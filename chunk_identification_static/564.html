<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>564</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    564
                    <a href="563.html">prev</a>
                    <a href="565.html">next</a>
                    <a href="564_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    GoogleCloudPlatform/bank-of-anthos_df4fe99ac82eb5fbe0432e8c7f553adf75b2dc61_src/ledgerwriter/src/main/java/anthos/samples/financedemo/ledgerwriter/LedgerWriterController.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\GoogleCloudPlatform\bank-of-anthos show &quot;df4fe99ac82eb5fbe0432e8c7f553adf75b2dc61:src/ledgerwriter/src/main/java/anthos/samples/financedemo/ledgerwriter/LedgerWriterController.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\GoogleCloudPlatform\bank-of-anthos show &quot;df4fe99ac82eb5fbe0432e8c7f553adf75b2dc61^1:src/ledgerwriter/src/main/java/anthos/samples/financedemo/ledgerwriter/LedgerWriterController.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\GoogleCloudPlatform\bank-of-anthos show &quot;df4fe99ac82eb5fbe0432e8c7f553adf75b2dc61^2:src/ledgerwriter/src/main/java/anthos/samples/financedemo/ledgerwriter/LedgerWriterController.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\GoogleCloudPlatform\bank-of-anthos show &quot;5aee626bdc4aeea6aa4c4c557c9873f11c3e12c0:src/ledgerwriter/src/main/java/anthos/samples/financedemo/ledgerwriter/LedgerWriterController.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bsj]], subset: [[bsj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">   2 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 /*                                                                                                       </span>
<span class="8011746770707306235" onmouseenter="enter('8011746770707306235');" onmouseout="out('8011746770707306235');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4  * Copyright 2020, Google LLC.                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17  */                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18                                                                                                          </span>
<span class="-1031727034891410218" onmouseenter="enter('-1031727034891410218');" onmouseout="out('-1031727034891410218');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19 package anthos.samples.financedemo.ledgerwriter;                                                         </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20                                                                                                          </span>
<span class="3887843854525453733" onmouseenter="enter('3887843854525453733');" onmouseout="out('3887843854525453733');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 import java.util.logging.Logger;                                                                         </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22                                                                                                          </span>
<span class="3248634983943737307" onmouseenter="enter('3248634983943737307');" onmouseout="out('3248634983943737307');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 import  org.springframework.web.client.HttpServerErrorException;                                         </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24                                                                                                          </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="-2449065930046514282" onmouseenter="enter('-2449065930046514282');" onmouseout="out('-2449065930046514282');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import org.springframework.http.HttpEntity;                                                              </span>
<span class="-2017038789555914398" onmouseenter="enter('-2017038789555914398');" onmouseout="out('-2017038789555914398');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 import org.springframework.http.HttpHeaders;                                                             </span>
<span class="7461978282736946494" onmouseenter="enter('7461978282736946494');" onmouseout="out('7461978282736946494');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 import org.springframework.http.HttpMethod;                                                              </span>
<span class="-6100913791676640620" onmouseenter="enter('-6100913791676640620');" onmouseout="out('-6100913791676640620');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 import org.springframework.http.HttpStatus;                                                              </span>
<span class="-4731930330216408095" onmouseenter="enter('-4731930330216408095');" onmouseout="out('-4731930330216408095');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 import org.springframework.http.ResponseEntity;                                                          </span>
<span class="5341219335560996028" onmouseenter="enter('5341219335560996028');" onmouseout="out('5341219335560996028');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import org.springframework.transaction.CannotCreateTransactionException;                                 </span>
<span class="-4152290558559497176" onmouseenter="enter('-4152290558559497176');" onmouseout="out('-4152290558559497176');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 import org.springframework.web.bind.annotation.GetMapping;                                               </span>
<span class="4051535263177665628" onmouseenter="enter('4051535263177665628');" onmouseout="out('4051535263177665628');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33 import org.springframework.web.bind.annotation.PostMapping;                                              </span>
<span class="-5091358343566339359" onmouseenter="enter('-5091358343566339359');" onmouseout="out('-5091358343566339359');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 import org.springframework.web.bind.annotation.RequestBody;                                              </span>
<span class="7012630364184468857" onmouseenter="enter('7012630364184468857');" onmouseout="out('7012630364184468857');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 import org.springframework.web.bind.annotation.RequestHeader;                                            </span>
<span class="-583363652389169341" onmouseenter="enter('-583363652389169341');" onmouseout="out('-583363652389169341');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36 import org.springframework.web.bind.annotation.ResponseStatus;                                           </span>
<span class="-7037114424511181002" onmouseenter="enter('-7037114424511181002');" onmouseout="out('-7037114424511181002');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37 import org.springframework.web.bind.annotation.RestController;                                           </span>
<span class="-7374118861510179828" onmouseenter="enter('-7374118861510179828');" onmouseout="out('-7374118861510179828');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38 import org.springframework.web.client.ResourceAccessException;                                           </span>
<span class="-2270477891067927787" onmouseenter="enter('-2270477891067927787');" onmouseout="out('-2270477891067927787');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39 import org.springframework.web.client.RestTemplate;                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40                                                                                                          </span>
<span class="494822993659260728" onmouseenter="enter('494822993659260728');" onmouseout="out('494822993659260728');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41 import com.auth0.jwt.JWTVerifier;                                                                        </span>
<span class="-7211641848955402551" onmouseenter="enter('-7211641848955402551');" onmouseout="out('-7211641848955402551');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42 import com.auth0.jwt.exceptions.JWTVerificationException;                                                </span>
<span class="5156920743651519035" onmouseenter="enter('5156920743651519035');" onmouseout="out('5156920743651519035');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43 import com.auth0.jwt.interfaces.DecodedJWT;                                                              </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44                                                                                                          </span>
<span class="6997167230740553376" onmouseenter="enter('6997167230740553376');" onmouseout="out('6997167230740553376');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45 import static anthos.samples.financedemo.ledgerwriter.ExceptionMessages.                                 </span>
<span class="5485927036637514847" onmouseenter="enter('5485927036637514847');" onmouseout="out('5485927036637514847');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46         EXCEPTION_MESSAGE_INSUFFICIENT_BALANCE;                                                          </span>
<span class="6997167230740553376" onmouseenter="enter('6997167230740553376');" onmouseout="out('6997167230740553376');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 import static anthos.samples.financedemo.ledgerwriter.ExceptionMessages.                                 </span>
<span class="-8362488606383815534" onmouseenter="enter('-8362488606383815534');" onmouseout="out('-8362488606383815534');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48         EXCEPTION_MESSAGE_WHEN_AUTHORIZATION_HEADER_NULL;                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49                                                                                                          </span>
<span class="6355076151554545937" onmouseenter="enter('6355076151554545937');" onmouseout="out('6355076151554545937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50 @RestController                                                                                          </span>
<span class="5933445460753317183" onmouseenter="enter('5933445460753317183');" onmouseout="out('5933445460753317183');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51 public final class LedgerWriterController {                                                              </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52                                                                                                          </span>
<span class="673777152962679767" onmouseenter="enter('673777152962679767');" onmouseout="out('673777152962679767');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53     private static final Logger LOGGER =                                                                 </span>
<span class="-7957956039430515397" onmouseenter="enter('-7957956039430515397');" onmouseout="out('-7957956039430515397');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54             Logger.getLogger(LedgerWriterController.class.getName());                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55                                                                                                          </span>
<span class="-728019112929028725" onmouseenter="enter('-728019112929028725');" onmouseout="out('-728019112929028725');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56     private TransactionRepository transactionRepository;                                                 </span>
<span class="-4578700528226723750" onmouseenter="enter('-4578700528226723750');" onmouseout="out('-4578700528226723750');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57     private TransactionValidator transactionValidator;                                                   </span>
<span class="-5049251535661215052" onmouseenter="enter('-5049251535661215052');" onmouseout="out('-5049251535661215052');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58     private JWTVerifier verifier;                                                                        </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59                                                                                                          </span>
<span class="-8636473471686513279" onmouseenter="enter('-8636473471686513279');" onmouseout="out('-8636473471686513279');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60     private String localRoutingNum;                                                                      </span>
<span class="-469486944919448386" onmouseenter="enter('-469486944919448386');" onmouseout="out('-469486944919448386');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61     private String balancesApiUri;                                                                       </span>
<span class="6148824265517010025" onmouseenter="enter('6148824265517010025');" onmouseout="out('6148824265517010025');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62     private String version;                                                                              </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63                                                                                                          </span>
<span class="-6505034648581184544" onmouseenter="enter('-6505034648581184544');" onmouseout="out('-6505034648581184544');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64     public static final String READINESS_CODE = &quot;ok&quot;;                                                    </span>
<span class="-9149089262416743429" onmouseenter="enter('-9149089262416743429');" onmouseout="out('-9149089262416743429');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65     public static final String UNAUTHORIZED_CODE = &quot;not authorized&quot;;                                     </span>
<span class="6290000176908202808" onmouseenter="enter('6290000176908202808');" onmouseout="out('6290000176908202808');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66     public static final String JWT_ACCOUNT_KEY = &quot;acct&quot;;                                                 </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68     /**                                                                                                  </span>
<span class="-1436741038288612910" onmouseenter="enter('-1436741038288612910');" onmouseout="out('-1436741038288612910');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69     * Constructor.                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70     *                                                                                                    </span>
<span class="-5348532432243399187" onmouseenter="enter('-5348532432243399187');" onmouseout="out('-5348532432243399187');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71     * Initializes JWT verifier.                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72     */                                                                                                   </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73                                                                                                          </span>
<span class="8937474768837710123" onmouseenter="enter('8937474768837710123');" onmouseout="out('8937474768837710123');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74     public LedgerWriterController(                                                                       </span>
<span class="2780303771851218368" onmouseenter="enter('2780303771851218368');" onmouseout="out('2780303771851218368');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75             JWTVerifier verifier,                                                                        </span>
<span class="1132068715177995291" onmouseenter="enter('1132068715177995291');" onmouseout="out('1132068715177995291');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76             TransactionRepository transactionRepository,                                                 </span>
<span class="5479269793478582431" onmouseenter="enter('5479269793478582431');" onmouseout="out('5479269793478582431');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77             TransactionValidator transactionValidator,                                                   </span>
<span class="-822564396537268339" onmouseenter="enter('-822564396537268339');" onmouseout="out('-822564396537268339');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78             @Value(&quot;${LOCAL_ROUTING_NUM}&quot;) String localRoutingNum,                                       </span>
<span class="-2250521274199702466" onmouseenter="enter('-2250521274199702466');" onmouseout="out('-2250521274199702466');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79             @Value(&quot;http://${BALANCES_API_ADDR}/balances&quot;)                                               </span>
<span class="5760341242560825698" onmouseenter="enter('5760341242560825698');" onmouseout="out('5760341242560825698');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80                     String balancesApiUri,                                                               </span>
<span class="3727660980762547349" onmouseenter="enter('3727660980762547349');" onmouseout="out('3727660980762547349');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81             @Value(&quot;${VERSION}&quot;) String version) {                                                       </span>
<span class="2791682847397564046" onmouseenter="enter('2791682847397564046');" onmouseout="out('2791682847397564046');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82         this.verifier = verifier;                                                                        </span>
<span class="5620916918385755227" onmouseenter="enter('5620916918385755227');" onmouseout="out('5620916918385755227');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83         this.transactionRepository = transactionRepository;                                              </span>
<span class="7194621662788445012" onmouseenter="enter('7194621662788445012');" onmouseout="out('7194621662788445012');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84         this.transactionValidator = transactionValidator;                                                </span>
<span class="5248812605098956146" onmouseenter="enter('5248812605098956146');" onmouseout="out('5248812605098956146');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85         this.localRoutingNum = localRoutingNum;                                                          </span>
<span class="-1729773563907748731" onmouseenter="enter('-1729773563907748731');" onmouseout="out('-1729773563907748731');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86         this.balancesApiUri = balancesApiUri;                                                            </span>
<span class="8734022701570323791" onmouseenter="enter('8734022701570323791');" onmouseout="out('8734022701570323791');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87         this.version = version;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90     /**                                                                                                  </span>
<span class="559132540195676827" onmouseenter="enter('559132540195676827');" onmouseout="out('559132540195676827');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91      * Version endpoint.                                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92      *                                                                                                   </span>
<span class="-3837725526160323045" onmouseenter="enter('-3837725526160323045');" onmouseout="out('-3837725526160323045');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93      * @return  service version string                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94      */                                                                                                  </span>
<span class="6685475051439146687" onmouseenter="enter('6685475051439146687');" onmouseout="out('6685475051439146687');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95     @GetMapping(&quot;/version&quot;)                                                                              </span>
<span class="580444279607563843" onmouseenter="enter('580444279607563843');" onmouseout="out('580444279607563843');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96     public ResponseEntity version() {                                                                    </span>
<span class="5343850267959959664" onmouseenter="enter('5343850267959959664');" onmouseout="out('5343850267959959664');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97         return new ResponseEntity&lt;String&gt;(version, HttpStatus.OK);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100     /**                                                                                                  </span>
<span class="-3900287586435222134" onmouseenter="enter('-3900287586435222134');" onmouseout="out('-3900287586435222134');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101      * Readiness probe endpoint.                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102      *                                                                                                   </span>
<span class="8463518254556868911" onmouseenter="enter('8463518254556868911');" onmouseout="out('8463518254556868911');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103      * @return HTTP Status 200 if server is ready to receive requests.                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104      */                                                                                                  </span>
<span class="-7757302847206504814" onmouseenter="enter('-7757302847206504814');" onmouseout="out('-7757302847206504814');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105     @GetMapping(&quot;/ready&quot;)                                                                                </span>
<span class="7447046953845578255" onmouseenter="enter('7447046953845578255');" onmouseout="out('7447046953845578255');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106     @ResponseStatus(HttpStatus.OK)                                                                       </span>
<span class="7271346341917529010" onmouseenter="enter('7271346341917529010');" onmouseout="out('7271346341917529010');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107     public ResponseEntity&lt;String&gt; readiness() {                                                          </span>
<span class="-4075762798656461919" onmouseenter="enter('-4075762798656461919');" onmouseout="out('-4075762798656461919');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108         return new ResponseEntity&lt;String&gt;(READINESS_CODE, HttpStatus.OK);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111     /**                                                                                                  </span>
<span class="3242866774072620153" onmouseenter="enter('3242866774072620153');" onmouseout="out('3242866774072620153');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112      * Submit a new transaction to the ledger.                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113      *                                                                                                   </span>
<span class="-1661212859137511783" onmouseenter="enter('-1661212859137511783');" onmouseout="out('-1661212859137511783');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114      * @param bearerToken  HTTP request &#x27;Authorization&#x27; header                                           </span>
<span class="5399615509278749127" onmouseenter="enter('5399615509278749127');" onmouseout="out('5399615509278749127');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115      * @param transaction  transaction to submit                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116      *                                                                                                   </span>
<span class="7486646966745340100" onmouseenter="enter('7486646966745340100');" onmouseout="out('7486646966745340100');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117      * @return  HTTP Status 200 if transaction was successfully submitted                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118      */                                                                                                  </span>
<span class="5323932416516552401" onmouseenter="enter('5323932416516552401');" onmouseout="out('5323932416516552401');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119     @PostMapping(value = &quot;/transactions&quot;, consumes = &quot;application/json&quot;)                                 </span>
<span class="7447046953845578255" onmouseenter="enter('7447046953845578255');" onmouseout="out('7447046953845578255');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120     @ResponseStatus(HttpStatus.OK)                                                                       </span>
<span class="1897907323625472935" onmouseenter="enter('1897907323625472935');" onmouseout="out('1897907323625472935');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121     public ResponseEntity&lt;?&gt; addTransaction(                                                             </span>
<span class="1166903297081280981" onmouseenter="enter('1166903297081280981');" onmouseout="out('1166903297081280981');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122             @RequestHeader(&quot;Authorization&quot;) String bearerToken,                                          </span>
<span class="9022696444049056102" onmouseenter="enter('9022696444049056102');" onmouseout="out('9022696444049056102');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123             @RequestBody Transaction transaction) {                                                      </span>
<span class="-3538581758087352701" onmouseenter="enter('-3538581758087352701');" onmouseout="out('-3538581758087352701');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124         if (bearerToken != null &amp;&amp; bearerToken.startsWith(&quot;Bearer &quot;)) {                                  </span>
<span class="-7115210276566291681" onmouseenter="enter('-7115210276566291681');" onmouseout="out('-7115210276566291681');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125             bearerToken = bearerToken.split(&quot;Bearer &quot;)[1];                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127         try {                                                                                            </span>
<span class="-4457463381546497224" onmouseenter="enter('-4457463381546497224');" onmouseout="out('-4457463381546497224');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128             if (bearerToken == null) {                                                                   </span>
<span class="-5454936540258631376" onmouseenter="enter('-5454936540258631376');" onmouseout="out('-5454936540258631376');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129                 throw new IllegalArgumentException(                                                      </span>
<span class="-4688472594501119643" onmouseenter="enter('-4688472594501119643');" onmouseout="out('-4688472594501119643');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130                         EXCEPTION_MESSAGE_WHEN_AUTHORIZATION_HEADER_NULL);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131             }                                                                                            </span>
<span class="-5768910099284843906" onmouseenter="enter('-5768910099284843906');" onmouseout="out('-5768910099284843906');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132             final DecodedJWT jwt = this.verifier.verify(bearerToken);                                    </span>
<span class="-6962791519859020761" onmouseenter="enter('-6962791519859020761');" onmouseout="out('-6962791519859020761');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133             // validate transaction                                                                      </span>
<span class="776637986685870327" onmouseenter="enter('776637986685870327');" onmouseout="out('776637986685870327');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134             transactionValidator.validateTransaction(localRoutingNum,                                    </span>
<span class="-4879758647615452357" onmouseenter="enter('-4879758647615452357');" onmouseout="out('-4879758647615452357');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135                     jwt.getClaim(JWT_ACCOUNT_KEY).asString(), transaction);                              </span>
<span class="-1762835934379555281" onmouseenter="enter('-1762835934379555281');" onmouseout="out('-1762835934379555281');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136             // Ensure sender balance can cover transaction.                                              </span>
<span class="-6144219964793655128" onmouseenter="enter('-6144219964793655128');" onmouseout="out('-6144219964793655128');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137             if (transaction.getFromRoutingNum().equals(localRoutingNum)) {                               </span>
<span class="7239735847198029864" onmouseenter="enter('7239735847198029864');" onmouseout="out('7239735847198029864');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138                 int balance = getAvailableBalance(                                                       </span>
<span class="7702083458280016025" onmouseenter="enter('7702083458280016025');" onmouseout="out('7702083458280016025');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139                         bearerToken, transaction.getFromAccountNum());                                   </span>
<span class="-8424323426889164999" onmouseenter="enter('-8424323426889164999');" onmouseout="out('-8424323426889164999');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140                 if (balance &lt; transaction.getAmount()) {                                                 </span>
<span class="-8046945014218387655" onmouseenter="enter('-8046945014218387655');" onmouseout="out('-8046945014218387655');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141                     throw new IllegalStateException(                                                     </span>
<span class="-5146115328615515543" onmouseenter="enter('-5146115328615515543');" onmouseout="out('-5146115328615515543');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142                             EXCEPTION_MESSAGE_INSUFFICIENT_BALANCE);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145                                                                                                          </span>
<span class="-3539745766511737220" onmouseenter="enter('-3539745766511737220');" onmouseout="out('-3539745766511737220');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146             // No exceptions thrown. Add to ledger                                                       </span>
<span class="613498208305766257" onmouseenter="enter('613498208305766257');" onmouseout="out('613498208305766257');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147             LOGGER.fine(&quot;Submitting transaction &quot;                                                        </span>
<span class="2531207035820706002" onmouseenter="enter('2531207035820706002');" onmouseout="out('2531207035820706002');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148                     + transaction.toString());                                                           </span>
<span class="-7584575581620960643" onmouseenter="enter('-7584575581620960643');" onmouseout="out('-7584575581620960643');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149             transactionRepository.save(transaction);                                                     </span>
<span class="-5231725033690787161" onmouseenter="enter('-5231725033690787161');" onmouseout="out('-5231725033690787161');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150             return new ResponseEntity&lt;String&gt;(READINESS_CODE,                                            </span>
<span class="-8527330892964817671" onmouseenter="enter('-8527330892964817671');" onmouseout="out('-8527330892964817671');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151                     HttpStatus.CREATED);                                                                 </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152                                                                                                          </span>
<span class="5687577372953802395" onmouseenter="enter('5687577372953802395');" onmouseout="out('5687577372953802395');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153         } catch (JWTVerificationException e) {                                                           </span>
<span class="-4154758301555607236" onmouseenter="enter('-4154758301555607236');" onmouseout="out('-4154758301555607236');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154             return new ResponseEntity&lt;String&gt;(UNAUTHORIZED_CODE,                                         </span>
<span class="-3711769128880294107" onmouseenter="enter('-3711769128880294107');" onmouseout="out('-3711769128880294107');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155                                               HttpStatus.UNAUTHORIZED);                                  </span>
<span class="-16261657306661328" onmouseenter="enter('-16261657306661328');" onmouseout="out('-16261657306661328');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156         } catch (IllegalArgumentException | IllegalStateException e) {                                   </span>
<span class="4951897796013672092" onmouseenter="enter('4951897796013672092');" onmouseout="out('4951897796013672092');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157             return new ResponseEntity&lt;String&gt;(e.getMessage(),                                            </span>
<span class="-4870417752025294804" onmouseenter="enter('-4870417752025294804');" onmouseout="out('-4870417752025294804');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158                                               HttpStatus.BAD_REQUEST);                                   </span>
<span class="2761749540388092140" onmouseenter="enter('2761749540388092140');" onmouseout="out('2761749540388092140');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159         } catch (ResourceAccessException                                                                 </span>
<span class="7920423166678117814" onmouseenter="enter('7920423166678117814');" onmouseout="out('7920423166678117814');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160                 | CannotCreateTransactionException                                                       </span>
<span class="-7265908382255363783" onmouseenter="enter('-7265908382255363783');" onmouseout="out('-7265908382255363783');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161                 | HttpServerErrorException e) {                                                          </span>
<span class="4951897796013672092" onmouseenter="enter('4951897796013672092');" onmouseout="out('4951897796013672092');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162             return new ResponseEntity&lt;String&gt;(e.getMessage(),                                            </span>
<span class="862392687202373996" onmouseenter="enter('862392687202373996');" onmouseout="out('862392687202373996');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163                                               HttpStatus.INTERNAL_SERVER_ERROR);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 166                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 167     /**                                                                                                  </span>
<span class="-840803106370353754" onmouseenter="enter('-840803106370353754');" onmouseout="out('-840803106370353754');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168      * Retrieve the balance for the transaction&#x27;s sender.                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169      *                                                                                                   </span>
<span class="-5399624366599429167" onmouseenter="enter('-5399624366599429167');" onmouseout="out('-5399624366599429167');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170      * @param token  the token used to authenticate request                                              </span>
<span class="5530241027805460636" onmouseenter="enter('5530241027805460636');" onmouseout="out('5530241027805460636');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 171      * @param fromAcct  sender account number                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172      *                                                                                                   </span>
<span class="-4671862933441611565" onmouseenter="enter('-4671862933441611565');" onmouseout="out('-4671862933441611565');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173      * @return available balance of the sender account                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174      *                                                                                                   </span>
<span class="7966166498405371741" onmouseenter="enter('7966166498405371741');" onmouseout="out('7966166498405371741');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175      * @throws HttpServerErrorException  if balance service returns 500                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176      */                                                                                                  </span>
<span class="-4867839573468993721" onmouseenter="enter('-4867839573468993721');" onmouseout="out('-4867839573468993721');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177     protected int getAvailableBalance(String token, String fromAcct)                                     </span>
<span class="7044480961715798280" onmouseenter="enter('7044480961715798280');" onmouseout="out('7044480961715798280');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178             throws HttpServerErrorException {                                                            </span>
<span class="-1187465989316714928" onmouseenter="enter('-1187465989316714928');" onmouseout="out('-1187465989316714928');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179         HttpHeaders headers = new HttpHeaders();                                                         </span>
<span class="3201291767686862102" onmouseenter="enter('3201291767686862102');" onmouseout="out('3201291767686862102');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180         headers.set(&quot;Authorization&quot;, &quot;Bearer &quot; + token);                                                 </span>
<span class="-1899310457862616867" onmouseenter="enter('-1899310457862616867');" onmouseout="out('-1899310457862616867');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181         HttpEntity entity = new HttpEntity(headers);                                                     </span>
<span class="3202802947297119524" onmouseenter="enter('3202802947297119524');" onmouseout="out('3202802947297119524');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182         RestTemplate restTemplate = new RestTemplate();                                                  </span>
<span class="5149154134365859036" onmouseenter="enter('5149154134365859036');" onmouseout="out('5149154134365859036');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183         String uri = balancesApiUri + &quot;/&quot; + fromAcct;                                                    </span>
<span class="-697674251075958280" onmouseenter="enter('-697674251075958280');" onmouseout="out('-697674251075958280');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184         ResponseEntity&lt;Integer&gt; response = restTemplate.exchange(                                        </span>
<span class="6083870125336786698" onmouseenter="enter('6083870125336786698');" onmouseout="out('6083870125336786698');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185             uri, HttpMethod.GET, entity, Integer.class);                                                 </span>
<span class="6400740982500579689" onmouseenter="enter('6400740982500579689');" onmouseout="out('6400740982500579689');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186         Integer senderBalance = response.getBody();                                                      </span>
<span class="8092340863849585815" onmouseenter="enter('8092340863849585815');" onmouseout="out('8092340863849585815');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187         return senderBalance.intValue();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190 }                                                                                                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 191 =======                                                                                                  </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192 /*                                                                                                       </span>
<span class="8011746770707306235" onmouseenter="enter('8011746770707306235');" onmouseout="out('8011746770707306235');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193  * Copyright 2020, Google LLC.                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 206  */                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207                                                                                                          </span>
<span class="-1031727034891410218" onmouseenter="enter('-1031727034891410218');" onmouseout="out('-1031727034891410218');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208 package anthos.samples.financedemo.ledgerwriter;                                                         </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209                                                                                                          </span>
<span class="-538473715904851717" onmouseenter="enter('-538473715904851717');" onmouseout="out('-538473715904851717');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210 import org.apache.logging.log4j.LogManager;                                                              </span>
<span class="2283937394492695819" onmouseenter="enter('2283937394492695819');" onmouseout="out('2283937394492695819');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211 import org.apache.logging.log4j.Logger;                                                                  </span>
<span class="3248634983943737307" onmouseenter="enter('3248634983943737307');" onmouseout="out('3248634983943737307');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212 import  org.springframework.web.client.HttpServerErrorException;                                         </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213                                                                                                          </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 214 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="-2449065930046514282" onmouseenter="enter('-2449065930046514282');" onmouseout="out('-2449065930046514282');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215 import org.springframework.http.HttpEntity;                                                              </span>
<span class="-2017038789555914398" onmouseenter="enter('-2017038789555914398');" onmouseout="out('-2017038789555914398');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 216 import org.springframework.http.HttpHeaders;                                                             </span>
<span class="7461978282736946494" onmouseenter="enter('7461978282736946494');" onmouseout="out('7461978282736946494');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 217 import org.springframework.http.HttpMethod;                                                              </span>
<span class="-6100913791676640620" onmouseenter="enter('-6100913791676640620');" onmouseout="out('-6100913791676640620');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 218 import org.springframework.http.HttpStatus;                                                              </span>
<span class="-4731930330216408095" onmouseenter="enter('-4731930330216408095');" onmouseout="out('-4731930330216408095');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 219 import org.springframework.http.ResponseEntity;                                                          </span>
<span class="5341219335560996028" onmouseenter="enter('5341219335560996028');" onmouseout="out('5341219335560996028');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 220 import org.springframework.transaction.CannotCreateTransactionException;                                 </span>
<span class="-4152290558559497176" onmouseenter="enter('-4152290558559497176');" onmouseout="out('-4152290558559497176');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 221 import org.springframework.web.bind.annotation.GetMapping;                                               </span>
<span class="4051535263177665628" onmouseenter="enter('4051535263177665628');" onmouseout="out('4051535263177665628');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 222 import org.springframework.web.bind.annotation.PostMapping;                                              </span>
<span class="-5091358343566339359" onmouseenter="enter('-5091358343566339359');" onmouseout="out('-5091358343566339359');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 223 import org.springframework.web.bind.annotation.RequestBody;                                              </span>
<span class="7012630364184468857" onmouseenter="enter('7012630364184468857');" onmouseout="out('7012630364184468857');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 224 import org.springframework.web.bind.annotation.RequestHeader;                                            </span>
<span class="-583363652389169341" onmouseenter="enter('-583363652389169341');" onmouseout="out('-583363652389169341');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225 import org.springframework.web.bind.annotation.ResponseStatus;                                           </span>
<span class="-7037114424511181002" onmouseenter="enter('-7037114424511181002');" onmouseout="out('-7037114424511181002');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226 import org.springframework.web.bind.annotation.RestController;                                           </span>
<span class="-7374118861510179828" onmouseenter="enter('-7374118861510179828');" onmouseout="out('-7374118861510179828');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 227 import org.springframework.web.client.ResourceAccessException;                                           </span>
<span class="-2270477891067927787" onmouseenter="enter('-2270477891067927787');" onmouseout="out('-2270477891067927787');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 228 import org.springframework.web.client.RestTemplate;                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 229                                                                                                          </span>
<span class="494822993659260728" onmouseenter="enter('494822993659260728');" onmouseout="out('494822993659260728');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 230 import com.auth0.jwt.JWTVerifier;                                                                        </span>
<span class="-7211641848955402551" onmouseenter="enter('-7211641848955402551');" onmouseout="out('-7211641848955402551');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 231 import com.auth0.jwt.exceptions.JWTVerificationException;                                                </span>
<span class="5156920743651519035" onmouseenter="enter('5156920743651519035');" onmouseout="out('5156920743651519035');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 232 import com.auth0.jwt.interfaces.DecodedJWT;                                                              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 233                                                                                                          </span>
<span class="6997167230740553376" onmouseenter="enter('6997167230740553376');" onmouseout="out('6997167230740553376');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 234 import static anthos.samples.financedemo.ledgerwriter.ExceptionMessages.                                 </span>
<span class="5485927036637514847" onmouseenter="enter('5485927036637514847');" onmouseout="out('5485927036637514847');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 235         EXCEPTION_MESSAGE_INSUFFICIENT_BALANCE;                                                          </span>
<span class="6997167230740553376" onmouseenter="enter('6997167230740553376');" onmouseout="out('6997167230740553376');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 236 import static anthos.samples.financedemo.ledgerwriter.ExceptionMessages.                                 </span>
<span class="-8362488606383815534" onmouseenter="enter('-8362488606383815534');" onmouseout="out('-8362488606383815534');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 237         EXCEPTION_MESSAGE_WHEN_AUTHORIZATION_HEADER_NULL;                                                </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 238                                                                                                          </span>
<span class="6355076151554545937" onmouseenter="enter('6355076151554545937');" onmouseout="out('6355076151554545937');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 239 @RestController                                                                                          </span>
<span class="5933445460753317183" onmouseenter="enter('5933445460753317183');" onmouseout="out('5933445460753317183');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 240 public final class LedgerWriterController {                                                              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 241                                                                                                          </span>
<span class="673777152962679767" onmouseenter="enter('673777152962679767');" onmouseout="out('673777152962679767');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 242     private static final Logger LOGGER =                                                                 </span>
<span class="999928017189038216" onmouseenter="enter('999928017189038216');" onmouseout="out('999928017189038216');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 243         LogManager.getLogger(LedgerWriterController.class);                                              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 244                                                                                                          </span>
<span class="-728019112929028725" onmouseenter="enter('-728019112929028725');" onmouseout="out('-728019112929028725');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 245     private TransactionRepository transactionRepository;                                                 </span>
<span class="-4578700528226723750" onmouseenter="enter('-4578700528226723750');" onmouseout="out('-4578700528226723750');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 246     private TransactionValidator transactionValidator;                                                   </span>
<span class="-5049251535661215052" onmouseenter="enter('-5049251535661215052');" onmouseout="out('-5049251535661215052');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 247     private JWTVerifier verifier;                                                                        </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 248                                                                                                          </span>
<span class="-8636473471686513279" onmouseenter="enter('-8636473471686513279');" onmouseout="out('-8636473471686513279');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 249     private String localRoutingNum;                                                                      </span>
<span class="-469486944919448386" onmouseenter="enter('-469486944919448386');" onmouseout="out('-469486944919448386');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 250     private String balancesApiUri;                                                                       </span>
<span class="6148824265517010025" onmouseenter="enter('6148824265517010025');" onmouseout="out('6148824265517010025');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 251     private String version;                                                                              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 252                                                                                                          </span>
<span class="-6505034648581184544" onmouseenter="enter('-6505034648581184544');" onmouseout="out('-6505034648581184544');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 253     public static final String READINESS_CODE = &quot;ok&quot;;                                                    </span>
<span class="-9149089262416743429" onmouseenter="enter('-9149089262416743429');" onmouseout="out('-9149089262416743429');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254     public static final String UNAUTHORIZED_CODE = &quot;not authorized&quot;;                                     </span>
<span class="6290000176908202808" onmouseenter="enter('6290000176908202808');" onmouseout="out('6290000176908202808');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 255     public static final String JWT_ACCOUNT_KEY = &quot;acct&quot;;                                                 </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 256                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 257     /**                                                                                                  </span>
<span class="-1436741038288612910" onmouseenter="enter('-1436741038288612910');" onmouseout="out('-1436741038288612910');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 258     * Constructor.                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 259     *                                                                                                    </span>
<span class="-5348532432243399187" onmouseenter="enter('-5348532432243399187');" onmouseout="out('-5348532432243399187');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 260     * Initializes JWT verifier.                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 261     */                                                                                                   </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 262                                                                                                          </span>
<span class="8937474768837710123" onmouseenter="enter('8937474768837710123');" onmouseout="out('8937474768837710123');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 263     public LedgerWriterController(                                                                       </span>
<span class="2780303771851218368" onmouseenter="enter('2780303771851218368');" onmouseout="out('2780303771851218368');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 264             JWTVerifier verifier,                                                                        </span>
<span class="1132068715177995291" onmouseenter="enter('1132068715177995291');" onmouseout="out('1132068715177995291');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 265             TransactionRepository transactionRepository,                                                 </span>
<span class="5479269793478582431" onmouseenter="enter('5479269793478582431');" onmouseout="out('5479269793478582431');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 266             TransactionValidator transactionValidator,                                                   </span>
<span class="-822564396537268339" onmouseenter="enter('-822564396537268339');" onmouseout="out('-822564396537268339');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 267             @Value(&quot;${LOCAL_ROUTING_NUM}&quot;) String localRoutingNum,                                       </span>
<span class="-2250521274199702466" onmouseenter="enter('-2250521274199702466');" onmouseout="out('-2250521274199702466');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 268             @Value(&quot;http://${BALANCES_API_ADDR}/balances&quot;)                                               </span>
<span class="5760341242560825698" onmouseenter="enter('5760341242560825698');" onmouseout="out('5760341242560825698');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 269                     String balancesApiUri,                                                               </span>
<span class="3727660980762547349" onmouseenter="enter('3727660980762547349');" onmouseout="out('3727660980762547349');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 270             @Value(&quot;${VERSION}&quot;) String version) {                                                       </span>
<span class="2791682847397564046" onmouseenter="enter('2791682847397564046');" onmouseout="out('2791682847397564046');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 271         this.verifier = verifier;                                                                        </span>
<span class="5620916918385755227" onmouseenter="enter('5620916918385755227');" onmouseout="out('5620916918385755227');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 272         this.transactionRepository = transactionRepository;                                              </span>
<span class="7194621662788445012" onmouseenter="enter('7194621662788445012');" onmouseout="out('7194621662788445012');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 273         this.transactionValidator = transactionValidator;                                                </span>
<span class="5248812605098956146" onmouseenter="enter('5248812605098956146');" onmouseout="out('5248812605098956146');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 274         this.localRoutingNum = localRoutingNum;                                                          </span>
<span class="-1729773563907748731" onmouseenter="enter('-1729773563907748731');" onmouseout="out('-1729773563907748731');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 275         this.balancesApiUri = balancesApiUri;                                                            </span>
<span class="8734022701570323791" onmouseenter="enter('8734022701570323791');" onmouseout="out('8734022701570323791');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 276         this.version = version;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 277     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 278                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 279     /**                                                                                                  </span>
<span class="559132540195676827" onmouseenter="enter('559132540195676827');" onmouseout="out('559132540195676827');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 280      * Version endpoint.                                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 281      *                                                                                                   </span>
<span class="-3837725526160323045" onmouseenter="enter('-3837725526160323045');" onmouseout="out('-3837725526160323045');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282      * @return  service version string                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 283      */                                                                                                  </span>
<span class="6685475051439146687" onmouseenter="enter('6685475051439146687');" onmouseout="out('6685475051439146687');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284     @GetMapping(&quot;/version&quot;)                                                                              </span>
<span class="580444279607563843" onmouseenter="enter('580444279607563843');" onmouseout="out('580444279607563843');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 285     public ResponseEntity version() {                                                                    </span>
<span class="5343850267959959664" onmouseenter="enter('5343850267959959664');" onmouseout="out('5343850267959959664');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 286         return new ResponseEntity&lt;String&gt;(version, HttpStatus.OK);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 287     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 288                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 289     /**                                                                                                  </span>
<span class="-3900287586435222134" onmouseenter="enter('-3900287586435222134');" onmouseout="out('-3900287586435222134');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 290      * Readiness probe endpoint.                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 291      *                                                                                                   </span>
<span class="8463518254556868911" onmouseenter="enter('8463518254556868911');" onmouseout="out('8463518254556868911');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 292      * @return HTTP Status 200 if server is ready to receive requests.                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 293      */                                                                                                  </span>
<span class="-7757302847206504814" onmouseenter="enter('-7757302847206504814');" onmouseout="out('-7757302847206504814');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 294     @GetMapping(&quot;/ready&quot;)                                                                                </span>
<span class="7447046953845578255" onmouseenter="enter('7447046953845578255');" onmouseout="out('7447046953845578255');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 295     @ResponseStatus(HttpStatus.OK)                                                                       </span>
<span class="7271346341917529010" onmouseenter="enter('7271346341917529010');" onmouseout="out('7271346341917529010');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 296     public ResponseEntity&lt;String&gt; readiness() {                                                          </span>
<span class="-4075762798656461919" onmouseenter="enter('-4075762798656461919');" onmouseout="out('-4075762798656461919');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 297         return new ResponseEntity&lt;String&gt;(READINESS_CODE, HttpStatus.OK);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 298     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 299                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 300     /**                                                                                                  </span>
<span class="3242866774072620153" onmouseenter="enter('3242866774072620153');" onmouseout="out('3242866774072620153');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 301      * Submit a new transaction to the ledger.                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 302      *                                                                                                   </span>
<span class="-1661212859137511783" onmouseenter="enter('-1661212859137511783');" onmouseout="out('-1661212859137511783');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 303      * @param bearerToken  HTTP request &#x27;Authorization&#x27; header                                           </span>
<span class="5399615509278749127" onmouseenter="enter('5399615509278749127');" onmouseout="out('5399615509278749127');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 304      * @param transaction  transaction to submit                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 305      *                                                                                                   </span>
<span class="7486646966745340100" onmouseenter="enter('7486646966745340100');" onmouseout="out('7486646966745340100');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 306      * @return  HTTP Status 200 if transaction was successfully submitted                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 307      */                                                                                                  </span>
<span class="5323932416516552401" onmouseenter="enter('5323932416516552401');" onmouseout="out('5323932416516552401');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 308     @PostMapping(value = &quot;/transactions&quot;, consumes = &quot;application/json&quot;)                                 </span>
<span class="7447046953845578255" onmouseenter="enter('7447046953845578255');" onmouseout="out('7447046953845578255');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 309     @ResponseStatus(HttpStatus.OK)                                                                       </span>
<span class="1897907323625472935" onmouseenter="enter('1897907323625472935');" onmouseout="out('1897907323625472935');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 310     public ResponseEntity&lt;?&gt; addTransaction(                                                             </span>
<span class="1166903297081280981" onmouseenter="enter('1166903297081280981');" onmouseout="out('1166903297081280981');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 311             @RequestHeader(&quot;Authorization&quot;) String bearerToken,                                          </span>
<span class="9022696444049056102" onmouseenter="enter('9022696444049056102');" onmouseout="out('9022696444049056102');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 312             @RequestBody Transaction transaction) {                                                      </span>
<span class="-3538581758087352701" onmouseenter="enter('-3538581758087352701');" onmouseout="out('-3538581758087352701');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 313         if (bearerToken != null &amp;&amp; bearerToken.startsWith(&quot;Bearer &quot;)) {                                  </span>
<span class="-7115210276566291681" onmouseenter="enter('-7115210276566291681');" onmouseout="out('-7115210276566291681');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 314             bearerToken = bearerToken.split(&quot;Bearer &quot;)[1];                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 315         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 316         try {                                                                                            </span>
<span class="-4457463381546497224" onmouseenter="enter('-4457463381546497224');" onmouseout="out('-4457463381546497224');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 317             if (bearerToken == null) {                                                                   </span>
<span class="8471284381161989921" onmouseenter="enter('8471284381161989921');" onmouseout="out('8471284381161989921');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 318                 LOGGER.error(&quot;Transaction submission failed: &quot;                                           </span>
<span class="-6310070690167802414" onmouseenter="enter('-6310070690167802414');" onmouseout="out('-6310070690167802414');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 319                     + &quot;Authorization header null&quot;);                                                      </span>
<span class="-5454936540258631376" onmouseenter="enter('-5454936540258631376');" onmouseout="out('-5454936540258631376');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 320                 throw new IllegalArgumentException(                                                      </span>
<span class="-4688472594501119643" onmouseenter="enter('-4688472594501119643');" onmouseout="out('-4688472594501119643');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 321                         EXCEPTION_MESSAGE_WHEN_AUTHORIZATION_HEADER_NULL);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 322             }                                                                                            </span>
<span class="-5768910099284843906" onmouseenter="enter('-5768910099284843906');" onmouseout="out('-5768910099284843906');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 323             final DecodedJWT jwt = this.verifier.verify(bearerToken);                                    </span>
<span class="-6962791519859020761" onmouseenter="enter('-6962791519859020761');" onmouseout="out('-6962791519859020761');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 324             // validate transaction                                                                      </span>
<span class="776637986685870327" onmouseenter="enter('776637986685870327');" onmouseout="out('776637986685870327');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 325             transactionValidator.validateTransaction(localRoutingNum,                                    </span>
<span class="-4879758647615452357" onmouseenter="enter('-4879758647615452357');" onmouseout="out('-4879758647615452357');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 326                     jwt.getClaim(JWT_ACCOUNT_KEY).asString(), transaction);                              </span>
<span class="-1762835934379555281" onmouseenter="enter('-1762835934379555281');" onmouseout="out('-1762835934379555281');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 327             // Ensure sender balance can cover transaction.                                              </span>
<span class="-6144219964793655128" onmouseenter="enter('-6144219964793655128');" onmouseout="out('-6144219964793655128');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 328             if (transaction.getFromRoutingNum().equals(localRoutingNum)) {                               </span>
<span class="7239735847198029864" onmouseenter="enter('7239735847198029864');" onmouseout="out('7239735847198029864');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 329                 int balance = getAvailableBalance(                                                       </span>
<span class="7702083458280016025" onmouseenter="enter('7702083458280016025');" onmouseout="out('7702083458280016025');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 330                         bearerToken, transaction.getFromAccountNum());                                   </span>
<span class="-8424323426889164999" onmouseenter="enter('-8424323426889164999');" onmouseout="out('-8424323426889164999');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 331                 if (balance &lt; transaction.getAmount()) {                                                 </span>
<span class="8471284381161989921" onmouseenter="enter('8471284381161989921');" onmouseout="out('8471284381161989921');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 332                     LOGGER.error(&quot;Transaction submission failed: &quot;                                       </span>
<span class="2606405075138145997" onmouseenter="enter('2606405075138145997');" onmouseout="out('2606405075138145997');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 333                         + &quot;Insufficient balance&quot;);                                                       </span>
<span class="-8046945014218387655" onmouseenter="enter('-8046945014218387655');" onmouseout="out('-8046945014218387655');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 334                     throw new IllegalStateException(                                                     </span>
<span class="-5146115328615515543" onmouseenter="enter('-5146115328615515543');" onmouseout="out('-5146115328615515543');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 335                             EXCEPTION_MESSAGE_INSUFFICIENT_BALANCE);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 336                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 337             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 338                                                                                                          </span>
<span class="-3539745766511737220" onmouseenter="enter('-3539745766511737220');" onmouseout="out('-3539745766511737220');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 339             // No exceptions thrown. Add to ledger                                                       </span>
<span class="-7584575581620960643" onmouseenter="enter('-7584575581620960643');" onmouseout="out('-7584575581620960643');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 340             transactionRepository.save(transaction);                                                     </span>
<span class="5719956641649610757" onmouseenter="enter('5719956641649610757');" onmouseout="out('5719956641649610757');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 341             LOGGER.info(&quot;Submitted transaction successfully&quot;);                                           </span>
<span class="-5231725033690787161" onmouseenter="enter('-5231725033690787161');" onmouseout="out('-5231725033690787161');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 342             return new ResponseEntity&lt;String&gt;(READINESS_CODE,                                            </span>
<span class="-8527330892964817671" onmouseenter="enter('-8527330892964817671');" onmouseout="out('-8527330892964817671');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 343                     HttpStatus.CREATED);                                                                 </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 344                                                                                                          </span>
<span class="5687577372953802395" onmouseenter="enter('5687577372953802395');" onmouseout="out('5687577372953802395');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 345         } catch (JWTVerificationException e) {                                                           </span>
<span class="-327448583504624880" onmouseenter="enter('-327448583504624880');" onmouseout="out('-327448583504624880');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 346             LOGGER.error(&quot;Failed to submit transaction: &quot;                                                </span>
<span class="5874187622003058896" onmouseenter="enter('5874187622003058896');" onmouseout="out('5874187622003058896');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 347                 + &quot;not authorized&quot;);                                                                     </span>
<span class="-4154758301555607236" onmouseenter="enter('-4154758301555607236');" onmouseout="out('-4154758301555607236');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 348             return new ResponseEntity&lt;String&gt;(UNAUTHORIZED_CODE,                                         </span>
<span class="-3711769128880294107" onmouseenter="enter('-3711769128880294107');" onmouseout="out('-3711769128880294107');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 349                                               HttpStatus.UNAUTHORIZED);                                  </span>
<span class="-16261657306661328" onmouseenter="enter('-16261657306661328');" onmouseout="out('-16261657306661328');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 350         } catch (IllegalArgumentException | IllegalStateException e) {                                   </span>
<span class="-7663233641936656847" onmouseenter="enter('-7663233641936656847');" onmouseout="out('-7663233641936656847');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 351             LOGGER.error(&quot;Failed to retrieve account balance: &quot;                                          </span>
<span class="-1386920267869766944" onmouseenter="enter('-1386920267869766944');" onmouseout="out('-1386920267869766944');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 352                 + &quot;bad request&quot;);                                                                        </span>
<span class="4951897796013672092" onmouseenter="enter('4951897796013672092');" onmouseout="out('4951897796013672092');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 353             return new ResponseEntity&lt;String&gt;(e.getMessage(),                                            </span>
<span class="-4870417752025294804" onmouseenter="enter('-4870417752025294804');" onmouseout="out('-4870417752025294804');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 354                                               HttpStatus.BAD_REQUEST);                                   </span>
<span class="2761749540388092140" onmouseenter="enter('2761749540388092140');" onmouseout="out('2761749540388092140');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 355         } catch (ResourceAccessException                                                                 </span>
<span class="7920423166678117814" onmouseenter="enter('7920423166678117814');" onmouseout="out('7920423166678117814');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 356                 | CannotCreateTransactionException                                                       </span>
<span class="-7265908382255363783" onmouseenter="enter('-7265908382255363783');" onmouseout="out('-7265908382255363783');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 357                 | HttpServerErrorException e) {                                                          </span>
<span class="-6756904505334648824" onmouseenter="enter('-6756904505334648824');" onmouseout="out('-6756904505334648824');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 358             LOGGER.error(&quot;Failed to retrieve account balance&quot;);                                          </span>
<span class="4951897796013672092" onmouseenter="enter('4951897796013672092');" onmouseout="out('4951897796013672092');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 359             return new ResponseEntity&lt;String&gt;(e.getMessage(),                                            </span>
<span class="862392687202373996" onmouseenter="enter('862392687202373996');" onmouseout="out('862392687202373996');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 360                                               HttpStatus.INTERNAL_SERVER_ERROR);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 361         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 362     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 363                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 364     /**                                                                                                  </span>
<span class="-840803106370353754" onmouseenter="enter('-840803106370353754');" onmouseout="out('-840803106370353754');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 365      * Retrieve the balance for the transaction&#x27;s sender.                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 366      *                                                                                                   </span>
<span class="-5399624366599429167" onmouseenter="enter('-5399624366599429167');" onmouseout="out('-5399624366599429167');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 367      * @param token  the token used to authenticate request                                              </span>
<span class="5530241027805460636" onmouseenter="enter('5530241027805460636');" onmouseout="out('5530241027805460636');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 368      * @param fromAcct  sender account number                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 369      *                                                                                                   </span>
<span class="-4671862933441611565" onmouseenter="enter('-4671862933441611565');" onmouseout="out('-4671862933441611565');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 370      * @return available balance of the sender account                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 371      *                                                                                                   </span>
<span class="7966166498405371741" onmouseenter="enter('7966166498405371741');" onmouseout="out('7966166498405371741');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 372      * @throws HttpServerErrorException  if balance service returns 500                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 373      */                                                                                                  </span>
<span class="-4867839573468993721" onmouseenter="enter('-4867839573468993721');" onmouseout="out('-4867839573468993721');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 374     protected int getAvailableBalance(String token, String fromAcct)                                     </span>
<span class="7044480961715798280" onmouseenter="enter('7044480961715798280');" onmouseout="out('7044480961715798280');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 375             throws HttpServerErrorException {                                                            </span>
<span class="2945528015156409897" onmouseenter="enter('2945528015156409897');" onmouseout="out('2945528015156409897');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 376         LOGGER.debug(&quot;Retrieving balance for transaction sender&quot;);                                       </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 377                                                                                                          </span>
<span class="-1187465989316714928" onmouseenter="enter('-1187465989316714928');" onmouseout="out('-1187465989316714928');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 378         HttpHeaders headers = new HttpHeaders();                                                         </span>
<span class="3201291767686862102" onmouseenter="enter('3201291767686862102');" onmouseout="out('3201291767686862102');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 379         headers.set(&quot;Authorization&quot;, &quot;Bearer &quot; + token);                                                 </span>
<span class="-1899310457862616867" onmouseenter="enter('-1899310457862616867');" onmouseout="out('-1899310457862616867');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 380         HttpEntity entity = new HttpEntity(headers);                                                     </span>
<span class="3202802947297119524" onmouseenter="enter('3202802947297119524');" onmouseout="out('3202802947297119524');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 381         RestTemplate restTemplate = new RestTemplate();                                                  </span>
<span class="5149154134365859036" onmouseenter="enter('5149154134365859036');" onmouseout="out('5149154134365859036');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 382         String uri = balancesApiUri + &quot;/&quot; + fromAcct;                                                    </span>
<span class="-697674251075958280" onmouseenter="enter('-697674251075958280');" onmouseout="out('-697674251075958280');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 383         ResponseEntity&lt;Integer&gt; response = restTemplate.exchange(                                        </span>
<span class="6083870125336786698" onmouseenter="enter('6083870125336786698');" onmouseout="out('6083870125336786698');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 384             uri, HttpMethod.GET, entity, Integer.class);                                                 </span>
<span class="6400740982500579689" onmouseenter="enter('6400740982500579689');" onmouseout="out('6400740982500579689');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 385         Integer senderBalance = response.getBody();                                                      </span>
<span class="8092340863849585815" onmouseenter="enter('8092340863849585815');" onmouseout="out('8092340863849585815');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 386         return senderBalance.intValue();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 387     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 388                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 389 }                                                                                                        </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 390 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span></pre></td>
                            <td><pre><span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">   2 ||||||| BASE                                                                                             </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 /*                                                                                                       </span>
<span class="8011746770707306235" onmouseenter="enter('8011746770707306235');" onmouseout="out('8011746770707306235');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4  * Copyright 2020, Google LLC.                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17  */                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18                                                                                                          </span>
<span class="-1031727034891410218" onmouseenter="enter('-1031727034891410218');" onmouseout="out('-1031727034891410218');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19 package anthos.samples.financedemo.ledgerwriter;                                                         </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20                                                                                                          </span>
<span class="3887843854525453733" onmouseenter="enter('3887843854525453733');" onmouseout="out('3887843854525453733');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 import java.util.logging.Logger;                                                                         </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22                                                                                                          </span>
<span class="3248634983943737307" onmouseenter="enter('3248634983943737307');" onmouseout="out('3248634983943737307');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 import  org.springframework.web.client.HttpServerErrorException;                                         </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24                                                                                                          </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="-2449065930046514282" onmouseenter="enter('-2449065930046514282');" onmouseout="out('-2449065930046514282');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import org.springframework.http.HttpEntity;                                                              </span>
<span class="-2017038789555914398" onmouseenter="enter('-2017038789555914398');" onmouseout="out('-2017038789555914398');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 import org.springframework.http.HttpHeaders;                                                             </span>
<span class="7461978282736946494" onmouseenter="enter('7461978282736946494');" onmouseout="out('7461978282736946494');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 import org.springframework.http.HttpMethod;                                                              </span>
<span class="-6100913791676640620" onmouseenter="enter('-6100913791676640620');" onmouseout="out('-6100913791676640620');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 import org.springframework.http.HttpStatus;                                                              </span>
<span class="-4731930330216408095" onmouseenter="enter('-4731930330216408095');" onmouseout="out('-4731930330216408095');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 import org.springframework.http.ResponseEntity;                                                          </span>
<span class="5341219335560996028" onmouseenter="enter('5341219335560996028');" onmouseout="out('5341219335560996028');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import org.springframework.transaction.CannotCreateTransactionException;                                 </span>
<span class="-4152290558559497176" onmouseenter="enter('-4152290558559497176');" onmouseout="out('-4152290558559497176');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 import org.springframework.web.bind.annotation.GetMapping;                                               </span>
<span class="4051535263177665628" onmouseenter="enter('4051535263177665628');" onmouseout="out('4051535263177665628');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33 import org.springframework.web.bind.annotation.PostMapping;                                              </span>
<span class="-5091358343566339359" onmouseenter="enter('-5091358343566339359');" onmouseout="out('-5091358343566339359');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 import org.springframework.web.bind.annotation.RequestBody;                                              </span>
<span class="7012630364184468857" onmouseenter="enter('7012630364184468857');" onmouseout="out('7012630364184468857');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 import org.springframework.web.bind.annotation.RequestHeader;                                            </span>
<span class="-583363652389169341" onmouseenter="enter('-583363652389169341');" onmouseout="out('-583363652389169341');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36 import org.springframework.web.bind.annotation.ResponseStatus;                                           </span>
<span class="-7037114424511181002" onmouseenter="enter('-7037114424511181002');" onmouseout="out('-7037114424511181002');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37 import org.springframework.web.bind.annotation.RestController;                                           </span>
<span class="-7374118861510179828" onmouseenter="enter('-7374118861510179828');" onmouseout="out('-7374118861510179828');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38 import org.springframework.web.client.ResourceAccessException;                                           </span>
<span class="-2270477891067927787" onmouseenter="enter('-2270477891067927787');" onmouseout="out('-2270477891067927787');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39 import org.springframework.web.client.RestTemplate;                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40                                                                                                          </span>
<span class="494822993659260728" onmouseenter="enter('494822993659260728');" onmouseout="out('494822993659260728');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41 import com.auth0.jwt.JWTVerifier;                                                                        </span>
<span class="-7211641848955402551" onmouseenter="enter('-7211641848955402551');" onmouseout="out('-7211641848955402551');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42 import com.auth0.jwt.exceptions.JWTVerificationException;                                                </span>
<span class="5156920743651519035" onmouseenter="enter('5156920743651519035');" onmouseout="out('5156920743651519035');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43 import com.auth0.jwt.interfaces.DecodedJWT;                                                              </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44                                                                                                          </span>
<span class="6997167230740553376" onmouseenter="enter('6997167230740553376');" onmouseout="out('6997167230740553376');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45 import static anthos.samples.financedemo.ledgerwriter.ExceptionMessages.                                 </span>
<span class="5485927036637514847" onmouseenter="enter('5485927036637514847');" onmouseout="out('5485927036637514847');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46         EXCEPTION_MESSAGE_INSUFFICIENT_BALANCE;                                                          </span>
<span class="6997167230740553376" onmouseenter="enter('6997167230740553376');" onmouseout="out('6997167230740553376');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 import static anthos.samples.financedemo.ledgerwriter.ExceptionMessages.                                 </span>
<span class="-8362488606383815534" onmouseenter="enter('-8362488606383815534');" onmouseout="out('-8362488606383815534');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48         EXCEPTION_MESSAGE_WHEN_AUTHORIZATION_HEADER_NULL;                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49                                                                                                          </span>
<span class="6355076151554545937" onmouseenter="enter('6355076151554545937');" onmouseout="out('6355076151554545937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50 @RestController                                                                                          </span>
<span class="5933445460753317183" onmouseenter="enter('5933445460753317183');" onmouseout="out('5933445460753317183');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51 public final class LedgerWriterController {                                                              </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52                                                                                                          </span>
<span class="673777152962679767" onmouseenter="enter('673777152962679767');" onmouseout="out('673777152962679767');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53     private static final Logger LOGGER =                                                                 </span>
<span class="-7957956039430515397" onmouseenter="enter('-7957956039430515397');" onmouseout="out('-7957956039430515397');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54             Logger.getLogger(LedgerWriterController.class.getName());                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55                                                                                                          </span>
<span class="-728019112929028725" onmouseenter="enter('-728019112929028725');" onmouseout="out('-728019112929028725');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56     private TransactionRepository transactionRepository;                                                 </span>
<span class="-4578700528226723750" onmouseenter="enter('-4578700528226723750');" onmouseout="out('-4578700528226723750');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57     private TransactionValidator transactionValidator;                                                   </span>
<span class="-5049251535661215052" onmouseenter="enter('-5049251535661215052');" onmouseout="out('-5049251535661215052');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58     private JWTVerifier verifier;                                                                        </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59                                                                                                          </span>
<span class="-8636473471686513279" onmouseenter="enter('-8636473471686513279');" onmouseout="out('-8636473471686513279');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60     private String localRoutingNum;                                                                      </span>
<span class="-469486944919448386" onmouseenter="enter('-469486944919448386');" onmouseout="out('-469486944919448386');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61     private String balancesApiUri;                                                                       </span>
<span class="6148824265517010025" onmouseenter="enter('6148824265517010025');" onmouseout="out('6148824265517010025');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62     private String version;                                                                              </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63                                                                                                          </span>
<span class="-6505034648581184544" onmouseenter="enter('-6505034648581184544');" onmouseout="out('-6505034648581184544');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64     public static final String READINESS_CODE = &quot;ok&quot;;                                                    </span>
<span class="-9149089262416743429" onmouseenter="enter('-9149089262416743429');" onmouseout="out('-9149089262416743429');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65     public static final String UNAUTHORIZED_CODE = &quot;not authorized&quot;;                                     </span>
<span class="6290000176908202808" onmouseenter="enter('6290000176908202808');" onmouseout="out('6290000176908202808');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66     public static final String JWT_ACCOUNT_KEY = &quot;acct&quot;;                                                 </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68     /**                                                                                                  </span>
<span class="-1436741038288612910" onmouseenter="enter('-1436741038288612910');" onmouseout="out('-1436741038288612910');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69     * Constructor.                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70     *                                                                                                    </span>
<span class="-5348532432243399187" onmouseenter="enter('-5348532432243399187');" onmouseout="out('-5348532432243399187');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71     * Initializes JWT verifier.                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72     */                                                                                                   </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73                                                                                                          </span>
<span class="8937474768837710123" onmouseenter="enter('8937474768837710123');" onmouseout="out('8937474768837710123');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74     public LedgerWriterController(                                                                       </span>
<span class="2780303771851218368" onmouseenter="enter('2780303771851218368');" onmouseout="out('2780303771851218368');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75             JWTVerifier verifier,                                                                        </span>
<span class="1132068715177995291" onmouseenter="enter('1132068715177995291');" onmouseout="out('1132068715177995291');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76             TransactionRepository transactionRepository,                                                 </span>
<span class="5479269793478582431" onmouseenter="enter('5479269793478582431');" onmouseout="out('5479269793478582431');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77             TransactionValidator transactionValidator,                                                   </span>
<span class="-822564396537268339" onmouseenter="enter('-822564396537268339');" onmouseout="out('-822564396537268339');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78             @Value(&quot;${LOCAL_ROUTING_NUM}&quot;) String localRoutingNum,                                       </span>
<span class="-2250521274199702466" onmouseenter="enter('-2250521274199702466');" onmouseout="out('-2250521274199702466');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79             @Value(&quot;http://${BALANCES_API_ADDR}/balances&quot;)                                               </span>
<span class="5760341242560825698" onmouseenter="enter('5760341242560825698');" onmouseout="out('5760341242560825698');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80                     String balancesApiUri,                                                               </span>
<span class="3727660980762547349" onmouseenter="enter('3727660980762547349');" onmouseout="out('3727660980762547349');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81             @Value(&quot;${VERSION}&quot;) String version) {                                                       </span>
<span class="2791682847397564046" onmouseenter="enter('2791682847397564046');" onmouseout="out('2791682847397564046');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82         this.verifier = verifier;                                                                        </span>
<span class="5620916918385755227" onmouseenter="enter('5620916918385755227');" onmouseout="out('5620916918385755227');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83         this.transactionRepository = transactionRepository;                                              </span>
<span class="7194621662788445012" onmouseenter="enter('7194621662788445012');" onmouseout="out('7194621662788445012');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84         this.transactionValidator = transactionValidator;                                                </span>
<span class="5248812605098956146" onmouseenter="enter('5248812605098956146');" onmouseout="out('5248812605098956146');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85         this.localRoutingNum = localRoutingNum;                                                          </span>
<span class="-1729773563907748731" onmouseenter="enter('-1729773563907748731');" onmouseout="out('-1729773563907748731');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86         this.balancesApiUri = balancesApiUri;                                                            </span>
<span class="8734022701570323791" onmouseenter="enter('8734022701570323791');" onmouseout="out('8734022701570323791');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87         this.version = version;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90     /**                                                                                                  </span>
<span class="559132540195676827" onmouseenter="enter('559132540195676827');" onmouseout="out('559132540195676827');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91      * Version endpoint.                                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92      *                                                                                                   </span>
<span class="-3837725526160323045" onmouseenter="enter('-3837725526160323045');" onmouseout="out('-3837725526160323045');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93      * @return  service version string                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94      */                                                                                                  </span>
<span class="6685475051439146687" onmouseenter="enter('6685475051439146687');" onmouseout="out('6685475051439146687');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95     @GetMapping(&quot;/version&quot;)                                                                              </span>
<span class="580444279607563843" onmouseenter="enter('580444279607563843');" onmouseout="out('580444279607563843');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96     public ResponseEntity version() {                                                                    </span>
<span class="5343850267959959664" onmouseenter="enter('5343850267959959664');" onmouseout="out('5343850267959959664');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97         return new ResponseEntity&lt;String&gt;(version, HttpStatus.OK);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100     /**                                                                                                  </span>
<span class="-3900287586435222134" onmouseenter="enter('-3900287586435222134');" onmouseout="out('-3900287586435222134');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101      * Readiness probe endpoint.                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102      *                                                                                                   </span>
<span class="8463518254556868911" onmouseenter="enter('8463518254556868911');" onmouseout="out('8463518254556868911');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103      * @return HTTP Status 200 if server is ready to receive requests.                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104      */                                                                                                  </span>
<span class="-7757302847206504814" onmouseenter="enter('-7757302847206504814');" onmouseout="out('-7757302847206504814');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105     @GetMapping(&quot;/ready&quot;)                                                                                </span>
<span class="7447046953845578255" onmouseenter="enter('7447046953845578255');" onmouseout="out('7447046953845578255');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106     @ResponseStatus(HttpStatus.OK)                                                                       </span>
<span class="7271346341917529010" onmouseenter="enter('7271346341917529010');" onmouseout="out('7271346341917529010');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107     public ResponseEntity&lt;String&gt; readiness() {                                                          </span>
<span class="-4075762798656461919" onmouseenter="enter('-4075762798656461919');" onmouseout="out('-4075762798656461919');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108         return new ResponseEntity&lt;String&gt;(READINESS_CODE, HttpStatus.OK);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111     /**                                                                                                  </span>
<span class="3242866774072620153" onmouseenter="enter('3242866774072620153');" onmouseout="out('3242866774072620153');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112      * Submit a new transaction to the ledger.                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113      *                                                                                                   </span>
<span class="-1661212859137511783" onmouseenter="enter('-1661212859137511783');" onmouseout="out('-1661212859137511783');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114      * @param bearerToken  HTTP request &#x27;Authorization&#x27; header                                           </span>
<span class="5399615509278749127" onmouseenter="enter('5399615509278749127');" onmouseout="out('5399615509278749127');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115      * @param transaction  transaction to submit                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116      *                                                                                                   </span>
<span class="7486646966745340100" onmouseenter="enter('7486646966745340100');" onmouseout="out('7486646966745340100');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117      * @return  HTTP Status 200 if transaction was successfully submitted                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118      */                                                                                                  </span>
<span class="5323932416516552401" onmouseenter="enter('5323932416516552401');" onmouseout="out('5323932416516552401');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119     @PostMapping(value = &quot;/transactions&quot;, consumes = &quot;application/json&quot;)                                 </span>
<span class="7447046953845578255" onmouseenter="enter('7447046953845578255');" onmouseout="out('7447046953845578255');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120     @ResponseStatus(HttpStatus.OK)                                                                       </span>
<span class="1897907323625472935" onmouseenter="enter('1897907323625472935');" onmouseout="out('1897907323625472935');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121     public ResponseEntity&lt;?&gt; addTransaction(                                                             </span>
<span class="1166903297081280981" onmouseenter="enter('1166903297081280981');" onmouseout="out('1166903297081280981');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122             @RequestHeader(&quot;Authorization&quot;) String bearerToken,                                          </span>
<span class="9022696444049056102" onmouseenter="enter('9022696444049056102');" onmouseout="out('9022696444049056102');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123             @RequestBody Transaction transaction) {                                                      </span>
<span class="-3538581758087352701" onmouseenter="enter('-3538581758087352701');" onmouseout="out('-3538581758087352701');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124         if (bearerToken != null &amp;&amp; bearerToken.startsWith(&quot;Bearer &quot;)) {                                  </span>
<span class="-7115210276566291681" onmouseenter="enter('-7115210276566291681');" onmouseout="out('-7115210276566291681');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125             bearerToken = bearerToken.split(&quot;Bearer &quot;)[1];                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127         try {                                                                                            </span>
<span class="-4457463381546497224" onmouseenter="enter('-4457463381546497224');" onmouseout="out('-4457463381546497224');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128             if (bearerToken == null) {                                                                   </span>
<span class="-5454936540258631376" onmouseenter="enter('-5454936540258631376');" onmouseout="out('-5454936540258631376');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129                 throw new IllegalArgumentException(                                                      </span>
<span class="-4688472594501119643" onmouseenter="enter('-4688472594501119643');" onmouseout="out('-4688472594501119643');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130                         EXCEPTION_MESSAGE_WHEN_AUTHORIZATION_HEADER_NULL);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131             }                                                                                            </span>
<span class="-5768910099284843906" onmouseenter="enter('-5768910099284843906');" onmouseout="out('-5768910099284843906');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132             final DecodedJWT jwt = this.verifier.verify(bearerToken);                                    </span>
<span class="-6962791519859020761" onmouseenter="enter('-6962791519859020761');" onmouseout="out('-6962791519859020761');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133             // validate transaction                                                                      </span>
<span class="776637986685870327" onmouseenter="enter('776637986685870327');" onmouseout="out('776637986685870327');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134             transactionValidator.validateTransaction(localRoutingNum,                                    </span>
<span class="-4879758647615452357" onmouseenter="enter('-4879758647615452357');" onmouseout="out('-4879758647615452357');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135                     jwt.getClaim(JWT_ACCOUNT_KEY).asString(), transaction);                              </span>
<span class="-1762835934379555281" onmouseenter="enter('-1762835934379555281');" onmouseout="out('-1762835934379555281');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136             // Ensure sender balance can cover transaction.                                              </span>
<span class="-6144219964793655128" onmouseenter="enter('-6144219964793655128');" onmouseout="out('-6144219964793655128');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137             if (transaction.getFromRoutingNum().equals(localRoutingNum)) {                               </span>
<span class="7239735847198029864" onmouseenter="enter('7239735847198029864');" onmouseout="out('7239735847198029864');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138                 int balance = getAvailableBalance(                                                       </span>
<span class="7702083458280016025" onmouseenter="enter('7702083458280016025');" onmouseout="out('7702083458280016025');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139                         bearerToken, transaction.getFromAccountNum());                                   </span>
<span class="-8424323426889164999" onmouseenter="enter('-8424323426889164999');" onmouseout="out('-8424323426889164999');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140                 if (balance &lt; transaction.getAmount()) {                                                 </span>
<span class="-8046945014218387655" onmouseenter="enter('-8046945014218387655');" onmouseout="out('-8046945014218387655');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141                     throw new IllegalStateException(                                                     </span>
<span class="-5146115328615515543" onmouseenter="enter('-5146115328615515543');" onmouseout="out('-5146115328615515543');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142                             EXCEPTION_MESSAGE_INSUFFICIENT_BALANCE);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145                                                                                                          </span>
<span class="-3539745766511737220" onmouseenter="enter('-3539745766511737220');" onmouseout="out('-3539745766511737220');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146             // No exceptions thrown. Add to ledger                                                       </span>
<span class="613498208305766257" onmouseenter="enter('613498208305766257');" onmouseout="out('613498208305766257');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147             LOGGER.fine(&quot;Submitting transaction &quot;                                                        </span>
<span class="2531207035820706002" onmouseenter="enter('2531207035820706002');" onmouseout="out('2531207035820706002');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148                     + transaction.toString());                                                           </span>
<span class="-7584575581620960643" onmouseenter="enter('-7584575581620960643');" onmouseout="out('-7584575581620960643');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149             transactionRepository.save(transaction);                                                     </span>
<span class="-5231725033690787161" onmouseenter="enter('-5231725033690787161');" onmouseout="out('-5231725033690787161');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150             return new ResponseEntity&lt;String&gt;(READINESS_CODE,                                            </span>
<span class="-8527330892964817671" onmouseenter="enter('-8527330892964817671');" onmouseout="out('-8527330892964817671');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151                     HttpStatus.CREATED);                                                                 </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152                                                                                                          </span>
<span class="5687577372953802395" onmouseenter="enter('5687577372953802395');" onmouseout="out('5687577372953802395');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153         } catch (JWTVerificationException e) {                                                           </span>
<span class="-4154758301555607236" onmouseenter="enter('-4154758301555607236');" onmouseout="out('-4154758301555607236');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154             return new ResponseEntity&lt;String&gt;(UNAUTHORIZED_CODE,                                         </span>
<span class="-3711769128880294107" onmouseenter="enter('-3711769128880294107');" onmouseout="out('-3711769128880294107');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155                                               HttpStatus.UNAUTHORIZED);                                  </span>
<span class="-16261657306661328" onmouseenter="enter('-16261657306661328');" onmouseout="out('-16261657306661328');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156         } catch (IllegalArgumentException | IllegalStateException e) {                                   </span>
<span class="4951897796013672092" onmouseenter="enter('4951897796013672092');" onmouseout="out('4951897796013672092');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157             return new ResponseEntity&lt;String&gt;(e.getMessage(),                                            </span>
<span class="-4870417752025294804" onmouseenter="enter('-4870417752025294804');" onmouseout="out('-4870417752025294804');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158                                               HttpStatus.BAD_REQUEST);                                   </span>
<span class="2761749540388092140" onmouseenter="enter('2761749540388092140');" onmouseout="out('2761749540388092140');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159         } catch (ResourceAccessException                                                                 </span>
<span class="7920423166678117814" onmouseenter="enter('7920423166678117814');" onmouseout="out('7920423166678117814');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160                 | CannotCreateTransactionException                                                       </span>
<span class="-7265908382255363783" onmouseenter="enter('-7265908382255363783');" onmouseout="out('-7265908382255363783');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161                 | HttpServerErrorException e) {                                                          </span>
<span class="4951897796013672092" onmouseenter="enter('4951897796013672092');" onmouseout="out('4951897796013672092');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162             return new ResponseEntity&lt;String&gt;(e.getMessage(),                                            </span>
<span class="862392687202373996" onmouseenter="enter('862392687202373996');" onmouseout="out('862392687202373996');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163                                               HttpStatus.INTERNAL_SERVER_ERROR);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 166                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 167     /**                                                                                                  </span>
<span class="-840803106370353754" onmouseenter="enter('-840803106370353754');" onmouseout="out('-840803106370353754');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168      * Retrieve the balance for the transaction&#x27;s sender.                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169      *                                                                                                   </span>
<span class="-5399624366599429167" onmouseenter="enter('-5399624366599429167');" onmouseout="out('-5399624366599429167');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170      * @param token  the token used to authenticate request                                              </span>
<span class="5530241027805460636" onmouseenter="enter('5530241027805460636');" onmouseout="out('5530241027805460636');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 171      * @param fromAcct  sender account number                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172      *                                                                                                   </span>
<span class="-4671862933441611565" onmouseenter="enter('-4671862933441611565');" onmouseout="out('-4671862933441611565');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173      * @return available balance of the sender account                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174      *                                                                                                   </span>
<span class="7966166498405371741" onmouseenter="enter('7966166498405371741');" onmouseout="out('7966166498405371741');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175      * @throws HttpServerErrorException  if balance service returns 500                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176      */                                                                                                  </span>
<span class="-4867839573468993721" onmouseenter="enter('-4867839573468993721');" onmouseout="out('-4867839573468993721');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177     protected int getAvailableBalance(String token, String fromAcct)                                     </span>
<span class="7044480961715798280" onmouseenter="enter('7044480961715798280');" onmouseout="out('7044480961715798280');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178             throws HttpServerErrorException {                                                            </span>
<span class="-1187465989316714928" onmouseenter="enter('-1187465989316714928');" onmouseout="out('-1187465989316714928');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179         HttpHeaders headers = new HttpHeaders();                                                         </span>
<span class="3201291767686862102" onmouseenter="enter('3201291767686862102');" onmouseout="out('3201291767686862102');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180         headers.set(&quot;Authorization&quot;, &quot;Bearer &quot; + token);                                                 </span>
<span class="-1899310457862616867" onmouseenter="enter('-1899310457862616867');" onmouseout="out('-1899310457862616867');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181         HttpEntity entity = new HttpEntity(headers);                                                     </span>
<span class="3202802947297119524" onmouseenter="enter('3202802947297119524');" onmouseout="out('3202802947297119524');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182         RestTemplate restTemplate = new RestTemplate();                                                  </span>
<span class="5149154134365859036" onmouseenter="enter('5149154134365859036');" onmouseout="out('5149154134365859036');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183         String uri = balancesApiUri + &quot;/&quot; + fromAcct;                                                    </span>
<span class="-697674251075958280" onmouseenter="enter('-697674251075958280');" onmouseout="out('-697674251075958280');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184         ResponseEntity&lt;Integer&gt; response = restTemplate.exchange(                                        </span>
<span class="6083870125336786698" onmouseenter="enter('6083870125336786698');" onmouseout="out('6083870125336786698');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185             uri, HttpMethod.GET, entity, Integer.class);                                                 </span>
<span class="6400740982500579689" onmouseenter="enter('6400740982500579689');" onmouseout="out('6400740982500579689');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186         Integer senderBalance = response.getBody();                                                      </span>
<span class="8092340863849585815" onmouseenter="enter('8092340863849585815');" onmouseout="out('8092340863849585815');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187         return senderBalance.intValue();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190 }                                                                                                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 191 =======                                                                                                  </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192 /*                                                                                                       </span>
<span class="8011746770707306235" onmouseenter="enter('8011746770707306235');" onmouseout="out('8011746770707306235');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193  * Copyright 2020, Google LLC.                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 206  */                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207                                                                                                          </span>
<span class="-1031727034891410218" onmouseenter="enter('-1031727034891410218');" onmouseout="out('-1031727034891410218');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208 package anthos.samples.financedemo.ledgerwriter;                                                         </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209                                                                                                          </span>
<span class="-538473715904851717" onmouseenter="enter('-538473715904851717');" onmouseout="out('-538473715904851717');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210 import org.apache.logging.log4j.LogManager;                                                              </span>
<span class="2283937394492695819" onmouseenter="enter('2283937394492695819');" onmouseout="out('2283937394492695819');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211 import org.apache.logging.log4j.Logger;                                                                  </span>
<span class="3248634983943737307" onmouseenter="enter('3248634983943737307');" onmouseout="out('3248634983943737307');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212 import  org.springframework.web.client.HttpServerErrorException;                                         </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213                                                                                                          </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 214 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="-2449065930046514282" onmouseenter="enter('-2449065930046514282');" onmouseout="out('-2449065930046514282');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215 import org.springframework.http.HttpEntity;                                                              </span>
<span class="-2017038789555914398" onmouseenter="enter('-2017038789555914398');" onmouseout="out('-2017038789555914398');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 216 import org.springframework.http.HttpHeaders;                                                             </span>
<span class="7461978282736946494" onmouseenter="enter('7461978282736946494');" onmouseout="out('7461978282736946494');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 217 import org.springframework.http.HttpMethod;                                                              </span>
<span class="-6100913791676640620" onmouseenter="enter('-6100913791676640620');" onmouseout="out('-6100913791676640620');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 218 import org.springframework.http.HttpStatus;                                                              </span>
<span class="-4731930330216408095" onmouseenter="enter('-4731930330216408095');" onmouseout="out('-4731930330216408095');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 219 import org.springframework.http.ResponseEntity;                                                          </span>
<span class="5341219335560996028" onmouseenter="enter('5341219335560996028');" onmouseout="out('5341219335560996028');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 220 import org.springframework.transaction.CannotCreateTransactionException;                                 </span>
<span class="-4152290558559497176" onmouseenter="enter('-4152290558559497176');" onmouseout="out('-4152290558559497176');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 221 import org.springframework.web.bind.annotation.GetMapping;                                               </span>
<span class="4051535263177665628" onmouseenter="enter('4051535263177665628');" onmouseout="out('4051535263177665628');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 222 import org.springframework.web.bind.annotation.PostMapping;                                              </span>
<span class="-5091358343566339359" onmouseenter="enter('-5091358343566339359');" onmouseout="out('-5091358343566339359');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 223 import org.springframework.web.bind.annotation.RequestBody;                                              </span>
<span class="7012630364184468857" onmouseenter="enter('7012630364184468857');" onmouseout="out('7012630364184468857');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 224 import org.springframework.web.bind.annotation.RequestHeader;                                            </span>
<span class="-583363652389169341" onmouseenter="enter('-583363652389169341');" onmouseout="out('-583363652389169341');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225 import org.springframework.web.bind.annotation.ResponseStatus;                                           </span>
<span class="-7037114424511181002" onmouseenter="enter('-7037114424511181002');" onmouseout="out('-7037114424511181002');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226 import org.springframework.web.bind.annotation.RestController;                                           </span>
<span class="-7374118861510179828" onmouseenter="enter('-7374118861510179828');" onmouseout="out('-7374118861510179828');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 227 import org.springframework.web.client.ResourceAccessException;                                           </span>
<span class="-2270477891067927787" onmouseenter="enter('-2270477891067927787');" onmouseout="out('-2270477891067927787');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 228 import org.springframework.web.client.RestTemplate;                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 229                                                                                                          </span>
<span class="494822993659260728" onmouseenter="enter('494822993659260728');" onmouseout="out('494822993659260728');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 230 import com.auth0.jwt.JWTVerifier;                                                                        </span>
<span class="-7211641848955402551" onmouseenter="enter('-7211641848955402551');" onmouseout="out('-7211641848955402551');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 231 import com.auth0.jwt.exceptions.JWTVerificationException;                                                </span>
<span class="5156920743651519035" onmouseenter="enter('5156920743651519035');" onmouseout="out('5156920743651519035');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 232 import com.auth0.jwt.interfaces.DecodedJWT;                                                              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 233                                                                                                          </span>
<span class="6997167230740553376" onmouseenter="enter('6997167230740553376');" onmouseout="out('6997167230740553376');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 234 import static anthos.samples.financedemo.ledgerwriter.ExceptionMessages.                                 </span>
<span class="5485927036637514847" onmouseenter="enter('5485927036637514847');" onmouseout="out('5485927036637514847');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 235         EXCEPTION_MESSAGE_INSUFFICIENT_BALANCE;                                                          </span>
<span class="6997167230740553376" onmouseenter="enter('6997167230740553376');" onmouseout="out('6997167230740553376');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 236 import static anthos.samples.financedemo.ledgerwriter.ExceptionMessages.                                 </span>
<span class="-8362488606383815534" onmouseenter="enter('-8362488606383815534');" onmouseout="out('-8362488606383815534');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 237         EXCEPTION_MESSAGE_WHEN_AUTHORIZATION_HEADER_NULL;                                                </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 238                                                                                                          </span>
<span class="6355076151554545937" onmouseenter="enter('6355076151554545937');" onmouseout="out('6355076151554545937');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 239 @RestController                                                                                          </span>
<span class="5933445460753317183" onmouseenter="enter('5933445460753317183');" onmouseout="out('5933445460753317183');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 240 public final class LedgerWriterController {                                                              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 241                                                                                                          </span>
<span class="673777152962679767" onmouseenter="enter('673777152962679767');" onmouseout="out('673777152962679767');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 242     private static final Logger LOGGER =                                                                 </span>
<span class="999928017189038216" onmouseenter="enter('999928017189038216');" onmouseout="out('999928017189038216');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 243         LogManager.getLogger(LedgerWriterController.class);                                              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 244                                                                                                          </span>
<span class="-728019112929028725" onmouseenter="enter('-728019112929028725');" onmouseout="out('-728019112929028725');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 245     private TransactionRepository transactionRepository;                                                 </span>
<span class="-4578700528226723750" onmouseenter="enter('-4578700528226723750');" onmouseout="out('-4578700528226723750');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 246     private TransactionValidator transactionValidator;                                                   </span>
<span class="-5049251535661215052" onmouseenter="enter('-5049251535661215052');" onmouseout="out('-5049251535661215052');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 247     private JWTVerifier verifier;                                                                        </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 248                                                                                                          </span>
<span class="-8636473471686513279" onmouseenter="enter('-8636473471686513279');" onmouseout="out('-8636473471686513279');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 249     private String localRoutingNum;                                                                      </span>
<span class="-469486944919448386" onmouseenter="enter('-469486944919448386');" onmouseout="out('-469486944919448386');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 250     private String balancesApiUri;                                                                       </span>
<span class="6148824265517010025" onmouseenter="enter('6148824265517010025');" onmouseout="out('6148824265517010025');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 251     private String version;                                                                              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 252                                                                                                          </span>
<span class="-6505034648581184544" onmouseenter="enter('-6505034648581184544');" onmouseout="out('-6505034648581184544');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 253     public static final String READINESS_CODE = &quot;ok&quot;;                                                    </span>
<span class="-9149089262416743429" onmouseenter="enter('-9149089262416743429');" onmouseout="out('-9149089262416743429');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254     public static final String UNAUTHORIZED_CODE = &quot;not authorized&quot;;                                     </span>
<span class="6290000176908202808" onmouseenter="enter('6290000176908202808');" onmouseout="out('6290000176908202808');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 255     public static final String JWT_ACCOUNT_KEY = &quot;acct&quot;;                                                 </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 256                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 257     /**                                                                                                  </span>
<span class="-1436741038288612910" onmouseenter="enter('-1436741038288612910');" onmouseout="out('-1436741038288612910');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 258     * Constructor.                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 259     *                                                                                                    </span>
<span class="-5348532432243399187" onmouseenter="enter('-5348532432243399187');" onmouseout="out('-5348532432243399187');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 260     * Initializes JWT verifier.                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 261     */                                                                                                   </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 262                                                                                                          </span>
<span class="8937474768837710123" onmouseenter="enter('8937474768837710123');" onmouseout="out('8937474768837710123');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 263     public LedgerWriterController(                                                                       </span>
<span class="2780303771851218368" onmouseenter="enter('2780303771851218368');" onmouseout="out('2780303771851218368');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 264             JWTVerifier verifier,                                                                        </span>
<span class="1132068715177995291" onmouseenter="enter('1132068715177995291');" onmouseout="out('1132068715177995291');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 265             TransactionRepository transactionRepository,                                                 </span>
<span class="5479269793478582431" onmouseenter="enter('5479269793478582431');" onmouseout="out('5479269793478582431');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 266             TransactionValidator transactionValidator,                                                   </span>
<span class="-822564396537268339" onmouseenter="enter('-822564396537268339');" onmouseout="out('-822564396537268339');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 267             @Value(&quot;${LOCAL_ROUTING_NUM}&quot;) String localRoutingNum,                                       </span>
<span class="-2250521274199702466" onmouseenter="enter('-2250521274199702466');" onmouseout="out('-2250521274199702466');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 268             @Value(&quot;http://${BALANCES_API_ADDR}/balances&quot;)                                               </span>
<span class="5760341242560825698" onmouseenter="enter('5760341242560825698');" onmouseout="out('5760341242560825698');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 269                     String balancesApiUri,                                                               </span>
<span class="3727660980762547349" onmouseenter="enter('3727660980762547349');" onmouseout="out('3727660980762547349');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 270             @Value(&quot;${VERSION}&quot;) String version) {                                                       </span>
<span class="2791682847397564046" onmouseenter="enter('2791682847397564046');" onmouseout="out('2791682847397564046');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 271         this.verifier = verifier;                                                                        </span>
<span class="5620916918385755227" onmouseenter="enter('5620916918385755227');" onmouseout="out('5620916918385755227');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 272         this.transactionRepository = transactionRepository;                                              </span>
<span class="7194621662788445012" onmouseenter="enter('7194621662788445012');" onmouseout="out('7194621662788445012');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 273         this.transactionValidator = transactionValidator;                                                </span>
<span class="5248812605098956146" onmouseenter="enter('5248812605098956146');" onmouseout="out('5248812605098956146');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 274         this.localRoutingNum = localRoutingNum;                                                          </span>
<span class="-1729773563907748731" onmouseenter="enter('-1729773563907748731');" onmouseout="out('-1729773563907748731');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 275         this.balancesApiUri = balancesApiUri;                                                            </span>
<span class="8734022701570323791" onmouseenter="enter('8734022701570323791');" onmouseout="out('8734022701570323791');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 276         this.version = version;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 277     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 278                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 279     /**                                                                                                  </span>
<span class="559132540195676827" onmouseenter="enter('559132540195676827');" onmouseout="out('559132540195676827');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 280      * Version endpoint.                                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 281      *                                                                                                   </span>
<span class="-3837725526160323045" onmouseenter="enter('-3837725526160323045');" onmouseout="out('-3837725526160323045');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282      * @return  service version string                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 283      */                                                                                                  </span>
<span class="6685475051439146687" onmouseenter="enter('6685475051439146687');" onmouseout="out('6685475051439146687');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284     @GetMapping(&quot;/version&quot;)                                                                              </span>
<span class="580444279607563843" onmouseenter="enter('580444279607563843');" onmouseout="out('580444279607563843');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 285     public ResponseEntity version() {                                                                    </span>
<span class="5343850267959959664" onmouseenter="enter('5343850267959959664');" onmouseout="out('5343850267959959664');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 286         return new ResponseEntity&lt;String&gt;(version, HttpStatus.OK);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 287     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 288                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 289     /**                                                                                                  </span>
<span class="-3900287586435222134" onmouseenter="enter('-3900287586435222134');" onmouseout="out('-3900287586435222134');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 290      * Readiness probe endpoint.                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 291      *                                                                                                   </span>
<span class="8463518254556868911" onmouseenter="enter('8463518254556868911');" onmouseout="out('8463518254556868911');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 292      * @return HTTP Status 200 if server is ready to receive requests.                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 293      */                                                                                                  </span>
<span class="-7757302847206504814" onmouseenter="enter('-7757302847206504814');" onmouseout="out('-7757302847206504814');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 294     @GetMapping(&quot;/ready&quot;)                                                                                </span>
<span class="7447046953845578255" onmouseenter="enter('7447046953845578255');" onmouseout="out('7447046953845578255');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 295     @ResponseStatus(HttpStatus.OK)                                                                       </span>
<span class="7271346341917529010" onmouseenter="enter('7271346341917529010');" onmouseout="out('7271346341917529010');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 296     public ResponseEntity&lt;String&gt; readiness() {                                                          </span>
<span class="-4075762798656461919" onmouseenter="enter('-4075762798656461919');" onmouseout="out('-4075762798656461919');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 297         return new ResponseEntity&lt;String&gt;(READINESS_CODE, HttpStatus.OK);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 298     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 299                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 300     /**                                                                                                  </span>
<span class="3242866774072620153" onmouseenter="enter('3242866774072620153');" onmouseout="out('3242866774072620153');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 301      * Submit a new transaction to the ledger.                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 302      *                                                                                                   </span>
<span class="-1661212859137511783" onmouseenter="enter('-1661212859137511783');" onmouseout="out('-1661212859137511783');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 303      * @param bearerToken  HTTP request &#x27;Authorization&#x27; header                                           </span>
<span class="5399615509278749127" onmouseenter="enter('5399615509278749127');" onmouseout="out('5399615509278749127');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 304      * @param transaction  transaction to submit                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 305      *                                                                                                   </span>
<span class="7486646966745340100" onmouseenter="enter('7486646966745340100');" onmouseout="out('7486646966745340100');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 306      * @return  HTTP Status 200 if transaction was successfully submitted                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 307      */                                                                                                  </span>
<span class="5323932416516552401" onmouseenter="enter('5323932416516552401');" onmouseout="out('5323932416516552401');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 308     @PostMapping(value = &quot;/transactions&quot;, consumes = &quot;application/json&quot;)                                 </span>
<span class="7447046953845578255" onmouseenter="enter('7447046953845578255');" onmouseout="out('7447046953845578255');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 309     @ResponseStatus(HttpStatus.OK)                                                                       </span>
<span class="1897907323625472935" onmouseenter="enter('1897907323625472935');" onmouseout="out('1897907323625472935');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 310     public ResponseEntity&lt;?&gt; addTransaction(                                                             </span>
<span class="1166903297081280981" onmouseenter="enter('1166903297081280981');" onmouseout="out('1166903297081280981');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 311             @RequestHeader(&quot;Authorization&quot;) String bearerToken,                                          </span>
<span class="9022696444049056102" onmouseenter="enter('9022696444049056102');" onmouseout="out('9022696444049056102');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 312             @RequestBody Transaction transaction) {                                                      </span>
<span class="-3538581758087352701" onmouseenter="enter('-3538581758087352701');" onmouseout="out('-3538581758087352701');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 313         if (bearerToken != null &amp;&amp; bearerToken.startsWith(&quot;Bearer &quot;)) {                                  </span>
<span class="-7115210276566291681" onmouseenter="enter('-7115210276566291681');" onmouseout="out('-7115210276566291681');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 314             bearerToken = bearerToken.split(&quot;Bearer &quot;)[1];                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 315         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 316         try {                                                                                            </span>
<span class="-4457463381546497224" onmouseenter="enter('-4457463381546497224');" onmouseout="out('-4457463381546497224');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 317             if (bearerToken == null) {                                                                   </span>
<span class="8471284381161989921" onmouseenter="enter('8471284381161989921');" onmouseout="out('8471284381161989921');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 318                 LOGGER.error(&quot;Transaction submission failed: &quot;                                           </span>
<span class="-6310070690167802414" onmouseenter="enter('-6310070690167802414');" onmouseout="out('-6310070690167802414');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 319                     + &quot;Authorization header null&quot;);                                                      </span>
<span class="-5454936540258631376" onmouseenter="enter('-5454936540258631376');" onmouseout="out('-5454936540258631376');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 320                 throw new IllegalArgumentException(                                                      </span>
<span class="-4688472594501119643" onmouseenter="enter('-4688472594501119643');" onmouseout="out('-4688472594501119643');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 321                         EXCEPTION_MESSAGE_WHEN_AUTHORIZATION_HEADER_NULL);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 322             }                                                                                            </span>
<span class="-5768910099284843906" onmouseenter="enter('-5768910099284843906');" onmouseout="out('-5768910099284843906');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 323             final DecodedJWT jwt = this.verifier.verify(bearerToken);                                    </span>
<span class="-6962791519859020761" onmouseenter="enter('-6962791519859020761');" onmouseout="out('-6962791519859020761');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 324             // validate transaction                                                                      </span>
<span class="776637986685870327" onmouseenter="enter('776637986685870327');" onmouseout="out('776637986685870327');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 325             transactionValidator.validateTransaction(localRoutingNum,                                    </span>
<span class="-4879758647615452357" onmouseenter="enter('-4879758647615452357');" onmouseout="out('-4879758647615452357');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 326                     jwt.getClaim(JWT_ACCOUNT_KEY).asString(), transaction);                              </span>
<span class="-1762835934379555281" onmouseenter="enter('-1762835934379555281');" onmouseout="out('-1762835934379555281');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 327             // Ensure sender balance can cover transaction.                                              </span>
<span class="-6144219964793655128" onmouseenter="enter('-6144219964793655128');" onmouseout="out('-6144219964793655128');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 328             if (transaction.getFromRoutingNum().equals(localRoutingNum)) {                               </span>
<span class="7239735847198029864" onmouseenter="enter('7239735847198029864');" onmouseout="out('7239735847198029864');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 329                 int balance = getAvailableBalance(                                                       </span>
<span class="7702083458280016025" onmouseenter="enter('7702083458280016025');" onmouseout="out('7702083458280016025');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 330                         bearerToken, transaction.getFromAccountNum());                                   </span>
<span class="-8424323426889164999" onmouseenter="enter('-8424323426889164999');" onmouseout="out('-8424323426889164999');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 331                 if (balance &lt; transaction.getAmount()) {                                                 </span>
<span class="8471284381161989921" onmouseenter="enter('8471284381161989921');" onmouseout="out('8471284381161989921');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 332                     LOGGER.error(&quot;Transaction submission failed: &quot;                                       </span>
<span class="2606405075138145997" onmouseenter="enter('2606405075138145997');" onmouseout="out('2606405075138145997');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 333                         + &quot;Insufficient balance&quot;);                                                       </span>
<span class="-8046945014218387655" onmouseenter="enter('-8046945014218387655');" onmouseout="out('-8046945014218387655');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 334                     throw new IllegalStateException(                                                     </span>
<span class="-5146115328615515543" onmouseenter="enter('-5146115328615515543');" onmouseout="out('-5146115328615515543');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 335                             EXCEPTION_MESSAGE_INSUFFICIENT_BALANCE);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 336                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 337             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 338                                                                                                          </span>
<span class="-3539745766511737220" onmouseenter="enter('-3539745766511737220');" onmouseout="out('-3539745766511737220');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 339             // No exceptions thrown. Add to ledger                                                       </span>
<span class="-7584575581620960643" onmouseenter="enter('-7584575581620960643');" onmouseout="out('-7584575581620960643');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 340             transactionRepository.save(transaction);                                                     </span>
<span class="5719956641649610757" onmouseenter="enter('5719956641649610757');" onmouseout="out('5719956641649610757');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 341             LOGGER.info(&quot;Submitted transaction successfully&quot;);                                           </span>
<span class="-5231725033690787161" onmouseenter="enter('-5231725033690787161');" onmouseout="out('-5231725033690787161');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 342             return new ResponseEntity&lt;String&gt;(READINESS_CODE,                                            </span>
<span class="-8527330892964817671" onmouseenter="enter('-8527330892964817671');" onmouseout="out('-8527330892964817671');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 343                     HttpStatus.CREATED);                                                                 </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 344                                                                                                          </span>
<span class="5687577372953802395" onmouseenter="enter('5687577372953802395');" onmouseout="out('5687577372953802395');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 345         } catch (JWTVerificationException e) {                                                           </span>
<span class="-327448583504624880" onmouseenter="enter('-327448583504624880');" onmouseout="out('-327448583504624880');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 346             LOGGER.error(&quot;Failed to submit transaction: &quot;                                                </span>
<span class="5874187622003058896" onmouseenter="enter('5874187622003058896');" onmouseout="out('5874187622003058896');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 347                 + &quot;not authorized&quot;);                                                                     </span>
<span class="-4154758301555607236" onmouseenter="enter('-4154758301555607236');" onmouseout="out('-4154758301555607236');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 348             return new ResponseEntity&lt;String&gt;(UNAUTHORIZED_CODE,                                         </span>
<span class="-3711769128880294107" onmouseenter="enter('-3711769128880294107');" onmouseout="out('-3711769128880294107');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 349                                               HttpStatus.UNAUTHORIZED);                                  </span>
<span class="-16261657306661328" onmouseenter="enter('-16261657306661328');" onmouseout="out('-16261657306661328');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 350         } catch (IllegalArgumentException | IllegalStateException e) {                                   </span>
<span class="-7663233641936656847" onmouseenter="enter('-7663233641936656847');" onmouseout="out('-7663233641936656847');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 351             LOGGER.error(&quot;Failed to retrieve account balance: &quot;                                          </span>
<span class="-1386920267869766944" onmouseenter="enter('-1386920267869766944');" onmouseout="out('-1386920267869766944');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 352                 + &quot;bad request&quot;);                                                                        </span>
<span class="4951897796013672092" onmouseenter="enter('4951897796013672092');" onmouseout="out('4951897796013672092');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 353             return new ResponseEntity&lt;String&gt;(e.getMessage(),                                            </span>
<span class="-4870417752025294804" onmouseenter="enter('-4870417752025294804');" onmouseout="out('-4870417752025294804');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 354                                               HttpStatus.BAD_REQUEST);                                   </span>
<span class="2761749540388092140" onmouseenter="enter('2761749540388092140');" onmouseout="out('2761749540388092140');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 355         } catch (ResourceAccessException                                                                 </span>
<span class="7920423166678117814" onmouseenter="enter('7920423166678117814');" onmouseout="out('7920423166678117814');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 356                 | CannotCreateTransactionException                                                       </span>
<span class="-7265908382255363783" onmouseenter="enter('-7265908382255363783');" onmouseout="out('-7265908382255363783');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 357                 | HttpServerErrorException e) {                                                          </span>
<span class="-6756904505334648824" onmouseenter="enter('-6756904505334648824');" onmouseout="out('-6756904505334648824');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 358             LOGGER.error(&quot;Failed to retrieve account balance&quot;);                                          </span>
<span class="4951897796013672092" onmouseenter="enter('4951897796013672092');" onmouseout="out('4951897796013672092');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 359             return new ResponseEntity&lt;String&gt;(e.getMessage(),                                            </span>
<span class="862392687202373996" onmouseenter="enter('862392687202373996');" onmouseout="out('862392687202373996');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 360                                               HttpStatus.INTERNAL_SERVER_ERROR);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 361         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 362     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 363                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 364     /**                                                                                                  </span>
<span class="-840803106370353754" onmouseenter="enter('-840803106370353754');" onmouseout="out('-840803106370353754');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 365      * Retrieve the balance for the transaction&#x27;s sender.                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 366      *                                                                                                   </span>
<span class="-5399624366599429167" onmouseenter="enter('-5399624366599429167');" onmouseout="out('-5399624366599429167');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 367      * @param token  the token used to authenticate request                                              </span>
<span class="5530241027805460636" onmouseenter="enter('5530241027805460636');" onmouseout="out('5530241027805460636');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 368      * @param fromAcct  sender account number                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 369      *                                                                                                   </span>
<span class="-4671862933441611565" onmouseenter="enter('-4671862933441611565');" onmouseout="out('-4671862933441611565');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 370      * @return available balance of the sender account                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 371      *                                                                                                   </span>
<span class="7966166498405371741" onmouseenter="enter('7966166498405371741');" onmouseout="out('7966166498405371741');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 372      * @throws HttpServerErrorException  if balance service returns 500                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 373      */                                                                                                  </span>
<span class="-4867839573468993721" onmouseenter="enter('-4867839573468993721');" onmouseout="out('-4867839573468993721');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 374     protected int getAvailableBalance(String token, String fromAcct)                                     </span>
<span class="7044480961715798280" onmouseenter="enter('7044480961715798280');" onmouseout="out('7044480961715798280');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 375             throws HttpServerErrorException {                                                            </span>
<span class="2945528015156409897" onmouseenter="enter('2945528015156409897');" onmouseout="out('2945528015156409897');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 376         LOGGER.debug(&quot;Retrieving balance for transaction sender&quot;);                                       </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 377                                                                                                          </span>
<span class="-1187465989316714928" onmouseenter="enter('-1187465989316714928');" onmouseout="out('-1187465989316714928');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 378         HttpHeaders headers = new HttpHeaders();                                                         </span>
<span class="3201291767686862102" onmouseenter="enter('3201291767686862102');" onmouseout="out('3201291767686862102');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 379         headers.set(&quot;Authorization&quot;, &quot;Bearer &quot; + token);                                                 </span>
<span class="-1899310457862616867" onmouseenter="enter('-1899310457862616867');" onmouseout="out('-1899310457862616867');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 380         HttpEntity entity = new HttpEntity(headers);                                                     </span>
<span class="3202802947297119524" onmouseenter="enter('3202802947297119524');" onmouseout="out('3202802947297119524');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 381         RestTemplate restTemplate = new RestTemplate();                                                  </span>
<span class="5149154134365859036" onmouseenter="enter('5149154134365859036');" onmouseout="out('5149154134365859036');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 382         String uri = balancesApiUri + &quot;/&quot; + fromAcct;                                                    </span>
<span class="-697674251075958280" onmouseenter="enter('-697674251075958280');" onmouseout="out('-697674251075958280');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 383         ResponseEntity&lt;Integer&gt; response = restTemplate.exchange(                                        </span>
<span class="6083870125336786698" onmouseenter="enter('6083870125336786698');" onmouseout="out('6083870125336786698');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 384             uri, HttpMethod.GET, entity, Integer.class);                                                 </span>
<span class="6400740982500579689" onmouseenter="enter('6400740982500579689');" onmouseout="out('6400740982500579689');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 385         Integer senderBalance = response.getBody();                                                      </span>
<span class="8092340863849585815" onmouseenter="enter('8092340863849585815');" onmouseout="out('8092340863849585815');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 386         return senderBalance.intValue();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 387     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 388                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 389 }                                                                                                        </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 390 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span></pre></td>
                            <td><pre><span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style="">   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">   2 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">   4 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   5                                                                                                          </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   6 /*                                                                                                       </span>
<span class="8011746770707306235" onmouseenter="enter('8011746770707306235');" onmouseout="out('8011746770707306235');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   7  * Copyright 2020, Google LLC.                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   8  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   9  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  10  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  11  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  12  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  13  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  14  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  15  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  16  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  17  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  18  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  19  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  20  */                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  21                                                                                                          </span>
<span class="-1031727034891410218" onmouseenter="enter('-1031727034891410218');" onmouseout="out('-1031727034891410218');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  22 package anthos.samples.financedemo.ledgerwriter;                                                         </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  23                                                                                                          </span>
<span class="-538473715904851717" onmouseenter="enter('-538473715904851717');" onmouseout="out('-538473715904851717');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  24 import org.apache.logging.log4j.LogManager;                                                              </span>
<span class="2283937394492695819" onmouseenter="enter('2283937394492695819');" onmouseout="out('2283937394492695819');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  25 import org.apache.logging.log4j.Logger;                                                                  </span>
<span class="3248634983943737307" onmouseenter="enter('3248634983943737307');" onmouseout="out('3248634983943737307');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  26 import  org.springframework.web.client.HttpServerErrorException;                                         </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  27                                                                                                          </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  28 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="-2449065930046514282" onmouseenter="enter('-2449065930046514282');" onmouseout="out('-2449065930046514282');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  29 import org.springframework.http.HttpEntity;                                                              </span>
<span class="-2017038789555914398" onmouseenter="enter('-2017038789555914398');" onmouseout="out('-2017038789555914398');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  30 import org.springframework.http.HttpHeaders;                                                             </span>
<span class="7461978282736946494" onmouseenter="enter('7461978282736946494');" onmouseout="out('7461978282736946494');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  31 import org.springframework.http.HttpMethod;                                                              </span>
<span class="-6100913791676640620" onmouseenter="enter('-6100913791676640620');" onmouseout="out('-6100913791676640620');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  32 import org.springframework.http.HttpStatus;                                                              </span>
<span class="-4731930330216408095" onmouseenter="enter('-4731930330216408095');" onmouseout="out('-4731930330216408095');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  33 import org.springframework.http.ResponseEntity;                                                          </span>
<span class="5341219335560996028" onmouseenter="enter('5341219335560996028');" onmouseout="out('5341219335560996028');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  34 import org.springframework.transaction.CannotCreateTransactionException;                                 </span>
<span class="-4152290558559497176" onmouseenter="enter('-4152290558559497176');" onmouseout="out('-4152290558559497176');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  35 import org.springframework.web.bind.annotation.GetMapping;                                               </span>
<span class="4051535263177665628" onmouseenter="enter('4051535263177665628');" onmouseout="out('4051535263177665628');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  36 import org.springframework.web.bind.annotation.PostMapping;                                              </span>
<span class="-5091358343566339359" onmouseenter="enter('-5091358343566339359');" onmouseout="out('-5091358343566339359');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  37 import org.springframework.web.bind.annotation.RequestBody;                                              </span>
<span class="7012630364184468857" onmouseenter="enter('7012630364184468857');" onmouseout="out('7012630364184468857');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  38 import org.springframework.web.bind.annotation.RequestHeader;                                            </span>
<span class="-583363652389169341" onmouseenter="enter('-583363652389169341');" onmouseout="out('-583363652389169341');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  39 import org.springframework.web.bind.annotation.ResponseStatus;                                           </span>
<span class="-7037114424511181002" onmouseenter="enter('-7037114424511181002');" onmouseout="out('-7037114424511181002');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  40 import org.springframework.web.bind.annotation.RestController;                                           </span>
<span class="-7374118861510179828" onmouseenter="enter('-7374118861510179828');" onmouseout="out('-7374118861510179828');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  41 import org.springframework.web.client.ResourceAccessException;                                           </span>
<span class="-2270477891067927787" onmouseenter="enter('-2270477891067927787');" onmouseout="out('-2270477891067927787');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  42 import org.springframework.web.client.RestTemplate;                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  43                                                                                                          </span>
<span class="494822993659260728" onmouseenter="enter('494822993659260728');" onmouseout="out('494822993659260728');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  44 import com.auth0.jwt.JWTVerifier;                                                                        </span>
<span class="-7211641848955402551" onmouseenter="enter('-7211641848955402551');" onmouseout="out('-7211641848955402551');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  45 import com.auth0.jwt.exceptions.JWTVerificationException;                                                </span>
<span class="5156920743651519035" onmouseenter="enter('5156920743651519035');" onmouseout="out('5156920743651519035');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  46 import com.auth0.jwt.interfaces.DecodedJWT;                                                              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  47                                                                                                          </span>
<span class="6997167230740553376" onmouseenter="enter('6997167230740553376');" onmouseout="out('6997167230740553376');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  48 import static anthos.samples.financedemo.ledgerwriter.ExceptionMessages.                                 </span>
<span class="5485927036637514847" onmouseenter="enter('5485927036637514847');" onmouseout="out('5485927036637514847');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  49         EXCEPTION_MESSAGE_INSUFFICIENT_BALANCE;                                                          </span>
<span class="6997167230740553376" onmouseenter="enter('6997167230740553376');" onmouseout="out('6997167230740553376');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  50 import static anthos.samples.financedemo.ledgerwriter.ExceptionMessages.                                 </span>
<span class="-8362488606383815534" onmouseenter="enter('-8362488606383815534');" onmouseout="out('-8362488606383815534');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  51         EXCEPTION_MESSAGE_WHEN_AUTHORIZATION_HEADER_NULL;                                                </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  52                                                                                                          </span>
<span class="6355076151554545937" onmouseenter="enter('6355076151554545937');" onmouseout="out('6355076151554545937');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  53 @RestController                                                                                          </span>
<span class="5933445460753317183" onmouseenter="enter('5933445460753317183');" onmouseout="out('5933445460753317183');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  54 public final class LedgerWriterController {                                                              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  55                                                                                                          </span>
<span class="673777152962679767" onmouseenter="enter('673777152962679767');" onmouseout="out('673777152962679767');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  56     private static final Logger LOGGER =                                                                 </span>
<span class="999928017189038216" onmouseenter="enter('999928017189038216');" onmouseout="out('999928017189038216');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  57         LogManager.getLogger(LedgerWriterController.class);                                              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  58                                                                                                          </span>
<span class="-728019112929028725" onmouseenter="enter('-728019112929028725');" onmouseout="out('-728019112929028725');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  59     private TransactionRepository transactionRepository;                                                 </span>
<span class="-4578700528226723750" onmouseenter="enter('-4578700528226723750');" onmouseout="out('-4578700528226723750');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  60     private TransactionValidator transactionValidator;                                                   </span>
<span class="-5049251535661215052" onmouseenter="enter('-5049251535661215052');" onmouseout="out('-5049251535661215052');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  61     private JWTVerifier verifier;                                                                        </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  62                                                                                                          </span>
<span class="-8636473471686513279" onmouseenter="enter('-8636473471686513279');" onmouseout="out('-8636473471686513279');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  63     private String localRoutingNum;                                                                      </span>
<span class="-469486944919448386" onmouseenter="enter('-469486944919448386');" onmouseout="out('-469486944919448386');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  64     private String balancesApiUri;                                                                       </span>
<span class="6148824265517010025" onmouseenter="enter('6148824265517010025');" onmouseout="out('6148824265517010025');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  65     private String version;                                                                              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  66                                                                                                          </span>
<span class="-6505034648581184544" onmouseenter="enter('-6505034648581184544');" onmouseout="out('-6505034648581184544');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  67     public static final String READINESS_CODE = &quot;ok&quot;;                                                    </span>
<span class="-9149089262416743429" onmouseenter="enter('-9149089262416743429');" onmouseout="out('-9149089262416743429');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  68     public static final String UNAUTHORIZED_CODE = &quot;not authorized&quot;;                                     </span>
<span class="6290000176908202808" onmouseenter="enter('6290000176908202808');" onmouseout="out('6290000176908202808');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  69     public static final String JWT_ACCOUNT_KEY = &quot;acct&quot;;                                                 </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  70                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  71     /**                                                                                                  </span>
<span class="-1436741038288612910" onmouseenter="enter('-1436741038288612910');" onmouseout="out('-1436741038288612910');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  72     * Constructor.                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  73     *                                                                                                    </span>
<span class="-5348532432243399187" onmouseenter="enter('-5348532432243399187');" onmouseout="out('-5348532432243399187');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  74     * Initializes JWT verifier.                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  75     */                                                                                                   </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  76                                                                                                          </span>
<span class="8937474768837710123" onmouseenter="enter('8937474768837710123');" onmouseout="out('8937474768837710123');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  77     public LedgerWriterController(                                                                       </span>
<span class="2780303771851218368" onmouseenter="enter('2780303771851218368');" onmouseout="out('2780303771851218368');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  78             JWTVerifier verifier,                                                                        </span>
<span class="1132068715177995291" onmouseenter="enter('1132068715177995291');" onmouseout="out('1132068715177995291');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  79             TransactionRepository transactionRepository,                                                 </span>
<span class="5479269793478582431" onmouseenter="enter('5479269793478582431');" onmouseout="out('5479269793478582431');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  80             TransactionValidator transactionValidator,                                                   </span>
<span class="-822564396537268339" onmouseenter="enter('-822564396537268339');" onmouseout="out('-822564396537268339');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  81             @Value(&quot;${LOCAL_ROUTING_NUM}&quot;) String localRoutingNum,                                       </span>
<span class="-2250521274199702466" onmouseenter="enter('-2250521274199702466');" onmouseout="out('-2250521274199702466');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  82             @Value(&quot;http://${BALANCES_API_ADDR}/balances&quot;)                                               </span>
<span class="5760341242560825698" onmouseenter="enter('5760341242560825698');" onmouseout="out('5760341242560825698');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  83                     String balancesApiUri,                                                               </span>
<span class="3727660980762547349" onmouseenter="enter('3727660980762547349');" onmouseout="out('3727660980762547349');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  84             @Value(&quot;${VERSION}&quot;) String version) {                                                       </span>
<span class="2791682847397564046" onmouseenter="enter('2791682847397564046');" onmouseout="out('2791682847397564046');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  85         this.verifier = verifier;                                                                        </span>
<span class="5620916918385755227" onmouseenter="enter('5620916918385755227');" onmouseout="out('5620916918385755227');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  86         this.transactionRepository = transactionRepository;                                              </span>
<span class="7194621662788445012" onmouseenter="enter('7194621662788445012');" onmouseout="out('7194621662788445012');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  87         this.transactionValidator = transactionValidator;                                                </span>
<span class="5248812605098956146" onmouseenter="enter('5248812605098956146');" onmouseout="out('5248812605098956146');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  88         this.localRoutingNum = localRoutingNum;                                                          </span>
<span class="-1729773563907748731" onmouseenter="enter('-1729773563907748731');" onmouseout="out('-1729773563907748731');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  89         this.balancesApiUri = balancesApiUri;                                                            </span>
<span class="8734022701570323791" onmouseenter="enter('8734022701570323791');" onmouseout="out('8734022701570323791');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  90         this.version = version;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  91     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  92                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  93     /**                                                                                                  </span>
<span class="559132540195676827" onmouseenter="enter('559132540195676827');" onmouseout="out('559132540195676827');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  94      * Version endpoint.                                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  95      *                                                                                                   </span>
<span class="-3837725526160323045" onmouseenter="enter('-3837725526160323045');" onmouseout="out('-3837725526160323045');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  96      * @return  service version string                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  97      */                                                                                                  </span>
<span class="6685475051439146687" onmouseenter="enter('6685475051439146687');" onmouseout="out('6685475051439146687');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  98     @GetMapping(&quot;/version&quot;)                                                                              </span>
<span class="580444279607563843" onmouseenter="enter('580444279607563843');" onmouseout="out('580444279607563843');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  99     public ResponseEntity version() {                                                                    </span>
<span class="5343850267959959664" onmouseenter="enter('5343850267959959664');" onmouseout="out('5343850267959959664');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 100         return new ResponseEntity&lt;String&gt;(version, HttpStatus.OK);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 101     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 102                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 103     /**                                                                                                  </span>
<span class="-3900287586435222134" onmouseenter="enter('-3900287586435222134');" onmouseout="out('-3900287586435222134');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 104      * Readiness probe endpoint.                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 105      *                                                                                                   </span>
<span class="8463518254556868911" onmouseenter="enter('8463518254556868911');" onmouseout="out('8463518254556868911');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 106      * @return HTTP Status 200 if server is ready to receive requests.                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 107      */                                                                                                  </span>
<span class="-7757302847206504814" onmouseenter="enter('-7757302847206504814');" onmouseout="out('-7757302847206504814');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 108     @GetMapping(&quot;/ready&quot;)                                                                                </span>
<span class="7447046953845578255" onmouseenter="enter('7447046953845578255');" onmouseout="out('7447046953845578255');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 109     @ResponseStatus(HttpStatus.OK)                                                                       </span>
<span class="7271346341917529010" onmouseenter="enter('7271346341917529010');" onmouseout="out('7271346341917529010');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 110     public ResponseEntity&lt;String&gt; readiness() {                                                          </span>
<span class="-4075762798656461919" onmouseenter="enter('-4075762798656461919');" onmouseout="out('-4075762798656461919');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 111         return new ResponseEntity&lt;String&gt;(READINESS_CODE, HttpStatus.OK);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 112     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 113                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 114     /**                                                                                                  </span>
<span class="3242866774072620153" onmouseenter="enter('3242866774072620153');" onmouseout="out('3242866774072620153');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 115      * Submit a new transaction to the ledger.                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 116      *                                                                                                   </span>
<span class="-1661212859137511783" onmouseenter="enter('-1661212859137511783');" onmouseout="out('-1661212859137511783');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 117      * @param bearerToken  HTTP request &#x27;Authorization&#x27; header                                           </span>
<span class="5399615509278749127" onmouseenter="enter('5399615509278749127');" onmouseout="out('5399615509278749127');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 118      * @param transaction  transaction to submit                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 119      *                                                                                                   </span>
<span class="7486646966745340100" onmouseenter="enter('7486646966745340100');" onmouseout="out('7486646966745340100');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 120      * @return  HTTP Status 200 if transaction was successfully submitted                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 121      */                                                                                                  </span>
<span class="5323932416516552401" onmouseenter="enter('5323932416516552401');" onmouseout="out('5323932416516552401');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 122     @PostMapping(value = &quot;/transactions&quot;, consumes = &quot;application/json&quot;)                                 </span>
<span class="7447046953845578255" onmouseenter="enter('7447046953845578255');" onmouseout="out('7447046953845578255');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 123     @ResponseStatus(HttpStatus.OK)                                                                       </span>
<span class="1897907323625472935" onmouseenter="enter('1897907323625472935');" onmouseout="out('1897907323625472935');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 124     public ResponseEntity&lt;?&gt; addTransaction(                                                             </span>
<span class="1166903297081280981" onmouseenter="enter('1166903297081280981');" onmouseout="out('1166903297081280981');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 125             @RequestHeader(&quot;Authorization&quot;) String bearerToken,                                          </span>
<span class="9022696444049056102" onmouseenter="enter('9022696444049056102');" onmouseout="out('9022696444049056102');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 126             @RequestBody Transaction transaction) {                                                      </span>
<span class="-3538581758087352701" onmouseenter="enter('-3538581758087352701');" onmouseout="out('-3538581758087352701');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 127         if (bearerToken != null &amp;&amp; bearerToken.startsWith(&quot;Bearer &quot;)) {                                  </span>
<span class="-7115210276566291681" onmouseenter="enter('-7115210276566291681');" onmouseout="out('-7115210276566291681');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 128             bearerToken = bearerToken.split(&quot;Bearer &quot;)[1];                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 129         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 130         try {                                                                                            </span>
<span class="-4457463381546497224" onmouseenter="enter('-4457463381546497224');" onmouseout="out('-4457463381546497224');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 131             if (bearerToken == null) {                                                                   </span>
<span class="8471284381161989921" onmouseenter="enter('8471284381161989921');" onmouseout="out('8471284381161989921');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 132                 LOGGER.error(&quot;Transaction submission failed: &quot;                                           </span>
<span class="-6310070690167802414" onmouseenter="enter('-6310070690167802414');" onmouseout="out('-6310070690167802414');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 133                     + &quot;Authorization header null&quot;);                                                      </span>
<span class="-5454936540258631376" onmouseenter="enter('-5454936540258631376');" onmouseout="out('-5454936540258631376');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 134                 throw new IllegalArgumentException(                                                      </span>
<span class="-4688472594501119643" onmouseenter="enter('-4688472594501119643');" onmouseout="out('-4688472594501119643');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135                         EXCEPTION_MESSAGE_WHEN_AUTHORIZATION_HEADER_NULL);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136             }                                                                                            </span>
<span class="-5768910099284843906" onmouseenter="enter('-5768910099284843906');" onmouseout="out('-5768910099284843906');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137             final DecodedJWT jwt = this.verifier.verify(bearerToken);                                    </span>
<span class="-6962791519859020761" onmouseenter="enter('-6962791519859020761');" onmouseout="out('-6962791519859020761');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138             // validate transaction                                                                      </span>
<span class="776637986685870327" onmouseenter="enter('776637986685870327');" onmouseout="out('776637986685870327');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 139             transactionValidator.validateTransaction(localRoutingNum,                                    </span>
<span class="-4879758647615452357" onmouseenter="enter('-4879758647615452357');" onmouseout="out('-4879758647615452357');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 140                     jwt.getClaim(JWT_ACCOUNT_KEY).asString(), transaction);                              </span>
<span class="-1762835934379555281" onmouseenter="enter('-1762835934379555281');" onmouseout="out('-1762835934379555281');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 141             // Ensure sender balance can cover transaction.                                              </span>
<span class="-6144219964793655128" onmouseenter="enter('-6144219964793655128');" onmouseout="out('-6144219964793655128');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 142             if (transaction.getFromRoutingNum().equals(localRoutingNum)) {                               </span>
<span class="7239735847198029864" onmouseenter="enter('7239735847198029864');" onmouseout="out('7239735847198029864');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143                 int balance = getAvailableBalance(                                                       </span>
<span class="7702083458280016025" onmouseenter="enter('7702083458280016025');" onmouseout="out('7702083458280016025');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144                         bearerToken, transaction.getFromAccountNum());                                   </span>
<span class="-8424323426889164999" onmouseenter="enter('-8424323426889164999');" onmouseout="out('-8424323426889164999');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145                 if (balance &lt; transaction.getAmount()) {                                                 </span>
<span class="8471284381161989921" onmouseenter="enter('8471284381161989921');" onmouseout="out('8471284381161989921');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146                     LOGGER.error(&quot;Transaction submission failed: &quot;                                       </span>
<span class="2606405075138145997" onmouseenter="enter('2606405075138145997');" onmouseout="out('2606405075138145997');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147                         + &quot;Insufficient balance&quot;);                                                       </span>
<span class="-8046945014218387655" onmouseenter="enter('-8046945014218387655');" onmouseout="out('-8046945014218387655');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148                     throw new IllegalStateException(                                                     </span>
<span class="-5146115328615515543" onmouseenter="enter('-5146115328615515543');" onmouseout="out('-5146115328615515543');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149                             EXCEPTION_MESSAGE_INSUFFICIENT_BALANCE);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152                                                                                                          </span>
<span class="-3539745766511737220" onmouseenter="enter('-3539745766511737220');" onmouseout="out('-3539745766511737220');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153             // No exceptions thrown. Add to ledger                                                       </span>
<span class="-7584575581620960643" onmouseenter="enter('-7584575581620960643');" onmouseout="out('-7584575581620960643');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154             transactionRepository.save(transaction);                                                     </span>
<span class="5719956641649610757" onmouseenter="enter('5719956641649610757');" onmouseout="out('5719956641649610757');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155             LOGGER.info(&quot;Submitted transaction successfully&quot;);                                           </span>
<span class="-5231725033690787161" onmouseenter="enter('-5231725033690787161');" onmouseout="out('-5231725033690787161');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156             return new ResponseEntity&lt;String&gt;(READINESS_CODE,                                            </span>
<span class="-8527330892964817671" onmouseenter="enter('-8527330892964817671');" onmouseout="out('-8527330892964817671');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157                     HttpStatus.CREATED);                                                                 </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158                                                                                                          </span>
<span class="5687577372953802395" onmouseenter="enter('5687577372953802395');" onmouseout="out('5687577372953802395');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159         } catch (JWTVerificationException e) {                                                           </span>
<span class="-327448583504624880" onmouseenter="enter('-327448583504624880');" onmouseout="out('-327448583504624880');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 160             LOGGER.error(&quot;Failed to submit transaction: &quot;                                                </span>
<span class="5874187622003058896" onmouseenter="enter('5874187622003058896');" onmouseout="out('5874187622003058896');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 161                 + &quot;not authorized&quot;);                                                                     </span>
<span class="-4154758301555607236" onmouseenter="enter('-4154758301555607236');" onmouseout="out('-4154758301555607236');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 162             return new ResponseEntity&lt;String&gt;(UNAUTHORIZED_CODE,                                         </span>
<span class="-3711769128880294107" onmouseenter="enter('-3711769128880294107');" onmouseout="out('-3711769128880294107');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 163                                               HttpStatus.UNAUTHORIZED);                                  </span>
<span class="-16261657306661328" onmouseenter="enter('-16261657306661328');" onmouseout="out('-16261657306661328');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 164         } catch (IllegalArgumentException | IllegalStateException e) {                                   </span>
<span class="-7663233641936656847" onmouseenter="enter('-7663233641936656847');" onmouseout="out('-7663233641936656847');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 165             LOGGER.error(&quot;Failed to retrieve account balance: &quot;                                          </span>
<span class="-1386920267869766944" onmouseenter="enter('-1386920267869766944');" onmouseout="out('-1386920267869766944');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166                 + &quot;bad request&quot;);                                                                        </span>
<span class="4951897796013672092" onmouseenter="enter('4951897796013672092');" onmouseout="out('4951897796013672092');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 167             return new ResponseEntity&lt;String&gt;(e.getMessage(),                                            </span>
<span class="-4870417752025294804" onmouseenter="enter('-4870417752025294804');" onmouseout="out('-4870417752025294804');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168                                               HttpStatus.BAD_REQUEST);                                   </span>
<span class="2761749540388092140" onmouseenter="enter('2761749540388092140');" onmouseout="out('2761749540388092140');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 169         } catch (ResourceAccessException                                                                 </span>
<span class="7920423166678117814" onmouseenter="enter('7920423166678117814');" onmouseout="out('7920423166678117814');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 170                 | CannotCreateTransactionException                                                       </span>
<span class="-7265908382255363783" onmouseenter="enter('-7265908382255363783');" onmouseout="out('-7265908382255363783');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 171                 | HttpServerErrorException e) {                                                          </span>
<span class="-6756904505334648824" onmouseenter="enter('-6756904505334648824');" onmouseout="out('-6756904505334648824');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 172             LOGGER.error(&quot;Failed to retrieve account balance&quot;);                                          </span>
<span class="4951897796013672092" onmouseenter="enter('4951897796013672092');" onmouseout="out('4951897796013672092');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 173             return new ResponseEntity&lt;String&gt;(e.getMessage(),                                            </span>
<span class="862392687202373996" onmouseenter="enter('862392687202373996');" onmouseout="out('862392687202373996');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174                                               HttpStatus.INTERNAL_SERVER_ERROR);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178     /**                                                                                                  </span>
<span class="-840803106370353754" onmouseenter="enter('-840803106370353754');" onmouseout="out('-840803106370353754');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179      * Retrieve the balance for the transaction&#x27;s sender.                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180      *                                                                                                   </span>
<span class="-5399624366599429167" onmouseenter="enter('-5399624366599429167');" onmouseout="out('-5399624366599429167');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 181      * @param token  the token used to authenticate request                                              </span>
<span class="5530241027805460636" onmouseenter="enter('5530241027805460636');" onmouseout="out('5530241027805460636');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 182      * @param fromAcct  sender account number                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 183      *                                                                                                   </span>
<span class="-4671862933441611565" onmouseenter="enter('-4671862933441611565');" onmouseout="out('-4671862933441611565');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 184      * @return available balance of the sender account                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 185      *                                                                                                   </span>
<span class="7966166498405371741" onmouseenter="enter('7966166498405371741');" onmouseout="out('7966166498405371741');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 186      * @throws HttpServerErrorException  if balance service returns 500                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 187      */                                                                                                  </span>
<span class="-4867839573468993721" onmouseenter="enter('-4867839573468993721');" onmouseout="out('-4867839573468993721');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188     protected int getAvailableBalance(String token, String fromAcct)                                     </span>
<span class="7044480961715798280" onmouseenter="enter('7044480961715798280');" onmouseout="out('7044480961715798280');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 189             throws HttpServerErrorException {                                                            </span>
<span class="2945528015156409897" onmouseenter="enter('2945528015156409897');" onmouseout="out('2945528015156409897');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190         LOGGER.debug(&quot;Retrieving balance for transaction sender&quot;);                                       </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 191                                                                                                          </span>
<span class="-1187465989316714928" onmouseenter="enter('-1187465989316714928');" onmouseout="out('-1187465989316714928');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192         HttpHeaders headers = new HttpHeaders();                                                         </span>
<span class="3201291767686862102" onmouseenter="enter('3201291767686862102');" onmouseout="out('3201291767686862102');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193         headers.set(&quot;Authorization&quot;, &quot;Bearer &quot; + token);                                                 </span>
<span class="-1899310457862616867" onmouseenter="enter('-1899310457862616867');" onmouseout="out('-1899310457862616867');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194         HttpEntity entity = new HttpEntity(headers);                                                     </span>
<span class="3202802947297119524" onmouseenter="enter('3202802947297119524');" onmouseout="out('3202802947297119524');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195         RestTemplate restTemplate = new RestTemplate();                                                  </span>
<span class="5149154134365859036" onmouseenter="enter('5149154134365859036');" onmouseout="out('5149154134365859036');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196         String uri = balancesApiUri + &quot;/&quot; + fromAcct;                                                    </span>
<span class="-697674251075958280" onmouseenter="enter('-697674251075958280');" onmouseout="out('-697674251075958280');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197         ResponseEntity&lt;Integer&gt; response = restTemplate.exchange(                                        </span>
<span class="6083870125336786698" onmouseenter="enter('6083870125336786698');" onmouseout="out('6083870125336786698');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198             uri, HttpMethod.GET, entity, Integer.class);                                                 </span>
<span class="6400740982500579689" onmouseenter="enter('6400740982500579689');" onmouseout="out('6400740982500579689');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199         Integer senderBalance = response.getBody();                                                      </span>
<span class="8092340863849585815" onmouseenter="enter('8092340863849585815');" onmouseout="out('8092340863849585815');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200         return senderBalance.intValue();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203 }                                                                                                        </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 204 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
























































































































































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   1 -/*                                                                                                                </span>
<span class="8011746770707306235" onmouseenter="enter('8011746770707306235');" onmouseout="out('8011746770707306235');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   2 - * Copyright 2020, Google LLC.                                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   3 - *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   4 - * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   5 - * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   6 - * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   7 - *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   8 - *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   9 - *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  10 - * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  11 - * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  12 - * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  13 - * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  14 - * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  15 - */                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  16 -                                                                                                                  </span>
<span class="-1031727034891410218" onmouseenter="enter('-1031727034891410218');" onmouseout="out('-1031727034891410218');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  17 -package anthos.samples.financedemo.ledgerwriter;                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  18 -                                                                                                                  </span>
<span class="3887843854525453733" onmouseenter="enter('3887843854525453733');" onmouseout="out('3887843854525453733');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  19 -import java.util.logging.Logger;                                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  20 -                                                                                                                  </span>


<span class="3248634983943737307" onmouseenter="enter('3248634983943737307');" onmouseout="out('3248634983943737307');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  21 -import  org.springframework.web.client.HttpServerErrorException;                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  22 -                                                                                                                  </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  23 -import org.springframework.beans.factory.annotation.Value;                                                        </span>
<span class="-2449065930046514282" onmouseenter="enter('-2449065930046514282');" onmouseout="out('-2449065930046514282');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  24 -import org.springframework.http.HttpEntity;                                                                       </span>
<span class="-2017038789555914398" onmouseenter="enter('-2017038789555914398');" onmouseout="out('-2017038789555914398');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  25 -import org.springframework.http.HttpHeaders;                                                                      </span>
<span class="7461978282736946494" onmouseenter="enter('7461978282736946494');" onmouseout="out('7461978282736946494');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  26 -import org.springframework.http.HttpMethod;                                                                       </span>
<span class="-6100913791676640620" onmouseenter="enter('-6100913791676640620');" onmouseout="out('-6100913791676640620');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  27 -import org.springframework.http.HttpStatus;                                                                       </span>
<span class="-4731930330216408095" onmouseenter="enter('-4731930330216408095');" onmouseout="out('-4731930330216408095');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  28 -import org.springframework.http.ResponseEntity;                                                                   </span>
<span class="5341219335560996028" onmouseenter="enter('5341219335560996028');" onmouseout="out('5341219335560996028');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  29 -import org.springframework.transaction.CannotCreateTransactionException;                                          </span>
<span class="-4152290558559497176" onmouseenter="enter('-4152290558559497176');" onmouseout="out('-4152290558559497176');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  30 -import org.springframework.web.bind.annotation.GetMapping;                                                        </span>
<span class="4051535263177665628" onmouseenter="enter('4051535263177665628');" onmouseout="out('4051535263177665628');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  31 -import org.springframework.web.bind.annotation.PostMapping;                                                       </span>
<span class="-5091358343566339359" onmouseenter="enter('-5091358343566339359');" onmouseout="out('-5091358343566339359');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  32 -import org.springframework.web.bind.annotation.RequestBody;                                                       </span>
<span class="7012630364184468857" onmouseenter="enter('7012630364184468857');" onmouseout="out('7012630364184468857');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  33 -import org.springframework.web.bind.annotation.RequestHeader;                                                     </span>
<span class="-583363652389169341" onmouseenter="enter('-583363652389169341');" onmouseout="out('-583363652389169341');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  34 -import org.springframework.web.bind.annotation.ResponseStatus;                                                    </span>
<span class="-7037114424511181002" onmouseenter="enter('-7037114424511181002');" onmouseout="out('-7037114424511181002');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  35 -import org.springframework.web.bind.annotation.RestController;                                                    </span>
<span class="-7374118861510179828" onmouseenter="enter('-7374118861510179828');" onmouseout="out('-7374118861510179828');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  36 -import org.springframework.web.client.ResourceAccessException;                                                    </span>
<span class="-2270477891067927787" onmouseenter="enter('-2270477891067927787');" onmouseout="out('-2270477891067927787');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  37 -import org.springframework.web.client.RestTemplate;                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  38 -                                                                                                                  </span>
<span class="494822993659260728" onmouseenter="enter('494822993659260728');" onmouseout="out('494822993659260728');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  39 -import com.auth0.jwt.JWTVerifier;                                                                                 </span>
<span class="-7211641848955402551" onmouseenter="enter('-7211641848955402551');" onmouseout="out('-7211641848955402551');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  40 -import com.auth0.jwt.exceptions.JWTVerificationException;                                                         </span>
<span class="5156920743651519035" onmouseenter="enter('5156920743651519035');" onmouseout="out('5156920743651519035');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  41 -import com.auth0.jwt.interfaces.DecodedJWT;                                                                       </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  42 -                                                                                                                  </span>
<span class="6997167230740553376" onmouseenter="enter('6997167230740553376');" onmouseout="out('6997167230740553376');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  43 -import static anthos.samples.financedemo.ledgerwriter.ExceptionMessages.                                          </span>
<span class="5485927036637514847" onmouseenter="enter('5485927036637514847');" onmouseout="out('5485927036637514847');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  44 -        EXCEPTION_MESSAGE_INSUFFICIENT_BALANCE;                                                                   </span>
<span class="6997167230740553376" onmouseenter="enter('6997167230740553376');" onmouseout="out('6997167230740553376');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  45 -import static anthos.samples.financedemo.ledgerwriter.ExceptionMessages.                                          </span>
<span class="-8362488606383815534" onmouseenter="enter('-8362488606383815534');" onmouseout="out('-8362488606383815534');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  46 -        EXCEPTION_MESSAGE_WHEN_AUTHORIZATION_HEADER_NULL;                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  47 -                                                                                                                  </span>
<span class="6355076151554545937" onmouseenter="enter('6355076151554545937');" onmouseout="out('6355076151554545937');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  48 -@RestController                                                                                                   </span>
<span class="5933445460753317183" onmouseenter="enter('5933445460753317183');" onmouseout="out('5933445460753317183');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  49 -public final class LedgerWriterController {                                                                       </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  50 -                                                                                                                  </span>
<span class="673777152962679767" onmouseenter="enter('673777152962679767');" onmouseout="out('673777152962679767');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  51 -    private static final Logger LOGGER =                                                                          </span>
<span class="-7957956039430515397" onmouseenter="enter('-7957956039430515397');" onmouseout="out('-7957956039430515397');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  52 -            Logger.getLogger(LedgerWriterController.class.getName());                                             </span>

<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  53 -                                                                                                                  </span>
<span class="-728019112929028725" onmouseenter="enter('-728019112929028725');" onmouseout="out('-728019112929028725');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  54 -    private TransactionRepository transactionRepository;                                                          </span>
<span class="-4578700528226723750" onmouseenter="enter('-4578700528226723750');" onmouseout="out('-4578700528226723750');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  55 -    private TransactionValidator transactionValidator;                                                            </span>
<span class="-5049251535661215052" onmouseenter="enter('-5049251535661215052');" onmouseout="out('-5049251535661215052');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  56 -    private JWTVerifier verifier;                                                                                 </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  57 -                                                                                                                  </span>
<span class="-8636473471686513279" onmouseenter="enter('-8636473471686513279');" onmouseout="out('-8636473471686513279');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  58 -    private String localRoutingNum;                                                                               </span>
<span class="-469486944919448386" onmouseenter="enter('-469486944919448386');" onmouseout="out('-469486944919448386');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  59 -    private String balancesApiUri;                                                                                </span>
<span class="6148824265517010025" onmouseenter="enter('6148824265517010025');" onmouseout="out('6148824265517010025');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  60 -    private String version;                                                                                       </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  61 -                                                                                                                  </span>
<span class="-6505034648581184544" onmouseenter="enter('-6505034648581184544');" onmouseout="out('-6505034648581184544');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  62 -    public static final String READINESS_CODE = &quot;ok&quot;;                                                             </span>
<span class="-9149089262416743429" onmouseenter="enter('-9149089262416743429');" onmouseout="out('-9149089262416743429');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  63 -    public static final String UNAUTHORIZED_CODE = &quot;not authorized&quot;;                                              </span>
<span class="6290000176908202808" onmouseenter="enter('6290000176908202808');" onmouseout="out('6290000176908202808');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  64 -    public static final String JWT_ACCOUNT_KEY = &quot;acct&quot;;                                                          </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  65 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  66 -    /**                                                                                                           </span>
<span class="-1436741038288612910" onmouseenter="enter('-1436741038288612910');" onmouseout="out('-1436741038288612910');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  67 -    * Constructor.                                                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  68 -    *                                                                                                             </span>
<span class="-5348532432243399187" onmouseenter="enter('-5348532432243399187');" onmouseout="out('-5348532432243399187');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  69 -    * Initializes JWT verifier.                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  70 -    */                                                                                                            </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  71 -                                                                                                                  </span>
<span class="8937474768837710123" onmouseenter="enter('8937474768837710123');" onmouseout="out('8937474768837710123');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  72 -    public LedgerWriterController(                                                                                </span>
<span class="2780303771851218368" onmouseenter="enter('2780303771851218368');" onmouseout="out('2780303771851218368');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  73 -            JWTVerifier verifier,                                                                                 </span>
<span class="1132068715177995291" onmouseenter="enter('1132068715177995291');" onmouseout="out('1132068715177995291');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  74 -            TransactionRepository transactionRepository,                                                          </span>
<span class="5479269793478582431" onmouseenter="enter('5479269793478582431');" onmouseout="out('5479269793478582431');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  75 -            TransactionValidator transactionValidator,                                                            </span>
<span class="-822564396537268339" onmouseenter="enter('-822564396537268339');" onmouseout="out('-822564396537268339');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  76 -            @Value(&quot;${LOCAL_ROUTING_NUM}&quot;) String localRoutingNum,                                                </span>
<span class="-2250521274199702466" onmouseenter="enter('-2250521274199702466');" onmouseout="out('-2250521274199702466');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  77 -            @Value(&quot;http://${BALANCES_API_ADDR}/balances&quot;)                                                        </span>
<span class="5760341242560825698" onmouseenter="enter('5760341242560825698');" onmouseout="out('5760341242560825698');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  78 -                    String balancesApiUri,                                                                        </span>
<span class="3727660980762547349" onmouseenter="enter('3727660980762547349');" onmouseout="out('3727660980762547349');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  79 -            @Value(&quot;${VERSION}&quot;) String version) {                                                                </span>
<span class="2791682847397564046" onmouseenter="enter('2791682847397564046');" onmouseout="out('2791682847397564046');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  80 -        this.verifier = verifier;                                                                                 </span>
<span class="5620916918385755227" onmouseenter="enter('5620916918385755227');" onmouseout="out('5620916918385755227');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  81 -        this.transactionRepository = transactionRepository;                                                       </span>
<span class="7194621662788445012" onmouseenter="enter('7194621662788445012');" onmouseout="out('7194621662788445012');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  82 -        this.transactionValidator = transactionValidator;                                                         </span>
<span class="5248812605098956146" onmouseenter="enter('5248812605098956146');" onmouseout="out('5248812605098956146');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  83 -        this.localRoutingNum = localRoutingNum;                                                                   </span>
<span class="-1729773563907748731" onmouseenter="enter('-1729773563907748731');" onmouseout="out('-1729773563907748731');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  84 -        this.balancesApiUri = balancesApiUri;                                                                     </span>
<span class="8734022701570323791" onmouseenter="enter('8734022701570323791');" onmouseout="out('8734022701570323791');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  85 -        this.version = version;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  86 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  87 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  88 -    /**                                                                                                           </span>
<span class="559132540195676827" onmouseenter="enter('559132540195676827');" onmouseout="out('559132540195676827');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  89 -     * Version endpoint.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  90 -     *                                                                                                            </span>
<span class="-3837725526160323045" onmouseenter="enter('-3837725526160323045');" onmouseout="out('-3837725526160323045');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  91 -     * @return  service version string                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  92 -     */                                                                                                           </span>
<span class="6685475051439146687" onmouseenter="enter('6685475051439146687');" onmouseout="out('6685475051439146687');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  93 -    @GetMapping(&quot;/version&quot;)                                                                                       </span>
<span class="580444279607563843" onmouseenter="enter('580444279607563843');" onmouseout="out('580444279607563843');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  94 -    public ResponseEntity version() {                                                                             </span>
<span class="5343850267959959664" onmouseenter="enter('5343850267959959664');" onmouseout="out('5343850267959959664');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  95 -        return new ResponseEntity&lt;String&gt;(version, HttpStatus.OK);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  96 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  97 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  98 -    /**                                                                                                           </span>
<span class="-3900287586435222134" onmouseenter="enter('-3900287586435222134');" onmouseout="out('-3900287586435222134');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -     * Readiness probe endpoint.                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 100 -     *                                                                                                            </span>
<span class="8463518254556868911" onmouseenter="enter('8463518254556868911');" onmouseout="out('8463518254556868911');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 101 -     * @return HTTP Status 200 if server is ready to receive requests.                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 102 -     */                                                                                                           </span>
<span class="-7757302847206504814" onmouseenter="enter('-7757302847206504814');" onmouseout="out('-7757302847206504814');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 103 -    @GetMapping(&quot;/ready&quot;)                                                                                         </span>
<span class="7447046953845578255" onmouseenter="enter('7447046953845578255');" onmouseout="out('7447046953845578255');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 104 -    @ResponseStatus(HttpStatus.OK)                                                                                </span>
<span class="7271346341917529010" onmouseenter="enter('7271346341917529010');" onmouseout="out('7271346341917529010');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 105 -    public ResponseEntity&lt;String&gt; readiness() {                                                                   </span>
<span class="-4075762798656461919" onmouseenter="enter('-4075762798656461919');" onmouseout="out('-4075762798656461919');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 106 -        return new ResponseEntity&lt;String&gt;(READINESS_CODE, HttpStatus.OK);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 107 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 108 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 109 -    /**                                                                                                           </span>
<span class="3242866774072620153" onmouseenter="enter('3242866774072620153');" onmouseout="out('3242866774072620153');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 110 -     * Submit a new transaction to the ledger.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 111 -     *                                                                                                            </span>
<span class="-1661212859137511783" onmouseenter="enter('-1661212859137511783');" onmouseout="out('-1661212859137511783');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 112 -     * @param bearerToken  HTTP request &#x27;Authorization&#x27; header                                                    </span>
<span class="5399615509278749127" onmouseenter="enter('5399615509278749127');" onmouseout="out('5399615509278749127');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 113 -     * @param transaction  transaction to submit                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 114 -     *                                                                                                            </span>
<span class="7486646966745340100" onmouseenter="enter('7486646966745340100');" onmouseout="out('7486646966745340100');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 115 -     * @return  HTTP Status 200 if transaction was successfully submitted                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 116 -     */                                                                                                           </span>
<span class="5323932416516552401" onmouseenter="enter('5323932416516552401');" onmouseout="out('5323932416516552401');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 117 -    @PostMapping(value = &quot;/transactions&quot;, consumes = &quot;application/json&quot;)                                          </span>
<span class="7447046953845578255" onmouseenter="enter('7447046953845578255');" onmouseout="out('7447046953845578255');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 118 -    @ResponseStatus(HttpStatus.OK)                                                                                </span>
<span class="1897907323625472935" onmouseenter="enter('1897907323625472935');" onmouseout="out('1897907323625472935');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 119 -    public ResponseEntity&lt;?&gt; addTransaction(                                                                      </span>
<span class="1166903297081280981" onmouseenter="enter('1166903297081280981');" onmouseout="out('1166903297081280981');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 120 -            @RequestHeader(&quot;Authorization&quot;) String bearerToken,                                                   </span>
<span class="9022696444049056102" onmouseenter="enter('9022696444049056102');" onmouseout="out('9022696444049056102');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 121 -            @RequestBody Transaction transaction) {                                                               </span>
<span class="-3538581758087352701" onmouseenter="enter('-3538581758087352701');" onmouseout="out('-3538581758087352701');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 122 -        if (bearerToken != null &amp;&amp; bearerToken.startsWith(&quot;Bearer &quot;)) {                                           </span>
<span class="-7115210276566291681" onmouseenter="enter('-7115210276566291681');" onmouseout="out('-7115210276566291681');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 123 -            bearerToken = bearerToken.split(&quot;Bearer &quot;)[1];                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 124 -        }                                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 125 -        try {                                                                                                     </span>
<span class="-4457463381546497224" onmouseenter="enter('-4457463381546497224');" onmouseout="out('-4457463381546497224');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 126 -            if (bearerToken == null) {                                                                            </span>


<span class="-5454936540258631376" onmouseenter="enter('-5454936540258631376');" onmouseout="out('-5454936540258631376');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 127 -                throw new IllegalArgumentException(                                                               </span>
<span class="-4688472594501119643" onmouseenter="enter('-4688472594501119643');" onmouseout="out('-4688472594501119643');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 128 -                        EXCEPTION_MESSAGE_WHEN_AUTHORIZATION_HEADER_NULL);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 129 -            }                                                                                                     </span>
<span class="-5768910099284843906" onmouseenter="enter('-5768910099284843906');" onmouseout="out('-5768910099284843906');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 130 -            final DecodedJWT jwt = this.verifier.verify(bearerToken);                                             </span>
<span class="-6962791519859020761" onmouseenter="enter('-6962791519859020761');" onmouseout="out('-6962791519859020761');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 131 -            // validate transaction                                                                               </span>
<span class="776637986685870327" onmouseenter="enter('776637986685870327');" onmouseout="out('776637986685870327');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 132 -            transactionValidator.validateTransaction(localRoutingNum,                                             </span>
<span class="-4879758647615452357" onmouseenter="enter('-4879758647615452357');" onmouseout="out('-4879758647615452357');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 133 -                    jwt.getClaim(JWT_ACCOUNT_KEY).asString(), transaction);                                       </span>
<span class="-1762835934379555281" onmouseenter="enter('-1762835934379555281');" onmouseout="out('-1762835934379555281');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 134 -            // Ensure sender balance can cover transaction.                                                       </span>
<span class="-6144219964793655128" onmouseenter="enter('-6144219964793655128');" onmouseout="out('-6144219964793655128');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 135 -            if (transaction.getFromRoutingNum().equals(localRoutingNum)) {                                        </span>
<span class="7239735847198029864" onmouseenter="enter('7239735847198029864');" onmouseout="out('7239735847198029864');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 136 -                int balance = getAvailableBalance(                                                                </span>
<span class="7702083458280016025" onmouseenter="enter('7702083458280016025');" onmouseout="out('7702083458280016025');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 137 -                        bearerToken, transaction.getFromAccountNum());                                            </span>
<span class="-8424323426889164999" onmouseenter="enter('-8424323426889164999');" onmouseout="out('-8424323426889164999');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 138 -                if (balance &lt; transaction.getAmount()) {                                                          </span>


<span class="-8046945014218387655" onmouseenter="enter('-8046945014218387655');" onmouseout="out('-8046945014218387655');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 139 -                    throw new IllegalStateException(                                                              </span>
<span class="-5146115328615515543" onmouseenter="enter('-5146115328615515543');" onmouseout="out('-5146115328615515543');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 140 -                            EXCEPTION_MESSAGE_INSUFFICIENT_BALANCE);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 141 -                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 142 -            }                                                                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 143 -                                                                                                                  </span>
<span class="-3539745766511737220" onmouseenter="enter('-3539745766511737220');" onmouseout="out('-3539745766511737220');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 144 -            // No exceptions thrown. Add to ledger                                                                </span>
<span class="613498208305766257" onmouseenter="enter('613498208305766257');" onmouseout="out('613498208305766257');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 145 -            LOGGER.fine(&quot;Submitting transaction &quot;                                                                 </span>
<span class="2531207035820706002" onmouseenter="enter('2531207035820706002');" onmouseout="out('2531207035820706002');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 146 -                    + transaction.toString());                                                                    </span>
<span class="-7584575581620960643" onmouseenter="enter('-7584575581620960643');" onmouseout="out('-7584575581620960643');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 147 -            transactionRepository.save(transaction);                                                              </span>

<span class="-5231725033690787161" onmouseenter="enter('-5231725033690787161');" onmouseout="out('-5231725033690787161');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 148 -            return new ResponseEntity&lt;String&gt;(READINESS_CODE,                                                     </span>
<span class="-8527330892964817671" onmouseenter="enter('-8527330892964817671');" onmouseout="out('-8527330892964817671');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 149 -                    HttpStatus.CREATED);                                                                          </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 150 -                                                                                                                  </span>
<span class="5687577372953802395" onmouseenter="enter('5687577372953802395');" onmouseout="out('5687577372953802395');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 151 -        } catch (JWTVerificationException e) {                                                                    </span>


<span class="-4154758301555607236" onmouseenter="enter('-4154758301555607236');" onmouseout="out('-4154758301555607236');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 152 -            return new ResponseEntity&lt;String&gt;(UNAUTHORIZED_CODE,                                                  </span>
<span class="-3711769128880294107" onmouseenter="enter('-3711769128880294107');" onmouseout="out('-3711769128880294107');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 153 -                                              HttpStatus.UNAUTHORIZED);                                           </span>
<span class="-16261657306661328" onmouseenter="enter('-16261657306661328');" onmouseout="out('-16261657306661328');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 154 -        } catch (IllegalArgumentException | IllegalStateException e) {                                            </span>


<span class="4951897796013672092" onmouseenter="enter('4951897796013672092');" onmouseout="out('4951897796013672092');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 155 -            return new ResponseEntity&lt;String&gt;(e.getMessage(),                                                     </span>
<span class="-4870417752025294804" onmouseenter="enter('-4870417752025294804');" onmouseout="out('-4870417752025294804');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 156 -                                              HttpStatus.BAD_REQUEST);                                            </span>
<span class="2761749540388092140" onmouseenter="enter('2761749540388092140');" onmouseout="out('2761749540388092140');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 157 -        } catch (ResourceAccessException                                                                          </span>
<span class="7920423166678117814" onmouseenter="enter('7920423166678117814');" onmouseout="out('7920423166678117814');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 158 -                | CannotCreateTransactionException                                                                </span>
<span class="-7265908382255363783" onmouseenter="enter('-7265908382255363783');" onmouseout="out('-7265908382255363783');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 159 -                | HttpServerErrorException e) {                                                                   </span>

<span class="4951897796013672092" onmouseenter="enter('4951897796013672092');" onmouseout="out('4951897796013672092');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 160 -            return new ResponseEntity&lt;String&gt;(e.getMessage(),                                                     </span>
<span class="862392687202373996" onmouseenter="enter('862392687202373996');" onmouseout="out('862392687202373996');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 161 -                                              HttpStatus.INTERNAL_SERVER_ERROR);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 162 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 163 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 164 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 165 -    /**                                                                                                           </span>
<span class="-840803106370353754" onmouseenter="enter('-840803106370353754');" onmouseout="out('-840803106370353754');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 166 -     * Retrieve the balance for the transaction&#x27;s sender.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 167 -     *                                                                                                            </span>
<span class="-5399624366599429167" onmouseenter="enter('-5399624366599429167');" onmouseout="out('-5399624366599429167');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 168 -     * @param token  the token used to authenticate request                                                       </span>
<span class="5530241027805460636" onmouseenter="enter('5530241027805460636');" onmouseout="out('5530241027805460636');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 169 -     * @param fromAcct  sender account number                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 170 -     *                                                                                                            </span>
<span class="-4671862933441611565" onmouseenter="enter('-4671862933441611565');" onmouseout="out('-4671862933441611565');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 171 -     * @return available balance of the sender account                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 172 -     *                                                                                                            </span>
<span class="7966166498405371741" onmouseenter="enter('7966166498405371741');" onmouseout="out('7966166498405371741');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 173 -     * @throws HttpServerErrorException  if balance service returns 500                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 174 -     */                                                                                                           </span>
<span class="-4867839573468993721" onmouseenter="enter('-4867839573468993721');" onmouseout="out('-4867839573468993721');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 175 -    protected int getAvailableBalance(String token, String fromAcct)                                              </span>
<span class="7044480961715798280" onmouseenter="enter('7044480961715798280');" onmouseout="out('7044480961715798280');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 176 -            throws HttpServerErrorException {                                                                     </span>


<span class="-1187465989316714928" onmouseenter="enter('-1187465989316714928');" onmouseout="out('-1187465989316714928');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 177 -        HttpHeaders headers = new HttpHeaders();                                                                  </span>
<span class="3201291767686862102" onmouseenter="enter('3201291767686862102');" onmouseout="out('3201291767686862102');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 178 -        headers.set(&quot;Authorization&quot;, &quot;Bearer &quot; + token);                                                          </span>
<span class="-1899310457862616867" onmouseenter="enter('-1899310457862616867');" onmouseout="out('-1899310457862616867');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 179 -        HttpEntity entity = new HttpEntity(headers);                                                              </span>
<span class="3202802947297119524" onmouseenter="enter('3202802947297119524');" onmouseout="out('3202802947297119524');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 180 -        RestTemplate restTemplate = new RestTemplate();                                                           </span>
<span class="5149154134365859036" onmouseenter="enter('5149154134365859036');" onmouseout="out('5149154134365859036');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 181 -        String uri = balancesApiUri + &quot;/&quot; + fromAcct;                                                             </span>
<span class="-697674251075958280" onmouseenter="enter('-697674251075958280');" onmouseout="out('-697674251075958280');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 182 -        ResponseEntity&lt;Integer&gt; response = restTemplate.exchange(                                                 </span>
<span class="6083870125336786698" onmouseenter="enter('6083870125336786698');" onmouseout="out('6083870125336786698');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 183 -            uri, HttpMethod.GET, entity, Integer.class);                                                          </span>
<span class="6400740982500579689" onmouseenter="enter('6400740982500579689');" onmouseout="out('6400740982500579689');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 184 -        Integer senderBalance = response.getBody();                                                               </span>
<span class="8092340863849585815" onmouseenter="enter('8092340863849585815');" onmouseout="out('8092340863849585815');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 185 -        return senderBalance.intValue();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 186 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 187 -                                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 188 -}                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="8011746770707306235" onmouseenter="enter('8011746770707306235');" onmouseout="out('8011746770707306235');" style="">   2   * Copyright 2020, Google LLC.                                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">   8   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span  style="">  16                                                                                                                    </span>
<span class="-1031727034891410218" onmouseenter="enter('-1031727034891410218');" onmouseout="out('-1031727034891410218');" style="">  17  package anthos.samples.financedemo.ledgerwriter;                                                                  </span>
<span  style="">  18                                                                                                                    </span>
<span class="3887843854525453733" onmouseenter="enter('3887843854525453733');" onmouseout="out('3887843854525453733');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  19 -import java.util.logging.Logger;                                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  20 -                                                                                                                  </span>
<span class="-538473715904851717" onmouseenter="enter('-538473715904851717');" onmouseout="out('-538473715904851717');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  21 +import org.apache.logging.log4j.LogManager;                                                                       </span>
<span class="2283937394492695819" onmouseenter="enter('2283937394492695819');" onmouseout="out('2283937394492695819');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  22 +import org.apache.logging.log4j.Logger;                                                                           </span>
<span class="3248634983943737307" onmouseenter="enter('3248634983943737307');" onmouseout="out('3248634983943737307');" style="">  23  import  org.springframework.web.client.HttpServerErrorException;                                                  </span>
<span  style="">  24                                                                                                                    </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  25  import org.springframework.beans.factory.annotation.Value;                                                        </span>
<span class="-2449065930046514282" onmouseenter="enter('-2449065930046514282');" onmouseout="out('-2449065930046514282');" style="">  26  import org.springframework.http.HttpEntity;                                                                       </span>
<span class="-2017038789555914398" onmouseenter="enter('-2017038789555914398');" onmouseout="out('-2017038789555914398');" style="">  27  import org.springframework.http.HttpHeaders;                                                                      </span>
<span class="7461978282736946494" onmouseenter="enter('7461978282736946494');" onmouseout="out('7461978282736946494');" style="">  28  import org.springframework.http.HttpMethod;                                                                       </span>
<span class="-6100913791676640620" onmouseenter="enter('-6100913791676640620');" onmouseout="out('-6100913791676640620');" style="">  29  import org.springframework.http.HttpStatus;                                                                       </span>
<span class="-4731930330216408095" onmouseenter="enter('-4731930330216408095');" onmouseout="out('-4731930330216408095');" style="">  30  import org.springframework.http.ResponseEntity;                                                                   </span>
<span class="5341219335560996028" onmouseenter="enter('5341219335560996028');" onmouseout="out('5341219335560996028');" style="">  31  import org.springframework.transaction.CannotCreateTransactionException;                                          </span>
<span class="-4152290558559497176" onmouseenter="enter('-4152290558559497176');" onmouseout="out('-4152290558559497176');" style="">  32  import org.springframework.web.bind.annotation.GetMapping;                                                        </span>
<span class="4051535263177665628" onmouseenter="enter('4051535263177665628');" onmouseout="out('4051535263177665628');" style="">  33  import org.springframework.web.bind.annotation.PostMapping;                                                       </span>
<span class="-5091358343566339359" onmouseenter="enter('-5091358343566339359');" onmouseout="out('-5091358343566339359');" style="">  34  import org.springframework.web.bind.annotation.RequestBody;                                                       </span>
<span class="7012630364184468857" onmouseenter="enter('7012630364184468857');" onmouseout="out('7012630364184468857');" style="">  35  import org.springframework.web.bind.annotation.RequestHeader;                                                     </span>
<span class="-583363652389169341" onmouseenter="enter('-583363652389169341');" onmouseout="out('-583363652389169341');" style="">  36  import org.springframework.web.bind.annotation.ResponseStatus;                                                    </span>
<span class="-7037114424511181002" onmouseenter="enter('-7037114424511181002');" onmouseout="out('-7037114424511181002');" style="">  37  import org.springframework.web.bind.annotation.RestController;                                                    </span>
<span class="-7374118861510179828" onmouseenter="enter('-7374118861510179828');" onmouseout="out('-7374118861510179828');" style="">  38  import org.springframework.web.client.ResourceAccessException;                                                    </span>
<span class="-2270477891067927787" onmouseenter="enter('-2270477891067927787');" onmouseout="out('-2270477891067927787');" style="">  39  import org.springframework.web.client.RestTemplate;                                                               </span>
<span  style="">  40                                                                                                                    </span>
<span class="494822993659260728" onmouseenter="enter('494822993659260728');" onmouseout="out('494822993659260728');" style="">  41  import com.auth0.jwt.JWTVerifier;                                                                                 </span>
<span class="-7211641848955402551" onmouseenter="enter('-7211641848955402551');" onmouseout="out('-7211641848955402551');" style="">  42  import com.auth0.jwt.exceptions.JWTVerificationException;                                                         </span>
<span class="5156920743651519035" onmouseenter="enter('5156920743651519035');" onmouseout="out('5156920743651519035');" style="">  43  import com.auth0.jwt.interfaces.DecodedJWT;                                                                       </span>
<span  style="">  44                                                                                                                    </span>
<span class="6997167230740553376" onmouseenter="enter('6997167230740553376');" onmouseout="out('6997167230740553376');" style="">  45  import static anthos.samples.financedemo.ledgerwriter.ExceptionMessages.                                          </span>
<span class="5485927036637514847" onmouseenter="enter('5485927036637514847');" onmouseout="out('5485927036637514847');" style="">  46          EXCEPTION_MESSAGE_INSUFFICIENT_BALANCE;                                                                   </span>
<span class="6997167230740553376" onmouseenter="enter('6997167230740553376');" onmouseout="out('6997167230740553376');" style="">  47  import static anthos.samples.financedemo.ledgerwriter.ExceptionMessages.                                          </span>
<span class="-8362488606383815534" onmouseenter="enter('-8362488606383815534');" onmouseout="out('-8362488606383815534');" style="">  48          EXCEPTION_MESSAGE_WHEN_AUTHORIZATION_HEADER_NULL;                                                         </span>
<span  style="">  49                                                                                                                    </span>
<span class="6355076151554545937" onmouseenter="enter('6355076151554545937');" onmouseout="out('6355076151554545937');" style="">  50  @RestController                                                                                                   </span>
<span class="5933445460753317183" onmouseenter="enter('5933445460753317183');" onmouseout="out('5933445460753317183');" style="">  51  public final class LedgerWriterController {                                                                       </span>
<span  style="">  52                                                                                                                    </span>
<span class="673777152962679767" onmouseenter="enter('673777152962679767');" onmouseout="out('673777152962679767');" style="">  53      private static final Logger LOGGER =                                                                          </span>
<span class="-7957956039430515397" onmouseenter="enter('-7957956039430515397');" onmouseout="out('-7957956039430515397');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  54 -            Logger.getLogger(LedgerWriterController.class.getName());                                             </span>
<span class="999928017189038216" onmouseenter="enter('999928017189038216');" onmouseout="out('999928017189038216');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  55 +        LogManager.getLogger(LedgerWriterController.class);                                                       </span>
<span  style="">  56                                                                                                                    </span>
<span class="-728019112929028725" onmouseenter="enter('-728019112929028725');" onmouseout="out('-728019112929028725');" style="">  57      private TransactionRepository transactionRepository;                                                          </span>
<span class="-4578700528226723750" onmouseenter="enter('-4578700528226723750');" onmouseout="out('-4578700528226723750');" style="">  58      private TransactionValidator transactionValidator;                                                            </span>
<span class="-5049251535661215052" onmouseenter="enter('-5049251535661215052');" onmouseout="out('-5049251535661215052');" style="">  59      private JWTVerifier verifier;                                                                                 </span>
<span  style="">  60                                                                                                                    </span>
<span class="-8636473471686513279" onmouseenter="enter('-8636473471686513279');" onmouseout="out('-8636473471686513279');" style="">  61      private String localRoutingNum;                                                                               </span>
<span class="-469486944919448386" onmouseenter="enter('-469486944919448386');" onmouseout="out('-469486944919448386');" style="">  62      private String balancesApiUri;                                                                                </span>
<span class="6148824265517010025" onmouseenter="enter('6148824265517010025');" onmouseout="out('6148824265517010025');" style="">  63      private String version;                                                                                       </span>
<span  style="">  64                                                                                                                    </span>
<span class="-6505034648581184544" onmouseenter="enter('-6505034648581184544');" onmouseout="out('-6505034648581184544');" style="">  65      public static final String READINESS_CODE = &quot;ok&quot;;                                                             </span>
<span class="-9149089262416743429" onmouseenter="enter('-9149089262416743429');" onmouseout="out('-9149089262416743429');" style="">  66      public static final String UNAUTHORIZED_CODE = &quot;not authorized&quot;;                                              </span>
<span class="6290000176908202808" onmouseenter="enter('6290000176908202808');" onmouseout="out('6290000176908202808');" style="">  67      public static final String JWT_ACCOUNT_KEY = &quot;acct&quot;;                                                          </span>
<span  style="">  68                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  69      /**                                                                                                           </span>
<span class="-1436741038288612910" onmouseenter="enter('-1436741038288612910');" onmouseout="out('-1436741038288612910');" style="">  70      * Constructor.                                                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  71      *                                                                                                             </span>
<span class="-5348532432243399187" onmouseenter="enter('-5348532432243399187');" onmouseout="out('-5348532432243399187');" style="">  72      * Initializes JWT verifier.                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  73      */                                                                                                            </span>
<span  style="">  74                                                                                                                    </span>
<span class="8937474768837710123" onmouseenter="enter('8937474768837710123');" onmouseout="out('8937474768837710123');" style="">  75      public LedgerWriterController(                                                                                </span>
<span class="2780303771851218368" onmouseenter="enter('2780303771851218368');" onmouseout="out('2780303771851218368');" style="">  76              JWTVerifier verifier,                                                                                 </span>
<span class="1132068715177995291" onmouseenter="enter('1132068715177995291');" onmouseout="out('1132068715177995291');" style="">  77              TransactionRepository transactionRepository,                                                          </span>
<span class="5479269793478582431" onmouseenter="enter('5479269793478582431');" onmouseout="out('5479269793478582431');" style="">  78              TransactionValidator transactionValidator,                                                            </span>
<span class="-822564396537268339" onmouseenter="enter('-822564396537268339');" onmouseout="out('-822564396537268339');" style="">  79              @Value(&quot;${LOCAL_ROUTING_NUM}&quot;) String localRoutingNum,                                                </span>
<span class="-2250521274199702466" onmouseenter="enter('-2250521274199702466');" onmouseout="out('-2250521274199702466');" style="">  80              @Value(&quot;http://${BALANCES_API_ADDR}/balances&quot;)                                                        </span>
<span class="5760341242560825698" onmouseenter="enter('5760341242560825698');" onmouseout="out('5760341242560825698');" style="">  81                      String balancesApiUri,                                                                        </span>
<span class="3727660980762547349" onmouseenter="enter('3727660980762547349');" onmouseout="out('3727660980762547349');" style="">  82              @Value(&quot;${VERSION}&quot;) String version) {                                                                </span>
<span class="2791682847397564046" onmouseenter="enter('2791682847397564046');" onmouseout="out('2791682847397564046');" style="">  83          this.verifier = verifier;                                                                                 </span>
<span class="5620916918385755227" onmouseenter="enter('5620916918385755227');" onmouseout="out('5620916918385755227');" style="">  84          this.transactionRepository = transactionRepository;                                                       </span>
<span class="7194621662788445012" onmouseenter="enter('7194621662788445012');" onmouseout="out('7194621662788445012');" style="">  85          this.transactionValidator = transactionValidator;                                                         </span>
<span class="5248812605098956146" onmouseenter="enter('5248812605098956146');" onmouseout="out('5248812605098956146');" style="">  86          this.localRoutingNum = localRoutingNum;                                                                   </span>
<span class="-1729773563907748731" onmouseenter="enter('-1729773563907748731');" onmouseout="out('-1729773563907748731');" style="">  87          this.balancesApiUri = balancesApiUri;                                                                     </span>
<span class="8734022701570323791" onmouseenter="enter('8734022701570323791');" onmouseout="out('8734022701570323791');" style="">  88          this.version = version;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  89      }                                                                                                             </span>
<span  style="">  90                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  91      /**                                                                                                           </span>
<span class="559132540195676827" onmouseenter="enter('559132540195676827');" onmouseout="out('559132540195676827');" style="">  92       * Version endpoint.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  93       *                                                                                                            </span>
<span class="-3837725526160323045" onmouseenter="enter('-3837725526160323045');" onmouseout="out('-3837725526160323045');" style="">  94       * @return  service version string                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  95       */                                                                                                           </span>
<span class="6685475051439146687" onmouseenter="enter('6685475051439146687');" onmouseout="out('6685475051439146687');" style="">  96      @GetMapping(&quot;/version&quot;)                                                                                       </span>
<span class="580444279607563843" onmouseenter="enter('580444279607563843');" onmouseout="out('580444279607563843');" style="">  97      public ResponseEntity version() {                                                                             </span>
<span class="5343850267959959664" onmouseenter="enter('5343850267959959664');" onmouseout="out('5343850267959959664');" style="">  98          return new ResponseEntity&lt;String&gt;(version, HttpStatus.OK);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99      }                                                                                                             </span>
<span  style=""> 100                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 101      /**                                                                                                           </span>
<span class="-3900287586435222134" onmouseenter="enter('-3900287586435222134');" onmouseout="out('-3900287586435222134');" style=""> 102       * Readiness probe endpoint.                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 103       *                                                                                                            </span>
<span class="8463518254556868911" onmouseenter="enter('8463518254556868911');" onmouseout="out('8463518254556868911');" style=""> 104       * @return HTTP Status 200 if server is ready to receive requests.                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 105       */                                                                                                           </span>
<span class="-7757302847206504814" onmouseenter="enter('-7757302847206504814');" onmouseout="out('-7757302847206504814');" style=""> 106      @GetMapping(&quot;/ready&quot;)                                                                                         </span>
<span class="7447046953845578255" onmouseenter="enter('7447046953845578255');" onmouseout="out('7447046953845578255');" style=""> 107      @ResponseStatus(HttpStatus.OK)                                                                                </span>
<span class="7271346341917529010" onmouseenter="enter('7271346341917529010');" onmouseout="out('7271346341917529010');" style=""> 108      public ResponseEntity&lt;String&gt; readiness() {                                                                   </span>
<span class="-4075762798656461919" onmouseenter="enter('-4075762798656461919');" onmouseout="out('-4075762798656461919');" style=""> 109          return new ResponseEntity&lt;String&gt;(READINESS_CODE, HttpStatus.OK);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110      }                                                                                                             </span>
<span  style=""> 111                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 112      /**                                                                                                           </span>
<span class="3242866774072620153" onmouseenter="enter('3242866774072620153');" onmouseout="out('3242866774072620153');" style=""> 113       * Submit a new transaction to the ledger.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 114       *                                                                                                            </span>
<span class="-1661212859137511783" onmouseenter="enter('-1661212859137511783');" onmouseout="out('-1661212859137511783');" style=""> 115       * @param bearerToken  HTTP request &#x27;Authorization&#x27; header                                                    </span>
<span class="5399615509278749127" onmouseenter="enter('5399615509278749127');" onmouseout="out('5399615509278749127');" style=""> 116       * @param transaction  transaction to submit                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 117       *                                                                                                            </span>
<span class="7486646966745340100" onmouseenter="enter('7486646966745340100');" onmouseout="out('7486646966745340100');" style=""> 118       * @return  HTTP Status 200 if transaction was successfully submitted                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 119       */                                                                                                           </span>
<span class="5323932416516552401" onmouseenter="enter('5323932416516552401');" onmouseout="out('5323932416516552401');" style=""> 120      @PostMapping(value = &quot;/transactions&quot;, consumes = &quot;application/json&quot;)                                          </span>
<span class="7447046953845578255" onmouseenter="enter('7447046953845578255');" onmouseout="out('7447046953845578255');" style=""> 121      @ResponseStatus(HttpStatus.OK)                                                                                </span>
<span class="1897907323625472935" onmouseenter="enter('1897907323625472935');" onmouseout="out('1897907323625472935');" style=""> 122      public ResponseEntity&lt;?&gt; addTransaction(                                                                      </span>
<span class="1166903297081280981" onmouseenter="enter('1166903297081280981');" onmouseout="out('1166903297081280981');" style=""> 123              @RequestHeader(&quot;Authorization&quot;) String bearerToken,                                                   </span>
<span class="9022696444049056102" onmouseenter="enter('9022696444049056102');" onmouseout="out('9022696444049056102');" style=""> 124              @RequestBody Transaction transaction) {                                                               </span>
<span class="-3538581758087352701" onmouseenter="enter('-3538581758087352701');" onmouseout="out('-3538581758087352701');" style=""> 125          if (bearerToken != null &amp;&amp; bearerToken.startsWith(&quot;Bearer &quot;)) {                                           </span>
<span class="-7115210276566291681" onmouseenter="enter('-7115210276566291681');" onmouseout="out('-7115210276566291681');" style=""> 126              bearerToken = bearerToken.split(&quot;Bearer &quot;)[1];                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127          }                                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 128          try {                                                                                                     </span>
<span class="-4457463381546497224" onmouseenter="enter('-4457463381546497224');" onmouseout="out('-4457463381546497224');" style=""> 129              if (bearerToken == null) {                                                                            </span>
<span class="8471284381161989921" onmouseenter="enter('8471284381161989921');" onmouseout="out('8471284381161989921');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 130 +                LOGGER.error(&quot;Transaction submission failed: &quot;                                                    </span>
<span class="-6310070690167802414" onmouseenter="enter('-6310070690167802414');" onmouseout="out('-6310070690167802414');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 131 +                    + &quot;Authorization header null&quot;);                                                               </span>
<span class="-5454936540258631376" onmouseenter="enter('-5454936540258631376');" onmouseout="out('-5454936540258631376');" style=""> 132                  throw new IllegalArgumentException(                                                               </span>
<span class="-4688472594501119643" onmouseenter="enter('-4688472594501119643');" onmouseout="out('-4688472594501119643');" style=""> 133                          EXCEPTION_MESSAGE_WHEN_AUTHORIZATION_HEADER_NULL);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134              }                                                                                                     </span>
<span class="-5768910099284843906" onmouseenter="enter('-5768910099284843906');" onmouseout="out('-5768910099284843906');" style=""> 135              final DecodedJWT jwt = this.verifier.verify(bearerToken);                                             </span>
<span class="-6962791519859020761" onmouseenter="enter('-6962791519859020761');" onmouseout="out('-6962791519859020761');" style=""> 136              // validate transaction                                                                               </span>
<span class="776637986685870327" onmouseenter="enter('776637986685870327');" onmouseout="out('776637986685870327');" style=""> 137              transactionValidator.validateTransaction(localRoutingNum,                                             </span>
<span class="-4879758647615452357" onmouseenter="enter('-4879758647615452357');" onmouseout="out('-4879758647615452357');" style=""> 138                      jwt.getClaim(JWT_ACCOUNT_KEY).asString(), transaction);                                       </span>
<span class="-1762835934379555281" onmouseenter="enter('-1762835934379555281');" onmouseout="out('-1762835934379555281');" style=""> 139              // Ensure sender balance can cover transaction.                                                       </span>
<span class="-6144219964793655128" onmouseenter="enter('-6144219964793655128');" onmouseout="out('-6144219964793655128');" style=""> 140              if (transaction.getFromRoutingNum().equals(localRoutingNum)) {                                        </span>
<span class="7239735847198029864" onmouseenter="enter('7239735847198029864');" onmouseout="out('7239735847198029864');" style=""> 141                  int balance = getAvailableBalance(                                                                </span>
<span class="7702083458280016025" onmouseenter="enter('7702083458280016025');" onmouseout="out('7702083458280016025');" style=""> 142                          bearerToken, transaction.getFromAccountNum());                                            </span>
<span class="-8424323426889164999" onmouseenter="enter('-8424323426889164999');" onmouseout="out('-8424323426889164999');" style=""> 143                  if (balance &lt; transaction.getAmount()) {                                                          </span>
<span class="8471284381161989921" onmouseenter="enter('8471284381161989921');" onmouseout="out('8471284381161989921');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 144 +                    LOGGER.error(&quot;Transaction submission failed: &quot;                                                </span>
<span class="2606405075138145997" onmouseenter="enter('2606405075138145997');" onmouseout="out('2606405075138145997');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +                        + &quot;Insufficient balance&quot;);                                                                </span>
<span class="-8046945014218387655" onmouseenter="enter('-8046945014218387655');" onmouseout="out('-8046945014218387655');" style=""> 146                      throw new IllegalStateException(                                                              </span>
<span class="-5146115328615515543" onmouseenter="enter('-5146115328615515543');" onmouseout="out('-5146115328615515543');" style=""> 147                              EXCEPTION_MESSAGE_INSUFFICIENT_BALANCE);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 149              }                                                                                                     </span>
<span  style=""> 150                                                                                                                    </span>
<span class="-3539745766511737220" onmouseenter="enter('-3539745766511737220');" onmouseout="out('-3539745766511737220');" style=""> 151              // No exceptions thrown. Add to ledger                                                                </span>
<span class="613498208305766257" onmouseenter="enter('613498208305766257');" onmouseout="out('613498208305766257');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 152 -            LOGGER.fine(&quot;Submitting transaction &quot;                                                                 </span>
<span class="2531207035820706002" onmouseenter="enter('2531207035820706002');" onmouseout="out('2531207035820706002');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 153 -                    + transaction.toString());                                                                    </span>
<span class="-7584575581620960643" onmouseenter="enter('-7584575581620960643');" onmouseout="out('-7584575581620960643');" style=""> 154              transactionRepository.save(transaction);                                                              </span>
<span class="5719956641649610757" onmouseenter="enter('5719956641649610757');" onmouseout="out('5719956641649610757');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +            LOGGER.info(&quot;Submitted transaction successfully&quot;);                                                    </span>
<span class="-5231725033690787161" onmouseenter="enter('-5231725033690787161');" onmouseout="out('-5231725033690787161');" style=""> 156              return new ResponseEntity&lt;String&gt;(READINESS_CODE,                                                     </span>
<span class="-8527330892964817671" onmouseenter="enter('-8527330892964817671');" onmouseout="out('-8527330892964817671');" style=""> 157                      HttpStatus.CREATED);                                                                          </span>
<span  style=""> 158                                                                                                                    </span>
<span class="5687577372953802395" onmouseenter="enter('5687577372953802395');" onmouseout="out('5687577372953802395');" style=""> 159          } catch (JWTVerificationException e) {                                                                    </span>
<span class="-327448583504624880" onmouseenter="enter('-327448583504624880');" onmouseout="out('-327448583504624880');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 160 +            LOGGER.error(&quot;Failed to submit transaction: &quot;                                                         </span>
<span class="5874187622003058896" onmouseenter="enter('5874187622003058896');" onmouseout="out('5874187622003058896');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 161 +                + &quot;not authorized&quot;);                                                                              </span>
<span class="-4154758301555607236" onmouseenter="enter('-4154758301555607236');" onmouseout="out('-4154758301555607236');" style=""> 162              return new ResponseEntity&lt;String&gt;(UNAUTHORIZED_CODE,                                                  </span>
<span class="-3711769128880294107" onmouseenter="enter('-3711769128880294107');" onmouseout="out('-3711769128880294107');" style=""> 163                                                HttpStatus.UNAUTHORIZED);                                           </span>
<span class="-16261657306661328" onmouseenter="enter('-16261657306661328');" onmouseout="out('-16261657306661328');" style=""> 164          } catch (IllegalArgumentException | IllegalStateException e) {                                            </span>
<span class="-7663233641936656847" onmouseenter="enter('-7663233641936656847');" onmouseout="out('-7663233641936656847');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 165 +            LOGGER.error(&quot;Failed to retrieve account balance: &quot;                                                   </span>
<span class="-1386920267869766944" onmouseenter="enter('-1386920267869766944');" onmouseout="out('-1386920267869766944');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 166 +                + &quot;bad request&quot;);                                                                                 </span>
<span class="4951897796013672092" onmouseenter="enter('4951897796013672092');" onmouseout="out('4951897796013672092');" style=""> 167              return new ResponseEntity&lt;String&gt;(e.getMessage(),                                                     </span>
<span class="-4870417752025294804" onmouseenter="enter('-4870417752025294804');" onmouseout="out('-4870417752025294804');" style=""> 168                                                HttpStatus.BAD_REQUEST);                                            </span>
<span class="2761749540388092140" onmouseenter="enter('2761749540388092140');" onmouseout="out('2761749540388092140');" style=""> 169          } catch (ResourceAccessException                                                                          </span>
<span class="7920423166678117814" onmouseenter="enter('7920423166678117814');" onmouseout="out('7920423166678117814');" style=""> 170                  | CannotCreateTransactionException                                                                </span>
<span class="-7265908382255363783" onmouseenter="enter('-7265908382255363783');" onmouseout="out('-7265908382255363783');" style=""> 171                  | HttpServerErrorException e) {                                                                   </span>
<span class="-6756904505334648824" onmouseenter="enter('-6756904505334648824');" onmouseout="out('-6756904505334648824');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 172 +            LOGGER.error(&quot;Failed to retrieve account balance&quot;);                                                   </span>
<span class="4951897796013672092" onmouseenter="enter('4951897796013672092');" onmouseout="out('4951897796013672092');" style=""> 173              return new ResponseEntity&lt;String&gt;(e.getMessage(),                                                     </span>
<span class="862392687202373996" onmouseenter="enter('862392687202373996');" onmouseout="out('862392687202373996');" style=""> 174                                                HttpStatus.INTERNAL_SERVER_ERROR);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176      }                                                                                                             </span>
<span  style=""> 177                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 178      /**                                                                                                           </span>
<span class="-840803106370353754" onmouseenter="enter('-840803106370353754');" onmouseout="out('-840803106370353754');" style=""> 179       * Retrieve the balance for the transaction&#x27;s sender.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 180       *                                                                                                            </span>
<span class="-5399624366599429167" onmouseenter="enter('-5399624366599429167');" onmouseout="out('-5399624366599429167');" style=""> 181       * @param token  the token used to authenticate request                                                       </span>
<span class="5530241027805460636" onmouseenter="enter('5530241027805460636');" onmouseout="out('5530241027805460636');" style=""> 182       * @param fromAcct  sender account number                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 183       *                                                                                                            </span>
<span class="-4671862933441611565" onmouseenter="enter('-4671862933441611565');" onmouseout="out('-4671862933441611565');" style=""> 184       * @return available balance of the sender account                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 185       *                                                                                                            </span>
<span class="7966166498405371741" onmouseenter="enter('7966166498405371741');" onmouseout="out('7966166498405371741');" style=""> 186       * @throws HttpServerErrorException  if balance service returns 500                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 187       */                                                                                                           </span>
<span class="-4867839573468993721" onmouseenter="enter('-4867839573468993721');" onmouseout="out('-4867839573468993721');" style=""> 188      protected int getAvailableBalance(String token, String fromAcct)                                              </span>
<span class="7044480961715798280" onmouseenter="enter('7044480961715798280');" onmouseout="out('7044480961715798280');" style=""> 189              throws HttpServerErrorException {                                                                     </span>
<span class="2945528015156409897" onmouseenter="enter('2945528015156409897');" onmouseout="out('2945528015156409897');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 190 +        LOGGER.debug(&quot;Retrieving balance for transaction sender&quot;);                                                </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 191 +                                                                                                                  </span>
<span class="-1187465989316714928" onmouseenter="enter('-1187465989316714928');" onmouseout="out('-1187465989316714928');" style=""> 192          HttpHeaders headers = new HttpHeaders();                                                                  </span>
<span class="3201291767686862102" onmouseenter="enter('3201291767686862102');" onmouseout="out('3201291767686862102');" style=""> 193          headers.set(&quot;Authorization&quot;, &quot;Bearer &quot; + token);                                                          </span>
<span class="-1899310457862616867" onmouseenter="enter('-1899310457862616867');" onmouseout="out('-1899310457862616867');" style=""> 194          HttpEntity entity = new HttpEntity(headers);                                                              </span>
<span class="3202802947297119524" onmouseenter="enter('3202802947297119524');" onmouseout="out('3202802947297119524');" style=""> 195          RestTemplate restTemplate = new RestTemplate();                                                           </span>
<span class="5149154134365859036" onmouseenter="enter('5149154134365859036');" onmouseout="out('5149154134365859036');" style=""> 196          String uri = balancesApiUri + &quot;/&quot; + fromAcct;                                                             </span>
<span class="-697674251075958280" onmouseenter="enter('-697674251075958280');" onmouseout="out('-697674251075958280');" style=""> 197          ResponseEntity&lt;Integer&gt; response = restTemplate.exchange(                                                 </span>
<span class="6083870125336786698" onmouseenter="enter('6083870125336786698');" onmouseout="out('6083870125336786698');" style=""> 198              uri, HttpMethod.GET, entity, Integer.class);                                                          </span>
<span class="6400740982500579689" onmouseenter="enter('6400740982500579689');" onmouseout="out('6400740982500579689');" style=""> 199          Integer senderBalance = response.getBody();                                                               </span>
<span class="8092340863849585815" onmouseenter="enter('8092340863849585815');" onmouseout="out('8092340863849585815');" style=""> 200          return senderBalance.intValue();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201      }                                                                                                             </span>
<span  style=""> 202                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            