<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>73</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    73
                    <a href="72.html">prev</a>
                    <a href="74.html">next</a>
                    <a href="73_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    CarGuo/GSYVideoPlayer_a1061d62099001b02357c265e6d4fce0b95a66fc_gsyVideoPlayer-exo_player2/src/main/java/tv/danmaku/ijk/media/exo2/IjkExo2MediaPlayer.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CarGuo\GSYVideoPlayer show &quot;a1061d62099001b02357c265e6d4fce0b95a66fc:gsyVideoPlayer-exo_player2/src/main/java/tv/danmaku/ijk/media/exo2/IjkExo2MediaPlayer.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CarGuo\GSYVideoPlayer show &quot;a1061d62099001b02357c265e6d4fce0b95a66fc^1:gsyVideoPlayer-exo_player2/src/main/java/tv/danmaku/ijk/media/exo2/IjkExo2MediaPlayer.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CarGuo\GSYVideoPlayer show &quot;a1061d62099001b02357c265e6d4fce0b95a66fc^2:gsyVideoPlayer-exo_player2/src/main/java/tv/danmaku/ijk/media/exo2/IjkExo2MediaPlayer.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CarGuo\GSYVideoPlayer show &quot;0bbf9d653eac231e9add9fe4bd2073e7054970dc:gsyVideoPlayer-exo_player2/src/main/java/tv/danmaku/ijk/media/exo2/IjkExo2MediaPlayer.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [b], [b], [b], [b], [b], [b], [b], [bj], [bj], [j], [j], [j], [j], [s]], subset: [[sbj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 
   2 package tv.danmaku.ijk.media.exo2;
   3 
   4 import android.content.Context;
   5 import android.net.Uri;
   6 import android.os.Handler;
   7 import android.os.Looper;
   8 import android.view.Surface;
   9 import android.view.SurfaceHolder;
  10 
  11 import androidx.annotation.NonNull;
  12 import androidx.annotation.Nullable;
  13 import androidx.annotation.Size;
  14 
  15 import com.google.android.exoplayer2.C;
  16 import com.google.android.exoplayer2.DefaultLoadControl;
  17 import com.google.android.exoplayer2.DefaultRenderersFactory;
  18 import com.google.android.exoplayer2.ExoPlaybackException;
  19 import com.google.android.exoplayer2.LoadControl;
  20 import com.google.android.exoplayer2.PlaybackParameters;
  21 import com.google.android.exoplayer2.Player;
  22 import com.google.android.exoplayer2.SeekParameters;
  23 import com.google.android.exoplayer2.SimpleExoPlayer;
  24 import com.google.android.exoplayer2.analytics.AnalyticsListener;
  25 import com.google.android.exoplayer2.decoder.DecoderCounters;
  26 import com.google.android.exoplayer2.metadata.Metadata;
  27 import com.google.android.exoplayer2.source.MediaSource;
  28 import com.google.android.exoplayer2.source.TrackGroupArray;
  29 import com.google.android.exoplayer2.text.Cue;
  30 import com.google.android.exoplayer2.trackselection.DefaultTrackSelector;
  31 import com.google.android.exoplayer2.trackselection.MappingTrackSelector;
  32 import com.google.android.exoplayer2.trackselection.TrackSelectionArray;
  33 import com.google.android.exoplayer2.video.VideoSize;
  34 
  35 import java.io.File;
  36 import java.io.FileDescriptor;
  37 import java.util.HashMap;
  38 import java.util.List;
  39 import java.util.Map;
  40 
  41 import tv.danmaku.ijk.media.exo2.demo.EventLogger;
  42 import tv.danmaku.ijk.media.player.AbstractMediaPlayer;
  43 import tv.danmaku.ijk.media.player.IMediaPlayer;
  44 import tv.danmaku.ijk.media.player.MediaInfo;
  45 import tv.danmaku.ijk.media.player.misc.IjkTrackInfo;
  46 
  47 import static com.google.android.exoplayer2.Player.DISCONTINUITY_REASON_SEEK;
  48 import static com.google.android.exoplayer2.Player.REPEAT_MODE_ALL;
  49 
  50 
  51 /**
  52  * Created by guoshuyu on 2018/1/10.
  53  * Exo
  54  */
<abbr title="  55 public class IjkExo2MediaPlayer extends AbstractMediaPlayer implements Player.Listener, AnalyticsListener {">  55 public class IjkExo2MediaPlayer extends AbstractMediaPlayer implements Player.Listener, AnalyticsListenerüîµ</abbr>
  56 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57 </span>
  58 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59  * Exo</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  61 public class IjkExo2MediaPlayer extends AbstractMediaPlayer implements Player.EventListener, AnalyticsListener {">  61 public class IjkExo2MediaPlayer extends AbstractMediaPlayer implements Player.EventListener, AnalyticsLisüîµ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63 </span>
  64 =======
  65 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
  66 
  67     public static final int ON_POSITION_DISCOUNTINUITY = 2702;
  68 
  69     private static final String TAG = &quot;IjkExo2MediaPlayer&quot;;
  70 
  71     protected final Context mAppContext;
  72     protected SimpleExoPlayer mInternalPlayer;
  73     protected EventLogger mEventLogger;
  74     protected DefaultRenderersFactory mRendererFactory;
  75     protected MediaSource mMediaSource;
  76     protected MappingTrackSelector mTrackSelector;
  77     protected LoadControl mLoadControl;
  78     protected String mDataSource;
  79     protected Surface mSurface;
  80     protected Map&lt;String, String&gt; mHeaders = new HashMap&lt;&gt;();
  81     protected PlaybackParameters mSpeedPlaybackParameters;
  82     protected int mVideoWidth;
  83     protected int mVideoHeight;
  84     protected int lastReportedPlaybackState;
  85     protected boolean isLastReportedPlayWhenReady;
  86     protected boolean isPreparing = true;
  87     protected boolean isBuffering = false;
  88     protected boolean isLooping = false;
  89     /**
  90      * ÊòØÂê¶Â∏¶‰∏äheader
  91      */
  92     protected boolean isPreview = false;
  93     /**
  94      * ÊòØÂê¶ÂºÄÂêØÁºìÂ≠ò
  95      */
  96     protected boolean isCache = false;
  97     /**
  98      * dataSourceÁ≠âÁöÑÂ∏ÆÁªÑÁ±ª
  99      */
 100     protected final ExoSourceManager mExoHelper;
 101     /**
 102      * ÁºìÂ≠òÁõÆÂΩïÔºåÂèØ‰ª•‰∏∫Á©∫
 103      */
 104     protected File mCacheDir;
 105     /**
 106      * Á±ªÂûãË¶ÜÁõñ
 107      */
 108     private String mOverrideExtension;
 109 
 110     protected int audioSessionId = C.AUDIO_SESSION_ID_UNSET;
 111 
 112 
 113     public IjkExo2MediaPlayer(Context context) {
 114         mAppContext = context.getApplicationContext();
 115         lastReportedPlaybackState = Player.STATE_IDLE;
 116         mExoHelper = ExoSourceManager.newInstance(context, mHeaders);
 117     }
 118 
 119 
 120     private int getVideoRendererIndex() {
 121         if (mInternalPlayer != null) {
 122             for (int i = 0; i &lt; mInternalPlayer.getRendererCount(); i++) {
 123                 if (mInternalPlayer.getRendererType(i) == C.TRACK_TYPE_VIDEO) {
 124                     return i;
 125                 }
 126             }
 127         }
 128         return 0;
 129     }
 130 
 131     @Override
 132     public void setDisplay(SurfaceHolder sh) {
 133         if (sh == null)
 134             setSurface(null);
 135         else
 136             setSurface(sh.getSurface());
 137     }
 138 
 139     @Override
 140     public void setSurface(Surface surface) {
 141         mSurface = surface;
 142         if (mInternalPlayer != null) {
 143             if (surface != null &amp;&amp; !surface.isValid()) {
 144                 mSurface = null;
 145             }
 146             mInternalPlayer.setVideoSurface(surface);
 147         }
 148     }
 149 
 150 
 151     @Override
 152     public void setDataSource(Context context, Uri uri, Map&lt;String, String&gt; headers) {
 153         if (headers != null) {
 154             mHeaders.clear();
 155             mHeaders.putAll(headers);
 156         }
 157         setDataSource(context, uri);
 158     }
 159 
 160     @Override
 161     public void setDataSource(String path) {
 162         setDataSource(mAppContext, Uri.parse(path));
 163     }
 164 
 165     @Override
 166     public void setDataSource(Context context, Uri uri) {
 167         mDataSource = uri.toString();
<abbr title=" 168         mMediaSource = mExoHelper.getMediaSource(mDataSource, isPreview, isCache, isLooping, mCacheDir, mOverrideExtension);"> 168         mMediaSource = mExoHelper.getMediaSource(mDataSource, isPreview, isCache, isLooping, mCacheDir, müîµ</abbr>
 169     }
 170 
 171     @Override
 172     public void setDataSource(FileDescriptor fd) {
 173         throw new UnsupportedOperationException(&quot;no support&quot;);
 174     }
 175 
 176     @Override
 177     public String getDataSource() {
 178         return mDataSource;
 179     }
 180 
 181     @Override
 182     public void prepareAsync() throws IllegalStateException {
 183         if (mInternalPlayer != null)
 184             throw new IllegalStateException(&quot;can&#x27;t prepare a prepared player&quot;);
 185         prepareAsyncInternal();
 186     }
 187 
 188     @Override
 189     public void start() throws IllegalStateException {
 190         if (mInternalPlayer == null)
 191             return;
 192         mInternalPlayer.setPlayWhenReady(true);
 193     }
 194 
 195     @Override
 196     public void stop() throws IllegalStateException {
 197         if (mInternalPlayer == null)
 198             return;
 199         mInternalPlayer.release();
 200     }
 201 
 202     @Override
 203     public void pause() throws IllegalStateException {
 204         if (mInternalPlayer == null)
 205             return;
 206         mInternalPlayer.setPlayWhenReady(false);
 207     }
 208 
 209     @Override
 210     public void setWakeMode(Context context, int mode) {
 211         // FIXME: implement
 212     }
 213 
 214     @Override
 215     public void setScreenOnWhilePlaying(boolean screenOn) {
 216         // TODO: do nothing
 217     }
 218 
 219     @Override
 220     public IjkTrackInfo[] getTrackInfo() {
 221         // TODO: implement
 222         return null;
 223     }
 224 
 225     @Override
 226     public int getVideoWidth() {
 227         return mVideoWidth;
 228     }
 229 
 230     @Override
 231     public int getVideoHeight() {
 232         return mVideoHeight;
 233     }
 234 
 235     @Override
 236     public boolean isPlaying() {
 237         if (mInternalPlayer == null)
 238             return false;
 239         int state = mInternalPlayer.getPlaybackState();
 240         switch (state) {
 241             case Player.STATE_BUFFERING:
 242             case Player.STATE_READY:
 243                 return mInternalPlayer.getPlayWhenReady();
 244             case Player.STATE_IDLE:
 245             case Player.STATE_ENDED:
 246             default:
 247                 return false;
 248         }
 249     }
 250 
 251     @Override
 252     public void seekTo(long msec) throws IllegalStateException {
 253         if (mInternalPlayer == null)
 254             return;
 255         mInternalPlayer.seekTo(msec);
 256     }
 257 
 258     @Override
 259     public long getCurrentPosition() {
 260         if (mInternalPlayer == null)
 261             return 0;
 262         return mInternalPlayer.getCurrentPosition();
 263     }
 264 
 265     @Override
 266     public long getDuration() {
 267         if (mInternalPlayer == null)
 268             return 0;
 269         return mInternalPlayer.getDuration();
 270     }
 271 
 272     @Override
 273     public int getVideoSarNum() {
 274         return 1;
 275     }
 276 
 277     @Override
 278     public int getVideoSarDen() {
 279         return 1;
 280     }
 281 
 282     @Override
 283     public void reset() {
 284         if (mInternalPlayer != null) {
 285             mInternalPlayer.release();
 286             mInternalPlayer = null;
 287         }
 288         if (mExoHelper != null) {
 289             mExoHelper.release();
 290         }
 291         mSurface = null;
 292         mDataSource = null;
 293         mVideoWidth = 0;
 294         mVideoHeight = 0;
 295     }
 296 
 297     @Override
 298     public void onCues(List&lt;Cue&gt; cues) {
 299 
 300     }
 301 
 302     @Override
 303     public void onMetadata(Metadata metadata) {
 304 
 305     }
 306 
 307     @Override
 308     public void setLooping(boolean looping) {
 309         isLooping = looping;
 310     }
 311 
 312     @Override
 313     public boolean isLooping() {
 314         return isLooping;
 315     }
 316 
 317     @Override
 318     public void setVolume(float leftVolume, float rightVolume) {
 319         if (mInternalPlayer != null)
 320             mInternalPlayer.setVolume((leftVolume + rightVolume) / 2);
 321     }
 322 
 323     @Override
 324     public int getAudioSessionId() {
 325         return audioSessionId;
 326     }
 327 
 328     @Override
 329     public MediaInfo getMediaInfo() {
 330         return null;
 331     }
 332 
 333     @Override
 334     public void setLogEnabled(boolean enable) {
 335         // do nothing
 336     }
 337 
 338     @Override
 339     public boolean isPlayable() {
 340         return true;
 341     }
 342 
 343     @Override
 344     public void setAudioStreamType(int streamType) {
 345         // do nothing
 346     }
 347 
 348     @Override
 349     public void setKeepInBackground(boolean keepInBackground) {
 350         // do nothing
 351     }
 352 
 353     @Override
 354     public void release() {
 355         if (mInternalPlayer != null) {
 356             reset();
 357             mEventLogger = null;
 358         }
 359     }
 360 
 361     protected void prepareAsyncInternal() {
 362         new Handler(Looper.myLooper()).post(
 363 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 364                 () -&gt; {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 365                     if (mTrackSelector == null) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 366                         mTrackSelector = new DefaultTrackSelector(mAppContext);</span>
 367 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 368 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 369     protected void prepareAsyncInternal() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 370         new Handler(Looper.myLooper()).post(</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 371                 new Runnable() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 372                     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 373                     public void run() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 374                         if (mTrackSelector == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 375                             mTrackSelector = new DefaultTrackSelector(mAppContext);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 376                         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 377                         mEventLogger = new EventLogger(mTrackSelector);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 378                         boolean preferExtensionDecoders = true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 379                         boolean useExtensionRenderers = true;//ÊòØÂê¶ÂºÄÂêØÊâ©Â±ï</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 380                         @DefaultRenderersFactory.ExtensionRendererMode int extensionRendererMode = useExtensionRenderers"> 380                         @DefaultRenderersFactory.ExtensionRendererMode int extensionRendererMode = useExtüîµ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 381                                 ? (preferExtensionDecoders ? DefaultRenderersFactory.EXTENSION_RENDERER_MODE_PREFER"> 381                                 ? (preferExtensionDecoders ? DefaultRenderersFactory.EXTENSION_RENDERER_Müîµ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 382                                 : DefaultRenderersFactory.EXTENSION_RENDERER_MODE_ON)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 383                                 : DefaultRenderersFactory.EXTENSION_RENDERER_MODE_OFF;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 384                         if (mRendererFactory == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 385                             mRendererFactory = new DefaultRenderersFactory(mAppContext);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 386                             mRendererFactory.setExtensionRendererMode(extensionRendererMode);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 387                         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 388                         if (mLoadControl == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 389                             mLoadControl = new DefaultLoadControl();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 390                         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 391                         mInternalPlayer = new SimpleExoPlayer.Builder(mAppContext, mRendererFactory)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 392                                 .setLooper(Looper.myLooper())</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 393                                 .setTrackSelector(mTrackSelector)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 394                                 .setLoadControl(mLoadControl).build();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 395                         mInternalPlayer.addListener(IjkExo2MediaPlayer.this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 396                         mInternalPlayer.addAnalyticsListener(IjkExo2MediaPlayer.this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 397                         mInternalPlayer.addListener(mEventLogger);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 398                         if (mSpeedPlaybackParameters != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 399                             mInternalPlayer.setPlaybackParameters(mSpeedPlaybackParameters);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 400                         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 401                         if (mSurface != null)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 402                             mInternalPlayer.setVideoSurface(mSurface);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 403                         mInternalPlayer.setMediaSource(mMediaSource);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 404                         mInternalPlayer.prepare();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 405                         mInternalPlayer.setPlayWhenReady(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 406                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 407                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 408         );</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 409     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 410 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 411     public String getOverrideExtension() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 412         return mOverrideExtension;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 413     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 414 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 415     public void setOverrideExtension(String overrideExtension) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 416         this.mOverrideExtension = overrideExtension;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 417     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 418 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 419     public void stopPlayback() {</span>
 420 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 421                 new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 422                     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 423                     public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 424                         if (mTrackSelector == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 425                             mTrackSelector = new DefaultTrackSelector(mAppContext);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 426                         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 427                         mEventLogger = new EventLogger(mTrackSelector);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 428                         boolean preferExtensionDecoders = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 429                         boolean useExtensionRenderers = true;//ÊòØÂê¶ÂºÄÂêØÊâ©Â±ï</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 430                         @DefaultRenderersFactory.ExtensionRendererMode int extensionRendererMode = useExtensionRenderers"> 430                         @DefaultRenderersFactory.ExtensionRendererMode int extensionRendererMode = useExtüîµ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 431                                 ? (preferExtensionDecoders ? DefaultRenderersFactory.EXTENSION_RENDERER_MODE_PREFER"> 431                                 ? (preferExtensionDecoders ? DefaultRenderersFactory.EXTENSION_RENDERER_Müîµ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 432                                 : DefaultRenderersFactory.EXTENSION_RENDERER_MODE_ON)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 433                                 : DefaultRenderersFactory.EXTENSION_RENDERER_MODE_OFF;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 434                         if (mRendererFactory == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 435                             mRendererFactory = new DefaultRenderersFactory(mAppContext);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 436                             mRendererFactory.setExtensionRendererMode(extensionRendererMode);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 437                         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 438                         if (mLoadControl == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 439                             mLoadControl = new DefaultLoadControl();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 440                         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 441                         mInternalPlayer = new SimpleExoPlayer.Builder(mAppContext, mRendererFactory)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 442                                 .setLooper(Looper.myLooper())</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 443                                 .setTrackSelector(mTrackSelector)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 444                                 .setLoadControl(mLoadControl).build();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 445                         mInternalPlayer.addListener(IjkExo2MediaPlayer.this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 446                         mInternalPlayer.addAnalyticsListener(IjkExo2MediaPlayer.this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 447                         mInternalPlayer.addListener(mEventLogger);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 448                         if (mSpeedPlaybackParameters != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 449                             mInternalPlayer.setPlaybackParameters(mSpeedPlaybackParameters);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 450                         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 451                         if (isLooping) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 452                             mInternalPlayer.setRepeatMode(REPEAT_MODE_ALL);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 453                         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 454                         if (mSurface != null)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 455                             mInternalPlayer.setVideoSurface(mSurface);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 456                         mInternalPlayer.setMediaSource(mMediaSource);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 457                         mInternalPlayer.prepare();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 458                         mInternalPlayer.setPlayWhenReady(false);</span>
 459 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 460                     }
 461                     mEventLogger = new EventLogger(mTrackSelector);
 462                     boolean preferExtensionDecoders = true;
 463                     boolean useExtensionRenderers = true;//ÊòØÂê¶ÂºÄÂêØÊâ©Â±ï
<abbr title=" 464                     @DefaultRenderersFactory.ExtensionRendererMode int extensionRendererMode = useExtensionRenderers"> 464                     @DefaultRenderersFactory.ExtensionRendererMode int extensionRendererMode = useExtensiüîµ</abbr>
<abbr title=" 465                             ? (preferExtensionDecoders ? DefaultRenderersFactory.EXTENSION_RENDERER_MODE_PREFER"> 465                             ? (preferExtensionDecoders ? DefaultRenderersFactory.EXTENSION_RENDERER_MODE_üîµ</abbr>
 466                             : DefaultRenderersFactory.EXTENSION_RENDERER_MODE_ON)
 467                             : DefaultRenderersFactory.EXTENSION_RENDERER_MODE_OFF;
 468                     if (mRendererFactory == null) {
 469                         mRendererFactory = new DefaultRenderersFactory(mAppContext);
 470                         mRendererFactory.setExtensionRendererMode(extensionRendererMode);
 471                     }
 472                     if (mLoadControl == null) {
 473                         mLoadControl = new DefaultLoadControl();
 474                     }
 475                     mInternalPlayer = new SimpleExoPlayer.Builder(mAppContext, mRendererFactory)
 476                             .setLooper(Looper.myLooper())
 477                             .setTrackSelector(mTrackSelector)
 478                             .setLoadControl(mLoadControl).build();
 479                     mInternalPlayer.addListener(IjkExo2MediaPlayer.this);
 480                     mInternalPlayer.addAnalyticsListener(IjkExo2MediaPlayer.this);
 481                     mInternalPlayer.addListener(mEventLogger);
 482                     if (mSpeedPlaybackParameters != null) {
 483                         mInternalPlayer.setPlaybackParameters(mSpeedPlaybackParameters);
 484                     }
 485                     if (mSurface != null)
 486                         mInternalPlayer.setVideoSurface(mSurface);
 487                     mInternalPlayer.setMediaSource(mMediaSource);
 488                     mInternalPlayer.prepare();
 489                     mInternalPlayer.setPlayWhenReady(false);
 490                 }
 491         );
 492     }
 493 
 494     public String getOverrideExtension() {
 495         return mOverrideExtension;
 496     }
 497 
 498     public void setOverrideExtension(String overrideExtension) {
 499         this.mOverrideExtension = overrideExtension;
 500     }
 501 
 502     public void stopPlayback() {
 503         mInternalPlayer.stop();
 504     }
 505 
 506     /**
 507      * ÊòØÂê¶ÈúÄË¶ÅÂ∏¶‰∏äheader
 508      * setDataSource‰πãÂâçÁîüÊïà
 509      */
 510     public void setPreview(boolean preview) {
 511         isPreview = preview;
 512     }
 513 
 514     public boolean isPreview() {
 515         return isPreview;
 516     }
 517 
 518     public boolean isCache() {
 519         return isCache;
 520     }
 521 
 522 
 523     /**
 524      * ËÆæÁΩÆseek ÁöÑ‰∏¥ËøëÂ∏ß„ÄÇ
 525      **/
 526     public void setSeekParameter(@Nullable SeekParameters seekParameters) {
 527         mInternalPlayer.setSeekParameters(seekParameters);
 528     }
 529 
 530 
 531     /**
 532      * ÊòØÂê¶ÂºÄÂêØcache
 533      * setDataSource‰πãÂâçÁîüÊïà
 534      */
 535     public void setCache(boolean cache) {
 536         isCache = cache;
 537     }
 538 
 539     public File getCacheDir() {
 540         return mCacheDir;
 541     }
 542 
 543     /**
 544      * cacheÊñá‰ª∂ÁöÑÁõÆÂΩï
 545      * setDataSource‰πãÂâçÁîüÊïà
 546      */
 547     public void setCacheDir(File cacheDir) {
 548         this.mCacheDir = cacheDir;
 549     }
 550 
 551     public MediaSource getMediaSource() {
 552         return mMediaSource;
 553     }
 554 
 555     public void setMediaSource(MediaSource mediaSource) {
 556         this.mMediaSource = mediaSource;
 557     }
 558 
 559     public ExoSourceManager getExoHelper() {
 560         return mExoHelper;
 561     }
 562 
 563     /**
 564      * ÂÄçÈÄüÊí≠Êîæ
 565      *
 566      * @param speed ÂÄçÈÄüÊí≠ÊîæÔºåÈªòËÆ§‰∏∫1
 567      * @param pitch Èü≥ÈáèÁº©ÊîæÔºåÈªòËÆ§‰∏∫1Ôºå‰øÆÊîπ‰ºöÂØºËá¥Â£∞Èü≥ÂèòË∞É
 568      */
 569     public void setSpeed(@Size(min = 0) float speed, @Size(min = 0) float pitch) {
 570         PlaybackParameters playbackParameters = new PlaybackParameters(speed, pitch);
 571         mSpeedPlaybackParameters = playbackParameters;
 572         if (mInternalPlayer != null) {
 573             mInternalPlayer.setPlaybackParameters(playbackParameters);
 574         }
 575     }
 576 
 577     public float getSpeed() {
 578         return mInternalPlayer.getPlaybackParameters().speed;
 579     }
 580 
 581     public int getBufferedPercentage() {
 582         if (mInternalPlayer == null)
 583             return 0;
 584 
 585         return mInternalPlayer.getBufferedPercentage();
 586     }
 587 
 588     public MappingTrackSelector getTrackSelector() {
 589         return mTrackSelector;
 590     }
 591 
 592     public void setTrackSelector(MappingTrackSelector trackSelector) {
 593         this.mTrackSelector = trackSelector;
 594     }
 595 
 596     public LoadControl getLoadControl() {
 597         return mLoadControl;
 598     }
 599 
 600     public void setLoadControl(LoadControl loadControl) {
 601         this.mLoadControl = loadControl;
 602     }
 603 
 604     public DefaultRenderersFactory getRendererFactory() {
 605         return mRendererFactory;
 606     }
 607 
 608     public void setRendererFactory(DefaultRenderersFactory rendererFactory) {
 609         this.mRendererFactory = rendererFactory;
 610     }
 611 
 612     @Override
<abbr title=" 613     public void onTracksChanged(@NonNull TrackGroupArray trackGroups, @NonNull TrackSelectionArray trackSelections) {"> 613     public void onTracksChanged(@NonNull TrackGroupArray trackGroups, @NonNull TrackSelectionArray trackSüîµ</abbr>
 614     }
 615 
 616     @Override
 617 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 618     public void onPlayerStateChanged(boolean playWhenReady, @Player.State int playbackState) {</span>
 619 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 620 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 621     public void setLoadControl(LoadControl loadControl) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 622         this.mLoadControl = loadControl;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 623     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 624 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 625     public DefaultRenderersFactory getRendererFactory() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 626         return mRendererFactory;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 627     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 628 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 629     public void setRendererFactory(DefaultRenderersFactory rendererFactory) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 630         this.mRendererFactory = rendererFactory;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 631     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 632 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 633     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 634     public void onTracksChanged(TrackGroupArray trackGroups, TrackSelectionArray trackSelections) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 635 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 636     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 637 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 638     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 639     public void onLoadingChanged(boolean isLoading) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 640 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 641     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 642 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 643     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 644     public void onPlayerStateChanged(boolean playWhenReady, int playbackState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 645         //ÈáçÊñ∞Êí≠ÊîæÁä∂ÊÄÅÈ°∫Â∫è‰∏∫ÔºöSTATE_IDLE -„ÄãSTATE_BUFFERING -„ÄãSTATE_READY</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 646         //ÁºìÂÜ≤Êó∂È°∫Â∫è‰∏∫ÔºöSTATE_BUFFERING -„ÄãSTATE_READY</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 647         //Log.e(TAG, &quot;onPlayerStateChanged: playWhenReady = &quot; + playWhenReady + &quot;, playbackState = &quot; + playbackState);"> 647         //Log.e(TAG, &quot;onPlayerStateChanged: playWhenReady = &quot; + playWhenReady + &quot;, playbackState = &quot; + plüîµ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 648         if (isLastReportedPlayWhenReady != playWhenReady || lastReportedPlaybackState != playbackState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 649             int buffer = 0;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 650             if(mInternalPlayer != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 651                 buffer =  mInternalPlayer.getBufferedPercentage();</span>
 652 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 653     public void onIsLoadingChanged(boolean isLoading) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 654 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 655     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 656 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 657     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 658     public void onPlaybackStateChanged(int state) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 659         onPlayWhenReadyChanged(isLastReportedPlayWhenReady, state);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 660     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 661 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 662     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 663     public void onPlayWhenReadyChanged(boolean playWhenReady, int playbackState) {</span>
 664 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 665         //ÈáçÊñ∞Êí≠ÊîæÁä∂ÊÄÅÈ°∫Â∫è‰∏∫ÔºöSTATE_IDLE -„ÄãSTATE_BUFFERING -„ÄãSTATE_READY
 666         //ÁºìÂÜ≤Êó∂È°∫Â∫è‰∏∫ÔºöSTATE_BUFFERING -„ÄãSTATE_READY
<abbr title=" 667         //Log.e(TAG, &quot;onPlayerStateChanged: playWhenReady = &quot; + playWhenReady + &quot;, playbackState = &quot; + playbackState);"> 667         //Log.e(TAG, &quot;onPlayerStateChanged: playWhenReady = &quot; + playWhenReady + &quot;, playbackState = &quot; + plüîµ</abbr>
 668         if (isLastReportedPlayWhenReady != playWhenReady || lastReportedPlaybackState != playbackState) {
 669             int buffer = 0;
 670             if (mInternalPlayer != null) {
 671                 buffer = mInternalPlayer.getBufferedPercentage();
 672             }
 673             if (isBuffering) {
 674                 switch (playbackState) {
 675                     case Player.STATE_ENDED:
 676                     case Player.STATE_READY:
 677                         notifyOnInfo(IMediaPlayer.MEDIA_INFO_BUFFERING_END, buffer);
 678                         isBuffering = false;
 679                         break;
 680                 }
 681             }
 682 
 683             if (isPreparing) {
 684                 if (playbackState == Player.STATE_READY) {
 685                     notifyOnPrepared();
 686                     isPreparing = false;
 687                 }
 688             }
 689 
 690             switch (playbackState) {
 691                 case Player.STATE_BUFFERING:
 692                     notifyOnInfo(IMediaPlayer.MEDIA_INFO_BUFFERING_START, buffer);
 693                     isBuffering = true;
 694                     break;
 695                 case Player.STATE_ENDED:
 696                     notifyOnCompletion();
 697                     break;
 698                 default:
 699                     break;
 700             }
 701         }
 702         isLastReportedPlayWhenReady = playWhenReady;
 703         lastReportedPlaybackState = playbackState;
 704     }
 705 
 706     @Override
 707     public void onRepeatModeChanged(int repeatMode) {
 708     }
 709 
 710     @Override
 711     public void onShuffleModeEnabledChanged(boolean shuffleModeEnabled) {
 712     }
 713 
 714     @Override
 715     public void onPlayerError(@NonNull ExoPlaybackException error) {
 716         notifyOnError(IMediaPlayer.MEDIA_ERROR_UNKNOWN, IMediaPlayer.MEDIA_ERROR_UNKNOWN);
 717     }
 718 
 719     @Override
 720 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 721     public void onPlaybackParametersChanged(@NonNull PlaybackParameters playbackParameters) {</span>
 722 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 723                     break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 724                 case Player.STATE_READY:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 725                     break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 726                 case Player.STATE_ENDED:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 727                     notifyOnCompletion();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 728                     break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 729                 default:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 730                     break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 731             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 732         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 733         isLastReportedPlayWhenReady = playWhenReady;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 734         lastReportedPlaybackState = playbackState;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 735     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 736 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 737     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 738     public void onRepeatModeChanged(int repeatMode) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 739 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 740     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 741 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 742     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 743     public void onShuffleModeEnabledChanged(boolean shuffleModeEnabled) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 744 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 745     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 746 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 747     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 748     public void onPlayerError(ExoPlaybackException error) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 749         notifyOnError(IMediaPlayer.MEDIA_ERROR_UNKNOWN, IMediaPlayer.MEDIA_ERROR_UNKNOWN);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 750     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 751 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 752     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 753     public void onPositionDiscontinuity(int reason) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 754 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 755     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 756 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 757     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 758     public void onPlaybackParametersChanged(PlaybackParameters playbackParameters) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 759 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 760     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 761 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 762     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 763     public void onSeekProcessed() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 764         notifyOnSeekComplete();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 765     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 766 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 767     /////////////////////////////////////AudioRendererEventListener/////////////////////////////////////////////"> 767     /////////////////////////////////////AudioRendererEventListener//////////////////////////////////////üîµ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 768 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 769 </span>
 770 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 771     public void onPositionDiscontinuity(Player.PositionInfo oldPosition, Player.PositionInfo newPosition, int reason) {"> 771     public void onPositionDiscontinuity(Player.PositionInfo oldPosition, Player.PositionInfo newPosition,üîµ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 772         notifyOnInfo(ON_POSITION_DISCOUNTINUITY, reason);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 773         if (reason == DISCONTINUITY_REASON_SEEK) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 774             notifyOnSeekComplete();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 775         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 776     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 777 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 778     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 779     public void onPlaybackParametersChanged(PlaybackParameters playbackParameters) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 780 </span>
 781 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 782     }
 783 
<abbr title=" 784     /////////////////////////////////////AudioRendererEventListener/////////////////////////////////////////////"> 784     /////////////////////////////////////AudioRendererEventListener//////////////////////////////////////üîµ</abbr>
 785 
 786     @Override
 787 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 788     public void onTimelineChanged(@NonNull EventTime eventTime, int reason) {</span>
 789 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 790         lastReportedPlaybackState = playbackState;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 791     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 792 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 793     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 794     public void onRepeatModeChanged(int repeatMode) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 795 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 796     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 797 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 798     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 799     public void onShuffleModeEnabledChanged(boolean shuffleModeEnabled) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 800 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 801     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 802 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 803     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 804     public void onPlayerError(ExoPlaybackException error) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 805         notifyOnError(IMediaPlayer.MEDIA_ERROR_UNKNOWN, IMediaPlayer.MEDIA_ERROR_UNKNOWN);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 806     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 807 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 808     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 809     public void onPositionDiscontinuity(int reason) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 810 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 811     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 812 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 813     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 814     public void onPlaybackParametersChanged(PlaybackParameters playbackParameters) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 815 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 816     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 817 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 818     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 819     public void onSeekProcessed() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 820         notifyOnSeekComplete();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 821     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 822 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 823     /////////////////////////////////////AudioRendererEventListener/////////////////////////////////////////////"> 823     /////////////////////////////////////AudioRendererEventListener//////////////////////////////////////üîµ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 824 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 825 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 826     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 827     public void onPlayerStateChanged(EventTime eventTime, boolean playWhenReady, int playbackState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 828 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 829     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 830 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 831     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 832     public void onTimelineChanged(EventTime eventTime, int reason) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 833 </span>
 834 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 835     public void onPlayWhenReadyChanged(EventTime eventTime, boolean playWhenReady, int playbackState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 836 </span>
 837 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 838     }
 839 
 840     @Override
 841 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 842     public void onPositionDiscontinuity(</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 843             @NonNull EventTime eventTime,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 844             @NonNull Player.PositionInfo oldPosition,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 845             @NonNull Player.PositionInfo newPosition,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 846             @Player.DiscontinuityReason int reason</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 847     ) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 848         notifyOnInfo(ON_POSITION_DISCOUNTINUITY, reason);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 849     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 850 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 851     @Override</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 852     public void onPlaybackParametersChanged(@NonNull EventTime eventTime, @NonNull PlaybackParameters playbackParameters) {"> 852     public void onPlaybackParametersChanged(@NonNull EventTime eventTime, @NonNull PlaybackParameters plaüîµ</abbr></span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 853     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 854 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 855     @Override</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 856     public void onRepeatModeChanged(@NonNull EventTime eventTime, int repeatMode) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 857     }</span>
 858 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 859     public void onRepeatModeChanged(int repeatMode) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 860 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 861     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 862 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 863     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 864     public void onShuffleModeEnabledChanged(boolean shuffleModeEnabled) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 865 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 866     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 867 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 868     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 869     public void onPlayerError(ExoPlaybackException error) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 870         notifyOnError(IMediaPlayer.MEDIA_ERROR_UNKNOWN, IMediaPlayer.MEDIA_ERROR_UNKNOWN);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 871     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 872 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 873     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 874     public void onPositionDiscontinuity(int reason) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 875 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 876     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 877 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 878     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 879     public void onPlaybackParametersChanged(PlaybackParameters playbackParameters) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 880 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 881     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 882 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 883     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 884     public void onSeekProcessed() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 885         notifyOnSeekComplete();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 886     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 887 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 888     /////////////////////////////////////AudioRendererEventListener/////////////////////////////////////////////"> 888     /////////////////////////////////////AudioRendererEventListener//////////////////////////////////////üîµ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 889 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 890 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 891     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 892     public void onPlayerStateChanged(EventTime eventTime, boolean playWhenReady, int playbackState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 893 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 894     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 895 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 896     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 897     public void onTimelineChanged(EventTime eventTime, int reason) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 898 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 899     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 900 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 901     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 902     public void onPositionDiscontinuity(EventTime eventTime, int reason) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 903         notifyOnInfo(ON_POSITION_DISCOUNTINUITY, reason);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 904     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 905 </span>
 906 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 907     public void onTimelineChanged(EventTime eventTime, int reason) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 908 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 909     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 910 </span>
 911 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 912 
 913     @Override
 914     public void onShuffleModeChanged(@NonNull EventTime eventTime, boolean shuffleModeEnabled) {
 915     }
 916 
 917     @Override
 918     public void onPlayerError(@NonNull EventTime eventTime, @NonNull ExoPlaybackException error) {
 919     }
 920 
 921     @Override
<abbr title=" 922     public void onTracksChanged(@NonNull EventTime eventTime, @NonNull TrackGroupArray trackGroups, @NonNull TrackSelectionArray trackSelections) {"> 922     public void onTracksChanged(@NonNull EventTime eventTime, @NonNull TrackGroupArray trackGroups, @NonNüîµ</abbr>
 923     }
 924 
 925     @Override
 926 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 927     public void onBandwidthEstimate(@NonNull EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaded, long bitrateEstimate) {"> 927     public void onBandwidthEstimate(@NonNull EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaüîµ</abbr></span>
 928 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 929 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 930 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 931     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 932     public void onPlayerStateChanged(EventTime eventTime, boolean playWhenReady, int playbackState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 933 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 934     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 935 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 936     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 937     public void onTimelineChanged(EventTime eventTime, int reason) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 938 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 939     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 940 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 941     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 942     public void onPositionDiscontinuity(EventTime eventTime, int reason) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 943         notifyOnInfo(ON_POSITION_DISCOUNTINUITY, reason);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 944     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 945 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 946     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 947     public void onSeekStarted(EventTime eventTime) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 948 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 949     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 950 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 951     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 952     public void onSeekProcessed(EventTime eventTime) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 953 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 954     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 955 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 956     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 957     public void onPlaybackParametersChanged(EventTime eventTime, PlaybackParameters playbackParameters) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 958 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 959     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 960 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 961     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 962     public void onRepeatModeChanged(EventTime eventTime, int repeatMode) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 963 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 964     }</span>
 965 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 966     public void onIsLoadingChanged(EventTime eventTime, boolean isLoading) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 967 </span>
 968 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 969     }
 970 
 971     @Override
 972     public void onMetadata(@NonNull EventTime eventTime, @NonNull Metadata metadata) {
 973     }
 974 
 975     @Override
 976 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 977     public void onDecoderDisabled(@NonNull EventTime eventTime, int trackType, @NonNull DecoderCounters decoderCounters) {"> 977     public void onDecoderDisabled(@NonNull EventTime eventTime, int trackType, @NonNull DecoderCounters düîµ</abbr></span>
 978 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 979     public void onTimelineChanged(EventTime eventTime, int reason) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 980 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 981     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 982 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 983     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 984     public void onPositionDiscontinuity(EventTime eventTime, int reason) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 985         notifyOnInfo(ON_POSITION_DISCOUNTINUITY, reason);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 986     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 987 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 988     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 989     public void onSeekStarted(EventTime eventTime) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 990 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 991     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 992 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 993     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 994     public void onSeekProcessed(EventTime eventTime) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 995 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 996     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 997 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 998     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 999     public void onPlaybackParametersChanged(EventTime eventTime, PlaybackParameters playbackParameters) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1000 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1001     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1002 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1003     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1004     public void onRepeatModeChanged(EventTime eventTime, int repeatMode) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1005 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1006     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1007 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1008     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1009     public void onShuffleModeChanged(EventTime eventTime, boolean shuffleModeEnabled) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1010 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1011     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1012 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1013     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1014     public void onLoadingChanged(EventTime eventTime, boolean isLoading) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1015 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1016     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1017 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1018     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1019     public void onPlayerError(EventTime eventTime, ExoPlaybackException error) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1020 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1021     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1022 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1023     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="1024     public void onTracksChanged(EventTime eventTime, TrackGroupArray trackGroups, TrackSelectionArray trackSelections) {">1024     public void onTracksChanged(EventTime eventTime, TrackGroupArray trackGroups, TrackSelectionArray traüîµ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1025 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1026     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1027 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1028     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="1029     public void onBandwidthEstimate(EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaded, long bitrateEstimate) {">1029     public void onBandwidthEstimate(EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaded, longüîµ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1030 </span>
1031 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="1032     public void onTracksChanged(EventTime eventTime, TrackGroupArray trackGroups, TrackSelectionArray trackSelections) {">1032     public void onTracksChanged(EventTime eventTime, TrackGroupArray trackGroups, TrackSelectionArray traüîµ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1033 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1034     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1035 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1036     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="1037     public void onBandwidthEstimate(EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaded, long bitrateEstimate) {">1037     public void onBandwidthEstimate(EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaded, longüîµ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1038 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1039     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1040 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1041     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1042     public void onMetadata(EventTime eventTime, Metadata metadata) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1043 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1044     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1045 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1046     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1047     public void onAudioDisabled(EventTime eventTime, DecoderCounters counters) {</span>
1048 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
1049         audioSessionId = C.AUDIO_SESSION_ID_UNSET;
1050     }
1051 
1052     @Override
<abbr title="1053     public void onAudioUnderrun(@NonNull EventTime eventTime, int bufferSize, long bufferSizeMs, long elapsedSinceLastFeedMs) {">1053     public void onAudioUnderrun(@NonNull EventTime eventTime, int bufferSize, long bufferSizeMs, long elaüîµ</abbr>
1054     }
1055 
1056     @Override
1057     public void onDroppedVideoFrames(@NonNull EventTime eventTime, int droppedFrames, long elapsedMs) {
1058     }
1059 
1060     @Override
1061 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1062     public void onVideoSizeChanged(@NonNull EventTime eventTime, @NonNull VideoSize videoSize) {</span>
1063 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1064 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1065     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1066     public void onSeekProcessed(EventTime eventTime) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1067 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1068     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1069 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1070     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1071     public void onPlaybackParametersChanged(EventTime eventTime, PlaybackParameters playbackParameters) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1072 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1073     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1074 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1075     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1076     public void onRepeatModeChanged(EventTime eventTime, int repeatMode) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1077 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1078     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1079 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1080     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1081     public void onShuffleModeChanged(EventTime eventTime, boolean shuffleModeEnabled) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1082 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1083     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1084 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1085     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1086     public void onLoadingChanged(EventTime eventTime, boolean isLoading) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1087 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1088     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1089 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1090     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1091     public void onPlayerError(EventTime eventTime, ExoPlaybackException error) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1092 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1093     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1094 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1095     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="1096     public void onTracksChanged(EventTime eventTime, TrackGroupArray trackGroups, TrackSelectionArray trackSelections) {">1096     public void onTracksChanged(EventTime eventTime, TrackGroupArray trackGroups, TrackSelectionArray traüîµ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1097 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1098     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1099 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1100     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="1101     public void onBandwidthEstimate(EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaded, long bitrateEstimate) {">1101     public void onBandwidthEstimate(EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaded, longüîµ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1102 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1103     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1104 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1105     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1106     public void onMetadata(EventTime eventTime, Metadata metadata) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1107 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1108     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1109 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1110     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1111     public void onDecoderEnabled(EventTime eventTime, int trackType, DecoderCounters decoderCounters) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1112 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1113     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1114 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1115     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="1116     public void onDecoderInitialized(EventTime eventTime, int trackType, String decoderName, long initializationDurationMs) {">1116     public void onDecoderInitialized(EventTime eventTime, int trackType, String decoderName, long initialüîµ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1117 </span>
1118 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1119     public void onVideoSizeChanged(EventTime eventTime, VideoSize videoSize) {</span>
1120 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
1121         mVideoWidth = (int) (videoSize.width * videoSize.pixelWidthHeightRatio);
1122         mVideoHeight = videoSize.height;
<abbr title="1123         notifyOnVideoSizeChanged((int) (videoSize.width * videoSize.pixelWidthHeightRatio), videoSize.height, 1, 1);">1123         notifyOnVideoSizeChanged((int) (videoSize.width * videoSize.pixelWidthHeightRatio), videoSize.heiüîµ</abbr>
1124         if (videoSize.unappliedRotationDegrees &gt; 0)
<abbr title="1125             notifyOnInfo(IMediaPlayer.MEDIA_INFO_VIDEO_ROTATION_CHANGED, videoSize.unappliedRotationDegrees);">1125             notifyOnInfo(IMediaPlayer.MEDIA_INFO_VIDEO_ROTATION_CHANGED, videoSize.unappliedRotationDegreüîµ</abbr>
1126     }
1127 
1128 
1129     @Override
1130 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title="1131     public void onRenderedFirstFrame(@NonNull EventTime eventTime, @NonNull Object output, long renderTimeMs) {">1131     public void onRenderedFirstFrame(@NonNull EventTime eventTime, @NonNull Object output, long renderTimüîµ</abbr></span>
1132 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1133     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1134 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1135     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1136     public void onRepeatModeChanged(EventTime eventTime, int repeatMode) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1137 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1138     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1139 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1140     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1141     public void onShuffleModeChanged(EventTime eventTime, boolean shuffleModeEnabled) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1142 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1143     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1144 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1145     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1146     public void onLoadingChanged(EventTime eventTime, boolean isLoading) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1147 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1148     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1149 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1150     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1151     public void onPlayerError(EventTime eventTime, ExoPlaybackException error) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1152 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1153     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1154 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1155     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="1156     public void onTracksChanged(EventTime eventTime, TrackGroupArray trackGroups, TrackSelectionArray trackSelections) {">1156     public void onTracksChanged(EventTime eventTime, TrackGroupArray trackGroups, TrackSelectionArray traüîµ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1157 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1158     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1159 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1160     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="1161     public void onBandwidthEstimate(EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaded, long bitrateEstimate) {">1161     public void onBandwidthEstimate(EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaded, longüîµ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1162 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1163     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1164 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1165     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1166     public void onMetadata(EventTime eventTime, Metadata metadata) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1167 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1168     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1169 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1170     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1171     public void onDecoderEnabled(EventTime eventTime, int trackType, DecoderCounters decoderCounters) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1172 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1173     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1174 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1175     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="1176     public void onDecoderInitialized(EventTime eventTime, int trackType, String decoderName, long initializationDurationMs) {">1176     public void onDecoderInitialized(EventTime eventTime, int trackType, String decoderName, long initialüîµ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1177 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1178     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1179 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1180     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1181     public void onDecoderInputFormatChanged(EventTime eventTime, int trackType, Format format) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1182 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1183     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1184 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1185     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1186     public void onDecoderDisabled(EventTime eventTime, int trackType, DecoderCounters decoderCounters) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1187         audioSessionId = C.AUDIO_SESSION_ID_UNSET;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1188     }</span>
1189 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1190     public void onRenderedFirstFrame(EventTime eventTime, Object output, long renderTimeMs) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1191 </span>
1192 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
1193     }
1194 
1195     @Override
1196     public void onDrmKeysLoaded(@NonNull EventTime eventTime) {
1197     }
1198 
1199     @Override
1200     public void onDrmSessionManagerError(@NonNull EventTime eventTime, @NonNull Exception error) {
1201     }
1202 
1203     @Override
1204     public void onDrmKeysRestored(@NonNull EventTime eventTime) {
1205     }
1206 
1207     @Override
1208     public void onDrmKeysRemoved(@NonNull EventTime eventTime) {
1209     }
1210 }</pre></td>
                            <td><pre>   1 
   2 package tv.danmaku.ijk.media.exo2;
   3 
   4 import android.content.Context;
   5 import android.net.Uri;
   6 import android.os.Handler;
   7 import android.os.Looper;
   8 import androidx.annotation.Nullable;
   9 import androidx.annotation.Size;
  10 import android.view.Surface;
  11 import android.view.SurfaceHolder;
  12 
  13 import androidx.annotation.NonNull;
  14 
  15 import com.google.android.exoplayer2.C;
  16 import com.google.android.exoplayer2.DefaultLoadControl;
  17 import com.google.android.exoplayer2.DefaultRenderersFactory;
  18 import com.google.android.exoplayer2.ExoPlaybackException;
  19 import com.google.android.exoplayer2.LoadControl;
  20 import com.google.android.exoplayer2.PlaybackParameters;
  21 import com.google.android.exoplayer2.Player;
  22 import com.google.android.exoplayer2.SeekParameters;
  23 import com.google.android.exoplayer2.SimpleExoPlayer;
  24 import com.google.android.exoplayer2.analytics.AnalyticsListener;
  25 import com.google.android.exoplayer2.decoder.DecoderCounters;
  26 import com.google.android.exoplayer2.metadata.Metadata;
  27 import com.google.android.exoplayer2.source.MediaSource;
  28 import com.google.android.exoplayer2.source.TrackGroupArray;
  29 import com.google.android.exoplayer2.text.Cue;
  30 import com.google.android.exoplayer2.trackselection.DefaultTrackSelector;
  31 import com.google.android.exoplayer2.trackselection.MappingTrackSelector;
  32 import com.google.android.exoplayer2.trackselection.TrackSelectionArray;
  33 import com.google.android.exoplayer2.video.VideoSize;
  34 
  35 import java.io.File;
  36 import java.io.FileDescriptor;
  37 import java.util.HashMap;
  38 import java.util.List;
  39 import java.util.Map;
  40 
  41 import tv.danmaku.ijk.media.exo2.demo.EventLogger;
  42 import tv.danmaku.ijk.media.player.AbstractMediaPlayer;
  43 import tv.danmaku.ijk.media.player.IMediaPlayer;
  44 import tv.danmaku.ijk.media.player.MediaInfo;
  45 import tv.danmaku.ijk.media.player.misc.IjkTrackInfo;
  46 
  47 import static com.google.android.exoplayer2.Player.DISCONTINUITY_REASON_SEEK;
  48 import static com.google.android.exoplayer2.Player.REPEAT_MODE_ALL;
  49 
  50 
  51 /**
  52  * Created by guoshuyu on 2018/1/10.
  53  * Exo
  54  */
<abbr title="  55 public class IjkExo2MediaPlayer extends AbstractMediaPlayer implements Player.Listener, AnalyticsListener {">  55 public class IjkExo2MediaPlayer extends AbstractMediaPlayer implements Player.Listener, AnalyticsListenerüîµ</abbr>
  56 
  57     public static final int ON_POSITION_DISCOUNTINUITY = 2702;
  58 
  59     private static final String TAG = &quot;IjkExo2MediaPlayer&quot;;
  60 
  61     protected final Context mAppContext;
  62     protected SimpleExoPlayer mInternalPlayer;
  63     protected EventLogger mEventLogger;
  64     protected DefaultRenderersFactory mRendererFactory;
  65     protected MediaSource mMediaSource;
  66     protected MappingTrackSelector mTrackSelector;
  67     protected LoadControl mLoadControl;
  68     protected String mDataSource;
  69     protected Surface mSurface;
  70     protected Map&lt;String, String&gt; mHeaders = new HashMap&lt;&gt;();
  71     protected PlaybackParameters mSpeedPlaybackParameters;
  72     protected int mVideoWidth;
  73     protected int mVideoHeight;
  74     protected int lastReportedPlaybackState;
  75     protected boolean isLastReportedPlayWhenReady;
  76     protected boolean isPreparing = true;
  77     protected boolean isBuffering = false;
  78     protected boolean isLooping = false;
  79     /**
  80      * ÊòØÂê¶Â∏¶‰∏äheader
  81      */
  82     protected boolean isPreview = false;
  83     /**
  84      * ÊòØÂê¶ÂºÄÂêØÁºìÂ≠ò
  85      */
  86     protected boolean isCache = false;
  87     /**
  88      * dataSourceÁ≠âÁöÑÂ∏ÆÁªÑÁ±ª
  89      */
  90     protected final ExoSourceManager mExoHelper;
  91     /**
  92      * ÁºìÂ≠òÁõÆÂΩïÔºåÂèØ‰ª•‰∏∫Á©∫
  93      */
  94     protected File mCacheDir;
  95     /**
  96      * Á±ªÂûãË¶ÜÁõñ
  97      */
  98     private String mOverrideExtension;
  99 
 100     protected int audioSessionId = C.AUDIO_SESSION_ID_UNSET;
 101 
 102 
 103     public IjkExo2MediaPlayer(Context context) {
 104         mAppContext = context.getApplicationContext();
 105         lastReportedPlaybackState = Player.STATE_IDLE;
 106         mExoHelper = ExoSourceManager.newInstance(context, mHeaders);
 107     }
 108 
 109 
 110     private int getVideoRendererIndex() {
 111         if (mInternalPlayer != null) {
 112             for (int i = 0; i &lt; mInternalPlayer.getRendererCount(); i++) {
 113                 if (mInternalPlayer.getRendererType(i) == C.TRACK_TYPE_VIDEO) {
 114                     return i;
 115                 }
 116             }
 117         }
 118         return 0;
 119     }
 120 
 121     @Override
 122     public void setDisplay(SurfaceHolder sh) {
 123         if (sh == null)
 124             setSurface(null);
 125         else
 126             setSurface(sh.getSurface());
 127     }
 128 
 129     @Override
 130     public void setSurface(Surface surface) {
 131         mSurface = surface;
 132         if (mInternalPlayer != null) {
 133             if (surface != null &amp;&amp; !surface.isValid()) {
 134                 mSurface = null;
 135             }
 136             mInternalPlayer.setVideoSurface(surface);
 137         }
 138     }
 139 
 140 
 141     @Override
 142     public void setDataSource(Context context, Uri uri, Map&lt;String, String&gt; headers) {
 143         if (headers != null) {
 144             mHeaders.clear();
 145             mHeaders.putAll(headers);
 146         }
 147         setDataSource(context, uri);
 148     }
 149 
 150     @Override
 151     public void setDataSource(String path) {
 152         setDataSource(mAppContext, Uri.parse(path));
 153     }
 154 
 155     @Override
 156     public void setDataSource(Context context, Uri uri) {
 157         mDataSource = uri.toString();
<abbr title=" 158         mMediaSource = mExoHelper.getMediaSource(mDataSource, isPreview, isCache, isLooping, mCacheDir, mOverrideExtension);"> 158         mMediaSource = mExoHelper.getMediaSource(mDataSource, isPreview, isCache, isLooping, mCacheDir, müîµ</abbr>
 159     }
 160 
 161     @Override
 162     public void setDataSource(FileDescriptor fd) {
 163         throw new UnsupportedOperationException(&quot;no support&quot;);
 164     }
 165 
 166     @Override
 167     public String getDataSource() {
 168         return mDataSource;
 169     }
 170 
 171     @Override
 172     public void prepareAsync() throws IllegalStateException {
 173         if (mInternalPlayer != null)
 174             throw new IllegalStateException(&quot;can&#x27;t prepare a prepared player&quot;);
 175         prepareAsyncInternal();
 176     }
 177 
 178     @Override
 179     public void start() throws IllegalStateException {
 180         if (mInternalPlayer == null)
 181             return;
 182         mInternalPlayer.setPlayWhenReady(true);
 183     }
 184 
 185     @Override
 186     public void stop() throws IllegalStateException {
 187         if (mInternalPlayer == null)
 188             return;
 189         mInternalPlayer.release();
 190     }
 191 
 192     @Override
 193     public void pause() throws IllegalStateException {
 194         if (mInternalPlayer == null)
 195             return;
 196         mInternalPlayer.setPlayWhenReady(false);
 197     }
 198 
 199     @Override
 200     public void setWakeMode(Context context, int mode) {
 201         // FIXME: implement
 202     }
 203 
 204     @Override
 205     public void setScreenOnWhilePlaying(boolean screenOn) {
 206         // TODO: do nothing
 207     }
 208 
 209     @Override
 210     public IjkTrackInfo[] getTrackInfo() {
 211         // TODO: implement
 212         return null;
 213     }
 214 
 215     @Override
 216     public int getVideoWidth() {
 217         return mVideoWidth;
 218     }
 219 
 220     @Override
 221     public int getVideoHeight() {
 222         return mVideoHeight;
 223     }
 224 
 225     @Override
 226     public boolean isPlaying() {
 227         if (mInternalPlayer == null)
 228             return false;
 229         int state = mInternalPlayer.getPlaybackState();
 230         switch (state) {
 231             case Player.STATE_BUFFERING:
 232             case Player.STATE_READY:
 233                 return mInternalPlayer.getPlayWhenReady();
 234             case Player.STATE_IDLE:
 235             case Player.STATE_ENDED:
 236             default:
 237                 return false;
 238         }
 239     }
 240 
 241     @Override
 242     public void seekTo(long msec) throws IllegalStateException {
 243         if (mInternalPlayer == null)
 244             return;
 245         mInternalPlayer.seekTo(msec);
 246     }
 247 
 248     @Override
 249     public long getCurrentPosition() {
 250         if (mInternalPlayer == null)
 251             return 0;
 252         return mInternalPlayer.getCurrentPosition();
 253     }
 254 
 255     @Override
 256     public long getDuration() {
 257         if (mInternalPlayer == null)
 258             return 0;
 259         return mInternalPlayer.getDuration();
 260     }
 261 
 262     @Override
 263     public int getVideoSarNum() {
 264         return 1;
 265     }
 266 
 267     @Override
 268     public int getVideoSarDen() {
 269         return 1;
 270     }
 271 
 272     @Override
 273     public void reset() {
 274         if (mInternalPlayer != null) {
 275             mInternalPlayer.release();
 276             mInternalPlayer = null;
 277         }
 278         if (mExoHelper != null) {
 279             mExoHelper.release();
 280         }
 281         mSurface = null;
 282         mDataSource = null;
 283         mVideoWidth = 0;
 284         mVideoHeight = 0;
 285     }
 286 
 287     @Override
 288     public void onMetadata(Metadata metadata) {
 289 
 290     }
 291 
 292     @Override
 293     public void setLooping(boolean looping) {
 294         isLooping = looping;
 295     }
 296 
 297     @Override
 298     public boolean isLooping() {
 299         return isLooping;
 300     }
 301 
 302     @Override
 303     public void setVolume(float leftVolume, float rightVolume) {
 304         if (mInternalPlayer != null)
 305             mInternalPlayer.setVolume((leftVolume + rightVolume) / 2);
 306     }
 307 
 308     @Override
 309     public int getAudioSessionId() {
 310         return audioSessionId;
 311     }
 312 
 313     @Override
 314     public MediaInfo getMediaInfo() {
 315         return null;
 316     }
 317 
 318     @Override
 319     public void setLogEnabled(boolean enable) {
 320         // do nothing
 321     }
 322 
 323     @Override
 324     public boolean isPlayable() {
 325         return true;
 326     }
 327 
 328     @Override
 329     public void setAudioStreamType(int streamType) {
 330         // do nothing
 331     }
 332 
 333     @Override
 334     public void setKeepInBackground(boolean keepInBackground) {
 335         // do nothing
 336     }
 337 
 338     @Override
 339     public void release() {
 340         if (mInternalPlayer != null) {
 341             reset();
 342             mEventLogger = null;
 343         }
 344     }
 345 
 346     protected void prepareAsyncInternal() {
 347         new Handler(Looper.myLooper()).post(
 348                 () -&gt; {
 349                         if (mTrackSelector == null) {
 350                             mTrackSelector = new DefaultTrackSelector(mAppContext);
 351                         }
 352                         mEventLogger = new EventLogger(mTrackSelector);
 353                         boolean preferExtensionDecoders = true;
 354                         boolean useExtensionRenderers = true;//ÊòØÂê¶ÂºÄÂêØÊâ©Â±ï
<abbr title=" 355                         @DefaultRenderersFactory.ExtensionRendererMode int extensionRendererMode = useExtensionRenderers"> 355                         @DefaultRenderersFactory.ExtensionRendererMode int extensionRendererMode = useExtüîµ</abbr>
<abbr title=" 356                                 ? (preferExtensionDecoders ? DefaultRenderersFactory.EXTENSION_RENDERER_MODE_PREFER"> 356                                 ? (preferExtensionDecoders ? DefaultRenderersFactory.EXTENSION_RENDERER_Müîµ</abbr>
 357                                 : DefaultRenderersFactory.EXTENSION_RENDERER_MODE_ON)
 358                                 : DefaultRenderersFactory.EXTENSION_RENDERER_MODE_OFF;
 359                         if (mRendererFactory == null) {
 360                             mRendererFactory = new DefaultRenderersFactory(mAppContext);
 361                             mRendererFactory.setExtensionRendererMode(extensionRendererMode);
 362                         }
 363                         if (mLoadControl == null) {
 364                             mLoadControl = new DefaultLoadControl();
 365                         }
 366                         mInternalPlayer = new SimpleExoPlayer.Builder(mAppContext, mRendererFactory)
 367                                 .setLooper(Looper.myLooper())
 368                                 .setTrackSelector(mTrackSelector)
 369                                 .setLoadControl(mLoadControl).build();
 370                         mInternalPlayer.addListener(IjkExo2MediaPlayer.this);
 371                         mInternalPlayer.addAnalyticsListener(IjkExo2MediaPlayer.this);
 372                         mInternalPlayer.addListener(mEventLogger);
 373                         if (mSpeedPlaybackParameters != null) {
 374                             mInternalPlayer.setPlaybackParameters(mSpeedPlaybackParameters);
 375                         }
 376                         if (isLooping) {
 377                             mInternalPlayer.setRepeatMode(REPEAT_MODE_ALL);
 378                         }
 379                         if (mSurface != null)
 380                             mInternalPlayer.setVideoSurface(mSurface);
 381                         mInternalPlayer.setMediaSource(mMediaSource);
 382                         mInternalPlayer.prepare();
 383                         mInternalPlayer.setPlayWhenReady(false);
 384                     }
 385         );
 386     }
 387 
 388     public String getOverrideExtension() {
 389         return mOverrideExtension;
 390     }
 391 
 392     public void setOverrideExtension(String overrideExtension) {
 393         this.mOverrideExtension = overrideExtension;
 394     }
 395 
 396     public void stopPlayback() {
 397         mInternalPlayer.stop();
 398     }
 399 
 400     /**
 401      * ÊòØÂê¶ÈúÄË¶ÅÂ∏¶‰∏äheader
 402      * setDataSource‰πãÂâçÁîüÊïà
 403      */
 404     public void setPreview(boolean preview) {
 405         isPreview = preview;
 406     }
 407 
 408     public boolean isPreview() {
 409         return isPreview;
 410     }
 411 
 412     public boolean isCache() {
 413         return isCache;
 414     }
 415 
 416 
 417     /**
 418      * ËÆæÁΩÆseek ÁöÑ‰∏¥ËøëÂ∏ß„ÄÇ
 419      **/
 420     public void setSeekParameter(@Nullable SeekParameters seekParameters) {
 421         mInternalPlayer.setSeekParameters(seekParameters);
 422     }
 423 
 424 
 425     /**
 426      * ÊòØÂê¶ÂºÄÂêØcache
 427      * setDataSource‰πãÂâçÁîüÊïà
 428      */
 429     public void setCache(boolean cache) {
 430         isCache = cache;
 431     }
 432 
 433     public File getCacheDir() {
 434         return mCacheDir;
 435     }
 436 
 437     /**
 438      * cacheÊñá‰ª∂ÁöÑÁõÆÂΩï
 439      * setDataSource‰πãÂâçÁîüÊïà
 440      */
 441     public void setCacheDir(File cacheDir) {
 442         this.mCacheDir = cacheDir;
 443     }
 444 
 445     public MediaSource getMediaSource() {
 446         return mMediaSource;
 447     }
 448 
 449     public void setMediaSource(MediaSource mediaSource) {
 450         this.mMediaSource = mediaSource;
 451     }
 452 
 453     public ExoSourceManager getExoHelper() {
 454         return mExoHelper;
 455     }
 456 
 457     /**
 458      * ÂÄçÈÄüÊí≠Êîæ
 459      *
 460      * @param speed ÂÄçÈÄüÊí≠ÊîæÔºåÈªòËÆ§‰∏∫1
 461      * @param pitch Èü≥ÈáèÁº©ÊîæÔºåÈªòËÆ§‰∏∫1Ôºå‰øÆÊîπ‰ºöÂØºËá¥Â£∞Èü≥ÂèòË∞É
 462      */
 463     public void setSpeed(@Size(min = 0) float speed, @Size(min = 0) float pitch) {
 464         PlaybackParameters playbackParameters = new PlaybackParameters(speed, pitch);
 465         mSpeedPlaybackParameters = playbackParameters;
 466         if (mInternalPlayer != null) {
 467             mInternalPlayer.setPlaybackParameters(playbackParameters);
 468         }
 469     }
 470 
 471     public float getSpeed() {
 472         return mInternalPlayer.getPlaybackParameters().speed;
 473     }
 474 
 475     public int getBufferedPercentage() {
 476         if (mInternalPlayer == null)
 477             return 0;
 478 
 479         return mInternalPlayer.getBufferedPercentage();
 480     }
 481 
 482     public MappingTrackSelector getTrackSelector() {
 483         return mTrackSelector;
 484     }
 485 
 486     public void setTrackSelector(MappingTrackSelector trackSelector) {
 487         this.mTrackSelector = trackSelector;
 488     }
 489 
 490     public LoadControl getLoadControl() {
 491         return mLoadControl;
 492     }
 493 
 494     public void setLoadControl(LoadControl loadControl) {
 495         this.mLoadControl = loadControl;
 496     }
 497 
 498     public DefaultRenderersFactory getRendererFactory() {
 499         return mRendererFactory;
 500     }
 501 
 502     public void setRendererFactory(DefaultRenderersFactory rendererFactory) {
 503         this.mRendererFactory = rendererFactory;
 504     }
 505 
 506 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 507     @Override</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 508     public void onTracksChanged(@NonNull TrackGroupArray trackGroups, @NonNull TrackSelectionArray trackSelections) {"> 508     public void onTracksChanged(@NonNull TrackGroupArray trackGroups, @NonNull TrackSelectionArray trackSüîµ</abbr></span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 509     }</span>
 510 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 511     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 512     public void onRenderedFirstFrame(EventTime eventTime, Surface surface) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 513 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 514     }</span>
 515 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 517     public void onCues(List&lt;Cue&gt; cues) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 519     }</span>
 520 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 521 
 522     @Override
 523 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 524     public void onPlayerStateChanged(boolean playWhenReady, @Player.State int playbackState) {</span>
 525 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 526     public void onPlayerStateChanged(boolean playWhenReady, int playbackState) {</span>
 527 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 528     public void onPlayWhenReadyChanged(boolean playWhenReady, int playbackState) {</span>
 529 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 530         //ÈáçÊñ∞Êí≠ÊîæÁä∂ÊÄÅÈ°∫Â∫è‰∏∫ÔºöSTATE_IDLE -„ÄãSTATE_BUFFERING -„ÄãSTATE_READY
 531         //ÁºìÂÜ≤Êó∂È°∫Â∫è‰∏∫ÔºöSTATE_BUFFERING -„ÄãSTATE_READY
<abbr title=" 532         //Log.e(TAG, &quot;onPlayerStateChanged: playWhenReady = &quot; + playWhenReady + &quot;, playbackState = &quot; + playbackState);"> 532         //Log.e(TAG, &quot;onPlayerStateChanged: playWhenReady = &quot; + playWhenReady + &quot;, playbackState = &quot; + plüîµ</abbr>
 533         if (isLastReportedPlayWhenReady != playWhenReady || lastReportedPlaybackState != playbackState) {
 534             int buffer = 0;
 535             if(mInternalPlayer != null) {
 536                 buffer =  mInternalPlayer.getBufferedPercentage();
 537             }
 538             if (isBuffering) {
 539                 switch (playbackState) {
 540                     case Player.STATE_ENDED:
 541                     case Player.STATE_READY:
 542                         notifyOnInfo(IMediaPlayer.MEDIA_INFO_BUFFERING_END, buffer);
 543                         isBuffering = false;
 544                         break;
 545                 }
 546             }
 547 
 548             if (isPreparing) {
 549                 if (playbackState == Player.STATE_READY) {
 550                         notifyOnPrepared();
 551                         isPreparing = false;
 552                 }
 553             }
 554 
 555             switch (playbackState) {
 556                 case Player.STATE_BUFFERING:
 557                     notifyOnInfo(IMediaPlayer.MEDIA_INFO_BUFFERING_START, buffer);
 558                     isBuffering = true;
 559                     break;
 560                 case Player.STATE_ENDED:
 561                     notifyOnCompletion();
 562                     break;
 563                 default:
 564                     break;
 565             }
 566         }
 567         isLastReportedPlayWhenReady = playWhenReady;
 568         lastReportedPlaybackState = playbackState;
 569     }
 570 
 571     @Override
 572     public void onIsLoadingChanged(boolean isLoading) {
 573 
 574     }
 575 
 576     @Override
 577     public void onPlaybackStateChanged(int state) {
 578         onPlayWhenReadyChanged(isLastReportedPlayWhenReady, state);
 579     }
 580 
 581     @Override
 582     public void onRepeatModeChanged(int repeatMode) {
 583     }
 584 
 585     @Override
 586     public void onShuffleModeEnabledChanged(boolean shuffleModeEnabled) {
 587     }
 588 
 589     @Override
 590     public void onPlayerError(@NonNull ExoPlaybackException error) {
 591         notifyOnError(IMediaPlayer.MEDIA_ERROR_UNKNOWN, IMediaPlayer.MEDIA_ERROR_UNKNOWN);
 592     }
 593 
 594     @Override
 595     public void onPlaybackParametersChanged(@NonNull PlaybackParameters playbackParameters) {
 596     }
 597 
 598     @Override
<abbr title=" 599     public void onPositionDiscontinuity(Player.PositionInfo oldPosition, Player.PositionInfo newPosition, int reason) {"> 599     public void onPositionDiscontinuity(Player.PositionInfo oldPosition, Player.PositionInfo newPosition,üîµ</abbr>
 600         notifyOnInfo(ON_POSITION_DISCOUNTINUITY, reason);
 601         if (reason == DISCONTINUITY_REASON_SEEK) {
 602         notifyOnSeekComplete();
 603     }
 604     }
 605 
<abbr title=" 606     /////////////////////////////////////AudioRendererEventListener/////////////////////////////////////////////"> 606     /////////////////////////////////////AudioRendererEventListener//////////////////////////////////////üîµ</abbr>
 607 
 608 
 609     @Override
 610     public void onPlayWhenReadyChanged(EventTime eventTime, boolean playWhenReady, int playbackState) {
 611 
 612     }
 613 
<abbr title=" 614     /////////////////////////////////////AudioRendererEventListener/////////////////////////////////////////////"> 614     /////////////////////////////////////AudioRendererEventListener//////////////////////////////////////üîµ</abbr>
 615 
 616     @Override
 617     public void onTimelineChanged(@NonNull EventTime eventTime, int reason) {
 618     }
 619 
 620 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 621     @Override</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 622     public void onPositionDiscontinuity(</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 623             @NonNull EventTime eventTime,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 624             @NonNull Player.PositionInfo oldPosition,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 625             @NonNull Player.PositionInfo newPosition,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 626             @Player.DiscontinuityReason int reason</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 627     ) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 628         notifyOnInfo(ON_POSITION_DISCOUNTINUITY, reason);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 629     }</span>
 630 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 631     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 632     public void onPositionDiscontinuity(EventTime eventTime, int reason) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 633         notifyOnInfo(ON_POSITION_DISCOUNTINUITY, reason);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 634     }</span>
 635 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 636 </span>
 637 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 638 
 639 
 640     @Override
<abbr title=" 641     public void onPlaybackParametersChanged(@NonNull EventTime eventTime, @NonNull PlaybackParameters playbackParameters) {"> 641     public void onPlaybackParametersChanged(@NonNull EventTime eventTime, @NonNull PlaybackParameters plaüîµ</abbr>
 642     }
 643 
 644     @Override
 645     public void onRepeatModeChanged(@NonNull EventTime eventTime, int repeatMode) {
 646     }
 647 
 648     @Override
 649     public void onShuffleModeChanged(@NonNull EventTime eventTime, boolean shuffleModeEnabled) {
 650     }
 651 
 652     @Override
 653     public void onIsLoadingChanged(EventTime eventTime, boolean isLoading) {
 654 
 655     }
 656 
 657     @Override
 658     public void onPlayerError(@NonNull EventTime eventTime, @NonNull ExoPlaybackException error) {
 659     }
 660 
 661     @Override
<abbr title=" 662     public void onTracksChanged(@NonNull EventTime eventTime, @NonNull TrackGroupArray trackGroups, @NonNull TrackSelectionArray trackSelections) {"> 662     public void onTracksChanged(@NonNull EventTime eventTime, @NonNull TrackGroupArray trackGroups, @NonNüîµ</abbr>
 663     }
 664 
 665     @Override
<abbr title=" 666     public void onBandwidthEstimate(@NonNull EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaded, long bitrateEstimate) {"> 666     public void onBandwidthEstimate(@NonNull EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaüîµ</abbr>
 667     }
 668 
 669     @Override
 670     public void onMetadata(@NonNull EventTime eventTime, @NonNull Metadata metadata) {
 671     }
 672 
 673     @Override
 674 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 675     public void onDecoderDisabled(@NonNull EventTime eventTime, int trackType, @NonNull DecoderCounters decoderCounters) {"> 675     public void onDecoderDisabled(@NonNull EventTime eventTime, int trackType, @NonNull DecoderCounters düîµ</abbr></span>
 676 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 677     public void onDecoderDisabled(EventTime eventTime, int trackType, DecoderCounters decoderCounters) {</span>
 678 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 679     public void onAudioDisabled(EventTime eventTime, DecoderCounters counters) {</span>
 680 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 681         audioSessionId = C.AUDIO_SESSION_ID_UNSET;
 682     }
 683 
 684     @Override
<abbr title=" 685     public void onAudioUnderrun(@NonNull EventTime eventTime, int bufferSize, long bufferSizeMs, long elapsedSinceLastFeedMs) {"> 685     public void onAudioUnderrun(@NonNull EventTime eventTime, int bufferSize, long bufferSizeMs, long elaüîµ</abbr>
 686     }
 687 
 688     @Override
 689     public void onDroppedVideoFrames(@NonNull EventTime eventTime, int droppedFrames, long elapsedMs) {
 690     }
 691 
 692     @Override
 693 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 694     public void onVideoSizeChanged(@NonNull EventTime eventTime, @NonNull VideoSize videoSize) {</span>
 695 ||||||| BASE
 696 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 697     public void onVideoSizeChanged(EventTime eventTime, VideoSize videoSize) {</span>
 698 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 699         mVideoWidth = (int) (videoSize.width * videoSize.pixelWidthHeightRatio);
 700         mVideoHeight = videoSize.height;
<abbr title=" 701         notifyOnVideoSizeChanged((int) (videoSize.width * videoSize.pixelWidthHeightRatio), videoSize.height, 1, 1);"> 701         notifyOnVideoSizeChanged((int) (videoSize.width * videoSize.pixelWidthHeightRatio), videoSize.heiüîµ</abbr>
 702         if (videoSize.unappliedRotationDegrees &gt; 0)
<abbr title=" 703             notifyOnInfo(IMediaPlayer.MEDIA_INFO_VIDEO_ROTATION_CHANGED, videoSize.unappliedRotationDegrees);"> 703             notifyOnInfo(IMediaPlayer.MEDIA_INFO_VIDEO_ROTATION_CHANGED, videoSize.unappliedRotationDegreüîµ</abbr>
 704     }
 705 
 706     @Override
 707 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 708     public void onRenderedFirstFrame(@NonNull EventTime eventTime, @NonNull Object output, long renderTimeMs) {"> 708     public void onRenderedFirstFrame(@NonNull EventTime eventTime, @NonNull Object output, long renderTimüîµ</abbr></span>
 709 ||||||| BASE
 710 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 711     public void onRenderedFirstFrame(EventTime eventTime, Object output, long renderTimeMs) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 712 </span>
 713 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 714     }
 715 
 716     @Override
 717     public void onDrmKeysLoaded(@NonNull EventTime eventTime) {
 718     }
 719 
 720     @Override
 721     public void onDrmSessionManagerError(@NonNull EventTime eventTime, @NonNull Exception error) {
 722     }
 723 
 724     @Override
 725     public void onDrmKeysRestored(@NonNull EventTime eventTime) {
 726     }
 727 
 728     @Override
 729     public void onDrmKeysRemoved(@NonNull EventTime eventTime) {
 730     }
 731 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 package tv.danmaku.ijk.media.exo2;
   2 
   3 import android.content.Context;
   4 import android.net.Uri;
   5 import android.os.Handler;
   6 import android.os.Looper;
   7 import android.view.Surface;
   8 import android.view.SurfaceHolder;
   9 import androidx.annotation.NonNull;
  10 import androidx.annotation.Nullable;
  11 import androidx.annotation.Size;
  12 import com.google.android.exoplayer2.C;
  13 import com.google.android.exoplayer2.DefaultLoadControl;
  14 import com.google.android.exoplayer2.DefaultRenderersFactory;
  15 import com.google.android.exoplayer2.ExoPlaybackException;
  16 import com.google.android.exoplayer2.LoadControl;
  17 import com.google.android.exoplayer2.PlaybackParameters;
  18 import com.google.android.exoplayer2.Player;
  19 import com.google.android.exoplayer2.SeekParameters;
  20 import com.google.android.exoplayer2.SimpleExoPlayer;
  21 import com.google.android.exoplayer2.analytics.AnalyticsListener;
  22 import com.google.android.exoplayer2.decoder.DecoderCounters;
  23 import com.google.android.exoplayer2.metadata.Metadata;
  24 import com.google.android.exoplayer2.source.MediaSource;
  25 import com.google.android.exoplayer2.source.TrackGroupArray;
  26 import com.google.android.exoplayer2.text.Cue;
  27 import com.google.android.exoplayer2.trackselection.DefaultTrackSelector;
  28 import com.google.android.exoplayer2.trackselection.MappingTrackSelector;
  29 import com.google.android.exoplayer2.trackselection.TrackSelectionArray;
  30 import com.google.android.exoplayer2.video.VideoSize;
  31 import java.io.File;
  32 import java.io.FileDescriptor;
  33 import java.util.HashMap;
  34 import java.util.List;
  35 import java.util.Map;
  36 import static com.google.android.exoplayer2.Player.DISCONTINUITY_REASON_SEEK;
  37 import static com.google.android.exoplayer2.Player.REPEAT_MODE_ALL;
  38 import tv.danmaku.ijk.media.exo2.demo.EventLogger;
  39 import tv.danmaku.ijk.media.player.AbstractMediaPlayer;
  40 import tv.danmaku.ijk.media.player.IMediaPlayer;
  41 import tv.danmaku.ijk.media.player.MediaInfo;
  42 import tv.danmaku.ijk.media.player.misc.IjkTrackInfo;
  43 
  44 
  45 /**
  46  * Created by guoshuyu on 2018/1/10.
  47  * Exo
  48  */
<abbr title="  49 public class IjkExo2MediaPlayer extends AbstractMediaPlayer implements Player.Listener , AnalyticsListener {">  49 public class IjkExo2MediaPlayer extends AbstractMediaPlayer implements Player.Listener , AnalyticsListeneüîµ</abbr>
  50     public static final int ON_POSITION_DISCOUNTINUITY = 2702;
  51 
  52     private static final String TAG = &quot;IjkExo2MediaPlayer&quot;;
  53 
  54     protected final Context mAppContext;
  55 
  56     protected SimpleExoPlayer mInternalPlayer;
  57 
  58     protected EventLogger mEventLogger;
  59 
  60     protected DefaultRenderersFactory mRendererFactory;
  61 
  62     protected MediaSource mMediaSource;
  63 
  64     protected MappingTrackSelector mTrackSelector;
  65 
  66     protected LoadControl mLoadControl;
  67 
  68     protected String mDataSource;
  69 
  70     protected Surface mSurface;
  71 
  72     protected Map&lt;String, String&gt; mHeaders = new HashMap&lt;&gt;();
  73 
  74     protected PlaybackParameters mSpeedPlaybackParameters;
  75 
  76     protected int mVideoWidth;
  77 
  78     protected int mVideoHeight;
  79 
  80     protected int lastReportedPlaybackState;
  81 
  82     protected boolean isLastReportedPlayWhenReady;
  83 
  84     protected boolean isPreparing = true;
  85 
  86     protected boolean isBuffering = false;
  87 
  88     protected boolean isLooping = false;
  89 
  90     /**
  91      * ÊòØÂê¶Â∏¶‰∏äheader
  92      */
  93     protected boolean isPreview = false;
  94 
  95     /**
  96      * ÊòØÂê¶ÂºÄÂêØÁºìÂ≠ò
  97      */
  98     protected boolean isCache = false;
  99 
 100     /**
 101      * dataSourceÁ≠âÁöÑÂ∏ÆÁªÑÁ±ª
 102      */
 103     protected final ExoSourceManager mExoHelper;
 104 
 105     /**
 106      * ÁºìÂ≠òÁõÆÂΩïÔºåÂèØ‰ª•‰∏∫Á©∫
 107      */
 108     protected File mCacheDir;
 109 
 110     /**
 111      * Á±ªÂûãË¶ÜÁõñ
 112      */
 113     private String mOverrideExtension;
 114 
 115     protected int audioSessionId = C.AUDIO_SESSION_ID_UNSET;
 116 
 117     public IjkExo2MediaPlayer(Context context) {
 118         mAppContext = context.getApplicationContext();
 119         lastReportedPlaybackState = Player.STATE_IDLE;
 120         mExoHelper = ExoSourceManager.newInstance(context, mHeaders);
 121     }
 122 
 123     private int getVideoRendererIndex() {
 124         if (mInternalPlayer != null) {
 125             for (int i = 0; i &lt; mInternalPlayer.getRendererCount(); i++) {
 126                 if (mInternalPlayer.getRendererType(i) == C.TRACK_TYPE_VIDEO) {
 127                     return i;
 128                 }
 129             }
 130         }
 131         return 0;
 132     }
 133 
 134     @Override
 135     public void setDisplay(SurfaceHolder sh) {
 136         if (sh == null)
 137             setSurface(null);
 138         else
 139             setSurface(sh.getSurface());
 140     }
 141 
 142     @Override
 143     public void setSurface(Surface surface) {
 144         mSurface = surface;
 145         if (mInternalPlayer != null) {
 146             if (surface != null &amp;&amp; !surface.isValid()) {
 147                 mSurface = null;
 148             }
 149             mInternalPlayer.setVideoSurface(surface);
 150         }
 151     }
 152 
 153     @Override
 154     public void setDataSource(Context context, Uri uri, Map&lt;String, String&gt; headers) {
 155         if (headers != null) {
 156             mHeaders.clear();
 157             mHeaders.putAll(headers);
 158         }
 159         setDataSource(context, uri);
 160     }
 161 
 162     @Override
 163     public void setDataSource(String path) {
 164         setDataSource(mAppContext, Uri.parse(path));
 165     }
 166 
 167     @Override
 168     public void setDataSource(Context context, Uri uri) {
 169         mDataSource = uri.toString();
<abbr title=" 170         mMediaSource = mExoHelper.getMediaSource(mDataSource, isPreview, isCache, isLooping, mCacheDir, mOverrideExtension);"> 170         mMediaSource = mExoHelper.getMediaSource(mDataSource, isPreview, isCache, isLooping, mCacheDir, müîµ</abbr>
 171     }
 172 
 173     @Override
 174     public void setDataSource(FileDescriptor fd) {
 175         throw new UnsupportedOperationException(&quot;no support&quot;);
 176     }
 177 
 178     @Override
 179     public String getDataSource() {
 180         return mDataSource;
 181     }
 182 
 183     @Override
 184     public void prepareAsync() throws IllegalStateException {
 185         if (mInternalPlayer != null)
 186             throw new IllegalStateException(&quot;can&#x27;t prepare a prepared player&quot;);
 187         prepareAsyncInternal();
 188     }
 189 
 190     @Override
 191     public void start() throws IllegalStateException {
 192         if (mInternalPlayer == null)
 193             return;
 194         mInternalPlayer.setPlayWhenReady(true);
 195     }
 196 
 197     @Override
 198     public void stop() throws IllegalStateException {
 199         if (mInternalPlayer == null)
 200             return;
 201         mInternalPlayer.release();
 202     }
 203 
 204     @Override
 205     public void pause() throws IllegalStateException {
 206         if (mInternalPlayer == null)
 207             return;
 208         mInternalPlayer.setPlayWhenReady(false);
 209     }
 210 
 211     @Override
 212     public void setWakeMode(Context context, int mode) {
 213         // FIXME: implement
 214     }
 215 
 216     @Override
 217     public void setScreenOnWhilePlaying(boolean screenOn) {
 218         // TODO: do nothing
 219     }
 220 
 221     @Override
 222     public IjkTrackInfo[] getTrackInfo() {
 223         // TODO: implement
 224         return null;
 225     }
 226 
 227     @Override
 228     public int getVideoWidth() {
 229         return mVideoWidth;
 230     }
 231 
 232     @Override
 233     public int getVideoHeight() {
 234         return mVideoHeight;
 235     }
 236 
 237     @Override
 238     public boolean isPlaying() {
 239         if (mInternalPlayer == null)
 240             return false;
 241         int state = mInternalPlayer.getPlaybackState();
 242         switch (state) {
 243             case Player.STATE_BUFFERING:
 244             case Player.STATE_READY:
 245                 return mInternalPlayer.getPlayWhenReady();
 246             case Player.STATE_IDLE:
 247             case Player.STATE_ENDED:
 248             default:
 249                 return false;
 250         }
 251     }
 252 
 253     @Override
 254     public void seekTo(long msec) throws IllegalStateException {
 255         if (mInternalPlayer == null)
 256             return;
 257         mInternalPlayer.seekTo(msec);
 258     }
 259 
 260     @Override
 261     public long getCurrentPosition() {
 262         if (mInternalPlayer == null)
 263             return 0;
 264         return mInternalPlayer.getCurrentPosition();
 265     }
 266 
 267     @Override
 268     public long getDuration() {
 269         if (mInternalPlayer == null)
 270             return 0;
 271         return mInternalPlayer.getDuration();
 272     }
 273 
 274     @Override
 275     public int getVideoSarNum() {
 276         return 1;
 277     }
 278 
 279     @Override
 280     public int getVideoSarDen() {
 281         return 1;
 282     }
 283 
 284     @Override
 285     public void reset() {
 286         if (mInternalPlayer != null) {
 287             mInternalPlayer.release();
 288             mInternalPlayer = null;
 289         }
 290         if (mExoHelper != null) {
 291             mExoHelper.release();
 292         }
 293         mSurface = null;
 294         mDataSource = null;
 295         mVideoWidth = 0;
 296         mVideoHeight = 0;
 297     }
 298 
 299     @Override
 300     public void onCues(List&lt;Cue&gt; cues) {
 301     }
 302 
 303     @Override
 304     public void onMetadata(Metadata metadata) {
 305     }
 306 
 307     @Override
 308     public void setLooping(boolean looping) {
 309         isLooping = looping;
 310     }
 311 
 312     @Override
 313     public boolean isLooping() {
 314         return isLooping;
 315     }
 316 
 317     @Override
 318     public void setVolume(float leftVolume, float rightVolume) {
 319         if (mInternalPlayer != null)
 320             mInternalPlayer.setVolume((leftVolume + rightVolume) / 2);
 321     }
 322 
 323     @Override
 324     public int getAudioSessionId() {
 325         return audioSessionId;
 326     }
 327 
 328     @Override
 329     public MediaInfo getMediaInfo() {
 330         return null;
 331     }
 332 
 333     @Override
 334     public void setLogEnabled(boolean enable) {
 335         // do nothing
 336     }
 337 
 338     @Override
 339     public boolean isPlayable() {
 340         return true;
 341     }
 342 
 343     @Override
 344     public void setAudioStreamType(int streamType) {
 345         // do nothing
 346     }
 347 
 348     @Override
 349     public void setKeepInBackground(boolean keepInBackground) {
 350         // do nothing
 351     }
 352 
 353     @Override
 354     public void release() {
 355         if (mInternalPlayer != null) {
 356             reset();
 357             mEventLogger = null;
 358         }
 359     }
 360 
 361     protected void prepareAsyncInternal() {
 362         new Handler(Looper.myLooper()).post(() -&gt; {
 363             if (mTrackSelector == null) {
 364                 mTrackSelector = new DefaultTrackSelector(mAppContext);
 365             }
 366             mEventLogger = new EventLogger(mTrackSelector);
 367             boolean preferExtensionDecoders = true;
 368             boolean useExtensionRenderers = true;// ÊòØÂê¶ÂºÄÂêØÊâ©Â±ï
 369 
 370             @DefaultRenderersFactory.ExtensionRendererMode
<abbr title=" 371             int extensionRendererMode = (useExtensionRenderers) ? preferExtensionDecoders ? DefaultRenderersFactory.EXTENSION_RENDERER_MODE_PREFER : DefaultRenderersFactory.EXTENSION_RENDERER_MODE_ON : DefaultRenderersFactory.EXTENSION_RENDERER_MODE_OFF;"> 371             int extensionRendererMode = (useExtensionRenderers) ? preferExtensionDecoders ? DefaultRenderüîµ</abbr>
 372             if (mRendererFactory == null) {
 373                 mRendererFactory = new DefaultRenderersFactory(mAppContext);
 374                 mRendererFactory.setExtensionRendererMode(extensionRendererMode);
 375             }
 376             if (mLoadControl == null) {
 377                 mLoadControl = new DefaultLoadControl();
 378             }
<abbr title=" 379             mInternalPlayer = new SimpleExoPlayer.Builder(mAppContext, mRendererFactory).setLooper(Looper.myLooper()).setTrackSelector(mTrackSelector).setLoadControl(mLoadControl).build();"> 379             mInternalPlayer = new SimpleExoPlayer.Builder(mAppContext, mRendererFactory).setLooper(Looperüîµ</abbr>
 380             mInternalPlayer.addListener(this);
 381             mInternalPlayer.addAnalyticsListener(this);
 382             mInternalPlayer.addListener(mEventLogger);
 383             if (mSpeedPlaybackParameters != null) {
 384                 mInternalPlayer.setPlaybackParameters(mSpeedPlaybackParameters);
 385             }
 386             if (mSurface != null) {
 387                 mInternalPlayer.setVideoSurface(mSurface);
 388             }
 389             mInternalPlayer.setMediaSource(mMediaSource);
 390             mInternalPlayer.prepare();
 391             mInternalPlayer.setPlayWhenReady(false);
 392         });
 393     }
 394 
 395     public String getOverrideExtension() {
 396         return mOverrideExtension;
 397     }
 398 
 399     public void setOverrideExtension(String overrideExtension) {
 400         this.mOverrideExtension = overrideExtension;
 401     }
 402 
 403     public void stopPlayback() {
 404         mInternalPlayer.stop();
 405     }
 406 
 407     /**
 408      * ÊòØÂê¶ÈúÄË¶ÅÂ∏¶‰∏äheader
 409      * setDataSource‰πãÂâçÁîüÊïà
 410      */
 411     public void setPreview(boolean preview) {
 412         isPreview = preview;
 413     }
 414 
 415     public boolean isPreview() {
 416         return isPreview;
 417     }
 418 
 419     public boolean isCache() {
 420         return isCache;
 421     }
 422 
 423     /**
 424      * ËÆæÁΩÆseek ÁöÑ‰∏¥ËøëÂ∏ß„ÄÇ
 425      **/
 426     public void setSeekParameter(@Nullable SeekParameters seekParameters) {
 427         mInternalPlayer.setSeekParameters(seekParameters);
 428     }
 429 
 430     /**
 431      * ÊòØÂê¶ÂºÄÂêØcache
 432      * setDataSource‰πãÂâçÁîüÊïà
 433      */
 434     public void setCache(boolean cache) {
 435         isCache = cache;
 436     }
 437 
 438     public File getCacheDir() {
 439         return mCacheDir;
 440     }
 441 
 442     /**
 443      * cacheÊñá‰ª∂ÁöÑÁõÆÂΩï
 444      * setDataSource‰πãÂâçÁîüÊïà
 445      */
 446     public void setCacheDir(File cacheDir) {
 447         this.mCacheDir = cacheDir;
 448     }
 449 
 450     public MediaSource getMediaSource() {
 451         return mMediaSource;
 452     }
 453 
 454     public void setMediaSource(MediaSource mediaSource) {
 455         this.mMediaSource = mediaSource;
 456     }
 457 
 458     public ExoSourceManager getExoHelper() {
 459         return mExoHelper;
 460     }
 461 
 462     /**
 463      * ÂÄçÈÄüÊí≠Êîæ
 464      *
 465      * @param speed ÂÄçÈÄüÊí≠ÊîæÔºåÈªòËÆ§‰∏∫1
 466      * @param pitch Èü≥ÈáèÁº©ÊîæÔºåÈªòËÆ§‰∏∫1Ôºå‰øÆÊîπ‰ºöÂØºËá¥Â£∞Èü≥ÂèòË∞É
 467      */
 468     public void setSpeed(@Size(min = 0) float speed, @Size(min = 0) float pitch) {
 469         PlaybackParameters playbackParameters = new PlaybackParameters(speed, pitch);
 470         mSpeedPlaybackParameters = playbackParameters;
 471         if (mInternalPlayer != null) {
 472             mInternalPlayer.setPlaybackParameters(playbackParameters);
 473         }
 474     }
 475 
 476     public float getSpeed() {
 477         return mInternalPlayer.getPlaybackParameters().speed;
 478     }
 479 
 480     public int getBufferedPercentage() {
 481         if (mInternalPlayer == null)
 482             return 0;
 483 
 484         return mInternalPlayer.getBufferedPercentage();
 485     }
 486 
 487     public MappingTrackSelector getTrackSelector() {
 488         return mTrackSelector;
 489     }
 490 
 491     public void setTrackSelector(MappingTrackSelector trackSelector) {
 492         this.mTrackSelector = trackSelector;
 493     }
 494 
 495     public LoadControl getLoadControl() {
 496         return mLoadControl;
 497     }
 498 
 499     public void setLoadControl(LoadControl loadControl) {
 500         this.mLoadControl = loadControl;
 501     }
 502 
 503     public DefaultRenderersFactory getRendererFactory() {
 504         return mRendererFactory;
 505     }
 506 
 507     public void setRendererFactory(DefaultRenderersFactory rendererFactory) {
 508         this.mRendererFactory = rendererFactory;
 509     }
 510 
 511     @Override
 512     public void onTracksChanged(@NonNull
 513     TrackGroupArray trackGroups, @NonNull
 514     TrackSelectionArray trackSelections) {
 515     }
 516 
 517     @Override
 518     public void onPlayWhenReadyChanged(boolean playWhenReady, @Player.State
 519     int playbackState) {
 520         //ÈáçÊñ∞Êí≠ÊîæÁä∂ÊÄÅÈ°∫Â∫è‰∏∫ÔºöSTATE_IDLE -„ÄãSTATE_BUFFERING -„ÄãSTATE_READY
 521         //ÁºìÂÜ≤Êó∂È°∫Â∫è‰∏∫ÔºöSTATE_BUFFERING -„ÄãSTATE_READY
<abbr title=" 522         //Log.e(TAG, &quot;onPlayerStateChanged: playWhenReady = &quot; + playWhenReady + &quot;, playbackState = &quot; + playbackState);"> 522         //Log.e(TAG, &quot;onPlayerStateChanged: playWhenReady = &quot; + playWhenReady + &quot;, playbackState = &quot; + plüîµ</abbr>
<abbr title=" 523         if ((isLastReportedPlayWhenReady != playWhenReady) || (lastReportedPlaybackState != playbackState)) {"> 523         if ((isLastReportedPlayWhenReady != playWhenReady) || (lastReportedPlaybackState != playbackStateüîµ</abbr>
 524             int buffer = 0;
 525             if (mInternalPlayer != null) {
 526                 buffer = mInternalPlayer.getBufferedPercentage();
 527             }
 528             if (isBuffering) {
 529                 switch (playbackState) {
 530                     case Player.STATE_ENDED :
 531                     case Player.STATE_READY :
 532                         notifyOnInfo(IMediaPlayer.MEDIA_INFO_BUFFERING_END, buffer);
 533                         isBuffering = false;
 534                         break;
 535                 }
 536             }
 537             if (isPreparing) {
 538                 if (playbackState == Player.STATE_READY) {
 539                     notifyOnPrepared();
 540                     isPreparing = false;
 541                 }
 542             }
 543             switch (playbackState) {
 544                 case Player.STATE_BUFFERING :
 545                     notifyOnInfo(IMediaPlayer.MEDIA_INFO_BUFFERING_START, buffer);
 546                     isBuffering = true;
 547                     break;
 548                 case Player.STATE_ENDED :
 549                     notifyOnCompletion();
 550                     break;
 551                 default :
 552                     break;
 553             }
 554         }
 555         isLastReportedPlayWhenReady = playWhenReady;
 556         lastReportedPlaybackState = playbackState;
 557     }
 558 
 559     @Override
 560     public void onRepeatModeChanged(int repeatMode) {
 561 
 562     }
 563 
 564     @Override
 565     public void onShuffleModeEnabledChanged(boolean shuffleModeEnabled) {
 566 
 567     }
 568 
 569     @Override
 570     public void onPlayerError(@NonNull
 571     ExoPlaybackException error) {
 572         notifyOnError(IMediaPlayer.MEDIA_ERROR_UNKNOWN, IMediaPlayer.MEDIA_ERROR_UNKNOWN);
 573     }
 574 
 575     @Override
<abbr title=" 576     public void onPositionDiscontinuity(Player.PositionInfo oldPosition, Player.PositionInfo newPosition, int reason) {"> 576     public void onPositionDiscontinuity(Player.PositionInfo oldPosition, Player.PositionInfo newPosition,üîµ</abbr>
 577         notifyOnInfo(ON_POSITION_DISCOUNTINUITY, reason);
 578         if (reason == DISCONTINUITY_REASON_SEEK) {
 579             notifyOnSeekComplete();
 580         }
 581     }
 582 
 583     @Override
 584     public void onPlaybackParametersChanged(@NonNull
 585     PlaybackParameters playbackParameters) {
 586     }
 587 
<abbr title=" 588     /////////////////////////////////////AudioRendererEventListener/////////////////////////////////////////////"> 588     /////////////////////////////////////AudioRendererEventListener//////////////////////////////////////üîµ</abbr>
 589     @Override
 590     public void onPlayWhenReadyChanged(EventTime eventTime, boolean playWhenReady, int playbackState) {
 591     }
 592 
 593     @Override
 594     public void onTimelineChanged(EventTime eventTime, int reason) {
 595 
 596     }
 597 
 598     @Override
 599     public void onPlaybackParametersChanged(@NonNull
 600     EventTime eventTime, @NonNull
 601     PlaybackParameters playbackParameters) {
 602     }
 603 
 604     @Override
 605     public void onRepeatModeChanged(@NonNull
 606     EventTime eventTime, int repeatMode) {
 607     }
 608 
 609     @Override
 610     public void onShuffleModeChanged(@NonNull
 611     EventTime eventTime, boolean shuffleModeEnabled) {
 612     }
 613 
 614     @Override
 615     public void onPlayerError(@NonNull
 616     EventTime eventTime, @NonNull
 617     ExoPlaybackException error) {
 618     }
 619 
 620     @Override
 621     public void onTracksChanged(@NonNull
 622     EventTime eventTime, @NonNull
 623     TrackGroupArray trackGroups, @NonNull
 624     TrackSelectionArray trackSelections) {
 625     }
 626 
 627     @Override
 628     public void onBandwidthEstimate(@NonNull
 629     EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaded, long bitrateEstimate) {
 630     }
 631 
 632     @Override
 633     public void onMetadata(@NonNull
 634     EventTime eventTime, @NonNull
 635     Metadata metadata) {
 636     }
 637 
 638     @Override
 639     public void onAudioDisabled(@NonNull
 640     EventTime eventTime, @NonNull
 641     DecoderCounters counters) {
 642         audioSessionId = C.AUDIO_SESSION_ID_UNSET;
 643     }
 644 
 645     @Override
 646     public void onAudioUnderrun(@NonNull
 647     EventTime eventTime, int bufferSize, long bufferSizeMs, long elapsedSinceLastFeedMs) {
 648     }
 649 
 650     @Override
 651     public void onDroppedVideoFrames(@NonNull
 652     EventTime eventTime, int droppedFrames, long elapsedMs) {
 653     }
 654 
 655     @Override
 656     public void onVideoSizeChanged(@NonNull
 657     EventTime eventTime,
 658 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 659 @NonNull VideoSize</span>
 660 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 661 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 661 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwüîµ</abbr></span>
 662 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 663 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 664 VideoSize</span>
 665 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 666 
 667      videoSize) {
 668         mVideoWidth = ((int) (videoSize.width * videoSize.pixelWidthHeightRatio));
 669         mVideoHeight = videoSize.height;
<abbr title=" 670         notifyOnVideoSizeChanged(((int) (videoSize.width * videoSize.pixelWidthHeightRatio)), videoSize.height, 1, 1);"> 670         notifyOnVideoSizeChanged(((int) (videoSize.width * videoSize.pixelWidthHeightRatio)), videoSize.hüîµ</abbr>
 671         if (videoSize.unappliedRotationDegrees &gt; 0) {
<abbr title=" 672             notifyOnInfo(IMediaPlayer.MEDIA_INFO_VIDEO_ROTATION_CHANGED, videoSize.unappliedRotationDegrees);"> 672             notifyOnInfo(IMediaPlayer.MEDIA_INFO_VIDEO_ROTATION_CHANGED, videoSize.unappliedRotationDegreüîµ</abbr>
 673         }
 674     }
 675 
 676     @Override
 677     public void onRenderedFirstFrame(@NonNull
 678     EventTime eventTime, @NonNull
 679     Object output, long renderTimeMs) {
 680     }
 681 
 682     @Override
 683     public void onDrmKeysLoaded(@NonNull
 684     EventTime eventTime) {
 685     }
 686 
 687     @Override
 688     public void onDrmSessionManagerError(@NonNull
 689     EventTime eventTime, @NonNull
 690     Exception error) {
 691     }
 692 
 693     @Override
 694     public void onDrmKeysRestored(@NonNull
 695     EventTime eventTime) {
 696     }
 697 
 698     @Override
 699     public void onDrmKeysRemoved(@NonNull
 700     EventTime eventTime) {
 701     }
 702 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  
   2  package tv.danmaku.ijk.media.exo2;
   3  
   4  import android.content.Context;
   5  import android.net.Uri;
   6  import android.os.Handler;
   7  import android.os.Looper;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   8 -</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   9 +import android.view.Surface;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  10 +import android.view.SurfaceHolder;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  11 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  12 +import androidx.annotation.NonNull;</span>
  13  import androidx.annotation.Nullable;
  14  import androidx.annotation.Size;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  15 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  16 -import android.view.Surface;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  17 -import android.view.SurfaceHolder;</span>
  18  
  19  import com.google.android.exoplayer2.C;
  20  import com.google.android.exoplayer2.DefaultLoadControl;
  21  import com.google.android.exoplayer2.DefaultRenderersFactory;
  22  import com.google.android.exoplayer2.ExoPlaybackException;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  23 -import com.google.android.exoplayer2.Format;</span>
  24  import com.google.android.exoplayer2.LoadControl;
  25  import com.google.android.exoplayer2.PlaybackParameters;
  26  import com.google.android.exoplayer2.Player;
  27  import com.google.android.exoplayer2.SeekParameters;
  28  import com.google.android.exoplayer2.SimpleExoPlayer;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  29 -import com.google.android.exoplayer2.Timeline;</span>
  30  import com.google.android.exoplayer2.analytics.AnalyticsListener;
  31  import com.google.android.exoplayer2.decoder.DecoderCounters;
  32  import com.google.android.exoplayer2.metadata.Metadata;
  33  import com.google.android.exoplayer2.source.MediaSource;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  34 -import com.google.android.exoplayer2.source.MediaSourceEventListener;</span>
  35  import com.google.android.exoplayer2.source.TrackGroupArray;

  36  import com.google.android.exoplayer2.trackselection.DefaultTrackSelector;
  37  import com.google.android.exoplayer2.trackselection.MappingTrackSelector;
  38  import com.google.android.exoplayer2.trackselection.TrackSelectionArray;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  39 +import com.google.android.exoplayer2.video.VideoSize;</span>
  40  
  41  import java.io.File;
  42  import java.io.FileDescriptor;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  43 -import java.io.IOException;</span>
  44  import java.util.HashMap;

  45  import java.util.Map;
  46  
  47  import tv.danmaku.ijk.media.exo2.demo.EventLogger;
  48  import tv.danmaku.ijk.media.player.AbstractMediaPlayer;
  49  import tv.danmaku.ijk.media.player.IMediaPlayer;
  50  import tv.danmaku.ijk.media.player.MediaInfo;
  51  import tv.danmaku.ijk.media.player.misc.IjkTrackInfo;
  52  



  53  
  54  /**
  55   * Created by guoshuyu on 2018/1/10.
  56   * Exo
  57   */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  58 -public class IjkExo2MediaPlayer extends AbstractMediaPlayer implements Player.EventListener, AnalyticsListener {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  59 -</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  60 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  61 -    public static int ON_POSITION_DISCOUNTINUITY = 2702;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  62 +public class IjkExo2MediaPlayer extends AbstractMediaPlayer implements Player.Listener, AnalyticsListener {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  63 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  64 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  65 +    public static final int ON_POSITION_DISCOUNTINUITY = 2702;</span>
  66  
  67      private static final String TAG = &quot;IjkExo2MediaPlayer&quot;;
  68  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  69 -    protected Context mAppContext;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  70 +    protected final Context mAppContext;</span>
  71      protected SimpleExoPlayer mInternalPlayer;
  72      protected EventLogger mEventLogger;
  73      protected DefaultRenderersFactory mRendererFactory;
  74      protected MediaSource mMediaSource;
  75      protected MappingTrackSelector mTrackSelector;
  76      protected LoadControl mLoadControl;
  77      protected String mDataSource;
  78      protected Surface mSurface;
  79      protected Map&lt;String, String&gt; mHeaders = new HashMap&lt;&gt;();
  80      protected PlaybackParameters mSpeedPlaybackParameters;
  81      protected int mVideoWidth;
  82      protected int mVideoHeight;
  83      protected int lastReportedPlaybackState;
  84      protected boolean isLastReportedPlayWhenReady;
  85      protected boolean isPreparing = true;
  86      protected boolean isBuffering = false;
  87      protected boolean isLooping = false;
  88      /**
  89       * ÊòØÂê¶Â∏¶‰∏äheader
  90       */
  91      protected boolean isPreview = false;
  92      /**
  93       * ÊòØÂê¶ÂºÄÂêØÁºìÂ≠ò
  94       */
  95      protected boolean isCache = false;
  96      /**
  97       * dataSourceÁ≠âÁöÑÂ∏ÆÁªÑÁ±ª
  98       */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  99 -    protected ExoSourceManager mExoHelper;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +    protected final ExoSourceManager mExoHelper;</span>
 101      /**
 102       * ÁºìÂ≠òÁõÆÂΩïÔºåÂèØ‰ª•‰∏∫Á©∫
 103       */
 104      protected File mCacheDir;
 105      /**
 106       * Á±ªÂûãË¶ÜÁõñ
 107       */
 108      private String mOverrideExtension;
 109  
 110      protected int audioSessionId = C.AUDIO_SESSION_ID_UNSET;
 111  
 112  
 113      public IjkExo2MediaPlayer(Context context) {
 114          mAppContext = context.getApplicationContext();
 115          lastReportedPlaybackState = Player.STATE_IDLE;
 116          mExoHelper = ExoSourceManager.newInstance(context, mHeaders);
 117      }
 118  
 119  
 120      private int getVideoRendererIndex() {
 121          if (mInternalPlayer != null) {
 122              for (int i = 0; i &lt; mInternalPlayer.getRendererCount(); i++) {
 123                  if (mInternalPlayer.getRendererType(i) == C.TRACK_TYPE_VIDEO) {
 124                      return i;
 125                  }
 126              }
 127          }
 128          return 0;
 129      }
 130  
 131      @Override
 132      public void setDisplay(SurfaceHolder sh) {
 133          if (sh == null)
 134              setSurface(null);
 135          else
 136              setSurface(sh.getSurface());
 137      }
 138  
 139      @Override
 140      public void setSurface(Surface surface) {
 141          mSurface = surface;
 142          if (mInternalPlayer != null) {
 143              if (surface != null &amp;&amp; !surface.isValid()) {
 144                  mSurface = null;
 145              }
 146              mInternalPlayer.setVideoSurface(surface);
 147          }
 148      }
 149  
 150  
 151      @Override
 152      public void setDataSource(Context context, Uri uri, Map&lt;String, String&gt; headers) {
 153          if (headers != null) {
 154              mHeaders.clear();
 155              mHeaders.putAll(headers);
 156          }
 157          setDataSource(context, uri);
 158      }
 159  
 160      @Override
 161      public void setDataSource(String path) {
 162          setDataSource(mAppContext, Uri.parse(path));
 163      }
 164  
 165      @Override
 166      public void setDataSource(Context context, Uri uri) {
 167          mDataSource = uri.toString();
<abbr title=" 168          mMediaSource = mExoHelper.getMediaSource(mDataSource, isPreview, isCache, isLooping, mCacheDir, mOverrideExtension);"> 168          mMediaSource = mExoHelper.getMediaSource(mDataSource, isPreview, isCache, isLooping, mCacheDir, mOverrideEüîµ</abbr>
 169      }
 170  
 171      @Override
 172      public void setDataSource(FileDescriptor fd) {
 173          throw new UnsupportedOperationException(&quot;no support&quot;);
 174      }
 175  
 176      @Override
 177      public String getDataSource() {
 178          return mDataSource;
 179      }
 180  
 181      @Override
 182      public void prepareAsync() throws IllegalStateException {
 183          if (mInternalPlayer != null)
 184              throw new IllegalStateException(&quot;can&#x27;t prepare a prepared player&quot;);
 185          prepareAsyncInternal();
 186      }
 187  
 188      @Override
 189      public void start() throws IllegalStateException {
 190          if (mInternalPlayer == null)
 191              return;
 192          mInternalPlayer.setPlayWhenReady(true);
 193      }
 194  
 195      @Override
 196      public void stop() throws IllegalStateException {
 197          if (mInternalPlayer == null)
 198              return;
 199          mInternalPlayer.release();
 200      }
 201  
 202      @Override
 203      public void pause() throws IllegalStateException {
 204          if (mInternalPlayer == null)
 205              return;
 206          mInternalPlayer.setPlayWhenReady(false);
 207      }
 208  
 209      @Override
 210      public void setWakeMode(Context context, int mode) {
 211          // FIXME: implement
 212      }
 213  
 214      @Override
 215      public void setScreenOnWhilePlaying(boolean screenOn) {
 216          // TODO: do nothing
 217      }
 218  
 219      @Override
 220      public IjkTrackInfo[] getTrackInfo() {
 221          // TODO: implement
 222          return null;
 223      }
 224  
 225      @Override
 226      public int getVideoWidth() {
 227          return mVideoWidth;
 228      }
 229  
 230      @Override
 231      public int getVideoHeight() {
 232          return mVideoHeight;
 233      }
 234  
 235      @Override
 236      public boolean isPlaying() {
 237          if (mInternalPlayer == null)
 238              return false;
 239          int state = mInternalPlayer.getPlaybackState();
 240          switch (state) {
 241              case Player.STATE_BUFFERING:
 242              case Player.STATE_READY:
 243                  return mInternalPlayer.getPlayWhenReady();
 244              case Player.STATE_IDLE:
 245              case Player.STATE_ENDED:
 246              default:
 247                  return false;
 248          }
 249      }
 250  
 251      @Override
 252      public void seekTo(long msec) throws IllegalStateException {
 253          if (mInternalPlayer == null)
 254              return;
 255          mInternalPlayer.seekTo(msec);
 256      }
 257  
 258      @Override
 259      public long getCurrentPosition() {
 260          if (mInternalPlayer == null)
 261              return 0;
 262          return mInternalPlayer.getCurrentPosition();
 263      }
 264  
 265      @Override
 266      public long getDuration() {
 267          if (mInternalPlayer == null)
 268              return 0;
 269          return mInternalPlayer.getDuration();
 270      }
 271  
 272      @Override
 273      public int getVideoSarNum() {
 274          return 1;
 275      }
 276  
 277      @Override
 278      public int getVideoSarDen() {
 279          return 1;
 280      }
 281  
 282      @Override
 283      public void reset() {
 284          if (mInternalPlayer != null) {
 285              mInternalPlayer.release();
 286              mInternalPlayer = null;
 287          }
 288          if (mExoHelper != null) {
 289              mExoHelper.release();
 290          }
 291          mSurface = null;
 292          mDataSource = null;
 293          mVideoWidth = 0;
 294          mVideoHeight = 0;










 295      }
 296  
 297      @Override
 298      public void setLooping(boolean looping) {
 299          isLooping = looping;
 300      }
 301  
 302      @Override
 303      public boolean isLooping() {
 304          return isLooping;
 305      }
 306  
 307      @Override
 308      public void setVolume(float leftVolume, float rightVolume) {
 309          if (mInternalPlayer != null)
 310              mInternalPlayer.setVolume((leftVolume + rightVolume) / 2);
 311      }
 312  
 313      @Override
 314      public int getAudioSessionId() {
 315          return audioSessionId;
 316      }
 317  
 318      @Override
 319      public MediaInfo getMediaInfo() {
 320          return null;
 321      }
 322  
 323      @Override
 324      public void setLogEnabled(boolean enable) {
 325          // do nothing
 326      }
 327  
 328      @Override
 329      public boolean isPlayable() {
 330          return true;
 331      }
 332  
 333      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 334 -    public void setAudioStreamType(int streamtype) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 335 +    public void setAudioStreamType(int streamType) {</span>
 336          // do nothing
 337      }
 338  
 339      @Override
 340      public void setKeepInBackground(boolean keepInBackground) {
 341          // do nothing
 342      }
 343  
 344      @Override
 345      public void release() {
 346          if (mInternalPlayer != null) {
 347              reset();
 348              mEventLogger = null;
 349          }
 350      }
 351  
 352      protected void prepareAsyncInternal() {
 353          new Handler(Looper.myLooper()).post(
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 354 -                new Runnable() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 355 -                    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 356 -                    public void run() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 357 -                        if (mTrackSelector == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 358 -                            mTrackSelector = new DefaultTrackSelector(mAppContext);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 359 -                        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 360 -                        mEventLogger = new EventLogger(mTrackSelector);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 361 -                        boolean preferExtensionDecoders = true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 362 -                        boolean useExtensionRenderers = true;//ÊòØÂê¶ÂºÄÂêØÊâ©Â±ï</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 363 -                        @DefaultRenderersFactory.ExtensionRendererMode int extensionRendererMode = useExtensionRenderers"> 363 -                        @DefaultRenderersFactory.ExtensionRendererMode int extensionRendererMode = useExtensionRenüîµ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 364 -                                ? (preferExtensionDecoders ? DefaultRenderersFactory.EXTENSION_RENDERER_MODE_PREFER"> 364 -                                ? (preferExtensionDecoders ? DefaultRenderersFactory.EXTENSION_RENDERER_MODE_PREFEüîµ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 365 -                                : DefaultRenderersFactory.EXTENSION_RENDERER_MODE_ON)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 366 -                                : DefaultRenderersFactory.EXTENSION_RENDERER_MODE_OFF;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 367 -                        if (mRendererFactory == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 368 -                            mRendererFactory = new DefaultRenderersFactory(mAppContext);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 369 -                            mRendererFactory.setExtensionRendererMode(extensionRendererMode);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 370 -                        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 371 -                        if (mLoadControl == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 372 -                            mLoadControl = new DefaultLoadControl();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 373 -                        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 374 -                        mInternalPlayer = new SimpleExoPlayer.Builder(mAppContext, mRendererFactory)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 375 -                                .setLooper(Looper.myLooper())</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 376 -                                .setTrackSelector(mTrackSelector)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 377 -                                .setLoadControl(mLoadControl).build();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 378 -                        mInternalPlayer.addListener(IjkExo2MediaPlayer.this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 379 -                        mInternalPlayer.addAnalyticsListener(IjkExo2MediaPlayer.this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 380 -                        mInternalPlayer.addListener(mEventLogger);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 381 -                        if (mSpeedPlaybackParameters != null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 382 -                            mInternalPlayer.setPlaybackParameters(mSpeedPlaybackParameters);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 383 -                        }</span>



<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 384 -                        if (mSurface != null)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 385 -                            mInternalPlayer.setVideoSurface(mSurface);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 386 -                        mInternalPlayer.setMediaSource(mMediaSource);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 387 -                        mInternalPlayer.prepare();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 388 -                        mInternalPlayer.setPlayWhenReady(false);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 389 +                () -&gt; {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 390 +                    if (mTrackSelector == null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 391 +                        mTrackSelector = new DefaultTrackSelector(mAppContext);</span>
 392                      }
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 393 +                    mEventLogger = new EventLogger(mTrackSelector);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 394 +                    boolean preferExtensionDecoders = true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 395 +                    boolean useExtensionRenderers = true;//ÊòØÂê¶ÂºÄÂêØÊâ©Â±ï</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 396 +                    @DefaultRenderersFactory.ExtensionRendererMode int extensionRendererMode = useExtensionRenderers"> 396 +                    @DefaultRenderersFactory.ExtensionRendererMode int extensionRendererMode = useExtensionRendereüîµ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 397 +                            ? (preferExtensionDecoders ? DefaultRenderersFactory.EXTENSION_RENDERER_MODE_PREFER</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 398 +                            : DefaultRenderersFactory.EXTENSION_RENDERER_MODE_ON)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 399 +                            : DefaultRenderersFactory.EXTENSION_RENDERER_MODE_OFF;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 400 +                    if (mRendererFactory == null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 401 +                        mRendererFactory = new DefaultRenderersFactory(mAppContext);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 402 +                        mRendererFactory.setExtensionRendererMode(extensionRendererMode);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 403 +                    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 404 +                    if (mLoadControl == null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 405 +                        mLoadControl = new DefaultLoadControl();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 406 +                    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 407 +                    mInternalPlayer = new SimpleExoPlayer.Builder(mAppContext, mRendererFactory)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 408 +                            .setLooper(Looper.myLooper())</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 409 +                            .setTrackSelector(mTrackSelector)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 410 +                            .setLoadControl(mLoadControl).build();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 411 +                    mInternalPlayer.addListener(IjkExo2MediaPlayer.this);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 412 +                    mInternalPlayer.addAnalyticsListener(IjkExo2MediaPlayer.this);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 413 +                    mInternalPlayer.addListener(mEventLogger);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 414 +                    if (mSpeedPlaybackParameters != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 415 +                        mInternalPlayer.setPlaybackParameters(mSpeedPlaybackParameters);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 416 +                    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 417 +                    if (mSurface != null)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 418 +                        mInternalPlayer.setVideoSurface(mSurface);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 419 +                    mInternalPlayer.setMediaSource(mMediaSource);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 420 +                    mInternalPlayer.prepare();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 421 +                    mInternalPlayer.setPlayWhenReady(false);</span>
 422                  }
 423          );
 424      }
 425  
 426      public String getOverrideExtension() {
 427          return mOverrideExtension;
 428      }
 429  
 430      public void setOverrideExtension(String overrideExtension) {
 431          this.mOverrideExtension = overrideExtension;
 432      }
 433  
 434      public void stopPlayback() {
 435          mInternalPlayer.stop();
 436      }
 437  
 438      /**
 439       * ÊòØÂê¶ÈúÄË¶ÅÂ∏¶‰∏äheader
 440       * setDataSource‰πãÂâçÁîüÊïà
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 441 -     *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 442 -     * @param preview</span>
 443       */
 444      public void setPreview(boolean preview) {
 445          isPreview = preview;
 446      }
 447  
 448      public boolean isPreview() {
 449          return isPreview;
 450      }
 451  
 452      public boolean isCache() {
 453          return isCache;
 454      }
 455  
 456  
 457      /**
 458       * ËÆæÁΩÆseek ÁöÑ‰∏¥ËøëÂ∏ß„ÄÇ
 459       **/
 460      public void setSeekParameter(@Nullable SeekParameters seekParameters) {
 461          mInternalPlayer.setSeekParameters(seekParameters);
 462      }
 463  
 464  
 465      /**
 466       * ÊòØÂê¶ÂºÄÂêØcache
 467       * setDataSource‰πãÂâçÁîüÊïà
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 468 -     *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 469 -     * @param cache</span>
 470       */
 471      public void setCache(boolean cache) {
 472          isCache = cache;
 473      }
 474  
 475      public File getCacheDir() {
 476          return mCacheDir;
 477      }
 478  
 479      /**
 480       * cacheÊñá‰ª∂ÁöÑÁõÆÂΩï
 481       * setDataSource‰πãÂâçÁîüÊïà
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 482 -     *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 483 -     * @param cacheDir</span>
 484       */
 485      public void setCacheDir(File cacheDir) {
 486          this.mCacheDir = cacheDir;
 487      }
 488  
 489      public MediaSource getMediaSource() {
 490          return mMediaSource;
 491      }
 492  
 493      public void setMediaSource(MediaSource mediaSource) {
 494          this.mMediaSource = mediaSource;
 495      }
 496  
 497      public ExoSourceManager getExoHelper() {
 498          return mExoHelper;
 499      }
 500  
 501      /**
 502       * ÂÄçÈÄüÊí≠Êîæ
 503       *
 504       * @param speed ÂÄçÈÄüÊí≠ÊîæÔºåÈªòËÆ§‰∏∫1
 505       * @param pitch Èü≥ÈáèÁº©ÊîæÔºåÈªòËÆ§‰∏∫1Ôºå‰øÆÊîπ‰ºöÂØºËá¥Â£∞Èü≥ÂèòË∞É
 506       */
 507      public void setSpeed(@Size(min = 0) float speed, @Size(min = 0) float pitch) {
 508          PlaybackParameters playbackParameters = new PlaybackParameters(speed, pitch);
 509          mSpeedPlaybackParameters = playbackParameters;
 510          if (mInternalPlayer != null) {
 511              mInternalPlayer.setPlaybackParameters(playbackParameters);
 512          }
 513      }
 514  
 515      public float getSpeed() {
 516          return mInternalPlayer.getPlaybackParameters().speed;
 517      }
 518  
 519      public int getBufferedPercentage() {
 520          if (mInternalPlayer == null)
 521              return 0;
 522  
 523          return mInternalPlayer.getBufferedPercentage();
 524      }
 525  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 526 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 527 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 528 -    public void onTimelineChanged(Timeline timeline, Object manifest, int reason) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 529 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 530 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 531 -</span>
 532      public MappingTrackSelector getTrackSelector() {
 533          return mTrackSelector;
 534      }
 535  
 536      public void setTrackSelector(MappingTrackSelector trackSelector) {
 537          this.mTrackSelector = trackSelector;
 538      }
 539  
 540      public LoadControl getLoadControl() {
 541          return mLoadControl;
 542      }
 543  
 544      public void setLoadControl(LoadControl loadControl) {
 545          this.mLoadControl = loadControl;
 546      }
 547  
 548      public DefaultRenderersFactory getRendererFactory() {
 549          return mRendererFactory;
 550      }
 551  
 552      public void setRendererFactory(DefaultRenderersFactory rendererFactory) {
 553          this.mRendererFactory = rendererFactory;
 554      }
 555  
 556      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 557 -    public void onTracksChanged(TrackGroupArray trackGroups, TrackSelectionArray trackSelections) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 558 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 559 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 560 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 561 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 562 -    public void onLoadingChanged(boolean isLoading) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 563 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 564 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 565 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 566 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 567 -    public void onPlayerStateChanged(boolean playWhenReady, int playbackState) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 568 +    public void onTracksChanged(@NonNull TrackGroupArray trackGroups, @NonNull TrackSelectionArray trackSelections) {"> 568 +    public void onTracksChanged(@NonNull TrackGroupArray trackGroups, @NonNull TrackSelectionArray trackSelectionsüîµ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 569 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 570 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 571 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 572 +    public void onPlayerStateChanged(boolean playWhenReady, @Player.State int playbackState) {</span>






 573          //ÈáçÊñ∞Êí≠ÊîæÁä∂ÊÄÅÈ°∫Â∫è‰∏∫ÔºöSTATE_IDLE -„ÄãSTATE_BUFFERING -„ÄãSTATE_READY
 574          //ÁºìÂÜ≤Êó∂È°∫Â∫è‰∏∫ÔºöSTATE_BUFFERING -„ÄãSTATE_READY
<abbr title=" 575          //Log.e(TAG, &quot;onPlayerStateChanged: playWhenReady = &quot; + playWhenReady + &quot;, playbackState = &quot; + playbackState);"> 575          //Log.e(TAG, &quot;onPlayerStateChanged: playWhenReady = &quot; + playWhenReady + &quot;, playbackState = &quot; + playbackStaüîµ</abbr>
 576          if (isLastReportedPlayWhenReady != playWhenReady || lastReportedPlaybackState != playbackState) {
 577              int buffer = 0;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 578 -            if(mInternalPlayer != null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 579 -                buffer =  mInternalPlayer.getBufferedPercentage();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 580 +            if (mInternalPlayer != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 581 +                buffer = mInternalPlayer.getBufferedPercentage();</span>
 582              }
 583              if (isBuffering) {
 584                  switch (playbackState) {
 585                      case Player.STATE_ENDED:
 586                      case Player.STATE_READY:
 587                          notifyOnInfo(IMediaPlayer.MEDIA_INFO_BUFFERING_END, buffer);
 588                          isBuffering = false;
 589                          break;
 590                  }
 591              }
 592  
 593              if (isPreparing) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 594 -                switch (playbackState) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 595 -                    case Player.STATE_READY:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 596 -                        notifyOnPrepared();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 597 -                        isPreparing = false;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 598 -                        break;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 599 +                if (playbackState == Player.STATE_READY) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 600 +                    notifyOnPrepared();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 601 +                    isPreparing = false;</span>
 602                  }
 603              }
 604  
 605              switch (playbackState) {
 606                  case Player.STATE_BUFFERING:
 607                      notifyOnInfo(IMediaPlayer.MEDIA_INFO_BUFFERING_START, buffer);
 608                      isBuffering = true;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 609 -                    break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 610 -                case Player.STATE_READY:</span>
 611                      break;
 612                  case Player.STATE_ENDED:
 613                      notifyOnCompletion();
 614                      break;
 615                  default:
 616                      break;
 617              }
 618          }
 619          isLastReportedPlayWhenReady = playWhenReady;
 620          lastReportedPlaybackState = playbackState;
 621      }
 622  
 623      @Override
 624      public void onRepeatModeChanged(int repeatMode) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 625 -</span>
 626      }
 627  
 628      @Override
 629      public void onShuffleModeEnabledChanged(boolean shuffleModeEnabled) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 630 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 631 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 632 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 633 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 634 -    public void onPlayerError(ExoPlaybackException error) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 635 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 636 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 637 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 638 +    public void onPlayerError(@NonNull ExoPlaybackException error) {</span>
 639          notifyOnError(IMediaPlayer.MEDIA_ERROR_UNKNOWN, IMediaPlayer.MEDIA_ERROR_UNKNOWN);
 640      }
 641  
 642      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 643 -    public void onPositionDiscontinuity(int reason) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 644 -</span>





<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 645 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 646 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 647 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 648 -    public void onPlaybackParametersChanged(PlaybackParameters playbackParameters) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 649 -</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 650 +    public void onPlaybackParametersChanged(@NonNull PlaybackParameters playbackParameters) {</span>
 651      }
 652  
 653      @Override
 654      public void onSeekProcessed() {
 655          notifyOnSeekComplete();
 656      }
 657  
 658      /////////////////////////////////////AudioRendererEventListener/////////////////////////////////////////////
 659  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 660 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 661 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 662 -    public void onPlayerStateChanged(EventTime eventTime, boolean playWhenReady, int playbackState) {</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 663 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 664 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 665 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 666 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 667 -    public void onTimelineChanged(EventTime eventTime, int reason) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 668 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 669 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 670 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 671 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 672 -    public void onPositionDiscontinuity(EventTime eventTime, int reason) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 673 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 674 +    public void onTimelineChanged(@NonNull EventTime eventTime, int reason) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 675 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 676 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 677 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 678 +    public void onPositionDiscontinuity(</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 679 +            @NonNull EventTime eventTime,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 680 +            @NonNull Player.PositionInfo oldPosition,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 681 +            @NonNull Player.PositionInfo newPosition,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 682 +            @Player.DiscontinuityReason int reason</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 683 +    ) {</span>
 684          notifyOnInfo(ON_POSITION_DISCOUNTINUITY, reason);
 685      }
 686  
 687      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 688 -    public void onSeekStarted(EventTime eventTime) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 689 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 690 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 691 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 692 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 693 -    public void onSeekProcessed(EventTime eventTime) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 694 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 695 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 696 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 697 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 698 -    public void onPlaybackParametersChanged(EventTime eventTime, PlaybackParameters playbackParameters) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 699 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 700 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 701 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 702 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 703 -    public void onRepeatModeChanged(EventTime eventTime, int repeatMode) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 704 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 705 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 706 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 707 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 708 -    public void onShuffleModeChanged(EventTime eventTime, boolean shuffleModeEnabled) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 709 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 710 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 711 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 712 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 713 -    public void onLoadingChanged(EventTime eventTime, boolean isLoading) {</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 714 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 715 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 716 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 717 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 718 -    public void onPlayerError(EventTime eventTime, ExoPlaybackException error) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 719 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 720 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 721 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 722 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 723 -    public void onTracksChanged(EventTime eventTime, TrackGroupArray trackGroups, TrackSelectionArray trackSelections) {"> 723 -    public void onTracksChanged(EventTime eventTime, TrackGroupArray trackGroups, TrackSelectionArray trackSelectiüîµ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 724 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 725 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 726 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 727 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 728 -    public void onBandwidthEstimate(EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaded, long bitrateEstimate) {"> 728 -    public void onBandwidthEstimate(EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaded, long bitrateEüîµ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 729 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 730 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 731 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 732 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 733 -    public void onMetadata(EventTime eventTime, Metadata metadata) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 734 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 735 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 736 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 737 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 738 -    public void onDecoderEnabled(EventTime eventTime, int trackType, DecoderCounters decoderCounters) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 739 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 740 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 741 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 742 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 743 -    public void onDecoderInitialized(EventTime eventTime, int trackType, String decoderName, long initializationDurationMs) {"> 743 -    public void onDecoderInitialized(EventTime eventTime, int trackType, String decoderName, long initializationDuüîµ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 744 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 745 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 746 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 747 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 748 -    public void onDecoderInputFormatChanged(EventTime eventTime, int trackType, Format format) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 749 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 750 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 751 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 752 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 753 -    public void onDecoderDisabled(EventTime eventTime, int trackType, DecoderCounters decoderCounters) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 754 +    public void onPlaybackParametersChanged(@NonNull EventTime eventTime, @NonNull PlaybackParameters playbackParameters) {"> 754 +    public void onPlaybackParametersChanged(@NonNull EventTime eventTime, @NonNull PlaybackParameters playbackParaüîµ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 755 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 756 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 757 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 758 +    public void onRepeatModeChanged(@NonNull EventTime eventTime, int repeatMode) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 759 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 760 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 761 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 762 +    public void onShuffleModeChanged(@NonNull EventTime eventTime, boolean shuffleModeEnabled) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 763 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 764 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 765 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 766 +    public void onPlayerError(@NonNull EventTime eventTime, @NonNull ExoPlaybackException error) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 767 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 768 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 769 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 770 +    public void onTracksChanged(@NonNull EventTime eventTime, @NonNull TrackGroupArray trackGroups, @NonNull TrackSelectionArray trackSelections) {"> 770 +    public void onTracksChanged(@NonNull EventTime eventTime, @NonNull TrackGroupArray trackGroups, @NonNull Tracküîµ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 771 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 772 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 773 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 774 +    public void onBandwidthEstimate(@NonNull EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaded, long bitrateEstimate) {"> 774 +    public void onBandwidthEstimate(@NonNull EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaded, longüîµ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 775 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 776 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 777 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 778 +    public void onMetadata(@NonNull EventTime eventTime, @NonNull Metadata metadata) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 779 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 780 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 781 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 782 +    public void onDecoderDisabled(@NonNull EventTime eventTime, int trackType, @NonNull DecoderCounters decoderCounters) {"> 782 +    public void onDecoderDisabled(@NonNull EventTime eventTime, int trackType, @NonNull DecoderCounters decoderCouüîµ</abbr></span>
 783          audioSessionId = C.AUDIO_SESSION_ID_UNSET;
 784      }
 785  
 786      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 787 -    public void onAudioUnderrun(EventTime eventTime, int bufferSize, long bufferSizeMs, long elapsedSinceLastFeedMs) {"> 787 -    public void onAudioUnderrun(EventTime eventTime, int bufferSize, long bufferSizeMs, long elapsedSinceLastFeedMüîµ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 788 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 789 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 790 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 791 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 792 -    public void onDroppedVideoFrames(EventTime eventTime, int droppedFrames, long elapsedMs) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 793 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 794 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 795 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 796 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 797 -    public void onVideoSizeChanged(EventTime eventTime, int width, int height, int unappliedRotationDegrees, float pixelWidthHeightRatio) {"> 797 -    public void onVideoSizeChanged(EventTime eventTime, int width, int height, int unappliedRotationDegrees, floatüîµ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 798 -        mVideoWidth = (int) (width * pixelWidthHeightRatio);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 799 -        mVideoHeight = height;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 800 -        notifyOnVideoSizeChanged((int) (width * pixelWidthHeightRatio), height, 1, 1);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 801 -        if (unappliedRotationDegrees &gt; 0)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 802 -            notifyOnInfo(IMediaPlayer.MEDIA_INFO_VIDEO_ROTATION_CHANGED, unappliedRotationDegrees);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 803 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 804 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 805 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 806 -    public void onRenderedFirstFrame(EventTime eventTime, Surface surface) {</span>











<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 807 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 808 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 809 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 810 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 811 -    public void onDrmKeysLoaded(EventTime eventTime) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 812 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 813 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 814 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 815 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 816 -    public void onDrmSessionManagerError(EventTime eventTime, Exception error) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 817 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 818 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 819 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 820 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 821 -    public void onDrmKeysRestored(EventTime eventTime) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 822 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 823 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 824 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 825 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 826 -    public void onDrmKeysRemoved(EventTime eventTime) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 827 -</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 828 +    public void onAudioUnderrun(@NonNull EventTime eventTime, int bufferSize, long bufferSizeMs, long elapsedSinceLastFeedMs) {"> 828 +    public void onAudioUnderrun(@NonNull EventTime eventTime, int bufferSize, long bufferSizeMs, long elapsedSinceüîµ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 829 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 830 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 831 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 832 +    public void onDroppedVideoFrames(@NonNull EventTime eventTime, int droppedFrames, long elapsedMs) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 833 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 834 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 835 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 836 +    public void onVideoSizeChanged(@NonNull EventTime eventTime, @NonNull VideoSize videoSize) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 837 +        mVideoWidth = (int) (videoSize.width * videoSize.pixelWidthHeightRatio);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 838 +        mVideoHeight = videoSize.height;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 839 +        notifyOnVideoSizeChanged((int) (videoSize.width * videoSize.pixelWidthHeightRatio), videoSize.height, 1, 1);"> 839 +        notifyOnVideoSizeChanged((int) (videoSize.width * videoSize.pixelWidthHeightRatio), videoSize.height, 1, 1üîµ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 840 +        if (videoSize.unappliedRotationDegrees &gt; 0)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 841 +            notifyOnInfo(IMediaPlayer.MEDIA_INFO_VIDEO_ROTATION_CHANGED, videoSize.unappliedRotationDegrees);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 842 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 843 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 844 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 845 +    public void onRenderedFirstFrame(@NonNull EventTime eventTime, @NonNull Object output, long renderTimeMs) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 846 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 847 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 848 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 849 +    public void onDrmKeysLoaded(@NonNull EventTime eventTime) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 850 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 851 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 852 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 853 +    public void onDrmSessionManagerError(@NonNull EventTime eventTime, @NonNull Exception error) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 854 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 855 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 856 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 857 +    public void onDrmKeysRestored(@NonNull EventTime eventTime) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 858 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 859 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 860 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 861 +    public void onDrmKeysRemoved(@NonNull EventTime eventTime) {</span>
 862      }
 863  }</pre></td>
                            <td><pre>   1  
   2  package tv.danmaku.ijk.media.exo2;
   3  
   4  import android.content.Context;
   5  import android.net.Uri;
   6  import android.os.Handler;
   7  import android.os.Looper;
   8  




   9  import androidx.annotation.Nullable;
  10  import androidx.annotation.Size;
  11  
  12  import android.view.Surface;
  13  import android.view.SurfaceHolder;
  14  
  15  import com.google.android.exoplayer2.C;
  16  import com.google.android.exoplayer2.DefaultLoadControl;
  17  import com.google.android.exoplayer2.DefaultRenderersFactory;
  18  import com.google.android.exoplayer2.ExoPlaybackException;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  19 -import com.google.android.exoplayer2.Format;</span>
  20  import com.google.android.exoplayer2.LoadControl;
  21  import com.google.android.exoplayer2.PlaybackParameters;
  22  import com.google.android.exoplayer2.Player;
  23  import com.google.android.exoplayer2.SeekParameters;
  24  import com.google.android.exoplayer2.SimpleExoPlayer;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  25 -import com.google.android.exoplayer2.Timeline;</span>
  26  import com.google.android.exoplayer2.analytics.AnalyticsListener;
  27  import com.google.android.exoplayer2.decoder.DecoderCounters;
  28  import com.google.android.exoplayer2.metadata.Metadata;
  29  import com.google.android.exoplayer2.source.MediaSource;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  30 -import com.google.android.exoplayer2.source.MediaSourceEventListener;</span>
  31  import com.google.android.exoplayer2.source.TrackGroupArray;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  32 +import com.google.android.exoplayer2.text.Cue;</span>
  33  import com.google.android.exoplayer2.trackselection.DefaultTrackSelector;
  34  import com.google.android.exoplayer2.trackselection.MappingTrackSelector;
  35  import com.google.android.exoplayer2.trackselection.TrackSelectionArray;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  36 +import com.google.android.exoplayer2.video.VideoSize;</span>
  37  
  38  import java.io.File;
  39  import java.io.FileDescriptor;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  40 -import java.io.IOException;</span>
  41  import java.util.HashMap;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  42 +import java.util.List;</span>
  43  import java.util.Map;
  44  
  45  import tv.danmaku.ijk.media.exo2.demo.EventLogger;
  46  import tv.danmaku.ijk.media.player.AbstractMediaPlayer;
  47  import tv.danmaku.ijk.media.player.IMediaPlayer;
  48  import tv.danmaku.ijk.media.player.MediaInfo;
  49  import tv.danmaku.ijk.media.player.misc.IjkTrackInfo;
  50  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  51 +import static com.google.android.exoplayer2.Player.DISCONTINUITY_REASON_SEEK;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  52 +import static com.google.android.exoplayer2.Player.REPEAT_MODE_ALL;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  53 +</span>
  54  
  55  /**
  56   * Created by guoshuyu on 2018/1/10.
  57   * Exo
  58   */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  59 -public class IjkExo2MediaPlayer extends AbstractMediaPlayer implements Player.EventListener, AnalyticsListener {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  60 -</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  61 +public class IjkExo2MediaPlayer extends AbstractMediaPlayer implements Player.Listener, AnalyticsListener {</span>
  62  
  63      public static int ON_POSITION_DISCOUNTINUITY = 2702;




  64  
  65      private static final String TAG = &quot;IjkExo2MediaPlayer&quot;;
  66  
  67      protected Context mAppContext;

  68      protected SimpleExoPlayer mInternalPlayer;
  69      protected EventLogger mEventLogger;
  70      protected DefaultRenderersFactory mRendererFactory;
  71      protected MediaSource mMediaSource;
  72      protected MappingTrackSelector mTrackSelector;
  73      protected LoadControl mLoadControl;
  74      protected String mDataSource;
  75      protected Surface mSurface;
  76      protected Map&lt;String, String&gt; mHeaders = new HashMap&lt;&gt;();
  77      protected PlaybackParameters mSpeedPlaybackParameters;
  78      protected int mVideoWidth;
  79      protected int mVideoHeight;
  80      protected int lastReportedPlaybackState;
  81      protected boolean isLastReportedPlayWhenReady;
  82      protected boolean isPreparing = true;
  83      protected boolean isBuffering = false;
  84      protected boolean isLooping = false;
  85      /**
  86       * ÊòØÂê¶Â∏¶‰∏äheader
  87       */
  88      protected boolean isPreview = false;
  89      /**
  90       * ÊòØÂê¶ÂºÄÂêØÁºìÂ≠ò
  91       */
  92      protected boolean isCache = false;
  93      /**
  94       * dataSourceÁ≠âÁöÑÂ∏ÆÁªÑÁ±ª
  95       */
  96      protected ExoSourceManager mExoHelper;

  97      /**
  98       * ÁºìÂ≠òÁõÆÂΩïÔºåÂèØ‰ª•‰∏∫Á©∫
  99       */
 100      protected File mCacheDir;
 101      /**
 102       * Á±ªÂûãË¶ÜÁõñ
 103       */
 104      private String mOverrideExtension;
 105  
 106      protected int audioSessionId = C.AUDIO_SESSION_ID_UNSET;
 107  
 108  
 109      public IjkExo2MediaPlayer(Context context) {
 110          mAppContext = context.getApplicationContext();
 111          lastReportedPlaybackState = Player.STATE_IDLE;
 112          mExoHelper = ExoSourceManager.newInstance(context, mHeaders);
 113      }
 114  
 115  
 116      private int getVideoRendererIndex() {
 117          if (mInternalPlayer != null) {
 118              for (int i = 0; i &lt; mInternalPlayer.getRendererCount(); i++) {
 119                  if (mInternalPlayer.getRendererType(i) == C.TRACK_TYPE_VIDEO) {
 120                      return i;
 121                  }
 122              }
 123          }
 124          return 0;
 125      }
 126  
 127      @Override
 128      public void setDisplay(SurfaceHolder sh) {
 129          if (sh == null)
 130              setSurface(null);
 131          else
 132              setSurface(sh.getSurface());
 133      }
 134  
 135      @Override
 136      public void setSurface(Surface surface) {
 137          mSurface = surface;
 138          if (mInternalPlayer != null) {
 139              if (surface != null &amp;&amp; !surface.isValid()) {
 140                  mSurface = null;
 141              }
 142              mInternalPlayer.setVideoSurface(surface);
 143          }
 144      }
 145  
 146  
 147      @Override
 148      public void setDataSource(Context context, Uri uri, Map&lt;String, String&gt; headers) {
 149          if (headers != null) {
 150              mHeaders.clear();
 151              mHeaders.putAll(headers);
 152          }
 153          setDataSource(context, uri);
 154      }
 155  
 156      @Override
 157      public void setDataSource(String path) {
 158          setDataSource(mAppContext, Uri.parse(path));
 159      }
 160  
 161      @Override
 162      public void setDataSource(Context context, Uri uri) {
 163          mDataSource = uri.toString();
<abbr title=" 164          mMediaSource = mExoHelper.getMediaSource(mDataSource, isPreview, isCache, isLooping, mCacheDir, mOverrideExtension);"> 164          mMediaSource = mExoHelper.getMediaSource(mDataSource, isPreview, isCache, isLooping, mCacheDir, mOverrideEüîµ</abbr>
 165      }
 166  
 167      @Override
 168      public void setDataSource(FileDescriptor fd) {
 169          throw new UnsupportedOperationException(&quot;no support&quot;);
 170      }
 171  
 172      @Override
 173      public String getDataSource() {
 174          return mDataSource;
 175      }
 176  
 177      @Override
 178      public void prepareAsync() throws IllegalStateException {
 179          if (mInternalPlayer != null)
 180              throw new IllegalStateException(&quot;can&#x27;t prepare a prepared player&quot;);
 181          prepareAsyncInternal();
 182      }
 183  
 184      @Override
 185      public void start() throws IllegalStateException {
 186          if (mInternalPlayer == null)
 187              return;
 188          mInternalPlayer.setPlayWhenReady(true);
 189      }
 190  
 191      @Override
 192      public void stop() throws IllegalStateException {
 193          if (mInternalPlayer == null)
 194              return;
 195          mInternalPlayer.release();
 196      }
 197  
 198      @Override
 199      public void pause() throws IllegalStateException {
 200          if (mInternalPlayer == null)
 201              return;
 202          mInternalPlayer.setPlayWhenReady(false);
 203      }
 204  
 205      @Override
 206      public void setWakeMode(Context context, int mode) {
 207          // FIXME: implement
 208      }
 209  
 210      @Override
 211      public void setScreenOnWhilePlaying(boolean screenOn) {
 212          // TODO: do nothing
 213      }
 214  
 215      @Override
 216      public IjkTrackInfo[] getTrackInfo() {
 217          // TODO: implement
 218          return null;
 219      }
 220  
 221      @Override
 222      public int getVideoWidth() {
 223          return mVideoWidth;
 224      }
 225  
 226      @Override
 227      public int getVideoHeight() {
 228          return mVideoHeight;
 229      }
 230  
 231      @Override
 232      public boolean isPlaying() {
 233          if (mInternalPlayer == null)
 234              return false;
 235          int state = mInternalPlayer.getPlaybackState();
 236          switch (state) {
 237              case Player.STATE_BUFFERING:
 238              case Player.STATE_READY:
 239                  return mInternalPlayer.getPlayWhenReady();
 240              case Player.STATE_IDLE:
 241              case Player.STATE_ENDED:
 242              default:
 243                  return false;
 244          }
 245      }
 246  
 247      @Override
 248      public void seekTo(long msec) throws IllegalStateException {
 249          if (mInternalPlayer == null)
 250              return;
 251          mInternalPlayer.seekTo(msec);
 252      }
 253  
 254      @Override
 255      public long getCurrentPosition() {
 256          if (mInternalPlayer == null)
 257              return 0;
 258          return mInternalPlayer.getCurrentPosition();
 259      }
 260  
 261      @Override
 262      public long getDuration() {
 263          if (mInternalPlayer == null)
 264              return 0;
 265          return mInternalPlayer.getDuration();
 266      }
 267  
 268      @Override
 269      public int getVideoSarNum() {
 270          return 1;
 271      }
 272  
 273      @Override
 274      public int getVideoSarDen() {
 275          return 1;
 276      }
 277  
 278      @Override
 279      public void reset() {
 280          if (mInternalPlayer != null) {
 281              mInternalPlayer.release();
 282              mInternalPlayer = null;
 283          }
 284          if (mExoHelper != null) {
 285              mExoHelper.release();
 286          }
 287          mSurface = null;
 288          mDataSource = null;
 289          mVideoWidth = 0;
 290          mVideoHeight = 0;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 291 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 292 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 293 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 294 +    public void onCues(List&lt;Cue&gt; cues) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 295 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 296 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 297 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 298 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 299 +    public void onMetadata(Metadata metadata) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 300 +</span>
 301      }
 302  
 303      @Override
 304      public void setLooping(boolean looping) {
 305          isLooping = looping;
 306      }
 307  
 308      @Override
 309      public boolean isLooping() {
 310          return isLooping;
 311      }
 312  
 313      @Override
 314      public void setVolume(float leftVolume, float rightVolume) {
 315          if (mInternalPlayer != null)
 316              mInternalPlayer.setVolume((leftVolume + rightVolume) / 2);
 317      }
 318  
 319      @Override
 320      public int getAudioSessionId() {
 321          return audioSessionId;
 322      }
 323  
 324      @Override
 325      public MediaInfo getMediaInfo() {
 326          return null;
 327      }
 328  
 329      @Override
 330      public void setLogEnabled(boolean enable) {
 331          // do nothing
 332      }
 333  
 334      @Override
 335      public boolean isPlayable() {
 336          return true;
 337      }
 338  
 339      @Override
 340      public void setAudioStreamType(int streamtype) {

 341          // do nothing
 342      }
 343  
 344      @Override
 345      public void setKeepInBackground(boolean keepInBackground) {
 346          // do nothing
 347      }
 348  
 349      @Override
 350      public void release() {
 351          if (mInternalPlayer != null) {
 352              reset();
 353              mEventLogger = null;
 354          }
 355      }
 356  
 357      protected void prepareAsyncInternal() {
 358          new Handler(Looper.myLooper()).post(
 359                  new Runnable() {
 360                      @Override
 361                      public void run() {
 362                          if (mTrackSelector == null) {
 363                              mTrackSelector = new DefaultTrackSelector(mAppContext);
 364                          }
 365                          mEventLogger = new EventLogger(mTrackSelector);
 366                          boolean preferExtensionDecoders = true;
 367                          boolean useExtensionRenderers = true;//ÊòØÂê¶ÂºÄÂêØÊâ©Â±ï
<abbr title=" 368                          @DefaultRenderersFactory.ExtensionRendererMode int extensionRendererMode = useExtensionRenderers"> 368                          @DefaultRenderersFactory.ExtensionRendererMode int extensionRendererMode = useExtensionRenüîµ</abbr>
<abbr title=" 369                                  ? (preferExtensionDecoders ? DefaultRenderersFactory.EXTENSION_RENDERER_MODE_PREFER"> 369                                  ? (preferExtensionDecoders ? DefaultRenderersFactory.EXTENSION_RENDERER_MODE_PREFEüîµ</abbr>
 370                                  : DefaultRenderersFactory.EXTENSION_RENDERER_MODE_ON)
 371                                  : DefaultRenderersFactory.EXTENSION_RENDERER_MODE_OFF;
 372                          if (mRendererFactory == null) {
 373                              mRendererFactory = new DefaultRenderersFactory(mAppContext);
 374                              mRendererFactory.setExtensionRendererMode(extensionRendererMode);
 375                          }
 376                          if (mLoadControl == null) {
 377                              mLoadControl = new DefaultLoadControl();
 378                          }
 379                          mInternalPlayer = new SimpleExoPlayer.Builder(mAppContext, mRendererFactory)
 380                                  .setLooper(Looper.myLooper())
 381                                  .setTrackSelector(mTrackSelector)
 382                                  .setLoadControl(mLoadControl).build();
 383                          mInternalPlayer.addListener(IjkExo2MediaPlayer.this);
 384                          mInternalPlayer.addAnalyticsListener(IjkExo2MediaPlayer.this);
 385                          mInternalPlayer.addListener(mEventLogger);
 386                          if (mSpeedPlaybackParameters != null) {
 387                              mInternalPlayer.setPlaybackParameters(mSpeedPlaybackParameters);
 388                          }
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 389 +                        if (isLooping) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 390 +                            mInternalPlayer.setRepeatMode(REPEAT_MODE_ALL);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 391 +                        }</span>
 392                          if (mSurface != null)
 393                              mInternalPlayer.setVideoSurface(mSurface);
 394                          mInternalPlayer.setMediaSource(mMediaSource);
 395                          mInternalPlayer.prepare();
 396                          mInternalPlayer.setPlayWhenReady(false);



 397                      }





























 398                  }
 399          );
 400      }
 401  
 402      public String getOverrideExtension() {
 403          return mOverrideExtension;
 404      }
 405  
 406      public void setOverrideExtension(String overrideExtension) {
 407          this.mOverrideExtension = overrideExtension;
 408      }
 409  
 410      public void stopPlayback() {
 411          mInternalPlayer.stop();
 412      }
 413  
 414      /**
 415       * ÊòØÂê¶ÈúÄË¶ÅÂ∏¶‰∏äheader
 416       * setDataSource‰πãÂâçÁîüÊïà
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 417 -     *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 418 -     * @param preview</span>
 419       */
 420      public void setPreview(boolean preview) {
 421          isPreview = preview;
 422      }
 423  
 424      public boolean isPreview() {
 425          return isPreview;
 426      }
 427  
 428      public boolean isCache() {
 429          return isCache;
 430      }
 431  
 432  
 433      /**
 434       * ËÆæÁΩÆseek ÁöÑ‰∏¥ËøëÂ∏ß„ÄÇ
 435       **/
 436      public void setSeekParameter(@Nullable SeekParameters seekParameters) {
 437          mInternalPlayer.setSeekParameters(seekParameters);
 438      }
 439  
 440  
 441      /**
 442       * ÊòØÂê¶ÂºÄÂêØcache
 443       * setDataSource‰πãÂâçÁîüÊïà
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 444 -     *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 445 -     * @param cache</span>
 446       */
 447      public void setCache(boolean cache) {
 448          isCache = cache;
 449      }
 450  
 451      public File getCacheDir() {
 452          return mCacheDir;
 453      }
 454  
 455      /**
 456       * cacheÊñá‰ª∂ÁöÑÁõÆÂΩï
 457       * setDataSource‰πãÂâçÁîüÊïà
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 458 -     *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 459 -     * @param cacheDir</span>
 460       */
 461      public void setCacheDir(File cacheDir) {
 462          this.mCacheDir = cacheDir;
 463      }
 464  
 465      public MediaSource getMediaSource() {
 466          return mMediaSource;
 467      }
 468  
 469      public void setMediaSource(MediaSource mediaSource) {
 470          this.mMediaSource = mediaSource;
 471      }
 472  
 473      public ExoSourceManager getExoHelper() {
 474          return mExoHelper;
 475      }
 476  
 477      /**
 478       * ÂÄçÈÄüÊí≠Êîæ
 479       *
 480       * @param speed ÂÄçÈÄüÊí≠ÊîæÔºåÈªòËÆ§‰∏∫1
 481       * @param pitch Èü≥ÈáèÁº©ÊîæÔºåÈªòËÆ§‰∏∫1Ôºå‰øÆÊîπ‰ºöÂØºËá¥Â£∞Èü≥ÂèòË∞É
 482       */
 483      public void setSpeed(@Size(min = 0) float speed, @Size(min = 0) float pitch) {
 484          PlaybackParameters playbackParameters = new PlaybackParameters(speed, pitch);
 485          mSpeedPlaybackParameters = playbackParameters;
 486          if (mInternalPlayer != null) {
 487              mInternalPlayer.setPlaybackParameters(playbackParameters);
 488          }
 489      }
 490  
 491      public float getSpeed() {
 492          return mInternalPlayer.getPlaybackParameters().speed;
 493      }
 494  
 495      public int getBufferedPercentage() {
 496          if (mInternalPlayer == null)
 497              return 0;
 498  
 499          return mInternalPlayer.getBufferedPercentage();
 500      }
 501  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 502 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 503 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 504 -    public void onTimelineChanged(Timeline timeline, Object manifest, int reason) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 505 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 506 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 507 -</span>
 508      public MappingTrackSelector getTrackSelector() {
 509          return mTrackSelector;
 510      }
 511  
 512      public void setTrackSelector(MappingTrackSelector trackSelector) {
 513          this.mTrackSelector = trackSelector;
 514      }
 515  
 516      public LoadControl getLoadControl() {
 517          return mLoadControl;
 518      }
 519  
 520      public void setLoadControl(LoadControl loadControl) {
 521          this.mLoadControl = loadControl;
 522      }
 523  
 524      public DefaultRenderersFactory getRendererFactory() {
 525          return mRendererFactory;
 526      }
 527  
 528      public void setRendererFactory(DefaultRenderersFactory rendererFactory) {
 529          this.mRendererFactory = rendererFactory;
 530      }
 531  
 532      @Override
 533      public void onTracksChanged(TrackGroupArray trackGroups, TrackSelectionArray trackSelections) {
 534  
 535      }
 536  
 537      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 538 -    public void onLoadingChanged(boolean isLoading) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 539 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 540 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 541 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 542 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 543 -    public void onPlayerStateChanged(boolean playWhenReady, int playbackState) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 544 +    public void onIsLoadingChanged(boolean isLoading) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 545 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 546 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 547 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 548 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 549 +    public void onPlaybackStateChanged(int state) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 550 +        onPlayWhenReadyChanged(isLastReportedPlayWhenReady, state);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 551 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 552 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 553 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 554 +    public void onPlayWhenReadyChanged(boolean playWhenReady, int playbackState) {</span>
 555          //ÈáçÊñ∞Êí≠ÊîæÁä∂ÊÄÅÈ°∫Â∫è‰∏∫ÔºöSTATE_IDLE -„ÄãSTATE_BUFFERING -„ÄãSTATE_READY
 556          //ÁºìÂÜ≤Êó∂È°∫Â∫è‰∏∫ÔºöSTATE_BUFFERING -„ÄãSTATE_READY
<abbr title=" 557          //Log.e(TAG, &quot;onPlayerStateChanged: playWhenReady = &quot; + playWhenReady + &quot;, playbackState = &quot; + playbackState);"> 557          //Log.e(TAG, &quot;onPlayerStateChanged: playWhenReady = &quot; + playWhenReady + &quot;, playbackState = &quot; + playbackStaüîµ</abbr>
 558          if (isLastReportedPlayWhenReady != playWhenReady || lastReportedPlaybackState != playbackState) {
 559              int buffer = 0;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 560 -            if(mInternalPlayer != null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 561 -                buffer =  mInternalPlayer.getBufferedPercentage();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 562 +            if (mInternalPlayer != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 563 +                buffer = mInternalPlayer.getBufferedPercentage();</span>
 564              }
 565              if (isBuffering) {
 566                  switch (playbackState) {
 567                      case Player.STATE_ENDED:
 568                      case Player.STATE_READY:
 569                          notifyOnInfo(IMediaPlayer.MEDIA_INFO_BUFFERING_END, buffer);
 570                          isBuffering = false;
 571                          break;
 572                  }
 573              }
 574  
 575              if (isPreparing) {
 576                  switch (playbackState) {
 577                      case Player.STATE_READY:
 578                          notifyOnPrepared();
 579                          isPreparing = false;
 580                          break;



 581                  }
 582              }
 583  
 584              switch (playbackState) {
 585                  case Player.STATE_BUFFERING:
 586                      notifyOnInfo(IMediaPlayer.MEDIA_INFO_BUFFERING_START, buffer);
 587                      isBuffering = true;
 588                      break;
 589                  case Player.STATE_READY:
 590                      break;
 591                  case Player.STATE_ENDED:
 592                      notifyOnCompletion();
 593                      break;
 594                  default:
 595                      break;
 596              }
 597          }
 598          isLastReportedPlayWhenReady = playWhenReady;
 599          lastReportedPlaybackState = playbackState;
 600      }
 601  
 602      @Override
 603      public void onRepeatModeChanged(int repeatMode) {
 604  
 605      }
 606  
 607      @Override
 608      public void onShuffleModeEnabledChanged(boolean shuffleModeEnabled) {
 609  
 610      }
 611  
 612      @Override
 613      public void onPlayerError(ExoPlaybackException error) {




 614          notifyOnError(IMediaPlayer.MEDIA_ERROR_UNKNOWN, IMediaPlayer.MEDIA_ERROR_UNKNOWN);
 615      }
 616  
 617      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 618 -    public void onPositionDiscontinuity(int reason) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 619 -</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 620 +    public void onPositionDiscontinuity(Player.PositionInfo oldPosition, Player.PositionInfo newPosition, int reason) {"> 620 +    public void onPositionDiscontinuity(Player.PositionInfo oldPosition, Player.PositionInfo newPosition, int reasüîµ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 621 +        notifyOnInfo(ON_POSITION_DISCOUNTINUITY, reason);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 622 +        if (reason == DISCONTINUITY_REASON_SEEK) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 623 +            notifyOnSeekComplete();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 624 +        }</span>
 625      }
 626  
 627      @Override
 628      public void onPlaybackParametersChanged(PlaybackParameters playbackParameters) {
 629  

 630      }
 631  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 632 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 633 -    public void onSeekProcessed() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 634 -        notifyOnSeekComplete();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 635 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 636 -</span>
 637      /////////////////////////////////////AudioRendererEventListener/////////////////////////////////////////////
 638  
 639  
 640      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 641 -    public void onPlayerStateChanged(EventTime eventTime, boolean playWhenReady, int playbackState) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 642 +    public void onPlayWhenReadyChanged(EventTime eventTime, boolean playWhenReady, int playbackState) {</span>
 643  
 644      }
 645  
 646      @Override
 647      public void onTimelineChanged(EventTime eventTime, int reason) {
 648  
 649      }
 650  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 651 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 652 -    public void onPositionDiscontinuity(EventTime eventTime, int reason) {</span>











<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 653 -        notifyOnInfo(ON_POSITION_DISCOUNTINUITY, reason);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 654 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 655 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 656 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 657 -    public void onSeekStarted(EventTime eventTime) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 658 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 659 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 660 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 661 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 662 -    public void onSeekProcessed(EventTime eventTime) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 663 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 664 -    }</span>
 665  
 666      @Override
 667      public void onPlaybackParametersChanged(EventTime eventTime, PlaybackParameters playbackParameters) {
 668  
 669      }
 670  
 671      @Override
 672      public void onRepeatModeChanged(EventTime eventTime, int repeatMode) {
 673  
 674      }
 675  
 676      @Override
 677      public void onShuffleModeChanged(EventTime eventTime, boolean shuffleModeEnabled) {
 678  
 679      }
 680  
 681      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 682 -    public void onLoadingChanged(EventTime eventTime, boolean isLoading) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 683 +    public void onIsLoadingChanged(EventTime eventTime, boolean isLoading) {</span>
 684  
 685      }
 686  
 687      @Override
 688      public void onPlayerError(EventTime eventTime, ExoPlaybackException error) {
 689  
 690      }
 691  
 692      @Override
<abbr title=" 693      public void onTracksChanged(EventTime eventTime, TrackGroupArray trackGroups, TrackSelectionArray trackSelections) {"> 693      public void onTracksChanged(EventTime eventTime, TrackGroupArray trackGroups, TrackSelectionArray trackSelectiüîµ</abbr>
 694  
 695      }
 696  
 697      @Override
<abbr title=" 698      public void onBandwidthEstimate(EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaded, long bitrateEstimate) {"> 698      public void onBandwidthEstimate(EventTime eventTime, int totalLoadTimeMs, long totalBytesLoaded, long bitrateEüîµ</abbr>
 699  
 700      }
 701  
 702      @Override
 703      public void onMetadata(EventTime eventTime, Metadata metadata) {
 704  
 705      }
 706  
 707      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 708 -    public void onDecoderEnabled(EventTime eventTime, int trackType, DecoderCounters decoderCounters) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 709 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 710 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 711 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 712 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 713 -    public void onDecoderInitialized(EventTime eventTime, int trackType, String decoderName, long initializationDurationMs) {"> 713 -    public void onDecoderInitialized(EventTime eventTime, int trackType, String decoderName, long initializationDuüîµ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 714 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 715 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 716 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 717 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 718 -    public void onDecoderInputFormatChanged(EventTime eventTime, int trackType, Format format) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 719 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 720 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 721 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 722 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 723 -    public void onDecoderDisabled(EventTime eventTime, int trackType, DecoderCounters decoderCounters) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 724 +    public void onAudioDisabled(EventTime eventTime, DecoderCounters counters) {</span>




























 725          audioSessionId = C.AUDIO_SESSION_ID_UNSET;
 726      }
 727  
 728      @Override
<abbr title=" 729      public void onAudioUnderrun(EventTime eventTime, int bufferSize, long bufferSizeMs, long elapsedSinceLastFeedMs) {"> 729      public void onAudioUnderrun(EventTime eventTime, int bufferSize, long bufferSizeMs, long elapsedSinceLastFeedMüîµ</abbr>
 730  
 731      }
 732  
 733      @Override
 734      public void onDroppedVideoFrames(EventTime eventTime, int droppedFrames, long elapsedMs) {
 735  
 736      }
 737  
 738      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 739 -    public void onVideoSizeChanged(EventTime eventTime, int width, int height, int unappliedRotationDegrees, float pixelWidthHeightRatio) {"> 739 -    public void onVideoSizeChanged(EventTime eventTime, int width, int height, int unappliedRotationDegrees, floatüîµ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 740 -        mVideoWidth = (int) (width * pixelWidthHeightRatio);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 741 -        mVideoHeight = height;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 742 -        notifyOnVideoSizeChanged((int) (width * pixelWidthHeightRatio), height, 1, 1);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 743 -        if (unappliedRotationDegrees &gt; 0)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 744 -            notifyOnInfo(IMediaPlayer.MEDIA_INFO_VIDEO_ROTATION_CHANGED, unappliedRotationDegrees);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 745 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 746 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 747 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 748 -    public void onRenderedFirstFrame(EventTime eventTime, Surface surface) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 749 +    public void onVideoSizeChanged(EventTime eventTime, VideoSize videoSize) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 750 +        mVideoWidth = (int) (videoSize.width * videoSize.pixelWidthHeightRatio);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 751 +        mVideoHeight = videoSize.height;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 752 +        notifyOnVideoSizeChanged((int) (videoSize.width * videoSize.pixelWidthHeightRatio), videoSize.height, 1, 1);"> 752 +        notifyOnVideoSizeChanged((int) (videoSize.width * videoSize.pixelWidthHeightRatio), videoSize.height, 1, 1üîµ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 753 +        if (videoSize.unappliedRotationDegrees &gt; 0)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 754 +            notifyOnInfo(IMediaPlayer.MEDIA_INFO_VIDEO_ROTATION_CHANGED, videoSize.unappliedRotationDegrees);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 755 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 756 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 757 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 758 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 759 +    public void onRenderedFirstFrame(EventTime eventTime, Object output, long renderTimeMs) {</span>
 760  
 761      }
 762  
 763      @Override
 764      public void onDrmKeysLoaded(EventTime eventTime) {
 765  
 766      }
 767  
 768      @Override
 769      public void onDrmSessionManagerError(EventTime eventTime, Exception error) {
 770  
 771      }
 772  
 773      @Override
 774      public void onDrmKeysRestored(EventTime eventTime) {
 775  
 776      }
 777  
 778      @Override
 779      public void onDrmKeysRemoved(EventTime eventTime) {
 780  


































 781      }
 782  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            