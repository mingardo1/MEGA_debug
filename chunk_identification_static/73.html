<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>73</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    73
                    <a href="72.html">prev</a>
                    <a href="74.html">next</a>
                    <a href="73_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    AriaLyy/Aria_99d857f3383c60ae4ae008f74e7d2b32afe9c26a_Aria/src/main/java/com/arialyy/aria/core/task/DownloadUtil.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;99d857f3383c60ae4ae008f74e7d2b32afe9c26a:Aria/src/main/java/com/arialyy/aria/core/task/DownloadUtil.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;99d857f3383c60ae4ae008f74e7d2b32afe9c26a^1:Aria/src/main/java/com/arialyy/aria/core/task/DownloadUtil.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;99d857f3383c60ae4ae008f74e7d2b32afe9c26a^2:Aria/src/main/java/com/arialyy/aria/core/task/DownloadUtil.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;41154d47fb8664ddca206122d28b50a6a3b8e9a6:Aria/src/main/java/com/arialyy/aria/core/task/DownloadUtil.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bsj]], subset: [[bsj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   2 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   3  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   4  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   5  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   6  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   7  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   8  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   9  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  10  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  11  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  12  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  13  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  14  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  15  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  16  */                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  17                                                                                                          </span>
<span class="-1768704711895145311" onmouseenter="enter('-1768704711895145311');" onmouseout="out('-1768704711895145311');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  18 package com.arialyy.aria.core.task;                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  19                                                                                                          </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  20 import android.content.Context;                                                                          </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  21 import android.util.Log;                                                                                 </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  22 import android.util.SparseArray;                                                                         </span>
<span class="-8446909004143589790" onmouseenter="enter('-8446909004143589790');" onmouseout="out('-8446909004143589790');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  23 import com.arialyy.aria.core.DownloadEntity;                                                             </span>
<span class="-1661010561836341583" onmouseenter="enter('-1661010561836341583');" onmouseout="out('-1661010561836341583');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  24 import com.arialyy.aria.util.BufferedRandomAccessFile;                                                   </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  25 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  26 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  27 import java.io.IOException;                                                                              </span>
<span class="-3877933607611446246" onmouseenter="enter('-3877933607611446246');" onmouseout="out('-3877933607611446246');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  28 import java.io.RandomAccessFile;                                                                         </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  29 import java.net.HttpURLConnection;                                                                       </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  30 import java.net.URL;                                                                                     </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  31 import java.util.Properties;                                                                             </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  32 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  33 import java.util.concurrent.Executors;                                                                   </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  34                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  35 /**                                                                                                      </span>
<span class="2363292981682035173" onmouseenter="enter('2363292981682035173');" onmouseout="out('2363292981682035173');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  36  * Created by lyy on 2015/8/25.                                                                          </span>
<span class="-8257115403302511340" onmouseenter="enter('-8257115403302511340');" onmouseout="out('-8257115403302511340');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  37  * 下载工具类                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  38  */                                                                                                      </span>
<span class="2282207299880186426" onmouseenter="enter('2282207299880186426');" onmouseout="out('2282207299880186426');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  39 public class DownloadUtil implements IDownloadUtil, Runnable {                                           </span>
<span class="1261799266044613591" onmouseenter="enter('1261799266044613591');" onmouseout="out('1261799266044613591');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  40   private static final String TAG = &quot;DownloadUtil&quot;;                                                      </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41   /**                                                                                                    </span>
<span class="-8352985751663047055" onmouseenter="enter('-8352985751663047055');" onmouseout="out('-8352985751663047055');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42    * 线程数                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  43    */                                                                                                    </span>
<span class="-7983967545860957599" onmouseenter="enter('-7983967545860957599');" onmouseout="out('-7983967545860957599');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  44   private final int THREAD_NUM;                                                                          </span>
<span class="-785681239530372348" onmouseenter="enter('-785681239530372348');" onmouseout="out('-785681239530372348');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  45   //下载监听                                                                                                 </span>
<span class="8085369704814778285" onmouseenter="enter('8085369704814778285');" onmouseout="out('8085369704814778285');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  46   private IDownloadListener mListener;                                                                   </span>
<span class="8993221121586487711" onmouseenter="enter('8993221121586487711');" onmouseout="out('8993221121586487711');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  47   private int mConnectTimeOut = 5000 * 4; //连接超时时间                                                       </span>
<span class="4023537183138169002" onmouseenter="enter('4023537183138169002');" onmouseout="out('4023537183138169002');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  48   private int mReadTimeOut = 5000 * 20; //流读取的超时时间                                                       </span>
<span class="-1157942250762320951" onmouseenter="enter('-1157942250762320951');" onmouseout="out('-1157942250762320951');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  49   private boolean isNewTask = true;                                                                      </span>
<span class="-7348064306101585897" onmouseenter="enter('-7348064306101585897');" onmouseout="out('-7348064306101585897');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  50   private boolean isSupportBreakpoint = true;                                                            </span>
<span class="6683852815807951473" onmouseenter="enter('6683852815807951473');" onmouseout="out('6683852815807951473');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  51   private Context mContext;                                                                              </span>
<span class="-4114987623877824308" onmouseenter="enter('-4114987623877824308');" onmouseout="out('-4114987623877824308');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  52   private DownloadEntity mDownloadEntity;                                                                </span>
<span class="1058453114158093994" onmouseenter="enter('1058453114158093994');" onmouseout="out('1058453114158093994');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53   private ExecutorService mFixedThreadPool;                                                              </span>
<span class="-1133559474859202897" onmouseenter="enter('-1133559474859202897');" onmouseout="out('-1133559474859202897');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54   private File mDownloadFile; //下载的文件                                                                    </span>
<span class="7861940189151317235" onmouseenter="enter('7861940189151317235');" onmouseout="out('7861940189151317235');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55   private File mConfigFile;//下载信息配置文件                                                                    </span>
<span class="-3869960521609686448" onmouseenter="enter('-3869960521609686448');" onmouseout="out('-3869960521609686448');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56   private SparseArray&lt;Runnable&gt; mTask = new SparseArray&lt;&gt;();                                             </span>
<span class="7070628333292412283" onmouseenter="enter('7070628333292412283');" onmouseout="out('7070628333292412283');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57   private DownloadStateConstance mConstance;                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58                                                                                                          </span>
<span class="-6554670557683360136" onmouseenter="enter('-6554670557683360136');" onmouseout="out('-6554670557683360136');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59   public DownloadUtil(Context context, DownloadEntity entity, IDownloadListener downloadListener) {      </span>
<span class="-4896597165635236478" onmouseenter="enter('-4896597165635236478');" onmouseout="out('-4896597165635236478');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60     this(context, entity, downloadListener, 3);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  61   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  62                                                                                                          </span>
<span class="-4986291938704783923" onmouseenter="enter('-4986291938704783923');" onmouseout="out('-4986291938704783923');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  63   DownloadUtil(Context context, DownloadEntity entity, IDownloadListener downloadListener,               </span>
<span class="-8984238530475947621" onmouseenter="enter('-8984238530475947621');" onmouseout="out('-8984238530475947621');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  64       int threadNum) {                                                                                   </span>
<span class="-673106209130372223" onmouseenter="enter('-673106209130372223');" onmouseout="out('-673106209130372223');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  65     mContext = context.getApplicationContext();                                                          </span>
<span class="-216605200672599564" onmouseenter="enter('-216605200672599564');" onmouseout="out('-216605200672599564');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  66     mDownloadEntity = entity;                                                                            </span>
<span class="3831466484862340223" onmouseenter="enter('3831466484862340223');" onmouseout="out('3831466484862340223');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67     mListener = downloadListener;                                                                        </span>
<span class="-6579794148103748852" onmouseenter="enter('-6579794148103748852');" onmouseout="out('-6579794148103748852');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  68     THREAD_NUM = threadNum;                                                                              </span>
<span class="-7335968387740294445" onmouseenter="enter('-7335968387740294445');" onmouseout="out('-7335968387740294445');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  69     mFixedThreadPool = Executors.newFixedThreadPool(Integer.MAX_VALUE);                                  </span>
<span class="2824360841323512384" onmouseenter="enter('2824360841323512384');" onmouseout="out('2824360841323512384');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  70     mConstance = new DownloadStateConstance(THREAD_NUM);                                                 </span>
<span class="-1498726564668589193" onmouseenter="enter('-1498726564668589193');" onmouseout="out('-1498726564668589193');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  71     init();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  72   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  73                                                                                                          </span>
<span class="-909562594025196126" onmouseenter="enter('-909562594025196126');" onmouseout="out('-909562594025196126');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  74   private void init() {                                                                                  </span>
<span class="-8302516119393797134" onmouseenter="enter('-8302516119393797134');" onmouseout="out('-8302516119393797134');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  75     mDownloadFile = new File(mDownloadEntity.getDownloadPath());                                         </span>
<span class="-3534953052494864097" onmouseenter="enter('-3534953052494864097');" onmouseout="out('-3534953052494864097');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76     //读取已完成的线程数                                                                                          </span>
<span class="-9053998435552088983" onmouseenter="enter('-9053998435552088983');" onmouseout="out('-9053998435552088983');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77     mConfigFile = new File(                                                                              </span>
<span class="-3948838928069897094" onmouseenter="enter('-3948838928069897094');" onmouseout="out('-3948838928069897094');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  78         mContext.getFilesDir().getPath() + &quot;/temp/&quot; + mDownloadFile.getName() + &quot;.properties&quot;);          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  79     try {                                                                                                </span>
<span class="7925700052565713558" onmouseenter="enter('7925700052565713558');" onmouseout="out('7925700052565713558');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  80       if (!mConfigFile.exists()) { //记录文件被删除，则重新下载                                                       </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  81         isNewTask = true;                                                                                </span>
<span class="1838885973573966413" onmouseenter="enter('1838885973573966413');" onmouseout="out('1838885973573966413');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  82         CommonUtil.createFile(mConfigFile.getPath());                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  83       } else {                                                                                           </span>
<span class="-6296621072689899390" onmouseenter="enter('-6296621072689899390');" onmouseout="out('-6296621072689899390');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  84         isNewTask = !mDownloadFile.exists();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85       }                                                                                                  </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  86     } catch (Exception e) {                                                                              </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  87       e.printStackTrace();                                                                               </span>
<span class="-3747169937451325082" onmouseenter="enter('-3747169937451325082');" onmouseout="out('-3747169937451325082');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  88       failDownload(&quot;下载失败，记录文件被删除&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  89     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  90   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  91                                                                                                          </span>
<span class="-8585626151911369157" onmouseenter="enter('-8585626151911369157');" onmouseout="out('-8585626151911369157');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  92   public IDownloadListener getListener() {                                                               </span>
<span class="-7037258027690597516" onmouseenter="enter('-7037258027690597516');" onmouseout="out('-7037258027690597516');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  93     return mListener;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  94   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  95                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  96   /**                                                                                                    </span>
<span class="6936487890332430093" onmouseenter="enter('6936487890332430093');" onmouseout="out('6936487890332430093');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  97    * 设置连接超时时间                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  98    */                                                                                                    </span>
<span class="8269350745377988793" onmouseenter="enter('8269350745377988793');" onmouseout="out('8269350745377988793');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99   public void setConnectTimeOut(int timeOut) {                                                           </span>
<span class="7491344361160646490" onmouseenter="enter('7491344361160646490');" onmouseout="out('7491344361160646490');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100     mConnectTimeOut = timeOut;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103   /**                                                                                                    </span>
<span class="1793189252207234639" onmouseenter="enter('1793189252207234639');" onmouseout="out('1793189252207234639');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104    * 设置流读取的超时时间                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 105    */                                                                                                    </span>
<span class="-4265144949210493065" onmouseenter="enter('-4265144949210493065');" onmouseout="out('-4265144949210493065');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106   public void setReadTimeOut(int readTimeOut) {                                                          </span>
<span class="-3349186980434336657" onmouseenter="enter('-3349186980434336657');" onmouseout="out('-3349186980434336657');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107     mReadTimeOut = readTimeOut;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 109                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 110   /**                                                                                                    </span>
<span class="6025979389427346334" onmouseenter="enter('6025979389427346334');" onmouseout="out('6025979389427346334');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 111    * 获取当前下载位置                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112    */                                                                                                    </span>
<span class="42588745782017963" onmouseenter="enter('42588745782017963');" onmouseout="out('42588745782017963');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113   @Override public long getCurrentLocation() {                                                           </span>
<span class="2881215542099369319" onmouseenter="enter('2881215542099369319');" onmouseout="out('2881215542099369319');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 114     return mConstance.CURRENT_LOCATION;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116                                                                                                          </span>
<span class="8514823861416132786" onmouseenter="enter('8514823861416132786');" onmouseout="out('8514823861416132786');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 117   @Override public boolean isDownloading() {                                                             </span>
<span class="-2560940912314579274" onmouseenter="enter('-2560940912314579274');" onmouseout="out('-2560940912314579274');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 118     return mConstance.isDownloading;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 119   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121   /**                                                                                                    </span>
<span class="8520049766391668792" onmouseenter="enter('8520049766391668792');" onmouseout="out('8520049766391668792');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122    * 取消下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123    */                                                                                                    </span>
<span class="8518544268347342740" onmouseenter="enter('8518544268347342740');" onmouseout="out('8518544268347342740');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124   @Override public void cancelDownload() {                                                               </span>
<span class="204250319841071761" onmouseenter="enter('204250319841071761');" onmouseout="out('204250319841071761');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125     mConstance.isCancel = true;                                                                          </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126     mConstance.isDownloading = false;                                                                    </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127     mFixedThreadPool.shutdown();                                                                         </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="6217106455110130996" onmouseenter="enter('6217106455110130996');" onmouseout="out('6217106455110130996');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129       SingleThreadTask task = (SingleThreadTask) mTask.get(i);                                           </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130       if (task != null) {                                                                                </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131         task.cancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 133     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 134   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 135                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 136   /**                                                                                                    </span>
<span class="7755328866638560569" onmouseenter="enter('7755328866638560569');" onmouseout="out('7755328866638560569');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 137    * 停止下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 138    */                                                                                                    </span>
<span class="-4596234023078912379" onmouseenter="enter('-4596234023078912379');" onmouseout="out('-4596234023078912379');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139   @Override public void stopDownload() {                                                                 </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140     mConstance.isStop = true;                                                                            </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141     mConstance.isDownloading = false;                                                                    </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 142     mFixedThreadPool.shutdown();                                                                         </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 143     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="6217106455110130996" onmouseenter="enter('6217106455110130996');" onmouseout="out('6217106455110130996');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 144       SingleThreadTask task = (SingleThreadTask) mTask.get(i);                                           </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 145       if (task != null) {                                                                                </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146         task.stop();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 148     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 149   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 150                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 151   /**                                                                                                    </span>
<span class="8538662619258057049" onmouseenter="enter('8538662619258057049');" onmouseout="out('8538662619258057049');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 152    * 删除下载记录文件                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 153    */                                                                                                    </span>
<span class="-6348491485207421588" onmouseenter="enter('-6348491485207421588');" onmouseout="out('-6348491485207421588');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 154   @Override public void delConfigFile() {                                                                </span>
<span class="8558402344038566367" onmouseenter="enter('8558402344038566367');" onmouseout="out('8558402344038566367');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 155     if (mContext != null &amp;&amp; mDownloadEntity != null) {                                                   </span>
<span class="3099781541276521660" onmouseenter="enter('3099781541276521660');" onmouseout="out('3099781541276521660');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 156       File dFile = new File(mDownloadEntity.getDownloadPath());                                          </span>
<span class="-1217451156974226618" onmouseenter="enter('-1217451156974226618');" onmouseout="out('-1217451156974226618');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 157       File config =                                                                                      </span>
<span class="1777202063354625193" onmouseenter="enter('1777202063354625193');" onmouseout="out('1777202063354625193');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 158           new File(mContext.getFilesDir().getPath() + &quot;/temp/&quot; + dFile.getName() + &quot;.properties&quot;);       </span>
<span class="-7696478919602418443" onmouseenter="enter('-7696478919602418443');" onmouseout="out('-7696478919602418443');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 159       if (config.exists()) {                                                                             </span>
<span class="-5702358031910949081" onmouseenter="enter('-5702358031910949081');" onmouseout="out('-5702358031910949081');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 160         config.delete();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 161       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 163   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 164                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 165   /**                                                                                                    </span>
<span class="-8312193682087493639" onmouseenter="enter('-8312193682087493639');" onmouseout="out('-8312193682087493639');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166    * 删除temp文件                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 167    */                                                                                                    </span>
<span class="7655331082892594561" onmouseenter="enter('7655331082892594561');" onmouseout="out('7655331082892594561');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 168   @Override public void delTempFile() {                                                                  </span>
<span class="8558402344038566367" onmouseenter="enter('8558402344038566367');" onmouseout="out('8558402344038566367');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 169     if (mContext != null &amp;&amp; mDownloadEntity != null) {                                                   </span>
<span class="3099781541276521660" onmouseenter="enter('3099781541276521660');" onmouseout="out('3099781541276521660');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170       File dFile = new File(mDownloadEntity.getDownloadPath());                                          </span>
<span class="7897717398420259974" onmouseenter="enter('7897717398420259974');" onmouseout="out('7897717398420259974');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 171       if (dFile.exists()) {                                                                              </span>
<span class="7527345290446588408" onmouseenter="enter('7527345290446588408');" onmouseout="out('7527345290446588408');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 172         dFile.delete();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 173       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 175   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 176                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 177   /**                                                                                                    </span>
<span class="-5727215122052088545" onmouseenter="enter('-5727215122052088545');" onmouseout="out('-5727215122052088545');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 178    * 多线程断点续传下载文件，开始下载                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 179    */                                                                                                    </span>
<span class="-4856178778199245062" onmouseenter="enter('-4856178778199245062');" onmouseout="out('-4856178778199245062');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 180   @Override public void startDownload() {                                                                </span>
<span class="898408935389387935" onmouseenter="enter('898408935389387935');" onmouseout="out('898408935389387935');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 181     mConstance.cleanState();                                                                             </span>
<span class="2099174989180368882" onmouseenter="enter('2099174989180368882');" onmouseout="out('2099174989180368882');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 182     mListener.onPre();                                                                                   </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 183     new Thread(this).start();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 184   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 185                                                                                                          </span>
<span class="-5762688668558425600" onmouseenter="enter('-5762688668558425600');" onmouseout="out('-5762688668558425600');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 186   @Override public void resumeDownload() {                                                               </span>
<span class="1497820413888703615" onmouseenter="enter('1497820413888703615');" onmouseout="out('1497820413888703615');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 187     startDownload();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 188   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 189                                                                                                          </span>
<span class="8306009172830771261" onmouseenter="enter('8306009172830771261');" onmouseout="out('8306009172830771261');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 190   private void failDownload(String msg) {                                                                </span>
<span class="-6647758959009774834" onmouseenter="enter('-6647758959009774834');" onmouseout="out('-6647758959009774834');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 191     Log.e(TAG, msg);                                                                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 192     mConstance.isDownloading = false;                                                                    </span>
<span class="-6715929234808926893" onmouseenter="enter('-6715929234808926893');" onmouseout="out('-6715929234808926893');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 193     stopDownload();                                                                                      </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 194     mListener.onFail();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 195   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 196                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 197   @Override public void run() {                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 198     try {                                                                                                </span>
<span class="5483634401908283016" onmouseenter="enter('5483634401908283016');" onmouseout="out('5483634401908283016');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 199       URL url = new URL(mDownloadEntity.getDownloadUrl());                                               </span>
<span class="-6008953795197858884" onmouseenter="enter('-6008953795197858884');" onmouseout="out('-6008953795197858884');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 200       HttpURLConnection conn = ConnectionHelp.handleConnection(url);                                     </span>
<span class="2062133901627510982" onmouseenter="enter('2062133901627510982');" onmouseout="out('2062133901627510982');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 201       conn = ConnectionHelp.setConnectParam(conn);                                                       </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 202       conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                              </span>
<span class="-3579311541579934971" onmouseenter="enter('-3579311541579934971');" onmouseout="out('-3579311541579934971');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 203       conn.setConnectTimeout(mConnectTimeOut * 4);                                                       </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 204       conn.connect();                                                                                    </span>
<span class="6567575788372053568" onmouseenter="enter('6567575788372053568');" onmouseout="out('6567575788372053568');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 205       int len = conn.getContentLength();                                                                 </span>
<span class="3904365852949278245" onmouseenter="enter('3904365852949278245');" onmouseout="out('3904365852949278245');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 206       //if (len &lt; 0) {  //网络被劫持时会出现这个问题                                                                  </span>
<span class="835324676499837078" onmouseenter="enter('835324676499837078');" onmouseout="out('835324676499837078');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 207       //  failDownload(&quot;下载失败，网络被劫持&quot;);                                                                    </span>
<span class="3500611444781325819" onmouseenter="enter('3500611444781325819');" onmouseout="out('3500611444781325819');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 208       //  return;                                                                                        </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 209       //}                                                                                                </span>
<span class="-5653376755036700146" onmouseenter="enter('-5653376755036700146');" onmouseout="out('-5653376755036700146');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 210       int code = conn.getResponseCode();                                                                 </span>
<span class="999254544547719885" onmouseenter="enter('999254544547719885');" onmouseout="out('999254544547719885');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 211       //https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81                                    </span>
<span class="-8703603538857387010" onmouseenter="enter('-8703603538857387010');" onmouseout="out('-8703603538857387010');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 212       //206支持断点                                                                                          </span>
<span class="5260656878663172399" onmouseenter="enter('5260656878663172399');" onmouseout="out('5260656878663172399');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 213       if (code == HttpURLConnection.HTTP_PARTIAL) {                                                      </span>
<span class="-4850747580721370850" onmouseenter="enter('-4850747580721370850');" onmouseout="out('-4850747580721370850');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 214         isSupportBreakpoint = true;                                                                      </span>
<span class="1256350564434583014" onmouseenter="enter('1256350564434583014');" onmouseout="out('1256350564434583014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 215         mListener.supportBreakpoint(true);                                                               </span>
<span class="-7366273742365769169" onmouseenter="enter('-7366273742365769169');" onmouseout="out('-7366273742365769169');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 216         handleBreakpoint(conn);                                                                          </span>
<span class="877851589237632825" onmouseenter="enter('877851589237632825');" onmouseout="out('877851589237632825');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 217       } else if (code == HttpURLConnection.HTTP_OK || len &lt; 0) {                                         </span>
<span class="-5840271675092361063" onmouseenter="enter('-5840271675092361063');" onmouseout="out('-5840271675092361063');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 218         //在conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);下，200为不支持断点状态                            </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 219         if (len &lt; 0) {                                                                                   </span>
<span class="9025825393004184595" onmouseenter="enter('9025825393004184595');" onmouseout="out('9025825393004184595');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 220           failDownload(&quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，文件长度小于0&quot;);                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 221           return;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 222         }                                                                                                </span>
<span class="5451458949060440820" onmouseenter="enter('5451458949060440820');" onmouseout="out('5451458949060440820');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 223         isSupportBreakpoint = false;                                                                     </span>
<span class="3223278567209587987" onmouseenter="enter('3223278567209587987');" onmouseout="out('3223278567209587987');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 224         mListener.supportBreakpoint(false);                                                              </span>
<span class="-3209038805792969148" onmouseenter="enter('-3209038805792969148');" onmouseout="out('-3209038805792969148');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 225         Log.w(TAG, &quot;该下载链接不支持断点下载&quot;);                                                                      </span>
<span class="-7366273742365769169" onmouseenter="enter('-7366273742365769169');" onmouseout="out('-7366273742365769169');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 226         handleBreakpoint(conn);                                                                          </span>
<span class="1848064821034278655" onmouseenter="enter('1848064821034278655');" onmouseout="out('1848064821034278655');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 227       } else if (code == HttpURLConnection.HTTP_NOT_FOUND) {                                             </span>
<span class="6854071059109338334" onmouseenter="enter('6854071059109338334');" onmouseout="out('6854071059109338334');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 228         Log.w(TAG, &quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，错误码：404&quot;);                          </span>
<span class="7504588834379816638" onmouseenter="enter('7504588834379816638');" onmouseout="out('7504588834379816638');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 229         //mListener.onCancel();                                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 230       } else {                                                                                           </span>
<span class="9116772185344886324" onmouseenter="enter('9116772185344886324');" onmouseout="out('9116772185344886324');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 231         failDownload(&quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，错误码：&quot; + code);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 232       }                                                                                                  </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 233     } catch (IOException e) {                                                                            </span>
<span class="7015103282251076587" onmouseenter="enter('7015103282251076587');" onmouseout="out('7015103282251076587');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 234       failDownload(&quot;下载失败【downloadUrl:&quot;                                                                   </span>
<span class="5951112113295803501" onmouseenter="enter('5951112113295803501');" onmouseout="out('5951112113295803501');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 235           + mDownloadEntity.getDownloadUrl()                                                             </span>
<span class="910868662350755341" onmouseenter="enter('910868662350755341');" onmouseout="out('910868662350755341');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 236           + &quot;】\n【filePath:&quot;                                                                              </span>
<span class="5931171797063415443" onmouseenter="enter('5931171797063415443');" onmouseout="out('5931171797063415443');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 237           + mDownloadFile.getPath()                                                                      </span>
<span class="-1840319934610193149" onmouseenter="enter('-1840319934610193149');" onmouseout="out('-1840319934610193149');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 238           + &quot;】&quot;                                                                                          </span>
<span class="-5371623624849066023" onmouseenter="enter('-5371623624849066023');" onmouseout="out('-5371623624849066023');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 239           + CommonUtil.getPrintException(e));                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 240     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 241   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 242                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 243   /**                                                                                                    </span>
<span class="-2887709646015060517" onmouseenter="enter('-2887709646015060517');" onmouseout="out('-2887709646015060517');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 244    * 处理断点                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 245    */                                                                                                    </span>
<span class="-1770943272374407595" onmouseenter="enter('-1770943272374407595');" onmouseout="out('-1770943272374407595');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 246   private void handleBreakpoint(HttpURLConnection conn) throws IOException {                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 247                                                                                                          </span>
<span class="7477238500582408106" onmouseenter="enter('7477238500582408106');" onmouseout="out('7477238500582408106');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 248     //不支持断点只能单线程下载                                                                                       </span>
<span class="-6722781002220970553" onmouseenter="enter('-6722781002220970553');" onmouseout="out('-6722781002220970553');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 249     if (!isSupportBreakpoint) {                                                                          </span>
<span class="-8481066330390671660" onmouseenter="enter('-8481066330390671660');" onmouseout="out('-8481066330390671660');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 250       ConfigEntity entity = new ConfigEntity();                                                          </span>
<span class="2550533377201046915" onmouseenter="enter('2550533377201046915');" onmouseout="out('2550533377201046915');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 251       long len = conn.getContentLength();;                                                               </span>
<span class="3256260393357377684" onmouseenter="enter('3256260393357377684');" onmouseout="out('3256260393357377684');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 252       entity.FILE_SIZE = len;                                                                            </span>
<span class="4189357201157412201" onmouseenter="enter('4189357201157412201');" onmouseout="out('4189357201157412201');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 253       entity.DOWNLOAD_URL = mDownloadEntity.getDownloadUrl();                                            </span>
<span class="1175511499700324517" onmouseenter="enter('1175511499700324517');" onmouseout="out('1175511499700324517');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 254       entity.TEMP_FILE = mDownloadFile;                                                                  </span>
<span class="-1353085718172399938" onmouseenter="enter('-1353085718172399938');" onmouseout="out('-1353085718172399938');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 255       entity.THREAD_ID = 0;                                                                              </span>
<span class="-4967231089338870782" onmouseenter="enter('-4967231089338870782');" onmouseout="out('-4967231089338870782');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 256       entity.START_LOCATION = 0;                                                                         </span>
<span class="4365950116387297475" onmouseenter="enter('4365950116387297475');" onmouseout="out('4365950116387297475');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 257       entity.END_LOCATION = entity.FILE_SIZE;                                                            </span>
<span class="-7848202009707844875" onmouseenter="enter('-7848202009707844875');" onmouseout="out('-7848202009707844875');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 258       entity.CONFIG_FILE_PATH = mConfigFile.getPath();                                                   </span>
<span class="2812036997657153043" onmouseenter="enter('2812036997657153043');" onmouseout="out('2812036997657153043');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 259       entity.isSupportBreakpoint = isSupportBreakpoint;                                                  </span>
<span class="4531885195650702733" onmouseenter="enter('4531885195650702733');" onmouseout="out('4531885195650702733');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 260       SingleThreadTask task = new SingleThreadTask(mConstance, mListener, entity);                       </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 261       mFixedThreadPool.execute(task);                                                                    </span>
<span class="1947759044939991847" onmouseenter="enter('1947759044939991847');" onmouseout="out('1947759044939991847');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 262       mListener.onPostPre(len);                                                                          </span>
<span class="-2943780714290472761" onmouseenter="enter('-2943780714290472761');" onmouseout="out('-2943780714290472761');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 263       mListener.onStart(0);                                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 264       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 265     }                                                                                                    </span>
<span class="-4144971478129188538" onmouseenter="enter('-4144971478129188538');" onmouseout="out('-4144971478129188538');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 266     int fileLength = conn.getContentLength();                                                            </span>
<span class="-3771769896201867631" onmouseenter="enter('-3771769896201867631');" onmouseout="out('-3771769896201867631');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 267     //必须建一个文件                                                                                            </span>
<span class="-8241179119122160888" onmouseenter="enter('-8241179119122160888');" onmouseout="out('-8241179119122160888');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 268     CommonUtil.createFile(mDownloadFile.getPath());                                                      </span>
<span class="-7635395723744199382" onmouseenter="enter('-7635395723744199382');" onmouseout="out('-7635395723744199382');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 269     //RandomAccessFile file = new RandomAccessFile(mDownloadFile.getPath(), &quot;rwd&quot;);                      </span>
<span class="-900329094809807646" onmouseenter="enter('-900329094809807646');" onmouseout="out('-900329094809807646');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 270     ////设置文件长度                                                                                           </span>
<span class="-756775849470659960" onmouseenter="enter('-756775849470659960');" onmouseout="out('-756775849470659960');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 271     //file.setLength(fileLength);                                                                        </span>
<span class="2674353001121820528" onmouseenter="enter('2674353001121820528');" onmouseout="out('2674353001121820528');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 272     BufferedRandomAccessFile file =                                                                      </span>
<span class="-2608299971259814762" onmouseenter="enter('-2608299971259814762');" onmouseout="out('-2608299971259814762');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 273         new BufferedRandomAccessFile(mDownloadFile.getPath(), &quot;rwd&quot;, 8192);                              </span>
<span class="-564508951971497574" onmouseenter="enter('-564508951971497574');" onmouseout="out('-564508951971497574');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 274     //设置文件长度                                                                                             </span>
<span class="6023690204241765206" onmouseenter="enter('6023690204241765206');" onmouseout="out('6023690204241765206');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 275     file.setLength(fileLength);                                                                          </span>
<span class="5666806310833670603" onmouseenter="enter('5666806310833670603');" onmouseout="out('5666806310833670603');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 276     mListener.onPostPre(fileLength);                                                                     </span>
<span class="6024675825413521783" onmouseenter="enter('6024675825413521783');" onmouseout="out('6024675825413521783');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 277     //分配每条线程的下载区间                                                                                        </span>
<span class="-317662916418562024" onmouseenter="enter('-317662916418562024');" onmouseout="out('-317662916418562024');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 278     Properties pro = null;                                                                               </span>
<span class="4467713772376842471" onmouseenter="enter('4467713772376842471');" onmouseout="out('4467713772376842471');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 279     pro = CommonUtil.loadConfig(mConfigFile);                                                            </span>
<span class="-681137634566379888" onmouseenter="enter('-681137634566379888');" onmouseout="out('-681137634566379888');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 280     if (pro.isEmpty()) {                                                                                 </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 281       isNewTask = true;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 282     } else {                                                                                             </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 283       for (int i = 0; i &lt; THREAD_NUM; i++) {                                                             </span>
<span class="-6973645922135466911" onmouseenter="enter('-6973645922135466911');" onmouseout="out('-6973645922135466911');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 284         if (pro.getProperty(mDownloadFile.getName() + &quot;_record_&quot; + i) == null) {                         </span>
<span class="1178951043321657234" onmouseenter="enter('1178951043321657234');" onmouseout="out('1178951043321657234');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 285           Object state = pro.getProperty(mDownloadFile.getName() + &quot;_state_&quot; + i);                       </span>
<span class="-2092430839348453245" onmouseenter="enter('-2092430839348453245');" onmouseout="out('-2092430839348453245');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 286           if (state != null &amp;&amp; Integer.parseInt(state + &quot;&quot;) == 1) {                                      </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 287             continue;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 288           }                                                                                              </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 289           isNewTask = true;                                                                              </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 290           break;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 291         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 292       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 293     }                                                                                                    </span>
<span class="-1643854653241583074" onmouseenter="enter('-1643854653241583074');" onmouseout="out('-1643854653241583074');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 294     int blockSize = fileLength / THREAD_NUM;                                                             </span>
<span class="866019335924650779" onmouseenter="enter('866019335924650779');" onmouseout="out('866019335924650779');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 295     int[] recordL = new int[THREAD_NUM];                                                                 </span>
<span class="794844889575716346" onmouseenter="enter('794844889575716346');" onmouseout="out('794844889575716346');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 296     int rl = 0;                                                                                          </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 297     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="8242320341463399828" onmouseenter="enter('8242320341463399828');" onmouseout="out('8242320341463399828');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 298       recordL[i] = -1;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 299     }                                                                                                    </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 300     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="-2965725495076654490" onmouseenter="enter('-2965725495076654490');" onmouseout="out('-2965725495076654490');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 301       long startL = i * blockSize, endL = (i + 1) * blockSize;                                           </span>
<span class="1178951043321657234" onmouseenter="enter('1178951043321657234');" onmouseout="out('1178951043321657234');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 302       Object state = pro.getProperty(mDownloadFile.getName() + &quot;_state_&quot; + i);                           </span>
<span class="2419725940883839935" onmouseenter="enter('2419725940883839935');" onmouseout="out('2419725940883839935');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 303       if (state != null &amp;&amp; Integer.parseInt(state + &quot;&quot;) == 1) {  //该线程已经完成                               </span>
<span class="8742170387731029623" onmouseenter="enter('8742170387731029623');" onmouseout="out('8742170387731029623');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 304         mConstance.CURRENT_LOCATION += endL - startL;                                                    </span>
<span class="7342592738960136820" onmouseenter="enter('7342592738960136820');" onmouseout="out('7342592738960136820');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 305         Log.d(TAG, &quot;++++++++++ 线程_&quot; + i + &quot;_已经下载完成 ++++++++++&quot;);                                         </span>
<span class="-337774801975969950" onmouseenter="enter('-337774801975969950');" onmouseout="out('-337774801975969950');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 306         mConstance.COMPLETE_THREAD_NUM++;                                                                </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 307         mConstance.STOP_NUM++;                                                                           </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 308         mConstance.CANCEL_NUM++;                                                                         </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 309         if (mConstance.isComplete()) {                                                                   </span>
<span class="4951157766975006439" onmouseenter="enter('4951157766975006439');" onmouseout="out('4951157766975006439');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 310           if (mConfigFile.exists()) {                                                                    </span>
<span class="-8106518526167482323" onmouseenter="enter('-8106518526167482323');" onmouseout="out('-8106518526167482323');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 311             mConfigFile.delete();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 312           }                                                                                              </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 313           mListener.onComplete();                                                                        </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 314           mConstance.isDownloading = false;                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 315           return;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 316         }                                                                                                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 317         continue;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 318       }                                                                                                  </span>
<span class="-1793454279264850881" onmouseenter="enter('-1793454279264850881');" onmouseout="out('-1793454279264850881');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 319       //分配下载位置                                                                                           </span>
<span class="-8200484973700844224" onmouseenter="enter('-8200484973700844224');" onmouseout="out('-8200484973700844224');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 320       Object record = pro.getProperty(mDownloadFile.getName() + &quot;_record_&quot; + i);                         </span>
<span class="-4606277471232235328" onmouseenter="enter('-4606277471232235328');" onmouseout="out('-4606277471232235328');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 321       //如果有记录，则恢复下载                                                                                      </span>
<span class="9081430961250736769" onmouseenter="enter('9081430961250736769');" onmouseout="out('9081430961250736769');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 322       if (!isNewTask &amp;&amp; record != null &amp;&amp; Long.parseLong(record + &quot;&quot;) &gt; 0) {                             </span>
<span class="8647082033828497822" onmouseenter="enter('8647082033828497822');" onmouseout="out('8647082033828497822');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 323         Long r = Long.parseLong(record + &quot;&quot;);                                                            </span>
<span class="1683054574044455381" onmouseenter="enter('1683054574044455381');" onmouseout="out('1683054574044455381');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 324         mConstance.CURRENT_LOCATION += r - startL;                                                       </span>
<span class="179733331572927392" onmouseenter="enter('179733331572927392');" onmouseout="out('179733331572927392');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 325         Log.d(TAG, &quot;++++++++++ 线程_&quot; + i + &quot;_恢复下载 ++++++++++&quot;);                                           </span>
<span class="6939461797319425642" onmouseenter="enter('6939461797319425642');" onmouseout="out('6939461797319425642');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 326         mListener.onChildResume(r);                                                                      </span>
<span class="1542845345888554533" onmouseenter="enter('1542845345888554533');" onmouseout="out('1542845345888554533');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 327         startL = r;                                                                                      </span>
<span class="-7425711498405631322" onmouseenter="enter('-7425711498405631322');" onmouseout="out('-7425711498405631322');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 328         recordL[rl] = i;                                                                                 </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 329         rl++;                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 330       } else {                                                                                           </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 331         isNewTask = true;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 332       }                                                                                                  </span>
<span class="537230916062757449" onmouseenter="enter('537230916062757449');" onmouseout="out('537230916062757449');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 333       if (isNewTask) {                                                                                   </span>
<span class="-7425711498405631322" onmouseenter="enter('-7425711498405631322');" onmouseout="out('-7425711498405631322');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 334         recordL[rl] = i;                                                                                 </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 335         rl++;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 336       }                                                                                                  </span>
<span class="-3400889980578220125" onmouseenter="enter('-3400889980578220125');" onmouseout="out('-3400889980578220125');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 337       if (i == (THREAD_NUM - 1)) {                                                                       </span>
<span class="-7423751213765432972" onmouseenter="enter('-7423751213765432972');" onmouseout="out('-7423751213765432972');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 338         //如果整个文件的大小不为线程个数的整数倍，则最后一个线程的结束位置即为文件的总长度                                                       </span>
<span class="-2829184075463306484" onmouseenter="enter('-2829184075463306484');" onmouseout="out('-2829184075463306484');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 339         endL = fileLength;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 340       }                                                                                                  </span>
<span class="-8481066330390671660" onmouseenter="enter('-8481066330390671660');" onmouseout="out('-8481066330390671660');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 341       ConfigEntity entity = new ConfigEntity();                                                          </span>
<span class="-3119684513187648029" onmouseenter="enter('-3119684513187648029');" onmouseout="out('-3119684513187648029');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 342       entity.FILE_SIZE = fileLength;                                                                     </span>
<span class="4189357201157412201" onmouseenter="enter('4189357201157412201');" onmouseout="out('4189357201157412201');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 343       entity.DOWNLOAD_URL = mDownloadEntity.getDownloadUrl();                                            </span>
<span class="1175511499700324517" onmouseenter="enter('1175511499700324517');" onmouseout="out('1175511499700324517');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 344       entity.TEMP_FILE = mDownloadFile;                                                                  </span>
<span class="-1808458878368858692" onmouseenter="enter('-1808458878368858692');" onmouseout="out('-1808458878368858692');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 345       entity.THREAD_ID = i;                                                                              </span>
<span class="6661292811999012973" onmouseenter="enter('6661292811999012973');" onmouseout="out('6661292811999012973');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 346       entity.START_LOCATION = startL;                                                                    </span>
<span class="8656472587238389131" onmouseenter="enter('8656472587238389131');" onmouseout="out('8656472587238389131');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 347       entity.END_LOCATION = endL;                                                                        </span>
<span class="-7848202009707844875" onmouseenter="enter('-7848202009707844875');" onmouseout="out('-7848202009707844875');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 348       entity.CONFIG_FILE_PATH = mConfigFile.getPath();                                                   </span>
<span class="2812036997657153043" onmouseenter="enter('2812036997657153043');" onmouseout="out('2812036997657153043');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 349       entity.isSupportBreakpoint = isSupportBreakpoint;                                                  </span>
<span class="4531885195650702733" onmouseenter="enter('4531885195650702733');" onmouseout="out('4531885195650702733');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 350       SingleThreadTask task = new SingleThreadTask(mConstance, mListener, entity);                       </span>
<span class="-6012810893938815399" onmouseenter="enter('-6012810893938815399');" onmouseout="out('-6012810893938815399');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 351       mTask.put(i, task);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 352     }                                                                                                    </span>
<span class="-1061602448343886008" onmouseenter="enter('-1061602448343886008');" onmouseout="out('-1061602448343886008');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 353     if (mConstance.CURRENT_LOCATION &gt; 0) {                                                               </span>
<span class="5187035189520501266" onmouseenter="enter('5187035189520501266');" onmouseout="out('5187035189520501266');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 354       mListener.onResume(mConstance.CURRENT_LOCATION);                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 355     } else {                                                                                             </span>
<span class="-2973471902048685805" onmouseenter="enter('-2973471902048685805');" onmouseout="out('-2973471902048685805');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 356       mListener.onStart(mConstance.CURRENT_LOCATION);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 357     }                                                                                                    </span>
<span class="1243235571055153612" onmouseenter="enter('1243235571055153612');" onmouseout="out('1243235571055153612');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 358     for (int l : recordL) {                                                                              </span>
<span class="-7510837703317171619" onmouseenter="enter('-7510837703317171619');" onmouseout="out('-7510837703317171619');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 359       if (l == -1) continue;                                                                             </span>
<span class="-85915337091278441" onmouseenter="enter('-85915337091278441');" onmouseout="out('-85915337091278441');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 360       Runnable task = mTask.get(l);                                                                      </span>
<span class="-7327661534177463737" onmouseenter="enter('-7327661534177463737');" onmouseout="out('-7327661534177463737');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 361       if (task != null &amp;&amp; !mFixedThreadPool.isShutdown()) {                                              </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 362         mFixedThreadPool.execute(task);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 363       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 364     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 365   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 366                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 367   /**                                                                                                    </span>
<span class="2585942053451624927" onmouseenter="enter('2585942053451624927');" onmouseout="out('2585942053451624927');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 368    * 子线程下载信息类                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 369    */                                                                                                    </span>
<span class="-3850188489545087742" onmouseenter="enter('-3850188489545087742');" onmouseout="out('-3850188489545087742');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 370   final static class ConfigEntity {                                                                      </span>
<span class="-403498804051257270" onmouseenter="enter('-403498804051257270');" onmouseout="out('-403498804051257270');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 371     //文件大小                                                                                               </span>
<span class="541475241289655650" onmouseenter="enter('541475241289655650');" onmouseout="out('541475241289655650');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 372     long FILE_SIZE;                                                                                      </span>
<span class="-4736398418022593572" onmouseenter="enter('-4736398418022593572');" onmouseout="out('-4736398418022593572');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 373     String DOWNLOAD_URL;                                                                                 </span>
<span class="-7368464316865211776" onmouseenter="enter('-7368464316865211776');" onmouseout="out('-7368464316865211776');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 374     int THREAD_ID;                                                                                       </span>
<span class="3260682776668453255" onmouseenter="enter('3260682776668453255');" onmouseout="out('3260682776668453255');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 375     long START_LOCATION;                                                                                 </span>
<span class="2446069397877689758" onmouseenter="enter('2446069397877689758');" onmouseout="out('2446069397877689758');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 376     long END_LOCATION;                                                                                   </span>
<span class="4104096962052364503" onmouseenter="enter('4104096962052364503');" onmouseout="out('4104096962052364503');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 377     File TEMP_FILE;                                                                                      </span>
<span class="-2017423643980728828" onmouseenter="enter('-2017423643980728828');" onmouseout="out('-2017423643980728828');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 378     boolean isSupportBreakpoint = true;                                                                  </span>
<span class="-2943683475239618057" onmouseenter="enter('-2943683475239618057');" onmouseout="out('-2943683475239618057');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 379     String CONFIG_FILE_PATH;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 380   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 381 }                                                                                                        </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 382 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 383 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 384  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 385  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 386  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 387  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 388  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 389  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 390  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 391  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 392  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 393  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 394  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 395  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 396  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 397  */                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 398                                                                                                          </span>
<span class="-1768704711895145311" onmouseenter="enter('-1768704711895145311');" onmouseout="out('-1768704711895145311');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 399 package com.arialyy.aria.core.task;                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 400                                                                                                          </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 401 import android.content.Context;                                                                          </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 402 import android.util.Log;                                                                                 </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 403 import android.util.SparseArray;                                                                         </span>
<span class="-8446909004143589790" onmouseenter="enter('-8446909004143589790');" onmouseout="out('-8446909004143589790');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 404 import com.arialyy.aria.core.DownloadEntity;                                                             </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 405 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 406 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 407 import java.io.IOException;                                                                              </span>
<span class="-3877933607611446246" onmouseenter="enter('-3877933607611446246');" onmouseout="out('-3877933607611446246');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 408 import java.io.RandomAccessFile;                                                                         </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 409 import java.net.HttpURLConnection;                                                                       </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 410 import java.net.URL;                                                                                     </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 411 import java.util.Properties;                                                                             </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 412 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 413 import java.util.concurrent.Executors;                                                                   </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 414                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 415 /**                                                                                                      </span>
<span class="2363292981682035173" onmouseenter="enter('2363292981682035173');" onmouseout="out('2363292981682035173');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 416  * Created by lyy on 2015/8/25.                                                                          </span>
<span class="-8257115403302511340" onmouseenter="enter('-8257115403302511340');" onmouseout="out('-8257115403302511340');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 417  * 下载工具类                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 418  */                                                                                                      </span>
<span class="1048428507777314273" onmouseenter="enter('1048428507777314273');" onmouseout="out('1048428507777314273');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 419 final class DownloadUtil implements IDownloadUtil, Runnable {                                            </span>
<span class="1261799266044613591" onmouseenter="enter('1261799266044613591');" onmouseout="out('1261799266044613591');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 420   private static final String TAG = &quot;DownloadUtil&quot;;                                                      </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 421   /**                                                                                                    </span>
<span class="-8352985751663047055" onmouseenter="enter('-8352985751663047055');" onmouseout="out('-8352985751663047055');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 422    * 线程数                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 423    */                                                                                                    </span>
<span class="-7983967545860957599" onmouseenter="enter('-7983967545860957599');" onmouseout="out('-7983967545860957599');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 424   private final int THREAD_NUM;                                                                          </span>
<span class="-785681239530372348" onmouseenter="enter('-785681239530372348');" onmouseout="out('-785681239530372348');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 425   //下载监听                                                                                                 </span>
<span class="8085369704814778285" onmouseenter="enter('8085369704814778285');" onmouseout="out('8085369704814778285');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 426   private IDownloadListener mListener;                                                                   </span>
<span class="8993221121586487711" onmouseenter="enter('8993221121586487711');" onmouseout="out('8993221121586487711');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 427   private int mConnectTimeOut = 5000 * 4; //连接超时时间                                                       </span>
<span class="4023537183138169002" onmouseenter="enter('4023537183138169002');" onmouseout="out('4023537183138169002');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 428   private int mReadTimeOut = 5000 * 20; //流读取的超时时间                                                       </span>
<span class="-1157942250762320951" onmouseenter="enter('-1157942250762320951');" onmouseout="out('-1157942250762320951');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 429   private boolean isNewTask = true;                                                                      </span>
<span class="-7348064306101585897" onmouseenter="enter('-7348064306101585897');" onmouseout="out('-7348064306101585897');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 430   private boolean isSupportBreakpoint = true;                                                            </span>
<span class="6683852815807951473" onmouseenter="enter('6683852815807951473');" onmouseout="out('6683852815807951473');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 431   private Context mContext;                                                                              </span>
<span class="-4114987623877824308" onmouseenter="enter('-4114987623877824308');" onmouseout="out('-4114987623877824308');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 432   private DownloadEntity mDownloadEntity;                                                                </span>
<span class="1058453114158093994" onmouseenter="enter('1058453114158093994');" onmouseout="out('1058453114158093994');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 433   private ExecutorService mFixedThreadPool;                                                              </span>
<span class="-1133559474859202897" onmouseenter="enter('-1133559474859202897');" onmouseout="out('-1133559474859202897');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 434   private File mDownloadFile; //下载的文件                                                                    </span>
<span class="7861940189151317235" onmouseenter="enter('7861940189151317235');" onmouseout="out('7861940189151317235');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 435   private File mConfigFile;//下载信息配置文件                                                                    </span>
<span class="-3869960521609686448" onmouseenter="enter('-3869960521609686448');" onmouseout="out('-3869960521609686448');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 436   private SparseArray&lt;Runnable&gt; mTask = new SparseArray&lt;&gt;();                                             </span>
<span class="7070628333292412283" onmouseenter="enter('7070628333292412283');" onmouseout="out('7070628333292412283');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 437   private DownloadStateConstance mConstance;                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 438                                                                                                          </span>
<span class="-2084839900540753927" onmouseenter="enter('-2084839900540753927');" onmouseout="out('-2084839900540753927');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 439   DownloadUtil(Context context, DownloadEntity entity, IDownloadListener downloadListener) {             </span>
<span class="-4896597165635236478" onmouseenter="enter('-4896597165635236478');" onmouseout="out('-4896597165635236478');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 440     this(context, entity, downloadListener, 3);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 441   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 442                                                                                                          </span>
<span class="-4986291938704783923" onmouseenter="enter('-4986291938704783923');" onmouseout="out('-4986291938704783923');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 443   DownloadUtil(Context context, DownloadEntity entity, IDownloadListener downloadListener,               </span>
<span class="-8984238530475947621" onmouseenter="enter('-8984238530475947621');" onmouseout="out('-8984238530475947621');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 444       int threadNum) {                                                                                   </span>
<span class="-673106209130372223" onmouseenter="enter('-673106209130372223');" onmouseout="out('-673106209130372223');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 445     mContext = context.getApplicationContext();                                                          </span>
<span class="-216605200672599564" onmouseenter="enter('-216605200672599564');" onmouseout="out('-216605200672599564');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 446     mDownloadEntity = entity;                                                                            </span>
<span class="3831466484862340223" onmouseenter="enter('3831466484862340223');" onmouseout="out('3831466484862340223');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 447     mListener = downloadListener;                                                                        </span>
<span class="-6579794148103748852" onmouseenter="enter('-6579794148103748852');" onmouseout="out('-6579794148103748852');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 448     THREAD_NUM = threadNum;                                                                              </span>
<span class="-7335968387740294445" onmouseenter="enter('-7335968387740294445');" onmouseout="out('-7335968387740294445');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 449     mFixedThreadPool = Executors.newFixedThreadPool(Integer.MAX_VALUE);                                  </span>
<span class="2824360841323512384" onmouseenter="enter('2824360841323512384');" onmouseout="out('2824360841323512384');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 450     mConstance = new DownloadStateConstance(THREAD_NUM);                                                 </span>
<span class="-1498726564668589193" onmouseenter="enter('-1498726564668589193');" onmouseout="out('-1498726564668589193');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 451     init();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 452   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 453                                                                                                          </span>
<span class="-909562594025196126" onmouseenter="enter('-909562594025196126');" onmouseout="out('-909562594025196126');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 454   private void init() {                                                                                  </span>
<span class="-8302516119393797134" onmouseenter="enter('-8302516119393797134');" onmouseout="out('-8302516119393797134');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 455     mDownloadFile = new File(mDownloadEntity.getDownloadPath());                                         </span>
<span class="-3534953052494864097" onmouseenter="enter('-3534953052494864097');" onmouseout="out('-3534953052494864097');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 456     //读取已完成的线程数                                                                                          </span>
<span class="-9053998435552088983" onmouseenter="enter('-9053998435552088983');" onmouseout="out('-9053998435552088983');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 457     mConfigFile = new File(                                                                              </span>
<span class="-3948838928069897094" onmouseenter="enter('-3948838928069897094');" onmouseout="out('-3948838928069897094');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 458         mContext.getFilesDir().getPath() + &quot;/temp/&quot; + mDownloadFile.getName() + &quot;.properties&quot;);          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 459     try {                                                                                                </span>
<span class="7925700052565713558" onmouseenter="enter('7925700052565713558');" onmouseout="out('7925700052565713558');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 460       if (!mConfigFile.exists()) { //记录文件被删除，则重新下载                                                       </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 461         isNewTask = true;                                                                                </span>
<span class="1838885973573966413" onmouseenter="enter('1838885973573966413');" onmouseout="out('1838885973573966413');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 462         CommonUtil.createFile(mConfigFile.getPath());                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 463       } else {                                                                                           </span>
<span class="-6296621072689899390" onmouseenter="enter('-6296621072689899390');" onmouseout="out('-6296621072689899390');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 464         isNewTask = !mDownloadFile.exists();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 465       }                                                                                                  </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 466     } catch (Exception e) {                                                                              </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 467       e.printStackTrace();                                                                               </span>
<span class="-3747169937451325082" onmouseenter="enter('-3747169937451325082');" onmouseout="out('-3747169937451325082');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 468       failDownload(&quot;下载失败，记录文件被删除&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 469     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 470   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 471                                                                                                          </span>
<span class="-8585626151911369157" onmouseenter="enter('-8585626151911369157');" onmouseout="out('-8585626151911369157');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 472   public IDownloadListener getListener() {                                                               </span>
<span class="-7037258027690597516" onmouseenter="enter('-7037258027690597516');" onmouseout="out('-7037258027690597516');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 473     return mListener;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 474   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 475                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 476   /**                                                                                                    </span>
<span class="6936487890332430093" onmouseenter="enter('6936487890332430093');" onmouseout="out('6936487890332430093');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 477    * 设置连接超时时间                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 478    */                                                                                                    </span>
<span class="8269350745377988793" onmouseenter="enter('8269350745377988793');" onmouseout="out('8269350745377988793');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 479   public void setConnectTimeOut(int timeOut) {                                                           </span>
<span class="7491344361160646490" onmouseenter="enter('7491344361160646490');" onmouseout="out('7491344361160646490');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 480     mConnectTimeOut = timeOut;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 481   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 482                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 483   /**                                                                                                    </span>
<span class="1793189252207234639" onmouseenter="enter('1793189252207234639');" onmouseout="out('1793189252207234639');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 484    * 设置流读取的超时时间                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 485    */                                                                                                    </span>
<span class="-4265144949210493065" onmouseenter="enter('-4265144949210493065');" onmouseout="out('-4265144949210493065');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 486   public void setReadTimeOut(int readTimeOut) {                                                          </span>
<span class="-3349186980434336657" onmouseenter="enter('-3349186980434336657');" onmouseout="out('-3349186980434336657');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 487     mReadTimeOut = readTimeOut;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 488   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 489                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 490   /**                                                                                                    </span>
<span class="6025979389427346334" onmouseenter="enter('6025979389427346334');" onmouseout="out('6025979389427346334');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 491    * 获取当前下载位置                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 492    */                                                                                                    </span>
<span class="42588745782017963" onmouseenter="enter('42588745782017963');" onmouseout="out('42588745782017963');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 493   @Override public long getCurrentLocation() {                                                           </span>
<span class="2881215542099369319" onmouseenter="enter('2881215542099369319');" onmouseout="out('2881215542099369319');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 494     return mConstance.CURRENT_LOCATION;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 495   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 496                                                                                                          </span>
<span class="8514823861416132786" onmouseenter="enter('8514823861416132786');" onmouseout="out('8514823861416132786');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 497   @Override public boolean isDownloading() {                                                             </span>
<span class="-2560940912314579274" onmouseenter="enter('-2560940912314579274');" onmouseout="out('-2560940912314579274');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 498     return mConstance.isDownloading;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 499   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 500                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 501   /**                                                                                                    </span>
<span class="8520049766391668792" onmouseenter="enter('8520049766391668792');" onmouseout="out('8520049766391668792');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 502    * 取消下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 503    */                                                                                                    </span>
<span class="8518544268347342740" onmouseenter="enter('8518544268347342740');" onmouseout="out('8518544268347342740');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 504   @Override public void cancelDownload() {                                                               </span>
<span class="204250319841071761" onmouseenter="enter('204250319841071761');" onmouseout="out('204250319841071761');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 505     mConstance.isCancel = true;                                                                          </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 506     mConstance.isDownloading = false;                                                                    </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 507     mFixedThreadPool.shutdown();                                                                         </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 508     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="6217106455110130996" onmouseenter="enter('6217106455110130996');" onmouseout="out('6217106455110130996');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 509       SingleThreadTask task = (SingleThreadTask) mTask.get(i);                                           </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 510       if (task != null) {                                                                                </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 511         task.cancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 512       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 513     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 514   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 515                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 516   /**                                                                                                    </span>
<span class="7755328866638560569" onmouseenter="enter('7755328866638560569');" onmouseout="out('7755328866638560569');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 517    * 停止下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 518    */                                                                                                    </span>
<span class="-4596234023078912379" onmouseenter="enter('-4596234023078912379');" onmouseout="out('-4596234023078912379');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 519   @Override public void stopDownload() {                                                                 </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 520     mConstance.isStop = true;                                                                            </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 521     mConstance.isDownloading = false;                                                                    </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 522     mFixedThreadPool.shutdown();                                                                         </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 523     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="6217106455110130996" onmouseenter="enter('6217106455110130996');" onmouseout="out('6217106455110130996');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 524       SingleThreadTask task = (SingleThreadTask) mTask.get(i);                                           </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 525       if (task != null) {                                                                                </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 526         task.stop();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 527       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 528     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 529   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 530                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 531   /**                                                                                                    </span>
<span class="8538662619258057049" onmouseenter="enter('8538662619258057049');" onmouseout="out('8538662619258057049');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 532    * 删除下载记录文件                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 533    */                                                                                                    </span>
<span class="-6348491485207421588" onmouseenter="enter('-6348491485207421588');" onmouseout="out('-6348491485207421588');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 534   @Override public void delConfigFile() {                                                                </span>
<span class="8558402344038566367" onmouseenter="enter('8558402344038566367');" onmouseout="out('8558402344038566367');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 535     if (mContext != null &amp;&amp; mDownloadEntity != null) {                                                   </span>
<span class="3099781541276521660" onmouseenter="enter('3099781541276521660');" onmouseout="out('3099781541276521660');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 536       File dFile = new File(mDownloadEntity.getDownloadPath());                                          </span>
<span class="-1217451156974226618" onmouseenter="enter('-1217451156974226618');" onmouseout="out('-1217451156974226618');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 537       File config =                                                                                      </span>
<span class="1777202063354625193" onmouseenter="enter('1777202063354625193');" onmouseout="out('1777202063354625193');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 538           new File(mContext.getFilesDir().getPath() + &quot;/temp/&quot; + dFile.getName() + &quot;.properties&quot;);       </span>
<span class="-7696478919602418443" onmouseenter="enter('-7696478919602418443');" onmouseout="out('-7696478919602418443');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 539       if (config.exists()) {                                                                             </span>
<span class="-5702358031910949081" onmouseenter="enter('-5702358031910949081');" onmouseout="out('-5702358031910949081');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 540         config.delete();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 541       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 542     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 543   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 544                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 545   /**                                                                                                    </span>
<span class="-8312193682087493639" onmouseenter="enter('-8312193682087493639');" onmouseout="out('-8312193682087493639');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 546    * 删除temp文件                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 547    */                                                                                                    </span>
<span class="7655331082892594561" onmouseenter="enter('7655331082892594561');" onmouseout="out('7655331082892594561');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 548   @Override public void delTempFile() {                                                                  </span>
<span class="8558402344038566367" onmouseenter="enter('8558402344038566367');" onmouseout="out('8558402344038566367');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 549     if (mContext != null &amp;&amp; mDownloadEntity != null) {                                                   </span>
<span class="3099781541276521660" onmouseenter="enter('3099781541276521660');" onmouseout="out('3099781541276521660');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 550       File dFile = new File(mDownloadEntity.getDownloadPath());                                          </span>
<span class="7897717398420259974" onmouseenter="enter('7897717398420259974');" onmouseout="out('7897717398420259974');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 551       if (dFile.exists()) {                                                                              </span>
<span class="7527345290446588408" onmouseenter="enter('7527345290446588408');" onmouseout="out('7527345290446588408');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 552         dFile.delete();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 553       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 554     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 555   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 556                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 557   /**                                                                                                    </span>
<span class="-5727215122052088545" onmouseenter="enter('-5727215122052088545');" onmouseout="out('-5727215122052088545');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 558    * 多线程断点续传下载文件，开始下载                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 559    */                                                                                                    </span>
<span class="-4856178778199245062" onmouseenter="enter('-4856178778199245062');" onmouseout="out('-4856178778199245062');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 560   @Override public void startDownload() {                                                                </span>
<span class="898408935389387935" onmouseenter="enter('898408935389387935');" onmouseout="out('898408935389387935');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 561     mConstance.cleanState();                                                                             </span>
<span class="2099174989180368882" onmouseenter="enter('2099174989180368882');" onmouseout="out('2099174989180368882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 562     mListener.onPre();                                                                                   </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 563     new Thread(this).start();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 564   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 565                                                                                                          </span>
<span class="-5762688668558425600" onmouseenter="enter('-5762688668558425600');" onmouseout="out('-5762688668558425600');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 566   @Override public void resumeDownload() {                                                               </span>
<span class="1497820413888703615" onmouseenter="enter('1497820413888703615');" onmouseout="out('1497820413888703615');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 567     startDownload();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 568   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 569                                                                                                          </span>
<span class="8306009172830771261" onmouseenter="enter('8306009172830771261');" onmouseout="out('8306009172830771261');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 570   private void failDownload(String msg) {                                                                </span>
<span class="-6647758959009774834" onmouseenter="enter('-6647758959009774834');" onmouseout="out('-6647758959009774834');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 571     Log.e(TAG, msg);                                                                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 572     mConstance.isDownloading = false;                                                                    </span>
<span class="-6715929234808926893" onmouseenter="enter('-6715929234808926893');" onmouseout="out('-6715929234808926893');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 573     stopDownload();                                                                                      </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 574     mListener.onFail();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 575   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 576                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 577   @Override public void run() {                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 578     try {                                                                                                </span>
<span class="5483634401908283016" onmouseenter="enter('5483634401908283016');" onmouseout="out('5483634401908283016');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 579       URL url = new URL(mDownloadEntity.getDownloadUrl());                                               </span>
<span class="-6008953795197858884" onmouseenter="enter('-6008953795197858884');" onmouseout="out('-6008953795197858884');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 580       HttpURLConnection conn = ConnectionHelp.handleConnection(url);                                     </span>
<span class="2062133901627510982" onmouseenter="enter('2062133901627510982');" onmouseout="out('2062133901627510982');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 581       conn = ConnectionHelp.setConnectParam(conn);                                                       </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 582       conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                              </span>
<span class="-3579311541579934971" onmouseenter="enter('-3579311541579934971');" onmouseout="out('-3579311541579934971');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 583       conn.setConnectTimeout(mConnectTimeOut * 4);                                                       </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 584       conn.connect();                                                                                    </span>
<span class="6567575788372053568" onmouseenter="enter('6567575788372053568');" onmouseout="out('6567575788372053568');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 585       int len = conn.getContentLength();                                                                 </span>
<span class="3904365852949278245" onmouseenter="enter('3904365852949278245');" onmouseout="out('3904365852949278245');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 586       //if (len &lt; 0) {  //网络被劫持时会出现这个问题                                                                  </span>
<span class="835324676499837078" onmouseenter="enter('835324676499837078');" onmouseout="out('835324676499837078');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 587       //  failDownload(&quot;下载失败，网络被劫持&quot;);                                                                    </span>
<span class="3500611444781325819" onmouseenter="enter('3500611444781325819');" onmouseout="out('3500611444781325819');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 588       //  return;                                                                                        </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 589       //}                                                                                                </span>
<span class="-5653376755036700146" onmouseenter="enter('-5653376755036700146');" onmouseout="out('-5653376755036700146');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 590       int code = conn.getResponseCode();                                                                 </span>
<span class="999254544547719885" onmouseenter="enter('999254544547719885');" onmouseout="out('999254544547719885');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 591       //https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81                                    </span>
<span class="-8703603538857387010" onmouseenter="enter('-8703603538857387010');" onmouseout="out('-8703603538857387010');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 592       //206支持断点                                                                                          </span>
<span class="5260656878663172399" onmouseenter="enter('5260656878663172399');" onmouseout="out('5260656878663172399');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 593       if (code == HttpURLConnection.HTTP_PARTIAL) {                                                      </span>
<span class="-4850747580721370850" onmouseenter="enter('-4850747580721370850');" onmouseout="out('-4850747580721370850');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 594         isSupportBreakpoint = true;                                                                      </span>
<span class="1256350564434583014" onmouseenter="enter('1256350564434583014');" onmouseout="out('1256350564434583014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 595         mListener.supportBreakpoint(true);                                                               </span>
<span class="-7366273742365769169" onmouseenter="enter('-7366273742365769169');" onmouseout="out('-7366273742365769169');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 596         handleBreakpoint(conn);                                                                          </span>
<span class="877851589237632825" onmouseenter="enter('877851589237632825');" onmouseout="out('877851589237632825');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 597       } else if (code == HttpURLConnection.HTTP_OK || len &lt; 0) {                                         </span>
<span class="-5840271675092361063" onmouseenter="enter('-5840271675092361063');" onmouseout="out('-5840271675092361063');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 598         //在conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);下，200为不支持断点状态                            </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 599         if (len &lt; 0) {                                                                                   </span>
<span class="9025825393004184595" onmouseenter="enter('9025825393004184595');" onmouseout="out('9025825393004184595');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 600           failDownload(&quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，文件长度小于0&quot;);                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 601           return;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 602         }                                                                                                </span>
<span class="5451458949060440820" onmouseenter="enter('5451458949060440820');" onmouseout="out('5451458949060440820');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 603         isSupportBreakpoint = false;                                                                     </span>
<span class="3223278567209587987" onmouseenter="enter('3223278567209587987');" onmouseout="out('3223278567209587987');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 604         mListener.supportBreakpoint(false);                                                              </span>
<span class="-3209038805792969148" onmouseenter="enter('-3209038805792969148');" onmouseout="out('-3209038805792969148');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 605         Log.w(TAG, &quot;该下载链接不支持断点下载&quot;);                                                                      </span>
<span class="-7366273742365769169" onmouseenter="enter('-7366273742365769169');" onmouseout="out('-7366273742365769169');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 606         handleBreakpoint(conn);                                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 607       } else {                                                                                           </span>
<span class="3429592426515613091" onmouseenter="enter('3429592426515613091');" onmouseout="out('3429592426515613091');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 608         failDownload(&quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，返回码：&quot; + code);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 609       }                                                                                                  </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 610     } catch (IOException e) {                                                                            </span>
<span class="7015103282251076587" onmouseenter="enter('7015103282251076587');" onmouseout="out('7015103282251076587');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 611       failDownload(&quot;下载失败【downloadUrl:&quot;                                                                   </span>
<span class="5951112113295803501" onmouseenter="enter('5951112113295803501');" onmouseout="out('5951112113295803501');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 612           + mDownloadEntity.getDownloadUrl()                                                             </span>
<span class="910868662350755341" onmouseenter="enter('910868662350755341');" onmouseout="out('910868662350755341');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 613           + &quot;】\n【filePath:&quot;                                                                              </span>
<span class="5931171797063415443" onmouseenter="enter('5931171797063415443');" onmouseout="out('5931171797063415443');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 614           + mDownloadFile.getPath()                                                                      </span>
<span class="-1840319934610193149" onmouseenter="enter('-1840319934610193149');" onmouseout="out('-1840319934610193149');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 615           + &quot;】&quot;                                                                                          </span>
<span class="-5371623624849066023" onmouseenter="enter('-5371623624849066023');" onmouseout="out('-5371623624849066023');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 616           + CommonUtil.getPrintException(e));                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 617     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 618   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 619                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 620   /**                                                                                                    </span>
<span class="-2887709646015060517" onmouseenter="enter('-2887709646015060517');" onmouseout="out('-2887709646015060517');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 621    * 处理断点                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 622    */                                                                                                    </span>
<span class="-1770943272374407595" onmouseenter="enter('-1770943272374407595');" onmouseout="out('-1770943272374407595');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 623   private void handleBreakpoint(HttpURLConnection conn) throws IOException {                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 624                                                                                                          </span>
<span class="7477238500582408106" onmouseenter="enter('7477238500582408106');" onmouseout="out('7477238500582408106');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 625     //不支持断点只能单线程下载                                                                                       </span>
<span class="-6722781002220970553" onmouseenter="enter('-6722781002220970553');" onmouseout="out('-6722781002220970553');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 626     if (!isSupportBreakpoint) {                                                                          </span>
<span class="-8481066330390671660" onmouseenter="enter('-8481066330390671660');" onmouseout="out('-8481066330390671660');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 627       ConfigEntity entity = new ConfigEntity();                                                          </span>
<span class="9125695722945677869" onmouseenter="enter('9125695722945677869');" onmouseout="out('9125695722945677869');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 628       entity.FILE_SIZE = conn.getContentLength();                                                        </span>
<span class="4189357201157412201" onmouseenter="enter('4189357201157412201');" onmouseout="out('4189357201157412201');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 629       entity.DOWNLOAD_URL = mDownloadEntity.getDownloadUrl();                                            </span>
<span class="1175511499700324517" onmouseenter="enter('1175511499700324517');" onmouseout="out('1175511499700324517');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 630       entity.TEMP_FILE = mDownloadFile;                                                                  </span>
<span class="-1353085718172399938" onmouseenter="enter('-1353085718172399938');" onmouseout="out('-1353085718172399938');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 631       entity.THREAD_ID = 0;                                                                              </span>
<span class="-4967231089338870782" onmouseenter="enter('-4967231089338870782');" onmouseout="out('-4967231089338870782');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 632       entity.START_LOCATION = 0;                                                                         </span>
<span class="4365950116387297475" onmouseenter="enter('4365950116387297475');" onmouseout="out('4365950116387297475');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 633       entity.END_LOCATION = entity.FILE_SIZE;                                                            </span>
<span class="-7848202009707844875" onmouseenter="enter('-7848202009707844875');" onmouseout="out('-7848202009707844875');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 634       entity.CONFIG_FILE_PATH = mConfigFile.getPath();                                                   </span>
<span class="2812036997657153043" onmouseenter="enter('2812036997657153043');" onmouseout="out('2812036997657153043');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 635       entity.isSupportBreakpoint = isSupportBreakpoint;                                                  </span>
<span class="4531885195650702733" onmouseenter="enter('4531885195650702733');" onmouseout="out('4531885195650702733');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 636       SingleThreadTask task = new SingleThreadTask(mConstance, mListener, entity);                       </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 637       mFixedThreadPool.execute(task);                                                                    </span>
<span class="-2943780714290472761" onmouseenter="enter('-2943780714290472761');" onmouseout="out('-2943780714290472761');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 638       mListener.onStart(0);                                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 639       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 640     }                                                                                                    </span>
<span class="-4144971478129188538" onmouseenter="enter('-4144971478129188538');" onmouseout="out('-4144971478129188538');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 641     int fileLength = conn.getContentLength();                                                            </span>
<span class="-3771769896201867631" onmouseenter="enter('-3771769896201867631');" onmouseout="out('-3771769896201867631');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 642     //必须建一个文件                                                                                            </span>
<span class="-8241179119122160888" onmouseenter="enter('-8241179119122160888');" onmouseout="out('-8241179119122160888');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 643     CommonUtil.createFile(mDownloadFile.getPath());                                                      </span>
<span class="-844126738551985064" onmouseenter="enter('-844126738551985064');" onmouseout="out('-844126738551985064');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 644     RandomAccessFile file = new RandomAccessFile(mDownloadFile.getPath(), &quot;rwd&quot;);                        </span>
<span class="-564508951971497574" onmouseenter="enter('-564508951971497574');" onmouseout="out('-564508951971497574');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 645     //设置文件长度                                                                                             </span>
<span class="6023690204241765206" onmouseenter="enter('6023690204241765206');" onmouseout="out('6023690204241765206');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 646     file.setLength(fileLength);                                                                          </span>
<span class="5666806310833670603" onmouseenter="enter('5666806310833670603');" onmouseout="out('5666806310833670603');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 647     mListener.onPostPre(fileLength);                                                                     </span>
<span class="6024675825413521783" onmouseenter="enter('6024675825413521783');" onmouseout="out('6024675825413521783');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 648     //分配每条线程的下载区间                                                                                        </span>
<span class="-317662916418562024" onmouseenter="enter('-317662916418562024');" onmouseout="out('-317662916418562024');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 649     Properties pro = null;                                                                               </span>
<span class="4467713772376842471" onmouseenter="enter('4467713772376842471');" onmouseout="out('4467713772376842471');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 650     pro = CommonUtil.loadConfig(mConfigFile);                                                            </span>
<span class="-681137634566379888" onmouseenter="enter('-681137634566379888');" onmouseout="out('-681137634566379888');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 651     if (pro.isEmpty()) {                                                                                 </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 652       isNewTask = true;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 653     } else {                                                                                             </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 654       for (int i = 0; i &lt; THREAD_NUM; i++) {                                                             </span>
<span class="-6973645922135466911" onmouseenter="enter('-6973645922135466911');" onmouseout="out('-6973645922135466911');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 655         if (pro.getProperty(mDownloadFile.getName() + &quot;_record_&quot; + i) == null) {                         </span>
<span class="1178951043321657234" onmouseenter="enter('1178951043321657234');" onmouseout="out('1178951043321657234');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 656           Object state = pro.getProperty(mDownloadFile.getName() + &quot;_state_&quot; + i);                       </span>
<span class="-2092430839348453245" onmouseenter="enter('-2092430839348453245');" onmouseout="out('-2092430839348453245');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 657           if (state != null &amp;&amp; Integer.parseInt(state + &quot;&quot;) == 1) {                                      </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 658             continue;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 659           }                                                                                              </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 660           isNewTask = true;                                                                              </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 661           break;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 662         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 663       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 664     }                                                                                                    </span>
<span class="-1643854653241583074" onmouseenter="enter('-1643854653241583074');" onmouseout="out('-1643854653241583074');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 665     int blockSize = fileLength / THREAD_NUM;                                                             </span>
<span class="866019335924650779" onmouseenter="enter('866019335924650779');" onmouseout="out('866019335924650779');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 666     int[] recordL = new int[THREAD_NUM];                                                                 </span>
<span class="794844889575716346" onmouseenter="enter('794844889575716346');" onmouseout="out('794844889575716346');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 667     int rl = 0;                                                                                          </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 668     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="8242320341463399828" onmouseenter="enter('8242320341463399828');" onmouseout="out('8242320341463399828');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 669       recordL[i] = -1;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 670     }                                                                                                    </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 671     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="-2965725495076654490" onmouseenter="enter('-2965725495076654490');" onmouseout="out('-2965725495076654490');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 672       long startL = i * blockSize, endL = (i + 1) * blockSize;                                           </span>
<span class="1178951043321657234" onmouseenter="enter('1178951043321657234');" onmouseout="out('1178951043321657234');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 673       Object state = pro.getProperty(mDownloadFile.getName() + &quot;_state_&quot; + i);                           </span>
<span class="2419725940883839935" onmouseenter="enter('2419725940883839935');" onmouseout="out('2419725940883839935');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 674       if (state != null &amp;&amp; Integer.parseInt(state + &quot;&quot;) == 1) {  //该线程已经完成                               </span>
<span class="8742170387731029623" onmouseenter="enter('8742170387731029623');" onmouseout="out('8742170387731029623');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 675         mConstance.CURRENT_LOCATION += endL - startL;                                                    </span>
<span class="7342592738960136820" onmouseenter="enter('7342592738960136820');" onmouseout="out('7342592738960136820');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 676         Log.d(TAG, &quot;++++++++++ 线程_&quot; + i + &quot;_已经下载完成 ++++++++++&quot;);                                         </span>
<span class="-337774801975969950" onmouseenter="enter('-337774801975969950');" onmouseout="out('-337774801975969950');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 677         mConstance.COMPLETE_THREAD_NUM++;                                                                </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 678         mConstance.STOP_NUM++;                                                                           </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 679         mConstance.CANCEL_NUM++;                                                                         </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 680         if (mConstance.isComplete()) {                                                                   </span>
<span class="4951157766975006439" onmouseenter="enter('4951157766975006439');" onmouseout="out('4951157766975006439');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 681           if (mConfigFile.exists()) {                                                                    </span>
<span class="-8106518526167482323" onmouseenter="enter('-8106518526167482323');" onmouseout="out('-8106518526167482323');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 682             mConfigFile.delete();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 683           }                                                                                              </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 684           mListener.onComplete();                                                                        </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 685           mConstance.isDownloading = false;                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 686           return;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 687         }                                                                                                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 688         continue;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 689       }                                                                                                  </span>
<span class="-1793454279264850881" onmouseenter="enter('-1793454279264850881');" onmouseout="out('-1793454279264850881');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 690       //分配下载位置                                                                                           </span>
<span class="-8200484973700844224" onmouseenter="enter('-8200484973700844224');" onmouseout="out('-8200484973700844224');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 691       Object record = pro.getProperty(mDownloadFile.getName() + &quot;_record_&quot; + i);                         </span>
<span class="-4606277471232235328" onmouseenter="enter('-4606277471232235328');" onmouseout="out('-4606277471232235328');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 692       //如果有记录，则恢复下载                                                                                      </span>
<span class="9081430961250736769" onmouseenter="enter('9081430961250736769');" onmouseout="out('9081430961250736769');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 693       if (!isNewTask &amp;&amp; record != null &amp;&amp; Long.parseLong(record + &quot;&quot;) &gt; 0) {                             </span>
<span class="8647082033828497822" onmouseenter="enter('8647082033828497822');" onmouseout="out('8647082033828497822');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 694         Long r = Long.parseLong(record + &quot;&quot;);                                                            </span>
<span class="1683054574044455381" onmouseenter="enter('1683054574044455381');" onmouseout="out('1683054574044455381');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 695         mConstance.CURRENT_LOCATION += r - startL;                                                       </span>
<span class="179733331572927392" onmouseenter="enter('179733331572927392');" onmouseout="out('179733331572927392');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 696         Log.d(TAG, &quot;++++++++++ 线程_&quot; + i + &quot;_恢复下载 ++++++++++&quot;);                                           </span>
<span class="6939461797319425642" onmouseenter="enter('6939461797319425642');" onmouseout="out('6939461797319425642');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 697         mListener.onChildResume(r);                                                                      </span>
<span class="1542845345888554533" onmouseenter="enter('1542845345888554533');" onmouseout="out('1542845345888554533');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 698         startL = r;                                                                                      </span>
<span class="-7425711498405631322" onmouseenter="enter('-7425711498405631322');" onmouseout="out('-7425711498405631322');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 699         recordL[rl] = i;                                                                                 </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 700         rl++;                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 701       } else {                                                                                           </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 702         isNewTask = true;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 703       }                                                                                                  </span>
<span class="537230916062757449" onmouseenter="enter('537230916062757449');" onmouseout="out('537230916062757449');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 704       if (isNewTask) {                                                                                   </span>
<span class="-7425711498405631322" onmouseenter="enter('-7425711498405631322');" onmouseout="out('-7425711498405631322');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 705         recordL[rl] = i;                                                                                 </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 706         rl++;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 707       }                                                                                                  </span>
<span class="-3400889980578220125" onmouseenter="enter('-3400889980578220125');" onmouseout="out('-3400889980578220125');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 708       if (i == (THREAD_NUM - 1)) {                                                                       </span>
<span class="-7423751213765432972" onmouseenter="enter('-7423751213765432972');" onmouseout="out('-7423751213765432972');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 709         //如果整个文件的大小不为线程个数的整数倍，则最后一个线程的结束位置即为文件的总长度                                                       </span>
<span class="-2829184075463306484" onmouseenter="enter('-2829184075463306484');" onmouseout="out('-2829184075463306484');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 710         endL = fileLength;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 711       }                                                                                                  </span>
<span class="-8481066330390671660" onmouseenter="enter('-8481066330390671660');" onmouseout="out('-8481066330390671660');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 712       ConfigEntity entity = new ConfigEntity();                                                          </span>
<span class="-3119684513187648029" onmouseenter="enter('-3119684513187648029');" onmouseout="out('-3119684513187648029');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 713       entity.FILE_SIZE = fileLength;                                                                     </span>
<span class="4189357201157412201" onmouseenter="enter('4189357201157412201');" onmouseout="out('4189357201157412201');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 714       entity.DOWNLOAD_URL = mDownloadEntity.getDownloadUrl();                                            </span>
<span class="1175511499700324517" onmouseenter="enter('1175511499700324517');" onmouseout="out('1175511499700324517');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 715       entity.TEMP_FILE = mDownloadFile;                                                                  </span>
<span class="-1808458878368858692" onmouseenter="enter('-1808458878368858692');" onmouseout="out('-1808458878368858692');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 716       entity.THREAD_ID = i;                                                                              </span>
<span class="6661292811999012973" onmouseenter="enter('6661292811999012973');" onmouseout="out('6661292811999012973');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 717       entity.START_LOCATION = startL;                                                                    </span>
<span class="8656472587238389131" onmouseenter="enter('8656472587238389131');" onmouseout="out('8656472587238389131');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 718       entity.END_LOCATION = endL;                                                                        </span>
<span class="-7848202009707844875" onmouseenter="enter('-7848202009707844875');" onmouseout="out('-7848202009707844875');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 719       entity.CONFIG_FILE_PATH = mConfigFile.getPath();                                                   </span>
<span class="2812036997657153043" onmouseenter="enter('2812036997657153043');" onmouseout="out('2812036997657153043');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 720       entity.isSupportBreakpoint = isSupportBreakpoint;                                                  </span>
<span class="4531885195650702733" onmouseenter="enter('4531885195650702733');" onmouseout="out('4531885195650702733');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 721       SingleThreadTask task = new SingleThreadTask(mConstance, mListener, entity);                       </span>
<span class="-6012810893938815399" onmouseenter="enter('-6012810893938815399');" onmouseout="out('-6012810893938815399');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 722       mTask.put(i, task);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 723     }                                                                                                    </span>
<span class="-1061602448343886008" onmouseenter="enter('-1061602448343886008');" onmouseout="out('-1061602448343886008');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 724     if (mConstance.CURRENT_LOCATION &gt; 0) {                                                               </span>
<span class="5187035189520501266" onmouseenter="enter('5187035189520501266');" onmouseout="out('5187035189520501266');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 725       mListener.onResume(mConstance.CURRENT_LOCATION);                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 726     } else {                                                                                             </span>
<span class="-2973471902048685805" onmouseenter="enter('-2973471902048685805');" onmouseout="out('-2973471902048685805');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 727       mListener.onStart(mConstance.CURRENT_LOCATION);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 728     }                                                                                                    </span>
<span class="1243235571055153612" onmouseenter="enter('1243235571055153612');" onmouseout="out('1243235571055153612');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 729     for (int l : recordL) {                                                                              </span>
<span class="-7510837703317171619" onmouseenter="enter('-7510837703317171619');" onmouseout="out('-7510837703317171619');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 730       if (l == -1) continue;                                                                             </span>
<span class="-85915337091278441" onmouseenter="enter('-85915337091278441');" onmouseout="out('-85915337091278441');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 731       Runnable task = mTask.get(l);                                                                      </span>
<span class="-7327661534177463737" onmouseenter="enter('-7327661534177463737');" onmouseout="out('-7327661534177463737');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 732       if (task != null &amp;&amp; !mFixedThreadPool.isShutdown()) {                                              </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 733         mFixedThreadPool.execute(task);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 734       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 735     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 736   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 737                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 738   /**                                                                                                    </span>
<span class="2585942053451624927" onmouseenter="enter('2585942053451624927');" onmouseout="out('2585942053451624927');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 739    * 子线程下载信息类                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 740    */                                                                                                    </span>
<span class="-3850188489545087742" onmouseenter="enter('-3850188489545087742');" onmouseout="out('-3850188489545087742');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 741   final static class ConfigEntity {                                                                      </span>
<span class="-403498804051257270" onmouseenter="enter('-403498804051257270');" onmouseout="out('-403498804051257270');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 742     //文件大小                                                                                               </span>
<span class="541475241289655650" onmouseenter="enter('541475241289655650');" onmouseout="out('541475241289655650');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 743     long FILE_SIZE;                                                                                      </span>
<span class="-4736398418022593572" onmouseenter="enter('-4736398418022593572');" onmouseout="out('-4736398418022593572');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 744     String DOWNLOAD_URL;                                                                                 </span>
<span class="-7368464316865211776" onmouseenter="enter('-7368464316865211776');" onmouseout="out('-7368464316865211776');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 745     int THREAD_ID;                                                                                       </span>
<span class="3260682776668453255" onmouseenter="enter('3260682776668453255');" onmouseout="out('3260682776668453255');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 746     long START_LOCATION;                                                                                 </span>
<span class="2446069397877689758" onmouseenter="enter('2446069397877689758');" onmouseout="out('2446069397877689758');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 747     long END_LOCATION;                                                                                   </span>
<span class="4104096962052364503" onmouseenter="enter('4104096962052364503');" onmouseout="out('4104096962052364503');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 748     File TEMP_FILE;                                                                                      </span>
<span class="-2017423643980728828" onmouseenter="enter('-2017423643980728828');" onmouseout="out('-2017423643980728828');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 749     boolean isSupportBreakpoint = true;                                                                  </span>
<span class="-2943683475239618057" onmouseenter="enter('-2943683475239618057');" onmouseout="out('-2943683475239618057');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 750     String CONFIG_FILE_PATH;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 751   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 752 }                                                                                                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 753 =======                                                                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 754 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span></pre></td>
                            <td><pre><span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   2 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   3  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   4  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   5  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   6  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   7  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   8  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   9  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  10  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  11  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  12  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  13  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  14  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  15  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  16  */                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  17                                                                                                          </span>
<span class="-1768704711895145311" onmouseenter="enter('-1768704711895145311');" onmouseout="out('-1768704711895145311');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  18 package com.arialyy.aria.core.task;                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  19                                                                                                          </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  20 import android.content.Context;                                                                          </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  21 import android.util.Log;                                                                                 </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  22 import android.util.SparseArray;                                                                         </span>
<span class="-8446909004143589790" onmouseenter="enter('-8446909004143589790');" onmouseout="out('-8446909004143589790');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  23 import com.arialyy.aria.core.DownloadEntity;                                                             </span>
<span class="-1661010561836341583" onmouseenter="enter('-1661010561836341583');" onmouseout="out('-1661010561836341583');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  24 import com.arialyy.aria.util.BufferedRandomAccessFile;                                                   </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  25 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  26 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  27 import java.io.IOException;                                                                              </span>
<span class="-3877933607611446246" onmouseenter="enter('-3877933607611446246');" onmouseout="out('-3877933607611446246');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  28 import java.io.RandomAccessFile;                                                                         </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  29 import java.net.HttpURLConnection;                                                                       </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  30 import java.net.URL;                                                                                     </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  31 import java.util.Properties;                                                                             </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  32 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  33 import java.util.concurrent.Executors;                                                                   </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  34                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  35 /**                                                                                                      </span>
<span class="2363292981682035173" onmouseenter="enter('2363292981682035173');" onmouseout="out('2363292981682035173');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  36  * Created by lyy on 2015/8/25.                                                                          </span>
<span class="-8257115403302511340" onmouseenter="enter('-8257115403302511340');" onmouseout="out('-8257115403302511340');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  37  * 下载工具类                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  38  */                                                                                                      </span>
<span class="2282207299880186426" onmouseenter="enter('2282207299880186426');" onmouseout="out('2282207299880186426');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  39 public class DownloadUtil implements IDownloadUtil, Runnable {                                           </span>
<span class="1261799266044613591" onmouseenter="enter('1261799266044613591');" onmouseout="out('1261799266044613591');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  40   private static final String TAG = &quot;DownloadUtil&quot;;                                                      </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41   /**                                                                                                    </span>
<span class="-8352985751663047055" onmouseenter="enter('-8352985751663047055');" onmouseout="out('-8352985751663047055');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42    * 线程数                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  43    */                                                                                                    </span>
<span class="-7983967545860957599" onmouseenter="enter('-7983967545860957599');" onmouseout="out('-7983967545860957599');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  44   private final int THREAD_NUM;                                                                          </span>
<span class="-785681239530372348" onmouseenter="enter('-785681239530372348');" onmouseout="out('-785681239530372348');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  45   //下载监听                                                                                                 </span>
<span class="8085369704814778285" onmouseenter="enter('8085369704814778285');" onmouseout="out('8085369704814778285');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  46   private IDownloadListener mListener;                                                                   </span>
<span class="8993221121586487711" onmouseenter="enter('8993221121586487711');" onmouseout="out('8993221121586487711');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  47   private int mConnectTimeOut = 5000 * 4; //连接超时时间                                                       </span>
<span class="4023537183138169002" onmouseenter="enter('4023537183138169002');" onmouseout="out('4023537183138169002');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  48   private int mReadTimeOut = 5000 * 20; //流读取的超时时间                                                       </span>
<span class="-1157942250762320951" onmouseenter="enter('-1157942250762320951');" onmouseout="out('-1157942250762320951');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  49   private boolean isNewTask = true;                                                                      </span>
<span class="-7348064306101585897" onmouseenter="enter('-7348064306101585897');" onmouseout="out('-7348064306101585897');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  50   private boolean isSupportBreakpoint = true;                                                            </span>
<span class="6683852815807951473" onmouseenter="enter('6683852815807951473');" onmouseout="out('6683852815807951473');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  51   private Context mContext;                                                                              </span>
<span class="-4114987623877824308" onmouseenter="enter('-4114987623877824308');" onmouseout="out('-4114987623877824308');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  52   private DownloadEntity mDownloadEntity;                                                                </span>
<span class="1058453114158093994" onmouseenter="enter('1058453114158093994');" onmouseout="out('1058453114158093994');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53   private ExecutorService mFixedThreadPool;                                                              </span>
<span class="-1133559474859202897" onmouseenter="enter('-1133559474859202897');" onmouseout="out('-1133559474859202897');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54   private File mDownloadFile; //下载的文件                                                                    </span>
<span class="7861940189151317235" onmouseenter="enter('7861940189151317235');" onmouseout="out('7861940189151317235');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55   private File mConfigFile;//下载信息配置文件                                                                    </span>
<span class="-3869960521609686448" onmouseenter="enter('-3869960521609686448');" onmouseout="out('-3869960521609686448');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56   private SparseArray&lt;Runnable&gt; mTask = new SparseArray&lt;&gt;();                                             </span>
<span class="7070628333292412283" onmouseenter="enter('7070628333292412283');" onmouseout="out('7070628333292412283');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57   private DownloadStateConstance mConstance;                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58                                                                                                          </span>
<span class="-6554670557683360136" onmouseenter="enter('-6554670557683360136');" onmouseout="out('-6554670557683360136');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59   public DownloadUtil(Context context, DownloadEntity entity, IDownloadListener downloadListener) {      </span>
<span class="-4896597165635236478" onmouseenter="enter('-4896597165635236478');" onmouseout="out('-4896597165635236478');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60     this(context, entity, downloadListener, 3);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  61   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  62                                                                                                          </span>
<span class="-4986291938704783923" onmouseenter="enter('-4986291938704783923');" onmouseout="out('-4986291938704783923');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  63   DownloadUtil(Context context, DownloadEntity entity, IDownloadListener downloadListener,               </span>
<span class="-8984238530475947621" onmouseenter="enter('-8984238530475947621');" onmouseout="out('-8984238530475947621');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  64       int threadNum) {                                                                                   </span>
<span class="-673106209130372223" onmouseenter="enter('-673106209130372223');" onmouseout="out('-673106209130372223');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  65     mContext = context.getApplicationContext();                                                          </span>
<span class="-216605200672599564" onmouseenter="enter('-216605200672599564');" onmouseout="out('-216605200672599564');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  66     mDownloadEntity = entity;                                                                            </span>
<span class="3831466484862340223" onmouseenter="enter('3831466484862340223');" onmouseout="out('3831466484862340223');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67     mListener = downloadListener;                                                                        </span>
<span class="-6579794148103748852" onmouseenter="enter('-6579794148103748852');" onmouseout="out('-6579794148103748852');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  68     THREAD_NUM = threadNum;                                                                              </span>
<span class="-7335968387740294445" onmouseenter="enter('-7335968387740294445');" onmouseout="out('-7335968387740294445');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  69     mFixedThreadPool = Executors.newFixedThreadPool(Integer.MAX_VALUE);                                  </span>
<span class="2824360841323512384" onmouseenter="enter('2824360841323512384');" onmouseout="out('2824360841323512384');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  70     mConstance = new DownloadStateConstance(THREAD_NUM);                                                 </span>
<span class="-1498726564668589193" onmouseenter="enter('-1498726564668589193');" onmouseout="out('-1498726564668589193');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  71     init();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  72   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  73                                                                                                          </span>
<span class="-909562594025196126" onmouseenter="enter('-909562594025196126');" onmouseout="out('-909562594025196126');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  74   private void init() {                                                                                  </span>
<span class="-8302516119393797134" onmouseenter="enter('-8302516119393797134');" onmouseout="out('-8302516119393797134');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  75     mDownloadFile = new File(mDownloadEntity.getDownloadPath());                                         </span>
<span class="-3534953052494864097" onmouseenter="enter('-3534953052494864097');" onmouseout="out('-3534953052494864097');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76     //读取已完成的线程数                                                                                          </span>
<span class="-9053998435552088983" onmouseenter="enter('-9053998435552088983');" onmouseout="out('-9053998435552088983');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77     mConfigFile = new File(                                                                              </span>
<span class="-3948838928069897094" onmouseenter="enter('-3948838928069897094');" onmouseout="out('-3948838928069897094');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  78         mContext.getFilesDir().getPath() + &quot;/temp/&quot; + mDownloadFile.getName() + &quot;.properties&quot;);          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  79     try {                                                                                                </span>
<span class="7925700052565713558" onmouseenter="enter('7925700052565713558');" onmouseout="out('7925700052565713558');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  80       if (!mConfigFile.exists()) { //记录文件被删除，则重新下载                                                       </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  81         isNewTask = true;                                                                                </span>
<span class="1838885973573966413" onmouseenter="enter('1838885973573966413');" onmouseout="out('1838885973573966413');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  82         CommonUtil.createFile(mConfigFile.getPath());                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  83       } else {                                                                                           </span>
<span class="-6296621072689899390" onmouseenter="enter('-6296621072689899390');" onmouseout="out('-6296621072689899390');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  84         isNewTask = !mDownloadFile.exists();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85       }                                                                                                  </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  86     } catch (Exception e) {                                                                              </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  87       e.printStackTrace();                                                                               </span>
<span class="-3747169937451325082" onmouseenter="enter('-3747169937451325082');" onmouseout="out('-3747169937451325082');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  88       failDownload(&quot;下载失败，记录文件被删除&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  89     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  90   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  91                                                                                                          </span>
<span class="-8585626151911369157" onmouseenter="enter('-8585626151911369157');" onmouseout="out('-8585626151911369157');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  92   public IDownloadListener getListener() {                                                               </span>
<span class="-7037258027690597516" onmouseenter="enter('-7037258027690597516');" onmouseout="out('-7037258027690597516');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  93     return mListener;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  94   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  95                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  96   /**                                                                                                    </span>
<span class="6936487890332430093" onmouseenter="enter('6936487890332430093');" onmouseout="out('6936487890332430093');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  97    * 设置连接超时时间                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  98    */                                                                                                    </span>
<span class="8269350745377988793" onmouseenter="enter('8269350745377988793');" onmouseout="out('8269350745377988793');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99   public void setConnectTimeOut(int timeOut) {                                                           </span>
<span class="7491344361160646490" onmouseenter="enter('7491344361160646490');" onmouseout="out('7491344361160646490');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100     mConnectTimeOut = timeOut;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103   /**                                                                                                    </span>
<span class="1793189252207234639" onmouseenter="enter('1793189252207234639');" onmouseout="out('1793189252207234639');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104    * 设置流读取的超时时间                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 105    */                                                                                                    </span>
<span class="-4265144949210493065" onmouseenter="enter('-4265144949210493065');" onmouseout="out('-4265144949210493065');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106   public void setReadTimeOut(int readTimeOut) {                                                          </span>
<span class="-3349186980434336657" onmouseenter="enter('-3349186980434336657');" onmouseout="out('-3349186980434336657');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107     mReadTimeOut = readTimeOut;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 109                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 110   /**                                                                                                    </span>
<span class="6025979389427346334" onmouseenter="enter('6025979389427346334');" onmouseout="out('6025979389427346334');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 111    * 获取当前下载位置                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112    */                                                                                                    </span>
<span class="42588745782017963" onmouseenter="enter('42588745782017963');" onmouseout="out('42588745782017963');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113   @Override public long getCurrentLocation() {                                                           </span>
<span class="2881215542099369319" onmouseenter="enter('2881215542099369319');" onmouseout="out('2881215542099369319');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 114     return mConstance.CURRENT_LOCATION;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116                                                                                                          </span>
<span class="8514823861416132786" onmouseenter="enter('8514823861416132786');" onmouseout="out('8514823861416132786');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 117   @Override public boolean isDownloading() {                                                             </span>
<span class="-2560940912314579274" onmouseenter="enter('-2560940912314579274');" onmouseout="out('-2560940912314579274');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 118     return mConstance.isDownloading;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 119   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121   /**                                                                                                    </span>
<span class="8520049766391668792" onmouseenter="enter('8520049766391668792');" onmouseout="out('8520049766391668792');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122    * 取消下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123    */                                                                                                    </span>
<span class="8518544268347342740" onmouseenter="enter('8518544268347342740');" onmouseout="out('8518544268347342740');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124   @Override public void cancelDownload() {                                                               </span>
<span class="204250319841071761" onmouseenter="enter('204250319841071761');" onmouseout="out('204250319841071761');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125     mConstance.isCancel = true;                                                                          </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126     mConstance.isDownloading = false;                                                                    </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127     mFixedThreadPool.shutdown();                                                                         </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="6217106455110130996" onmouseenter="enter('6217106455110130996');" onmouseout="out('6217106455110130996');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129       SingleThreadTask task = (SingleThreadTask) mTask.get(i);                                           </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130       if (task != null) {                                                                                </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131         task.cancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 133     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 134   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 135                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 136   /**                                                                                                    </span>
<span class="7755328866638560569" onmouseenter="enter('7755328866638560569');" onmouseout="out('7755328866638560569');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 137    * 停止下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 138    */                                                                                                    </span>
<span class="-4596234023078912379" onmouseenter="enter('-4596234023078912379');" onmouseout="out('-4596234023078912379');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139   @Override public void stopDownload() {                                                                 </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140     mConstance.isStop = true;                                                                            </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141     mConstance.isDownloading = false;                                                                    </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 142     mFixedThreadPool.shutdown();                                                                         </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 143     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="6217106455110130996" onmouseenter="enter('6217106455110130996');" onmouseout="out('6217106455110130996');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 144       SingleThreadTask task = (SingleThreadTask) mTask.get(i);                                           </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 145       if (task != null) {                                                                                </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146         task.stop();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 148     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 149   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 150                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 151   /**                                                                                                    </span>
<span class="8538662619258057049" onmouseenter="enter('8538662619258057049');" onmouseout="out('8538662619258057049');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 152    * 删除下载记录文件                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 153    */                                                                                                    </span>
<span class="-6348491485207421588" onmouseenter="enter('-6348491485207421588');" onmouseout="out('-6348491485207421588');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 154   @Override public void delConfigFile() {                                                                </span>
<span class="8558402344038566367" onmouseenter="enter('8558402344038566367');" onmouseout="out('8558402344038566367');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 155     if (mContext != null &amp;&amp; mDownloadEntity != null) {                                                   </span>
<span class="3099781541276521660" onmouseenter="enter('3099781541276521660');" onmouseout="out('3099781541276521660');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 156       File dFile = new File(mDownloadEntity.getDownloadPath());                                          </span>
<span class="-1217451156974226618" onmouseenter="enter('-1217451156974226618');" onmouseout="out('-1217451156974226618');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 157       File config =                                                                                      </span>
<span class="1777202063354625193" onmouseenter="enter('1777202063354625193');" onmouseout="out('1777202063354625193');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 158           new File(mContext.getFilesDir().getPath() + &quot;/temp/&quot; + dFile.getName() + &quot;.properties&quot;);       </span>
<span class="-7696478919602418443" onmouseenter="enter('-7696478919602418443');" onmouseout="out('-7696478919602418443');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 159       if (config.exists()) {                                                                             </span>
<span class="-5702358031910949081" onmouseenter="enter('-5702358031910949081');" onmouseout="out('-5702358031910949081');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 160         config.delete();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 161       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 163   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 164                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 165   /**                                                                                                    </span>
<span class="-8312193682087493639" onmouseenter="enter('-8312193682087493639');" onmouseout="out('-8312193682087493639');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166    * 删除temp文件                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 167    */                                                                                                    </span>
<span class="7655331082892594561" onmouseenter="enter('7655331082892594561');" onmouseout="out('7655331082892594561');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 168   @Override public void delTempFile() {                                                                  </span>
<span class="8558402344038566367" onmouseenter="enter('8558402344038566367');" onmouseout="out('8558402344038566367');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 169     if (mContext != null &amp;&amp; mDownloadEntity != null) {                                                   </span>
<span class="3099781541276521660" onmouseenter="enter('3099781541276521660');" onmouseout="out('3099781541276521660');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170       File dFile = new File(mDownloadEntity.getDownloadPath());                                          </span>
<span class="7897717398420259974" onmouseenter="enter('7897717398420259974');" onmouseout="out('7897717398420259974');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 171       if (dFile.exists()) {                                                                              </span>
<span class="7527345290446588408" onmouseenter="enter('7527345290446588408');" onmouseout="out('7527345290446588408');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 172         dFile.delete();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 173       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 175   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 176                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 177   /**                                                                                                    </span>
<span class="-5727215122052088545" onmouseenter="enter('-5727215122052088545');" onmouseout="out('-5727215122052088545');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 178    * 多线程断点续传下载文件，开始下载                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 179    */                                                                                                    </span>
<span class="-4856178778199245062" onmouseenter="enter('-4856178778199245062');" onmouseout="out('-4856178778199245062');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 180   @Override public void startDownload() {                                                                </span>
<span class="898408935389387935" onmouseenter="enter('898408935389387935');" onmouseout="out('898408935389387935');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 181     mConstance.cleanState();                                                                             </span>
<span class="2099174989180368882" onmouseenter="enter('2099174989180368882');" onmouseout="out('2099174989180368882');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 182     mListener.onPre();                                                                                   </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 183     new Thread(this).start();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 184   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 185                                                                                                          </span>
<span class="-5762688668558425600" onmouseenter="enter('-5762688668558425600');" onmouseout="out('-5762688668558425600');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 186   @Override public void resumeDownload() {                                                               </span>
<span class="1497820413888703615" onmouseenter="enter('1497820413888703615');" onmouseout="out('1497820413888703615');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 187     startDownload();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 188   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 189                                                                                                          </span>
<span class="8306009172830771261" onmouseenter="enter('8306009172830771261');" onmouseout="out('8306009172830771261');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 190   private void failDownload(String msg) {                                                                </span>
<span class="-6647758959009774834" onmouseenter="enter('-6647758959009774834');" onmouseout="out('-6647758959009774834');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 191     Log.e(TAG, msg);                                                                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 192     mConstance.isDownloading = false;                                                                    </span>
<span class="-6715929234808926893" onmouseenter="enter('-6715929234808926893');" onmouseout="out('-6715929234808926893');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 193     stopDownload();                                                                                      </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 194     mListener.onFail();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 195   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 196                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 197   @Override public void run() {                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 198     try {                                                                                                </span>
<span class="5483634401908283016" onmouseenter="enter('5483634401908283016');" onmouseout="out('5483634401908283016');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 199       URL url = new URL(mDownloadEntity.getDownloadUrl());                                               </span>
<span class="-6008953795197858884" onmouseenter="enter('-6008953795197858884');" onmouseout="out('-6008953795197858884');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 200       HttpURLConnection conn = ConnectionHelp.handleConnection(url);                                     </span>
<span class="2062133901627510982" onmouseenter="enter('2062133901627510982');" onmouseout="out('2062133901627510982');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 201       conn = ConnectionHelp.setConnectParam(conn);                                                       </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 202       conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                              </span>
<span class="-3579311541579934971" onmouseenter="enter('-3579311541579934971');" onmouseout="out('-3579311541579934971');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 203       conn.setConnectTimeout(mConnectTimeOut * 4);                                                       </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 204       conn.connect();                                                                                    </span>
<span class="6567575788372053568" onmouseenter="enter('6567575788372053568');" onmouseout="out('6567575788372053568');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 205       int len = conn.getContentLength();                                                                 </span>
<span class="3904365852949278245" onmouseenter="enter('3904365852949278245');" onmouseout="out('3904365852949278245');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 206       //if (len &lt; 0) {  //网络被劫持时会出现这个问题                                                                  </span>
<span class="835324676499837078" onmouseenter="enter('835324676499837078');" onmouseout="out('835324676499837078');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 207       //  failDownload(&quot;下载失败，网络被劫持&quot;);                                                                    </span>
<span class="3500611444781325819" onmouseenter="enter('3500611444781325819');" onmouseout="out('3500611444781325819');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 208       //  return;                                                                                        </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 209       //}                                                                                                </span>
<span class="-5653376755036700146" onmouseenter="enter('-5653376755036700146');" onmouseout="out('-5653376755036700146');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 210       int code = conn.getResponseCode();                                                                 </span>
<span class="999254544547719885" onmouseenter="enter('999254544547719885');" onmouseout="out('999254544547719885');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 211       //https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81                                    </span>
<span class="-8703603538857387010" onmouseenter="enter('-8703603538857387010');" onmouseout="out('-8703603538857387010');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 212       //206支持断点                                                                                          </span>
<span class="5260656878663172399" onmouseenter="enter('5260656878663172399');" onmouseout="out('5260656878663172399');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 213       if (code == HttpURLConnection.HTTP_PARTIAL) {                                                      </span>
<span class="-4850747580721370850" onmouseenter="enter('-4850747580721370850');" onmouseout="out('-4850747580721370850');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 214         isSupportBreakpoint = true;                                                                      </span>
<span class="1256350564434583014" onmouseenter="enter('1256350564434583014');" onmouseout="out('1256350564434583014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 215         mListener.supportBreakpoint(true);                                                               </span>
<span class="-7366273742365769169" onmouseenter="enter('-7366273742365769169');" onmouseout="out('-7366273742365769169');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 216         handleBreakpoint(conn);                                                                          </span>
<span class="877851589237632825" onmouseenter="enter('877851589237632825');" onmouseout="out('877851589237632825');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 217       } else if (code == HttpURLConnection.HTTP_OK || len &lt; 0) {                                         </span>
<span class="-5840271675092361063" onmouseenter="enter('-5840271675092361063');" onmouseout="out('-5840271675092361063');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 218         //在conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);下，200为不支持断点状态                            </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 219         if (len &lt; 0) {                                                                                   </span>
<span class="9025825393004184595" onmouseenter="enter('9025825393004184595');" onmouseout="out('9025825393004184595');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 220           failDownload(&quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，文件长度小于0&quot;);                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 221           return;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 222         }                                                                                                </span>
<span class="5451458949060440820" onmouseenter="enter('5451458949060440820');" onmouseout="out('5451458949060440820');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 223         isSupportBreakpoint = false;                                                                     </span>
<span class="3223278567209587987" onmouseenter="enter('3223278567209587987');" onmouseout="out('3223278567209587987');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 224         mListener.supportBreakpoint(false);                                                              </span>
<span class="-3209038805792969148" onmouseenter="enter('-3209038805792969148');" onmouseout="out('-3209038805792969148');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 225         Log.w(TAG, &quot;该下载链接不支持断点下载&quot;);                                                                      </span>
<span class="-7366273742365769169" onmouseenter="enter('-7366273742365769169');" onmouseout="out('-7366273742365769169');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 226         handleBreakpoint(conn);                                                                          </span>
<span class="1848064821034278655" onmouseenter="enter('1848064821034278655');" onmouseout="out('1848064821034278655');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 227       } else if (code == HttpURLConnection.HTTP_NOT_FOUND) {                                             </span>
<span class="6854071059109338334" onmouseenter="enter('6854071059109338334');" onmouseout="out('6854071059109338334');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 228         Log.w(TAG, &quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，错误码：404&quot;);                          </span>
<span class="7504588834379816638" onmouseenter="enter('7504588834379816638');" onmouseout="out('7504588834379816638');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 229         //mListener.onCancel();                                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 230       } else {                                                                                           </span>
<span class="9116772185344886324" onmouseenter="enter('9116772185344886324');" onmouseout="out('9116772185344886324');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 231         failDownload(&quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，错误码：&quot; + code);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 232       }                                                                                                  </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 233     } catch (IOException e) {                                                                            </span>
<span class="7015103282251076587" onmouseenter="enter('7015103282251076587');" onmouseout="out('7015103282251076587');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 234       failDownload(&quot;下载失败【downloadUrl:&quot;                                                                   </span>
<span class="5951112113295803501" onmouseenter="enter('5951112113295803501');" onmouseout="out('5951112113295803501');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 235           + mDownloadEntity.getDownloadUrl()                                                             </span>
<span class="910868662350755341" onmouseenter="enter('910868662350755341');" onmouseout="out('910868662350755341');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 236           + &quot;】\n【filePath:&quot;                                                                              </span>
<span class="5931171797063415443" onmouseenter="enter('5931171797063415443');" onmouseout="out('5931171797063415443');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 237           + mDownloadFile.getPath()                                                                      </span>
<span class="-1840319934610193149" onmouseenter="enter('-1840319934610193149');" onmouseout="out('-1840319934610193149');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 238           + &quot;】&quot;                                                                                          </span>
<span class="-5371623624849066023" onmouseenter="enter('-5371623624849066023');" onmouseout="out('-5371623624849066023');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 239           + CommonUtil.getPrintException(e));                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 240     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 241   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 242                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 243   /**                                                                                                    </span>
<span class="-2887709646015060517" onmouseenter="enter('-2887709646015060517');" onmouseout="out('-2887709646015060517');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 244    * 处理断点                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 245    */                                                                                                    </span>
<span class="-1770943272374407595" onmouseenter="enter('-1770943272374407595');" onmouseout="out('-1770943272374407595');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 246   private void handleBreakpoint(HttpURLConnection conn) throws IOException {                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 247                                                                                                          </span>
<span class="7477238500582408106" onmouseenter="enter('7477238500582408106');" onmouseout="out('7477238500582408106');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 248     //不支持断点只能单线程下载                                                                                       </span>
<span class="-6722781002220970553" onmouseenter="enter('-6722781002220970553');" onmouseout="out('-6722781002220970553');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 249     if (!isSupportBreakpoint) {                                                                          </span>
<span class="-8481066330390671660" onmouseenter="enter('-8481066330390671660');" onmouseout="out('-8481066330390671660');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 250       ConfigEntity entity = new ConfigEntity();                                                          </span>
<span class="2550533377201046915" onmouseenter="enter('2550533377201046915');" onmouseout="out('2550533377201046915');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 251       long len = conn.getContentLength();;                                                               </span>
<span class="3256260393357377684" onmouseenter="enter('3256260393357377684');" onmouseout="out('3256260393357377684');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 252       entity.FILE_SIZE = len;                                                                            </span>
<span class="4189357201157412201" onmouseenter="enter('4189357201157412201');" onmouseout="out('4189357201157412201');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 253       entity.DOWNLOAD_URL = mDownloadEntity.getDownloadUrl();                                            </span>
<span class="1175511499700324517" onmouseenter="enter('1175511499700324517');" onmouseout="out('1175511499700324517');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 254       entity.TEMP_FILE = mDownloadFile;                                                                  </span>
<span class="-1353085718172399938" onmouseenter="enter('-1353085718172399938');" onmouseout="out('-1353085718172399938');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 255       entity.THREAD_ID = 0;                                                                              </span>
<span class="-4967231089338870782" onmouseenter="enter('-4967231089338870782');" onmouseout="out('-4967231089338870782');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 256       entity.START_LOCATION = 0;                                                                         </span>
<span class="4365950116387297475" onmouseenter="enter('4365950116387297475');" onmouseout="out('4365950116387297475');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 257       entity.END_LOCATION = entity.FILE_SIZE;                                                            </span>
<span class="-7848202009707844875" onmouseenter="enter('-7848202009707844875');" onmouseout="out('-7848202009707844875');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 258       entity.CONFIG_FILE_PATH = mConfigFile.getPath();                                                   </span>
<span class="2812036997657153043" onmouseenter="enter('2812036997657153043');" onmouseout="out('2812036997657153043');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 259       entity.isSupportBreakpoint = isSupportBreakpoint;                                                  </span>
<span class="4531885195650702733" onmouseenter="enter('4531885195650702733');" onmouseout="out('4531885195650702733');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 260       SingleThreadTask task = new SingleThreadTask(mConstance, mListener, entity);                       </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 261       mFixedThreadPool.execute(task);                                                                    </span>
<span class="1947759044939991847" onmouseenter="enter('1947759044939991847');" onmouseout="out('1947759044939991847');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 262       mListener.onPostPre(len);                                                                          </span>
<span class="-2943780714290472761" onmouseenter="enter('-2943780714290472761');" onmouseout="out('-2943780714290472761');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 263       mListener.onStart(0);                                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 264       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 265     }                                                                                                    </span>
<span class="-4144971478129188538" onmouseenter="enter('-4144971478129188538');" onmouseout="out('-4144971478129188538');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 266     int fileLength = conn.getContentLength();                                                            </span>
<span class="-3771769896201867631" onmouseenter="enter('-3771769896201867631');" onmouseout="out('-3771769896201867631');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 267     //必须建一个文件                                                                                            </span>
<span class="-8241179119122160888" onmouseenter="enter('-8241179119122160888');" onmouseout="out('-8241179119122160888');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 268     CommonUtil.createFile(mDownloadFile.getPath());                                                      </span>
<span class="-7635395723744199382" onmouseenter="enter('-7635395723744199382');" onmouseout="out('-7635395723744199382');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 269     //RandomAccessFile file = new RandomAccessFile(mDownloadFile.getPath(), &quot;rwd&quot;);                      </span>
<span class="-900329094809807646" onmouseenter="enter('-900329094809807646');" onmouseout="out('-900329094809807646');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 270     ////设置文件长度                                                                                           </span>
<span class="-756775849470659960" onmouseenter="enter('-756775849470659960');" onmouseout="out('-756775849470659960');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 271     //file.setLength(fileLength);                                                                        </span>
<span class="2674353001121820528" onmouseenter="enter('2674353001121820528');" onmouseout="out('2674353001121820528');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 272     BufferedRandomAccessFile file =                                                                      </span>
<span class="-2608299971259814762" onmouseenter="enter('-2608299971259814762');" onmouseout="out('-2608299971259814762');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 273         new BufferedRandomAccessFile(mDownloadFile.getPath(), &quot;rwd&quot;, 8192);                              </span>
<span class="-564508951971497574" onmouseenter="enter('-564508951971497574');" onmouseout="out('-564508951971497574');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 274     //设置文件长度                                                                                             </span>
<span class="6023690204241765206" onmouseenter="enter('6023690204241765206');" onmouseout="out('6023690204241765206');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 275     file.setLength(fileLength);                                                                          </span>
<span class="5666806310833670603" onmouseenter="enter('5666806310833670603');" onmouseout="out('5666806310833670603');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 276     mListener.onPostPre(fileLength);                                                                     </span>
<span class="6024675825413521783" onmouseenter="enter('6024675825413521783');" onmouseout="out('6024675825413521783');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 277     //分配每条线程的下载区间                                                                                        </span>
<span class="-317662916418562024" onmouseenter="enter('-317662916418562024');" onmouseout="out('-317662916418562024');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 278     Properties pro = null;                                                                               </span>
<span class="4467713772376842471" onmouseenter="enter('4467713772376842471');" onmouseout="out('4467713772376842471');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 279     pro = CommonUtil.loadConfig(mConfigFile);                                                            </span>
<span class="-681137634566379888" onmouseenter="enter('-681137634566379888');" onmouseout="out('-681137634566379888');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 280     if (pro.isEmpty()) {                                                                                 </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 281       isNewTask = true;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 282     } else {                                                                                             </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 283       for (int i = 0; i &lt; THREAD_NUM; i++) {                                                             </span>
<span class="-6973645922135466911" onmouseenter="enter('-6973645922135466911');" onmouseout="out('-6973645922135466911');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 284         if (pro.getProperty(mDownloadFile.getName() + &quot;_record_&quot; + i) == null) {                         </span>
<span class="1178951043321657234" onmouseenter="enter('1178951043321657234');" onmouseout="out('1178951043321657234');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 285           Object state = pro.getProperty(mDownloadFile.getName() + &quot;_state_&quot; + i);                       </span>
<span class="-2092430839348453245" onmouseenter="enter('-2092430839348453245');" onmouseout="out('-2092430839348453245');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 286           if (state != null &amp;&amp; Integer.parseInt(state + &quot;&quot;) == 1) {                                      </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 287             continue;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 288           }                                                                                              </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 289           isNewTask = true;                                                                              </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 290           break;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 291         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 292       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 293     }                                                                                                    </span>
<span class="-1643854653241583074" onmouseenter="enter('-1643854653241583074');" onmouseout="out('-1643854653241583074');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 294     int blockSize = fileLength / THREAD_NUM;                                                             </span>
<span class="866019335924650779" onmouseenter="enter('866019335924650779');" onmouseout="out('866019335924650779');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 295     int[] recordL = new int[THREAD_NUM];                                                                 </span>
<span class="794844889575716346" onmouseenter="enter('794844889575716346');" onmouseout="out('794844889575716346');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 296     int rl = 0;                                                                                          </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 297     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="8242320341463399828" onmouseenter="enter('8242320341463399828');" onmouseout="out('8242320341463399828');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 298       recordL[i] = -1;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 299     }                                                                                                    </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 300     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="-2965725495076654490" onmouseenter="enter('-2965725495076654490');" onmouseout="out('-2965725495076654490');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 301       long startL = i * blockSize, endL = (i + 1) * blockSize;                                           </span>
<span class="1178951043321657234" onmouseenter="enter('1178951043321657234');" onmouseout="out('1178951043321657234');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 302       Object state = pro.getProperty(mDownloadFile.getName() + &quot;_state_&quot; + i);                           </span>
<span class="2419725940883839935" onmouseenter="enter('2419725940883839935');" onmouseout="out('2419725940883839935');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 303       if (state != null &amp;&amp; Integer.parseInt(state + &quot;&quot;) == 1) {  //该线程已经完成                               </span>
<span class="8742170387731029623" onmouseenter="enter('8742170387731029623');" onmouseout="out('8742170387731029623');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 304         mConstance.CURRENT_LOCATION += endL - startL;                                                    </span>
<span class="7342592738960136820" onmouseenter="enter('7342592738960136820');" onmouseout="out('7342592738960136820');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 305         Log.d(TAG, &quot;++++++++++ 线程_&quot; + i + &quot;_已经下载完成 ++++++++++&quot;);                                         </span>
<span class="-337774801975969950" onmouseenter="enter('-337774801975969950');" onmouseout="out('-337774801975969950');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 306         mConstance.COMPLETE_THREAD_NUM++;                                                                </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 307         mConstance.STOP_NUM++;                                                                           </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 308         mConstance.CANCEL_NUM++;                                                                         </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 309         if (mConstance.isComplete()) {                                                                   </span>
<span class="4951157766975006439" onmouseenter="enter('4951157766975006439');" onmouseout="out('4951157766975006439');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 310           if (mConfigFile.exists()) {                                                                    </span>
<span class="-8106518526167482323" onmouseenter="enter('-8106518526167482323');" onmouseout="out('-8106518526167482323');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 311             mConfigFile.delete();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 312           }                                                                                              </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 313           mListener.onComplete();                                                                        </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 314           mConstance.isDownloading = false;                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 315           return;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 316         }                                                                                                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 317         continue;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 318       }                                                                                                  </span>
<span class="-1793454279264850881" onmouseenter="enter('-1793454279264850881');" onmouseout="out('-1793454279264850881');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 319       //分配下载位置                                                                                           </span>
<span class="-8200484973700844224" onmouseenter="enter('-8200484973700844224');" onmouseout="out('-8200484973700844224');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 320       Object record = pro.getProperty(mDownloadFile.getName() + &quot;_record_&quot; + i);                         </span>
<span class="-4606277471232235328" onmouseenter="enter('-4606277471232235328');" onmouseout="out('-4606277471232235328');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 321       //如果有记录，则恢复下载                                                                                      </span>
<span class="9081430961250736769" onmouseenter="enter('9081430961250736769');" onmouseout="out('9081430961250736769');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 322       if (!isNewTask &amp;&amp; record != null &amp;&amp; Long.parseLong(record + &quot;&quot;) &gt; 0) {                             </span>
<span class="8647082033828497822" onmouseenter="enter('8647082033828497822');" onmouseout="out('8647082033828497822');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 323         Long r = Long.parseLong(record + &quot;&quot;);                                                            </span>
<span class="1683054574044455381" onmouseenter="enter('1683054574044455381');" onmouseout="out('1683054574044455381');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 324         mConstance.CURRENT_LOCATION += r - startL;                                                       </span>
<span class="179733331572927392" onmouseenter="enter('179733331572927392');" onmouseout="out('179733331572927392');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 325         Log.d(TAG, &quot;++++++++++ 线程_&quot; + i + &quot;_恢复下载 ++++++++++&quot;);                                           </span>
<span class="6939461797319425642" onmouseenter="enter('6939461797319425642');" onmouseout="out('6939461797319425642');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 326         mListener.onChildResume(r);                                                                      </span>
<span class="1542845345888554533" onmouseenter="enter('1542845345888554533');" onmouseout="out('1542845345888554533');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 327         startL = r;                                                                                      </span>
<span class="-7425711498405631322" onmouseenter="enter('-7425711498405631322');" onmouseout="out('-7425711498405631322');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 328         recordL[rl] = i;                                                                                 </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 329         rl++;                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 330       } else {                                                                                           </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 331         isNewTask = true;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 332       }                                                                                                  </span>
<span class="537230916062757449" onmouseenter="enter('537230916062757449');" onmouseout="out('537230916062757449');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 333       if (isNewTask) {                                                                                   </span>
<span class="-7425711498405631322" onmouseenter="enter('-7425711498405631322');" onmouseout="out('-7425711498405631322');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 334         recordL[rl] = i;                                                                                 </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 335         rl++;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 336       }                                                                                                  </span>
<span class="-3400889980578220125" onmouseenter="enter('-3400889980578220125');" onmouseout="out('-3400889980578220125');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 337       if (i == (THREAD_NUM - 1)) {                                                                       </span>
<span class="-7423751213765432972" onmouseenter="enter('-7423751213765432972');" onmouseout="out('-7423751213765432972');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 338         //如果整个文件的大小不为线程个数的整数倍，则最后一个线程的结束位置即为文件的总长度                                                       </span>
<span class="-2829184075463306484" onmouseenter="enter('-2829184075463306484');" onmouseout="out('-2829184075463306484');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 339         endL = fileLength;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 340       }                                                                                                  </span>
<span class="-8481066330390671660" onmouseenter="enter('-8481066330390671660');" onmouseout="out('-8481066330390671660');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 341       ConfigEntity entity = new ConfigEntity();                                                          </span>
<span class="-3119684513187648029" onmouseenter="enter('-3119684513187648029');" onmouseout="out('-3119684513187648029');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 342       entity.FILE_SIZE = fileLength;                                                                     </span>
<span class="4189357201157412201" onmouseenter="enter('4189357201157412201');" onmouseout="out('4189357201157412201');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 343       entity.DOWNLOAD_URL = mDownloadEntity.getDownloadUrl();                                            </span>
<span class="1175511499700324517" onmouseenter="enter('1175511499700324517');" onmouseout="out('1175511499700324517');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 344       entity.TEMP_FILE = mDownloadFile;                                                                  </span>
<span class="-1808458878368858692" onmouseenter="enter('-1808458878368858692');" onmouseout="out('-1808458878368858692');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 345       entity.THREAD_ID = i;                                                                              </span>
<span class="6661292811999012973" onmouseenter="enter('6661292811999012973');" onmouseout="out('6661292811999012973');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 346       entity.START_LOCATION = startL;                                                                    </span>
<span class="8656472587238389131" onmouseenter="enter('8656472587238389131');" onmouseout="out('8656472587238389131');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 347       entity.END_LOCATION = endL;                                                                        </span>
<span class="-7848202009707844875" onmouseenter="enter('-7848202009707844875');" onmouseout="out('-7848202009707844875');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 348       entity.CONFIG_FILE_PATH = mConfigFile.getPath();                                                   </span>
<span class="2812036997657153043" onmouseenter="enter('2812036997657153043');" onmouseout="out('2812036997657153043');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 349       entity.isSupportBreakpoint = isSupportBreakpoint;                                                  </span>
<span class="4531885195650702733" onmouseenter="enter('4531885195650702733');" onmouseout="out('4531885195650702733');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 350       SingleThreadTask task = new SingleThreadTask(mConstance, mListener, entity);                       </span>
<span class="-6012810893938815399" onmouseenter="enter('-6012810893938815399');" onmouseout="out('-6012810893938815399');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 351       mTask.put(i, task);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 352     }                                                                                                    </span>
<span class="-1061602448343886008" onmouseenter="enter('-1061602448343886008');" onmouseout="out('-1061602448343886008');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 353     if (mConstance.CURRENT_LOCATION &gt; 0) {                                                               </span>
<span class="5187035189520501266" onmouseenter="enter('5187035189520501266');" onmouseout="out('5187035189520501266');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 354       mListener.onResume(mConstance.CURRENT_LOCATION);                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 355     } else {                                                                                             </span>
<span class="-2973471902048685805" onmouseenter="enter('-2973471902048685805');" onmouseout="out('-2973471902048685805');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 356       mListener.onStart(mConstance.CURRENT_LOCATION);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 357     }                                                                                                    </span>
<span class="1243235571055153612" onmouseenter="enter('1243235571055153612');" onmouseout="out('1243235571055153612');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 358     for (int l : recordL) {                                                                              </span>
<span class="-7510837703317171619" onmouseenter="enter('-7510837703317171619');" onmouseout="out('-7510837703317171619');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 359       if (l == -1) continue;                                                                             </span>
<span class="-85915337091278441" onmouseenter="enter('-85915337091278441');" onmouseout="out('-85915337091278441');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 360       Runnable task = mTask.get(l);                                                                      </span>
<span class="-7327661534177463737" onmouseenter="enter('-7327661534177463737');" onmouseout="out('-7327661534177463737');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 361       if (task != null &amp;&amp; !mFixedThreadPool.isShutdown()) {                                              </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 362         mFixedThreadPool.execute(task);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 363       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 364     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 365   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 366                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 367   /**                                                                                                    </span>
<span class="2585942053451624927" onmouseenter="enter('2585942053451624927');" onmouseout="out('2585942053451624927');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 368    * 子线程下载信息类                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 369    */                                                                                                    </span>
<span class="-3850188489545087742" onmouseenter="enter('-3850188489545087742');" onmouseout="out('-3850188489545087742');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 370   final static class ConfigEntity {                                                                      </span>
<span class="-403498804051257270" onmouseenter="enter('-403498804051257270');" onmouseout="out('-403498804051257270');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 371     //文件大小                                                                                               </span>
<span class="541475241289655650" onmouseenter="enter('541475241289655650');" onmouseout="out('541475241289655650');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 372     long FILE_SIZE;                                                                                      </span>
<span class="-4736398418022593572" onmouseenter="enter('-4736398418022593572');" onmouseout="out('-4736398418022593572');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 373     String DOWNLOAD_URL;                                                                                 </span>
<span class="-7368464316865211776" onmouseenter="enter('-7368464316865211776');" onmouseout="out('-7368464316865211776');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 374     int THREAD_ID;                                                                                       </span>
<span class="3260682776668453255" onmouseenter="enter('3260682776668453255');" onmouseout="out('3260682776668453255');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 375     long START_LOCATION;                                                                                 </span>
<span class="2446069397877689758" onmouseenter="enter('2446069397877689758');" onmouseout="out('2446069397877689758');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 376     long END_LOCATION;                                                                                   </span>
<span class="4104096962052364503" onmouseenter="enter('4104096962052364503');" onmouseout="out('4104096962052364503');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 377     File TEMP_FILE;                                                                                      </span>
<span class="-2017423643980728828" onmouseenter="enter('-2017423643980728828');" onmouseout="out('-2017423643980728828');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 378     boolean isSupportBreakpoint = true;                                                                  </span>
<span class="-2943683475239618057" onmouseenter="enter('-2943683475239618057');" onmouseout="out('-2943683475239618057');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 379     String CONFIG_FILE_PATH;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 380   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 381 }                                                                                                        </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 382 ||||||| BASE                                                                                             </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 383 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 384  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 385  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 386  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 387  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 388  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 389  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 390  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 391  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 392  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 393  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 394  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 395  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 396  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 397  */                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 398                                                                                                          </span>
<span class="-1768704711895145311" onmouseenter="enter('-1768704711895145311');" onmouseout="out('-1768704711895145311');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 399 package com.arialyy.aria.core.task;                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 400                                                                                                          </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 401 import android.content.Context;                                                                          </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 402 import android.util.Log;                                                                                 </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 403 import android.util.SparseArray;                                                                         </span>
<span class="-8446909004143589790" onmouseenter="enter('-8446909004143589790');" onmouseout="out('-8446909004143589790');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 404 import com.arialyy.aria.core.DownloadEntity;                                                             </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 405 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 406 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 407 import java.io.IOException;                                                                              </span>
<span class="-3877933607611446246" onmouseenter="enter('-3877933607611446246');" onmouseout="out('-3877933607611446246');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 408 import java.io.RandomAccessFile;                                                                         </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 409 import java.net.HttpURLConnection;                                                                       </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 410 import java.net.URL;                                                                                     </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 411 import java.util.Properties;                                                                             </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 412 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 413 import java.util.concurrent.Executors;                                                                   </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 414                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 415 /**                                                                                                      </span>
<span class="2363292981682035173" onmouseenter="enter('2363292981682035173');" onmouseout="out('2363292981682035173');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 416  * Created by lyy on 2015/8/25.                                                                          </span>
<span class="-8257115403302511340" onmouseenter="enter('-8257115403302511340');" onmouseout="out('-8257115403302511340');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 417  * 下载工具类                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 418  */                                                                                                      </span>
<span class="1048428507777314273" onmouseenter="enter('1048428507777314273');" onmouseout="out('1048428507777314273');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 419 final class DownloadUtil implements IDownloadUtil, Runnable {                                            </span>
<span class="1261799266044613591" onmouseenter="enter('1261799266044613591');" onmouseout="out('1261799266044613591');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 420   private static final String TAG = &quot;DownloadUtil&quot;;                                                      </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 421   /**                                                                                                    </span>
<span class="-8352985751663047055" onmouseenter="enter('-8352985751663047055');" onmouseout="out('-8352985751663047055');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 422    * 线程数                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 423    */                                                                                                    </span>
<span class="-7983967545860957599" onmouseenter="enter('-7983967545860957599');" onmouseout="out('-7983967545860957599');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 424   private final int THREAD_NUM;                                                                          </span>
<span class="-785681239530372348" onmouseenter="enter('-785681239530372348');" onmouseout="out('-785681239530372348');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 425   //下载监听                                                                                                 </span>
<span class="8085369704814778285" onmouseenter="enter('8085369704814778285');" onmouseout="out('8085369704814778285');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 426   private IDownloadListener mListener;                                                                   </span>
<span class="8993221121586487711" onmouseenter="enter('8993221121586487711');" onmouseout="out('8993221121586487711');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 427   private int mConnectTimeOut = 5000 * 4; //连接超时时间                                                       </span>
<span class="4023537183138169002" onmouseenter="enter('4023537183138169002');" onmouseout="out('4023537183138169002');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 428   private int mReadTimeOut = 5000 * 20; //流读取的超时时间                                                       </span>
<span class="-1157942250762320951" onmouseenter="enter('-1157942250762320951');" onmouseout="out('-1157942250762320951');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 429   private boolean isNewTask = true;                                                                      </span>
<span class="-7348064306101585897" onmouseenter="enter('-7348064306101585897');" onmouseout="out('-7348064306101585897');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 430   private boolean isSupportBreakpoint = true;                                                            </span>
<span class="6683852815807951473" onmouseenter="enter('6683852815807951473');" onmouseout="out('6683852815807951473');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 431   private Context mContext;                                                                              </span>
<span class="-4114987623877824308" onmouseenter="enter('-4114987623877824308');" onmouseout="out('-4114987623877824308');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 432   private DownloadEntity mDownloadEntity;                                                                </span>
<span class="1058453114158093994" onmouseenter="enter('1058453114158093994');" onmouseout="out('1058453114158093994');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 433   private ExecutorService mFixedThreadPool;                                                              </span>
<span class="-1133559474859202897" onmouseenter="enter('-1133559474859202897');" onmouseout="out('-1133559474859202897');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 434   private File mDownloadFile; //下载的文件                                                                    </span>
<span class="7861940189151317235" onmouseenter="enter('7861940189151317235');" onmouseout="out('7861940189151317235');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 435   private File mConfigFile;//下载信息配置文件                                                                    </span>
<span class="-3869960521609686448" onmouseenter="enter('-3869960521609686448');" onmouseout="out('-3869960521609686448');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 436   private SparseArray&lt;Runnable&gt; mTask = new SparseArray&lt;&gt;();                                             </span>
<span class="7070628333292412283" onmouseenter="enter('7070628333292412283');" onmouseout="out('7070628333292412283');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 437   private DownloadStateConstance mConstance;                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 438                                                                                                          </span>
<span class="-2084839900540753927" onmouseenter="enter('-2084839900540753927');" onmouseout="out('-2084839900540753927');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 439   DownloadUtil(Context context, DownloadEntity entity, IDownloadListener downloadListener) {             </span>
<span class="-4896597165635236478" onmouseenter="enter('-4896597165635236478');" onmouseout="out('-4896597165635236478');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 440     this(context, entity, downloadListener, 3);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 441   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 442                                                                                                          </span>
<span class="-4986291938704783923" onmouseenter="enter('-4986291938704783923');" onmouseout="out('-4986291938704783923');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 443   DownloadUtil(Context context, DownloadEntity entity, IDownloadListener downloadListener,               </span>
<span class="-8984238530475947621" onmouseenter="enter('-8984238530475947621');" onmouseout="out('-8984238530475947621');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 444       int threadNum) {                                                                                   </span>
<span class="-673106209130372223" onmouseenter="enter('-673106209130372223');" onmouseout="out('-673106209130372223');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 445     mContext = context.getApplicationContext();                                                          </span>
<span class="-216605200672599564" onmouseenter="enter('-216605200672599564');" onmouseout="out('-216605200672599564');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 446     mDownloadEntity = entity;                                                                            </span>
<span class="3831466484862340223" onmouseenter="enter('3831466484862340223');" onmouseout="out('3831466484862340223');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 447     mListener = downloadListener;                                                                        </span>
<span class="-6579794148103748852" onmouseenter="enter('-6579794148103748852');" onmouseout="out('-6579794148103748852');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 448     THREAD_NUM = threadNum;                                                                              </span>
<span class="-7335968387740294445" onmouseenter="enter('-7335968387740294445');" onmouseout="out('-7335968387740294445');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 449     mFixedThreadPool = Executors.newFixedThreadPool(Integer.MAX_VALUE);                                  </span>
<span class="2824360841323512384" onmouseenter="enter('2824360841323512384');" onmouseout="out('2824360841323512384');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 450     mConstance = new DownloadStateConstance(THREAD_NUM);                                                 </span>
<span class="-1498726564668589193" onmouseenter="enter('-1498726564668589193');" onmouseout="out('-1498726564668589193');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 451     init();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 452   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 453                                                                                                          </span>
<span class="-909562594025196126" onmouseenter="enter('-909562594025196126');" onmouseout="out('-909562594025196126');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 454   private void init() {                                                                                  </span>
<span class="-8302516119393797134" onmouseenter="enter('-8302516119393797134');" onmouseout="out('-8302516119393797134');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 455     mDownloadFile = new File(mDownloadEntity.getDownloadPath());                                         </span>
<span class="-3534953052494864097" onmouseenter="enter('-3534953052494864097');" onmouseout="out('-3534953052494864097');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 456     //读取已完成的线程数                                                                                          </span>
<span class="-9053998435552088983" onmouseenter="enter('-9053998435552088983');" onmouseout="out('-9053998435552088983');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 457     mConfigFile = new File(                                                                              </span>
<span class="-3948838928069897094" onmouseenter="enter('-3948838928069897094');" onmouseout="out('-3948838928069897094');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 458         mContext.getFilesDir().getPath() + &quot;/temp/&quot; + mDownloadFile.getName() + &quot;.properties&quot;);          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 459     try {                                                                                                </span>
<span class="7925700052565713558" onmouseenter="enter('7925700052565713558');" onmouseout="out('7925700052565713558');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 460       if (!mConfigFile.exists()) { //记录文件被删除，则重新下载                                                       </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 461         isNewTask = true;                                                                                </span>
<span class="1838885973573966413" onmouseenter="enter('1838885973573966413');" onmouseout="out('1838885973573966413');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 462         CommonUtil.createFile(mConfigFile.getPath());                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 463       } else {                                                                                           </span>
<span class="-6296621072689899390" onmouseenter="enter('-6296621072689899390');" onmouseout="out('-6296621072689899390');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 464         isNewTask = !mDownloadFile.exists();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 465       }                                                                                                  </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 466     } catch (Exception e) {                                                                              </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 467       e.printStackTrace();                                                                               </span>
<span class="-3747169937451325082" onmouseenter="enter('-3747169937451325082');" onmouseout="out('-3747169937451325082');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 468       failDownload(&quot;下载失败，记录文件被删除&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 469     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 470   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 471                                                                                                          </span>
<span class="-8585626151911369157" onmouseenter="enter('-8585626151911369157');" onmouseout="out('-8585626151911369157');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 472   public IDownloadListener getListener() {                                                               </span>
<span class="-7037258027690597516" onmouseenter="enter('-7037258027690597516');" onmouseout="out('-7037258027690597516');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 473     return mListener;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 474   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 475                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 476   /**                                                                                                    </span>
<span class="6936487890332430093" onmouseenter="enter('6936487890332430093');" onmouseout="out('6936487890332430093');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 477    * 设置连接超时时间                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 478    */                                                                                                    </span>
<span class="8269350745377988793" onmouseenter="enter('8269350745377988793');" onmouseout="out('8269350745377988793');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 479   public void setConnectTimeOut(int timeOut) {                                                           </span>
<span class="7491344361160646490" onmouseenter="enter('7491344361160646490');" onmouseout="out('7491344361160646490');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 480     mConnectTimeOut = timeOut;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 481   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 482                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 483   /**                                                                                                    </span>
<span class="1793189252207234639" onmouseenter="enter('1793189252207234639');" onmouseout="out('1793189252207234639');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 484    * 设置流读取的超时时间                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 485    */                                                                                                    </span>
<span class="-4265144949210493065" onmouseenter="enter('-4265144949210493065');" onmouseout="out('-4265144949210493065');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 486   public void setReadTimeOut(int readTimeOut) {                                                          </span>
<span class="-3349186980434336657" onmouseenter="enter('-3349186980434336657');" onmouseout="out('-3349186980434336657');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 487     mReadTimeOut = readTimeOut;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 488   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 489                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 490   /**                                                                                                    </span>
<span class="6025979389427346334" onmouseenter="enter('6025979389427346334');" onmouseout="out('6025979389427346334');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 491    * 获取当前下载位置                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 492    */                                                                                                    </span>
<span class="42588745782017963" onmouseenter="enter('42588745782017963');" onmouseout="out('42588745782017963');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 493   @Override public long getCurrentLocation() {                                                           </span>
<span class="2881215542099369319" onmouseenter="enter('2881215542099369319');" onmouseout="out('2881215542099369319');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 494     return mConstance.CURRENT_LOCATION;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 495   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 496                                                                                                          </span>
<span class="8514823861416132786" onmouseenter="enter('8514823861416132786');" onmouseout="out('8514823861416132786');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 497   @Override public boolean isDownloading() {                                                             </span>
<span class="-2560940912314579274" onmouseenter="enter('-2560940912314579274');" onmouseout="out('-2560940912314579274');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 498     return mConstance.isDownloading;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 499   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 500                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 501   /**                                                                                                    </span>
<span class="8520049766391668792" onmouseenter="enter('8520049766391668792');" onmouseout="out('8520049766391668792');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 502    * 取消下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 503    */                                                                                                    </span>
<span class="8518544268347342740" onmouseenter="enter('8518544268347342740');" onmouseout="out('8518544268347342740');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 504   @Override public void cancelDownload() {                                                               </span>
<span class="204250319841071761" onmouseenter="enter('204250319841071761');" onmouseout="out('204250319841071761');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 505     mConstance.isCancel = true;                                                                          </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 506     mConstance.isDownloading = false;                                                                    </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 507     mFixedThreadPool.shutdown();                                                                         </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 508     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="6217106455110130996" onmouseenter="enter('6217106455110130996');" onmouseout="out('6217106455110130996');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 509       SingleThreadTask task = (SingleThreadTask) mTask.get(i);                                           </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 510       if (task != null) {                                                                                </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 511         task.cancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 512       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 513     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 514   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 515                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 516   /**                                                                                                    </span>
<span class="7755328866638560569" onmouseenter="enter('7755328866638560569');" onmouseout="out('7755328866638560569');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 517    * 停止下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 518    */                                                                                                    </span>
<span class="-4596234023078912379" onmouseenter="enter('-4596234023078912379');" onmouseout="out('-4596234023078912379');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 519   @Override public void stopDownload() {                                                                 </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 520     mConstance.isStop = true;                                                                            </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 521     mConstance.isDownloading = false;                                                                    </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 522     mFixedThreadPool.shutdown();                                                                         </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 523     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="6217106455110130996" onmouseenter="enter('6217106455110130996');" onmouseout="out('6217106455110130996');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 524       SingleThreadTask task = (SingleThreadTask) mTask.get(i);                                           </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 525       if (task != null) {                                                                                </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 526         task.stop();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 527       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 528     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 529   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 530                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 531   /**                                                                                                    </span>
<span class="8538662619258057049" onmouseenter="enter('8538662619258057049');" onmouseout="out('8538662619258057049');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 532    * 删除下载记录文件                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 533    */                                                                                                    </span>
<span class="-6348491485207421588" onmouseenter="enter('-6348491485207421588');" onmouseout="out('-6348491485207421588');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 534   @Override public void delConfigFile() {                                                                </span>
<span class="8558402344038566367" onmouseenter="enter('8558402344038566367');" onmouseout="out('8558402344038566367');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 535     if (mContext != null &amp;&amp; mDownloadEntity != null) {                                                   </span>
<span class="3099781541276521660" onmouseenter="enter('3099781541276521660');" onmouseout="out('3099781541276521660');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 536       File dFile = new File(mDownloadEntity.getDownloadPath());                                          </span>
<span class="-1217451156974226618" onmouseenter="enter('-1217451156974226618');" onmouseout="out('-1217451156974226618');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 537       File config =                                                                                      </span>
<span class="1777202063354625193" onmouseenter="enter('1777202063354625193');" onmouseout="out('1777202063354625193');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 538           new File(mContext.getFilesDir().getPath() + &quot;/temp/&quot; + dFile.getName() + &quot;.properties&quot;);       </span>
<span class="-7696478919602418443" onmouseenter="enter('-7696478919602418443');" onmouseout="out('-7696478919602418443');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 539       if (config.exists()) {                                                                             </span>
<span class="-5702358031910949081" onmouseenter="enter('-5702358031910949081');" onmouseout="out('-5702358031910949081');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 540         config.delete();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 541       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 542     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 543   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 544                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 545   /**                                                                                                    </span>
<span class="-8312193682087493639" onmouseenter="enter('-8312193682087493639');" onmouseout="out('-8312193682087493639');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 546    * 删除temp文件                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 547    */                                                                                                    </span>
<span class="7655331082892594561" onmouseenter="enter('7655331082892594561');" onmouseout="out('7655331082892594561');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 548   @Override public void delTempFile() {                                                                  </span>
<span class="8558402344038566367" onmouseenter="enter('8558402344038566367');" onmouseout="out('8558402344038566367');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 549     if (mContext != null &amp;&amp; mDownloadEntity != null) {                                                   </span>
<span class="3099781541276521660" onmouseenter="enter('3099781541276521660');" onmouseout="out('3099781541276521660');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 550       File dFile = new File(mDownloadEntity.getDownloadPath());                                          </span>
<span class="7897717398420259974" onmouseenter="enter('7897717398420259974');" onmouseout="out('7897717398420259974');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 551       if (dFile.exists()) {                                                                              </span>
<span class="7527345290446588408" onmouseenter="enter('7527345290446588408');" onmouseout="out('7527345290446588408');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 552         dFile.delete();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 553       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 554     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 555   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 556                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 557   /**                                                                                                    </span>
<span class="-5727215122052088545" onmouseenter="enter('-5727215122052088545');" onmouseout="out('-5727215122052088545');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 558    * 多线程断点续传下载文件，开始下载                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 559    */                                                                                                    </span>
<span class="-4856178778199245062" onmouseenter="enter('-4856178778199245062');" onmouseout="out('-4856178778199245062');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 560   @Override public void startDownload() {                                                                </span>
<span class="898408935389387935" onmouseenter="enter('898408935389387935');" onmouseout="out('898408935389387935');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 561     mConstance.cleanState();                                                                             </span>
<span class="2099174989180368882" onmouseenter="enter('2099174989180368882');" onmouseout="out('2099174989180368882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 562     mListener.onPre();                                                                                   </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 563     new Thread(this).start();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 564   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 565                                                                                                          </span>
<span class="-5762688668558425600" onmouseenter="enter('-5762688668558425600');" onmouseout="out('-5762688668558425600');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 566   @Override public void resumeDownload() {                                                               </span>
<span class="1497820413888703615" onmouseenter="enter('1497820413888703615');" onmouseout="out('1497820413888703615');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 567     startDownload();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 568   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 569                                                                                                          </span>
<span class="8306009172830771261" onmouseenter="enter('8306009172830771261');" onmouseout="out('8306009172830771261');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 570   private void failDownload(String msg) {                                                                </span>
<span class="-6647758959009774834" onmouseenter="enter('-6647758959009774834');" onmouseout="out('-6647758959009774834');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 571     Log.e(TAG, msg);                                                                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 572     mConstance.isDownloading = false;                                                                    </span>
<span class="-6715929234808926893" onmouseenter="enter('-6715929234808926893');" onmouseout="out('-6715929234808926893');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 573     stopDownload();                                                                                      </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 574     mListener.onFail();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 575   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 576                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 577   @Override public void run() {                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 578     try {                                                                                                </span>
<span class="5483634401908283016" onmouseenter="enter('5483634401908283016');" onmouseout="out('5483634401908283016');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 579       URL url = new URL(mDownloadEntity.getDownloadUrl());                                               </span>
<span class="-6008953795197858884" onmouseenter="enter('-6008953795197858884');" onmouseout="out('-6008953795197858884');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 580       HttpURLConnection conn = ConnectionHelp.handleConnection(url);                                     </span>
<span class="2062133901627510982" onmouseenter="enter('2062133901627510982');" onmouseout="out('2062133901627510982');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 581       conn = ConnectionHelp.setConnectParam(conn);                                                       </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 582       conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                              </span>
<span class="-3579311541579934971" onmouseenter="enter('-3579311541579934971');" onmouseout="out('-3579311541579934971');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 583       conn.setConnectTimeout(mConnectTimeOut * 4);                                                       </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 584       conn.connect();                                                                                    </span>
<span class="6567575788372053568" onmouseenter="enter('6567575788372053568');" onmouseout="out('6567575788372053568');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 585       int len = conn.getContentLength();                                                                 </span>
<span class="3904365852949278245" onmouseenter="enter('3904365852949278245');" onmouseout="out('3904365852949278245');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 586       //if (len &lt; 0) {  //网络被劫持时会出现这个问题                                                                  </span>
<span class="835324676499837078" onmouseenter="enter('835324676499837078');" onmouseout="out('835324676499837078');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 587       //  failDownload(&quot;下载失败，网络被劫持&quot;);                                                                    </span>
<span class="3500611444781325819" onmouseenter="enter('3500611444781325819');" onmouseout="out('3500611444781325819');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 588       //  return;                                                                                        </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 589       //}                                                                                                </span>
<span class="-5653376755036700146" onmouseenter="enter('-5653376755036700146');" onmouseout="out('-5653376755036700146');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 590       int code = conn.getResponseCode();                                                                 </span>
<span class="999254544547719885" onmouseenter="enter('999254544547719885');" onmouseout="out('999254544547719885');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 591       //https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81                                    </span>
<span class="-8703603538857387010" onmouseenter="enter('-8703603538857387010');" onmouseout="out('-8703603538857387010');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 592       //206支持断点                                                                                          </span>
<span class="5260656878663172399" onmouseenter="enter('5260656878663172399');" onmouseout="out('5260656878663172399');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 593       if (code == HttpURLConnection.HTTP_PARTIAL) {                                                      </span>
<span class="-4850747580721370850" onmouseenter="enter('-4850747580721370850');" onmouseout="out('-4850747580721370850');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 594         isSupportBreakpoint = true;                                                                      </span>
<span class="1256350564434583014" onmouseenter="enter('1256350564434583014');" onmouseout="out('1256350564434583014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 595         mListener.supportBreakpoint(true);                                                               </span>
<span class="-7366273742365769169" onmouseenter="enter('-7366273742365769169');" onmouseout="out('-7366273742365769169');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 596         handleBreakpoint(conn);                                                                          </span>
<span class="877851589237632825" onmouseenter="enter('877851589237632825');" onmouseout="out('877851589237632825');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 597       } else if (code == HttpURLConnection.HTTP_OK || len &lt; 0) {                                         </span>
<span class="-5840271675092361063" onmouseenter="enter('-5840271675092361063');" onmouseout="out('-5840271675092361063');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 598         //在conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);下，200为不支持断点状态                            </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 599         if (len &lt; 0) {                                                                                   </span>
<span class="9025825393004184595" onmouseenter="enter('9025825393004184595');" onmouseout="out('9025825393004184595');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 600           failDownload(&quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，文件长度小于0&quot;);                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 601           return;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 602         }                                                                                                </span>
<span class="5451458949060440820" onmouseenter="enter('5451458949060440820');" onmouseout="out('5451458949060440820');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 603         isSupportBreakpoint = false;                                                                     </span>
<span class="3223278567209587987" onmouseenter="enter('3223278567209587987');" onmouseout="out('3223278567209587987');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 604         mListener.supportBreakpoint(false);                                                              </span>
<span class="-3209038805792969148" onmouseenter="enter('-3209038805792969148');" onmouseout="out('-3209038805792969148');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 605         Log.w(TAG, &quot;该下载链接不支持断点下载&quot;);                                                                      </span>
<span class="-7366273742365769169" onmouseenter="enter('-7366273742365769169');" onmouseout="out('-7366273742365769169');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 606         handleBreakpoint(conn);                                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 607       } else {                                                                                           </span>
<span class="3429592426515613091" onmouseenter="enter('3429592426515613091');" onmouseout="out('3429592426515613091');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 608         failDownload(&quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，返回码：&quot; + code);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 609       }                                                                                                  </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 610     } catch (IOException e) {                                                                            </span>
<span class="7015103282251076587" onmouseenter="enter('7015103282251076587');" onmouseout="out('7015103282251076587');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 611       failDownload(&quot;下载失败【downloadUrl:&quot;                                                                   </span>
<span class="5951112113295803501" onmouseenter="enter('5951112113295803501');" onmouseout="out('5951112113295803501');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 612           + mDownloadEntity.getDownloadUrl()                                                             </span>
<span class="910868662350755341" onmouseenter="enter('910868662350755341');" onmouseout="out('910868662350755341');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 613           + &quot;】\n【filePath:&quot;                                                                              </span>
<span class="5931171797063415443" onmouseenter="enter('5931171797063415443');" onmouseout="out('5931171797063415443');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 614           + mDownloadFile.getPath()                                                                      </span>
<span class="-1840319934610193149" onmouseenter="enter('-1840319934610193149');" onmouseout="out('-1840319934610193149');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 615           + &quot;】&quot;                                                                                          </span>
<span class="-5371623624849066023" onmouseenter="enter('-5371623624849066023');" onmouseout="out('-5371623624849066023');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 616           + CommonUtil.getPrintException(e));                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 617     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 618   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 619                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 620   /**                                                                                                    </span>
<span class="-2887709646015060517" onmouseenter="enter('-2887709646015060517');" onmouseout="out('-2887709646015060517');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 621    * 处理断点                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 622    */                                                                                                    </span>
<span class="-1770943272374407595" onmouseenter="enter('-1770943272374407595');" onmouseout="out('-1770943272374407595');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 623   private void handleBreakpoint(HttpURLConnection conn) throws IOException {                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 624                                                                                                          </span>
<span class="7477238500582408106" onmouseenter="enter('7477238500582408106');" onmouseout="out('7477238500582408106');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 625     //不支持断点只能单线程下载                                                                                       </span>
<span class="-6722781002220970553" onmouseenter="enter('-6722781002220970553');" onmouseout="out('-6722781002220970553');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 626     if (!isSupportBreakpoint) {                                                                          </span>
<span class="-8481066330390671660" onmouseenter="enter('-8481066330390671660');" onmouseout="out('-8481066330390671660');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 627       ConfigEntity entity = new ConfigEntity();                                                          </span>
<span class="9125695722945677869" onmouseenter="enter('9125695722945677869');" onmouseout="out('9125695722945677869');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 628       entity.FILE_SIZE = conn.getContentLength();                                                        </span>
<span class="4189357201157412201" onmouseenter="enter('4189357201157412201');" onmouseout="out('4189357201157412201');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 629       entity.DOWNLOAD_URL = mDownloadEntity.getDownloadUrl();                                            </span>
<span class="1175511499700324517" onmouseenter="enter('1175511499700324517');" onmouseout="out('1175511499700324517');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 630       entity.TEMP_FILE = mDownloadFile;                                                                  </span>
<span class="-1353085718172399938" onmouseenter="enter('-1353085718172399938');" onmouseout="out('-1353085718172399938');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 631       entity.THREAD_ID = 0;                                                                              </span>
<span class="-4967231089338870782" onmouseenter="enter('-4967231089338870782');" onmouseout="out('-4967231089338870782');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 632       entity.START_LOCATION = 0;                                                                         </span>
<span class="4365950116387297475" onmouseenter="enter('4365950116387297475');" onmouseout="out('4365950116387297475');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 633       entity.END_LOCATION = entity.FILE_SIZE;                                                            </span>
<span class="-7848202009707844875" onmouseenter="enter('-7848202009707844875');" onmouseout="out('-7848202009707844875');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 634       entity.CONFIG_FILE_PATH = mConfigFile.getPath();                                                   </span>
<span class="2812036997657153043" onmouseenter="enter('2812036997657153043');" onmouseout="out('2812036997657153043');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 635       entity.isSupportBreakpoint = isSupportBreakpoint;                                                  </span>
<span class="4531885195650702733" onmouseenter="enter('4531885195650702733');" onmouseout="out('4531885195650702733');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 636       SingleThreadTask task = new SingleThreadTask(mConstance, mListener, entity);                       </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 637       mFixedThreadPool.execute(task);                                                                    </span>
<span class="-2943780714290472761" onmouseenter="enter('-2943780714290472761');" onmouseout="out('-2943780714290472761');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 638       mListener.onStart(0);                                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 639       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 640     }                                                                                                    </span>
<span class="-4144971478129188538" onmouseenter="enter('-4144971478129188538');" onmouseout="out('-4144971478129188538');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 641     int fileLength = conn.getContentLength();                                                            </span>
<span class="-3771769896201867631" onmouseenter="enter('-3771769896201867631');" onmouseout="out('-3771769896201867631');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 642     //必须建一个文件                                                                                            </span>
<span class="-8241179119122160888" onmouseenter="enter('-8241179119122160888');" onmouseout="out('-8241179119122160888');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 643     CommonUtil.createFile(mDownloadFile.getPath());                                                      </span>
<span class="-844126738551985064" onmouseenter="enter('-844126738551985064');" onmouseout="out('-844126738551985064');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 644     RandomAccessFile file = new RandomAccessFile(mDownloadFile.getPath(), &quot;rwd&quot;);                        </span>
<span class="-564508951971497574" onmouseenter="enter('-564508951971497574');" onmouseout="out('-564508951971497574');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 645     //设置文件长度                                                                                             </span>
<span class="6023690204241765206" onmouseenter="enter('6023690204241765206');" onmouseout="out('6023690204241765206');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 646     file.setLength(fileLength);                                                                          </span>
<span class="5666806310833670603" onmouseenter="enter('5666806310833670603');" onmouseout="out('5666806310833670603');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 647     mListener.onPostPre(fileLength);                                                                     </span>
<span class="6024675825413521783" onmouseenter="enter('6024675825413521783');" onmouseout="out('6024675825413521783');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 648     //分配每条线程的下载区间                                                                                        </span>
<span class="-317662916418562024" onmouseenter="enter('-317662916418562024');" onmouseout="out('-317662916418562024');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 649     Properties pro = null;                                                                               </span>
<span class="4467713772376842471" onmouseenter="enter('4467713772376842471');" onmouseout="out('4467713772376842471');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 650     pro = CommonUtil.loadConfig(mConfigFile);                                                            </span>
<span class="-681137634566379888" onmouseenter="enter('-681137634566379888');" onmouseout="out('-681137634566379888');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 651     if (pro.isEmpty()) {                                                                                 </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 652       isNewTask = true;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 653     } else {                                                                                             </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 654       for (int i = 0; i &lt; THREAD_NUM; i++) {                                                             </span>
<span class="-6973645922135466911" onmouseenter="enter('-6973645922135466911');" onmouseout="out('-6973645922135466911');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 655         if (pro.getProperty(mDownloadFile.getName() + &quot;_record_&quot; + i) == null) {                         </span>
<span class="1178951043321657234" onmouseenter="enter('1178951043321657234');" onmouseout="out('1178951043321657234');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 656           Object state = pro.getProperty(mDownloadFile.getName() + &quot;_state_&quot; + i);                       </span>
<span class="-2092430839348453245" onmouseenter="enter('-2092430839348453245');" onmouseout="out('-2092430839348453245');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 657           if (state != null &amp;&amp; Integer.parseInt(state + &quot;&quot;) == 1) {                                      </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 658             continue;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 659           }                                                                                              </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 660           isNewTask = true;                                                                              </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 661           break;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 662         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 663       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 664     }                                                                                                    </span>
<span class="-1643854653241583074" onmouseenter="enter('-1643854653241583074');" onmouseout="out('-1643854653241583074');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 665     int blockSize = fileLength / THREAD_NUM;                                                             </span>
<span class="866019335924650779" onmouseenter="enter('866019335924650779');" onmouseout="out('866019335924650779');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 666     int[] recordL = new int[THREAD_NUM];                                                                 </span>
<span class="794844889575716346" onmouseenter="enter('794844889575716346');" onmouseout="out('794844889575716346');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 667     int rl = 0;                                                                                          </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 668     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="8242320341463399828" onmouseenter="enter('8242320341463399828');" onmouseout="out('8242320341463399828');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 669       recordL[i] = -1;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 670     }                                                                                                    </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 671     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="-2965725495076654490" onmouseenter="enter('-2965725495076654490');" onmouseout="out('-2965725495076654490');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 672       long startL = i * blockSize, endL = (i + 1) * blockSize;                                           </span>
<span class="1178951043321657234" onmouseenter="enter('1178951043321657234');" onmouseout="out('1178951043321657234');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 673       Object state = pro.getProperty(mDownloadFile.getName() + &quot;_state_&quot; + i);                           </span>
<span class="2419725940883839935" onmouseenter="enter('2419725940883839935');" onmouseout="out('2419725940883839935');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 674       if (state != null &amp;&amp; Integer.parseInt(state + &quot;&quot;) == 1) {  //该线程已经完成                               </span>
<span class="8742170387731029623" onmouseenter="enter('8742170387731029623');" onmouseout="out('8742170387731029623');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 675         mConstance.CURRENT_LOCATION += endL - startL;                                                    </span>
<span class="7342592738960136820" onmouseenter="enter('7342592738960136820');" onmouseout="out('7342592738960136820');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 676         Log.d(TAG, &quot;++++++++++ 线程_&quot; + i + &quot;_已经下载完成 ++++++++++&quot;);                                         </span>
<span class="-337774801975969950" onmouseenter="enter('-337774801975969950');" onmouseout="out('-337774801975969950');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 677         mConstance.COMPLETE_THREAD_NUM++;                                                                </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 678         mConstance.STOP_NUM++;                                                                           </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 679         mConstance.CANCEL_NUM++;                                                                         </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 680         if (mConstance.isComplete()) {                                                                   </span>
<span class="4951157766975006439" onmouseenter="enter('4951157766975006439');" onmouseout="out('4951157766975006439');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 681           if (mConfigFile.exists()) {                                                                    </span>
<span class="-8106518526167482323" onmouseenter="enter('-8106518526167482323');" onmouseout="out('-8106518526167482323');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 682             mConfigFile.delete();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 683           }                                                                                              </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 684           mListener.onComplete();                                                                        </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 685           mConstance.isDownloading = false;                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 686           return;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 687         }                                                                                                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 688         continue;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 689       }                                                                                                  </span>
<span class="-1793454279264850881" onmouseenter="enter('-1793454279264850881');" onmouseout="out('-1793454279264850881');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 690       //分配下载位置                                                                                           </span>
<span class="-8200484973700844224" onmouseenter="enter('-8200484973700844224');" onmouseout="out('-8200484973700844224');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 691       Object record = pro.getProperty(mDownloadFile.getName() + &quot;_record_&quot; + i);                         </span>
<span class="-4606277471232235328" onmouseenter="enter('-4606277471232235328');" onmouseout="out('-4606277471232235328');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 692       //如果有记录，则恢复下载                                                                                      </span>
<span class="9081430961250736769" onmouseenter="enter('9081430961250736769');" onmouseout="out('9081430961250736769');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 693       if (!isNewTask &amp;&amp; record != null &amp;&amp; Long.parseLong(record + &quot;&quot;) &gt; 0) {                             </span>
<span class="8647082033828497822" onmouseenter="enter('8647082033828497822');" onmouseout="out('8647082033828497822');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 694         Long r = Long.parseLong(record + &quot;&quot;);                                                            </span>
<span class="1683054574044455381" onmouseenter="enter('1683054574044455381');" onmouseout="out('1683054574044455381');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 695         mConstance.CURRENT_LOCATION += r - startL;                                                       </span>
<span class="179733331572927392" onmouseenter="enter('179733331572927392');" onmouseout="out('179733331572927392');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 696         Log.d(TAG, &quot;++++++++++ 线程_&quot; + i + &quot;_恢复下载 ++++++++++&quot;);                                           </span>
<span class="6939461797319425642" onmouseenter="enter('6939461797319425642');" onmouseout="out('6939461797319425642');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 697         mListener.onChildResume(r);                                                                      </span>
<span class="1542845345888554533" onmouseenter="enter('1542845345888554533');" onmouseout="out('1542845345888554533');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 698         startL = r;                                                                                      </span>
<span class="-7425711498405631322" onmouseenter="enter('-7425711498405631322');" onmouseout="out('-7425711498405631322');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 699         recordL[rl] = i;                                                                                 </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 700         rl++;                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 701       } else {                                                                                           </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 702         isNewTask = true;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 703       }                                                                                                  </span>
<span class="537230916062757449" onmouseenter="enter('537230916062757449');" onmouseout="out('537230916062757449');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 704       if (isNewTask) {                                                                                   </span>
<span class="-7425711498405631322" onmouseenter="enter('-7425711498405631322');" onmouseout="out('-7425711498405631322');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 705         recordL[rl] = i;                                                                                 </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 706         rl++;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 707       }                                                                                                  </span>
<span class="-3400889980578220125" onmouseenter="enter('-3400889980578220125');" onmouseout="out('-3400889980578220125');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 708       if (i == (THREAD_NUM - 1)) {                                                                       </span>
<span class="-7423751213765432972" onmouseenter="enter('-7423751213765432972');" onmouseout="out('-7423751213765432972');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 709         //如果整个文件的大小不为线程个数的整数倍，则最后一个线程的结束位置即为文件的总长度                                                       </span>
<span class="-2829184075463306484" onmouseenter="enter('-2829184075463306484');" onmouseout="out('-2829184075463306484');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 710         endL = fileLength;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 711       }                                                                                                  </span>
<span class="-8481066330390671660" onmouseenter="enter('-8481066330390671660');" onmouseout="out('-8481066330390671660');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 712       ConfigEntity entity = new ConfigEntity();                                                          </span>
<span class="-3119684513187648029" onmouseenter="enter('-3119684513187648029');" onmouseout="out('-3119684513187648029');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 713       entity.FILE_SIZE = fileLength;                                                                     </span>
<span class="4189357201157412201" onmouseenter="enter('4189357201157412201');" onmouseout="out('4189357201157412201');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 714       entity.DOWNLOAD_URL = mDownloadEntity.getDownloadUrl();                                            </span>
<span class="1175511499700324517" onmouseenter="enter('1175511499700324517');" onmouseout="out('1175511499700324517');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 715       entity.TEMP_FILE = mDownloadFile;                                                                  </span>
<span class="-1808458878368858692" onmouseenter="enter('-1808458878368858692');" onmouseout="out('-1808458878368858692');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 716       entity.THREAD_ID = i;                                                                              </span>
<span class="6661292811999012973" onmouseenter="enter('6661292811999012973');" onmouseout="out('6661292811999012973');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 717       entity.START_LOCATION = startL;                                                                    </span>
<span class="8656472587238389131" onmouseenter="enter('8656472587238389131');" onmouseout="out('8656472587238389131');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 718       entity.END_LOCATION = endL;                                                                        </span>
<span class="-7848202009707844875" onmouseenter="enter('-7848202009707844875');" onmouseout="out('-7848202009707844875');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 719       entity.CONFIG_FILE_PATH = mConfigFile.getPath();                                                   </span>
<span class="2812036997657153043" onmouseenter="enter('2812036997657153043');" onmouseout="out('2812036997657153043');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 720       entity.isSupportBreakpoint = isSupportBreakpoint;                                                  </span>
<span class="4531885195650702733" onmouseenter="enter('4531885195650702733');" onmouseout="out('4531885195650702733');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 721       SingleThreadTask task = new SingleThreadTask(mConstance, mListener, entity);                       </span>
<span class="-6012810893938815399" onmouseenter="enter('-6012810893938815399');" onmouseout="out('-6012810893938815399');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 722       mTask.put(i, task);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 723     }                                                                                                    </span>
<span class="-1061602448343886008" onmouseenter="enter('-1061602448343886008');" onmouseout="out('-1061602448343886008');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 724     if (mConstance.CURRENT_LOCATION &gt; 0) {                                                               </span>
<span class="5187035189520501266" onmouseenter="enter('5187035189520501266');" onmouseout="out('5187035189520501266');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 725       mListener.onResume(mConstance.CURRENT_LOCATION);                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 726     } else {                                                                                             </span>
<span class="-2973471902048685805" onmouseenter="enter('-2973471902048685805');" onmouseout="out('-2973471902048685805');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 727       mListener.onStart(mConstance.CURRENT_LOCATION);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 728     }                                                                                                    </span>
<span class="1243235571055153612" onmouseenter="enter('1243235571055153612');" onmouseout="out('1243235571055153612');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 729     for (int l : recordL) {                                                                              </span>
<span class="-7510837703317171619" onmouseenter="enter('-7510837703317171619');" onmouseout="out('-7510837703317171619');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 730       if (l == -1) continue;                                                                             </span>
<span class="-85915337091278441" onmouseenter="enter('-85915337091278441');" onmouseout="out('-85915337091278441');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 731       Runnable task = mTask.get(l);                                                                      </span>
<span class="-7327661534177463737" onmouseenter="enter('-7327661534177463737');" onmouseout="out('-7327661534177463737');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 732       if (task != null &amp;&amp; !mFixedThreadPool.isShutdown()) {                                              </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 733         mFixedThreadPool.execute(task);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 734       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 735     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 736   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 737                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 738   /**                                                                                                    </span>
<span class="2585942053451624927" onmouseenter="enter('2585942053451624927');" onmouseout="out('2585942053451624927');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 739    * 子线程下载信息类                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 740    */                                                                                                    </span>
<span class="-3850188489545087742" onmouseenter="enter('-3850188489545087742');" onmouseout="out('-3850188489545087742');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 741   final static class ConfigEntity {                                                                      </span>
<span class="-403498804051257270" onmouseenter="enter('-403498804051257270');" onmouseout="out('-403498804051257270');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 742     //文件大小                                                                                               </span>
<span class="541475241289655650" onmouseenter="enter('541475241289655650');" onmouseout="out('541475241289655650');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 743     long FILE_SIZE;                                                                                      </span>
<span class="-4736398418022593572" onmouseenter="enter('-4736398418022593572');" onmouseout="out('-4736398418022593572');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 744     String DOWNLOAD_URL;                                                                                 </span>
<span class="-7368464316865211776" onmouseenter="enter('-7368464316865211776');" onmouseout="out('-7368464316865211776');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 745     int THREAD_ID;                                                                                       </span>
<span class="3260682776668453255" onmouseenter="enter('3260682776668453255');" onmouseout="out('3260682776668453255');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 746     long START_LOCATION;                                                                                 </span>
<span class="2446069397877689758" onmouseenter="enter('2446069397877689758');" onmouseout="out('2446069397877689758');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 747     long END_LOCATION;                                                                                   </span>
<span class="4104096962052364503" onmouseenter="enter('4104096962052364503');" onmouseout="out('4104096962052364503');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 748     File TEMP_FILE;                                                                                      </span>
<span class="-2017423643980728828" onmouseenter="enter('-2017423643980728828');" onmouseout="out('-2017423643980728828');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 749     boolean isSupportBreakpoint = true;                                                                  </span>
<span class="-2943683475239618057" onmouseenter="enter('-2943683475239618057');" onmouseout="out('-2943683475239618057');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 750     String CONFIG_FILE_PATH;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 751   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 752 }                                                                                                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 753 =======                                                                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 754 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span></pre></td>
                            <td><pre><span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style="">   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   2 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   3  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   4  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   5  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   6  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   7  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   8  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   9  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  10  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  11  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  12  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  13  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  14  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  15  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  16  */                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  17                                                                                                          </span>
<span class="-1768704711895145311" onmouseenter="enter('-1768704711895145311');" onmouseout="out('-1768704711895145311');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  18 package com.arialyy.aria.core.task;                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  19                                                                                                          </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  20 import android.content.Context;                                                                          </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  21 import android.util.Log;                                                                                 </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  22 import android.util.SparseArray;                                                                         </span>
<span class="-8446909004143589790" onmouseenter="enter('-8446909004143589790');" onmouseout="out('-8446909004143589790');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  23 import com.arialyy.aria.core.DownloadEntity;                                                             </span>
<span class="-1661010561836341583" onmouseenter="enter('-1661010561836341583');" onmouseout="out('-1661010561836341583');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  24 import com.arialyy.aria.util.BufferedRandomAccessFile;                                                   </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  25 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  26 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  27 import java.io.IOException;                                                                              </span>
<span class="-3877933607611446246" onmouseenter="enter('-3877933607611446246');" onmouseout="out('-3877933607611446246');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  28 import java.io.RandomAccessFile;                                                                         </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  29 import java.net.HttpURLConnection;                                                                       </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  30 import java.net.URL;                                                                                     </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  31 import java.util.Properties;                                                                             </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  32 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  33 import java.util.concurrent.Executors;                                                                   </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  34                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  35 /**                                                                                                      </span>
<span class="2363292981682035173" onmouseenter="enter('2363292981682035173');" onmouseout="out('2363292981682035173');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  36  * Created by lyy on 2015/8/25.                                                                          </span>
<span class="-8257115403302511340" onmouseenter="enter('-8257115403302511340');" onmouseout="out('-8257115403302511340');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  37  * 下载工具类                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  38  */                                                                                                      </span>
<span class="2282207299880186426" onmouseenter="enter('2282207299880186426');" onmouseout="out('2282207299880186426');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  39 public class DownloadUtil implements IDownloadUtil, Runnable {                                           </span>
<span class="1261799266044613591" onmouseenter="enter('1261799266044613591');" onmouseout="out('1261799266044613591');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  40   private static final String TAG = &quot;DownloadUtil&quot;;                                                      </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41   /**                                                                                                    </span>
<span class="-8352985751663047055" onmouseenter="enter('-8352985751663047055');" onmouseout="out('-8352985751663047055');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42    * 线程数                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  43    */                                                                                                    </span>
<span class="-7983967545860957599" onmouseenter="enter('-7983967545860957599');" onmouseout="out('-7983967545860957599');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  44   private final int THREAD_NUM;                                                                          </span>
<span class="-785681239530372348" onmouseenter="enter('-785681239530372348');" onmouseout="out('-785681239530372348');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  45   //下载监听                                                                                                 </span>
<span class="8085369704814778285" onmouseenter="enter('8085369704814778285');" onmouseout="out('8085369704814778285');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  46   private IDownloadListener mListener;                                                                   </span>
<span class="8993221121586487711" onmouseenter="enter('8993221121586487711');" onmouseout="out('8993221121586487711');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  47   private int mConnectTimeOut = 5000 * 4; //连接超时时间                                                       </span>
<span class="4023537183138169002" onmouseenter="enter('4023537183138169002');" onmouseout="out('4023537183138169002');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  48   private int mReadTimeOut = 5000 * 20; //流读取的超时时间                                                       </span>
<span class="-1157942250762320951" onmouseenter="enter('-1157942250762320951');" onmouseout="out('-1157942250762320951');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  49   private boolean isNewTask = true;                                                                      </span>
<span class="-7348064306101585897" onmouseenter="enter('-7348064306101585897');" onmouseout="out('-7348064306101585897');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  50   private boolean isSupportBreakpoint = true;                                                            </span>
<span class="6683852815807951473" onmouseenter="enter('6683852815807951473');" onmouseout="out('6683852815807951473');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  51   private Context mContext;                                                                              </span>
<span class="-4114987623877824308" onmouseenter="enter('-4114987623877824308');" onmouseout="out('-4114987623877824308');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  52   private DownloadEntity mDownloadEntity;                                                                </span>
<span class="1058453114158093994" onmouseenter="enter('1058453114158093994');" onmouseout="out('1058453114158093994');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53   private ExecutorService mFixedThreadPool;                                                              </span>
<span class="-1133559474859202897" onmouseenter="enter('-1133559474859202897');" onmouseout="out('-1133559474859202897');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54   private File mDownloadFile; //下载的文件                                                                    </span>
<span class="7861940189151317235" onmouseenter="enter('7861940189151317235');" onmouseout="out('7861940189151317235');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55   private File mConfigFile;//下载信息配置文件                                                                    </span>
<span class="-3869960521609686448" onmouseenter="enter('-3869960521609686448');" onmouseout="out('-3869960521609686448');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56   private SparseArray&lt;Runnable&gt; mTask = new SparseArray&lt;&gt;();                                             </span>
<span class="7070628333292412283" onmouseenter="enter('7070628333292412283');" onmouseout="out('7070628333292412283');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57   private DownloadStateConstance mConstance;                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58                                                                                                          </span>
<span class="-6554670557683360136" onmouseenter="enter('-6554670557683360136');" onmouseout="out('-6554670557683360136');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59   public DownloadUtil(Context context, DownloadEntity entity, IDownloadListener downloadListener) {      </span>
<span class="-4896597165635236478" onmouseenter="enter('-4896597165635236478');" onmouseout="out('-4896597165635236478');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60     this(context, entity, downloadListener, 3);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  61   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  62                                                                                                          </span>
<span class="-4986291938704783923" onmouseenter="enter('-4986291938704783923');" onmouseout="out('-4986291938704783923');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  63   DownloadUtil(Context context, DownloadEntity entity, IDownloadListener downloadListener,               </span>
<span class="-8984238530475947621" onmouseenter="enter('-8984238530475947621');" onmouseout="out('-8984238530475947621');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  64       int threadNum) {                                                                                   </span>
<span class="-673106209130372223" onmouseenter="enter('-673106209130372223');" onmouseout="out('-673106209130372223');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  65     mContext = context.getApplicationContext();                                                          </span>
<span class="-216605200672599564" onmouseenter="enter('-216605200672599564');" onmouseout="out('-216605200672599564');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  66     mDownloadEntity = entity;                                                                            </span>
<span class="3831466484862340223" onmouseenter="enter('3831466484862340223');" onmouseout="out('3831466484862340223');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67     mListener = downloadListener;                                                                        </span>
<span class="-6579794148103748852" onmouseenter="enter('-6579794148103748852');" onmouseout="out('-6579794148103748852');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  68     THREAD_NUM = threadNum;                                                                              </span>
<span class="-7335968387740294445" onmouseenter="enter('-7335968387740294445');" onmouseout="out('-7335968387740294445');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  69     mFixedThreadPool = Executors.newFixedThreadPool(Integer.MAX_VALUE);                                  </span>
<span class="2824360841323512384" onmouseenter="enter('2824360841323512384');" onmouseout="out('2824360841323512384');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  70     mConstance = new DownloadStateConstance(THREAD_NUM);                                                 </span>
<span class="-1498726564668589193" onmouseenter="enter('-1498726564668589193');" onmouseout="out('-1498726564668589193');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  71     init();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  72   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  73                                                                                                          </span>
<span class="-909562594025196126" onmouseenter="enter('-909562594025196126');" onmouseout="out('-909562594025196126');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  74   private void init() {                                                                                  </span>
<span class="-8302516119393797134" onmouseenter="enter('-8302516119393797134');" onmouseout="out('-8302516119393797134');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  75     mDownloadFile = new File(mDownloadEntity.getDownloadPath());                                         </span>
<span class="-3534953052494864097" onmouseenter="enter('-3534953052494864097');" onmouseout="out('-3534953052494864097');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76     //读取已完成的线程数                                                                                          </span>
<span class="-9053998435552088983" onmouseenter="enter('-9053998435552088983');" onmouseout="out('-9053998435552088983');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77     mConfigFile = new File(                                                                              </span>
<span class="-3948838928069897094" onmouseenter="enter('-3948838928069897094');" onmouseout="out('-3948838928069897094');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  78         mContext.getFilesDir().getPath() + &quot;/temp/&quot; + mDownloadFile.getName() + &quot;.properties&quot;);          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  79     try {                                                                                                </span>
<span class="7925700052565713558" onmouseenter="enter('7925700052565713558');" onmouseout="out('7925700052565713558');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  80       if (!mConfigFile.exists()) { //记录文件被删除，则重新下载                                                       </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  81         isNewTask = true;                                                                                </span>
<span class="1838885973573966413" onmouseenter="enter('1838885973573966413');" onmouseout="out('1838885973573966413');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  82         CommonUtil.createFile(mConfigFile.getPath());                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  83       } else {                                                                                           </span>
<span class="-6296621072689899390" onmouseenter="enter('-6296621072689899390');" onmouseout="out('-6296621072689899390');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  84         isNewTask = !mDownloadFile.exists();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85       }                                                                                                  </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  86     } catch (Exception e) {                                                                              </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  87       e.printStackTrace();                                                                               </span>
<span class="-3747169937451325082" onmouseenter="enter('-3747169937451325082');" onmouseout="out('-3747169937451325082');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  88       failDownload(&quot;下载失败，记录文件被删除&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  89     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  90   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  91                                                                                                          </span>
<span class="-8585626151911369157" onmouseenter="enter('-8585626151911369157');" onmouseout="out('-8585626151911369157');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  92   public IDownloadListener getListener() {                                                               </span>
<span class="-7037258027690597516" onmouseenter="enter('-7037258027690597516');" onmouseout="out('-7037258027690597516');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  93     return mListener;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  94   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  95                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  96   /**                                                                                                    </span>
<span class="6936487890332430093" onmouseenter="enter('6936487890332430093');" onmouseout="out('6936487890332430093');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  97    * 设置连接超时时间                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  98    */                                                                                                    </span>
<span class="8269350745377988793" onmouseenter="enter('8269350745377988793');" onmouseout="out('8269350745377988793');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99   public void setConnectTimeOut(int timeOut) {                                                           </span>
<span class="7491344361160646490" onmouseenter="enter('7491344361160646490');" onmouseout="out('7491344361160646490');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100     mConnectTimeOut = timeOut;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103   /**                                                                                                    </span>
<span class="1793189252207234639" onmouseenter="enter('1793189252207234639');" onmouseout="out('1793189252207234639');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104    * 设置流读取的超时时间                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 105    */                                                                                                    </span>
<span class="-4265144949210493065" onmouseenter="enter('-4265144949210493065');" onmouseout="out('-4265144949210493065');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106   public void setReadTimeOut(int readTimeOut) {                                                          </span>
<span class="-3349186980434336657" onmouseenter="enter('-3349186980434336657');" onmouseout="out('-3349186980434336657');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107     mReadTimeOut = readTimeOut;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 109                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 110   /**                                                                                                    </span>
<span class="6025979389427346334" onmouseenter="enter('6025979389427346334');" onmouseout="out('6025979389427346334');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 111    * 获取当前下载位置                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112    */                                                                                                    </span>
<span class="42588745782017963" onmouseenter="enter('42588745782017963');" onmouseout="out('42588745782017963');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113   @Override public long getCurrentLocation() {                                                           </span>
<span class="2881215542099369319" onmouseenter="enter('2881215542099369319');" onmouseout="out('2881215542099369319');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 114     return mConstance.CURRENT_LOCATION;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116                                                                                                          </span>
<span class="8514823861416132786" onmouseenter="enter('8514823861416132786');" onmouseout="out('8514823861416132786');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 117   @Override public boolean isDownloading() {                                                             </span>
<span class="-2560940912314579274" onmouseenter="enter('-2560940912314579274');" onmouseout="out('-2560940912314579274');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 118     return mConstance.isDownloading;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 119   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121   /**                                                                                                    </span>
<span class="8520049766391668792" onmouseenter="enter('8520049766391668792');" onmouseout="out('8520049766391668792');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122    * 取消下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123    */                                                                                                    </span>
<span class="8518544268347342740" onmouseenter="enter('8518544268347342740');" onmouseout="out('8518544268347342740');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124   @Override public void cancelDownload() {                                                               </span>
<span class="204250319841071761" onmouseenter="enter('204250319841071761');" onmouseout="out('204250319841071761');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125     mConstance.isCancel = true;                                                                          </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126     mConstance.isDownloading = false;                                                                    </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127     mFixedThreadPool.shutdown();                                                                         </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="6217106455110130996" onmouseenter="enter('6217106455110130996');" onmouseout="out('6217106455110130996');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129       SingleThreadTask task = (SingleThreadTask) mTask.get(i);                                           </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130       if (task != null) {                                                                                </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131         task.cancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 133     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 134   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 135                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 136   /**                                                                                                    </span>
<span class="7755328866638560569" onmouseenter="enter('7755328866638560569');" onmouseout="out('7755328866638560569');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 137    * 停止下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 138    */                                                                                                    </span>
<span class="-4596234023078912379" onmouseenter="enter('-4596234023078912379');" onmouseout="out('-4596234023078912379');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139   @Override public void stopDownload() {                                                                 </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140     mConstance.isStop = true;                                                                            </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141     mConstance.isDownloading = false;                                                                    </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 142     mFixedThreadPool.shutdown();                                                                         </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 143     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="6217106455110130996" onmouseenter="enter('6217106455110130996');" onmouseout="out('6217106455110130996');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 144       SingleThreadTask task = (SingleThreadTask) mTask.get(i);                                           </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 145       if (task != null) {                                                                                </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146         task.stop();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 148     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 149   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 150                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 151   /**                                                                                                    </span>
<span class="8538662619258057049" onmouseenter="enter('8538662619258057049');" onmouseout="out('8538662619258057049');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 152    * 删除下载记录文件                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 153    */                                                                                                    </span>
<span class="-6348491485207421588" onmouseenter="enter('-6348491485207421588');" onmouseout="out('-6348491485207421588');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 154   @Override public void delConfigFile() {                                                                </span>
<span class="8558402344038566367" onmouseenter="enter('8558402344038566367');" onmouseout="out('8558402344038566367');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 155     if (mContext != null &amp;&amp; mDownloadEntity != null) {                                                   </span>
<span class="3099781541276521660" onmouseenter="enter('3099781541276521660');" onmouseout="out('3099781541276521660');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 156       File dFile = new File(mDownloadEntity.getDownloadPath());                                          </span>
<span class="-1217451156974226618" onmouseenter="enter('-1217451156974226618');" onmouseout="out('-1217451156974226618');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 157       File config =                                                                                      </span>
<span class="1777202063354625193" onmouseenter="enter('1777202063354625193');" onmouseout="out('1777202063354625193');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 158           new File(mContext.getFilesDir().getPath() + &quot;/temp/&quot; + dFile.getName() + &quot;.properties&quot;);       </span>
<span class="-7696478919602418443" onmouseenter="enter('-7696478919602418443');" onmouseout="out('-7696478919602418443');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 159       if (config.exists()) {                                                                             </span>
<span class="-5702358031910949081" onmouseenter="enter('-5702358031910949081');" onmouseout="out('-5702358031910949081');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 160         config.delete();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 161       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 163   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 164                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 165   /**                                                                                                    </span>
<span class="-8312193682087493639" onmouseenter="enter('-8312193682087493639');" onmouseout="out('-8312193682087493639');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166    * 删除temp文件                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 167    */                                                                                                    </span>
<span class="7655331082892594561" onmouseenter="enter('7655331082892594561');" onmouseout="out('7655331082892594561');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 168   @Override public void delTempFile() {                                                                  </span>
<span class="8558402344038566367" onmouseenter="enter('8558402344038566367');" onmouseout="out('8558402344038566367');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 169     if (mContext != null &amp;&amp; mDownloadEntity != null) {                                                   </span>
<span class="3099781541276521660" onmouseenter="enter('3099781541276521660');" onmouseout="out('3099781541276521660');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170       File dFile = new File(mDownloadEntity.getDownloadPath());                                          </span>
<span class="7897717398420259974" onmouseenter="enter('7897717398420259974');" onmouseout="out('7897717398420259974');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 171       if (dFile.exists()) {                                                                              </span>
<span class="7527345290446588408" onmouseenter="enter('7527345290446588408');" onmouseout="out('7527345290446588408');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 172         dFile.delete();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 173       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 175   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 176                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 177   /**                                                                                                    </span>
<span class="-5727215122052088545" onmouseenter="enter('-5727215122052088545');" onmouseout="out('-5727215122052088545');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 178    * 多线程断点续传下载文件，开始下载                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 179    */                                                                                                    </span>
<span class="-4856178778199245062" onmouseenter="enter('-4856178778199245062');" onmouseout="out('-4856178778199245062');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 180   @Override public void startDownload() {                                                                </span>
<span class="898408935389387935" onmouseenter="enter('898408935389387935');" onmouseout="out('898408935389387935');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 181     mConstance.cleanState();                                                                             </span>
<span class="2099174989180368882" onmouseenter="enter('2099174989180368882');" onmouseout="out('2099174989180368882');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 182     mListener.onPre();                                                                                   </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 183     new Thread(this).start();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 184   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 185                                                                                                          </span>
<span class="-5762688668558425600" onmouseenter="enter('-5762688668558425600');" onmouseout="out('-5762688668558425600');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 186   @Override public void resumeDownload() {                                                               </span>
<span class="1497820413888703615" onmouseenter="enter('1497820413888703615');" onmouseout="out('1497820413888703615');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 187     startDownload();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 188   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 189                                                                                                          </span>
<span class="8306009172830771261" onmouseenter="enter('8306009172830771261');" onmouseout="out('8306009172830771261');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 190   private void failDownload(String msg) {                                                                </span>
<span class="-6647758959009774834" onmouseenter="enter('-6647758959009774834');" onmouseout="out('-6647758959009774834');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 191     Log.e(TAG, msg);                                                                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 192     mConstance.isDownloading = false;                                                                    </span>
<span class="-6715929234808926893" onmouseenter="enter('-6715929234808926893');" onmouseout="out('-6715929234808926893');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 193     stopDownload();                                                                                      </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 194     mListener.onFail();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 195   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 196                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 197   @Override public void run() {                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 198     try {                                                                                                </span>
<span class="5483634401908283016" onmouseenter="enter('5483634401908283016');" onmouseout="out('5483634401908283016');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 199       URL url = new URL(mDownloadEntity.getDownloadUrl());                                               </span>
<span class="-6008953795197858884" onmouseenter="enter('-6008953795197858884');" onmouseout="out('-6008953795197858884');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 200       HttpURLConnection conn = ConnectionHelp.handleConnection(url);                                     </span>
<span class="2062133901627510982" onmouseenter="enter('2062133901627510982');" onmouseout="out('2062133901627510982');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 201       conn = ConnectionHelp.setConnectParam(conn);                                                       </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 202       conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                              </span>
<span class="-3579311541579934971" onmouseenter="enter('-3579311541579934971');" onmouseout="out('-3579311541579934971');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 203       conn.setConnectTimeout(mConnectTimeOut * 4);                                                       </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 204       conn.connect();                                                                                    </span>
<span class="6567575788372053568" onmouseenter="enter('6567575788372053568');" onmouseout="out('6567575788372053568');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 205       int len = conn.getContentLength();                                                                 </span>
<span class="3904365852949278245" onmouseenter="enter('3904365852949278245');" onmouseout="out('3904365852949278245');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 206       //if (len &lt; 0) {  //网络被劫持时会出现这个问题                                                                  </span>
<span class="835324676499837078" onmouseenter="enter('835324676499837078');" onmouseout="out('835324676499837078');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 207       //  failDownload(&quot;下载失败，网络被劫持&quot;);                                                                    </span>
<span class="3500611444781325819" onmouseenter="enter('3500611444781325819');" onmouseout="out('3500611444781325819');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 208       //  return;                                                                                        </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 209       //}                                                                                                </span>
<span class="-5653376755036700146" onmouseenter="enter('-5653376755036700146');" onmouseout="out('-5653376755036700146');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 210       int code = conn.getResponseCode();                                                                 </span>
<span class="999254544547719885" onmouseenter="enter('999254544547719885');" onmouseout="out('999254544547719885');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 211       //https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81                                    </span>
<span class="-8703603538857387010" onmouseenter="enter('-8703603538857387010');" onmouseout="out('-8703603538857387010');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 212       //206支持断点                                                                                          </span>
<span class="5260656878663172399" onmouseenter="enter('5260656878663172399');" onmouseout="out('5260656878663172399');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 213       if (code == HttpURLConnection.HTTP_PARTIAL) {                                                      </span>
<span class="-4850747580721370850" onmouseenter="enter('-4850747580721370850');" onmouseout="out('-4850747580721370850');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 214         isSupportBreakpoint = true;                                                                      </span>
<span class="1256350564434583014" onmouseenter="enter('1256350564434583014');" onmouseout="out('1256350564434583014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 215         mListener.supportBreakpoint(true);                                                               </span>
<span class="-7366273742365769169" onmouseenter="enter('-7366273742365769169');" onmouseout="out('-7366273742365769169');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 216         handleBreakpoint(conn);                                                                          </span>
<span class="877851589237632825" onmouseenter="enter('877851589237632825');" onmouseout="out('877851589237632825');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 217       } else if (code == HttpURLConnection.HTTP_OK || len &lt; 0) {                                         </span>
<span class="-5840271675092361063" onmouseenter="enter('-5840271675092361063');" onmouseout="out('-5840271675092361063');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 218         //在conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);下，200为不支持断点状态                            </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 219         if (len &lt; 0) {                                                                                   </span>
<span class="9025825393004184595" onmouseenter="enter('9025825393004184595');" onmouseout="out('9025825393004184595');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 220           failDownload(&quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，文件长度小于0&quot;);                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 221           return;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 222         }                                                                                                </span>
<span class="5451458949060440820" onmouseenter="enter('5451458949060440820');" onmouseout="out('5451458949060440820');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 223         isSupportBreakpoint = false;                                                                     </span>
<span class="3223278567209587987" onmouseenter="enter('3223278567209587987');" onmouseout="out('3223278567209587987');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 224         mListener.supportBreakpoint(false);                                                              </span>
<span class="-3209038805792969148" onmouseenter="enter('-3209038805792969148');" onmouseout="out('-3209038805792969148');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 225         Log.w(TAG, &quot;该下载链接不支持断点下载&quot;);                                                                      </span>
<span class="-7366273742365769169" onmouseenter="enter('-7366273742365769169');" onmouseout="out('-7366273742365769169');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 226         handleBreakpoint(conn);                                                                          </span>
<span class="1848064821034278655" onmouseenter="enter('1848064821034278655');" onmouseout="out('1848064821034278655');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 227       } else if (code == HttpURLConnection.HTTP_NOT_FOUND) {                                             </span>
<span class="6854071059109338334" onmouseenter="enter('6854071059109338334');" onmouseout="out('6854071059109338334');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 228         Log.w(TAG, &quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，错误码：404&quot;);                          </span>
<span class="7504588834379816638" onmouseenter="enter('7504588834379816638');" onmouseout="out('7504588834379816638');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 229         //mListener.onCancel();                                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 230       } else {                                                                                           </span>
<span class="9116772185344886324" onmouseenter="enter('9116772185344886324');" onmouseout="out('9116772185344886324');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 231         failDownload(&quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，错误码：&quot; + code);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 232       }                                                                                                  </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 233     } catch (IOException e) {                                                                            </span>
<span class="7015103282251076587" onmouseenter="enter('7015103282251076587');" onmouseout="out('7015103282251076587');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 234       failDownload(&quot;下载失败【downloadUrl:&quot;                                                                   </span>
<span class="5951112113295803501" onmouseenter="enter('5951112113295803501');" onmouseout="out('5951112113295803501');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 235           + mDownloadEntity.getDownloadUrl()                                                             </span>
<span class="910868662350755341" onmouseenter="enter('910868662350755341');" onmouseout="out('910868662350755341');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 236           + &quot;】\n【filePath:&quot;                                                                              </span>
<span class="5931171797063415443" onmouseenter="enter('5931171797063415443');" onmouseout="out('5931171797063415443');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 237           + mDownloadFile.getPath()                                                                      </span>
<span class="-1840319934610193149" onmouseenter="enter('-1840319934610193149');" onmouseout="out('-1840319934610193149');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 238           + &quot;】&quot;                                                                                          </span>
<span class="-5371623624849066023" onmouseenter="enter('-5371623624849066023');" onmouseout="out('-5371623624849066023');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 239           + CommonUtil.getPrintException(e));                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 240     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 241   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 242                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 243   /**                                                                                                    </span>
<span class="-2887709646015060517" onmouseenter="enter('-2887709646015060517');" onmouseout="out('-2887709646015060517');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 244    * 处理断点                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 245    */                                                                                                    </span>
<span class="-1770943272374407595" onmouseenter="enter('-1770943272374407595');" onmouseout="out('-1770943272374407595');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 246   private void handleBreakpoint(HttpURLConnection conn) throws IOException {                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 247                                                                                                          </span>
<span class="7477238500582408106" onmouseenter="enter('7477238500582408106');" onmouseout="out('7477238500582408106');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 248     //不支持断点只能单线程下载                                                                                       </span>
<span class="-6722781002220970553" onmouseenter="enter('-6722781002220970553');" onmouseout="out('-6722781002220970553');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 249     if (!isSupportBreakpoint) {                                                                          </span>
<span class="-8481066330390671660" onmouseenter="enter('-8481066330390671660');" onmouseout="out('-8481066330390671660');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 250       ConfigEntity entity = new ConfigEntity();                                                          </span>
<span class="2550533377201046915" onmouseenter="enter('2550533377201046915');" onmouseout="out('2550533377201046915');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 251       long len = conn.getContentLength();;                                                               </span>
<span class="3256260393357377684" onmouseenter="enter('3256260393357377684');" onmouseout="out('3256260393357377684');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 252       entity.FILE_SIZE = len;                                                                            </span>
<span class="4189357201157412201" onmouseenter="enter('4189357201157412201');" onmouseout="out('4189357201157412201');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 253       entity.DOWNLOAD_URL = mDownloadEntity.getDownloadUrl();                                            </span>
<span class="1175511499700324517" onmouseenter="enter('1175511499700324517');" onmouseout="out('1175511499700324517');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 254       entity.TEMP_FILE = mDownloadFile;                                                                  </span>
<span class="-1353085718172399938" onmouseenter="enter('-1353085718172399938');" onmouseout="out('-1353085718172399938');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 255       entity.THREAD_ID = 0;                                                                              </span>
<span class="-4967231089338870782" onmouseenter="enter('-4967231089338870782');" onmouseout="out('-4967231089338870782');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 256       entity.START_LOCATION = 0;                                                                         </span>
<span class="4365950116387297475" onmouseenter="enter('4365950116387297475');" onmouseout="out('4365950116387297475');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 257       entity.END_LOCATION = entity.FILE_SIZE;                                                            </span>
<span class="-7848202009707844875" onmouseenter="enter('-7848202009707844875');" onmouseout="out('-7848202009707844875');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 258       entity.CONFIG_FILE_PATH = mConfigFile.getPath();                                                   </span>
<span class="2812036997657153043" onmouseenter="enter('2812036997657153043');" onmouseout="out('2812036997657153043');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 259       entity.isSupportBreakpoint = isSupportBreakpoint;                                                  </span>
<span class="4531885195650702733" onmouseenter="enter('4531885195650702733');" onmouseout="out('4531885195650702733');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 260       SingleThreadTask task = new SingleThreadTask(mConstance, mListener, entity);                       </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 261       mFixedThreadPool.execute(task);                                                                    </span>
<span class="1947759044939991847" onmouseenter="enter('1947759044939991847');" onmouseout="out('1947759044939991847');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 262       mListener.onPostPre(len);                                                                          </span>
<span class="-2943780714290472761" onmouseenter="enter('-2943780714290472761');" onmouseout="out('-2943780714290472761');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 263       mListener.onStart(0);                                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 264       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 265     }                                                                                                    </span>
<span class="-4144971478129188538" onmouseenter="enter('-4144971478129188538');" onmouseout="out('-4144971478129188538');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 266     int fileLength = conn.getContentLength();                                                            </span>
<span class="-3771769896201867631" onmouseenter="enter('-3771769896201867631');" onmouseout="out('-3771769896201867631');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 267     //必须建一个文件                                                                                            </span>
<span class="-8241179119122160888" onmouseenter="enter('-8241179119122160888');" onmouseout="out('-8241179119122160888');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 268     CommonUtil.createFile(mDownloadFile.getPath());                                                      </span>
<span class="-7635395723744199382" onmouseenter="enter('-7635395723744199382');" onmouseout="out('-7635395723744199382');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 269     //RandomAccessFile file = new RandomAccessFile(mDownloadFile.getPath(), &quot;rwd&quot;);                      </span>
<span class="-900329094809807646" onmouseenter="enter('-900329094809807646');" onmouseout="out('-900329094809807646');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 270     ////设置文件长度                                                                                           </span>
<span class="-756775849470659960" onmouseenter="enter('-756775849470659960');" onmouseout="out('-756775849470659960');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 271     //file.setLength(fileLength);                                                                        </span>
<span class="2674353001121820528" onmouseenter="enter('2674353001121820528');" onmouseout="out('2674353001121820528');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 272     BufferedRandomAccessFile file =                                                                      </span>
<span class="-2608299971259814762" onmouseenter="enter('-2608299971259814762');" onmouseout="out('-2608299971259814762');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 273         new BufferedRandomAccessFile(mDownloadFile.getPath(), &quot;rwd&quot;, 8192);                              </span>
<span class="-564508951971497574" onmouseenter="enter('-564508951971497574');" onmouseout="out('-564508951971497574');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 274     //设置文件长度                                                                                             </span>
<span class="6023690204241765206" onmouseenter="enter('6023690204241765206');" onmouseout="out('6023690204241765206');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 275     file.setLength(fileLength);                                                                          </span>
<span class="5666806310833670603" onmouseenter="enter('5666806310833670603');" onmouseout="out('5666806310833670603');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 276     mListener.onPostPre(fileLength);                                                                     </span>
<span class="6024675825413521783" onmouseenter="enter('6024675825413521783');" onmouseout="out('6024675825413521783');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 277     //分配每条线程的下载区间                                                                                        </span>
<span class="-317662916418562024" onmouseenter="enter('-317662916418562024');" onmouseout="out('-317662916418562024');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 278     Properties pro = null;                                                                               </span>
<span class="4467713772376842471" onmouseenter="enter('4467713772376842471');" onmouseout="out('4467713772376842471');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 279     pro = CommonUtil.loadConfig(mConfigFile);                                                            </span>
<span class="-681137634566379888" onmouseenter="enter('-681137634566379888');" onmouseout="out('-681137634566379888');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 280     if (pro.isEmpty()) {                                                                                 </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 281       isNewTask = true;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 282     } else {                                                                                             </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 283       for (int i = 0; i &lt; THREAD_NUM; i++) {                                                             </span>
<span class="-6973645922135466911" onmouseenter="enter('-6973645922135466911');" onmouseout="out('-6973645922135466911');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 284         if (pro.getProperty(mDownloadFile.getName() + &quot;_record_&quot; + i) == null) {                         </span>
<span class="1178951043321657234" onmouseenter="enter('1178951043321657234');" onmouseout="out('1178951043321657234');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 285           Object state = pro.getProperty(mDownloadFile.getName() + &quot;_state_&quot; + i);                       </span>
<span class="-2092430839348453245" onmouseenter="enter('-2092430839348453245');" onmouseout="out('-2092430839348453245');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 286           if (state != null &amp;&amp; Integer.parseInt(state + &quot;&quot;) == 1) {                                      </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 287             continue;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 288           }                                                                                              </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 289           isNewTask = true;                                                                              </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 290           break;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 291         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 292       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 293     }                                                                                                    </span>
<span class="-1643854653241583074" onmouseenter="enter('-1643854653241583074');" onmouseout="out('-1643854653241583074');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 294     int blockSize = fileLength / THREAD_NUM;                                                             </span>
<span class="866019335924650779" onmouseenter="enter('866019335924650779');" onmouseout="out('866019335924650779');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 295     int[] recordL = new int[THREAD_NUM];                                                                 </span>
<span class="794844889575716346" onmouseenter="enter('794844889575716346');" onmouseout="out('794844889575716346');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 296     int rl = 0;                                                                                          </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 297     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="8242320341463399828" onmouseenter="enter('8242320341463399828');" onmouseout="out('8242320341463399828');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 298       recordL[i] = -1;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 299     }                                                                                                    </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 300     for (int i = 0; i &lt; THREAD_NUM; i++) {                                                               </span>
<span class="-2965725495076654490" onmouseenter="enter('-2965725495076654490');" onmouseout="out('-2965725495076654490');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 301       long startL = i * blockSize, endL = (i + 1) * blockSize;                                           </span>
<span class="1178951043321657234" onmouseenter="enter('1178951043321657234');" onmouseout="out('1178951043321657234');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 302       Object state = pro.getProperty(mDownloadFile.getName() + &quot;_state_&quot; + i);                           </span>
<span class="2419725940883839935" onmouseenter="enter('2419725940883839935');" onmouseout="out('2419725940883839935');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 303       if (state != null &amp;&amp; Integer.parseInt(state + &quot;&quot;) == 1) {  //该线程已经完成                               </span>
<span class="8742170387731029623" onmouseenter="enter('8742170387731029623');" onmouseout="out('8742170387731029623');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 304         mConstance.CURRENT_LOCATION += endL - startL;                                                    </span>
<span class="7342592738960136820" onmouseenter="enter('7342592738960136820');" onmouseout="out('7342592738960136820');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 305         Log.d(TAG, &quot;++++++++++ 线程_&quot; + i + &quot;_已经下载完成 ++++++++++&quot;);                                         </span>
<span class="-337774801975969950" onmouseenter="enter('-337774801975969950');" onmouseout="out('-337774801975969950');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 306         mConstance.COMPLETE_THREAD_NUM++;                                                                </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 307         mConstance.STOP_NUM++;                                                                           </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 308         mConstance.CANCEL_NUM++;                                                                         </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 309         if (mConstance.isComplete()) {                                                                   </span>
<span class="4951157766975006439" onmouseenter="enter('4951157766975006439');" onmouseout="out('4951157766975006439');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 310           if (mConfigFile.exists()) {                                                                    </span>
<span class="-8106518526167482323" onmouseenter="enter('-8106518526167482323');" onmouseout="out('-8106518526167482323');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 311             mConfigFile.delete();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 312           }                                                                                              </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 313           mListener.onComplete();                                                                        </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 314           mConstance.isDownloading = false;                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 315           return;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 316         }                                                                                                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 317         continue;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 318       }                                                                                                  </span>
<span class="-1793454279264850881" onmouseenter="enter('-1793454279264850881');" onmouseout="out('-1793454279264850881');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 319       //分配下载位置                                                                                           </span>
<span class="-8200484973700844224" onmouseenter="enter('-8200484973700844224');" onmouseout="out('-8200484973700844224');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 320       Object record = pro.getProperty(mDownloadFile.getName() + &quot;_record_&quot; + i);                         </span>
<span class="-4606277471232235328" onmouseenter="enter('-4606277471232235328');" onmouseout="out('-4606277471232235328');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 321       //如果有记录，则恢复下载                                                                                      </span>
<span class="9081430961250736769" onmouseenter="enter('9081430961250736769');" onmouseout="out('9081430961250736769');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 322       if (!isNewTask &amp;&amp; record != null &amp;&amp; Long.parseLong(record + &quot;&quot;) &gt; 0) {                             </span>
<span class="8647082033828497822" onmouseenter="enter('8647082033828497822');" onmouseout="out('8647082033828497822');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 323         Long r = Long.parseLong(record + &quot;&quot;);                                                            </span>
<span class="1683054574044455381" onmouseenter="enter('1683054574044455381');" onmouseout="out('1683054574044455381');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 324         mConstance.CURRENT_LOCATION += r - startL;                                                       </span>
<span class="179733331572927392" onmouseenter="enter('179733331572927392');" onmouseout="out('179733331572927392');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 325         Log.d(TAG, &quot;++++++++++ 线程_&quot; + i + &quot;_恢复下载 ++++++++++&quot;);                                           </span>
<span class="6939461797319425642" onmouseenter="enter('6939461797319425642');" onmouseout="out('6939461797319425642');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 326         mListener.onChildResume(r);                                                                      </span>
<span class="1542845345888554533" onmouseenter="enter('1542845345888554533');" onmouseout="out('1542845345888554533');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 327         startL = r;                                                                                      </span>
<span class="-7425711498405631322" onmouseenter="enter('-7425711498405631322');" onmouseout="out('-7425711498405631322');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 328         recordL[rl] = i;                                                                                 </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 329         rl++;                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 330       } else {                                                                                           </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 331         isNewTask = true;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 332       }                                                                                                  </span>
<span class="537230916062757449" onmouseenter="enter('537230916062757449');" onmouseout="out('537230916062757449');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 333       if (isNewTask) {                                                                                   </span>
<span class="-7425711498405631322" onmouseenter="enter('-7425711498405631322');" onmouseout="out('-7425711498405631322');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 334         recordL[rl] = i;                                                                                 </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 335         rl++;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 336       }                                                                                                  </span>
<span class="-3400889980578220125" onmouseenter="enter('-3400889980578220125');" onmouseout="out('-3400889980578220125');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 337       if (i == (THREAD_NUM - 1)) {                                                                       </span>
<span class="-7423751213765432972" onmouseenter="enter('-7423751213765432972');" onmouseout="out('-7423751213765432972');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 338         //如果整个文件的大小不为线程个数的整数倍，则最后一个线程的结束位置即为文件的总长度                                                       </span>
<span class="-2829184075463306484" onmouseenter="enter('-2829184075463306484');" onmouseout="out('-2829184075463306484');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 339         endL = fileLength;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 340       }                                                                                                  </span>
<span class="-8481066330390671660" onmouseenter="enter('-8481066330390671660');" onmouseout="out('-8481066330390671660');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 341       ConfigEntity entity = new ConfigEntity();                                                          </span>
<span class="-3119684513187648029" onmouseenter="enter('-3119684513187648029');" onmouseout="out('-3119684513187648029');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 342       entity.FILE_SIZE = fileLength;                                                                     </span>
<span class="4189357201157412201" onmouseenter="enter('4189357201157412201');" onmouseout="out('4189357201157412201');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 343       entity.DOWNLOAD_URL = mDownloadEntity.getDownloadUrl();                                            </span>
<span class="1175511499700324517" onmouseenter="enter('1175511499700324517');" onmouseout="out('1175511499700324517');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 344       entity.TEMP_FILE = mDownloadFile;                                                                  </span>
<span class="-1808458878368858692" onmouseenter="enter('-1808458878368858692');" onmouseout="out('-1808458878368858692');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 345       entity.THREAD_ID = i;                                                                              </span>
<span class="6661292811999012973" onmouseenter="enter('6661292811999012973');" onmouseout="out('6661292811999012973');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 346       entity.START_LOCATION = startL;                                                                    </span>
<span class="8656472587238389131" onmouseenter="enter('8656472587238389131');" onmouseout="out('8656472587238389131');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 347       entity.END_LOCATION = endL;                                                                        </span>
<span class="-7848202009707844875" onmouseenter="enter('-7848202009707844875');" onmouseout="out('-7848202009707844875');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 348       entity.CONFIG_FILE_PATH = mConfigFile.getPath();                                                   </span>
<span class="2812036997657153043" onmouseenter="enter('2812036997657153043');" onmouseout="out('2812036997657153043');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 349       entity.isSupportBreakpoint = isSupportBreakpoint;                                                  </span>
<span class="4531885195650702733" onmouseenter="enter('4531885195650702733');" onmouseout="out('4531885195650702733');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 350       SingleThreadTask task = new SingleThreadTask(mConstance, mListener, entity);                       </span>
<span class="-6012810893938815399" onmouseenter="enter('-6012810893938815399');" onmouseout="out('-6012810893938815399');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 351       mTask.put(i, task);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 352     }                                                                                                    </span>
<span class="-1061602448343886008" onmouseenter="enter('-1061602448343886008');" onmouseout="out('-1061602448343886008');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 353     if (mConstance.CURRENT_LOCATION &gt; 0) {                                                               </span>
<span class="5187035189520501266" onmouseenter="enter('5187035189520501266');" onmouseout="out('5187035189520501266');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 354       mListener.onResume(mConstance.CURRENT_LOCATION);                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 355     } else {                                                                                             </span>
<span class="-2973471902048685805" onmouseenter="enter('-2973471902048685805');" onmouseout="out('-2973471902048685805');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 356       mListener.onStart(mConstance.CURRENT_LOCATION);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 357     }                                                                                                    </span>
<span class="1243235571055153612" onmouseenter="enter('1243235571055153612');" onmouseout="out('1243235571055153612');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 358     for (int l : recordL) {                                                                              </span>
<span class="-7510837703317171619" onmouseenter="enter('-7510837703317171619');" onmouseout="out('-7510837703317171619');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 359       if (l == -1) continue;                                                                             </span>
<span class="-85915337091278441" onmouseenter="enter('-85915337091278441');" onmouseout="out('-85915337091278441');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 360       Runnable task = mTask.get(l);                                                                      </span>
<span class="-7327661534177463737" onmouseenter="enter('-7327661534177463737');" onmouseout="out('-7327661534177463737');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 361       if (task != null &amp;&amp; !mFixedThreadPool.isShutdown()) {                                              </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 362         mFixedThreadPool.execute(task);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 363       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 364     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 365   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 366                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 367   /**                                                                                                    </span>
<span class="2585942053451624927" onmouseenter="enter('2585942053451624927');" onmouseout="out('2585942053451624927');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 368    * 子线程下载信息类                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 369    */                                                                                                    </span>
<span class="-3850188489545087742" onmouseenter="enter('-3850188489545087742');" onmouseout="out('-3850188489545087742');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 370   final static class ConfigEntity {                                                                      </span>
<span class="-403498804051257270" onmouseenter="enter('-403498804051257270');" onmouseout="out('-403498804051257270');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 371     //文件大小                                                                                               </span>
<span class="541475241289655650" onmouseenter="enter('541475241289655650');" onmouseout="out('541475241289655650');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 372     long FILE_SIZE;                                                                                      </span>
<span class="-4736398418022593572" onmouseenter="enter('-4736398418022593572');" onmouseout="out('-4736398418022593572');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 373     String DOWNLOAD_URL;                                                                                 </span>
<span class="-7368464316865211776" onmouseenter="enter('-7368464316865211776');" onmouseout="out('-7368464316865211776');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 374     int THREAD_ID;                                                                                       </span>
<span class="3260682776668453255" onmouseenter="enter('3260682776668453255');" onmouseout="out('3260682776668453255');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 375     long START_LOCATION;                                                                                 </span>
<span class="2446069397877689758" onmouseenter="enter('2446069397877689758');" onmouseout="out('2446069397877689758');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 376     long END_LOCATION;                                                                                   </span>
<span class="4104096962052364503" onmouseenter="enter('4104096962052364503');" onmouseout="out('4104096962052364503');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 377     File TEMP_FILE;                                                                                      </span>
<span class="-2017423643980728828" onmouseenter="enter('-2017423643980728828');" onmouseout="out('-2017423643980728828');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 378     boolean isSupportBreakpoint = true;                                                                  </span>
<span class="-2943683475239618057" onmouseenter="enter('-2943683475239618057');" onmouseout="out('-2943683475239618057');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 379     String CONFIG_FILE_PATH;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 380   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 381 }                                                                                                        </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 382 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 383 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 383 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 384 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 385                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 386 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>














































































































































































































































































































































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span  style="">  16                                                                                                                    </span>
<span class="-1768704711895145311" onmouseenter="enter('-1768704711895145311');" onmouseout="out('-1768704711895145311');" style="">  17  package com.arialyy.aria.core.task;                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  19  import android.content.Context;                                                                                   </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  20  import android.util.Log;                                                                                          </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  21  import android.util.SparseArray;                                                                                  </span>
<span class="-8446909004143589790" onmouseenter="enter('-8446909004143589790');" onmouseout="out('-8446909004143589790');" style="">  22  import com.arialyy.aria.core.DownloadEntity;                                                                      </span>
<span class="-1661010561836341583" onmouseenter="enter('-1661010561836341583');" onmouseout="out('-1661010561836341583');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  23 +import com.arialyy.aria.util.BufferedRandomAccessFile;                                                            </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="">  24  import com.arialyy.aria.util.CommonUtil;                                                                          </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  25  import java.io.File;                                                                                              </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  26  import java.io.IOException;                                                                                       </span>
<span class="-3877933607611446246" onmouseenter="enter('-3877933607611446246');" onmouseout="out('-3877933607611446246');" style="">  27  import java.io.RandomAccessFile;                                                                                  </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="">  28  import java.net.HttpURLConnection;                                                                                </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="">  29  import java.net.URL;                                                                                              </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="">  30  import java.util.Properties;                                                                                      </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  31  import java.util.concurrent.ExecutorService;                                                                      </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  32  import java.util.concurrent.Executors;                                                                            </span>
<span  style="">  33                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  34  /**                                                                                                               </span>
<span class="2363292981682035173" onmouseenter="enter('2363292981682035173');" onmouseout="out('2363292981682035173');" style="">  35   * Created by lyy on 2015/8/25.                                                                                   </span>
<span class="-8257115403302511340" onmouseenter="enter('-8257115403302511340');" onmouseout="out('-8257115403302511340');" style="">  36   * 下载工具类                                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  37   */                                                                                                               </span>
<span class="1048428507777314273" onmouseenter="enter('1048428507777314273');" onmouseout="out('1048428507777314273');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  38 -final class DownloadUtil implements IDownloadUtil, Runnable {                                                     </span>
<span class="2282207299880186426" onmouseenter="enter('2282207299880186426');" onmouseout="out('2282207299880186426');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  39 +public class DownloadUtil implements IDownloadUtil, Runnable {                                                    </span>
<span class="1261799266044613591" onmouseenter="enter('1261799266044613591');" onmouseout="out('1261799266044613591');" style="">  40    private static final String TAG = &quot;DownloadUtil&quot;;                                                               </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  41    /**                                                                                                             </span>
<span class="-8352985751663047055" onmouseenter="enter('-8352985751663047055');" onmouseout="out('-8352985751663047055');" style="">  42     * 线程数                                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  43     */                                                                                                             </span>
<span class="-7983967545860957599" onmouseenter="enter('-7983967545860957599');" onmouseout="out('-7983967545860957599');" style="">  44    private final int THREAD_NUM;                                                                                   </span>
<span class="-785681239530372348" onmouseenter="enter('-785681239530372348');" onmouseout="out('-785681239530372348');" style="">  45    //下载监听                                                                                                          </span>
<span class="8085369704814778285" onmouseenter="enter('8085369704814778285');" onmouseout="out('8085369704814778285');" style="">  46    private IDownloadListener mListener;                                                                            </span>
<span class="8993221121586487711" onmouseenter="enter('8993221121586487711');" onmouseout="out('8993221121586487711');" style="">  47    private int mConnectTimeOut = 5000 * 4; //连接超时时间                                                                </span>
<span class="4023537183138169002" onmouseenter="enter('4023537183138169002');" onmouseout="out('4023537183138169002');" style="">  48    private int mReadTimeOut = 5000 * 20; //流读取的超时时间                                                                </span>
<span class="-1157942250762320951" onmouseenter="enter('-1157942250762320951');" onmouseout="out('-1157942250762320951');" style="">  49    private boolean isNewTask = true;                                                                               </span>
<span class="-7348064306101585897" onmouseenter="enter('-7348064306101585897');" onmouseout="out('-7348064306101585897');" style="">  50    private boolean isSupportBreakpoint = true;                                                                     </span>
<span class="6683852815807951473" onmouseenter="enter('6683852815807951473');" onmouseout="out('6683852815807951473');" style="">  51    private Context mContext;                                                                                       </span>
<span class="-4114987623877824308" onmouseenter="enter('-4114987623877824308');" onmouseout="out('-4114987623877824308');" style="">  52    private DownloadEntity mDownloadEntity;                                                                         </span>
<span class="1058453114158093994" onmouseenter="enter('1058453114158093994');" onmouseout="out('1058453114158093994');" style="">  53    private ExecutorService mFixedThreadPool;                                                                       </span>
<span class="-1133559474859202897" onmouseenter="enter('-1133559474859202897');" onmouseout="out('-1133559474859202897');" style="">  54    private File mDownloadFile; //下载的文件                                                                             </span>
<span class="7861940189151317235" onmouseenter="enter('7861940189151317235');" onmouseout="out('7861940189151317235');" style="">  55    private File mConfigFile;//下载信息配置文件                                                                             </span>
<span class="-3869960521609686448" onmouseenter="enter('-3869960521609686448');" onmouseout="out('-3869960521609686448');" style="">  56    private SparseArray&lt;Runnable&gt; mTask = new SparseArray&lt;&gt;();                                                      </span>
<span class="7070628333292412283" onmouseenter="enter('7070628333292412283');" onmouseout="out('7070628333292412283');" style="">  57    private DownloadStateConstance mConstance;                                                                      </span>
<span  style="">  58                                                                                                                    </span>
<span class="-2084839900540753927" onmouseenter="enter('-2084839900540753927');" onmouseout="out('-2084839900540753927');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  59 -  DownloadUtil(Context context, DownloadEntity entity, IDownloadListener downloadListener) {                      </span>
<span class="-6554670557683360136" onmouseenter="enter('-6554670557683360136');" onmouseout="out('-6554670557683360136');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  60 +  public DownloadUtil(Context context, DownloadEntity entity, IDownloadListener downloadListener) {               </span>
<span class="-4896597165635236478" onmouseenter="enter('-4896597165635236478');" onmouseout="out('-4896597165635236478');" style="">  61      this(context, entity, downloadListener, 3);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  62    }                                                                                                               </span>
<span  style="">  63                                                                                                                    </span>
<span class="-4986291938704783923" onmouseenter="enter('-4986291938704783923');" onmouseout="out('-4986291938704783923');" style="">  64    DownloadUtil(Context context, DownloadEntity entity, IDownloadListener downloadListener,                        </span>
<span class="-8984238530475947621" onmouseenter="enter('-8984238530475947621');" onmouseout="out('-8984238530475947621');" style="">  65        int threadNum) {                                                                                            </span>
<span class="-673106209130372223" onmouseenter="enter('-673106209130372223');" onmouseout="out('-673106209130372223');" style="">  66      mContext = context.getApplicationContext();                                                                   </span>
<span class="-216605200672599564" onmouseenter="enter('-216605200672599564');" onmouseout="out('-216605200672599564');" style="">  67      mDownloadEntity = entity;                                                                                     </span>
<span class="3831466484862340223" onmouseenter="enter('3831466484862340223');" onmouseout="out('3831466484862340223');" style="">  68      mListener = downloadListener;                                                                                 </span>
<span class="-6579794148103748852" onmouseenter="enter('-6579794148103748852');" onmouseout="out('-6579794148103748852');" style="">  69      THREAD_NUM = threadNum;                                                                                       </span>
<span class="-7335968387740294445" onmouseenter="enter('-7335968387740294445');" onmouseout="out('-7335968387740294445');" style="">  70      mFixedThreadPool = Executors.newFixedThreadPool(Integer.MAX_VALUE);                                           </span>
<span class="2824360841323512384" onmouseenter="enter('2824360841323512384');" onmouseout="out('2824360841323512384');" style="">  71      mConstance = new DownloadStateConstance(THREAD_NUM);                                                          </span>
<span class="-1498726564668589193" onmouseenter="enter('-1498726564668589193');" onmouseout="out('-1498726564668589193');" style="">  72      init();                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  73    }                                                                                                               </span>
<span  style="">  74                                                                                                                    </span>
<span class="-909562594025196126" onmouseenter="enter('-909562594025196126');" onmouseout="out('-909562594025196126');" style="">  75    private void init() {                                                                                           </span>
<span class="-8302516119393797134" onmouseenter="enter('-8302516119393797134');" onmouseout="out('-8302516119393797134');" style="">  76      mDownloadFile = new File(mDownloadEntity.getDownloadPath());                                                  </span>
<span class="-3534953052494864097" onmouseenter="enter('-3534953052494864097');" onmouseout="out('-3534953052494864097');" style="">  77      //读取已完成的线程数                                                                                                   </span>
<span class="-9053998435552088983" onmouseenter="enter('-9053998435552088983');" onmouseout="out('-9053998435552088983');" style="">  78      mConfigFile = new File(                                                                                       </span>
<span class="-3948838928069897094" onmouseenter="enter('-3948838928069897094');" onmouseout="out('-3948838928069897094');" style="">  79          mContext.getFilesDir().getPath() + &quot;/temp/&quot; + mDownloadFile.getName() + &quot;.properties&quot;);                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  80      try {                                                                                                         </span>
<span class="7925700052565713558" onmouseenter="enter('7925700052565713558');" onmouseout="out('7925700052565713558');" style="">  81        if (!mConfigFile.exists()) { //记录文件被删除，则重新下载                                                                </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="">  82          isNewTask = true;                                                                                         </span>
<span class="1838885973573966413" onmouseenter="enter('1838885973573966413');" onmouseout="out('1838885973573966413');" style="">  83          CommonUtil.createFile(mConfigFile.getPath());                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  84        } else {                                                                                                    </span>
<span class="-6296621072689899390" onmouseenter="enter('-6296621072689899390');" onmouseout="out('-6296621072689899390');" style="">  85          isNewTask = !mDownloadFile.exists();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  86        }                                                                                                           </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="">  87      } catch (Exception e) {                                                                                       </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="">  88        e.printStackTrace();                                                                                        </span>
<span class="-3747169937451325082" onmouseenter="enter('-3747169937451325082');" onmouseout="out('-3747169937451325082');" style="">  89        failDownload(&quot;下载失败，记录文件被删除&quot;);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91    }                                                                                                               </span>
<span  style="">  92                                                                                                                    </span>
<span class="-8585626151911369157" onmouseenter="enter('-8585626151911369157');" onmouseout="out('-8585626151911369157');" style="">  93    public IDownloadListener getListener() {                                                                        </span>
<span class="-7037258027690597516" onmouseenter="enter('-7037258027690597516');" onmouseout="out('-7037258027690597516');" style="">  94      return mListener;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  95    }                                                                                                               </span>
<span  style="">  96                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  97    /**                                                                                                             </span>
<span class="6936487890332430093" onmouseenter="enter('6936487890332430093');" onmouseout="out('6936487890332430093');" style="">  98     * 设置连接超时时间                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  99     */                                                                                                             </span>
<span class="8269350745377988793" onmouseenter="enter('8269350745377988793');" onmouseout="out('8269350745377988793');" style=""> 100    public void setConnectTimeOut(int timeOut) {                                                                    </span>
<span class="7491344361160646490" onmouseenter="enter('7491344361160646490');" onmouseout="out('7491344361160646490');" style=""> 101      mConnectTimeOut = timeOut;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102    }                                                                                                               </span>
<span  style=""> 103                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 104    /**                                                                                                             </span>
<span class="1793189252207234639" onmouseenter="enter('1793189252207234639');" onmouseout="out('1793189252207234639');" style=""> 105     * 设置流读取的超时时间                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 106     */                                                                                                             </span>
<span class="-4265144949210493065" onmouseenter="enter('-4265144949210493065');" onmouseout="out('-4265144949210493065');" style=""> 107    public void setReadTimeOut(int readTimeOut) {                                                                   </span>
<span class="-3349186980434336657" onmouseenter="enter('-3349186980434336657');" onmouseout="out('-3349186980434336657');" style=""> 108      mReadTimeOut = readTimeOut;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 109    }                                                                                                               </span>
<span  style=""> 110                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 111    /**                                                                                                             </span>
<span class="6025979389427346334" onmouseenter="enter('6025979389427346334');" onmouseout="out('6025979389427346334');" style=""> 112     * 获取当前下载位置                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 113     */                                                                                                             </span>
<span class="42588745782017963" onmouseenter="enter('42588745782017963');" onmouseout="out('42588745782017963');" style=""> 114    @Override public long getCurrentLocation() {                                                                    </span>
<span class="2881215542099369319" onmouseenter="enter('2881215542099369319');" onmouseout="out('2881215542099369319');" style=""> 115      return mConstance.CURRENT_LOCATION;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116    }                                                                                                               </span>
<span  style=""> 117                                                                                                                    </span>
<span class="8514823861416132786" onmouseenter="enter('8514823861416132786');" onmouseout="out('8514823861416132786');" style=""> 118    @Override public boolean isDownloading() {                                                                      </span>
<span class="-2560940912314579274" onmouseenter="enter('-2560940912314579274');" onmouseout="out('-2560940912314579274');" style=""> 119      return mConstance.isDownloading;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 120    }                                                                                                               </span>
<span  style=""> 121                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 122    /**                                                                                                             </span>
<span class="8520049766391668792" onmouseenter="enter('8520049766391668792');" onmouseout="out('8520049766391668792');" style=""> 123     * 取消下载                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 124     */                                                                                                             </span>
<span class="8518544268347342740" onmouseenter="enter('8518544268347342740');" onmouseout="out('8518544268347342740');" style=""> 125    @Override public void cancelDownload() {                                                                        </span>
<span class="204250319841071761" onmouseenter="enter('204250319841071761');" onmouseout="out('204250319841071761');" style=""> 126      mConstance.isCancel = true;                                                                                   </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style=""> 127      mConstance.isDownloading = false;                                                                             </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style=""> 128      mFixedThreadPool.shutdown();                                                                                  </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style=""> 129      for (int i = 0; i &lt; THREAD_NUM; i++) {                                                                        </span>
<span class="6217106455110130996" onmouseenter="enter('6217106455110130996');" onmouseout="out('6217106455110130996');" style=""> 130        SingleThreadTask task = (SingleThreadTask) mTask.get(i);                                                    </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 131        if (task != null) {                                                                                         </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style=""> 132          task.cancel();                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135    }                                                                                                               </span>
<span  style=""> 136                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 137    /**                                                                                                             </span>
<span class="7755328866638560569" onmouseenter="enter('7755328866638560569');" onmouseout="out('7755328866638560569');" style=""> 138     * 停止下载                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 139     */                                                                                                             </span>
<span class="-4596234023078912379" onmouseenter="enter('-4596234023078912379');" onmouseout="out('-4596234023078912379');" style=""> 140    @Override public void stopDownload() {                                                                          </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style=""> 141      mConstance.isStop = true;                                                                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style=""> 142      mConstance.isDownloading = false;                                                                             </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style=""> 143      mFixedThreadPool.shutdown();                                                                                  </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style=""> 144      for (int i = 0; i &lt; THREAD_NUM; i++) {                                                                        </span>
<span class="6217106455110130996" onmouseenter="enter('6217106455110130996');" onmouseout="out('6217106455110130996');" style=""> 145        SingleThreadTask task = (SingleThreadTask) mTask.get(i);                                                    </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 146        if (task != null) {                                                                                         </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style=""> 147          task.stop();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 149      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 150    }                                                                                                               </span>
<span  style=""> 151                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 152    /**                                                                                                             </span>
<span class="8538662619258057049" onmouseenter="enter('8538662619258057049');" onmouseout="out('8538662619258057049');" style=""> 153     * 删除下载记录文件                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 154     */                                                                                                             </span>
<span class="-6348491485207421588" onmouseenter="enter('-6348491485207421588');" onmouseout="out('-6348491485207421588');" style=""> 155    @Override public void delConfigFile() {                                                                         </span>
<span class="8558402344038566367" onmouseenter="enter('8558402344038566367');" onmouseout="out('8558402344038566367');" style=""> 156      if (mContext != null &amp;&amp; mDownloadEntity != null) {                                                            </span>
<span class="3099781541276521660" onmouseenter="enter('3099781541276521660');" onmouseout="out('3099781541276521660');" style=""> 157        File dFile = new File(mDownloadEntity.getDownloadPath());                                                   </span>
<span class="-1217451156974226618" onmouseenter="enter('-1217451156974226618');" onmouseout="out('-1217451156974226618');" style=""> 158        File config =                                                                                               </span>
<span class="1777202063354625193" onmouseenter="enter('1777202063354625193');" onmouseout="out('1777202063354625193');" style=""> 159            new File(mContext.getFilesDir().getPath() + &quot;/temp/&quot; + dFile.getName() + &quot;.properties&quot;);                </span>
<span class="-7696478919602418443" onmouseenter="enter('-7696478919602418443');" onmouseout="out('-7696478919602418443');" style=""> 160        if (config.exists()) {                                                                                      </span>
<span class="-5702358031910949081" onmouseenter="enter('-5702358031910949081');" onmouseout="out('-5702358031910949081');" style=""> 161          config.delete();                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164    }                                                                                                               </span>
<span  style=""> 165                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 166    /**                                                                                                             </span>
<span class="-8312193682087493639" onmouseenter="enter('-8312193682087493639');" onmouseout="out('-8312193682087493639');" style=""> 167     * 删除temp文件                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 168     */                                                                                                             </span>
<span class="7655331082892594561" onmouseenter="enter('7655331082892594561');" onmouseout="out('7655331082892594561');" style=""> 169    @Override public void delTempFile() {                                                                           </span>
<span class="8558402344038566367" onmouseenter="enter('8558402344038566367');" onmouseout="out('8558402344038566367');" style=""> 170      if (mContext != null &amp;&amp; mDownloadEntity != null) {                                                            </span>
<span class="3099781541276521660" onmouseenter="enter('3099781541276521660');" onmouseout="out('3099781541276521660');" style=""> 171        File dFile = new File(mDownloadEntity.getDownloadPath());                                                   </span>
<span class="7897717398420259974" onmouseenter="enter('7897717398420259974');" onmouseout="out('7897717398420259974');" style=""> 172        if (dFile.exists()) {                                                                                       </span>
<span class="7527345290446588408" onmouseenter="enter('7527345290446588408');" onmouseout="out('7527345290446588408');" style=""> 173          dFile.delete();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176    }                                                                                                               </span>
<span  style=""> 177                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 178    /**                                                                                                             </span>
<span class="-5727215122052088545" onmouseenter="enter('-5727215122052088545');" onmouseout="out('-5727215122052088545');" style=""> 179     * 多线程断点续传下载文件，开始下载                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 180     */                                                                                                             </span>
<span class="-4856178778199245062" onmouseenter="enter('-4856178778199245062');" onmouseout="out('-4856178778199245062');" style=""> 181    @Override public void startDownload() {                                                                         </span>
<span class="898408935389387935" onmouseenter="enter('898408935389387935');" onmouseout="out('898408935389387935');" style=""> 182      mConstance.cleanState();                                                                                      </span>
<span class="2099174989180368882" onmouseenter="enter('2099174989180368882');" onmouseout="out('2099174989180368882');" style=""> 183      mListener.onPre();                                                                                            </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style=""> 184      new Thread(this).start();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185    }                                                                                                               </span>
<span  style=""> 186                                                                                                                    </span>
<span class="-5762688668558425600" onmouseenter="enter('-5762688668558425600');" onmouseout="out('-5762688668558425600');" style=""> 187    @Override public void resumeDownload() {                                                                        </span>
<span class="1497820413888703615" onmouseenter="enter('1497820413888703615');" onmouseout="out('1497820413888703615');" style=""> 188      startDownload();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189    }                                                                                                               </span>
<span  style=""> 190                                                                                                                    </span>
<span class="8306009172830771261" onmouseenter="enter('8306009172830771261');" onmouseout="out('8306009172830771261');" style=""> 191    private void failDownload(String msg) {                                                                         </span>
<span class="-6647758959009774834" onmouseenter="enter('-6647758959009774834');" onmouseout="out('-6647758959009774834');" style=""> 192      Log.e(TAG, msg);                                                                                              </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style=""> 193      mConstance.isDownloading = false;                                                                             </span>
<span class="-6715929234808926893" onmouseenter="enter('-6715929234808926893');" onmouseout="out('-6715929234808926893');" style=""> 194      stopDownload();                                                                                               </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style=""> 195      mListener.onFail();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196    }                                                                                                               </span>
<span  style=""> 197                                                                                                                    </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 198    @Override public void run() {                                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 199      try {                                                                                                         </span>
<span class="5483634401908283016" onmouseenter="enter('5483634401908283016');" onmouseout="out('5483634401908283016');" style=""> 200        URL url = new URL(mDownloadEntity.getDownloadUrl());                                                        </span>
<span class="-6008953795197858884" onmouseenter="enter('-6008953795197858884');" onmouseout="out('-6008953795197858884');" style=""> 201        HttpURLConnection conn = ConnectionHelp.handleConnection(url);                                              </span>
<span class="2062133901627510982" onmouseenter="enter('2062133901627510982');" onmouseout="out('2062133901627510982');" style=""> 202        conn = ConnectionHelp.setConnectParam(conn);                                                                </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style=""> 203        conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                                       </span>
<span class="-3579311541579934971" onmouseenter="enter('-3579311541579934971');" onmouseout="out('-3579311541579934971');" style=""> 204        conn.setConnectTimeout(mConnectTimeOut * 4);                                                                </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style=""> 205        conn.connect();                                                                                             </span>
<span class="6567575788372053568" onmouseenter="enter('6567575788372053568');" onmouseout="out('6567575788372053568');" style=""> 206        int len = conn.getContentLength();                                                                          </span>
<span class="3904365852949278245" onmouseenter="enter('3904365852949278245');" onmouseout="out('3904365852949278245');" style=""> 207        //if (len &lt; 0) {  //网络被劫持时会出现这个问题                                                                           </span>
<span class="835324676499837078" onmouseenter="enter('835324676499837078');" onmouseout="out('835324676499837078');" style=""> 208        //  failDownload(&quot;下载失败，网络被劫持&quot;);                                                                             </span>
<span class="3500611444781325819" onmouseenter="enter('3500611444781325819');" onmouseout="out('3500611444781325819');" style=""> 209        //  return;                                                                                                 </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style=""> 210        //}                                                                                                         </span>
<span class="-5653376755036700146" onmouseenter="enter('-5653376755036700146');" onmouseout="out('-5653376755036700146');" style=""> 211        int code = conn.getResponseCode();                                                                          </span>
<span class="999254544547719885" onmouseenter="enter('999254544547719885');" onmouseout="out('999254544547719885');" style=""> 212        //https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81                                             </span>
<span class="-8703603538857387010" onmouseenter="enter('-8703603538857387010');" onmouseout="out('-8703603538857387010');" style=""> 213        //206支持断点                                                                                                   </span>
<span class="5260656878663172399" onmouseenter="enter('5260656878663172399');" onmouseout="out('5260656878663172399');" style=""> 214        if (code == HttpURLConnection.HTTP_PARTIAL) {                                                               </span>
<span class="-4850747580721370850" onmouseenter="enter('-4850747580721370850');" onmouseout="out('-4850747580721370850');" style=""> 215          isSupportBreakpoint = true;                                                                               </span>
<span class="1256350564434583014" onmouseenter="enter('1256350564434583014');" onmouseout="out('1256350564434583014');" style=""> 216          mListener.supportBreakpoint(true);                                                                        </span>
<span class="-7366273742365769169" onmouseenter="enter('-7366273742365769169');" onmouseout="out('-7366273742365769169');" style=""> 217          handleBreakpoint(conn);                                                                                   </span>
<span class="877851589237632825" onmouseenter="enter('877851589237632825');" onmouseout="out('877851589237632825');" style=""> 218        } else if (code == HttpURLConnection.HTTP_OK || len &lt; 0) {                                                  </span>
<span class="-5840271675092361063" onmouseenter="enter('-5840271675092361063');" onmouseout="out('-5840271675092361063');" style=""> 219          //在conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);下，200为不支持断点状态                                     </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style=""> 220          if (len &lt; 0) {                                                                                            </span>
<span class="9025825393004184595" onmouseenter="enter('9025825393004184595');" onmouseout="out('9025825393004184595');" style=""> 221            failDownload(&quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，文件长度小于0&quot;);                               </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 222            return;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223          }                                                                                                         </span>
<span class="5451458949060440820" onmouseenter="enter('5451458949060440820');" onmouseout="out('5451458949060440820');" style=""> 224          isSupportBreakpoint = false;                                                                              </span>
<span class="3223278567209587987" onmouseenter="enter('3223278567209587987');" onmouseout="out('3223278567209587987');" style=""> 225          mListener.supportBreakpoint(false);                                                                       </span>
<span class="-3209038805792969148" onmouseenter="enter('-3209038805792969148');" onmouseout="out('-3209038805792969148');" style=""> 226          Log.w(TAG, &quot;该下载链接不支持断点下载&quot;);                                                                               </span>
<span class="-7366273742365769169" onmouseenter="enter('-7366273742365769169');" onmouseout="out('-7366273742365769169');" style=""> 227          handleBreakpoint(conn);                                                                                   </span>
<span class="1848064821034278655" onmouseenter="enter('1848064821034278655');" onmouseout="out('1848064821034278655');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 228 +      } else if (code == HttpURLConnection.HTTP_NOT_FOUND) {                                                      </span>
<span class="6854071059109338334" onmouseenter="enter('6854071059109338334');" onmouseout="out('6854071059109338334');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 229 +        Log.w(TAG, &quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，错误码：404&quot;);                                   </span>
<span class="7504588834379816638" onmouseenter="enter('7504588834379816638');" onmouseout="out('7504588834379816638');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 230 +        //mListener.onCancel();                                                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 231        } else {                                                                                                    </span>
<span class="3429592426515613091" onmouseenter="enter('3429592426515613091');" onmouseout="out('3429592426515613091');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 232 -        failDownload(&quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，返回码：&quot; + code);                             </span>
<span class="9116772185344886324" onmouseenter="enter('9116772185344886324');" onmouseout="out('9116772185344886324');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 233 +        failDownload(&quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，错误码：&quot; + code);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234        }                                                                                                           </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 235      } catch (IOException e) {                                                                                     </span>
<span class="7015103282251076587" onmouseenter="enter('7015103282251076587');" onmouseout="out('7015103282251076587');" style=""> 236        failDownload(&quot;下载失败【downloadUrl:&quot;                                                                            </span>
<span class="5951112113295803501" onmouseenter="enter('5951112113295803501');" onmouseout="out('5951112113295803501');" style=""> 237            + mDownloadEntity.getDownloadUrl()                                                                      </span>
<span class="910868662350755341" onmouseenter="enter('910868662350755341');" onmouseout="out('910868662350755341');" style=""> 238            + &quot;】\n【filePath:&quot;                                                                                       </span>
<span class="5931171797063415443" onmouseenter="enter('5931171797063415443');" onmouseout="out('5931171797063415443');" style=""> 239            + mDownloadFile.getPath()                                                                               </span>
<span class="-1840319934610193149" onmouseenter="enter('-1840319934610193149');" onmouseout="out('-1840319934610193149');" style=""> 240            + &quot;】&quot;                                                                                                   </span>
<span class="-5371623624849066023" onmouseenter="enter('-5371623624849066023');" onmouseout="out('-5371623624849066023');" style=""> 241            + CommonUtil.getPrintException(e));                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243    }                                                                                                               </span>
<span  style=""> 244                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 245    /**                                                                                                             </span>
<span class="-2887709646015060517" onmouseenter="enter('-2887709646015060517');" onmouseout="out('-2887709646015060517');" style=""> 246     * 处理断点                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 247     */                                                                                                             </span>
<span class="-1770943272374407595" onmouseenter="enter('-1770943272374407595');" onmouseout="out('-1770943272374407595');" style=""> 248    private void handleBreakpoint(HttpURLConnection conn) throws IOException {                                      </span>
<span  style=""> 249                                                                                                                    </span>
<span class="7477238500582408106" onmouseenter="enter('7477238500582408106');" onmouseout="out('7477238500582408106');" style=""> 250      //不支持断点只能单线程下载                                                                                                </span>
<span class="-6722781002220970553" onmouseenter="enter('-6722781002220970553');" onmouseout="out('-6722781002220970553');" style=""> 251      if (!isSupportBreakpoint) {                                                                                   </span>
<span class="-8481066330390671660" onmouseenter="enter('-8481066330390671660');" onmouseout="out('-8481066330390671660');" style=""> 252        ConfigEntity entity = new ConfigEntity();                                                                   </span>
<span class="9125695722945677869" onmouseenter="enter('9125695722945677869');" onmouseout="out('9125695722945677869');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 253 -      entity.FILE_SIZE = conn.getContentLength();                                                                 </span>
<span class="2550533377201046915" onmouseenter="enter('2550533377201046915');" onmouseout="out('2550533377201046915');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 254 +      long len = conn.getContentLength();;                                                                        </span>
<span class="3256260393357377684" onmouseenter="enter('3256260393357377684');" onmouseout="out('3256260393357377684');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 255 +      entity.FILE_SIZE = len;                                                                                     </span>
<span class="4189357201157412201" onmouseenter="enter('4189357201157412201');" onmouseout="out('4189357201157412201');" style=""> 256        entity.DOWNLOAD_URL = mDownloadEntity.getDownloadUrl();                                                     </span>
<span class="1175511499700324517" onmouseenter="enter('1175511499700324517');" onmouseout="out('1175511499700324517');" style=""> 257        entity.TEMP_FILE = mDownloadFile;                                                                           </span>
<span class="-1353085718172399938" onmouseenter="enter('-1353085718172399938');" onmouseout="out('-1353085718172399938');" style=""> 258        entity.THREAD_ID = 0;                                                                                       </span>
<span class="-4967231089338870782" onmouseenter="enter('-4967231089338870782');" onmouseout="out('-4967231089338870782');" style=""> 259        entity.START_LOCATION = 0;                                                                                  </span>
<span class="4365950116387297475" onmouseenter="enter('4365950116387297475');" onmouseout="out('4365950116387297475');" style=""> 260        entity.END_LOCATION = entity.FILE_SIZE;                                                                     </span>
<span class="-7848202009707844875" onmouseenter="enter('-7848202009707844875');" onmouseout="out('-7848202009707844875');" style=""> 261        entity.CONFIG_FILE_PATH = mConfigFile.getPath();                                                            </span>
<span class="2812036997657153043" onmouseenter="enter('2812036997657153043');" onmouseout="out('2812036997657153043');" style=""> 262        entity.isSupportBreakpoint = isSupportBreakpoint;                                                           </span>
<span class="4531885195650702733" onmouseenter="enter('4531885195650702733');" onmouseout="out('4531885195650702733');" style=""> 263        SingleThreadTask task = new SingleThreadTask(mConstance, mListener, entity);                                </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style=""> 264        mFixedThreadPool.execute(task);                                                                             </span>
<span class="1947759044939991847" onmouseenter="enter('1947759044939991847');" onmouseout="out('1947759044939991847');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 265 +      mListener.onPostPre(len);                                                                                   </span>
<span class="-2943780714290472761" onmouseenter="enter('-2943780714290472761');" onmouseout="out('-2943780714290472761');" style=""> 266        mListener.onStart(0);                                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 267        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268      }                                                                                                             </span>
<span class="-4144971478129188538" onmouseenter="enter('-4144971478129188538');" onmouseout="out('-4144971478129188538');" style=""> 269      int fileLength = conn.getContentLength();                                                                     </span>
<span class="-3771769896201867631" onmouseenter="enter('-3771769896201867631');" onmouseout="out('-3771769896201867631');" style=""> 270      //必须建一个文件                                                                                                     </span>
<span class="-8241179119122160888" onmouseenter="enter('-8241179119122160888');" onmouseout="out('-8241179119122160888');" style=""> 271      CommonUtil.createFile(mDownloadFile.getPath());                                                               </span>
<span class="-844126738551985064" onmouseenter="enter('-844126738551985064');" onmouseout="out('-844126738551985064');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 272 -    RandomAccessFile file = new RandomAccessFile(mDownloadFile.getPath(), &quot;rwd&quot;);                                 </span>
<span class="-7635395723744199382" onmouseenter="enter('-7635395723744199382');" onmouseout="out('-7635395723744199382');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 273 +    //RandomAccessFile file = new RandomAccessFile(mDownloadFile.getPath(), &quot;rwd&quot;);                               </span>
<span class="-900329094809807646" onmouseenter="enter('-900329094809807646');" onmouseout="out('-900329094809807646');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 274 +    ////设置文件长度                                                                                                    </span>
<span class="-756775849470659960" onmouseenter="enter('-756775849470659960');" onmouseout="out('-756775849470659960');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 275 +    //file.setLength(fileLength);                                                                                 </span>
<span class="2674353001121820528" onmouseenter="enter('2674353001121820528');" onmouseout="out('2674353001121820528');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 276 +    BufferedRandomAccessFile file =                                                                               </span>
<span class="-2608299971259814762" onmouseenter="enter('-2608299971259814762');" onmouseout="out('-2608299971259814762');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 277 +        new BufferedRandomAccessFile(mDownloadFile.getPath(), &quot;rwd&quot;, 8192);                                       </span>
<span class="-564508951971497574" onmouseenter="enter('-564508951971497574');" onmouseout="out('-564508951971497574');" style=""> 278      //设置文件长度                                                                                                      </span>
<span class="6023690204241765206" onmouseenter="enter('6023690204241765206');" onmouseout="out('6023690204241765206');" style=""> 279      file.setLength(fileLength);                                                                                   </span>
<span class="5666806310833670603" onmouseenter="enter('5666806310833670603');" onmouseout="out('5666806310833670603');" style=""> 280      mListener.onPostPre(fileLength);                                                                              </span>
<span class="6024675825413521783" onmouseenter="enter('6024675825413521783');" onmouseout="out('6024675825413521783');" style=""> 281      //分配每条线程的下载区间                                                                                                 </span>
<span class="-317662916418562024" onmouseenter="enter('-317662916418562024');" onmouseout="out('-317662916418562024');" style=""> 282      Properties pro = null;                                                                                        </span>
<span class="4467713772376842471" onmouseenter="enter('4467713772376842471');" onmouseout="out('4467713772376842471');" style=""> 283      pro = CommonUtil.loadConfig(mConfigFile);                                                                     </span>
<span class="-681137634566379888" onmouseenter="enter('-681137634566379888');" onmouseout="out('-681137634566379888');" style=""> 284      if (pro.isEmpty()) {                                                                                          </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style=""> 285        isNewTask = true;                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 286      } else {                                                                                                      </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style=""> 287        for (int i = 0; i &lt; THREAD_NUM; i++) {                                                                      </span>
<span class="-6973645922135466911" onmouseenter="enter('-6973645922135466911');" onmouseout="out('-6973645922135466911');" style=""> 288          if (pro.getProperty(mDownloadFile.getName() + &quot;_record_&quot; + i) == null) {                                  </span>
<span class="1178951043321657234" onmouseenter="enter('1178951043321657234');" onmouseout="out('1178951043321657234');" style=""> 289            Object state = pro.getProperty(mDownloadFile.getName() + &quot;_state_&quot; + i);                                </span>
<span class="-2092430839348453245" onmouseenter="enter('-2092430839348453245');" onmouseout="out('-2092430839348453245');" style=""> 290            if (state != null &amp;&amp; Integer.parseInt(state + &quot;&quot;) == 1) {                                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 291              continue;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292            }                                                                                                       </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style=""> 293            isNewTask = true;                                                                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 294            break;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297      }                                                                                                             </span>
<span class="-1643854653241583074" onmouseenter="enter('-1643854653241583074');" onmouseout="out('-1643854653241583074');" style=""> 298      int blockSize = fileLength / THREAD_NUM;                                                                      </span>
<span class="866019335924650779" onmouseenter="enter('866019335924650779');" onmouseout="out('866019335924650779');" style=""> 299      int[] recordL = new int[THREAD_NUM];                                                                          </span>
<span class="794844889575716346" onmouseenter="enter('794844889575716346');" onmouseout="out('794844889575716346');" style=""> 300      int rl = 0;                                                                                                   </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style=""> 301      for (int i = 0; i &lt; THREAD_NUM; i++) {                                                                        </span>
<span class="8242320341463399828" onmouseenter="enter('8242320341463399828');" onmouseout="out('8242320341463399828');" style=""> 302        recordL[i] = -1;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303      }                                                                                                             </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style=""> 304      for (int i = 0; i &lt; THREAD_NUM; i++) {                                                                        </span>
<span class="-2965725495076654490" onmouseenter="enter('-2965725495076654490');" onmouseout="out('-2965725495076654490');" style=""> 305        long startL = i * blockSize, endL = (i + 1) * blockSize;                                                    </span>
<span class="1178951043321657234" onmouseenter="enter('1178951043321657234');" onmouseout="out('1178951043321657234');" style=""> 306        Object state = pro.getProperty(mDownloadFile.getName() + &quot;_state_&quot; + i);                                    </span>
<span class="2419725940883839935" onmouseenter="enter('2419725940883839935');" onmouseout="out('2419725940883839935');" style=""> 307        if (state != null &amp;&amp; Integer.parseInt(state + &quot;&quot;) == 1) {  //该线程已经完成                                        </span>
<span class="8742170387731029623" onmouseenter="enter('8742170387731029623');" onmouseout="out('8742170387731029623');" style=""> 308          mConstance.CURRENT_LOCATION += endL - startL;                                                             </span>
<span class="7342592738960136820" onmouseenter="enter('7342592738960136820');" onmouseout="out('7342592738960136820');" style=""> 309          Log.d(TAG, &quot;++++++++++ 线程_&quot; + i + &quot;_已经下载完成 ++++++++++&quot;);                                                  </span>
<span class="-337774801975969950" onmouseenter="enter('-337774801975969950');" onmouseout="out('-337774801975969950');" style=""> 310          mConstance.COMPLETE_THREAD_NUM++;                                                                         </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style=""> 311          mConstance.STOP_NUM++;                                                                                    </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style=""> 312          mConstance.CANCEL_NUM++;                                                                                  </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style=""> 313          if (mConstance.isComplete()) {                                                                            </span>
<span class="4951157766975006439" onmouseenter="enter('4951157766975006439');" onmouseout="out('4951157766975006439');" style=""> 314            if (mConfigFile.exists()) {                                                                             </span>
<span class="-8106518526167482323" onmouseenter="enter('-8106518526167482323');" onmouseout="out('-8106518526167482323');" style=""> 315              mConfigFile.delete();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316            }                                                                                                       </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 317            mListener.onComplete();                                                                                 </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style=""> 318            mConstance.isDownloading = false;                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 319            return;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320          }                                                                                                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 321          continue;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322        }                                                                                                           </span>
<span class="-1793454279264850881" onmouseenter="enter('-1793454279264850881');" onmouseout="out('-1793454279264850881');" style=""> 323        //分配下载位置                                                                                                    </span>
<span class="-8200484973700844224" onmouseenter="enter('-8200484973700844224');" onmouseout="out('-8200484973700844224');" style=""> 324        Object record = pro.getProperty(mDownloadFile.getName() + &quot;_record_&quot; + i);                                  </span>
<span class="-4606277471232235328" onmouseenter="enter('-4606277471232235328');" onmouseout="out('-4606277471232235328');" style=""> 325        //如果有记录，则恢复下载                                                                                               </span>
<span class="9081430961250736769" onmouseenter="enter('9081430961250736769');" onmouseout="out('9081430961250736769');" style=""> 326        if (!isNewTask &amp;&amp; record != null &amp;&amp; Long.parseLong(record + &quot;&quot;) &gt; 0) {                                      </span>
<span class="8647082033828497822" onmouseenter="enter('8647082033828497822');" onmouseout="out('8647082033828497822');" style=""> 327          Long r = Long.parseLong(record + &quot;&quot;);                                                                     </span>
<span class="1683054574044455381" onmouseenter="enter('1683054574044455381');" onmouseout="out('1683054574044455381');" style=""> 328          mConstance.CURRENT_LOCATION += r - startL;                                                                </span>
<span class="179733331572927392" onmouseenter="enter('179733331572927392');" onmouseout="out('179733331572927392');" style=""> 329          Log.d(TAG, &quot;++++++++++ 线程_&quot; + i + &quot;_恢复下载 ++++++++++&quot;);                                                    </span>
<span class="6939461797319425642" onmouseenter="enter('6939461797319425642');" onmouseout="out('6939461797319425642');" style=""> 330          mListener.onChildResume(r);                                                                               </span>
<span class="1542845345888554533" onmouseenter="enter('1542845345888554533');" onmouseout="out('1542845345888554533');" style=""> 331          startL = r;                                                                                               </span>
<span class="-7425711498405631322" onmouseenter="enter('-7425711498405631322');" onmouseout="out('-7425711498405631322');" style=""> 332          recordL[rl] = i;                                                                                          </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style=""> 333          rl++;                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 334        } else {                                                                                                    </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style=""> 335          isNewTask = true;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336        }                                                                                                           </span>
<span class="537230916062757449" onmouseenter="enter('537230916062757449');" onmouseout="out('537230916062757449');" style=""> 337        if (isNewTask) {                                                                                            </span>
<span class="-7425711498405631322" onmouseenter="enter('-7425711498405631322');" onmouseout="out('-7425711498405631322');" style=""> 338          recordL[rl] = i;                                                                                          </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style=""> 339          rl++;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340        }                                                                                                           </span>
<span class="-3400889980578220125" onmouseenter="enter('-3400889980578220125');" onmouseout="out('-3400889980578220125');" style=""> 341        if (i == (THREAD_NUM - 1)) {                                                                                </span>
<span class="-7423751213765432972" onmouseenter="enter('-7423751213765432972');" onmouseout="out('-7423751213765432972');" style=""> 342          //如果整个文件的大小不为线程个数的整数倍，则最后一个线程的结束位置即为文件的总长度                                                                </span>
<span class="-2829184075463306484" onmouseenter="enter('-2829184075463306484');" onmouseout="out('-2829184075463306484');" style=""> 343          endL = fileLength;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 344        }                                                                                                           </span>
<span class="-8481066330390671660" onmouseenter="enter('-8481066330390671660');" onmouseout="out('-8481066330390671660');" style=""> 345        ConfigEntity entity = new ConfigEntity();                                                                   </span>
<span class="-3119684513187648029" onmouseenter="enter('-3119684513187648029');" onmouseout="out('-3119684513187648029');" style=""> 346        entity.FILE_SIZE = fileLength;                                                                              </span>
<span class="4189357201157412201" onmouseenter="enter('4189357201157412201');" onmouseout="out('4189357201157412201');" style=""> 347        entity.DOWNLOAD_URL = mDownloadEntity.getDownloadUrl();                                                     </span>
<span class="1175511499700324517" onmouseenter="enter('1175511499700324517');" onmouseout="out('1175511499700324517');" style=""> 348        entity.TEMP_FILE = mDownloadFile;                                                                           </span>
<span class="-1808458878368858692" onmouseenter="enter('-1808458878368858692');" onmouseout="out('-1808458878368858692');" style=""> 349        entity.THREAD_ID = i;                                                                                       </span>
<span class="6661292811999012973" onmouseenter="enter('6661292811999012973');" onmouseout="out('6661292811999012973');" style=""> 350        entity.START_LOCATION = startL;                                                                             </span>
<span class="8656472587238389131" onmouseenter="enter('8656472587238389131');" onmouseout="out('8656472587238389131');" style=""> 351        entity.END_LOCATION = endL;                                                                                 </span>
<span class="-7848202009707844875" onmouseenter="enter('-7848202009707844875');" onmouseout="out('-7848202009707844875');" style=""> 352        entity.CONFIG_FILE_PATH = mConfigFile.getPath();                                                            </span>
<span class="2812036997657153043" onmouseenter="enter('2812036997657153043');" onmouseout="out('2812036997657153043');" style=""> 353        entity.isSupportBreakpoint = isSupportBreakpoint;                                                           </span>
<span class="4531885195650702733" onmouseenter="enter('4531885195650702733');" onmouseout="out('4531885195650702733');" style=""> 354        SingleThreadTask task = new SingleThreadTask(mConstance, mListener, entity);                                </span>
<span class="-6012810893938815399" onmouseenter="enter('-6012810893938815399');" onmouseout="out('-6012810893938815399');" style=""> 355        mTask.put(i, task);                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356      }                                                                                                             </span>
<span class="-1061602448343886008" onmouseenter="enter('-1061602448343886008');" onmouseout="out('-1061602448343886008');" style=""> 357      if (mConstance.CURRENT_LOCATION &gt; 0) {                                                                        </span>
<span class="5187035189520501266" onmouseenter="enter('5187035189520501266');" onmouseout="out('5187035189520501266');" style=""> 358        mListener.onResume(mConstance.CURRENT_LOCATION);                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 359      } else {                                                                                                      </span>
<span class="-2973471902048685805" onmouseenter="enter('-2973471902048685805');" onmouseout="out('-2973471902048685805');" style=""> 360        mListener.onStart(mConstance.CURRENT_LOCATION);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 361      }                                                                                                             </span>
<span class="1243235571055153612" onmouseenter="enter('1243235571055153612');" onmouseout="out('1243235571055153612');" style=""> 362      for (int l : recordL) {                                                                                       </span>
<span class="-7510837703317171619" onmouseenter="enter('-7510837703317171619');" onmouseout="out('-7510837703317171619');" style=""> 363        if (l == -1) continue;                                                                                      </span>
<span class="-85915337091278441" onmouseenter="enter('-85915337091278441');" onmouseout="out('-85915337091278441');" style=""> 364        Runnable task = mTask.get(l);                                                                               </span>
<span class="-7327661534177463737" onmouseenter="enter('-7327661534177463737');" onmouseout="out('-7327661534177463737');" style=""> 365        if (task != null &amp;&amp; !mFixedThreadPool.isShutdown()) {                                                       </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style=""> 366          mFixedThreadPool.execute(task);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 368      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369    }                                                                                                               </span>
<span  style=""> 370                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 371    /**                                                                                                             </span>
<span class="2585942053451624927" onmouseenter="enter('2585942053451624927');" onmouseout="out('2585942053451624927');" style=""> 372     * 子线程下载信息类                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 373     */                                                                                                             </span>
<span class="-3850188489545087742" onmouseenter="enter('-3850188489545087742');" onmouseout="out('-3850188489545087742');" style=""> 374    final static class ConfigEntity {                                                                               </span>
<span class="-403498804051257270" onmouseenter="enter('-403498804051257270');" onmouseout="out('-403498804051257270');" style=""> 375      //文件大小                                                                                                        </span>
<span class="541475241289655650" onmouseenter="enter('541475241289655650');" onmouseout="out('541475241289655650');" style=""> 376      long FILE_SIZE;                                                                                               </span>
<span class="-4736398418022593572" onmouseenter="enter('-4736398418022593572');" onmouseout="out('-4736398418022593572');" style=""> 377      String DOWNLOAD_URL;                                                                                          </span>
<span class="-7368464316865211776" onmouseenter="enter('-7368464316865211776');" onmouseout="out('-7368464316865211776');" style=""> 378      int THREAD_ID;                                                                                                </span>
<span class="3260682776668453255" onmouseenter="enter('3260682776668453255');" onmouseout="out('3260682776668453255');" style=""> 379      long START_LOCATION;                                                                                          </span>
<span class="2446069397877689758" onmouseenter="enter('2446069397877689758');" onmouseout="out('2446069397877689758');" style=""> 380      long END_LOCATION;                                                                                            </span>
<span class="4104096962052364503" onmouseenter="enter('4104096962052364503');" onmouseout="out('4104096962052364503');" style=""> 381      File TEMP_FILE;                                                                                               </span>
<span class="-2017423643980728828" onmouseenter="enter('-2017423643980728828');" onmouseout="out('-2017423643980728828');" style=""> 382      boolean isSupportBreakpoint = true;                                                                           </span>
<span class="-2943683475239618057" onmouseenter="enter('-2943683475239618057');" onmouseout="out('-2943683475239618057');" style=""> 383      String CONFIG_FILE_PATH;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 384    }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   1 -/*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   2 - * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   3 - *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   4 - * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   5 - * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   6 - * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   7 - *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   8 - *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   9 - *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  10 - * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  11 - * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  12 - * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  13 - * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  14 - * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  15 - */                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  16 -                                                                                                                  </span>
<span class="-1768704711895145311" onmouseenter="enter('-1768704711895145311');" onmouseout="out('-1768704711895145311');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  17 -package com.arialyy.aria.core.task;                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  18 -                                                                                                                  </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  19 -import android.content.Context;                                                                                   </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  20 -import android.util.Log;                                                                                          </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  21 -import android.util.SparseArray;                                                                                  </span>
<span class="-8446909004143589790" onmouseenter="enter('-8446909004143589790');" onmouseout="out('-8446909004143589790');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  22 -import com.arialyy.aria.core.DownloadEntity;                                                                      </span>

<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  23 -import com.arialyy.aria.util.CommonUtil;                                                                          </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  24 -import java.io.File;                                                                                              </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  25 -import java.io.IOException;                                                                                       </span>
<span class="-3877933607611446246" onmouseenter="enter('-3877933607611446246');" onmouseout="out('-3877933607611446246');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  26 -import java.io.RandomAccessFile;                                                                                  </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  27 -import java.net.HttpURLConnection;                                                                                </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  28 -import java.net.URL;                                                                                              </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  29 -import java.util.Properties;                                                                                      </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  30 -import java.util.concurrent.ExecutorService;                                                                      </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  31 -import java.util.concurrent.Executors;                                                                            </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  32 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  33 -/**                                                                                                               </span>
<span class="2363292981682035173" onmouseenter="enter('2363292981682035173');" onmouseout="out('2363292981682035173');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  34 - * Created by lyy on 2015/8/25.                                                                                   </span>
<span class="-8257115403302511340" onmouseenter="enter('-8257115403302511340');" onmouseout="out('-8257115403302511340');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  35 - * 下载工具类                                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  36 - */                                                                                                               </span>
<span class="1048428507777314273" onmouseenter="enter('1048428507777314273');" onmouseout="out('1048428507777314273');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  37 -final class DownloadUtil implements IDownloadUtil, Runnable {                                                     </span>

<span class="1261799266044613591" onmouseenter="enter('1261799266044613591');" onmouseout="out('1261799266044613591');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  38 -  private static final String TAG = &quot;DownloadUtil&quot;;                                                               </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  39 -  /**                                                                                                             </span>
<span class="-8352985751663047055" onmouseenter="enter('-8352985751663047055');" onmouseout="out('-8352985751663047055');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  40 -   * 线程数                                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  41 -   */                                                                                                             </span>
<span class="-7983967545860957599" onmouseenter="enter('-7983967545860957599');" onmouseout="out('-7983967545860957599');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  42 -  private final int THREAD_NUM;                                                                                   </span>
<span class="-785681239530372348" onmouseenter="enter('-785681239530372348');" onmouseout="out('-785681239530372348');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  43 -  //下载监听                                                                                                          </span>
<span class="8085369704814778285" onmouseenter="enter('8085369704814778285');" onmouseout="out('8085369704814778285');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  44 -  private IDownloadListener mListener;                                                                            </span>
<span class="8993221121586487711" onmouseenter="enter('8993221121586487711');" onmouseout="out('8993221121586487711');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  45 -  private int mConnectTimeOut = 5000 * 4; //连接超时时间                                                                </span>
<span class="4023537183138169002" onmouseenter="enter('4023537183138169002');" onmouseout="out('4023537183138169002');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  46 -  private int mReadTimeOut = 5000 * 20; //流读取的超时时间                                                                </span>
<span class="-1157942250762320951" onmouseenter="enter('-1157942250762320951');" onmouseout="out('-1157942250762320951');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  47 -  private boolean isNewTask = true;                                                                               </span>
<span class="-7348064306101585897" onmouseenter="enter('-7348064306101585897');" onmouseout="out('-7348064306101585897');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  48 -  private boolean isSupportBreakpoint = true;                                                                     </span>
<span class="6683852815807951473" onmouseenter="enter('6683852815807951473');" onmouseout="out('6683852815807951473');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  49 -  private Context mContext;                                                                                       </span>
<span class="-4114987623877824308" onmouseenter="enter('-4114987623877824308');" onmouseout="out('-4114987623877824308');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  50 -  private DownloadEntity mDownloadEntity;                                                                         </span>
<span class="1058453114158093994" onmouseenter="enter('1058453114158093994');" onmouseout="out('1058453114158093994');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  51 -  private ExecutorService mFixedThreadPool;                                                                       </span>
<span class="-1133559474859202897" onmouseenter="enter('-1133559474859202897');" onmouseout="out('-1133559474859202897');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  52 -  private File mDownloadFile; //下载的文件                                                                             </span>
<span class="7861940189151317235" onmouseenter="enter('7861940189151317235');" onmouseout="out('7861940189151317235');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  53 -  private File mConfigFile;//下载信息配置文件                                                                             </span>
<span class="-3869960521609686448" onmouseenter="enter('-3869960521609686448');" onmouseout="out('-3869960521609686448');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  54 -  private SparseArray&lt;Runnable&gt; mTask = new SparseArray&lt;&gt;();                                                      </span>
<span class="7070628333292412283" onmouseenter="enter('7070628333292412283');" onmouseout="out('7070628333292412283');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  55 -  private DownloadStateConstance mConstance;                                                                      </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  56 -                                                                                                                  </span>
<span class="-2084839900540753927" onmouseenter="enter('-2084839900540753927');" onmouseout="out('-2084839900540753927');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  57 -  DownloadUtil(Context context, DownloadEntity entity, IDownloadListener downloadListener) {                      </span>

<span class="-4896597165635236478" onmouseenter="enter('-4896597165635236478');" onmouseout="out('-4896597165635236478');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  58 -    this(context, entity, downloadListener, 3);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  59 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  60 -                                                                                                                  </span>
<span class="-4986291938704783923" onmouseenter="enter('-4986291938704783923');" onmouseout="out('-4986291938704783923');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  61 -  DownloadUtil(Context context, DownloadEntity entity, IDownloadListener downloadListener,                        </span>
<span class="-8984238530475947621" onmouseenter="enter('-8984238530475947621');" onmouseout="out('-8984238530475947621');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  62 -      int threadNum) {                                                                                            </span>
<span class="-673106209130372223" onmouseenter="enter('-673106209130372223');" onmouseout="out('-673106209130372223');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  63 -    mContext = context.getApplicationContext();                                                                   </span>
<span class="-216605200672599564" onmouseenter="enter('-216605200672599564');" onmouseout="out('-216605200672599564');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  64 -    mDownloadEntity = entity;                                                                                     </span>
<span class="3831466484862340223" onmouseenter="enter('3831466484862340223');" onmouseout="out('3831466484862340223');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  65 -    mListener = downloadListener;                                                                                 </span>
<span class="-6579794148103748852" onmouseenter="enter('-6579794148103748852');" onmouseout="out('-6579794148103748852');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  66 -    THREAD_NUM = threadNum;                                                                                       </span>
<span class="-7335968387740294445" onmouseenter="enter('-7335968387740294445');" onmouseout="out('-7335968387740294445');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  67 -    mFixedThreadPool = Executors.newFixedThreadPool(Integer.MAX_VALUE);                                           </span>
<span class="2824360841323512384" onmouseenter="enter('2824360841323512384');" onmouseout="out('2824360841323512384');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  68 -    mConstance = new DownloadStateConstance(THREAD_NUM);                                                          </span>
<span class="-1498726564668589193" onmouseenter="enter('-1498726564668589193');" onmouseout="out('-1498726564668589193');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  69 -    init();                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  70 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  71 -                                                                                                                  </span>
<span class="-909562594025196126" onmouseenter="enter('-909562594025196126');" onmouseout="out('-909562594025196126');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  72 -  private void init() {                                                                                           </span>
<span class="-8302516119393797134" onmouseenter="enter('-8302516119393797134');" onmouseout="out('-8302516119393797134');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  73 -    mDownloadFile = new File(mDownloadEntity.getDownloadPath());                                                  </span>
<span class="-3534953052494864097" onmouseenter="enter('-3534953052494864097');" onmouseout="out('-3534953052494864097');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  74 -    //读取已完成的线程数                                                                                                   </span>
<span class="-9053998435552088983" onmouseenter="enter('-9053998435552088983');" onmouseout="out('-9053998435552088983');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  75 -    mConfigFile = new File(                                                                                       </span>
<span class="-3948838928069897094" onmouseenter="enter('-3948838928069897094');" onmouseout="out('-3948838928069897094');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  76 -        mContext.getFilesDir().getPath() + &quot;/temp/&quot; + mDownloadFile.getName() + &quot;.properties&quot;);                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  77 -    try {                                                                                                         </span>
<span class="7925700052565713558" onmouseenter="enter('7925700052565713558');" onmouseout="out('7925700052565713558');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  78 -      if (!mConfigFile.exists()) { //记录文件被删除，则重新下载                                                                </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  79 -        isNewTask = true;                                                                                         </span>
<span class="1838885973573966413" onmouseenter="enter('1838885973573966413');" onmouseout="out('1838885973573966413');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  80 -        CommonUtil.createFile(mConfigFile.getPath());                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  81 -      } else {                                                                                                    </span>
<span class="-6296621072689899390" onmouseenter="enter('-6296621072689899390');" onmouseout="out('-6296621072689899390');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  82 -        isNewTask = !mDownloadFile.exists();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  83 -      }                                                                                                           </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  84 -    } catch (Exception e) {                                                                                       </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  85 -      e.printStackTrace();                                                                                        </span>
<span class="-3747169937451325082" onmouseenter="enter('-3747169937451325082');" onmouseout="out('-3747169937451325082');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  86 -      failDownload(&quot;下载失败，记录文件被删除&quot;);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  87 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  88 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  89 -                                                                                                                  </span>
<span class="-8585626151911369157" onmouseenter="enter('-8585626151911369157');" onmouseout="out('-8585626151911369157');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  90 -  public IDownloadListener getListener() {                                                                        </span>
<span class="-7037258027690597516" onmouseenter="enter('-7037258027690597516');" onmouseout="out('-7037258027690597516');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  91 -    return mListener;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  92 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  93 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  94 -  /**                                                                                                             </span>
<span class="6936487890332430093" onmouseenter="enter('6936487890332430093');" onmouseout="out('6936487890332430093');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  95 -   * 设置连接超时时间                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  96 -   */                                                                                                             </span>
<span class="8269350745377988793" onmouseenter="enter('8269350745377988793');" onmouseout="out('8269350745377988793');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  97 -  public void setConnectTimeOut(int timeOut) {                                                                    </span>
<span class="7491344361160646490" onmouseenter="enter('7491344361160646490');" onmouseout="out('7491344361160646490');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  98 -    mConnectTimeOut = timeOut;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 100 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 101 -  /**                                                                                                             </span>
<span class="1793189252207234639" onmouseenter="enter('1793189252207234639');" onmouseout="out('1793189252207234639');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 102 -   * 设置流读取的超时时间                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 103 -   */                                                                                                             </span>
<span class="-4265144949210493065" onmouseenter="enter('-4265144949210493065');" onmouseout="out('-4265144949210493065');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 104 -  public void setReadTimeOut(int readTimeOut) {                                                                   </span>
<span class="-3349186980434336657" onmouseenter="enter('-3349186980434336657');" onmouseout="out('-3349186980434336657');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 105 -    mReadTimeOut = readTimeOut;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 106 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 107 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 108 -  /**                                                                                                             </span>
<span class="6025979389427346334" onmouseenter="enter('6025979389427346334');" onmouseout="out('6025979389427346334');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 109 -   * 获取当前下载位置                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 110 -   */                                                                                                             </span>
<span class="42588745782017963" onmouseenter="enter('42588745782017963');" onmouseout="out('42588745782017963');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 111 -  @Override public long getCurrentLocation() {                                                                    </span>
<span class="2881215542099369319" onmouseenter="enter('2881215542099369319');" onmouseout="out('2881215542099369319');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 112 -    return mConstance.CURRENT_LOCATION;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 113 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 114 -                                                                                                                  </span>
<span class="8514823861416132786" onmouseenter="enter('8514823861416132786');" onmouseout="out('8514823861416132786');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 115 -  @Override public boolean isDownloading() {                                                                      </span>
<span class="-2560940912314579274" onmouseenter="enter('-2560940912314579274');" onmouseout="out('-2560940912314579274');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 116 -    return mConstance.isDownloading;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 117 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 118 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 119 -  /**                                                                                                             </span>
<span class="8520049766391668792" onmouseenter="enter('8520049766391668792');" onmouseout="out('8520049766391668792');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 120 -   * 取消下载                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 121 -   */                                                                                                             </span>
<span class="8518544268347342740" onmouseenter="enter('8518544268347342740');" onmouseout="out('8518544268347342740');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 122 -  @Override public void cancelDownload() {                                                                        </span>
<span class="204250319841071761" onmouseenter="enter('204250319841071761');" onmouseout="out('204250319841071761');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 123 -    mConstance.isCancel = true;                                                                                   </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 124 -    mConstance.isDownloading = false;                                                                             </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 125 -    mFixedThreadPool.shutdown();                                                                                  </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 126 -    for (int i = 0; i &lt; THREAD_NUM; i++) {                                                                        </span>
<span class="6217106455110130996" onmouseenter="enter('6217106455110130996');" onmouseout="out('6217106455110130996');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 127 -      SingleThreadTask task = (SingleThreadTask) mTask.get(i);                                                    </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 128 -      if (task != null) {                                                                                         </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 129 -        task.cancel();                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 130 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 131 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 132 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 133 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 134 -  /**                                                                                                             </span>
<span class="7755328866638560569" onmouseenter="enter('7755328866638560569');" onmouseout="out('7755328866638560569');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 135 -   * 停止下载                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 136 -   */                                                                                                             </span>
<span class="-4596234023078912379" onmouseenter="enter('-4596234023078912379');" onmouseout="out('-4596234023078912379');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 137 -  @Override public void stopDownload() {                                                                          </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 138 -    mConstance.isStop = true;                                                                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 139 -    mConstance.isDownloading = false;                                                                             </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 140 -    mFixedThreadPool.shutdown();                                                                                  </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 141 -    for (int i = 0; i &lt; THREAD_NUM; i++) {                                                                        </span>
<span class="6217106455110130996" onmouseenter="enter('6217106455110130996');" onmouseout="out('6217106455110130996');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 142 -      SingleThreadTask task = (SingleThreadTask) mTask.get(i);                                                    </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 143 -      if (task != null) {                                                                                         </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 144 -        task.stop();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 145 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 146 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 147 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 148 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 149 -  /**                                                                                                             </span>
<span class="8538662619258057049" onmouseenter="enter('8538662619258057049');" onmouseout="out('8538662619258057049');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 150 -   * 删除下载记录文件                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 151 -   */                                                                                                             </span>
<span class="-6348491485207421588" onmouseenter="enter('-6348491485207421588');" onmouseout="out('-6348491485207421588');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 152 -  @Override public void delConfigFile() {                                                                         </span>
<span class="8558402344038566367" onmouseenter="enter('8558402344038566367');" onmouseout="out('8558402344038566367');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 153 -    if (mContext != null &amp;&amp; mDownloadEntity != null) {                                                            </span>
<span class="3099781541276521660" onmouseenter="enter('3099781541276521660');" onmouseout="out('3099781541276521660');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 154 -      File dFile = new File(mDownloadEntity.getDownloadPath());                                                   </span>
<span class="-1217451156974226618" onmouseenter="enter('-1217451156974226618');" onmouseout="out('-1217451156974226618');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 155 -      File config =                                                                                               </span>
<span class="1777202063354625193" onmouseenter="enter('1777202063354625193');" onmouseout="out('1777202063354625193');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 156 -          new File(mContext.getFilesDir().getPath() + &quot;/temp/&quot; + dFile.getName() + &quot;.properties&quot;);                </span>
<span class="-7696478919602418443" onmouseenter="enter('-7696478919602418443');" onmouseout="out('-7696478919602418443');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 157 -      if (config.exists()) {                                                                                      </span>
<span class="-5702358031910949081" onmouseenter="enter('-5702358031910949081');" onmouseout="out('-5702358031910949081');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 158 -        config.delete();                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 159 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 160 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 161 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 162 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 163 -  /**                                                                                                             </span>
<span class="-8312193682087493639" onmouseenter="enter('-8312193682087493639');" onmouseout="out('-8312193682087493639');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 164 -   * 删除temp文件                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 165 -   */                                                                                                             </span>
<span class="7655331082892594561" onmouseenter="enter('7655331082892594561');" onmouseout="out('7655331082892594561');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 166 -  @Override public void delTempFile() {                                                                           </span>
<span class="8558402344038566367" onmouseenter="enter('8558402344038566367');" onmouseout="out('8558402344038566367');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 167 -    if (mContext != null &amp;&amp; mDownloadEntity != null) {                                                            </span>
<span class="3099781541276521660" onmouseenter="enter('3099781541276521660');" onmouseout="out('3099781541276521660');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 168 -      File dFile = new File(mDownloadEntity.getDownloadPath());                                                   </span>
<span class="7897717398420259974" onmouseenter="enter('7897717398420259974');" onmouseout="out('7897717398420259974');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 169 -      if (dFile.exists()) {                                                                                       </span>
<span class="7527345290446588408" onmouseenter="enter('7527345290446588408');" onmouseout="out('7527345290446588408');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 170 -        dFile.delete();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 171 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 172 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 173 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 174 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 175 -  /**                                                                                                             </span>
<span class="-5727215122052088545" onmouseenter="enter('-5727215122052088545');" onmouseout="out('-5727215122052088545');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 176 -   * 多线程断点续传下载文件，开始下载                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 177 -   */                                                                                                             </span>
<span class="-4856178778199245062" onmouseenter="enter('-4856178778199245062');" onmouseout="out('-4856178778199245062');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 178 -  @Override public void startDownload() {                                                                         </span>
<span class="898408935389387935" onmouseenter="enter('898408935389387935');" onmouseout="out('898408935389387935');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 179 -    mConstance.cleanState();                                                                                      </span>
<span class="2099174989180368882" onmouseenter="enter('2099174989180368882');" onmouseout="out('2099174989180368882');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 180 -    mListener.onPre();                                                                                            </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 181 -    new Thread(this).start();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 182 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 183 -                                                                                                                  </span>
<span class="-5762688668558425600" onmouseenter="enter('-5762688668558425600');" onmouseout="out('-5762688668558425600');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 184 -  @Override public void resumeDownload() {                                                                        </span>
<span class="1497820413888703615" onmouseenter="enter('1497820413888703615');" onmouseout="out('1497820413888703615');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 185 -    startDownload();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 186 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 187 -                                                                                                                  </span>
<span class="8306009172830771261" onmouseenter="enter('8306009172830771261');" onmouseout="out('8306009172830771261');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 188 -  private void failDownload(String msg) {                                                                         </span>
<span class="-6647758959009774834" onmouseenter="enter('-6647758959009774834');" onmouseout="out('-6647758959009774834');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 189 -    Log.e(TAG, msg);                                                                                              </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 190 -    mConstance.isDownloading = false;                                                                             </span>
<span class="-6715929234808926893" onmouseenter="enter('-6715929234808926893');" onmouseout="out('-6715929234808926893');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 191 -    stopDownload();                                                                                               </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 192 -    mListener.onFail();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 193 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 194 -                                                                                                                  </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 195 -  @Override public void run() {                                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 196 -    try {                                                                                                         </span>
<span class="5483634401908283016" onmouseenter="enter('5483634401908283016');" onmouseout="out('5483634401908283016');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 197 -      URL url = new URL(mDownloadEntity.getDownloadUrl());                                                        </span>
<span class="-6008953795197858884" onmouseenter="enter('-6008953795197858884');" onmouseout="out('-6008953795197858884');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 198 -      HttpURLConnection conn = ConnectionHelp.handleConnection(url);                                              </span>
<span class="2062133901627510982" onmouseenter="enter('2062133901627510982');" onmouseout="out('2062133901627510982');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 199 -      conn = ConnectionHelp.setConnectParam(conn);                                                                </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 200 -      conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                                       </span>
<span class="-3579311541579934971" onmouseenter="enter('-3579311541579934971');" onmouseout="out('-3579311541579934971');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 201 -      conn.setConnectTimeout(mConnectTimeOut * 4);                                                                </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 202 -      conn.connect();                                                                                             </span>
<span class="6567575788372053568" onmouseenter="enter('6567575788372053568');" onmouseout="out('6567575788372053568');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 203 -      int len = conn.getContentLength();                                                                          </span>
<span class="3904365852949278245" onmouseenter="enter('3904365852949278245');" onmouseout="out('3904365852949278245');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 204 -      //if (len &lt; 0) {  //网络被劫持时会出现这个问题                                                                           </span>
<span class="835324676499837078" onmouseenter="enter('835324676499837078');" onmouseout="out('835324676499837078');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 205 -      //  failDownload(&quot;下载失败，网络被劫持&quot;);                                                                             </span>
<span class="3500611444781325819" onmouseenter="enter('3500611444781325819');" onmouseout="out('3500611444781325819');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 206 -      //  return;                                                                                                 </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 207 -      //}                                                                                                         </span>
<span class="-5653376755036700146" onmouseenter="enter('-5653376755036700146');" onmouseout="out('-5653376755036700146');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 208 -      int code = conn.getResponseCode();                                                                          </span>
<span class="999254544547719885" onmouseenter="enter('999254544547719885');" onmouseout="out('999254544547719885');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 209 -      //https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81                                             </span>
<span class="-8703603538857387010" onmouseenter="enter('-8703603538857387010');" onmouseout="out('-8703603538857387010');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 210 -      //206支持断点                                                                                                   </span>
<span class="5260656878663172399" onmouseenter="enter('5260656878663172399');" onmouseout="out('5260656878663172399');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 211 -      if (code == HttpURLConnection.HTTP_PARTIAL) {                                                               </span>
<span class="-4850747580721370850" onmouseenter="enter('-4850747580721370850');" onmouseout="out('-4850747580721370850');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 212 -        isSupportBreakpoint = true;                                                                               </span>
<span class="1256350564434583014" onmouseenter="enter('1256350564434583014');" onmouseout="out('1256350564434583014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 213 -        mListener.supportBreakpoint(true);                                                                        </span>
<span class="-7366273742365769169" onmouseenter="enter('-7366273742365769169');" onmouseout="out('-7366273742365769169');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 214 -        handleBreakpoint(conn);                                                                                   </span>
<span class="877851589237632825" onmouseenter="enter('877851589237632825');" onmouseout="out('877851589237632825');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 215 -      } else if (code == HttpURLConnection.HTTP_OK || len &lt; 0) {                                                  </span>
<span class="-5840271675092361063" onmouseenter="enter('-5840271675092361063');" onmouseout="out('-5840271675092361063');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 216 -        //在conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);下，200为不支持断点状态                                     </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 217 -        if (len &lt; 0) {                                                                                            </span>
<span class="9025825393004184595" onmouseenter="enter('9025825393004184595');" onmouseout="out('9025825393004184595');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 218 -          failDownload(&quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，文件长度小于0&quot;);                               </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 219 -          return;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 220 -        }                                                                                                         </span>
<span class="5451458949060440820" onmouseenter="enter('5451458949060440820');" onmouseout="out('5451458949060440820');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 221 -        isSupportBreakpoint = false;                                                                              </span>
<span class="3223278567209587987" onmouseenter="enter('3223278567209587987');" onmouseout="out('3223278567209587987');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 222 -        mListener.supportBreakpoint(false);                                                                       </span>
<span class="-3209038805792969148" onmouseenter="enter('-3209038805792969148');" onmouseout="out('-3209038805792969148');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 223 -        Log.w(TAG, &quot;该下载链接不支持断点下载&quot;);                                                                               </span>
<span class="-7366273742365769169" onmouseenter="enter('-7366273742365769169');" onmouseout="out('-7366273742365769169');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 224 -        handleBreakpoint(conn);                                                                                   </span>



<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 225 -      } else {                                                                                                    </span>
<span class="3429592426515613091" onmouseenter="enter('3429592426515613091');" onmouseout="out('3429592426515613091');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 226 -        failDownload(&quot;任务【&quot; + mDownloadEntity.getDownloadUrl() + &quot;】下载失败，返回码：&quot; + code);                             </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 227 -      }                                                                                                           </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 228 -    } catch (IOException e) {                                                                                     </span>
<span class="7015103282251076587" onmouseenter="enter('7015103282251076587');" onmouseout="out('7015103282251076587');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 229 -      failDownload(&quot;下载失败【downloadUrl:&quot;                                                                            </span>
<span class="5951112113295803501" onmouseenter="enter('5951112113295803501');" onmouseout="out('5951112113295803501');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 230 -          + mDownloadEntity.getDownloadUrl()                                                                      </span>
<span class="910868662350755341" onmouseenter="enter('910868662350755341');" onmouseout="out('910868662350755341');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 231 -          + &quot;】\n【filePath:&quot;                                                                                       </span>
<span class="5931171797063415443" onmouseenter="enter('5931171797063415443');" onmouseout="out('5931171797063415443');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 232 -          + mDownloadFile.getPath()                                                                               </span>
<span class="-1840319934610193149" onmouseenter="enter('-1840319934610193149');" onmouseout="out('-1840319934610193149');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 233 -          + &quot;】&quot;                                                                                                   </span>
<span class="-5371623624849066023" onmouseenter="enter('-5371623624849066023');" onmouseout="out('-5371623624849066023');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 234 -          + CommonUtil.getPrintException(e));                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 235 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 236 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 237 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 238 -  /**                                                                                                             </span>
<span class="-2887709646015060517" onmouseenter="enter('-2887709646015060517');" onmouseout="out('-2887709646015060517');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 239 -   * 处理断点                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 240 -   */                                                                                                             </span>
<span class="-1770943272374407595" onmouseenter="enter('-1770943272374407595');" onmouseout="out('-1770943272374407595');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 241 -  private void handleBreakpoint(HttpURLConnection conn) throws IOException {                                      </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 242 -                                                                                                                  </span>
<span class="7477238500582408106" onmouseenter="enter('7477238500582408106');" onmouseout="out('7477238500582408106');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 243 -    //不支持断点只能单线程下载                                                                                                </span>
<span class="-6722781002220970553" onmouseenter="enter('-6722781002220970553');" onmouseout="out('-6722781002220970553');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 244 -    if (!isSupportBreakpoint) {                                                                                   </span>
<span class="-8481066330390671660" onmouseenter="enter('-8481066330390671660');" onmouseout="out('-8481066330390671660');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 245 -      ConfigEntity entity = new ConfigEntity();                                                                   </span>
<span class="9125695722945677869" onmouseenter="enter('9125695722945677869');" onmouseout="out('9125695722945677869');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 246 -      entity.FILE_SIZE = conn.getContentLength();                                                                 </span>


<span class="4189357201157412201" onmouseenter="enter('4189357201157412201');" onmouseout="out('4189357201157412201');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 247 -      entity.DOWNLOAD_URL = mDownloadEntity.getDownloadUrl();                                                     </span>
<span class="1175511499700324517" onmouseenter="enter('1175511499700324517');" onmouseout="out('1175511499700324517');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 248 -      entity.TEMP_FILE = mDownloadFile;                                                                           </span>
<span class="-1353085718172399938" onmouseenter="enter('-1353085718172399938');" onmouseout="out('-1353085718172399938');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 249 -      entity.THREAD_ID = 0;                                                                                       </span>
<span class="-4967231089338870782" onmouseenter="enter('-4967231089338870782');" onmouseout="out('-4967231089338870782');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 250 -      entity.START_LOCATION = 0;                                                                                  </span>
<span class="4365950116387297475" onmouseenter="enter('4365950116387297475');" onmouseout="out('4365950116387297475');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 251 -      entity.END_LOCATION = entity.FILE_SIZE;                                                                     </span>
<span class="-7848202009707844875" onmouseenter="enter('-7848202009707844875');" onmouseout="out('-7848202009707844875');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 252 -      entity.CONFIG_FILE_PATH = mConfigFile.getPath();                                                            </span>
<span class="2812036997657153043" onmouseenter="enter('2812036997657153043');" onmouseout="out('2812036997657153043');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 253 -      entity.isSupportBreakpoint = isSupportBreakpoint;                                                           </span>
<span class="4531885195650702733" onmouseenter="enter('4531885195650702733');" onmouseout="out('4531885195650702733');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 254 -      SingleThreadTask task = new SingleThreadTask(mConstance, mListener, entity);                                </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 255 -      mFixedThreadPool.execute(task);                                                                             </span>

<span class="-2943780714290472761" onmouseenter="enter('-2943780714290472761');" onmouseout="out('-2943780714290472761');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 256 -      mListener.onStart(0);                                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 257 -      return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 258 -    }                                                                                                             </span>
<span class="-4144971478129188538" onmouseenter="enter('-4144971478129188538');" onmouseout="out('-4144971478129188538');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 259 -    int fileLength = conn.getContentLength();                                                                     </span>
<span class="-3771769896201867631" onmouseenter="enter('-3771769896201867631');" onmouseout="out('-3771769896201867631');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 260 -    //必须建一个文件                                                                                                     </span>
<span class="-8241179119122160888" onmouseenter="enter('-8241179119122160888');" onmouseout="out('-8241179119122160888');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 261 -    CommonUtil.createFile(mDownloadFile.getPath());                                                               </span>
<span class="-844126738551985064" onmouseenter="enter('-844126738551985064');" onmouseout="out('-844126738551985064');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 262 -    RandomAccessFile file = new RandomAccessFile(mDownloadFile.getPath(), &quot;rwd&quot;);                                 </span>





<span class="-564508951971497574" onmouseenter="enter('-564508951971497574');" onmouseout="out('-564508951971497574');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 263 -    //设置文件长度                                                                                                      </span>
<span class="6023690204241765206" onmouseenter="enter('6023690204241765206');" onmouseout="out('6023690204241765206');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 264 -    file.setLength(fileLength);                                                                                   </span>
<span class="5666806310833670603" onmouseenter="enter('5666806310833670603');" onmouseout="out('5666806310833670603');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 265 -    mListener.onPostPre(fileLength);                                                                              </span>
<span class="6024675825413521783" onmouseenter="enter('6024675825413521783');" onmouseout="out('6024675825413521783');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 266 -    //分配每条线程的下载区间                                                                                                 </span>
<span class="-317662916418562024" onmouseenter="enter('-317662916418562024');" onmouseout="out('-317662916418562024');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 267 -    Properties pro = null;                                                                                        </span>
<span class="4467713772376842471" onmouseenter="enter('4467713772376842471');" onmouseout="out('4467713772376842471');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 268 -    pro = CommonUtil.loadConfig(mConfigFile);                                                                     </span>
<span class="-681137634566379888" onmouseenter="enter('-681137634566379888');" onmouseout="out('-681137634566379888');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 269 -    if (pro.isEmpty()) {                                                                                          </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 270 -      isNewTask = true;                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 271 -    } else {                                                                                                      </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 272 -      for (int i = 0; i &lt; THREAD_NUM; i++) {                                                                      </span>
<span class="-6973645922135466911" onmouseenter="enter('-6973645922135466911');" onmouseout="out('-6973645922135466911');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 273 -        if (pro.getProperty(mDownloadFile.getName() + &quot;_record_&quot; + i) == null) {                                  </span>
<span class="1178951043321657234" onmouseenter="enter('1178951043321657234');" onmouseout="out('1178951043321657234');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 274 -          Object state = pro.getProperty(mDownloadFile.getName() + &quot;_state_&quot; + i);                                </span>
<span class="-2092430839348453245" onmouseenter="enter('-2092430839348453245');" onmouseout="out('-2092430839348453245');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 275 -          if (state != null &amp;&amp; Integer.parseInt(state + &quot;&quot;) == 1) {                                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 276 -            continue;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 277 -          }                                                                                                       </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 278 -          isNewTask = true;                                                                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 279 -          break;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 280 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 281 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 282 -    }                                                                                                             </span>
<span class="-1643854653241583074" onmouseenter="enter('-1643854653241583074');" onmouseout="out('-1643854653241583074');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 283 -    int blockSize = fileLength / THREAD_NUM;                                                                      </span>
<span class="866019335924650779" onmouseenter="enter('866019335924650779');" onmouseout="out('866019335924650779');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 284 -    int[] recordL = new int[THREAD_NUM];                                                                          </span>
<span class="794844889575716346" onmouseenter="enter('794844889575716346');" onmouseout="out('794844889575716346');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 285 -    int rl = 0;                                                                                                   </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 286 -    for (int i = 0; i &lt; THREAD_NUM; i++) {                                                                        </span>
<span class="8242320341463399828" onmouseenter="enter('8242320341463399828');" onmouseout="out('8242320341463399828');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 287 -      recordL[i] = -1;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 288 -    }                                                                                                             </span>
<span class="-652079948926189976" onmouseenter="enter('-652079948926189976');" onmouseout="out('-652079948926189976');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 289 -    for (int i = 0; i &lt; THREAD_NUM; i++) {                                                                        </span>
<span class="-2965725495076654490" onmouseenter="enter('-2965725495076654490');" onmouseout="out('-2965725495076654490');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 290 -      long startL = i * blockSize, endL = (i + 1) * blockSize;                                                    </span>
<span class="1178951043321657234" onmouseenter="enter('1178951043321657234');" onmouseout="out('1178951043321657234');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 291 -      Object state = pro.getProperty(mDownloadFile.getName() + &quot;_state_&quot; + i);                                    </span>
<span class="2419725940883839935" onmouseenter="enter('2419725940883839935');" onmouseout="out('2419725940883839935');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 292 -      if (state != null &amp;&amp; Integer.parseInt(state + &quot;&quot;) == 1) {  //该线程已经完成                                        </span>
<span class="8742170387731029623" onmouseenter="enter('8742170387731029623');" onmouseout="out('8742170387731029623');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 293 -        mConstance.CURRENT_LOCATION += endL - startL;                                                             </span>
<span class="7342592738960136820" onmouseenter="enter('7342592738960136820');" onmouseout="out('7342592738960136820');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 294 -        Log.d(TAG, &quot;++++++++++ 线程_&quot; + i + &quot;_已经下载完成 ++++++++++&quot;);                                                  </span>
<span class="-337774801975969950" onmouseenter="enter('-337774801975969950');" onmouseout="out('-337774801975969950');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 295 -        mConstance.COMPLETE_THREAD_NUM++;                                                                         </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 296 -        mConstance.STOP_NUM++;                                                                                    </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 297 -        mConstance.CANCEL_NUM++;                                                                                  </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 298 -        if (mConstance.isComplete()) {                                                                            </span>
<span class="4951157766975006439" onmouseenter="enter('4951157766975006439');" onmouseout="out('4951157766975006439');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 299 -          if (mConfigFile.exists()) {                                                                             </span>
<span class="-8106518526167482323" onmouseenter="enter('-8106518526167482323');" onmouseout="out('-8106518526167482323');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 300 -            mConfigFile.delete();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 301 -          }                                                                                                       </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 302 -          mListener.onComplete();                                                                                 </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 303 -          mConstance.isDownloading = false;                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 304 -          return;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 305 -        }                                                                                                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 306 -        continue;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 307 -      }                                                                                                           </span>
<span class="-1793454279264850881" onmouseenter="enter('-1793454279264850881');" onmouseout="out('-1793454279264850881');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 308 -      //分配下载位置                                                                                                    </span>
<span class="-8200484973700844224" onmouseenter="enter('-8200484973700844224');" onmouseout="out('-8200484973700844224');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 309 -      Object record = pro.getProperty(mDownloadFile.getName() + &quot;_record_&quot; + i);                                  </span>
<span class="-4606277471232235328" onmouseenter="enter('-4606277471232235328');" onmouseout="out('-4606277471232235328');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 310 -      //如果有记录，则恢复下载                                                                                               </span>
<span class="9081430961250736769" onmouseenter="enter('9081430961250736769');" onmouseout="out('9081430961250736769');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 311 -      if (!isNewTask &amp;&amp; record != null &amp;&amp; Long.parseLong(record + &quot;&quot;) &gt; 0) {                                      </span>
<span class="8647082033828497822" onmouseenter="enter('8647082033828497822');" onmouseout="out('8647082033828497822');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 312 -        Long r = Long.parseLong(record + &quot;&quot;);                                                                     </span>
<span class="1683054574044455381" onmouseenter="enter('1683054574044455381');" onmouseout="out('1683054574044455381');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 313 -        mConstance.CURRENT_LOCATION += r - startL;                                                                </span>
<span class="179733331572927392" onmouseenter="enter('179733331572927392');" onmouseout="out('179733331572927392');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 314 -        Log.d(TAG, &quot;++++++++++ 线程_&quot; + i + &quot;_恢复下载 ++++++++++&quot;);                                                    </span>
<span class="6939461797319425642" onmouseenter="enter('6939461797319425642');" onmouseout="out('6939461797319425642');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 315 -        mListener.onChildResume(r);                                                                               </span>
<span class="1542845345888554533" onmouseenter="enter('1542845345888554533');" onmouseout="out('1542845345888554533');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 316 -        startL = r;                                                                                               </span>
<span class="-7425711498405631322" onmouseenter="enter('-7425711498405631322');" onmouseout="out('-7425711498405631322');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 317 -        recordL[rl] = i;                                                                                          </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 318 -        rl++;                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 319 -      } else {                                                                                                    </span>
<span class="-7065031896488044292" onmouseenter="enter('-7065031896488044292');" onmouseout="out('-7065031896488044292');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 320 -        isNewTask = true;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 321 -      }                                                                                                           </span>
<span class="537230916062757449" onmouseenter="enter('537230916062757449');" onmouseout="out('537230916062757449');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 322 -      if (isNewTask) {                                                                                            </span>
<span class="-7425711498405631322" onmouseenter="enter('-7425711498405631322');" onmouseout="out('-7425711498405631322');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 323 -        recordL[rl] = i;                                                                                          </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 324 -        rl++;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 325 -      }                                                                                                           </span>
<span class="-3400889980578220125" onmouseenter="enter('-3400889980578220125');" onmouseout="out('-3400889980578220125');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 326 -      if (i == (THREAD_NUM - 1)) {                                                                                </span>
<span class="-7423751213765432972" onmouseenter="enter('-7423751213765432972');" onmouseout="out('-7423751213765432972');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 327 -        //如果整个文件的大小不为线程个数的整数倍，则最后一个线程的结束位置即为文件的总长度                                                                </span>
<span class="-2829184075463306484" onmouseenter="enter('-2829184075463306484');" onmouseout="out('-2829184075463306484');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 328 -        endL = fileLength;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 329 -      }                                                                                                           </span>
<span class="-8481066330390671660" onmouseenter="enter('-8481066330390671660');" onmouseout="out('-8481066330390671660');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 330 -      ConfigEntity entity = new ConfigEntity();                                                                   </span>
<span class="-3119684513187648029" onmouseenter="enter('-3119684513187648029');" onmouseout="out('-3119684513187648029');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 331 -      entity.FILE_SIZE = fileLength;                                                                              </span>
<span class="4189357201157412201" onmouseenter="enter('4189357201157412201');" onmouseout="out('4189357201157412201');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 332 -      entity.DOWNLOAD_URL = mDownloadEntity.getDownloadUrl();                                                     </span>
<span class="1175511499700324517" onmouseenter="enter('1175511499700324517');" onmouseout="out('1175511499700324517');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 333 -      entity.TEMP_FILE = mDownloadFile;                                                                           </span>
<span class="-1808458878368858692" onmouseenter="enter('-1808458878368858692');" onmouseout="out('-1808458878368858692');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 334 -      entity.THREAD_ID = i;                                                                                       </span>
<span class="6661292811999012973" onmouseenter="enter('6661292811999012973');" onmouseout="out('6661292811999012973');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 335 -      entity.START_LOCATION = startL;                                                                             </span>
<span class="8656472587238389131" onmouseenter="enter('8656472587238389131');" onmouseout="out('8656472587238389131');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 336 -      entity.END_LOCATION = endL;                                                                                 </span>
<span class="-7848202009707844875" onmouseenter="enter('-7848202009707844875');" onmouseout="out('-7848202009707844875');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 337 -      entity.CONFIG_FILE_PATH = mConfigFile.getPath();                                                            </span>
<span class="2812036997657153043" onmouseenter="enter('2812036997657153043');" onmouseout="out('2812036997657153043');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 338 -      entity.isSupportBreakpoint = isSupportBreakpoint;                                                           </span>
<span class="4531885195650702733" onmouseenter="enter('4531885195650702733');" onmouseout="out('4531885195650702733');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 339 -      SingleThreadTask task = new SingleThreadTask(mConstance, mListener, entity);                                </span>
<span class="-6012810893938815399" onmouseenter="enter('-6012810893938815399');" onmouseout="out('-6012810893938815399');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 340 -      mTask.put(i, task);                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 341 -    }                                                                                                             </span>
<span class="-1061602448343886008" onmouseenter="enter('-1061602448343886008');" onmouseout="out('-1061602448343886008');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 342 -    if (mConstance.CURRENT_LOCATION &gt; 0) {                                                                        </span>
<span class="5187035189520501266" onmouseenter="enter('5187035189520501266');" onmouseout="out('5187035189520501266');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 343 -      mListener.onResume(mConstance.CURRENT_LOCATION);                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 344 -    } else {                                                                                                      </span>
<span class="-2973471902048685805" onmouseenter="enter('-2973471902048685805');" onmouseout="out('-2973471902048685805');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 345 -      mListener.onStart(mConstance.CURRENT_LOCATION);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 346 -    }                                                                                                             </span>
<span class="1243235571055153612" onmouseenter="enter('1243235571055153612');" onmouseout="out('1243235571055153612');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 347 -    for (int l : recordL) {                                                                                       </span>
<span class="-7510837703317171619" onmouseenter="enter('-7510837703317171619');" onmouseout="out('-7510837703317171619');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 348 -      if (l == -1) continue;                                                                                      </span>
<span class="-85915337091278441" onmouseenter="enter('-85915337091278441');" onmouseout="out('-85915337091278441');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 349 -      Runnable task = mTask.get(l);                                                                               </span>
<span class="-7327661534177463737" onmouseenter="enter('-7327661534177463737');" onmouseout="out('-7327661534177463737');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 350 -      if (task != null &amp;&amp; !mFixedThreadPool.isShutdown()) {                                                       </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 351 -        mFixedThreadPool.execute(task);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 352 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 353 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 354 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 355 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 356 -  /**                                                                                                             </span>
<span class="2585942053451624927" onmouseenter="enter('2585942053451624927');" onmouseout="out('2585942053451624927');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 357 -   * 子线程下载信息类                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 358 -   */                                                                                                             </span>
<span class="-3850188489545087742" onmouseenter="enter('-3850188489545087742');" onmouseout="out('-3850188489545087742');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 359 -  final static class ConfigEntity {                                                                               </span>
<span class="-403498804051257270" onmouseenter="enter('-403498804051257270');" onmouseout="out('-403498804051257270');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 360 -    //文件大小                                                                                                        </span>
<span class="541475241289655650" onmouseenter="enter('541475241289655650');" onmouseout="out('541475241289655650');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 361 -    long FILE_SIZE;                                                                                               </span>
<span class="-4736398418022593572" onmouseenter="enter('-4736398418022593572');" onmouseout="out('-4736398418022593572');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 362 -    String DOWNLOAD_URL;                                                                                          </span>
<span class="-7368464316865211776" onmouseenter="enter('-7368464316865211776');" onmouseout="out('-7368464316865211776');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 363 -    int THREAD_ID;                                                                                                </span>
<span class="3260682776668453255" onmouseenter="enter('3260682776668453255');" onmouseout="out('3260682776668453255');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 364 -    long START_LOCATION;                                                                                          </span>
<span class="2446069397877689758" onmouseenter="enter('2446069397877689758');" onmouseout="out('2446069397877689758');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 365 -    long END_LOCATION;                                                                                            </span>
<span class="4104096962052364503" onmouseenter="enter('4104096962052364503');" onmouseout="out('4104096962052364503');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 366 -    File TEMP_FILE;                                                                                               </span>
<span class="-2017423643980728828" onmouseenter="enter('-2017423643980728828');" onmouseout="out('-2017423643980728828');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 367 -    boolean isSupportBreakpoint = true;                                                                           </span>
<span class="-2943683475239618057" onmouseenter="enter('-2943683475239618057');" onmouseout="out('-2943683475239618057');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 368 -    String CONFIG_FILE_PATH;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 369 -  }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 370 -}                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            