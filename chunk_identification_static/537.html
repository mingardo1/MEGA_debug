<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>537</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    537
                    <a href="536.html">prev</a>
                    <a href="538.html">next</a>
                    <a href="537_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    Freeyourgadget/Gadgetbridge_92e92ae7927eaf3c7552c002a860acc86b20edfd_app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/NotificationListener.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Freeyourgadget\Gadgetbridge show &quot;92e92ae7927eaf3c7552c002a860acc86b20edfd:app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/NotificationListener.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Freeyourgadget\Gadgetbridge show &quot;92e92ae7927eaf3c7552c002a860acc86b20edfd^1:app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/NotificationListener.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Freeyourgadget\Gadgetbridge show &quot;92e92ae7927eaf3c7552c002a860acc86b20edfd^2:app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/NotificationListener.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Freeyourgadget\Gadgetbridge show &quot;d15167c8adb712d59832cb62725491847a21ac63:app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/NotificationListener.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="-230343772074056088" onmouseenter="enter('-230343772074056088');" onmouseout="out('-230343772074056088');" style="">   1 /*  Copyright (C) 2015-2018 Andreas Shimokawa, Carsten Pfeiffer, Daniele                                 </span>
<span class="2492236627567978380" onmouseenter="enter('2492236627567978380');" onmouseout="out('2492236627567978380');" style="">   2     Gobbetti, Frank Slezak, Hasan Ammar, JosÃ© Rebelo, Julien Pivotto, Kevin                              </span>
<span class="-504983364603579348" onmouseenter="enter('-504983364603579348');" onmouseout="out('-504983364603579348');" style="">   3     Richter, Normano64, Steffen Liebergeld, Taavi EomÃ¤e, Zhong Jianxin                                   </span>
<span  style="">   4                                                                                                          </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   5     This file is part of Gadgetbridge.                                                                   </span>
<span  style="">   6                                                                                                          </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   7     Gadgetbridge is free software: you can redistribute it and/or modify                                 </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   8     it under the terms of the GNU Affero General Public License as published                             </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">   9     by the Free Software Foundation, either version 3 of the License, or                                 </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">  10     (at your option) any later version.                                                                  </span>
<span  style="">  11                                                                                                          </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  12     Gadgetbridge is distributed in the hope that it will be useful,                                      </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  13     but WITHOUT ANY WARRANTY; without even the implied warranty of                                       </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  14     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                        </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  15     GNU Affero General Public License for more details.                                                  </span>
<span  style="">  16                                                                                                          </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  17     You should have received a copy of the GNU Affero General Public License                             </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  18     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                             </span>
<span class="8249211937858728345" onmouseenter="enter('8249211937858728345');" onmouseout="out('8249211937858728345');" style="">  19 package nodomain.freeyourgadget.gadgetbridge.externalevents;                                             </span>
<span  style="">  20                                                                                                          </span>
<span class="-867022162471464761" onmouseenter="enter('-867022162471464761');" onmouseout="out('-867022162471464761');" style="">  21 import android.app.ActivityManager;                                                                      </span>
<span class="1017587490774535994" onmouseenter="enter('1017587490774535994');" onmouseout="out('1017587490774535994');" style="">  22 import android.app.Notification;                                                                         </span>
<span class="2183671588995744448" onmouseenter="enter('2183671588995744448');" onmouseout="out('2183671588995744448');" style="">  23 import android.app.NotificationManager;                                                                  </span>
<span class="2265467446931963889" onmouseenter="enter('2265467446931963889');" onmouseout="out('2265467446931963889');" style="">  24 import android.app.PendingIntent;                                                                        </span>
<span class="-489389385851058391" onmouseenter="enter('-489389385851058391');" onmouseout="out('-489389385851058391');" style="">  25 import android.content.BroadcastReceiver;                                                                </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  26 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  27 import android.content.Intent;                                                                           </span>
<span class="8697221465021235869" onmouseenter="enter('8697221465021235869');" onmouseout="out('8697221465021235869');" style="">  28 import android.content.IntentFilter;                                                                     </span>
<span class="-841431222158024655" onmouseenter="enter('-841431222158024655');" onmouseout="out('-841431222158024655');" style="">  29 import android.content.pm.ApplicationInfo;                                                               </span>
<span class="-1290624633738557221" onmouseenter="enter('-1290624633738557221');" onmouseout="out('-1290624633738557221');" style="">  30 import android.content.pm.PackageManager;                                                                </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  31 import android.graphics.Bitmap;                                                                          </span>
<span class="-5868658801447575011" onmouseenter="enter('-5868658801447575011');" onmouseout="out('-5868658801447575011');" style="">  32 import android.graphics.Color;                                                                           </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  33 import android.graphics.drawable.Drawable;                                                               </span>
<span class="-7644600255099282823" onmouseenter="enter('-7644600255099282823');" onmouseout="out('-7644600255099282823');" style="">  34 import android.media.MediaMetadata;                                                                      </span>
<span class="6014561289295455692" onmouseenter="enter('6014561289295455692');" onmouseout="out('6014561289295455692');" style="">  35 import android.media.session.PlaybackState;                                                              </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  36 import android.os.Bundle;                                                                                </span>
<span class="1048014933395814760" onmouseenter="enter('1048014933395814760');" onmouseout="out('1048014933395814760');" style="">  37 import android.os.PowerManager;                                                                          </span>
<span class="2671599330745315048" onmouseenter="enter('2671599330745315048');" onmouseout="out('2671599330745315048');" style="">  38 import android.os.RemoteException;                                                                       </span>
<span class="2414580121965048179" onmouseenter="enter('2414580121965048179');" onmouseout="out('2414580121965048179');" style="">  39 import android.service.notification.NotificationListenerService;                                         </span>
<span class="-5243140560088050107" onmouseenter="enter('-5243140560088050107');" onmouseout="out('-5243140560088050107');" style="">  40 import android.service.notification.StatusBarNotification;                                               </span>
<span class="-9135046463009697450" onmouseenter="enter('-9135046463009697450');" onmouseout="out('-9135046463009697450');" style="">  41 import android.support.v4.media.MediaMetadataCompat;                                                     </span>
<span class="3010053617601869286" onmouseenter="enter('3010053617601869286');" onmouseout="out('3010053617601869286');" style="">  42 import android.support.v4.media.session.MediaControllerCompat;                                           </span>
<span class="7582659085834762989" onmouseenter="enter('7582659085834762989');" onmouseout="out('7582659085834762989');" style="">  43 import android.support.v4.media.session.MediaSessionCompat;                                              </span>
<span class="7730848488047972805" onmouseenter="enter('7730848488047972805');" onmouseout="out('7730848488047972805');" style="">  44 import android.support.v4.media.session.PlaybackStateCompat;                                             </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  45 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  46                                                                                                          </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  47 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-9135046463009697450" onmouseenter="enter('-9135046463009697450');" onmouseout="out('-9135046463009697450');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48 import android.support.v4.media.MediaMetadataCompat;                                                     </span>
<span class="3010053617601869286" onmouseenter="enter('3010053617601869286');" onmouseout="out('3010053617601869286');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49 import android.support.v4.media.session.MediaControllerCompat;                                           </span>
<span class="7582659085834762989" onmouseenter="enter('7582659085834762989');" onmouseout="out('7582659085834762989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50 import android.support.v4.media.session.MediaSessionCompat;                                              </span>
<span class="7730848488047972805" onmouseenter="enter('7730848488047972805');" onmouseout="out('7730848488047972805');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51 import android.support.v4.media.session.PlaybackStateCompat;                                             </span>
<span class="1265541204496044340" onmouseenter="enter('1265541204496044340');" onmouseout="out('1265541204496044340');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52 import android.support.v7.graphics.Palette;                                                              </span>
<span class="-1987741288118698756" onmouseenter="enter('-1987741288118698756');" onmouseout="out('-1987741288118698756');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53 import de.greenrobot.dao.query.Query;                                                                    </span>
<span class="5877451784023912628" onmouseenter="enter('5877451784023912628');" onmouseout="out('5877451784023912628');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54 import nodomain.freeyourgadget.gadgetbridge.BuildConfig;                                                 </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55 import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                               </span>
<span class="-1471644270559892265" onmouseenter="enter('-1471644270559892265');" onmouseout="out('-1471644270559892265');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56 import nodomain.freeyourgadget.gadgetbridge.GBException;                                                 </span>
<span class="-7198279398549834921" onmouseenter="enter('-7198279398549834921');" onmouseout="out('-7198279398549834921');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57 import nodomain.freeyourgadget.gadgetbridge.R;                                                           </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58 import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                          </span>
<span class="4987748567588683404" onmouseenter="enter('4987748567588683404');" onmouseout="out('4987748567588683404');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59 import nodomain.freeyourgadget.gadgetbridge.devices.pebble.PebbleColor;                                  </span>
<span class="4582396241551629343" onmouseenter="enter('4582396241551629343');" onmouseout="out('4582396241551629343');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilter;                                 </span>
<span class="-8984035867915956548" onmouseenter="enter('-8984035867915956548');" onmouseout="out('-8984035867915956548');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterDao;                              </span>
<span class="-8722044444563651785" onmouseenter="enter('-8722044444563651785');" onmouseout="out('-8722044444563651785');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntry;                            </span>
<span class="-8636777843920322113" onmouseenter="enter('-8636777843920322113');" onmouseout="out('-8636777843920322113');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntryDao;                         </span>
<span class="9006904697493331689" onmouseenter="enter('9006904697493331689');" onmouseout="out('9006904697493331689');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64 import nodomain.freeyourgadget.gadgetbridge.model.*;                                                     </span>
<span class="-3383373218913164687" onmouseenter="enter('-3383373218913164687');" onmouseout="out('-3383373218913164687');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65 import nodomain.freeyourgadget.gadgetbridge.service.DeviceCommunicationService;                          </span>
<span class="-5340888108606249230" onmouseenter="enter('-5340888108606249230');" onmouseout="out('-5340888108606249230');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66 import nodomain.freeyourgadget.gadgetbridge.util.BitmapUtil;                                             </span>
<span class="-6912606469471439703" onmouseenter="enter('-6912606469471439703');" onmouseout="out('-6912606469471439703');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67 import nodomain.freeyourgadget.gadgetbridge.util.LimitedQueue;                                           </span>
<span class="4645284583739884744" onmouseenter="enter('4645284583739884744');" onmouseout="out('4645284583739884744');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68 import nodomain.freeyourgadget.gadgetbridge.util.PebbleUtils;                                            </span>
<span class="-600862318521663319" onmouseenter="enter('-600862318521663319');" onmouseout="out('-600862318521663319');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69 import nodomain.freeyourgadget.gadgetbridge.util.Prefs;                                                  </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  71 =======                                                                                                  </span>
<span class="1265541204496044340" onmouseenter="enter('1265541204496044340');" onmouseout="out('1265541204496044340');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  72 import android.support.v7.graphics.Palette;                                                              </span>
<span class="-1987741288118698756" onmouseenter="enter('-1987741288118698756');" onmouseout="out('-1987741288118698756');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  73 import de.greenrobot.dao.query.Query;                                                                    </span>
<span class="5877451784023912628" onmouseenter="enter('5877451784023912628');" onmouseout="out('5877451784023912628');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  74 import nodomain.freeyourgadget.gadgetbridge.BuildConfig;                                                 </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  75 import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                               </span>
<span class="-1471644270559892265" onmouseenter="enter('-1471644270559892265');" onmouseout="out('-1471644270559892265');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  76 import nodomain.freeyourgadget.gadgetbridge.GBException;                                                 </span>
<span class="-7198279398549834921" onmouseenter="enter('-7198279398549834921');" onmouseout="out('-7198279398549834921');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  77 import nodomain.freeyourgadget.gadgetbridge.R;                                                           </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  78 import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                          </span>
<span class="4987748567588683404" onmouseenter="enter('4987748567588683404');" onmouseout="out('4987748567588683404');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  79 import nodomain.freeyourgadget.gadgetbridge.devices.pebble.PebbleColor;                                  </span>
<span class="4582396241551629343" onmouseenter="enter('4582396241551629343');" onmouseout="out('4582396241551629343');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  80 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilter;                                 </span>
<span class="-9074570965792323186" onmouseenter="enter('-9074570965792323186');" onmouseout="out('-9074570965792323186');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  81 import nodomain.freeyourgadget.gadgetbridge.model.CallSpec;                                              </span>
<span class="-8984035867915956548" onmouseenter="enter('-8984035867915956548');" onmouseout="out('-8984035867915956548');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  82 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterDao;                              </span>
<span class="-8722044444563651785" onmouseenter="enter('-8722044444563651785');" onmouseout="out('-8722044444563651785');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  83 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntry;                            </span>
<span class="-8636777843920322113" onmouseenter="enter('-8636777843920322113');" onmouseout="out('-8636777843920322113');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  84 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntryDao;                         </span>
<span class="9006904697493331689" onmouseenter="enter('9006904697493331689');" onmouseout="out('9006904697493331689');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  85 import nodomain.freeyourgadget.gadgetbridge.model.*;                                                     </span>
<span class="-3383373218913164687" onmouseenter="enter('-3383373218913164687');" onmouseout="out('-3383373218913164687');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  86 import nodomain.freeyourgadget.gadgetbridge.service.DeviceCommunicationService;                          </span>
<span class="-5340888108606249230" onmouseenter="enter('-5340888108606249230');" onmouseout="out('-5340888108606249230');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  87 import nodomain.freeyourgadget.gadgetbridge.util.BitmapUtil;                                             </span>
<span class="-6912606469471439703" onmouseenter="enter('-6912606469471439703');" onmouseout="out('-6912606469471439703');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  88 import nodomain.freeyourgadget.gadgetbridge.util.LimitedQueue;                                           </span>
<span class="4645284583739884744" onmouseenter="enter('4645284583739884744');" onmouseout="out('4645284583739884744');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  89 import nodomain.freeyourgadget.gadgetbridge.util.PebbleUtils;                                            </span>
<span class="-600862318521663319" onmouseenter="enter('-600862318521663319');" onmouseout="out('-600862318521663319');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  90 import nodomain.freeyourgadget.gadgetbridge.util.Prefs;                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  91 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  92 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  93 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  94 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  95                                                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  96 import java.util.ArrayList;                                                                              </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  97 import java.util.HashMap;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  98 import java.util.List;                                                                                   </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  99 import java.util.Objects;                                                                                </span>
<span  style=""> 100                                                                                                          </span>
<span class="6963272077887521702" onmouseenter="enter('6963272077887521702');" onmouseout="out('6963272077887521702');" style=""> 101 import androidx.annotation.NonNull;                                                                      </span>
<span class="-8223344932374400146" onmouseenter="enter('-8223344932374400146');" onmouseout="out('-8223344932374400146');" style=""> 102 import androidx.core.app.NotificationCompat;                                                             </span>
<span class="608068994369921062" onmouseenter="enter('608068994369921062');" onmouseout="out('608068994369921062');" style=""> 103 import androidx.core.app.RemoteInput;                                                                    </span>
<span class="-898780232029151795" onmouseenter="enter('-898780232029151795');" onmouseout="out('-898780232029151795');" style=""> 104 import androidx.localbroadcastmanager.content.LocalBroadcastManager;                                     </span>
<span class="8247440879742583383" onmouseenter="enter('8247440879742583383');" onmouseout="out('8247440879742583383');" style=""> 105 import androidx.palette.graphics.Palette;                                                                </span>
<span class="-1987741288118698756" onmouseenter="enter('-1987741288118698756');" onmouseout="out('-1987741288118698756');" style=""> 106 import de.greenrobot.dao.query.Query;                                                                    </span>
<span class="5877451784023912628" onmouseenter="enter('5877451784023912628');" onmouseout="out('5877451784023912628');" style=""> 107 import nodomain.freeyourgadget.gadgetbridge.BuildConfig;                                                 </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style=""> 108 import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                               </span>
<span class="-7198279398549834921" onmouseenter="enter('-7198279398549834921');" onmouseout="out('-7198279398549834921');" style=""> 109 import nodomain.freeyourgadget.gadgetbridge.R;                                                           </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style=""> 110 import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                          </span>
<span class="4987748567588683404" onmouseenter="enter('4987748567588683404');" onmouseout="out('4987748567588683404');" style=""> 111 import nodomain.freeyourgadget.gadgetbridge.devices.pebble.PebbleColor;                                  </span>
<span class="4582396241551629343" onmouseenter="enter('4582396241551629343');" onmouseout="out('4582396241551629343');" style=""> 112 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilter;                                 </span>
<span class="-8984035867915956548" onmouseenter="enter('-8984035867915956548');" onmouseout="out('-8984035867915956548');" style=""> 113 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterDao;                              </span>
<span class="-8722044444563651785" onmouseenter="enter('-8722044444563651785');" onmouseout="out('-8722044444563651785');" style=""> 114 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntry;                            </span>
<span class="-8636777843920322113" onmouseenter="enter('-8636777843920322113');" onmouseout="out('-8636777843920322113');" style=""> 115 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntryDao;                         </span>
<span class="6892049631062353546" onmouseenter="enter('6892049631062353546');" onmouseout="out('6892049631062353546');" style=""> 116 import nodomain.freeyourgadget.gadgetbridge.model.AppNotificationType;                                   </span>
<span class="-4068239021838445503" onmouseenter="enter('-4068239021838445503');" onmouseout="out('-4068239021838445503');" style=""> 117 import nodomain.freeyourgadget.gadgetbridge.model.MusicSpec;                                             </span>
<span class="7536481506851862405" onmouseenter="enter('7536481506851862405');" onmouseout="out('7536481506851862405');" style=""> 118 import nodomain.freeyourgadget.gadgetbridge.model.MusicStateSpec;                                        </span>
<span class="8239808916005009388" onmouseenter="enter('8239808916005009388');" onmouseout="out('8239808916005009388');" style=""> 119 import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;                                      </span>
<span class="7087011959288310716" onmouseenter="enter('7087011959288310716');" onmouseout="out('7087011959288310716');" style=""> 120 import nodomain.freeyourgadget.gadgetbridge.model.NotificationType;                                      </span>
<span class="-3383373218913164687" onmouseenter="enter('-3383373218913164687');" onmouseout="out('-3383373218913164687');" style=""> 121 import nodomain.freeyourgadget.gadgetbridge.service.DeviceCommunicationService;                          </span>
<span class="-5340888108606249230" onmouseenter="enter('-5340888108606249230');" onmouseout="out('-5340888108606249230');" style=""> 122 import nodomain.freeyourgadget.gadgetbridge.util.BitmapUtil;                                             </span>
<span class="-6912606469471439703" onmouseenter="enter('-6912606469471439703');" onmouseout="out('-6912606469471439703');" style=""> 123 import nodomain.freeyourgadget.gadgetbridge.util.LimitedQueue;                                           </span>
<span class="4645284583739884744" onmouseenter="enter('4645284583739884744');" onmouseout="out('4645284583739884744');" style=""> 124 import nodomain.freeyourgadget.gadgetbridge.util.PebbleUtils;                                            </span>
<span class="-600862318521663319" onmouseenter="enter('-600862318521663319');" onmouseout="out('-600862318521663319');" style=""> 125 import nodomain.freeyourgadget.gadgetbridge.util.Prefs;                                                  </span>
<span  style=""> 126                                                                                                          </span>
<span class="7436623043745543163" onmouseenter="enter('7436623043745543163');" onmouseout="out('7436623043745543163');" style=""> 127 import static androidx.media.app.NotificationCompat.MediaStyle.getMediaSession;                          </span>
<span class="2609355261484520736" onmouseenter="enter('2609355261484520736');" onmouseout="out('2609355261484520736');" style=""><abbr title=" 128 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_BLACKLIST;"> 128 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILðŸ”µ</abbr></span>
<span class="-7771135586340561880" onmouseenter="enter('-7771135586340561880');" onmouseout="out('-7771135586340561880');" style=""><abbr title=" 129 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_WHITELIST;"> 129 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILðŸ”µ</abbr></span>
<span class="-3815741097386417514" onmouseenter="enter('-3815741097386417514');" onmouseout="out('-3815741097386417514');" style=""><abbr title=" 130 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_SUBMODE_ALL;"> 130 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILðŸ”µ</abbr></span>
<span  style=""> 131                                                                                                          </span>
<span class="6882532116672062216" onmouseenter="enter('6882532116672062216');" onmouseout="out('6882532116672062216');" style=""> 132 public class NotificationListener extends NotificationListenerService {                                  </span>
<span  style=""> 133                                                                                                          </span>
<span class="5652999225459763894" onmouseenter="enter('5652999225459763894');" onmouseout="out('5652999225459763894');" style=""> 134     private static final Logger LOG = LoggerFactory.getLogger(NotificationListener.class);               </span>
<span  style=""> 135                                                                                                          </span>
<span class="-6720636215056424198" onmouseenter="enter('-6720636215056424198');" onmouseout="out('-6720636215056424198');" style=""> 136     public static final String ACTION_DISMISS                                                            </span>
<span class="-435533233439313912" onmouseenter="enter('-435533233439313912');" onmouseout="out('-435533233439313912');" style=""> 137             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss&quot;;                </span>
<span class="-2138233225266526402" onmouseenter="enter('-2138233225266526402');" onmouseout="out('-2138233225266526402');" style=""> 138     public static final String ACTION_DISMISS_ALL                                                        </span>
<span class="-4592236270087722119" onmouseenter="enter('-4592236270087722119');" onmouseout="out('-4592236270087722119');" style=""> 139             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss_all&quot;;            </span>
<span class="-3417692764158931011" onmouseenter="enter('-3417692764158931011');" onmouseout="out('-3417692764158931011');" style=""> 140     public static final String ACTION_OPEN                                                               </span>
<span class="-4990387725302380924" onmouseenter="enter('-4990387725302380924');" onmouseout="out('-4990387725302380924');" style=""> 141             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.open&quot;;                   </span>
<span class="-4179389986769695249" onmouseenter="enter('-4179389986769695249');" onmouseout="out('-4179389986769695249');" style=""> 142     public static final String ACTION_MUTE                                                               </span>
<span class="9023540546537828742" onmouseenter="enter('9023540546537828742');" onmouseout="out('9023540546537828742');" style=""> 143             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.mute&quot;;                   </span>
<span class="5009618492496239115" onmouseenter="enter('5009618492496239115');" onmouseout="out('5009618492496239115');" style=""> 144     public static final String ACTION_REPLY                                                              </span>
<span class="8900274215532856227" onmouseenter="enter('8900274215532856227');" onmouseout="out('8900274215532856227');" style=""> 145             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.reply&quot;;                  </span>
<span  style=""> 146                                                                                                          </span>
<span class="2046947475762055359" onmouseenter="enter('2046947475762055359');" onmouseout="out('2046947475762055359');" style=""> 147     private LimitedQueue mActionLookup = new LimitedQueue(32);                                           </span>
<span class="7830816337914020824" onmouseenter="enter('7830816337914020824');" onmouseout="out('7830816337914020824');" style=""> 148     private LimitedQueue mPackageLookup = new LimitedQueue(64);                                          </span>
<span class="203591122145891899" onmouseenter="enter('203591122145891899');" onmouseout="out('203591122145891899');" style=""> 149     private LimitedQueue mNotificationHandleLookup = new LimitedQueue(128);                              </span>
<span  style=""> 150                                                                                                          </span>
<span class="5935133783530348929" onmouseenter="enter('5935133783530348929');" onmouseout="out('5935133783530348929');" style=""> 151     private HashMap&lt;String, Long&gt; notificationBurstPrevention = new HashMap&lt;&gt;();                         </span>
<span class="957532525841967801" onmouseenter="enter('957532525841967801');" onmouseout="out('957532525841967801');" style=""> 152     private HashMap&lt;String, Long&gt; notificationOldRepeatPrevention = new HashMap&lt;&gt;();                     </span>
<span  style=""> 153                                                                                                          </span>
<span class="1901653456173527926" onmouseenter="enter('1901653456173527926');" onmouseout="out('1901653456173527926');" style=""> 154     private long activeCallPostTime;                                                                     </span>
<span  style=""> 155                                                                                                          </span>
<span class="4625474178666977899" onmouseenter="enter('4625474178666977899');" onmouseout="out('4625474178666977899');" style=""> 156     private final BroadcastReceiver mReceiver = new BroadcastReceiver() {                                </span>
<span  style=""> 157                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 158         @Override                                                                                        </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 159         public void onReceive(Context context, Intent intent) {                                          </span>
<span class="5344227773413700857" onmouseenter="enter('5344227773413700857');" onmouseout="out('5344227773413700857');" style=""> 160             String action = intent.getAction();                                                          </span>
<span class="4668300806615190248" onmouseenter="enter('4668300806615190248');" onmouseout="out('4668300806615190248');" style=""> 161             if (action == null) {                                                                        </span>
<span class="-9060638611519565940" onmouseenter="enter('-9060638611519565940');" onmouseout="out('-9060638611519565940');" style=""> 162                 LOG.warn(&quot;no action&quot;);                                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 163                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164             }                                                                                            </span>
<span  style=""> 165                                                                                                          </span>
<span class="-4066678304235095791" onmouseenter="enter('-4066678304235095791');" onmouseout="out('-4066678304235095791');" style=""> 166             int handle = (int) intent.getLongExtra(&quot;handle&quot;, -1);                                        </span>
<span class="6099627150369302694" onmouseenter="enter('6099627150369302694');" onmouseout="out('6099627150369302694');" style=""> 167             switch (action) {                                                                            </span>
<span class="-3756464253045444946" onmouseenter="enter('-3756464253045444946');" onmouseout="out('-3756464253045444946');" style=""> 168                 case GBApplication.ACTION_QUIT:                                                          </span>
<span class="711670831438240238" onmouseenter="enter('711670831438240238');" onmouseout="out('711670831438240238');" style=""> 169                     stopSelf();                                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 170                     break;                                                                               </span>
<span  style=""> 171                                                                                                          </span>
<span class="7089712877132390363" onmouseenter="enter('7089712877132390363');" onmouseout="out('7089712877132390363');" style=""> 172                 case ACTION_OPEN: {                                                                      </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""> 173                     StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();   </span>
<span class="-2620913793661815477" onmouseenter="enter('-2620913793661815477');" onmouseout="out('-2620913793661815477');" style=""> 174                     Long ts = (Long) mNotificationHandleLookup.lookup(handle);                           </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 175                     if (ts == null) {                                                                    </span>
<span class="-3551838833774164230" onmouseenter="enter('-3551838833774164230');" onmouseout="out('-3551838833774164230');" style=""> 176                         LOG.info(&quot;could not lookup handle for open action&quot;);                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 177                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178                     }                                                                                    </span>
<span  style=""> 179                                                                                                          </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 180                     for (StatusBarNotification sbn : sbns) {                                             </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 181                         if (sbn.getPostTime() == ts) {                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 182                             try {                                                                        </span>
<span class="-5589448531951598530" onmouseenter="enter('-5589448531951598530');" onmouseout="out('-5589448531951598530');" style=""> 183                                 PendingIntent pi = sbn.getNotification().contentIntent;                  </span>
<span class="-4590351723917688021" onmouseenter="enter('-4590351723917688021');" onmouseout="out('-4590351723917688021');" style=""> 184                                 if (pi != null) {                                                        </span>
<span class="-4072418890714992779" onmouseenter="enter('-4072418890714992779');" onmouseout="out('-4072418890714992779');" style=""> 185                                     pi.send();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186                                 }                                                                        </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 187                             } catch (PendingIntent.CanceledException e) {                                </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 188                                 e.printStackTrace();                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191                     }                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 192                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193                 }                                                                                        </span>
<span class="-4678853843833528690" onmouseenter="enter('-4678853843833528690');" onmouseout="out('-4678853843833528690');" style=""> 194                 case ACTION_MUTE:                                                                        </span>
<span class="4917035583817915455" onmouseenter="enter('4917035583817915455');" onmouseout="out('4917035583817915455');" style=""> 195                     String packageName = (String) mPackageLookup.lookup(handle);                         </span>
<span class="2797777100746091358" onmouseenter="enter('2797777100746091358');" onmouseout="out('2797777100746091358');" style=""> 196                     if (packageName == null) {                                                           </span>
<span class="5190950653644936431" onmouseenter="enter('5190950653644936431');" onmouseout="out('5190950653644936431');" style=""> 197                         LOG.info(&quot;could not lookup handle for mute action&quot;);                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 198                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199                     }                                                                                    </span>
<span  style=""> 200                                                                                                          </span>
<span class="-55961907216512395" onmouseenter="enter('-55961907216512395');" onmouseout="out('-55961907216512395');" style=""> 201                     LOG.info(&quot;going to mute &quot; + packageName);                                            </span>
<span class="6244948836232449423" onmouseenter="enter('6244948836232449423');" onmouseout="out('6244948836232449423');" style=""> 202                     GBApplication.addAppToNotifBlacklist(packageName);                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 203                     break;                                                                               </span>
<span class="-1141458133536299461" onmouseenter="enter('-1141458133536299461');" onmouseout="out('-1141458133536299461');" style=""> 204                 case ACTION_DISMISS: {                                                                   </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""> 205                     StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();   </span>
<span class="-2620913793661815477" onmouseenter="enter('-2620913793661815477');" onmouseout="out('-2620913793661815477');" style=""> 206                     Long ts = (Long) mNotificationHandleLookup.lookup(handle);                           </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 207                     if (ts == null) {                                                                    </span>
<span class="2968382775980406642" onmouseenter="enter('2968382775980406642');" onmouseout="out('2968382775980406642');" style=""> 208                         LOG.info(&quot;could not lookup handle for dismiss action&quot;);                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 209                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210                     }                                                                                    </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 211                     for (StatusBarNotification sbn : sbns) {                                             </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 212                         if (sbn.getPostTime() == ts) {                                                   </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 213                             if (GBApplication.isRunningLollipopOrLater()) {                              </span>
<span class="6969546006861717982" onmouseenter="enter('6969546006861717982');" onmouseout="out('6969546006861717982');" style=""> 214                                 String key = sbn.getKey();                                               </span>
<span class="-8910102463751962403" onmouseenter="enter('-8910102463751962403');" onmouseout="out('-8910102463751962403');" style=""> 215                                 NotificationListener.this.cancelNotification(key);                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 216                             } else {                                                                     </span>
<span class="8698193459204911181" onmouseenter="enter('8698193459204911181');" onmouseout="out('8698193459204911181');" style=""> 217                                 int id = sbn.getId();                                                    </span>
<span class="-3586097476318973287" onmouseenter="enter('-3586097476318973287');" onmouseout="out('-3586097476318973287');" style=""> 218                                 String pkg = sbn.getPackageName();                                       </span>
<span class="-8898967747084014814" onmouseenter="enter('-8898967747084014814');" onmouseout="out('-8898967747084014814');" style=""> 219                                 String tag = sbn.getTag();                                               </span>
<span class="-7819421458484381897" onmouseenter="enter('-7819421458484381897');" onmouseout="out('-7819421458484381897');" style=""> 220                                 NotificationListener.this.cancelNotification(pkg, tag, id);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223                     }                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 224                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225                 }                                                                                        </span>
<span class="-6975792259235269251" onmouseenter="enter('-6975792259235269251');" onmouseout="out('-6975792259235269251');" style=""> 226                 case ACTION_DISMISS_ALL:                                                                 </span>
<span class="1530048448958335468" onmouseenter="enter('1530048448958335468');" onmouseout="out('1530048448958335468');" style=""> 227                     NotificationListener.this.cancelAllNotifications();                                  </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 228                     break;                                                                               </span>
<span class="-8033996733174441765" onmouseenter="enter('-8033996733174441765');" onmouseout="out('-8033996733174441765');" style=""> 229                 case ACTION_REPLY:                                                                       </span>
<span class="4738866927376315941" onmouseenter="enter('4738866927376315941');" onmouseout="out('4738866927376315941');" style=""><abbr title=" 230                     NotificationCompat.Action wearableAction = (NotificationCompat.Action) mActionLookup.lookup(handle);"> 230                     NotificationCompat.Action wearableAction = (NotificationCompat.Action) mActionLookup.ðŸ”µ</abbr></span>
<span class="2885762978640892133" onmouseenter="enter('2885762978640892133');" onmouseout="out('2885762978640892133');" style=""> 231                     String reply = intent.getStringExtra(&quot;reply&quot;);                                       </span>
<span class="-2711571343237725875" onmouseenter="enter('-2711571343237725875');" onmouseout="out('-2711571343237725875');" style=""> 232                     if (wearableAction != null) {                                                        </span>
<span class="8382710711087379858" onmouseenter="enter('8382710711087379858');" onmouseout="out('8382710711087379858');" style=""> 233                         PendingIntent actionIntent = wearableAction.getActionIntent();                   </span>
<span class="8988901388813075705" onmouseenter="enter('8988901388813075705');" onmouseout="out('8988901388813075705');" style=""> 234                         Intent localIntent = new Intent();                                               </span>
<span class="7096307769955289231" onmouseenter="enter('7096307769955289231');" onmouseout="out('7096307769955289231');" style=""> 235                         localIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);                             </span>
<span class="-3683679949476668963" onmouseenter="enter('-3683679949476668963');" onmouseout="out('-3683679949476668963');" style=""> 236                         if(wearableAction.getRemoteInputs()!=null) {                                     </span>
<span class="-957754769572110349" onmouseenter="enter('-957754769572110349');" onmouseout="out('-957754769572110349');" style=""> 237                             RemoteInput[] remoteInputs = wearableAction.getRemoteInputs();               </span>
<span class="1776998572180860248" onmouseenter="enter('1776998572180860248');" onmouseout="out('1776998572180860248');" style=""> 238                             Bundle extras = new Bundle();                                                </span>
<span class="2352964158014766609" onmouseenter="enter('2352964158014766609');" onmouseout="out('2352964158014766609');" style=""> 239                             extras.putCharSequence(remoteInputs[0].getResultKey(), reply);               </span>
<span class="5088590721402752136" onmouseenter="enter('5088590721402752136');" onmouseout="out('5088590721402752136');" style=""> 240                             RemoteInput.addResultsToIntent(remoteInputs, localIntent, extras);           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241                         }                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 242                         try {                                                                            </span>
<span class="2300129068579463689" onmouseenter="enter('2300129068579463689');" onmouseout="out('2300129068579463689');" style=""> 243                             LOG.info(&quot;will send exec intent to remote application&quot;);                     </span>
<span class="2731482446525466050" onmouseenter="enter('2731482446525466050');" onmouseout="out('2731482446525466050');" style=""> 244                             actionIntent.send(context, 0, localIntent);                                  </span>
<span class="5952869537434724617" onmouseenter="enter('5952869537434724617');" onmouseout="out('5952869537434724617');" style=""> 245                             mActionLookup.remove(handle);                                                </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 246                         } catch (PendingIntent.CanceledException e) {                                    </span>
<span class="-3367288945438988923" onmouseenter="enter('-3367288945438988923');" onmouseout="out('-3367288945438988923');" style=""> 247                             LOG.warn(&quot;replyToLastNotification error: &quot; + e.getLocalizedMessage());       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249                     }                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 250                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252         }                                                                                                </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 253     };                                                                                                   </span>
<span  style=""> 254                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 255     @Override                                                                                            </span>
<span class="-2716773701189387633" onmouseenter="enter('-2716773701189387633');" onmouseout="out('-2716773701189387633');" style=""> 256     public void onCreate() {                                                                             </span>
<span class="-2958534921295515858" onmouseenter="enter('-2958534921295515858');" onmouseout="out('-2958534921295515858');" style=""> 257         super.onCreate();                                                                                </span>
<span class="7618100238646869770" onmouseenter="enter('7618100238646869770');" onmouseout="out('7618100238646869770');" style=""> 258         IntentFilter filterLocal = new IntentFilter();                                                   </span>
<span class="1063910518920289150" onmouseenter="enter('1063910518920289150');" onmouseout="out('1063910518920289150');" style=""> 259         filterLocal.addAction(GBApplication.ACTION_QUIT);                                                </span>
<span class="2076754442287025975" onmouseenter="enter('2076754442287025975');" onmouseout="out('2076754442287025975');" style=""> 260         filterLocal.addAction(ACTION_OPEN);                                                              </span>
<span class="-6869981444846929258" onmouseenter="enter('-6869981444846929258');" onmouseout="out('-6869981444846929258');" style=""> 261         filterLocal.addAction(ACTION_DISMISS);                                                           </span>
<span class="8695742864955675589" onmouseenter="enter('8695742864955675589');" onmouseout="out('8695742864955675589');" style=""> 262         filterLocal.addAction(ACTION_DISMISS_ALL);                                                       </span>
<span class="3848496335642882317" onmouseenter="enter('3848496335642882317');" onmouseout="out('3848496335642882317');" style=""> 263         filterLocal.addAction(ACTION_MUTE);                                                              </span>
<span class="-4535783496195239094" onmouseenter="enter('-4535783496195239094');" onmouseout="out('-4535783496195239094');" style=""> 264         filterLocal.addAction(ACTION_REPLY);                                                             </span>
<span class="-4279331771748389639" onmouseenter="enter('-4279331771748389639');" onmouseout="out('-4279331771748389639');" style=""> 265         LocalBroadcastManager.getInstance(this).registerReceiver(mReceiver, filterLocal);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266     }                                                                                                    </span>
<span  style=""> 267                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 268     @Override                                                                                            </span>
<span class="658855826062432633" onmouseenter="enter('658855826062432633');" onmouseout="out('658855826062432633');" style=""> 269     public void onDestroy() {                                                                            </span>
<span class="1476506345433791001" onmouseenter="enter('1476506345433791001');" onmouseout="out('1476506345433791001');" style=""> 270         LocalBroadcastManager.getInstance(this).unregisterReceiver(mReceiver);                           </span>
<span class="7275190530034972367" onmouseenter="enter('7275190530034972367');" onmouseout="out('7275190530034972367');" style=""> 271         super.onDestroy();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272     }                                                                                                    </span>
<span  style=""> 273                                                                                                          </span>
<span class="4951847030810611879" onmouseenter="enter('4951847030810611879');" onmouseout="out('4951847030810611879');" style=""> 274     public String getAppName(String pkg) {                                                               </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style=""> 275         // determinate Source App Name (&quot;Label&quot;)                                                         </span>
<span class="-6628567271413355488" onmouseenter="enter('-6628567271413355488');" onmouseout="out('-6628567271413355488');" style=""> 276         PackageManager pm = getPackageManager();                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 277         try {                                                                                            </span>
<span class="2215142249605863035" onmouseenter="enter('2215142249605863035');" onmouseout="out('2215142249605863035');" style=""> 278             return (String)pm.getApplicationLabel(pm.getApplicationInfo(pkg, 0));                        </span>
<span class="8932842947262589349" onmouseenter="enter('8932842947262589349');" onmouseout="out('8932842947262589349');" style=""> 279         } catch (PackageManager.NameNotFoundException e) {                                               </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 280             e.printStackTrace();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 282         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283     }                                                                                                    </span>
<span  style=""> 284                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 285     @Override                                                                                            </span>
<span class="-2772368349505117806" onmouseenter="enter('-2772368349505117806');" onmouseout="out('-2772368349505117806');" style=""> 286     public void onNotificationPosted(StatusBarNotification sbn) {                                        </span>
<span class="6669401580814547638" onmouseenter="enter('6669401580814547638');" onmouseout="out('6669401580814547638');" style=""> 287         if (&quot;call&quot;.equals(sbn.getNotification().category)) {                                             </span>
<span class="-4846577510724576112" onmouseenter="enter('-4846577510724576112');" onmouseout="out('-4846577510724576112');" style=""> 288             handleCallNotification(sbn);                                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 289             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290         }                                                                                                </span>
<span class="2998034859944771870" onmouseenter="enter('2998034859944771870');" onmouseout="out('2998034859944771870');" style=""> 291         if (shouldIgnore(sbn)) {                                                                         </span>
<span class="-3980483839174328253" onmouseenter="enter('-3980483839174328253');" onmouseout="out('-3980483839174328253');" style=""> 292             LOG.info(&quot;Ignore notification&quot;);                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 293             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294         }                                                                                                </span>
<span  style=""> 295                                                                                                          </span>
<span  style=""> 296                                                                                                          </span>
<span  style=""> 297                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 298         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span  style=""> 299                                                                                                          </span>
<span class="8054135432811402885" onmouseenter="enter('8054135432811402885');" onmouseout="out('8054135432811402885');" style=""> 300         switch (GBApplication.getGrantedInterruptionFilter()) {                                          </span>
<span class="4109165554183544277" onmouseenter="enter('4109165554183544277');" onmouseout="out('4109165554183544277');" style=""> 301             case NotificationManager.INTERRUPTION_FILTER_ALL:                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 302                 break;                                                                                   </span>
<span class="-4951181644409102304" onmouseenter="enter('-4951181644409102304');" onmouseout="out('-4951181644409102304');" style=""> 303             case NotificationManager.INTERRUPTION_FILTER_ALARMS:                                         </span>
<span class="7344230421954560306" onmouseenter="enter('7344230421954560306');" onmouseout="out('7344230421954560306');" style=""> 304             case NotificationManager.INTERRUPTION_FILTER_NONE:                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 305                 return;                                                                                  </span>
<span class="-4328737131563524650" onmouseenter="enter('-4328737131563524650');" onmouseout="out('-4328737131563524650');" style=""> 306             case NotificationManager.INTERRUPTION_FILTER_PRIORITY:                                       </span>
<span class="8591867555140901755" onmouseenter="enter('8591867555140901755');" onmouseout="out('8591867555140901755');" style=""> 307                 // FIXME: Handle Reminders and Events if they are enabled in Do Not Disturb              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 308                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309         }                                                                                                </span>
<span  style=""> 310                                                                                                          </span>
<span class="3332016722812204086" onmouseenter="enter('3332016722812204086');" onmouseout="out('3332016722812204086');" style=""> 311         String source = sbn.getPackageName().toLowerCase();                                              </span>
<span class="2830045728262824638" onmouseenter="enter('2830045728262824638');" onmouseout="out('2830045728262824638');" style=""> 312         Notification notification = sbn.getNotification();                                               </span>
<span class="4218475881538878307" onmouseenter="enter('4218475881538878307');" onmouseout="out('4218475881538878307');" style=""> 313         if (notificationOldRepeatPrevention.containsKey(source)) {                                       </span>
<span class="6155853035860803703" onmouseenter="enter('6155853035860803703');" onmouseout="out('6155853035860803703');" style=""> 314             if (notification.when &lt;= notificationOldRepeatPrevention.get(source)) {                      </span>
<span class="-4118070098413074653" onmouseenter="enter('-4118070098413074653');" onmouseout="out('-4118070098413074653');" style=""><abbr title=" 315                 LOG.info(&quot;NOT processing notification, already sent newer notifications from this source.&quot;);"> 315                 LOG.info(&quot;NOT processing notification, already sent newer notifications from this source.ðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 316                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318         }                                                                                                </span>
<span  style=""> 319                                                                                                          </span>
<span class="-5834893131205351970" onmouseenter="enter('-5834893131205351970');" onmouseout="out('-5834893131205351970');" style=""> 320         // Ignore too frequent notifications, according to user preference                               </span>
<span class="8739203694966910315" onmouseenter="enter('8739203694966910315');" onmouseout="out('8739203694966910315');" style=""> 321         long min_timeout = (long)prefs.getInt(&quot;notifications_timeout&quot;, 0) * 1000L;                       </span>
<span class="7158364678624901735" onmouseenter="enter('7158364678624901735');" onmouseout="out('7158364678624901735');" style=""> 322         long cur_time = System.currentTimeMillis();                                                      </span>
<span class="4691272725591601941" onmouseenter="enter('4691272725591601941');" onmouseout="out('4691272725591601941');" style=""> 323         if (notificationBurstPrevention.containsKey(source)) {                                           </span>
<span class="-7388621012045880255" onmouseenter="enter('-7388621012045880255');" onmouseout="out('-7388621012045880255');" style=""> 324             long last_time = notificationBurstPrevention.get(source);                                    </span>
<span class="8371821158922557754" onmouseenter="enter('8371821158922557754');" onmouseout="out('8371821158922557754');" style=""> 325             if (cur_time - last_time &lt; min_timeout) {                                                    </span>
<span class="761193726766758320" onmouseenter="enter('761193726766758320');" onmouseout="out('761193726766758320');" style=""><abbr title=" 326                 LOG.info(&quot;Ignoring frequent notification, last one was &quot; + (cur_time - last_time) + &quot;ms ago&quot;);"> 326                 LOG.info(&quot;Ignoring frequent notification, last one was &quot; + (cur_time - last_time) + &quot;ms aðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 327                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 329         }                                                                                                </span>
<span  style=""> 330                                                                                                          </span>
<span class="4249292218927487361" onmouseenter="enter('4249292218927487361');" onmouseout="out('4249292218927487361');" style=""> 331         NotificationSpec notificationSpec = new NotificationSpec();                                      </span>
<span  style=""> 332                                                                                                          </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style=""> 333         // determinate Source App Name (&quot;Label&quot;)                                                         </span>
<span class="-1232802106572556205" onmouseenter="enter('-1232802106572556205');" onmouseout="out('-1232802106572556205');" style=""> 334         String name = getAppName(source);                                                                </span>
<span class="8801601261434726216" onmouseenter="enter('8801601261434726216');" onmouseout="out('8801601261434726216');" style=""> 335         if (name != null) {                                                                              </span>
<span class="3305632254012197272" onmouseenter="enter('3305632254012197272');" onmouseout="out('3305632254012197272');" style=""> 336             notificationSpec.sourceName = name;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337         }                                                                                                </span>
<span  style=""> 338                                                                                                          </span>
<span class="-7581221946487094265" onmouseenter="enter('-7581221946487094265');" onmouseout="out('-7581221946487094265');" style=""> 339         boolean preferBigText = false;                                                                   </span>
<span  style=""> 340                                                                                                          </span>
<span class="-1916386255928229930" onmouseenter="enter('-1916386255928229930');" onmouseout="out('-1916386255928229930');" style=""><abbr title=" 341         // Get the app ID that generated this notification. For now only used by pebble color, but may be more useful later."> 341         // Get the app ID that generated this notification. For now only used by pebble color, but may beðŸ”µ</abbr></span>
<span class="-8067455375416267049" onmouseenter="enter('-8067455375416267049');" onmouseout="out('-8067455375416267049');" style=""> 342         notificationSpec.sourceAppId = source;                                                           </span>
<span  style=""> 343                                                                                                          </span>
<span class="-2810132766447661631" onmouseenter="enter('-2810132766447661631');" onmouseout="out('-2810132766447661631');" style=""> 344         notificationSpec.type = AppNotificationType.getInstance().get(source);                           </span>
<span  style=""> 345                                                                                                          </span>
<span class="-7540601865424540593" onmouseenter="enter('-7540601865424540593');" onmouseout="out('-7540601865424540593');" style=""> 346         //FIXME: some quirks lookup table would be the minor evil here                                   </span>
<span class="2207563395624266113" onmouseenter="enter('2207563395624266113');" onmouseout="out('2207563395624266113');" style=""> 347         if (source.startsWith(&quot;com.fsck.k9&quot;)) {                                                          </span>
<span class="-8461204742030134802" onmouseenter="enter('-8461204742030134802');" onmouseout="out('-8461204742030134802');" style=""> 348             if (NotificationCompat.isGroupSummary(notification)) {                                       </span>
<span class="3811797734502814406" onmouseenter="enter('3811797734502814406');" onmouseout="out('3811797734502814406');" style=""> 349                 LOG.info(&quot;ignore K9 group summary&quot;);                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 350                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351             }                                                                                            </span>
<span class="5839263120304468869" onmouseenter="enter('5839263120304468869');" onmouseout="out('5839263120304468869');" style=""> 352             preferBigText = true;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353         }                                                                                                </span>
<span  style=""> 354                                                                                                          </span>
<span class="4253328762370341177" onmouseenter="enter('4253328762370341177');" onmouseout="out('4253328762370341177');" style=""> 355         if (notificationSpec.type == null) {                                                             </span>
<span class="954876523018596305" onmouseenter="enter('954876523018596305');" onmouseout="out('954876523018596305');" style=""> 356             notificationSpec.type = NotificationType.UNKNOWN;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357         }                                                                                                </span>
<span  style=""> 358                                                                                                          </span>
<span class="8812080595679134351" onmouseenter="enter('8812080595679134351');" onmouseout="out('8812080595679134351');" style=""> 359         // Get color                                                                                     </span>
<span class="-7215379846374020112" onmouseenter="enter('-7215379846374020112');" onmouseout="out('-7215379846374020112');" style=""> 360         notificationSpec.pebbleColor = getPebbleColorForNotification(notificationSpec);                  </span>
<span  style=""> 361                                                                                                          </span>
<span class="-2694685924632068401" onmouseenter="enter('-2694685924632068401');" onmouseout="out('-2694685924632068401');" style=""><abbr title=" 362         LOG.info(&quot;Processing notification &quot; + notificationSpec.getId() + &quot; age: &quot; + (System.currentTimeMillis() - notification.when) + &quot; from source &quot; + source + &quot; with flags: &quot; + notification.flags);"> 362         LOG.info(&quot;Processing notification &quot; + notificationSpec.getId() + &quot; age: &quot; + (System.currentTimeMiðŸ”µ</abbr></span>
<span  style=""> 363                                                                                                          </span>
<span class="-5865600179971875271" onmouseenter="enter('-5865600179971875271');" onmouseout="out('-5865600179971875271');" style=""> 364         dissectNotificationTo(notification, notificationSpec, preferBigText);                            </span>
<span  style=""> 365                                                                                                          </span>
<span class="3953264596152234401" onmouseenter="enter('3953264596152234401');" onmouseout="out('3953264596152234401');" style=""><abbr title=" 366         if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificationSpec.body)) {"> 366         if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificatioðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 367             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 368         }                                                                                                </span>
<span  style=""> 369                                                                                                          </span>
<span  style=""> 370                                                                                                          </span>
<span class="668617636634990568" onmouseenter="enter('668617636634990568');" onmouseout="out('668617636634990568');" style=""> 371         // ignore Gadgetbridge&#x27;s very own notifications, except for those from the debug screen          </span>
<span class="8240704894033078509" onmouseenter="enter('8240704894033078509');" onmouseout="out('8240704894033078509');" style=""> 372         if (getApplicationContext().getPackageName().equals(source)) {                                   </span>
<span class="-4005163798104538430" onmouseenter="enter('-4005163798104538430');" onmouseout="out('-4005163798104538430');" style=""><abbr title=" 373             if (!getApplicationContext().getString(R.string.test_notification).equals(notificationSpec.title)) {"> 373             if (!getApplicationContext().getString(R.string.test_notification).equals(notificationSpec.tiðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 374                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376         }                                                                                                </span>
<span  style=""> 377                                                                                                          </span>
<span class="3032759621835437424" onmouseenter="enter('3032759621835437424');" onmouseout="out('3032759621835437424');" style=""><abbr title=" 378         NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(notification);"> 378         NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(noðŸ”µ</abbr></span>
<span class="-1472750016987720650" onmouseenter="enter('-1472750016987720650');" onmouseout="out('-1472750016987720650');" style=""> 379         List&lt;NotificationCompat.Action&gt; actions = wearableExtender.getActions();                         </span>
<span  style=""> 380                                                                                                          </span>
<span  style=""> 381                                                                                                          </span>
<span class="7774033817539746019" onmouseenter="enter('7774033817539746019');" onmouseout="out('7774033817539746019');" style=""><abbr title=" 382         if (actions.size() == 0 &amp;&amp; NotificationCompat.isGroupSummary(notification)) { //this could cause #395 to come back"> 382         if (actions.size() == 0 &amp;&amp; NotificationCompat.isGroupSummary(notification)) { //this could cause ðŸ”µ</abbr></span>
<span class="-2600295662498564908" onmouseenter="enter('-2600295662498564908');" onmouseout="out('-2600295662498564908');" style=""><abbr title=" 383             LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action present. Notification flags: &quot; + notification.flags);"> 383             LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action preseðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 384             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385         }                                                                                                </span>
<span  style=""> 386                                                                                                          </span>
<span class="-5917197971696016550" onmouseenter="enter('-5917197971696016550');" onmouseout="out('-5917197971696016550');" style=""> 387         notificationSpec.attachedActions = new ArrayList&lt;&gt;();                                            </span>
<span  style=""> 388                                                                                                          </span>
<span class="6824678123821134026" onmouseenter="enter('6824678123821134026');" onmouseout="out('6824678123821134026');" style=""> 389         // DISMISS action                                                                                </span>
<span class="5533936039133318070" onmouseenter="enter('5533936039133318070');" onmouseout="out('5533936039133318070');" style=""> 390         NotificationSpec.Action dismissAction = new NotificationSpec.Action();                           </span>
<span class="-2035191731043357921" onmouseenter="enter('-2035191731043357921');" onmouseout="out('-2035191731043357921');" style=""> 391         dismissAction.title = &quot;Dismiss&quot;;                                                                 </span>
<span class="5737664600017371521" onmouseenter="enter('5737664600017371521');" onmouseout="out('5737664600017371521');" style=""> 392         dismissAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_DISMISS;                             </span>
<span class="-4673031657134511356" onmouseenter="enter('-4673031657134511356');" onmouseout="out('-4673031657134511356');" style=""> 393         notificationSpec.attachedActions.add(dismissAction);                                             </span>
<span  style=""> 394                                                                                                          </span>
<span class="-8264806993566587236" onmouseenter="enter('-8264806993566587236');" onmouseout="out('-8264806993566587236');" style=""> 395         for (NotificationCompat.Action act : actions) {                                                  </span>
<span class="-5026732361501841882" onmouseenter="enter('-5026732361501841882');" onmouseout="out('-5026732361501841882');" style=""> 396             if (act != null) {                                                                           </span>
<span class="-5786483650500220153" onmouseenter="enter('-5786483650500220153');" onmouseout="out('-5786483650500220153');" style=""> 397                 NotificationSpec.Action wearableAction = new NotificationSpec.Action();                  </span>
<span class="911429091199110596" onmouseenter="enter('911429091199110596');" onmouseout="out('911429091199110596');" style=""> 398                 wearableAction.title = act.getTitle().toString();                                        </span>
<span class="5243119547087092802" onmouseenter="enter('5243119547087092802');" onmouseout="out('5243119547087092802');" style=""> 399                 if(act.getRemoteInputs()!=null) {                                                        </span>
<span class="3631843705460318974" onmouseenter="enter('3631843705460318974');" onmouseout="out('3631843705460318974');" style=""> 400                     wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_REPLY;                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 401                 } else {                                                                                 </span>
<span class="5019071376909091625" onmouseenter="enter('5019071376909091625');" onmouseout="out('5019071376909091625');" style=""> 402                     wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_SIMPLE;                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403                 }                                                                                        </span>
<span  style=""> 404                                                                                                          </span>
<span class="3300319972847919808" onmouseenter="enter('3300319972847919808');" onmouseout="out('3300319972847919808');" style=""> 405                 notificationSpec.attachedActions.add(wearableAction);                                    </span>
<span class="-7038376970573634272" onmouseenter="enter('-7038376970573634272');" onmouseout="out('-7038376970573634272');" style=""><abbr title=" 406                 mActionLookup.add((notificationSpec.getId()&lt;&lt;4) + notificationSpec.attachedActions.size(), act);"> 406                 mActionLookup.add((notificationSpec.getId()&lt;&lt;4) + notificationSpec.attachedActions.size()ðŸ”µ</abbr></span>
<span class="1537265167944677779" onmouseenter="enter('1537265167944677779');" onmouseout="out('1537265167944677779');" style=""><abbr title=" 407                 LOG.info(&quot;found wearable action: &quot; + notificationSpec.attachedActions.size() + &quot; - &quot;+ act.getTitle() + &quot;  &quot; + sbn.getTag());"> 407                 LOG.info(&quot;found wearable action: &quot; + notificationSpec.attachedActions.size() + &quot; - &quot;+ actðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 408             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 409         }                                                                                                </span>
<span  style=""> 410                                                                                                          </span>
<span class="7347352498327901971" onmouseenter="enter('7347352498327901971');" onmouseout="out('7347352498327901971');" style=""> 411         // OPEN action                                                                                   </span>
<span class="6797092604605164688" onmouseenter="enter('6797092604605164688');" onmouseout="out('6797092604605164688');" style=""> 412         NotificationSpec.Action openAction = new NotificationSpec.Action();                              </span>
<span class="8898599446651645486" onmouseenter="enter('8898599446651645486');" onmouseout="out('8898599446651645486');" style=""> 413         openAction.title = getString(R.string._pebble_watch_open_on_phone);                              </span>
<span class="620332764476499952" onmouseenter="enter('620332764476499952');" onmouseout="out('620332764476499952');" style=""> 414         openAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_OPEN;                                   </span>
<span class="-654055199082716612" onmouseenter="enter('-654055199082716612');" onmouseout="out('-654055199082716612');" style=""> 415         notificationSpec.attachedActions.add(openAction);                                                </span>
<span  style=""> 416                                                                                                          </span>
<span class="2264132042552456605" onmouseenter="enter('2264132042552456605');" onmouseout="out('2264132042552456605');" style=""> 417         // MUTE action                                                                                   </span>
<span class="-8712525482035557123" onmouseenter="enter('-8712525482035557123');" onmouseout="out('-8712525482035557123');" style=""> 418         NotificationSpec.Action muteAction = new NotificationSpec.Action();                              </span>
<span class="-8110587689026159862" onmouseenter="enter('-8110587689026159862');" onmouseout="out('-8110587689026159862');" style=""> 419         muteAction.title = getString(R.string._pebble_watch_mute);                                       </span>
<span class="6211637458858479364" onmouseenter="enter('6211637458858479364');" onmouseout="out('6211637458858479364');" style=""> 420         muteAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_MUTE;                                   </span>
<span class="1775691680583302265" onmouseenter="enter('1775691680583302265');" onmouseout="out('1775691680583302265');" style=""> 421         notificationSpec.attachedActions.add(muteAction);                                                </span>
<span  style=""> 422                                                                                                          </span>
<span class="-476558653827405923" onmouseenter="enter('-476558653827405923');" onmouseout="out('-476558653827405923');" style=""><abbr title=" 423         mNotificationHandleLookup.add(notificationSpec.getId(), sbn.getPostTime()); // for both DISMISS and OPEN"> 423         mNotificationHandleLookup.add(notificationSpec.getId(), sbn.getPostTime()); // for both DISMISS aðŸ”µ</abbr></span>
<span class="8153579199557574199" onmouseenter="enter('8153579199557574199');" onmouseout="out('8153579199557574199');" style=""> 424         mPackageLookup.add(notificationSpec.getId(), sbn.getPackageName()); // for MUTE                  </span>
<span  style=""> 425                                                                                                          </span>
<span class="5979670797208442666" onmouseenter="enter('5979670797208442666');" onmouseout="out('5979670797208442666');" style=""> 426         notificationBurstPrevention.put(source, cur_time);                                               </span>
<span class="5546492408732750715" onmouseenter="enter('5546492408732750715');" onmouseout="out('5546492408732750715');" style=""> 427         if(0 != notification.when) {                                                                     </span>
<span class="-7718619408843379706" onmouseenter="enter('-7718619408843379706');" onmouseout="out('-7718619408843379706');" style=""> 428             notificationOldRepeatPrevention.put(source, notification.when);                              </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 429         }else {                                                                                          </span>
<span class="-1627147369441390095" onmouseenter="enter('-1627147369441390095');" onmouseout="out('-1627147369441390095');" style=""><abbr title=" 430             LOG.info(&quot;This app might show old/duplicate notifications. notification.when is 0 for &quot; + source);"> 430             LOG.info(&quot;This app might show old/duplicate notifications. notification.when is 0 for &quot; + souðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 431         }                                                                                                </span>
<span  style=""> 432                                                                                                          </span>
<span class="9189856510229218442" onmouseenter="enter('9189856510229218442');" onmouseout="out('9189856510229218442');" style=""> 433         GBApplication.deviceService().onNotification(notificationSpec);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 434     }                                                                                                    </span>
<span  style=""> 435                                                                                                          </span>
<span class="3489513600177556550" onmouseenter="enter('3489513600177556550');" onmouseout="out('3489513600177556550');" style=""> 436     private boolean checkNotificationContentForWhiteAndBlackList(String packageName, String body) {      </span>
<span class="-150679469252815152" onmouseenter="enter('-150679469252815152');" onmouseout="out('-150679469252815152');" style=""> 437         long start = System.currentTimeMillis();                                                         </span>
<span  style=""> 438                                                                                                          </span>
<span class="2124734257009739137" onmouseenter="enter('2124734257009739137');" onmouseout="out('2124734257009739137');" style=""> 439         List&lt;String&gt; wordsList = new ArrayList&lt;&gt;();                                                      </span>
<span class="8513213831196998490" onmouseenter="enter('8513213831196998490');" onmouseout="out('8513213831196998490');" style=""> 440         NotificationFilter notificationFilter;                                                           </span>
<span  style=""> 441                                                                                                          </span>
<span class="-4590804423150229551" onmouseenter="enter('-4590804423150229551');" onmouseout="out('-4590804423150229551');" style=""> 442         try (DBHandler db = GBApplication.acquireDB()) {                                                 </span>
<span  style=""> 443                                                                                                          </span>
<span class="2403890883362572333" onmouseenter="enter('2403890883362572333');" onmouseout="out('2403890883362572333');" style=""> 444             NotificationFilterDao notificationFilterDao = db.getDaoSession().getNotificationFilterDao(); </span>
<span class="7254238877040119420" onmouseenter="enter('7254238877040119420');" onmouseout="out('7254238877040119420');" style=""><abbr title=" 445             NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilterEntryDao();"> 445             NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilðŸ”µ</abbr></span>
<span  style=""> 446                                                                                                          </span>
<span class="-4728567184917764691" onmouseenter="enter('-4728567184917764691');" onmouseout="out('-4728567184917764691');" style=""><abbr title=" 447             Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFilterDao.Properties.AppIdentifier.eq(packageName.toLowerCase())).build();"> 447             Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFiltðŸ”µ</abbr></span>
<span class="7488324375938324162" onmouseenter="enter('7488324375938324162');" onmouseout="out('7488324375938324162');" style=""> 448             notificationFilter = query.unique();                                                         </span>
<span  style=""> 449                                                                                                          </span>
<span class="6018560877068628254" onmouseenter="enter('6018560877068628254');" onmouseout="out('6018560877068628254');" style=""> 450             if (notificationFilter == null) {                                                            </span>
<span class="8510731869572739415" onmouseenter="enter('8510731869572739415');" onmouseout="out('8510731869572739415');" style=""> 451                 LOG.debug(&quot;No Notification Filter found&quot;);                                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 452                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 453             }                                                                                            </span>
<span  style=""> 454                                                                                                          </span>
<span class="3968012753441467210" onmouseenter="enter('3968012753441467210');" onmouseout="out('3968012753441467210');" style=""> 455             LOG.debug(&quot;Loaded notification filter for &#x27;{}&#x27;&quot;, packageName);                               </span>
<span class="7966618056150210259" onmouseenter="enter('7966618056150210259');" onmouseout="out('7966618056150210259');" style=""><abbr title=" 456             Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().where(NotificationFilterEntryDao.Properties.NotificationFilterId.eq(notificationFilter.getId())).build();"> 456             Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().whereðŸ”µ</abbr></span>
<span  style=""> 457                                                                                                          </span>
<span class="5592374987839394879" onmouseenter="enter('5592374987839394879');" onmouseout="out('5592374987839394879');" style=""> 458             List&lt;NotificationFilterEntry&gt; filterEntries = queryEntries.list();                           </span>
<span  style=""> 459                                                                                                          </span>
<span class="-8976969426120877151" onmouseenter="enter('-8976969426120877151');" onmouseout="out('-8976969426120877151');" style=""> 460             if (BuildConfig.DEBUG) {                                                                     </span>
<span class="-9170185973081630678" onmouseenter="enter('-9170185973081630678');" onmouseout="out('-9170185973081630678');" style=""> 461                 LOG.info(&quot;Database lookup took &#x27;{}&#x27; ms&quot;, System.currentTimeMillis() - start);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 462             }                                                                                            </span>
<span  style=""> 463                                                                                                          </span>
<span class="2077893056906600600" onmouseenter="enter('2077893056906600600');" onmouseout="out('2077893056906600600');" style=""> 464             if (!filterEntries.isEmpty()) {                                                              </span>
<span class="4304008491784528731" onmouseenter="enter('4304008491784528731');" onmouseout="out('4304008491784528731');" style=""> 465                 for (NotificationFilterEntry temp : filterEntries) {                                     </span>
<span class="4808262139369052558" onmouseenter="enter('4808262139369052558');" onmouseout="out('4808262139369052558');" style=""> 466                     wordsList.add(temp.getNotificationFilterContent());                                  </span>
<span class="-2502897764394929378" onmouseenter="enter('-2502897764394929378');" onmouseout="out('-2502897764394929378');" style=""> 467                     LOG.debug(&quot;Loaded filter word: &quot; + temp.getNotificationFilterContent());             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 468                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469             }                                                                                            </span>
<span  style=""> 470                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 471         } catch (Exception e) {                                                                          </span>
<span class="-7390176680812789235" onmouseenter="enter('-7390176680812789235');" onmouseout="out('-7390176680812789235');" style=""> 472             LOG.error(&quot;Could not acquire DB.&quot;, e);                                                       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 473             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 474         }                                                                                                </span>
<span  style=""> 475                                                                                                          </span>
<span class="-2837061757343239904" onmouseenter="enter('-2837061757343239904');" onmouseout="out('-2837061757343239904');" style=""> 476         return shouldContinueAfterFilter(body, wordsList, notificationFilter);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 477     }                                                                                                    </span>
<span  style=""> 478                                                                                                          </span>
<span class="-5392793857622727834" onmouseenter="enter('-5392793857622727834');" onmouseout="out('-5392793857622727834');" style=""> 479     private void handleCallNotification(StatusBarNotification sbn) {                                     </span>
<span class="-2635029824573834340" onmouseenter="enter('-2635029824573834340');" onmouseout="out('-2635029824573834340');" style=""> 480         String app = sbn.getPackageName();                                                               </span>
<span class="-4765460655732789674" onmouseenter="enter('-4765460655732789674');" onmouseout="out('-4765460655732789674');" style=""> 481         LOG.debug(&quot;got call from: &quot; + app);                                                              </span>
<span class="-1087669074367115225" onmouseenter="enter('-1087669074367115225');" onmouseout="out('-1087669074367115225');" style=""> 482         if(app.equals(&quot;com.android.dialer&quot;)) {                                                           </span>
<span class="5503604353212721032" onmouseenter="enter('5503604353212721032');" onmouseout="out('5503604353212721032');" style=""> 483             LOG.debug(&quot;Ignoring non-voip call&quot;);                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 484             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485         }                                                                                                </span>
<span class="2515184326717332924" onmouseenter="enter('2515184326717332924');" onmouseout="out('2515184326717332924');" style=""> 486         Notification noti = sbn.getNotification();                                                       </span>
<span class="4917333921300541045" onmouseenter="enter('4917333921300541045');" onmouseout="out('4917333921300541045');" style=""> 487         dumpExtras(noti.extras);                                                                         </span>
<span class="7056760971959382883" onmouseenter="enter('7056760971959382883');" onmouseout="out('7056760971959382883');" style=""> 488         if(noti.actions != null &amp;&amp; noti.actions.length &gt; 0) {                                            </span>
<span class="-8283553374130078748" onmouseenter="enter('-8283553374130078748');" onmouseout="out('-8283553374130078748');" style=""> 489             for (Notification.Action action : noti.actions) {                                            </span>
<span class="4712881017428392998" onmouseenter="enter('4712881017428392998');" onmouseout="out('4712881017428392998');" style=""> 490                 LOG.info(&quot;Found call action: &quot; + action.title);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 491             }                                                                                            </span>
<span class="5573696862010733553" onmouseenter="enter('5573696862010733553');" onmouseout="out('5573696862010733553');" style=""> 492             /*try {                                                                                      </span>
<span class="-4941077910751273482" onmouseenter="enter('-4941077910751273482');" onmouseout="out('-4941077910751273482');" style=""> 493                 LOG.info(&quot;Executing first action&quot;);                                                      </span>
<span class="-6079407865140020178" onmouseenter="enter('-6079407865140020178');" onmouseout="out('-6079407865140020178');" style=""> 494                 noti.actions[0].actionIntent.send();                                                     </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 495             } catch (PendingIntent.CanceledException e) {                                                </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 496                 e.printStackTrace();                                                                     </span>
<span class="-2684617365274670769" onmouseenter="enter('-2684617365274670769');" onmouseout="out('-2684617365274670769');" style=""> 497             }*/                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498         }                                                                                                </span>
<span  style=""> 499                                                                                                          </span>
<span class="-2563571895899526728" onmouseenter="enter('-2563571895899526728');" onmouseout="out('-2563571895899526728');" style=""> 500         // figure out sender                                                                             </span>
<span class="-9123115817740196080" onmouseenter="enter('-9123115817740196080');" onmouseout="out('-9123115817740196080');" style=""> 501         String number;                                                                                   </span>
<span class="-83871468585037136" onmouseenter="enter('-83871468585037136');" onmouseout="out('-83871468585037136');" style=""> 502         if(noti.extras.containsKey(Notification.EXTRA_PEOPLE)) {                                         </span>
<span class="-9087853976002790509" onmouseenter="enter('-9087853976002790509');" onmouseout="out('-9087853976002790509');" style=""> 503             number = noti.extras.getString(Notification.EXTRA_PEOPLE);                                   </span>
<span class="-2430024668957447800" onmouseenter="enter('-2430024668957447800');" onmouseout="out('-2430024668957447800');" style=""> 504         } else if(noti.extras.containsKey(Notification.EXTRA_TITLE)) {                                   </span>
<span class="-6437685763050744480" onmouseenter="enter('-6437685763050744480');" onmouseout="out('-6437685763050744480');" style=""> 505             number = noti.extras.getString(Notification.EXTRA_TITLE);                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 506         } else {                                                                                         </span>
<span class="8266080573880164526" onmouseenter="enter('8266080573880164526');" onmouseout="out('8266080573880164526');" style=""> 507             String appName = getAppName(app);                                                            </span>
<span class="3077870662190147275" onmouseenter="enter('3077870662190147275');" onmouseout="out('3077870662190147275');" style=""> 508             number = appName != null ? appName : app;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 509         }                                                                                                </span>
<span class="-2521654618349415592" onmouseenter="enter('-2521654618349415592');" onmouseout="out('-2521654618349415592');" style=""> 510         activeCallPostTime = sbn.getPostTime();                                                          </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style=""> 511         CallSpec callSpec = new CallSpec();                                                              </span>
<span class="6754379566106160474" onmouseenter="enter('6754379566106160474');" onmouseout="out('6754379566106160474');" style=""> 512         callSpec.number = number;                                                                        </span>
<span class="-4416193589830976087" onmouseenter="enter('-4416193589830976087');" onmouseout="out('-4416193589830976087');" style=""> 513         callSpec.command = CallSpec.CALL_INCOMING;                                                       </span>
<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style=""> 514         GBApplication.deviceService().onSetCallState(callSpec);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 515     }                                                                                                    </span>
<span  style=""> 516                                                                                                          </span>
<span class="2011726315289648221" onmouseenter="enter('2011726315289648221');" onmouseout="out('2011726315289648221');" style=""><abbr title=" 517     boolean shouldContinueAfterFilter(@NonNull String body, @NonNull List&lt;String&gt; wordsList, @NonNull NotificationFilter notificationFilter) {"> 517     boolean shouldContinueAfterFilter(@NonNull String body, @NonNull List&lt;String&gt; wordsList, @NonNull NotðŸ”µ</abbr></span>
<span  style=""> 518                                                                                                          </span>
<span class="-2049928826508332953" onmouseenter="enter('-2049928826508332953');" onmouseout="out('-2049928826508332953');" style=""><abbr title=" 519         LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterMode(), notificationFilter.getNotificationFilterSubMode(), wordsList);"> 519         LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterModðŸ”µ</abbr></span>
<span  style=""> 520                                                                                                          </span>
<span class="2466831550918903346" onmouseenter="enter('2466831550918903346');" onmouseout="out('2466831550918903346');" style=""><abbr title=" 521         boolean allMode = notificationFilter.getNotificationFilterSubMode() == NOTIFICATION_FILTER_SUBMODE_ALL;"> 521         boolean allMode = notificationFilter.getNotificationFilterSubMode() == NOTIFICATION_FILTER_SUBMODðŸ”µ</abbr></span>
<span  style=""> 522                                                                                                          </span>
<span class="7111790076547269568" onmouseenter="enter('7111790076547269568');" onmouseout="out('7111790076547269568');" style=""> 523         switch (notificationFilter.getNotificationFilterMode()) {                                        </span>
<span class="9010216302027839769" onmouseenter="enter('9010216302027839769');" onmouseout="out('9010216302027839769');" style=""> 524             case NOTIFICATION_FILTER_MODE_BLACKLIST:                                                     </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 525                 if (allMode) {                                                                           </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 526                     for (String word : wordsList) {                                                      </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 527                         if (!body.contains(word)) {                                                      </span>
<span class="-6541716343086786985" onmouseenter="enter('-6541716343086786985');" onmouseout="out('-6541716343086786985');" style=""><abbr title=" 528                             LOG.info(&quot;Not every word was found, blacklist has no effect, processing continues.&quot;);"> 528                             LOG.info(&quot;Not every word was found, blacklist has no effect, processing contiðŸ”µ</abbr></span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 529                             return true;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 530                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 531                     }                                                                                    </span>
<span class="7128342962819519611" onmouseenter="enter('7128342962819519611');" onmouseout="out('7128342962819519611');" style=""> 532                     LOG.info(&quot;Every word was found, blacklist has effect, processing stops.&quot;);           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 533                     return false;                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 534                 } else {                                                                                 </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""><abbr title=" 535                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));"> 535                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequencðŸ”µ</abbr></span>
<span class="-6184990871390026912" onmouseenter="enter('-6184990871390026912');" onmouseout="out('-6184990871390026912');" style=""> 536                     if (!containsAny) {                                                                  </span>
<span class="-8299034583350120850" onmouseenter="enter('-8299034583350120850');" onmouseout="out('-8299034583350120850');" style=""><abbr title=" 537                         LOG.info(&quot;No matching word was found, blacklist has no effect, processing continues.&quot;);"> 537                         LOG.info(&quot;No matching word was found, blacklist has no effect, processing continuðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 538                     } else {                                                                             </span>
<span class="-1380690990253575343" onmouseenter="enter('-1380690990253575343');" onmouseout="out('-1380690990253575343');" style=""><abbr title=" 539                         LOG.info(&quot;At least one matching word was found, blacklist has effect, processing stops.&quot;);"> 539                         LOG.info(&quot;At least one matching word was found, blacklist has effect, processing ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 540                     }                                                                                    </span>
<span class="3895372753413352625" onmouseenter="enter('3895372753413352625');" onmouseout="out('3895372753413352625');" style=""> 541                     return !containsAny;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 542                 }                                                                                        </span>
<span  style=""> 543                                                                                                          </span>
<span class="-7619441502433256183" onmouseenter="enter('-7619441502433256183');" onmouseout="out('-7619441502433256183');" style=""> 544             case NOTIFICATION_FILTER_MODE_WHITELIST:                                                     </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 545                 if (allMode) {                                                                           </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 546                     for (String word : wordsList) {                                                      </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 547                         if (!body.contains(word)) {                                                      </span>
<span class="-2193044683137963048" onmouseenter="enter('-2193044683137963048');" onmouseout="out('-2193044683137963048');" style=""><abbr title=" 548                             LOG.info(&quot;Not every word was found, whitelist has no effect, processing stops.&quot;);"> 548                             LOG.info(&quot;Not every word was found, whitelist has no effect, processing stopsðŸ”µ</abbr></span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 549                             return false;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 550                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 551                     }                                                                                    </span>
<span class="7060257086642023362" onmouseenter="enter('7060257086642023362');" onmouseout="out('7060257086642023362');" style=""> 552                     LOG.info(&quot;Every word was found, whitelist has effect, processing continues.&quot;);       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 553                     return true;                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 554                 } else {                                                                                 </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""><abbr title=" 555                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));"> 555                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequencðŸ”µ</abbr></span>
<span class="-340597820517180781" onmouseenter="enter('-340597820517180781');" onmouseout="out('-340597820517180781');" style=""> 556                     if (containsAny) {                                                                   </span>
<span class="-1881072703439588003" onmouseenter="enter('-1881072703439588003');" onmouseout="out('-1881072703439588003');" style=""><abbr title=" 557                         LOG.info(&quot;At least one matching word was found, whitelist has effect, processing continues.&quot;);"> 557                         LOG.info(&quot;At least one matching word was found, whitelist has effect, processing ðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 558                     } else {                                                                             </span>
<span class="2098487797015691396" onmouseenter="enter('2098487797015691396');" onmouseout="out('2098487797015691396');" style=""><abbr title=" 559                         LOG.info(&quot;No matching word was found, whitelist has no effect, processing stops.&quot;);"> 559                         LOG.info(&quot;No matching word was found, whitelist has no effect, processing stops.&quot;ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 560                     }                                                                                    </span>
<span class="1941886136813063182" onmouseenter="enter('1941886136813063182');" onmouseout="out('1941886136813063182');" style=""> 561                     return containsAny;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 562                 }                                                                                        </span>
<span  style=""> 563                                                                                                          </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 564             default:                                                                                     </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 565                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 566         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 567     }                                                                                                    </span>
<span  style=""> 568                                                                                                          </span>
<span class="-522333448184701526" onmouseenter="enter('-522333448184701526');" onmouseout="out('-522333448184701526');" style=""> 569     // Strip Unicode control sequences: some apps like Telegram add a lot of them for unknown reasons    </span>
<span class="-8731468808345203749" onmouseenter="enter('-8731468808345203749');" onmouseout="out('-8731468808345203749');" style=""> 570     private String sanitizeUnicode(String orig) {                                                        </span>
<span class="3980018359364350746" onmouseenter="enter('3980018359364350746');" onmouseout="out('3980018359364350746');" style=""> 571         return orig.replaceAll(&quot;\\p{C}&quot;, &quot;&quot;);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 572     }                                                                                                    </span>
<span  style=""> 573                                                                                                          </span>
<span class="-9171831878462980109" onmouseenter="enter('-9171831878462980109');" onmouseout="out('-9171831878462980109');" style=""> 574     private void dissectNotificationTo(Notification notification, NotificationSpec notificationSpec,     </span>
<span class="2688021293853549872" onmouseenter="enter('2688021293853549872');" onmouseout="out('2688021293853549872');" style=""> 575                                        boolean preferBigText) {                                          </span>
<span  style=""> 576                                                                                                          </span>
<span class="-4856559942663327722" onmouseenter="enter('-4856559942663327722');" onmouseout="out('-4856559942663327722');" style=""> 577         Bundle extras = NotificationCompat.getExtras(notification);                                      </span>
<span  style=""> 578                                                                                                          </span>
<span class="1218249610901206964" onmouseenter="enter('1218249610901206964');" onmouseout="out('1218249610901206964');" style=""> 579         //dumpExtras(extras);                                                                            </span>
<span  style=""> 580                                                                                                          </span>
<span class="-6997230475683564369" onmouseenter="enter('-6997230475683564369');" onmouseout="out('-6997230475683564369');" style=""> 581         CharSequence title = extras.getCharSequence(Notification.EXTRA_TITLE);                           </span>
<span class="-5768442231641885516" onmouseenter="enter('-5768442231641885516');" onmouseout="out('-5768442231641885516');" style=""> 582         if (title != null) {                                                                             </span>
<span class="3486456028705164748" onmouseenter="enter('3486456028705164748');" onmouseout="out('3486456028705164748');" style=""> 583             notificationSpec.title = sanitizeUnicode(title.toString());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 584         }                                                                                                </span>
<span  style=""> 585                                                                                                          </span>
<span class="-1675348653102168964" onmouseenter="enter('-1675348653102168964');" onmouseout="out('-1675348653102168964');" style=""> 586         CharSequence contentCS = null;                                                                   </span>
<span class="7665214774958344559" onmouseenter="enter('7665214774958344559');" onmouseout="out('7665214774958344559');" style=""> 587         if (preferBigText &amp;&amp; extras.containsKey(Notification.EXTRA_BIG_TEXT)) {                          </span>
<span class="3933802215223175306" onmouseenter="enter('3933802215223175306');" onmouseout="out('3933802215223175306');" style=""> 588             contentCS = extras.getCharSequence(NotificationCompat.EXTRA_BIG_TEXT);                       </span>
<span class="8631000860903630717" onmouseenter="enter('8631000860903630717');" onmouseout="out('8631000860903630717');" style=""> 589         } else if (extras.containsKey(Notification.EXTRA_TEXT)) {                                        </span>
<span class="-7547654609103611854" onmouseenter="enter('-7547654609103611854');" onmouseout="out('-7547654609103611854');" style=""> 590             contentCS = extras.getCharSequence(NotificationCompat.EXTRA_TEXT);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 591         }                                                                                                </span>
<span class="-2707602363986640259" onmouseenter="enter('-2707602363986640259');" onmouseout="out('-2707602363986640259');" style=""> 592         if (contentCS != null) {                                                                         </span>
<span class="-5564526501110527191" onmouseenter="enter('-5564526501110527191');" onmouseout="out('-5564526501110527191');" style=""> 593             notificationSpec.body = sanitizeUnicode(contentCS.toString());                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 594         }                                                                                                </span>
<span  style=""> 595                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 596     }                                                                                                    </span>
<span  style=""> 597                                                                                                          </span>
<span class="-7937366375312895792" onmouseenter="enter('-7937366375312895792');" onmouseout="out('-7937366375312895792');" style=""> 598     private boolean isServiceRunning() {                                                                 </span>
<span class="-8788124079324077188" onmouseenter="enter('-8788124079324077188');" onmouseout="out('-8788124079324077188');" style=""> 599         ActivityManager manager = (ActivityManager) getSystemService(ACTIVITY_SERVICE);                  </span>
<span class="5841398637891737551" onmouseenter="enter('5841398637891737551');" onmouseout="out('5841398637891737551');" style=""> 600         if (manager == null) {                                                                           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 601             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 602         }                                                                                                </span>
<span class="-1060000448595061247" onmouseenter="enter('-1060000448595061247');" onmouseout="out('-1060000448595061247');" style=""><abbr title=" 603         for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) {"> 603         for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) ðŸ”µ</abbr></span>
<span class="1715383852667790939" onmouseenter="enter('1715383852667790939');" onmouseout="out('1715383852667790939');" style=""> 604             if (DeviceCommunicationService.class.getName().equals(service.service.getClassName())) {     </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 605                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 606             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 607         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 608         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 609     }                                                                                                    </span>
<span  style=""> 610                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 611     /**                                                                                                  </span>
<span class="-3386513456391723953" onmouseenter="enter('-3386513456391723953');" onmouseout="out('-3386513456391723953');" style=""> 612      * Try to handle media session notifications that tell info about the current play state.            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 613      *                                                                                                   </span>
<span class="-2019490562393536710" onmouseenter="enter('-2019490562393536710');" onmouseout="out('-2019490562393536710');" style=""> 614      * @param mediaSession The mediasession to handle.                                                   </span>
<span class="1642728463279900605" onmouseenter="enter('1642728463279900605');" onmouseout="out('1642728463279900605');" style=""> 615      * @return true if notification was handled, false otherwise                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 616      */                                                                                                  </span>
<span class="1254895864500637019" onmouseenter="enter('1254895864500637019');" onmouseout="out('1254895864500637019');" style=""> 617     public boolean handleMediaSessionNotification(MediaSessionCompat.Token mediaSession) {               </span>
<span class="-4606570715029334060" onmouseenter="enter('-4606570715029334060');" onmouseout="out('-4606570715029334060');" style=""> 618         MusicSpec musicSpec = new MusicSpec();                                                           </span>
<span class="6191411421956413825" onmouseenter="enter('6191411421956413825');" onmouseout="out('6191411421956413825');" style=""> 619         MusicStateSpec stateSpec = new MusicStateSpec();                                                 </span>
<span  style=""> 620                                                                                                          </span>
<span class="-6296053285913663629" onmouseenter="enter('-6296053285913663629');" onmouseout="out('-6296053285913663629');" style=""> 621         MediaControllerCompat c;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 622         try {                                                                                            </span>
<span class="7437011440923722104" onmouseenter="enter('7437011440923722104');" onmouseout="out('7437011440923722104');" style=""> 623             c = new MediaControllerCompat(getApplicationContext(), mediaSession);                        </span>
<span  style=""> 624                                                                                                          </span>
<span class="-1916914550610898815" onmouseenter="enter('-1916914550610898815');" onmouseout="out('-1916914550610898815');" style=""> 625             PlaybackStateCompat s = c.getPlaybackState();                                                </span>
<span class="-2990817606835558686" onmouseenter="enter('-2990817606835558686');" onmouseout="out('-2990817606835558686');" style=""> 626             stateSpec.position = (int) (s.getPosition() / 1000);                                         </span>
<span class="5328288853423061088" onmouseenter="enter('5328288853423061088');" onmouseout="out('5328288853423061088');" style=""> 627             stateSpec.playRate = Math.round(100 * s.getPlaybackSpeed());                                 </span>
<span class="2323238932425227387" onmouseenter="enter('2323238932425227387');" onmouseout="out('2323238932425227387');" style=""> 628             stateSpec.repeat = 1;                                                                        </span>
<span class="-2798957985679932557" onmouseenter="enter('-2798957985679932557');" onmouseout="out('-2798957985679932557');" style=""> 629             stateSpec.shuffle = 1;                                                                       </span>
<span class="1453024666101612078" onmouseenter="enter('1453024666101612078');" onmouseout="out('1453024666101612078');" style=""> 630             switch (s.getState()) {                                                                      </span>
<span class="-7604550062433163488" onmouseenter="enter('-7604550062433163488');" onmouseout="out('-7604550062433163488');" style=""> 631                 case PlaybackState.STATE_PLAYING:                                                        </span>
<span class="-5997751080810805230" onmouseenter="enter('-5997751080810805230');" onmouseout="out('-5997751080810805230');" style=""> 632                     stateSpec.state = MusicStateSpec.STATE_PLAYING;                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 633                     break;                                                                               </span>
<span class="4895305209877093306" onmouseenter="enter('4895305209877093306');" onmouseout="out('4895305209877093306');" style=""> 634                 case PlaybackState.STATE_STOPPED:                                                        </span>
<span class="7340128138398857774" onmouseenter="enter('7340128138398857774');" onmouseout="out('7340128138398857774');" style=""> 635                     stateSpec.state = MusicStateSpec.STATE_STOPPED;                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 636                     break;                                                                               </span>
<span class="-7061407832272958754" onmouseenter="enter('-7061407832272958754');" onmouseout="out('-7061407832272958754');" style=""> 637                 case PlaybackState.STATE_PAUSED:                                                         </span>
<span class="928317678007732085" onmouseenter="enter('928317678007732085');" onmouseout="out('928317678007732085');" style=""> 638                     stateSpec.state = MusicStateSpec.STATE_PAUSED;                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 639                     break;                                                                               </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 640                 default:                                                                                 </span>
<span class="1494209818965165815" onmouseenter="enter('1494209818965165815');" onmouseout="out('1494209818965165815');" style=""> 641                     stateSpec.state = MusicStateSpec.STATE_UNKNOWN;                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 642                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 643             }                                                                                            </span>
<span  style=""> 644                                                                                                          </span>
<span class="-1378394649293702376" onmouseenter="enter('-1378394649293702376');" onmouseout="out('-1378394649293702376');" style=""> 645             MediaMetadataCompat d = c.getMetadata();                                                     </span>
<span class="1381395247865936457" onmouseenter="enter('1381395247865936457');" onmouseout="out('1381395247865936457');" style=""> 646             if (d == null)                                                                               </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 647                 return false;                                                                            </span>
<span class="7299474512588472960" onmouseenter="enter('7299474512588472960');" onmouseout="out('7299474512588472960');" style=""> 648             if (d.containsKey(MediaMetadata.METADATA_KEY_ARTIST))                                        </span>
<span class="-145858411899069051" onmouseenter="enter('-145858411899069051');" onmouseout="out('-145858411899069051');" style=""> 649                 musicSpec.artist = d.getString(MediaMetadataCompat.METADATA_KEY_ARTIST);                 </span>
<span class="563580125723474981" onmouseenter="enter('563580125723474981');" onmouseout="out('563580125723474981');" style=""> 650             if (d.containsKey(MediaMetadata.METADATA_KEY_ALBUM))                                         </span>
<span class="1803038863600841979" onmouseenter="enter('1803038863600841979');" onmouseout="out('1803038863600841979');" style=""> 651                 musicSpec.album = d.getString(MediaMetadataCompat.METADATA_KEY_ALBUM);                   </span>
<span class="-1766324950453780005" onmouseenter="enter('-1766324950453780005');" onmouseout="out('-1766324950453780005');" style=""> 652             if (d.containsKey(MediaMetadata.METADATA_KEY_TITLE))                                         </span>
<span class="-6541941403865600636" onmouseenter="enter('-6541941403865600636');" onmouseout="out('-6541941403865600636');" style=""> 653                 musicSpec.track = d.getString(MediaMetadataCompat.METADATA_KEY_TITLE);                   </span>
<span class="-690335942087370936" onmouseenter="enter('-690335942087370936');" onmouseout="out('-690335942087370936');" style=""> 654             if (d.containsKey(MediaMetadata.METADATA_KEY_DURATION))                                      </span>
<span class="-139118447155224577" onmouseenter="enter('-139118447155224577');" onmouseout="out('-139118447155224577');" style=""> 655                 musicSpec.duration = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_DURATION) / 1000;  </span>
<span class="6028497768136929228" onmouseenter="enter('6028497768136929228');" onmouseout="out('6028497768136929228');" style=""> 656             if (d.containsKey(MediaMetadata.METADATA_KEY_NUM_TRACKS))                                    </span>
<span class="6703481613150545995" onmouseenter="enter('6703481613150545995');" onmouseout="out('6703481613150545995');" style=""> 657                 musicSpec.trackCount = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_NUM_TRACKS);     </span>
<span class="3843094866204545202" onmouseenter="enter('3843094866204545202');" onmouseout="out('3843094866204545202');" style=""> 658             if (d.containsKey(MediaMetadata.METADATA_KEY_TRACK_NUMBER))                                  </span>
<span class="1727735009143440653" onmouseenter="enter('1727735009143440653');" onmouseout="out('1727735009143440653');" style=""> 659                 musicSpec.trackNr = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_TRACK_NUMBER);      </span>
<span  style=""> 660                                                                                                          </span>
<span class="2207286164059072520" onmouseenter="enter('2207286164059072520');" onmouseout="out('2207286164059072520');" style=""> 661             // finally, tell the device about it                                                         </span>
<span class="7157573786903835889" onmouseenter="enter('7157573786903835889');" onmouseout="out('7157573786903835889');" style=""> 662             GBApplication.deviceService().onSetMusicInfo(musicSpec);                                     </span>
<span class="-6342881769260875577" onmouseenter="enter('-6342881769260875577');" onmouseout="out('-6342881769260875577');" style=""> 663             GBApplication.deviceService().onSetMusicState(stateSpec);                                    </span>
<span  style=""> 664                                                                                                          </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 665             return true;                                                                                 </span>
<span class="3226201684513186940" onmouseenter="enter('3226201684513186940');" onmouseout="out('3226201684513186940');" style=""> 666         } catch (NullPointerException | RemoteException e) {                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 667             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 668         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 669     }                                                                                                    </span>
<span  style=""> 670                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 671     @Override                                                                                            </span>
<span class="2733031363552103422" onmouseenter="enter('2733031363552103422');" onmouseout="out('2733031363552103422');" style=""> 672     public void onNotificationRemoved(StatusBarNotification sbn) {                                       </span>
<span class="-4502832560681421381" onmouseenter="enter('-4502832560681421381');" onmouseout="out('-4502832560681421381');" style=""><abbr title=" 673         LOG.info(&quot;Notification removed: &quot; + sbn.getPackageName() + &quot;: &quot; + sbn.getNotification().category);"> 673         LOG.info(&quot;Notification removed: &quot; + sbn.getPackageName() + &quot;: &quot; + sbn.getNotification().category)ðŸ”µ</abbr></span>
<span class="940449061862943006" onmouseenter="enter('940449061862943006');" onmouseout="out('940449061862943006');" style=""><abbr title=" 674         if(Notification.CATEGORY_CALL.equals(sbn.getNotification().category) &amp;&amp; activeCallPostTime == sbn.getPostTime()) {"> 674         if(Notification.CATEGORY_CALL.equals(sbn.getNotification().category) &amp;&amp; activeCallPostTime == sbnðŸ”µ</abbr></span>
<span class="-3941810167705609591" onmouseenter="enter('-3941810167705609591');" onmouseout="out('-3941810167705609591');" style=""> 675             activeCallPostTime = 0;                                                                      </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style=""> 676             CallSpec callSpec = new CallSpec();                                                          </span>
<span class="-7261749156805075102" onmouseenter="enter('-7261749156805075102');" onmouseout="out('-7261749156805075102');" style=""> 677             callSpec.command = CallSpec.CALL_END;                                                        </span>
<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style=""> 678             GBApplication.deviceService().onSetCallState(callSpec);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 679         }                                                                                                </span>
<span class="-7767930678383346096" onmouseenter="enter('-7767930678383346096');" onmouseout="out('-7767930678383346096');" style=""> 680         // FIXME: DISABLED for now                                                                       </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 681         /*                                                                                               </span>
<span class="1980360516715691973" onmouseenter="enter('1980360516715691973');" onmouseout="out('1980360516715691973');" style=""> 682         if (shouldIgnore(sbn))                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 683             return;                                                                                      </span>
<span  style=""> 684                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 685         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="-1523052147845593738" onmouseenter="enter('-1523052147845593738');" onmouseout="out('-1523052147845593738');" style=""> 686         if (prefs.getBoolean(&quot;autoremove_notifications&quot;, false)) {                                       </span>
<span class="-1849447037737481789" onmouseenter="enter('-1849447037737481789');" onmouseout="out('-1849447037737481789');" style=""> 687             LOG.info(&quot;notification removed, will ask device to delete it&quot;);                              </span>
<span class="-8504489390442611809" onmouseenter="enter('-8504489390442611809');" onmouseout="out('-8504489390442611809');" style=""> 688             GBApplication.deviceService().onDeleteNotification((int) sbn.getPostTime());                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 689         }                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 690         */                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 691     }                                                                                                    </span>
<span  style=""> 692                                                                                                          </span>
<span  style=""> 693                                                                                                          </span>
<span class="2967918509730451591" onmouseenter="enter('2967918509730451591');" onmouseout="out('2967918509730451591');" style=""> 694     private void dumpExtras(Bundle bundle) {                                                             </span>
<span class="-755508411737932855" onmouseenter="enter('-755508411737932855');" onmouseout="out('-755508411737932855');" style=""> 695         for (String key : bundle.keySet()) {                                                             </span>
<span class="-680967060076152312" onmouseenter="enter('-680967060076152312');" onmouseout="out('-680967060076152312');" style=""> 696             Object value = bundle.get(key);                                                              </span>
<span class="-5708365098537636921" onmouseenter="enter('-5708365098537636921');" onmouseout="out('-5708365098537636921');" style=""> 697             if (value == null) {                                                                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 698                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 699             }                                                                                            </span>
<span class="6935438865287804705" onmouseenter="enter('6935438865287804705');" onmouseout="out('6935438865287804705');" style=""><abbr title=" 700             LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClass().getName()));"> 700             LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClaðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 701         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 702     }                                                                                                    </span>
<span  style=""> 703                                                                                                          </span>
<span  style=""> 704                                                                                                          </span>
<span class="-4145111049531346189" onmouseenter="enter('-4145111049531346189');" onmouseout="out('-4145111049531346189');" style=""> 705     private boolean shouldIgnore(StatusBarNotification sbn) {                                            </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 706         /*                                                                                               </span>
<span class="8751388135302008830" onmouseenter="enter('8751388135302008830');" onmouseout="out('8751388135302008830');" style=""> 707          * return early if DeviceCommunicationService is not running,                                    </span>
<span class="2502615223278385984" onmouseenter="enter('2502615223278385984');" onmouseout="out('2502615223278385984');" style=""> 708          * else the service would get started every time we get a notification.                          </span>
<span class="-5425061837888704430" onmouseenter="enter('-5425061837888704430');" onmouseout="out('-5425061837888704430');" style=""> 709          * unfortunately we cannot enable/disable NotificationListener at runtime like we do with        </span>
<span class="4838982710001585921" onmouseenter="enter('4838982710001585921');" onmouseout="out('4838982710001585921');" style=""> 710          * broadcast receivers because it seems to invalidate the permissions that are                   </span>
<span class="-2921629841702414230" onmouseenter="enter('-2921629841702414230');" onmouseout="out('-2921629841702414230');" style=""> 711          * necessary for NotificationListenerService                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 712          */                                                                                              </span>
<span class="-3255765405089884099" onmouseenter="enter('-3255765405089884099');" onmouseout="out('-3255765405089884099');" style=""> 713         if (!isServiceRunning() || sbn == null) {                                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 714             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 715         }                                                                                                </span>
<span  style=""> 716                                                                                                          </span>
<span class="8647073884367840020" onmouseenter="enter('8647073884367840020');" onmouseout="out('8647073884367840020');" style=""> 717         return shouldIgnoreSource(sbn.getPackageName()) || shouldIgnoreNotification(                     </span>
<span class="-1392203204106720793" onmouseenter="enter('-1392203204106720793');" onmouseout="out('-1392203204106720793');" style=""> 718                 sbn.getNotification(), sbn.getPackageName());                                            </span>
<span  style=""> 719                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 720     }                                                                                                    </span>
<span  style=""> 721                                                                                                          </span>
<span class="8460515521985572441" onmouseenter="enter('8460515521985572441');" onmouseout="out('8460515521985572441');" style=""> 722     private boolean shouldIgnoreSource(String source) {                                                  </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 723         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span  style=""> 724                                                                                                          </span>
<span class="714714039810027052" onmouseenter="enter('714714039810027052');" onmouseout="out('714714039810027052');" style=""> 725         /* do not display messages from &quot;android&quot;                                                        </span>
<span class="1893274482542565547" onmouseenter="enter('1893274482542565547');" onmouseout="out('1893274482542565547');" style=""> 726          * This includes keyboard selection message, usb connection messages, etc                        </span>
<span class="-7750906811397804767" onmouseenter="enter('-7750906811397804767');" onmouseout="out('-7750906811397804767');" style=""> 727          * Hope it does not filter out too much, we will see...                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 728          */                                                                                              </span>
<span  style=""> 729                                                                                                          </span>
<span class="1872165376889396003" onmouseenter="enter('1872165376889396003');" onmouseout="out('1872165376889396003');" style=""> 730         if (source.equals(&quot;android&quot;) ||                                                                  </span>
<span class="1446354513639890825" onmouseenter="enter('1446354513639890825');" onmouseout="out('1446354513639890825');" style=""> 731                 source.equals(&quot;com.android.systemui&quot;) ||                                                 </span>
<span class="-4630583015863350357" onmouseenter="enter('-4630583015863350357');" onmouseout="out('-4630583015863350357');" style=""> 732                 source.equals(&quot;com.android.dialer&quot;) ||                                                   </span>
<span class="-4581680912095398334" onmouseenter="enter('-4581680912095398334');" onmouseout="out('-4581680912095398334');" style=""> 733                 source.equals(&quot;com.cyanogenmod.eleven&quot;)) {                                               </span>
<span class="7414276835277607055" onmouseenter="enter('7414276835277607055');" onmouseout="out('7414276835277607055');" style=""> 734             LOG.info(&quot;Ignoring notification, is a system event&quot;);                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 735             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 736         }                                                                                                </span>
<span  style=""> 737                                                                                                          </span>
<span class="6340978795702098449" onmouseenter="enter('6340978795702098449');" onmouseout="out('6340978795702098449');" style=""> 738         if (source.equals(&quot;com.moez.QKSMS&quot;) ||                                                           </span>
<span class="3673317982547560929" onmouseenter="enter('3673317982547560929');" onmouseout="out('3673317982547560929');" style=""> 739                 source.equals(&quot;com.android.mms&quot;) ||                                                      </span>
<span class="-6538830744852229820" onmouseenter="enter('-6538830744852229820');" onmouseout="out('-6538830744852229820');" style=""> 740                 source.equals(&quot;com.sonyericsson.conversations&quot;) ||                                       </span>
<span class="-1795882970722883910" onmouseenter="enter('-1795882970722883910');" onmouseout="out('-1795882970722883910');" style=""> 741                 source.equals(&quot;com.android.messaging&quot;) ||                                                </span>
<span class="4780395695457664313" onmouseenter="enter('4780395695457664313');" onmouseout="out('4780395695457664313');" style=""> 742                 source.equals(&quot;org.smssecure.smssecure&quot;)) {                                              </span>
<span class="7115714847551904856" onmouseenter="enter('7115714847551904856');" onmouseout="out('7115714847551904856');" style=""> 743             if (!&quot;never&quot;.equals(prefs.getString(&quot;notification_mode_sms&quot;, &quot;when_screen_off&quot;))) {          </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 744                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 745             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 746         }                                                                                                </span>
<span  style=""> 747                                                                                                          </span>
<span class="6044120705305546650" onmouseenter="enter('6044120705305546650');" onmouseout="out('6044120705305546650');" style=""> 748         if (GBApplication.appIsNotifBlacklisted(source)) {                                               </span>
<span class="-8656872471771272619" onmouseenter="enter('-8656872471771272619');" onmouseout="out('-8656872471771272619');" style=""> 749             LOG.info(&quot;Ignoring notification, application is blacklisted&quot;);                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 750             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 751         }                                                                                                </span>
<span  style=""> 752                                                                                                          </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 753         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 754     }                                                                                                    </span>
<span  style=""> 755                                                                                                          </span>
<span class="1856078835330472094" onmouseenter="enter('1856078835330472094');" onmouseout="out('1856078835330472094');" style=""> 756     private boolean shouldIgnoreNotification(Notification notification, String source) {                 </span>
<span  style=""> 757                                                                                                          </span>
<span class="2710746236440319224" onmouseenter="enter('2710746236440319224');" onmouseout="out('2710746236440319224');" style=""> 758         MediaSessionCompat.Token mediaSession = getMediaSession(notification);                           </span>
<span class="-7174765412912193274" onmouseenter="enter('-7174765412912193274');" onmouseout="out('-7174765412912193274');" style=""> 759         //try to handle media session notifications                                                      </span>
<span class="3009058002375133697" onmouseenter="enter('3009058002375133697');" onmouseout="out('3009058002375133697');" style=""> 760         if (mediaSession != null &amp;&amp; handleMediaSessionNotification(mediaSession))                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 761             return true;                                                                                 </span>
<span  style=""> 762                                                                                                          </span>
<span class="8585714054343457960" onmouseenter="enter('8585714054343457960');" onmouseout="out('8585714054343457960');" style=""> 763         NotificationType type = AppNotificationType.getInstance().get(source);                           </span>
<span class="-3108268637978238079" onmouseenter="enter('-3108268637978238079');" onmouseout="out('-3108268637978238079');" style=""><abbr title=" 764         //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/Notification.html#FLAG_LOCAL_ONLY"> 764         //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/NoðŸ”µ</abbr></span>
<span class="1334602672683683072" onmouseenter="enter('1334602672683683072');" onmouseout="out('1334602672683683072');" style=""> 765         //some Apps always mark their notifcations as read-only                                          </span>
<span class="-5418244290311748300" onmouseenter="enter('-5418244290311748300');" onmouseout="out('-5418244290311748300');" style=""> 766         if (NotificationCompat.getLocalOnly(notification) &amp;&amp;                                             </span>
<span class="7056635344578594111" onmouseenter="enter('7056635344578594111');" onmouseout="out('7056635344578594111');" style=""> 767                 type != NotificationType.WECHAT &amp;&amp;                                                       </span>
<span class="-8701954321417018195" onmouseenter="enter('-8701954321417018195');" onmouseout="out('-8701954321417018195');" style=""> 768                 type != NotificationType.OUTLOOK &amp;&amp;                                                      </span>
<span class="-8347560682459681115" onmouseenter="enter('-8347560682459681115');" onmouseout="out('-8347560682459681115');" style=""><abbr title=" 769                 type != NotificationType.SKYPE) { //see https://github.com/Freeyourgadget/Gadgetbridge/issues/1109"> 769                 type != NotificationType.SKYPE) { //see https://github.com/Freeyourgadget/Gadgetbridge/isðŸ”µ</abbr></span>
<span class="-8433825860703034123" onmouseenter="enter('-8433825860703034123');" onmouseout="out('-8433825860703034123');" style=""> 770             LOG.info(&quot;local only&quot;);                                                                      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 771             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 772         }                                                                                                </span>
<span  style=""> 773                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 774         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="7394809232234198434" onmouseenter="enter('7394809232234198434');" onmouseout="out('7394809232234198434');" style=""> 775         if (!prefs.getBoolean(&quot;notifications_generic_whenscreenon&quot;, false)) {                            </span>
<span class="-494499854560412945" onmouseenter="enter('-494499854560412945');" onmouseout="out('-494499854560412945');" style=""> 776             PowerManager powermanager = (PowerManager) getSystemService(POWER_SERVICE);                  </span>
<span class="-5667675384255289213" onmouseenter="enter('-5667675384255289213');" onmouseout="out('-5667675384255289213');" style=""> 777             if (powermanager != null &amp;&amp; powermanager.isScreenOn()) {                                     </span>
<span class="1543062508857536366" onmouseenter="enter('1543062508857536366');" onmouseout="out('1543062508857536366');" style=""><abbr title=" 778 //                LOG.info(&quot;Not forwarding notification, screen seems to be on and settings do not allow this&quot;);"> 778 //                LOG.info(&quot;Not forwarding notification, screen seems to be on and settings do not allow ðŸ”µ</abbr></span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 779                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 780             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 781         }                                                                                                </span>
<span  style=""> 782                                                                                                          </span>
<span class="3125878453643003848" onmouseenter="enter('3125878453643003848');" onmouseout="out('3125878453643003848');" style=""> 783         return (notification.flags &amp; Notification.FLAG_ONGOING_EVENT) == Notification.FLAG_ONGOING_EVENT;</span>
<span  style=""> 784                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 785     }                                                                                                    </span>
<span  style=""> 786                                                                                                          </span>
<span  style=""> 787                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 788     /**                                                                                                  </span>
<span class="-3600272953695402454" onmouseenter="enter('-3600272953695402454');" onmouseout="out('-3600272953695402454');" style=""> 789      * Get the notification color that should be used for this Pebble notification.                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 790      *                                                                                                   </span>
<span class="-6380098887809341874" onmouseenter="enter('-6380098887809341874');" onmouseout="out('-6380098887809341874');" style=""><abbr title=" 791      * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PebbleColor."> 791      * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PeðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 792      *                                                                                                   </span>
<span class="-5220482988035539244" onmouseenter="enter('-5220482988035539244');" onmouseout="out('-5220482988035539244');" style=""> 793      * See Issue #815 on GitHub to see how notification colors are set.                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 794      *                                                                                                   </span>
<span class="-144667098623416646" onmouseenter="enter('-144667098623416646');" onmouseout="out('-144667098623416646');" style=""> 795      * @param notificationSpec The NotificationSpec to read from.                                        </span>
<span class="-8231127304595524287" onmouseenter="enter('-8231127304595524287');" onmouseout="out('-8231127304595524287');" style=""> 796      * @return Returns a PebbleColor that best represents this notification.                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 797      */                                                                                                  </span>
<span class="-8858039465077957361" onmouseenter="enter('-8858039465077957361');" onmouseout="out('-8858039465077957361');" style=""> 798     private byte getPebbleColorForNotification(NotificationSpec notificationSpec) {                      </span>
<span class="2461936733082927787" onmouseenter="enter('2461936733082927787');" onmouseout="out('2461936733082927787');" style=""> 799         String appId = notificationSpec.sourceAppId;                                                     </span>
<span class="6072026966279222546" onmouseenter="enter('6072026966279222546');" onmouseout="out('6072026966279222546');" style=""> 800         NotificationType existingType = notificationSpec.type;                                           </span>
<span  style=""> 801                                                                                                          </span>
<span class="-4597227445151323685" onmouseenter="enter('-4597227445151323685');" onmouseout="out('-4597227445151323685');" style=""> 802         // If the notification type is known, return the associated color.                               </span>
<span class="-3115160525838252691" onmouseenter="enter('-3115160525838252691');" onmouseout="out('-3115160525838252691');" style=""> 803         if (existingType != NotificationType.UNKNOWN) {                                                  </span>
<span class="4443749667658266101" onmouseenter="enter('4443749667658266101');" onmouseout="out('4443749667658266101');" style=""> 804             return existingType.color;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 805         }                                                                                                </span>
<span  style=""> 806                                                                                                          </span>
<span class="128994715916204674" onmouseenter="enter('128994715916204674');" onmouseout="out('128994715916204674');" style=""> 807         // Otherwise, we go and attempt to find the color from the app icon.                             </span>
<span class="-6191555258820518316" onmouseenter="enter('-6191555258820518316');" onmouseout="out('-6191555258820518316');" style=""> 808         Drawable icon;                                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 809         try {                                                                                            </span>
<span class="8261548971879133584" onmouseenter="enter('8261548971879133584');" onmouseout="out('8261548971879133584');" style=""> 810             icon = getApplicationContext().getPackageManager().getApplicationIcon(appId);                </span>
<span class="6230969829088056905" onmouseenter="enter('6230969829088056905');" onmouseout="out('6230969829088056905');" style=""> 811             Objects.requireNonNull(icon);                                                                </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style=""> 812         } catch (Exception ex) {                                                                         </span>
<span class="-3868233956680081057" onmouseenter="enter('-3868233956680081057');" onmouseout="out('-3868233956680081057');" style=""> 813             // If we can&#x27;t get the icon, we go with the default defined above.                           </span>
<span class="-5905931119091130668" onmouseenter="enter('-5905931119091130668');" onmouseout="out('-5905931119091130668');" style=""> 814             LOG.warn(&quot;Could not get icon for AppID &quot; + appId, ex);                                       </span>
<span class="5002487793506958772" onmouseenter="enter('5002487793506958772');" onmouseout="out('5002487793506958772');" style=""> 815             return PebbleColor.IslamicGreen;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 816         }                                                                                                </span>
<span  style=""> 817                                                                                                          </span>
<span class="-5100715979180048388" onmouseenter="enter('-5100715979180048388');" onmouseout="out('-5100715979180048388');" style=""> 818         Bitmap bitmapIcon = BitmapUtil.convertDrawableToBitmap(icon);                                    </span>
<span class="-8268037003500299815" onmouseenter="enter('-8268037003500299815');" onmouseout="out('-8268037003500299815');" style=""> 819         int iconPrimaryColor = new Palette.Builder(bitmapIcon)                                           </span>
<span class="-3438664463656085757" onmouseenter="enter('-3438664463656085757');" onmouseout="out('-3438664463656085757');" style=""> 820                 .generate()                                                                              </span>
<span class="-7390360638896501298" onmouseenter="enter('-7390360638896501298');" onmouseout="out('-7390360638896501298');" style=""> 821                 .getVibrantColor(Color.parseColor(&quot;#aa0000&quot;));                                           </span>
<span  style=""> 822                                                                                                          </span>
<span class="5649835422942677201" onmouseenter="enter('5649835422942677201');" onmouseout="out('5649835422942677201');" style=""> 823         return PebbleUtils.getPebbleColor(iconPrimaryColor);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 824     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 825 }                                                                                                        </span></pre></td>
                            <td><pre><span class="-230343772074056088" onmouseenter="enter('-230343772074056088');" onmouseout="out('-230343772074056088');" style="">   1 /*  Copyright (C) 2015-2018 Andreas Shimokawa, Carsten Pfeiffer, Daniele                                 </span>
<span class="2492236627567978380" onmouseenter="enter('2492236627567978380');" onmouseout="out('2492236627567978380');" style="">   2     Gobbetti, Frank Slezak, Hasan Ammar, JosÃ© Rebelo, Julien Pivotto, Kevin                              </span>
<span class="-504983364603579348" onmouseenter="enter('-504983364603579348');" onmouseout="out('-504983364603579348');" style="">   3     Richter, Normano64, Steffen Liebergeld, Taavi EomÃ¤e, Zhong Jianxin                                   </span>
<span  style="">   4                                                                                                          </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   5     This file is part of Gadgetbridge.                                                                   </span>
<span  style="">   6                                                                                                          </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   7     Gadgetbridge is free software: you can redistribute it and/or modify                                 </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   8     it under the terms of the GNU Affero General Public License as published                             </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">   9     by the Free Software Foundation, either version 3 of the License, or                                 </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">  10     (at your option) any later version.                                                                  </span>
<span  style="">  11                                                                                                          </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  12     Gadgetbridge is distributed in the hope that it will be useful,                                      </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  13     but WITHOUT ANY WARRANTY; without even the implied warranty of                                       </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  14     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                        </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  15     GNU Affero General Public License for more details.                                                  </span>
<span  style="">  16                                                                                                          </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  17     You should have received a copy of the GNU Affero General Public License                             </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  18     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                             </span>
<span class="8249211937858728345" onmouseenter="enter('8249211937858728345');" onmouseout="out('8249211937858728345');" style="">  19 package nodomain.freeyourgadget.gadgetbridge.externalevents;                                             </span>
<span  style="">  20                                                                                                          </span>
<span class="-867022162471464761" onmouseenter="enter('-867022162471464761');" onmouseout="out('-867022162471464761');" style="">  21 import android.app.ActivityManager;                                                                      </span>
<span class="1017587490774535994" onmouseenter="enter('1017587490774535994');" onmouseout="out('1017587490774535994');" style="">  22 import android.app.Notification;                                                                         </span>
<span class="2183671588995744448" onmouseenter="enter('2183671588995744448');" onmouseout="out('2183671588995744448');" style="">  23 import android.app.NotificationManager;                                                                  </span>
<span class="2265467446931963889" onmouseenter="enter('2265467446931963889');" onmouseout="out('2265467446931963889');" style="">  24 import android.app.PendingIntent;                                                                        </span>
<span class="-489389385851058391" onmouseenter="enter('-489389385851058391');" onmouseout="out('-489389385851058391');" style="">  25 import android.content.BroadcastReceiver;                                                                </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  26 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  27 import android.content.Intent;                                                                           </span>
<span class="8697221465021235869" onmouseenter="enter('8697221465021235869');" onmouseout="out('8697221465021235869');" style="">  28 import android.content.IntentFilter;                                                                     </span>
<span class="-841431222158024655" onmouseenter="enter('-841431222158024655');" onmouseout="out('-841431222158024655');" style="">  29 import android.content.pm.ApplicationInfo;                                                               </span>
<span class="-1290624633738557221" onmouseenter="enter('-1290624633738557221');" onmouseout="out('-1290624633738557221');" style="">  30 import android.content.pm.PackageManager;                                                                </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  31 import android.graphics.Bitmap;                                                                          </span>
<span class="-5868658801447575011" onmouseenter="enter('-5868658801447575011');" onmouseout="out('-5868658801447575011');" style="">  32 import android.graphics.Color;                                                                           </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  33 import android.graphics.drawable.Drawable;                                                               </span>
<span class="-7644600255099282823" onmouseenter="enter('-7644600255099282823');" onmouseout="out('-7644600255099282823');" style="">  34 import android.media.MediaMetadata;                                                                      </span>
<span class="6014561289295455692" onmouseenter="enter('6014561289295455692');" onmouseout="out('6014561289295455692');" style="">  35 import android.media.session.PlaybackState;                                                              </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  36 import android.os.Bundle;                                                                                </span>
<span class="1048014933395814760" onmouseenter="enter('1048014933395814760');" onmouseout="out('1048014933395814760');" style="">  37 import android.os.PowerManager;                                                                          </span>
<span class="2671599330745315048" onmouseenter="enter('2671599330745315048');" onmouseout="out('2671599330745315048');" style="">  38 import android.os.RemoteException;                                                                       </span>
<span class="2414580121965048179" onmouseenter="enter('2414580121965048179');" onmouseout="out('2414580121965048179');" style="">  39 import android.service.notification.NotificationListenerService;                                         </span>
<span class="-5243140560088050107" onmouseenter="enter('-5243140560088050107');" onmouseout="out('-5243140560088050107');" style="">  40 import android.service.notification.StatusBarNotification;                                               </span>
<span class="-9135046463009697450" onmouseenter="enter('-9135046463009697450');" onmouseout="out('-9135046463009697450');" style="">  41 import android.support.v4.media.MediaMetadataCompat;                                                     </span>
<span class="3010053617601869286" onmouseenter="enter('3010053617601869286');" onmouseout="out('3010053617601869286');" style="">  42 import android.support.v4.media.session.MediaControllerCompat;                                           </span>
<span class="7582659085834762989" onmouseenter="enter('7582659085834762989');" onmouseout="out('7582659085834762989');" style="">  43 import android.support.v4.media.session.MediaSessionCompat;                                              </span>
<span class="7730848488047972805" onmouseenter="enter('7730848488047972805');" onmouseout="out('7730848488047972805');" style="">  44 import android.support.v4.media.session.PlaybackStateCompat;                                             </span>
<span class="-1987741288118698756" onmouseenter="enter('-1987741288118698756');" onmouseout="out('-1987741288118698756');" style="">  45 import de.greenrobot.dao.query.Query;                                                                    </span>
<span class="5877451784023912628" onmouseenter="enter('5877451784023912628');" onmouseout="out('5877451784023912628');" style="">  46 import nodomain.freeyourgadget.gadgetbridge.BuildConfig;                                                 </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  47 import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                               </span>
<span class="-7198279398549834921" onmouseenter="enter('-7198279398549834921');" onmouseout="out('-7198279398549834921');" style="">  48 import nodomain.freeyourgadget.gadgetbridge.R;                                                           </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  49 import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                          </span>
<span class="4987748567588683404" onmouseenter="enter('4987748567588683404');" onmouseout="out('4987748567588683404');" style="">  50 import nodomain.freeyourgadget.gadgetbridge.devices.pebble.PebbleColor;                                  </span>
<span class="4582396241551629343" onmouseenter="enter('4582396241551629343');" onmouseout="out('4582396241551629343');" style="">  51 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilter;                                 </span>
<span class="-9074570965792323186" onmouseenter="enter('-9074570965792323186');" onmouseout="out('-9074570965792323186');" style="">  52 import nodomain.freeyourgadget.gadgetbridge.model.CallSpec;                                              </span>
<span class="-8984035867915956548" onmouseenter="enter('-8984035867915956548');" onmouseout="out('-8984035867915956548');" style="">  53 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterDao;                              </span>
<span class="-8722044444563651785" onmouseenter="enter('-8722044444563651785');" onmouseout="out('-8722044444563651785');" style="">  54 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntry;                            </span>
<span class="-8636777843920322113" onmouseenter="enter('-8636777843920322113');" onmouseout="out('-8636777843920322113');" style="">  55 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntryDao;                         </span>
<span class="6892049631062353546" onmouseenter="enter('6892049631062353546');" onmouseout="out('6892049631062353546');" style="">  56 import nodomain.freeyourgadget.gadgetbridge.model.AppNotificationType;                                   </span>
<span class="-4068239021838445503" onmouseenter="enter('-4068239021838445503');" onmouseout="out('-4068239021838445503');" style="">  57 import nodomain.freeyourgadget.gadgetbridge.model.MusicSpec;                                             </span>
<span class="7536481506851862405" onmouseenter="enter('7536481506851862405');" onmouseout="out('7536481506851862405');" style="">  58 import nodomain.freeyourgadget.gadgetbridge.model.MusicStateSpec;                                        </span>
<span class="8239808916005009388" onmouseenter="enter('8239808916005009388');" onmouseout="out('8239808916005009388');" style="">  59 import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;                                      </span>
<span class="7087011959288310716" onmouseenter="enter('7087011959288310716');" onmouseout="out('7087011959288310716');" style="">  60 import nodomain.freeyourgadget.gadgetbridge.model.NotificationType;                                      </span>
<span class="-3383373218913164687" onmouseenter="enter('-3383373218913164687');" onmouseout="out('-3383373218913164687');" style="">  61 import nodomain.freeyourgadget.gadgetbridge.service.DeviceCommunicationService;                          </span>
<span class="-5340888108606249230" onmouseenter="enter('-5340888108606249230');" onmouseout="out('-5340888108606249230');" style="">  62 import nodomain.freeyourgadget.gadgetbridge.util.BitmapUtil;                                             </span>
<span class="-6912606469471439703" onmouseenter="enter('-6912606469471439703');" onmouseout="out('-6912606469471439703');" style="">  63 import nodomain.freeyourgadget.gadgetbridge.util.LimitedQueue;                                           </span>
<span class="4645284583739884744" onmouseenter="enter('4645284583739884744');" onmouseout="out('4645284583739884744');" style="">  64 import nodomain.freeyourgadget.gadgetbridge.util.PebbleUtils;                                            </span>
<span class="-600862318521663319" onmouseenter="enter('-600862318521663319');" onmouseout="out('-600862318521663319');" style="">  65 import nodomain.freeyourgadget.gadgetbridge.util.Prefs;                                                  </span>
<span  style="">  66                                                                                                          </span>
<span class="7436623043745543163" onmouseenter="enter('7436623043745543163');" onmouseout="out('7436623043745543163');" style="">  67 import static androidx.media.app.NotificationCompat.MediaStyle.getMediaSession;                          </span>
<span class="2609355261484520736" onmouseenter="enter('2609355261484520736');" onmouseout="out('2609355261484520736');" style=""><abbr title="  68 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_BLACKLIST;">  68 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILðŸ”µ</abbr></span>
<span class="-7771135586340561880" onmouseenter="enter('-7771135586340561880');" onmouseout="out('-7771135586340561880');" style=""><abbr title="  69 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_WHITELIST;">  69 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILðŸ”µ</abbr></span>
<span class="-3815741097386417514" onmouseenter="enter('-3815741097386417514');" onmouseout="out('-3815741097386417514');" style=""><abbr title="  70 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_SUBMODE_ALL;">  70 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILðŸ”µ</abbr></span>
<span  style="">  71                                                                                                          </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  72 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  73 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  74 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  75                                                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  76 import java.util.ArrayList;                                                                              </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  77 import java.util.HashMap;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  78 import java.util.List;                                                                                   </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  79 import java.util.Objects;                                                                                </span>
<span  style="">  80                                                                                                          </span>
<span class="6963272077887521702" onmouseenter="enter('6963272077887521702');" onmouseout="out('6963272077887521702');" style="">  81 import androidx.annotation.NonNull;                                                                      </span>
<span class="-8223344932374400146" onmouseenter="enter('-8223344932374400146');" onmouseout="out('-8223344932374400146');" style="">  82 import androidx.core.app.NotificationCompat;                                                             </span>
<span class="608068994369921062" onmouseenter="enter('608068994369921062');" onmouseout="out('608068994369921062');" style="">  83 import androidx.core.app.RemoteInput;                                                                    </span>
<span class="-898780232029151795" onmouseenter="enter('-898780232029151795');" onmouseout="out('-898780232029151795');" style="">  84 import androidx.localbroadcastmanager.content.LocalBroadcastManager;                                     </span>
<span class="8247440879742583383" onmouseenter="enter('8247440879742583383');" onmouseout="out('8247440879742583383');" style="">  85 import androidx.palette.graphics.Palette;                                                                </span>
<span  style="">  86                                                                                                          </span>
<span class="6882532116672062216" onmouseenter="enter('6882532116672062216');" onmouseout="out('6882532116672062216');" style="">  87 public class NotificationListener extends NotificationListenerService {                                  </span>
<span  style="">  88                                                                                                          </span>
<span class="5652999225459763894" onmouseenter="enter('5652999225459763894');" onmouseout="out('5652999225459763894');" style="">  89     private static final Logger LOG = LoggerFactory.getLogger(NotificationListener.class);               </span>
<span  style="">  90                                                                                                          </span>
<span class="-6720636215056424198" onmouseenter="enter('-6720636215056424198');" onmouseout="out('-6720636215056424198');" style="">  91     public static final String ACTION_DISMISS                                                            </span>
<span class="-435533233439313912" onmouseenter="enter('-435533233439313912');" onmouseout="out('-435533233439313912');" style="">  92             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss&quot;;                </span>
<span class="-2138233225266526402" onmouseenter="enter('-2138233225266526402');" onmouseout="out('-2138233225266526402');" style="">  93     public static final String ACTION_DISMISS_ALL                                                        </span>
<span class="-4592236270087722119" onmouseenter="enter('-4592236270087722119');" onmouseout="out('-4592236270087722119');" style="">  94             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss_all&quot;;            </span>
<span class="-3417692764158931011" onmouseenter="enter('-3417692764158931011');" onmouseout="out('-3417692764158931011');" style="">  95     public static final String ACTION_OPEN                                                               </span>
<span class="-4990387725302380924" onmouseenter="enter('-4990387725302380924');" onmouseout="out('-4990387725302380924');" style="">  96             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.open&quot;;                   </span>
<span class="-4179389986769695249" onmouseenter="enter('-4179389986769695249');" onmouseout="out('-4179389986769695249');" style="">  97     public static final String ACTION_MUTE                                                               </span>
<span class="9023540546537828742" onmouseenter="enter('9023540546537828742');" onmouseout="out('9023540546537828742');" style="">  98             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.mute&quot;;                   </span>
<span class="5009618492496239115" onmouseenter="enter('5009618492496239115');" onmouseout="out('5009618492496239115');" style="">  99     public static final String ACTION_REPLY                                                              </span>
<span class="8900274215532856227" onmouseenter="enter('8900274215532856227');" onmouseout="out('8900274215532856227');" style=""> 100             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.reply&quot;;                  </span>
<span  style=""> 101                                                                                                          </span>
<span class="2046947475762055359" onmouseenter="enter('2046947475762055359');" onmouseout="out('2046947475762055359');" style=""> 102     private LimitedQueue mActionLookup = new LimitedQueue(32);                                           </span>
<span class="7830816337914020824" onmouseenter="enter('7830816337914020824');" onmouseout="out('7830816337914020824');" style=""> 103     private LimitedQueue mPackageLookup = new LimitedQueue(64);                                          </span>
<span class="203591122145891899" onmouseenter="enter('203591122145891899');" onmouseout="out('203591122145891899');" style=""> 104     private LimitedQueue mNotificationHandleLookup = new LimitedQueue(128);                              </span>
<span  style=""> 105                                                                                                          </span>
<span class="5935133783530348929" onmouseenter="enter('5935133783530348929');" onmouseout="out('5935133783530348929');" style=""> 106     private HashMap&lt;String, Long&gt; notificationBurstPrevention = new HashMap&lt;&gt;();                         </span>
<span class="957532525841967801" onmouseenter="enter('957532525841967801');" onmouseout="out('957532525841967801');" style=""> 107     private HashMap&lt;String, Long&gt; notificationOldRepeatPrevention = new HashMap&lt;&gt;();                     </span>
<span  style=""> 108                                                                                                          </span>
<span class="1901653456173527926" onmouseenter="enter('1901653456173527926');" onmouseout="out('1901653456173527926');" style=""> 109     private long activeCallPostTime;                                                                     </span>
<span  style=""> 110                                                                                                          </span>
<span class="4625474178666977899" onmouseenter="enter('4625474178666977899');" onmouseout="out('4625474178666977899');" style=""> 111     private final BroadcastReceiver mReceiver = new BroadcastReceiver() {                                </span>
<span  style=""> 112                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 113         @Override                                                                                        </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 114         public void onReceive(Context context, Intent intent) {                                          </span>
<span class="5344227773413700857" onmouseenter="enter('5344227773413700857');" onmouseout="out('5344227773413700857');" style=""> 115             String action = intent.getAction();                                                          </span>
<span class="4668300806615190248" onmouseenter="enter('4668300806615190248');" onmouseout="out('4668300806615190248');" style=""> 116             if (action == null) {                                                                        </span>
<span class="-9060638611519565940" onmouseenter="enter('-9060638611519565940');" onmouseout="out('-9060638611519565940');" style=""> 117                 LOG.warn(&quot;no action&quot;);                                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 118                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119             }                                                                                            </span>
<span  style=""> 120                                                                                                          </span>
<span class="-4066678304235095791" onmouseenter="enter('-4066678304235095791');" onmouseout="out('-4066678304235095791');" style=""> 121             int handle = (int) intent.getLongExtra(&quot;handle&quot;, -1);                                        </span>
<span class="6099627150369302694" onmouseenter="enter('6099627150369302694');" onmouseout="out('6099627150369302694');" style=""> 122             switch (action) {                                                                            </span>
<span class="-3756464253045444946" onmouseenter="enter('-3756464253045444946');" onmouseout="out('-3756464253045444946');" style=""> 123                 case GBApplication.ACTION_QUIT:                                                          </span>
<span class="711670831438240238" onmouseenter="enter('711670831438240238');" onmouseout="out('711670831438240238');" style=""> 124                     stopSelf();                                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 125                     break;                                                                               </span>
<span  style=""> 126                                                                                                          </span>
<span class="7089712877132390363" onmouseenter="enter('7089712877132390363');" onmouseout="out('7089712877132390363');" style=""> 127                 case ACTION_OPEN: {                                                                      </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""> 128                     StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();   </span>
<span class="-2620913793661815477" onmouseenter="enter('-2620913793661815477');" onmouseout="out('-2620913793661815477');" style=""> 129                     Long ts = (Long) mNotificationHandleLookup.lookup(handle);                           </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 130                     if (ts == null) {                                                                    </span>
<span class="-3551838833774164230" onmouseenter="enter('-3551838833774164230');" onmouseout="out('-3551838833774164230');" style=""> 131                         LOG.info(&quot;could not lookup handle for open action&quot;);                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 132                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133                     }                                                                                    </span>
<span  style=""> 134                                                                                                          </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 135                     for (StatusBarNotification sbn : sbns) {                                             </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 136                         if (sbn.getPostTime() == ts) {                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 137                             try {                                                                        </span>
<span class="-5589448531951598530" onmouseenter="enter('-5589448531951598530');" onmouseout="out('-5589448531951598530');" style=""> 138                                 PendingIntent pi = sbn.getNotification().contentIntent;                  </span>
<span class="-4590351723917688021" onmouseenter="enter('-4590351723917688021');" onmouseout="out('-4590351723917688021');" style=""> 139                                 if (pi != null) {                                                        </span>
<span class="-4072418890714992779" onmouseenter="enter('-4072418890714992779');" onmouseout="out('-4072418890714992779');" style=""> 140                                     pi.send();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141                                 }                                                                        </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 142                             } catch (PendingIntent.CanceledException e) {                                </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 143                                 e.printStackTrace();                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146                     }                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 147                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148                 }                                                                                        </span>
<span class="-4678853843833528690" onmouseenter="enter('-4678853843833528690');" onmouseout="out('-4678853843833528690');" style=""> 149                 case ACTION_MUTE:                                                                        </span>
<span class="4917035583817915455" onmouseenter="enter('4917035583817915455');" onmouseout="out('4917035583817915455');" style=""> 150                     String packageName = (String) mPackageLookup.lookup(handle);                         </span>
<span class="2797777100746091358" onmouseenter="enter('2797777100746091358');" onmouseout="out('2797777100746091358');" style=""> 151                     if (packageName == null) {                                                           </span>
<span class="5190950653644936431" onmouseenter="enter('5190950653644936431');" onmouseout="out('5190950653644936431');" style=""> 152                         LOG.info(&quot;could not lookup handle for mute action&quot;);                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 153                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154                     }                                                                                    </span>
<span  style=""> 155                                                                                                          </span>
<span class="-55961907216512395" onmouseenter="enter('-55961907216512395');" onmouseout="out('-55961907216512395');" style=""> 156                     LOG.info(&quot;going to mute &quot; + packageName);                                            </span>
<span class="6244948836232449423" onmouseenter="enter('6244948836232449423');" onmouseout="out('6244948836232449423');" style=""> 157                     GBApplication.addAppToNotifBlacklist(packageName);                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 158                     break;                                                                               </span>
<span class="-1141458133536299461" onmouseenter="enter('-1141458133536299461');" onmouseout="out('-1141458133536299461');" style=""> 159                 case ACTION_DISMISS: {                                                                   </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""> 160                     StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();   </span>
<span class="-2620913793661815477" onmouseenter="enter('-2620913793661815477');" onmouseout="out('-2620913793661815477');" style=""> 161                     Long ts = (Long) mNotificationHandleLookup.lookup(handle);                           </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 162                     if (ts == null) {                                                                    </span>
<span class="2968382775980406642" onmouseenter="enter('2968382775980406642');" onmouseout="out('2968382775980406642');" style=""> 163                         LOG.info(&quot;could not lookup handle for dismiss action&quot;);                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 164                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165                     }                                                                                    </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 166                     for (StatusBarNotification sbn : sbns) {                                             </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 167                         if (sbn.getPostTime() == ts) {                                                   </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 168                             if (GBApplication.isRunningLollipopOrLater()) {                              </span>
<span class="6969546006861717982" onmouseenter="enter('6969546006861717982');" onmouseout="out('6969546006861717982');" style=""> 169                                 String key = sbn.getKey();                                               </span>
<span class="-8910102463751962403" onmouseenter="enter('-8910102463751962403');" onmouseout="out('-8910102463751962403');" style=""> 170                                 NotificationListener.this.cancelNotification(key);                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 171                             } else {                                                                     </span>
<span class="8698193459204911181" onmouseenter="enter('8698193459204911181');" onmouseout="out('8698193459204911181');" style=""> 172                                 int id = sbn.getId();                                                    </span>
<span class="-3586097476318973287" onmouseenter="enter('-3586097476318973287');" onmouseout="out('-3586097476318973287');" style=""> 173                                 String pkg = sbn.getPackageName();                                       </span>
<span class="-8898967747084014814" onmouseenter="enter('-8898967747084014814');" onmouseout="out('-8898967747084014814');" style=""> 174                                 String tag = sbn.getTag();                                               </span>
<span class="-7819421458484381897" onmouseenter="enter('-7819421458484381897');" onmouseout="out('-7819421458484381897');" style=""> 175                                 NotificationListener.this.cancelNotification(pkg, tag, id);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178                     }                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 179                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180                 }                                                                                        </span>
<span class="-6975792259235269251" onmouseenter="enter('-6975792259235269251');" onmouseout="out('-6975792259235269251');" style=""> 181                 case ACTION_DISMISS_ALL:                                                                 </span>
<span class="1530048448958335468" onmouseenter="enter('1530048448958335468');" onmouseout="out('1530048448958335468');" style=""> 182                     NotificationListener.this.cancelAllNotifications();                                  </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 183                     break;                                                                               </span>
<span class="-8033996733174441765" onmouseenter="enter('-8033996733174441765');" onmouseout="out('-8033996733174441765');" style=""> 184                 case ACTION_REPLY:                                                                       </span>
<span class="4738866927376315941" onmouseenter="enter('4738866927376315941');" onmouseout="out('4738866927376315941');" style=""><abbr title=" 185                     NotificationCompat.Action wearableAction = (NotificationCompat.Action) mActionLookup.lookup(handle);"> 185                     NotificationCompat.Action wearableAction = (NotificationCompat.Action) mActionLookup.ðŸ”µ</abbr></span>
<span class="2885762978640892133" onmouseenter="enter('2885762978640892133');" onmouseout="out('2885762978640892133');" style=""> 186                     String reply = intent.getStringExtra(&quot;reply&quot;);                                       </span>
<span class="-2711571343237725875" onmouseenter="enter('-2711571343237725875');" onmouseout="out('-2711571343237725875');" style=""> 187                     if (wearableAction != null) {                                                        </span>
<span class="8382710711087379858" onmouseenter="enter('8382710711087379858');" onmouseout="out('8382710711087379858');" style=""> 188                         PendingIntent actionIntent = wearableAction.getActionIntent();                   </span>
<span class="8988901388813075705" onmouseenter="enter('8988901388813075705');" onmouseout="out('8988901388813075705');" style=""> 189                         Intent localIntent = new Intent();                                               </span>
<span class="7096307769955289231" onmouseenter="enter('7096307769955289231');" onmouseout="out('7096307769955289231');" style=""> 190                         localIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);                             </span>
<span class="-3683679949476668963" onmouseenter="enter('-3683679949476668963');" onmouseout="out('-3683679949476668963');" style=""> 191                         if(wearableAction.getRemoteInputs()!=null) {                                     </span>
<span class="-957754769572110349" onmouseenter="enter('-957754769572110349');" onmouseout="out('-957754769572110349');" style=""> 192                             RemoteInput[] remoteInputs = wearableAction.getRemoteInputs();               </span>
<span class="1776998572180860248" onmouseenter="enter('1776998572180860248');" onmouseout="out('1776998572180860248');" style=""> 193                             Bundle extras = new Bundle();                                                </span>
<span class="2352964158014766609" onmouseenter="enter('2352964158014766609');" onmouseout="out('2352964158014766609');" style=""> 194                             extras.putCharSequence(remoteInputs[0].getResultKey(), reply);               </span>
<span class="5088590721402752136" onmouseenter="enter('5088590721402752136');" onmouseout="out('5088590721402752136');" style=""> 195                             RemoteInput.addResultsToIntent(remoteInputs, localIntent, extras);           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196                         }                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 197                         try {                                                                            </span>
<span class="2300129068579463689" onmouseenter="enter('2300129068579463689');" onmouseout="out('2300129068579463689');" style=""> 198                             LOG.info(&quot;will send exec intent to remote application&quot;);                     </span>
<span class="2731482446525466050" onmouseenter="enter('2731482446525466050');" onmouseout="out('2731482446525466050');" style=""> 199                             actionIntent.send(context, 0, localIntent);                                  </span>
<span class="5952869537434724617" onmouseenter="enter('5952869537434724617');" onmouseout="out('5952869537434724617');" style=""> 200                             mActionLookup.remove(handle);                                                </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 201                         } catch (PendingIntent.CanceledException e) {                                    </span>
<span class="-3367288945438988923" onmouseenter="enter('-3367288945438988923');" onmouseout="out('-3367288945438988923');" style=""> 202                             LOG.warn(&quot;replyToLastNotification error: &quot; + e.getLocalizedMessage());       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204                     }                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 205                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207         }                                                                                                </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 208     };                                                                                                   </span>
<span  style=""> 209                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 210     @Override                                                                                            </span>
<span class="-2716773701189387633" onmouseenter="enter('-2716773701189387633');" onmouseout="out('-2716773701189387633');" style=""> 211     public void onCreate() {                                                                             </span>
<span class="-2958534921295515858" onmouseenter="enter('-2958534921295515858');" onmouseout="out('-2958534921295515858');" style=""> 212         super.onCreate();                                                                                </span>
<span class="7618100238646869770" onmouseenter="enter('7618100238646869770');" onmouseout="out('7618100238646869770');" style=""> 213         IntentFilter filterLocal = new IntentFilter();                                                   </span>
<span class="1063910518920289150" onmouseenter="enter('1063910518920289150');" onmouseout="out('1063910518920289150');" style=""> 214         filterLocal.addAction(GBApplication.ACTION_QUIT);                                                </span>
<span class="2076754442287025975" onmouseenter="enter('2076754442287025975');" onmouseout="out('2076754442287025975');" style=""> 215         filterLocal.addAction(ACTION_OPEN);                                                              </span>
<span class="-6869981444846929258" onmouseenter="enter('-6869981444846929258');" onmouseout="out('-6869981444846929258');" style=""> 216         filterLocal.addAction(ACTION_DISMISS);                                                           </span>
<span class="8695742864955675589" onmouseenter="enter('8695742864955675589');" onmouseout="out('8695742864955675589');" style=""> 217         filterLocal.addAction(ACTION_DISMISS_ALL);                                                       </span>
<span class="3848496335642882317" onmouseenter="enter('3848496335642882317');" onmouseout="out('3848496335642882317');" style=""> 218         filterLocal.addAction(ACTION_MUTE);                                                              </span>
<span class="-4535783496195239094" onmouseenter="enter('-4535783496195239094');" onmouseout="out('-4535783496195239094');" style=""> 219         filterLocal.addAction(ACTION_REPLY);                                                             </span>
<span class="-4279331771748389639" onmouseenter="enter('-4279331771748389639');" onmouseout="out('-4279331771748389639');" style=""> 220         LocalBroadcastManager.getInstance(this).registerReceiver(mReceiver, filterLocal);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221     }                                                                                                    </span>
<span  style=""> 222                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 223     @Override                                                                                            </span>
<span class="658855826062432633" onmouseenter="enter('658855826062432633');" onmouseout="out('658855826062432633');" style=""> 224     public void onDestroy() {                                                                            </span>
<span class="1476506345433791001" onmouseenter="enter('1476506345433791001');" onmouseout="out('1476506345433791001');" style=""> 225         LocalBroadcastManager.getInstance(this).unregisterReceiver(mReceiver);                           </span>
<span class="7275190530034972367" onmouseenter="enter('7275190530034972367');" onmouseout="out('7275190530034972367');" style=""> 226         super.onDestroy();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227     }                                                                                                    </span>
<span  style=""> 228                                                                                                          </span>
<span class="4951847030810611879" onmouseenter="enter('4951847030810611879');" onmouseout="out('4951847030810611879');" style=""> 229     public String getAppName(String pkg) {                                                               </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style=""> 230         // determinate Source App Name (&quot;Label&quot;)                                                         </span>
<span class="-6628567271413355488" onmouseenter="enter('-6628567271413355488');" onmouseout="out('-6628567271413355488');" style=""> 231         PackageManager pm = getPackageManager();                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 232         try {                                                                                            </span>
<span class="2215142249605863035" onmouseenter="enter('2215142249605863035');" onmouseout="out('2215142249605863035');" style=""> 233             return (String)pm.getApplicationLabel(pm.getApplicationInfo(pkg, 0));                        </span>
<span class="8932842947262589349" onmouseenter="enter('8932842947262589349');" onmouseout="out('8932842947262589349');" style=""> 234         } catch (PackageManager.NameNotFoundException e) {                                               </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 235             e.printStackTrace();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 237         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238     }                                                                                                    </span>
<span  style=""> 239                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 240     @Override                                                                                            </span>
<span class="-2772368349505117806" onmouseenter="enter('-2772368349505117806');" onmouseout="out('-2772368349505117806');" style=""> 241     public void onNotificationPosted(StatusBarNotification sbn) {                                        </span>
<span class="6669401580814547638" onmouseenter="enter('6669401580814547638');" onmouseout="out('6669401580814547638');" style=""> 242         if (&quot;call&quot;.equals(sbn.getNotification().category)) {                                             </span>
<span class="-4846577510724576112" onmouseenter="enter('-4846577510724576112');" onmouseout="out('-4846577510724576112');" style=""> 243             handleCallNotification(sbn);                                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 244             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245         }                                                                                                </span>
<span class="2998034859944771870" onmouseenter="enter('2998034859944771870');" onmouseout="out('2998034859944771870');" style=""> 246         if (shouldIgnore(sbn)) {                                                                         </span>
<span class="-3980483839174328253" onmouseenter="enter('-3980483839174328253');" onmouseout="out('-3980483839174328253');" style=""> 247             LOG.info(&quot;Ignore notification&quot;);                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 248             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249         }                                                                                                </span>
<span  style=""> 250                                                                                                          </span>
<span  style=""> 251                                                                                                          </span>
<span  style=""> 252                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 253         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span  style=""> 254                                                                                                          </span>
<span class="8054135432811402885" onmouseenter="enter('8054135432811402885');" onmouseout="out('8054135432811402885');" style=""> 255         switch (GBApplication.getGrantedInterruptionFilter()) {                                          </span>
<span class="4109165554183544277" onmouseenter="enter('4109165554183544277');" onmouseout="out('4109165554183544277');" style=""> 256             case NotificationManager.INTERRUPTION_FILTER_ALL:                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 257                 break;                                                                                   </span>
<span class="-4951181644409102304" onmouseenter="enter('-4951181644409102304');" onmouseout="out('-4951181644409102304');" style=""> 258             case NotificationManager.INTERRUPTION_FILTER_ALARMS:                                         </span>
<span class="7344230421954560306" onmouseenter="enter('7344230421954560306');" onmouseout="out('7344230421954560306');" style=""> 259             case NotificationManager.INTERRUPTION_FILTER_NONE:                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 260                 return;                                                                                  </span>
<span class="-4328737131563524650" onmouseenter="enter('-4328737131563524650');" onmouseout="out('-4328737131563524650');" style=""> 261             case NotificationManager.INTERRUPTION_FILTER_PRIORITY:                                       </span>
<span class="8591867555140901755" onmouseenter="enter('8591867555140901755');" onmouseout="out('8591867555140901755');" style=""> 262                 // FIXME: Handle Reminders and Events if they are enabled in Do Not Disturb              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 263                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264         }                                                                                                </span>
<span  style=""> 265                                                                                                          </span>
<span class="3332016722812204086" onmouseenter="enter('3332016722812204086');" onmouseout="out('3332016722812204086');" style=""> 266         String source = sbn.getPackageName().toLowerCase();                                              </span>
<span class="2830045728262824638" onmouseenter="enter('2830045728262824638');" onmouseout="out('2830045728262824638');" style=""> 267         Notification notification = sbn.getNotification();                                               </span>
<span class="4218475881538878307" onmouseenter="enter('4218475881538878307');" onmouseout="out('4218475881538878307');" style=""> 268         if (notificationOldRepeatPrevention.containsKey(source)) {                                       </span>
<span class="6155853035860803703" onmouseenter="enter('6155853035860803703');" onmouseout="out('6155853035860803703');" style=""> 269             if (notification.when &lt;= notificationOldRepeatPrevention.get(source)) {                      </span>
<span class="-4118070098413074653" onmouseenter="enter('-4118070098413074653');" onmouseout="out('-4118070098413074653');" style=""><abbr title=" 270                 LOG.info(&quot;NOT processing notification, already sent newer notifications from this source.&quot;);"> 270                 LOG.info(&quot;NOT processing notification, already sent newer notifications from this source.ðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 271                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273         }                                                                                                </span>
<span  style=""> 274                                                                                                          </span>
<span class="-5834893131205351970" onmouseenter="enter('-5834893131205351970');" onmouseout="out('-5834893131205351970');" style=""> 275         // Ignore too frequent notifications, according to user preference                               </span>
<span class="8739203694966910315" onmouseenter="enter('8739203694966910315');" onmouseout="out('8739203694966910315');" style=""> 276         long min_timeout = (long)prefs.getInt(&quot;notifications_timeout&quot;, 0) * 1000L;                       </span>
<span class="7158364678624901735" onmouseenter="enter('7158364678624901735');" onmouseout="out('7158364678624901735');" style=""> 277         long cur_time = System.currentTimeMillis();                                                      </span>
<span class="4691272725591601941" onmouseenter="enter('4691272725591601941');" onmouseout="out('4691272725591601941');" style=""> 278         if (notificationBurstPrevention.containsKey(source)) {                                           </span>
<span class="-7388621012045880255" onmouseenter="enter('-7388621012045880255');" onmouseout="out('-7388621012045880255');" style=""> 279             long last_time = notificationBurstPrevention.get(source);                                    </span>
<span class="8371821158922557754" onmouseenter="enter('8371821158922557754');" onmouseout="out('8371821158922557754');" style=""> 280             if (cur_time - last_time &lt; min_timeout) {                                                    </span>
<span class="761193726766758320" onmouseenter="enter('761193726766758320');" onmouseout="out('761193726766758320');" style=""><abbr title=" 281                 LOG.info(&quot;Ignoring frequent notification, last one was &quot; + (cur_time - last_time) + &quot;ms ago&quot;);"> 281                 LOG.info(&quot;Ignoring frequent notification, last one was &quot; + (cur_time - last_time) + &quot;ms aðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 282                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284         }                                                                                                </span>
<span  style=""> 285                                                                                                          </span>
<span class="4249292218927487361" onmouseenter="enter('4249292218927487361');" onmouseout="out('4249292218927487361');" style=""> 286         NotificationSpec notificationSpec = new NotificationSpec();                                      </span>
<span  style=""> 287                                                                                                          </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style=""> 288         // determinate Source App Name (&quot;Label&quot;)                                                         </span>
<span class="-1232802106572556205" onmouseenter="enter('-1232802106572556205');" onmouseout="out('-1232802106572556205');" style=""> 289         String name = getAppName(source);                                                                </span>
<span class="8801601261434726216" onmouseenter="enter('8801601261434726216');" onmouseout="out('8801601261434726216');" style=""> 290         if (name != null) {                                                                              </span>
<span class="3305632254012197272" onmouseenter="enter('3305632254012197272');" onmouseout="out('3305632254012197272');" style=""> 291             notificationSpec.sourceName = name;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292         }                                                                                                </span>
<span  style=""> 293                                                                                                          </span>
<span class="-7581221946487094265" onmouseenter="enter('-7581221946487094265');" onmouseout="out('-7581221946487094265');" style=""> 294         boolean preferBigText = false;                                                                   </span>
<span  style=""> 295                                                                                                          </span>
<span class="-1916386255928229930" onmouseenter="enter('-1916386255928229930');" onmouseout="out('-1916386255928229930');" style=""><abbr title=" 296         // Get the app ID that generated this notification. For now only used by pebble color, but may be more useful later."> 296         // Get the app ID that generated this notification. For now only used by pebble color, but may beðŸ”µ</abbr></span>
<span class="-8067455375416267049" onmouseenter="enter('-8067455375416267049');" onmouseout="out('-8067455375416267049');" style=""> 297         notificationSpec.sourceAppId = source;                                                           </span>
<span  style=""> 298                                                                                                          </span>
<span class="-2810132766447661631" onmouseenter="enter('-2810132766447661631');" onmouseout="out('-2810132766447661631');" style=""> 299         notificationSpec.type = AppNotificationType.getInstance().get(source);                           </span>
<span  style=""> 300                                                                                                          </span>
<span class="-7540601865424540593" onmouseenter="enter('-7540601865424540593');" onmouseout="out('-7540601865424540593');" style=""> 301         //FIXME: some quirks lookup table would be the minor evil here                                   </span>
<span class="2207563395624266113" onmouseenter="enter('2207563395624266113');" onmouseout="out('2207563395624266113');" style=""> 302         if (source.startsWith(&quot;com.fsck.k9&quot;)) {                                                          </span>
<span class="-8461204742030134802" onmouseenter="enter('-8461204742030134802');" onmouseout="out('-8461204742030134802');" style=""> 303             if (NotificationCompat.isGroupSummary(notification)) {                                       </span>
<span class="3811797734502814406" onmouseenter="enter('3811797734502814406');" onmouseout="out('3811797734502814406');" style=""> 304                 LOG.info(&quot;ignore K9 group summary&quot;);                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 305                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306             }                                                                                            </span>
<span class="5839263120304468869" onmouseenter="enter('5839263120304468869');" onmouseout="out('5839263120304468869');" style=""> 307             preferBigText = true;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308         }                                                                                                </span>
<span  style=""> 309                                                                                                          </span>
<span class="4253328762370341177" onmouseenter="enter('4253328762370341177');" onmouseout="out('4253328762370341177');" style=""> 310         if (notificationSpec.type == null) {                                                             </span>
<span class="954876523018596305" onmouseenter="enter('954876523018596305');" onmouseout="out('954876523018596305');" style=""> 311             notificationSpec.type = NotificationType.UNKNOWN;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312         }                                                                                                </span>
<span  style=""> 313                                                                                                          </span>
<span class="8812080595679134351" onmouseenter="enter('8812080595679134351');" onmouseout="out('8812080595679134351');" style=""> 314         // Get color                                                                                     </span>
<span class="-7215379846374020112" onmouseenter="enter('-7215379846374020112');" onmouseout="out('-7215379846374020112');" style=""> 315         notificationSpec.pebbleColor = getPebbleColorForNotification(notificationSpec);                  </span>
<span  style=""> 316                                                                                                          </span>
<span class="-2694685924632068401" onmouseenter="enter('-2694685924632068401');" onmouseout="out('-2694685924632068401');" style=""><abbr title=" 317         LOG.info(&quot;Processing notification &quot; + notificationSpec.getId() + &quot; age: &quot; + (System.currentTimeMillis() - notification.when) + &quot; from source &quot; + source + &quot; with flags: &quot; + notification.flags);"> 317         LOG.info(&quot;Processing notification &quot; + notificationSpec.getId() + &quot; age: &quot; + (System.currentTimeMiðŸ”µ</abbr></span>
<span  style=""> 318                                                                                                          </span>
<span class="-5865600179971875271" onmouseenter="enter('-5865600179971875271');" onmouseout="out('-5865600179971875271');" style=""> 319         dissectNotificationTo(notification, notificationSpec, preferBigText);                            </span>
<span  style=""> 320                                                                                                          </span>
<span class="3953264596152234401" onmouseenter="enter('3953264596152234401');" onmouseout="out('3953264596152234401');" style=""><abbr title=" 321         if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificationSpec.body)) {"> 321         if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificatioðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 322             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323         }                                                                                                </span>
<span  style=""> 324                                                                                                          </span>
<span  style=""> 325                                                                                                          </span>
<span class="668617636634990568" onmouseenter="enter('668617636634990568');" onmouseout="out('668617636634990568');" style=""> 326         // ignore Gadgetbridge&#x27;s very own notifications, except for those from the debug screen          </span>
<span class="8240704894033078509" onmouseenter="enter('8240704894033078509');" onmouseout="out('8240704894033078509');" style=""> 327         if (getApplicationContext().getPackageName().equals(source)) {                                   </span>
<span class="-4005163798104538430" onmouseenter="enter('-4005163798104538430');" onmouseout="out('-4005163798104538430');" style=""><abbr title=" 328             if (!getApplicationContext().getString(R.string.test_notification).equals(notificationSpec.title)) {"> 328             if (!getApplicationContext().getString(R.string.test_notification).equals(notificationSpec.tiðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 329                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 331         }                                                                                                </span>
<span  style=""> 332                                                                                                          </span>
<span class="3032759621835437424" onmouseenter="enter('3032759621835437424');" onmouseout="out('3032759621835437424');" style=""><abbr title=" 333         NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(notification);"> 333         NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(noðŸ”µ</abbr></span>
<span class="-1472750016987720650" onmouseenter="enter('-1472750016987720650');" onmouseout="out('-1472750016987720650');" style=""> 334         List&lt;NotificationCompat.Action&gt; actions = wearableExtender.getActions();                         </span>
<span  style=""> 335                                                                                                          </span>
<span  style=""> 336                                                                                                          </span>
<span class="7774033817539746019" onmouseenter="enter('7774033817539746019');" onmouseout="out('7774033817539746019');" style=""><abbr title=" 337         if (actions.size() == 0 &amp;&amp; NotificationCompat.isGroupSummary(notification)) { //this could cause #395 to come back"> 337         if (actions.size() == 0 &amp;&amp; NotificationCompat.isGroupSummary(notification)) { //this could cause ðŸ”µ</abbr></span>
<span class="-2600295662498564908" onmouseenter="enter('-2600295662498564908');" onmouseout="out('-2600295662498564908');" style=""><abbr title=" 338             LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action present. Notification flags: &quot; + notification.flags);"> 338             LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action preseðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 339             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340         }                                                                                                </span>
<span  style=""> 341                                                                                                          </span>
<span class="-5917197971696016550" onmouseenter="enter('-5917197971696016550');" onmouseout="out('-5917197971696016550');" style=""> 342         notificationSpec.attachedActions = new ArrayList&lt;&gt;();                                            </span>
<span  style=""> 343                                                                                                          </span>
<span class="6824678123821134026" onmouseenter="enter('6824678123821134026');" onmouseout="out('6824678123821134026');" style=""> 344         // DISMISS action                                                                                </span>
<span class="5533936039133318070" onmouseenter="enter('5533936039133318070');" onmouseout="out('5533936039133318070');" style=""> 345         NotificationSpec.Action dismissAction = new NotificationSpec.Action();                           </span>
<span class="-2035191731043357921" onmouseenter="enter('-2035191731043357921');" onmouseout="out('-2035191731043357921');" style=""> 346         dismissAction.title = &quot;Dismiss&quot;;                                                                 </span>
<span class="5737664600017371521" onmouseenter="enter('5737664600017371521');" onmouseout="out('5737664600017371521');" style=""> 347         dismissAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_DISMISS;                             </span>
<span class="-4673031657134511356" onmouseenter="enter('-4673031657134511356');" onmouseout="out('-4673031657134511356');" style=""> 348         notificationSpec.attachedActions.add(dismissAction);                                             </span>
<span  style=""> 349                                                                                                          </span>
<span class="-8264806993566587236" onmouseenter="enter('-8264806993566587236');" onmouseout="out('-8264806993566587236');" style=""> 350         for (NotificationCompat.Action act : actions) {                                                  </span>
<span class="-5026732361501841882" onmouseenter="enter('-5026732361501841882');" onmouseout="out('-5026732361501841882');" style=""> 351             if (act != null) {                                                                           </span>
<span class="-5786483650500220153" onmouseenter="enter('-5786483650500220153');" onmouseout="out('-5786483650500220153');" style=""> 352                 NotificationSpec.Action wearableAction = new NotificationSpec.Action();                  </span>
<span class="911429091199110596" onmouseenter="enter('911429091199110596');" onmouseout="out('911429091199110596');" style=""> 353                 wearableAction.title = act.getTitle().toString();                                        </span>
<span class="5243119547087092802" onmouseenter="enter('5243119547087092802');" onmouseout="out('5243119547087092802');" style=""> 354                 if(act.getRemoteInputs()!=null) {                                                        </span>
<span class="3631843705460318974" onmouseenter="enter('3631843705460318974');" onmouseout="out('3631843705460318974');" style=""> 355                     wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_REPLY;                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 356                 } else {                                                                                 </span>
<span class="5019071376909091625" onmouseenter="enter('5019071376909091625');" onmouseout="out('5019071376909091625');" style=""> 357                     wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_SIMPLE;                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358                 }                                                                                        </span>
<span  style=""> 359                                                                                                          </span>
<span class="3300319972847919808" onmouseenter="enter('3300319972847919808');" onmouseout="out('3300319972847919808');" style=""> 360                 notificationSpec.attachedActions.add(wearableAction);                                    </span>
<span class="-7038376970573634272" onmouseenter="enter('-7038376970573634272');" onmouseout="out('-7038376970573634272');" style=""><abbr title=" 361                 mActionLookup.add((notificationSpec.getId()&lt;&lt;4) + notificationSpec.attachedActions.size(), act);"> 361                 mActionLookup.add((notificationSpec.getId()&lt;&lt;4) + notificationSpec.attachedActions.size()ðŸ”µ</abbr></span>
<span class="1537265167944677779" onmouseenter="enter('1537265167944677779');" onmouseout="out('1537265167944677779');" style=""><abbr title=" 362                 LOG.info(&quot;found wearable action: &quot; + notificationSpec.attachedActions.size() + &quot; - &quot;+ act.getTitle() + &quot;  &quot; + sbn.getTag());"> 362                 LOG.info(&quot;found wearable action: &quot; + notificationSpec.attachedActions.size() + &quot; - &quot;+ actðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364         }                                                                                                </span>
<span  style=""> 365                                                                                                          </span>
<span class="7347352498327901971" onmouseenter="enter('7347352498327901971');" onmouseout="out('7347352498327901971');" style=""> 366         // OPEN action                                                                                   </span>
<span class="6797092604605164688" onmouseenter="enter('6797092604605164688');" onmouseout="out('6797092604605164688');" style=""> 367         NotificationSpec.Action openAction = new NotificationSpec.Action();                              </span>
<span class="8898599446651645486" onmouseenter="enter('8898599446651645486');" onmouseout="out('8898599446651645486');" style=""> 368         openAction.title = getString(R.string._pebble_watch_open_on_phone);                              </span>
<span class="620332764476499952" onmouseenter="enter('620332764476499952');" onmouseout="out('620332764476499952');" style=""> 369         openAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_OPEN;                                   </span>
<span class="-654055199082716612" onmouseenter="enter('-654055199082716612');" onmouseout="out('-654055199082716612');" style=""> 370         notificationSpec.attachedActions.add(openAction);                                                </span>
<span  style=""> 371                                                                                                          </span>
<span class="2264132042552456605" onmouseenter="enter('2264132042552456605');" onmouseout="out('2264132042552456605');" style=""> 372         // MUTE action                                                                                   </span>
<span class="-8712525482035557123" onmouseenter="enter('-8712525482035557123');" onmouseout="out('-8712525482035557123');" style=""> 373         NotificationSpec.Action muteAction = new NotificationSpec.Action();                              </span>
<span class="-8110587689026159862" onmouseenter="enter('-8110587689026159862');" onmouseout="out('-8110587689026159862');" style=""> 374         muteAction.title = getString(R.string._pebble_watch_mute);                                       </span>
<span class="6211637458858479364" onmouseenter="enter('6211637458858479364');" onmouseout="out('6211637458858479364');" style=""> 375         muteAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_MUTE;                                   </span>
<span class="1775691680583302265" onmouseenter="enter('1775691680583302265');" onmouseout="out('1775691680583302265');" style=""> 376         notificationSpec.attachedActions.add(muteAction);                                                </span>
<span  style=""> 377                                                                                                          </span>
<span class="-476558653827405923" onmouseenter="enter('-476558653827405923');" onmouseout="out('-476558653827405923');" style=""><abbr title=" 378         mNotificationHandleLookup.add(notificationSpec.getId(), sbn.getPostTime()); // for both DISMISS and OPEN"> 378         mNotificationHandleLookup.add(notificationSpec.getId(), sbn.getPostTime()); // for both DISMISS aðŸ”µ</abbr></span>
<span class="8153579199557574199" onmouseenter="enter('8153579199557574199');" onmouseout="out('8153579199557574199');" style=""> 379         mPackageLookup.add(notificationSpec.getId(), sbn.getPackageName()); // for MUTE                  </span>
<span  style=""> 380                                                                                                          </span>
<span class="5979670797208442666" onmouseenter="enter('5979670797208442666');" onmouseout="out('5979670797208442666');" style=""> 381         notificationBurstPrevention.put(source, cur_time);                                               </span>
<span class="5546492408732750715" onmouseenter="enter('5546492408732750715');" onmouseout="out('5546492408732750715');" style=""> 382         if(0 != notification.when) {                                                                     </span>
<span class="-7718619408843379706" onmouseenter="enter('-7718619408843379706');" onmouseout="out('-7718619408843379706');" style=""> 383         notificationOldRepeatPrevention.put(source, notification.when);                                  </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 384         }else {                                                                                          </span>
<span class="-1627147369441390095" onmouseenter="enter('-1627147369441390095');" onmouseout="out('-1627147369441390095');" style=""><abbr title=" 385             LOG.info(&quot;This app might show old/duplicate notifications. notification.when is 0 for &quot; + source);"> 385             LOG.info(&quot;This app might show old/duplicate notifications. notification.when is 0 for &quot; + souðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 386         }                                                                                                </span>
<span  style=""> 387                                                                                                          </span>
<span class="9189856510229218442" onmouseenter="enter('9189856510229218442');" onmouseout="out('9189856510229218442');" style=""> 388         GBApplication.deviceService().onNotification(notificationSpec);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 389     }                                                                                                    </span>
<span  style=""> 390                                                                                                          </span>
<span class="3489513600177556550" onmouseenter="enter('3489513600177556550');" onmouseout="out('3489513600177556550');" style=""> 391     private boolean checkNotificationContentForWhiteAndBlackList(String packageName, String body) {      </span>
<span class="-150679469252815152" onmouseenter="enter('-150679469252815152');" onmouseout="out('-150679469252815152');" style=""> 392         long start = System.currentTimeMillis();                                                         </span>
<span  style=""> 393                                                                                                          </span>
<span class="2124734257009739137" onmouseenter="enter('2124734257009739137');" onmouseout="out('2124734257009739137');" style=""> 394         List&lt;String&gt; wordsList = new ArrayList&lt;&gt;();                                                      </span>
<span class="8513213831196998490" onmouseenter="enter('8513213831196998490');" onmouseout="out('8513213831196998490');" style=""> 395         NotificationFilter notificationFilter;                                                           </span>
<span  style=""> 396                                                                                                          </span>
<span class="-4590804423150229551" onmouseenter="enter('-4590804423150229551');" onmouseout="out('-4590804423150229551');" style=""> 397         try (DBHandler db = GBApplication.acquireDB()) {                                                 </span>
<span  style=""> 398                                                                                                          </span>
<span class="2403890883362572333" onmouseenter="enter('2403890883362572333');" onmouseout="out('2403890883362572333');" style=""> 399             NotificationFilterDao notificationFilterDao = db.getDaoSession().getNotificationFilterDao(); </span>
<span class="7254238877040119420" onmouseenter="enter('7254238877040119420');" onmouseout="out('7254238877040119420');" style=""><abbr title=" 400             NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilterEntryDao();"> 400             NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilðŸ”µ</abbr></span>
<span  style=""> 401                                                                                                          </span>
<span class="-4728567184917764691" onmouseenter="enter('-4728567184917764691');" onmouseout="out('-4728567184917764691');" style=""><abbr title=" 402             Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFilterDao.Properties.AppIdentifier.eq(packageName.toLowerCase())).build();"> 402             Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFiltðŸ”µ</abbr></span>
<span class="7488324375938324162" onmouseenter="enter('7488324375938324162');" onmouseout="out('7488324375938324162');" style=""> 403             notificationFilter = query.unique();                                                         </span>
<span  style=""> 404                                                                                                          </span>
<span class="6018560877068628254" onmouseenter="enter('6018560877068628254');" onmouseout="out('6018560877068628254');" style=""> 405             if (notificationFilter == null) {                                                            </span>
<span class="8510731869572739415" onmouseenter="enter('8510731869572739415');" onmouseout="out('8510731869572739415');" style=""> 406                 LOG.debug(&quot;No Notification Filter found&quot;);                                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 407                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 408             }                                                                                            </span>
<span  style=""> 409                                                                                                          </span>
<span class="3968012753441467210" onmouseenter="enter('3968012753441467210');" onmouseout="out('3968012753441467210');" style=""> 410             LOG.debug(&quot;Loaded notification filter for &#x27;{}&#x27;&quot;, packageName);                               </span>
<span class="7966618056150210259" onmouseenter="enter('7966618056150210259');" onmouseout="out('7966618056150210259');" style=""><abbr title=" 411             Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().where(NotificationFilterEntryDao.Properties.NotificationFilterId.eq(notificationFilter.getId())).build();"> 411             Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().whereðŸ”µ</abbr></span>
<span  style=""> 412                                                                                                          </span>
<span class="5592374987839394879" onmouseenter="enter('5592374987839394879');" onmouseout="out('5592374987839394879');" style=""> 413             List&lt;NotificationFilterEntry&gt; filterEntries = queryEntries.list();                           </span>
<span  style=""> 414                                                                                                          </span>
<span class="-8976969426120877151" onmouseenter="enter('-8976969426120877151');" onmouseout="out('-8976969426120877151');" style=""> 415             if (BuildConfig.DEBUG) {                                                                     </span>
<span class="-9170185973081630678" onmouseenter="enter('-9170185973081630678');" onmouseout="out('-9170185973081630678');" style=""> 416                 LOG.info(&quot;Database lookup took &#x27;{}&#x27; ms&quot;, System.currentTimeMillis() - start);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 417             }                                                                                            </span>
<span  style=""> 418                                                                                                          </span>
<span class="2077893056906600600" onmouseenter="enter('2077893056906600600');" onmouseout="out('2077893056906600600');" style=""> 419             if (!filterEntries.isEmpty()) {                                                              </span>
<span class="4304008491784528731" onmouseenter="enter('4304008491784528731');" onmouseout="out('4304008491784528731');" style=""> 420                 for (NotificationFilterEntry temp : filterEntries) {                                     </span>
<span class="4808262139369052558" onmouseenter="enter('4808262139369052558');" onmouseout="out('4808262139369052558');" style=""> 421                     wordsList.add(temp.getNotificationFilterContent());                                  </span>
<span class="-2502897764394929378" onmouseenter="enter('-2502897764394929378');" onmouseout="out('-2502897764394929378');" style=""> 422                     LOG.debug(&quot;Loaded filter word: &quot; + temp.getNotificationFilterContent());             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 423                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 424             }                                                                                            </span>
<span  style=""> 425                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 426         } catch (Exception e) {                                                                          </span>
<span class="-7390176680812789235" onmouseenter="enter('-7390176680812789235');" onmouseout="out('-7390176680812789235');" style=""> 427             LOG.error(&quot;Could not acquire DB.&quot;, e);                                                       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 428             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 429         }                                                                                                </span>
<span  style=""> 430                                                                                                          </span>
<span class="-2837061757343239904" onmouseenter="enter('-2837061757343239904');" onmouseout="out('-2837061757343239904');" style=""> 431         return shouldContinueAfterFilter(body, wordsList, notificationFilter);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 432     }                                                                                                    </span>
<span  style=""> 433                                                                                                          </span>
<span class="-5392793857622727834" onmouseenter="enter('-5392793857622727834');" onmouseout="out('-5392793857622727834');" style=""> 434     private void handleCallNotification(StatusBarNotification sbn) {                                     </span>
<span class="-2635029824573834340" onmouseenter="enter('-2635029824573834340');" onmouseout="out('-2635029824573834340');" style=""> 435         String app = sbn.getPackageName();                                                               </span>
<span class="-4765460655732789674" onmouseenter="enter('-4765460655732789674');" onmouseout="out('-4765460655732789674');" style=""> 436         LOG.debug(&quot;got call from: &quot; + app);                                                              </span>
<span class="-1087669074367115225" onmouseenter="enter('-1087669074367115225');" onmouseout="out('-1087669074367115225');" style=""> 437         if(app.equals(&quot;com.android.dialer&quot;)) {                                                           </span>
<span class="5503604353212721032" onmouseenter="enter('5503604353212721032');" onmouseout="out('5503604353212721032');" style=""> 438             LOG.debug(&quot;Ignoring non-voip call&quot;);                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 439             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 440         }                                                                                                </span>
<span class="2515184326717332924" onmouseenter="enter('2515184326717332924');" onmouseout="out('2515184326717332924');" style=""> 441         Notification noti = sbn.getNotification();                                                       </span>
<span class="4917333921300541045" onmouseenter="enter('4917333921300541045');" onmouseout="out('4917333921300541045');" style=""> 442         dumpExtras(noti.extras);                                                                         </span>
<span class="7056760971959382883" onmouseenter="enter('7056760971959382883');" onmouseout="out('7056760971959382883');" style=""> 443         if(noti.actions != null &amp;&amp; noti.actions.length &gt; 0) {                                            </span>
<span class="-8283553374130078748" onmouseenter="enter('-8283553374130078748');" onmouseout="out('-8283553374130078748');" style=""> 444             for (Notification.Action action : noti.actions) {                                            </span>
<span class="4712881017428392998" onmouseenter="enter('4712881017428392998');" onmouseout="out('4712881017428392998');" style=""> 445                 LOG.info(&quot;Found call action: &quot; + action.title);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 446             }                                                                                            </span>
<span class="5573696862010733553" onmouseenter="enter('5573696862010733553');" onmouseout="out('5573696862010733553');" style=""> 447             /*try {                                                                                      </span>
<span class="-4941077910751273482" onmouseenter="enter('-4941077910751273482');" onmouseout="out('-4941077910751273482');" style=""> 448                 LOG.info(&quot;Executing first action&quot;);                                                      </span>
<span class="-6079407865140020178" onmouseenter="enter('-6079407865140020178');" onmouseout="out('-6079407865140020178');" style=""> 449                 noti.actions[0].actionIntent.send();                                                     </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 450             } catch (PendingIntent.CanceledException e) {                                                </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 451                 e.printStackTrace();                                                                     </span>
<span class="-2684617365274670769" onmouseenter="enter('-2684617365274670769');" onmouseout="out('-2684617365274670769');" style=""> 452             }*/                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 453         }                                                                                                </span>
<span  style=""> 454                                                                                                          </span>
<span class="-2563571895899526728" onmouseenter="enter('-2563571895899526728');" onmouseout="out('-2563571895899526728');" style=""> 455         // figure out sender                                                                             </span>
<span class="-9123115817740196080" onmouseenter="enter('-9123115817740196080');" onmouseout="out('-9123115817740196080');" style=""> 456         String number;                                                                                   </span>
<span class="-83871468585037136" onmouseenter="enter('-83871468585037136');" onmouseout="out('-83871468585037136');" style=""> 457         if(noti.extras.containsKey(Notification.EXTRA_PEOPLE)) {                                         </span>
<span class="-9087853976002790509" onmouseenter="enter('-9087853976002790509');" onmouseout="out('-9087853976002790509');" style=""> 458             number = noti.extras.getString(Notification.EXTRA_PEOPLE);                                   </span>
<span class="-2430024668957447800" onmouseenter="enter('-2430024668957447800');" onmouseout="out('-2430024668957447800');" style=""> 459         } else if(noti.extras.containsKey(Notification.EXTRA_TITLE)) {                                   </span>
<span class="-6437685763050744480" onmouseenter="enter('-6437685763050744480');" onmouseout="out('-6437685763050744480');" style=""> 460             number = noti.extras.getString(Notification.EXTRA_TITLE);                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 461         } else {                                                                                         </span>
<span class="8266080573880164526" onmouseenter="enter('8266080573880164526');" onmouseout="out('8266080573880164526');" style=""> 462             String appName = getAppName(app);                                                            </span>
<span class="3077870662190147275" onmouseenter="enter('3077870662190147275');" onmouseout="out('3077870662190147275');" style=""> 463             number = appName != null ? appName : app;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 464         }                                                                                                </span>
<span class="-2521654618349415592" onmouseenter="enter('-2521654618349415592');" onmouseout="out('-2521654618349415592');" style=""> 465         activeCallPostTime = sbn.getPostTime();                                                          </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style=""> 466         CallSpec callSpec = new CallSpec();                                                              </span>
<span class="6754379566106160474" onmouseenter="enter('6754379566106160474');" onmouseout="out('6754379566106160474');" style=""> 467         callSpec.number = number;                                                                        </span>
<span class="-4416193589830976087" onmouseenter="enter('-4416193589830976087');" onmouseout="out('-4416193589830976087');" style=""> 468         callSpec.command = CallSpec.CALL_INCOMING;                                                       </span>
<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style=""> 469         GBApplication.deviceService().onSetCallState(callSpec);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470     }                                                                                                    </span>
<span  style=""> 471                                                                                                          </span>
<span class="2011726315289648221" onmouseenter="enter('2011726315289648221');" onmouseout="out('2011726315289648221');" style=""><abbr title=" 472     boolean shouldContinueAfterFilter(@NonNull String body, @NonNull List&lt;String&gt; wordsList, @NonNull NotificationFilter notificationFilter) {"> 472     boolean shouldContinueAfterFilter(@NonNull String body, @NonNull List&lt;String&gt; wordsList, @NonNull NotðŸ”µ</abbr></span>
<span  style=""> 473                                                                                                          </span>
<span class="-2049928826508332953" onmouseenter="enter('-2049928826508332953');" onmouseout="out('-2049928826508332953');" style=""><abbr title=" 474         LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterMode(), notificationFilter.getNotificationFilterSubMode(), wordsList);"> 474         LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterModðŸ”µ</abbr></span>
<span  style=""> 475                                                                                                          </span>
<span class="2466831550918903346" onmouseenter="enter('2466831550918903346');" onmouseout="out('2466831550918903346');" style=""><abbr title=" 476         boolean allMode = notificationFilter.getNotificationFilterSubMode() == NOTIFICATION_FILTER_SUBMODE_ALL;"> 476         boolean allMode = notificationFilter.getNotificationFilterSubMode() == NOTIFICATION_FILTER_SUBMODðŸ”µ</abbr></span>
<span  style=""> 477                                                                                                          </span>
<span class="7111790076547269568" onmouseenter="enter('7111790076547269568');" onmouseout="out('7111790076547269568');" style=""> 478         switch (notificationFilter.getNotificationFilterMode()) {                                        </span>
<span class="9010216302027839769" onmouseenter="enter('9010216302027839769');" onmouseout="out('9010216302027839769');" style=""> 479             case NOTIFICATION_FILTER_MODE_BLACKLIST:                                                     </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 480                 if (allMode) {                                                                           </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 481                     for (String word : wordsList) {                                                      </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 482                         if (!body.contains(word)) {                                                      </span>
<span class="-6541716343086786985" onmouseenter="enter('-6541716343086786985');" onmouseout="out('-6541716343086786985');" style=""><abbr title=" 483                             LOG.info(&quot;Not every word was found, blacklist has no effect, processing continues.&quot;);"> 483                             LOG.info(&quot;Not every word was found, blacklist has no effect, processing contiðŸ”µ</abbr></span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 484                             return true;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 486                     }                                                                                    </span>
<span class="7128342962819519611" onmouseenter="enter('7128342962819519611');" onmouseout="out('7128342962819519611');" style=""> 487                     LOG.info(&quot;Every word was found, blacklist has effect, processing stops.&quot;);           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 488                     return false;                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 489                 } else {                                                                                 </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""><abbr title=" 490                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));"> 490                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequencðŸ”µ</abbr></span>
<span class="-6184990871390026912" onmouseenter="enter('-6184990871390026912');" onmouseout="out('-6184990871390026912');" style=""> 491                     if (!containsAny) {                                                                  </span>
<span class="-8299034583350120850" onmouseenter="enter('-8299034583350120850');" onmouseout="out('-8299034583350120850');" style=""><abbr title=" 492                         LOG.info(&quot;No matching word was found, blacklist has no effect, processing continues.&quot;);"> 492                         LOG.info(&quot;No matching word was found, blacklist has no effect, processing continuðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 493                     } else {                                                                             </span>
<span class="-1380690990253575343" onmouseenter="enter('-1380690990253575343');" onmouseout="out('-1380690990253575343');" style=""><abbr title=" 494                         LOG.info(&quot;At least one matching word was found, blacklist has effect, processing stops.&quot;);"> 494                         LOG.info(&quot;At least one matching word was found, blacklist has effect, processing ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 495                     }                                                                                    </span>
<span class="3895372753413352625" onmouseenter="enter('3895372753413352625');" onmouseout="out('3895372753413352625');" style=""> 496                     return !containsAny;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 497                 }                                                                                        </span>
<span  style=""> 498                                                                                                          </span>
<span class="-7619441502433256183" onmouseenter="enter('-7619441502433256183');" onmouseout="out('-7619441502433256183');" style=""> 499             case NOTIFICATION_FILTER_MODE_WHITELIST:                                                     </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 500                 if (allMode) {                                                                           </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 501                     for (String word : wordsList) {                                                      </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 502                         if (!body.contains(word)) {                                                      </span>
<span class="-2193044683137963048" onmouseenter="enter('-2193044683137963048');" onmouseout="out('-2193044683137963048');" style=""><abbr title=" 503                             LOG.info(&quot;Not every word was found, whitelist has no effect, processing stops.&quot;);"> 503                             LOG.info(&quot;Not every word was found, whitelist has no effect, processing stopsðŸ”µ</abbr></span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 504                             return false;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 505                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 506                     }                                                                                    </span>
<span class="7060257086642023362" onmouseenter="enter('7060257086642023362');" onmouseout="out('7060257086642023362');" style=""> 507                     LOG.info(&quot;Every word was found, whitelist has effect, processing continues.&quot;);       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 508                     return true;                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 509                 } else {                                                                                 </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""><abbr title=" 510                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));"> 510                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequencðŸ”µ</abbr></span>
<span class="-340597820517180781" onmouseenter="enter('-340597820517180781');" onmouseout="out('-340597820517180781');" style=""> 511                     if (containsAny) {                                                                   </span>
<span class="-1881072703439588003" onmouseenter="enter('-1881072703439588003');" onmouseout="out('-1881072703439588003');" style=""><abbr title=" 512                         LOG.info(&quot;At least one matching word was found, whitelist has effect, processing continues.&quot;);"> 512                         LOG.info(&quot;At least one matching word was found, whitelist has effect, processing ðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 513                     } else {                                                                             </span>
<span class="2098487797015691396" onmouseenter="enter('2098487797015691396');" onmouseout="out('2098487797015691396');" style=""><abbr title=" 514                         LOG.info(&quot;No matching word was found, whitelist has no effect, processing stops.&quot;);"> 514                         LOG.info(&quot;No matching word was found, whitelist has no effect, processing stops.&quot;ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 515                     }                                                                                    </span>
<span class="1941886136813063182" onmouseenter="enter('1941886136813063182');" onmouseout="out('1941886136813063182');" style=""> 516                     return containsAny;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 517                 }                                                                                        </span>
<span  style=""> 518                                                                                                          </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 519             default:                                                                                     </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 520                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 521         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 522     }                                                                                                    </span>
<span  style=""> 523                                                                                                          </span>
<span class="-522333448184701526" onmouseenter="enter('-522333448184701526');" onmouseout="out('-522333448184701526');" style=""> 524     // Strip Unicode control sequences: some apps like Telegram add a lot of them for unknown reasons    </span>
<span class="-8731468808345203749" onmouseenter="enter('-8731468808345203749');" onmouseout="out('-8731468808345203749');" style=""> 525     private String sanitizeUnicode(String orig) {                                                        </span>
<span class="3980018359364350746" onmouseenter="enter('3980018359364350746');" onmouseout="out('3980018359364350746');" style=""> 526         return orig.replaceAll(&quot;\\p{C}&quot;, &quot;&quot;);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 527     }                                                                                                    </span>
<span  style=""> 528                                                                                                          </span>
<span class="-9171831878462980109" onmouseenter="enter('-9171831878462980109');" onmouseout="out('-9171831878462980109');" style=""> 529     private void dissectNotificationTo(Notification notification, NotificationSpec notificationSpec,     </span>
<span class="2688021293853549872" onmouseenter="enter('2688021293853549872');" onmouseout="out('2688021293853549872');" style=""> 530                                        boolean preferBigText) {                                          </span>
<span  style=""> 531                                                                                                          </span>
<span class="-4856559942663327722" onmouseenter="enter('-4856559942663327722');" onmouseout="out('-4856559942663327722');" style=""> 532         Bundle extras = NotificationCompat.getExtras(notification);                                      </span>
<span  style=""> 533                                                                                                          </span>
<span class="1218249610901206964" onmouseenter="enter('1218249610901206964');" onmouseout="out('1218249610901206964');" style=""> 534         //dumpExtras(extras);                                                                            </span>
<span  style=""> 535                                                                                                          </span>
<span class="-6997230475683564369" onmouseenter="enter('-6997230475683564369');" onmouseout="out('-6997230475683564369');" style=""> 536         CharSequence title = extras.getCharSequence(Notification.EXTRA_TITLE);                           </span>
<span class="-5768442231641885516" onmouseenter="enter('-5768442231641885516');" onmouseout="out('-5768442231641885516');" style=""> 537         if (title != null) {                                                                             </span>
<span class="3486456028705164748" onmouseenter="enter('3486456028705164748');" onmouseout="out('3486456028705164748');" style=""> 538             notificationSpec.title = sanitizeUnicode(title.toString());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 539         }                                                                                                </span>
<span  style=""> 540                                                                                                          </span>
<span class="-1675348653102168964" onmouseenter="enter('-1675348653102168964');" onmouseout="out('-1675348653102168964');" style=""> 541         CharSequence contentCS = null;                                                                   </span>
<span class="7665214774958344559" onmouseenter="enter('7665214774958344559');" onmouseout="out('7665214774958344559');" style=""> 542         if (preferBigText &amp;&amp; extras.containsKey(Notification.EXTRA_BIG_TEXT)) {                          </span>
<span class="3933802215223175306" onmouseenter="enter('3933802215223175306');" onmouseout="out('3933802215223175306');" style=""> 543             contentCS = extras.getCharSequence(NotificationCompat.EXTRA_BIG_TEXT);                       </span>
<span class="8631000860903630717" onmouseenter="enter('8631000860903630717');" onmouseout="out('8631000860903630717');" style=""> 544         } else if (extras.containsKey(Notification.EXTRA_TEXT)) {                                        </span>
<span class="-7547654609103611854" onmouseenter="enter('-7547654609103611854');" onmouseout="out('-7547654609103611854');" style=""> 545             contentCS = extras.getCharSequence(NotificationCompat.EXTRA_TEXT);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 546         }                                                                                                </span>
<span class="-2707602363986640259" onmouseenter="enter('-2707602363986640259');" onmouseout="out('-2707602363986640259');" style=""> 547         if (contentCS != null) {                                                                         </span>
<span class="-5564526501110527191" onmouseenter="enter('-5564526501110527191');" onmouseout="out('-5564526501110527191');" style=""> 548             notificationSpec.body = sanitizeUnicode(contentCS.toString());                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 549         }                                                                                                </span>
<span  style=""> 550                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 551     }                                                                                                    </span>
<span  style=""> 552                                                                                                          </span>
<span class="-7937366375312895792" onmouseenter="enter('-7937366375312895792');" onmouseout="out('-7937366375312895792');" style=""> 553     private boolean isServiceRunning() {                                                                 </span>
<span class="-8788124079324077188" onmouseenter="enter('-8788124079324077188');" onmouseout="out('-8788124079324077188');" style=""> 554         ActivityManager manager = (ActivityManager) getSystemService(ACTIVITY_SERVICE);                  </span>
<span class="5841398637891737551" onmouseenter="enter('5841398637891737551');" onmouseout="out('5841398637891737551');" style=""> 555         if (manager == null) {                                                                           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 556             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 557         }                                                                                                </span>
<span class="-1060000448595061247" onmouseenter="enter('-1060000448595061247');" onmouseout="out('-1060000448595061247');" style=""><abbr title=" 558         for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) {"> 558         for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) ðŸ”µ</abbr></span>
<span class="1715383852667790939" onmouseenter="enter('1715383852667790939');" onmouseout="out('1715383852667790939');" style=""> 559             if (DeviceCommunicationService.class.getName().equals(service.service.getClassName())) {     </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 560                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 561             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 562         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 563         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 564     }                                                                                                    </span>
<span  style=""> 565                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 566     /**                                                                                                  </span>
<span class="-3386513456391723953" onmouseenter="enter('-3386513456391723953');" onmouseout="out('-3386513456391723953');" style=""> 567      * Try to handle media session notifications that tell info about the current play state.            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 568      *                                                                                                   </span>
<span class="-2019490562393536710" onmouseenter="enter('-2019490562393536710');" onmouseout="out('-2019490562393536710');" style=""> 569      * @param mediaSession The mediasession to handle.                                                   </span>
<span class="1642728463279900605" onmouseenter="enter('1642728463279900605');" onmouseout="out('1642728463279900605');" style=""> 570      * @return true if notification was handled, false otherwise                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 571      */                                                                                                  </span>
<span class="1254895864500637019" onmouseenter="enter('1254895864500637019');" onmouseout="out('1254895864500637019');" style=""> 572     public boolean handleMediaSessionNotification(MediaSessionCompat.Token mediaSession) {               </span>
<span class="-4606570715029334060" onmouseenter="enter('-4606570715029334060');" onmouseout="out('-4606570715029334060');" style=""> 573         MusicSpec musicSpec = new MusicSpec();                                                           </span>
<span class="6191411421956413825" onmouseenter="enter('6191411421956413825');" onmouseout="out('6191411421956413825');" style=""> 574         MusicStateSpec stateSpec = new MusicStateSpec();                                                 </span>
<span  style=""> 575                                                                                                          </span>
<span class="-6296053285913663629" onmouseenter="enter('-6296053285913663629');" onmouseout="out('-6296053285913663629');" style=""> 576         MediaControllerCompat c;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 577         try {                                                                                            </span>
<span class="7437011440923722104" onmouseenter="enter('7437011440923722104');" onmouseout="out('7437011440923722104');" style=""> 578             c = new MediaControllerCompat(getApplicationContext(), mediaSession);                        </span>
<span  style=""> 579                                                                                                          </span>
<span class="-1916914550610898815" onmouseenter="enter('-1916914550610898815');" onmouseout="out('-1916914550610898815');" style=""> 580             PlaybackStateCompat s = c.getPlaybackState();                                                </span>
<span class="-2990817606835558686" onmouseenter="enter('-2990817606835558686');" onmouseout="out('-2990817606835558686');" style=""> 581             stateSpec.position = (int) (s.getPosition() / 1000);                                         </span>
<span class="5328288853423061088" onmouseenter="enter('5328288853423061088');" onmouseout="out('5328288853423061088');" style=""> 582             stateSpec.playRate = Math.round(100 * s.getPlaybackSpeed());                                 </span>
<span class="2323238932425227387" onmouseenter="enter('2323238932425227387');" onmouseout="out('2323238932425227387');" style=""> 583             stateSpec.repeat = 1;                                                                        </span>
<span class="-2798957985679932557" onmouseenter="enter('-2798957985679932557');" onmouseout="out('-2798957985679932557');" style=""> 584             stateSpec.shuffle = 1;                                                                       </span>
<span class="1453024666101612078" onmouseenter="enter('1453024666101612078');" onmouseout="out('1453024666101612078');" style=""> 585             switch (s.getState()) {                                                                      </span>
<span class="-7604550062433163488" onmouseenter="enter('-7604550062433163488');" onmouseout="out('-7604550062433163488');" style=""> 586                 case PlaybackState.STATE_PLAYING:                                                        </span>
<span class="-5997751080810805230" onmouseenter="enter('-5997751080810805230');" onmouseout="out('-5997751080810805230');" style=""> 587                     stateSpec.state = MusicStateSpec.STATE_PLAYING;                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 588                     break;                                                                               </span>
<span class="4895305209877093306" onmouseenter="enter('4895305209877093306');" onmouseout="out('4895305209877093306');" style=""> 589                 case PlaybackState.STATE_STOPPED:                                                        </span>
<span class="7340128138398857774" onmouseenter="enter('7340128138398857774');" onmouseout="out('7340128138398857774');" style=""> 590                     stateSpec.state = MusicStateSpec.STATE_STOPPED;                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 591                     break;                                                                               </span>
<span class="-7061407832272958754" onmouseenter="enter('-7061407832272958754');" onmouseout="out('-7061407832272958754');" style=""> 592                 case PlaybackState.STATE_PAUSED:                                                         </span>
<span class="928317678007732085" onmouseenter="enter('928317678007732085');" onmouseout="out('928317678007732085');" style=""> 593                     stateSpec.state = MusicStateSpec.STATE_PAUSED;                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 594                     break;                                                                               </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 595                 default:                                                                                 </span>
<span class="1494209818965165815" onmouseenter="enter('1494209818965165815');" onmouseout="out('1494209818965165815');" style=""> 596                     stateSpec.state = MusicStateSpec.STATE_UNKNOWN;                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 597                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 598             }                                                                                            </span>
<span  style=""> 599                                                                                                          </span>
<span class="-1378394649293702376" onmouseenter="enter('-1378394649293702376');" onmouseout="out('-1378394649293702376');" style=""> 600             MediaMetadataCompat d = c.getMetadata();                                                     </span>
<span class="1381395247865936457" onmouseenter="enter('1381395247865936457');" onmouseout="out('1381395247865936457');" style=""> 601             if (d == null)                                                                               </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 602                 return false;                                                                            </span>
<span class="7299474512588472960" onmouseenter="enter('7299474512588472960');" onmouseout="out('7299474512588472960');" style=""> 603             if (d.containsKey(MediaMetadata.METADATA_KEY_ARTIST))                                        </span>
<span class="-145858411899069051" onmouseenter="enter('-145858411899069051');" onmouseout="out('-145858411899069051');" style=""> 604                 musicSpec.artist = d.getString(MediaMetadataCompat.METADATA_KEY_ARTIST);                 </span>
<span class="563580125723474981" onmouseenter="enter('563580125723474981');" onmouseout="out('563580125723474981');" style=""> 605             if (d.containsKey(MediaMetadata.METADATA_KEY_ALBUM))                                         </span>
<span class="1803038863600841979" onmouseenter="enter('1803038863600841979');" onmouseout="out('1803038863600841979');" style=""> 606                 musicSpec.album = d.getString(MediaMetadataCompat.METADATA_KEY_ALBUM);                   </span>
<span class="-1766324950453780005" onmouseenter="enter('-1766324950453780005');" onmouseout="out('-1766324950453780005');" style=""> 607             if (d.containsKey(MediaMetadata.METADATA_KEY_TITLE))                                         </span>
<span class="-6541941403865600636" onmouseenter="enter('-6541941403865600636');" onmouseout="out('-6541941403865600636');" style=""> 608                 musicSpec.track = d.getString(MediaMetadataCompat.METADATA_KEY_TITLE);                   </span>
<span class="-690335942087370936" onmouseenter="enter('-690335942087370936');" onmouseout="out('-690335942087370936');" style=""> 609             if (d.containsKey(MediaMetadata.METADATA_KEY_DURATION))                                      </span>
<span class="-139118447155224577" onmouseenter="enter('-139118447155224577');" onmouseout="out('-139118447155224577');" style=""> 610                 musicSpec.duration = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_DURATION) / 1000;  </span>
<span class="6028497768136929228" onmouseenter="enter('6028497768136929228');" onmouseout="out('6028497768136929228');" style=""> 611             if (d.containsKey(MediaMetadata.METADATA_KEY_NUM_TRACKS))                                    </span>
<span class="6703481613150545995" onmouseenter="enter('6703481613150545995');" onmouseout="out('6703481613150545995');" style=""> 612                 musicSpec.trackCount = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_NUM_TRACKS);     </span>
<span class="3843094866204545202" onmouseenter="enter('3843094866204545202');" onmouseout="out('3843094866204545202');" style=""> 613             if (d.containsKey(MediaMetadata.METADATA_KEY_TRACK_NUMBER))                                  </span>
<span class="1727735009143440653" onmouseenter="enter('1727735009143440653');" onmouseout="out('1727735009143440653');" style=""> 614                 musicSpec.trackNr = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_TRACK_NUMBER);      </span>
<span  style=""> 615                                                                                                          </span>
<span class="2207286164059072520" onmouseenter="enter('2207286164059072520');" onmouseout="out('2207286164059072520');" style=""> 616             // finally, tell the device about it                                                         </span>
<span class="7157573786903835889" onmouseenter="enter('7157573786903835889');" onmouseout="out('7157573786903835889');" style=""> 617             GBApplication.deviceService().onSetMusicInfo(musicSpec);                                     </span>
<span class="-6342881769260875577" onmouseenter="enter('-6342881769260875577');" onmouseout="out('-6342881769260875577');" style=""> 618             GBApplication.deviceService().onSetMusicState(stateSpec);                                    </span>
<span  style=""> 619                                                                                                          </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 620             return true;                                                                                 </span>
<span class="3226201684513186940" onmouseenter="enter('3226201684513186940');" onmouseout="out('3226201684513186940');" style=""> 621         } catch (NullPointerException | RemoteException e) {                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 622             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 623         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 624     }                                                                                                    </span>
<span  style=""> 625                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 626     @Override                                                                                            </span>
<span class="2733031363552103422" onmouseenter="enter('2733031363552103422');" onmouseout="out('2733031363552103422');" style=""> 627     public void onNotificationRemoved(StatusBarNotification sbn) {                                       </span>
<span class="-4502832560681421381" onmouseenter="enter('-4502832560681421381');" onmouseout="out('-4502832560681421381');" style=""><abbr title=" 628         LOG.info(&quot;Notification removed: &quot; + sbn.getPackageName() + &quot;: &quot; + sbn.getNotification().category);"> 628         LOG.info(&quot;Notification removed: &quot; + sbn.getPackageName() + &quot;: &quot; + sbn.getNotification().category)ðŸ”µ</abbr></span>
<span class="940449061862943006" onmouseenter="enter('940449061862943006');" onmouseout="out('940449061862943006');" style=""><abbr title=" 629         if(Notification.CATEGORY_CALL.equals(sbn.getNotification().category) &amp;&amp; activeCallPostTime == sbn.getPostTime()) {"> 629         if(Notification.CATEGORY_CALL.equals(sbn.getNotification().category) &amp;&amp; activeCallPostTime == sbnðŸ”µ</abbr></span>
<span class="-3941810167705609591" onmouseenter="enter('-3941810167705609591');" onmouseout="out('-3941810167705609591');" style=""> 630             activeCallPostTime = 0;                                                                      </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style=""> 631             CallSpec callSpec = new CallSpec();                                                          </span>
<span class="-7261749156805075102" onmouseenter="enter('-7261749156805075102');" onmouseout="out('-7261749156805075102');" style=""> 632             callSpec.command = CallSpec.CALL_END;                                                        </span>
<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style=""> 633             GBApplication.deviceService().onSetCallState(callSpec);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 634         }                                                                                                </span>
<span class="-7767930678383346096" onmouseenter="enter('-7767930678383346096');" onmouseout="out('-7767930678383346096');" style=""> 635         // FIXME: DISABLED for now                                                                       </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 636         /*                                                                                               </span>
<span class="1980360516715691973" onmouseenter="enter('1980360516715691973');" onmouseout="out('1980360516715691973');" style=""> 637         if (shouldIgnore(sbn))                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 638             return;                                                                                      </span>
<span  style=""> 639                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 640         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="-1523052147845593738" onmouseenter="enter('-1523052147845593738');" onmouseout="out('-1523052147845593738');" style=""> 641         if (prefs.getBoolean(&quot;autoremove_notifications&quot;, false)) {                                       </span>
<span class="-1849447037737481789" onmouseenter="enter('-1849447037737481789');" onmouseout="out('-1849447037737481789');" style=""> 642             LOG.info(&quot;notification removed, will ask device to delete it&quot;);                              </span>
<span class="-8504489390442611809" onmouseenter="enter('-8504489390442611809');" onmouseout="out('-8504489390442611809');" style=""> 643             GBApplication.deviceService().onDeleteNotification((int) sbn.getPostTime());                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 644         }                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 645         */                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 646     }                                                                                                    </span>
<span  style=""> 647                                                                                                          </span>
<span  style=""> 648                                                                                                          </span>
<span class="2967918509730451591" onmouseenter="enter('2967918509730451591');" onmouseout="out('2967918509730451591');" style=""> 649     private void dumpExtras(Bundle bundle) {                                                             </span>
<span class="-755508411737932855" onmouseenter="enter('-755508411737932855');" onmouseout="out('-755508411737932855');" style=""> 650         for (String key : bundle.keySet()) {                                                             </span>
<span class="-680967060076152312" onmouseenter="enter('-680967060076152312');" onmouseout="out('-680967060076152312');" style=""> 651             Object value = bundle.get(key);                                                              </span>
<span class="-5708365098537636921" onmouseenter="enter('-5708365098537636921');" onmouseout="out('-5708365098537636921');" style=""> 652             if (value == null) {                                                                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 653                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 654             }                                                                                            </span>
<span class="6935438865287804705" onmouseenter="enter('6935438865287804705');" onmouseout="out('6935438865287804705');" style=""><abbr title=" 655             LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClass().getName()));"> 655             LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClaðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 656         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 657     }                                                                                                    </span>
<span  style=""> 658                                                                                                          </span>
<span  style=""> 659                                                                                                          </span>
<span class="-4145111049531346189" onmouseenter="enter('-4145111049531346189');" onmouseout="out('-4145111049531346189');" style=""> 660     private boolean shouldIgnore(StatusBarNotification sbn) {                                            </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 661         /*                                                                                               </span>
<span class="8751388135302008830" onmouseenter="enter('8751388135302008830');" onmouseout="out('8751388135302008830');" style=""> 662         * return early if DeviceCommunicationService is not running,                                     </span>
<span class="2502615223278385984" onmouseenter="enter('2502615223278385984');" onmouseout="out('2502615223278385984');" style=""> 663         * else the service would get started every time we get a notification.                           </span>
<span class="-5425061837888704430" onmouseenter="enter('-5425061837888704430');" onmouseout="out('-5425061837888704430');" style=""> 664         * unfortunately we cannot enable/disable NotificationListener at runtime like we do with         </span>
<span class="4838982710001585921" onmouseenter="enter('4838982710001585921');" onmouseout="out('4838982710001585921');" style=""> 665         * broadcast receivers because it seems to invalidate the permissions that are                    </span>
<span class="-2921629841702414230" onmouseenter="enter('-2921629841702414230');" onmouseout="out('-2921629841702414230');" style=""> 666         * necessary for NotificationListenerService                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 667         */                                                                                               </span>
<span class="-3255765405089884099" onmouseenter="enter('-3255765405089884099');" onmouseout="out('-3255765405089884099');" style=""> 668         if (!isServiceRunning() || sbn == null) {                                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 669             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 670         }                                                                                                </span>
<span  style=""> 671                                                                                                          </span>
<span class="8647073884367840020" onmouseenter="enter('8647073884367840020');" onmouseout="out('8647073884367840020');" style=""> 672         return shouldIgnoreSource(sbn.getPackageName()) || shouldIgnoreNotification(                     </span>
<span class="-1392203204106720793" onmouseenter="enter('-1392203204106720793');" onmouseout="out('-1392203204106720793');" style=""> 673                 sbn.getNotification(), sbn.getPackageName());                                            </span>
<span  style=""> 674                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 675     }                                                                                                    </span>
<span  style=""> 676                                                                                                          </span>
<span class="8460515521985572441" onmouseenter="enter('8460515521985572441');" onmouseout="out('8460515521985572441');" style=""> 677     private boolean shouldIgnoreSource(String source) {                                                  </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 678         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span  style=""> 679                                                                                                          </span>
<span class="714714039810027052" onmouseenter="enter('714714039810027052');" onmouseout="out('714714039810027052');" style=""> 680         /* do not display messages from &quot;android&quot;                                                        </span>
<span class="1893274482542565547" onmouseenter="enter('1893274482542565547');" onmouseout="out('1893274482542565547');" style=""> 681          * This includes keyboard selection message, usb connection messages, etc                        </span>
<span class="-7750906811397804767" onmouseenter="enter('-7750906811397804767');" onmouseout="out('-7750906811397804767');" style=""> 682          * Hope it does not filter out too much, we will see...                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 683          */                                                                                              </span>
<span  style=""> 684                                                                                                          </span>
<span class="1872165376889396003" onmouseenter="enter('1872165376889396003');" onmouseout="out('1872165376889396003');" style=""> 685         if (source.equals(&quot;android&quot;) ||                                                                  </span>
<span class="1446354513639890825" onmouseenter="enter('1446354513639890825');" onmouseout="out('1446354513639890825');" style=""> 686                 source.equals(&quot;com.android.systemui&quot;) ||                                                 </span>
<span class="-4630583015863350357" onmouseenter="enter('-4630583015863350357');" onmouseout="out('-4630583015863350357');" style=""> 687                 source.equals(&quot;com.android.dialer&quot;) ||                                                   </span>
<span class="-4581680912095398334" onmouseenter="enter('-4581680912095398334');" onmouseout="out('-4581680912095398334');" style=""> 688                 source.equals(&quot;com.cyanogenmod.eleven&quot;)) {                                               </span>
<span class="7414276835277607055" onmouseenter="enter('7414276835277607055');" onmouseout="out('7414276835277607055');" style=""> 689             LOG.info(&quot;Ignoring notification, is a system event&quot;);                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 690             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 691         }                                                                                                </span>
<span  style=""> 692                                                                                                          </span>
<span class="6340978795702098449" onmouseenter="enter('6340978795702098449');" onmouseout="out('6340978795702098449');" style=""> 693         if (source.equals(&quot;com.moez.QKSMS&quot;) ||                                                           </span>
<span class="3673317982547560929" onmouseenter="enter('3673317982547560929');" onmouseout="out('3673317982547560929');" style=""> 694                 source.equals(&quot;com.android.mms&quot;) ||                                                      </span>
<span class="-6538830744852229820" onmouseenter="enter('-6538830744852229820');" onmouseout="out('-6538830744852229820');" style=""> 695                 source.equals(&quot;com.sonyericsson.conversations&quot;) ||                                       </span>
<span class="-1795882970722883910" onmouseenter="enter('-1795882970722883910');" onmouseout="out('-1795882970722883910');" style=""> 696                 source.equals(&quot;com.android.messaging&quot;) ||                                                </span>
<span class="4780395695457664313" onmouseenter="enter('4780395695457664313');" onmouseout="out('4780395695457664313');" style=""> 697                 source.equals(&quot;org.smssecure.smssecure&quot;)) {                                              </span>
<span class="7115714847551904856" onmouseenter="enter('7115714847551904856');" onmouseout="out('7115714847551904856');" style=""> 698             if (!&quot;never&quot;.equals(prefs.getString(&quot;notification_mode_sms&quot;, &quot;when_screen_off&quot;))) {          </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 699                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 700             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 701         }                                                                                                </span>
<span  style=""> 702                                                                                                          </span>
<span class="6044120705305546650" onmouseenter="enter('6044120705305546650');" onmouseout="out('6044120705305546650');" style=""> 703         if (GBApplication.appIsNotifBlacklisted(source)) {                                               </span>
<span class="-8656872471771272619" onmouseenter="enter('-8656872471771272619');" onmouseout="out('-8656872471771272619');" style=""> 704             LOG.info(&quot;Ignoring notification, application is blacklisted&quot;);                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 705             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 706         }                                                                                                </span>
<span  style=""> 707                                                                                                          </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 708         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 709     }                                                                                                    </span>
<span  style=""> 710                                                                                                          </span>
<span class="1856078835330472094" onmouseenter="enter('1856078835330472094');" onmouseout="out('1856078835330472094');" style=""> 711     private boolean shouldIgnoreNotification(Notification notification, String source) {                 </span>
<span  style=""> 712                                                                                                          </span>
<span class="2710746236440319224" onmouseenter="enter('2710746236440319224');" onmouseout="out('2710746236440319224');" style=""> 713         MediaSessionCompat.Token mediaSession = getMediaSession(notification);                           </span>
<span class="-7174765412912193274" onmouseenter="enter('-7174765412912193274');" onmouseout="out('-7174765412912193274');" style=""> 714         //try to handle media session notifications                                                      </span>
<span class="3009058002375133697" onmouseenter="enter('3009058002375133697');" onmouseout="out('3009058002375133697');" style=""> 715         if (mediaSession != null &amp;&amp; handleMediaSessionNotification(mediaSession))                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 716             return true;                                                                                 </span>
<span  style=""> 717                                                                                                          </span>
<span class="8585714054343457960" onmouseenter="enter('8585714054343457960');" onmouseout="out('8585714054343457960');" style=""> 718         NotificationType type = AppNotificationType.getInstance().get(source);                           </span>
<span class="-3108268637978238079" onmouseenter="enter('-3108268637978238079');" onmouseout="out('-3108268637978238079');" style=""><abbr title=" 719         //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/Notification.html#FLAG_LOCAL_ONLY"> 719         //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/NoðŸ”µ</abbr></span>
<span class="1334602672683683072" onmouseenter="enter('1334602672683683072');" onmouseout="out('1334602672683683072');" style=""> 720         //some Apps always mark their notifcations as read-only                                          </span>
<span class="-5418244290311748300" onmouseenter="enter('-5418244290311748300');" onmouseout="out('-5418244290311748300');" style=""> 721         if (NotificationCompat.getLocalOnly(notification) &amp;&amp;                                             </span>
<span class="7056635344578594111" onmouseenter="enter('7056635344578594111');" onmouseout="out('7056635344578594111');" style=""> 722                 type != NotificationType.WECHAT &amp;&amp;                                                       </span>
<span class="-8701954321417018195" onmouseenter="enter('-8701954321417018195');" onmouseout="out('-8701954321417018195');" style=""> 723                 type != NotificationType.OUTLOOK &amp;&amp;                                                      </span>
<span class="-8347560682459681115" onmouseenter="enter('-8347560682459681115');" onmouseout="out('-8347560682459681115');" style=""><abbr title=" 724                 type != NotificationType.SKYPE) { //see https://github.com/Freeyourgadget/Gadgetbridge/issues/1109"> 724                 type != NotificationType.SKYPE) { //see https://github.com/Freeyourgadget/Gadgetbridge/isðŸ”µ</abbr></span>
<span class="-8433825860703034123" onmouseenter="enter('-8433825860703034123');" onmouseout="out('-8433825860703034123');" style=""> 725             LOG.info(&quot;local only&quot;);                                                                      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 726             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 727         }                                                                                                </span>
<span  style=""> 728                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 729         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="7394809232234198434" onmouseenter="enter('7394809232234198434');" onmouseout="out('7394809232234198434');" style=""> 730         if (!prefs.getBoolean(&quot;notifications_generic_whenscreenon&quot;, false)) {                            </span>
<span class="-494499854560412945" onmouseenter="enter('-494499854560412945');" onmouseout="out('-494499854560412945');" style=""> 731             PowerManager powermanager = (PowerManager) getSystemService(POWER_SERVICE);                  </span>
<span class="-5667675384255289213" onmouseenter="enter('-5667675384255289213');" onmouseout="out('-5667675384255289213');" style=""> 732             if (powermanager != null &amp;&amp; powermanager.isScreenOn()) {                                     </span>
<span class="1543062508857536366" onmouseenter="enter('1543062508857536366');" onmouseout="out('1543062508857536366');" style=""><abbr title=" 733 //                LOG.info(&quot;Not forwarding notification, screen seems to be on and settings do not allow this&quot;);"> 733 //                LOG.info(&quot;Not forwarding notification, screen seems to be on and settings do not allow ðŸ”µ</abbr></span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 734                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 735             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 736         }                                                                                                </span>
<span  style=""> 737                                                                                                          </span>
<span class="3125878453643003848" onmouseenter="enter('3125878453643003848');" onmouseout="out('3125878453643003848');" style=""> 738         return (notification.flags &amp; Notification.FLAG_ONGOING_EVENT) == Notification.FLAG_ONGOING_EVENT;</span>
<span  style=""> 739                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 740     }                                                                                                    </span>
<span  style=""> 741                                                                                                          </span>
<span  style=""> 742                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 743     /**                                                                                                  </span>
<span class="-3600272953695402454" onmouseenter="enter('-3600272953695402454');" onmouseout="out('-3600272953695402454');" style=""> 744      * Get the notification color that should be used for this Pebble notification.                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 745      *                                                                                                   </span>
<span class="-6380098887809341874" onmouseenter="enter('-6380098887809341874');" onmouseout="out('-6380098887809341874');" style=""><abbr title=" 746      * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PebbleColor."> 746      * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PeðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 747      *                                                                                                   </span>
<span class="-5220482988035539244" onmouseenter="enter('-5220482988035539244');" onmouseout="out('-5220482988035539244');" style=""> 748      * See Issue #815 on GitHub to see how notification colors are set.                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 749      *                                                                                                   </span>
<span class="-144667098623416646" onmouseenter="enter('-144667098623416646');" onmouseout="out('-144667098623416646');" style=""> 750      * @param notificationSpec The NotificationSpec to read from.                                        </span>
<span class="-8231127304595524287" onmouseenter="enter('-8231127304595524287');" onmouseout="out('-8231127304595524287');" style=""> 751      * @return Returns a PebbleColor that best represents this notification.                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 752      */                                                                                                  </span>
<span class="-8858039465077957361" onmouseenter="enter('-8858039465077957361');" onmouseout="out('-8858039465077957361');" style=""> 753     private byte getPebbleColorForNotification(NotificationSpec notificationSpec) {                      </span>
<span class="2461936733082927787" onmouseenter="enter('2461936733082927787');" onmouseout="out('2461936733082927787');" style=""> 754         String appId = notificationSpec.sourceAppId;                                                     </span>
<span class="6072026966279222546" onmouseenter="enter('6072026966279222546');" onmouseout="out('6072026966279222546');" style=""> 755         NotificationType existingType = notificationSpec.type;                                           </span>
<span  style=""> 756                                                                                                          </span>
<span class="-4597227445151323685" onmouseenter="enter('-4597227445151323685');" onmouseout="out('-4597227445151323685');" style=""> 757         // If the notification type is known, return the associated color.                               </span>
<span class="-3115160525838252691" onmouseenter="enter('-3115160525838252691');" onmouseout="out('-3115160525838252691');" style=""> 758         if (existingType != NotificationType.UNKNOWN) {                                                  </span>
<span class="4443749667658266101" onmouseenter="enter('4443749667658266101');" onmouseout="out('4443749667658266101');" style=""> 759             return existingType.color;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 760         }                                                                                                </span>
<span  style=""> 761                                                                                                          </span>
<span class="128994715916204674" onmouseenter="enter('128994715916204674');" onmouseout="out('128994715916204674');" style=""> 762         // Otherwise, we go and attempt to find the color from the app icon.                             </span>
<span class="-6191555258820518316" onmouseenter="enter('-6191555258820518316');" onmouseout="out('-6191555258820518316');" style=""> 763         Drawable icon;                                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 764         try {                                                                                            </span>
<span class="8261548971879133584" onmouseenter="enter('8261548971879133584');" onmouseout="out('8261548971879133584');" style=""> 765             icon = getApplicationContext().getPackageManager().getApplicationIcon(appId);                </span>
<span class="6230969829088056905" onmouseenter="enter('6230969829088056905');" onmouseout="out('6230969829088056905');" style=""> 766             Objects.requireNonNull(icon);                                                                </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style=""> 767         } catch (Exception ex) {                                                                         </span>
<span class="-3868233956680081057" onmouseenter="enter('-3868233956680081057');" onmouseout="out('-3868233956680081057');" style=""> 768             // If we can&#x27;t get the icon, we go with the default defined above.                           </span>
<span class="-5905931119091130668" onmouseenter="enter('-5905931119091130668');" onmouseout="out('-5905931119091130668');" style=""> 769             LOG.warn(&quot;Could not get icon for AppID &quot; + appId, ex);                                       </span>
<span class="5002487793506958772" onmouseenter="enter('5002487793506958772');" onmouseout="out('5002487793506958772');" style=""> 770             return PebbleColor.IslamicGreen;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 771         }                                                                                                </span>
<span  style=""> 772                                                                                                          </span>
<span class="-5100715979180048388" onmouseenter="enter('-5100715979180048388');" onmouseout="out('-5100715979180048388');" style=""> 773         Bitmap bitmapIcon = BitmapUtil.convertDrawableToBitmap(icon);                                    </span>
<span class="-8268037003500299815" onmouseenter="enter('-8268037003500299815');" onmouseout="out('-8268037003500299815');" style=""> 774         int iconPrimaryColor = new Palette.Builder(bitmapIcon)                                           </span>
<span class="-3438664463656085757" onmouseenter="enter('-3438664463656085757');" onmouseout="out('-3438664463656085757');" style=""> 775                 .generate()                                                                              </span>
<span class="-7390360638896501298" onmouseenter="enter('-7390360638896501298');" onmouseout="out('-7390360638896501298');" style=""> 776                 .getVibrantColor(Color.parseColor(&quot;#aa0000&quot;));                                           </span>
<span  style=""> 777                                                                                                          </span>
<span class="5649835422942677201" onmouseenter="enter('5649835422942677201');" onmouseout="out('5649835422942677201');" style=""> 778         return PebbleUtils.getPebbleColor(iconPrimaryColor);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 779     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 780 }                                                                                                        </span>











































</pre></td>
                            <td><pre><span class="-230343772074056088" onmouseenter="enter('-230343772074056088');" onmouseout="out('-230343772074056088');" style="">   1 /*  Copyright (C) 2015-2018 Andreas Shimokawa, Carsten Pfeiffer, Daniele                                 </span>
<span class="2492236627567978380" onmouseenter="enter('2492236627567978380');" onmouseout="out('2492236627567978380');" style="">   2     Gobbetti, Frank Slezak, Hasan Ammar, JosÃ© Rebelo, Julien Pivotto, Kevin                              </span>
<span class="-504983364603579348" onmouseenter="enter('-504983364603579348');" onmouseout="out('-504983364603579348');" style="">   3     Richter, Normano64, Steffen Liebergeld, Taavi EomÃ¤e, Zhong Jianxin                                   </span>
<span  style="">   4                                                                                                          </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   5     This file is part of Gadgetbridge.                                                                   </span>
<span  style="">   6                                                                                                          </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   7     Gadgetbridge is free software: you can redistribute it and/or modify                                 </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   8     it under the terms of the GNU Affero General Public License as published                             </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">   9     by the Free Software Foundation, either version 3 of the License, or                                 </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">  10     (at your option) any later version.                                                                  </span>
<span  style="">  11                                                                                                          </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  12     Gadgetbridge is distributed in the hope that it will be useful,                                      </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  13     but WITHOUT ANY WARRANTY; without even the implied warranty of                                       </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  14     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                        </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  15     GNU Affero General Public License for more details.                                                  </span>
<span  style="">  16                                                                                                          </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  17     You should have received a copy of the GNU Affero General Public License                             </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  18     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                             </span>
<span class="8249211937858728345" onmouseenter="enter('8249211937858728345');" onmouseout="out('8249211937858728345');" style="">  19 package nodomain.freeyourgadget.gadgetbridge.externalevents;                                             </span>
<span  style="">  20                                                                                                          </span>
<span class="-867022162471464761" onmouseenter="enter('-867022162471464761');" onmouseout="out('-867022162471464761');" style="">  21 import android.app.ActivityManager;                                                                      </span>
<span class="1017587490774535994" onmouseenter="enter('1017587490774535994');" onmouseout="out('1017587490774535994');" style="">  22 import android.app.Notification;                                                                         </span>
<span class="2183671588995744448" onmouseenter="enter('2183671588995744448');" onmouseout="out('2183671588995744448');" style="">  23 import android.app.NotificationManager;                                                                  </span>
<span class="2265467446931963889" onmouseenter="enter('2265467446931963889');" onmouseout="out('2265467446931963889');" style="">  24 import android.app.PendingIntent;                                                                        </span>
<span class="-489389385851058391" onmouseenter="enter('-489389385851058391');" onmouseout="out('-489389385851058391');" style="">  25 import android.content.BroadcastReceiver;                                                                </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  26 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  27 import android.content.Intent;                                                                           </span>
<span class="8697221465021235869" onmouseenter="enter('8697221465021235869');" onmouseout="out('8697221465021235869');" style="">  28 import android.content.IntentFilter;                                                                     </span>
<span class="-841431222158024655" onmouseenter="enter('-841431222158024655');" onmouseout="out('-841431222158024655');" style="">  29 import android.content.pm.ApplicationInfo;                                                               </span>
<span class="-1290624633738557221" onmouseenter="enter('-1290624633738557221');" onmouseout="out('-1290624633738557221');" style="">  30 import android.content.pm.PackageManager;                                                                </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  31 import android.graphics.Bitmap;                                                                          </span>
<span class="-5868658801447575011" onmouseenter="enter('-5868658801447575011');" onmouseout="out('-5868658801447575011');" style="">  32 import android.graphics.Color;                                                                           </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  33 import android.graphics.drawable.Drawable;                                                               </span>
<span class="-7644600255099282823" onmouseenter="enter('-7644600255099282823');" onmouseout="out('-7644600255099282823');" style="">  34 import android.media.MediaMetadata;                                                                      </span>
<span class="6014561289295455692" onmouseenter="enter('6014561289295455692');" onmouseout="out('6014561289295455692');" style="">  35 import android.media.session.PlaybackState;                                                              </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  36 import android.os.Bundle;                                                                                </span>
<span class="1048014933395814760" onmouseenter="enter('1048014933395814760');" onmouseout="out('1048014933395814760');" style="">  37 import android.os.PowerManager;                                                                          </span>
<span class="2671599330745315048" onmouseenter="enter('2671599330745315048');" onmouseout="out('2671599330745315048');" style="">  38 import android.os.RemoteException;                                                                       </span>
<span class="2414580121965048179" onmouseenter="enter('2414580121965048179');" onmouseout="out('2414580121965048179');" style="">  39 import android.service.notification.NotificationListenerService;                                         </span>
<span class="-5243140560088050107" onmouseenter="enter('-5243140560088050107');" onmouseout="out('-5243140560088050107');" style="">  40 import android.service.notification.StatusBarNotification;                                               </span>
<span class="-9135046463009697450" onmouseenter="enter('-9135046463009697450');" onmouseout="out('-9135046463009697450');" style="">  41 import android.support.v4.media.MediaMetadataCompat;                                                     </span>
<span class="3010053617601869286" onmouseenter="enter('3010053617601869286');" onmouseout="out('3010053617601869286');" style="">  42 import android.support.v4.media.session.MediaControllerCompat;                                           </span>
<span class="7582659085834762989" onmouseenter="enter('7582659085834762989');" onmouseout="out('7582659085834762989');" style="">  43 import android.support.v4.media.session.MediaSessionCompat;                                              </span>
<span class="7730848488047972805" onmouseenter="enter('7730848488047972805');" onmouseout="out('7730848488047972805');" style="">  44 import android.support.v4.media.session.PlaybackStateCompat;                                             </span>
<span class="6963272077887521702" onmouseenter="enter('6963272077887521702');" onmouseout="out('6963272077887521702');" style="">  45 import androidx.annotation.NonNull;                                                                      </span>
<span class="-8223344932374400146" onmouseenter="enter('-8223344932374400146');" onmouseout="out('-8223344932374400146');" style="">  46 import androidx.core.app.NotificationCompat;                                                             </span>
<span class="608068994369921062" onmouseenter="enter('608068994369921062');" onmouseout="out('608068994369921062');" style="">  47 import androidx.core.app.RemoteInput;                                                                    </span>
<span class="-898780232029151795" onmouseenter="enter('-898780232029151795');" onmouseout="out('-898780232029151795');" style="">  48 import androidx.localbroadcastmanager.content.LocalBroadcastManager;                                     </span>
<span class="8247440879742583383" onmouseenter="enter('8247440879742583383');" onmouseout="out('8247440879742583383');" style="">  49 import androidx.palette.graphics.Palette;                                                                </span>
<span class="-1987741288118698756" onmouseenter="enter('-1987741288118698756');" onmouseout="out('-1987741288118698756');" style="">  50 import de.greenrobot.dao.query.Query;                                                                    </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  51 import java.util.ArrayList;                                                                              </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  52 import java.util.HashMap;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  53 import java.util.List;                                                                                   </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  54 import java.util.Objects;                                                                                </span>
<span class="5877451784023912628" onmouseenter="enter('5877451784023912628');" onmouseout="out('5877451784023912628');" style="">  55 import nodomain.freeyourgadget.gadgetbridge.BuildConfig;                                                 </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  56 import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                               </span>
<span class="-7198279398549834921" onmouseenter="enter('-7198279398549834921');" onmouseout="out('-7198279398549834921');" style="">  57 import nodomain.freeyourgadget.gadgetbridge.R;                                                           </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  58 import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                          </span>
<span class="4987748567588683404" onmouseenter="enter('4987748567588683404');" onmouseout="out('4987748567588683404');" style="">  59 import nodomain.freeyourgadget.gadgetbridge.devices.pebble.PebbleColor;                                  </span>
<span class="4582396241551629343" onmouseenter="enter('4582396241551629343');" onmouseout="out('4582396241551629343');" style="">  60 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilter;                                 </span>
<span class="-8984035867915956548" onmouseenter="enter('-8984035867915956548');" onmouseout="out('-8984035867915956548');" style="">  61 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterDao;                              </span>
<span class="-8722044444563651785" onmouseenter="enter('-8722044444563651785');" onmouseout="out('-8722044444563651785');" style="">  62 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntry;                            </span>
<span class="-8636777843920322113" onmouseenter="enter('-8636777843920322113');" onmouseout="out('-8636777843920322113');" style="">  63 import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntryDao;                         </span>
<span class="6892049631062353546" onmouseenter="enter('6892049631062353546');" onmouseout="out('6892049631062353546');" style="">  64 import nodomain.freeyourgadget.gadgetbridge.model.AppNotificationType;                                   </span>
<span class="-9074570965792323186" onmouseenter="enter('-9074570965792323186');" onmouseout="out('-9074570965792323186');" style="">  65 import nodomain.freeyourgadget.gadgetbridge.model.CallSpec;                                              </span>
<span class="-4068239021838445503" onmouseenter="enter('-4068239021838445503');" onmouseout="out('-4068239021838445503');" style="">  66 import nodomain.freeyourgadget.gadgetbridge.model.MusicSpec;                                             </span>
<span class="7536481506851862405" onmouseenter="enter('7536481506851862405');" onmouseout="out('7536481506851862405');" style="">  67 import nodomain.freeyourgadget.gadgetbridge.model.MusicStateSpec;                                        </span>
<span class="8239808916005009388" onmouseenter="enter('8239808916005009388');" onmouseout="out('8239808916005009388');" style="">  68 import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;                                      </span>
<span class="7087011959288310716" onmouseenter="enter('7087011959288310716');" onmouseout="out('7087011959288310716');" style="">  69 import nodomain.freeyourgadget.gadgetbridge.model.NotificationType;                                      </span>
<span class="-3383373218913164687" onmouseenter="enter('-3383373218913164687');" onmouseout="out('-3383373218913164687');" style="">  70 import nodomain.freeyourgadget.gadgetbridge.service.DeviceCommunicationService;                          </span>
<span class="-5340888108606249230" onmouseenter="enter('-5340888108606249230');" onmouseout="out('-5340888108606249230');" style="">  71 import nodomain.freeyourgadget.gadgetbridge.util.BitmapUtil;                                             </span>
<span class="-6912606469471439703" onmouseenter="enter('-6912606469471439703');" onmouseout="out('-6912606469471439703');" style="">  72 import nodomain.freeyourgadget.gadgetbridge.util.LimitedQueue;                                           </span>
<span class="4645284583739884744" onmouseenter="enter('4645284583739884744');" onmouseout="out('4645284583739884744');" style="">  73 import nodomain.freeyourgadget.gadgetbridge.util.PebbleUtils;                                            </span>
<span class="-600862318521663319" onmouseenter="enter('-600862318521663319');" onmouseout="out('-600862318521663319');" style="">  74 import nodomain.freeyourgadget.gadgetbridge.util.Prefs;                                                  </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  75 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  76 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  77 import org.slf4j.LoggerFactory;                                                                          </span>
<span class="7436623043745543163" onmouseenter="enter('7436623043745543163');" onmouseout="out('7436623043745543163');" style="">  78 import static androidx.media.app.NotificationCompat.MediaStyle.getMediaSession;                          </span>
<span class="2609355261484520736" onmouseenter="enter('2609355261484520736');" onmouseout="out('2609355261484520736');" style=""><abbr title="  79 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_BLACKLIST;">  79 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILðŸ”µ</abbr></span>
<span class="-7771135586340561880" onmouseenter="enter('-7771135586340561880');" onmouseout="out('-7771135586340561880');" style=""><abbr title="  80 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_WHITELIST;">  80 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILðŸ”µ</abbr></span>
<span class="-3815741097386417514" onmouseenter="enter('-3815741097386417514');" onmouseout="out('-3815741097386417514');" style=""><abbr title="  81 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_SUBMODE_ALL;">  81 import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILðŸ”µ</abbr></span>
<span  style="">  82                                                                                                          </span>
<span  style="">  83                                                                                                          </span>
<span class="6882532116672062216" onmouseenter="enter('6882532116672062216');" onmouseout="out('6882532116672062216');" style="">  84 public class NotificationListener extends NotificationListenerService {                                  </span>
<span class="5652999225459763894" onmouseenter="enter('5652999225459763894');" onmouseout="out('5652999225459763894');" style="">  85     private static final Logger LOG = LoggerFactory.getLogger(NotificationListener.class);               </span>
<span  style="">  86                                                                                                          </span>
<span class="-6720636215056424198" onmouseenter="enter('-6720636215056424198');" onmouseout="out('-6720636215056424198');" style="">  87     public static final String ACTION_DISMISS                                                            </span>
<span class="-435533233439313912" onmouseenter="enter('-435533233439313912');" onmouseout="out('-435533233439313912');" style="">  88             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss&quot;;                </span>
<span  style="">  89                                                                                                          </span>
<span class="-2138233225266526402" onmouseenter="enter('-2138233225266526402');" onmouseout="out('-2138233225266526402');" style="">  90     public static final String ACTION_DISMISS_ALL                                                        </span>
<span class="-4592236270087722119" onmouseenter="enter('-4592236270087722119');" onmouseout="out('-4592236270087722119');" style="">  91             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss_all&quot;;            </span>
<span  style="">  92                                                                                                          </span>
<span class="-3417692764158931011" onmouseenter="enter('-3417692764158931011');" onmouseout="out('-3417692764158931011');" style="">  93     public static final String ACTION_OPEN                                                               </span>
<span class="-4990387725302380924" onmouseenter="enter('-4990387725302380924');" onmouseout="out('-4990387725302380924');" style="">  94             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.open&quot;;                   </span>
<span  style="">  95                                                                                                          </span>
<span class="-4179389986769695249" onmouseenter="enter('-4179389986769695249');" onmouseout="out('-4179389986769695249');" style="">  96     public static final String ACTION_MUTE                                                               </span>
<span class="9023540546537828742" onmouseenter="enter('9023540546537828742');" onmouseout="out('9023540546537828742');" style="">  97             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.mute&quot;;                   </span>
<span  style="">  98                                                                                                          </span>
<span class="5009618492496239115" onmouseenter="enter('5009618492496239115');" onmouseout="out('5009618492496239115');" style="">  99     public static final String ACTION_REPLY                                                              </span>
<span class="8900274215532856227" onmouseenter="enter('8900274215532856227');" onmouseout="out('8900274215532856227');" style=""> 100             = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.reply&quot;;                  </span>
<span  style=""> 101                                                                                                          </span>
<span class="2046947475762055359" onmouseenter="enter('2046947475762055359');" onmouseout="out('2046947475762055359');" style=""> 102     private LimitedQueue mActionLookup = new LimitedQueue(32);                                           </span>
<span  style=""> 103                                                                                                          </span>
<span class="7830816337914020824" onmouseenter="enter('7830816337914020824');" onmouseout="out('7830816337914020824');" style=""> 104     private LimitedQueue mPackageLookup = new LimitedQueue(64);                                          </span>
<span  style=""> 105                                                                                                          </span>
<span class="203591122145891899" onmouseenter="enter('203591122145891899');" onmouseout="out('203591122145891899');" style=""> 106     private LimitedQueue mNotificationHandleLookup = new LimitedQueue(128);                              </span>
<span  style=""> 107                                                                                                          </span>
<span class="5935133783530348929" onmouseenter="enter('5935133783530348929');" onmouseout="out('5935133783530348929');" style=""> 108     private HashMap&lt;String, Long&gt; notificationBurstPrevention = new HashMap&lt;&gt;();                         </span>
<span  style=""> 109                                                                                                          </span>
<span class="957532525841967801" onmouseenter="enter('957532525841967801');" onmouseout="out('957532525841967801');" style=""> 110     private HashMap&lt;String, Long&gt; notificationOldRepeatPrevention = new HashMap&lt;&gt;();                     </span>
<span  style=""> 111                                                                                                          </span>
<span class="1901653456173527926" onmouseenter="enter('1901653456173527926');" onmouseout="out('1901653456173527926');" style=""> 112     private long activeCallPostTime;                                                                     </span>
<span  style=""> 113                                                                                                          </span>
<span class="4625474178666977899" onmouseenter="enter('4625474178666977899');" onmouseout="out('4625474178666977899');" style=""> 114     private final BroadcastReceiver mReceiver = new BroadcastReceiver() {                                </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 115         @Override                                                                                        </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 116         public void onReceive(Context context, Intent intent) {                                          </span>
<span class="5344227773413700857" onmouseenter="enter('5344227773413700857');" onmouseout="out('5344227773413700857');" style=""> 117             String action = intent.getAction();                                                          </span>
<span class="4668300806615190248" onmouseenter="enter('4668300806615190248');" onmouseout="out('4668300806615190248');" style=""> 118             if (action == null) {                                                                        </span>
<span class="-9060638611519565940" onmouseenter="enter('-9060638611519565940');" onmouseout="out('-9060638611519565940');" style=""> 119                 LOG.warn(&quot;no action&quot;);                                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 120                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121             }                                                                                            </span>
<span class="-8522569859437208143" onmouseenter="enter('-8522569859437208143');" onmouseout="out('-8522569859437208143');" style=""> 122             int handle = ((int) (intent.getLongExtra(&quot;handle&quot;, -1)));                                    </span>
<span class="6099627150369302694" onmouseenter="enter('6099627150369302694');" onmouseout="out('6099627150369302694');" style=""> 123             switch (action) {                                                                            </span>
<span class="3445389342864668009" onmouseenter="enter('3445389342864668009');" onmouseout="out('3445389342864668009');" style=""> 124                 case GBApplication.ACTION_QUIT :                                                         </span>
<span class="711670831438240238" onmouseenter="enter('711670831438240238');" onmouseout="out('711670831438240238');" style=""> 125                     stopSelf();                                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 126                     break;                                                                               </span>
<span class="-5547688122153857280" onmouseenter="enter('-5547688122153857280');" onmouseout="out('-5547688122153857280');" style=""> 127                 case ACTION_OPEN :                                                                       </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 128                     {                                                                                    </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""><abbr title=" 129                         StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();"> 129                         StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications()ðŸ”µ</abbr></span>
<span class="8871626058142499694" onmouseenter="enter('8871626058142499694');" onmouseout="out('8871626058142499694');" style=""> 130                         Long ts = ((Long) (mNotificationHandleLookup.lookup(handle)));                   </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 131                         if (ts == null) {                                                                </span>
<span class="-3551838833774164230" onmouseenter="enter('-3551838833774164230');" onmouseout="out('-3551838833774164230');" style=""> 132                             LOG.info(&quot;could not lookup handle for open action&quot;);                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 133                             break;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134                         }                                                                                </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 135                         for (StatusBarNotification sbn : sbns) {                                         </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 136                             if (sbn.getPostTime() == ts) {                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 137                                 try {                                                                    </span>
<span class="-5589448531951598530" onmouseenter="enter('-5589448531951598530');" onmouseout="out('-5589448531951598530');" style=""> 138                                     PendingIntent pi = sbn.getNotification().contentIntent;              </span>
<span class="-4590351723917688021" onmouseenter="enter('-4590351723917688021');" onmouseout="out('-4590351723917688021');" style=""> 139                                     if (pi != null) {                                                    </span>
<span class="-4072418890714992779" onmouseenter="enter('-4072418890714992779');" onmouseout="out('-4072418890714992779');" style=""> 140                                         pi.send();                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141                                     }                                                                    </span>
<span class="-7631067620786105934" onmouseenter="enter('-7631067620786105934');" onmouseout="out('-7631067620786105934');" style=""> 142                                 } catch (PendingIntent e) {                                              </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 143                                     e.printStackTrace();                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146                         }                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 147                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148                     }                                                                                    </span>
<span class="4895194214786786257" onmouseenter="enter('4895194214786786257');" onmouseout="out('4895194214786786257');" style=""> 149                 case ACTION_MUTE :                                                                       </span>
<span class="9128513059934580751" onmouseenter="enter('9128513059934580751');" onmouseout="out('9128513059934580751');" style=""> 150                     String packageName = ((String) (mPackageLookup.lookup(handle)));                     </span>
<span class="2797777100746091358" onmouseenter="enter('2797777100746091358');" onmouseout="out('2797777100746091358');" style=""> 151                     if (packageName == null) {                                                           </span>
<span class="5190950653644936431" onmouseenter="enter('5190950653644936431');" onmouseout="out('5190950653644936431');" style=""> 152                         LOG.info(&quot;could not lookup handle for mute action&quot;);                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 153                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154                     }                                                                                    </span>
<span class="-55961907216512395" onmouseenter="enter('-55961907216512395');" onmouseout="out('-55961907216512395');" style=""> 155                     LOG.info(&quot;going to mute &quot; + packageName);                                            </span>
<span class="6244948836232449423" onmouseenter="enter('6244948836232449423');" onmouseout="out('6244948836232449423');" style=""> 156                     GBApplication.addAppToNotifBlacklist(packageName);                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 157                     break;                                                                               </span>
<span class="-2731864045103809175" onmouseenter="enter('-2731864045103809175');" onmouseout="out('-2731864045103809175');" style=""> 158                 case ACTION_DISMISS :                                                                    </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 159                     {                                                                                    </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""><abbr title=" 160                         StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();"> 160                         StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications()ðŸ”µ</abbr></span>
<span class="8871626058142499694" onmouseenter="enter('8871626058142499694');" onmouseout="out('8871626058142499694');" style=""> 161                         Long ts = ((Long) (mNotificationHandleLookup.lookup(handle)));                   </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 162                         if (ts == null) {                                                                </span>
<span class="2968382775980406642" onmouseenter="enter('2968382775980406642');" onmouseout="out('2968382775980406642');" style=""> 163                             LOG.info(&quot;could not lookup handle for dismiss action&quot;);                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 164                             break;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165                         }                                                                                </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 166                         for (StatusBarNotification sbn : sbns) {                                         </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 167                             if (sbn.getPostTime() == ts) {                                               </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 168                                 if (GBApplication.isRunningLollipopOrLater()) {                          </span>
<span class="6969546006861717982" onmouseenter="enter('6969546006861717982');" onmouseout="out('6969546006861717982');" style=""> 169                                     String key = sbn.getKey();                                           </span>
<span class="-8910102463751962403" onmouseenter="enter('-8910102463751962403');" onmouseout="out('-8910102463751962403');" style=""> 170                                     NotificationListener.this.cancelNotification(key);                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 171                                 } else {                                                                 </span>
<span class="8698193459204911181" onmouseenter="enter('8698193459204911181');" onmouseout="out('8698193459204911181');" style=""> 172                                     int id = sbn.getId();                                                </span>
<span class="-3586097476318973287" onmouseenter="enter('-3586097476318973287');" onmouseout="out('-3586097476318973287');" style=""> 173                                     String pkg = sbn.getPackageName();                                   </span>
<span class="-8898967747084014814" onmouseenter="enter('-8898967747084014814');" onmouseout="out('-8898967747084014814');" style=""> 174                                     String tag = sbn.getTag();                                           </span>
<span class="-7819421458484381897" onmouseenter="enter('-7819421458484381897');" onmouseout="out('-7819421458484381897');" style=""> 175                                     NotificationListener.this.cancelNotification(pkg, tag, id);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178                         }                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 179                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180                     }                                                                                    </span>
<span class="3656305978861666618" onmouseenter="enter('3656305978861666618');" onmouseout="out('3656305978861666618');" style=""> 181                 case ACTION_DISMISS_ALL :                                                                </span>
<span class="1530048448958335468" onmouseenter="enter('1530048448958335468');" onmouseout="out('1530048448958335468');" style=""> 182                     NotificationListener.this.cancelAllNotifications();                                  </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 183                     break;                                                                               </span>
<span class="-6395486145934723530" onmouseenter="enter('-6395486145934723530');" onmouseout="out('-6395486145934723530');" style=""> 184                 case ACTION_REPLY :                                                                      </span>
<span class="3246293661004050434" onmouseenter="enter('3246293661004050434');" onmouseout="out('3246293661004050434');" style=""><abbr title=" 185                     NotificationCompat.Action wearableAction = ((NotificationCompat.Action) (mActionLookup.lookup(handle)));"> 185                     NotificationCompat.Action wearableAction = ((NotificationCompat.Action) (mActionLookuðŸ”µ</abbr></span>
<span class="2885762978640892133" onmouseenter="enter('2885762978640892133');" onmouseout="out('2885762978640892133');" style=""> 186                     String reply = intent.getStringExtra(&quot;reply&quot;);                                       </span>
<span class="-2711571343237725875" onmouseenter="enter('-2711571343237725875');" onmouseout="out('-2711571343237725875');" style=""> 187                     if (wearableAction != null) {                                                        </span>
<span class="8382710711087379858" onmouseenter="enter('8382710711087379858');" onmouseout="out('8382710711087379858');" style=""> 188                         PendingIntent actionIntent = wearableAction.getActionIntent();                   </span>
<span class="8988901388813075705" onmouseenter="enter('8988901388813075705');" onmouseout="out('8988901388813075705');" style=""> 189                         Intent localIntent = new Intent();                                               </span>
<span class="7096307769955289231" onmouseenter="enter('7096307769955289231');" onmouseout="out('7096307769955289231');" style=""> 190                         localIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);                             </span>
<span class="691073611137837703" onmouseenter="enter('691073611137837703');" onmouseout="out('691073611137837703');" style=""> 191                         if (wearableAction.getRemoteInputs() != null) {                                  </span>
<span class="-957754769572110349" onmouseenter="enter('-957754769572110349');" onmouseout="out('-957754769572110349');" style=""> 192                             RemoteInput[] remoteInputs = wearableAction.getRemoteInputs();               </span>
<span class="1776998572180860248" onmouseenter="enter('1776998572180860248');" onmouseout="out('1776998572180860248');" style=""> 193                             Bundle extras = new Bundle();                                                </span>
<span class="2352964158014766609" onmouseenter="enter('2352964158014766609');" onmouseout="out('2352964158014766609');" style=""> 194                             extras.putCharSequence(remoteInputs[0].getResultKey(), reply);               </span>
<span class="5088590721402752136" onmouseenter="enter('5088590721402752136');" onmouseout="out('5088590721402752136');" style=""> 195                             RemoteInput.addResultsToIntent(remoteInputs, localIntent, extras);           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196                         }                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 197                         try {                                                                            </span>
<span class="2300129068579463689" onmouseenter="enter('2300129068579463689');" onmouseout="out('2300129068579463689');" style=""> 198                             LOG.info(&quot;will send exec intent to remote application&quot;);                     </span>
<span class="2731482446525466050" onmouseenter="enter('2731482446525466050');" onmouseout="out('2731482446525466050');" style=""> 199                             actionIntent.send(context, 0, localIntent);                                  </span>
<span class="5952869537434724617" onmouseenter="enter('5952869537434724617');" onmouseout="out('5952869537434724617');" style=""> 200                             mActionLookup.remove(handle);                                                </span>
<span class="-7631067620786105934" onmouseenter="enter('-7631067620786105934');" onmouseout="out('-7631067620786105934');" style=""> 201                         } catch (PendingIntent e) {                                                      </span>
<span class="-3367288945438988923" onmouseenter="enter('-3367288945438988923');" onmouseout="out('-3367288945438988923');" style=""> 202                             LOG.warn(&quot;replyToLastNotification error: &quot; + e.getLocalizedMessage());       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204                     }                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 205                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207         }                                                                                                </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 208     };                                                                                                   </span>
<span  style=""> 209                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 210     @Override                                                                                            </span>
<span class="-2716773701189387633" onmouseenter="enter('-2716773701189387633');" onmouseout="out('-2716773701189387633');" style=""> 211     public void onCreate() {                                                                             </span>
<span class="-2958534921295515858" onmouseenter="enter('-2958534921295515858');" onmouseout="out('-2958534921295515858');" style=""> 212         super.onCreate();                                                                                </span>
<span class="7618100238646869770" onmouseenter="enter('7618100238646869770');" onmouseout="out('7618100238646869770');" style=""> 213         IntentFilter filterLocal = new IntentFilter();                                                   </span>
<span class="1063910518920289150" onmouseenter="enter('1063910518920289150');" onmouseout="out('1063910518920289150');" style=""> 214         filterLocal.addAction(GBApplication.ACTION_QUIT);                                                </span>
<span class="2076754442287025975" onmouseenter="enter('2076754442287025975');" onmouseout="out('2076754442287025975');" style=""> 215         filterLocal.addAction(ACTION_OPEN);                                                              </span>
<span class="-6869981444846929258" onmouseenter="enter('-6869981444846929258');" onmouseout="out('-6869981444846929258');" style=""> 216         filterLocal.addAction(ACTION_DISMISS);                                                           </span>
<span class="8695742864955675589" onmouseenter="enter('8695742864955675589');" onmouseout="out('8695742864955675589');" style=""> 217         filterLocal.addAction(ACTION_DISMISS_ALL);                                                       </span>
<span class="3848496335642882317" onmouseenter="enter('3848496335642882317');" onmouseout="out('3848496335642882317');" style=""> 218         filterLocal.addAction(ACTION_MUTE);                                                              </span>
<span class="-4535783496195239094" onmouseenter="enter('-4535783496195239094');" onmouseout="out('-4535783496195239094');" style=""> 219         filterLocal.addAction(ACTION_REPLY);                                                             </span>
<span class="-4279331771748389639" onmouseenter="enter('-4279331771748389639');" onmouseout="out('-4279331771748389639');" style=""> 220         LocalBroadcastManager.getInstance(this).registerReceiver(mReceiver, filterLocal);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221     }                                                                                                    </span>
<span  style=""> 222                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 223     @Override                                                                                            </span>
<span class="658855826062432633" onmouseenter="enter('658855826062432633');" onmouseout="out('658855826062432633');" style=""> 224     public void onDestroy() {                                                                            </span>
<span class="1476506345433791001" onmouseenter="enter('1476506345433791001');" onmouseout="out('1476506345433791001');" style=""> 225         LocalBroadcastManager.getInstance(this).unregisterReceiver(mReceiver);                           </span>
<span class="7275190530034972367" onmouseenter="enter('7275190530034972367');" onmouseout="out('7275190530034972367');" style=""> 226         super.onDestroy();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227     }                                                                                                    </span>
<span  style=""> 228                                                                                                          </span>
<span class="4951847030810611879" onmouseenter="enter('4951847030810611879');" onmouseout="out('4951847030810611879');" style=""> 229     public String getAppName(String pkg) {                                                               </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style=""> 230         // determinate Source App Name (&quot;Label&quot;)                                                         </span>
<span class="-6628567271413355488" onmouseenter="enter('-6628567271413355488');" onmouseout="out('-6628567271413355488');" style=""> 231         PackageManager pm = getPackageManager();                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 232         try {                                                                                            </span>
<span class="-8332644856914515147" onmouseenter="enter('-8332644856914515147');" onmouseout="out('-8332644856914515147');" style=""> 233             return ((String) (pm.getApplicationLabel(pm.getApplicationInfo(pkg, 0))));                   </span>
<span class="1662440237380033096" onmouseenter="enter('1662440237380033096');" onmouseout="out('1662440237380033096');" style=""> 234         } catch (PackageManager e) {                                                                     </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 235             e.printStackTrace();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 237         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238     }                                                                                                    </span>
<span  style=""> 239                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 240     @Override                                                                                            </span>
<span class="-2772368349505117806" onmouseenter="enter('-2772368349505117806');" onmouseout="out('-2772368349505117806');" style=""> 241     public void onNotificationPosted(StatusBarNotification sbn) {                                        </span>
<span class="6669401580814547638" onmouseenter="enter('6669401580814547638');" onmouseout="out('6669401580814547638');" style=""> 242         if (&quot;call&quot;.equals(sbn.getNotification().category)) {                                             </span>
<span class="-4846577510724576112" onmouseenter="enter('-4846577510724576112');" onmouseout="out('-4846577510724576112');" style=""> 243             handleCallNotification(sbn);                                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 244             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245         }                                                                                                </span>
<span class="2998034859944771870" onmouseenter="enter('2998034859944771870');" onmouseout="out('2998034859944771870');" style=""> 246         if (shouldIgnore(sbn)) {                                                                         </span>
<span class="-3980483839174328253" onmouseenter="enter('-3980483839174328253');" onmouseout="out('-3980483839174328253');" style=""> 247             LOG.info(&quot;Ignore notification&quot;);                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 248             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249         }                                                                                                </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 250         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="8054135432811402885" onmouseenter="enter('8054135432811402885');" onmouseout="out('8054135432811402885');" style=""> 251         switch (GBApplication.getGrantedInterruptionFilter()) {                                          </span>
<span class="4785756693835525279" onmouseenter="enter('4785756693835525279');" onmouseout="out('4785756693835525279');" style=""> 252             case NotificationManager.INTERRUPTION_FILTER_ALL :                                           </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 253                 break;                                                                                   </span>
<span class="-2606935604959437865" onmouseenter="enter('-2606935604959437865');" onmouseout="out('-2606935604959437865');" style=""> 254             case NotificationManager.INTERRUPTION_FILTER_ALARMS :                                        </span>
<span class="4107220922496401196" onmouseenter="enter('4107220922496401196');" onmouseout="out('4107220922496401196');" style=""> 255             case NotificationManager.INTERRUPTION_FILTER_NONE :                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 256                 return;                                                                                  </span>
<span class="48032271551006594" onmouseenter="enter('48032271551006594');" onmouseout="out('48032271551006594');" style=""> 257             case NotificationManager.INTERRUPTION_FILTER_PRIORITY :                                      </span>
<span class="8591867555140901755" onmouseenter="enter('8591867555140901755');" onmouseout="out('8591867555140901755');" style=""> 258                 // FIXME: Handle Reminders and Events if they are enabled in Do Not Disturb              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 259                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260         }                                                                                                </span>
<span class="3332016722812204086" onmouseenter="enter('3332016722812204086');" onmouseout="out('3332016722812204086');" style=""> 261         String source = sbn.getPackageName().toLowerCase();                                              </span>
<span class="2830045728262824638" onmouseenter="enter('2830045728262824638');" onmouseout="out('2830045728262824638');" style=""> 262         Notification notification = sbn.getNotification();                                               </span>
<span class="4218475881538878307" onmouseenter="enter('4218475881538878307');" onmouseout="out('4218475881538878307');" style=""> 263         if (notificationOldRepeatPrevention.containsKey(source)) {                                       </span>
<span class="6155853035860803703" onmouseenter="enter('6155853035860803703');" onmouseout="out('6155853035860803703');" style=""> 264             if (notification.when &lt;= notificationOldRepeatPrevention.get(source)) {                      </span>
<span class="-4118070098413074653" onmouseenter="enter('-4118070098413074653');" onmouseout="out('-4118070098413074653');" style=""><abbr title=" 265                 LOG.info(&quot;NOT processing notification, already sent newer notifications from this source.&quot;);"> 265                 LOG.info(&quot;NOT processing notification, already sent newer notifications from this source.ðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 266                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268         }                                                                                                </span>
<span class="-5834893131205351970" onmouseenter="enter('-5834893131205351970');" onmouseout="out('-5834893131205351970');" style=""> 269         // Ignore too frequent notifications, according to user preference                               </span>
<span class="-248364900445820615" onmouseenter="enter('-248364900445820615');" onmouseout="out('-248364900445820615');" style=""> 270         long min_timeout = ((long) (prefs.getInt(&quot;notifications_timeout&quot;, 0))) * 1000L;                  </span>
<span class="7158364678624901735" onmouseenter="enter('7158364678624901735');" onmouseout="out('7158364678624901735');" style=""> 271         long cur_time = System.currentTimeMillis();                                                      </span>
<span class="4691272725591601941" onmouseenter="enter('4691272725591601941');" onmouseout="out('4691272725591601941');" style=""> 272         if (notificationBurstPrevention.containsKey(source)) {                                           </span>
<span class="-7388621012045880255" onmouseenter="enter('-7388621012045880255');" onmouseout="out('-7388621012045880255');" style=""> 273             long last_time = notificationBurstPrevention.get(source);                                    </span>
<span class="-6252165364735426669" onmouseenter="enter('-6252165364735426669');" onmouseout="out('-6252165364735426669');" style=""> 274             if ((cur_time - last_time) &lt; min_timeout) {                                                  </span>
<span class="-7754002419465005686" onmouseenter="enter('-7754002419465005686');" onmouseout="out('-7754002419465005686');" style=""><abbr title=" 275                 LOG.info((&quot;Ignoring frequent notification, last one was &quot; + (cur_time - last_time)) + &quot;ms ago&quot;);"> 275                 LOG.info((&quot;Ignoring frequent notification, last one was &quot; + (cur_time - last_time)) + &quot;msðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 276                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278         }                                                                                                </span>
<span class="4249292218927487361" onmouseenter="enter('4249292218927487361');" onmouseout="out('4249292218927487361');" style=""> 279         NotificationSpec notificationSpec = new NotificationSpec();                                      </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style=""> 280         // determinate Source App Name (&quot;Label&quot;)                                                         </span>
<span class="-1232802106572556205" onmouseenter="enter('-1232802106572556205');" onmouseout="out('-1232802106572556205');" style=""> 281         String name = getAppName(source);                                                                </span>
<span class="8801601261434726216" onmouseenter="enter('8801601261434726216');" onmouseout="out('8801601261434726216');" style=""> 282         if (name != null) {                                                                              </span>
<span class="3305632254012197272" onmouseenter="enter('3305632254012197272');" onmouseout="out('3305632254012197272');" style=""> 283             notificationSpec.sourceName = name;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284         }                                                                                                </span>
<span class="-7581221946487094265" onmouseenter="enter('-7581221946487094265');" onmouseout="out('-7581221946487094265');" style=""> 285         boolean preferBigText = false;                                                                   </span>
<span class="-1916386255928229930" onmouseenter="enter('-1916386255928229930');" onmouseout="out('-1916386255928229930');" style=""><abbr title=" 286         // Get the app ID that generated this notification. For now only used by pebble color, but may be more useful later."> 286         // Get the app ID that generated this notification. For now only used by pebble color, but may beðŸ”µ</abbr></span>
<span class="-8067455375416267049" onmouseenter="enter('-8067455375416267049');" onmouseout="out('-8067455375416267049');" style=""> 287         notificationSpec.sourceAppId = source;                                                           </span>
<span class="-2810132766447661631" onmouseenter="enter('-2810132766447661631');" onmouseout="out('-2810132766447661631');" style=""> 288         notificationSpec.type = AppNotificationType.getInstance().get(source);                           </span>
<span class="-7540601865424540593" onmouseenter="enter('-7540601865424540593');" onmouseout="out('-7540601865424540593');" style=""> 289         //FIXME: some quirks lookup table would be the minor evil here                                   </span>
<span class="2207563395624266113" onmouseenter="enter('2207563395624266113');" onmouseout="out('2207563395624266113');" style=""> 290         if (source.startsWith(&quot;com.fsck.k9&quot;)) {                                                          </span>
<span class="-8461204742030134802" onmouseenter="enter('-8461204742030134802');" onmouseout="out('-8461204742030134802');" style=""> 291             if (NotificationCompat.isGroupSummary(notification)) {                                       </span>
<span class="3811797734502814406" onmouseenter="enter('3811797734502814406');" onmouseout="out('3811797734502814406');" style=""> 292                 LOG.info(&quot;ignore K9 group summary&quot;);                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 293                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294             }                                                                                            </span>
<span class="5839263120304468869" onmouseenter="enter('5839263120304468869');" onmouseout="out('5839263120304468869');" style=""> 295             preferBigText = true;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296         }                                                                                                </span>
<span class="4253328762370341177" onmouseenter="enter('4253328762370341177');" onmouseout="out('4253328762370341177');" style=""> 297         if (notificationSpec.type == null) {                                                             </span>
<span class="954876523018596305" onmouseenter="enter('954876523018596305');" onmouseout="out('954876523018596305');" style=""> 298             notificationSpec.type = NotificationType.UNKNOWN;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299         }                                                                                                </span>
<span class="8812080595679134351" onmouseenter="enter('8812080595679134351');" onmouseout="out('8812080595679134351');" style=""> 300         // Get color                                                                                     </span>
<span class="-7215379846374020112" onmouseenter="enter('-7215379846374020112');" onmouseout="out('-7215379846374020112');" style=""> 301         notificationSpec.pebbleColor = getPebbleColorForNotification(notificationSpec);                  </span>
<span class="6404207301432213382" onmouseenter="enter('6404207301432213382');" onmouseout="out('6404207301432213382');" style=""><abbr title=" 302         LOG.info(((((((&quot;Processing notification &quot; + notificationSpec.getId()) + &quot; age: &quot;) + (System.currentTimeMillis() - notification.when)) + &quot; from source &quot;) + source) + &quot; with flags: &quot;) + notification.flags);"> 302         LOG.info(((((((&quot;Processing notification &quot; + notificationSpec.getId()) + &quot; age: &quot;) + (System.curreðŸ”µ</abbr></span>
<span class="-5865600179971875271" onmouseenter="enter('-5865600179971875271');" onmouseout="out('-5865600179971875271');" style=""> 303         dissectNotificationTo(notification, notificationSpec, preferBigText);                            </span>
<span class="3953264596152234401" onmouseenter="enter('3953264596152234401');" onmouseout="out('3953264596152234401');" style=""><abbr title=" 304         if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificationSpec.body)) {"> 304         if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificatioðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 305             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306         }                                                                                                </span>
<span class="668617636634990568" onmouseenter="enter('668617636634990568');" onmouseout="out('668617636634990568');" style=""> 307         // ignore Gadgetbridge&#x27;s very own notifications, except for those from the debug screen          </span>
<span class="8240704894033078509" onmouseenter="enter('8240704894033078509');" onmouseout="out('8240704894033078509');" style=""> 308         if (getApplicationContext().getPackageName().equals(source)) {                                   </span>
<span class="-4005163798104538430" onmouseenter="enter('-4005163798104538430');" onmouseout="out('-4005163798104538430');" style=""><abbr title=" 309             if (!getApplicationContext().getString(R.string.test_notification).equals(notificationSpec.title)) {"> 309             if (!getApplicationContext().getString(R.string.test_notification).equals(notificationSpec.tiðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 310                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312         }                                                                                                </span>
<span class="3032759621835437424" onmouseenter="enter('3032759621835437424');" onmouseout="out('3032759621835437424');" style=""><abbr title=" 313         NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(notification);"> 313         NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(noðŸ”µ</abbr></span>
<span class="-1472750016987720650" onmouseenter="enter('-1472750016987720650');" onmouseout="out('-1472750016987720650');" style=""> 314         List&lt;NotificationCompat.Action&gt; actions = wearableExtender.getActions();                         </span>
<span class="-8589418989263636261" onmouseenter="enter('-8589418989263636261');" onmouseout="out('-8589418989263636261');" style=""> 315         if ((actions.size() == 0) &amp;&amp; NotificationCompat.isGroupSummary(notification)) {                  </span>
<span class="7633593456004128366" onmouseenter="enter('7633593456004128366');" onmouseout="out('7633593456004128366');" style=""> 316             // this could cause #395 to come back                                                        </span>
<span class="-2600295662498564908" onmouseenter="enter('-2600295662498564908');" onmouseout="out('-2600295662498564908');" style=""><abbr title=" 317             LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action present. Notification flags: &quot; + notification.flags);"> 317             LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action preseðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 318             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319         }                                                                                                </span>
<span class="-5917197971696016550" onmouseenter="enter('-5917197971696016550');" onmouseout="out('-5917197971696016550');" style=""> 320         notificationSpec.attachedActions = new ArrayList&lt;&gt;();                                            </span>
<span class="6824678123821134026" onmouseenter="enter('6824678123821134026');" onmouseout="out('6824678123821134026');" style=""> 321         // DISMISS action                                                                                </span>
<span class="5533936039133318070" onmouseenter="enter('5533936039133318070');" onmouseout="out('5533936039133318070');" style=""> 322         NotificationSpec.Action dismissAction = new NotificationSpec.Action();                           </span>
<span class="-2035191731043357921" onmouseenter="enter('-2035191731043357921');" onmouseout="out('-2035191731043357921');" style=""> 323         dismissAction.title = &quot;Dismiss&quot;;                                                                 </span>
<span class="5737664600017371521" onmouseenter="enter('5737664600017371521');" onmouseout="out('5737664600017371521');" style=""> 324         dismissAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_DISMISS;                             </span>
<span class="-4673031657134511356" onmouseenter="enter('-4673031657134511356');" onmouseout="out('-4673031657134511356');" style=""> 325         notificationSpec.attachedActions.add(dismissAction);                                             </span>
<span class="-8264806993566587236" onmouseenter="enter('-8264806993566587236');" onmouseout="out('-8264806993566587236');" style=""> 326         for (NotificationCompat.Action act : actions) {                                                  </span>
<span class="-5026732361501841882" onmouseenter="enter('-5026732361501841882');" onmouseout="out('-5026732361501841882');" style=""> 327             if (act != null) {                                                                           </span>
<span class="-5786483650500220153" onmouseenter="enter('-5786483650500220153');" onmouseout="out('-5786483650500220153');" style=""> 328                 NotificationSpec.Action wearableAction = new NotificationSpec.Action();                  </span>
<span class="911429091199110596" onmouseenter="enter('911429091199110596');" onmouseout="out('911429091199110596');" style=""> 329                 wearableAction.title = act.getTitle().toString();                                        </span>
<span class="1763313419828289561" onmouseenter="enter('1763313419828289561');" onmouseout="out('1763313419828289561');" style=""> 330                 if (act.getRemoteInputs() != null) {                                                     </span>
<span class="3631843705460318974" onmouseenter="enter('3631843705460318974');" onmouseout="out('3631843705460318974');" style=""> 331                     wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_REPLY;                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 332                 } else {                                                                                 </span>
<span class="5019071376909091625" onmouseenter="enter('5019071376909091625');" onmouseout="out('5019071376909091625');" style=""> 333                     wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_SIMPLE;                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334                 }                                                                                        </span>
<span class="3300319972847919808" onmouseenter="enter('3300319972847919808');" onmouseout="out('3300319972847919808');" style=""> 335                 notificationSpec.attachedActions.add(wearableAction);                                    </span>
<span class="6842873775718956558" onmouseenter="enter('6842873775718956558');" onmouseout="out('6842873775718956558');" style=""><abbr title=" 336                 mActionLookup.add((notificationSpec.getId() &lt;&lt; 4) + notificationSpec.attachedActions.size(), act);"> 336                 mActionLookup.add((notificationSpec.getId() &lt;&lt; 4) + notificationSpec.attachedActions.sizeðŸ”µ</abbr></span>
<span class="7977624565890597945" onmouseenter="enter('7977624565890597945');" onmouseout="out('7977624565890597945');" style=""><abbr title=" 337                 LOG.info(((((&quot;found wearable action: &quot; + notificationSpec.attachedActions.size()) + &quot; - &quot;) + act.getTitle()) + &quot;  &quot;) + sbn.getTag());"> 337                 LOG.info(((((&quot;found wearable action: &quot; + notificationSpec.attachedActions.size()) + &quot; - &quot;ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339         }                                                                                                </span>
<span class="7347352498327901971" onmouseenter="enter('7347352498327901971');" onmouseout="out('7347352498327901971');" style=""> 340         // OPEN action                                                                                   </span>
<span class="6797092604605164688" onmouseenter="enter('6797092604605164688');" onmouseout="out('6797092604605164688');" style=""> 341         NotificationSpec.Action openAction = new NotificationSpec.Action();                              </span>
<span class="8898599446651645486" onmouseenter="enter('8898599446651645486');" onmouseout="out('8898599446651645486');" style=""> 342         openAction.title = getString(R.string._pebble_watch_open_on_phone);                              </span>
<span class="620332764476499952" onmouseenter="enter('620332764476499952');" onmouseout="out('620332764476499952');" style=""> 343         openAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_OPEN;                                   </span>
<span class="-654055199082716612" onmouseenter="enter('-654055199082716612');" onmouseout="out('-654055199082716612');" style=""> 344         notificationSpec.attachedActions.add(openAction);                                                </span>
<span class="2264132042552456605" onmouseenter="enter('2264132042552456605');" onmouseout="out('2264132042552456605');" style=""> 345         // MUTE action                                                                                   </span>
<span class="-8712525482035557123" onmouseenter="enter('-8712525482035557123');" onmouseout="out('-8712525482035557123');" style=""> 346         NotificationSpec.Action muteAction = new NotificationSpec.Action();                              </span>
<span class="-8110587689026159862" onmouseenter="enter('-8110587689026159862');" onmouseout="out('-8110587689026159862');" style=""> 347         muteAction.title = getString(R.string._pebble_watch_mute);                                       </span>
<span class="6211637458858479364" onmouseenter="enter('6211637458858479364');" onmouseout="out('6211637458858479364');" style=""> 348         muteAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_MUTE;                                   </span>
<span class="1775691680583302265" onmouseenter="enter('1775691680583302265');" onmouseout="out('1775691680583302265');" style=""> 349         notificationSpec.attachedActions.add(muteAction);                                                </span>
<span class="-5694513862252752333" onmouseenter="enter('-5694513862252752333');" onmouseout="out('-5694513862252752333');" style=""> 350         // for both DISMISS and OPEN                                                                     </span>
<span class="-4736447846148159923" onmouseenter="enter('-4736447846148159923');" onmouseout="out('-4736447846148159923');" style=""> 351         mNotificationHandleLookup.add(notificationSpec.getId(), sbn.getPostTime());                      </span>
<span class="-213728990790172385" onmouseenter="enter('-213728990790172385');" onmouseout="out('-213728990790172385');" style=""> 352         // for MUTE                                                                                      </span>
<span class="-2410391779599853950" onmouseenter="enter('-2410391779599853950');" onmouseout="out('-2410391779599853950');" style=""> 353         mPackageLookup.add(notificationSpec.getId(), sbn.getPackageName());                              </span>
<span class="5979670797208442666" onmouseenter="enter('5979670797208442666');" onmouseout="out('5979670797208442666');" style=""> 354         notificationBurstPrevention.put(source, cur_time);                                               </span>
<span class="-1037528869006074751" onmouseenter="enter('-1037528869006074751');" onmouseout="out('-1037528869006074751');" style=""> 355         if (0 != notification.when) {                                                                    </span>
<span class="-7718619408843379706" onmouseenter="enter('-7718619408843379706');" onmouseout="out('-7718619408843379706');" style=""> 356             notificationOldRepeatPrevention.put(source, notification.when);                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 357         } else {                                                                                         </span>
<span class="-1627147369441390095" onmouseenter="enter('-1627147369441390095');" onmouseout="out('-1627147369441390095');" style=""><abbr title=" 358             LOG.info(&quot;This app might show old/duplicate notifications. notification.when is 0 for &quot; + source);"> 358             LOG.info(&quot;This app might show old/duplicate notifications. notification.when is 0 for &quot; + souðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 359         }                                                                                                </span>
<span class="9189856510229218442" onmouseenter="enter('9189856510229218442');" onmouseout="out('9189856510229218442');" style=""> 360         GBApplication.deviceService().onNotification(notificationSpec);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 361     }                                                                                                    </span>
<span  style=""> 362                                                                                                          </span>
<span class="3489513600177556550" onmouseenter="enter('3489513600177556550');" onmouseout="out('3489513600177556550');" style=""> 363     private boolean checkNotificationContentForWhiteAndBlackList(String packageName, String body) {      </span>
<span class="-150679469252815152" onmouseenter="enter('-150679469252815152');" onmouseout="out('-150679469252815152');" style=""> 364         long start = System.currentTimeMillis();                                                         </span>
<span  style=""> 365                                                                                                          </span>
<span class="2124734257009739137" onmouseenter="enter('2124734257009739137');" onmouseout="out('2124734257009739137');" style=""> 366         List&lt;String&gt; wordsList = new ArrayList&lt;&gt;();                                                      </span>
<span class="8513213831196998490" onmouseenter="enter('8513213831196998490');" onmouseout="out('8513213831196998490');" style=""> 367         NotificationFilter notificationFilter;                                                           </span>
<span  style=""> 368                                                                                                          </span>
<span class="-4590804423150229551" onmouseenter="enter('-4590804423150229551');" onmouseout="out('-4590804423150229551');" style=""> 369         try (DBHandler db = GBApplication.acquireDB()) {                                                 </span>
<span  style=""> 370                                                                                                          </span>
<span class="2403890883362572333" onmouseenter="enter('2403890883362572333');" onmouseout="out('2403890883362572333');" style=""> 371             NotificationFilterDao notificationFilterDao = db.getDaoSession().getNotificationFilterDao(); </span>
<span class="7254238877040119420" onmouseenter="enter('7254238877040119420');" onmouseout="out('7254238877040119420');" style=""><abbr title=" 372             NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilterEntryDao();"> 372             NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilðŸ”µ</abbr></span>
<span  style=""> 373                                                                                                          </span>
<span class="-4728567184917764691" onmouseenter="enter('-4728567184917764691');" onmouseout="out('-4728567184917764691');" style=""><abbr title=" 374             Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFilterDao.Properties.AppIdentifier.eq(packageName.toLowerCase())).build();"> 374             Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFiltðŸ”µ</abbr></span>
<span class="7488324375938324162" onmouseenter="enter('7488324375938324162');" onmouseout="out('7488324375938324162');" style=""> 375             notificationFilter = query.unique();                                                         </span>
<span  style=""> 376                                                                                                          </span>
<span class="6018560877068628254" onmouseenter="enter('6018560877068628254');" onmouseout="out('6018560877068628254');" style=""> 377             if (notificationFilter == null) {                                                            </span>
<span class="8510731869572739415" onmouseenter="enter('8510731869572739415');" onmouseout="out('8510731869572739415');" style=""> 378                 LOG.debug(&quot;No Notification Filter found&quot;);                                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 379                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 380             }                                                                                            </span>
<span  style=""> 381                                                                                                          </span>
<span class="3968012753441467210" onmouseenter="enter('3968012753441467210');" onmouseout="out('3968012753441467210');" style=""> 382             LOG.debug(&quot;Loaded notification filter for &#x27;{}&#x27;&quot;, packageName);                               </span>
<span class="7966618056150210259" onmouseenter="enter('7966618056150210259');" onmouseout="out('7966618056150210259');" style=""><abbr title=" 383             Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().where(NotificationFilterEntryDao.Properties.NotificationFilterId.eq(notificationFilter.getId())).build();"> 383             Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().whereðŸ”µ</abbr></span>
<span  style=""> 384                                                                                                          </span>
<span class="5592374987839394879" onmouseenter="enter('5592374987839394879');" onmouseout="out('5592374987839394879');" style=""> 385             List&lt;NotificationFilterEntry&gt; filterEntries = queryEntries.list();                           </span>
<span  style=""> 386                                                                                                          </span>
<span class="-8976969426120877151" onmouseenter="enter('-8976969426120877151');" onmouseout="out('-8976969426120877151');" style=""> 387             if (BuildConfig.DEBUG) {                                                                     </span>
<span class="-9170185973081630678" onmouseenter="enter('-9170185973081630678');" onmouseout="out('-9170185973081630678');" style=""> 388                 LOG.info(&quot;Database lookup took &#x27;{}&#x27; ms&quot;, System.currentTimeMillis() - start);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 389             }                                                                                            </span>
<span  style=""> 390                                                                                                          </span>
<span class="2077893056906600600" onmouseenter="enter('2077893056906600600');" onmouseout="out('2077893056906600600');" style=""> 391             if (!filterEntries.isEmpty()) {                                                              </span>
<span class="4304008491784528731" onmouseenter="enter('4304008491784528731');" onmouseout="out('4304008491784528731');" style=""> 392                 for (NotificationFilterEntry temp : filterEntries) {                                     </span>
<span class="4808262139369052558" onmouseenter="enter('4808262139369052558');" onmouseout="out('4808262139369052558');" style=""> 393                     wordsList.add(temp.getNotificationFilterContent());                                  </span>
<span class="-2502897764394929378" onmouseenter="enter('-2502897764394929378');" onmouseout="out('-2502897764394929378');" style=""> 394                     LOG.debug(&quot;Loaded filter word: &quot; + temp.getNotificationFilterContent());             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 395                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 396             }                                                                                            </span>
<span  style=""> 397                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 398         } catch (Exception e) {                                                                          </span>
<span class="-7390176680812789235" onmouseenter="enter('-7390176680812789235');" onmouseout="out('-7390176680812789235');" style=""> 399             LOG.error(&quot;Could not acquire DB.&quot;, e);                                                       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 400             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 401         }                                                                                                </span>
<span  style=""> 402                                                                                                          </span>
<span class="-2837061757343239904" onmouseenter="enter('-2837061757343239904');" onmouseout="out('-2837061757343239904');" style=""> 403         return shouldContinueAfterFilter(body, wordsList, notificationFilter);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 404     }                                                                                                    </span>
<span  style=""> 405                                                                                                          </span>
<span class="-5392793857622727834" onmouseenter="enter('-5392793857622727834');" onmouseout="out('-5392793857622727834');" style=""> 406     private void handleCallNotification(StatusBarNotification sbn) {                                     </span>
<span class="-2635029824573834340" onmouseenter="enter('-2635029824573834340');" onmouseout="out('-2635029824573834340');" style=""> 407         String app = sbn.getPackageName();                                                               </span>
<span class="-4765460655732789674" onmouseenter="enter('-4765460655732789674');" onmouseout="out('-4765460655732789674');" style=""> 408         LOG.debug(&quot;got call from: &quot; + app);                                                              </span>
<span class="-1087669074367115225" onmouseenter="enter('-1087669074367115225');" onmouseout="out('-1087669074367115225');" style=""> 409         if(app.equals(&quot;com.android.dialer&quot;)) {                                                           </span>
<span class="5503604353212721032" onmouseenter="enter('5503604353212721032');" onmouseout="out('5503604353212721032');" style=""> 410             LOG.debug(&quot;Ignoring non-voip call&quot;);                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 411             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412         }                                                                                                </span>
<span class="2515184326717332924" onmouseenter="enter('2515184326717332924');" onmouseout="out('2515184326717332924');" style=""> 413         Notification noti = sbn.getNotification();                                                       </span>
<span class="4917333921300541045" onmouseenter="enter('4917333921300541045');" onmouseout="out('4917333921300541045');" style=""> 414         dumpExtras(noti.extras);                                                                         </span>
<span class="7056760971959382883" onmouseenter="enter('7056760971959382883');" onmouseout="out('7056760971959382883');" style=""> 415         if(noti.actions != null &amp;&amp; noti.actions.length &gt; 0) {                                            </span>
<span class="-8283553374130078748" onmouseenter="enter('-8283553374130078748');" onmouseout="out('-8283553374130078748');" style=""> 416             for (Notification.Action action : noti.actions) {                                            </span>
<span class="4712881017428392998" onmouseenter="enter('4712881017428392998');" onmouseout="out('4712881017428392998');" style=""> 417                 LOG.info(&quot;Found call action: &quot; + action.title);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 418             }                                                                                            </span>
<span class="5573696862010733553" onmouseenter="enter('5573696862010733553');" onmouseout="out('5573696862010733553');" style=""> 419             /*try {                                                                                      </span>
<span class="-4941077910751273482" onmouseenter="enter('-4941077910751273482');" onmouseout="out('-4941077910751273482');" style=""> 420                 LOG.info(&quot;Executing first action&quot;);                                                      </span>
<span class="-6079407865140020178" onmouseenter="enter('-6079407865140020178');" onmouseout="out('-6079407865140020178');" style=""> 421                 noti.actions[0].actionIntent.send();                                                     </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 422             } catch (PendingIntent.CanceledException e) {                                                </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 423                 e.printStackTrace();                                                                     </span>
<span class="-2684617365274670769" onmouseenter="enter('-2684617365274670769');" onmouseout="out('-2684617365274670769');" style=""> 424             }*/                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 425         }                                                                                                </span>
<span  style=""> 426                                                                                                          </span>
<span class="-2563571895899526728" onmouseenter="enter('-2563571895899526728');" onmouseout="out('-2563571895899526728');" style=""> 427         // figure out sender                                                                             </span>
<span class="-9123115817740196080" onmouseenter="enter('-9123115817740196080');" onmouseout="out('-9123115817740196080');" style=""> 428         String number;                                                                                   </span>
<span class="-83871468585037136" onmouseenter="enter('-83871468585037136');" onmouseout="out('-83871468585037136');" style=""> 429         if(noti.extras.containsKey(Notification.EXTRA_PEOPLE)) {                                         </span>
<span class="-9087853976002790509" onmouseenter="enter('-9087853976002790509');" onmouseout="out('-9087853976002790509');" style=""> 430             number = noti.extras.getString(Notification.EXTRA_PEOPLE);                                   </span>
<span class="-2430024668957447800" onmouseenter="enter('-2430024668957447800');" onmouseout="out('-2430024668957447800');" style=""> 431         } else if(noti.extras.containsKey(Notification.EXTRA_TITLE)) {                                   </span>
<span class="-6437685763050744480" onmouseenter="enter('-6437685763050744480');" onmouseout="out('-6437685763050744480');" style=""> 432             number = noti.extras.getString(Notification.EXTRA_TITLE);                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 433         } else {                                                                                         </span>
<span class="8266080573880164526" onmouseenter="enter('8266080573880164526');" onmouseout="out('8266080573880164526');" style=""> 434             String appName = getAppName(app);                                                            </span>
<span class="3077870662190147275" onmouseenter="enter('3077870662190147275');" onmouseout="out('3077870662190147275');" style=""> 435             number = appName != null ? appName : app;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 436         }                                                                                                </span>
<span class="-2521654618349415592" onmouseenter="enter('-2521654618349415592');" onmouseout="out('-2521654618349415592');" style=""> 437         activeCallPostTime = sbn.getPostTime();                                                          </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style=""> 438         CallSpec callSpec = new CallSpec();                                                              </span>
<span class="6754379566106160474" onmouseenter="enter('6754379566106160474');" onmouseout="out('6754379566106160474');" style=""> 439         callSpec.number = number;                                                                        </span>
<span class="-4416193589830976087" onmouseenter="enter('-4416193589830976087');" onmouseout="out('-4416193589830976087');" style=""> 440         callSpec.command = CallSpec.CALL_INCOMING;                                                       </span>
<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style=""> 441         GBApplication.deviceService().onSetCallState(callSpec);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 442     }                                                                                                    </span>
<span  style=""> 443                                                                                                          </span>
<span class="-8223249024265886846" onmouseenter="enter('-8223249024265886846');" onmouseout="out('-8223249024265886846');" style=""> 444     boolean shouldContinueAfterFilter(@NonNull                                                           </span>
<span class="7041508209799247638" onmouseenter="enter('7041508209799247638');" onmouseout="out('7041508209799247638');" style=""> 445     String body, @NonNull                                                                                </span>
<span class="-4525045028782365899" onmouseenter="enter('-4525045028782365899');" onmouseout="out('-4525045028782365899');" style=""> 446     List&lt;String&gt; wordsList, @NonNull                                                                     </span>
<span class="6607353106141546191" onmouseenter="enter('6607353106141546191');" onmouseout="out('6607353106141546191');" style=""> 447     NotificationFilter notificationFilter) {                                                             </span>
<span class="-2049928826508332953" onmouseenter="enter('-2049928826508332953');" onmouseout="out('-2049928826508332953');" style=""><abbr title=" 448         LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterMode(), notificationFilter.getNotificationFilterSubMode(), wordsList);"> 448         LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterModðŸ”µ</abbr></span>
<span class="2466831550918903346" onmouseenter="enter('2466831550918903346');" onmouseout="out('2466831550918903346');" style=""><abbr title=" 449         boolean allMode = notificationFilter.getNotificationFilterSubMode() == NOTIFICATION_FILTER_SUBMODE_ALL;"> 449         boolean allMode = notificationFilter.getNotificationFilterSubMode() == NOTIFICATION_FILTER_SUBMODðŸ”µ</abbr></span>
<span class="7111790076547269568" onmouseenter="enter('7111790076547269568');" onmouseout="out('7111790076547269568');" style=""> 450         switch (notificationFilter.getNotificationFilterMode()) {                                        </span>
<span class="-8040581380510245828" onmouseenter="enter('-8040581380510245828');" onmouseout="out('-8040581380510245828');" style=""> 451             case NOTIFICATION_FILTER_MODE_BLACKLIST :                                                    </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 452                 if (allMode) {                                                                           </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 453                     for (String word : wordsList) {                                                      </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 454                         if (!body.contains(word)) {                                                      </span>
<span class="-6541716343086786985" onmouseenter="enter('-6541716343086786985');" onmouseout="out('-6541716343086786985');" style=""><abbr title=" 455                             LOG.info(&quot;Not every word was found, blacklist has no effect, processing continues.&quot;);"> 455                             LOG.info(&quot;Not every word was found, blacklist has no effect, processing contiðŸ”µ</abbr></span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 456                             return true;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 457                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 458                     }                                                                                    </span>
<span class="7128342962819519611" onmouseenter="enter('7128342962819519611');" onmouseout="out('7128342962819519611');" style=""> 459                     LOG.info(&quot;Every word was found, blacklist has effect, processing stops.&quot;);           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 460                     return false;                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 461                 } else {                                                                                 </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""><abbr title=" 462                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));"> 462                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequencðŸ”µ</abbr></span>
<span class="-6184990871390026912" onmouseenter="enter('-6184990871390026912');" onmouseout="out('-6184990871390026912');" style=""> 463                     if (!containsAny) {                                                                  </span>
<span class="-8299034583350120850" onmouseenter="enter('-8299034583350120850');" onmouseout="out('-8299034583350120850');" style=""><abbr title=" 464                         LOG.info(&quot;No matching word was found, blacklist has no effect, processing continues.&quot;);"> 464                         LOG.info(&quot;No matching word was found, blacklist has no effect, processing continuðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 465                     } else {                                                                             </span>
<span class="-1380690990253575343" onmouseenter="enter('-1380690990253575343');" onmouseout="out('-1380690990253575343');" style=""><abbr title=" 466                         LOG.info(&quot;At least one matching word was found, blacklist has effect, processing stops.&quot;);"> 466                         LOG.info(&quot;At least one matching word was found, blacklist has effect, processing ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 467                     }                                                                                    </span>
<span class="3895372753413352625" onmouseenter="enter('3895372753413352625');" onmouseout="out('3895372753413352625');" style=""> 468                     return !containsAny;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469                 }                                                                                        </span>
<span class="-248096094413131124" onmouseenter="enter('-248096094413131124');" onmouseout="out('-248096094413131124');" style=""> 470             case NOTIFICATION_FILTER_MODE_WHITELIST :                                                    </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 471                 if (allMode) {                                                                           </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 472                     for (String word : wordsList) {                                                      </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 473                         if (!body.contains(word)) {                                                      </span>
<span class="-2193044683137963048" onmouseenter="enter('-2193044683137963048');" onmouseout="out('-2193044683137963048');" style=""><abbr title=" 474                             LOG.info(&quot;Not every word was found, whitelist has no effect, processing stops.&quot;);"> 474                             LOG.info(&quot;Not every word was found, whitelist has no effect, processing stopsðŸ”µ</abbr></span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 475                             return false;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 476                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 477                     }                                                                                    </span>
<span class="7060257086642023362" onmouseenter="enter('7060257086642023362');" onmouseout="out('7060257086642023362');" style=""> 478                     LOG.info(&quot;Every word was found, whitelist has effect, processing continues.&quot;);       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 479                     return true;                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 480                 } else {                                                                                 </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""><abbr title=" 481                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));"> 481                     boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequencðŸ”µ</abbr></span>
<span class="-340597820517180781" onmouseenter="enter('-340597820517180781');" onmouseout="out('-340597820517180781');" style=""> 482                     if (containsAny) {                                                                   </span>
<span class="-1881072703439588003" onmouseenter="enter('-1881072703439588003');" onmouseout="out('-1881072703439588003');" style=""><abbr title=" 483                         LOG.info(&quot;At least one matching word was found, whitelist has effect, processing continues.&quot;);"> 483                         LOG.info(&quot;At least one matching word was found, whitelist has effect, processing ðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 484                     } else {                                                                             </span>
<span class="2098487797015691396" onmouseenter="enter('2098487797015691396');" onmouseout="out('2098487797015691396');" style=""><abbr title=" 485                         LOG.info(&quot;No matching word was found, whitelist has no effect, processing stops.&quot;);"> 485                         LOG.info(&quot;No matching word was found, whitelist has no effect, processing stops.&quot;ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 486                     }                                                                                    </span>
<span class="1941886136813063182" onmouseenter="enter('1941886136813063182');" onmouseout="out('1941886136813063182');" style=""> 487                     return containsAny;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 488                 }                                                                                        </span>
<span class="3050734735710613783" onmouseenter="enter('3050734735710613783');" onmouseout="out('3050734735710613783');" style=""> 489             default :                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 490                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 491         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492     }                                                                                                    </span>
<span  style=""> 493                                                                                                          </span>
<span class="-522333448184701526" onmouseenter="enter('-522333448184701526');" onmouseout="out('-522333448184701526');" style=""> 494     // Strip Unicode control sequences: some apps like Telegram add a lot of them for unknown reasons    </span>
<span class="-8731468808345203749" onmouseenter="enter('-8731468808345203749');" onmouseout="out('-8731468808345203749');" style=""> 495     private String sanitizeUnicode(String orig) {                                                        </span>
<span class="3980018359364350746" onmouseenter="enter('3980018359364350746');" onmouseout="out('3980018359364350746');" style=""> 496         return orig.replaceAll(&quot;\\p{C}&quot;, &quot;&quot;);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 497     }                                                                                                    </span>
<span  style=""> 498                                                                                                          </span>
<span class="4119982993835020511" onmouseenter="enter('4119982993835020511');" onmouseout="out('4119982993835020511');" style=""><abbr title=" 499     private void dissectNotificationTo(Notification notification, NotificationSpec notificationSpec, boolean preferBigText) {"> 499     private void dissectNotificationTo(Notification notification, NotificationSpec notificationSpec, boolðŸ”µ</abbr></span>
<span class="-4856559942663327722" onmouseenter="enter('-4856559942663327722');" onmouseout="out('-4856559942663327722');" style=""> 500         Bundle extras = NotificationCompat.getExtras(notification);                                      </span>
<span class="-6812122096607319135" onmouseenter="enter('-6812122096607319135');" onmouseout="out('-6812122096607319135');" style=""> 501         // dumpExtras(extras);                                                                           </span>
<span class="-6997230475683564369" onmouseenter="enter('-6997230475683564369');" onmouseout="out('-6997230475683564369');" style=""> 502         CharSequence title = extras.getCharSequence(Notification.EXTRA_TITLE);                           </span>
<span class="-5768442231641885516" onmouseenter="enter('-5768442231641885516');" onmouseout="out('-5768442231641885516');" style=""> 503         if (title != null) {                                                                             </span>
<span class="3486456028705164748" onmouseenter="enter('3486456028705164748');" onmouseout="out('3486456028705164748');" style=""> 504             notificationSpec.title = sanitizeUnicode(title.toString());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 505         }                                                                                                </span>
<span class="-1675348653102168964" onmouseenter="enter('-1675348653102168964');" onmouseout="out('-1675348653102168964');" style=""> 506         CharSequence contentCS = null;                                                                   </span>
<span class="7665214774958344559" onmouseenter="enter('7665214774958344559');" onmouseout="out('7665214774958344559');" style=""> 507         if (preferBigText &amp;&amp; extras.containsKey(Notification.EXTRA_BIG_TEXT)) {                          </span>
<span class="3933802215223175306" onmouseenter="enter('3933802215223175306');" onmouseout="out('3933802215223175306');" style=""> 508             contentCS = extras.getCharSequence(NotificationCompat.EXTRA_BIG_TEXT);                       </span>
<span class="8631000860903630717" onmouseenter="enter('8631000860903630717');" onmouseout="out('8631000860903630717');" style=""> 509         } else if (extras.containsKey(Notification.EXTRA_TEXT)) {                                        </span>
<span class="-7547654609103611854" onmouseenter="enter('-7547654609103611854');" onmouseout="out('-7547654609103611854');" style=""> 510             contentCS = extras.getCharSequence(NotificationCompat.EXTRA_TEXT);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 511         }                                                                                                </span>
<span class="-2707602363986640259" onmouseenter="enter('-2707602363986640259');" onmouseout="out('-2707602363986640259');" style=""> 512         if (contentCS != null) {                                                                         </span>
<span class="-5564526501110527191" onmouseenter="enter('-5564526501110527191');" onmouseout="out('-5564526501110527191');" style=""> 513             notificationSpec.body = sanitizeUnicode(contentCS.toString());                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 514         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 515     }                                                                                                    </span>
<span  style=""> 516                                                                                                          </span>
<span class="-7937366375312895792" onmouseenter="enter('-7937366375312895792');" onmouseout="out('-7937366375312895792');" style=""> 517     private boolean isServiceRunning() {                                                                 </span>
<span class="-674207090783892468" onmouseenter="enter('-674207090783892468');" onmouseout="out('-674207090783892468');" style=""> 518         ActivityManager manager = ((ActivityManager) (getSystemService(ACTIVITY_SERVICE)));              </span>
<span class="5841398637891737551" onmouseenter="enter('5841398637891737551');" onmouseout="out('5841398637891737551');" style=""> 519         if (manager == null) {                                                                           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 520             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 521         }                                                                                                </span>
<span class="-1060000448595061247" onmouseenter="enter('-1060000448595061247');" onmouseout="out('-1060000448595061247');" style=""><abbr title=" 522         for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) {"> 522         for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) ðŸ”µ</abbr></span>
<span class="1715383852667790939" onmouseenter="enter('1715383852667790939');" onmouseout="out('1715383852667790939');" style=""> 523             if (DeviceCommunicationService.class.getName().equals(service.service.getClassName())) {     </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 524                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 525             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 526         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 527         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 528     }                                                                                                    </span>
<span  style=""> 529                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 530     /**                                                                                                  </span>
<span class="-3386513456391723953" onmouseenter="enter('-3386513456391723953');" onmouseout="out('-3386513456391723953');" style=""> 531      * Try to handle media session notifications that tell info about the current play state.            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 532      *                                                                                                   </span>
<span class="-2019490562393536710" onmouseenter="enter('-2019490562393536710');" onmouseout="out('-2019490562393536710');" style=""> 533      * @param mediaSession The mediasession to handle.                                                   </span>
<span class="1642728463279900605" onmouseenter="enter('1642728463279900605');" onmouseout="out('1642728463279900605');" style=""> 534      * @return true if notification was handled, false otherwise                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 535      */                                                                                                  </span>
<span class="1254895864500637019" onmouseenter="enter('1254895864500637019');" onmouseout="out('1254895864500637019');" style=""> 536     public boolean handleMediaSessionNotification(MediaSessionCompat.Token mediaSession) {               </span>
<span class="-4606570715029334060" onmouseenter="enter('-4606570715029334060');" onmouseout="out('-4606570715029334060');" style=""> 537         MusicSpec musicSpec = new MusicSpec();                                                           </span>
<span class="6191411421956413825" onmouseenter="enter('6191411421956413825');" onmouseout="out('6191411421956413825');" style=""> 538         MusicStateSpec stateSpec = new MusicStateSpec();                                                 </span>
<span class="-6296053285913663629" onmouseenter="enter('-6296053285913663629');" onmouseout="out('-6296053285913663629');" style=""> 539         MediaControllerCompat c;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 540         try {                                                                                            </span>
<span class="7437011440923722104" onmouseenter="enter('7437011440923722104');" onmouseout="out('7437011440923722104');" style=""> 541             c = new MediaControllerCompat(getApplicationContext(), mediaSession);                        </span>
<span class="-1916914550610898815" onmouseenter="enter('-1916914550610898815');" onmouseout="out('-1916914550610898815');" style=""> 542             PlaybackStateCompat s = c.getPlaybackState();                                                </span>
<span class="-2541618655706888860" onmouseenter="enter('-2541618655706888860');" onmouseout="out('-2541618655706888860');" style=""> 543             stateSpec.position = ((int) (s.getPosition() / 1000));                                       </span>
<span class="5328288853423061088" onmouseenter="enter('5328288853423061088');" onmouseout="out('5328288853423061088');" style=""> 544             stateSpec.playRate = Math.round(100 * s.getPlaybackSpeed());                                 </span>
<span class="2323238932425227387" onmouseenter="enter('2323238932425227387');" onmouseout="out('2323238932425227387');" style=""> 545             stateSpec.repeat = 1;                                                                        </span>
<span class="-2798957985679932557" onmouseenter="enter('-2798957985679932557');" onmouseout="out('-2798957985679932557');" style=""> 546             stateSpec.shuffle = 1;                                                                       </span>
<span class="1453024666101612078" onmouseenter="enter('1453024666101612078');" onmouseout="out('1453024666101612078');" style=""> 547             switch (s.getState()) {                                                                      </span>
<span class="6582108916990199612" onmouseenter="enter('6582108916990199612');" onmouseout="out('6582108916990199612');" style=""> 548                 case PlaybackState.STATE_PLAYING :                                                       </span>
<span class="-5997751080810805230" onmouseenter="enter('-5997751080810805230');" onmouseout="out('-5997751080810805230');" style=""> 549                     stateSpec.state = MusicStateSpec.STATE_PLAYING;                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 550                     break;                                                                               </span>
<span class="5590526027681214953" onmouseenter="enter('5590526027681214953');" onmouseout="out('5590526027681214953');" style=""> 551                 case PlaybackState.STATE_STOPPED :                                                       </span>
<span class="7340128138398857774" onmouseenter="enter('7340128138398857774');" onmouseout="out('7340128138398857774');" style=""> 552                     stateSpec.state = MusicStateSpec.STATE_STOPPED;                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 553                     break;                                                                               </span>
<span class="1777956117592072014" onmouseenter="enter('1777956117592072014');" onmouseout="out('1777956117592072014');" style=""> 554                 case PlaybackState.STATE_PAUSED :                                                        </span>
<span class="928317678007732085" onmouseenter="enter('928317678007732085');" onmouseout="out('928317678007732085');" style=""> 555                     stateSpec.state = MusicStateSpec.STATE_PAUSED;                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 556                     break;                                                                               </span>
<span class="3050734735710613783" onmouseenter="enter('3050734735710613783');" onmouseout="out('3050734735710613783');" style=""> 557                 default :                                                                                </span>
<span class="1494209818965165815" onmouseenter="enter('1494209818965165815');" onmouseout="out('1494209818965165815');" style=""> 558                     stateSpec.state = MusicStateSpec.STATE_UNKNOWN;                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 559                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 560             }                                                                                            </span>
<span class="-1378394649293702376" onmouseenter="enter('-1378394649293702376');" onmouseout="out('-1378394649293702376');" style=""> 561             MediaMetadataCompat d = c.getMetadata();                                                     </span>
<span class="6223772025435192801" onmouseenter="enter('6223772025435192801');" onmouseout="out('6223772025435192801');" style=""> 562             if (d == null) {                                                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 563                 return false;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 564             }                                                                                            </span>
<span class="5367650048865522436" onmouseenter="enter('5367650048865522436');" onmouseout="out('5367650048865522436');" style=""> 565             if (d.containsKey(MediaMetadata.METADATA_KEY_ARTIST)) {                                      </span>
<span class="-145858411899069051" onmouseenter="enter('-145858411899069051');" onmouseout="out('-145858411899069051');" style=""> 566                 musicSpec.artist = d.getString(MediaMetadataCompat.METADATA_KEY_ARTIST);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 567             }                                                                                            </span>
<span class="-7798103878446422106" onmouseenter="enter('-7798103878446422106');" onmouseout="out('-7798103878446422106');" style=""> 568             if (d.containsKey(MediaMetadata.METADATA_KEY_ALBUM)) {                                       </span>
<span class="1803038863600841979" onmouseenter="enter('1803038863600841979');" onmouseout="out('1803038863600841979');" style=""> 569                 musicSpec.album = d.getString(MediaMetadataCompat.METADATA_KEY_ALBUM);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 570             }                                                                                            </span>
<span class="-5845914456102393940" onmouseenter="enter('-5845914456102393940');" onmouseout="out('-5845914456102393940');" style=""> 571             if (d.containsKey(MediaMetadata.METADATA_KEY_TITLE)) {                                       </span>
<span class="-6541941403865600636" onmouseenter="enter('-6541941403865600636');" onmouseout="out('-6541941403865600636');" style=""> 572                 musicSpec.track = d.getString(MediaMetadataCompat.METADATA_KEY_TITLE);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 573             }                                                                                            </span>
<span class="-3888067236269922999" onmouseenter="enter('-3888067236269922999');" onmouseout="out('-3888067236269922999');" style=""> 574             if (d.containsKey(MediaMetadata.METADATA_KEY_DURATION)) {                                    </span>
<span class="-1795401487549705712" onmouseenter="enter('-1795401487549705712');" onmouseout="out('-1795401487549705712');" style=""><abbr title=" 575                 musicSpec.duration = ((int) (d.getLong(MediaMetadataCompat.METADATA_KEY_DURATION))) / 1000;"> 575                 musicSpec.duration = ((int) (d.getLong(MediaMetadataCompat.METADATA_KEY_DURATION))) / 100ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 576             }                                                                                            </span>
<span class="5881261642577554387" onmouseenter="enter('5881261642577554387');" onmouseout="out('5881261642577554387');" style=""> 577             if (d.containsKey(MediaMetadata.METADATA_KEY_NUM_TRACKS)) {                                  </span>
<span class="1811869650509621488" onmouseenter="enter('1811869650509621488');" onmouseout="out('1811869650509621488');" style=""> 578                 musicSpec.trackCount = ((int) (d.getLong(MediaMetadataCompat.METADATA_KEY_NUM_TRACKS))); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 579             }                                                                                            </span>
<span class="-3850940168984097467" onmouseenter="enter('-3850940168984097467');" onmouseout="out('-3850940168984097467');" style=""> 580             if (d.containsKey(MediaMetadata.METADATA_KEY_TRACK_NUMBER)) {                                </span>
<span class="-8649479128560274699" onmouseenter="enter('-8649479128560274699');" onmouseout="out('-8649479128560274699');" style=""> 581                 musicSpec.trackNr = ((int) (d.getLong(MediaMetadataCompat.METADATA_KEY_TRACK_NUMBER)));  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 582             }                                                                                            </span>
<span class="2207286164059072520" onmouseenter="enter('2207286164059072520');" onmouseout="out('2207286164059072520');" style=""> 583             // finally, tell the device about it                                                         </span>
<span class="7157573786903835889" onmouseenter="enter('7157573786903835889');" onmouseout="out('7157573786903835889');" style=""> 584             GBApplication.deviceService().onSetMusicInfo(musicSpec);                                     </span>
<span class="-6342881769260875577" onmouseenter="enter('-6342881769260875577');" onmouseout="out('-6342881769260875577');" style=""> 585             GBApplication.deviceService().onSetMusicState(stateSpec);                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 586             return true;                                                                                 </span>
<span class="1010236952206238933" onmouseenter="enter('1010236952206238933');" onmouseout="out('1010236952206238933');" style=""> 587         } catch (java.lang.NullPointerException | RemoteException e) {                                   </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 588             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 589         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 590     }                                                                                                    </span>
<span  style=""> 591                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 592     @Override                                                                                            </span>
<span class="2733031363552103422" onmouseenter="enter('2733031363552103422');" onmouseout="out('2733031363552103422');" style=""> 593     public void onNotificationRemoved(StatusBarNotification sbn) {                                       </span>
<span class="6788945727497274526" onmouseenter="enter('6788945727497274526');" onmouseout="out('6788945727497274526');" style=""><abbr title=" 594         LOG.info(((&quot;Notification removed: &quot; + sbn.getPackageName()) + &quot;: &quot;) + sbn.getNotification().category);"> 594         LOG.info(((&quot;Notification removed: &quot; + sbn.getPackageName()) + &quot;: &quot;) + sbn.getNotification().categðŸ”µ</abbr></span>
<span class="5729570006670653729" onmouseenter="enter('5729570006670653729');" onmouseout="out('5729570006670653729');" style=""><abbr title=" 595         if (Notification.CATEGORY_CALL.equals(sbn.getNotification().category) &amp;&amp; (activeCallPostTime == sbn.getPostTime())) {"> 595         if (Notification.CATEGORY_CALL.equals(sbn.getNotification().category) &amp;&amp; (activeCallPostTime == sðŸ”µ</abbr></span>
<span class="-3941810167705609591" onmouseenter="enter('-3941810167705609591');" onmouseout="out('-3941810167705609591');" style=""> 596             activeCallPostTime = 0;                                                                      </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style=""> 597             CallSpec callSpec = new CallSpec();                                                          </span>
<span class="-7261749156805075102" onmouseenter="enter('-7261749156805075102');" onmouseout="out('-7261749156805075102');" style=""> 598             callSpec.command = CallSpec.CALL_END;                                                        </span>
<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style=""> 599             GBApplication.deviceService().onSetCallState(callSpec);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 600         }                                                                                                </span>
<span class="-7767930678383346096" onmouseenter="enter('-7767930678383346096');" onmouseout="out('-7767930678383346096');" style=""> 601         // FIXME: DISABLED for now                                                                       </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 602         /*                                                                                               </span>
<span class="1980360516715691973" onmouseenter="enter('1980360516715691973');" onmouseout="out('1980360516715691973');" style=""> 603         if (shouldIgnore(sbn))                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 604             return;                                                                                      </span>
<span  style=""> 605                                                                                                          </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 606         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="-1523052147845593738" onmouseenter="enter('-1523052147845593738');" onmouseout="out('-1523052147845593738');" style=""> 607         if (prefs.getBoolean(&quot;autoremove_notifications&quot;, false)) {                                       </span>
<span class="-1849447037737481789" onmouseenter="enter('-1849447037737481789');" onmouseout="out('-1849447037737481789');" style=""> 608             LOG.info(&quot;notification removed, will ask device to delete it&quot;);                              </span>
<span class="-8504489390442611809" onmouseenter="enter('-8504489390442611809');" onmouseout="out('-8504489390442611809');" style=""> 609             GBApplication.deviceService().onDeleteNotification((int) sbn.getPostTime());                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 610         }                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 611         */                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 612     }                                                                                                    </span>
<span  style=""> 613                                                                                                          </span>
<span class="2967918509730451591" onmouseenter="enter('2967918509730451591');" onmouseout="out('2967918509730451591');" style=""> 614     private void dumpExtras(Bundle bundle) {                                                             </span>
<span class="-755508411737932855" onmouseenter="enter('-755508411737932855');" onmouseout="out('-755508411737932855');" style=""> 615         for (String key : bundle.keySet()) {                                                             </span>
<span class="-680967060076152312" onmouseenter="enter('-680967060076152312');" onmouseout="out('-680967060076152312');" style=""> 616             Object value = bundle.get(key);                                                              </span>
<span class="-5708365098537636921" onmouseenter="enter('-5708365098537636921');" onmouseout="out('-5708365098537636921');" style=""> 617             if (value == null) {                                                                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 618                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 619             }                                                                                            </span>
<span class="6935438865287804705" onmouseenter="enter('6935438865287804705');" onmouseout="out('6935438865287804705');" style=""><abbr title=" 620             LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClass().getName()));"> 620             LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClaðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 621         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 622     }                                                                                                    </span>
<span  style=""> 623                                                                                                          </span>
<span class="-4145111049531346189" onmouseenter="enter('-4145111049531346189');" onmouseout="out('-4145111049531346189');" style=""> 624     private boolean shouldIgnore(StatusBarNotification sbn) {                                            </span>
<span class="8092663231671682276" onmouseenter="enter('8092663231671682276');" onmouseout="out('8092663231671682276');" style=""> 625         /* return early if DeviceCommunicationService is not running,                                    </span>
<span class="3206226847615773202" onmouseenter="enter('3206226847615773202');" onmouseout="out('3206226847615773202');" style=""> 626         else the service would get started every time we get a notification.                             </span>
<span class="-791229024049739616" onmouseenter="enter('-791229024049739616');" onmouseout="out('-791229024049739616');" style=""> 627         unfortunately we cannot enable/disable NotificationListener at runtime like we do with           </span>
<span class="-8375613837887391031" onmouseenter="enter('-8375613837887391031');" onmouseout="out('-8375613837887391031');" style=""> 628         broadcast receivers because it seems to invalidate the permissions that are                      </span>
<span class="-2262673952520346193" onmouseenter="enter('-2262673952520346193');" onmouseout="out('-2262673952520346193');" style=""> 629         necessary for NotificationListenerService                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 630          */                                                                                              </span>
<span class="1616189210815270203" onmouseenter="enter('1616189210815270203');" onmouseout="out('1616189210815270203');" style=""> 631         if ((!isServiceRunning()) || (sbn == null)) {                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 632             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 633         }                                                                                                </span>
<span class="-3796091657090886514" onmouseenter="enter('-3796091657090886514');" onmouseout="out('-3796091657090886514');" style=""><abbr title=" 634         return shouldIgnoreSource(sbn.getPackageName()) || shouldIgnoreNotification(sbn.getNotification(), sbn.getPackageName());"> 634         return shouldIgnoreSource(sbn.getPackageName()) || shouldIgnoreNotification(sbn.getNotification()ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 635     }                                                                                                    </span>
<span  style=""> 636                                                                                                          </span>
<span class="8460515521985572441" onmouseenter="enter('8460515521985572441');" onmouseout="out('8460515521985572441');" style=""> 637     private boolean shouldIgnoreSource(String source) {                                                  </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 638         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span  style=""> 639                                                                                                          </span>
<span class="714714039810027052" onmouseenter="enter('714714039810027052');" onmouseout="out('714714039810027052');" style=""> 640         /* do not display messages from &quot;android&quot;                                                        </span>
<span class="1893274482542565547" onmouseenter="enter('1893274482542565547');" onmouseout="out('1893274482542565547');" style=""> 641          * This includes keyboard selection message, usb connection messages, etc                        </span>
<span class="-7750906811397804767" onmouseenter="enter('-7750906811397804767');" onmouseout="out('-7750906811397804767');" style=""> 642          * Hope it does not filter out too much, we will see...                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 643          */                                                                                              </span>
<span  style=""> 644                                                                                                          </span>
<span class="1872165376889396003" onmouseenter="enter('1872165376889396003');" onmouseout="out('1872165376889396003');" style=""> 645         if (source.equals(&quot;android&quot;) ||                                                                  </span>
<span class="1446354513639890825" onmouseenter="enter('1446354513639890825');" onmouseout="out('1446354513639890825');" style=""> 646                 source.equals(&quot;com.android.systemui&quot;) ||                                                 </span>
<span class="-4630583015863350357" onmouseenter="enter('-4630583015863350357');" onmouseout="out('-4630583015863350357');" style=""> 647                 source.equals(&quot;com.android.dialer&quot;) ||                                                   </span>
<span class="-4581680912095398334" onmouseenter="enter('-4581680912095398334');" onmouseout="out('-4581680912095398334');" style=""> 648                 source.equals(&quot;com.cyanogenmod.eleven&quot;)) {                                               </span>
<span class="7414276835277607055" onmouseenter="enter('7414276835277607055');" onmouseout="out('7414276835277607055');" style=""> 649             LOG.info(&quot;Ignoring notification, is a system event&quot;);                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 650             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 651         }                                                                                                </span>
<span  style=""> 652                                                                                                          </span>
<span class="6340978795702098449" onmouseenter="enter('6340978795702098449');" onmouseout="out('6340978795702098449');" style=""> 653         if (source.equals(&quot;com.moez.QKSMS&quot;) ||                                                           </span>
<span class="3673317982547560929" onmouseenter="enter('3673317982547560929');" onmouseout="out('3673317982547560929');" style=""> 654                 source.equals(&quot;com.android.mms&quot;) ||                                                      </span>
<span class="-6538830744852229820" onmouseenter="enter('-6538830744852229820');" onmouseout="out('-6538830744852229820');" style=""> 655                 source.equals(&quot;com.sonyericsson.conversations&quot;) ||                                       </span>
<span class="-1795882970722883910" onmouseenter="enter('-1795882970722883910');" onmouseout="out('-1795882970722883910');" style=""> 656                 source.equals(&quot;com.android.messaging&quot;) ||                                                </span>
<span class="4780395695457664313" onmouseenter="enter('4780395695457664313');" onmouseout="out('4780395695457664313');" style=""> 657                 source.equals(&quot;org.smssecure.smssecure&quot;)) {                                              </span>
<span class="7115714847551904856" onmouseenter="enter('7115714847551904856');" onmouseout="out('7115714847551904856');" style=""> 658             if (!&quot;never&quot;.equals(prefs.getString(&quot;notification_mode_sms&quot;, &quot;when_screen_off&quot;))) {          </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 659                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 660             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 661         }                                                                                                </span>
<span  style=""> 662                                                                                                          </span>
<span class="6044120705305546650" onmouseenter="enter('6044120705305546650');" onmouseout="out('6044120705305546650');" style=""> 663         if (GBApplication.appIsNotifBlacklisted(source)) {                                               </span>
<span class="-8656872471771272619" onmouseenter="enter('-8656872471771272619');" onmouseout="out('-8656872471771272619');" style=""> 664             LOG.info(&quot;Ignoring notification, application is blacklisted&quot;);                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 665             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 666         }                                                                                                </span>
<span  style=""> 667                                                                                                          </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 668         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 669     }                                                                                                    </span>
<span  style=""> 670                                                                                                          </span>
<span class="1856078835330472094" onmouseenter="enter('1856078835330472094');" onmouseout="out('1856078835330472094');" style=""> 671     private boolean shouldIgnoreNotification(Notification notification, String source) {                 </span>
<span class="2710746236440319224" onmouseenter="enter('2710746236440319224');" onmouseout="out('2710746236440319224');" style=""> 672         MediaSessionCompat.Token mediaSession = getMediaSession(notification);                           </span>
<span class="-5383930052453944922" onmouseenter="enter('-5383930052453944922');" onmouseout="out('-5383930052453944922');" style=""> 673         // try to handle media session notifications                                                     </span>
<span class="3511576793031165096" onmouseenter="enter('3511576793031165096');" onmouseout="out('3511576793031165096');" style=""> 674         if ((mediaSession != null) &amp;&amp; handleMediaSessionNotification(mediaSession)) {                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 675             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 676         }                                                                                                </span>
<span class="8585714054343457960" onmouseenter="enter('8585714054343457960');" onmouseout="out('8585714054343457960');" style=""> 677         NotificationType type = AppNotificationType.getInstance().get(source);                           </span>
<span class="-3108268637978238079" onmouseenter="enter('-3108268637978238079');" onmouseout="out('-3108268637978238079');" style=""><abbr title=" 678         //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/Notification.html#FLAG_LOCAL_ONLY"> 678         //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/NoðŸ”µ</abbr></span>
<span class="1334602672683683072" onmouseenter="enter('1334602672683683072');" onmouseout="out('1334602672683683072');" style=""> 679         //some Apps always mark their notifcations as read-only                                          </span>
<span class="-243380540587029064" onmouseenter="enter('-243380540587029064');" onmouseout="out('-243380540587029064');" style=""><abbr title=" 680         if (((NotificationCompat.getLocalOnly(notification) &amp;&amp; (type != NotificationType.WECHAT)) &amp;&amp; (type != NotificationType.OUTLOOK)) &amp;&amp; (type != NotificationType.SKYPE)) {"> 680         if (((NotificationCompat.getLocalOnly(notification) &amp;&amp; (type != NotificationType.WECHAT)) &amp;&amp; (typðŸ”µ</abbr></span>
<span class="-4400049527969698929" onmouseenter="enter('-4400049527969698929');" onmouseout="out('-4400049527969698929');" style=""> 681             // see https://github.com/Freeyourgadget/Gadgetbridge/issues/1109                            </span>
<span class="-8433825860703034123" onmouseenter="enter('-8433825860703034123');" onmouseout="out('-8433825860703034123');" style=""> 682             LOG.info(&quot;local only&quot;);                                                                      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 683             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 684         }                                                                                                </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 685         Prefs prefs = GBApplication.getPrefs();                                                          </span>
<span class="7394809232234198434" onmouseenter="enter('7394809232234198434');" onmouseout="out('7394809232234198434');" style=""> 686         if (!prefs.getBoolean(&quot;notifications_generic_whenscreenon&quot;, false)) {                            </span>
<span class="-1033540538762468291" onmouseenter="enter('-1033540538762468291');" onmouseout="out('-1033540538762468291');" style=""> 687             PowerManager powermanager = ((PowerManager) (getSystemService(POWER_SERVICE)));              </span>
<span class="-5809956872773294216" onmouseenter="enter('-5809956872773294216');" onmouseout="out('-5809956872773294216');" style=""> 688             if ((powermanager != null) &amp;&amp; powermanager.isScreenOn()) {                                   </span>
<span class="-7763261956658220331" onmouseenter="enter('-7763261956658220331');" onmouseout="out('-7763261956658220331');" style=""><abbr title=" 689                 // LOG.info(&quot;Not forwarding notification, screen seems to be on and settings do not allow this&quot;);"> 689                 // LOG.info(&quot;Not forwarding notification, screen seems to be on and settings do not allowðŸ”µ</abbr></span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 690                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 691             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 692         }                                                                                                </span>
<span class="3125878453643003848" onmouseenter="enter('3125878453643003848');" onmouseout="out('3125878453643003848');" style=""> 693         return (notification.flags &amp; Notification.FLAG_ONGOING_EVENT) == Notification.FLAG_ONGOING_EVENT;</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 694     }                                                                                                    </span>
<span  style=""> 695                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 696     /**                                                                                                  </span>
<span class="-3600272953695402454" onmouseenter="enter('-3600272953695402454');" onmouseout="out('-3600272953695402454');" style=""> 697      * Get the notification color that should be used for this Pebble notification.                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 698      *                                                                                                   </span>
<span class="-6380098887809341874" onmouseenter="enter('-6380098887809341874');" onmouseout="out('-6380098887809341874');" style=""><abbr title=" 699      * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PebbleColor."> 699      * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PeðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 700      *                                                                                                   </span>
<span class="-5220482988035539244" onmouseenter="enter('-5220482988035539244');" onmouseout="out('-5220482988035539244');" style=""> 701      * See Issue #815 on GitHub to see how notification colors are set.                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 702      *                                                                                                   </span>
<span class="-144667098623416646" onmouseenter="enter('-144667098623416646');" onmouseout="out('-144667098623416646');" style=""> 703      * @param notificationSpec The NotificationSpec to read from.                                        </span>
<span class="-8231127304595524287" onmouseenter="enter('-8231127304595524287');" onmouseout="out('-8231127304595524287');" style=""> 704      * @return Returns a PebbleColor that best represents this notification.                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 705      */                                                                                                  </span>
<span class="-8858039465077957361" onmouseenter="enter('-8858039465077957361');" onmouseout="out('-8858039465077957361');" style=""> 706     private byte getPebbleColorForNotification(NotificationSpec notificationSpec) {                      </span>
<span class="2461936733082927787" onmouseenter="enter('2461936733082927787');" onmouseout="out('2461936733082927787');" style=""> 707         String appId = notificationSpec.sourceAppId;                                                     </span>
<span class="6072026966279222546" onmouseenter="enter('6072026966279222546');" onmouseout="out('6072026966279222546');" style=""> 708         NotificationType existingType = notificationSpec.type;                                           </span>
<span class="-4597227445151323685" onmouseenter="enter('-4597227445151323685');" onmouseout="out('-4597227445151323685');" style=""> 709         // If the notification type is known, return the associated color.                               </span>
<span class="-3115160525838252691" onmouseenter="enter('-3115160525838252691');" onmouseout="out('-3115160525838252691');" style=""> 710         if (existingType != NotificationType.UNKNOWN) {                                                  </span>
<span class="4443749667658266101" onmouseenter="enter('4443749667658266101');" onmouseout="out('4443749667658266101');" style=""> 711             return existingType.color;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 712         }                                                                                                </span>
<span class="128994715916204674" onmouseenter="enter('128994715916204674');" onmouseout="out('128994715916204674');" style=""> 713         // Otherwise, we go and attempt to find the color from the app icon.                             </span>
<span class="-6191555258820518316" onmouseenter="enter('-6191555258820518316');" onmouseout="out('-6191555258820518316');" style=""> 714         Drawable icon;                                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 715         try {                                                                                            </span>
<span class="8261548971879133584" onmouseenter="enter('8261548971879133584');" onmouseout="out('8261548971879133584');" style=""> 716             icon = getApplicationContext().getPackageManager().getApplicationIcon(appId);                </span>
<span class="6230969829088056905" onmouseenter="enter('6230969829088056905');" onmouseout="out('6230969829088056905');" style=""> 717             Objects.requireNonNull(icon);                                                                </span>
<span class="-2749309157466987679" onmouseenter="enter('-2749309157466987679');" onmouseout="out('-2749309157466987679');" style=""> 718         } catch (java.lang.Exception ex) {                                                               </span>
<span class="-3868233956680081057" onmouseenter="enter('-3868233956680081057');" onmouseout="out('-3868233956680081057');" style=""> 719             // If we can&#x27;t get the icon, we go with the default defined above.                           </span>
<span class="-5905931119091130668" onmouseenter="enter('-5905931119091130668');" onmouseout="out('-5905931119091130668');" style=""> 720             LOG.warn(&quot;Could not get icon for AppID &quot; + appId, ex);                                       </span>
<span class="5002487793506958772" onmouseenter="enter('5002487793506958772');" onmouseout="out('5002487793506958772');" style=""> 721             return PebbleColor.IslamicGreen;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 722         }                                                                                                </span>
<span class="-5100715979180048388" onmouseenter="enter('-5100715979180048388');" onmouseout="out('-5100715979180048388');" style=""> 723         Bitmap bitmapIcon = BitmapUtil.convertDrawableToBitmap(icon);                                    </span>
<span class="-2300183163680579321" onmouseenter="enter('-2300183163680579321');" onmouseout="out('-2300183163680579321');" style=""><abbr title=" 724         int iconPrimaryColor = new Palette.Builder(bitmapIcon).generate().getVibrantColor(Color.parseColor(&quot;#aa0000&quot;));"> 724         int iconPrimaryColor = new Palette.Builder(bitmapIcon).generate().getVibrantColor(Color.parseColoðŸ”µ</abbr></span>
<span class="5649835422942677201" onmouseenter="enter('5649835422942677201');" onmouseout="out('5649835422942677201');" style=""> 725         return PebbleUtils.getPebbleColor(iconPrimaryColor);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 726     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 727 }                                                                                                        </span>
































































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="-230343772074056088" onmouseenter="enter('-230343772074056088');" onmouseout="out('-230343772074056088');" style="">   1  /*  Copyright (C) 2015-2018 Andreas Shimokawa, Carsten Pfeiffer, Daniele                                          </span>
<span class="2492236627567978380" onmouseenter="enter('2492236627567978380');" onmouseout="out('2492236627567978380');" style="">   2      Gobbetti, Frank Slezak, Hasan Ammar, JosÃ© Rebelo, Julien Pivotto, Kevin                                       </span>
<span class="-504983364603579348" onmouseenter="enter('-504983364603579348');" onmouseout="out('-504983364603579348');" style="">   3      Richter, Normano64, Steffen Liebergeld, Taavi EomÃ¤e, Zhong Jianxin                                            </span>
<span  style="">   4                                                                                                                    </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   5      This file is part of Gadgetbridge.                                                                            </span>
<span  style="">   6                                                                                                                    </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   7      Gadgetbridge is free software: you can redistribute it and/or modify                                          </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   8      it under the terms of the GNU Affero General Public License as published                                      </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">   9      by the Free Software Foundation, either version 3 of the License, or                                          </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">  10      (at your option) any later version.                                                                           </span>
<span  style="">  11                                                                                                                    </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  12      Gadgetbridge is distributed in the hope that it will be useful,                                               </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  13      but WITHOUT ANY WARRANTY; without even the implied warranty of                                                </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  14      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                                 </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  15      GNU Affero General Public License for more details.                                                           </span>
<span  style="">  16                                                                                                                    </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  17      You should have received a copy of the GNU Affero General Public License                                      </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  18      along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                                      </span>
<span class="8249211937858728345" onmouseenter="enter('8249211937858728345');" onmouseout="out('8249211937858728345');" style="">  19  package nodomain.freeyourgadget.gadgetbridge.externalevents;                                                      </span>
<span  style="">  20                                                                                                                    </span>
<span class="-867022162471464761" onmouseenter="enter('-867022162471464761');" onmouseout="out('-867022162471464761');" style="">  21  import android.app.ActivityManager;                                                                               </span>
<span class="1017587490774535994" onmouseenter="enter('1017587490774535994');" onmouseout="out('1017587490774535994');" style="">  22  import android.app.Notification;                                                                                  </span>
<span class="2183671588995744448" onmouseenter="enter('2183671588995744448');" onmouseout="out('2183671588995744448');" style="">  23  import android.app.NotificationManager;                                                                           </span>
<span class="2265467446931963889" onmouseenter="enter('2265467446931963889');" onmouseout="out('2265467446931963889');" style="">  24  import android.app.PendingIntent;                                                                                 </span>
<span class="-489389385851058391" onmouseenter="enter('-489389385851058391');" onmouseout="out('-489389385851058391');" style="">  25  import android.content.BroadcastReceiver;                                                                         </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  26  import android.content.Context;                                                                                   </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  27  import android.content.Intent;                                                                                    </span>
<span class="8697221465021235869" onmouseenter="enter('8697221465021235869');" onmouseout="out('8697221465021235869');" style="">  28  import android.content.IntentFilter;                                                                              </span>
<span class="-841431222158024655" onmouseenter="enter('-841431222158024655');" onmouseout="out('-841431222158024655');" style="">  29  import android.content.pm.ApplicationInfo;                                                                        </span>
<span class="-1290624633738557221" onmouseenter="enter('-1290624633738557221');" onmouseout="out('-1290624633738557221');" style="">  30  import android.content.pm.PackageManager;                                                                         </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  31  import android.graphics.Bitmap;                                                                                   </span>
<span class="-5868658801447575011" onmouseenter="enter('-5868658801447575011');" onmouseout="out('-5868658801447575011');" style="">  32  import android.graphics.Color;                                                                                    </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  33  import android.graphics.drawable.Drawable;                                                                        </span>
<span class="-7644600255099282823" onmouseenter="enter('-7644600255099282823');" onmouseout="out('-7644600255099282823');" style="">  34  import android.media.MediaMetadata;                                                                               </span>
<span class="6014561289295455692" onmouseenter="enter('6014561289295455692');" onmouseout="out('6014561289295455692');" style="">  35  import android.media.session.PlaybackState;                                                                       </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  36  import android.os.Bundle;                                                                                         </span>
<span class="1048014933395814760" onmouseenter="enter('1048014933395814760');" onmouseout="out('1048014933395814760');" style="">  37  import android.os.PowerManager;                                                                                   </span>
<span class="2671599330745315048" onmouseenter="enter('2671599330745315048');" onmouseout="out('2671599330745315048');" style="">  38  import android.os.RemoteException;                                                                                </span>
<span class="2414580121965048179" onmouseenter="enter('2414580121965048179');" onmouseout="out('2414580121965048179');" style="">  39  import android.service.notification.NotificationListenerService;                                                  </span>
<span class="-5243140560088050107" onmouseenter="enter('-5243140560088050107');" onmouseout="out('-5243140560088050107');" style="">  40  import android.service.notification.StatusBarNotification;                                                        </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  41 -import android.support.annotation.NonNull;                                                                        </span>
<span class="776263261885946432" onmouseenter="enter('776263261885946432');" onmouseout="out('776263261885946432');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  42 -import android.support.v4.app.NotificationCompat;                                                                 </span>
<span class="-7596747065606978004" onmouseenter="enter('-7596747065606978004');" onmouseout="out('-7596747065606978004');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  43 -import android.support.v4.app.RemoteInput;                                                                        </span>
<span class="2517521963771876570" onmouseenter="enter('2517521963771876570');" onmouseout="out('2517521963771876570');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  44 -import android.support.v4.content.LocalBroadcastManager;                                                          </span>
<span class="-9135046463009697450" onmouseenter="enter('-9135046463009697450');" onmouseout="out('-9135046463009697450');" style="">  45  import android.support.v4.media.MediaMetadataCompat;                                                              </span>
<span class="3010053617601869286" onmouseenter="enter('3010053617601869286');" onmouseout="out('3010053617601869286');" style="">  46  import android.support.v4.media.session.MediaControllerCompat;                                                    </span>
<span class="7582659085834762989" onmouseenter="enter('7582659085834762989');" onmouseout="out('7582659085834762989');" style="">  47  import android.support.v4.media.session.MediaSessionCompat;                                                       </span>
<span class="7730848488047972805" onmouseenter="enter('7730848488047972805');" onmouseout="out('7730848488047972805');" style="">  48  import android.support.v4.media.session.PlaybackStateCompat;                                                      </span>
<span class="1265541204496044340" onmouseenter="enter('1265541204496044340');" onmouseout="out('1265541204496044340');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  49 -import android.support.v7.graphics.Palette;                                                                       </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  50 +                                                                                                                  </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  51 +import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  52 +import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  53 +import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  54 +                                                                                                                  </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  55 +import java.util.ArrayList;                                                                                       </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  56 +import java.util.HashMap;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  57 +import java.util.List;                                                                                            </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  58 +import java.util.Objects;                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  59 +                                                                                                                  </span>
<span class="6963272077887521702" onmouseenter="enter('6963272077887521702');" onmouseout="out('6963272077887521702');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  60 +import androidx.annotation.NonNull;                                                                               </span>
<span class="-8223344932374400146" onmouseenter="enter('-8223344932374400146');" onmouseout="out('-8223344932374400146');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  61 +import androidx.core.app.NotificationCompat;                                                                      </span>
<span class="608068994369921062" onmouseenter="enter('608068994369921062');" onmouseout="out('608068994369921062');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  62 +import androidx.core.app.RemoteInput;                                                                             </span>
<span class="-898780232029151795" onmouseenter="enter('-898780232029151795');" onmouseout="out('-898780232029151795');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  63 +import androidx.localbroadcastmanager.content.LocalBroadcastManager;                                              </span>
<span class="8247440879742583383" onmouseenter="enter('8247440879742583383');" onmouseout="out('8247440879742583383');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  64 +import androidx.palette.graphics.Palette;                                                                         </span>
<span class="-1987741288118698756" onmouseenter="enter('-1987741288118698756');" onmouseout="out('-1987741288118698756');" style="">  65  import de.greenrobot.dao.query.Query;                                                                             </span>
<span class="5877451784023912628" onmouseenter="enter('5877451784023912628');" onmouseout="out('5877451784023912628');" style="">  66  import nodomain.freeyourgadget.gadgetbridge.BuildConfig;                                                          </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  67  import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                                        </span>
<span class="-1471644270559892265" onmouseenter="enter('-1471644270559892265');" onmouseout="out('-1471644270559892265');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  68 -import nodomain.freeyourgadget.gadgetbridge.GBException;                                                          </span>
<span class="-7198279398549834921" onmouseenter="enter('-7198279398549834921');" onmouseout="out('-7198279398549834921');" style="">  69  import nodomain.freeyourgadget.gadgetbridge.R;                                                                    </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  70  import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                                   </span>
<span class="4987748567588683404" onmouseenter="enter('4987748567588683404');" onmouseout="out('4987748567588683404');" style="">  71  import nodomain.freeyourgadget.gadgetbridge.devices.pebble.PebbleColor;                                           </span>
<span class="4582396241551629343" onmouseenter="enter('4582396241551629343');" onmouseout="out('4582396241551629343');" style="">  72  import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilter;                                          </span>

<span class="-8984035867915956548" onmouseenter="enter('-8984035867915956548');" onmouseout="out('-8984035867915956548');" style="">  73  import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterDao;                                       </span>
<span class="-8722044444563651785" onmouseenter="enter('-8722044444563651785');" onmouseout="out('-8722044444563651785');" style="">  74  import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntry;                                     </span>
<span class="-8636777843920322113" onmouseenter="enter('-8636777843920322113');" onmouseout="out('-8636777843920322113');" style="">  75  import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntryDao;                                  </span>
<span class="9006904697493331689" onmouseenter="enter('9006904697493331689');" onmouseout="out('9006904697493331689');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  76 -import nodomain.freeyourgadget.gadgetbridge.model.*;                                                              </span>
<span class="6892049631062353546" onmouseenter="enter('6892049631062353546');" onmouseout="out('6892049631062353546');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  77 +import nodomain.freeyourgadget.gadgetbridge.model.AppNotificationType;                                            </span>
<span class="-4068239021838445503" onmouseenter="enter('-4068239021838445503');" onmouseout="out('-4068239021838445503');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  78 +import nodomain.freeyourgadget.gadgetbridge.model.MusicSpec;                                                      </span>
<span class="7536481506851862405" onmouseenter="enter('7536481506851862405');" onmouseout="out('7536481506851862405');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  79 +import nodomain.freeyourgadget.gadgetbridge.model.MusicStateSpec;                                                 </span>
<span class="8239808916005009388" onmouseenter="enter('8239808916005009388');" onmouseout="out('8239808916005009388');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  80 +import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;                                               </span>
<span class="7087011959288310716" onmouseenter="enter('7087011959288310716');" onmouseout="out('7087011959288310716');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  81 +import nodomain.freeyourgadget.gadgetbridge.model.NotificationType;                                               </span>
<span class="-3383373218913164687" onmouseenter="enter('-3383373218913164687');" onmouseout="out('-3383373218913164687');" style="">  82  import nodomain.freeyourgadget.gadgetbridge.service.DeviceCommunicationService;                                   </span>
<span class="-5340888108606249230" onmouseenter="enter('-5340888108606249230');" onmouseout="out('-5340888108606249230');" style="">  83  import nodomain.freeyourgadget.gadgetbridge.util.BitmapUtil;                                                      </span>
<span class="-6912606469471439703" onmouseenter="enter('-6912606469471439703');" onmouseout="out('-6912606469471439703');" style="">  84  import nodomain.freeyourgadget.gadgetbridge.util.LimitedQueue;                                                    </span>
<span class="4645284583739884744" onmouseenter="enter('4645284583739884744');" onmouseout="out('4645284583739884744');" style="">  85  import nodomain.freeyourgadget.gadgetbridge.util.PebbleUtils;                                                     </span>
<span class="-600862318521663319" onmouseenter="enter('-600862318521663319');" onmouseout="out('-600862318521663319');" style="">  86  import nodomain.freeyourgadget.gadgetbridge.util.Prefs;                                                           </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  87 -import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  88 -import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  89 -import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  90 -                                                                                                                  </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  91 -import java.util.ArrayList;                                                                                       </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  92 -import java.util.HashMap;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  93 -import java.util.List;                                                                                            </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  94 -import java.util.Objects;                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  95 -                                                                                                                  </span>
<span class="-7522097891467373273" onmouseenter="enter('-7522097891467373273');" onmouseout="out('-7522097891467373273');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  96 -import static android.support.v4.media.app.NotificationCompat.MediaStyle.getMediaSession;                         </span>
<span class="-5547807107031188302" onmouseenter="enter('-5547807107031188302');" onmouseout="out('-5547807107031188302');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  97 -import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.*;                       </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +                                                                                                                  </span>
<span class="7436623043745543163" onmouseenter="enter('7436623043745543163');" onmouseout="out('7436623043745543163');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +import static androidx.media.app.NotificationCompat.MediaStyle.getMediaSession;                                   </span>
<span class="2609355261484520736" onmouseenter="enter('2609355261484520736');" onmouseout="out('2609355261484520736');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 100 +import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_BLACKLIST;"> 100 +import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_ðŸ”µ</abbr></span>
<span class="-7771135586340561880" onmouseenter="enter('-7771135586340561880');" onmouseout="out('-7771135586340561880');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 101 +import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_WHITELIST;"> 101 +import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_MODE_ðŸ”µ</abbr></span>
<span class="-3815741097386417514" onmouseenter="enter('-3815741097386417514');" onmouseout="out('-3815741097386417514');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 102 +import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_SUBMODE_ALL;"> 102 +import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.NOTIFICATION_FILTER_SUBMOðŸ”µ</abbr></span>
<span  style=""> 103                                                                                                                    </span>
<span class="6882532116672062216" onmouseenter="enter('6882532116672062216');" onmouseout="out('6882532116672062216');" style=""> 104  public class NotificationListener extends NotificationListenerService {                                           </span>
<span  style=""> 105                                                                                                                    </span>
<span class="5652999225459763894" onmouseenter="enter('5652999225459763894');" onmouseout="out('5652999225459763894');" style=""> 106      private static final Logger LOG = LoggerFactory.getLogger(NotificationListener.class);                        </span>
<span  style=""> 107                                                                                                                    </span>
<span class="-6720636215056424198" onmouseenter="enter('-6720636215056424198');" onmouseout="out('-6720636215056424198');" style=""> 108      public static final String ACTION_DISMISS                                                                     </span>
<span class="-435533233439313912" onmouseenter="enter('-435533233439313912');" onmouseout="out('-435533233439313912');" style=""> 109              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss&quot;;                         </span>
<span class="-2138233225266526402" onmouseenter="enter('-2138233225266526402');" onmouseout="out('-2138233225266526402');" style=""> 110      public static final String ACTION_DISMISS_ALL                                                                 </span>
<span class="-4592236270087722119" onmouseenter="enter('-4592236270087722119');" onmouseout="out('-4592236270087722119');" style=""> 111              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss_all&quot;;                     </span>
<span class="-3417692764158931011" onmouseenter="enter('-3417692764158931011');" onmouseout="out('-3417692764158931011');" style=""> 112      public static final String ACTION_OPEN                                                                        </span>
<span class="-4990387725302380924" onmouseenter="enter('-4990387725302380924');" onmouseout="out('-4990387725302380924');" style=""> 113              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.open&quot;;                            </span>
<span class="-4179389986769695249" onmouseenter="enter('-4179389986769695249');" onmouseout="out('-4179389986769695249');" style=""> 114      public static final String ACTION_MUTE                                                                        </span>
<span class="9023540546537828742" onmouseenter="enter('9023540546537828742');" onmouseout="out('9023540546537828742');" style=""> 115              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.mute&quot;;                            </span>
<span class="5009618492496239115" onmouseenter="enter('5009618492496239115');" onmouseout="out('5009618492496239115');" style=""> 116      public static final String ACTION_REPLY                                                                       </span>
<span class="8900274215532856227" onmouseenter="enter('8900274215532856227');" onmouseout="out('8900274215532856227');" style=""> 117              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.reply&quot;;                           </span>
<span  style=""> 118                                                                                                                    </span>
<span class="2046947475762055359" onmouseenter="enter('2046947475762055359');" onmouseout="out('2046947475762055359');" style=""> 119      private LimitedQueue mActionLookup = new LimitedQueue(32);                                                    </span>
<span class="7830816337914020824" onmouseenter="enter('7830816337914020824');" onmouseout="out('7830816337914020824');" style=""> 120      private LimitedQueue mPackageLookup = new LimitedQueue(64);                                                   </span>
<span class="203591122145891899" onmouseenter="enter('203591122145891899');" onmouseout="out('203591122145891899');" style=""> 121      private LimitedQueue mNotificationHandleLookup = new LimitedQueue(128);                                       </span>
<span  style=""> 122                                                                                                                    </span>
<span class="5935133783530348929" onmouseenter="enter('5935133783530348929');" onmouseout="out('5935133783530348929');" style=""> 123      private HashMap&lt;String, Long&gt; notificationBurstPrevention = new HashMap&lt;&gt;();                                  </span>
<span class="957532525841967801" onmouseenter="enter('957532525841967801');" onmouseout="out('957532525841967801');" style=""> 124      private HashMap&lt;String, Long&gt; notificationOldRepeatPrevention = new HashMap&lt;&gt;();                              </span>


<span  style=""> 125                                                                                                                    </span>
<span class="4625474178666977899" onmouseenter="enter('4625474178666977899');" onmouseout="out('4625474178666977899');" style=""> 126      private final BroadcastReceiver mReceiver = new BroadcastReceiver() {                                         </span>
<span  style=""> 127                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 128          @Override                                                                                                 </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 129          public void onReceive(Context context, Intent intent) {                                                   </span>
<span class="5344227773413700857" onmouseenter="enter('5344227773413700857');" onmouseout="out('5344227773413700857');" style=""> 130              String action = intent.getAction();                                                                   </span>
<span class="4668300806615190248" onmouseenter="enter('4668300806615190248');" onmouseout="out('4668300806615190248');" style=""> 131              if (action == null) {                                                                                 </span>
<span class="-9060638611519565940" onmouseenter="enter('-9060638611519565940');" onmouseout="out('-9060638611519565940');" style=""> 132                  LOG.warn(&quot;no action&quot;);                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 133                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134              }                                                                                                     </span>
<span  style=""> 135                                                                                                                    </span>
<span class="-4066678304235095791" onmouseenter="enter('-4066678304235095791');" onmouseout="out('-4066678304235095791');" style=""> 136              int handle = (int) intent.getLongExtra(&quot;handle&quot;, -1);                                                 </span>
<span class="6099627150369302694" onmouseenter="enter('6099627150369302694');" onmouseout="out('6099627150369302694');" style=""> 137              switch (action) {                                                                                     </span>
<span class="-3756464253045444946" onmouseenter="enter('-3756464253045444946');" onmouseout="out('-3756464253045444946');" style=""> 138                  case GBApplication.ACTION_QUIT:                                                                   </span>
<span class="711670831438240238" onmouseenter="enter('711670831438240238');" onmouseout="out('711670831438240238');" style=""> 139                      stopSelf();                                                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 140                      break;                                                                                        </span>
<span  style=""> 141                                                                                                                    </span>
<span class="7089712877132390363" onmouseenter="enter('7089712877132390363');" onmouseout="out('7089712877132390363');" style=""> 142                  case ACTION_OPEN: {                                                                               </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""> 143                      StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();            </span>
<span class="-2620913793661815477" onmouseenter="enter('-2620913793661815477');" onmouseout="out('-2620913793661815477');" style=""> 144                      Long ts = (Long) mNotificationHandleLookup.lookup(handle);                                    </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 145                      if (ts == null) {                                                                             </span>
<span class="-3551838833774164230" onmouseenter="enter('-3551838833774164230');" onmouseout="out('-3551838833774164230');" style=""> 146                          LOG.info(&quot;could not lookup handle for open action&quot;);                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 147                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148                      }                                                                                             </span>
<span  style=""> 149                                                                                                                    </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 150                      for (StatusBarNotification sbn : sbns) {                                                      </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 151                          if (sbn.getPostTime() == ts) {                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 152                              try {                                                                                 </span>
<span class="-5589448531951598530" onmouseenter="enter('-5589448531951598530');" onmouseout="out('-5589448531951598530');" style=""> 153                                  PendingIntent pi = sbn.getNotification().contentIntent;                           </span>
<span class="-4590351723917688021" onmouseenter="enter('-4590351723917688021');" onmouseout="out('-4590351723917688021');" style=""> 154                                  if (pi != null) {                                                                 </span>
<span class="-4072418890714992779" onmouseenter="enter('-4072418890714992779');" onmouseout="out('-4072418890714992779');" style=""> 155                                      pi.send();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156                                  }                                                                                 </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 157                              } catch (PendingIntent.CanceledException e) {                                         </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 158                                  e.printStackTrace();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161                      }                                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 162                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163                  }                                                                                                 </span>
<span class="-4678853843833528690" onmouseenter="enter('-4678853843833528690');" onmouseout="out('-4678853843833528690');" style=""> 164                  case ACTION_MUTE:                                                                                 </span>
<span class="4917035583817915455" onmouseenter="enter('4917035583817915455');" onmouseout="out('4917035583817915455');" style=""> 165                      String packageName = (String) mPackageLookup.lookup(handle);                                  </span>
<span class="2797777100746091358" onmouseenter="enter('2797777100746091358');" onmouseout="out('2797777100746091358');" style=""> 166                      if (packageName == null) {                                                                    </span>
<span class="5190950653644936431" onmouseenter="enter('5190950653644936431');" onmouseout="out('5190950653644936431');" style=""> 167                          LOG.info(&quot;could not lookup handle for mute action&quot;);                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 168                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169                      }                                                                                             </span>
<span  style=""> 170                                                                                                                    </span>
<span class="-55961907216512395" onmouseenter="enter('-55961907216512395');" onmouseout="out('-55961907216512395');" style=""> 171                      LOG.info(&quot;going to mute &quot; + packageName);                                                     </span>
<span class="6244948836232449423" onmouseenter="enter('6244948836232449423');" onmouseout="out('6244948836232449423');" style=""> 172                      GBApplication.addAppToNotifBlacklist(packageName);                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 173                      break;                                                                                        </span>
<span class="-1141458133536299461" onmouseenter="enter('-1141458133536299461');" onmouseout="out('-1141458133536299461');" style=""> 174                  case ACTION_DISMISS: {                                                                            </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""> 175                      StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();            </span>
<span class="-2620913793661815477" onmouseenter="enter('-2620913793661815477');" onmouseout="out('-2620913793661815477');" style=""> 176                      Long ts = (Long) mNotificationHandleLookup.lookup(handle);                                    </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 177                      if (ts == null) {                                                                             </span>
<span class="2968382775980406642" onmouseenter="enter('2968382775980406642');" onmouseout="out('2968382775980406642');" style=""> 178                          LOG.info(&quot;could not lookup handle for dismiss action&quot;);                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 179                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180                      }                                                                                             </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 181                      for (StatusBarNotification sbn : sbns) {                                                      </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 182                          if (sbn.getPostTime() == ts) {                                                            </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 183                              if (GBApplication.isRunningLollipopOrLater()) {                                       </span>
<span class="6969546006861717982" onmouseenter="enter('6969546006861717982');" onmouseout="out('6969546006861717982');" style=""> 184                                  String key = sbn.getKey();                                                        </span>
<span class="-8910102463751962403" onmouseenter="enter('-8910102463751962403');" onmouseout="out('-8910102463751962403');" style=""> 185                                  NotificationListener.this.cancelNotification(key);                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 186                              } else {                                                                              </span>
<span class="8698193459204911181" onmouseenter="enter('8698193459204911181');" onmouseout="out('8698193459204911181');" style=""> 187                                  int id = sbn.getId();                                                             </span>
<span class="-3586097476318973287" onmouseenter="enter('-3586097476318973287');" onmouseout="out('-3586097476318973287');" style=""> 188                                  String pkg = sbn.getPackageName();                                                </span>
<span class="-8898967747084014814" onmouseenter="enter('-8898967747084014814');" onmouseout="out('-8898967747084014814');" style=""> 189                                  String tag = sbn.getTag();                                                        </span>
<span class="-7819421458484381897" onmouseenter="enter('-7819421458484381897');" onmouseout="out('-7819421458484381897');" style=""> 190                                  NotificationListener.this.cancelNotification(pkg, tag, id);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193                      }                                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 194                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195                  }                                                                                                 </span>
<span class="-6975792259235269251" onmouseenter="enter('-6975792259235269251');" onmouseout="out('-6975792259235269251');" style=""> 196                  case ACTION_DISMISS_ALL:                                                                          </span>
<span class="1530048448958335468" onmouseenter="enter('1530048448958335468');" onmouseout="out('1530048448958335468');" style=""> 197                      NotificationListener.this.cancelAllNotifications();                                           </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 198                      break;                                                                                        </span>
<span class="-8033996733174441765" onmouseenter="enter('-8033996733174441765');" onmouseout="out('-8033996733174441765');" style=""> 199                  case ACTION_REPLY:                                                                                </span>
<span class="4738866927376315941" onmouseenter="enter('4738866927376315941');" onmouseout="out('4738866927376315941');" style=""><abbr title=" 200                      NotificationCompat.Action wearableAction = (NotificationCompat.Action) mActionLookup.lookup(handle);"> 200                      NotificationCompat.Action wearableAction = (NotificationCompat.Action) mActionLookup.lookup(haðŸ”µ</abbr></span>
<span class="2885762978640892133" onmouseenter="enter('2885762978640892133');" onmouseout="out('2885762978640892133');" style=""> 201                      String reply = intent.getStringExtra(&quot;reply&quot;);                                                </span>
<span class="-2711571343237725875" onmouseenter="enter('-2711571343237725875');" onmouseout="out('-2711571343237725875');" style=""> 202                      if (wearableAction != null) {                                                                 </span>
<span class="8382710711087379858" onmouseenter="enter('8382710711087379858');" onmouseout="out('8382710711087379858');" style=""> 203                          PendingIntent actionIntent = wearableAction.getActionIntent();                            </span>
<span class="8988901388813075705" onmouseenter="enter('8988901388813075705');" onmouseout="out('8988901388813075705');" style=""> 204                          Intent localIntent = new Intent();                                                        </span>
<span class="7096307769955289231" onmouseenter="enter('7096307769955289231');" onmouseout="out('7096307769955289231');" style=""> 205                          localIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);                                      </span>
<span class="-3683679949476668963" onmouseenter="enter('-3683679949476668963');" onmouseout="out('-3683679949476668963');" style=""> 206                          if(wearableAction.getRemoteInputs()!=null) {                                              </span>
<span class="-957754769572110349" onmouseenter="enter('-957754769572110349');" onmouseout="out('-957754769572110349');" style=""> 207                              RemoteInput[] remoteInputs = wearableAction.getRemoteInputs();                        </span>
<span class="1776998572180860248" onmouseenter="enter('1776998572180860248');" onmouseout="out('1776998572180860248');" style=""> 208                              Bundle extras = new Bundle();                                                         </span>
<span class="2352964158014766609" onmouseenter="enter('2352964158014766609');" onmouseout="out('2352964158014766609');" style=""> 209                              extras.putCharSequence(remoteInputs[0].getResultKey(), reply);                        </span>
<span class="5088590721402752136" onmouseenter="enter('5088590721402752136');" onmouseout="out('5088590721402752136');" style=""> 210                              RemoteInput.addResultsToIntent(remoteInputs, localIntent, extras);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211                          }                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 212                          try {                                                                                     </span>
<span class="2300129068579463689" onmouseenter="enter('2300129068579463689');" onmouseout="out('2300129068579463689');" style=""> 213                              LOG.info(&quot;will send exec intent to remote application&quot;);                              </span>
<span class="2731482446525466050" onmouseenter="enter('2731482446525466050');" onmouseout="out('2731482446525466050');" style=""> 214                              actionIntent.send(context, 0, localIntent);                                           </span>
<span class="5952869537434724617" onmouseenter="enter('5952869537434724617');" onmouseout="out('5952869537434724617');" style=""> 215                              mActionLookup.remove(handle);                                                         </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 216                          } catch (PendingIntent.CanceledException e) {                                             </span>
<span class="-3367288945438988923" onmouseenter="enter('-3367288945438988923');" onmouseout="out('-3367288945438988923');" style=""> 217                              LOG.warn(&quot;replyToLastNotification error: &quot; + e.getLocalizedMessage());                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219                      }                                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 220                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222          }                                                                                                         </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 223      };                                                                                                            </span>
<span  style=""> 224                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 225      @Override                                                                                                     </span>
<span class="-2716773701189387633" onmouseenter="enter('-2716773701189387633');" onmouseout="out('-2716773701189387633');" style=""> 226      public void onCreate() {                                                                                      </span>
<span class="-2958534921295515858" onmouseenter="enter('-2958534921295515858');" onmouseout="out('-2958534921295515858');" style=""> 227          super.onCreate();                                                                                         </span>
<span class="7618100238646869770" onmouseenter="enter('7618100238646869770');" onmouseout="out('7618100238646869770');" style=""> 228          IntentFilter filterLocal = new IntentFilter();                                                            </span>
<span class="1063910518920289150" onmouseenter="enter('1063910518920289150');" onmouseout="out('1063910518920289150');" style=""> 229          filterLocal.addAction(GBApplication.ACTION_QUIT);                                                         </span>
<span class="2076754442287025975" onmouseenter="enter('2076754442287025975');" onmouseout="out('2076754442287025975');" style=""> 230          filterLocal.addAction(ACTION_OPEN);                                                                       </span>
<span class="-6869981444846929258" onmouseenter="enter('-6869981444846929258');" onmouseout="out('-6869981444846929258');" style=""> 231          filterLocal.addAction(ACTION_DISMISS);                                                                    </span>
<span class="8695742864955675589" onmouseenter="enter('8695742864955675589');" onmouseout="out('8695742864955675589');" style=""> 232          filterLocal.addAction(ACTION_DISMISS_ALL);                                                                </span>
<span class="3848496335642882317" onmouseenter="enter('3848496335642882317');" onmouseout="out('3848496335642882317');" style=""> 233          filterLocal.addAction(ACTION_MUTE);                                                                       </span>
<span class="-4535783496195239094" onmouseenter="enter('-4535783496195239094');" onmouseout="out('-4535783496195239094');" style=""> 234          filterLocal.addAction(ACTION_REPLY);                                                                      </span>
<span class="-4279331771748389639" onmouseenter="enter('-4279331771748389639');" onmouseout="out('-4279331771748389639');" style=""> 235          LocalBroadcastManager.getInstance(this).registerReceiver(mReceiver, filterLocal);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236      }                                                                                                             </span>
<span  style=""> 237                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 238      @Override                                                                                                     </span>
<span class="658855826062432633" onmouseenter="enter('658855826062432633');" onmouseout="out('658855826062432633');" style=""> 239      public void onDestroy() {                                                                                     </span>
<span class="1476506345433791001" onmouseenter="enter('1476506345433791001');" onmouseout="out('1476506345433791001');" style=""> 240          LocalBroadcastManager.getInstance(this).unregisterReceiver(mReceiver);                                    </span>
<span class="7275190530034972367" onmouseenter="enter('7275190530034972367');" onmouseout="out('7275190530034972367');" style=""> 241          super.onDestroy();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242      }                                                                                                             </span>
<span  style=""> 243                                                                                                                    </span>











<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 244      @Override                                                                                                     </span>
<span class="-2772368349505117806" onmouseenter="enter('-2772368349505117806');" onmouseout="out('-2772368349505117806');" style=""> 245      public void onNotificationPosted(StatusBarNotification sbn) {                                                 </span>
<span class="1980360516715691973" onmouseenter="enter('1980360516715691973');" onmouseout="out('1980360516715691973');" style=""> 246          if (shouldIgnore(sbn))                                                                                    </span>


<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 247              return;                                                                                               </span>







<span  style=""> 248                                                                                                                    </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 249          Prefs prefs = GBApplication.getPrefs();                                                                   </span>
<span  style=""> 250                                                                                                                    </span>
<span class="8054135432811402885" onmouseenter="enter('8054135432811402885');" onmouseout="out('8054135432811402885');" style=""> 251          switch (GBApplication.getGrantedInterruptionFilter()) {                                                   </span>
<span class="4109165554183544277" onmouseenter="enter('4109165554183544277');" onmouseout="out('4109165554183544277');" style=""> 252              case NotificationManager.INTERRUPTION_FILTER_ALL:                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 253                  break;                                                                                            </span>
<span class="-4951181644409102304" onmouseenter="enter('-4951181644409102304');" onmouseout="out('-4951181644409102304');" style=""> 254              case NotificationManager.INTERRUPTION_FILTER_ALARMS:                                                  </span>
<span class="7344230421954560306" onmouseenter="enter('7344230421954560306');" onmouseout="out('7344230421954560306');" style=""> 255              case NotificationManager.INTERRUPTION_FILTER_NONE:                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 256                  return;                                                                                           </span>
<span class="-4328737131563524650" onmouseenter="enter('-4328737131563524650');" onmouseout="out('-4328737131563524650');" style=""> 257              case NotificationManager.INTERRUPTION_FILTER_PRIORITY:                                                </span>
<span class="8591867555140901755" onmouseenter="enter('8591867555140901755');" onmouseout="out('8591867555140901755');" style=""> 258                  // FIXME: Handle Reminders and Events if they are enabled in Do Not Disturb                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 259                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260          }                                                                                                         </span>
<span  style=""> 261                                                                                                                    </span>
<span class="3332016722812204086" onmouseenter="enter('3332016722812204086');" onmouseout="out('3332016722812204086');" style=""> 262          String source = sbn.getPackageName().toLowerCase();                                                       </span>
<span class="2830045728262824638" onmouseenter="enter('2830045728262824638');" onmouseout="out('2830045728262824638');" style=""> 263          Notification notification = sbn.getNotification();                                                        </span>
<span class="4218475881538878307" onmouseenter="enter('4218475881538878307');" onmouseout="out('4218475881538878307');" style=""> 264          if (notificationOldRepeatPrevention.containsKey(source)) {                                                </span>
<span class="6155853035860803703" onmouseenter="enter('6155853035860803703');" onmouseout="out('6155853035860803703');" style=""> 265              if (notification.when &lt;= notificationOldRepeatPrevention.get(source)) {                               </span>
<span class="-4118070098413074653" onmouseenter="enter('-4118070098413074653');" onmouseout="out('-4118070098413074653');" style=""> 266                  LOG.info(&quot;NOT processing notification, already sent newer notifications from this source.&quot;);      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 267                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269          }                                                                                                         </span>
<span  style=""> 270                                                                                                                    </span>
<span class="-5834893131205351970" onmouseenter="enter('-5834893131205351970');" onmouseout="out('-5834893131205351970');" style=""> 271          // Ignore too frequent notifications, according to user preference                                        </span>
<span class="8739203694966910315" onmouseenter="enter('8739203694966910315');" onmouseout="out('8739203694966910315');" style=""> 272          long min_timeout = (long)prefs.getInt(&quot;notifications_timeout&quot;, 0) * 1000L;                                </span>
<span class="7158364678624901735" onmouseenter="enter('7158364678624901735');" onmouseout="out('7158364678624901735');" style=""> 273          long cur_time = System.currentTimeMillis();                                                               </span>
<span class="4691272725591601941" onmouseenter="enter('4691272725591601941');" onmouseout="out('4691272725591601941');" style=""> 274          if (notificationBurstPrevention.containsKey(source)) {                                                    </span>
<span class="-7388621012045880255" onmouseenter="enter('-7388621012045880255');" onmouseout="out('-7388621012045880255');" style=""> 275              long last_time = notificationBurstPrevention.get(source);                                             </span>
<span class="8371821158922557754" onmouseenter="enter('8371821158922557754');" onmouseout="out('8371821158922557754');" style=""> 276              if (cur_time - last_time &lt; min_timeout) {                                                             </span>
<span class="761193726766758320" onmouseenter="enter('761193726766758320');" onmouseout="out('761193726766758320');" style=""> 277                  LOG.info(&quot;Ignoring frequent notification, last one was &quot; + (cur_time - last_time) + &quot;ms ago&quot;);    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 278                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280          }                                                                                                         </span>
<span  style=""> 281                                                                                                                    </span>
<span class="4249292218927487361" onmouseenter="enter('4249292218927487361');" onmouseout="out('4249292218927487361');" style=""> 282          NotificationSpec notificationSpec = new NotificationSpec();                                               </span>
<span  style=""> 283                                                                                                                    </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style=""> 284          // determinate Source App Name (&quot;Label&quot;)                                                                  </span>
<span class="-6628567271413355488" onmouseenter="enter('-6628567271413355488');" onmouseout="out('-6628567271413355488');" style=""> 285          PackageManager pm = getPackageManager();                                                                  </span>
<span class="-1270310547520251488" onmouseenter="enter('-1270310547520251488');" onmouseout="out('-1270310547520251488');" style=""> 286          ApplicationInfo ai = null;                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 287          try {                                                                                                     </span>
<span class="935827957867129526" onmouseenter="enter('935827957867129526');" onmouseout="out('935827957867129526');" style=""> 288              ai = pm.getApplicationInfo(source, 0);                                                                </span>
<span class="8932842947262589349" onmouseenter="enter('8932842947262589349');" onmouseout="out('8932842947262589349');" style=""> 289          } catch (PackageManager.NameNotFoundException e) {                                                        </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 290              e.printStackTrace();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291          }                                                                                                         </span>
<span class="-7433648267677911184" onmouseenter="enter('-7433648267677911184');" onmouseout="out('-7433648267677911184');" style=""> 292          if (ai != null) {                                                                                         </span>
<span class="-2056449758575494768" onmouseenter="enter('-2056449758575494768');" onmouseout="out('-2056449758575494768');" style=""> 293              notificationSpec.sourceName = (String) pm.getApplicationLabel(ai);                                    </span>



<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294          }                                                                                                         </span>
<span  style=""> 295                                                                                                                    </span>
<span class="-7581221946487094265" onmouseenter="enter('-7581221946487094265');" onmouseout="out('-7581221946487094265');" style=""> 296          boolean preferBigText = false;                                                                            </span>
<span  style=""> 297                                                                                                                    </span>
<span class="-1916386255928229930" onmouseenter="enter('-1916386255928229930');" onmouseout="out('-1916386255928229930');" style=""><abbr title=" 298          // Get the app ID that generated this notification. For now only used by pebble color, but may be more useful later."> 298          // Get the app ID that generated this notification. For now only used by pebble color, but may be more useðŸ”µ</abbr></span>
<span class="-8067455375416267049" onmouseenter="enter('-8067455375416267049');" onmouseout="out('-8067455375416267049');" style=""> 299          notificationSpec.sourceAppId = source;                                                                    </span>
<span  style=""> 300                                                                                                                    </span>
<span class="-2810132766447661631" onmouseenter="enter('-2810132766447661631');" onmouseout="out('-2810132766447661631');" style=""> 301          notificationSpec.type = AppNotificationType.getInstance().get(source);                                    </span>
<span  style=""> 302                                                                                                                    </span>
<span class="-7540601865424540593" onmouseenter="enter('-7540601865424540593');" onmouseout="out('-7540601865424540593');" style=""> 303          //FIXME: some quirks lookup table would be the minor evil here                                            </span>
<span class="2207563395624266113" onmouseenter="enter('2207563395624266113');" onmouseout="out('2207563395624266113');" style=""> 304          if (source.startsWith(&quot;com.fsck.k9&quot;)) {                                                                   </span>
<span class="-8461204742030134802" onmouseenter="enter('-8461204742030134802');" onmouseout="out('-8461204742030134802');" style=""> 305              if (NotificationCompat.isGroupSummary(notification)) {                                                </span>
<span class="3811797734502814406" onmouseenter="enter('3811797734502814406');" onmouseout="out('3811797734502814406');" style=""> 306                  LOG.info(&quot;ignore K9 group summary&quot;);                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 307                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308              }                                                                                                     </span>
<span class="5839263120304468869" onmouseenter="enter('5839263120304468869');" onmouseout="out('5839263120304468869');" style=""> 309              preferBigText = true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 310          }                                                                                                         </span>
<span  style=""> 311                                                                                                                    </span>
<span class="4253328762370341177" onmouseenter="enter('4253328762370341177');" onmouseout="out('4253328762370341177');" style=""> 312          if (notificationSpec.type == null) {                                                                      </span>
<span class="954876523018596305" onmouseenter="enter('954876523018596305');" onmouseout="out('954876523018596305');" style=""> 313              notificationSpec.type = NotificationType.UNKNOWN;                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 314          }                                                                                                         </span>
<span  style=""> 315                                                                                                                    </span>
<span class="8812080595679134351" onmouseenter="enter('8812080595679134351');" onmouseout="out('8812080595679134351');" style=""> 316          // Get color                                                                                              </span>
<span class="-7215379846374020112" onmouseenter="enter('-7215379846374020112');" onmouseout="out('-7215379846374020112');" style=""> 317          notificationSpec.pebbleColor = getPebbleColorForNotification(notificationSpec);                           </span>
<span  style=""> 318                                                                                                                    </span>
<span class="-2694685924632068401" onmouseenter="enter('-2694685924632068401');" onmouseout="out('-2694685924632068401');" style=""><abbr title=" 319          LOG.info(&quot;Processing notification &quot; + notificationSpec.getId() + &quot; age: &quot; + (System.currentTimeMillis() - notification.when) + &quot; from source &quot; + source + &quot; with flags: &quot; + notification.flags);"> 319          LOG.info(&quot;Processing notification &quot; + notificationSpec.getId() + &quot; age: &quot; + (System.currentTimeMillis() - ðŸ”µ</abbr></span>
<span  style=""> 320                                                                                                                    </span>
<span class="-5865600179971875271" onmouseenter="enter('-5865600179971875271');" onmouseout="out('-5865600179971875271');" style=""> 321          dissectNotificationTo(notification, notificationSpec, preferBigText);                                     </span>
<span  style=""> 322                                                                                                                    </span>
<span class="3953264596152234401" onmouseenter="enter('3953264596152234401');" onmouseout="out('3953264596152234401');" style=""><abbr title=" 323          if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificationSpec.body)) {"> 323          if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificationSpec.bodðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 324              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325          }                                                                                                         </span>
<span  style=""> 326                                                                                                                    </span>
<span  style=""> 327                                                                                                                    </span>
<span class="668617636634990568" onmouseenter="enter('668617636634990568');" onmouseout="out('668617636634990568');" style=""> 328          // ignore Gadgetbridge&#x27;s very own notifications, except for those from the debug screen                   </span>
<span class="8240704894033078509" onmouseenter="enter('8240704894033078509');" onmouseout="out('8240704894033078509');" style=""> 329          if (getApplicationContext().getPackageName().equals(source)) {                                            </span>
<span class="-4005163798104538430" onmouseenter="enter('-4005163798104538430');" onmouseout="out('-4005163798104538430');" style=""> 330              if (!getApplicationContext().getString(R.string.test_notification).equals(notificationSpec.title)) {  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 331                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 333          }                                                                                                         </span>
<span  style=""> 334                                                                                                                    </span>
<span class="3032759621835437424" onmouseenter="enter('3032759621835437424');" onmouseout="out('3032759621835437424');" style=""><abbr title=" 335          NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(notification);"> 335          NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(notificatioðŸ”µ</abbr></span>
<span class="-1472750016987720650" onmouseenter="enter('-1472750016987720650');" onmouseout="out('-1472750016987720650');" style=""> 336          List&lt;NotificationCompat.Action&gt; actions = wearableExtender.getActions();                                  </span>
<span  style=""> 337                                                                                                                    </span>
<span  style=""> 338                                                                                                                    </span>
<span class="7774033817539746019" onmouseenter="enter('7774033817539746019');" onmouseout="out('7774033817539746019');" style=""><abbr title=" 339          if (actions.size() == 0 &amp;&amp; NotificationCompat.isGroupSummary(notification)) { //this could cause #395 to come back"> 339          if (actions.size() == 0 &amp;&amp; NotificationCompat.isGroupSummary(notification)) { //this could cause #395 to cðŸ”µ</abbr></span>
<span class="-2600295662498564908" onmouseenter="enter('-2600295662498564908');" onmouseout="out('-2600295662498564908');" style=""><abbr title=" 340              LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action present. Notification flags: &quot; + notification.flags);"> 340              LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action present. NotifðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 341              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342          }                                                                                                         </span>
<span  style=""> 343                                                                                                                    </span>
<span class="-5917197971696016550" onmouseenter="enter('-5917197971696016550');" onmouseout="out('-5917197971696016550');" style=""> 344          notificationSpec.attachedActions = new ArrayList&lt;&gt;();                                                     </span>
<span  style=""> 345                                                                                                                    </span>
<span class="6824678123821134026" onmouseenter="enter('6824678123821134026');" onmouseout="out('6824678123821134026');" style=""> 346          // DISMISS action                                                                                         </span>
<span class="5533936039133318070" onmouseenter="enter('5533936039133318070');" onmouseout="out('5533936039133318070');" style=""> 347          NotificationSpec.Action dismissAction = new NotificationSpec.Action();                                    </span>
<span class="-2035191731043357921" onmouseenter="enter('-2035191731043357921');" onmouseout="out('-2035191731043357921');" style=""> 348          dismissAction.title = &quot;Dismiss&quot;;                                                                          </span>
<span class="5737664600017371521" onmouseenter="enter('5737664600017371521');" onmouseout="out('5737664600017371521');" style=""> 349          dismissAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_DISMISS;                                      </span>
<span class="-4673031657134511356" onmouseenter="enter('-4673031657134511356');" onmouseout="out('-4673031657134511356');" style=""> 350          notificationSpec.attachedActions.add(dismissAction);                                                      </span>
<span  style=""> 351                                                                                                                    </span>
<span class="-8264806993566587236" onmouseenter="enter('-8264806993566587236');" onmouseout="out('-8264806993566587236');" style=""> 352          for (NotificationCompat.Action act : actions) {                                                           </span>
<span class="-5026732361501841882" onmouseenter="enter('-5026732361501841882');" onmouseout="out('-5026732361501841882');" style=""> 353              if (act != null) {                                                                                    </span>
<span class="-5786483650500220153" onmouseenter="enter('-5786483650500220153');" onmouseout="out('-5786483650500220153');" style=""> 354                  NotificationSpec.Action wearableAction = new NotificationSpec.Action();                           </span>
<span class="911429091199110596" onmouseenter="enter('911429091199110596');" onmouseout="out('911429091199110596');" style=""> 355                  wearableAction.title = act.getTitle().toString();                                                 </span>
<span class="5243119547087092802" onmouseenter="enter('5243119547087092802');" onmouseout="out('5243119547087092802');" style=""> 356                  if(act.getRemoteInputs()!=null) {                                                                 </span>
<span class="3631843705460318974" onmouseenter="enter('3631843705460318974');" onmouseout="out('3631843705460318974');" style=""> 357                      wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_REPLY;                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 358                  } else {                                                                                          </span>
<span class="5019071376909091625" onmouseenter="enter('5019071376909091625');" onmouseout="out('5019071376909091625');" style=""> 359                      wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_SIMPLE;                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 360                  }                                                                                                 </span>
<span  style=""> 361                                                                                                                    </span>
<span class="3300319972847919808" onmouseenter="enter('3300319972847919808');" onmouseout="out('3300319972847919808');" style=""> 362                  notificationSpec.attachedActions.add(wearableAction);                                             </span>
<span class="-7038376970573634272" onmouseenter="enter('-7038376970573634272');" onmouseout="out('-7038376970573634272');" style=""> 363                  mActionLookup.add((notificationSpec.getId()&lt;&lt;4) + notificationSpec.attachedActions.size(), act);  </span>
<span class="1537265167944677779" onmouseenter="enter('1537265167944677779');" onmouseout="out('1537265167944677779');" style=""><abbr title=" 364                  LOG.info(&quot;found wearable action: &quot; + notificationSpec.attachedActions.size() + &quot; - &quot;+ act.getTitle() + &quot;  &quot; + sbn.getTag());"> 364                  LOG.info(&quot;found wearable action: &quot; + notificationSpec.attachedActions.size() + &quot; - &quot;+ act.getTitleðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 365              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366          }                                                                                                         </span>
<span  style=""> 367                                                                                                                    </span>
<span class="7347352498327901971" onmouseenter="enter('7347352498327901971');" onmouseout="out('7347352498327901971');" style=""> 368          // OPEN action                                                                                            </span>
<span class="6797092604605164688" onmouseenter="enter('6797092604605164688');" onmouseout="out('6797092604605164688');" style=""> 369          NotificationSpec.Action openAction = new NotificationSpec.Action();                                       </span>
<span class="8898599446651645486" onmouseenter="enter('8898599446651645486');" onmouseout="out('8898599446651645486');" style=""> 370          openAction.title = getString(R.string._pebble_watch_open_on_phone);                                       </span>
<span class="620332764476499952" onmouseenter="enter('620332764476499952');" onmouseout="out('620332764476499952');" style=""> 371          openAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_OPEN;                                            </span>
<span class="-654055199082716612" onmouseenter="enter('-654055199082716612');" onmouseout="out('-654055199082716612');" style=""> 372          notificationSpec.attachedActions.add(openAction);                                                         </span>
<span  style=""> 373                                                                                                                    </span>
<span class="2264132042552456605" onmouseenter="enter('2264132042552456605');" onmouseout="out('2264132042552456605');" style=""> 374          // MUTE action                                                                                            </span>
<span class="-8712525482035557123" onmouseenter="enter('-8712525482035557123');" onmouseout="out('-8712525482035557123');" style=""> 375          NotificationSpec.Action muteAction = new NotificationSpec.Action();                                       </span>
<span class="-8110587689026159862" onmouseenter="enter('-8110587689026159862');" onmouseout="out('-8110587689026159862');" style=""> 376          muteAction.title = getString(R.string._pebble_watch_mute);                                                </span>
<span class="6211637458858479364" onmouseenter="enter('6211637458858479364');" onmouseout="out('6211637458858479364');" style=""> 377          muteAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_MUTE;                                            </span>
<span class="1775691680583302265" onmouseenter="enter('1775691680583302265');" onmouseout="out('1775691680583302265');" style=""> 378          notificationSpec.attachedActions.add(muteAction);                                                         </span>
<span  style=""> 379                                                                                                                    </span>
<span class="-476558653827405923" onmouseenter="enter('-476558653827405923');" onmouseout="out('-476558653827405923');" style=""> 380          mNotificationHandleLookup.add(notificationSpec.getId(), sbn.getPostTime()); // for both DISMISS and OPEN  </span>
<span class="8153579199557574199" onmouseenter="enter('8153579199557574199');" onmouseout="out('8153579199557574199');" style=""> 381          mPackageLookup.add(notificationSpec.getId(), sbn.getPackageName()); // for MUTE                           </span>
<span  style=""> 382                                                                                                                    </span>
<span class="5979670797208442666" onmouseenter="enter('5979670797208442666');" onmouseout="out('5979670797208442666');" style=""> 383          notificationBurstPrevention.put(source, cur_time);                                                        </span>
<span class="-7718619408843379706" onmouseenter="enter('-7718619408843379706');" onmouseout="out('-7718619408843379706');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 384 -        notificationOldRepeatPrevention.put(source, notification.when);                                           </span>
<span class="5546492408732750715" onmouseenter="enter('5546492408732750715');" onmouseout="out('5546492408732750715');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 385 +        if(0 != notification.when) {                                                                              </span>
<span class="-7718619408843379706" onmouseenter="enter('-7718619408843379706');" onmouseout="out('-7718619408843379706');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 386 +            notificationOldRepeatPrevention.put(source, notification.when);                                       </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 387 +        }else {                                                                                                   </span>
<span class="-1627147369441390095" onmouseenter="enter('-1627147369441390095');" onmouseout="out('-1627147369441390095');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 388 +            LOG.info(&quot;This app might show old/duplicate notifications. notification.when is 0 for &quot; + source);    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 389 +        }                                                                                                         </span>
<span  style=""> 390                                                                                                                    </span>
<span class="9189856510229218442" onmouseenter="enter('9189856510229218442');" onmouseout="out('9189856510229218442');" style=""> 391          GBApplication.deviceService().onNotification(notificationSpec);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392      }                                                                                                             </span>
<span  style=""> 393                                                                                                                    </span>
<span class="3489513600177556550" onmouseenter="enter('3489513600177556550');" onmouseout="out('3489513600177556550');" style=""> 394      private boolean checkNotificationContentForWhiteAndBlackList(String packageName, String body) {               </span>
<span class="-150679469252815152" onmouseenter="enter('-150679469252815152');" onmouseout="out('-150679469252815152');" style=""> 395          long start = System.currentTimeMillis();                                                                  </span>
<span  style=""> 396                                                                                                                    </span>
<span class="2124734257009739137" onmouseenter="enter('2124734257009739137');" onmouseout="out('2124734257009739137');" style=""> 397          List&lt;String&gt; wordsList = new ArrayList&lt;&gt;();                                                               </span>
<span class="8513213831196998490" onmouseenter="enter('8513213831196998490');" onmouseout="out('8513213831196998490');" style=""> 398          NotificationFilter notificationFilter;                                                                    </span>
<span  style=""> 399                                                                                                                    </span>
<span class="-4590804423150229551" onmouseenter="enter('-4590804423150229551');" onmouseout="out('-4590804423150229551');" style=""> 400          try (DBHandler db = GBApplication.acquireDB()) {                                                          </span>
<span  style=""> 401                                                                                                                    </span>
<span class="2403890883362572333" onmouseenter="enter('2403890883362572333');" onmouseout="out('2403890883362572333');" style=""> 402              NotificationFilterDao notificationFilterDao = db.getDaoSession().getNotificationFilterDao();          </span>
<span class="7254238877040119420" onmouseenter="enter('7254238877040119420');" onmouseout="out('7254238877040119420');" style=""><abbr title=" 403              NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilterEntryDao();"> 403              NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilterEntryDðŸ”µ</abbr></span>
<span  style=""> 404                                                                                                                    </span>
<span class="-4728567184917764691" onmouseenter="enter('-4728567184917764691');" onmouseout="out('-4728567184917764691');" style=""><abbr title=" 405              Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFilterDao.Properties.AppIdentifier.eq(packageName.toLowerCase())).build();"> 405              Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFilterDao.ProðŸ”µ</abbr></span>
<span class="7488324375938324162" onmouseenter="enter('7488324375938324162');" onmouseout="out('7488324375938324162');" style=""> 406              notificationFilter = query.unique();                                                                  </span>
<span  style=""> 407                                                                                                                    </span>
<span class="6018560877068628254" onmouseenter="enter('6018560877068628254');" onmouseout="out('6018560877068628254');" style=""> 408              if (notificationFilter == null) {                                                                     </span>
<span class="8510731869572739415" onmouseenter="enter('8510731869572739415');" onmouseout="out('8510731869572739415');" style=""> 409                  LOG.debug(&quot;No Notification Filter found&quot;);                                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 410                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 411              }                                                                                                     </span>
<span  style=""> 412                                                                                                                    </span>
<span class="3968012753441467210" onmouseenter="enter('3968012753441467210');" onmouseout="out('3968012753441467210');" style=""> 413              LOG.debug(&quot;Loaded notification filter for &#x27;{}&#x27;&quot;, packageName);                                        </span>
<span class="7966618056150210259" onmouseenter="enter('7966618056150210259');" onmouseout="out('7966618056150210259');" style=""><abbr title=" 414              Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().where(NotificationFilterEntryDao.Properties.NotificationFilterId.eq(notificationFilter.getId())).build();"> 414              Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().where(NotificaðŸ”µ</abbr></span>
<span  style=""> 415                                                                                                                    </span>
<span class="5592374987839394879" onmouseenter="enter('5592374987839394879');" onmouseout="out('5592374987839394879');" style=""> 416              List&lt;NotificationFilterEntry&gt; filterEntries = queryEntries.list();                                    </span>
<span  style=""> 417                                                                                                                    </span>
<span class="-8976969426120877151" onmouseenter="enter('-8976969426120877151');" onmouseout="out('-8976969426120877151');" style=""> 418              if (BuildConfig.DEBUG) {                                                                              </span>
<span class="-9170185973081630678" onmouseenter="enter('-9170185973081630678');" onmouseout="out('-9170185973081630678');" style=""> 419                  LOG.info(&quot;Database lookup took &#x27;{}&#x27; ms&quot;, System.currentTimeMillis() - start);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420              }                                                                                                     </span>
<span  style=""> 421                                                                                                                    </span>
<span class="2077893056906600600" onmouseenter="enter('2077893056906600600');" onmouseout="out('2077893056906600600');" style=""> 422              if (!filterEntries.isEmpty()) {                                                                       </span>
<span class="4304008491784528731" onmouseenter="enter('4304008491784528731');" onmouseout="out('4304008491784528731');" style=""> 423                  for (NotificationFilterEntry temp : filterEntries) {                                              </span>
<span class="4808262139369052558" onmouseenter="enter('4808262139369052558');" onmouseout="out('4808262139369052558');" style=""> 424                      wordsList.add(temp.getNotificationFilterContent());                                           </span>
<span class="-2502897764394929378" onmouseenter="enter('-2502897764394929378');" onmouseout="out('-2502897764394929378');" style=""> 425                      LOG.debug(&quot;Loaded filter word: &quot; + temp.getNotificationFilterContent());                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 426                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 427              }                                                                                                     </span>
<span  style=""> 428                                                                                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 429          } catch (Exception e) {                                                                                   </span>
<span class="-7390176680812789235" onmouseenter="enter('-7390176680812789235');" onmouseout="out('-7390176680812789235');" style=""> 430              LOG.error(&quot;Could not acquire DB.&quot;, e);                                                                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 431              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 432          }                                                                                                         </span>
<span  style=""> 433                                                                                                                    </span>
<span class="-2837061757343239904" onmouseenter="enter('-2837061757343239904');" onmouseout="out('-2837061757343239904');" style=""> 434          return shouldContinueAfterFilter(body, wordsList, notificationFilter);                                    </span>






































<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 435      }                                                                                                             </span>
<span  style=""> 436                                                                                                                    </span>
<span class="2011726315289648221" onmouseenter="enter('2011726315289648221');" onmouseout="out('2011726315289648221');" style=""><abbr title=" 437      boolean shouldContinueAfterFilter(@NonNull String body, @NonNull List&lt;String&gt; wordsList, @NonNull NotificationFilter notificationFilter) {"> 437      boolean shouldContinueAfterFilter(@NonNull String body, @NonNull List&lt;String&gt; wordsList, @NonNull NotificationðŸ”µ</abbr></span>
<span  style=""> 438                                                                                                                    </span>
<span class="-2049928826508332953" onmouseenter="enter('-2049928826508332953');" onmouseout="out('-2049928826508332953');" style=""><abbr title=" 439          LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterMode(), notificationFilter.getNotificationFilterSubMode(), wordsList);"> 439          LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterMode(), notiðŸ”µ</abbr></span>
<span  style=""> 440                                                                                                                    </span>
<span class="2466831550918903346" onmouseenter="enter('2466831550918903346');" onmouseout="out('2466831550918903346');" style=""> 441          boolean allMode = notificationFilter.getNotificationFilterSubMode() == NOTIFICATION_FILTER_SUBMODE_ALL;   </span>
<span  style=""> 442                                                                                                                    </span>
<span class="7111790076547269568" onmouseenter="enter('7111790076547269568');" onmouseout="out('7111790076547269568');" style=""> 443          switch (notificationFilter.getNotificationFilterMode()) {                                                 </span>
<span class="9010216302027839769" onmouseenter="enter('9010216302027839769');" onmouseout="out('9010216302027839769');" style=""> 444              case NOTIFICATION_FILTER_MODE_BLACKLIST:                                                              </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 445                  if (allMode) {                                                                                    </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 446                      for (String word : wordsList) {                                                               </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 447                          if (!body.contains(word)) {                                                               </span>
<span class="-6541716343086786985" onmouseenter="enter('-6541716343086786985');" onmouseout="out('-6541716343086786985');" style=""> 448                              LOG.info(&quot;Not every word was found, blacklist has no effect, processing continues.&quot;); </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 449                              return true;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 450                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451                      }                                                                                             </span>
<span class="7128342962819519611" onmouseenter="enter('7128342962819519611');" onmouseout="out('7128342962819519611');" style=""> 452                      LOG.info(&quot;Every word was found, blacklist has effect, processing stops.&quot;);                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 453                      return false;                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 454                  } else {                                                                                          </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""> 455                      boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));  </span>
<span class="-6184990871390026912" onmouseenter="enter('-6184990871390026912');" onmouseout="out('-6184990871390026912');" style=""> 456                      if (!containsAny) {                                                                           </span>
<span class="-8299034583350120850" onmouseenter="enter('-8299034583350120850');" onmouseout="out('-8299034583350120850');" style=""> 457                          LOG.info(&quot;No matching word was found, blacklist has no effect, processing continues.&quot;);   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 458                      } else {                                                                                      </span>
<span class="-1380690990253575343" onmouseenter="enter('-1380690990253575343');" onmouseout="out('-1380690990253575343');" style=""> 459                          LOG.info(&quot;At least one matching word was found, blacklist has effect, processing stops.&quot;);</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 460                      }                                                                                             </span>
<span class="3895372753413352625" onmouseenter="enter('3895372753413352625');" onmouseout="out('3895372753413352625');" style=""> 461                      return !containsAny;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 462                  }                                                                                                 </span>
<span  style=""> 463                                                                                                                    </span>
<span class="-7619441502433256183" onmouseenter="enter('-7619441502433256183');" onmouseout="out('-7619441502433256183');" style=""> 464              case NOTIFICATION_FILTER_MODE_WHITELIST:                                                              </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 465                  if (allMode) {                                                                                    </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 466                      for (String word : wordsList) {                                                               </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 467                          if (!body.contains(word)) {                                                               </span>
<span class="-2193044683137963048" onmouseenter="enter('-2193044683137963048');" onmouseout="out('-2193044683137963048');" style=""> 468                              LOG.info(&quot;Not every word was found, whitelist has no effect, processing stops.&quot;);     </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 469                              return false;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 471                      }                                                                                             </span>
<span class="7060257086642023362" onmouseenter="enter('7060257086642023362');" onmouseout="out('7060257086642023362');" style=""> 472                      LOG.info(&quot;Every word was found, whitelist has effect, processing continues.&quot;);                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 473                      return true;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 474                  } else {                                                                                          </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""> 475                      boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));  </span>
<span class="-340597820517180781" onmouseenter="enter('-340597820517180781');" onmouseout="out('-340597820517180781');" style=""> 476                      if (containsAny) {                                                                            </span>
<span class="-1881072703439588003" onmouseenter="enter('-1881072703439588003');" onmouseout="out('-1881072703439588003');" style=""><abbr title=" 477                          LOG.info(&quot;At least one matching word was found, whitelist has effect, processing continues.&quot;);"> 477                          LOG.info(&quot;At least one matching word was found, whitelist has effect, processing continuesðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 478                      } else {                                                                                      </span>
<span class="2098487797015691396" onmouseenter="enter('2098487797015691396');" onmouseout="out('2098487797015691396');" style=""> 479                          LOG.info(&quot;No matching word was found, whitelist has no effect, processing stops.&quot;);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 480                      }                                                                                             </span>
<span class="1941886136813063182" onmouseenter="enter('1941886136813063182');" onmouseout="out('1941886136813063182');" style=""> 481                      return containsAny;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 482                  }                                                                                                 </span>
<span  style=""> 483                                                                                                                    </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 484              default:                                                                                              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 485                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 486          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 487      }                                                                                                             </span>
<span  style=""> 488                                                                                                                    </span>
<span class="-522333448184701526" onmouseenter="enter('-522333448184701526');" onmouseout="out('-522333448184701526');" style=""> 489      // Strip Unicode control sequences: some apps like Telegram add a lot of them for unknown reasons             </span>
<span class="-8731468808345203749" onmouseenter="enter('-8731468808345203749');" onmouseout="out('-8731468808345203749');" style=""> 490      private String sanitizeUnicode(String orig) {                                                                 </span>
<span class="3980018359364350746" onmouseenter="enter('3980018359364350746');" onmouseout="out('3980018359364350746');" style=""> 491          return orig.replaceAll(&quot;\\p{C}&quot;, &quot;&quot;);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492      }                                                                                                             </span>
<span  style=""> 493                                                                                                                    </span>
<span class="-9171831878462980109" onmouseenter="enter('-9171831878462980109');" onmouseout="out('-9171831878462980109');" style=""> 494      private void dissectNotificationTo(Notification notification, NotificationSpec notificationSpec,              </span>
<span class="2688021293853549872" onmouseenter="enter('2688021293853549872');" onmouseout="out('2688021293853549872');" style=""> 495                                         boolean preferBigText) {                                                   </span>
<span  style=""> 496                                                                                                                    </span>
<span class="-4856559942663327722" onmouseenter="enter('-4856559942663327722');" onmouseout="out('-4856559942663327722');" style=""> 497          Bundle extras = NotificationCompat.getExtras(notification);                                               </span>
<span  style=""> 498                                                                                                                    </span>
<span class="1218249610901206964" onmouseenter="enter('1218249610901206964');" onmouseout="out('1218249610901206964');" style=""> 499          //dumpExtras(extras);                                                                                     </span>
<span  style=""> 500                                                                                                                    </span>
<span class="-6997230475683564369" onmouseenter="enter('-6997230475683564369');" onmouseout="out('-6997230475683564369');" style=""> 501          CharSequence title = extras.getCharSequence(Notification.EXTRA_TITLE);                                    </span>
<span class="-5768442231641885516" onmouseenter="enter('-5768442231641885516');" onmouseout="out('-5768442231641885516');" style=""> 502          if (title != null) {                                                                                      </span>
<span class="3486456028705164748" onmouseenter="enter('3486456028705164748');" onmouseout="out('3486456028705164748');" style=""> 503              notificationSpec.title = sanitizeUnicode(title.toString());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 504          }                                                                                                         </span>
<span  style=""> 505                                                                                                                    </span>
<span class="-1675348653102168964" onmouseenter="enter('-1675348653102168964');" onmouseout="out('-1675348653102168964');" style=""> 506          CharSequence contentCS = null;                                                                            </span>
<span class="7665214774958344559" onmouseenter="enter('7665214774958344559');" onmouseout="out('7665214774958344559');" style=""> 507          if (preferBigText &amp;&amp; extras.containsKey(Notification.EXTRA_BIG_TEXT)) {                                   </span>
<span class="3933802215223175306" onmouseenter="enter('3933802215223175306');" onmouseout="out('3933802215223175306');" style=""> 508              contentCS = extras.getCharSequence(NotificationCompat.EXTRA_BIG_TEXT);                                </span>
<span class="8631000860903630717" onmouseenter="enter('8631000860903630717');" onmouseout="out('8631000860903630717');" style=""> 509          } else if (extras.containsKey(Notification.EXTRA_TEXT)) {                                                 </span>
<span class="-7547654609103611854" onmouseenter="enter('-7547654609103611854');" onmouseout="out('-7547654609103611854');" style=""> 510              contentCS = extras.getCharSequence(NotificationCompat.EXTRA_TEXT);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 511          }                                                                                                         </span>
<span class="-2707602363986640259" onmouseenter="enter('-2707602363986640259');" onmouseout="out('-2707602363986640259');" style=""> 512          if (contentCS != null) {                                                                                  </span>
<span class="-5564526501110527191" onmouseenter="enter('-5564526501110527191');" onmouseout="out('-5564526501110527191');" style=""> 513              notificationSpec.body = sanitizeUnicode(contentCS.toString());                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 514          }                                                                                                         </span>
<span  style=""> 515                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 516      }                                                                                                             </span>
<span  style=""> 517                                                                                                                    </span>
<span class="-7937366375312895792" onmouseenter="enter('-7937366375312895792');" onmouseout="out('-7937366375312895792');" style=""> 518      private boolean isServiceRunning() {                                                                          </span>
<span class="-8788124079324077188" onmouseenter="enter('-8788124079324077188');" onmouseout="out('-8788124079324077188');" style=""> 519          ActivityManager manager = (ActivityManager) getSystemService(ACTIVITY_SERVICE);                           </span>
<span class="5841398637891737551" onmouseenter="enter('5841398637891737551');" onmouseout="out('5841398637891737551');" style=""> 520          if (manager == null) {                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 521              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 522          }                                                                                                         </span>
<span class="-1060000448595061247" onmouseenter="enter('-1060000448595061247');" onmouseout="out('-1060000448595061247');" style=""> 523          for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) {        </span>
<span class="1715383852667790939" onmouseenter="enter('1715383852667790939');" onmouseout="out('1715383852667790939');" style=""> 524              if (DeviceCommunicationService.class.getName().equals(service.service.getClassName())) {              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 525                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 526              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 527          }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 528          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 529      }                                                                                                             </span>
<span  style=""> 530                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 531      /**                                                                                                           </span>
<span class="-3386513456391723953" onmouseenter="enter('-3386513456391723953');" onmouseout="out('-3386513456391723953');" style=""> 532       * Try to handle media session notifications that tell info about the current play state.                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 533       *                                                                                                            </span>
<span class="-2019490562393536710" onmouseenter="enter('-2019490562393536710');" onmouseout="out('-2019490562393536710');" style=""> 534       * @param mediaSession The mediasession to handle.                                                            </span>
<span class="1642728463279900605" onmouseenter="enter('1642728463279900605');" onmouseout="out('1642728463279900605');" style=""> 535       * @return true if notification was handled, false otherwise                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 536       */                                                                                                           </span>
<span class="1254895864500637019" onmouseenter="enter('1254895864500637019');" onmouseout="out('1254895864500637019');" style=""> 537      public boolean handleMediaSessionNotification(MediaSessionCompat.Token mediaSession) {                        </span>
<span class="-4606570715029334060" onmouseenter="enter('-4606570715029334060');" onmouseout="out('-4606570715029334060');" style=""> 538          MusicSpec musicSpec = new MusicSpec();                                                                    </span>
<span class="6191411421956413825" onmouseenter="enter('6191411421956413825');" onmouseout="out('6191411421956413825');" style=""> 539          MusicStateSpec stateSpec = new MusicStateSpec();                                                          </span>
<span  style=""> 540                                                                                                                    </span>
<span class="-6296053285913663629" onmouseenter="enter('-6296053285913663629');" onmouseout="out('-6296053285913663629');" style=""> 541          MediaControllerCompat c;                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 542          try {                                                                                                     </span>
<span class="7437011440923722104" onmouseenter="enter('7437011440923722104');" onmouseout="out('7437011440923722104');" style=""> 543              c = new MediaControllerCompat(getApplicationContext(), mediaSession);                                 </span>
<span  style=""> 544                                                                                                                    </span>
<span class="-1916914550610898815" onmouseenter="enter('-1916914550610898815');" onmouseout="out('-1916914550610898815');" style=""> 545              PlaybackStateCompat s = c.getPlaybackState();                                                         </span>
<span class="-2990817606835558686" onmouseenter="enter('-2990817606835558686');" onmouseout="out('-2990817606835558686');" style=""> 546              stateSpec.position = (int) (s.getPosition() / 1000);                                                  </span>
<span class="5328288853423061088" onmouseenter="enter('5328288853423061088');" onmouseout="out('5328288853423061088');" style=""> 547              stateSpec.playRate = Math.round(100 * s.getPlaybackSpeed());                                          </span>
<span class="2323238932425227387" onmouseenter="enter('2323238932425227387');" onmouseout="out('2323238932425227387');" style=""> 548              stateSpec.repeat = 1;                                                                                 </span>
<span class="-2798957985679932557" onmouseenter="enter('-2798957985679932557');" onmouseout="out('-2798957985679932557');" style=""> 549              stateSpec.shuffle = 1;                                                                                </span>
<span class="1453024666101612078" onmouseenter="enter('1453024666101612078');" onmouseout="out('1453024666101612078');" style=""> 550              switch (s.getState()) {                                                                               </span>
<span class="-7604550062433163488" onmouseenter="enter('-7604550062433163488');" onmouseout="out('-7604550062433163488');" style=""> 551                  case PlaybackState.STATE_PLAYING:                                                                 </span>
<span class="-5997751080810805230" onmouseenter="enter('-5997751080810805230');" onmouseout="out('-5997751080810805230');" style=""> 552                      stateSpec.state = MusicStateSpec.STATE_PLAYING;                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 553                      break;                                                                                        </span>
<span class="4895305209877093306" onmouseenter="enter('4895305209877093306');" onmouseout="out('4895305209877093306');" style=""> 554                  case PlaybackState.STATE_STOPPED:                                                                 </span>
<span class="7340128138398857774" onmouseenter="enter('7340128138398857774');" onmouseout="out('7340128138398857774');" style=""> 555                      stateSpec.state = MusicStateSpec.STATE_STOPPED;                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 556                      break;                                                                                        </span>
<span class="-7061407832272958754" onmouseenter="enter('-7061407832272958754');" onmouseout="out('-7061407832272958754');" style=""> 557                  case PlaybackState.STATE_PAUSED:                                                                  </span>
<span class="928317678007732085" onmouseenter="enter('928317678007732085');" onmouseout="out('928317678007732085');" style=""> 558                      stateSpec.state = MusicStateSpec.STATE_PAUSED;                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 559                      break;                                                                                        </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 560                  default:                                                                                          </span>
<span class="1494209818965165815" onmouseenter="enter('1494209818965165815');" onmouseout="out('1494209818965165815');" style=""> 561                      stateSpec.state = MusicStateSpec.STATE_UNKNOWN;                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 562                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 563              }                                                                                                     </span>
<span  style=""> 564                                                                                                                    </span>
<span class="-1378394649293702376" onmouseenter="enter('-1378394649293702376');" onmouseout="out('-1378394649293702376');" style=""> 565              MediaMetadataCompat d = c.getMetadata();                                                              </span>
<span class="1381395247865936457" onmouseenter="enter('1381395247865936457');" onmouseout="out('1381395247865936457');" style=""> 566              if (d == null)                                                                                        </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 567                  return false;                                                                                     </span>
<span class="7299474512588472960" onmouseenter="enter('7299474512588472960');" onmouseout="out('7299474512588472960');" style=""> 568              if (d.containsKey(MediaMetadata.METADATA_KEY_ARTIST))                                                 </span>
<span class="-145858411899069051" onmouseenter="enter('-145858411899069051');" onmouseout="out('-145858411899069051');" style=""> 569                  musicSpec.artist = d.getString(MediaMetadataCompat.METADATA_KEY_ARTIST);                          </span>
<span class="563580125723474981" onmouseenter="enter('563580125723474981');" onmouseout="out('563580125723474981');" style=""> 570              if (d.containsKey(MediaMetadata.METADATA_KEY_ALBUM))                                                  </span>
<span class="1803038863600841979" onmouseenter="enter('1803038863600841979');" onmouseout="out('1803038863600841979');" style=""> 571                  musicSpec.album = d.getString(MediaMetadataCompat.METADATA_KEY_ALBUM);                            </span>
<span class="-1766324950453780005" onmouseenter="enter('-1766324950453780005');" onmouseout="out('-1766324950453780005');" style=""> 572              if (d.containsKey(MediaMetadata.METADATA_KEY_TITLE))                                                  </span>
<span class="-6541941403865600636" onmouseenter="enter('-6541941403865600636');" onmouseout="out('-6541941403865600636');" style=""> 573                  musicSpec.track = d.getString(MediaMetadataCompat.METADATA_KEY_TITLE);                            </span>
<span class="-690335942087370936" onmouseenter="enter('-690335942087370936');" onmouseout="out('-690335942087370936');" style=""> 574              if (d.containsKey(MediaMetadata.METADATA_KEY_DURATION))                                               </span>
<span class="-139118447155224577" onmouseenter="enter('-139118447155224577');" onmouseout="out('-139118447155224577');" style=""> 575                  musicSpec.duration = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_DURATION) / 1000;           </span>
<span class="6028497768136929228" onmouseenter="enter('6028497768136929228');" onmouseout="out('6028497768136929228');" style=""> 576              if (d.containsKey(MediaMetadata.METADATA_KEY_NUM_TRACKS))                                             </span>
<span class="6703481613150545995" onmouseenter="enter('6703481613150545995');" onmouseout="out('6703481613150545995');" style=""> 577                  musicSpec.trackCount = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_NUM_TRACKS);              </span>
<span class="3843094866204545202" onmouseenter="enter('3843094866204545202');" onmouseout="out('3843094866204545202');" style=""> 578              if (d.containsKey(MediaMetadata.METADATA_KEY_TRACK_NUMBER))                                           </span>
<span class="1727735009143440653" onmouseenter="enter('1727735009143440653');" onmouseout="out('1727735009143440653');" style=""> 579                  musicSpec.trackNr = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_TRACK_NUMBER);               </span>
<span  style=""> 580                                                                                                                    </span>
<span class="2207286164059072520" onmouseenter="enter('2207286164059072520');" onmouseout="out('2207286164059072520');" style=""> 581              // finally, tell the device about it                                                                  </span>
<span class="7157573786903835889" onmouseenter="enter('7157573786903835889');" onmouseout="out('7157573786903835889');" style=""> 582              GBApplication.deviceService().onSetMusicInfo(musicSpec);                                              </span>
<span class="-6342881769260875577" onmouseenter="enter('-6342881769260875577');" onmouseout="out('-6342881769260875577');" style=""> 583              GBApplication.deviceService().onSetMusicState(stateSpec);                                             </span>
<span  style=""> 584                                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 585              return true;                                                                                          </span>
<span class="3226201684513186940" onmouseenter="enter('3226201684513186940');" onmouseout="out('3226201684513186940');" style=""> 586          } catch (NullPointerException | RemoteException e) {                                                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 587              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 588          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 589      }                                                                                                             </span>
<span  style=""> 590                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 591      @Override                                                                                                     </span>
<span class="2733031363552103422" onmouseenter="enter('2733031363552103422');" onmouseout="out('2733031363552103422');" style=""> 592      public void onNotificationRemoved(StatusBarNotification sbn) {                                                </span>







<span class="-7767930678383346096" onmouseenter="enter('-7767930678383346096');" onmouseout="out('-7767930678383346096');" style=""> 593          // FIXME: DISABLED for now                                                                                </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 594          /*                                                                                                        </span>
<span class="1980360516715691973" onmouseenter="enter('1980360516715691973');" onmouseout="out('1980360516715691973');" style=""> 595          if (shouldIgnore(sbn))                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 596              return;                                                                                               </span>
<span  style=""> 597                                                                                                                    </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 598          Prefs prefs = GBApplication.getPrefs();                                                                   </span>
<span class="-1523052147845593738" onmouseenter="enter('-1523052147845593738');" onmouseout="out('-1523052147845593738');" style=""> 599          if (prefs.getBoolean(&quot;autoremove_notifications&quot;, false)) {                                                </span>
<span class="-1849447037737481789" onmouseenter="enter('-1849447037737481789');" onmouseout="out('-1849447037737481789');" style=""> 600              LOG.info(&quot;notification removed, will ask device to delete it&quot;);                                       </span>
<span class="-8504489390442611809" onmouseenter="enter('-8504489390442611809');" onmouseout="out('-8504489390442611809');" style=""> 601              GBApplication.deviceService().onDeleteNotification((int) sbn.getPostTime());                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 602          }                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 603          */                                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 604      }                                                                                                             </span>
<span  style=""> 605                                                                                                                    </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 606      /*                                                                                                            </span>

<span class="2967918509730451591" onmouseenter="enter('2967918509730451591');" onmouseout="out('2967918509730451591');" style=""> 607      private void dumpExtras(Bundle bundle) {                                                                      </span>
<span class="-755508411737932855" onmouseenter="enter('-755508411737932855');" onmouseout="out('-755508411737932855');" style=""> 608          for (String key : bundle.keySet()) {                                                                      </span>
<span class="-680967060076152312" onmouseenter="enter('-680967060076152312');" onmouseout="out('-680967060076152312');" style=""> 609              Object value = bundle.get(key);                                                                       </span>
<span class="-5708365098537636921" onmouseenter="enter('-5708365098537636921');" onmouseout="out('-5708365098537636921');" style=""> 610              if (value == null) {                                                                                  </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 611                  continue;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 612              }                                                                                                     </span>
<span class="6935438865287804705" onmouseenter="enter('6935438865287804705');" onmouseout="out('6935438865287804705');" style=""><abbr title=" 613              LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClass().getName()));"> 613              LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClass().getNðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 614          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 615      }                                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 616      */                                                                                                            </span>

<span  style=""> 617                                                                                                                    </span>
<span class="-4145111049531346189" onmouseenter="enter('-4145111049531346189');" onmouseout="out('-4145111049531346189');" style=""> 618      private boolean shouldIgnore(StatusBarNotification sbn) {                                                     </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 619          /*                                                                                                        </span>
<span class="8751388135302008830" onmouseenter="enter('8751388135302008830');" onmouseout="out('8751388135302008830');" style=""> 620          * return early if DeviceCommunicationService is not running,                                              </span>
<span class="2502615223278385984" onmouseenter="enter('2502615223278385984');" onmouseout="out('2502615223278385984');" style=""> 621          * else the service would get started every time we get a notification.                                    </span>
<span class="-5425061837888704430" onmouseenter="enter('-5425061837888704430');" onmouseout="out('-5425061837888704430');" style=""> 622          * unfortunately we cannot enable/disable NotificationListener at runtime like we do with                  </span>
<span class="4838982710001585921" onmouseenter="enter('4838982710001585921');" onmouseout="out('4838982710001585921');" style=""> 623          * broadcast receivers because it seems to invalidate the permissions that are                             </span>
<span class="-2921629841702414230" onmouseenter="enter('-2921629841702414230');" onmouseout="out('-2921629841702414230');" style=""> 624          * necessary for NotificationListenerService                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 625          */                                                                                                        </span>






<span class="-3255765405089884099" onmouseenter="enter('-3255765405089884099');" onmouseout="out('-3255765405089884099');" style=""> 626          if (!isServiceRunning() || sbn == null) {                                                                 </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 627              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 628          }                                                                                                         </span>
<span  style=""> 629                                                                                                                    </span>
<span class="8647073884367840020" onmouseenter="enter('8647073884367840020');" onmouseout="out('8647073884367840020');" style=""> 630          return shouldIgnoreSource(sbn.getPackageName()) || shouldIgnoreNotification(                              </span>
<span class="-1392203204106720793" onmouseenter="enter('-1392203204106720793');" onmouseout="out('-1392203204106720793');" style=""> 631                  sbn.getNotification(), sbn.getPackageName());                                                     </span>
<span  style=""> 632                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 633      }                                                                                                             </span>
<span  style=""> 634                                                                                                                    </span>
<span class="8460515521985572441" onmouseenter="enter('8460515521985572441');" onmouseout="out('8460515521985572441');" style=""> 635      private boolean shouldIgnoreSource(String source) {                                                           </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 636          Prefs prefs = GBApplication.getPrefs();                                                                   </span>
<span  style=""> 637                                                                                                                    </span>
<span class="714714039810027052" onmouseenter="enter('714714039810027052');" onmouseout="out('714714039810027052');" style=""> 638          /* do not display messages from &quot;android&quot;                                                                 </span>
<span class="1893274482542565547" onmouseenter="enter('1893274482542565547');" onmouseout="out('1893274482542565547');" style=""> 639           * This includes keyboard selection message, usb connection messages, etc                                 </span>
<span class="-7750906811397804767" onmouseenter="enter('-7750906811397804767');" onmouseout="out('-7750906811397804767');" style=""> 640           * Hope it does not filter out too much, we will see...                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 641           */                                                                                                       </span>
<span  style=""> 642                                                                                                                    </span>
<span class="1872165376889396003" onmouseenter="enter('1872165376889396003');" onmouseout="out('1872165376889396003');" style=""> 643          if (source.equals(&quot;android&quot;) ||                                                                           </span>
<span class="1446354513639890825" onmouseenter="enter('1446354513639890825');" onmouseout="out('1446354513639890825');" style=""> 644                  source.equals(&quot;com.android.systemui&quot;) ||                                                          </span>
<span class="-4630583015863350357" onmouseenter="enter('-4630583015863350357');" onmouseout="out('-4630583015863350357');" style=""> 645                  source.equals(&quot;com.android.dialer&quot;) ||                                                            </span>
<span class="-4581680912095398334" onmouseenter="enter('-4581680912095398334');" onmouseout="out('-4581680912095398334');" style=""> 646                  source.equals(&quot;com.cyanogenmod.eleven&quot;)) {                                                        </span>
<span class="7414276835277607055" onmouseenter="enter('7414276835277607055');" onmouseout="out('7414276835277607055');" style=""> 647              LOG.info(&quot;Ignoring notification, is a system event&quot;);                                                 </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 648              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 649          }                                                                                                         </span>
<span  style=""> 650                                                                                                                    </span>
<span class="6340978795702098449" onmouseenter="enter('6340978795702098449');" onmouseout="out('6340978795702098449');" style=""> 651          if (source.equals(&quot;com.moez.QKSMS&quot;) ||                                                                    </span>
<span class="3673317982547560929" onmouseenter="enter('3673317982547560929');" onmouseout="out('3673317982547560929');" style=""> 652                  source.equals(&quot;com.android.mms&quot;) ||                                                               </span>
<span class="-6538830744852229820" onmouseenter="enter('-6538830744852229820');" onmouseout="out('-6538830744852229820');" style=""> 653                  source.equals(&quot;com.sonyericsson.conversations&quot;) ||                                                </span>
<span class="-1795882970722883910" onmouseenter="enter('-1795882970722883910');" onmouseout="out('-1795882970722883910');" style=""> 654                  source.equals(&quot;com.android.messaging&quot;) ||                                                         </span>
<span class="4780395695457664313" onmouseenter="enter('4780395695457664313');" onmouseout="out('4780395695457664313');" style=""> 655                  source.equals(&quot;org.smssecure.smssecure&quot;)) {                                                       </span>
<span class="7115714847551904856" onmouseenter="enter('7115714847551904856');" onmouseout="out('7115714847551904856');" style=""> 656              if (!&quot;never&quot;.equals(prefs.getString(&quot;notification_mode_sms&quot;, &quot;when_screen_off&quot;))) {                   </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 657                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 658              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 659          }                                                                                                         </span>
<span  style=""> 660                                                                                                                    </span>
<span class="6044120705305546650" onmouseenter="enter('6044120705305546650');" onmouseout="out('6044120705305546650');" style=""> 661          if (GBApplication.appIsNotifBlacklisted(source)) {                                                        </span>
<span class="-8656872471771272619" onmouseenter="enter('-8656872471771272619');" onmouseout="out('-8656872471771272619');" style=""> 662              LOG.info(&quot;Ignoring notification, application is blacklisted&quot;);                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 663              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 664          }                                                                                                         </span>
<span  style=""> 665                                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 666          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 667      }                                                                                                             </span>
<span  style=""> 668                                                                                                                    </span>
<span class="1856078835330472094" onmouseenter="enter('1856078835330472094');" onmouseout="out('1856078835330472094');" style=""> 669      private boolean shouldIgnoreNotification(Notification notification, String source) {                          </span>
<span  style=""> 670                                                                                                                    </span>
<span class="2710746236440319224" onmouseenter="enter('2710746236440319224');" onmouseout="out('2710746236440319224');" style=""> 671          MediaSessionCompat.Token mediaSession = getMediaSession(notification);                                    </span>
<span class="-7174765412912193274" onmouseenter="enter('-7174765412912193274');" onmouseout="out('-7174765412912193274');" style=""> 672          //try to handle media session notifications                                                               </span>
<span class="3009058002375133697" onmouseenter="enter('3009058002375133697');" onmouseout="out('3009058002375133697');" style=""> 673          if (mediaSession != null &amp;&amp; handleMediaSessionNotification(mediaSession))                                 </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 674              return true;                                                                                          </span>
<span  style=""> 675                                                                                                                    </span>
<span class="8585714054343457960" onmouseenter="enter('8585714054343457960');" onmouseout="out('8585714054343457960');" style=""> 676          NotificationType type = AppNotificationType.getInstance().get(source);                                    </span>
<span class="-3108268637978238079" onmouseenter="enter('-3108268637978238079');" onmouseout="out('-3108268637978238079');" style=""><abbr title=" 677          //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/Notification.html#FLAG_LOCAL_ONLY"> 677          //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/NotificatioðŸ”µ</abbr></span>
<span class="1334602672683683072" onmouseenter="enter('1334602672683683072');" onmouseout="out('1334602672683683072');" style=""> 678          //some Apps always mark their notifcations as read-only                                                   </span>
<span class="-5418244290311748300" onmouseenter="enter('-5418244290311748300');" onmouseout="out('-5418244290311748300');" style=""> 679          if (NotificationCompat.getLocalOnly(notification) &amp;&amp;                                                      </span>
<span class="7056635344578594111" onmouseenter="enter('7056635344578594111');" onmouseout="out('7056635344578594111');" style=""> 680                  type != NotificationType.WECHAT &amp;&amp;                                                                </span>
<span class="-8701954321417018195" onmouseenter="enter('-8701954321417018195');" onmouseout="out('-8701954321417018195');" style=""> 681                  type != NotificationType.OUTLOOK &amp;&amp;                                                               </span>
<span class="-8347560682459681115" onmouseenter="enter('-8347560682459681115');" onmouseout="out('-8347560682459681115');" style=""> 682                  type != NotificationType.SKYPE) { //see https://github.com/Freeyourgadget/Gadgetbridge/issues/1109</span>

<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 683              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 684          }                                                                                                         </span>
<span  style=""> 685                                                                                                                    </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 686          Prefs prefs = GBApplication.getPrefs();                                                                   </span>
<span class="7394809232234198434" onmouseenter="enter('7394809232234198434');" onmouseout="out('7394809232234198434');" style=""> 687          if (!prefs.getBoolean(&quot;notifications_generic_whenscreenon&quot;, false)) {                                     </span>
<span class="-494499854560412945" onmouseenter="enter('-494499854560412945');" onmouseout="out('-494499854560412945');" style=""> 688              PowerManager powermanager = (PowerManager) getSystemService(POWER_SERVICE);                           </span>
<span class="-5667675384255289213" onmouseenter="enter('-5667675384255289213');" onmouseout="out('-5667675384255289213');" style=""> 689              if (powermanager != null &amp;&amp; powermanager.isScreenOn()) {                                              </span>
<span class="1543062508857536366" onmouseenter="enter('1543062508857536366');" onmouseout="out('1543062508857536366');" style=""> 690  //                LOG.info(&quot;Not forwarding notification, screen seems to be on and settings do not allow this&quot;);  </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 691                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 692              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 693          }                                                                                                         </span>
<span  style=""> 694                                                                                                                    </span>
<span class="3125878453643003848" onmouseenter="enter('3125878453643003848');" onmouseout="out('3125878453643003848');" style=""> 695          return (notification.flags &amp; Notification.FLAG_ONGOING_EVENT) == Notification.FLAG_ONGOING_EVENT;         </span>
<span  style=""> 696                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 697      }                                                                                                             </span>
<span  style=""> 698                                                                                                                    </span>
<span  style=""> 699                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 700      /**                                                                                                           </span>
<span class="-3600272953695402454" onmouseenter="enter('-3600272953695402454');" onmouseout="out('-3600272953695402454');" style=""> 701       * Get the notification color that should be used for this Pebble notification.                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 702       *                                                                                                            </span>
<span class="-6380098887809341874" onmouseenter="enter('-6380098887809341874');" onmouseout="out('-6380098887809341874');" style=""><abbr title=" 703       * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PebbleColor."> 703       * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PebbleColorðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 704       *                                                                                                            </span>
<span class="-5220482988035539244" onmouseenter="enter('-5220482988035539244');" onmouseout="out('-5220482988035539244');" style=""> 705       * See Issue #815 on GitHub to see how notification colors are set.                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 706       *                                                                                                            </span>
<span class="-144667098623416646" onmouseenter="enter('-144667098623416646');" onmouseout="out('-144667098623416646');" style=""> 707       * @param notificationSpec The NotificationSpec to read from.                                                 </span>
<span class="-8231127304595524287" onmouseenter="enter('-8231127304595524287');" onmouseout="out('-8231127304595524287');" style=""> 708       * @return Returns a PebbleColor that best represents this notification.                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 709       */                                                                                                           </span>
<span class="-8858039465077957361" onmouseenter="enter('-8858039465077957361');" onmouseout="out('-8858039465077957361');" style=""> 710      private byte getPebbleColorForNotification(NotificationSpec notificationSpec) {                               </span>
<span class="2461936733082927787" onmouseenter="enter('2461936733082927787');" onmouseout="out('2461936733082927787');" style=""> 711          String appId = notificationSpec.sourceAppId;                                                              </span>
<span class="6072026966279222546" onmouseenter="enter('6072026966279222546');" onmouseout="out('6072026966279222546');" style=""> 712          NotificationType existingType = notificationSpec.type;                                                    </span>
<span  style=""> 713                                                                                                                    </span>
<span class="-4597227445151323685" onmouseenter="enter('-4597227445151323685');" onmouseout="out('-4597227445151323685');" style=""> 714          // If the notification type is known, return the associated color.                                        </span>
<span class="-3115160525838252691" onmouseenter="enter('-3115160525838252691');" onmouseout="out('-3115160525838252691');" style=""> 715          if (existingType != NotificationType.UNKNOWN) {                                                           </span>
<span class="4443749667658266101" onmouseenter="enter('4443749667658266101');" onmouseout="out('4443749667658266101');" style=""> 716              return existingType.color;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 717          }                                                                                                         </span>
<span  style=""> 718                                                                                                                    </span>
<span class="128994715916204674" onmouseenter="enter('128994715916204674');" onmouseout="out('128994715916204674');" style=""> 719          // Otherwise, we go and attempt to find the color from the app icon.                                      </span>
<span class="-6191555258820518316" onmouseenter="enter('-6191555258820518316');" onmouseout="out('-6191555258820518316');" style=""> 720          Drawable icon;                                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 721          try {                                                                                                     </span>
<span class="8261548971879133584" onmouseenter="enter('8261548971879133584');" onmouseout="out('8261548971879133584');" style=""> 722              icon = getApplicationContext().getPackageManager().getApplicationIcon(appId);                         </span>
<span class="6230969829088056905" onmouseenter="enter('6230969829088056905');" onmouseout="out('6230969829088056905');" style=""> 723              Objects.requireNonNull(icon);                                                                         </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style=""> 724          } catch (Exception ex) {                                                                                  </span>
<span class="-3868233956680081057" onmouseenter="enter('-3868233956680081057');" onmouseout="out('-3868233956680081057');" style=""> 725              // If we can&#x27;t get the icon, we go with the default defined above.                                    </span>
<span class="-5905931119091130668" onmouseenter="enter('-5905931119091130668');" onmouseout="out('-5905931119091130668');" style=""> 726              LOG.warn(&quot;Could not get icon for AppID &quot; + appId, ex);                                                </span>
<span class="5002487793506958772" onmouseenter="enter('5002487793506958772');" onmouseout="out('5002487793506958772');" style=""> 727              return PebbleColor.IslamicGreen;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 728          }                                                                                                         </span>
<span  style=""> 729                                                                                                                    </span>
<span class="-5100715979180048388" onmouseenter="enter('-5100715979180048388');" onmouseout="out('-5100715979180048388');" style=""> 730          Bitmap bitmapIcon = BitmapUtil.convertDrawableToBitmap(icon);                                             </span>
<span class="-8268037003500299815" onmouseenter="enter('-8268037003500299815');" onmouseout="out('-8268037003500299815');" style=""> 731          int iconPrimaryColor = new Palette.Builder(bitmapIcon)                                                    </span>
<span class="-3438664463656085757" onmouseenter="enter('-3438664463656085757');" onmouseout="out('-3438664463656085757');" style=""> 732                  .generate()                                                                                       </span>
<span class="-7390360638896501298" onmouseenter="enter('-7390360638896501298');" onmouseout="out('-7390360638896501298');" style=""> 733                  .getVibrantColor(Color.parseColor(&quot;#aa0000&quot;));                                                    </span>
<span  style=""> 734                                                                                                                    </span>
<span class="5649835422942677201" onmouseenter="enter('5649835422942677201');" onmouseout="out('5649835422942677201');" style=""> 735          return PebbleUtils.getPebbleColor(iconPrimaryColor);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 736      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 737  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="-230343772074056088" onmouseenter="enter('-230343772074056088');" onmouseout="out('-230343772074056088');" style="">   1  /*  Copyright (C) 2015-2018 Andreas Shimokawa, Carsten Pfeiffer, Daniele                                          </span>
<span class="2492236627567978380" onmouseenter="enter('2492236627567978380');" onmouseout="out('2492236627567978380');" style="">   2      Gobbetti, Frank Slezak, Hasan Ammar, JosÃ© Rebelo, Julien Pivotto, Kevin                                       </span>
<span class="-504983364603579348" onmouseenter="enter('-504983364603579348');" onmouseout="out('-504983364603579348');" style="">   3      Richter, Normano64, Steffen Liebergeld, Taavi EomÃ¤e, Zhong Jianxin                                            </span>
<span  style="">   4                                                                                                                    </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   5      This file is part of Gadgetbridge.                                                                            </span>
<span  style="">   6                                                                                                                    </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   7      Gadgetbridge is free software: you can redistribute it and/or modify                                          </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   8      it under the terms of the GNU Affero General Public License as published                                      </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">   9      by the Free Software Foundation, either version 3 of the License, or                                          </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">  10      (at your option) any later version.                                                                           </span>
<span  style="">  11                                                                                                                    </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  12      Gadgetbridge is distributed in the hope that it will be useful,                                               </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  13      but WITHOUT ANY WARRANTY; without even the implied warranty of                                                </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  14      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                                 </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  15      GNU Affero General Public License for more details.                                                           </span>
<span  style="">  16                                                                                                                    </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  17      You should have received a copy of the GNU Affero General Public License                                      </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  18      along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                                      </span>
<span class="8249211937858728345" onmouseenter="enter('8249211937858728345');" onmouseout="out('8249211937858728345');" style="">  19  package nodomain.freeyourgadget.gadgetbridge.externalevents;                                                      </span>
<span  style="">  20                                                                                                                    </span>
<span class="-867022162471464761" onmouseenter="enter('-867022162471464761');" onmouseout="out('-867022162471464761');" style="">  21  import android.app.ActivityManager;                                                                               </span>
<span class="1017587490774535994" onmouseenter="enter('1017587490774535994');" onmouseout="out('1017587490774535994');" style="">  22  import android.app.Notification;                                                                                  </span>
<span class="2183671588995744448" onmouseenter="enter('2183671588995744448');" onmouseout="out('2183671588995744448');" style="">  23  import android.app.NotificationManager;                                                                           </span>
<span class="2265467446931963889" onmouseenter="enter('2265467446931963889');" onmouseout="out('2265467446931963889');" style="">  24  import android.app.PendingIntent;                                                                                 </span>
<span class="-489389385851058391" onmouseenter="enter('-489389385851058391');" onmouseout="out('-489389385851058391');" style="">  25  import android.content.BroadcastReceiver;                                                                         </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  26  import android.content.Context;                                                                                   </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  27  import android.content.Intent;                                                                                    </span>
<span class="8697221465021235869" onmouseenter="enter('8697221465021235869');" onmouseout="out('8697221465021235869');" style="">  28  import android.content.IntentFilter;                                                                              </span>
<span class="-841431222158024655" onmouseenter="enter('-841431222158024655');" onmouseout="out('-841431222158024655');" style="">  29  import android.content.pm.ApplicationInfo;                                                                        </span>
<span class="-1290624633738557221" onmouseenter="enter('-1290624633738557221');" onmouseout="out('-1290624633738557221');" style="">  30  import android.content.pm.PackageManager;                                                                         </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  31  import android.graphics.Bitmap;                                                                                   </span>
<span class="-5868658801447575011" onmouseenter="enter('-5868658801447575011');" onmouseout="out('-5868658801447575011');" style="">  32  import android.graphics.Color;                                                                                    </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  33  import android.graphics.drawable.Drawable;                                                                        </span>
<span class="-7644600255099282823" onmouseenter="enter('-7644600255099282823');" onmouseout="out('-7644600255099282823');" style="">  34  import android.media.MediaMetadata;                                                                               </span>
<span class="6014561289295455692" onmouseenter="enter('6014561289295455692');" onmouseout="out('6014561289295455692');" style="">  35  import android.media.session.PlaybackState;                                                                       </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  36  import android.os.Bundle;                                                                                         </span>
<span class="1048014933395814760" onmouseenter="enter('1048014933395814760');" onmouseout="out('1048014933395814760');" style="">  37  import android.os.PowerManager;                                                                                   </span>
<span class="2671599330745315048" onmouseenter="enter('2671599330745315048');" onmouseout="out('2671599330745315048');" style="">  38  import android.os.RemoteException;                                                                                </span>
<span class="2414580121965048179" onmouseenter="enter('2414580121965048179');" onmouseout="out('2414580121965048179');" style="">  39  import android.service.notification.NotificationListenerService;                                                  </span>
<span class="-5243140560088050107" onmouseenter="enter('-5243140560088050107');" onmouseout="out('-5243140560088050107');" style="">  40  import android.service.notification.StatusBarNotification;                                                        </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  41  import android.support.annotation.NonNull;                                                                        </span>
<span class="776263261885946432" onmouseenter="enter('776263261885946432');" onmouseout="out('776263261885946432');" style="">  42  import android.support.v4.app.NotificationCompat;                                                                 </span>
<span class="-7596747065606978004" onmouseenter="enter('-7596747065606978004');" onmouseout="out('-7596747065606978004');" style="">  43  import android.support.v4.app.RemoteInput;                                                                        </span>
<span class="2517521963771876570" onmouseenter="enter('2517521963771876570');" onmouseout="out('2517521963771876570');" style="">  44  import android.support.v4.content.LocalBroadcastManager;                                                          </span>
<span class="-9135046463009697450" onmouseenter="enter('-9135046463009697450');" onmouseout="out('-9135046463009697450');" style="">  45  import android.support.v4.media.MediaMetadataCompat;                                                              </span>
<span class="3010053617601869286" onmouseenter="enter('3010053617601869286');" onmouseout="out('3010053617601869286');" style="">  46  import android.support.v4.media.session.MediaControllerCompat;                                                    </span>
<span class="7582659085834762989" onmouseenter="enter('7582659085834762989');" onmouseout="out('7582659085834762989');" style="">  47  import android.support.v4.media.session.MediaSessionCompat;                                                       </span>
<span class="7730848488047972805" onmouseenter="enter('7730848488047972805');" onmouseout="out('7730848488047972805');" style="">  48  import android.support.v4.media.session.PlaybackStateCompat;                                                      </span>
<span class="1265541204496044340" onmouseenter="enter('1265541204496044340');" onmouseout="out('1265541204496044340');" style="">  49  import android.support.v7.graphics.Palette;                                                                       </span>















<span class="-1987741288118698756" onmouseenter="enter('-1987741288118698756');" onmouseout="out('-1987741288118698756');" style="">  50  import de.greenrobot.dao.query.Query;                                                                             </span>
<span class="5877451784023912628" onmouseenter="enter('5877451784023912628');" onmouseout="out('5877451784023912628');" style="">  51  import nodomain.freeyourgadget.gadgetbridge.BuildConfig;                                                          </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  52  import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                                        </span>
<span class="-1471644270559892265" onmouseenter="enter('-1471644270559892265');" onmouseout="out('-1471644270559892265');" style="">  53  import nodomain.freeyourgadget.gadgetbridge.GBException;                                                          </span>
<span class="-7198279398549834921" onmouseenter="enter('-7198279398549834921');" onmouseout="out('-7198279398549834921');" style="">  54  import nodomain.freeyourgadget.gadgetbridge.R;                                                                    </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  55  import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                                   </span>
<span class="4987748567588683404" onmouseenter="enter('4987748567588683404');" onmouseout="out('4987748567588683404');" style="">  56  import nodomain.freeyourgadget.gadgetbridge.devices.pebble.PebbleColor;                                           </span>
<span class="4582396241551629343" onmouseenter="enter('4582396241551629343');" onmouseout="out('4582396241551629343');" style="">  57  import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilter;                                          </span>
<span class="-9074570965792323186" onmouseenter="enter('-9074570965792323186');" onmouseout="out('-9074570965792323186');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  58 +import nodomain.freeyourgadget.gadgetbridge.model.CallSpec;                                                       </span>
<span class="-8984035867915956548" onmouseenter="enter('-8984035867915956548');" onmouseout="out('-8984035867915956548');" style="">  59  import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterDao;                                       </span>
<span class="-8722044444563651785" onmouseenter="enter('-8722044444563651785');" onmouseout="out('-8722044444563651785');" style="">  60  import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntry;                                     </span>
<span class="-8636777843920322113" onmouseenter="enter('-8636777843920322113');" onmouseout="out('-8636777843920322113');" style="">  61  import nodomain.freeyourgadget.gadgetbridge.entities.NotificationFilterEntryDao;                                  </span>
<span class="9006904697493331689" onmouseenter="enter('9006904697493331689');" onmouseout="out('9006904697493331689');" style="">  62  import nodomain.freeyourgadget.gadgetbridge.model.*;                                                              </span>





<span class="-3383373218913164687" onmouseenter="enter('-3383373218913164687');" onmouseout="out('-3383373218913164687');" style="">  63  import nodomain.freeyourgadget.gadgetbridge.service.DeviceCommunicationService;                                   </span>
<span class="-5340888108606249230" onmouseenter="enter('-5340888108606249230');" onmouseout="out('-5340888108606249230');" style="">  64  import nodomain.freeyourgadget.gadgetbridge.util.BitmapUtil;                                                      </span>
<span class="-6912606469471439703" onmouseenter="enter('-6912606469471439703');" onmouseout="out('-6912606469471439703');" style="">  65  import nodomain.freeyourgadget.gadgetbridge.util.LimitedQueue;                                                    </span>
<span class="4645284583739884744" onmouseenter="enter('4645284583739884744');" onmouseout="out('4645284583739884744');" style="">  66  import nodomain.freeyourgadget.gadgetbridge.util.PebbleUtils;                                                     </span>
<span class="-600862318521663319" onmouseenter="enter('-600862318521663319');" onmouseout="out('-600862318521663319');" style="">  67  import nodomain.freeyourgadget.gadgetbridge.util.Prefs;                                                           </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  68  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  69  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  70  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  71                                                                                                                    </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  72  import java.util.ArrayList;                                                                                       </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  73  import java.util.HashMap;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  74  import java.util.List;                                                                                            </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  75  import java.util.Objects;                                                                                         </span>
<span  style="">  76                                                                                                                    </span>
<span class="-7522097891467373273" onmouseenter="enter('-7522097891467373273');" onmouseout="out('-7522097891467373273');" style="">  77  import static android.support.v4.media.app.NotificationCompat.MediaStyle.getMediaSession;                         </span>
<span class="-5547807107031188302" onmouseenter="enter('-5547807107031188302');" onmouseout="out('-5547807107031188302');" style="">  78  import static nodomain.freeyourgadget.gadgetbridge.activities.NotificationFilterActivity.*;                       </span>





<span  style="">  79                                                                                                                    </span>
<span class="6882532116672062216" onmouseenter="enter('6882532116672062216');" onmouseout="out('6882532116672062216');" style="">  80  public class NotificationListener extends NotificationListenerService {                                           </span>
<span  style="">  81                                                                                                                    </span>
<span class="5652999225459763894" onmouseenter="enter('5652999225459763894');" onmouseout="out('5652999225459763894');" style="">  82      private static final Logger LOG = LoggerFactory.getLogger(NotificationListener.class);                        </span>
<span  style="">  83                                                                                                                    </span>
<span class="-6720636215056424198" onmouseenter="enter('-6720636215056424198');" onmouseout="out('-6720636215056424198');" style="">  84      public static final String ACTION_DISMISS                                                                     </span>
<span class="-435533233439313912" onmouseenter="enter('-435533233439313912');" onmouseout="out('-435533233439313912');" style="">  85              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss&quot;;                         </span>
<span class="-2138233225266526402" onmouseenter="enter('-2138233225266526402');" onmouseout="out('-2138233225266526402');" style="">  86      public static final String ACTION_DISMISS_ALL                                                                 </span>
<span class="-4592236270087722119" onmouseenter="enter('-4592236270087722119');" onmouseout="out('-4592236270087722119');" style="">  87              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.dismiss_all&quot;;                     </span>
<span class="-3417692764158931011" onmouseenter="enter('-3417692764158931011');" onmouseout="out('-3417692764158931011');" style="">  88      public static final String ACTION_OPEN                                                                        </span>
<span class="-4990387725302380924" onmouseenter="enter('-4990387725302380924');" onmouseout="out('-4990387725302380924');" style="">  89              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.open&quot;;                            </span>
<span class="-4179389986769695249" onmouseenter="enter('-4179389986769695249');" onmouseout="out('-4179389986769695249');" style="">  90      public static final String ACTION_MUTE                                                                        </span>
<span class="9023540546537828742" onmouseenter="enter('9023540546537828742');" onmouseout="out('9023540546537828742');" style="">  91              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.mute&quot;;                            </span>
<span class="5009618492496239115" onmouseenter="enter('5009618492496239115');" onmouseout="out('5009618492496239115');" style="">  92      public static final String ACTION_REPLY                                                                       </span>
<span class="8900274215532856227" onmouseenter="enter('8900274215532856227');" onmouseout="out('8900274215532856227');" style="">  93              = &quot;nodomain.freeyourgadget.gadgetbridge.notificationlistener.action.reply&quot;;                           </span>
<span  style="">  94                                                                                                                    </span>
<span class="2046947475762055359" onmouseenter="enter('2046947475762055359');" onmouseout="out('2046947475762055359');" style="">  95      private LimitedQueue mActionLookup = new LimitedQueue(32);                                                    </span>
<span class="7830816337914020824" onmouseenter="enter('7830816337914020824');" onmouseout="out('7830816337914020824');" style="">  96      private LimitedQueue mPackageLookup = new LimitedQueue(64);                                                   </span>
<span class="203591122145891899" onmouseenter="enter('203591122145891899');" onmouseout="out('203591122145891899');" style="">  97      private LimitedQueue mNotificationHandleLookup = new LimitedQueue(128);                                       </span>
<span  style="">  98                                                                                                                    </span>
<span class="5935133783530348929" onmouseenter="enter('5935133783530348929');" onmouseout="out('5935133783530348929');" style="">  99      private HashMap&lt;String, Long&gt; notificationBurstPrevention = new HashMap&lt;&gt;();                                  </span>
<span class="957532525841967801" onmouseenter="enter('957532525841967801');" onmouseout="out('957532525841967801');" style=""> 100      private HashMap&lt;String, Long&gt; notificationOldRepeatPrevention = new HashMap&lt;&gt;();                              </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +                                                                                                                  </span>
<span class="1901653456173527926" onmouseenter="enter('1901653456173527926');" onmouseout="out('1901653456173527926');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +    private long activeCallPostTime;                                                                              </span>
<span  style=""> 103                                                                                                                    </span>
<span class="4625474178666977899" onmouseenter="enter('4625474178666977899');" onmouseout="out('4625474178666977899');" style=""> 104      private final BroadcastReceiver mReceiver = new BroadcastReceiver() {                                         </span>
<span  style=""> 105                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 106          @Override                                                                                                 </span>
<span class="-1520739091809898546" onmouseenter="enter('-1520739091809898546');" onmouseout="out('-1520739091809898546');" style=""> 107          public void onReceive(Context context, Intent intent) {                                                   </span>
<span class="5344227773413700857" onmouseenter="enter('5344227773413700857');" onmouseout="out('5344227773413700857');" style=""> 108              String action = intent.getAction();                                                                   </span>
<span class="4668300806615190248" onmouseenter="enter('4668300806615190248');" onmouseout="out('4668300806615190248');" style=""> 109              if (action == null) {                                                                                 </span>
<span class="-9060638611519565940" onmouseenter="enter('-9060638611519565940');" onmouseout="out('-9060638611519565940');" style=""> 110                  LOG.warn(&quot;no action&quot;);                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 111                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112              }                                                                                                     </span>
<span  style=""> 113                                                                                                                    </span>
<span class="-4066678304235095791" onmouseenter="enter('-4066678304235095791');" onmouseout="out('-4066678304235095791');" style=""> 114              int handle = (int) intent.getLongExtra(&quot;handle&quot;, -1);                                                 </span>
<span class="6099627150369302694" onmouseenter="enter('6099627150369302694');" onmouseout="out('6099627150369302694');" style=""> 115              switch (action) {                                                                                     </span>
<span class="-3756464253045444946" onmouseenter="enter('-3756464253045444946');" onmouseout="out('-3756464253045444946');" style=""> 116                  case GBApplication.ACTION_QUIT:                                                                   </span>
<span class="711670831438240238" onmouseenter="enter('711670831438240238');" onmouseout="out('711670831438240238');" style=""> 117                      stopSelf();                                                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 118                      break;                                                                                        </span>
<span  style=""> 119                                                                                                                    </span>
<span class="7089712877132390363" onmouseenter="enter('7089712877132390363');" onmouseout="out('7089712877132390363');" style=""> 120                  case ACTION_OPEN: {                                                                               </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""> 121                      StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();            </span>
<span class="-2620913793661815477" onmouseenter="enter('-2620913793661815477');" onmouseout="out('-2620913793661815477');" style=""> 122                      Long ts = (Long) mNotificationHandleLookup.lookup(handle);                                    </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 123                      if (ts == null) {                                                                             </span>
<span class="-3551838833774164230" onmouseenter="enter('-3551838833774164230');" onmouseout="out('-3551838833774164230');" style=""> 124                          LOG.info(&quot;could not lookup handle for open action&quot;);                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 125                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126                      }                                                                                             </span>
<span  style=""> 127                                                                                                                    </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 128                      for (StatusBarNotification sbn : sbns) {                                                      </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 129                          if (sbn.getPostTime() == ts) {                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 130                              try {                                                                                 </span>
<span class="-5589448531951598530" onmouseenter="enter('-5589448531951598530');" onmouseout="out('-5589448531951598530');" style=""> 131                                  PendingIntent pi = sbn.getNotification().contentIntent;                           </span>
<span class="-4590351723917688021" onmouseenter="enter('-4590351723917688021');" onmouseout="out('-4590351723917688021');" style=""> 132                                  if (pi != null) {                                                                 </span>
<span class="-4072418890714992779" onmouseenter="enter('-4072418890714992779');" onmouseout="out('-4072418890714992779');" style=""> 133                                      pi.send();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134                                  }                                                                                 </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 135                              } catch (PendingIntent.CanceledException e) {                                         </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 136                                  e.printStackTrace();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139                      }                                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 140                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141                  }                                                                                                 </span>
<span class="-4678853843833528690" onmouseenter="enter('-4678853843833528690');" onmouseout="out('-4678853843833528690');" style=""> 142                  case ACTION_MUTE:                                                                                 </span>
<span class="4917035583817915455" onmouseenter="enter('4917035583817915455');" onmouseout="out('4917035583817915455');" style=""> 143                      String packageName = (String) mPackageLookup.lookup(handle);                                  </span>
<span class="2797777100746091358" onmouseenter="enter('2797777100746091358');" onmouseout="out('2797777100746091358');" style=""> 144                      if (packageName == null) {                                                                    </span>
<span class="5190950653644936431" onmouseenter="enter('5190950653644936431');" onmouseout="out('5190950653644936431');" style=""> 145                          LOG.info(&quot;could not lookup handle for mute action&quot;);                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 146                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147                      }                                                                                             </span>
<span  style=""> 148                                                                                                                    </span>
<span class="-55961907216512395" onmouseenter="enter('-55961907216512395');" onmouseout="out('-55961907216512395');" style=""> 149                      LOG.info(&quot;going to mute &quot; + packageName);                                                     </span>
<span class="6244948836232449423" onmouseenter="enter('6244948836232449423');" onmouseout="out('6244948836232449423');" style=""> 150                      GBApplication.addAppToNotifBlacklist(packageName);                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 151                      break;                                                                                        </span>
<span class="-1141458133536299461" onmouseenter="enter('-1141458133536299461');" onmouseout="out('-1141458133536299461');" style=""> 152                  case ACTION_DISMISS: {                                                                            </span>
<span class="8199808314847243755" onmouseenter="enter('8199808314847243755');" onmouseout="out('8199808314847243755');" style=""> 153                      StatusBarNotification[] sbns = NotificationListener.this.getActiveNotifications();            </span>
<span class="-2620913793661815477" onmouseenter="enter('-2620913793661815477');" onmouseout="out('-2620913793661815477');" style=""> 154                      Long ts = (Long) mNotificationHandleLookup.lookup(handle);                                    </span>
<span class="-5791146458529201626" onmouseenter="enter('-5791146458529201626');" onmouseout="out('-5791146458529201626');" style=""> 155                      if (ts == null) {                                                                             </span>
<span class="2968382775980406642" onmouseenter="enter('2968382775980406642');" onmouseout="out('2968382775980406642');" style=""> 156                          LOG.info(&quot;could not lookup handle for dismiss action&quot;);                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 157                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158                      }                                                                                             </span>
<span class="4471007844812681679" onmouseenter="enter('4471007844812681679');" onmouseout="out('4471007844812681679');" style=""> 159                      for (StatusBarNotification sbn : sbns) {                                                      </span>
<span class="-9183791416685726201" onmouseenter="enter('-9183791416685726201');" onmouseout="out('-9183791416685726201');" style=""> 160                          if (sbn.getPostTime() == ts) {                                                            </span>
<span class="-2574007810032784507" onmouseenter="enter('-2574007810032784507');" onmouseout="out('-2574007810032784507');" style=""> 161                              if (GBApplication.isRunningLollipopOrLater()) {                                       </span>
<span class="6969546006861717982" onmouseenter="enter('6969546006861717982');" onmouseout="out('6969546006861717982');" style=""> 162                                  String key = sbn.getKey();                                                        </span>
<span class="-8910102463751962403" onmouseenter="enter('-8910102463751962403');" onmouseout="out('-8910102463751962403');" style=""> 163                                  NotificationListener.this.cancelNotification(key);                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 164                              } else {                                                                              </span>
<span class="8698193459204911181" onmouseenter="enter('8698193459204911181');" onmouseout="out('8698193459204911181');" style=""> 165                                  int id = sbn.getId();                                                             </span>
<span class="-3586097476318973287" onmouseenter="enter('-3586097476318973287');" onmouseout="out('-3586097476318973287');" style=""> 166                                  String pkg = sbn.getPackageName();                                                </span>
<span class="-8898967747084014814" onmouseenter="enter('-8898967747084014814');" onmouseout="out('-8898967747084014814');" style=""> 167                                  String tag = sbn.getTag();                                                        </span>
<span class="-7819421458484381897" onmouseenter="enter('-7819421458484381897');" onmouseout="out('-7819421458484381897');" style=""> 168                                  NotificationListener.this.cancelNotification(pkg, tag, id);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171                      }                                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 172                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173                  }                                                                                                 </span>
<span class="-6975792259235269251" onmouseenter="enter('-6975792259235269251');" onmouseout="out('-6975792259235269251');" style=""> 174                  case ACTION_DISMISS_ALL:                                                                          </span>
<span class="1530048448958335468" onmouseenter="enter('1530048448958335468');" onmouseout="out('1530048448958335468');" style=""> 175                      NotificationListener.this.cancelAllNotifications();                                           </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 176                      break;                                                                                        </span>
<span class="-8033996733174441765" onmouseenter="enter('-8033996733174441765');" onmouseout="out('-8033996733174441765');" style=""> 177                  case ACTION_REPLY:                                                                                </span>
<span class="4738866927376315941" onmouseenter="enter('4738866927376315941');" onmouseout="out('4738866927376315941');" style=""><abbr title=" 178                      NotificationCompat.Action wearableAction = (NotificationCompat.Action) mActionLookup.lookup(handle);"> 178                      NotificationCompat.Action wearableAction = (NotificationCompat.Action) mActionLookup.lookup(haðŸ”µ</abbr></span>
<span class="2885762978640892133" onmouseenter="enter('2885762978640892133');" onmouseout="out('2885762978640892133');" style=""> 179                      String reply = intent.getStringExtra(&quot;reply&quot;);                                                </span>
<span class="-2711571343237725875" onmouseenter="enter('-2711571343237725875');" onmouseout="out('-2711571343237725875');" style=""> 180                      if (wearableAction != null) {                                                                 </span>
<span class="8382710711087379858" onmouseenter="enter('8382710711087379858');" onmouseout="out('8382710711087379858');" style=""> 181                          PendingIntent actionIntent = wearableAction.getActionIntent();                            </span>
<span class="8988901388813075705" onmouseenter="enter('8988901388813075705');" onmouseout="out('8988901388813075705');" style=""> 182                          Intent localIntent = new Intent();                                                        </span>
<span class="7096307769955289231" onmouseenter="enter('7096307769955289231');" onmouseout="out('7096307769955289231');" style=""> 183                          localIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);                                      </span>
<span class="-3683679949476668963" onmouseenter="enter('-3683679949476668963');" onmouseout="out('-3683679949476668963');" style=""> 184                          if(wearableAction.getRemoteInputs()!=null) {                                              </span>
<span class="-957754769572110349" onmouseenter="enter('-957754769572110349');" onmouseout="out('-957754769572110349');" style=""> 185                              RemoteInput[] remoteInputs = wearableAction.getRemoteInputs();                        </span>
<span class="1776998572180860248" onmouseenter="enter('1776998572180860248');" onmouseout="out('1776998572180860248');" style=""> 186                              Bundle extras = new Bundle();                                                         </span>
<span class="2352964158014766609" onmouseenter="enter('2352964158014766609');" onmouseout="out('2352964158014766609');" style=""> 187                              extras.putCharSequence(remoteInputs[0].getResultKey(), reply);                        </span>
<span class="5088590721402752136" onmouseenter="enter('5088590721402752136');" onmouseout="out('5088590721402752136');" style=""> 188                              RemoteInput.addResultsToIntent(remoteInputs, localIntent, extras);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189                          }                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 190                          try {                                                                                     </span>
<span class="2300129068579463689" onmouseenter="enter('2300129068579463689');" onmouseout="out('2300129068579463689');" style=""> 191                              LOG.info(&quot;will send exec intent to remote application&quot;);                              </span>
<span class="2731482446525466050" onmouseenter="enter('2731482446525466050');" onmouseout="out('2731482446525466050');" style=""> 192                              actionIntent.send(context, 0, localIntent);                                           </span>
<span class="5952869537434724617" onmouseenter="enter('5952869537434724617');" onmouseout="out('5952869537434724617');" style=""> 193                              mActionLookup.remove(handle);                                                         </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style=""> 194                          } catch (PendingIntent.CanceledException e) {                                             </span>
<span class="-3367288945438988923" onmouseenter="enter('-3367288945438988923');" onmouseout="out('-3367288945438988923');" style=""> 195                              LOG.warn(&quot;replyToLastNotification error: &quot; + e.getLocalizedMessage());                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197                      }                                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 198                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200          }                                                                                                         </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 201      };                                                                                                            </span>
<span  style=""> 202                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 203      @Override                                                                                                     </span>
<span class="-2716773701189387633" onmouseenter="enter('-2716773701189387633');" onmouseout="out('-2716773701189387633');" style=""> 204      public void onCreate() {                                                                                      </span>
<span class="-2958534921295515858" onmouseenter="enter('-2958534921295515858');" onmouseout="out('-2958534921295515858');" style=""> 205          super.onCreate();                                                                                         </span>
<span class="7618100238646869770" onmouseenter="enter('7618100238646869770');" onmouseout="out('7618100238646869770');" style=""> 206          IntentFilter filterLocal = new IntentFilter();                                                            </span>
<span class="1063910518920289150" onmouseenter="enter('1063910518920289150');" onmouseout="out('1063910518920289150');" style=""> 207          filterLocal.addAction(GBApplication.ACTION_QUIT);                                                         </span>
<span class="2076754442287025975" onmouseenter="enter('2076754442287025975');" onmouseout="out('2076754442287025975');" style=""> 208          filterLocal.addAction(ACTION_OPEN);                                                                       </span>
<span class="-6869981444846929258" onmouseenter="enter('-6869981444846929258');" onmouseout="out('-6869981444846929258');" style=""> 209          filterLocal.addAction(ACTION_DISMISS);                                                                    </span>
<span class="8695742864955675589" onmouseenter="enter('8695742864955675589');" onmouseout="out('8695742864955675589');" style=""> 210          filterLocal.addAction(ACTION_DISMISS_ALL);                                                                </span>
<span class="3848496335642882317" onmouseenter="enter('3848496335642882317');" onmouseout="out('3848496335642882317');" style=""> 211          filterLocal.addAction(ACTION_MUTE);                                                                       </span>
<span class="-4535783496195239094" onmouseenter="enter('-4535783496195239094');" onmouseout="out('-4535783496195239094');" style=""> 212          filterLocal.addAction(ACTION_REPLY);                                                                      </span>
<span class="-4279331771748389639" onmouseenter="enter('-4279331771748389639');" onmouseout="out('-4279331771748389639');" style=""> 213          LocalBroadcastManager.getInstance(this).registerReceiver(mReceiver, filterLocal);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214      }                                                                                                             </span>
<span  style=""> 215                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 216      @Override                                                                                                     </span>
<span class="658855826062432633" onmouseenter="enter('658855826062432633');" onmouseout="out('658855826062432633');" style=""> 217      public void onDestroy() {                                                                                     </span>
<span class="1476506345433791001" onmouseenter="enter('1476506345433791001');" onmouseout="out('1476506345433791001');" style=""> 218          LocalBroadcastManager.getInstance(this).unregisterReceiver(mReceiver);                                    </span>
<span class="7275190530034972367" onmouseenter="enter('7275190530034972367');" onmouseout="out('7275190530034972367');" style=""> 219          super.onDestroy();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220      }                                                                                                             </span>
<span  style=""> 221                                                                                                                    </span>
<span class="4951847030810611879" onmouseenter="enter('4951847030810611879');" onmouseout="out('4951847030810611879');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 222 +    public String getAppName(String pkg) {                                                                        </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +        // determinate Source App Name (&quot;Label&quot;)                                                                  </span>
<span class="-6628567271413355488" onmouseenter="enter('-6628567271413355488');" onmouseout="out('-6628567271413355488');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 224 +        PackageManager pm = getPackageManager();                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 225 +        try {                                                                                                     </span>
<span class="2215142249605863035" onmouseenter="enter('2215142249605863035');" onmouseout="out('2215142249605863035');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 226 +            return (String)pm.getApplicationLabel(pm.getApplicationInfo(pkg, 0));                                 </span>
<span class="8932842947262589349" onmouseenter="enter('8932842947262589349');" onmouseout="out('8932842947262589349');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 227 +        } catch (PackageManager.NameNotFoundException e) {                                                        </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 228 +            e.printStackTrace();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 229 +        }                                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 230 +        return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 231 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 232 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 233      @Override                                                                                                     </span>
<span class="-2772368349505117806" onmouseenter="enter('-2772368349505117806');" onmouseout="out('-2772368349505117806');" style=""> 234      public void onNotificationPosted(StatusBarNotification sbn) {                                                 </span>
<span class="1980360516715691973" onmouseenter="enter('1980360516715691973');" onmouseout="out('1980360516715691973');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 235 -        if (shouldIgnore(sbn))                                                                                    </span>
<span class="6669401580814547638" onmouseenter="enter('6669401580814547638');" onmouseout="out('6669401580814547638');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 236 +        if (&quot;call&quot;.equals(sbn.getNotification().category)) {                                                      </span>
<span class="-4846577510724576112" onmouseenter="enter('-4846577510724576112');" onmouseout="out('-4846577510724576112');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 237 +            handleCallNotification(sbn);                                                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 238              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 239 +        }                                                                                                         </span>
<span class="2998034859944771870" onmouseenter="enter('2998034859944771870');" onmouseout="out('2998034859944771870');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 240 +        if (shouldIgnore(sbn)) {                                                                                  </span>
<span class="-3980483839174328253" onmouseenter="enter('-3980483839174328253');" onmouseout="out('-3980483839174328253');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +            LOG.info(&quot;Ignore notification&quot;);                                                                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +            return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 243 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 244 +                                                                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 245 +                                                                                                                  </span>
<span  style=""> 246                                                                                                                    </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 247          Prefs prefs = GBApplication.getPrefs();                                                                   </span>
<span  style=""> 248                                                                                                                    </span>
<span class="8054135432811402885" onmouseenter="enter('8054135432811402885');" onmouseout="out('8054135432811402885');" style=""> 249          switch (GBApplication.getGrantedInterruptionFilter()) {                                                   </span>
<span class="4109165554183544277" onmouseenter="enter('4109165554183544277');" onmouseout="out('4109165554183544277');" style=""> 250              case NotificationManager.INTERRUPTION_FILTER_ALL:                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 251                  break;                                                                                            </span>
<span class="-4951181644409102304" onmouseenter="enter('-4951181644409102304');" onmouseout="out('-4951181644409102304');" style=""> 252              case NotificationManager.INTERRUPTION_FILTER_ALARMS:                                                  </span>
<span class="7344230421954560306" onmouseenter="enter('7344230421954560306');" onmouseout="out('7344230421954560306');" style=""> 253              case NotificationManager.INTERRUPTION_FILTER_NONE:                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 254                  return;                                                                                           </span>
<span class="-4328737131563524650" onmouseenter="enter('-4328737131563524650');" onmouseout="out('-4328737131563524650');" style=""> 255              case NotificationManager.INTERRUPTION_FILTER_PRIORITY:                                                </span>
<span class="8591867555140901755" onmouseenter="enter('8591867555140901755');" onmouseout="out('8591867555140901755');" style=""> 256                  // FIXME: Handle Reminders and Events if they are enabled in Do Not Disturb                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 257                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258          }                                                                                                         </span>
<span  style=""> 259                                                                                                                    </span>
<span class="3332016722812204086" onmouseenter="enter('3332016722812204086');" onmouseout="out('3332016722812204086');" style=""> 260          String source = sbn.getPackageName().toLowerCase();                                                       </span>
<span class="2830045728262824638" onmouseenter="enter('2830045728262824638');" onmouseout="out('2830045728262824638');" style=""> 261          Notification notification = sbn.getNotification();                                                        </span>
<span class="4218475881538878307" onmouseenter="enter('4218475881538878307');" onmouseout="out('4218475881538878307');" style=""> 262          if (notificationOldRepeatPrevention.containsKey(source)) {                                                </span>
<span class="6155853035860803703" onmouseenter="enter('6155853035860803703');" onmouseout="out('6155853035860803703');" style=""> 263              if (notification.when &lt;= notificationOldRepeatPrevention.get(source)) {                               </span>
<span class="-4118070098413074653" onmouseenter="enter('-4118070098413074653');" onmouseout="out('-4118070098413074653');" style=""> 264                  LOG.info(&quot;NOT processing notification, already sent newer notifications from this source.&quot;);      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 265                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267          }                                                                                                         </span>
<span  style=""> 268                                                                                                                    </span>
<span class="-5834893131205351970" onmouseenter="enter('-5834893131205351970');" onmouseout="out('-5834893131205351970');" style=""> 269          // Ignore too frequent notifications, according to user preference                                        </span>
<span class="8739203694966910315" onmouseenter="enter('8739203694966910315');" onmouseout="out('8739203694966910315');" style=""> 270          long min_timeout = (long)prefs.getInt(&quot;notifications_timeout&quot;, 0) * 1000L;                                </span>
<span class="7158364678624901735" onmouseenter="enter('7158364678624901735');" onmouseout="out('7158364678624901735');" style=""> 271          long cur_time = System.currentTimeMillis();                                                               </span>
<span class="4691272725591601941" onmouseenter="enter('4691272725591601941');" onmouseout="out('4691272725591601941');" style=""> 272          if (notificationBurstPrevention.containsKey(source)) {                                                    </span>
<span class="-7388621012045880255" onmouseenter="enter('-7388621012045880255');" onmouseout="out('-7388621012045880255');" style=""> 273              long last_time = notificationBurstPrevention.get(source);                                             </span>
<span class="8371821158922557754" onmouseenter="enter('8371821158922557754');" onmouseout="out('8371821158922557754');" style=""> 274              if (cur_time - last_time &lt; min_timeout) {                                                             </span>
<span class="761193726766758320" onmouseenter="enter('761193726766758320');" onmouseout="out('761193726766758320');" style=""> 275                  LOG.info(&quot;Ignoring frequent notification, last one was &quot; + (cur_time - last_time) + &quot;ms ago&quot;);    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 276                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278          }                                                                                                         </span>
<span  style=""> 279                                                                                                                    </span>
<span class="4249292218927487361" onmouseenter="enter('4249292218927487361');" onmouseout="out('4249292218927487361');" style=""> 280          NotificationSpec notificationSpec = new NotificationSpec();                                               </span>
<span  style=""> 281                                                                                                                    </span>
<span class="2280524949944840986" onmouseenter="enter('2280524949944840986');" onmouseout="out('2280524949944840986');" style=""> 282          // determinate Source App Name (&quot;Label&quot;)                                                                  </span>
<span class="-6628567271413355488" onmouseenter="enter('-6628567271413355488');" onmouseout="out('-6628567271413355488');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 283 -        PackageManager pm = getPackageManager();                                                                  </span>
<span class="-1270310547520251488" onmouseenter="enter('-1270310547520251488');" onmouseout="out('-1270310547520251488');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 284 -        ApplicationInfo ai = null;                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 285 -        try {                                                                                                     </span>
<span class="935827957867129526" onmouseenter="enter('935827957867129526');" onmouseout="out('935827957867129526');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 286 -            ai = pm.getApplicationInfo(source, 0);                                                                </span>
<span class="8932842947262589349" onmouseenter="enter('8932842947262589349');" onmouseout="out('8932842947262589349');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 287 -        } catch (PackageManager.NameNotFoundException e) {                                                        </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 288 -            e.printStackTrace();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 289 -        }                                                                                                         </span>
<span class="-7433648267677911184" onmouseenter="enter('-7433648267677911184');" onmouseout="out('-7433648267677911184');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 290 -        if (ai != null) {                                                                                         </span>
<span class="-2056449758575494768" onmouseenter="enter('-2056449758575494768');" onmouseout="out('-2056449758575494768');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 291 -            notificationSpec.sourceName = (String) pm.getApplicationLabel(ai);                                    </span>
<span class="-1232802106572556205" onmouseenter="enter('-1232802106572556205');" onmouseout="out('-1232802106572556205');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 292 +        String name = getAppName(source);                                                                         </span>
<span class="8801601261434726216" onmouseenter="enter('8801601261434726216');" onmouseout="out('8801601261434726216');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 293 +        if (name != null) {                                                                                       </span>
<span class="3305632254012197272" onmouseenter="enter('3305632254012197272');" onmouseout="out('3305632254012197272');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 294 +            notificationSpec.sourceName = name;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295          }                                                                                                         </span>
<span  style=""> 296                                                                                                                    </span>
<span class="-7581221946487094265" onmouseenter="enter('-7581221946487094265');" onmouseout="out('-7581221946487094265');" style=""> 297          boolean preferBigText = false;                                                                            </span>
<span  style=""> 298                                                                                                                    </span>
<span class="-1916386255928229930" onmouseenter="enter('-1916386255928229930');" onmouseout="out('-1916386255928229930');" style=""><abbr title=" 299          // Get the app ID that generated this notification. For now only used by pebble color, but may be more useful later."> 299          // Get the app ID that generated this notification. For now only used by pebble color, but may be more useðŸ”µ</abbr></span>
<span class="-8067455375416267049" onmouseenter="enter('-8067455375416267049');" onmouseout="out('-8067455375416267049');" style=""> 300          notificationSpec.sourceAppId = source;                                                                    </span>
<span  style=""> 301                                                                                                                    </span>
<span class="-2810132766447661631" onmouseenter="enter('-2810132766447661631');" onmouseout="out('-2810132766447661631');" style=""> 302          notificationSpec.type = AppNotificationType.getInstance().get(source);                                    </span>
<span  style=""> 303                                                                                                                    </span>
<span class="-7540601865424540593" onmouseenter="enter('-7540601865424540593');" onmouseout="out('-7540601865424540593');" style=""> 304          //FIXME: some quirks lookup table would be the minor evil here                                            </span>
<span class="2207563395624266113" onmouseenter="enter('2207563395624266113');" onmouseout="out('2207563395624266113');" style=""> 305          if (source.startsWith(&quot;com.fsck.k9&quot;)) {                                                                   </span>
<span class="-8461204742030134802" onmouseenter="enter('-8461204742030134802');" onmouseout="out('-8461204742030134802');" style=""> 306              if (NotificationCompat.isGroupSummary(notification)) {                                                </span>
<span class="3811797734502814406" onmouseenter="enter('3811797734502814406');" onmouseout="out('3811797734502814406');" style=""> 307                  LOG.info(&quot;ignore K9 group summary&quot;);                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 308                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309              }                                                                                                     </span>
<span class="5839263120304468869" onmouseenter="enter('5839263120304468869');" onmouseout="out('5839263120304468869');" style=""> 310              preferBigText = true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311          }                                                                                                         </span>
<span  style=""> 312                                                                                                                    </span>
<span class="4253328762370341177" onmouseenter="enter('4253328762370341177');" onmouseout="out('4253328762370341177');" style=""> 313          if (notificationSpec.type == null) {                                                                      </span>
<span class="954876523018596305" onmouseenter="enter('954876523018596305');" onmouseout="out('954876523018596305');" style=""> 314              notificationSpec.type = NotificationType.UNKNOWN;                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315          }                                                                                                         </span>
<span  style=""> 316                                                                                                                    </span>
<span class="8812080595679134351" onmouseenter="enter('8812080595679134351');" onmouseout="out('8812080595679134351');" style=""> 317          // Get color                                                                                              </span>
<span class="-7215379846374020112" onmouseenter="enter('-7215379846374020112');" onmouseout="out('-7215379846374020112');" style=""> 318          notificationSpec.pebbleColor = getPebbleColorForNotification(notificationSpec);                           </span>
<span  style=""> 319                                                                                                                    </span>
<span class="-2694685924632068401" onmouseenter="enter('-2694685924632068401');" onmouseout="out('-2694685924632068401');" style=""><abbr title=" 320          LOG.info(&quot;Processing notification &quot; + notificationSpec.getId() + &quot; age: &quot; + (System.currentTimeMillis() - notification.when) + &quot; from source &quot; + source + &quot; with flags: &quot; + notification.flags);"> 320          LOG.info(&quot;Processing notification &quot; + notificationSpec.getId() + &quot; age: &quot; + (System.currentTimeMillis() - ðŸ”µ</abbr></span>
<span  style=""> 321                                                                                                                    </span>
<span class="-5865600179971875271" onmouseenter="enter('-5865600179971875271');" onmouseout="out('-5865600179971875271');" style=""> 322          dissectNotificationTo(notification, notificationSpec, preferBigText);                                     </span>
<span  style=""> 323                                                                                                                    </span>
<span class="3953264596152234401" onmouseenter="enter('3953264596152234401');" onmouseout="out('3953264596152234401');" style=""><abbr title=" 324          if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificationSpec.body)) {"> 324          if (!checkNotificationContentForWhiteAndBlackList(sbn.getPackageName().toLowerCase(), notificationSpec.bodðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 325              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326          }                                                                                                         </span>
<span  style=""> 327                                                                                                                    </span>
<span  style=""> 328                                                                                                                    </span>
<span class="668617636634990568" onmouseenter="enter('668617636634990568');" onmouseout="out('668617636634990568');" style=""> 329          // ignore Gadgetbridge&#x27;s very own notifications, except for those from the debug screen                   </span>
<span class="8240704894033078509" onmouseenter="enter('8240704894033078509');" onmouseout="out('8240704894033078509');" style=""> 330          if (getApplicationContext().getPackageName().equals(source)) {                                            </span>
<span class="-4005163798104538430" onmouseenter="enter('-4005163798104538430');" onmouseout="out('-4005163798104538430');" style=""> 331              if (!getApplicationContext().getString(R.string.test_notification).equals(notificationSpec.title)) {  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 332                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 333              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334          }                                                                                                         </span>
<span  style=""> 335                                                                                                                    </span>
<span class="3032759621835437424" onmouseenter="enter('3032759621835437424');" onmouseout="out('3032759621835437424');" style=""><abbr title=" 336          NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(notification);"> 336          NotificationCompat.WearableExtender wearableExtender = new NotificationCompat.WearableExtender(notificatioðŸ”µ</abbr></span>
<span class="-1472750016987720650" onmouseenter="enter('-1472750016987720650');" onmouseout="out('-1472750016987720650');" style=""> 337          List&lt;NotificationCompat.Action&gt; actions = wearableExtender.getActions();                                  </span>
<span  style=""> 338                                                                                                                    </span>
<span  style=""> 339                                                                                                                    </span>
<span class="7774033817539746019" onmouseenter="enter('7774033817539746019');" onmouseout="out('7774033817539746019');" style=""><abbr title=" 340          if (actions.size() == 0 &amp;&amp; NotificationCompat.isGroupSummary(notification)) { //this could cause #395 to come back"> 340          if (actions.size() == 0 &amp;&amp; NotificationCompat.isGroupSummary(notification)) { //this could cause #395 to cðŸ”µ</abbr></span>
<span class="-2600295662498564908" onmouseenter="enter('-2600295662498564908');" onmouseout="out('-2600295662498564908');" style=""><abbr title=" 341              LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action present. Notification flags: &quot; + notification.flags);"> 341              LOG.info(&quot;Not forwarding notification, FLAG_GROUP_SUMMARY is set and no wearable action present. NotifðŸ”µ</abbr></span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 342              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 343          }                                                                                                         </span>
<span  style=""> 344                                                                                                                    </span>
<span class="-5917197971696016550" onmouseenter="enter('-5917197971696016550');" onmouseout="out('-5917197971696016550');" style=""> 345          notificationSpec.attachedActions = new ArrayList&lt;&gt;();                                                     </span>
<span  style=""> 346                                                                                                                    </span>
<span class="6824678123821134026" onmouseenter="enter('6824678123821134026');" onmouseout="out('6824678123821134026');" style=""> 347          // DISMISS action                                                                                         </span>
<span class="5533936039133318070" onmouseenter="enter('5533936039133318070');" onmouseout="out('5533936039133318070');" style=""> 348          NotificationSpec.Action dismissAction = new NotificationSpec.Action();                                    </span>
<span class="-2035191731043357921" onmouseenter="enter('-2035191731043357921');" onmouseout="out('-2035191731043357921');" style=""> 349          dismissAction.title = &quot;Dismiss&quot;;                                                                          </span>
<span class="5737664600017371521" onmouseenter="enter('5737664600017371521');" onmouseout="out('5737664600017371521');" style=""> 350          dismissAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_DISMISS;                                      </span>
<span class="-4673031657134511356" onmouseenter="enter('-4673031657134511356');" onmouseout="out('-4673031657134511356');" style=""> 351          notificationSpec.attachedActions.add(dismissAction);                                                      </span>
<span  style=""> 352                                                                                                                    </span>
<span class="-8264806993566587236" onmouseenter="enter('-8264806993566587236');" onmouseout="out('-8264806993566587236');" style=""> 353          for (NotificationCompat.Action act : actions) {                                                           </span>
<span class="-5026732361501841882" onmouseenter="enter('-5026732361501841882');" onmouseout="out('-5026732361501841882');" style=""> 354              if (act != null) {                                                                                    </span>
<span class="-5786483650500220153" onmouseenter="enter('-5786483650500220153');" onmouseout="out('-5786483650500220153');" style=""> 355                  NotificationSpec.Action wearableAction = new NotificationSpec.Action();                           </span>
<span class="911429091199110596" onmouseenter="enter('911429091199110596');" onmouseout="out('911429091199110596');" style=""> 356                  wearableAction.title = act.getTitle().toString();                                                 </span>
<span class="5243119547087092802" onmouseenter="enter('5243119547087092802');" onmouseout="out('5243119547087092802');" style=""> 357                  if(act.getRemoteInputs()!=null) {                                                                 </span>
<span class="3631843705460318974" onmouseenter="enter('3631843705460318974');" onmouseout="out('3631843705460318974');" style=""> 358                      wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_REPLY;                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 359                  } else {                                                                                          </span>
<span class="5019071376909091625" onmouseenter="enter('5019071376909091625');" onmouseout="out('5019071376909091625');" style=""> 360                      wearableAction.type = NotificationSpec.Action.TYPE_WEARABLE_SIMPLE;                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 361                  }                                                                                                 </span>
<span  style=""> 362                                                                                                                    </span>
<span class="3300319972847919808" onmouseenter="enter('3300319972847919808');" onmouseout="out('3300319972847919808');" style=""> 363                  notificationSpec.attachedActions.add(wearableAction);                                             </span>
<span class="-7038376970573634272" onmouseenter="enter('-7038376970573634272');" onmouseout="out('-7038376970573634272');" style=""> 364                  mActionLookup.add((notificationSpec.getId()&lt;&lt;4) + notificationSpec.attachedActions.size(), act);  </span>
<span class="1537265167944677779" onmouseenter="enter('1537265167944677779');" onmouseout="out('1537265167944677779');" style=""><abbr title=" 365                  LOG.info(&quot;found wearable action: &quot; + notificationSpec.attachedActions.size() + &quot; - &quot;+ act.getTitle() + &quot;  &quot; + sbn.getTag());"> 365                  LOG.info(&quot;found wearable action: &quot; + notificationSpec.attachedActions.size() + &quot; - &quot;+ act.getTitleðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367          }                                                                                                         </span>
<span  style=""> 368                                                                                                                    </span>
<span class="7347352498327901971" onmouseenter="enter('7347352498327901971');" onmouseout="out('7347352498327901971');" style=""> 369          // OPEN action                                                                                            </span>
<span class="6797092604605164688" onmouseenter="enter('6797092604605164688');" onmouseout="out('6797092604605164688');" style=""> 370          NotificationSpec.Action openAction = new NotificationSpec.Action();                                       </span>
<span class="8898599446651645486" onmouseenter="enter('8898599446651645486');" onmouseout="out('8898599446651645486');" style=""> 371          openAction.title = getString(R.string._pebble_watch_open_on_phone);                                       </span>
<span class="620332764476499952" onmouseenter="enter('620332764476499952');" onmouseout="out('620332764476499952');" style=""> 372          openAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_OPEN;                                            </span>
<span class="-654055199082716612" onmouseenter="enter('-654055199082716612');" onmouseout="out('-654055199082716612');" style=""> 373          notificationSpec.attachedActions.add(openAction);                                                         </span>
<span  style=""> 374                                                                                                                    </span>
<span class="2264132042552456605" onmouseenter="enter('2264132042552456605');" onmouseout="out('2264132042552456605');" style=""> 375          // MUTE action                                                                                            </span>
<span class="-8712525482035557123" onmouseenter="enter('-8712525482035557123');" onmouseout="out('-8712525482035557123');" style=""> 376          NotificationSpec.Action muteAction = new NotificationSpec.Action();                                       </span>
<span class="-8110587689026159862" onmouseenter="enter('-8110587689026159862');" onmouseout="out('-8110587689026159862');" style=""> 377          muteAction.title = getString(R.string._pebble_watch_mute);                                                </span>
<span class="6211637458858479364" onmouseenter="enter('6211637458858479364');" onmouseout="out('6211637458858479364');" style=""> 378          muteAction.type = NotificationSpec.Action.TYPE_SYNTECTIC_MUTE;                                            </span>
<span class="1775691680583302265" onmouseenter="enter('1775691680583302265');" onmouseout="out('1775691680583302265');" style=""> 379          notificationSpec.attachedActions.add(muteAction);                                                         </span>
<span  style=""> 380                                                                                                                    </span>
<span class="-476558653827405923" onmouseenter="enter('-476558653827405923');" onmouseout="out('-476558653827405923');" style=""> 381          mNotificationHandleLookup.add(notificationSpec.getId(), sbn.getPostTime()); // for both DISMISS and OPEN  </span>
<span class="8153579199557574199" onmouseenter="enter('8153579199557574199');" onmouseout="out('8153579199557574199');" style=""> 382          mPackageLookup.add(notificationSpec.getId(), sbn.getPackageName()); // for MUTE                           </span>
<span  style=""> 383                                                                                                                    </span>
<span class="5979670797208442666" onmouseenter="enter('5979670797208442666');" onmouseout="out('5979670797208442666');" style=""> 384          notificationBurstPrevention.put(source, cur_time);                                                        </span>
<span class="-7718619408843379706" onmouseenter="enter('-7718619408843379706');" onmouseout="out('-7718619408843379706');" style=""> 385          notificationOldRepeatPrevention.put(source, notification.when);                                           </span>





<span  style=""> 386                                                                                                                    </span>
<span class="9189856510229218442" onmouseenter="enter('9189856510229218442');" onmouseout="out('9189856510229218442');" style=""> 387          GBApplication.deviceService().onNotification(notificationSpec);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388      }                                                                                                             </span>
<span  style=""> 389                                                                                                                    </span>
<span class="3489513600177556550" onmouseenter="enter('3489513600177556550');" onmouseout="out('3489513600177556550');" style=""> 390      private boolean checkNotificationContentForWhiteAndBlackList(String packageName, String body) {               </span>
<span class="-150679469252815152" onmouseenter="enter('-150679469252815152');" onmouseout="out('-150679469252815152');" style=""> 391          long start = System.currentTimeMillis();                                                                  </span>
<span  style=""> 392                                                                                                                    </span>
<span class="2124734257009739137" onmouseenter="enter('2124734257009739137');" onmouseout="out('2124734257009739137');" style=""> 393          List&lt;String&gt; wordsList = new ArrayList&lt;&gt;();                                                               </span>
<span class="8513213831196998490" onmouseenter="enter('8513213831196998490');" onmouseout="out('8513213831196998490');" style=""> 394          NotificationFilter notificationFilter;                                                                    </span>
<span  style=""> 395                                                                                                                    </span>
<span class="-4590804423150229551" onmouseenter="enter('-4590804423150229551');" onmouseout="out('-4590804423150229551');" style=""> 396          try (DBHandler db = GBApplication.acquireDB()) {                                                          </span>
<span  style=""> 397                                                                                                                    </span>
<span class="2403890883362572333" onmouseenter="enter('2403890883362572333');" onmouseout="out('2403890883362572333');" style=""> 398              NotificationFilterDao notificationFilterDao = db.getDaoSession().getNotificationFilterDao();          </span>
<span class="7254238877040119420" onmouseenter="enter('7254238877040119420');" onmouseout="out('7254238877040119420');" style=""><abbr title=" 399              NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilterEntryDao();"> 399              NotificationFilterEntryDao notificationFilterEntryDao = db.getDaoSession().getNotificationFilterEntryDðŸ”µ</abbr></span>
<span  style=""> 400                                                                                                                    </span>
<span class="-4728567184917764691" onmouseenter="enter('-4728567184917764691');" onmouseout="out('-4728567184917764691');" style=""><abbr title=" 401              Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFilterDao.Properties.AppIdentifier.eq(packageName.toLowerCase())).build();"> 401              Query&lt;NotificationFilter&gt; query = notificationFilterDao.queryBuilder().where(NotificationFilterDao.ProðŸ”µ</abbr></span>
<span class="7488324375938324162" onmouseenter="enter('7488324375938324162');" onmouseout="out('7488324375938324162');" style=""> 402              notificationFilter = query.unique();                                                                  </span>
<span  style=""> 403                                                                                                                    </span>
<span class="6018560877068628254" onmouseenter="enter('6018560877068628254');" onmouseout="out('6018560877068628254');" style=""> 404              if (notificationFilter == null) {                                                                     </span>
<span class="8510731869572739415" onmouseenter="enter('8510731869572739415');" onmouseout="out('8510731869572739415');" style=""> 405                  LOG.debug(&quot;No Notification Filter found&quot;);                                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 406                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 407              }                                                                                                     </span>
<span  style=""> 408                                                                                                                    </span>
<span class="3968012753441467210" onmouseenter="enter('3968012753441467210');" onmouseout="out('3968012753441467210');" style=""> 409              LOG.debug(&quot;Loaded notification filter for &#x27;{}&#x27;&quot;, packageName);                                        </span>
<span class="7966618056150210259" onmouseenter="enter('7966618056150210259');" onmouseout="out('7966618056150210259');" style=""><abbr title=" 410              Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().where(NotificationFilterEntryDao.Properties.NotificationFilterId.eq(notificationFilter.getId())).build();"> 410              Query&lt;NotificationFilterEntry&gt; queryEntries = notificationFilterEntryDao.queryBuilder().where(NotificaðŸ”µ</abbr></span>
<span  style=""> 411                                                                                                                    </span>
<span class="5592374987839394879" onmouseenter="enter('5592374987839394879');" onmouseout="out('5592374987839394879');" style=""> 412              List&lt;NotificationFilterEntry&gt; filterEntries = queryEntries.list();                                    </span>
<span  style=""> 413                                                                                                                    </span>
<span class="-8976969426120877151" onmouseenter="enter('-8976969426120877151');" onmouseout="out('-8976969426120877151');" style=""> 414              if (BuildConfig.DEBUG) {                                                                              </span>
<span class="-9170185973081630678" onmouseenter="enter('-9170185973081630678');" onmouseout="out('-9170185973081630678');" style=""> 415                  LOG.info(&quot;Database lookup took &#x27;{}&#x27; ms&quot;, System.currentTimeMillis() - start);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 416              }                                                                                                     </span>
<span  style=""> 417                                                                                                                    </span>
<span class="2077893056906600600" onmouseenter="enter('2077893056906600600');" onmouseout="out('2077893056906600600');" style=""> 418              if (!filterEntries.isEmpty()) {                                                                       </span>
<span class="4304008491784528731" onmouseenter="enter('4304008491784528731');" onmouseout="out('4304008491784528731');" style=""> 419                  for (NotificationFilterEntry temp : filterEntries) {                                              </span>
<span class="4808262139369052558" onmouseenter="enter('4808262139369052558');" onmouseout="out('4808262139369052558');" style=""> 420                      wordsList.add(temp.getNotificationFilterContent());                                           </span>
<span class="-2502897764394929378" onmouseenter="enter('-2502897764394929378');" onmouseout="out('-2502897764394929378');" style=""> 421                      LOG.debug(&quot;Loaded filter word: &quot; + temp.getNotificationFilterContent());                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 422                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 423              }                                                                                                     </span>
<span  style=""> 424                                                                                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 425          } catch (Exception e) {                                                                                   </span>
<span class="-7390176680812789235" onmouseenter="enter('-7390176680812789235');" onmouseout="out('-7390176680812789235');" style=""> 426              LOG.error(&quot;Could not acquire DB.&quot;, e);                                                                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 427              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 428          }                                                                                                         </span>
<span  style=""> 429                                                                                                                    </span>
<span class="-2837061757343239904" onmouseenter="enter('-2837061757343239904');" onmouseout="out('-2837061757343239904');" style=""> 430          return shouldContinueAfterFilter(body, wordsList, notificationFilter);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 431 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 432 +                                                                                                                  </span>
<span class="-5392793857622727834" onmouseenter="enter('-5392793857622727834');" onmouseout="out('-5392793857622727834');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 433 +    private void handleCallNotification(StatusBarNotification sbn) {                                              </span>
<span class="-2635029824573834340" onmouseenter="enter('-2635029824573834340');" onmouseout="out('-2635029824573834340');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 434 +        String app = sbn.getPackageName();                                                                        </span>
<span class="-4765460655732789674" onmouseenter="enter('-4765460655732789674');" onmouseout="out('-4765460655732789674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 435 +        LOG.debug(&quot;got call from: &quot; + app);                                                                       </span>
<span class="-1087669074367115225" onmouseenter="enter('-1087669074367115225');" onmouseout="out('-1087669074367115225');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 436 +        if(app.equals(&quot;com.android.dialer&quot;)) {                                                                    </span>
<span class="5503604353212721032" onmouseenter="enter('5503604353212721032');" onmouseout="out('5503604353212721032');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 437 +            LOG.debug(&quot;Ignoring non-voip call&quot;);                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 438 +            return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 439 +        }                                                                                                         </span>
<span class="2515184326717332924" onmouseenter="enter('2515184326717332924');" onmouseout="out('2515184326717332924');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 440 +        Notification noti = sbn.getNotification();                                                                </span>
<span class="4917333921300541045" onmouseenter="enter('4917333921300541045');" onmouseout="out('4917333921300541045');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 441 +        dumpExtras(noti.extras);                                                                                  </span>
<span class="7056760971959382883" onmouseenter="enter('7056760971959382883');" onmouseout="out('7056760971959382883');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 442 +        if(noti.actions != null &amp;&amp; noti.actions.length &gt; 0) {                                                     </span>
<span class="-8283553374130078748" onmouseenter="enter('-8283553374130078748');" onmouseout="out('-8283553374130078748');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 443 +            for (Notification.Action action : noti.actions) {                                                     </span>
<span class="4712881017428392998" onmouseenter="enter('4712881017428392998');" onmouseout="out('4712881017428392998');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 444 +                LOG.info(&quot;Found call action: &quot; + action.title);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 445 +            }                                                                                                     </span>
<span class="5573696862010733553" onmouseenter="enter('5573696862010733553');" onmouseout="out('5573696862010733553');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 446 +            /*try {                                                                                               </span>
<span class="-4941077910751273482" onmouseenter="enter('-4941077910751273482');" onmouseout="out('-4941077910751273482');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 447 +                LOG.info(&quot;Executing first action&quot;);                                                               </span>
<span class="-6079407865140020178" onmouseenter="enter('-6079407865140020178');" onmouseout="out('-6079407865140020178');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 448 +                noti.actions[0].actionIntent.send();                                                              </span>
<span class="692957943310260032" onmouseenter="enter('692957943310260032');" onmouseout="out('692957943310260032');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 449 +            } catch (PendingIntent.CanceledException e) {                                                         </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 450 +                e.printStackTrace();                                                                              </span>
<span class="-2684617365274670769" onmouseenter="enter('-2684617365274670769');" onmouseout="out('-2684617365274670769');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 451 +            }*/                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 452 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 453 +                                                                                                                  </span>
<span class="-2563571895899526728" onmouseenter="enter('-2563571895899526728');" onmouseout="out('-2563571895899526728');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 454 +        // figure out sender                                                                                      </span>
<span class="-9123115817740196080" onmouseenter="enter('-9123115817740196080');" onmouseout="out('-9123115817740196080');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 455 +        String number;                                                                                            </span>
<span class="-83871468585037136" onmouseenter="enter('-83871468585037136');" onmouseout="out('-83871468585037136');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 456 +        if(noti.extras.containsKey(Notification.EXTRA_PEOPLE)) {                                                  </span>
<span class="-9087853976002790509" onmouseenter="enter('-9087853976002790509');" onmouseout="out('-9087853976002790509');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 457 +            number = noti.extras.getString(Notification.EXTRA_PEOPLE);                                            </span>
<span class="-2430024668957447800" onmouseenter="enter('-2430024668957447800');" onmouseout="out('-2430024668957447800');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 458 +        } else if(noti.extras.containsKey(Notification.EXTRA_TITLE)) {                                            </span>
<span class="-6437685763050744480" onmouseenter="enter('-6437685763050744480');" onmouseout="out('-6437685763050744480');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 459 +            number = noti.extras.getString(Notification.EXTRA_TITLE);                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 460 +        } else {                                                                                                  </span>
<span class="8266080573880164526" onmouseenter="enter('8266080573880164526');" onmouseout="out('8266080573880164526');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 461 +            String appName = getAppName(app);                                                                     </span>
<span class="3077870662190147275" onmouseenter="enter('3077870662190147275');" onmouseout="out('3077870662190147275');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 462 +            number = appName != null ? appName : app;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 463 +        }                                                                                                         </span>
<span class="-2521654618349415592" onmouseenter="enter('-2521654618349415592');" onmouseout="out('-2521654618349415592');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 464 +        activeCallPostTime = sbn.getPostTime();                                                                   </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 465 +        CallSpec callSpec = new CallSpec();                                                                       </span>
<span class="6754379566106160474" onmouseenter="enter('6754379566106160474');" onmouseout="out('6754379566106160474');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 466 +        callSpec.number = number;                                                                                 </span>
<span class="-4416193589830976087" onmouseenter="enter('-4416193589830976087');" onmouseout="out('-4416193589830976087');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 467 +        callSpec.command = CallSpec.CALL_INCOMING;                                                                </span>
<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 468 +        GBApplication.deviceService().onSetCallState(callSpec);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469      }                                                                                                             </span>
<span  style=""> 470                                                                                                                    </span>
<span class="2011726315289648221" onmouseenter="enter('2011726315289648221');" onmouseout="out('2011726315289648221');" style=""><abbr title=" 471      boolean shouldContinueAfterFilter(@NonNull String body, @NonNull List&lt;String&gt; wordsList, @NonNull NotificationFilter notificationFilter) {"> 471      boolean shouldContinueAfterFilter(@NonNull String body, @NonNull List&lt;String&gt; wordsList, @NonNull NotificationðŸ”µ</abbr></span>
<span  style=""> 472                                                                                                                    </span>
<span class="-2049928826508332953" onmouseenter="enter('-2049928826508332953');" onmouseout="out('-2049928826508332953');" style=""><abbr title=" 473          LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterMode(), notificationFilter.getNotificationFilterSubMode(), wordsList);"> 473          LOG.debug(&quot;Mode: &#x27;{}&#x27; Submode: &#x27;{}&#x27; WordsList: &#x27;{}&#x27;&quot;, notificationFilter.getNotificationFilterMode(), notiðŸ”µ</abbr></span>
<span  style=""> 474                                                                                                                    </span>
<span class="2466831550918903346" onmouseenter="enter('2466831550918903346');" onmouseout="out('2466831550918903346');" style=""> 475          boolean allMode = notificationFilter.getNotificationFilterSubMode() == NOTIFICATION_FILTER_SUBMODE_ALL;   </span>
<span  style=""> 476                                                                                                                    </span>
<span class="7111790076547269568" onmouseenter="enter('7111790076547269568');" onmouseout="out('7111790076547269568');" style=""> 477          switch (notificationFilter.getNotificationFilterMode()) {                                                 </span>
<span class="9010216302027839769" onmouseenter="enter('9010216302027839769');" onmouseout="out('9010216302027839769');" style=""> 478              case NOTIFICATION_FILTER_MODE_BLACKLIST:                                                              </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 479                  if (allMode) {                                                                                    </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 480                      for (String word : wordsList) {                                                               </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 481                          if (!body.contains(word)) {                                                               </span>
<span class="-6541716343086786985" onmouseenter="enter('-6541716343086786985');" onmouseout="out('-6541716343086786985');" style=""> 482                              LOG.info(&quot;Not every word was found, blacklist has no effect, processing continues.&quot;); </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 483                              return true;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 484                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485                      }                                                                                             </span>
<span class="7128342962819519611" onmouseenter="enter('7128342962819519611');" onmouseout="out('7128342962819519611');" style=""> 486                      LOG.info(&quot;Every word was found, blacklist has effect, processing stops.&quot;);                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 487                      return false;                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 488                  } else {                                                                                          </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""> 489                      boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));  </span>
<span class="-6184990871390026912" onmouseenter="enter('-6184990871390026912');" onmouseout="out('-6184990871390026912');" style=""> 490                      if (!containsAny) {                                                                           </span>
<span class="-8299034583350120850" onmouseenter="enter('-8299034583350120850');" onmouseout="out('-8299034583350120850');" style=""> 491                          LOG.info(&quot;No matching word was found, blacklist has no effect, processing continues.&quot;);   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 492                      } else {                                                                                      </span>
<span class="-1380690990253575343" onmouseenter="enter('-1380690990253575343');" onmouseout="out('-1380690990253575343');" style=""> 493                          LOG.info(&quot;At least one matching word was found, blacklist has effect, processing stops.&quot;);</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494                      }                                                                                             </span>
<span class="3895372753413352625" onmouseenter="enter('3895372753413352625');" onmouseout="out('3895372753413352625');" style=""> 495                      return !containsAny;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 496                  }                                                                                                 </span>
<span  style=""> 497                                                                                                                    </span>
<span class="-7619441502433256183" onmouseenter="enter('-7619441502433256183');" onmouseout="out('-7619441502433256183');" style=""> 498              case NOTIFICATION_FILTER_MODE_WHITELIST:                                                              </span>
<span class="2530612981344747040" onmouseenter="enter('2530612981344747040');" onmouseout="out('2530612981344747040');" style=""> 499                  if (allMode) {                                                                                    </span>
<span class="127350092598948777" onmouseenter="enter('127350092598948777');" onmouseout="out('127350092598948777');" style=""> 500                      for (String word : wordsList) {                                                               </span>
<span class="-7363427370726711737" onmouseenter="enter('-7363427370726711737');" onmouseout="out('-7363427370726711737');" style=""> 501                          if (!body.contains(word)) {                                                               </span>
<span class="-2193044683137963048" onmouseenter="enter('-2193044683137963048');" onmouseout="out('-2193044683137963048');" style=""> 502                              LOG.info(&quot;Not every word was found, whitelist has no effect, processing stops.&quot;);     </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 503                              return false;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 504                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 505                      }                                                                                             </span>
<span class="7060257086642023362" onmouseenter="enter('7060257086642023362');" onmouseout="out('7060257086642023362');" style=""> 506                      LOG.info(&quot;Every word was found, whitelist has effect, processing continues.&quot;);                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 507                      return true;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 508                  } else {                                                                                          </span>
<span class="4525513444402460157" onmouseenter="enter('4525513444402460157');" onmouseout="out('4525513444402460157');" style=""> 509                      boolean containsAny = StringUtils.containsAny(body, wordsList.toArray(new CharSequence[0]));  </span>
<span class="-340597820517180781" onmouseenter="enter('-340597820517180781');" onmouseout="out('-340597820517180781');" style=""> 510                      if (containsAny) {                                                                            </span>
<span class="-1881072703439588003" onmouseenter="enter('-1881072703439588003');" onmouseout="out('-1881072703439588003');" style=""><abbr title=" 511                          LOG.info(&quot;At least one matching word was found, whitelist has effect, processing continues.&quot;);"> 511                          LOG.info(&quot;At least one matching word was found, whitelist has effect, processing continuesðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 512                      } else {                                                                                      </span>
<span class="2098487797015691396" onmouseenter="enter('2098487797015691396');" onmouseout="out('2098487797015691396');" style=""> 513                          LOG.info(&quot;No matching word was found, whitelist has no effect, processing stops.&quot;);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 514                      }                                                                                             </span>
<span class="1941886136813063182" onmouseenter="enter('1941886136813063182');" onmouseout="out('1941886136813063182');" style=""> 515                      return containsAny;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 516                  }                                                                                                 </span>
<span  style=""> 517                                                                                                                    </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 518              default:                                                                                              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 519                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 520          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 521      }                                                                                                             </span>
<span  style=""> 522                                                                                                                    </span>
<span class="-522333448184701526" onmouseenter="enter('-522333448184701526');" onmouseout="out('-522333448184701526');" style=""> 523      // Strip Unicode control sequences: some apps like Telegram add a lot of them for unknown reasons             </span>
<span class="-8731468808345203749" onmouseenter="enter('-8731468808345203749');" onmouseout="out('-8731468808345203749');" style=""> 524      private String sanitizeUnicode(String orig) {                                                                 </span>
<span class="3980018359364350746" onmouseenter="enter('3980018359364350746');" onmouseout="out('3980018359364350746');" style=""> 525          return orig.replaceAll(&quot;\\p{C}&quot;, &quot;&quot;);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 526      }                                                                                                             </span>
<span  style=""> 527                                                                                                                    </span>
<span class="-9171831878462980109" onmouseenter="enter('-9171831878462980109');" onmouseout="out('-9171831878462980109');" style=""> 528      private void dissectNotificationTo(Notification notification, NotificationSpec notificationSpec,              </span>
<span class="2688021293853549872" onmouseenter="enter('2688021293853549872');" onmouseout="out('2688021293853549872');" style=""> 529                                         boolean preferBigText) {                                                   </span>
<span  style=""> 530                                                                                                                    </span>
<span class="-4856559942663327722" onmouseenter="enter('-4856559942663327722');" onmouseout="out('-4856559942663327722');" style=""> 531          Bundle extras = NotificationCompat.getExtras(notification);                                               </span>
<span  style=""> 532                                                                                                                    </span>
<span class="1218249610901206964" onmouseenter="enter('1218249610901206964');" onmouseout="out('1218249610901206964');" style=""> 533          //dumpExtras(extras);                                                                                     </span>
<span  style=""> 534                                                                                                                    </span>
<span class="-6997230475683564369" onmouseenter="enter('-6997230475683564369');" onmouseout="out('-6997230475683564369');" style=""> 535          CharSequence title = extras.getCharSequence(Notification.EXTRA_TITLE);                                    </span>
<span class="-5768442231641885516" onmouseenter="enter('-5768442231641885516');" onmouseout="out('-5768442231641885516');" style=""> 536          if (title != null) {                                                                                      </span>
<span class="3486456028705164748" onmouseenter="enter('3486456028705164748');" onmouseout="out('3486456028705164748');" style=""> 537              notificationSpec.title = sanitizeUnicode(title.toString());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 538          }                                                                                                         </span>
<span  style=""> 539                                                                                                                    </span>
<span class="-1675348653102168964" onmouseenter="enter('-1675348653102168964');" onmouseout="out('-1675348653102168964');" style=""> 540          CharSequence contentCS = null;                                                                            </span>
<span class="7665214774958344559" onmouseenter="enter('7665214774958344559');" onmouseout="out('7665214774958344559');" style=""> 541          if (preferBigText &amp;&amp; extras.containsKey(Notification.EXTRA_BIG_TEXT)) {                                   </span>
<span class="3933802215223175306" onmouseenter="enter('3933802215223175306');" onmouseout="out('3933802215223175306');" style=""> 542              contentCS = extras.getCharSequence(NotificationCompat.EXTRA_BIG_TEXT);                                </span>
<span class="8631000860903630717" onmouseenter="enter('8631000860903630717');" onmouseout="out('8631000860903630717');" style=""> 543          } else if (extras.containsKey(Notification.EXTRA_TEXT)) {                                                 </span>
<span class="-7547654609103611854" onmouseenter="enter('-7547654609103611854');" onmouseout="out('-7547654609103611854');" style=""> 544              contentCS = extras.getCharSequence(NotificationCompat.EXTRA_TEXT);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 545          }                                                                                                         </span>
<span class="-2707602363986640259" onmouseenter="enter('-2707602363986640259');" onmouseout="out('-2707602363986640259');" style=""> 546          if (contentCS != null) {                                                                                  </span>
<span class="-5564526501110527191" onmouseenter="enter('-5564526501110527191');" onmouseout="out('-5564526501110527191');" style=""> 547              notificationSpec.body = sanitizeUnicode(contentCS.toString());                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 548          }                                                                                                         </span>
<span  style=""> 549                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 550      }                                                                                                             </span>
<span  style=""> 551                                                                                                                    </span>
<span class="-7937366375312895792" onmouseenter="enter('-7937366375312895792');" onmouseout="out('-7937366375312895792');" style=""> 552      private boolean isServiceRunning() {                                                                          </span>
<span class="-8788124079324077188" onmouseenter="enter('-8788124079324077188');" onmouseout="out('-8788124079324077188');" style=""> 553          ActivityManager manager = (ActivityManager) getSystemService(ACTIVITY_SERVICE);                           </span>
<span class="5841398637891737551" onmouseenter="enter('5841398637891737551');" onmouseout="out('5841398637891737551');" style=""> 554          if (manager == null) {                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 555              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 556          }                                                                                                         </span>
<span class="-1060000448595061247" onmouseenter="enter('-1060000448595061247');" onmouseout="out('-1060000448595061247');" style=""> 557          for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) {        </span>
<span class="1715383852667790939" onmouseenter="enter('1715383852667790939');" onmouseout="out('1715383852667790939');" style=""> 558              if (DeviceCommunicationService.class.getName().equals(service.service.getClassName())) {              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 559                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 560              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 561          }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 562          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 563      }                                                                                                             </span>
<span  style=""> 564                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 565      /**                                                                                                           </span>
<span class="-3386513456391723953" onmouseenter="enter('-3386513456391723953');" onmouseout="out('-3386513456391723953');" style=""> 566       * Try to handle media session notifications that tell info about the current play state.                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 567       *                                                                                                            </span>
<span class="-2019490562393536710" onmouseenter="enter('-2019490562393536710');" onmouseout="out('-2019490562393536710');" style=""> 568       * @param mediaSession The mediasession to handle.                                                            </span>
<span class="1642728463279900605" onmouseenter="enter('1642728463279900605');" onmouseout="out('1642728463279900605');" style=""> 569       * @return true if notification was handled, false otherwise                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 570       */                                                                                                           </span>
<span class="1254895864500637019" onmouseenter="enter('1254895864500637019');" onmouseout="out('1254895864500637019');" style=""> 571      public boolean handleMediaSessionNotification(MediaSessionCompat.Token mediaSession) {                        </span>
<span class="-4606570715029334060" onmouseenter="enter('-4606570715029334060');" onmouseout="out('-4606570715029334060');" style=""> 572          MusicSpec musicSpec = new MusicSpec();                                                                    </span>
<span class="6191411421956413825" onmouseenter="enter('6191411421956413825');" onmouseout="out('6191411421956413825');" style=""> 573          MusicStateSpec stateSpec = new MusicStateSpec();                                                          </span>
<span  style=""> 574                                                                                                                    </span>
<span class="-6296053285913663629" onmouseenter="enter('-6296053285913663629');" onmouseout="out('-6296053285913663629');" style=""> 575          MediaControllerCompat c;                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 576          try {                                                                                                     </span>
<span class="7437011440923722104" onmouseenter="enter('7437011440923722104');" onmouseout="out('7437011440923722104');" style=""> 577              c = new MediaControllerCompat(getApplicationContext(), mediaSession);                                 </span>
<span  style=""> 578                                                                                                                    </span>
<span class="-1916914550610898815" onmouseenter="enter('-1916914550610898815');" onmouseout="out('-1916914550610898815');" style=""> 579              PlaybackStateCompat s = c.getPlaybackState();                                                         </span>
<span class="-2990817606835558686" onmouseenter="enter('-2990817606835558686');" onmouseout="out('-2990817606835558686');" style=""> 580              stateSpec.position = (int) (s.getPosition() / 1000);                                                  </span>
<span class="5328288853423061088" onmouseenter="enter('5328288853423061088');" onmouseout="out('5328288853423061088');" style=""> 581              stateSpec.playRate = Math.round(100 * s.getPlaybackSpeed());                                          </span>
<span class="2323238932425227387" onmouseenter="enter('2323238932425227387');" onmouseout="out('2323238932425227387');" style=""> 582              stateSpec.repeat = 1;                                                                                 </span>
<span class="-2798957985679932557" onmouseenter="enter('-2798957985679932557');" onmouseout="out('-2798957985679932557');" style=""> 583              stateSpec.shuffle = 1;                                                                                </span>
<span class="1453024666101612078" onmouseenter="enter('1453024666101612078');" onmouseout="out('1453024666101612078');" style=""> 584              switch (s.getState()) {                                                                               </span>
<span class="-7604550062433163488" onmouseenter="enter('-7604550062433163488');" onmouseout="out('-7604550062433163488');" style=""> 585                  case PlaybackState.STATE_PLAYING:                                                                 </span>
<span class="-5997751080810805230" onmouseenter="enter('-5997751080810805230');" onmouseout="out('-5997751080810805230');" style=""> 586                      stateSpec.state = MusicStateSpec.STATE_PLAYING;                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 587                      break;                                                                                        </span>
<span class="4895305209877093306" onmouseenter="enter('4895305209877093306');" onmouseout="out('4895305209877093306');" style=""> 588                  case PlaybackState.STATE_STOPPED:                                                                 </span>
<span class="7340128138398857774" onmouseenter="enter('7340128138398857774');" onmouseout="out('7340128138398857774');" style=""> 589                      stateSpec.state = MusicStateSpec.STATE_STOPPED;                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 590                      break;                                                                                        </span>
<span class="-7061407832272958754" onmouseenter="enter('-7061407832272958754');" onmouseout="out('-7061407832272958754');" style=""> 591                  case PlaybackState.STATE_PAUSED:                                                                  </span>
<span class="928317678007732085" onmouseenter="enter('928317678007732085');" onmouseout="out('928317678007732085');" style=""> 592                      stateSpec.state = MusicStateSpec.STATE_PAUSED;                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 593                      break;                                                                                        </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 594                  default:                                                                                          </span>
<span class="1494209818965165815" onmouseenter="enter('1494209818965165815');" onmouseout="out('1494209818965165815');" style=""> 595                      stateSpec.state = MusicStateSpec.STATE_UNKNOWN;                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 596                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 597              }                                                                                                     </span>
<span  style=""> 598                                                                                                                    </span>
<span class="-1378394649293702376" onmouseenter="enter('-1378394649293702376');" onmouseout="out('-1378394649293702376');" style=""> 599              MediaMetadataCompat d = c.getMetadata();                                                              </span>
<span class="1381395247865936457" onmouseenter="enter('1381395247865936457');" onmouseout="out('1381395247865936457');" style=""> 600              if (d == null)                                                                                        </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 601                  return false;                                                                                     </span>
<span class="7299474512588472960" onmouseenter="enter('7299474512588472960');" onmouseout="out('7299474512588472960');" style=""> 602              if (d.containsKey(MediaMetadata.METADATA_KEY_ARTIST))                                                 </span>
<span class="-145858411899069051" onmouseenter="enter('-145858411899069051');" onmouseout="out('-145858411899069051');" style=""> 603                  musicSpec.artist = d.getString(MediaMetadataCompat.METADATA_KEY_ARTIST);                          </span>
<span class="563580125723474981" onmouseenter="enter('563580125723474981');" onmouseout="out('563580125723474981');" style=""> 604              if (d.containsKey(MediaMetadata.METADATA_KEY_ALBUM))                                                  </span>
<span class="1803038863600841979" onmouseenter="enter('1803038863600841979');" onmouseout="out('1803038863600841979');" style=""> 605                  musicSpec.album = d.getString(MediaMetadataCompat.METADATA_KEY_ALBUM);                            </span>
<span class="-1766324950453780005" onmouseenter="enter('-1766324950453780005');" onmouseout="out('-1766324950453780005');" style=""> 606              if (d.containsKey(MediaMetadata.METADATA_KEY_TITLE))                                                  </span>
<span class="-6541941403865600636" onmouseenter="enter('-6541941403865600636');" onmouseout="out('-6541941403865600636');" style=""> 607                  musicSpec.track = d.getString(MediaMetadataCompat.METADATA_KEY_TITLE);                            </span>
<span class="-690335942087370936" onmouseenter="enter('-690335942087370936');" onmouseout="out('-690335942087370936');" style=""> 608              if (d.containsKey(MediaMetadata.METADATA_KEY_DURATION))                                               </span>
<span class="-139118447155224577" onmouseenter="enter('-139118447155224577');" onmouseout="out('-139118447155224577');" style=""> 609                  musicSpec.duration = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_DURATION) / 1000;           </span>
<span class="6028497768136929228" onmouseenter="enter('6028497768136929228');" onmouseout="out('6028497768136929228');" style=""> 610              if (d.containsKey(MediaMetadata.METADATA_KEY_NUM_TRACKS))                                             </span>
<span class="6703481613150545995" onmouseenter="enter('6703481613150545995');" onmouseout="out('6703481613150545995');" style=""> 611                  musicSpec.trackCount = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_NUM_TRACKS);              </span>
<span class="3843094866204545202" onmouseenter="enter('3843094866204545202');" onmouseout="out('3843094866204545202');" style=""> 612              if (d.containsKey(MediaMetadata.METADATA_KEY_TRACK_NUMBER))                                           </span>
<span class="1727735009143440653" onmouseenter="enter('1727735009143440653');" onmouseout="out('1727735009143440653');" style=""> 613                  musicSpec.trackNr = (int) d.getLong(MediaMetadataCompat.METADATA_KEY_TRACK_NUMBER);               </span>
<span  style=""> 614                                                                                                                    </span>
<span class="2207286164059072520" onmouseenter="enter('2207286164059072520');" onmouseout="out('2207286164059072520');" style=""> 615              // finally, tell the device about it                                                                  </span>
<span class="7157573786903835889" onmouseenter="enter('7157573786903835889');" onmouseout="out('7157573786903835889');" style=""> 616              GBApplication.deviceService().onSetMusicInfo(musicSpec);                                              </span>
<span class="-6342881769260875577" onmouseenter="enter('-6342881769260875577');" onmouseout="out('-6342881769260875577');" style=""> 617              GBApplication.deviceService().onSetMusicState(stateSpec);                                             </span>
<span  style=""> 618                                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 619              return true;                                                                                          </span>
<span class="3226201684513186940" onmouseenter="enter('3226201684513186940');" onmouseout="out('3226201684513186940');" style=""> 620          } catch (NullPointerException | RemoteException e) {                                                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 621              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 622          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 623      }                                                                                                             </span>
<span  style=""> 624                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 625      @Override                                                                                                     </span>
<span class="2733031363552103422" onmouseenter="enter('2733031363552103422');" onmouseout="out('2733031363552103422');" style=""> 626      public void onNotificationRemoved(StatusBarNotification sbn) {                                                </span>
<span class="-4502832560681421381" onmouseenter="enter('-4502832560681421381');" onmouseout="out('-4502832560681421381');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 627 +        LOG.info(&quot;Notification removed: &quot; + sbn.getPackageName() + &quot;: &quot; + sbn.getNotification().category);        </span>
<span class="940449061862943006" onmouseenter="enter('940449061862943006');" onmouseout="out('940449061862943006');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 628 +        if(Notification.CATEGORY_CALL.equals(sbn.getNotification().category) &amp;&amp; activeCallPostTime == sbn.getPostTime()) {"> 628 +        if(Notification.CATEGORY_CALL.equals(sbn.getNotification().category) &amp;&amp; activeCallPostTime == sbn.getPostTðŸ”µ</abbr></span>
<span class="-3941810167705609591" onmouseenter="enter('-3941810167705609591');" onmouseout="out('-3941810167705609591');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 629 +            activeCallPostTime = 0;                                                                               </span>
<span class="3795479724098101655" onmouseenter="enter('3795479724098101655');" onmouseout="out('3795479724098101655');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 630 +            CallSpec callSpec = new CallSpec();                                                                   </span>
<span class="-7261749156805075102" onmouseenter="enter('-7261749156805075102');" onmouseout="out('-7261749156805075102');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 631 +            callSpec.command = CallSpec.CALL_END;                                                                 </span>
<span class="-10750277001379324" onmouseenter="enter('-10750277001379324');" onmouseout="out('-10750277001379324');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 632 +            GBApplication.deviceService().onSetCallState(callSpec);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 633 +        }                                                                                                         </span>
<span class="-7767930678383346096" onmouseenter="enter('-7767930678383346096');" onmouseout="out('-7767930678383346096');" style=""> 634          // FIXME: DISABLED for now                                                                                </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 635          /*                                                                                                        </span>
<span class="1980360516715691973" onmouseenter="enter('1980360516715691973');" onmouseout="out('1980360516715691973');" style=""> 636          if (shouldIgnore(sbn))                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 637              return;                                                                                               </span>
<span  style=""> 638                                                                                                                    </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 639          Prefs prefs = GBApplication.getPrefs();                                                                   </span>
<span class="-1523052147845593738" onmouseenter="enter('-1523052147845593738');" onmouseout="out('-1523052147845593738');" style=""> 640          if (prefs.getBoolean(&quot;autoremove_notifications&quot;, false)) {                                                </span>
<span class="-1849447037737481789" onmouseenter="enter('-1849447037737481789');" onmouseout="out('-1849447037737481789');" style=""> 641              LOG.info(&quot;notification removed, will ask device to delete it&quot;);                                       </span>
<span class="-8504489390442611809" onmouseenter="enter('-8504489390442611809');" onmouseout="out('-8504489390442611809');" style=""> 642              GBApplication.deviceService().onDeleteNotification((int) sbn.getPostTime());                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 643          }                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 644          */                                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 645      }                                                                                                             </span>
<span  style=""> 646                                                                                                                    </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 647 -    /*                                                                                                            </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 648 +                                                                                                                  </span>
<span class="2967918509730451591" onmouseenter="enter('2967918509730451591');" onmouseout="out('2967918509730451591');" style=""> 649      private void dumpExtras(Bundle bundle) {                                                                      </span>
<span class="-755508411737932855" onmouseenter="enter('-755508411737932855');" onmouseout="out('-755508411737932855');" style=""> 650          for (String key : bundle.keySet()) {                                                                      </span>
<span class="-680967060076152312" onmouseenter="enter('-680967060076152312');" onmouseout="out('-680967060076152312');" style=""> 651              Object value = bundle.get(key);                                                                       </span>
<span class="-5708365098537636921" onmouseenter="enter('-5708365098537636921');" onmouseout="out('-5708365098537636921');" style=""> 652              if (value == null) {                                                                                  </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 653                  continue;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 654              }                                                                                                     </span>
<span class="6935438865287804705" onmouseenter="enter('6935438865287804705');" onmouseout="out('6935438865287804705');" style=""><abbr title=" 655              LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClass().getName()));"> 655              LOG.debug(String.format(&quot;Notification extra: %s %s (%s)&quot;, key, value.toString(), value.getClass().getNðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 656          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 657      }                                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 658 -    */                                                                                                            </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 659 +                                                                                                                  </span>
<span  style=""> 660                                                                                                                    </span>
<span class="-4145111049531346189" onmouseenter="enter('-4145111049531346189');" onmouseout="out('-4145111049531346189');" style=""> 661      private boolean shouldIgnore(StatusBarNotification sbn) {                                                     </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 662          /*                                                                                                        </span>
<span class="8751388135302008830" onmouseenter="enter('8751388135302008830');" onmouseout="out('8751388135302008830');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 663 -        * return early if DeviceCommunicationService is not running,                                              </span>
<span class="2502615223278385984" onmouseenter="enter('2502615223278385984');" onmouseout="out('2502615223278385984');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 664 -        * else the service would get started every time we get a notification.                                    </span>
<span class="-5425061837888704430" onmouseenter="enter('-5425061837888704430');" onmouseout="out('-5425061837888704430');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 665 -        * unfortunately we cannot enable/disable NotificationListener at runtime like we do with                  </span>
<span class="4838982710001585921" onmouseenter="enter('4838982710001585921');" onmouseout="out('4838982710001585921');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 666 -        * broadcast receivers because it seems to invalidate the permissions that are                             </span>
<span class="-2921629841702414230" onmouseenter="enter('-2921629841702414230');" onmouseout="out('-2921629841702414230');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 667 -        * necessary for NotificationListenerService                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 668 -        */                                                                                                        </span>
<span class="8751388135302008830" onmouseenter="enter('8751388135302008830');" onmouseout="out('8751388135302008830');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 669 +         * return early if DeviceCommunicationService is not running,                                             </span>
<span class="2502615223278385984" onmouseenter="enter('2502615223278385984');" onmouseout="out('2502615223278385984');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 670 +         * else the service would get started every time we get a notification.                                   </span>
<span class="-5425061837888704430" onmouseenter="enter('-5425061837888704430');" onmouseout="out('-5425061837888704430');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 671 +         * unfortunately we cannot enable/disable NotificationListener at runtime like we do with                 </span>
<span class="4838982710001585921" onmouseenter="enter('4838982710001585921');" onmouseout="out('4838982710001585921');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 672 +         * broadcast receivers because it seems to invalidate the permissions that are                            </span>
<span class="-2921629841702414230" onmouseenter="enter('-2921629841702414230');" onmouseout="out('-2921629841702414230');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 673 +         * necessary for NotificationListenerService                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 674 +         */                                                                                                       </span>
<span class="-3255765405089884099" onmouseenter="enter('-3255765405089884099');" onmouseout="out('-3255765405089884099');" style=""> 675          if (!isServiceRunning() || sbn == null) {                                                                 </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 676              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 677          }                                                                                                         </span>
<span  style=""> 678                                                                                                                    </span>
<span class="8647073884367840020" onmouseenter="enter('8647073884367840020');" onmouseout="out('8647073884367840020');" style=""> 679          return shouldIgnoreSource(sbn.getPackageName()) || shouldIgnoreNotification(                              </span>
<span class="-1392203204106720793" onmouseenter="enter('-1392203204106720793');" onmouseout="out('-1392203204106720793');" style=""> 680                  sbn.getNotification(), sbn.getPackageName());                                                     </span>
<span  style=""> 681                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 682      }                                                                                                             </span>
<span  style=""> 683                                                                                                                    </span>
<span class="8460515521985572441" onmouseenter="enter('8460515521985572441');" onmouseout="out('8460515521985572441');" style=""> 684      private boolean shouldIgnoreSource(String source) {                                                           </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 685          Prefs prefs = GBApplication.getPrefs();                                                                   </span>
<span  style=""> 686                                                                                                                    </span>
<span class="714714039810027052" onmouseenter="enter('714714039810027052');" onmouseout="out('714714039810027052');" style=""> 687          /* do not display messages from &quot;android&quot;                                                                 </span>
<span class="1893274482542565547" onmouseenter="enter('1893274482542565547');" onmouseout="out('1893274482542565547');" style=""> 688           * This includes keyboard selection message, usb connection messages, etc                                 </span>
<span class="-7750906811397804767" onmouseenter="enter('-7750906811397804767');" onmouseout="out('-7750906811397804767');" style=""> 689           * Hope it does not filter out too much, we will see...                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 690           */                                                                                                       </span>
<span  style=""> 691                                                                                                                    </span>
<span class="1872165376889396003" onmouseenter="enter('1872165376889396003');" onmouseout="out('1872165376889396003');" style=""> 692          if (source.equals(&quot;android&quot;) ||                                                                           </span>
<span class="1446354513639890825" onmouseenter="enter('1446354513639890825');" onmouseout="out('1446354513639890825');" style=""> 693                  source.equals(&quot;com.android.systemui&quot;) ||                                                          </span>
<span class="-4630583015863350357" onmouseenter="enter('-4630583015863350357');" onmouseout="out('-4630583015863350357');" style=""> 694                  source.equals(&quot;com.android.dialer&quot;) ||                                                            </span>
<span class="-4581680912095398334" onmouseenter="enter('-4581680912095398334');" onmouseout="out('-4581680912095398334');" style=""> 695                  source.equals(&quot;com.cyanogenmod.eleven&quot;)) {                                                        </span>
<span class="7414276835277607055" onmouseenter="enter('7414276835277607055');" onmouseout="out('7414276835277607055');" style=""> 696              LOG.info(&quot;Ignoring notification, is a system event&quot;);                                                 </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 697              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 698          }                                                                                                         </span>
<span  style=""> 699                                                                                                                    </span>
<span class="6340978795702098449" onmouseenter="enter('6340978795702098449');" onmouseout="out('6340978795702098449');" style=""> 700          if (source.equals(&quot;com.moez.QKSMS&quot;) ||                                                                    </span>
<span class="3673317982547560929" onmouseenter="enter('3673317982547560929');" onmouseout="out('3673317982547560929');" style=""> 701                  source.equals(&quot;com.android.mms&quot;) ||                                                               </span>
<span class="-6538830744852229820" onmouseenter="enter('-6538830744852229820');" onmouseout="out('-6538830744852229820');" style=""> 702                  source.equals(&quot;com.sonyericsson.conversations&quot;) ||                                                </span>
<span class="-1795882970722883910" onmouseenter="enter('-1795882970722883910');" onmouseout="out('-1795882970722883910');" style=""> 703                  source.equals(&quot;com.android.messaging&quot;) ||                                                         </span>
<span class="4780395695457664313" onmouseenter="enter('4780395695457664313');" onmouseout="out('4780395695457664313');" style=""> 704                  source.equals(&quot;org.smssecure.smssecure&quot;)) {                                                       </span>
<span class="7115714847551904856" onmouseenter="enter('7115714847551904856');" onmouseout="out('7115714847551904856');" style=""> 705              if (!&quot;never&quot;.equals(prefs.getString(&quot;notification_mode_sms&quot;, &quot;when_screen_off&quot;))) {                   </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 706                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 707              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 708          }                                                                                                         </span>
<span  style=""> 709                                                                                                                    </span>
<span class="6044120705305546650" onmouseenter="enter('6044120705305546650');" onmouseout="out('6044120705305546650');" style=""> 710          if (GBApplication.appIsNotifBlacklisted(source)) {                                                        </span>
<span class="-8656872471771272619" onmouseenter="enter('-8656872471771272619');" onmouseout="out('-8656872471771272619');" style=""> 711              LOG.info(&quot;Ignoring notification, application is blacklisted&quot;);                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 712              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 713          }                                                                                                         </span>
<span  style=""> 714                                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 715          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 716      }                                                                                                             </span>
<span  style=""> 717                                                                                                                    </span>
<span class="1856078835330472094" onmouseenter="enter('1856078835330472094');" onmouseout="out('1856078835330472094');" style=""> 718      private boolean shouldIgnoreNotification(Notification notification, String source) {                          </span>
<span  style=""> 719                                                                                                                    </span>
<span class="2710746236440319224" onmouseenter="enter('2710746236440319224');" onmouseout="out('2710746236440319224');" style=""> 720          MediaSessionCompat.Token mediaSession = getMediaSession(notification);                                    </span>
<span class="-7174765412912193274" onmouseenter="enter('-7174765412912193274');" onmouseout="out('-7174765412912193274');" style=""> 721          //try to handle media session notifications                                                               </span>
<span class="3009058002375133697" onmouseenter="enter('3009058002375133697');" onmouseout="out('3009058002375133697');" style=""> 722          if (mediaSession != null &amp;&amp; handleMediaSessionNotification(mediaSession))                                 </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 723              return true;                                                                                          </span>
<span  style=""> 724                                                                                                                    </span>
<span class="8585714054343457960" onmouseenter="enter('8585714054343457960');" onmouseout="out('8585714054343457960');" style=""> 725          NotificationType type = AppNotificationType.getInstance().get(source);                                    </span>
<span class="-3108268637978238079" onmouseenter="enter('-3108268637978238079');" onmouseout="out('-3108268637978238079');" style=""><abbr title=" 726          //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/Notification.html#FLAG_LOCAL_ONLY"> 726          //ignore notifications marked as LocalOnly https://developer.android.com/reference/android/app/NotificatioðŸ”µ</abbr></span>
<span class="1334602672683683072" onmouseenter="enter('1334602672683683072');" onmouseout="out('1334602672683683072');" style=""> 727          //some Apps always mark their notifcations as read-only                                                   </span>
<span class="-5418244290311748300" onmouseenter="enter('-5418244290311748300');" onmouseout="out('-5418244290311748300');" style=""> 728          if (NotificationCompat.getLocalOnly(notification) &amp;&amp;                                                      </span>
<span class="7056635344578594111" onmouseenter="enter('7056635344578594111');" onmouseout="out('7056635344578594111');" style=""> 729                  type != NotificationType.WECHAT &amp;&amp;                                                                </span>
<span class="-8701954321417018195" onmouseenter="enter('-8701954321417018195');" onmouseout="out('-8701954321417018195');" style=""> 730                  type != NotificationType.OUTLOOK &amp;&amp;                                                               </span>
<span class="-8347560682459681115" onmouseenter="enter('-8347560682459681115');" onmouseout="out('-8347560682459681115');" style=""> 731                  type != NotificationType.SKYPE) { //see https://github.com/Freeyourgadget/Gadgetbridge/issues/1109</span>
<span class="-8433825860703034123" onmouseenter="enter('-8433825860703034123');" onmouseout="out('-8433825860703034123');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 732 +            LOG.info(&quot;local only&quot;);                                                                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 733              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 734          }                                                                                                         </span>
<span  style=""> 735                                                                                                                    </span>
<span class="7576815700871527587" onmouseenter="enter('7576815700871527587');" onmouseout="out('7576815700871527587');" style=""> 736          Prefs prefs = GBApplication.getPrefs();                                                                   </span>
<span class="7394809232234198434" onmouseenter="enter('7394809232234198434');" onmouseout="out('7394809232234198434');" style=""> 737          if (!prefs.getBoolean(&quot;notifications_generic_whenscreenon&quot;, false)) {                                     </span>
<span class="-494499854560412945" onmouseenter="enter('-494499854560412945');" onmouseout="out('-494499854560412945');" style=""> 738              PowerManager powermanager = (PowerManager) getSystemService(POWER_SERVICE);                           </span>
<span class="-5667675384255289213" onmouseenter="enter('-5667675384255289213');" onmouseout="out('-5667675384255289213');" style=""> 739              if (powermanager != null &amp;&amp; powermanager.isScreenOn()) {                                              </span>
<span class="1543062508857536366" onmouseenter="enter('1543062508857536366');" onmouseout="out('1543062508857536366');" style=""> 740  //                LOG.info(&quot;Not forwarding notification, screen seems to be on and settings do not allow this&quot;);  </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 741                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 742              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 743          }                                                                                                         </span>
<span  style=""> 744                                                                                                                    </span>
<span class="3125878453643003848" onmouseenter="enter('3125878453643003848');" onmouseout="out('3125878453643003848');" style=""> 745          return (notification.flags &amp; Notification.FLAG_ONGOING_EVENT) == Notification.FLAG_ONGOING_EVENT;         </span>
<span  style=""> 746                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 747      }                                                                                                             </span>
<span  style=""> 748                                                                                                                    </span>
<span  style=""> 749                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 750      /**                                                                                                           </span>
<span class="-3600272953695402454" onmouseenter="enter('-3600272953695402454');" onmouseout="out('-3600272953695402454');" style=""> 751       * Get the notification color that should be used for this Pebble notification.                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 752       *                                                                                                            </span>
<span class="-6380098887809341874" onmouseenter="enter('-6380098887809341874');" onmouseout="out('-6380098887809341874');" style=""><abbr title=" 753       * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PebbleColor."> 753       * Note that this method will *not* edit the NotificationSpec passed in. It will only evaluate the PebbleColorðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 754       *                                                                                                            </span>
<span class="-5220482988035539244" onmouseenter="enter('-5220482988035539244');" onmouseout="out('-5220482988035539244');" style=""> 755       * See Issue #815 on GitHub to see how notification colors are set.                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 756       *                                                                                                            </span>
<span class="-144667098623416646" onmouseenter="enter('-144667098623416646');" onmouseout="out('-144667098623416646');" style=""> 757       * @param notificationSpec The NotificationSpec to read from.                                                 </span>
<span class="-8231127304595524287" onmouseenter="enter('-8231127304595524287');" onmouseout="out('-8231127304595524287');" style=""> 758       * @return Returns a PebbleColor that best represents this notification.                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 759       */                                                                                                           </span>
<span class="-8858039465077957361" onmouseenter="enter('-8858039465077957361');" onmouseout="out('-8858039465077957361');" style=""> 760      private byte getPebbleColorForNotification(NotificationSpec notificationSpec) {                               </span>
<span class="2461936733082927787" onmouseenter="enter('2461936733082927787');" onmouseout="out('2461936733082927787');" style=""> 761          String appId = notificationSpec.sourceAppId;                                                              </span>
<span class="6072026966279222546" onmouseenter="enter('6072026966279222546');" onmouseout="out('6072026966279222546');" style=""> 762          NotificationType existingType = notificationSpec.type;                                                    </span>
<span  style=""> 763                                                                                                                    </span>
<span class="-4597227445151323685" onmouseenter="enter('-4597227445151323685');" onmouseout="out('-4597227445151323685');" style=""> 764          // If the notification type is known, return the associated color.                                        </span>
<span class="-3115160525838252691" onmouseenter="enter('-3115160525838252691');" onmouseout="out('-3115160525838252691');" style=""> 765          if (existingType != NotificationType.UNKNOWN) {                                                           </span>
<span class="4443749667658266101" onmouseenter="enter('4443749667658266101');" onmouseout="out('4443749667658266101');" style=""> 766              return existingType.color;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 767          }                                                                                                         </span>
<span  style=""> 768                                                                                                                    </span>
<span class="128994715916204674" onmouseenter="enter('128994715916204674');" onmouseout="out('128994715916204674');" style=""> 769          // Otherwise, we go and attempt to find the color from the app icon.                                      </span>
<span class="-6191555258820518316" onmouseenter="enter('-6191555258820518316');" onmouseout="out('-6191555258820518316');" style=""> 770          Drawable icon;                                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 771          try {                                                                                                     </span>
<span class="8261548971879133584" onmouseenter="enter('8261548971879133584');" onmouseout="out('8261548971879133584');" style=""> 772              icon = getApplicationContext().getPackageManager().getApplicationIcon(appId);                         </span>
<span class="6230969829088056905" onmouseenter="enter('6230969829088056905');" onmouseout="out('6230969829088056905');" style=""> 773              Objects.requireNonNull(icon);                                                                         </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style=""> 774          } catch (Exception ex) {                                                                                  </span>
<span class="-3868233956680081057" onmouseenter="enter('-3868233956680081057');" onmouseout="out('-3868233956680081057');" style=""> 775              // If we can&#x27;t get the icon, we go with the default defined above.                                    </span>
<span class="-5905931119091130668" onmouseenter="enter('-5905931119091130668');" onmouseout="out('-5905931119091130668');" style=""> 776              LOG.warn(&quot;Could not get icon for AppID &quot; + appId, ex);                                                </span>
<span class="5002487793506958772" onmouseenter="enter('5002487793506958772');" onmouseout="out('5002487793506958772');" style=""> 777              return PebbleColor.IslamicGreen;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 778          }                                                                                                         </span>
<span  style=""> 779                                                                                                                    </span>
<span class="-5100715979180048388" onmouseenter="enter('-5100715979180048388');" onmouseout="out('-5100715979180048388');" style=""> 780          Bitmap bitmapIcon = BitmapUtil.convertDrawableToBitmap(icon);                                             </span>
<span class="-8268037003500299815" onmouseenter="enter('-8268037003500299815');" onmouseout="out('-8268037003500299815');" style=""> 781          int iconPrimaryColor = new Palette.Builder(bitmapIcon)                                                    </span>
<span class="-3438664463656085757" onmouseenter="enter('-3438664463656085757');" onmouseout="out('-3438664463656085757');" style=""> 782                  .generate()                                                                                       </span>
<span class="-7390360638896501298" onmouseenter="enter('-7390360638896501298');" onmouseout="out('-7390360638896501298');" style=""> 783                  .getVibrantColor(Color.parseColor(&quot;#aa0000&quot;));                                                    </span>
<span  style=""> 784                                                                                                                    </span>
<span class="5649835422942677201" onmouseenter="enter('5649835422942677201');" onmouseout="out('5649835422942677201');" style=""> 785          return PebbleUtils.getPebbleColor(iconPrimaryColor);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 786      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 787  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            