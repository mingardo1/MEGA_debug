<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>299</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    299
                    <a href="298.html">prev</a>
                    <a href="300.html">next</a>
                    <a href="299_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_c7dd491696086536f01bfb1ce1116a128740d170_core/src/main/java/com/dtstack/flink/sql/parser/InsertSqlParser.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;c7dd491696086536f01bfb1ce1116a128740d170:core/src/main/java/com/dtstack/flink/sql/parser/InsertSqlParser.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;c7dd491696086536f01bfb1ce1116a128740d170^1:core/src/main/java/com/dtstack/flink/sql/parser/InsertSqlParser.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;c7dd491696086536f01bfb1ce1116a128740d170^2:core/src/main/java/com/dtstack/flink/sql/parser/InsertSqlParser.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;e52022440e11ac5d851e44be4c0c529050223903:core/src/main/java/com/dtstack/flink/sql/parser/InsertSqlParser.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span class="1224993673552058858" onmouseenter="enter('1224993673552058858');" onmouseout="out('1224993673552058858');" style="">  20 package com.dtstack.flink.sql.parser;                                                                    </span>
<span  style="">  21                                                                                                          </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  22 import org.apache.calcite.sql.SqlInsert;                                                                 </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  23 import org.apache.calcite.sql.SqlJoin;                                                                   </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  24 import org.apache.calcite.sql.SqlKind;                                                                   </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  25 import org.apache.calcite.sql.SqlNode;                                                                   </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  26 import org.apache.calcite.sql.SqlSelect;                                                                 </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  27 import org.apache.calcite.sql.SqlNodeList;                                                               </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  28 import org.apache.calcite.sql.SqlBasicCall;                                                              </span>
<span class="-6443913902114896099" onmouseenter="enter('-6443913902114896099');" onmouseout="out('-6443913902114896099');" style="">  29 import org.apache.calcite.sql.SqlMatchRecognize;                                                         </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  30 import org.apache.calcite.sql.SqlOrderBy;                                                                </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  31 import org.apache.calcite.sql.SqlIdentifier;                                                             </span>
<span class="-6347312057640942811" onmouseenter="enter('-6347312057640942811');" onmouseout="out('-6347312057640942811');" style="">  32 import org.apache.calcite.sql.SqlAsOperator;                                                             </span>
<span class="-8475519504744506507" onmouseenter="enter('-8475519504744506507');" onmouseout="out('-8475519504744506507');" style="">  33 import org.apache.calcite.sql.parser.SqlParserPos;                                                       </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  34 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  35 import com.google.common.collect.Lists;                                                                  </span>
<span class="6392557416326297682" onmouseenter="enter('6392557416326297682');" onmouseout="out('6392557416326297682');" style="">  36 import org.apache.flink.table.planner.calcite.FlinkPlannerImpl;                                          </span>
<span  style="">  37                                                                                                          </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  38 import java.util.List;                                                                                   </span>
<span  style="">  39                                                                                                          </span>
<span class="-2521262007515880622" onmouseenter="enter('-2521262007515880622');" onmouseout="out('-2521262007515880622');" style="">  40 import static org.apache.calcite.sql.SqlKind.IDENTIFIER;                                                 </span>
<span  style="">  41                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  42 /**                                                                                                      </span>
<span class="7745097592575645187" onmouseenter="enter('7745097592575645187');" onmouseout="out('7745097592575645187');" style="">  43  * 解析flink sql                                                                                           </span>
<span class="4344975189984981793" onmouseenter="enter('4344975189984981793');" onmouseout="out('4344975189984981793');" style="">  44  * sql 只支持 insert 开头的                                                                                    </span>
<span class="-704258415287748828" onmouseenter="enter('-704258415287748828');" onmouseout="out('-704258415287748828');" style="">  45  * Date: 2018/6/22                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  46  * Company: www.dtstack.com                                                                              </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  47  * @author xuchao                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  48  */                                                                                                      </span>
<span  style="">  49                                                                                                          </span>
<span class="2260027744038508987" onmouseenter="enter('2260027744038508987');" onmouseout="out('2260027744038508987');" style="">  50 public class InsertSqlParser implements IParser {                                                        </span>
<span  style="">  51                                                                                                          </span>
<span class="7449713827178994474" onmouseenter="enter('7449713827178994474');" onmouseout="out('7449713827178994474');" style="">  52     private FlinkPlanner flinkPlanner = new FlinkPlanner();                                              </span>
<span  style="">  53                                                                                                          </span>
<span class="1461371051478130716" onmouseenter="enter('1461371051478130716');" onmouseout="out('1461371051478130716');" style="">  54     // 用来标识当前解析节点的上一层节点是否为 insert 节点                                                                     </span>
<span class="6095630625593139817" onmouseenter="enter('6095630625593139817');" onmouseout="out('6095630625593139817');" style="">  55     private static Boolean parentIsInsert = false;                                                       </span>
<span  style="">  56                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  57     @Override                                                                                            </span>
<span class="2092801495564122916" onmouseenter="enter('2092801495564122916');" onmouseout="out('2092801495564122916');" style="">  58     public boolean verify(String sql) {                                                                  </span>
<span class="-6453349921868443163" onmouseenter="enter('-6453349921868443163');" onmouseout="out('-6453349921868443163');" style="">  59         return StringUtils.isNotBlank(sql) &amp;&amp; sql.trim().toLowerCase().startsWith(&quot;insert&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  60     }                                                                                                    </span>
<span  style="">  61                                                                                                          </span>
<span class="3637662161101374244" onmouseenter="enter('3637662161101374244');" onmouseout="out('3637662161101374244');" style="">  62     public static InsertSqlParser newInstance(){                                                         </span>
<span class="3030919886573972443" onmouseenter="enter('3030919886573972443');" onmouseout="out('3030919886573972443');" style="">  63         InsertSqlParser parser = new InsertSqlParser();                                                  </span>
<span class="3422310816985147925" onmouseenter="enter('3422310816985147925');" onmouseout="out('3422310816985147925');" style="">  64         return parser;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  65     }                                                                                                    </span>
<span  style="">  66                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  67     @Override                                                                                            </span>
<span class="1978536140497269371" onmouseenter="enter('1978536140497269371');" onmouseout="out('1978536140497269371');" style="">  68     public void parseSql(String sql, SqlTree sqlTree) throws Exception {                                 </span>
<span  style="">  69                                                                                                          </span>
<span  style="">  70                                                                                                          </span>
<span class="8499815483525337810" onmouseenter="enter('8499815483525337810');" onmouseout="out('8499815483525337810');" style="">  71         SqlNode sqlNode = flinkPlanner.getParser().parse(sql);                                           </span>
<span  style="">  72                                                                                                          </span>
<span class="1514033550138895862" onmouseenter="enter('1514033550138895862');" onmouseout="out('1514033550138895862');" style="">  73         SqlParseResult sqlParseResult = new SqlParseResult();                                            </span>
<span class="-1557788009333318197" onmouseenter="enter('-1557788009333318197');" onmouseout="out('-1557788009333318197');" style="">  74         parseNode(sqlNode, sqlParseResult);                                                              </span>
<span class="5986716603685301727" onmouseenter="enter('5986716603685301727');" onmouseout="out('5986716603685301727');" style="">  75         sqlParseResult.setExecSql(sqlNode.toString());                                                   </span>
<span class="2818767453667301834" onmouseenter="enter('2818767453667301834');" onmouseout="out('2818767453667301834');" style="">  76         sqlTree.addExecSql(sqlParseResult);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77     }                                                                                                    </span>
<span  style="">  78                                                                                                          </span>
<span class="-597868253990907964" onmouseenter="enter('-597868253990907964');" onmouseout="out('-597868253990907964');" style="">  79     private static void parseNode(SqlNode sqlNode, SqlParseResult sqlParseResult){                       </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style="">  80         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style="">  81         switch (sqlKind){                                                                                </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style="">  82             case INSERT:                                                                                 </span>
<span class="2646037727966090767" onmouseenter="enter('2646037727966090767');" onmouseout="out('2646037727966090767');" style="">  83                 SqlNode sqlTarget = ((SqlInsert)sqlNode).getTargetTable();                               </span>
<span class="-7853295063534246070" onmouseenter="enter('-7853295063534246070');" onmouseout="out('-7853295063534246070');" style="">  84                 SqlNode sqlSource = ((SqlInsert)sqlNode).getSource();                                    </span>
<span class="2646328150760623506" onmouseenter="enter('2646328150760623506');" onmouseout="out('2646328150760623506');" style="">  85                 sqlParseResult.addTargetTable(sqlTarget.toString());                                     </span>
<span class="3865517203793965283" onmouseenter="enter('3865517203793965283');" onmouseout="out('3865517203793965283');" style="">  86                 parentIsInsert = true;                                                                   </span>
<span class="6673792509799319812" onmouseenter="enter('6673792509799319812');" onmouseout="out('6673792509799319812');" style="">  87                 parseNode(sqlSource, sqlParseResult);                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="">  88                 break;                                                                                   </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style="">  89             case SELECT:                                                                                 </span>
<span class="-6587445636759965572" onmouseenter="enter('-6587445636759965572');" onmouseout="out('-6587445636759965572');" style="">  90                 SqlSelect sqlSelect = (SqlSelect) sqlNode;                                               </span>
<span class="3551219024900017087" onmouseenter="enter('3551219024900017087');" onmouseout="out('3551219024900017087');" style="">  91                 if (parentIsInsert) {                                                                    </span>
<span class="1716986497952209882" onmouseenter="enter('1716986497952209882');" onmouseout="out('1716986497952209882');" style="">  92                     rebuildSelectNode(sqlSelect.getSelectList(), sqlSelect);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93                 }                                                                                        </span>
<span class="-4229800989062838511" onmouseenter="enter('-4229800989062838511');" onmouseout="out('-4229800989062838511');" style="">  94                 SqlNode sqlFrom = ((SqlSelect) sqlNode).getFrom();                                       </span>
<span class="6191253572730585832" onmouseenter="enter('6191253572730585832');" onmouseout="out('6191253572730585832');" style="">  95                 if (sqlFrom.getKind() == IDENTIFIER) {                                                   </span>
<span class="8241530473190791640" onmouseenter="enter('8241530473190791640');" onmouseout="out('8241530473190791640');" style="">  96                     sqlParseResult.addSourceTable(sqlFrom.toString());                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  97                 } else {                                                                                 </span>
<span class="-1064722465081016619" onmouseenter="enter('-1064722465081016619');" onmouseout="out('-1064722465081016619');" style="">  98                     parentIsInsert = false;                                                              </span>
<span class="4128396176691967722" onmouseenter="enter('4128396176691967722');" onmouseout="out('4128396176691967722');" style="">  99                     parseNode(sqlFrom, sqlParseResult);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 100                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 101                 break;                                                                                   </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 102             case JOIN:                                                                                   </span>
<span class="7698802261704662279" onmouseenter="enter('7698802261704662279');" onmouseout="out('7698802261704662279');" style=""> 103                 SqlNode leftNode = ((SqlJoin)sqlNode).getLeft();                                         </span>
<span class="-6247618774659154031" onmouseenter="enter('-6247618774659154031');" onmouseout="out('-6247618774659154031');" style=""> 104                 SqlNode rightNode = ((SqlJoin)sqlNode).getRight();                                       </span>
<span  style=""> 105                                                                                                          </span>
<span class="-8190917917216144958" onmouseenter="enter('-8190917917216144958');" onmouseout="out('-8190917917216144958');" style=""> 106                 if(leftNode.getKind() == IDENTIFIER){                                                    </span>
<span class="-307510795650094250" onmouseenter="enter('-307510795650094250');" onmouseout="out('-307510795650094250');" style=""> 107                     sqlParseResult.addSourceTable(leftNode.toString());                                  </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 108                 }else{                                                                                   </span>
<span class="4207242849825940624" onmouseenter="enter('4207242849825940624');" onmouseout="out('4207242849825940624');" style=""> 109                     parseNode(leftNode, sqlParseResult);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110                 }                                                                                        </span>
<span  style=""> 111                                                                                                          </span>
<span class="-5648840450336709152" onmouseenter="enter('-5648840450336709152');" onmouseout="out('-5648840450336709152');" style=""> 112                 if(rightNode.getKind() == IDENTIFIER){                                                   </span>
<span class="-7238435843855989440" onmouseenter="enter('-7238435843855989440');" onmouseout="out('-7238435843855989440');" style=""> 113                     sqlParseResult.addSourceTable(rightNode.toString());                                 </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 114                 }else{                                                                                   </span>
<span class="-5366187044469072353" onmouseenter="enter('-5366187044469072353');" onmouseout="out('-5366187044469072353');" style=""> 115                     parseNode(rightNode, sqlParseResult);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 117                 break;                                                                                   </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 118             case AS:                                                                                     </span>
<span class="5826390168021483981" onmouseenter="enter('5826390168021483981');" onmouseout="out('5826390168021483981');" style=""> 119                 //不解析column,所以 as 相关的都是表                                                                 </span>
<span class="-5734921612668171253" onmouseenter="enter('-5734921612668171253');" onmouseout="out('-5734921612668171253');" style=""> 120                 SqlNode identifierNode = ((SqlBasicCall)sqlNode).getOperands()[0];                       </span>
<span class="-8687183585810485329" onmouseenter="enter('-8687183585810485329');" onmouseout="out('-8687183585810485329');" style=""> 121                 if(identifierNode.getKind() != IDENTIFIER){                                              </span>
<span class="-4744022615262891158" onmouseenter="enter('-4744022615262891158');" onmouseout="out('-4744022615262891158');" style=""> 122                     parseNode(identifierNode, sqlParseResult);                                           </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 123                 }else {                                                                                  </span>
<span class="6305370846253658960" onmouseenter="enter('6305370846253658960');" onmouseout="out('6305370846253658960');" style=""> 124                     sqlParseResult.addSourceTable(identifierNode.toString());                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 125                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 126                 break;                                                                                   </span>
<span class="5889755648968358721" onmouseenter="enter('5889755648968358721');" onmouseout="out('5889755648968358721');" style=""> 127             case MATCH_RECOGNIZE:                                                                        </span>
<span class="1373643275810848474" onmouseenter="enter('1373643275810848474');" onmouseout="out('1373643275810848474');" style=""> 128                 SqlMatchRecognize node = (SqlMatchRecognize) sqlNode;                                    </span>
<span class="8933858622159353818" onmouseenter="enter('8933858622159353818');" onmouseout="out('8933858622159353818');" style=""> 129                 sqlParseResult.addSourceTable(node.getTableRef().toString());                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 130                 break;                                                                                   </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 131             case UNION:                                                                                  </span>
<span class="-7477725012703906871" onmouseenter="enter('-7477725012703906871');" onmouseout="out('-7477725012703906871');" style=""> 132                 SqlNode unionLeft = ((SqlBasicCall)sqlNode).getOperands()[0];                            </span>
<span class="-368480979530163649" onmouseenter="enter('-368480979530163649');" onmouseout="out('-368480979530163649');" style=""> 133                 SqlNode unionRight = ((SqlBasicCall)sqlNode).getOperands()[1];                           </span>
<span class="3779552565426531876" onmouseenter="enter('3779552565426531876');" onmouseout="out('3779552565426531876');" style=""> 134                 if(unionLeft.getKind() == IDENTIFIER){                                                   </span>
<span class="-5358468360073063178" onmouseenter="enter('-5358468360073063178');" onmouseout="out('-5358468360073063178');" style=""> 135                     sqlParseResult.addSourceTable(unionLeft.toString());                                 </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 136                 }else{                                                                                   </span>
<span class="-2617274856762080939" onmouseenter="enter('-2617274856762080939');" onmouseout="out('-2617274856762080939');" style=""> 137                     parseNode(unionLeft, sqlParseResult);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138                 }                                                                                        </span>
<span class="7065528519182980902" onmouseenter="enter('7065528519182980902');" onmouseout="out('7065528519182980902');" style=""> 139                 if(unionRight.getKind() == IDENTIFIER){                                                  </span>
<span class="-9060067906181874961" onmouseenter="enter('-9060067906181874961');" onmouseout="out('-9060067906181874961');" style=""> 140                     sqlParseResult.addSourceTable(unionRight.toString());                                </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 141                 }else{                                                                                   </span>
<span class="-1718106092654689933" onmouseenter="enter('-1718106092654689933');" onmouseout="out('-1718106092654689933');" style=""> 142                     parseNode(unionRight, sqlParseResult);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 144                 break;                                                                                   </span>
<span class="9033815331900391172" onmouseenter="enter('9033815331900391172');" onmouseout="out('9033815331900391172');" style=""> 145             case ORDER_BY:                                                                               </span>
<span class="3723185693474391186" onmouseenter="enter('3723185693474391186');" onmouseout="out('3723185693474391186');" style=""> 146                 SqlOrderBy sqlOrderBy  = (SqlOrderBy) sqlNode;                                           </span>
<span class="4479816118151669611" onmouseenter="enter('4479816118151669611');" onmouseout="out('4479816118151669611');" style=""> 147                 parseNode(sqlOrderBy.query, sqlParseResult);                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 148                 break;                                                                                   </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 149             default:                                                                                     </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 150                 //do nothing                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 151                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 153     }                                                                                                    </span>
<span  style=""> 154                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 155     /**                                                                                                  </span>
<span class="425437455944800468" onmouseenter="enter('425437455944800468');" onmouseout="out('425437455944800468');" style=""> 156      * 将第一层 select 中的 sqlNode 转化为 AsNode，解决字段名冲突问题                                                       </span>
<span class="5061634859035675315" onmouseenter="enter('5061634859035675315');" onmouseout="out('5061634859035675315');" style=""> 157      * 仅对 table.xx 这种类型的字段进行替换                                                                           </span>
<span class="2039713584240146444" onmouseenter="enter('2039713584240146444');" onmouseout="out('2039713584240146444');" style=""> 158      * @param selectList select Node 的 select 字段                                                         </span>
<span class="-5725073247887320592" onmouseenter="enter('-5725073247887320592');" onmouseout="out('-5725073247887320592');" style=""> 159      * @param sqlSelect 第一层解析出来的 selectNode                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 160      */                                                                                                  </span>
<span class="5922338772528688925" onmouseenter="enter('5922338772528688925');" onmouseout="out('5922338772528688925');" style=""> 161     private static void rebuildSelectNode(SqlNodeList selectList, SqlSelect sqlSelect) {                 </span>
<span class="-5039170127940637600" onmouseenter="enter('-5039170127940637600');" onmouseout="out('-5039170127940637600');" style=""> 162         SqlNodeList sqlNodes = new SqlNodeList(selectList.getParserPosition());                          </span>
<span  style=""> 163                                                                                                          </span>
<span class="343879600078305884" onmouseenter="enter('343879600078305884');" onmouseout="out('343879600078305884');" style=""> 164         for (int index = 0; index &lt; selectList.size(); index++) {                                        </span>
<span class="-862031849753580800" onmouseenter="enter('-862031849753580800');" onmouseout="out('-862031849753580800');" style=""> 165             SqlNode sqlNode = selectList.get(index);                                                     </span>
<span class="-2578460539823980869" onmouseenter="enter('-2578460539823980869');" onmouseout="out('-2578460539823980869');" style=""> 166             // 判断sqlNode的类型是否属于 &#x27;t1.f1 as f2&#x27;                                                            </span>
<span class="5048377851733354050" onmouseenter="enter('5048377851733354050');" onmouseout="out('5048377851733354050');" style=""> 167             boolean isAsNode = sqlNode.getKind().equals(SqlKind.AS);                                     </span>
<span  style=""> 168                                                                                                          </span>
<span class="-7636926610308823144" onmouseenter="enter('-7636926610308823144');" onmouseout="out('-7636926610308823144');" style=""> 169             // 判断sqlNode的结构是否属于&#x27;f1&#x27; 或者 &#x27;t.*&#x27;                                                             </span>
<span class="8842452042957903214" onmouseenter="enter('8842452042957903214');" onmouseout="out('8842452042957903214');" style=""> 170             boolean isIdentifierOrStar = sqlNode.getClass().equals(SqlIdentifier.class)                  </span>
<span class="8216149235331840224" onmouseenter="enter('8216149235331840224');" onmouseout="out('8216149235331840224');" style=""> 171                     // sqlNode like &#x27;f1&#x27;                                                                 </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 172 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="4825325517642827377" onmouseenter="enter('4825325517642827377');" onmouseout="out('4825325517642827377');" style=""> 173 &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD                                                                                             </span>
<span class="2301663565572323154" onmouseenter="enter('2301663565572323154');" onmouseout="out('2301663565572323154');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174                     &amp;&amp; (((SqlIdentifier) sqlNode).names.size() == 1                                      </span>
<span class="8815254266839889504" onmouseenter="enter('8815254266839889504');" onmouseout="out('8815254266839889504');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 175                     // sqlNode like &#x27;t.*&#x27;                                                                </span>
<span class="-8133538842001433253" onmouseenter="enter('-8133538842001433253');" onmouseout="out('-8133538842001433253');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 176                     || StringUtils.isBlank(((SqlIdentifier) sqlNode).names.get(1)));                     </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 177 =======                                                                                                  </span>
<span class="-6555710588983893024" onmouseenter="enter('-6555710588983893024');" onmouseout="out('-6555710588983893024');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178                     &amp;&amp; (((SqlIdentifier) sqlNode).isSimple()                                             </span>
<span class="8815254266839889504" onmouseenter="enter('8815254266839889504');" onmouseout="out('8815254266839889504');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179                     // sqlNode like &#x27;t.*&#x27;                                                                </span>
<span class="-1007775631400642269" onmouseenter="enter('-1007775631400642269');" onmouseout="out('-1007775631400642269');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180                     || ((SqlIdentifier) sqlNode).isStar());                                              </span>
<span class="5933788354678768164" onmouseenter="enter('5933788354678768164');" onmouseout="out('5933788354678768164');" style=""> 181 &gt;&gt;&gt;&gt;&gt;&gt;&gt; e52022440e11ac5d851e44be4c0c529050223903                                                         </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 182 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="7560529663732492491" onmouseenter="enter('7560529663732492491');" onmouseout="out('7560529663732492491');" style=""> 183 &lt;&lt;&lt;&lt;&lt;&lt;&lt; OURS                                                                                             </span>
<span class="-6555710588983893024" onmouseenter="enter('-6555710588983893024');" onmouseout="out('-6555710588983893024');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 184                     &amp;&amp; (((SqlIdentifier) sqlNode).isSimple()                                             </span>
<span class="8815254266839889504" onmouseenter="enter('8815254266839889504');" onmouseout="out('8815254266839889504');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 185                     // sqlNode like &#x27;t.*&#x27;                                                                </span>
<span class="-1007775631400642269" onmouseenter="enter('-1007775631400642269');" onmouseout="out('-1007775631400642269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 186                     || ((SqlIdentifier) sqlNode).isStar());                                              </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 187 =======                                                                                                  </span>
<span class="2301663565572323154" onmouseenter="enter('2301663565572323154');" onmouseout="out('2301663565572323154');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188                     &amp;&amp; (((SqlIdentifier) sqlNode).names.size() == 1                                      </span>
<span class="8815254266839889504" onmouseenter="enter('8815254266839889504');" onmouseout="out('8815254266839889504');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 189                     // sqlNode like &#x27;t.*&#x27;                                                                </span>
<span class="-8133538842001433253" onmouseenter="enter('-8133538842001433253');" onmouseout="out('-8133538842001433253');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190                     || StringUtils.isBlank(((SqlIdentifier) sqlNode).names.get(1)));                     </span>
<span class="-1379186895432660313" onmouseenter="enter('-1379186895432660313');" onmouseout="out('-1379186895432660313');" style=""> 191 &gt;&gt;&gt;&gt;&gt;&gt;&gt; THEIRS                                                                                           </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 192 =======                                                                                                  </span>
<span class="-6555710588983893024" onmouseenter="enter('-6555710588983893024');" onmouseout="out('-6555710588983893024');" style=""> 193                     &amp;&amp; (((SqlIdentifier) sqlNode).isSimple()                                             </span>
<span class="8815254266839889504" onmouseenter="enter('8815254266839889504');" onmouseout="out('8815254266839889504');" style=""> 194                     // sqlNode like &#x27;t.*&#x27;                                                                </span>
<span class="-1007775631400642269" onmouseenter="enter('-1007775631400642269');" onmouseout="out('-1007775631400642269');" style=""> 195                     || ((SqlIdentifier) sqlNode).isStar());                                              </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 196 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span  style=""> 197                                                                                                          </span>
<span class="7707072008253188751" onmouseenter="enter('7707072008253188751');" onmouseout="out('7707072008253188751');" style=""> 198             if (isAsNode || isIdentifierOrStar) {                                                        </span>
<span class="-4097224917928195160" onmouseenter="enter('-4097224917928195160');" onmouseout="out('-4097224917928195160');" style=""> 199                 sqlNodes.add(sqlNode);                                                                   </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 200                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201             }                                                                                            </span>
<span  style=""> 202                                                                                                          </span>
<span class="-2733430377230189789" onmouseenter="enter('-2733430377230189789');" onmouseout="out('-2733430377230189789');" style=""> 203             if (!sqlNode.getClass().equals(SqlIdentifier.class)) {                                       </span>
<span class="-4772172748755107816" onmouseenter="enter('-4772172748755107816');" onmouseout="out('-4772172748755107816');" style=""> 204                 if (sqlNode.getKind().equals(SqlKind.LITERAL)) {                                         </span>
<span class="71185610508294362" onmouseenter="enter('71185610508294362');" onmouseout="out('71185610508294362');" style=""><abbr title=" 205                     throw new IllegalArgumentException(String.format(&quot;Constants %s in the SELECT statement must be aliased!&quot;,"> 205                     throw new IllegalArgumentException(String.format(&quot;Constants %s in the SELECT statemen🔵</abbr></span>
<span class="-2683332635210278463" onmouseenter="enter('-2683332635210278463');" onmouseout="out('-2683332635210278463');" style=""> 206                             sqlNode.toString()));                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207                 }                                                                                        </span>
<span class="-4706648042477805395" onmouseenter="enter('-4706648042477805395');" onmouseout="out('-4706648042477805395');" style=""><abbr title=" 208                 throw new RuntimeException(String.format(&quot;Illegal statement! Please check the statement: %s&quot;,"> 208                 throw new RuntimeException(String.format(&quot;Illegal statement! Please check the statement: 🔵</abbr></span>
<span class="-2683332635210278463" onmouseenter="enter('-2683332635210278463');" onmouseout="out('-2683332635210278463');" style=""> 209                         sqlNode.toString()));                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210             }                                                                                            </span>
<span  style=""> 211                                                                                                          </span>
<span class="5476004887086667819" onmouseenter="enter('5476004887086667819');" onmouseout="out('5476004887086667819');" style=""> 212             sqlNodes.add(transformToAsNode(sqlNode));                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213         }                                                                                                </span>
<span class="-3996420935691854843" onmouseenter="enter('-3996420935691854843');" onmouseout="out('-3996420935691854843');" style=""> 214         sqlSelect.setSelectList(sqlNodes);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215     }                                                                                                    </span>
<span  style=""> 216                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 217     /**                                                                                                  </span>
<span class="-4664929224134271960" onmouseenter="enter('-4664929224134271960');" onmouseout="out('-4664929224134271960');" style=""> 218      * 将 sqlNode 转化为 AsNode                                                                              </span>
<span class="-2117917073515803213" onmouseenter="enter('-2117917073515803213');" onmouseout="out('-2117917073515803213');" style=""> 219      * @param sqlNode 需要转化的 sqlNode                                                                      </span>
<span class="7567586887564748591" onmouseenter="enter('7567586887564748591');" onmouseout="out('7567586887564748591');" style=""> 220      * @return 重新构造的 AsNode                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 221      */                                                                                                  </span>
<span class="-2689707916993061627" onmouseenter="enter('-2689707916993061627');" onmouseout="out('-2689707916993061627');" style=""> 222     public static SqlBasicCall transformToAsNode(SqlNode sqlNode) {                                      </span>
<span class="-8357059688166569654" onmouseenter="enter('-8357059688166569654');" onmouseout="out('-8357059688166569654');" style=""> 223         String asName = &quot;&quot;;                                                                              </span>
<span class="-5346646982964147658" onmouseenter="enter('-5346646982964147658');" onmouseout="out('-5346646982964147658');" style=""> 224         SqlParserPos pos = new SqlParserPos(sqlNode.getParserPosition().getLineNum(),                    </span>
<span class="-8534758370861444561" onmouseenter="enter('-8534758370861444561');" onmouseout="out('-8534758370861444561');" style=""> 225                                             sqlNode.getParserPosition().getEndColumnNum());              </span>
<span class="3909600863175221319" onmouseenter="enter('3909600863175221319');" onmouseout="out('3909600863175221319');" style=""> 226         if (sqlNode.getKind().equals(SqlKind.IDENTIFIER)) {                                              </span>
<span class="-6734847535232911160" onmouseenter="enter('-6734847535232911160');" onmouseout="out('-6734847535232911160');" style=""> 227             asName = ((SqlIdentifier) sqlNode).names.get(1);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228         }                                                                                                </span>
<span class="-6629769419150459383" onmouseenter="enter('-6629769419150459383');" onmouseout="out('-6629769419150459383');" style=""> 229         SqlNode[] operands = new SqlNode[2];                                                             </span>
<span class="5673677563739985763" onmouseenter="enter('5673677563739985763');" onmouseout="out('5673677563739985763');" style=""> 230         operands[0] = sqlNode;                                                                           </span>
<span class="9062082844214631566" onmouseenter="enter('9062082844214631566');" onmouseout="out('9062082844214631566');" style=""> 231         operands[1] = new SqlIdentifier(asName, null, pos);                                              </span>
<span class="-1315247439335526800" onmouseenter="enter('-1315247439335526800');" onmouseout="out('-1315247439335526800');" style=""> 232         return new SqlBasicCall(new SqlAsOperator(), operands, pos);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233     }                                                                                                    </span>
<span  style=""> 234                                                                                                          </span>
<span class="-5717905756360440039" onmouseenter="enter('-5717905756360440039');" onmouseout="out('-5717905756360440039');" style=""> 235     public static class SqlParseResult {                                                                 </span>
<span  style=""> 236                                                                                                          </span>
<span class="1587904348878184014" onmouseenter="enter('1587904348878184014');" onmouseout="out('1587904348878184014');" style=""> 237         private List&lt;String&gt; sourceTableList = Lists.newArrayList();                                     </span>
<span  style=""> 238                                                                                                          </span>
<span class="-1479693990071194125" onmouseenter="enter('-1479693990071194125');" onmouseout="out('-1479693990071194125');" style=""> 239         private List&lt;String&gt; targetTableList = Lists.newArrayList();                                     </span>
<span  style=""> 240                                                                                                          </span>
<span class="8437363304882776179" onmouseenter="enter('8437363304882776179');" onmouseout="out('8437363304882776179');" style=""> 241         private String execSql;                                                                          </span>
<span  style=""> 242                                                                                                          </span>
<span class="5144548036770890441" onmouseenter="enter('5144548036770890441');" onmouseout="out('5144548036770890441');" style=""> 243         public void addSourceTable(String sourceTable){                                                  </span>
<span class="3920005572951608068" onmouseenter="enter('3920005572951608068');" onmouseout="out('3920005572951608068');" style=""> 244             sourceTableList.add(sourceTable);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245         }                                                                                                </span>
<span  style=""> 246                                                                                                          </span>
<span class="2239855044100079830" onmouseenter="enter('2239855044100079830');" onmouseout="out('2239855044100079830');" style=""> 247         public void addTargetTable(String targetTable){                                                  </span>
<span class="-7020491181635877882" onmouseenter="enter('-7020491181635877882');" onmouseout="out('-7020491181635877882');" style=""> 248             targetTableList.add(targetTable);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249         }                                                                                                </span>
<span  style=""> 250                                                                                                          </span>
<span class="-7363026318680376964" onmouseenter="enter('-7363026318680376964');" onmouseout="out('-7363026318680376964');" style=""> 251         public List&lt;String&gt; getSourceTableList() {                                                       </span>
<span class="7081270282315381863" onmouseenter="enter('7081270282315381863');" onmouseout="out('7081270282315381863');" style=""> 252             return sourceTableList;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253         }                                                                                                </span>
<span  style=""> 254                                                                                                          </span>
<span class="-8775504114915320905" onmouseenter="enter('-8775504114915320905');" onmouseout="out('-8775504114915320905');" style=""> 255         public List&lt;String&gt; getTargetTableList() {                                                       </span>
<span class="3901193726515838075" onmouseenter="enter('3901193726515838075');" onmouseout="out('3901193726515838075');" style=""> 256             return targetTableList;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257         }                                                                                                </span>
<span  style=""> 258                                                                                                          </span>
<span class="7459959708918851119" onmouseenter="enter('7459959708918851119');" onmouseout="out('7459959708918851119');" style=""> 259         public String getExecSql() {                                                                     </span>
<span class="4154186148994399560" onmouseenter="enter('4154186148994399560');" onmouseout="out('4154186148994399560');" style=""> 260             return execSql;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261         }                                                                                                </span>
<span  style=""> 262                                                                                                          </span>
<span class="7557197678911800826" onmouseenter="enter('7557197678911800826');" onmouseout="out('7557197678911800826');" style=""> 263         public void setExecSql(String execSql) {                                                         </span>
<span class="5784569524175592813" onmouseenter="enter('5784569524175592813');" onmouseout="out('5784569524175592813');" style=""> 264             this.execSql = execSql;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span class="1224993673552058858" onmouseenter="enter('1224993673552058858');" onmouseout="out('1224993673552058858');" style="">  20 package com.dtstack.flink.sql.parser;                                                                    </span>
<span  style="">  21                                                                                                          </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  22 import org.apache.calcite.sql.SqlInsert;                                                                 </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  23 import org.apache.calcite.sql.SqlJoin;                                                                   </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  24 import org.apache.calcite.sql.SqlKind;                                                                   </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  25 import org.apache.calcite.sql.SqlNode;                                                                   </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  26 import org.apache.calcite.sql.SqlSelect;                                                                 </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  27 import org.apache.calcite.sql.SqlNodeList;                                                               </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  28 import org.apache.calcite.sql.SqlBasicCall;                                                              </span>
<span class="-6443913902114896099" onmouseenter="enter('-6443913902114896099');" onmouseout="out('-6443913902114896099');" style="">  29 import org.apache.calcite.sql.SqlMatchRecognize;                                                         </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  30 import org.apache.calcite.sql.SqlOrderBy;                                                                </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  31 import org.apache.calcite.sql.SqlIdentifier;                                                             </span>
<span class="-6347312057640942811" onmouseenter="enter('-6347312057640942811');" onmouseout="out('-6347312057640942811');" style="">  32 import org.apache.calcite.sql.SqlAsOperator;                                                             </span>
<span class="-8475519504744506507" onmouseenter="enter('-8475519504744506507');" onmouseout="out('-8475519504744506507');" style="">  33 import org.apache.calcite.sql.parser.SqlParserPos;                                                       </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  34 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  35 import com.google.common.collect.Lists;                                                                  </span>
<span class="6392557416326297682" onmouseenter="enter('6392557416326297682');" onmouseout="out('6392557416326297682');" style="">  36 import org.apache.flink.table.planner.calcite.FlinkPlannerImpl;                                          </span>
<span  style="">  37                                                                                                          </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  38 import java.util.List;                                                                                   </span>
<span  style="">  39                                                                                                          </span>
<span class="-2521262007515880622" onmouseenter="enter('-2521262007515880622');" onmouseout="out('-2521262007515880622');" style="">  40 import static org.apache.calcite.sql.SqlKind.IDENTIFIER;                                                 </span>
<span  style="">  41                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  42 /**                                                                                                      </span>
<span class="7745097592575645187" onmouseenter="enter('7745097592575645187');" onmouseout="out('7745097592575645187');" style="">  43  * 解析flink sql                                                                                           </span>
<span class="4344975189984981793" onmouseenter="enter('4344975189984981793');" onmouseout="out('4344975189984981793');" style="">  44  * sql 只支持 insert 开头的                                                                                    </span>
<span class="-704258415287748828" onmouseenter="enter('-704258415287748828');" onmouseout="out('-704258415287748828');" style="">  45  * Date: 2018/6/22                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  46  * Company: www.dtstack.com                                                                              </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  47  * @author xuchao                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  48  */                                                                                                      </span>
<span  style="">  49                                                                                                          </span>
<span class="2260027744038508987" onmouseenter="enter('2260027744038508987');" onmouseout="out('2260027744038508987');" style="">  50 public class InsertSqlParser implements IParser {                                                        </span>
<span  style="">  51                                                                                                          </span>
<span class="7449713827178994474" onmouseenter="enter('7449713827178994474');" onmouseout="out('7449713827178994474');" style="">  52     private FlinkPlanner flinkPlanner = new FlinkPlanner();                                              </span>
<span  style="">  53                                                                                                          </span>
<span class="1461371051478130716" onmouseenter="enter('1461371051478130716');" onmouseout="out('1461371051478130716');" style="">  54     // 用来标识当前解析节点的上一层节点是否为 insert 节点                                                                     </span>
<span class="6095630625593139817" onmouseenter="enter('6095630625593139817');" onmouseout="out('6095630625593139817');" style="">  55     private static Boolean parentIsInsert = false;                                                       </span>
<span  style="">  56                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  57     @Override                                                                                            </span>
<span class="2092801495564122916" onmouseenter="enter('2092801495564122916');" onmouseout="out('2092801495564122916');" style="">  58     public boolean verify(String sql) {                                                                  </span>
<span class="-6453349921868443163" onmouseenter="enter('-6453349921868443163');" onmouseout="out('-6453349921868443163');" style="">  59         return StringUtils.isNotBlank(sql) &amp;&amp; sql.trim().toLowerCase().startsWith(&quot;insert&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  60     }                                                                                                    </span>
<span  style="">  61                                                                                                          </span>
<span class="3637662161101374244" onmouseenter="enter('3637662161101374244');" onmouseout="out('3637662161101374244');" style="">  62     public static InsertSqlParser newInstance(){                                                         </span>
<span class="3030919886573972443" onmouseenter="enter('3030919886573972443');" onmouseout="out('3030919886573972443');" style="">  63         InsertSqlParser parser = new InsertSqlParser();                                                  </span>
<span class="3422310816985147925" onmouseenter="enter('3422310816985147925');" onmouseout="out('3422310816985147925');" style="">  64         return parser;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  65     }                                                                                                    </span>
<span  style="">  66                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  67     @Override                                                                                            </span>
<span class="1978536140497269371" onmouseenter="enter('1978536140497269371');" onmouseout="out('1978536140497269371');" style="">  68     public void parseSql(String sql, SqlTree sqlTree) throws Exception {                                 </span>
<span  style="">  69                                                                                                          </span>
<span  style="">  70                                                                                                          </span>
<span class="8499815483525337810" onmouseenter="enter('8499815483525337810');" onmouseout="out('8499815483525337810');" style="">  71         SqlNode sqlNode = flinkPlanner.getParser().parse(sql);                                           </span>
<span  style="">  72                                                                                                          </span>
<span class="1514033550138895862" onmouseenter="enter('1514033550138895862');" onmouseout="out('1514033550138895862');" style="">  73         SqlParseResult sqlParseResult = new SqlParseResult();                                            </span>
<span class="-1557788009333318197" onmouseenter="enter('-1557788009333318197');" onmouseout="out('-1557788009333318197');" style="">  74         parseNode(sqlNode, sqlParseResult);                                                              </span>
<span class="5986716603685301727" onmouseenter="enter('5986716603685301727');" onmouseout="out('5986716603685301727');" style="">  75         sqlParseResult.setExecSql(sqlNode.toString());                                                   </span>
<span class="2818767453667301834" onmouseenter="enter('2818767453667301834');" onmouseout="out('2818767453667301834');" style="">  76         sqlTree.addExecSql(sqlParseResult);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77     }                                                                                                    </span>
<span  style="">  78                                                                                                          </span>
<span class="-597868253990907964" onmouseenter="enter('-597868253990907964');" onmouseout="out('-597868253990907964');" style="">  79     private static void parseNode(SqlNode sqlNode, SqlParseResult sqlParseResult){                       </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style="">  80         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style="">  81         switch (sqlKind){                                                                                </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style="">  82             case INSERT:                                                                                 </span>
<span class="2646037727966090767" onmouseenter="enter('2646037727966090767');" onmouseout="out('2646037727966090767');" style="">  83                 SqlNode sqlTarget = ((SqlInsert)sqlNode).getTargetTable();                               </span>
<span class="-7853295063534246070" onmouseenter="enter('-7853295063534246070');" onmouseout="out('-7853295063534246070');" style="">  84                 SqlNode sqlSource = ((SqlInsert)sqlNode).getSource();                                    </span>
<span class="2646328150760623506" onmouseenter="enter('2646328150760623506');" onmouseout="out('2646328150760623506');" style="">  85                 sqlParseResult.addTargetTable(sqlTarget.toString());                                     </span>
<span class="3865517203793965283" onmouseenter="enter('3865517203793965283');" onmouseout="out('3865517203793965283');" style="">  86                 parentIsInsert = true;                                                                   </span>
<span class="6673792509799319812" onmouseenter="enter('6673792509799319812');" onmouseout="out('6673792509799319812');" style="">  87                 parseNode(sqlSource, sqlParseResult);                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="">  88                 break;                                                                                   </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style="">  89             case SELECT:                                                                                 </span>
<span class="-6587445636759965572" onmouseenter="enter('-6587445636759965572');" onmouseout="out('-6587445636759965572');" style="">  90                 SqlSelect sqlSelect = (SqlSelect) sqlNode;                                               </span>
<span class="3551219024900017087" onmouseenter="enter('3551219024900017087');" onmouseout="out('3551219024900017087');" style="">  91                 if (parentIsInsert) {                                                                    </span>
<span class="1716986497952209882" onmouseenter="enter('1716986497952209882');" onmouseout="out('1716986497952209882');" style="">  92                     rebuildSelectNode(sqlSelect.getSelectList(), sqlSelect);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93                 }                                                                                        </span>
<span class="-4229800989062838511" onmouseenter="enter('-4229800989062838511');" onmouseout="out('-4229800989062838511');" style="">  94                 SqlNode sqlFrom = ((SqlSelect) sqlNode).getFrom();                                       </span>
<span class="6191253572730585832" onmouseenter="enter('6191253572730585832');" onmouseout="out('6191253572730585832');" style="">  95                 if (sqlFrom.getKind() == IDENTIFIER) {                                                   </span>
<span class="8241530473190791640" onmouseenter="enter('8241530473190791640');" onmouseout="out('8241530473190791640');" style="">  96                     sqlParseResult.addSourceTable(sqlFrom.toString());                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  97                 } else {                                                                                 </span>
<span class="-1064722465081016619" onmouseenter="enter('-1064722465081016619');" onmouseout="out('-1064722465081016619');" style="">  98                     parentIsInsert = false;                                                              </span>
<span class="4128396176691967722" onmouseenter="enter('4128396176691967722');" onmouseout="out('4128396176691967722');" style="">  99                     parseNode(sqlFrom, sqlParseResult);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 100                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 101                 break;                                                                                   </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 102             case JOIN:                                                                                   </span>
<span class="7698802261704662279" onmouseenter="enter('7698802261704662279');" onmouseout="out('7698802261704662279');" style=""> 103                 SqlNode leftNode = ((SqlJoin)sqlNode).getLeft();                                         </span>
<span class="-6247618774659154031" onmouseenter="enter('-6247618774659154031');" onmouseout="out('-6247618774659154031');" style=""> 104                 SqlNode rightNode = ((SqlJoin)sqlNode).getRight();                                       </span>
<span  style=""> 105                                                                                                          </span>
<span class="-8190917917216144958" onmouseenter="enter('-8190917917216144958');" onmouseout="out('-8190917917216144958');" style=""> 106                 if(leftNode.getKind() == IDENTIFIER){                                                    </span>
<span class="-307510795650094250" onmouseenter="enter('-307510795650094250');" onmouseout="out('-307510795650094250');" style=""> 107                     sqlParseResult.addSourceTable(leftNode.toString());                                  </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 108                 }else{                                                                                   </span>
<span class="4207242849825940624" onmouseenter="enter('4207242849825940624');" onmouseout="out('4207242849825940624');" style=""> 109                     parseNode(leftNode, sqlParseResult);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110                 }                                                                                        </span>
<span  style=""> 111                                                                                                          </span>
<span class="-5648840450336709152" onmouseenter="enter('-5648840450336709152');" onmouseout="out('-5648840450336709152');" style=""> 112                 if(rightNode.getKind() == IDENTIFIER){                                                   </span>
<span class="-7238435843855989440" onmouseenter="enter('-7238435843855989440');" onmouseout="out('-7238435843855989440');" style=""> 113                     sqlParseResult.addSourceTable(rightNode.toString());                                 </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 114                 }else{                                                                                   </span>
<span class="-5366187044469072353" onmouseenter="enter('-5366187044469072353');" onmouseout="out('-5366187044469072353');" style=""> 115                     parseNode(rightNode, sqlParseResult);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 117                 break;                                                                                   </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 118             case AS:                                                                                     </span>
<span class="5826390168021483981" onmouseenter="enter('5826390168021483981');" onmouseout="out('5826390168021483981');" style=""> 119                 //不解析column,所以 as 相关的都是表                                                                 </span>
<span class="-5734921612668171253" onmouseenter="enter('-5734921612668171253');" onmouseout="out('-5734921612668171253');" style=""> 120                 SqlNode identifierNode = ((SqlBasicCall)sqlNode).getOperands()[0];                       </span>
<span class="-8687183585810485329" onmouseenter="enter('-8687183585810485329');" onmouseout="out('-8687183585810485329');" style=""> 121                 if(identifierNode.getKind() != IDENTIFIER){                                              </span>
<span class="-4744022615262891158" onmouseenter="enter('-4744022615262891158');" onmouseout="out('-4744022615262891158');" style=""> 122                     parseNode(identifierNode, sqlParseResult);                                           </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 123                 }else {                                                                                  </span>
<span class="6305370846253658960" onmouseenter="enter('6305370846253658960');" onmouseout="out('6305370846253658960');" style=""> 124                     sqlParseResult.addSourceTable(identifierNode.toString());                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 125                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 126                 break;                                                                                   </span>
<span class="5889755648968358721" onmouseenter="enter('5889755648968358721');" onmouseout="out('5889755648968358721');" style=""> 127             case MATCH_RECOGNIZE:                                                                        </span>
<span class="1373643275810848474" onmouseenter="enter('1373643275810848474');" onmouseout="out('1373643275810848474');" style=""> 128                 SqlMatchRecognize node = (SqlMatchRecognize) sqlNode;                                    </span>
<span class="8933858622159353818" onmouseenter="enter('8933858622159353818');" onmouseout="out('8933858622159353818');" style=""> 129                 sqlParseResult.addSourceTable(node.getTableRef().toString());                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 130                 break;                                                                                   </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 131             case UNION:                                                                                  </span>
<span class="-7477725012703906871" onmouseenter="enter('-7477725012703906871');" onmouseout="out('-7477725012703906871');" style=""> 132                 SqlNode unionLeft = ((SqlBasicCall)sqlNode).getOperands()[0];                            </span>
<span class="-368480979530163649" onmouseenter="enter('-368480979530163649');" onmouseout="out('-368480979530163649');" style=""> 133                 SqlNode unionRight = ((SqlBasicCall)sqlNode).getOperands()[1];                           </span>
<span class="3779552565426531876" onmouseenter="enter('3779552565426531876');" onmouseout="out('3779552565426531876');" style=""> 134                 if(unionLeft.getKind() == IDENTIFIER){                                                   </span>
<span class="-5358468360073063178" onmouseenter="enter('-5358468360073063178');" onmouseout="out('-5358468360073063178');" style=""> 135                     sqlParseResult.addSourceTable(unionLeft.toString());                                 </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 136                 }else{                                                                                   </span>
<span class="-2617274856762080939" onmouseenter="enter('-2617274856762080939');" onmouseout="out('-2617274856762080939');" style=""> 137                     parseNode(unionLeft, sqlParseResult);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138                 }                                                                                        </span>
<span class="7065528519182980902" onmouseenter="enter('7065528519182980902');" onmouseout="out('7065528519182980902');" style=""> 139                 if(unionRight.getKind() == IDENTIFIER){                                                  </span>
<span class="-9060067906181874961" onmouseenter="enter('-9060067906181874961');" onmouseout="out('-9060067906181874961');" style=""> 140                     sqlParseResult.addSourceTable(unionRight.toString());                                </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 141                 }else{                                                                                   </span>
<span class="-1718106092654689933" onmouseenter="enter('-1718106092654689933');" onmouseout="out('-1718106092654689933');" style=""> 142                     parseNode(unionRight, sqlParseResult);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 144                 break;                                                                                   </span>
<span class="9033815331900391172" onmouseenter="enter('9033815331900391172');" onmouseout="out('9033815331900391172');" style=""> 145             case ORDER_BY:                                                                               </span>
<span class="3723185693474391186" onmouseenter="enter('3723185693474391186');" onmouseout="out('3723185693474391186');" style=""> 146                 SqlOrderBy sqlOrderBy  = (SqlOrderBy) sqlNode;                                           </span>
<span class="4479816118151669611" onmouseenter="enter('4479816118151669611');" onmouseout="out('4479816118151669611');" style=""> 147                 parseNode(sqlOrderBy.query, sqlParseResult);                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 148                 break;                                                                                   </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 149             default:                                                                                     </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 150                 //do nothing                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 151                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 153     }                                                                                                    </span>
<span  style=""> 154                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 155     /**                                                                                                  </span>
<span class="425437455944800468" onmouseenter="enter('425437455944800468');" onmouseout="out('425437455944800468');" style=""> 156      * 将第一层 select 中的 sqlNode 转化为 AsNode，解决字段名冲突问题                                                       </span>
<span class="5061634859035675315" onmouseenter="enter('5061634859035675315');" onmouseout="out('5061634859035675315');" style=""> 157      * 仅对 table.xx 这种类型的字段进行替换                                                                           </span>
<span class="2039713584240146444" onmouseenter="enter('2039713584240146444');" onmouseout="out('2039713584240146444');" style=""> 158      * @param selectList select Node 的 select 字段                                                         </span>
<span class="-5725073247887320592" onmouseenter="enter('-5725073247887320592');" onmouseout="out('-5725073247887320592');" style=""> 159      * @param sqlSelect 第一层解析出来的 selectNode                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 160      */                                                                                                  </span>
<span class="5922338772528688925" onmouseenter="enter('5922338772528688925');" onmouseout="out('5922338772528688925');" style=""> 161     private static void rebuildSelectNode(SqlNodeList selectList, SqlSelect sqlSelect) {                 </span>
<span class="-5039170127940637600" onmouseenter="enter('-5039170127940637600');" onmouseout="out('-5039170127940637600');" style=""> 162         SqlNodeList sqlNodes = new SqlNodeList(selectList.getParserPosition());                          </span>
<span  style=""> 163                                                                                                          </span>
<span class="343879600078305884" onmouseenter="enter('343879600078305884');" onmouseout="out('343879600078305884');" style=""> 164         for (int index = 0; index &lt; selectList.size(); index++) {                                        </span>
<span class="-862031849753580800" onmouseenter="enter('-862031849753580800');" onmouseout="out('-862031849753580800');" style=""> 165             SqlNode sqlNode = selectList.get(index);                                                     </span>
<span class="-2578460539823980869" onmouseenter="enter('-2578460539823980869');" onmouseout="out('-2578460539823980869');" style=""> 166             // 判断sqlNode的类型是否属于 &#x27;t1.f1 as f2&#x27;                                                            </span>
<span class="5048377851733354050" onmouseenter="enter('5048377851733354050');" onmouseout="out('5048377851733354050');" style=""> 167             boolean isAsNode = sqlNode.getKind().equals(SqlKind.AS);                                     </span>
<span  style=""> 168                                                                                                          </span>
<span class="-7636926610308823144" onmouseenter="enter('-7636926610308823144');" onmouseout="out('-7636926610308823144');" style=""> 169             // 判断sqlNode的结构是否属于&#x27;f1&#x27; 或者 &#x27;t.*&#x27;                                                             </span>
<span class="8842452042957903214" onmouseenter="enter('8842452042957903214');" onmouseout="out('8842452042957903214');" style=""> 170             boolean isIdentifierOrStar = sqlNode.getClass().equals(SqlIdentifier.class)                  </span>
<span class="8216149235331840224" onmouseenter="enter('8216149235331840224');" onmouseout="out('8216149235331840224');" style=""> 171                     // sqlNode like &#x27;f1&#x27;                                                                 </span>
<span class="4825325517642827377" onmouseenter="enter('4825325517642827377');" onmouseout="out('4825325517642827377');" style=""> 172 &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD                                                                                             </span>
<span class="2301663565572323154" onmouseenter="enter('2301663565572323154');" onmouseout="out('2301663565572323154');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 173                     &amp;&amp; (((SqlIdentifier) sqlNode).names.size() == 1                                      </span>
<span class="8815254266839889504" onmouseenter="enter('8815254266839889504');" onmouseout="out('8815254266839889504');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174                     // sqlNode like &#x27;t.*&#x27;                                                                </span>
<span class="-8133538842001433253" onmouseenter="enter('-8133538842001433253');" onmouseout="out('-8133538842001433253');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 175                     || StringUtils.isBlank(((SqlIdentifier) sqlNode).names.get(1)));                     </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 176 =======                                                                                                  </span>
<span class="-6555710588983893024" onmouseenter="enter('-6555710588983893024');" onmouseout="out('-6555710588983893024');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177                     &amp;&amp; (((SqlIdentifier) sqlNode).isSimple()                                             </span>
<span class="8815254266839889504" onmouseenter="enter('8815254266839889504');" onmouseout="out('8815254266839889504');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178                     // sqlNode like &#x27;t.*&#x27;                                                                </span>
<span class="-1007775631400642269" onmouseenter="enter('-1007775631400642269');" onmouseout="out('-1007775631400642269');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179                     || ((SqlIdentifier) sqlNode).isStar());                                              </span>
<span class="5933788354678768164" onmouseenter="enter('5933788354678768164');" onmouseout="out('5933788354678768164');" style=""> 180 &gt;&gt;&gt;&gt;&gt;&gt;&gt; e52022440e11ac5d851e44be4c0c529050223903                                                         </span>
<span  style=""> 181                                                                                                          </span>
<span class="7707072008253188751" onmouseenter="enter('7707072008253188751');" onmouseout="out('7707072008253188751');" style=""> 182             if (isAsNode || isIdentifierOrStar) {                                                        </span>
<span class="-4097224917928195160" onmouseenter="enter('-4097224917928195160');" onmouseout="out('-4097224917928195160');" style=""> 183                 sqlNodes.add(sqlNode);                                                                   </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 184                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185             }                                                                                            </span>
<span  style=""> 186                                                                                                          </span>
<span class="-2733430377230189789" onmouseenter="enter('-2733430377230189789');" onmouseout="out('-2733430377230189789');" style=""> 187             if (!sqlNode.getClass().equals(SqlIdentifier.class)) {                                       </span>
<span class="-4772172748755107816" onmouseenter="enter('-4772172748755107816');" onmouseout="out('-4772172748755107816');" style=""> 188                 if (sqlNode.getKind().equals(SqlKind.LITERAL)) {                                         </span>
<span class="71185610508294362" onmouseenter="enter('71185610508294362');" onmouseout="out('71185610508294362');" style=""><abbr title=" 189                     throw new IllegalArgumentException(String.format(&quot;Constants %s in the SELECT statement must be aliased!&quot;,"> 189                     throw new IllegalArgumentException(String.format(&quot;Constants %s in the SELECT statemen🔵</abbr></span>
<span class="-2683332635210278463" onmouseenter="enter('-2683332635210278463');" onmouseout="out('-2683332635210278463');" style=""> 190                             sqlNode.toString()));                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191                 }                                                                                        </span>
<span class="-4706648042477805395" onmouseenter="enter('-4706648042477805395');" onmouseout="out('-4706648042477805395');" style=""><abbr title=" 192                 throw new RuntimeException(String.format(&quot;Illegal statement! Please check the statement: %s&quot;,"> 192                 throw new RuntimeException(String.format(&quot;Illegal statement! Please check the statement: 🔵</abbr></span>
<span class="-2683332635210278463" onmouseenter="enter('-2683332635210278463');" onmouseout="out('-2683332635210278463');" style=""> 193                         sqlNode.toString()));                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194             }                                                                                            </span>
<span  style=""> 195                                                                                                          </span>
<span class="5476004887086667819" onmouseenter="enter('5476004887086667819');" onmouseout="out('5476004887086667819');" style=""> 196             sqlNodes.add(transformToAsNode(sqlNode));                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197         }                                                                                                </span>
<span class="-3996420935691854843" onmouseenter="enter('-3996420935691854843');" onmouseout="out('-3996420935691854843');" style=""> 198         sqlSelect.setSelectList(sqlNodes);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199     }                                                                                                    </span>
<span  style=""> 200                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 201     /**                                                                                                  </span>
<span class="-4664929224134271960" onmouseenter="enter('-4664929224134271960');" onmouseout="out('-4664929224134271960');" style=""> 202      * 将 sqlNode 转化为 AsNode                                                                              </span>
<span class="-2117917073515803213" onmouseenter="enter('-2117917073515803213');" onmouseout="out('-2117917073515803213');" style=""> 203      * @param sqlNode 需要转化的 sqlNode                                                                      </span>
<span class="7567586887564748591" onmouseenter="enter('7567586887564748591');" onmouseout="out('7567586887564748591');" style=""> 204      * @return 重新构造的 AsNode                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 205      */                                                                                                  </span>
<span class="-2689707916993061627" onmouseenter="enter('-2689707916993061627');" onmouseout="out('-2689707916993061627');" style=""> 206     public static SqlBasicCall transformToAsNode(SqlNode sqlNode) {                                      </span>
<span class="-8357059688166569654" onmouseenter="enter('-8357059688166569654');" onmouseout="out('-8357059688166569654');" style=""> 207         String asName = &quot;&quot;;                                                                              </span>
<span class="-5346646982964147658" onmouseenter="enter('-5346646982964147658');" onmouseout="out('-5346646982964147658');" style=""> 208         SqlParserPos pos = new SqlParserPos(sqlNode.getParserPosition().getLineNum(),                    </span>
<span class="-8534758370861444561" onmouseenter="enter('-8534758370861444561');" onmouseout="out('-8534758370861444561');" style=""> 209                                             sqlNode.getParserPosition().getEndColumnNum());              </span>
<span class="3909600863175221319" onmouseenter="enter('3909600863175221319');" onmouseout="out('3909600863175221319');" style=""> 210         if (sqlNode.getKind().equals(SqlKind.IDENTIFIER)) {                                              </span>
<span class="-6734847535232911160" onmouseenter="enter('-6734847535232911160');" onmouseout="out('-6734847535232911160');" style=""> 211             asName = ((SqlIdentifier) sqlNode).names.get(1);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212         }                                                                                                </span>
<span class="-6629769419150459383" onmouseenter="enter('-6629769419150459383');" onmouseout="out('-6629769419150459383');" style=""> 213         SqlNode[] operands = new SqlNode[2];                                                             </span>
<span class="5673677563739985763" onmouseenter="enter('5673677563739985763');" onmouseout="out('5673677563739985763');" style=""> 214         operands[0] = sqlNode;                                                                           </span>
<span class="9062082844214631566" onmouseenter="enter('9062082844214631566');" onmouseout="out('9062082844214631566');" style=""> 215         operands[1] = new SqlIdentifier(asName, null, pos);                                              </span>
<span class="-1315247439335526800" onmouseenter="enter('-1315247439335526800');" onmouseout="out('-1315247439335526800');" style=""> 216         return new SqlBasicCall(new SqlAsOperator(), operands, pos);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217     }                                                                                                    </span>
<span  style=""> 218                                                                                                          </span>
<span class="-5717905756360440039" onmouseenter="enter('-5717905756360440039');" onmouseout="out('-5717905756360440039');" style=""> 219     public static class SqlParseResult {                                                                 </span>
<span  style=""> 220                                                                                                          </span>
<span class="1587904348878184014" onmouseenter="enter('1587904348878184014');" onmouseout="out('1587904348878184014');" style=""> 221         private List&lt;String&gt; sourceTableList = Lists.newArrayList();                                     </span>
<span  style=""> 222                                                                                                          </span>
<span class="-1479693990071194125" onmouseenter="enter('-1479693990071194125');" onmouseout="out('-1479693990071194125');" style=""> 223         private List&lt;String&gt; targetTableList = Lists.newArrayList();                                     </span>
<span  style=""> 224                                                                                                          </span>
<span class="8437363304882776179" onmouseenter="enter('8437363304882776179');" onmouseout="out('8437363304882776179');" style=""> 225         private String execSql;                                                                          </span>
<span  style=""> 226                                                                                                          </span>
<span class="5144548036770890441" onmouseenter="enter('5144548036770890441');" onmouseout="out('5144548036770890441');" style=""> 227         public void addSourceTable(String sourceTable){                                                  </span>
<span class="3920005572951608068" onmouseenter="enter('3920005572951608068');" onmouseout="out('3920005572951608068');" style=""> 228             sourceTableList.add(sourceTable);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229         }                                                                                                </span>
<span  style=""> 230                                                                                                          </span>
<span class="2239855044100079830" onmouseenter="enter('2239855044100079830');" onmouseout="out('2239855044100079830');" style=""> 231         public void addTargetTable(String targetTable){                                                  </span>
<span class="-7020491181635877882" onmouseenter="enter('-7020491181635877882');" onmouseout="out('-7020491181635877882');" style=""> 232             targetTableList.add(targetTable);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233         }                                                                                                </span>
<span  style=""> 234                                                                                                          </span>
<span class="-7363026318680376964" onmouseenter="enter('-7363026318680376964');" onmouseout="out('-7363026318680376964');" style=""> 235         public List&lt;String&gt; getSourceTableList() {                                                       </span>
<span class="7081270282315381863" onmouseenter="enter('7081270282315381863');" onmouseout="out('7081270282315381863');" style=""> 236             return sourceTableList;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237         }                                                                                                </span>
<span  style=""> 238                                                                                                          </span>
<span class="-8775504114915320905" onmouseenter="enter('-8775504114915320905');" onmouseout="out('-8775504114915320905');" style=""> 239         public List&lt;String&gt; getTargetTableList() {                                                       </span>
<span class="3901193726515838075" onmouseenter="enter('3901193726515838075');" onmouseout="out('3901193726515838075');" style=""> 240             return targetTableList;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241         }                                                                                                </span>
<span  style=""> 242                                                                                                          </span>
<span class="7459959708918851119" onmouseenter="enter('7459959708918851119');" onmouseout="out('7459959708918851119');" style=""> 243         public String getExecSql() {                                                                     </span>
<span class="4154186148994399560" onmouseenter="enter('4154186148994399560');" onmouseout="out('4154186148994399560');" style=""> 244             return execSql;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245         }                                                                                                </span>
<span  style=""> 246                                                                                                          </span>
<span class="7557197678911800826" onmouseenter="enter('7557197678911800826');" onmouseout="out('7557197678911800826');" style=""> 247         public void setExecSql(String execSql) {                                                         </span>
<span class="5784569524175592813" onmouseenter="enter('5784569524175592813');" onmouseout="out('5784569524175592813');" style=""> 248             this.execSql = execSql;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251 }                                                                                                        </span>














</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="1224993673552058858" onmouseenter="enter('1224993673552058858');" onmouseout="out('1224993673552058858');" style="">  18 package com.dtstack.flink.sql.parser;                                                                    </span>
<span  style="">  19                                                                                                          </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  20 import com.google.common.collect.Lists;                                                                  </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  21 import java.util.List;                                                                                   </span>
<span class="-6347312057640942811" onmouseenter="enter('-6347312057640942811');" onmouseout="out('-6347312057640942811');" style="">  22 import org.apache.calcite.sql.SqlAsOperator;                                                             </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  23 import org.apache.calcite.sql.SqlBasicCall;                                                              </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  24 import org.apache.calcite.sql.SqlIdentifier;                                                             </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  25 import org.apache.calcite.sql.SqlInsert;                                                                 </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  26 import org.apache.calcite.sql.SqlJoin;                                                                   </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  27 import org.apache.calcite.sql.SqlKind;                                                                   </span>
<span class="-6443913902114896099" onmouseenter="enter('-6443913902114896099');" onmouseout="out('-6443913902114896099');" style="">  28 import org.apache.calcite.sql.SqlMatchRecognize;                                                         </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  29 import org.apache.calcite.sql.SqlNode;                                                                   </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  30 import org.apache.calcite.sql.SqlNodeList;                                                               </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  31 import org.apache.calcite.sql.SqlOrderBy;                                                                </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  32 import org.apache.calcite.sql.SqlSelect;                                                                 </span>
<span class="-8475519504744506507" onmouseenter="enter('-8475519504744506507');" onmouseout="out('-8475519504744506507');" style="">  33 import org.apache.calcite.sql.parser.SqlParserPos;                                                       </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  34 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="6392557416326297682" onmouseenter="enter('6392557416326297682');" onmouseout="out('6392557416326297682');" style="">  35 import org.apache.flink.table.planner.calcite.FlinkPlannerImpl;                                          </span>
<span class="-2521262007515880622" onmouseenter="enter('-2521262007515880622');" onmouseout="out('-2521262007515880622');" style="">  36 import static org.apache.calcite.sql.SqlKind.IDENTIFIER;                                                 </span>
<span  style="">  37                                                                                                          </span>
<span  style="">  38                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  39 /**                                                                                                      </span>
<span class="7745097592575645187" onmouseenter="enter('7745097592575645187');" onmouseout="out('7745097592575645187');" style="">  40  * 解析flink sql                                                                                           </span>
<span class="4344975189984981793" onmouseenter="enter('4344975189984981793');" onmouseout="out('4344975189984981793');" style="">  41  * sql 只支持 insert 开头的                                                                                    </span>
<span class="-704258415287748828" onmouseenter="enter('-704258415287748828');" onmouseout="out('-704258415287748828');" style="">  42  * Date: 2018/6/22                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  43  * Company: www.dtstack.com                                                                              </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  44  * @author xuchao                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  45  */                                                                                                      </span>
<span class="2260027744038508987" onmouseenter="enter('2260027744038508987');" onmouseout="out('2260027744038508987');" style="">  46 public class InsertSqlParser implements IParser {                                                        </span>
<span class="7449713827178994474" onmouseenter="enter('7449713827178994474');" onmouseout="out('7449713827178994474');" style="">  47     private FlinkPlanner flinkPlanner = new FlinkPlanner();                                              </span>
<span  style="">  48                                                                                                          </span>
<span class="1461371051478130716" onmouseenter="enter('1461371051478130716');" onmouseout="out('1461371051478130716');" style="">  49     // 用来标识当前解析节点的上一层节点是否为 insert 节点                                                                     </span>
<span class="1461371051478130716" onmouseenter="enter('1461371051478130716');" onmouseout="out('1461371051478130716');" style="">  50     // 用来标识当前解析节点的上一层节点是否为 insert 节点                                                                     </span>
<span class="6095630625593139817" onmouseenter="enter('6095630625593139817');" onmouseout="out('6095630625593139817');" style="">  51     private static Boolean parentIsInsert = false;                                                       </span>
<span  style="">  52                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  53     @Override                                                                                            </span>
<span class="2092801495564122916" onmouseenter="enter('2092801495564122916');" onmouseout="out('2092801495564122916');" style="">  54     public boolean verify(String sql) {                                                                  </span>
<span class="-6453349921868443163" onmouseenter="enter('-6453349921868443163');" onmouseout="out('-6453349921868443163');" style="">  55         return StringUtils.isNotBlank(sql) &amp;&amp; sql.trim().toLowerCase().startsWith(&quot;insert&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  56     }                                                                                                    </span>
<span  style="">  57                                                                                                          </span>
<span class="3637662161101374244" onmouseenter="enter('3637662161101374244');" onmouseout="out('3637662161101374244');" style="">  58     public static InsertSqlParser newInstance(){                                                         </span>
<span class="3030919886573972443" onmouseenter="enter('3030919886573972443');" onmouseout="out('3030919886573972443');" style="">  59         InsertSqlParser parser = new InsertSqlParser();                                                  </span>
<span class="3422310816985147925" onmouseenter="enter('3422310816985147925');" onmouseout="out('3422310816985147925');" style="">  60         return parser;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  61     }                                                                                                    </span>
<span  style="">  62                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  63     @Override                                                                                            </span>
<span class="1978536140497269371" onmouseenter="enter('1978536140497269371');" onmouseout="out('1978536140497269371');" style="">  64     public void parseSql(String sql, SqlTree sqlTree) throws Exception {                                 </span>
<span  style="">  65                                                                                                          </span>
<span  style="">  66                                                                                                          </span>
<span class="8499815483525337810" onmouseenter="enter('8499815483525337810');" onmouseout="out('8499815483525337810');" style="">  67         SqlNode sqlNode = flinkPlanner.getParser().parse(sql);                                           </span>
<span  style="">  68                                                                                                          </span>
<span class="1514033550138895862" onmouseenter="enter('1514033550138895862');" onmouseout="out('1514033550138895862');" style="">  69         SqlParseResult sqlParseResult = new SqlParseResult();                                            </span>
<span class="-1557788009333318197" onmouseenter="enter('-1557788009333318197');" onmouseout="out('-1557788009333318197');" style="">  70         parseNode(sqlNode, sqlParseResult);                                                              </span>
<span class="5986716603685301727" onmouseenter="enter('5986716603685301727');" onmouseout="out('5986716603685301727');" style="">  71         sqlParseResult.setExecSql(sqlNode.toString());                                                   </span>
<span class="2818767453667301834" onmouseenter="enter('2818767453667301834');" onmouseout="out('2818767453667301834');" style="">  72         sqlTree.addExecSql(sqlParseResult);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  73     }                                                                                                    </span>
<span  style="">  74                                                                                                          </span>
<span class="-597868253990907964" onmouseenter="enter('-597868253990907964');" onmouseout="out('-597868253990907964');" style="">  75     private static void parseNode(SqlNode sqlNode, SqlParseResult sqlParseResult){                       </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style="">  76         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style="">  77         switch (sqlKind){                                                                                </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style="">  78             case INSERT:                                                                                 </span>
<span class="2646037727966090767" onmouseenter="enter('2646037727966090767');" onmouseout="out('2646037727966090767');" style="">  79                 SqlNode sqlTarget = ((SqlInsert)sqlNode).getTargetTable();                               </span>
<span class="-7853295063534246070" onmouseenter="enter('-7853295063534246070');" onmouseout="out('-7853295063534246070');" style="">  80                 SqlNode sqlSource = ((SqlInsert)sqlNode).getSource();                                    </span>
<span class="2646328150760623506" onmouseenter="enter('2646328150760623506');" onmouseout="out('2646328150760623506');" style="">  81                 sqlParseResult.addTargetTable(sqlTarget.toString());                                     </span>
<span class="3865517203793965283" onmouseenter="enter('3865517203793965283');" onmouseout="out('3865517203793965283');" style="">  82                 parentIsInsert = true;                                                                   </span>
<span class="6673792509799319812" onmouseenter="enter('6673792509799319812');" onmouseout="out('6673792509799319812');" style="">  83                 parseNode(sqlSource, sqlParseResult);                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="">  84                 break;                                                                                   </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style="">  85             case SELECT:                                                                                 </span>
<span class="-6587445636759965572" onmouseenter="enter('-6587445636759965572');" onmouseout="out('-6587445636759965572');" style="">  86                 SqlSelect sqlSelect = (SqlSelect) sqlNode;                                               </span>
<span class="3551219024900017087" onmouseenter="enter('3551219024900017087');" onmouseout="out('3551219024900017087');" style="">  87                 if (parentIsInsert) {                                                                    </span>
<span class="1716986497952209882" onmouseenter="enter('1716986497952209882');" onmouseout="out('1716986497952209882');" style="">  88                     rebuildSelectNode(sqlSelect.getSelectList(), sqlSelect);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  89                 }                                                                                        </span>
<span class="-4229800989062838511" onmouseenter="enter('-4229800989062838511');" onmouseout="out('-4229800989062838511');" style="">  90                 SqlNode sqlFrom = ((SqlSelect) sqlNode).getFrom();                                       </span>
<span class="6191253572730585832" onmouseenter="enter('6191253572730585832');" onmouseout="out('6191253572730585832');" style="">  91                 if (sqlFrom.getKind() == IDENTIFIER) {                                                   </span>
<span class="8241530473190791640" onmouseenter="enter('8241530473190791640');" onmouseout="out('8241530473190791640');" style="">  92                     sqlParseResult.addSourceTable(sqlFrom.toString());                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  93                 } else {                                                                                 </span>
<span class="-1064722465081016619" onmouseenter="enter('-1064722465081016619');" onmouseout="out('-1064722465081016619');" style="">  94                     parentIsInsert = false;                                                              </span>
<span class="4128396176691967722" onmouseenter="enter('4128396176691967722');" onmouseout="out('4128396176691967722');" style="">  95                     parseNode(sqlFrom, sqlParseResult);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="">  97                 break;                                                                                   </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style="">  98             case JOIN:                                                                                   </span>
<span class="7698802261704662279" onmouseenter="enter('7698802261704662279');" onmouseout="out('7698802261704662279');" style="">  99                 SqlNode leftNode = ((SqlJoin)sqlNode).getLeft();                                         </span>
<span class="-6247618774659154031" onmouseenter="enter('-6247618774659154031');" onmouseout="out('-6247618774659154031');" style=""> 100                 SqlNode rightNode = ((SqlJoin)sqlNode).getRight();                                       </span>
<span  style=""> 101                                                                                                          </span>
<span class="-8190917917216144958" onmouseenter="enter('-8190917917216144958');" onmouseout="out('-8190917917216144958');" style=""> 102                 if(leftNode.getKind() == IDENTIFIER){                                                    </span>
<span class="-307510795650094250" onmouseenter="enter('-307510795650094250');" onmouseout="out('-307510795650094250');" style=""> 103                     sqlParseResult.addSourceTable(leftNode.toString());                                  </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 104                 }else{                                                                                   </span>
<span class="4207242849825940624" onmouseenter="enter('4207242849825940624');" onmouseout="out('4207242849825940624');" style=""> 105                     parseNode(leftNode, sqlParseResult);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106                 }                                                                                        </span>
<span  style=""> 107                                                                                                          </span>
<span class="-5648840450336709152" onmouseenter="enter('-5648840450336709152');" onmouseout="out('-5648840450336709152');" style=""> 108                 if(rightNode.getKind() == IDENTIFIER){                                                   </span>
<span class="-7238435843855989440" onmouseenter="enter('-7238435843855989440');" onmouseout="out('-7238435843855989440');" style=""> 109                     sqlParseResult.addSourceTable(rightNode.toString());                                 </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 110                 }else{                                                                                   </span>
<span class="-5366187044469072353" onmouseenter="enter('-5366187044469072353');" onmouseout="out('-5366187044469072353');" style=""> 111                     parseNode(rightNode, sqlParseResult);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 113                 break;                                                                                   </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 114             case AS:                                                                                     </span>
<span class="5826390168021483981" onmouseenter="enter('5826390168021483981');" onmouseout="out('5826390168021483981');" style=""> 115                 //不解析column,所以 as 相关的都是表                                                                 </span>
<span class="-5734921612668171253" onmouseenter="enter('-5734921612668171253');" onmouseout="out('-5734921612668171253');" style=""> 116                 SqlNode identifierNode = ((SqlBasicCall)sqlNode).getOperands()[0];                       </span>
<span class="-8687183585810485329" onmouseenter="enter('-8687183585810485329');" onmouseout="out('-8687183585810485329');" style=""> 117                 if(identifierNode.getKind() != IDENTIFIER){                                              </span>
<span class="-4744022615262891158" onmouseenter="enter('-4744022615262891158');" onmouseout="out('-4744022615262891158');" style=""> 118                     parseNode(identifierNode, sqlParseResult);                                           </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 119                 }else {                                                                                  </span>
<span class="6305370846253658960" onmouseenter="enter('6305370846253658960');" onmouseout="out('6305370846253658960');" style=""> 120                     sqlParseResult.addSourceTable(identifierNode.toString());                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 122                 break;                                                                                   </span>
<span class="5889755648968358721" onmouseenter="enter('5889755648968358721');" onmouseout="out('5889755648968358721');" style=""> 123             case MATCH_RECOGNIZE:                                                                        </span>
<span class="1373643275810848474" onmouseenter="enter('1373643275810848474');" onmouseout="out('1373643275810848474');" style=""> 124                 SqlMatchRecognize node = (SqlMatchRecognize) sqlNode;                                    </span>
<span class="8933858622159353818" onmouseenter="enter('8933858622159353818');" onmouseout="out('8933858622159353818');" style=""> 125                 sqlParseResult.addSourceTable(node.getTableRef().toString());                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 126                 break;                                                                                   </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 127             case UNION:                                                                                  </span>
<span class="-7477725012703906871" onmouseenter="enter('-7477725012703906871');" onmouseout="out('-7477725012703906871');" style=""> 128                 SqlNode unionLeft = ((SqlBasicCall)sqlNode).getOperands()[0];                            </span>
<span class="-368480979530163649" onmouseenter="enter('-368480979530163649');" onmouseout="out('-368480979530163649');" style=""> 129                 SqlNode unionRight = ((SqlBasicCall)sqlNode).getOperands()[1];                           </span>
<span class="3779552565426531876" onmouseenter="enter('3779552565426531876');" onmouseout="out('3779552565426531876');" style=""> 130                 if(unionLeft.getKind() == IDENTIFIER){                                                   </span>
<span class="-5358468360073063178" onmouseenter="enter('-5358468360073063178');" onmouseout="out('-5358468360073063178');" style=""> 131                     sqlParseResult.addSourceTable(unionLeft.toString());                                 </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 132                 }else{                                                                                   </span>
<span class="-2617274856762080939" onmouseenter="enter('-2617274856762080939');" onmouseout="out('-2617274856762080939');" style=""> 133                     parseNode(unionLeft, sqlParseResult);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134                 }                                                                                        </span>
<span class="7065528519182980902" onmouseenter="enter('7065528519182980902');" onmouseout="out('7065528519182980902');" style=""> 135                 if(unionRight.getKind() == IDENTIFIER){                                                  </span>
<span class="-9060067906181874961" onmouseenter="enter('-9060067906181874961');" onmouseout="out('-9060067906181874961');" style=""> 136                     sqlParseResult.addSourceTable(unionRight.toString());                                </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 137                 }else{                                                                                   </span>
<span class="-1718106092654689933" onmouseenter="enter('-1718106092654689933');" onmouseout="out('-1718106092654689933');" style=""> 138                     parseNode(unionRight, sqlParseResult);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 140                 break;                                                                                   </span>
<span class="9033815331900391172" onmouseenter="enter('9033815331900391172');" onmouseout="out('9033815331900391172');" style=""> 141             case ORDER_BY:                                                                               </span>
<span class="3723185693474391186" onmouseenter="enter('3723185693474391186');" onmouseout="out('3723185693474391186');" style=""> 142                 SqlOrderBy sqlOrderBy  = (SqlOrderBy) sqlNode;                                           </span>
<span class="4479816118151669611" onmouseenter="enter('4479816118151669611');" onmouseout="out('4479816118151669611');" style=""> 143                 parseNode(sqlOrderBy.query, sqlParseResult);                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 144                 break;                                                                                   </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 145             default:                                                                                     </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 146                 //do nothing                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 147                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 149     }                                                                                                    </span>
<span  style=""> 150                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 151     /**                                                                                                  </span>
<span class="425437455944800468" onmouseenter="enter('425437455944800468');" onmouseout="out('425437455944800468');" style=""> 152      * 将第一层 select 中的 sqlNode 转化为 AsNode，解决字段名冲突问题                                                       </span>
<span class="5061634859035675315" onmouseenter="enter('5061634859035675315');" onmouseout="out('5061634859035675315');" style=""> 153      * 仅对 table.xx 这种类型的字段进行替换                                                                           </span>
<span class="2039713584240146444" onmouseenter="enter('2039713584240146444');" onmouseout="out('2039713584240146444');" style=""> 154      * @param selectList select Node 的 select 字段                                                         </span>
<span class="-5725073247887320592" onmouseenter="enter('-5725073247887320592');" onmouseout="out('-5725073247887320592');" style=""> 155      * @param sqlSelect 第一层解析出来的 selectNode                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 156      */                                                                                                  </span>
<span class="5922338772528688925" onmouseenter="enter('5922338772528688925');" onmouseout="out('5922338772528688925');" style=""> 157     private static void rebuildSelectNode(SqlNodeList selectList, SqlSelect sqlSelect) {                 </span>
<span class="-5039170127940637600" onmouseenter="enter('-5039170127940637600');" onmouseout="out('-5039170127940637600');" style=""> 158         SqlNodeList sqlNodes = new SqlNodeList(selectList.getParserPosition());                          </span>
<span class="-2578460539823980869" onmouseenter="enter('-2578460539823980869');" onmouseout="out('-2578460539823980869');" style=""> 159             // 判断sqlNode的类型是否属于 &#x27;t1.f1 as f2&#x27;                                                            </span>
<span class="-7636926610308823144" onmouseenter="enter('-7636926610308823144');" onmouseout="out('-7636926610308823144');" style=""> 160             // 判断sqlNode的结构是否属于&#x27;f1&#x27; 或者 &#x27;t.*&#x27;                                                             </span>
<span class="8216149235331840224" onmouseenter="enter('8216149235331840224');" onmouseout="out('8216149235331840224');" style=""> 161                     // sqlNode like &#x27;f1&#x27;                                                                 </span>
<span class="8815254266839889504" onmouseenter="enter('8815254266839889504');" onmouseout="out('8815254266839889504');" style=""> 162                     // sqlNode like &#x27;t.*&#x27;                                                                </span>
<span class="8815254266839889504" onmouseenter="enter('8815254266839889504');" onmouseout="out('8815254266839889504');" style=""> 163                     // sqlNode like &#x27;t.*&#x27;                                                                </span>
<span class="143616384832850354" onmouseenter="enter('143616384832850354');" onmouseout="out('143616384832850354');" style=""> 164         for (int index = 0; index &lt; selectList.size(); index++);                                         </span>
<span class="7707072008253188751" onmouseenter="enter('7707072008253188751');" onmouseout="out('7707072008253188751');" style=""> 165         if (isAsNode || isIdentifierOrStar) {                                                            </span>
<span class="-4097224917928195160" onmouseenter="enter('-4097224917928195160');" onmouseout="out('-4097224917928195160');" style=""> 166             sqlNodes.add(sqlNode);                                                                       </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 167             continue;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168         }                                                                                                </span>
<span class="-2733430377230189789" onmouseenter="enter('-2733430377230189789');" onmouseout="out('-2733430377230189789');" style=""> 169         if (!sqlNode.getClass().equals(SqlIdentifier.class)) {                                           </span>
<span class="-4772172748755107816" onmouseenter="enter('-4772172748755107816');" onmouseout="out('-4772172748755107816');" style=""> 170             if (sqlNode.getKind().equals(SqlKind.LITERAL)) {                                             </span>
<span class="-7753913818906388468" onmouseenter="enter('-7753913818906388468');" onmouseout="out('-7753913818906388468');" style=""><abbr title=" 171                 throw new IllegalArgumentException(String.format(&quot;Constants %s in the SELECT statement must be aliased!&quot;, sqlNode.toString()));"> 171                 throw new IllegalArgumentException(String.format(&quot;Constants %s in the SELECT statement mu🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172             }                                                                                            </span>
<span class="641406221583176213" onmouseenter="enter('641406221583176213');" onmouseout="out('641406221583176213');" style=""><abbr title=" 173             throw new RuntimeException(String.format(&quot;Illegal statement! Please check the statement: %s&quot;, sqlNode.toString()));"> 173             throw new RuntimeException(String.format(&quot;Illegal statement! Please check the statement: %s&quot;,🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174         }                                                                                                </span>
<span class="5476004887086667819" onmouseenter="enter('5476004887086667819');" onmouseout="out('5476004887086667819');" style=""> 175         sqlNodes.add(transformToAsNode(sqlNode));                                                        </span>
<span class="-3996420935691854843" onmouseenter="enter('-3996420935691854843');" onmouseout="out('-3996420935691854843');" style=""> 176         sqlSelect.setSelectList(sqlNodes);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177     }                                                                                                    </span>
<span  style=""> 178                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 179     /**                                                                                                  </span>
<span class="-4664929224134271960" onmouseenter="enter('-4664929224134271960');" onmouseout="out('-4664929224134271960');" style=""> 180      * 将 sqlNode 转化为 AsNode                                                                              </span>
<span class="-2117917073515803213" onmouseenter="enter('-2117917073515803213');" onmouseout="out('-2117917073515803213');" style=""> 181      * @param sqlNode 需要转化的 sqlNode                                                                      </span>
<span class="7567586887564748591" onmouseenter="enter('7567586887564748591');" onmouseout="out('7567586887564748591');" style=""> 182      * @return 重新构造的 AsNode                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 183      */                                                                                                  </span>
<span class="-2689707916993061627" onmouseenter="enter('-2689707916993061627');" onmouseout="out('-2689707916993061627');" style=""> 184     public static SqlBasicCall transformToAsNode(SqlNode sqlNode) {                                      </span>
<span class="-8357059688166569654" onmouseenter="enter('-8357059688166569654');" onmouseout="out('-8357059688166569654');" style=""> 185         String asName = &quot;&quot;;                                                                              </span>
<span class="-5346646982964147658" onmouseenter="enter('-5346646982964147658');" onmouseout="out('-5346646982964147658');" style=""> 186         SqlParserPos pos = new SqlParserPos(sqlNode.getParserPosition().getLineNum(),                    </span>
<span class="-8534758370861444561" onmouseenter="enter('-8534758370861444561');" onmouseout="out('-8534758370861444561');" style=""> 187                                             sqlNode.getParserPosition().getEndColumnNum());              </span>
<span class="3909600863175221319" onmouseenter="enter('3909600863175221319');" onmouseout="out('3909600863175221319');" style=""> 188         if (sqlNode.getKind().equals(SqlKind.IDENTIFIER)) {                                              </span>
<span class="-6734847535232911160" onmouseenter="enter('-6734847535232911160');" onmouseout="out('-6734847535232911160');" style=""> 189             asName = ((SqlIdentifier) sqlNode).names.get(1);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190         }                                                                                                </span>
<span class="-6629769419150459383" onmouseenter="enter('-6629769419150459383');" onmouseout="out('-6629769419150459383');" style=""> 191         SqlNode[] operands = new SqlNode[2];                                                             </span>
<span class="5673677563739985763" onmouseenter="enter('5673677563739985763');" onmouseout="out('5673677563739985763');" style=""> 192         operands[0] = sqlNode;                                                                           </span>
<span class="9062082844214631566" onmouseenter="enter('9062082844214631566');" onmouseout="out('9062082844214631566');" style=""> 193         operands[1] = new SqlIdentifier(asName, null, pos);                                              </span>
<span class="-1315247439335526800" onmouseenter="enter('-1315247439335526800');" onmouseout="out('-1315247439335526800');" style=""> 194         return new SqlBasicCall(new SqlAsOperator(), operands, pos);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195     }                                                                                                    </span>
<span  style=""> 196                                                                                                          </span>
<span class="-5717905756360440039" onmouseenter="enter('-5717905756360440039');" onmouseout="out('-5717905756360440039');" style=""> 197     public static class SqlParseResult {                                                                 </span>
<span class="1587904348878184014" onmouseenter="enter('1587904348878184014');" onmouseout="out('1587904348878184014');" style=""> 198         private List&lt;String&gt; sourceTableList = Lists.newArrayList();                                     </span>
<span  style=""> 199                                                                                                          </span>
<span class="-1479693990071194125" onmouseenter="enter('-1479693990071194125');" onmouseout="out('-1479693990071194125');" style=""> 200         private List&lt;String&gt; targetTableList = Lists.newArrayList();                                     </span>
<span  style=""> 201                                                                                                          </span>
<span class="8437363304882776179" onmouseenter="enter('8437363304882776179');" onmouseout="out('8437363304882776179');" style=""> 202         private String execSql;                                                                          </span>
<span  style=""> 203                                                                                                          </span>
<span class="-2198483008967905672" onmouseenter="enter('-2198483008967905672');" onmouseout="out('-2198483008967905672');" style=""> 204         public void addSourceTable(String sourceTable) {                                                 </span>
<span class="3920005572951608068" onmouseenter="enter('3920005572951608068');" onmouseout="out('3920005572951608068');" style=""> 205             sourceTableList.add(sourceTable);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206         }                                                                                                </span>
<span  style=""> 207                                                                                                          </span>
<span class="7318825121337911992" onmouseenter="enter('7318825121337911992');" onmouseout="out('7318825121337911992');" style=""> 208         public void addTargetTable(String targetTable) {                                                 </span>
<span class="-7020491181635877882" onmouseenter="enter('-7020491181635877882');" onmouseout="out('-7020491181635877882');" style=""> 209             targetTableList.add(targetTable);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210         }                                                                                                </span>
<span  style=""> 211                                                                                                          </span>
<span class="-7363026318680376964" onmouseenter="enter('-7363026318680376964');" onmouseout="out('-7363026318680376964');" style=""> 212         public List&lt;String&gt; getSourceTableList() {                                                       </span>
<span class="7081270282315381863" onmouseenter="enter('7081270282315381863');" onmouseout="out('7081270282315381863');" style=""> 213             return sourceTableList;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214         }                                                                                                </span>
<span  style=""> 215                                                                                                          </span>
<span class="-8775504114915320905" onmouseenter="enter('-8775504114915320905');" onmouseout="out('-8775504114915320905');" style=""> 216         public List&lt;String&gt; getTargetTableList() {                                                       </span>
<span class="3901193726515838075" onmouseenter="enter('3901193726515838075');" onmouseout="out('3901193726515838075');" style=""> 217             return targetTableList;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218         }                                                                                                </span>
<span  style=""> 219                                                                                                          </span>
<span class="7459959708918851119" onmouseenter="enter('7459959708918851119');" onmouseout="out('7459959708918851119');" style=""> 220         public String getExecSql() {                                                                     </span>
<span class="4154186148994399560" onmouseenter="enter('4154186148994399560');" onmouseout="out('4154186148994399560');" style=""> 221             return execSql;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222         }                                                                                                </span>
<span  style=""> 223                                                                                                          </span>
<span class="7557197678911800826" onmouseenter="enter('7557197678911800826');" onmouseout="out('7557197678911800826');" style=""> 224         public void setExecSql(String execSql) {                                                         </span>
<span class="5784569524175592813" onmouseenter="enter('5784569524175592813');" onmouseout="out('5784569524175592813');" style=""> 225             this.execSql = execSql;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228 }                                                                                                        </span>





































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span class="1224993673552058858" onmouseenter="enter('1224993673552058858');" onmouseout="out('1224993673552058858');" style="">  20  package com.dtstack.flink.sql.parser;                                                                             </span>
<span  style="">  21                                                                                                                    </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  22  import org.apache.calcite.sql.SqlInsert;                                                                          </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  23  import org.apache.calcite.sql.SqlJoin;                                                                            </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  24  import org.apache.calcite.sql.SqlKind;                                                                            </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  25  import org.apache.calcite.sql.SqlNode;                                                                            </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  26  import org.apache.calcite.sql.SqlSelect;                                                                          </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  27  import org.apache.calcite.sql.SqlNodeList;                                                                        </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  28  import org.apache.calcite.sql.SqlBasicCall;                                                                       </span>
<span class="-6443913902114896099" onmouseenter="enter('-6443913902114896099');" onmouseout="out('-6443913902114896099');" style="">  29  import org.apache.calcite.sql.SqlMatchRecognize;                                                                  </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  30  import org.apache.calcite.sql.SqlOrderBy;                                                                         </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  31  import org.apache.calcite.sql.SqlIdentifier;                                                                      </span>
<span class="-6347312057640942811" onmouseenter="enter('-6347312057640942811');" onmouseout="out('-6347312057640942811');" style="">  32  import org.apache.calcite.sql.SqlAsOperator;                                                                      </span>
<span class="-8475519504744506507" onmouseenter="enter('-8475519504744506507');" onmouseout="out('-8475519504744506507');" style="">  33  import org.apache.calcite.sql.parser.SqlParserPos;                                                                </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  34  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  35  import com.google.common.collect.Lists;                                                                           </span>
<span class="6392557416326297682" onmouseenter="enter('6392557416326297682');" onmouseout="out('6392557416326297682');" style="">  36  import org.apache.flink.table.planner.calcite.FlinkPlannerImpl;                                                   </span>
<span  style="">  37                                                                                                                    </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  38  import java.util.List;                                                                                            </span>
<span  style="">  39                                                                                                                    </span>
<span class="-2521262007515880622" onmouseenter="enter('-2521262007515880622');" onmouseout="out('-2521262007515880622');" style="">  40  import static org.apache.calcite.sql.SqlKind.IDENTIFIER;                                                          </span>
<span  style="">  41                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  42  /**                                                                                                               </span>
<span class="7745097592575645187" onmouseenter="enter('7745097592575645187');" onmouseout="out('7745097592575645187');" style="">  43   * 解析flink sql                                                                                                    </span>
<span class="4344975189984981793" onmouseenter="enter('4344975189984981793');" onmouseout="out('4344975189984981793');" style="">  44   * sql 只支持 insert 开头的                                                                                             </span>
<span class="-704258415287748828" onmouseenter="enter('-704258415287748828');" onmouseout="out('-704258415287748828');" style="">  45   * Date: 2018/6/22                                                                                                </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  46   * Company: www.dtstack.com                                                                                       </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  47   * @author xuchao                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  48   */                                                                                                               </span>
<span  style="">  49                                                                                                                    </span>
<span class="2260027744038508987" onmouseenter="enter('2260027744038508987');" onmouseout="out('2260027744038508987');" style="">  50  public class InsertSqlParser implements IParser {                                                                 </span>
<span  style="">  51                                                                                                                    </span>
<span class="7449713827178994474" onmouseenter="enter('7449713827178994474');" onmouseout="out('7449713827178994474');" style="">  52      private FlinkPlanner flinkPlanner = new FlinkPlanner();                                                       </span>
<span  style="">  53                                                                                                                    </span>
<span class="1461371051478130716" onmouseenter="enter('1461371051478130716');" onmouseout="out('1461371051478130716');" style="">  54      // 用来标识当前解析节点的上一层节点是否为 insert 节点                                                                              </span>
<span class="6095630625593139817" onmouseenter="enter('6095630625593139817');" onmouseout="out('6095630625593139817');" style="">  55      private static Boolean parentIsInsert = false;                                                                </span>
<span  style="">  56                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  57      @Override                                                                                                     </span>
<span class="2092801495564122916" onmouseenter="enter('2092801495564122916');" onmouseout="out('2092801495564122916');" style="">  58      public boolean verify(String sql) {                                                                           </span>
<span class="-6453349921868443163" onmouseenter="enter('-6453349921868443163');" onmouseout="out('-6453349921868443163');" style="">  59          return StringUtils.isNotBlank(sql) &amp;&amp; sql.trim().toLowerCase().startsWith(&quot;insert&quot;);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  60      }                                                                                                             </span>
<span  style="">  61                                                                                                                    </span>
<span class="3637662161101374244" onmouseenter="enter('3637662161101374244');" onmouseout="out('3637662161101374244');" style="">  62      public static InsertSqlParser newInstance(){                                                                  </span>
<span class="3030919886573972443" onmouseenter="enter('3030919886573972443');" onmouseout="out('3030919886573972443');" style="">  63          InsertSqlParser parser = new InsertSqlParser();                                                           </span>
<span class="3422310816985147925" onmouseenter="enter('3422310816985147925');" onmouseout="out('3422310816985147925');" style="">  64          return parser;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  65      }                                                                                                             </span>
<span  style="">  66                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  67      @Override                                                                                                     </span>
<span class="1978536140497269371" onmouseenter="enter('1978536140497269371');" onmouseout="out('1978536140497269371');" style="">  68      public void parseSql(String sql, SqlTree sqlTree) throws Exception {                                          </span>
<span  style="">  69                                                                                                                    </span>
<span  style="">  70                                                                                                                    </span>
<span class="8499815483525337810" onmouseenter="enter('8499815483525337810');" onmouseout="out('8499815483525337810');" style="">  71          SqlNode sqlNode = flinkPlanner.getParser().parse(sql);                                                    </span>
<span  style="">  72                                                                                                                    </span>
<span class="1514033550138895862" onmouseenter="enter('1514033550138895862');" onmouseout="out('1514033550138895862');" style="">  73          SqlParseResult sqlParseResult = new SqlParseResult();                                                     </span>
<span class="-1557788009333318197" onmouseenter="enter('-1557788009333318197');" onmouseout="out('-1557788009333318197');" style="">  74          parseNode(sqlNode, sqlParseResult);                                                                       </span>
<span class="5986716603685301727" onmouseenter="enter('5986716603685301727');" onmouseout="out('5986716603685301727');" style="">  75          sqlParseResult.setExecSql(sqlNode.toString());                                                            </span>
<span class="2818767453667301834" onmouseenter="enter('2818767453667301834');" onmouseout="out('2818767453667301834');" style="">  76          sqlTree.addExecSql(sqlParseResult);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77      }                                                                                                             </span>
<span  style="">  78                                                                                                                    </span>
<span class="-597868253990907964" onmouseenter="enter('-597868253990907964');" onmouseout="out('-597868253990907964');" style="">  79      private static void parseNode(SqlNode sqlNode, SqlParseResult sqlParseResult){                                </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style="">  80          SqlKind sqlKind = sqlNode.getKind();                                                                      </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style="">  81          switch (sqlKind){                                                                                         </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style="">  82              case INSERT:                                                                                          </span>
<span class="2646037727966090767" onmouseenter="enter('2646037727966090767');" onmouseout="out('2646037727966090767');" style="">  83                  SqlNode sqlTarget = ((SqlInsert)sqlNode).getTargetTable();                                        </span>
<span class="-7853295063534246070" onmouseenter="enter('-7853295063534246070');" onmouseout="out('-7853295063534246070');" style="">  84                  SqlNode sqlSource = ((SqlInsert)sqlNode).getSource();                                             </span>
<span class="2646328150760623506" onmouseenter="enter('2646328150760623506');" onmouseout="out('2646328150760623506');" style="">  85                  sqlParseResult.addTargetTable(sqlTarget.toString());                                              </span>
<span class="3865517203793965283" onmouseenter="enter('3865517203793965283');" onmouseout="out('3865517203793965283');" style="">  86                  parentIsInsert = true;                                                                            </span>
<span class="6673792509799319812" onmouseenter="enter('6673792509799319812');" onmouseout="out('6673792509799319812');" style="">  87                  parseNode(sqlSource, sqlParseResult);                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="">  88                  break;                                                                                            </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style="">  89              case SELECT:                                                                                          </span>
<span class="-6587445636759965572" onmouseenter="enter('-6587445636759965572');" onmouseout="out('-6587445636759965572');" style="">  90                  SqlSelect sqlSelect = (SqlSelect) sqlNode;                                                        </span>
<span class="3551219024900017087" onmouseenter="enter('3551219024900017087');" onmouseout="out('3551219024900017087');" style="">  91                  if (parentIsInsert) {                                                                             </span>
<span class="1716986497952209882" onmouseenter="enter('1716986497952209882');" onmouseout="out('1716986497952209882');" style="">  92                      rebuildSelectNode(sqlSelect.getSelectList(), sqlSelect);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93                  }                                                                                                 </span>
<span class="-4229800989062838511" onmouseenter="enter('-4229800989062838511');" onmouseout="out('-4229800989062838511');" style="">  94                  SqlNode sqlFrom = ((SqlSelect) sqlNode).getFrom();                                                </span>
<span class="6191253572730585832" onmouseenter="enter('6191253572730585832');" onmouseout="out('6191253572730585832');" style="">  95                  if (sqlFrom.getKind() == IDENTIFIER) {                                                            </span>
<span class="8241530473190791640" onmouseenter="enter('8241530473190791640');" onmouseout="out('8241530473190791640');" style="">  96                      sqlParseResult.addSourceTable(sqlFrom.toString());                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  97                  } else {                                                                                          </span>
<span class="-1064722465081016619" onmouseenter="enter('-1064722465081016619');" onmouseout="out('-1064722465081016619');" style="">  98                      parentIsInsert = false;                                                                       </span>
<span class="4128396176691967722" onmouseenter="enter('4128396176691967722');" onmouseout="out('4128396176691967722');" style="">  99                      parseNode(sqlFrom, sqlParseResult);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 100                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 101                  break;                                                                                            </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 102              case JOIN:                                                                                            </span>
<span class="7698802261704662279" onmouseenter="enter('7698802261704662279');" onmouseout="out('7698802261704662279');" style=""> 103                  SqlNode leftNode = ((SqlJoin)sqlNode).getLeft();                                                  </span>
<span class="-6247618774659154031" onmouseenter="enter('-6247618774659154031');" onmouseout="out('-6247618774659154031');" style=""> 104                  SqlNode rightNode = ((SqlJoin)sqlNode).getRight();                                                </span>
<span  style=""> 105                                                                                                                    </span>
<span class="-8190917917216144958" onmouseenter="enter('-8190917917216144958');" onmouseout="out('-8190917917216144958');" style=""> 106                  if(leftNode.getKind() == IDENTIFIER){                                                             </span>
<span class="-307510795650094250" onmouseenter="enter('-307510795650094250');" onmouseout="out('-307510795650094250');" style=""> 107                      sqlParseResult.addSourceTable(leftNode.toString());                                           </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 108                  }else{                                                                                            </span>
<span class="4207242849825940624" onmouseenter="enter('4207242849825940624');" onmouseout="out('4207242849825940624');" style=""> 109                      parseNode(leftNode, sqlParseResult);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110                  }                                                                                                 </span>
<span  style=""> 111                                                                                                                    </span>
<span class="-5648840450336709152" onmouseenter="enter('-5648840450336709152');" onmouseout="out('-5648840450336709152');" style=""> 112                  if(rightNode.getKind() == IDENTIFIER){                                                            </span>
<span class="-7238435843855989440" onmouseenter="enter('-7238435843855989440');" onmouseout="out('-7238435843855989440');" style=""> 113                      sqlParseResult.addSourceTable(rightNode.toString());                                          </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 114                  }else{                                                                                            </span>
<span class="-5366187044469072353" onmouseenter="enter('-5366187044469072353');" onmouseout="out('-5366187044469072353');" style=""> 115                      parseNode(rightNode, sqlParseResult);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 117                  break;                                                                                            </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 118              case AS:                                                                                              </span>
<span class="5826390168021483981" onmouseenter="enter('5826390168021483981');" onmouseout="out('5826390168021483981');" style=""> 119                  //不解析column,所以 as 相关的都是表                                                                          </span>
<span class="-5734921612668171253" onmouseenter="enter('-5734921612668171253');" onmouseout="out('-5734921612668171253');" style=""> 120                  SqlNode identifierNode = ((SqlBasicCall)sqlNode).getOperands()[0];                                </span>
<span class="-8687183585810485329" onmouseenter="enter('-8687183585810485329');" onmouseout="out('-8687183585810485329');" style=""> 121                  if(identifierNode.getKind() != IDENTIFIER){                                                       </span>
<span class="-4744022615262891158" onmouseenter="enter('-4744022615262891158');" onmouseout="out('-4744022615262891158');" style=""> 122                      parseNode(identifierNode, sqlParseResult);                                                    </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 123                  }else {                                                                                           </span>
<span class="6305370846253658960" onmouseenter="enter('6305370846253658960');" onmouseout="out('6305370846253658960');" style=""> 124                      sqlParseResult.addSourceTable(identifierNode.toString());                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 125                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 126                  break;                                                                                            </span>
<span class="5889755648968358721" onmouseenter="enter('5889755648968358721');" onmouseout="out('5889755648968358721');" style=""> 127              case MATCH_RECOGNIZE:                                                                                 </span>
<span class="1373643275810848474" onmouseenter="enter('1373643275810848474');" onmouseout="out('1373643275810848474');" style=""> 128                  SqlMatchRecognize node = (SqlMatchRecognize) sqlNode;                                             </span>
<span class="8933858622159353818" onmouseenter="enter('8933858622159353818');" onmouseout="out('8933858622159353818');" style=""> 129                  sqlParseResult.addSourceTable(node.getTableRef().toString());                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 130                  break;                                                                                            </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 131              case UNION:                                                                                           </span>
<span class="-7477725012703906871" onmouseenter="enter('-7477725012703906871');" onmouseout="out('-7477725012703906871');" style=""> 132                  SqlNode unionLeft = ((SqlBasicCall)sqlNode).getOperands()[0];                                     </span>
<span class="-368480979530163649" onmouseenter="enter('-368480979530163649');" onmouseout="out('-368480979530163649');" style=""> 133                  SqlNode unionRight = ((SqlBasicCall)sqlNode).getOperands()[1];                                    </span>
<span class="3779552565426531876" onmouseenter="enter('3779552565426531876');" onmouseout="out('3779552565426531876');" style=""> 134                  if(unionLeft.getKind() == IDENTIFIER){                                                            </span>
<span class="-5358468360073063178" onmouseenter="enter('-5358468360073063178');" onmouseout="out('-5358468360073063178');" style=""> 135                      sqlParseResult.addSourceTable(unionLeft.toString());                                          </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 136                  }else{                                                                                            </span>
<span class="-2617274856762080939" onmouseenter="enter('-2617274856762080939');" onmouseout="out('-2617274856762080939');" style=""> 137                      parseNode(unionLeft, sqlParseResult);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138                  }                                                                                                 </span>
<span class="7065528519182980902" onmouseenter="enter('7065528519182980902');" onmouseout="out('7065528519182980902');" style=""> 139                  if(unionRight.getKind() == IDENTIFIER){                                                           </span>
<span class="-9060067906181874961" onmouseenter="enter('-9060067906181874961');" onmouseout="out('-9060067906181874961');" style=""> 140                      sqlParseResult.addSourceTable(unionRight.toString());                                         </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 141                  }else{                                                                                            </span>
<span class="-1718106092654689933" onmouseenter="enter('-1718106092654689933');" onmouseout="out('-1718106092654689933');" style=""> 142                      parseNode(unionRight, sqlParseResult);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 144                  break;                                                                                            </span>
<span class="9033815331900391172" onmouseenter="enter('9033815331900391172');" onmouseout="out('9033815331900391172');" style=""> 145              case ORDER_BY:                                                                                        </span>
<span class="3723185693474391186" onmouseenter="enter('3723185693474391186');" onmouseout="out('3723185693474391186');" style=""> 146                  SqlOrderBy sqlOrderBy  = (SqlOrderBy) sqlNode;                                                    </span>
<span class="4479816118151669611" onmouseenter="enter('4479816118151669611');" onmouseout="out('4479816118151669611');" style=""> 147                  parseNode(sqlOrderBy.query, sqlParseResult);                                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 148                  break;                                                                                            </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 149              default:                                                                                              </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 150                  //do nothing                                                                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 151                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 153      }                                                                                                             </span>
<span  style=""> 154                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 155      /**                                                                                                           </span>
<span class="425437455944800468" onmouseenter="enter('425437455944800468');" onmouseout="out('425437455944800468');" style=""> 156       * 将第一层 select 中的 sqlNode 转化为 AsNode，解决字段名冲突问题                                                                </span>
<span class="5061634859035675315" onmouseenter="enter('5061634859035675315');" onmouseout="out('5061634859035675315');" style=""> 157       * 仅对 table.xx 这种类型的字段进行替换                                                                                    </span>
<span class="2039713584240146444" onmouseenter="enter('2039713584240146444');" onmouseout="out('2039713584240146444');" style=""> 158       * @param selectList select Node 的 select 字段                                                                  </span>
<span class="-5725073247887320592" onmouseenter="enter('-5725073247887320592');" onmouseout="out('-5725073247887320592');" style=""> 159       * @param sqlSelect 第一层解析出来的 selectNode                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 160       */                                                                                                           </span>
<span class="5922338772528688925" onmouseenter="enter('5922338772528688925');" onmouseout="out('5922338772528688925');" style=""> 161      private static void rebuildSelectNode(SqlNodeList selectList, SqlSelect sqlSelect) {                          </span>
<span class="-5039170127940637600" onmouseenter="enter('-5039170127940637600');" onmouseout="out('-5039170127940637600');" style=""> 162          SqlNodeList sqlNodes = new SqlNodeList(selectList.getParserPosition());                                   </span>
<span  style=""> 163                                                                                                                    </span>
<span class="343879600078305884" onmouseenter="enter('343879600078305884');" onmouseout="out('343879600078305884');" style=""> 164          for (int index = 0; index &lt; selectList.size(); index++) {                                                 </span>
<span class="-862031849753580800" onmouseenter="enter('-862031849753580800');" onmouseout="out('-862031849753580800');" style=""> 165              SqlNode sqlNode = selectList.get(index);                                                              </span>
<span class="-2578460539823980869" onmouseenter="enter('-2578460539823980869');" onmouseout="out('-2578460539823980869');" style=""> 166              // 判断sqlNode的类型是否属于 &#x27;t1.f1 as f2&#x27;                                                                     </span>
<span class="5048377851733354050" onmouseenter="enter('5048377851733354050');" onmouseout="out('5048377851733354050');" style=""> 167              boolean isAsNode = sqlNode.getKind().equals(SqlKind.AS);                                              </span>
<span  style=""> 168                                                                                                                    </span>
<span class="-7636926610308823144" onmouseenter="enter('-7636926610308823144');" onmouseout="out('-7636926610308823144');" style=""> 169              // 判断sqlNode的结构是否属于&#x27;f1&#x27; 或者 &#x27;t.*&#x27;                                                                      </span>
<span class="8842452042957903214" onmouseenter="enter('8842452042957903214');" onmouseout="out('8842452042957903214');" style=""> 170              boolean isIdentifierOrStar = sqlNode.getClass().equals(SqlIdentifier.class)                           </span>
<span class="8216149235331840224" onmouseenter="enter('8216149235331840224');" onmouseout="out('8216149235331840224');" style=""> 171                      // sqlNode like &#x27;f1&#x27;                                                                          </span>
<span class="4825325517642827377" onmouseenter="enter('4825325517642827377');" onmouseout="out('4825325517642827377');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 172 +&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD                                                                                                      </span>
<span class="2301663565572323154" onmouseenter="enter('2301663565572323154');" onmouseout="out('2301663565572323154');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 173 +                    &amp;&amp; (((SqlIdentifier) sqlNode).names.size() == 1                                               </span>
<span class="8815254266839889504" onmouseenter="enter('8815254266839889504');" onmouseout="out('8815254266839889504');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 174 +                    // sqlNode like &#x27;t.*&#x27;                                                                         </span>
<span class="-8133538842001433253" onmouseenter="enter('-8133538842001433253');" onmouseout="out('-8133538842001433253');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +                    || StringUtils.isBlank(((SqlIdentifier) sqlNode).names.get(1)));                              </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +=======                                                                                                           </span>
<span class="-6555710588983893024" onmouseenter="enter('-6555710588983893024');" onmouseout="out('-6555710588983893024');" style=""> 177                      &amp;&amp; (((SqlIdentifier) sqlNode).isSimple()                                                      </span>
<span class="8815254266839889504" onmouseenter="enter('8815254266839889504');" onmouseout="out('8815254266839889504');" style=""> 178                      // sqlNode like &#x27;t.*&#x27;                                                                         </span>
<span class="-1007775631400642269" onmouseenter="enter('-1007775631400642269');" onmouseout="out('-1007775631400642269');" style=""> 179                      || ((SqlIdentifier) sqlNode).isStar());                                                       </span>
<span class="5933788354678768164" onmouseenter="enter('5933788354678768164');" onmouseout="out('5933788354678768164');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 180 +&gt;&gt;&gt;&gt;&gt;&gt;&gt; e52022440e11ac5d851e44be4c0c529050223903                                                                  </span>
<span  style=""> 181                                                                                                                    </span>
<span class="7707072008253188751" onmouseenter="enter('7707072008253188751');" onmouseout="out('7707072008253188751');" style=""> 182              if (isAsNode || isIdentifierOrStar) {                                                                 </span>
<span class="-4097224917928195160" onmouseenter="enter('-4097224917928195160');" onmouseout="out('-4097224917928195160');" style=""> 183                  sqlNodes.add(sqlNode);                                                                            </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 184                  continue;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185              }                                                                                                     </span>
<span  style=""> 186                                                                                                                    </span>
<span class="-2733430377230189789" onmouseenter="enter('-2733430377230189789');" onmouseout="out('-2733430377230189789');" style=""> 187              if (!sqlNode.getClass().equals(SqlIdentifier.class)) {                                                </span>
<span class="-4772172748755107816" onmouseenter="enter('-4772172748755107816');" onmouseout="out('-4772172748755107816');" style=""> 188                  if (sqlNode.getKind().equals(SqlKind.LITERAL)) {                                                  </span>
<span class="71185610508294362" onmouseenter="enter('71185610508294362');" onmouseout="out('71185610508294362');" style=""><abbr title=" 189                      throw new IllegalArgumentException(String.format(&quot;Constants %s in the SELECT statement must be aliased!&quot;,"> 189                      throw new IllegalArgumentException(String.format(&quot;Constants %s in the SELECT statement must be🔵</abbr></span>
<span class="-2683332635210278463" onmouseenter="enter('-2683332635210278463');" onmouseout="out('-2683332635210278463');" style=""> 190                              sqlNode.toString()));                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191                  }                                                                                                 </span>
<span class="-4706648042477805395" onmouseenter="enter('-4706648042477805395');" onmouseout="out('-4706648042477805395');" style=""> 192                  throw new RuntimeException(String.format(&quot;Illegal statement! Please check the statement: %s&quot;,     </span>
<span class="-2683332635210278463" onmouseenter="enter('-2683332635210278463');" onmouseout="out('-2683332635210278463');" style=""> 193                          sqlNode.toString()));                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194              }                                                                                                     </span>
<span  style=""> 195                                                                                                                    </span>
<span class="5476004887086667819" onmouseenter="enter('5476004887086667819');" onmouseout="out('5476004887086667819');" style=""> 196              sqlNodes.add(transformToAsNode(sqlNode));                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197          }                                                                                                         </span>
<span class="-3996420935691854843" onmouseenter="enter('-3996420935691854843');" onmouseout="out('-3996420935691854843');" style=""> 198          sqlSelect.setSelectList(sqlNodes);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199      }                                                                                                             </span>
<span  style=""> 200                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 201      /**                                                                                                           </span>
<span class="-4664929224134271960" onmouseenter="enter('-4664929224134271960');" onmouseout="out('-4664929224134271960');" style=""> 202       * 将 sqlNode 转化为 AsNode                                                                                       </span>
<span class="-2117917073515803213" onmouseenter="enter('-2117917073515803213');" onmouseout="out('-2117917073515803213');" style=""> 203       * @param sqlNode 需要转化的 sqlNode                                                                               </span>
<span class="7567586887564748591" onmouseenter="enter('7567586887564748591');" onmouseout="out('7567586887564748591');" style=""> 204       * @return 重新构造的 AsNode                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 205       */                                                                                                           </span>
<span class="-2689707916993061627" onmouseenter="enter('-2689707916993061627');" onmouseout="out('-2689707916993061627');" style=""> 206      public static SqlBasicCall transformToAsNode(SqlNode sqlNode) {                                               </span>
<span class="-8357059688166569654" onmouseenter="enter('-8357059688166569654');" onmouseout="out('-8357059688166569654');" style=""> 207          String asName = &quot;&quot;;                                                                                       </span>
<span class="-5346646982964147658" onmouseenter="enter('-5346646982964147658');" onmouseout="out('-5346646982964147658');" style=""> 208          SqlParserPos pos = new SqlParserPos(sqlNode.getParserPosition().getLineNum(),                             </span>
<span class="-8534758370861444561" onmouseenter="enter('-8534758370861444561');" onmouseout="out('-8534758370861444561');" style=""> 209                                              sqlNode.getParserPosition().getEndColumnNum());                       </span>
<span class="3909600863175221319" onmouseenter="enter('3909600863175221319');" onmouseout="out('3909600863175221319');" style=""> 210          if (sqlNode.getKind().equals(SqlKind.IDENTIFIER)) {                                                       </span>
<span class="-6734847535232911160" onmouseenter="enter('-6734847535232911160');" onmouseout="out('-6734847535232911160');" style=""> 211              asName = ((SqlIdentifier) sqlNode).names.get(1);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212          }                                                                                                         </span>
<span class="-6629769419150459383" onmouseenter="enter('-6629769419150459383');" onmouseout="out('-6629769419150459383');" style=""> 213          SqlNode[] operands = new SqlNode[2];                                                                      </span>
<span class="5673677563739985763" onmouseenter="enter('5673677563739985763');" onmouseout="out('5673677563739985763');" style=""> 214          operands[0] = sqlNode;                                                                                    </span>
<span class="9062082844214631566" onmouseenter="enter('9062082844214631566');" onmouseout="out('9062082844214631566');" style=""> 215          operands[1] = new SqlIdentifier(asName, null, pos);                                                       </span>
<span class="-1315247439335526800" onmouseenter="enter('-1315247439335526800');" onmouseout="out('-1315247439335526800');" style=""> 216          return new SqlBasicCall(new SqlAsOperator(), operands, pos);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217      }                                                                                                             </span>
<span  style=""> 218                                                                                                                    </span>
<span class="-5717905756360440039" onmouseenter="enter('-5717905756360440039');" onmouseout="out('-5717905756360440039');" style=""> 219      public static class SqlParseResult {                                                                          </span>
<span  style=""> 220                                                                                                                    </span>
<span class="1587904348878184014" onmouseenter="enter('1587904348878184014');" onmouseout="out('1587904348878184014');" style=""> 221          private List&lt;String&gt; sourceTableList = Lists.newArrayList();                                              </span>
<span  style=""> 222                                                                                                                    </span>
<span class="-1479693990071194125" onmouseenter="enter('-1479693990071194125');" onmouseout="out('-1479693990071194125');" style=""> 223          private List&lt;String&gt; targetTableList = Lists.newArrayList();                                              </span>
<span  style=""> 224                                                                                                                    </span>
<span class="8437363304882776179" onmouseenter="enter('8437363304882776179');" onmouseout="out('8437363304882776179');" style=""> 225          private String execSql;                                                                                   </span>
<span  style=""> 226                                                                                                                    </span>
<span class="5144548036770890441" onmouseenter="enter('5144548036770890441');" onmouseout="out('5144548036770890441');" style=""> 227          public void addSourceTable(String sourceTable){                                                           </span>
<span class="3920005572951608068" onmouseenter="enter('3920005572951608068');" onmouseout="out('3920005572951608068');" style=""> 228              sourceTableList.add(sourceTable);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229          }                                                                                                         </span>
<span  style=""> 230                                                                                                                    </span>
<span class="2239855044100079830" onmouseenter="enter('2239855044100079830');" onmouseout="out('2239855044100079830');" style=""> 231          public void addTargetTable(String targetTable){                                                           </span>
<span class="-7020491181635877882" onmouseenter="enter('-7020491181635877882');" onmouseout="out('-7020491181635877882');" style=""> 232              targetTableList.add(targetTable);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233          }                                                                                                         </span>
<span  style=""> 234                                                                                                                    </span>
<span class="-7363026318680376964" onmouseenter="enter('-7363026318680376964');" onmouseout="out('-7363026318680376964');" style=""> 235          public List&lt;String&gt; getSourceTableList() {                                                                </span>
<span class="7081270282315381863" onmouseenter="enter('7081270282315381863');" onmouseout="out('7081270282315381863');" style=""> 236              return sourceTableList;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237          }                                                                                                         </span>
<span  style=""> 238                                                                                                                    </span>
<span class="-8775504114915320905" onmouseenter="enter('-8775504114915320905');" onmouseout="out('-8775504114915320905');" style=""> 239          public List&lt;String&gt; getTargetTableList() {                                                                </span>
<span class="3901193726515838075" onmouseenter="enter('3901193726515838075');" onmouseout="out('3901193726515838075');" style=""> 240              return targetTableList;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241          }                                                                                                         </span>
<span  style=""> 242                                                                                                                    </span>
<span class="7459959708918851119" onmouseenter="enter('7459959708918851119');" onmouseout="out('7459959708918851119');" style=""> 243          public String getExecSql() {                                                                              </span>
<span class="4154186148994399560" onmouseenter="enter('4154186148994399560');" onmouseout="out('4154186148994399560');" style=""> 244              return execSql;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245          }                                                                                                         </span>
<span  style=""> 246                                                                                                                    </span>
<span class="7557197678911800826" onmouseenter="enter('7557197678911800826');" onmouseout="out('7557197678911800826');" style=""> 247          public void setExecSql(String execSql) {                                                                  </span>
<span class="5784569524175592813" onmouseenter="enter('5784569524175592813');" onmouseout="out('5784569524175592813');" style=""> 248              this.execSql = execSql;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251  }                                                                                                                 </span></pre></td>
                            <td><pre></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            