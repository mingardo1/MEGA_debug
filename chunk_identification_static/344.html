<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>344</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    344
                    <a href="343.html">prev</a>
                    <a href="345.html">next</a>
                    <a href="344_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_296f212b688307caed07340a18589621a66963a6_hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;296f212b688307caed07340a18589621a66963a6:hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;296f212b688307caed07340a18589621a66963a6^1:hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;296f212b688307caed07340a18589621a66963a6^2:hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;31f1ea14a44dc5df28823b0897609031044a15b1:hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span  style="">  20                                                                                                          </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  21 package com.dtstack.flink.sql.sink.hbase;                                                                </span>
<span  style="">  22                                                                                                          </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  23 import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                    </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  24 import com.google.common.collect.Maps;                                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  25 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  26 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  27 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  28 import org.apache.flink.types.Row;                                                                       </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  29 import org.apache.flink.util.Preconditions;                                                              </span>
<span class="-2774002081156384359" onmouseenter="enter('-2774002081156384359');" onmouseout="out('-2774002081156384359');" style="">  30 import org.apache.hadoop.hbase.*;                                                                        </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  31 import org.apache.hadoop.hbase.client.Connection;                                                        </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  32 import org.apache.hadoop.hbase.client.ConnectionFactory;                                                 </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  33 import org.apache.hadoop.hbase.client.Put;                                                               </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  34 import org.apache.hadoop.hbase.client.Table;                                                             </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  35 import org.apache.hadoop.security.UserGroupInformation;                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  36 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  37 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  38                                                                                                          </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  39 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  40 import java.io.IOException;                                                                              </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="">  41 import java.security.PrivilegedAction;                                                                   </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  42 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  43 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45 import java.io.IOException;                                                                              </span>
<span class="7560529663732492491" onmouseenter="enter('7560529663732492491');" onmouseout="out('7560529663732492491');" style="">  46 &lt;&lt;&lt;&lt;&lt;&lt;&lt; OURS                                                                                             </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  47 =======                                                                                                  </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  48 =======                                                                                                  </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  49 import java.util.List;                                                                                   </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  50 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  51 import java.util.Map;                                                                                    </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  52 import java.util.Set;                                                                                    </span>
<span  style="">  53                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  54 /**                                                                                                      </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  55  * @author: jingzhen@dtstack.com                                                                         </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  56  * date: 2017-6-29                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  57  */                                                                                                      </span>
<span class="-4312410715233475343" onmouseenter="enter('-4312410715233475343');" onmouseout="out('-4312410715233475343');" style="">  58 public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&gt; {                              </span>
<span  style="">  59                                                                                                          </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  60     private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                  </span>
<span  style="">  61                                                                                                          </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  62     private String host;                                                                                 </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  63     private String zkParent;                                                                             </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  64     private String rowkey;                                                                               </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  65     private String tableName;                                                                            </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  66     private String[] columnNames;                                                                        </span>
<span class="870437353868335199" onmouseenter="enter('870437353868335199');" onmouseout="out('870437353868335199');" style="">  67     private String updateMode;                                                                           </span>
<span class="3545286675323235189" onmouseenter="enter('3545286675323235189');" onmouseout="out('3545286675323235189');" style="">  68     private String[] columnTypes;                                                                        </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  69     private Map&lt;String, String&gt; columnNameFamily;                                                        </span>
<span  style="">  70                                                                                                          </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="">  71     private boolean kerberosAuthEnable;                                                                  </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="">  72     private String regionserverKeytabFile;                                                               </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="">  73     private String regionserverPrincipal;                                                                </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="">  74     private String securityKrb5Conf;                                                                     </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="">  75     private String zookeeperSaslClient;                                                                  </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="">  76     private String clientPrincipal;                                                                      </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="">  77     private String clientKeytabFile;                                                                     </span>
<span  style="">  78                                                                                                          </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  79     private String[] families;                                                                           </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  80     private String[] qualifiers;                                                                         </span>
<span  style="">  81                                                                                                          </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  82     private transient org.apache.hadoop.conf.Configuration conf;                                         </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  83     private transient Connection conn;                                                                   </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  84     private transient Table table;                                                                       </span>
<span  style="">  85                                                                                                          </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="">  86     private transient ChoreService choreService;                                                         </span>
<span  style="">  87                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  88     @Override                                                                                            </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style="">  89     public void configure(Configuration parameters) {                                                    </span>
<span class="5283504732570168532" onmouseenter="enter('5283504732570168532');" onmouseout="out('5283504732570168532');" style="">  90         LOG.warn(&quot;---configure---&quot;);                                                                     </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style="">  91         conf = HBaseConfiguration.create();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  92     }                                                                                                    </span>
<span  style="">  93                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  94     @Override                                                                                            </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style="">  95     public void open(int taskNumber, int numTasks) throws IOException {                                  </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style="">  96         LOG.warn(&quot;---open---&quot;);                                                                          </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style="">  97         openConn();                                                                                      </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style="">  98         table = conn.getTable(TableName.valueOf(tableName));                                             </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style="">  99         LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                               </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 100         initMetric();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101     }                                                                                                    </span>
<span  style=""> 102                                                                                                          </span>
<span class="-7045952989670311434" onmouseenter="enter('-7045952989670311434');" onmouseout="out('-7045952989670311434');" style=""> 103     private void openConn(){                                                                             </span>
<span class="-1891643383856272179" onmouseenter="enter('-1891643383856272179');" onmouseout="out('-1891643383856272179');" style=""> 104         try{                                                                                             </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style=""> 105             if (kerberosAuthEnable) {                                                                    </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style=""> 106                 LOG.info(&quot;open kerberos conn&quot;);                                                          </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style=""> 107                 openKerberosConn();                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 108             } else {                                                                                     </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style=""> 109                 LOG.info(&quot;open conn&quot;);                                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 110                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                             </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 111                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                   </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style=""> 112                 conn = ConnectionFactory.createConnection(conf);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113             }                                                                                            </span>
<span class="-1580407524319062305" onmouseenter="enter('-1580407524319062305');" onmouseout="out('-1580407524319062305');" style=""> 114         }catch (Exception e){                                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 115             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116         }                                                                                                </span>
<span  style=""> 117                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118     }                                                                                                    </span>
<span class="2860698523146859203" onmouseenter="enter('2860698523146859203');" onmouseout="out('2860698523146859203');" style=""> 119     private void openKerberosConn() throws IOException {                                                 </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 120         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                     </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 121         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                           </span>
<span  style=""> 122                                                                                                          </span>
<span class="4379250985718822963" onmouseenter="enter('4379250985718822963');" onmouseout="out('4379250985718822963');" style=""> 123         LOG.info(&quot;kerberos config:{}&quot;, this.toString());                                                 </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style=""> 124         Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);</span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style=""><abbr title=" 125         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);"> 125         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;ðŸ”µ</abbr></span>
<span  style=""> 126                                                                                                          </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style=""> 127         fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);      </span>
<span  style=""> 128                                                                                                          </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style=""> 129         clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;           </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style=""><abbr title=" 130         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;"> 130         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipalðŸ”µ</abbr></span>
<span  style=""> 131                                                                                                          </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style=""> 132         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                       </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style=""> 133         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                 </span>
<span  style=""> 134                                                                                                          </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style=""><abbr title=" 135         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 135         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrinciðŸ”µ</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style=""> 136         org.apache.hadoop.conf.Configuration finalConf = conf;                                           </span>
<span class="8070196252242862048" onmouseenter="enter('8070196252242862048');" onmouseout="out('8070196252242862048');" style=""> 137         conn = userGroupInformation.doAs(new PrivilegedAction&lt;Connection&gt;() {                            </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 138             @Override                                                                                    </span>
<span class="-2793922907574726120" onmouseenter="enter('-2793922907574726120');" onmouseout="out('-2793922907574726120');" style=""> 139             public Connection run() {                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 140                 try {                                                                                    </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style=""> 141                     ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                         </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style=""> 142                     if (authChore != null) {                                                             </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style=""> 143                         choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                            </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style=""> 144                         choreService.scheduleChore(authChore);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145                     }                                                                                    </span>
<span  style=""> 146                                                                                                          </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style=""> 147                     return ConnectionFactory.createConnection(finalConf);                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 148                 } catch (IOException e) {                                                                </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style=""> 149                     LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 150                     throw new RuntimeException(e);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 153         });                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154     }                                                                                                    </span>
<span  style=""> 155                                                                                                          </span>
<span  style=""> 156                                                                                                          </span>
<span  style=""> 157                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 158     @Override                                                                                            </span>
<span class="6661161668199118158" onmouseenter="enter('6661161668199118158');" onmouseout="out('6661161668199118158');" style=""> 159     public void writeRecord(Tuple2 tuple2) {                                                             </span>
<span class="-6701151034505735722" onmouseenter="enter('-6701151034505735722');" onmouseout="out('-6701151034505735722');" style=""> 160         Tuple2&lt;Boolean, Row&gt; tupleTrans = tuple2;                                                        </span>
<span class="-8114318735339252101" onmouseenter="enter('-8114318735339252101');" onmouseout="out('-8114318735339252101');" style=""> 161         Row row = tupleTrans.f1;                                                                         </span>
<span class="-4770370182470852454" onmouseenter="enter('-4770370182470852454');" onmouseout="out('-4770370182470852454');" style=""> 162         dealInsert(row);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163     }                                                                                                    </span>
<span  style=""> 164                                                                                                          </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 165     protected void dealInsert(Row record) {                                                              </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 166         Put put = getPutByRow(record);                                                                   </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 167         if (put == null || put.isEmpty()) {                                                              </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 168             outDirtyRecords.inc();                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 169             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170         }                                                                                                </span>
<span  style=""> 171                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 172         try {                                                                                            </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 173             table.put(put);                                                                              </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 174         } catch (Exception e) {                                                                          </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style=""> 175             if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {       </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style=""> 176                 LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                               </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 177                 LOG.error(&quot;&quot;, e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178             }                                                                                            </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 179             outDirtyRecords.inc();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180         }                                                                                                </span>
<span  style=""> 181                                                                                                          </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 182         if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                          </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style=""> 183             LOG.info(record.toString());                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184         }                                                                                                </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 185         outRecords.inc();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186     }                                                                                                    </span>
<span  style=""> 187                                                                                                          </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 188     private Put getPutByRow(Row record) {                                                                </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 189         String rowKey = buildRowKey(record);                                                             </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 190         if (StringUtils.isEmpty(rowKey)) {                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 191             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192         }                                                                                                </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 193         Put put = new Put(rowKey.getBytes());                                                            </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 194         for (int i = 0; i &lt; record.getArity(); ++i) {                                                    </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 195             Object fieldVal = record.getField(i);                                                        </span>
<span class="1407908144613461272" onmouseenter="enter('1407908144613461272');" onmouseout="out('1407908144613461272');" style=""> 196             if (fieldVal == null) {                                                                      </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 197                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198             }                                                                                            </span>
<span class="-3781685654159973216" onmouseenter="enter('-3781685654159973216');" onmouseout="out('-3781685654159973216');" style=""> 199             byte[] val = HbaseUtil.toByte(fieldVal);                                                     </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 200             byte[] cf = families[i].getBytes();                                                          </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 201             byte[] qualifier = qualifiers[i].getBytes();                                                 </span>
<span  style=""> 202                                                                                                          </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 203             put.addColumn(cf, qualifier, val);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204         }                                                                                                </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 205         return put;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206     }                                                                                                    </span>
<span  style=""> 207                                                                                                          </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 208     private String buildRowKey(Row record) {                                                             </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 209         String rowKeyValues = getRowKeyValues(record);                                                   </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 210         // all rowkey not null                                                                           </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 211         if (StringUtils.isBlank(rowKeyValues)) {                                                         </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 212             LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                             </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 213             outDirtyRecords.inc();                                                                       </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 214             return &quot;&quot;;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215         }                                                                                                </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 216         return rowKeyValues;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217     }                                                                                                    </span>
<span  style=""> 218                                                                                                          </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 219     private String getRowKeyValues(Row record) {                                                         </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 220         Map&lt;String, Object&gt; row = rowConvertMap(record);                                                 </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 221         RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                               </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 222         rowKeyBuilder.init(rowkey);                                                                      </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 223         return rowKeyBuilder.getRowKey(row);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224     }                                                                                                    </span>
<span  style=""> 225                                                                                                          </span>
<span class="-4244565164826320221" onmouseenter="enter('-4244565164826320221');" onmouseout="out('-4244565164826320221');" style=""> 226     private Map&lt;String, Object&gt; rowConvertMap(Row record){                                               </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 227         Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                </span>
<span class="-3126284954851894008" onmouseenter="enter('-3126284954851894008');" onmouseout="out('-3126284954851894008');" style=""> 228         for(int i = 0; i &lt; columnNames.length; i++){                                                     </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 229             rowValue.put(columnNames[i], record.getField(i));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230         }                                                                                                </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 231         return rowValue;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232     }                                                                                                    </span>
<span  style=""> 233                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 234     @Override                                                                                            </span>
<span class="3075770629113308700" onmouseenter="enter('3075770629113308700');" onmouseout="out('3075770629113308700');" style=""> 235     public void close() throws IOException {                                                             </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 236         if (conn != null) {                                                                              </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 237             conn.close();                                                                                </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 238             conn = null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240     }                                                                                                    </span>
<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style=""> 241     private HbaseOutputFormat() {                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242     }                                                                                                    </span>
<span  style=""> 243                                                                                                          </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style=""> 244     public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                    </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 245         return new HbaseOutputFormatBuilder();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246     }                                                                                                    </span>
<span  style=""> 247                                                                                                          </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 248     public static class HbaseOutputFormatBuilder {                                                       </span>
<span  style=""> 249                                                                                                          </span>
<span class="-7158416171782501647" onmouseenter="enter('-7158416171782501647');" onmouseout="out('-7158416171782501647');" style=""> 250         private HbaseOutputFormat format;                                                                </span>
<span  style=""> 251                                                                                                          </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 252         private HbaseOutputFormatBuilder() {                                                             </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 253             format = new HbaseOutputFormat();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254         }                                                                                                </span>
<span  style=""> 255                                                                                                          </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 256         public HbaseOutputFormatBuilder setHost(String host) {                                           </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 257             format.host = host;                                                                          </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 258             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259         }                                                                                                </span>
<span  style=""> 260                                                                                                          </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 261         public HbaseOutputFormatBuilder setZkParent(String parent) {                                     </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 262             format.zkParent = parent;                                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 263             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264         }                                                                                                </span>
<span  style=""> 265                                                                                                          </span>
<span  style=""> 266                                                                                                          </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 267         public HbaseOutputFormatBuilder setTable(String tableName) {                                     </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 268             format.tableName = tableName;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 269             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 270         }                                                                                                </span>
<span  style=""> 271                                                                                                          </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 272         public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                       </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 273             format.rowkey = rowkey;                                                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 274             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275         }                                                                                                </span>
<span  style=""> 276                                                                                                          </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 277         public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                           </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 278             format.columnNames = columnNames;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 279             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280         }                                                                                                </span>
<span  style=""> 281                                                                                                          </span>
<span class="-3477447409796330528" onmouseenter="enter('-3477447409796330528');" onmouseout="out('-3477447409796330528');" style=""> 282         public HbaseOutputFormatBuilder setColumnTypes(String[] columnTypes) {                           </span>
<span class="4736435751759566717" onmouseenter="enter('4736435751759566717');" onmouseout="out('4736435751759566717');" style=""> 283             format.columnTypes = columnTypes;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 284             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285         }                                                                                                </span>
<span  style=""> 286                                                                                                          </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 287         public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {      </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 288             format.columnNameFamily = columnNameFamily;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 289             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290         }                                                                                                </span>
<span  style=""> 291                                                                                                          </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style=""> 292         public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {              </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style=""> 293             format.kerberosAuthEnable = kerberosAuthEnable;                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 294             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295         }                                                                                                </span>
<span  style=""> 296                                                                                                          </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style=""> 297         public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {       </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style=""> 298             format.regionserverKeytabFile = regionserverKeytabFile;                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 299             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300         }                                                                                                </span>
<span  style=""> 301                                                                                                          </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style=""> 302         public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {         </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style=""> 303             format.regionserverPrincipal = regionserverPrincipal;                                        </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 304             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 305         }                                                                                                </span>
<span  style=""> 306                                                                                                          </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style=""> 307         public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                   </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style=""> 308             format.securityKrb5Conf = securityKrb5Conf;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 309             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 310         }                                                                                                </span>
<span  style=""> 311                                                                                                          </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style=""> 312         public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {             </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style=""> 313             format.zookeeperSaslClient = zookeeperSaslClient;                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 314             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315         }                                                                                                </span>
<span  style=""> 316                                                                                                          </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style=""> 317         public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                     </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style=""> 318             format.clientPrincipal = clientPrincipal;                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 319             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320         }                                                                                                </span>
<span  style=""> 321                                                                                                          </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style=""> 322         public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                   </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style=""> 323             format.clientKeytabFile = clientKeytabFile;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 324             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325         }                                                                                                </span>
<span  style=""> 326                                                                                                          </span>
<span  style=""> 327                                                                                                          </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 328         public HbaseOutputFormat finish() {                                                              </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 329             Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);              </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 330             Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);               </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 331             Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);           </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""><abbr title=" 332             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;);"> 332             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not beðŸ”µ</abbr></span>
<span  style=""> 333                                                                                                          </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 334             String[] families = new String[format.columnNames.length];                                   </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 335             String[] qualifiers = new String[format.columnNames.length];                                 </span>
<span  style=""> 336                                                                                                          </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 337             if (format.columnNameFamily != null) {                                                       </span>
<span class="7088458954718632362" onmouseenter="enter('7088458954718632362');" onmouseout="out('7088458954718632362');" style=""> 338                 Set&lt;String&gt; keySet = format.columnNameFamily.keySet();                                   </span>
<span class="6868380902804141682" onmouseenter="enter('6868380902804141682');" onmouseout="out('6868380902804141682');" style=""> 339                 String[] columns = keySet.toArray(new String[keySet.size()]);                            </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 340                 for (int i = 0; i &lt; columns.length; ++i) {                                               </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 341                     String col = columns[i];                                                             </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style=""> 342                     String[] part = col.split(&quot;:&quot;);                                                      </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 343                     families[i] = part[0];                                                               </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 344                     qualifiers[i] = part[1];                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 345                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 346             }                                                                                            </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 347             format.families = families;                                                                  </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 348             format.qualifiers = qualifiers;                                                              </span>
<span  style=""> 349                                                                                                          </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 350             return format;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351         }                                                                                                </span>
<span  style=""> 352                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353     }                                                                                                    </span>
<span  style=""> 354                                                                                                          </span>
<span class="-7186582701716849885" onmouseenter="enter('-7186582701716849885');" onmouseout="out('-7186582701716849885');" style=""><abbr title=" 355     private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config, String regionserverPrincipal,"> 355     private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config, String regionserverPðŸ”µ</abbr></span>
<span class="-4185911471210652243" onmouseenter="enter('-4185911471210652243');" onmouseout="out('-4185911471210652243');" style=""><abbr title=" 356                                         String zookeeperSaslClient, String securityKrb5Conf) throws IOException {"> 356                                         String zookeeperSaslClient, String securityKrb5Conf) throws IOExcðŸ”µ</abbr></span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style=""> 357         if (StringUtils.isEmpty(regionserverPrincipal)) {                                                </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style=""><abbr title=" 358             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 358             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication isðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 359         }                                                                                                </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style=""> 360         config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);         </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style=""> 361         config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);   </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style=""> 362         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                           </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style=""> 363         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                      </span>
<span  style=""> 364                                                                                                          </span>
<span  style=""> 365                                                                                                          </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style=""> 366         if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                 </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style=""> 367             System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 368         }                                                                                                </span>
<span  style=""> 369                                                                                                          </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style=""> 370         if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                    </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style=""> 371             String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;    </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style=""> 372             LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                   </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style=""> 373             System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375     }                                                                                                    </span>
<span  style=""> 376                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 377     @Override                                                                                            </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style=""> 378     public String toString() {                                                                           </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style=""> 379         return &quot;HbaseOutputFormat kerberos{&quot; +                                                           </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style=""> 380                 &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                             </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style=""> 381                 &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                           </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style=""> 382                 &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                             </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style=""> 383                 &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                       </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style=""> 384                 &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                 </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style=""> 385                 &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                         </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style=""> 386                 &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                       </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style=""> 387                 &#x27;}&#x27;;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388     }                                                                                                    </span>
<span  style=""> 389                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span  style="">  20                                                                                                          </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  21 package com.dtstack.flink.sql.sink.hbase;                                                                </span>
<span  style="">  22                                                                                                          </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  23 import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                    </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  24 import com.google.common.collect.Maps;                                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  25 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  26 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  27 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  28 import org.apache.flink.types.Row;                                                                       </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  29 import org.apache.flink.util.Preconditions;                                                              </span>
<span class="-2774002081156384359" onmouseenter="enter('-2774002081156384359');" onmouseout="out('-2774002081156384359');" style="">  30 import org.apache.hadoop.hbase.*;                                                                        </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  31 import org.apache.hadoop.hbase.client.Connection;                                                        </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  32 import org.apache.hadoop.hbase.client.ConnectionFactory;                                                 </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  33 import org.apache.hadoop.hbase.client.Put;                                                               </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  34 import org.apache.hadoop.hbase.client.Table;                                                             </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  35 import org.apache.hadoop.security.UserGroupInformation;                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  36 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  37 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  38                                                                                                          </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  39 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  40 import java.io.IOException;                                                                              </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="">  41 import java.security.PrivilegedAction;                                                                   </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  42 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  43 import java.util.Map;                                                                                    </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  44 import java.util.Set;                                                                                    </span>
<span  style="">  45                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  46 /**                                                                                                      </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  47  * @author: jingzhen@dtstack.com                                                                         </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  48  * date: 2017-6-29                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  49  */                                                                                                      </span>
<span class="-4312410715233475343" onmouseenter="enter('-4312410715233475343');" onmouseout="out('-4312410715233475343');" style="">  50 public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&gt; {                              </span>
<span  style="">  51                                                                                                          </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  52     private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                  </span>
<span  style="">  53                                                                                                          </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  54     private String host;                                                                                 </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  55     private String zkParent;                                                                             </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  56     private String rowkey;                                                                               </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  57     private String tableName;                                                                            </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  58     private String[] columnNames;                                                                        </span>
<span class="870437353868335199" onmouseenter="enter('870437353868335199');" onmouseout="out('870437353868335199');" style="">  59     private String updateMode;                                                                           </span>
<span class="3545286675323235189" onmouseenter="enter('3545286675323235189');" onmouseout="out('3545286675323235189');" style="">  60     private String[] columnTypes;                                                                        </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  61     private Map&lt;String, String&gt; columnNameFamily;                                                        </span>
<span  style="">  62                                                                                                          </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="">  63     private boolean kerberosAuthEnable;                                                                  </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="">  64     private String regionserverKeytabFile;                                                               </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="">  65     private String regionserverPrincipal;                                                                </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="">  66     private String securityKrb5Conf;                                                                     </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="">  67     private String zookeeperSaslClient;                                                                  </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="">  68     private String clientPrincipal;                                                                      </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="">  69     private String clientKeytabFile;                                                                     </span>
<span  style="">  70                                                                                                          </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  71     private String[] families;                                                                           </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  72     private String[] qualifiers;                                                                         </span>
<span  style="">  73                                                                                                          </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  74     private transient org.apache.hadoop.conf.Configuration conf;                                         </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  75     private transient Connection conn;                                                                   </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  76     private transient Table table;                                                                       </span>
<span  style="">  77                                                                                                          </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="">  78     private transient ChoreService choreService;                                                         </span>
<span  style="">  79                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  80     @Override                                                                                            </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style="">  81     public void configure(Configuration parameters) {                                                    </span>
<span class="5283504732570168532" onmouseenter="enter('5283504732570168532');" onmouseout="out('5283504732570168532');" style="">  82         LOG.warn(&quot;---configure---&quot;);                                                                     </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style="">  83         conf = HBaseConfiguration.create();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84     }                                                                                                    </span>
<span  style="">  85                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  86     @Override                                                                                            </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style="">  87     public void open(int taskNumber, int numTasks) throws IOException {                                  </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style="">  88         LOG.warn(&quot;---open---&quot;);                                                                          </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style="">  89         openConn();                                                                                      </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style="">  90         table = conn.getTable(TableName.valueOf(tableName));                                             </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style="">  91         LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                               </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style="">  92         initMetric();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93     }                                                                                                    </span>
<span  style="">  94                                                                                                          </span>
<span class="-7045952989670311434" onmouseenter="enter('-7045952989670311434');" onmouseout="out('-7045952989670311434');" style="">  95     private void openConn(){                                                                             </span>
<span class="-1891643383856272179" onmouseenter="enter('-1891643383856272179');" onmouseout="out('-1891643383856272179');" style="">  96         try{                                                                                             </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style="">  97             if (kerberosAuthEnable) {                                                                    </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style="">  98                 LOG.info(&quot;open kerberos conn&quot;);                                                          </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style="">  99                 openKerberosConn();                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 100             } else {                                                                                     </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style=""> 101                 LOG.info(&quot;open conn&quot;);                                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 102                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                             </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 103                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                   </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style=""> 104                 conn = ConnectionFactory.createConnection(conf);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105             }                                                                                            </span>
<span class="-1580407524319062305" onmouseenter="enter('-1580407524319062305');" onmouseout="out('-1580407524319062305');" style=""> 106         }catch (Exception e){                                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 107             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108         }                                                                                                </span>
<span  style=""> 109                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110     }                                                                                                    </span>
<span class="2860698523146859203" onmouseenter="enter('2860698523146859203');" onmouseout="out('2860698523146859203');" style=""> 111     private void openKerberosConn() throws IOException {                                                 </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 112         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                     </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 113         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                           </span>
<span  style=""> 114                                                                                                          </span>
<span class="4379250985718822963" onmouseenter="enter('4379250985718822963');" onmouseout="out('4379250985718822963');" style=""> 115         LOG.info(&quot;kerberos config:{}&quot;, this.toString());                                                 </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style=""> 116         Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);</span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style=""><abbr title=" 117         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);"> 117         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;ðŸ”µ</abbr></span>
<span  style=""> 118                                                                                                          </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style=""> 119         fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);      </span>
<span  style=""> 120                                                                                                          </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style=""> 121         clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;           </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style=""><abbr title=" 122         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;"> 122         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipalðŸ”µ</abbr></span>
<span  style=""> 123                                                                                                          </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style=""> 124         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                       </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style=""> 125         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                 </span>
<span  style=""> 126                                                                                                          </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style=""><abbr title=" 127         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 127         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrinciðŸ”µ</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style=""> 128         org.apache.hadoop.conf.Configuration finalConf = conf;                                           </span>
<span class="8070196252242862048" onmouseenter="enter('8070196252242862048');" onmouseout="out('8070196252242862048');" style=""> 129         conn = userGroupInformation.doAs(new PrivilegedAction&lt;Connection&gt;() {                            </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 130             @Override                                                                                    </span>
<span class="-2793922907574726120" onmouseenter="enter('-2793922907574726120');" onmouseout="out('-2793922907574726120');" style=""> 131             public Connection run() {                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 132                 try {                                                                                    </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style=""> 133                     ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                         </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style=""> 134                     if (authChore != null) {                                                             </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style=""> 135                         choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                            </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style=""> 136                         choreService.scheduleChore(authChore);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137                     }                                                                                    </span>
<span  style=""> 138                                                                                                          </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style=""> 139                     return ConnectionFactory.createConnection(finalConf);                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 140                 } catch (IOException e) {                                                                </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style=""> 141                     LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 142                     throw new RuntimeException(e);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 145         });                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146     }                                                                                                    </span>
<span  style=""> 147                                                                                                          </span>
<span  style=""> 148                                                                                                          </span>
<span  style=""> 149                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 150     @Override                                                                                            </span>
<span class="6661161668199118158" onmouseenter="enter('6661161668199118158');" onmouseout="out('6661161668199118158');" style=""> 151     public void writeRecord(Tuple2 tuple2) {                                                             </span>
<span class="-6701151034505735722" onmouseenter="enter('-6701151034505735722');" onmouseout="out('-6701151034505735722');" style=""> 152         Tuple2&lt;Boolean, Row&gt; tupleTrans = tuple2;                                                        </span>
<span class="-8114318735339252101" onmouseenter="enter('-8114318735339252101');" onmouseout="out('-8114318735339252101');" style=""> 153         Row row = tupleTrans.f1;                                                                         </span>
<span class="-4770370182470852454" onmouseenter="enter('-4770370182470852454');" onmouseout="out('-4770370182470852454');" style=""> 154             dealInsert(row);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155     }                                                                                                    </span>
<span  style=""> 156                                                                                                          </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 157     protected void dealInsert(Row record) {                                                              </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 158         Put put = getPutByRow(record);                                                                   </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 159         if (put == null || put.isEmpty()) {                                                              </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 160             outDirtyRecords.inc();                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 161             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162         }                                                                                                </span>
<span  style=""> 163                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 164             try {                                                                                        </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 165             table.put(put);                                                                              </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 166         } catch (Exception e) {                                                                          </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style=""> 167                 if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {   </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style=""> 168                     LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                           </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 169                     LOG.error(&quot;&quot;, e);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170                 }                                                                                        </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 171                 outDirtyRecords.inc();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172             }                                                                                            </span>
<span  style=""> 173                                                                                                          </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 174             if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                      </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style=""> 175                 LOG.info(record.toString());                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176             }                                                                                            </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 177             outRecords.inc();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178         }                                                                                                </span>
<span  style=""> 179                                                                                                          </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 180     private Put getPutByRow(Row record) {                                                                </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 181         String rowKey = buildRowKey(record);                                                             </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 182         if (StringUtils.isEmpty(rowKey)) {                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 183             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184         }                                                                                                </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 185         Put put = new Put(rowKey.getBytes());                                                            </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 186         for (int i = 0; i &lt; record.getArity(); ++i) {                                                    </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 187             Object fieldVal = record.getField(i);                                                        </span>
<span class="1407908144613461272" onmouseenter="enter('1407908144613461272');" onmouseout="out('1407908144613461272');" style=""> 188             if (fieldVal == null) {                                                                      </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 189                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190             }                                                                                            </span>
<span class="-3781685654159973216" onmouseenter="enter('-3781685654159973216');" onmouseout="out('-3781685654159973216');" style=""> 191             byte[] val = HbaseUtil.toByte(fieldVal);                                                     </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 192             byte[] cf = families[i].getBytes();                                                          </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 193             byte[] qualifier = qualifiers[i].getBytes();                                                 </span>
<span  style=""> 194                                                                                                          </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 195             put.addColumn(cf, qualifier, val);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196         }                                                                                                </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 197         return put;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198     }                                                                                                    </span>
<span  style=""> 199                                                                                                          </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 200     private String buildRowKey(Row record) {                                                             </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 201         String rowKeyValues = getRowKeyValues(record);                                                   </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 202         // all rowkey not null                                                                           </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 203         if (StringUtils.isBlank(rowKeyValues)) {                                                         </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 204             LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                             </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 205             outDirtyRecords.inc();                                                                       </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 206             return &quot;&quot;;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207         }                                                                                                </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 208         return rowKeyValues;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209     }                                                                                                    </span>
<span  style=""> 210                                                                                                          </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 211     private String getRowKeyValues(Row record) {                                                         </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 212         Map&lt;String, Object&gt; row = rowConvertMap(record);                                                 </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 213         RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                               </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 214         rowKeyBuilder.init(rowkey);                                                                      </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 215         return rowKeyBuilder.getRowKey(row);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216     }                                                                                                    </span>
<span  style=""> 217                                                                                                          </span>
<span class="-4244565164826320221" onmouseenter="enter('-4244565164826320221');" onmouseout="out('-4244565164826320221');" style=""> 218     private Map&lt;String, Object&gt; rowConvertMap(Row record){                                               </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 219         Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                </span>
<span class="-3126284954851894008" onmouseenter="enter('-3126284954851894008');" onmouseout="out('-3126284954851894008');" style=""> 220         for(int i = 0; i &lt; columnNames.length; i++){                                                     </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 221             rowValue.put(columnNames[i], record.getField(i));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222         }                                                                                                </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 223         return rowValue;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224     }                                                                                                    </span>
<span  style=""> 225                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 226     @Override                                                                                            </span>
<span class="3075770629113308700" onmouseenter="enter('3075770629113308700');" onmouseout="out('3075770629113308700');" style=""> 227     public void close() throws IOException {                                                             </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 228         if (conn != null) {                                                                              </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 229             conn.close();                                                                                </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 230             conn = null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232     }                                                                                                    </span>
<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style=""> 233     private HbaseOutputFormat() {                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234     }                                                                                                    </span>
<span  style=""> 235                                                                                                          </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style=""> 236     public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                    </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 237         return new HbaseOutputFormatBuilder();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238     }                                                                                                    </span>
<span  style=""> 239                                                                                                          </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 240     public static class HbaseOutputFormatBuilder {                                                       </span>
<span  style=""> 241                                                                                                          </span>
<span class="-7158416171782501647" onmouseenter="enter('-7158416171782501647');" onmouseout="out('-7158416171782501647');" style=""> 242         private HbaseOutputFormat format;                                                                </span>
<span  style=""> 243                                                                                                          </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 244         private HbaseOutputFormatBuilder() {                                                             </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 245             format = new HbaseOutputFormat();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246         }                                                                                                </span>
<span  style=""> 247                                                                                                          </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 248         public HbaseOutputFormatBuilder setHost(String host) {                                           </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 249             format.host = host;                                                                          </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 250             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251         }                                                                                                </span>
<span  style=""> 252                                                                                                          </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 253         public HbaseOutputFormatBuilder setZkParent(String parent) {                                     </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 254             format.zkParent = parent;                                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 255             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 256         }                                                                                                </span>
<span  style=""> 257                                                                                                          </span>
<span  style=""> 258                                                                                                          </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 259         public HbaseOutputFormatBuilder setTable(String tableName) {                                     </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 260             format.tableName = tableName;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 261             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262         }                                                                                                </span>
<span  style=""> 263                                                                                                          </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 264         public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                       </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 265             format.rowkey = rowkey;                                                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 266             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267         }                                                                                                </span>
<span  style=""> 268                                                                                                          </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 269         public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                           </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 270             format.columnNames = columnNames;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 271             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272         }                                                                                                </span>
<span  style=""> 273                                                                                                          </span>
<span class="-3477447409796330528" onmouseenter="enter('-3477447409796330528');" onmouseout="out('-3477447409796330528');" style=""> 274         public HbaseOutputFormatBuilder setColumnTypes(String[] columnTypes) {                           </span>
<span class="4736435751759566717" onmouseenter="enter('4736435751759566717');" onmouseout="out('4736435751759566717');" style=""> 275             format.columnTypes = columnTypes;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 276             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277         }                                                                                                </span>
<span  style=""> 278                                                                                                          </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 279         public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {      </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 280             format.columnNameFamily = columnNameFamily;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 281             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282         }                                                                                                </span>
<span  style=""> 283                                                                                                          </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style=""> 284         public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {              </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style=""> 285             format.kerberosAuthEnable = kerberosAuthEnable;                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 286             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287         }                                                                                                </span>
<span  style=""> 288                                                                                                          </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style=""> 289         public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {       </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style=""> 290             format.regionserverKeytabFile = regionserverKeytabFile;                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 291             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292         }                                                                                                </span>
<span  style=""> 293                                                                                                          </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style=""> 294         public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {         </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style=""> 295             format.regionserverPrincipal = regionserverPrincipal;                                        </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 296             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297         }                                                                                                </span>
<span  style=""> 298                                                                                                          </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style=""> 299         public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                   </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style=""> 300             format.securityKrb5Conf = securityKrb5Conf;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 301             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302         }                                                                                                </span>
<span  style=""> 303                                                                                                          </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style=""> 304         public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {             </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style=""> 305             format.zookeeperSaslClient = zookeeperSaslClient;                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 306             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307         }                                                                                                </span>
<span  style=""> 308                                                                                                          </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style=""> 309         public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                     </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style=""> 310             format.clientPrincipal = clientPrincipal;                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 311             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312         }                                                                                                </span>
<span  style=""> 313                                                                                                          </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style=""> 314         public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                   </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style=""> 315             format.clientKeytabFile = clientKeytabFile;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 316             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317         }                                                                                                </span>
<span  style=""> 318                                                                                                          </span>
<span  style=""> 319                                                                                                          </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 320         public HbaseOutputFormat finish() {                                                              </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 321             Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);              </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 322             Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);               </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 323             Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);           </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""><abbr title=" 324             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;);"> 324             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not beðŸ”µ</abbr></span>
<span  style=""> 325                                                                                                          </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 326             String[] families = new String[format.columnNames.length];                                   </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 327             String[] qualifiers = new String[format.columnNames.length];                                 </span>
<span  style=""> 328                                                                                                          </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 329             if (format.columnNameFamily != null) {                                                       </span>
<span class="7088458954718632362" onmouseenter="enter('7088458954718632362');" onmouseout="out('7088458954718632362');" style=""> 330                 Set&lt;String&gt; keySet = format.columnNameFamily.keySet();                                   </span>
<span class="6868380902804141682" onmouseenter="enter('6868380902804141682');" onmouseout="out('6868380902804141682');" style=""> 331                 String[] columns = keySet.toArray(new String[keySet.size()]);                            </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 332                 for (int i = 0; i &lt; columns.length; ++i) {                                               </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 333                     String col = columns[i];                                                             </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style=""> 334                     String[] part = col.split(&quot;:&quot;);                                                      </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 335                     families[i] = part[0];                                                               </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 336                     qualifiers[i] = part[1];                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338             }                                                                                            </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 339             format.families = families;                                                                  </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 340             format.qualifiers = qualifiers;                                                              </span>
<span  style=""> 341                                                                                                          </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 342             return format;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 343         }                                                                                                </span>
<span  style=""> 344                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 345     }                                                                                                    </span>
<span  style=""> 346                                                                                                          </span>
<span class="-7186582701716849885" onmouseenter="enter('-7186582701716849885');" onmouseout="out('-7186582701716849885');" style=""><abbr title=" 347     private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config, String regionserverPrincipal,"> 347     private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config, String regionserverPðŸ”µ</abbr></span>
<span class="-4185911471210652243" onmouseenter="enter('-4185911471210652243');" onmouseout="out('-4185911471210652243');" style=""><abbr title=" 348                                         String zookeeperSaslClient, String securityKrb5Conf) throws IOException {"> 348                                         String zookeeperSaslClient, String securityKrb5Conf) throws IOExcðŸ”µ</abbr></span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style=""> 349         if (StringUtils.isEmpty(regionserverPrincipal)) {                                                </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style=""><abbr title=" 350             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 350             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication isðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351         }                                                                                                </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style=""> 352         config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);         </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style=""> 353         config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);   </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style=""> 354         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                           </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style=""> 355         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                      </span>
<span  style=""> 356                                                                                                          </span>
<span  style=""> 357                                                                                                          </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style=""> 358         if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                 </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style=""> 359             System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 360         }                                                                                                </span>
<span  style=""> 361                                                                                                          </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style=""> 362         if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                    </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style=""> 363             String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;    </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style=""> 364             LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                   </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style=""> 365             System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367     }                                                                                                    </span>
<span  style=""> 368                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 369     @Override                                                                                            </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style=""> 370     public String toString() {                                                                           </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style=""> 371         return &quot;HbaseOutputFormat kerberos{&quot; +                                                           </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style=""> 372                 &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                             </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style=""> 373                 &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                           </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style=""> 374                 &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                             </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style=""> 375                 &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                       </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style=""> 376                 &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                 </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style=""> 377                 &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                         </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style=""> 378                 &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                       </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style=""> 379                 &#x27;}&#x27;;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 380     }                                                                                                    </span>
<span  style=""> 381                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 382 }                                                                                                        </span>






</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  18 package com.dtstack.flink.sql.sink.hbase;                                                                </span>
<span  style="">  19                                                                                                          </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  20 import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                    </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  21 import com.google.common.collect.Maps;                                                                   </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  22 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  23 import java.io.IOException;                                                                              </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="">  24 import java.security.PrivilegedAction;                                                                   </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  25 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  26 import java.util.Map;                                                                                    </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  27 import java.util.Set;                                                                                    </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  28 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  29 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  30 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  31 import org.apache.flink.types.Row;                                                                       </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  32 import org.apache.flink.util.Preconditions;                                                              </span>
<span class="-2774002081156384359" onmouseenter="enter('-2774002081156384359');" onmouseout="out('-2774002081156384359');" style="">  33 import org.apache.hadoop.hbase.*;                                                                        </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  34 import org.apache.hadoop.hbase.client.Connection;                                                        </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  35 import org.apache.hadoop.hbase.client.ConnectionFactory;                                                 </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  36 import org.apache.hadoop.hbase.client.Put;                                                               </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  37 import org.apache.hadoop.hbase.client.Table;                                                             </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  38 import org.apache.hadoop.security.UserGroupInformation;                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  39 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  40 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  41                                                                                                          </span>
<span  style="">  42                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  43 /**                                                                                                      </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  44  * @author: jingzhen@dtstack.com                                                                         </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  45  * date: 2017-6-29                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  46  */                                                                                                      </span>
<span class="-4312410715233475343" onmouseenter="enter('-4312410715233475343');" onmouseout="out('-4312410715233475343');" style="">  47 public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&gt; {                              </span>
<span  style="">  48                                                                                                          </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  49     private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                  </span>
<span  style="">  50                                                                                                          </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  51     private String host;                                                                                 </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  52     private String zkParent;                                                                             </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  53     private String rowkey;                                                                               </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  54     private String tableName;                                                                            </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  55     private String[] columnNames;                                                                        </span>
<span class="870437353868335199" onmouseenter="enter('870437353868335199');" onmouseout="out('870437353868335199');" style="">  56     private String updateMode;                                                                           </span>
<span class="3545286675323235189" onmouseenter="enter('3545286675323235189');" onmouseout="out('3545286675323235189');" style="">  57     private String[] columnTypes;                                                                        </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  58     private Map&lt;String, String&gt; columnNameFamily;                                                        </span>
<span  style="">  59                                                                                                          </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="">  60     private boolean kerberosAuthEnable;                                                                  </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="">  61     private String regionserverKeytabFile;                                                               </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="">  62     private String regionserverPrincipal;                                                                </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="">  63     private String securityKrb5Conf;                                                                     </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="">  64     private String zookeeperSaslClient;                                                                  </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="">  65     private String clientPrincipal;                                                                      </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="">  66     private String clientKeytabFile;                                                                     </span>
<span  style="">  67                                                                                                          </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  68     private String[] families;                                                                           </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  69     private String[] qualifiers;                                                                         </span>
<span  style="">  70                                                                                                          </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  71     private transient org.apache.hadoop.conf.Configuration conf;                                         </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  72     private transient Connection conn;                                                                   </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  73     private transient Table table;                                                                       </span>
<span  style="">  74                                                                                                          </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="">  75     private transient ChoreService choreService;                                                         </span>
<span  style="">  76                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  77     @Override                                                                                            </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style="">  78     public void configure(Configuration parameters) {                                                    </span>
<span class="5283504732570168532" onmouseenter="enter('5283504732570168532');" onmouseout="out('5283504732570168532');" style="">  79         LOG.warn(&quot;---configure---&quot;);                                                                     </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style="">  80         conf = HBaseConfiguration.create();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  81     }                                                                                                    </span>
<span  style="">  82                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  83     @Override                                                                                            </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style="">  84     public void open(int taskNumber, int numTasks) throws IOException {                                  </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style="">  85         LOG.warn(&quot;---open---&quot;);                                                                          </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style="">  86         openConn();                                                                                      </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style="">  87         table = conn.getTable(TableName.valueOf(tableName));                                             </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style="">  88         LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                               </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style="">  89         initMetric();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90     }                                                                                                    </span>
<span  style="">  91                                                                                                          </span>
<span class="-7045952989670311434" onmouseenter="enter('-7045952989670311434');" onmouseout="out('-7045952989670311434');" style="">  92     private void openConn(){                                                                             </span>
<span class="-1891643383856272179" onmouseenter="enter('-1891643383856272179');" onmouseout="out('-1891643383856272179');" style="">  93         try{                                                                                             </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style="">  94             if (kerberosAuthEnable) {                                                                    </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style="">  95                 LOG.info(&quot;open kerberos conn&quot;);                                                          </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style="">  96                 openKerberosConn();                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  97             } else {                                                                                     </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style="">  98                 LOG.info(&quot;open conn&quot;);                                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style="">  99                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                             </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 100                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                   </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style=""> 101                 conn = ConnectionFactory.createConnection(conf);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102             }                                                                                            </span>
<span class="-1580407524319062305" onmouseenter="enter('-1580407524319062305');" onmouseout="out('-1580407524319062305');" style=""> 103         }catch (Exception e){                                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 104             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105         }                                                                                                </span>
<span  style=""> 106                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107     }                                                                                                    </span>
<span class="2860698523146859203" onmouseenter="enter('2860698523146859203');" onmouseout="out('2860698523146859203');" style=""> 108     private void openKerberosConn() throws IOException {                                                 </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 109         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                     </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 110         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                           </span>
<span  style=""> 111                                                                                                          </span>
<span class="4379250985718822963" onmouseenter="enter('4379250985718822963');" onmouseout="out('4379250985718822963');" style=""> 112         LOG.info(&quot;kerberos config:{}&quot;, this.toString());                                                 </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style=""> 113         Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);</span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style=""><abbr title=" 114         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);"> 114         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;ðŸ”µ</abbr></span>
<span  style=""> 115                                                                                                          </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style=""> 116         fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);      </span>
<span  style=""> 117                                                                                                          </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style=""> 118         clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;           </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style=""><abbr title=" 119         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;"> 119         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipalðŸ”µ</abbr></span>
<span  style=""> 120                                                                                                          </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style=""> 121         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                       </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style=""> 122         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                 </span>
<span  style=""> 123                                                                                                          </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style=""><abbr title=" 124         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 124         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrinciðŸ”µ</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style=""> 125         org.apache.hadoop.conf.Configuration finalConf = conf;                                           </span>
<span class="8070196252242862048" onmouseenter="enter('8070196252242862048');" onmouseout="out('8070196252242862048');" style=""> 126         conn = userGroupInformation.doAs(new PrivilegedAction&lt;Connection&gt;() {                            </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 127             @Override                                                                                    </span>
<span class="-2793922907574726120" onmouseenter="enter('-2793922907574726120');" onmouseout="out('-2793922907574726120');" style=""> 128             public Connection run() {                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 129                 try {                                                                                    </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style=""> 130                     ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                         </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style=""> 131                     if (authChore != null) {                                                             </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style=""> 132                         choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                            </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style=""> 133                         choreService.scheduleChore(authChore);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134                     }                                                                                    </span>
<span  style=""> 135                                                                                                          </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style=""> 136                     return ConnectionFactory.createConnection(finalConf);                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 137                 } catch (IOException e) {                                                                </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style=""> 138                     LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 139                     throw new RuntimeException(e);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 142         });                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143     }                                                                                                    </span>
<span  style=""> 144                                                                                                          </span>
<span  style=""> 145                                                                                                          </span>
<span  style=""> 146                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 147     @Override                                                                                            </span>
<span class="6661161668199118158" onmouseenter="enter('6661161668199118158');" onmouseout="out('6661161668199118158');" style=""> 148     public void writeRecord(Tuple2 tuple2) {                                                             </span>
<span class="-6701151034505735722" onmouseenter="enter('-6701151034505735722');" onmouseout="out('-6701151034505735722');" style=""> 149         Tuple2&lt;Boolean, Row&gt; tupleTrans = tuple2;                                                        </span>
<span class="-8114318735339252101" onmouseenter="enter('-8114318735339252101');" onmouseout="out('-8114318735339252101');" style=""> 150         Row row = tupleTrans.f1;                                                                         </span>
<span class="-4770370182470852454" onmouseenter="enter('-4770370182470852454');" onmouseout="out('-4770370182470852454');" style=""> 151         dealInsert(row);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152     }                                                                                                    </span>
<span  style=""> 153                                                                                                          </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 154     protected void dealInsert(Row record) {                                                              </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 155         Put put = getPutByRow(record);                                                                   </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 156         if (put == null || put.isEmpty()) {                                                              </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 157             outDirtyRecords.inc();                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 158             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159         }                                                                                                </span>
<span  style=""> 160                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 161         try {                                                                                            </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 162             table.put(put);                                                                              </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 163         } catch (Exception e) {                                                                          </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style=""> 164             if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {       </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style=""> 165                 LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                               </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 166                 LOG.error(&quot;&quot;, e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167             }                                                                                            </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 168             outDirtyRecords.inc();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169         }                                                                                                </span>
<span  style=""> 170                                                                                                          </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 171         if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                          </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style=""> 172             LOG.info(record.toString());                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173         }                                                                                                </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 174         outRecords.inc();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175     }                                                                                                    </span>
<span  style=""> 176                                                                                                          </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 177     private Put getPutByRow(Row record) {                                                                </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 178         String rowKey = buildRowKey(record);                                                             </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 179         if (StringUtils.isEmpty(rowKey)) {                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 180             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181         }                                                                                                </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 182         Put put = new Put(rowKey.getBytes());                                                            </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 183         for (int i = 0; i &lt; record.getArity(); ++i) {                                                    </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 184             Object fieldVal = record.getField(i);                                                        </span>
<span class="1407908144613461272" onmouseenter="enter('1407908144613461272');" onmouseout="out('1407908144613461272');" style=""> 185             if (fieldVal == null) {                                                                      </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 186                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187             }                                                                                            </span>
<span class="-3781685654159973216" onmouseenter="enter('-3781685654159973216');" onmouseout="out('-3781685654159973216');" style=""> 188             byte[] val = HbaseUtil.toByte(fieldVal);                                                     </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 189             byte[] cf = families[i].getBytes();                                                          </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 190             byte[] qualifier = qualifiers[i].getBytes();                                                 </span>
<span  style=""> 191                                                                                                          </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 192             put.addColumn(cf, qualifier, val);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193         }                                                                                                </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 194         return put;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195     }                                                                                                    </span>
<span  style=""> 196                                                                                                          </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 197     private String buildRowKey(Row record) {                                                             </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 198         String rowKeyValues = getRowKeyValues(record);                                                   </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 199         // all rowkey not null                                                                           </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 200         if (StringUtils.isBlank(rowKeyValues)) {                                                         </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 201             LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                             </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 202             outDirtyRecords.inc();                                                                       </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 203             return &quot;&quot;;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204         }                                                                                                </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 205         return rowKeyValues;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206     }                                                                                                    </span>
<span  style=""> 207                                                                                                          </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 208     private String getRowKeyValues(Row record) {                                                         </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 209         Map&lt;String, Object&gt; row = rowConvertMap(record);                                                 </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 210         RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                               </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 211         rowKeyBuilder.init(rowkey);                                                                      </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 212         return rowKeyBuilder.getRowKey(row);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213     }                                                                                                    </span>
<span  style=""> 214                                                                                                          </span>
<span class="-4244565164826320221" onmouseenter="enter('-4244565164826320221');" onmouseout="out('-4244565164826320221');" style=""> 215     private Map&lt;String, Object&gt; rowConvertMap(Row record){                                               </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 216         Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                </span>
<span class="-3126284954851894008" onmouseenter="enter('-3126284954851894008');" onmouseout="out('-3126284954851894008');" style=""> 217         for(int i = 0; i &lt; columnNames.length; i++){                                                     </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 218             rowValue.put(columnNames[i], record.getField(i));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219         }                                                                                                </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 220         return rowValue;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221     }                                                                                                    </span>
<span  style=""> 222                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 223     @Override                                                                                            </span>
<span class="3075770629113308700" onmouseenter="enter('3075770629113308700');" onmouseout="out('3075770629113308700');" style=""> 224     public void close() throws IOException {                                                             </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 225         if (conn != null) {                                                                              </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 226             conn.close();                                                                                </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 227             conn = null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229     }                                                                                                    </span>
<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style=""> 230     private HbaseOutputFormat() {                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231     }                                                                                                    </span>
<span  style=""> 232                                                                                                          </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style=""> 233     public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                    </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 234         return new HbaseOutputFormatBuilder();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235     }                                                                                                    </span>
<span  style=""> 236                                                                                                          </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 237     public static class HbaseOutputFormatBuilder {                                                       </span>
<span  style=""> 238                                                                                                          </span>
<span class="-7158416171782501647" onmouseenter="enter('-7158416171782501647');" onmouseout="out('-7158416171782501647');" style=""> 239         private HbaseOutputFormat format;                                                                </span>
<span  style=""> 240                                                                                                          </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 241         private HbaseOutputFormatBuilder() {                                                             </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 242             format = new HbaseOutputFormat();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243         }                                                                                                </span>
<span  style=""> 244                                                                                                          </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 245         public HbaseOutputFormatBuilder setHost(String host) {                                           </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 246             format.host = host;                                                                          </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 247             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248         }                                                                                                </span>
<span  style=""> 249                                                                                                          </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 250         public HbaseOutputFormatBuilder setZkParent(String parent) {                                     </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 251             format.zkParent = parent;                                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 252             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253         }                                                                                                </span>
<span  style=""> 254                                                                                                          </span>
<span  style=""> 255                                                                                                          </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 256         public HbaseOutputFormatBuilder setTable(String tableName) {                                     </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 257             format.tableName = tableName;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 258             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259         }                                                                                                </span>
<span  style=""> 260                                                                                                          </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 261         public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                       </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 262             format.rowkey = rowkey;                                                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 263             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264         }                                                                                                </span>
<span  style=""> 265                                                                                                          </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 266         public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                           </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 267             format.columnNames = columnNames;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 268             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269         }                                                                                                </span>
<span  style=""> 270                                                                                                          </span>
<span class="-3477447409796330528" onmouseenter="enter('-3477447409796330528');" onmouseout="out('-3477447409796330528');" style=""> 271         public HbaseOutputFormatBuilder setColumnTypes(String[] columnTypes) {                           </span>
<span class="4736435751759566717" onmouseenter="enter('4736435751759566717');" onmouseout="out('4736435751759566717');" style=""> 272             format.columnTypes = columnTypes;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 273             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274         }                                                                                                </span>
<span  style=""> 275                                                                                                          </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 276         public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {      </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 277             format.columnNameFamily = columnNameFamily;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 278             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279         }                                                                                                </span>
<span  style=""> 280                                                                                                          </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style=""> 281         public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {              </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style=""> 282             format.kerberosAuthEnable = kerberosAuthEnable;                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 283             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284         }                                                                                                </span>
<span  style=""> 285                                                                                                          </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style=""> 286         public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {       </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style=""> 287             format.regionserverKeytabFile = regionserverKeytabFile;                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 288             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289         }                                                                                                </span>
<span  style=""> 290                                                                                                          </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style=""> 291         public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {         </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style=""> 292             format.regionserverPrincipal = regionserverPrincipal;                                        </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 293             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294         }                                                                                                </span>
<span  style=""> 295                                                                                                          </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style=""> 296         public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                   </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style=""> 297             format.securityKrb5Conf = securityKrb5Conf;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 298             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299         }                                                                                                </span>
<span  style=""> 300                                                                                                          </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style=""> 301         public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {             </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style=""> 302             format.zookeeperSaslClient = zookeeperSaslClient;                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 303             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304         }                                                                                                </span>
<span  style=""> 305                                                                                                          </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style=""> 306         public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                     </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style=""> 307             format.clientPrincipal = clientPrincipal;                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 308             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309         }                                                                                                </span>
<span  style=""> 310                                                                                                          </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style=""> 311         public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                   </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style=""> 312             format.clientKeytabFile = clientKeytabFile;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 313             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 314         }                                                                                                </span>
<span  style=""> 315                                                                                                          </span>
<span  style=""> 316                                                                                                          </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 317         public HbaseOutputFormat finish() {                                                              </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 318             Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);              </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 319             Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);               </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 320             Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);           </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""><abbr title=" 321             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;);"> 321             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not beðŸ”µ</abbr></span>
<span  style=""> 322                                                                                                          </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 323             String[] families = new String[format.columnNames.length];                                   </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 324             String[] qualifiers = new String[format.columnNames.length];                                 </span>
<span  style=""> 325                                                                                                          </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 326             if (format.columnNameFamily != null) {                                                       </span>
<span class="7088458954718632362" onmouseenter="enter('7088458954718632362');" onmouseout="out('7088458954718632362');" style=""> 327                 Set&lt;String&gt; keySet = format.columnNameFamily.keySet();                                   </span>
<span class="6868380902804141682" onmouseenter="enter('6868380902804141682');" onmouseout="out('6868380902804141682');" style=""> 328                 String[] columns = keySet.toArray(new String[keySet.size()]);                            </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 329                 for (int i = 0; i &lt; columns.length; ++i) {                                               </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 330                     String col = columns[i];                                                             </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style=""> 331                     String[] part = col.split(&quot;:&quot;);                                                      </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 332                     families[i] = part[0];                                                               </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 333                     qualifiers[i] = part[1];                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335             }                                                                                            </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 336             format.families = families;                                                                  </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 337             format.qualifiers = qualifiers;                                                              </span>
<span  style=""> 338                                                                                                          </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 339             return format;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340         }                                                                                                </span>
<span  style=""> 341                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342     }                                                                                                    </span>
<span  style=""> 343                                                                                                          </span>
<span class="-7186582701716849885" onmouseenter="enter('-7186582701716849885');" onmouseout="out('-7186582701716849885');" style=""><abbr title=" 344     private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config, String regionserverPrincipal,"> 344     private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config, String regionserverPðŸ”µ</abbr></span>
<span class="-4185911471210652243" onmouseenter="enter('-4185911471210652243');" onmouseout="out('-4185911471210652243');" style=""><abbr title=" 345                                         String zookeeperSaslClient, String securityKrb5Conf) throws IOException {"> 345                                         String zookeeperSaslClient, String securityKrb5Conf) throws IOExcðŸ”µ</abbr></span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style=""> 346         if (StringUtils.isEmpty(regionserverPrincipal)) {                                                </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style=""><abbr title=" 347             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 347             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication isðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 348         }                                                                                                </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style=""> 349         config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);         </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style=""> 350         config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);   </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style=""> 351         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                           </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style=""> 352         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                      </span>
<span  style=""> 353                                                                                                          </span>
<span  style=""> 354                                                                                                          </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style=""> 355         if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                 </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style=""> 356             System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357         }                                                                                                </span>
<span  style=""> 358                                                                                                          </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style=""> 359         if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                    </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style=""> 360             String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;    </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style=""> 361             LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                   </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style=""> 362             System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364     }                                                                                                    </span>
<span  style=""> 365                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 366     @Override                                                                                            </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style=""> 367     public String toString() {                                                                           </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style=""> 368         return &quot;HbaseOutputFormat kerberos{&quot; +                                                           </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style=""> 369                 &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                             </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style=""> 370                 &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                           </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style=""> 371                 &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                             </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style=""> 372                 &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                       </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style=""> 373                 &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                 </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style=""> 374                 &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                         </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style=""> 375                 &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                       </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style=""> 376                 &#x27;}&#x27;;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 377     }                                                                                                    </span>
<span  style=""> 378                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379 }                                                                                                        </span>









</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span  style="">  20                                                                                                                    </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  21  package com.dtstack.flink.sql.sink.hbase;                                                                         </span>
<span  style="">  22                                                                                                                    </span>
<span class="-4800595592392942650" onmouseenter="enter('-4800595592392942650');" onmouseout="out('-4800595592392942650');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  23 -import com.dtstack.flink.sql.enums.EUpdateMode;                                                                   </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  24  import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                             </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  25  import com.google.common.collect.Maps;                                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  26  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  27  import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  28  import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  29  import org.apache.flink.types.Row;                                                                                </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  30  import org.apache.flink.util.Preconditions;                                                                       </span>
<span class="-2192907090032735453" onmouseenter="enter('-2192907090032735453');" onmouseout="out('-2192907090032735453');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  31 -import org.apache.hadoop.hbase.HBaseConfiguration;                                                                </span>
<span class="-1233342480689635281" onmouseenter="enter('-1233342480689635281');" onmouseout="out('-1233342480689635281');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  32 -import org.apache.hadoop.hbase.TableName;                                                                         </span>
<span class="-2774002081156384359" onmouseenter="enter('-2774002081156384359');" onmouseout="out('-2774002081156384359');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  33 +import org.apache.hadoop.hbase.*;                                                                                 </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  34  import org.apache.hadoop.hbase.client.Connection;                                                                 </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  35  import org.apache.hadoop.hbase.client.ConnectionFactory;                                                          </span>
<span class="162156476597244429" onmouseenter="enter('162156476597244429');" onmouseout="out('162156476597244429');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  36 -import org.apache.hadoop.hbase.client.Delete;                                                                     </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  37  import org.apache.hadoop.hbase.client.Put;                                                                        </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  38  import org.apache.hadoop.hbase.client.Table;                                                                      </span>
<span class="1523191633494881954" onmouseenter="enter('1523191633494881954');" onmouseout="out('1523191633494881954');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  39 -import org.apache.hadoop.hbase.util.Bytes;                                                                        </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  40 +import org.apache.hadoop.security.UserGroupInformation;                                                           </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  41  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  42  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  43                                                                                                                    </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  44 +import java.io.File;                                                                                              </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  45  import java.io.IOException;                                                                                       </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  46 +import java.security.PrivilegedAction;                                                                            </span>

<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  47  import java.util.Map;                                                                                             </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  48  import java.util.Set;                                                                                             </span>
<span  style="">  49                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50  /**                                                                                                               </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  51   * @author: jingzhen@dtstack.com                                                                                  </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  52   * date: 2017-6-29                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  53   */                                                                                                               </span>
<span class="-4312410715233475343" onmouseenter="enter('-4312410715233475343');" onmouseout="out('-4312410715233475343');" style="">  54  public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&gt; {                                       </span>
<span  style="">  55                                                                                                                    </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  56      private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                           </span>
<span  style="">  57                                                                                                                    </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  58      private String host;                                                                                          </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  59      private String zkParent;                                                                                      </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  60      private String rowkey;                                                                                        </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  61      private String tableName;                                                                                     </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  62      private String[] columnNames;                                                                                 </span>
<span class="870437353868335199" onmouseenter="enter('870437353868335199');" onmouseout="out('870437353868335199');" style="">  63      private String updateMode;                                                                                    </span>
<span class="3545286675323235189" onmouseenter="enter('3545286675323235189');" onmouseout="out('3545286675323235189');" style="">  64      private String[] columnTypes;                                                                                 </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  65      private Map&lt;String, String&gt; columnNameFamily;                                                                 </span>
<span  style="">  66                                                                                                                    </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  67 +    private boolean kerberosAuthEnable;                                                                           </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  68 +    private String regionserverKeytabFile;                                                                        </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  69 +    private String regionserverPrincipal;                                                                         </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  70 +    private String securityKrb5Conf;                                                                              </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  71 +    private String zookeeperSaslClient;                                                                           </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  72 +    private String clientPrincipal;                                                                               </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  73 +    private String clientKeytabFile;                                                                              </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  74 +                                                                                                                  </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  75      private String[] families;                                                                                    </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  76      private String[] qualifiers;                                                                                  </span>
<span  style="">  77                                                                                                                    </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  78      private transient org.apache.hadoop.conf.Configuration conf;                                                  </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  79      private transient Connection conn;                                                                            </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  80      private transient Table table;                                                                                </span>


<span  style="">  81                                                                                                                    </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  82 +    private transient ChoreService choreService;                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  83 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  84      @Override                                                                                                     </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style="">  85      public void configure(Configuration parameters) {                                                             </span>
<span class="5283504732570168532" onmouseenter="enter('5283504732570168532');" onmouseout="out('5283504732570168532');" style="">  86          LOG.warn(&quot;---configure---&quot;);                                                                              </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style="">  87          conf = HBaseConfiguration.create();                                                                       </span>
<span class="-2926407176515564631" onmouseenter="enter('-2926407176515564631');" onmouseout="out('-2926407176515564631');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  88 -        conf.set(&quot;hbase.zookeeper.quorum&quot;, host);                                                                 </span>
<span class="-6824596350393883643" onmouseenter="enter('-6824596350393883643');" onmouseout="out('-6824596350393883643');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  89 -        if (zkParent != null &amp;&amp; !&quot;&quot;.equals(zkParent)) {                                                           </span>
<span class="9200595598744218935" onmouseenter="enter('9200595598744218935');" onmouseout="out('9200595598744218935');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  90 -            conf.set(&quot;zookeeper.znode.parent&quot;, zkParent);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  91 -        }                                                                                                         </span>
<span class="527987699266735087" onmouseenter="enter('527987699266735087');" onmouseout="out('527987699266735087');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  92 -        LOG.warn(&quot;---configure end ---&quot;);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93      }                                                                                                             </span>
<span  style="">  94                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  95      @Override                                                                                                     </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style="">  96      public void open(int taskNumber, int numTasks) throws IOException {                                           </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style="">  97          LOG.warn(&quot;---open---&quot;);                                                                                   </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  98 -        conn = ConnectionFactory.createConnection(conf);                                                          </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +        openConn();                                                                                               </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style=""> 100          table = conn.getTable(TableName.valueOf(tableName));                                                      </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style=""> 101          LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                                        </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 102          initMetric();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103      }                                                                                                             </span>























































<span  style=""> 104                                                                                                                    </span>
<span class="-7045952989670311434" onmouseenter="enter('-7045952989670311434');" onmouseout="out('-7045952989670311434');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +    private void openConn(){                                                                                      </span>
<span class="-1891643383856272179" onmouseenter="enter('-1891643383856272179');" onmouseout="out('-1891643383856272179');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +        try{                                                                                                      </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 107 +            if (kerberosAuthEnable) {                                                                             </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 108 +                LOG.info(&quot;open kerberos conn&quot;);                                                                   </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 109 +                openKerberosConn();                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 110 +            } else {                                                                                              </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 111 +                LOG.info(&quot;open conn&quot;);                                                                            </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 112 +                conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                      </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 113 +                conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                            </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 114 +                conn = ConnectionFactory.createConnection(conf);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 115 +            }                                                                                                     </span>
<span class="-1580407524319062305" onmouseenter="enter('-1580407524319062305');" onmouseout="out('-1580407524319062305');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 116 +        }catch (Exception e){                                                                                     </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 117 +            throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 118 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +                                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +    }                                                                                                             </span>
<span class="2860698523146859203" onmouseenter="enter('2860698523146859203');" onmouseout="out('2860698523146859203');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 121 +    private void openKerberosConn() throws IOException {                                                          </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +        conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                              </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +        conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                                    </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +                                                                                                                  </span>
<span class="4379250985718822963" onmouseenter="enter('4379250985718822963');" onmouseout="out('4379250985718822963');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +        LOG.info(&quot;kerberos config:{}&quot;, this.toString());                                                          </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +        Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);         </span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +        Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);       </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +                                                                                                                  </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 129 +        fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 130 +                                                                                                                  </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 131 +        clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;                    </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 132 +        clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 133 +                                                                                                                  </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 134 +        conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                                </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 135 +        conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 136 +                                                                                                                  </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 137 +        UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 137 +        UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clieðŸ”µ</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 138 +        org.apache.hadoop.conf.Configuration finalConf = conf;                                                    </span>
<span class="8070196252242862048" onmouseenter="enter('8070196252242862048');" onmouseout="out('8070196252242862048');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 139 +        conn = userGroupInformation.doAs(new PrivilegedAction&lt;Connection&gt;() {                                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 140 +            @Override                                                                                             </span>
<span class="-2793922907574726120" onmouseenter="enter('-2793922907574726120');" onmouseout="out('-2793922907574726120');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 141 +            public Connection run() {                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +                try {                                                                                             </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +                    ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                                  </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 144 +                    if (authChore != null) {                                                                      </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +                        choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                                     </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 146 +                        choreService.scheduleChore(authChore);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 147 +                    }                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +                                                                                                                  </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 149 +                    return ConnectionFactory.createConnection(finalConf);                                         </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +                } catch (IOException e) {                                                                         </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +                    LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                                   </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +                    throw new RuntimeException(e);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 153 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 154 +            }                                                                                                     </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +        });                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 156 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 157 +                                                                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 158 +                                                                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 159 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 160      @Override                                                                                                     </span>
<span class="6661161668199118158" onmouseenter="enter('6661161668199118158');" onmouseout="out('6661161668199118158');" style=""> 161      public void writeRecord(Tuple2 tuple2) {                                                                      </span>
<span class="-6701151034505735722" onmouseenter="enter('-6701151034505735722');" onmouseout="out('-6701151034505735722');" style=""> 162          Tuple2&lt;Boolean, Row&gt; tupleTrans = tuple2;                                                                 </span>
<span class="-6798598886787048492" onmouseenter="enter('-6798598886787048492');" onmouseout="out('-6798598886787048492');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 163 -        Boolean retract = tupleTrans.f0;                                                                          </span>
<span class="-8114318735339252101" onmouseenter="enter('-8114318735339252101');" onmouseout="out('-8114318735339252101');" style=""> 164          Row row = tupleTrans.f1;                                                                                  </span>
<span class="-4738216633021392189" onmouseenter="enter('-4738216633021392189');" onmouseout="out('-4738216633021392189');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 165 -        if (retract) {                                                                                            </span>
<span class="-4770370182470852454" onmouseenter="enter('-4770370182470852454');" onmouseout="out('-4770370182470852454');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 166 -            dealInsert(row);                                                                                      </span>
<span class="-6425603269843385069" onmouseenter="enter('-6425603269843385069');" onmouseout="out('-6425603269843385069');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 167 -        } else if (!retract &amp;&amp; StringUtils.equalsIgnoreCase(updateMode, EUpdateMode.UPSERT.name())) {             </span>
<span class="-2497428920962601187" onmouseenter="enter('-2497428920962601187');" onmouseout="out('-2497428920962601187');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 168 -            dealDelete(row);                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 169 -        }                                                                                                         </span>
<span class="-4770370182470852454" onmouseenter="enter('-4770370182470852454');" onmouseout="out('-4770370182470852454');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 170 +        dealInsert(row);                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171      }                                                                                                             </span>
<span  style=""> 172                                                                                                                    </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 173      protected void dealInsert(Row record) {                                                                       </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 174          Put put = getPutByRow(record);                                                                            </span>
<span class="493519997573168334" onmouseenter="enter('493519997573168334');" onmouseout="out('493519997573168334');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 175 -        if (put == null) {                                                                                        </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +        if (put == null || put.isEmpty()) {                                                                       </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +            outDirtyRecords.inc();                                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 178              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179          }                                                                                                         </span>
<span  style=""> 180                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 181          try {                                                                                                     </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 182              table.put(put);                                                                                       </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 183 -        } catch (IOException e) {                                                                                 </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 184 +        } catch (Exception e) {                                                                                   </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style=""> 185              if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {                </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style=""> 186                  LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                                        </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 187                  LOG.error(&quot;&quot;, e);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188              }                                                                                                     </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 189              outDirtyRecords.inc();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190          }                                                                                                         </span>
<span  style=""> 191                                                                                                                    </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 192          if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                                   </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style=""> 193              LOG.info(record.toString());                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194          }                                                                                                         </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 195          outRecords.inc();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 196 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 197 -                                                                                                                  </span>
<span class="-6877193357999819834" onmouseenter="enter('-6877193357999819834');" onmouseout="out('-6877193357999819834');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 198 -    protected void dealDelete(Row record) {                                                                       </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 199 -        String rowKey = buildRowKey(record);                                                                      </span>
<span class="-7117490653594367529" onmouseenter="enter('-7117490653594367529');" onmouseout="out('-7117490653594367529');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 200 -        if (!StringUtils.isEmpty(rowKey)) {                                                                       </span>
<span class="-4443114221682253197" onmouseenter="enter('-4443114221682253197');" onmouseout="out('-4443114221682253197');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 201 -            Delete delete = new Delete(Bytes.toBytes(rowKey));                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 202 -            try {                                                                                                 </span>
<span class="2376467010118351815" onmouseenter="enter('2376467010118351815');" onmouseout="out('2376467010118351815');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 203 -                table.delete(delete);                                                                             </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 204 -            } catch (IOException e) {                                                                             </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 205 -                if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {            </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 206 -                    LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                                    </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 207 -                    LOG.error(&quot;&quot;, e);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 208 -                }                                                                                                 </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 209 -                outDirtyRecords.inc();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 210 -            }                                                                                                     </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 211 -            if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                               </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 212 -                LOG.info(record.toString());                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 213 -            }                                                                                                     </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 214 -            outRecords.inc();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 215 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216      }                                                                                                             </span>
<span  style=""> 217                                                                                                                    </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 218      private Put getPutByRow(Row record) {                                                                         </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 219          String rowKey = buildRowKey(record);                                                                      </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 220          if (StringUtils.isEmpty(rowKey)) {                                                                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 221              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222          }                                                                                                         </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 223          Put put = new Put(rowKey.getBytes());                                                                     </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 224          for (int i = 0; i &lt; record.getArity(); ++i) {                                                             </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 225              Object fieldVal = record.getField(i);                                                                 </span>
<span class="1407908144613461272" onmouseenter="enter('1407908144613461272');" onmouseout="out('1407908144613461272');" style=""> 226              if (fieldVal == null) {                                                                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 227                  continue;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228              }                                                                                                     </span>
<span class="-6034367363724242535" onmouseenter="enter('-6034367363724242535');" onmouseout="out('-6034367363724242535');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 229 -            byte[] val = fieldVal.toString().getBytes();                                                          </span>
<span class="-3781685654159973216" onmouseenter="enter('-3781685654159973216');" onmouseout="out('-3781685654159973216');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 230 +            byte[] val = HbaseUtil.toByte(fieldVal);                                                              </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 231              byte[] cf = families[i].getBytes();                                                                   </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 232              byte[] qualifier = qualifiers[i].getBytes();                                                          </span>
<span  style=""> 233                                                                                                                    </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 234              put.addColumn(cf, qualifier, val);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235          }                                                                                                         </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 236          return put;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237      }                                                                                                             </span>
<span  style=""> 238                                                                                                                    </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 239      private String buildRowKey(Row record) {                                                                      </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 240          String rowKeyValues = getRowKeyValues(record);                                                            </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 241          // all rowkey not null                                                                                    </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 242          if (StringUtils.isBlank(rowKeyValues)) {                                                                  </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 243              LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                                      </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 244              outDirtyRecords.inc();                                                                                </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 245              return &quot;&quot;;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246          }                                                                                                         </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 247          return rowKeyValues;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248      }                                                                                                             </span>
<span  style=""> 249                                                                                                                    </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 250      private String getRowKeyValues(Row record) {                                                                  </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 251          Map&lt;String, Object&gt; row = rowConvertMap(record);                                                          </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 252          RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                                        </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 253          rowKeyBuilder.init(rowkey);                                                                               </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 254          return rowKeyBuilder.getRowKey(row);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255      }                                                                                                             </span>
<span  style=""> 256                                                                                                                    </span>
<span class="-4244565164826320221" onmouseenter="enter('-4244565164826320221');" onmouseout="out('-4244565164826320221');" style=""> 257      private Map&lt;String, Object&gt; rowConvertMap(Row record){                                                        </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 258          Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                         </span>
<span class="-3126284954851894008" onmouseenter="enter('-3126284954851894008');" onmouseout="out('-3126284954851894008');" style=""> 259          for(int i = 0; i &lt; columnNames.length; i++){                                                              </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 260              rowValue.put(columnNames[i], record.getField(i));                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261          }                                                                                                         </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 262          return rowValue;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263      }                                                                                                             </span>
<span  style=""> 264                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 265      @Override                                                                                                     </span>
<span class="3075770629113308700" onmouseenter="enter('3075770629113308700');" onmouseout="out('3075770629113308700');" style=""> 266      public void close() throws IOException {                                                                      </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 267          if (conn != null) {                                                                                       </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 268              conn.close();                                                                                         </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 269              conn = null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 270          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 271      }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 272 -                                                                                                                  </span>
<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style=""> 273      private HbaseOutputFormat() {                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274      }                                                                                                             </span>
<span  style=""> 275                                                                                                                    </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style=""> 276      public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                             </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 277          return new HbaseOutputFormatBuilder();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278      }                                                                                                             </span>
<span  style=""> 279                                                                                                                    </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 280      public static class HbaseOutputFormatBuilder {                                                                </span>
<span  style=""> 281                                                                                                                    </span>
<span class="-7158416171782501647" onmouseenter="enter('-7158416171782501647');" onmouseout="out('-7158416171782501647');" style=""> 282          private HbaseOutputFormat format;                                                                         </span>
<span  style=""> 283                                                                                                                    </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 284          private HbaseOutputFormatBuilder() {                                                                      </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 285              format = new HbaseOutputFormat();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286          }                                                                                                         </span>
<span  style=""> 287                                                                                                                    </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 288          public HbaseOutputFormatBuilder setHost(String host) {                                                    </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 289              format.host = host;                                                                                   </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 290              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291          }                                                                                                         </span>
<span  style=""> 292                                                                                                                    </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 293          public HbaseOutputFormatBuilder setZkParent(String parent) {                                              </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 294              format.zkParent = parent;                                                                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 295              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296          }                                                                                                         </span>
<span  style=""> 297                                                                                                                    </span>
<span  style=""> 298                                                                                                                    </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 299          public HbaseOutputFormatBuilder setTable(String tableName) {                                              </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 300              format.tableName = tableName;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 301              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302          }                                                                                                         </span>
<span  style=""> 303                                                                                                                    </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 304          public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                                </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 305              format.rowkey = rowkey;                                                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 306              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307          }                                                                                                         </span>
<span  style=""> 308                                                                                                                    </span>
<span class="-3918129811515768088" onmouseenter="enter('-3918129811515768088');" onmouseout="out('-3918129811515768088');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 309 -        public HbaseOutputFormatBuilder setUpdateMode(String updateMode) {                                        </span>
<span class="-2281017119849044621" onmouseenter="enter('-2281017119849044621');" onmouseout="out('-2281017119849044621');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 310 -            format.updateMode = updateMode;                                                                       </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 311 -            return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 312 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 313 -                                                                                                                  </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 314          public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                                    </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 315              format.columnNames = columnNames;                                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 316              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317          }                                                                                                         </span>
<span  style=""> 318                                                                                                                    </span>
<span class="-3477447409796330528" onmouseenter="enter('-3477447409796330528');" onmouseout="out('-3477447409796330528');" style=""> 319          public HbaseOutputFormatBuilder setColumnTypes(String[] columnTypes) {                                    </span>
<span class="4736435751759566717" onmouseenter="enter('4736435751759566717');" onmouseout="out('4736435751759566717');" style=""> 320              format.columnTypes = columnTypes;                                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 321              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322          }                                                                                                         </span>
<span  style=""> 323                                                                                                                    </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 324          public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {               </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 325              format.columnNameFamily = columnNameFamily;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 326              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327          }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 328 +                                                                                                                  </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 329 +        public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {                       </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 330 +            format.kerberosAuthEnable = kerberosAuthEnable;                                                       </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 331 +            return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 332 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 333 +                                                                                                                  </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 334 +        public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {                </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 335 +            format.regionserverKeytabFile = regionserverKeytabFile;                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 336 +            return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 337 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 338 +                                                                                                                  </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 339 +        public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {                  </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 340 +            format.regionserverPrincipal = regionserverPrincipal;                                                 </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 341 +            return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 342 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 343 +                                                                                                                  </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 344 +        public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                            </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 345 +            format.securityKrb5Conf = securityKrb5Conf;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 346 +            return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 347 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 348 +                                                                                                                  </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 349 +        public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {                      </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 350 +            format.zookeeperSaslClient = zookeeperSaslClient;                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 351 +            return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 352 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 353 +                                                                                                                  </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 354 +        public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                              </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 355 +            format.clientPrincipal = clientPrincipal;                                                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 356 +            return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 357 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 358 +                                                                                                                  </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 359 +        public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                            </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 360 +            format.clientKeytabFile = clientKeytabFile;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 361 +            return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 362 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 363 +                                                                                                                  </span>
<span  style=""> 364                                                                                                                    </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 365          public HbaseOutputFormat finish() {                                                                       </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 366              Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);                       </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 367              Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);                        </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 368              Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);                    </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""> 369              Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;); </span>
<span  style=""> 370                                                                                                                    </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 371              String[] families = new String[format.columnNames.length];                                            </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 372              String[] qualifiers = new String[format.columnNames.length];                                          </span>
<span  style=""> 373                                                                                                                    </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 374              if (format.columnNameFamily != null) {                                                                </span>
<span class="7088458954718632362" onmouseenter="enter('7088458954718632362');" onmouseout="out('7088458954718632362');" style=""> 375                  Set&lt;String&gt; keySet = format.columnNameFamily.keySet();                                            </span>
<span class="6868380902804141682" onmouseenter="enter('6868380902804141682');" onmouseout="out('6868380902804141682');" style=""> 376                  String[] columns = keySet.toArray(new String[keySet.size()]);                                     </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 377                  for (int i = 0; i &lt; columns.length; ++i) {                                                        </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 378                      String col = columns[i];                                                                      </span>
<span class="-2221799979553520110" onmouseenter="enter('-2221799979553520110');" onmouseout="out('-2221799979553520110');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 379 -                    String[] part = StringUtils.split(col, &quot;:&quot;);                                                  </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 380 +                    String[] part = col.split(&quot;:&quot;);                                                               </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 381                      families[i] = part[0];                                                                        </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 382                      qualifiers[i] = part[1];                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 383                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 384              }                                                                                                     </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 385              format.families = families;                                                                           </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 386              format.qualifiers = qualifiers;                                                                       </span>
<span  style=""> 387                                                                                                                    </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 388              return format;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 389          }                                                                                                         </span>
<span  style=""> 390                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 391      }                                                                                                             </span>
<span  style=""> 392                                                                                                                    </span>
<span class="-7186582701716849885" onmouseenter="enter('-7186582701716849885');" onmouseout="out('-7186582701716849885');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 393 +    private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config, String regionserverPrincipal,</span>
<span class="-4185911471210652243" onmouseenter="enter('-4185911471210652243');" onmouseout="out('-4185911471210652243');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 394 +                                        String zookeeperSaslClient, String securityKrb5Conf) throws IOException { </span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 395 +        if (StringUtils.isEmpty(regionserverPrincipal)) {                                                         </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 396 +            throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 396 +            throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is KerberosðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 397 +        }                                                                                                         </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 398 +        config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);                  </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 399 +        config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);            </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 400 +        config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                                    </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 401 +        config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 402 +                                                                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 403 +                                                                                                                  </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 404 +        if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                          </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 405 +            System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 406 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 407 +                                                                                                                  </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 408 +        if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                             </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 409 +            String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;             </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 410 +            LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                            </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 411 +            System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 412 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 413 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 414 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 415 +    @Override                                                                                                     </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 416 +    public String toString() {                                                                                    </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 417 +        return &quot;HbaseOutputFormat kerberos{&quot; +                                                                    </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 418 +                &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                                      </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 419 +                &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                                    </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 420 +                &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                                      </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 421 +                &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                                </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 422 +                &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                          </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 423 +                &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                                  </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 424 +                &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                                </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 425 +                &#x27;}&#x27;;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 426 +    }                                                                                                             </span>
<span  style=""> 427                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 428  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span  style="">  20                                                                                                                    </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  21  package com.dtstack.flink.sql.sink.hbase;                                                                         </span>
<span  style="">  22                                                                                                                    </span>
<span class="-4800595592392942650" onmouseenter="enter('-4800595592392942650');" onmouseout="out('-4800595592392942650');" style="">  23  import com.dtstack.flink.sql.enums.EUpdateMode;                                                                   </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  24  import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                             </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  25  import com.google.common.collect.Maps;                                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  26  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  27  import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  28  import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  29  import org.apache.flink.types.Row;                                                                                </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  30  import org.apache.flink.util.Preconditions;                                                                       </span>
<span class="-2192907090032735453" onmouseenter="enter('-2192907090032735453');" onmouseout="out('-2192907090032735453');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  31 -import org.apache.hadoop.hbase.HBaseConfiguration;                                                                </span>
<span class="-1233342480689635281" onmouseenter="enter('-1233342480689635281');" onmouseout="out('-1233342480689635281');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  32 -import org.apache.hadoop.hbase.TableName;                                                                         </span>
<span class="-2774002081156384359" onmouseenter="enter('-2774002081156384359');" onmouseout="out('-2774002081156384359');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  33 +import org.apache.hadoop.hbase.*;                                                                                 </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  34  import org.apache.hadoop.hbase.client.Connection;                                                                 </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  35  import org.apache.hadoop.hbase.client.ConnectionFactory;                                                          </span>
<span class="162156476597244429" onmouseenter="enter('162156476597244429');" onmouseout="out('162156476597244429');" style="">  36  import org.apache.hadoop.hbase.client.Delete;                                                                     </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  37  import org.apache.hadoop.hbase.client.Put;                                                                        </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  38  import org.apache.hadoop.hbase.client.Table;                                                                      </span>
<span class="1523191633494881954" onmouseenter="enter('1523191633494881954');" onmouseout="out('1523191633494881954');" style="">  39  import org.apache.hadoop.hbase.util.Bytes;                                                                        </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  40 +import org.apache.hadoop.security.UserGroupInformation;                                                           </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  41  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  42  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  43                                                                                                                    </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  44 +import java.io.File;                                                                                              </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  45  import java.io.IOException;                                                                                       </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  46 +import java.security.PrivilegedAction;                                                                            </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  47 +import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  48  import java.util.Map;                                                                                             </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  49  import java.util.Set;                                                                                             </span>
<span  style="">  50                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  51  /**                                                                                                               </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  52   * @author: jingzhen@dtstack.com                                                                                  </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  53   * date: 2017-6-29                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  54   */                                                                                                               </span>
<span class="-4312410715233475343" onmouseenter="enter('-4312410715233475343');" onmouseout="out('-4312410715233475343');" style="">  55  public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&gt; {                                       </span>
<span  style="">  56                                                                                                                    </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  57      private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                           </span>
<span  style="">  58                                                                                                                    </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  59      private String host;                                                                                          </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  60      private String zkParent;                                                                                      </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  61      private String rowkey;                                                                                        </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  62      private String tableName;                                                                                     </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  63      private String[] columnNames;                                                                                 </span>
<span class="870437353868335199" onmouseenter="enter('870437353868335199');" onmouseout="out('870437353868335199');" style="">  64      private String updateMode;                                                                                    </span>
<span class="3545286675323235189" onmouseenter="enter('3545286675323235189');" onmouseout="out('3545286675323235189');" style="">  65      private String[] columnTypes;                                                                                 </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  66      private Map&lt;String, String&gt; columnNameFamily;                                                                 </span>
<span  style="">  67                                                                                                                    </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  68 +    private boolean kerberosAuthEnable;                                                                           </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  69 +    private String regionserverKeytabFile;                                                                        </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  70 +    private String regionserverPrincipal;                                                                         </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  71 +    private String securityKrb5Conf;                                                                              </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  72 +    private String zookeeperSaslClient;                                                                           </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  73 +    private String clientPrincipal;                                                                               </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  74 +    private String clientKeytabFile;                                                                              </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  75 +                                                                                                                  </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  76      private String[] families;                                                                                    </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  77      private String[] qualifiers;                                                                                  </span>
<span  style="">  78                                                                                                                    </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  79      private transient org.apache.hadoop.conf.Configuration conf;                                                  </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  80      private transient Connection conn;                                                                            </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  81      private transient Table table;                                                                                </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  82 +                                                                                                                  </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  83 +    private transient ChoreService choreService;                                                                  </span>
<span  style="">  84                                                                                                                    </span>


<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  85      @Override                                                                                                     </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style="">  86      public void configure(Configuration parameters) {                                                             </span>
<span class="5283504732570168532" onmouseenter="enter('5283504732570168532');" onmouseout="out('5283504732570168532');" style="">  87          LOG.warn(&quot;---configure---&quot;);                                                                              </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style="">  88          conf = HBaseConfiguration.create();                                                                       </span>
<span class="-2926407176515564631" onmouseenter="enter('-2926407176515564631');" onmouseout="out('-2926407176515564631');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  89 -        conf.set(&quot;hbase.zookeeper.quorum&quot;, host);                                                                 </span>
<span class="-6824596350393883643" onmouseenter="enter('-6824596350393883643');" onmouseout="out('-6824596350393883643');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  90 -        if (zkParent != null &amp;&amp; !&quot;&quot;.equals(zkParent)) {                                                           </span>
<span class="9200595598744218935" onmouseenter="enter('9200595598744218935');" onmouseout="out('9200595598744218935');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  91 -            conf.set(&quot;zookeeper.znode.parent&quot;, zkParent);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  92 -        }                                                                                                         </span>
<span class="527987699266735087" onmouseenter="enter('527987699266735087');" onmouseout="out('527987699266735087');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  93 -        LOG.warn(&quot;---configure end ---&quot;);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  94      }                                                                                                             </span>
<span  style="">  95                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  96      @Override                                                                                                     </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style="">  97      public void open(int taskNumber, int numTasks) throws IOException {                                           </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style="">  98          LOG.warn(&quot;---open---&quot;);                                                                                   </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -        conn = ConnectionFactory.createConnection(conf);                                                          </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +        openConn();                                                                                               </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style=""> 101          table = conn.getTable(TableName.valueOf(tableName));                                                      </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style=""> 102          LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                                        </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 103          initMetric();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104      }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +                                                                                                                  </span>
<span class="-7045952989670311434" onmouseenter="enter('-7045952989670311434');" onmouseout="out('-7045952989670311434');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +    private void openConn(){                                                                                      </span>
<span class="-1891643383856272179" onmouseenter="enter('-1891643383856272179');" onmouseout="out('-1891643383856272179');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 107 +        try{                                                                                                      </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 108 +            if (kerberosAuthEnable) {                                                                             </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 109 +                LOG.info(&quot;open kerberos conn&quot;);                                                                   </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 110 +                openKerberosConn();                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 111 +            } else {                                                                                              </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 112 +                LOG.info(&quot;open conn&quot;);                                                                            </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 113 +                conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                      </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 114 +                conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                            </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 115 +                conn = ConnectionFactory.createConnection(conf);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 116 +            }                                                                                                     </span>
<span class="-1580407524319062305" onmouseenter="enter('-1580407524319062305');" onmouseout="out('-1580407524319062305');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 117 +        }catch (Exception e){                                                                                     </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 118 +            throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +                                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 121 +    }                                                                                                             </span>
<span class="2860698523146859203" onmouseenter="enter('2860698523146859203');" onmouseout="out('2860698523146859203');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +    private void openKerberosConn() throws IOException {                                                          </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +        conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                              </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +        conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                                    </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +                                                                                                                  </span>
<span class="4379250985718822963" onmouseenter="enter('4379250985718822963');" onmouseout="out('4379250985718822963');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +        LOG.info(&quot;kerberos config:{}&quot;, this.toString());                                                          </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +        Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);         </span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +        Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);       </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 129 +                                                                                                                  </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 130 +        fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 131 +                                                                                                                  </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 132 +        clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;                    </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 133 +        clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 134 +                                                                                                                  </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 135 +        conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                                </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 136 +        conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 137 +                                                                                                                  </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 138 +        UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 138 +        UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clieðŸ”µ</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 139 +        org.apache.hadoop.conf.Configuration finalConf = conf;                                                    </span>
<span class="8070196252242862048" onmouseenter="enter('8070196252242862048');" onmouseout="out('8070196252242862048');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 140 +        conn = userGroupInformation.doAs(new PrivilegedAction&lt;Connection&gt;() {                                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 141 +            @Override                                                                                             </span>
<span class="-2793922907574726120" onmouseenter="enter('-2793922907574726120');" onmouseout="out('-2793922907574726120');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +            public Connection run() {                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +                try {                                                                                             </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 144 +                    ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                                  </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +                    if (authChore != null) {                                                                      </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 146 +                        choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                                     </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 147 +                        choreService.scheduleChore(authChore);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +                    }                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 149 +                                                                                                                  </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +                    return ConnectionFactory.createConnection(finalConf);                                         </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +                } catch (IOException e) {                                                                         </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +                    LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                                   </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 153 +                    throw new RuntimeException(e);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 154 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +            }                                                                                                     </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 156 +        });                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 157 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 158 +                                                                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 159 +                                                                                                                  </span>
<span  style=""> 160                                                                                                                    </span>























































<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 161      @Override                                                                                                     </span>
<span class="6661161668199118158" onmouseenter="enter('6661161668199118158');" onmouseout="out('6661161668199118158');" style=""> 162      public void writeRecord(Tuple2 tuple2) {                                                                      </span>
<span class="-6701151034505735722" onmouseenter="enter('-6701151034505735722');" onmouseout="out('-6701151034505735722');" style=""> 163          Tuple2&lt;Boolean, Row&gt; tupleTrans = tuple2;                                                                 </span>
<span class="-6798598886787048492" onmouseenter="enter('-6798598886787048492');" onmouseout="out('-6798598886787048492');" style=""> 164          Boolean retract = tupleTrans.f0;                                                                          </span>
<span class="-8114318735339252101" onmouseenter="enter('-8114318735339252101');" onmouseout="out('-8114318735339252101');" style=""> 165          Row row = tupleTrans.f1;                                                                                  </span>
<span class="-4738216633021392189" onmouseenter="enter('-4738216633021392189');" onmouseout="out('-4738216633021392189');" style=""> 166          if (retract) {                                                                                            </span>
<span class="-4770370182470852454" onmouseenter="enter('-4770370182470852454');" onmouseout="out('-4770370182470852454');" style=""> 167              dealInsert(row);                                                                                      </span>
<span class="-6425603269843385069" onmouseenter="enter('-6425603269843385069');" onmouseout="out('-6425603269843385069');" style=""> 168          } else if (!retract &amp;&amp; StringUtils.equalsIgnoreCase(updateMode, EUpdateMode.UPSERT.name())) {             </span>
<span class="-2497428920962601187" onmouseenter="enter('-2497428920962601187');" onmouseout="out('-2497428920962601187');" style=""> 169              dealDelete(row);                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170          }                                                                                                         </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171      }                                                                                                             </span>
<span  style=""> 172                                                                                                                    </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 173      protected void dealInsert(Row record) {                                                                       </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 174          Put put = getPutByRow(record);                                                                            </span>
<span class="493519997573168334" onmouseenter="enter('493519997573168334');" onmouseout="out('493519997573168334');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 175 -        if (put == null) {                                                                                        </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +        if (put == null || put.isEmpty()) {                                                                       </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +            outDirtyRecords.inc();                                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 178              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179          }                                                                                                         </span>
<span  style=""> 180                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 181          try {                                                                                                     </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 182              table.put(put);                                                                                       </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 183 -        } catch (IOException e) {                                                                                 </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 184 +        } catch (Exception e) {                                                                                   </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style=""> 185              if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {                </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style=""> 186                  LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                                        </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 187                  LOG.error(&quot;&quot;, e);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188              }                                                                                                     </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 189              outDirtyRecords.inc();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190          }                                                                                                         </span>
<span  style=""> 191                                                                                                                    </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 192          if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                                   </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style=""> 193              LOG.info(record.toString());                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194          }                                                                                                         </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 195          outRecords.inc();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196      }                                                                                                             </span>
<span  style=""> 197                                                                                                                    </span>
<span class="-6877193357999819834" onmouseenter="enter('-6877193357999819834');" onmouseout="out('-6877193357999819834');" style=""> 198      protected void dealDelete(Row record) {                                                                       </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 199          String rowKey = buildRowKey(record);                                                                      </span>
<span class="-7117490653594367529" onmouseenter="enter('-7117490653594367529');" onmouseout="out('-7117490653594367529');" style=""> 200          if (!StringUtils.isEmpty(rowKey)) {                                                                       </span>
<span class="-4443114221682253197" onmouseenter="enter('-4443114221682253197');" onmouseout="out('-4443114221682253197');" style=""> 201              Delete delete = new Delete(Bytes.toBytes(rowKey));                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 202              try {                                                                                                 </span>
<span class="2376467010118351815" onmouseenter="enter('2376467010118351815');" onmouseout="out('2376467010118351815');" style=""> 203                  table.delete(delete);                                                                             </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 204              } catch (IOException e) {                                                                             </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style=""> 205                  if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {            </span>
<span class="-8833175227067122168" onmouseenter="enter('-8833175227067122168');" onmouseout="out('-8833175227067122168');" style=""> 206                      LOG.error(&quot;record insert failed ..{}&quot;, record.toString());                                    </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 207                      LOG.error(&quot;&quot;, e);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208                  }                                                                                                 </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 209                  outDirtyRecords.inc();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210              }                                                                                                     </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 211              if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                               </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style=""> 212                  LOG.info(record.toString());                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213              }                                                                                                     </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 214              outRecords.inc();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216      }                                                                                                             </span>
<span  style=""> 217                                                                                                                    </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 218      private Put getPutByRow(Row record) {                                                                         </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 219          String rowKey = buildRowKey(record);                                                                      </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 220          if (StringUtils.isEmpty(rowKey)) {                                                                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 221              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222          }                                                                                                         </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 223          Put put = new Put(rowKey.getBytes());                                                                     </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 224          for (int i = 0; i &lt; record.getArity(); ++i) {                                                             </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 225              Object fieldVal = record.getField(i);                                                                 </span>
<span class="1407908144613461272" onmouseenter="enter('1407908144613461272');" onmouseout="out('1407908144613461272');" style=""> 226              if (fieldVal == null) {                                                                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 227                  continue;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228              }                                                                                                     </span>
<span class="-6034367363724242535" onmouseenter="enter('-6034367363724242535');" onmouseout="out('-6034367363724242535');" style=""> 229              byte[] val = fieldVal.toString().getBytes();                                                          </span>

<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 230              byte[] cf = families[i].getBytes();                                                                   </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 231              byte[] qualifier = qualifiers[i].getBytes();                                                          </span>
<span  style=""> 232                                                                                                                    </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 233              put.addColumn(cf, qualifier, val);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234          }                                                                                                         </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 235          return put;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236      }                                                                                                             </span>
<span  style=""> 237                                                                                                                    </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 238      private String buildRowKey(Row record) {                                                                      </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 239          String rowKeyValues = getRowKeyValues(record);                                                            </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 240          // all rowkey not null                                                                                    </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 241          if (StringUtils.isBlank(rowKeyValues)) {                                                                  </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 242              LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                                      </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 243              outDirtyRecords.inc();                                                                                </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 244              return &quot;&quot;;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245          }                                                                                                         </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 246          return rowKeyValues;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247      }                                                                                                             </span>
<span  style=""> 248                                                                                                                    </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 249      private String getRowKeyValues(Row record) {                                                                  </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 250          Map&lt;String, Object&gt; row = rowConvertMap(record);                                                          </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 251          RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                                        </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 252          rowKeyBuilder.init(rowkey);                                                                               </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 253          return rowKeyBuilder.getRowKey(row);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254      }                                                                                                             </span>
<span  style=""> 255                                                                                                                    </span>
<span class="-4244565164826320221" onmouseenter="enter('-4244565164826320221');" onmouseout="out('-4244565164826320221');" style=""> 256      private Map&lt;String, Object&gt; rowConvertMap(Row record){                                                        </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 257          Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                         </span>
<span class="-3126284954851894008" onmouseenter="enter('-3126284954851894008');" onmouseout="out('-3126284954851894008');" style=""> 258          for(int i = 0; i &lt; columnNames.length; i++){                                                              </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 259              rowValue.put(columnNames[i], record.getField(i));                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260          }                                                                                                         </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 261          return rowValue;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262      }                                                                                                             </span>
<span  style=""> 263                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 264      @Override                                                                                                     </span>
<span class="3075770629113308700" onmouseenter="enter('3075770629113308700');" onmouseout="out('3075770629113308700');" style=""> 265      public void close() throws IOException {                                                                      </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 266          if (conn != null) {                                                                                       </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 267              conn.close();                                                                                         </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 268              conn = null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 270      }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 271 -                                                                                                                  </span>
<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style=""> 272      private HbaseOutputFormat() {                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273      }                                                                                                             </span>
<span  style=""> 274                                                                                                                    </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style=""> 275      public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                             </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 276          return new HbaseOutputFormatBuilder();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277      }                                                                                                             </span>
<span  style=""> 278                                                                                                                    </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 279      public static class HbaseOutputFormatBuilder {                                                                </span>
<span  style=""> 280                                                                                                                    </span>
<span class="-7158416171782501647" onmouseenter="enter('-7158416171782501647');" onmouseout="out('-7158416171782501647');" style=""> 281          private HbaseOutputFormat format;                                                                         </span>
<span  style=""> 282                                                                                                                    </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 283          private HbaseOutputFormatBuilder() {                                                                      </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 284              format = new HbaseOutputFormat();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285          }                                                                                                         </span>
<span  style=""> 286                                                                                                                    </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 287          public HbaseOutputFormatBuilder setHost(String host) {                                                    </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 288              format.host = host;                                                                                   </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 289              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290          }                                                                                                         </span>
<span  style=""> 291                                                                                                                    </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 292          public HbaseOutputFormatBuilder setZkParent(String parent) {                                              </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 293              format.zkParent = parent;                                                                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 294              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295          }                                                                                                         </span>
<span  style=""> 296                                                                                                                    </span>
<span  style=""> 297                                                                                                                    </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 298          public HbaseOutputFormatBuilder setTable(String tableName) {                                              </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 299              format.tableName = tableName;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 300              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301          }                                                                                                         </span>
<span  style=""> 302                                                                                                                    </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 303          public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                                </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 304              format.rowkey = rowkey;                                                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 305              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306          }                                                                                                         </span>
<span  style=""> 307                                                                                                                    </span>
<span class="-3918129811515768088" onmouseenter="enter('-3918129811515768088');" onmouseout="out('-3918129811515768088');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 308 -        public HbaseOutputFormatBuilder setUpdateMode(String updateMode) {                                        </span>
<span class="-2281017119849044621" onmouseenter="enter('-2281017119849044621');" onmouseout="out('-2281017119849044621');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 309 -            format.updateMode = updateMode;                                                                       </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 310 -            return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 311 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 312 -                                                                                                                  </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 313          public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                                    </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 314              format.columnNames = columnNames;                                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 315              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316          }                                                                                                         </span>
<span  style=""> 317                                                                                                                    </span>
<span class="-3477447409796330528" onmouseenter="enter('-3477447409796330528');" onmouseout="out('-3477447409796330528');" style=""> 318          public HbaseOutputFormatBuilder setColumnTypes(String[] columnTypes) {                                    </span>
<span class="4736435751759566717" onmouseenter="enter('4736435751759566717');" onmouseout="out('4736435751759566717');" style=""> 319              format.columnTypes = columnTypes;                                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 320              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321          }                                                                                                         </span>
<span  style=""> 322                                                                                                                    </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 323          public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {               </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 324              format.columnNameFamily = columnNameFamily;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 325              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326          }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 327 +                                                                                                                  </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 328 +        public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {                       </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 329 +            format.kerberosAuthEnable = kerberosAuthEnable;                                                       </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 330 +            return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 331 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 332 +                                                                                                                  </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 333 +        public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {                </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 334 +            format.regionserverKeytabFile = regionserverKeytabFile;                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 335 +            return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 336 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 337 +                                                                                                                  </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 338 +        public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {                  </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 339 +            format.regionserverPrincipal = regionserverPrincipal;                                                 </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 340 +            return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 341 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 342 +                                                                                                                  </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 343 +        public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                            </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 344 +            format.securityKrb5Conf = securityKrb5Conf;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 345 +            return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 346 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 347 +                                                                                                                  </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 348 +        public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {                      </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 349 +            format.zookeeperSaslClient = zookeeperSaslClient;                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 350 +            return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 351 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 352 +                                                                                                                  </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 353 +        public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                              </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 354 +            format.clientPrincipal = clientPrincipal;                                                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 355 +            return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 356 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 357 +                                                                                                                  </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 358 +        public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                            </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 359 +            format.clientKeytabFile = clientKeytabFile;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 360 +            return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 361 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 362 +                                                                                                                  </span>
<span  style=""> 363                                                                                                                    </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 364          public HbaseOutputFormat finish() {                                                                       </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 365              Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);                       </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 366              Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);                        </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 367              Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);                    </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""> 368              Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;); </span>
<span  style=""> 369                                                                                                                    </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 370              String[] families = new String[format.columnNames.length];                                            </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 371              String[] qualifiers = new String[format.columnNames.length];                                          </span>
<span  style=""> 372                                                                                                                    </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 373              if (format.columnNameFamily != null) {                                                                </span>
<span class="7088458954718632362" onmouseenter="enter('7088458954718632362');" onmouseout="out('7088458954718632362');" style=""> 374                  Set&lt;String&gt; keySet = format.columnNameFamily.keySet();                                            </span>
<span class="6868380902804141682" onmouseenter="enter('6868380902804141682');" onmouseout="out('6868380902804141682');" style=""> 375                  String[] columns = keySet.toArray(new String[keySet.size()]);                                     </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 376                  for (int i = 0; i &lt; columns.length; ++i) {                                                        </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 377                      String col = columns[i];                                                                      </span>
<span class="-2221799979553520110" onmouseenter="enter('-2221799979553520110');" onmouseout="out('-2221799979553520110');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 378 -                    String[] part = StringUtils.split(col, &quot;:&quot;);                                                  </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 379 +                    String[] part = col.split(&quot;:&quot;);                                                               </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 380                      families[i] = part[0];                                                                        </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 381                      qualifiers[i] = part[1];                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 382                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 383              }                                                                                                     </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 384              format.families = families;                                                                           </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 385              format.qualifiers = qualifiers;                                                                       </span>
<span  style=""> 386                                                                                                                    </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 387              return format;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388          }                                                                                                         </span>
<span  style=""> 389                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390      }                                                                                                             </span>
<span  style=""> 391                                                                                                                    </span>
<span class="-7186582701716849885" onmouseenter="enter('-7186582701716849885');" onmouseout="out('-7186582701716849885');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 392 +    private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config, String regionserverPrincipal,</span>
<span class="-4185911471210652243" onmouseenter="enter('-4185911471210652243');" onmouseout="out('-4185911471210652243');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 393 +                                        String zookeeperSaslClient, String securityKrb5Conf) throws IOException { </span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 394 +        if (StringUtils.isEmpty(regionserverPrincipal)) {                                                         </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 395 +            throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 395 +            throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is KerberosðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 396 +        }                                                                                                         </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 397 +        config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);                  </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 398 +        config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);            </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 399 +        config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                                    </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 400 +        config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 401 +                                                                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 402 +                                                                                                                  </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 403 +        if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                          </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 404 +            System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 405 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 406 +                                                                                                                  </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 407 +        if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                             </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 408 +            String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;             </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 409 +            LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                            </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 410 +            System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 411 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 412 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 413 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 414 +    @Override                                                                                                     </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 415 +    public String toString() {                                                                                    </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 416 +        return &quot;HbaseOutputFormat kerberos{&quot; +                                                                    </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 417 +                &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                                      </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 418 +                &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                                    </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 419 +                &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                                      </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 420 +                &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                                </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 421 +                &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                          </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 422 +                &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                                  </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 423 +                &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                                </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 424 +                &#x27;}&#x27;;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 425 +    }                                                                                                             </span>
<span  style=""> 426                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 427  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            