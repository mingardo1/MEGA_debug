<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>85</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    85
                    <a href="84.html">prev</a>
                    <a href="86.html">next</a>
                    <a href="85_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    Automattic/simplenote-android_a379ea0cd268411774a28e2b9ec8b1dea1b5db3a_Simplenote/src/main/java/com/automattic/simplenote/utils/TagUtils.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;a379ea0cd268411774a28e2b9ec8b1dea1b5db3a:Simplenote/src/main/java/com/automattic/simplenote/utils/TagUtils.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;a379ea0cd268411774a28e2b9ec8b1dea1b5db3a^1:Simplenote/src/main/java/com/automattic/simplenote/utils/TagUtils.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;a379ea0cd268411774a28e2b9ec8b1dea1b5db3a^2:Simplenote/src/main/java/com/automattic/simplenote/utils/TagUtils.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;b31e76b78daf8eacff2d158fcf77dba40c44c20b:Simplenote/src/main/java/com/automattic/simplenote/utils/TagUtils.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 package com.automattic.simplenote.utils;
   2 
   3 import android.util.Log;
   4 
   5 import com.automattic.simplenote.models.Tag;
   6 import com.simperium.client.Bucket;
   7 import com.simperium.client.BucketObjectMissingException;
   8 import com.simperium.client.BucketObjectNameInvalid;
   9 
  10 import java.io.UnsupportedEncodingException;
  11 import java.net.URLEncoder;
  12 import java.nio.charset.StandardCharsets;
  13 import java.text.Normalizer;
  14 import java.util.Locale;
  15 
  16 public class TagUtils {
  17     private static int MAXIMUM_LENGTH_ENCODED_HASH = 256;
  18 
  19     /**
  20      * Create a tag with the @param key and @param name in the @param bucket.
  21      *
  22      * @param bucket    {@link Bucket&lt;Tag&gt;} in which to create the tag.
  23      * @param name      {@link String} to use as tag name.
  24      * @param index     {@link int} to use as tag index.
  25      */
<abbr title="  26     public static void createTag(Bucket&lt;Tag&gt; bucket, String name, int index) throws BucketObjectNameInvalid {">  26     public static void createTag(Bucket&lt;Tag&gt; bucket, String name, int index) throws BucketObjectNameInvalðŸ”µ</abbr>
  27         try {
  28             Tag tag = bucket.newObject(hashTag(name));
  29             tag.setName(name);
  30             tag.setIndex(index);
  31             tag.save();
  32         } catch (BucketObjectNameInvalid e) {
  33             Log.e(&quot;createTag&quot;, &quot;Could not create tag &quot; + &quot;\&quot;&quot; + name + &quot;\&quot;&quot;, e);
  34             throw new BucketObjectNameInvalid(name);
  35         }
  36     }
  37 
  38     /**
  39      * Create a tag the @param key and @param name in the @param bucket if it does not exist.
  40      *
  41      * @param bucket    {@link Bucket&lt;Tag&gt;} in which to create the tag.
  42      * @param name      {@link String} to use creating the tag.
  43      */
<abbr title="  44     public static void createTagIfMissing(Bucket&lt;Tag&gt; bucket, String name) throws BucketObjectNameInvalid {">  44     public static void createTagIfMissing(Bucket&lt;Tag&gt; bucket, String name) throws BucketObjectNameInvalidðŸ”µ</abbr>
  45         if (isTagMissing(bucket, name)) {
  46             createTag(bucket, name, bucket.count());
  47         }
  48     }
  49 
  50     /**
  51      * Get the canonical representation of a tag from the hashed value of the lexical variation.
  52      *
  53      * @param bucket    {@link Bucket&lt;Tag&gt;} in which to get tag.
  54      * @param lexical   {@link String} lexical variation of tag.
  55      *
  56      * @return          {@link String} canonical of tag if exists; lexical variation otherwise.
  57      */
  58     public static String getCanonicalFromLexical(Bucket&lt;Tag&gt; bucket, String lexical) {
  59         String hashed = hashTag(lexical);
  60 
  61         try {
  62             Tag tag = bucket.getObject(hashed);
  63             Log.d(&quot;getCanonicalFromLexical&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + hashed + &quot;\&quot;&quot; + &quot; does exist&quot;);
  64             return tag.getName();
  65         } catch (BucketObjectMissingException e) {
  66             Log.d(&quot;getCanonicalFromLexical&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + hashed + &quot;\&quot;&quot; + &quot; does not exist&quot;);
  67             return lexical;
  68         }
  69     }
  70 
  71     /**
  72      * A canonical representation of a tag exists from the hashed value of the lexical variation.
  73      *
  74      * @param bucket    {@link Bucket&lt;Tag&gt;} in which to get tag.
  75      * @param lexical   {@link String} lexical variation of tag.
  76      *
  77      * @return          {@link Boolean} TRUE if canonical tag exists; FALSE otherwise.
  78      */
  79     public static boolean hasCanonicalOfLexical(Bucket&lt;Tag&gt; bucket, String lexical) {
  80         String hashed = hashTag(lexical);
  81 
  82         try {
  83             bucket.getObject(hashed);
  84             Log.d(&quot;hasCanonicalOfLexical&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + hashed + &quot;\&quot;&quot; + &quot; does exist&quot;);
  85             return true;
  86         } catch (BucketObjectMissingException e) {
  87             Log.d(&quot;hasCanonicalOfLexical&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + hashed + &quot;\&quot;&quot; + &quot; does not exist&quot;);
  88             return false;
  89         }
  90     }
  91 
  92     /**
  93      * Hash the tag @param name with normalizing, lowercasing, and encoding.
  94      *
  95      * @param name      {@link String} to hash as the tag kay.
  96      *
  97      * @return          {@link String} hashed to use as tag key.
  98      */
  99     public static String hashTag(String name) {
 100         try {
 101             String normalized = Normalizer.normalize(name, Normalizer.Form.NFC);
 102             String lowercased = normalized.toLowerCase(Locale.US);
 103             String encoded = URLEncoder.encode(lowercased, StandardCharsets.UTF_8.name());
 104             return replaceEncoded(encoded);
 105         } catch (UnsupportedEncodingException e) {
 106             // TODO: Handle encoding exception with a custom UTF-8 encoder.
 107             return name;
 108         }
 109     }
 110 
 111     /**
 112      * Determine if the hashed tag @param name is valid after normalizing, lowercasing, and encoding.
 113      *
 114      * @param name      {@link String} to hash as the tag kay.
 115      *
 116      * @return          {@link boolean} true if hashed value is valid; false otherwise.
 117      */
 118     public static boolean hashTagValid(String name) {
 119         try {
 120             String normalized = Normalizer.normalize(name, Normalizer.Form.NFC);
 121             String lowercased = normalized.toLowerCase(Locale.US);
<abbr title=" 122             String encoded = replaceEncoded(URLEncoder.encode(lowercased, StandardCharsets.UTF_8.name()));"> 122             String encoded = replaceEncoded(URLEncoder.encode(lowercased, StandardCharsets.UTF_8.name()))ðŸ”µ</abbr>
 123             return encoded.length() &lt;= MAXIMUM_LENGTH_ENCODED_HASH;
 124         } catch (UnsupportedEncodingException e) {
 125             // TODO: Handle encoding exception with a custom UTF-8 encoder.
 126             return false;
 127         }
 128     }
 129 
 130     /**
 131 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132      * Determine if the tag with @param name is missing from @param bucket or not.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 133      *</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 134      * @param bucket    {@link Bucket&lt;Tag&gt;} in which to create the tag.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 135      * @param name      {@link String} to use creating the tag.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 136      *</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 137      * @return          {@link Boolean} true if tag is missing; false otherwise.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 138      */</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139     public static boolean isTagMissing(Bucket&lt;Tag&gt; bucket, String name) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140         try {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141             bucket.getObject(hashTag(name));</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 142             Log.d(&quot;createTagIfMissing&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + name + &quot;\&quot;&quot; + &quot; already exists&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 143             return false;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 144         } catch (BucketObjectMissingException e) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 145             Log.d(&quot;createTagIfMissing&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + name + &quot;\&quot;&quot; + &quot; does not exist&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146             return true;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147         }</span>
 148 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150     }</span>
 151 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152      * Replace certain characters in @param encoded that were not encoded with encoded value.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153      *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154      * All &quot;+&quot; characters in a tag are encoded upstream and passed as &quot;%2B&quot; in {@param encoded}.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155      * All &quot; &quot; characters in a tag are encoded upstream and passed as &quot;+&quot; in {@param encoded}.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156      * Thus, all &quot;+&quot; in {@param encoded} should be replaced with &quot;%20&quot; as an encoded space.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157      *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158      * @param encoded   {@link String} to replace certain characters with encoded value.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159      *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 160      * @return          {@link String} replaced characters with encoded values.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 161      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 162     private static String replaceEncoded(String encoded) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 163         return encoded</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 164             .replace(&quot;+&quot;, &quot;%20&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 165             .replace(&quot;*&quot;, &quot;%2A&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166             .replace(&quot;-&quot;, &quot;%2D&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 167             .replace(&quot;.&quot;, &quot;%2E&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168             .replace(&quot;_&quot;, &quot;%5F&quot;);</span>
 169 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 170     }
 171 }</pre></td>
                            <td><pre>   1 package com.automattic.simplenote.utils;
   2 
   3 import android.util.Log;
   4 
   5 import com.automattic.simplenote.models.Tag;
   6 import com.simperium.client.Bucket;
   7 import com.simperium.client.BucketObjectMissingException;
   8 import com.simperium.client.BucketObjectNameInvalid;
   9 
  10 import java.io.UnsupportedEncodingException;
  11 import java.net.URLEncoder;
  12 import java.nio.charset.StandardCharsets;
  13 import java.text.Normalizer;
  14 import java.util.Locale;
  15 
  16 public class TagUtils {
  17     private static int MAXIMUM_LENGTH_ENCODED_HASH = 256;
  18 
  19     /**
  20      * Create a tag with the @param key and @param name in the @param bucket.
  21      *
  22      * @param bucket    {@link Bucket&lt;Tag&gt;} in which to create the tag.
  23      * @param name      {@link String} to use as tag name.
  24      * @param index     {@link int} to use as tag index.
  25      */
<abbr title="  26     public static void createTag(Bucket&lt;Tag&gt; bucket, String name, int index) throws BucketObjectNameInvalid {">  26     public static void createTag(Bucket&lt;Tag&gt; bucket, String name, int index) throws BucketObjectNameInvalðŸ”µ</abbr>
  27         try {
  28             Tag tag = bucket.newObject(hashTag(name));
  29             tag.setName(name);
  30             tag.setIndex(index);
  31             tag.save();
  32         } catch (BucketObjectNameInvalid e) {
  33             Log.e(&quot;createTag&quot;, &quot;Could not create tag &quot; + &quot;\&quot;&quot; + name + &quot;\&quot;&quot;, e);
  34             throw new BucketObjectNameInvalid(name);
  35         }
  36     }
  37 
  38     /**
  39      * Create a tag the @param key and @param name in the @param bucket if it does not exist.
  40      *
  41      * @param bucket    {@link Bucket&lt;Tag&gt;} in which to create the tag.
  42      * @param name      {@link String} to use creating the tag.
  43      */
<abbr title="  44     public static void createTagIfMissing(Bucket&lt;Tag&gt; bucket, String name) throws BucketObjectNameInvalid {">  44     public static void createTagIfMissing(Bucket&lt;Tag&gt; bucket, String name) throws BucketObjectNameInvalidðŸ”µ</abbr>
  45         if (isTagMissing(bucket, name)) {
  46             createTag(bucket, name, bucket.count());
  47         }
  48     }
  49 
  50     /**
  51      * Get the canonical representation of a tag from the hashed value of the lexical variation.
  52      *
  53      * @param bucket    {@link Bucket&lt;Tag&gt;} in which to get tag.
  54      * @param lexical   {@link String} lexical variation of tag.
  55      *
  56      * @return          {@link String} canonical of tag if exists; lexical variation otherwise.
  57      */
  58     public static String getCanonicalFromLexical(Bucket&lt;Tag&gt; bucket, String lexical) {
  59         String hashed = hashTag(lexical);
  60 
  61         try {
  62             Tag tag = bucket.getObject(hashed);
  63             Log.d(&quot;getCanonicalFromLexical&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + hashed + &quot;\&quot;&quot; + &quot; does exist&quot;);
  64             return tag.getName();
  65         } catch (BucketObjectMissingException e) {
  66             Log.d(&quot;getCanonicalFromLexical&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + hashed + &quot;\&quot;&quot; + &quot; does not exist&quot;);
  67             return lexical;
  68         }
  69     }
  70 
  71     /**
  72      * A canonical representation of a tag exists from the hashed value of the lexical variation.
  73      *
  74      * @param bucket    {@link Bucket&lt;Tag&gt;} in which to get tag.
  75      * @param lexical   {@link String} lexical variation of tag.
  76      *
  77      * @return          {@link Boolean} TRUE if canonical tag exists; FALSE otherwise.
  78      */
  79     public static boolean hasCanonicalOfLexical(Bucket&lt;Tag&gt; bucket, String lexical) {
  80         String hashed = hashTag(lexical);
  81 
  82         try {
  83             bucket.getObject(hashed);
  84             Log.d(&quot;hasCanonicalOfLexical&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + hashed + &quot;\&quot;&quot; + &quot; does exist&quot;);
  85             return true;
  86         } catch (BucketObjectMissingException e) {
  87             Log.d(&quot;hasCanonicalOfLexical&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + hashed + &quot;\&quot;&quot; + &quot; does not exist&quot;);
  88             return false;
  89         }
  90     }
  91 
  92     /**
  93      * Hash the tag @param name with normalizing, lowercasing, and encoding.
  94      *
  95      * @param name      {@link String} to hash as the tag kay.
  96      *
  97      * @return          {@link String} hashed to use as tag key.
  98      */
  99     public static String hashTag(String name) {
 100         try {
 101             String normalized = Normalizer.normalize(name, Normalizer.Form.NFC);
 102             String lowercased = normalized.toLowerCase(Locale.US);
 103             String encoded = URLEncoder.encode(lowercased, StandardCharsets.UTF_8.name());
 104             return replaceEncoded(encoded);
 105         } catch (UnsupportedEncodingException e) {
 106             // TODO: Handle encoding exception with a custom UTF-8 encoder.
 107             return name;
 108         }
 109     }
 110 
 111     /**
 112      * Determine if the hashed tag @param name is valid after normalizing, lowercasing, and encoding.
 113      *
 114      * @param name      {@link String} to hash as the tag kay.
 115      *
 116      * @return          {@link boolean} true if hashed value is valid; false otherwise.
 117      */
 118     public static boolean hashTagValid(String name) {
 119         try {
 120             String normalized = Normalizer.normalize(name, Normalizer.Form.NFC);
 121             String lowercased = normalized.toLowerCase(Locale.US);
<abbr title=" 122             String encoded = replaceEncoded(URLEncoder.encode(lowercased, StandardCharsets.UTF_8.name()));"> 122             String encoded = replaceEncoded(URLEncoder.encode(lowercased, StandardCharsets.UTF_8.name()))ðŸ”µ</abbr>
 123             return encoded.length() &lt;= MAXIMUM_LENGTH_ENCODED_HASH;
 124         } catch (UnsupportedEncodingException e) {
 125             // TODO: Handle encoding exception with a custom UTF-8 encoder.
 126             return false;
 127         }
 128     }
 129 
 130     /**
 131      * Determine if the tag with @param name is missing from @param bucket or not.
 132      *
 133      * @param bucket    {@link Bucket&lt;Tag&gt;} in which to create the tag.
 134      * @param name      {@link String} to use creating the tag.
 135      *
 136      * @return          {@link Boolean} true if tag is missing; false otherwise.
 137      */
 138     public static boolean isTagMissing(Bucket&lt;Tag&gt; bucket, String name) {
 139         try {
 140             bucket.getObject(hashTag(name));
 141             Log.d(&quot;createTagIfMissing&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + name + &quot;\&quot;&quot; + &quot; already exists&quot;);
 142             return false;
 143         } catch (BucketObjectMissingException e) {
 144             Log.d(&quot;createTagIfMissing&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + name + &quot;\&quot;&quot; + &quot; does not exist&quot;);
 145             return true;
 146         }
 147     }
 148 
 149     /**
 150      * Replace certain characters in @param encoded that were not encoded with encoded value.
 151      *
 152      * All &quot;+&quot; characters in a tag are encoded upstream and passed as &quot;%2B&quot; in {@param encoded}.
 153      * All &quot; &quot; characters in a tag are encoded upstream and passed as &quot;+&quot; in {@param encoded}.
 154      * Thus, all &quot;+&quot; in {@param encoded} should be replaced with &quot;%20&quot; as an encoded space.
 155      *
 156      * @param encoded   {@link String} to replace certain characters with encoded value.
 157      *
 158      * @return          {@link String} replaced characters with encoded values.
 159      */
 160     private static String replaceEncoded(String encoded) {
 161         return encoded
 162             .replace(&quot;+&quot;, &quot;%20&quot;)
 163             .replace(&quot;*&quot;, &quot;%2A&quot;)
 164             .replace(&quot;-&quot;, &quot;%2D&quot;)
 165             .replace(&quot;.&quot;, &quot;%2E&quot;)
 166             .replace(&quot;_&quot;, &quot;%5F&quot;);
 167     }
 168 }
 
 </pre></td>
                            <td><pre>   1 package com.automattic.simplenote.utils;
   2 
   3 import android.util.Log;
   4 import com.automattic.simplenote.models.Tag;
   5 import com.simperium.client.Bucket;
   6 import com.simperium.client.BucketObjectMissingException;
   7 import com.simperium.client.BucketObjectNameInvalid;
   8 import java.io.UnsupportedEncodingException;
   9 import java.net.URLEncoder;
  10 import java.nio.charset.StandardCharsets;
  11 import java.text.Normalizer;
  12 import java.util.Locale;
  13 
  14 
  15 public class TagUtils {
  16     private static int MAXIMUM_LENGTH_ENCODED_HASH = 256;
  17 
  18     /**
  19      * Create a tag with the @param key and @param name in the @param bucket.
  20      *
  21      * @param bucket    {@link Bucket&lt;Tag&gt;} in which to create the tag.
  22      * @param name      {@link String} to use as tag name.
  23      * @param index     {@link int} to use as tag index.
  24      */
<abbr title="  25     public static void createTag(Bucket&lt;Tag&gt; bucket, String name, int index) throws BucketObjectNameInvalid {">  25     public static void createTag(Bucket&lt;Tag&gt; bucket, String name, int index) throws BucketObjectNameInvalðŸ”µ</abbr>
  26         try {
  27             Tag tag = bucket.newObject(hashTag(name));
  28             tag.setName(name);
  29             tag.setIndex(index);
  30             tag.save();
  31         } catch (BucketObjectNameInvalid e) {
  32             Log.e(&quot;createTag&quot;, &quot;Could not create tag &quot; + &quot;\&quot;&quot; + name + &quot;\&quot;&quot;, e);
  33             throw new BucketObjectNameInvalid(name);
  34         }
  35     }
  36 
  37     /**
  38      * Create a tag the @param key and @param name in the @param bucket if it does not exist.
  39      *
  40      * @param bucket    {@link Bucket&lt;Tag&gt;} in which to create the tag.
  41      * @param name      {@link String} to use creating the tag.
  42      */
<abbr title="  43     public static void createTagIfMissing(Bucket&lt;Tag&gt; bucket, String name) throws BucketObjectNameInvalid {">  43     public static void createTagIfMissing(Bucket&lt;Tag&gt; bucket, String name) throws BucketObjectNameInvalidðŸ”µ</abbr>
  44         if (isTagMissing(bucket, name)) {
  45             createTag(bucket, name, bucket.count());
  46         }
  47     }
  48 
  49     /**
  50      * Get the canonical representation of a tag from the hashed value of the lexical variation.
  51      *
  52      * @param bucket    {@link Bucket&lt;Tag&gt;} in which to get tag.
  53      * @param lexical   {@link String} lexical variation of tag.
  54      *
  55      * @return          {@link String} canonical of tag if exists; lexical variation otherwise.
  56      */
  57     public static String getCanonicalFromLexical(Bucket&lt;Tag&gt; bucket, String lexical) {
  58         String hashed = hashTag(lexical);
  59 
  60         try {
  61             Tag tag = bucket.getObject(hashed);
  62             Log.d(&quot;getCanonicalFromLexical&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + hashed + &quot;\&quot;&quot; + &quot; does exist&quot;);
  63             return tag.getName();
  64         } catch (BucketObjectMissingException e) {
  65             Log.d(&quot;getCanonicalFromLexical&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + hashed + &quot;\&quot;&quot; + &quot; does not exist&quot;);
  66             return lexical;
  67         }
  68     }
  69 
  70     /**
  71      * A canonical representation of a tag exists from the hashed value of the lexical variation.
  72      *
  73      * @param bucket    {@link Bucket&lt;Tag&gt;} in which to get tag.
  74      * @param lexical   {@link String} lexical variation of tag.
  75      *
  76      * @return          {@link Boolean} TRUE if canonical tag exists; FALSE otherwise.
  77      */
  78     public static boolean hasCanonicalOfLexical(Bucket&lt;Tag&gt; bucket, String lexical) {
  79         String hashed = hashTag(lexical);
  80 
  81         try {
  82             bucket.getObject(hashed);
  83             Log.d(&quot;hasCanonicalOfLexical&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + hashed + &quot;\&quot;&quot; + &quot; does exist&quot;);
  84             return true;
  85         } catch (BucketObjectMissingException e) {
  86             Log.d(&quot;hasCanonicalOfLexical&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + hashed + &quot;\&quot;&quot; + &quot; does not exist&quot;);
  87             return false;
  88         }
  89     }
  90 
  91     /**
  92      * Hash the tag @param name with normalizing, lowercasing, and encoding.
  93      *
  94      * @param name      {@link String} to hash as the tag kay.
  95      *
  96      * @return          {@link String} hashed to use as tag key.
  97      */
  98     public static String hashTag(String name) {
  99         try {
 100             String normalized = Normalizer.normalize(name, Normalizer.Form.NFC);
 101             String lowercased = normalized.toLowerCase(Locale.US);
 102             String encoded = URLEncoder.encode(lowercased, StandardCharsets.UTF_8.name());
 103             return replaceEncoded(encoded);
 104         } catch (UnsupportedEncodingException e) {
 105             // TODO: Handle encoding exception with a custom UTF-8 encoder.
 106             return name;
 107         }
 108     }
 109 
 110     /**
 111      * Determine if the hashed tag @param name is valid after normalizing, lowercasing, and encoding.
 112      *
 113      * @param name      {@link String} to hash as the tag kay.
 114      *
 115      * @return          {@link boolean} true if hashed value is valid; false otherwise.
 116      */
 117     public static boolean hashTagValid(String name) {
 118         try {
 119             String normalized = Normalizer.normalize(name, Normalizer.Form.NFC);
 120             String lowercased = normalized.toLowerCase(Locale.US);
<abbr title=" 121             String encoded = replaceEncoded(URLEncoder.encode(lowercased, StandardCharsets.UTF_8.name()));"> 121             String encoded = replaceEncoded(URLEncoder.encode(lowercased, StandardCharsets.UTF_8.name()))ðŸ”µ</abbr>
 122             return encoded.length() &lt;= MAXIMUM_LENGTH_ENCODED_HASH;
 123         } catch (UnsupportedEncodingException e) {
 124             // TODO: Handle encoding exception with a custom UTF-8 encoder.
 125             return false;
 126         }
 127     }
 128 
 129     /**
 130      * Determine if the tag with @param name is missing from @param bucket or not.
 131      *
 132      * @param bucket    {@link Bucket&lt;Tag&gt;} in which to create the tag.
 133      * @param name      {@link String} to use creating the tag.
 134      *
 135      * @return          {@link Boolean} true if tag is missing; false otherwise.
 136      */
 137     public static boolean isTagMissing(Bucket&lt;Tag&gt; bucket, String name) {
 138         try {
 139             bucket.getObject(hashTag(name));
 140             Log.d(&quot;createTagIfMissing&quot;, (((&quot;Tag &quot; + &quot;\&quot;&quot;) + name) + &quot;\&quot;&quot;) + &quot; already exists&quot;);
 141             return false;
 142         } catch (BucketObjectMissingException e) {
 143             Log.d(&quot;createTagIfMissing&quot;, (((&quot;Tag &quot; + &quot;\&quot;&quot;) + name) + &quot;\&quot;&quot;) + &quot; does not exist&quot;);
 144             return true;
 145         }
 146     }
 147 
 148     /**
 149      * Replace certain characters in @param encoded that were not encoded with encoded value.
 150      *
 151      * All &quot;+&quot; characters in a tag are encoded upstream and passed as &quot;%2B&quot; in {@param encoded}.
 152      * All &quot; &quot; characters in a tag are encoded upstream and passed as &quot;+&quot; in {@param encoded}.
 153      * Thus, all &quot;+&quot; in {@param encoded} should be replaced with &quot;%20&quot; as an encoded space.
 154      *
 155      * @param encoded   {@link String} to replace certain characters with encoded value.
 156      *
 157      * @return          {@link String} replaced characters with encoded values.
 158      */
 159     private static String replaceEncoded(String encoded) {
 160         return encoded
 161             .replace(&quot;+&quot;, &quot;%20&quot;)
 162             .replace(&quot;*&quot;, &quot;%2A&quot;)
 163             .replace(&quot;-&quot;, &quot;%2D&quot;)
 164             .replace(&quot;.&quot;, &quot;%2E&quot;)
 165             .replace(&quot;_&quot;, &quot;%5F&quot;);
 166     }
 167 }
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  package com.automattic.simplenote.utils;
   2  
   3  import android.util.Log;
   4  
   5  import com.automattic.simplenote.models.Tag;
   6  import com.simperium.client.Bucket;
   7  import com.simperium.client.BucketObjectMissingException;
   8  import com.simperium.client.BucketObjectNameInvalid;
   9  
  10  import java.io.UnsupportedEncodingException;
  11  import java.net.URLEncoder;
  12  import java.nio.charset.StandardCharsets;
  13  import java.text.Normalizer;
  14  import java.util.Locale;
  15  
  16  public class TagUtils {
  17      private static int MAXIMUM_LENGTH_ENCODED_HASH = 256;
  18  
  19      /**
  20       * Create a tag with the @param key and @param name in the @param bucket.
  21       *
  22       * @param bucket    {@link Bucket&lt;Tag&gt;} in which to create the tag.
  23       * @param name      {@link String} to use as tag name.
  24       * @param index     {@link int} to use as tag index.
  25       */
  26      public static void createTag(Bucket&lt;Tag&gt; bucket, String name, int index) throws BucketObjectNameInvalid {
  27          try {
  28              Tag tag = bucket.newObject(hashTag(name));
  29              tag.setName(name);
  30              tag.setIndex(index);
  31              tag.save();
  32          } catch (BucketObjectNameInvalid e) {
  33              Log.e(&quot;createTag&quot;, &quot;Could not create tag &quot; + &quot;\&quot;&quot; + name + &quot;\&quot;&quot;, e);
  34              throw new BucketObjectNameInvalid(name);
  35          }
  36      }
  37  
  38      /**
  39       * Create a tag the @param key and @param name in the @param bucket if it does not exist.
  40       *
  41       * @param bucket    {@link Bucket&lt;Tag&gt;} in which to create the tag.
  42       * @param name      {@link String} to use creating the tag.
  43       */
  44      public static void createTagIfMissing(Bucket&lt;Tag&gt; bucket, String name) throws BucketObjectNameInvalid {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  45 -        try {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  46 -            bucket.getObject(hashTag(name));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  47 -            Log.d(&quot;createTagIfMissing&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + name + &quot;\&quot;&quot; + &quot; already exists&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  48 -        } catch (BucketObjectMissingException e) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  49 +        if (isTagMissing(bucket, name)) {</span>
  50              createTag(bucket, name, bucket.count());
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  51 -            Log.d(&quot;createTagIfMissing&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + name + &quot;\&quot;&quot; + &quot; does not exist&quot;);</span>
  52          }
  53      }
  54  
  55      /**
  56       * Get the canonical representation of a tag from the hashed value of the lexical variation.
  57       *
  58       * @param bucket    {@link Bucket&lt;Tag&gt;} in which to get tag.
  59       * @param lexical   {@link String} lexical variation of tag.
  60       *
  61       * @return          {@link String} canonical of tag if exists; lexical variation otherwise.
  62       */
  63      public static String getCanonicalFromLexical(Bucket&lt;Tag&gt; bucket, String lexical) {
  64          String hashed = hashTag(lexical);
  65  
  66          try {
  67              Tag tag = bucket.getObject(hashed);
  68              Log.d(&quot;getCanonicalFromLexical&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + hashed + &quot;\&quot;&quot; + &quot; does exist&quot;);
  69              return tag.getName();
  70          } catch (BucketObjectMissingException e) {
  71              Log.d(&quot;getCanonicalFromLexical&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + hashed + &quot;\&quot;&quot; + &quot; does not exist&quot;);
  72              return lexical;
  73          }
  74      }
  75  
  76      /**





















  77       * Hash the tag @param name with normalizing, lowercasing, and encoding.
  78       *
  79       * @param name      {@link String} to hash as the tag kay.
  80       *
  81       * @return          {@link String} hashed to use as tag key.
  82       */
  83      public static String hashTag(String name) {
  84          try {
  85              String normalized = Normalizer.normalize(name, Normalizer.Form.NFC);
  86              String lowercased = normalized.toLowerCase(Locale.US);
  87              String encoded = URLEncoder.encode(lowercased, StandardCharsets.UTF_8.name());
  88              return encoded.replace(&quot;*&quot;, &quot;%2A&quot;).replace(&quot;+&quot;, &quot;%20&quot;);

  89          } catch (UnsupportedEncodingException e) {
  90              // TODO: Handle encoding exception with a custom UTF-8 encoder.
  91              return name;
  92          }
  93      }
  94  
  95      /**
  96       * Determine if the hashed tag @param name is valid after normalizing, lowercasing, and encoding.
  97       *
  98       * @param name      {@link String} to hash as the tag kay.
  99       *
 100       * @return          {@link boolean} true if hashed value is valid; false otherwise.
 101       */
 102      public static boolean hashTagValid(String name) {
 103          try {
 104              String normalized = Normalizer.normalize(name, Normalizer.Form.NFC);
 105              String lowercased = normalized.toLowerCase(Locale.US);
<abbr title=" 106              String encoded = URLEncoder.encode(lowercased, StandardCharsets.UTF_8.name()).replace(&quot;*&quot;, &quot;%2A&quot;).replace(&quot;+&quot;, &quot;%20&quot;);"> 106              String encoded = URLEncoder.encode(lowercased, StandardCharsets.UTF_8.name()).replace(&quot;*&quot;, &quot;%2A&quot;).replðŸ”µ</abbr>

 107              return encoded.length() &lt;= MAXIMUM_LENGTH_ENCODED_HASH;
 108          } catch (UnsupportedEncodingException e) {
 109              // TODO: Handle encoding exception with a custom UTF-8 encoder.
 110              return false;
 111          }
 112      }
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 113 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 114 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 115 +     * Determine if the tag with @param name is missing from @param bucket or not.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 116 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 117 +     * @param bucket    {@link Bucket&lt;Tag&gt;} in which to create the tag.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 118 +     * @param name      {@link String} to use creating the tag.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +     * @return          {@link Boolean} true if tag is missing; false otherwise.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 121 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +    public static boolean isTagMissing(Bucket&lt;Tag&gt; bucket, String name) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +        try {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +            bucket.getObject(hashTag(name));</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +            Log.d(&quot;createTagIfMissing&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + name + &quot;\&quot;&quot; + &quot; already exists&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +            return false;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +        } catch (BucketObjectMissingException e) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +            Log.d(&quot;createTagIfMissing&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + name + &quot;\&quot;&quot; + &quot; does not exist&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 129 +            return true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 130 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 131 +    }</span>

 132  }</pre></td>
                            <td><pre>   1  package com.automattic.simplenote.utils;
   2  
   3  import android.util.Log;
   4  
   5  import com.automattic.simplenote.models.Tag;
   6  import com.simperium.client.Bucket;
   7  import com.simperium.client.BucketObjectMissingException;
   8  import com.simperium.client.BucketObjectNameInvalid;
   9  
  10  import java.io.UnsupportedEncodingException;
  11  import java.net.URLEncoder;
  12  import java.nio.charset.StandardCharsets;
  13  import java.text.Normalizer;
  14  import java.util.Locale;
  15  
  16  public class TagUtils {
  17      private static int MAXIMUM_LENGTH_ENCODED_HASH = 256;
  18  
  19      /**
  20       * Create a tag with the @param key and @param name in the @param bucket.
  21       *
  22       * @param bucket    {@link Bucket&lt;Tag&gt;} in which to create the tag.
  23       * @param name      {@link String} to use as tag name.
  24       * @param index     {@link int} to use as tag index.
  25       */
  26      public static void createTag(Bucket&lt;Tag&gt; bucket, String name, int index) throws BucketObjectNameInvalid {
  27          try {
  28              Tag tag = bucket.newObject(hashTag(name));
  29              tag.setName(name);
  30              tag.setIndex(index);
  31              tag.save();
  32          } catch (BucketObjectNameInvalid e) {
  33              Log.e(&quot;createTag&quot;, &quot;Could not create tag &quot; + &quot;\&quot;&quot; + name + &quot;\&quot;&quot;, e);
  34              throw new BucketObjectNameInvalid(name);
  35          }
  36      }
  37  
  38      /**
  39       * Create a tag the @param key and @param name in the @param bucket if it does not exist.
  40       *
  41       * @param bucket    {@link Bucket&lt;Tag&gt;} in which to create the tag.
  42       * @param name      {@link String} to use creating the tag.
  43       */
  44      public static void createTagIfMissing(Bucket&lt;Tag&gt; bucket, String name) throws BucketObjectNameInvalid {
  45          try {
  46              bucket.getObject(hashTag(name));
  47              Log.d(&quot;createTagIfMissing&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + name + &quot;\&quot;&quot; + &quot; already exists&quot;);
  48          } catch (BucketObjectMissingException e) {

  49              createTag(bucket, name, bucket.count());
  50              Log.d(&quot;createTagIfMissing&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + name + &quot;\&quot;&quot; + &quot; does not exist&quot;);
  51          }
  52      }
  53  
  54      /**
  55       * Get the canonical representation of a tag from the hashed value of the lexical variation.
  56       *
  57       * @param bucket    {@link Bucket&lt;Tag&gt;} in which to get tag.
  58       * @param lexical   {@link String} lexical variation of tag.
  59       *
  60       * @return          {@link String} canonical of tag if exists; lexical variation otherwise.
  61       */
  62      public static String getCanonicalFromLexical(Bucket&lt;Tag&gt; bucket, String lexical) {
  63          String hashed = hashTag(lexical);
  64  
  65          try {
  66              Tag tag = bucket.getObject(hashed);
  67              Log.d(&quot;getCanonicalFromLexical&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + hashed + &quot;\&quot;&quot; + &quot; does exist&quot;);
  68              return tag.getName();
  69          } catch (BucketObjectMissingException e) {
  70              Log.d(&quot;getCanonicalFromLexical&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + hashed + &quot;\&quot;&quot; + &quot; does not exist&quot;);
  71              return lexical;
  72          }
  73      }
  74  
  75      /**
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  76 +     * A canonical representation of a tag exists from the hashed value of the lexical variation.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  77 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  78 +     * @param bucket    {@link Bucket&lt;Tag&gt;} in which to get tag.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  79 +     * @param lexical   {@link String} lexical variation of tag.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  80 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  81 +     * @return          {@link Boolean} TRUE if canonical tag exists; FALSE otherwise.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  82 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  83 +    public static boolean hasCanonicalOfLexical(Bucket&lt;Tag&gt; bucket, String lexical) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  84 +        String hashed = hashTag(lexical);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  85 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  86 +        try {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  87 +            bucket.getObject(hashed);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  88 +            Log.d(&quot;hasCanonicalOfLexical&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + hashed + &quot;\&quot;&quot; + &quot; does exist&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  89 +            return true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  90 +        } catch (BucketObjectMissingException e) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  91 +            Log.d(&quot;hasCanonicalOfLexical&quot;, &quot;Tag &quot; + &quot;\&quot;&quot; + hashed + &quot;\&quot;&quot; + &quot; does not exist&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  92 +            return false;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  93 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  94 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  95 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  96 +    /**</span>
  97       * Hash the tag @param name with normalizing, lowercasing, and encoding.
  98       *
  99       * @param name      {@link String} to hash as the tag kay.
 100       *
 101       * @return          {@link String} hashed to use as tag key.
 102       */
 103      public static String hashTag(String name) {
 104          try {
 105              String normalized = Normalizer.normalize(name, Normalizer.Form.NFC);
 106              String lowercased = normalized.toLowerCase(Locale.US);
 107              String encoded = URLEncoder.encode(lowercased, StandardCharsets.UTF_8.name());
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 108 -            return encoded.replace(&quot;*&quot;, &quot;%2A&quot;).replace(&quot;+&quot;, &quot;%20&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 109 +            return replaceEncoded(encoded);</span>
 110          } catch (UnsupportedEncodingException e) {
 111              // TODO: Handle encoding exception with a custom UTF-8 encoder.
 112              return name;
 113          }
 114      }
 115  
 116      /**
 117       * Determine if the hashed tag @param name is valid after normalizing, lowercasing, and encoding.
 118       *
 119       * @param name      {@link String} to hash as the tag kay.
 120       *
 121       * @return          {@link boolean} true if hashed value is valid; false otherwise.
 122       */
 123      public static boolean hashTagValid(String name) {
 124          try {
 125              String normalized = Normalizer.normalize(name, Normalizer.Form.NFC);
 126              String lowercased = normalized.toLowerCase(Locale.US);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 127 -            String encoded = URLEncoder.encode(lowercased, StandardCharsets.UTF_8.name()).replace(&quot;*&quot;, &quot;%2A&quot;).replace(&quot;+&quot;, &quot;%20&quot;);"> 127 -            String encoded = URLEncoder.encode(lowercased, StandardCharsets.UTF_8.name()).replace(&quot;*&quot;, &quot;%2A&quot;).replðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +            String encoded = replaceEncoded(URLEncoder.encode(lowercased, StandardCharsets.UTF_8.name()));</span>
 129              return encoded.length() &lt;= MAXIMUM_LENGTH_ENCODED_HASH;
 130          } catch (UnsupportedEncodingException e) {
 131              // TODO: Handle encoding exception with a custom UTF-8 encoder.
 132              return false;
 133          }
 134      }
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 135 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 136 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 137 +     * Replace certain characters in @param encoded that were not encoded with encoded value.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 138 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 139 +     * All &quot;+&quot; characters in a tag are encoded upstream and passed as &quot;%2B&quot; in {@param encoded}.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 140 +     * All &quot; &quot; characters in a tag are encoded upstream and passed as &quot;+&quot; in {@param encoded}.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 141 +     * Thus, all &quot;+&quot; in {@param encoded} should be replaced with &quot;%20&quot; as an encoded space.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +     * @param encoded   {@link String} to replace certain characters with encoded value.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 144 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +     * @return          {@link String} replaced characters with encoded values.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 146 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 147 +    private static String replaceEncoded(String encoded) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +        return encoded</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 149 +            .replace(&quot;+&quot;, &quot;%20&quot;)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +            .replace(&quot;*&quot;, &quot;%2A&quot;)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +            .replace(&quot;-&quot;, &quot;%2D&quot;)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +            .replace(&quot;.&quot;, &quot;%2E&quot;)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 153 +            .replace(&quot;_&quot;, &quot;%5F&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 154 +    }</span>
 155  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            