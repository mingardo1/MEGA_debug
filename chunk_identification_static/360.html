<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>360</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    360
                    <a href="359.html">prev</a>
                    <a href="361.html">next</a>
                    <a href="360_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    CyanogenMod/android_packages_apps_Trebuchet_7118d9dd17f51d998440f257935d6670c927383f_src/com/android/launcher3/AllAppsList.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;7118d9dd17f51d998440f257935d6670c927383f:src/com/android/launcher3/AllAppsList.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;7118d9dd17f51d998440f257935d6670c927383f^1:src/com/android/launcher3/AllAppsList.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;7118d9dd17f51d998440f257935d6670c927383f^2:src/com/android/launcher3/AllAppsList.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;58dcef7b28ec0bbc8e097b2cd45a6c6542a4cdef:src/com/android/launcher3/AllAppsList.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 /*
   2  * Copyright (C) 2008 The Android Open Source Project
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 
  17 package com.android.launcher3;
  18 
  19 import android.content.ComponentName;
  20 import android.content.Context;
  21 import android.content.Intent;
  22 import android.content.pm.ActivityInfo;
  23 import android.content.pm.PackageManager;
  24 import android.content.pm.ResolveInfo;
  25 
  26 import com.android.launcher3.compat.LauncherActivityInfoCompat;
  27 import com.android.launcher3.compat.LauncherAppsCompat;
  28 import com.android.launcher3.compat.UserHandleCompat;
  29 
  30 import java.util.ArrayList;
  31 import java.util.List;
  32 
  33 
  34 /**
  35  * Stores the list of all applications for the all apps view.
  36  */
  37 class AllAppsList {
  38     public static final int DEFAULT_APPLICATIONS_NUMBER = 42;
  39     
  40     /** The list off all apps. */
  41     public ArrayList&lt;AppInfo&gt; data =
  42             new ArrayList&lt;AppInfo&gt;(DEFAULT_APPLICATIONS_NUMBER);
  43     /** The list of apps that have been added since the last notify() call. */
  44     public ArrayList&lt;AppInfo&gt; added =
  45             new ArrayList&lt;AppInfo&gt;(DEFAULT_APPLICATIONS_NUMBER);
  46     /** The list of apps that have been removed since the last notify() call. */
  47     public ArrayList&lt;AppInfo&gt; removed = new ArrayList&lt;AppInfo&gt;();
  48     /** The list of apps that have been modified since the last notify() call. */
  49     public ArrayList&lt;AppInfo&gt; modified = new ArrayList&lt;AppInfo&gt;();
  50 
  51     private IconCache mIconCache;
  52 
  53     private AppFilter mAppFilter;
  54 
  55     /**
  56      * Boring constructor.
  57      */
  58     public AllAppsList(IconCache iconCache, AppFilter appFilter) {
  59         mIconCache = iconCache;
  60         mAppFilter = appFilter;
  61     }
  62 
  63     /**
  64      * Add the supplied ApplicationInfo objects to the list, and enqueue it into the
  65      * list to broadcast when notify() is called.
  66      *
  67      * If the app is already in the list, doesn&#x27;t add it.
  68      */
  69     public void add(AppInfo info) {
  70         if (mAppFilter != null &amp;&amp; !mAppFilter.shouldShowApp(info.componentName)) {
  71             return;
  72         }
  73         if (findActivity(data, info.componentName, info.user)) {
  74             return;
  75         }
  76         data.add(info);
  77         added.add(info);
  78     }
  79 
  80     public void clear() {
  81         data.clear();
  82         // TODO: do we clear these too?
  83         added.clear();
  84         removed.clear();
  85         modified.clear();
  86     }
  87 
  88     public int size() {
  89         return data.size();
  90     }
  91 
  92     public AppInfo get(int index) {
  93         return data.get(index);
  94     }
  95 
  96     /**
  97      * Add the icons for the supplied apk called packageName.
  98      */
  99     public void addPackage(Context context, String packageName, UserHandleCompat user) {
 100         final LauncherAppsCompat launcherApps = LauncherAppsCompat.getInstance(context);
 101         final List&lt;LauncherActivityInfoCompat&gt; matches = launcherApps.getActivityList(packageName,
 102                 user);
 103 
 104         if (matches.size() &gt; 0) {
 105             for (LauncherActivityInfoCompat info : matches) {
 106                 add(new AppInfo(context, info, user, mIconCache, null));
 107             }
 108         }
 109     }
 110 
 111     /**
 112      * Remove the apps for the given apk identified by packageName.
 113      */
 114     public void removePackage(String packageName, UserHandleCompat user) {
 115         final List&lt;AppInfo&gt; data = this.data;
 116         for (int i = data.size() - 1; i &gt;= 0; i--) {
 117             AppInfo info = data.get(i);
 118             final ComponentName component = info.intent.getComponent();
 119             if (info.user.equals(user) &amp;&amp; packageName.equals(component.getPackageName())) {
 120                 removed.add(info);
 121                 data.remove(i);
 122             }
 123         }
 124 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125         mIconCache.remove(packageName, user);</span>
 126 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127         mIconCache.remove(packageName);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131      * Add and remove icons for this package which has been updated.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133     public void updatePackage(Context context, String packageName) {</span>
 134 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135         // This is more aggressive than it needs to be.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136         mIconCache.flush();</span>
 137 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 138     }
 139 
 140     /**
 141      * Add and remove icons for this package which has been updated.
 142      */
 143     public void updatePackage(Context context, String packageName, UserHandleCompat user) {
 144         final LauncherAppsCompat launcherApps = LauncherAppsCompat.getInstance(context);
 145         final List&lt;LauncherActivityInfoCompat&gt; matches = launcherApps.getActivityList(packageName,
 146                 user);
 147         if (matches.size() &gt; 0) {
 148             // Find disabled/removed activities and remove them from data and add them
 149             // to the removed list.
 150             for (int i = data.size() - 1; i &gt;= 0; i--) {
 151                 final AppInfo applicationInfo = data.get(i);
 152                 final ComponentName component = applicationInfo.intent.getComponent();
 153                 if (user.equals(applicationInfo.user)
 154                         &amp;&amp; packageName.equals(component.getPackageName())) {
 155                     if (!findActivity(matches, component)) {
 156                         removed.add(applicationInfo);
 157                         mIconCache.remove(component, user);
 158                         data.remove(i);
 159                     }
 160                 }
 161             }
 162 
 163             // Find enabled activities and add them to the adapter
 164             // Also updates existing activities with new labels/icons
 165             int count = matches.size();
 166             for (int i = 0; i &lt; count; i++) {
 167                 final LauncherActivityInfoCompat info = matches.get(i);
 168                 AppInfo applicationInfo = findApplicationInfoLocked(
 169                         info.getComponentName().getPackageName(), user,
 170                         info.getComponentName().getClassName());
 171                 if (applicationInfo == null) {
 172                     add(new AppInfo(context, info, user, mIconCache, null));
 173                 } else {
 174                     mIconCache.remove(applicationInfo.componentName, user);
 175                     mIconCache.getTitleAndIcon(applicationInfo, info, null);
 176                     modified.add(applicationInfo);
 177                 }
 178             }
 179         } else {
 180             // Remove all data for this package.
 181             for (int i = data.size() - 1; i &gt;= 0; i--) {
 182                 final AppInfo applicationInfo = data.get(i);
 183                 final ComponentName component = applicationInfo.intent.getComponent();
 184                 if (user.equals(applicationInfo.user)
 185                         &amp;&amp; packageName.equals(component.getPackageName())) {
 186                     removed.add(applicationInfo);
 187                     mIconCache.remove(component, user);
 188                     data.remove(i);
 189                 }
 190             }
 191         }
 192     }
 193 
 194 
 195     /**
 196      * Returns whether &lt;em&gt;apps&lt;/em&gt; contains &lt;em&gt;component&lt;/em&gt;.
 197      */
 198     private static boolean findActivity(List&lt;LauncherActivityInfoCompat&gt; apps,
 199             ComponentName component) {
 200         for (LauncherActivityInfoCompat info : apps) {
 201             if (info.getComponentName().equals(component)) {
 202                 return true;
 203             }
 204         }
 205         return false;
 206     }
 207 
 208     /**
 209      * Query the launcher apps service for whether the supplied package has
 210      * MAIN/LAUNCHER activities in the supplied package.
 211      */
 212     static boolean packageHasActivities(Context context, String packageName,
 213             UserHandleCompat user) {
 214         final LauncherAppsCompat launcherApps = LauncherAppsCompat.getInstance(context);
 215         return launcherApps.getActivityList(packageName, user).size() &gt; 0;
 216     }
 217 
 218     /**
 219      * Returns whether &lt;em&gt;apps&lt;/em&gt; contains &lt;em&gt;component&lt;/em&gt;.
 220      */
 221     private static boolean findActivity(ArrayList&lt;AppInfo&gt; apps, ComponentName component,
 222             UserHandleCompat user) {
 223         final int N = apps.size();
 224         for (int i = 0; i &lt; N; i++) {
 225             final AppInfo info = apps.get(i);
 226             if (info.user.equals(user) &amp;&amp; info.componentName.equals(component)) {
 227                 return true;
 228             }
 229         }
 230         return false;
 231     }
 232 
 233     /**
 234      * Find an ApplicationInfo object for the given packageName and className.
 235      */
 236     private AppInfo findApplicationInfoLocked(String packageName, UserHandleCompat user,
 237             String className) {
 238         for (AppInfo info: data) {
 239             final ComponentName component = info.intent.getComponent();
 240             if (user.equals(info.user) &amp;&amp; packageName.equals(component.getPackageName())
 241                     &amp;&amp; className.equals(component.getClassName())) {
 242                 return info;
 243             }
 244         }
 245         return null;
 246     }
 247 }</pre></td>
                            <td><pre>   1 /*
   2  * Copyright (C) 2008 The Android Open Source Project
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 
  17 package com.android.launcher3;
  18 
  19 import android.content.ComponentName;
  20 import android.content.Context;
  21 import android.content.Intent;
  22 import android.content.pm.ActivityInfo;
  23 import android.content.pm.PackageManager;
  24 import android.content.pm.ResolveInfo;
  25 
  26 import com.android.launcher3.compat.LauncherActivityInfoCompat;
  27 import com.android.launcher3.compat.LauncherAppsCompat;
  28 import com.android.launcher3.compat.UserHandleCompat;
  29 
  30 import java.util.ArrayList;
  31 import java.util.List;
  32 
  33 
  34 /**
  35  * Stores the list of all applications for the all apps view.
  36  */
  37 class AllAppsList {
  38     public static final int DEFAULT_APPLICATIONS_NUMBER = 42;
  39 
  40     /** The list off all apps. */
  41     public ArrayList&lt;AppInfo&gt; data =
  42             new ArrayList&lt;AppInfo&gt;(DEFAULT_APPLICATIONS_NUMBER);
  43     /** The list of apps that have been added since the last notify() call. */
  44     public ArrayList&lt;AppInfo&gt; added =
  45             new ArrayList&lt;AppInfo&gt;(DEFAULT_APPLICATIONS_NUMBER);
  46     /** The list of apps that have been removed since the last notify() call. */
  47     public ArrayList&lt;AppInfo&gt; removed = new ArrayList&lt;AppInfo&gt;();
  48     /** The list of apps that have been modified since the last notify() call. */
  49     public ArrayList&lt;AppInfo&gt; modified = new ArrayList&lt;AppInfo&gt;();
  50 
  51     private IconCache mIconCache;
  52 
  53     private AppFilter mAppFilter;
  54 
  55     /**
  56      * Boring constructor.
  57      */
  58     public AllAppsList(IconCache iconCache, AppFilter appFilter) {
  59         mIconCache = iconCache;
  60         mAppFilter = appFilter;
  61     }
  62 
  63     /**
  64      * Add the supplied ApplicationInfo objects to the list, and enqueue it into the
  65      * list to broadcast when notify() is called.
  66      *
  67      * If the app is already in the list, doesn&#x27;t add it.
  68      */
  69     public void add(AppInfo info) {
  70         if (mAppFilter != null &amp;&amp; !mAppFilter.shouldShowApp(info.componentName)) {
  71             return;
  72         }
  73         if (findActivity(data, info.componentName, info.user)) {
  74             return;
  75         }
  76         data.add(info);
  77         added.add(info);
  78     }
  79 
  80     public void clear() {
  81         data.clear();
  82         // TODO: do we clear these too?
  83         added.clear();
  84         removed.clear();
  85         modified.clear();
  86     }
  87 
  88     public int size() {
  89         return data.size();
  90     }
  91 
  92     public AppInfo get(int index) {
  93         return data.get(index);
  94     }
  95 
  96     /**
  97      * Add the icons for the supplied apk called packageName.
  98      */
  99     public void addPackage(Context context, String packageName, UserHandleCompat user) {
 100         final LauncherAppsCompat launcherApps = LauncherAppsCompat.getInstance(context);
 101         final List&lt;LauncherActivityInfoCompat&gt; matches = launcherApps.getActivityList(packageName,
 102                 user);
 103 
 104         if (matches.size() &gt; 0) {
 105             for (LauncherActivityInfoCompat info : matches) {
 106                 add(new AppInfo(context, info, user, mIconCache, null));
 107             }
 108         }
 109     }
 110 
 111     /**
 112      * Remove the apps for the given apk identified by packageName.
 113      */
 114     public void removePackage(String packageName, UserHandleCompat user) {
 115         final List&lt;AppInfo&gt; data = this.data;
 116         for (int i = data.size() - 1; i &gt;= 0; i--) {
 117             AppInfo info = data.get(i);
 118             final ComponentName component = info.intent.getComponent();
 119             if (info.user.equals(user) &amp;&amp; packageName.equals(component.getPackageName())) {
 120                 removed.add(info);
 121                 data.remove(i);
 122             }
 123         }
 124         mIconCache.remove(packageName, user);
 125     }
 126 
 127     /**
 128      * Add and remove icons for this package which has been updated.
 129      */
 130     public void updatePackage(Context context, String packageName, UserHandleCompat user) {
 131         final LauncherAppsCompat launcherApps = LauncherAppsCompat.getInstance(context);
 132         final List&lt;LauncherActivityInfoCompat&gt; matches = launcherApps.getActivityList(packageName,
 133                 user);
 134         if (matches.size() &gt; 0) {
 135             // Find disabled/removed activities and remove them from data and add them
 136             // to the removed list.
 137             for (int i = data.size() - 1; i &gt;= 0; i--) {
 138                 final AppInfo applicationInfo = data.get(i);
 139                 final ComponentName component = applicationInfo.intent.getComponent();
 140                 if (user.equals(applicationInfo.user)
 141                         &amp;&amp; packageName.equals(component.getPackageName())) {
 142                     if (!findActivity(matches, component)) {
 143                         removed.add(applicationInfo);
 144                         mIconCache.remove(component, user);
 145                         data.remove(i);
 146                     }
 147                 }
 148             }
 149 
 150             // Find enabled activities and add them to the adapter
 151             // Also updates existing activities with new labels/icons
 152             int count = matches.size();
 153             for (int i = 0; i &lt; count; i++) {
 154                 final LauncherActivityInfoCompat info = matches.get(i);
 155                 AppInfo applicationInfo = findApplicationInfoLocked(
 156                         info.getComponentName().getPackageName(), user,
 157                         info.getComponentName().getClassName());
 158                 if (applicationInfo == null) {
 159                     add(new AppInfo(context, info, user, mIconCache, null));
 160                 } else {
 161                     mIconCache.remove(applicationInfo.componentName, user);
 162                     mIconCache.getTitleAndIcon(applicationInfo, info, null);
 163                     modified.add(applicationInfo);
 164                 }
 165             }
 166         } else {
 167             // Remove all data for this package.
 168             for (int i = data.size() - 1; i &gt;= 0; i--) {
 169                 final AppInfo applicationInfo = data.get(i);
 170                 final ComponentName component = applicationInfo.intent.getComponent();
 171                 if (user.equals(applicationInfo.user)
 172                         &amp;&amp; packageName.equals(component.getPackageName())) {
 173                     removed.add(applicationInfo);
 174                     mIconCache.remove(component, user);
 175                     data.remove(i);
 176                 }
 177             }
 178         }
 179     }
 180 
 181 
 182     /**
 183      * Returns whether &lt;em&gt;apps&lt;/em&gt; contains &lt;em&gt;component&lt;/em&gt;.
 184      */
 185     private static boolean findActivity(List&lt;LauncherActivityInfoCompat&gt; apps,
 186             ComponentName component) {
 187         for (LauncherActivityInfoCompat info : apps) {
 188             if (info.getComponentName().equals(component)) {
 189                 return true;
 190             }
 191         }
 192         return false;
 193     }
 194 
 195     /**
 196      * Query the launcher apps service for whether the supplied package has
 197      * MAIN/LAUNCHER activities in the supplied package.
 198      */
 199     static boolean packageHasActivities(Context context, String packageName,
 200             UserHandleCompat user) {
 201         final LauncherAppsCompat launcherApps = LauncherAppsCompat.getInstance(context);
 202         return launcherApps.getActivityList(packageName, user).size() &gt; 0;
 203     }
 204 
 205     /**
 206      * Returns whether &lt;em&gt;apps&lt;/em&gt; contains &lt;em&gt;component&lt;/em&gt;.
 207      */
 208     private static boolean findActivity(ArrayList&lt;AppInfo&gt; apps, ComponentName component,
 209             UserHandleCompat user) {
 210         final int N = apps.size();
 211         for (int i = 0; i &lt; N; i++) {
 212             final AppInfo info = apps.get(i);
 213             if (info.user.equals(user) &amp;&amp; info.componentName.equals(component)) {
 214                 return true;
 215             }
 216         }
 217         return false;
 218     }
 219 
 220     /**
 221      * Find an ApplicationInfo object for the given packageName and className.
 222      */
 223     private AppInfo findApplicationInfoLocked(String packageName, UserHandleCompat user,
 224             String className) {
 225         for (AppInfo info: data) {
 226             final ComponentName component = info.intent.getComponent();
 227             if (user.equals(info.user) &amp;&amp; packageName.equals(component.getPackageName())
 228                     &amp;&amp; className.equals(component.getClassName())) {
 229                 return info;
 230             }
 231         }
 232         return null;
 233     }
 234 }
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 /*
   2  * Copyright (C) 2008 The Android Open Source Project
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package com.android.launcher3;
  17 
  18 import android.content.ComponentName;
  19 import android.content.Context;
  20 import android.content.Intent;
  21 import android.content.pm.ActivityInfo;
  22 import android.content.pm.PackageManager;
  23 import android.content.pm.ResolveInfo;
  24 import com.android.launcher3.compat.LauncherActivityInfoCompat;
  25 import com.android.launcher3.compat.LauncherAppsCompat;
  26 import com.android.launcher3.compat.UserHandleCompat;
  27 import java.util.ArrayList;
  28 import java.util.List;
  29 
  30 
  31 /**
  32  * Stores the list of all applications for the all apps view.
  33  */
  34 class AllAppsList {
  35     public static final int DEFAULT_APPLICATIONS_NUMBER = 42;
  36 
  37     /** The list off all apps. */
  38     public ArrayList&lt;AppInfo&gt; data =
  39             new ArrayList&lt;AppInfo&gt;(DEFAULT_APPLICATIONS_NUMBER);
  40 
  41     /** The list of apps that have been added since the last notify() call. */
  42     public ArrayList&lt;AppInfo&gt; added =
  43             new ArrayList&lt;AppInfo&gt;(DEFAULT_APPLICATIONS_NUMBER);
  44 
  45     /** The list of apps that have been removed since the last notify() call. */
  46     public ArrayList&lt;AppInfo&gt; removed = new ArrayList&lt;AppInfo&gt;();
  47 
  48     /** The list of apps that have been modified since the last notify() call. */
  49     public ArrayList&lt;AppInfo&gt; modified = new ArrayList&lt;AppInfo&gt;();
  50 
  51     private IconCache mIconCache;
  52 
  53     private AppFilter mAppFilter;
  54 
  55     /**
  56      * Boring constructor.
  57      */
  58     public AllAppsList(IconCache iconCache, AppFilter appFilter) {
  59         mIconCache = iconCache;
  60         mAppFilter = appFilter;
  61     }
  62 
  63     /**
  64      * Add the supplied ApplicationInfo objects to the list, and enqueue it into the
  65      * list to broadcast when notify() is called.
  66      *
  67      * If the app is already in the list, doesn&#x27;t add it.
  68      */
  69     public void add(AppInfo info) {
  70         if ((mAppFilter != null) &amp;&amp; (!mAppFilter.shouldShowApp(info.componentName))) {
  71             return;
  72         }
  73         if (findActivity(data, info.componentName, info.user)) {
  74             return;
  75         }
  76         data.add(info);
  77         added.add(info);
  78     }
  79 
  80     public void clear() {
  81         data.clear();
  82         // TODO: do we clear these too?
  83         added.clear();
  84         removed.clear();
  85         modified.clear();
  86     }
  87 
  88     public int size() {
  89         return data.size();
  90     }
  91 
  92     public AppInfo get(int index) {
  93         return data.get(index);
  94     }
  95 
  96     /**
  97      * Add the icons for the supplied apk called packageName.
  98      */
  99     public void addPackage(Context context, String packageName, UserHandleCompat user) {
 100         final LauncherAppsCompat launcherApps = LauncherAppsCompat.getInstance(context);
 101         final List&lt;LauncherActivityInfoCompat&gt; matches = launcherApps.getActivityList(packageName, user);
 102         if (matches.size() &gt; 0) {
 103             for (LauncherActivityInfoCompat info : matches) {
 104                 add(new AppInfo(context, info, user, mIconCache, null));
 105             }
 106         }
 107     }
 108 
 109     /**
 110      * Remove the apps for the given apk identified by packageName.
 111      */
 112     public void removePackage(String packageName, UserHandleCompat user) {
 113         final List&lt;AppInfo&gt; data = this.data;
 114         for (int i = data.size() - 1; i &gt;= 0; i--) {
 115             AppInfo info = data.get(i);
 116             final ComponentName component = info.intent.getComponent();
 117             if (info.user.equals(user) &amp;&amp; packageName.equals(component.getPackageName())) {
 118                 removed.add(info);
 119                 data.remove(i);
 120             }
 121         }
 122         mIconCache.remove(packageName, user);
 123     }
 124 
 125     /**
 126      * Add and remove icons for this package which has been updated.
 127      */
 128     public void updatePackage(Context context, String packageName, UserHandleCompat user) {
 129         final LauncherAppsCompat launcherApps = LauncherAppsCompat.getInstance(context);
 130         final List&lt;LauncherActivityInfoCompat&gt; matches = launcherApps.getActivityList(packageName, user);
 131         if (matches.size() &gt; 0) {
 132             // Find disabled/removed activities and remove them from data and add them
 133             // to the removed list.
 134             for (int i = data.size() - 1; i &gt;= 0; i--) {
 135                 final AppInfo applicationInfo = data.get(i);
 136                 final ComponentName component = applicationInfo.intent.getComponent();
<abbr title=" 137                 if (user.equals(applicationInfo.user) &amp;&amp; packageName.equals(component.getPackageName())) {"> 137                 if (user.equals(applicationInfo.user) &amp;&amp; packageName.equals(component.getPackageName())) ðŸ”µ</abbr>
 138                     if (!findActivity(matches, component)) {
 139                         removed.add(applicationInfo);
 140                         mIconCache.remove(component, user);
 141                         data.remove(i);
 142                     }
 143                 }
 144             }
 145             // Find enabled activities and add them to the adapter
 146             // Also updates existing activities with new labels/icons
 147             int count = matches.size();
 148             for (int i = 0; i &lt; count; i++) {
 149                 final LauncherActivityInfoCompat info = matches.get(i);
<abbr title=" 150                 AppInfo applicationInfo = findApplicationInfoLocked(info.getComponentName().getPackageName(), user, info.getComponentName().getClassName());"> 150                 AppInfo applicationInfo = findApplicationInfoLocked(info.getComponentName().getPackageNamðŸ”µ</abbr>
 151                 if (applicationInfo == null) {
 152                     add(new AppInfo(context, info, user, mIconCache, null));
 153                 } else {
 154                     mIconCache.remove(applicationInfo.componentName, user);
 155                     mIconCache.getTitleAndIcon(applicationInfo, info, null);
 156                     modified.add(applicationInfo);
 157                 }
 158             }
 159         } else {
 160             // Remove all data for this package.
 161             for (int i = data.size() - 1; i &gt;= 0; i--) {
 162                 final AppInfo applicationInfo = data.get(i);
 163                 final ComponentName component = applicationInfo.intent.getComponent();
<abbr title=" 164                 if (user.equals(applicationInfo.user) &amp;&amp; packageName.equals(component.getPackageName())) {"> 164                 if (user.equals(applicationInfo.user) &amp;&amp; packageName.equals(component.getPackageName())) ðŸ”µ</abbr>
 165                     removed.add(applicationInfo);
 166                     mIconCache.remove(component, user);
 167                     data.remove(i);
 168                 }
 169             }
 170         }
 171     }
 172 
 173     /**
 174      * Returns whether &lt;em&gt;apps&lt;/em&gt; contains &lt;em&gt;component&lt;/em&gt;.
 175      */
 176     private static boolean findActivity(List&lt;LauncherActivityInfoCompat&gt; apps, ComponentName component) {
 177         for (LauncherActivityInfoCompat info : apps) {
 178             if (info.getComponentName().equals(component)) {
 179                 return true;
 180             }
 181         }
 182         return false;
 183     }
 184 
 185     /**
 186      * Query the launcher apps service for whether the supplied package has
 187      * MAIN/LAUNCHER activities in the supplied package.
 188      */
 189     static boolean packageHasActivities(Context context, String packageName, UserHandleCompat user) {
 190         final LauncherAppsCompat launcherApps = LauncherAppsCompat.getInstance(context);
 191         return launcherApps.getActivityList(packageName, user).size() &gt; 0;
 192     }
 193 
 194     /**
 195      * Returns whether &lt;em&gt;apps&lt;/em&gt; contains &lt;em&gt;component&lt;/em&gt;.
 196      */
<abbr title=" 197     private static boolean findActivity(ArrayList&lt;AppInfo&gt; apps, ComponentName component, UserHandleCompat user) {"> 197     private static boolean findActivity(ArrayList&lt;AppInfo&gt; apps, ComponentName component, UserHandleCompaðŸ”µ</abbr>
 198         final int N = apps.size();
 199         for (int i = 0; i &lt; N; i++) {
 200             final AppInfo info = apps.get(i);
 201             if (info.user.equals(user) &amp;&amp; info.componentName.equals(component)) {
 202                 return true;
 203             }
 204         }
 205         return false;
 206     }
 207 
 208     /**
 209      * Find an ApplicationInfo object for the given packageName and className.
 210      */
<abbr title=" 211     private AppInfo findApplicationInfoLocked(String packageName, UserHandleCompat user, String className) {"> 211     private AppInfo findApplicationInfoLocked(String packageName, UserHandleCompat user, String classNameðŸ”µ</abbr>
 212         for (AppInfo info : data) {
 213             final ComponentName component = info.intent.getComponent();
<abbr title=" 214             if ((user.equals(info.user) &amp;&amp; packageName.equals(component.getPackageName())) &amp;&amp; className.equals(component.getClassName())) {"> 214             if ((user.equals(info.user) &amp;&amp; packageName.equals(component.getPackageName())) &amp;&amp; className.eðŸ”µ</abbr>
 215                 return info;
 216             }
 217         }
 218         return null;
 219     }
 220 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  /*
   2   * Copyright (C) 2008 The Android Open Source Project
   3   *
   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5   * you may not use this file except in compliance with the License.
   6   * You may obtain a copy of the License at
   7   *
   8   *      http://www.apache.org/licenses/LICENSE-2.0
   9   *
  10   * Unless required by applicable law or agreed to in writing, software
  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13   * See the License for the specific language governing permissions and
  14   * limitations under the License.
  15   */
  16  
  17  package com.android.launcher3;
  18  
  19  import android.content.ComponentName;
  20  import android.content.Context;
  21  import android.content.Intent;
  22  import android.content.pm.ActivityInfo;
  23  import android.content.pm.PackageManager;
  24  import android.content.pm.ResolveInfo;
  25  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  26 +import com.android.launcher3.compat.LauncherActivityInfoCompat;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  27 +import com.android.launcher3.compat.LauncherAppsCompat;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  28 +import com.android.launcher3.compat.UserHandleCompat;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  29 +</span>
  30  import java.util.ArrayList;
  31  import java.util.List;
  32  
  33  
  34  /**
  35   * Stores the list of all applications for the all apps view.
  36   */
  37  class AllAppsList {
  38      public static final int DEFAULT_APPLICATIONS_NUMBER = 42;
  39  
  40      /** The list off all apps. */
  41      public ArrayList&lt;AppInfo&gt; data =
  42              new ArrayList&lt;AppInfo&gt;(DEFAULT_APPLICATIONS_NUMBER);
  43      /** The list of apps that have been added since the last notify() call. */
  44      public ArrayList&lt;AppInfo&gt; added =
  45              new ArrayList&lt;AppInfo&gt;(DEFAULT_APPLICATIONS_NUMBER);
  46      /** The list of apps that have been removed since the last notify() call. */
  47      public ArrayList&lt;AppInfo&gt; removed = new ArrayList&lt;AppInfo&gt;();
  48      /** The list of apps that have been modified since the last notify() call. */
  49      public ArrayList&lt;AppInfo&gt; modified = new ArrayList&lt;AppInfo&gt;();
  50  
  51      private IconCache mIconCache;
  52  
  53      private AppFilter mAppFilter;
  54  
  55      /**
  56       * Boring constructor.
  57       */
  58      public AllAppsList(IconCache iconCache, AppFilter appFilter) {
  59          mIconCache = iconCache;
  60          mAppFilter = appFilter;
  61      }
  62  
  63      /**
  64       * Add the supplied ApplicationInfo objects to the list, and enqueue it into the
  65       * list to broadcast when notify() is called.
  66       *
  67       * If the app is already in the list, doesn&#x27;t add it.
  68       */
  69      public void add(AppInfo info) {
  70          if (mAppFilter != null &amp;&amp; !mAppFilter.shouldShowApp(info.componentName)) {
  71              return;
  72          }
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  73 -        if (findActivity(data, info.componentName)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  74 +        if (findActivity(data, info.componentName, info.user)) {</span>
  75              return;
  76          }
  77          data.add(info);
  78          added.add(info);
  79      }
  80  
  81      public void clear() {
  82          data.clear();
  83          // TODO: do we clear these too?
  84          added.clear();
  85          removed.clear();
  86          modified.clear();
  87      }
  88  
  89      public int size() {
  90          return data.size();
  91      }
  92  
  93      public AppInfo get(int index) {
  94          return data.get(index);
  95      }
  96  
  97      /**
  98       * Add the icons for the supplied apk called packageName.
  99       */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 100 -    public void addPackage(Context context, String packageName) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 101 -        final List&lt;ResolveInfo&gt; matches = findActivitiesForPackage(context, packageName);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +    public void addPackage(Context context, String packageName, UserHandleCompat user) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 103 +        final LauncherAppsCompat launcherApps = LauncherAppsCompat.getInstance(context);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +        final List&lt;LauncherActivityInfoCompat&gt; matches = launcherApps.getActivityList(packageName,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +                user);</span>
 106  
 107          if (matches.size() &gt; 0) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 108 -            for (ResolveInfo info : matches) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 109 -                add(new AppInfo(context.getPackageManager(), info, mIconCache, null));</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 110 +            for (LauncherActivityInfoCompat info : matches) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 111 +                add(new AppInfo(context, info, user, mIconCache, null));</span>
 112              }
 113          }
 114      }
 115  
 116      /**
 117       * Remove the apps for the given apk identified by packageName.
 118       */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 119 -    public void removePackage(String packageName) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +    public void removePackage(String packageName, UserHandleCompat user) {</span>
 121          final List&lt;AppInfo&gt; data = this.data;
 122          for (int i = data.size() - 1; i &gt;= 0; i--) {
 123              AppInfo info = data.get(i);
 124              final ComponentName component = info.intent.getComponent();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 125 -            if (packageName.equals(component.getPackageName())) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +            if (info.user.equals(user) &amp;&amp; packageName.equals(component.getPackageName())) {</span>
 127                  removed.add(info);
 128                  data.remove(i);
 129              }
 130          }
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 131 -        // This is more aggressive than it needs to be.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 132 -        mIconCache.flush();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 133 +        mIconCache.remove(packageName, user);</span>
 134      }
 135  
 136      /**
 137       * Add and remove icons for this package which has been updated.
 138       */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 139 -    public void updatePackage(Context context, String packageName) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 140 -        final List&lt;ResolveInfo&gt; matches = findActivitiesForPackage(context, packageName);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 141 +    public void updatePackage(Context context, String packageName, UserHandleCompat user) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +        final LauncherAppsCompat launcherApps = LauncherAppsCompat.getInstance(context);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +        final List&lt;LauncherActivityInfoCompat&gt; matches = launcherApps.getActivityList(packageName,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 144 +                user);</span>
 145          if (matches.size() &gt; 0) {
 146              // Find disabled/removed activities and remove them from data and add them
 147              // to the removed list.
 148              for (int i = data.size() - 1; i &gt;= 0; i--) {
 149                  final AppInfo applicationInfo = data.get(i);
 150                  final ComponentName component = applicationInfo.intent.getComponent();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 151 -                if (packageName.equals(component.getPackageName())) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +                if (user.equals(applicationInfo.user)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 153 +                        &amp;&amp; packageName.equals(component.getPackageName())) {</span>
 154                      if (!findActivity(matches, component)) {
 155                          removed.add(applicationInfo);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 156 -                        mIconCache.remove(component);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 157 +                        mIconCache.remove(component, user);</span>
 158                          data.remove(i);
 159                      }
 160                  }
 161              }
 162  
 163              // Find enabled activities and add them to the adapter
 164              // Also updates existing activities with new labels/icons
 165              int count = matches.size();
 166              for (int i = 0; i &lt; count; i++) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 167 -                final ResolveInfo info = matches.get(i);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 168 +                final LauncherActivityInfoCompat info = matches.get(i);</span>
 169                  AppInfo applicationInfo = findApplicationInfoLocked(
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 170 -                        info.activityInfo.applicationInfo.packageName,</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 171 -                        info.activityInfo.name);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 172 +                        info.getComponentName().getPackageName(), user,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 173 +                        info.getComponentName().getClassName());</span>
 174                  if (applicationInfo == null) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 175 -                    add(new AppInfo(context.getPackageManager(), info, mIconCache, null));</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +                    add(new AppInfo(context, info, user, mIconCache, null));</span>
 177                  } else {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 178 -                    mIconCache.remove(applicationInfo.componentName);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 179 +                    mIconCache.remove(applicationInfo.componentName, user);</span>
 180                      mIconCache.getTitleAndIcon(applicationInfo, info, null);
 181                      modified.add(applicationInfo);
 182                  }
 183              }
 184          } else {
 185              // Remove all data for this package.
 186              for (int i = data.size() - 1; i &gt;= 0; i--) {
 187                  final AppInfo applicationInfo = data.get(i);
 188                  final ComponentName component = applicationInfo.intent.getComponent();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 189 -                if (packageName.equals(component.getPackageName())) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 190 +                if (user.equals(applicationInfo.user)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 191 +                        &amp;&amp; packageName.equals(component.getPackageName())) {</span>
 192                      removed.add(applicationInfo);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 193 -                    mIconCache.remove(component);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 194 +                    mIconCache.remove(component, user);</span>
 195                      data.remove(i);
 196                  }
 197              }
 198          }
 199      }
 200  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 201 -    /**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 202 -     * Query the package manager for MAIN/LAUNCHER activities in the supplied package.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 203 -     */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 204 -    static List&lt;ResolveInfo&gt; findActivitiesForPackage(Context context, String packageName) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 205 -        final PackageManager packageManager = context.getPackageManager();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 206 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 207 -        final Intent mainIntent = new Intent(Intent.ACTION_MAIN, null);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 208 -        mainIntent.addCategory(Intent.CATEGORY_LAUNCHER);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 209 -        mainIntent.setPackage(packageName);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 210 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 211 -        final List&lt;ResolveInfo&gt; apps = packageManager.queryIntentActivities(mainIntent, 0);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 212 -        return apps != null ? apps : new ArrayList&lt;ResolveInfo&gt;();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 213 -    }</span>
 214  
 215      /**
 216       * Returns whether &lt;em&gt;apps&lt;/em&gt; contains &lt;em&gt;component&lt;/em&gt;.
 217       */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 218 -    private static boolean findActivity(List&lt;ResolveInfo&gt; apps, ComponentName component) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 219 -        final String className = component.getClassName();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 220 -        for (ResolveInfo info : apps) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 221 -            final ActivityInfo activityInfo = info.activityInfo;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 222 -            if (activityInfo.name.equals(className)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +    private static boolean findActivity(List&lt;LauncherActivityInfoCompat&gt; apps,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 224 +            ComponentName component) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 225 +        for (LauncherActivityInfoCompat info : apps) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 226 +            if (info.getComponentName().equals(component)) {</span>
 227                  return true;
 228              }
 229          }
 230          return false;
 231      }
 232  
 233      /**
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 234 +     * Query the launcher apps service for whether the supplied package has</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 235 +     * MAIN/LAUNCHER activities in the supplied package.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 236 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 237 +    static boolean packageHasActivities(Context context, String packageName,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 238 +            UserHandleCompat user) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 239 +        final LauncherAppsCompat launcherApps = LauncherAppsCompat.getInstance(context);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 240 +        return launcherApps.getActivityList(packageName, user).size() &gt; 0;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 243 +    /**</span>
 244       * Returns whether &lt;em&gt;apps&lt;/em&gt; contains &lt;em&gt;component&lt;/em&gt;.
 245       */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 246 -    private static boolean findActivity(ArrayList&lt;AppInfo&gt; apps, ComponentName component) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 247 +    private static boolean findActivity(ArrayList&lt;AppInfo&gt; apps, ComponentName component,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 248 +            UserHandleCompat user) {</span>
 249          final int N = apps.size();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 250 -        for (int i=0; i&lt;N; i++) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +        for (int i = 0; i &lt; N; i++) {</span>
 252              final AppInfo info = apps.get(i);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 253 -            if (info.componentName.equals(component)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 254 +            if (info.user.equals(user) &amp;&amp; info.componentName.equals(component)) {</span>
 255                  return true;
 256              }
 257          }
 258          return false;
 259      }
 260  
 261      /**
 262       * Find an ApplicationInfo object for the given packageName and className.
 263       */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 264 -    private AppInfo findApplicationInfoLocked(String packageName, String className) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 265 +    private AppInfo findApplicationInfoLocked(String packageName, UserHandleCompat user,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 266 +            String className) {</span>
 267          for (AppInfo info: data) {
 268              final ComponentName component = info.intent.getComponent();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 269 -            if (packageName.equals(component.getPackageName())</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 270 +            if (user.equals(info.user) &amp;&amp; packageName.equals(component.getPackageName())</span>
 271                      &amp;&amp; className.equals(component.getClassName())) {
 272                  return info;
 273              }
 274          }
 275          return null;
 276      }
 277  }</pre></td>
                            <td><pre></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            