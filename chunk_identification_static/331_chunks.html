<!DOCTYPE html>
<html lang="en">
          <head>
            <meta charset="utf-8">
            <title>331 chunks</title>
                <style>
                    #top {
                        height: 48vh;
                        overflow-y: auto;
                    }
                    #bottom {
                        height: 48vh;
                        overflow-y: auto;
                    }
                </style>
          </head>
          <body>
            <pre>[[{&#x27;eq&#x27;: [{&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;package com.automattic.simplenote;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import android.app.ActionBar;\n&#x27;
                           &#x27;import android.app.Activity;\n&#x27;
                           &#x27;import android.app.AlertDialog;\n&#x27;
                           &#x27;import android.app.FragmentManager;\n&#x27;
                           &#x27;import android.app.FragmentTransaction;\n&#x27;
                           &#x27;import android.content.DialogInterface;\n&#x27;
                           &#x27;import android.content.Intent;\n&#x27;
                           &#x27;import android.content.res.Configuration;\n&#x27;
                           &#x27;import android.os.AsyncTask;\n&#x27;
                           &#x27;import android.os.Bundle;\n&#x27;
                           &#x27;import android.os.Parcelable;\n&#x27;
                           &#x27;import android.view.Menu;\n&#x27;
                           &#x27;import android.view.MenuInflater;\n&#x27;
                           &#x27;import android.view.MenuItem;\n&#x27;
                           &#x27;import android.widget.SearchView;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.automattic.simplenote.models.Note;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.automattic.simplenote.utils.UndoBarController;\n&#x27;
                           &#x27;import com.simperium.Simperium;\n&#x27;
                           &#x27;import com.simperium.client.Bucket;\n&#x27;
                           &#x27;import com.simperium.client.LoginActivity;\n&#x27;
                           &#x27;import com.simperium.client.Query;\n&#x27;
                           &#x27;import com.simperium.client.User;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.util.Calendar;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * An activity representing a list of Notes.\n&#x27;
                           &#x27; * &lt;p/&gt;\n&#x27;
                           &#x27; * The activity makes heavy use of fragments. The &#x27;
                           &#x27;list of items is a\n&#x27;
                           &#x27; * {@link NoteListFragment} and the item details &#x27;
                           &#x27;(if present) is a\n&#x27;
                           &#x27; * {@link NoteEditorFragment}.\n&#x27;
                           &#x27; * &lt;p/&gt;\n&#x27;
                           &#x27; * This activity also implements the required &#x27;
                           &#x27;{@link NoteListFragment.Callbacks}\n&#x27;
                           &#x27; * interface to listen for item selections.\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;public class NotesActivity extends Activity &#x27;
                           &#x27;implements\n&#x27;
                           &#x27;        NoteListFragment.Callbacks, &#x27;
                           &#x27;ActionBar.OnNavigationListener,\n&#x27;
                           &#x27;        User.AuthenticationListener, &#x27;
                           &#x27;UndoBarController.UndoListener,\n&#x27;
                           &#x27;        &#x27;
                           &#x27;FragmentManager.OnBackStackChangedListener, &#x27;
                           &#x27;Bucket.Listener&lt;Note&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private boolean mIsLargeScreen, mIsLandscape;\n&#x27;
                           &#x27;    private UndoBarController mUndoBarController;\n&#x27;
                           &#x27;    private SearchView mSearchView;\n&#x27;
                           &#x27;    private MenuItem mSearchMenuItem;\n&#x27;
                           &#x27;    private NoteListFragment mNoteListFragment;\n&#x27;
                           &#x27;    private NoteEditorFragment &#x27;
                           &#x27;mNoteEditorFragment;\n&#x27;
                           &#x27;    private Note mCurrentNote;\n&#x27;
                           &#x27;    private Bucket&lt;Note&gt; mNotesBucket;\n&#x27;
                           &#x27;    private int TRASH_SELECTED_ID = 1;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static String TAG_NOTE_LIST = &#x27;
                           &#x27;&quot;noteList&quot;;\n&#x27;
                           &#x27;    public static String TAG_NOTE_EDITOR = &#x27;
                           &#x27;&quot;noteEditor&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onCreate(Bundle &#x27;
                           &#x27;savedInstanceState) {\n&#x27;
                           &#x27;        super.onCreate(savedInstanceState);\n&#x27;
                           &#x27;        Simplenote currentApp = (Simplenote) &#x27;
                           &#x27;getApplication();\n&#x27;
                           &#x27;        mNotesBucket = &#x27;
                           &#x27;currentApp.getNotesBucket();\n&#x27;
                           &#x27;        setContentView(R.layout.activity_notes);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (savedInstanceState == null) {\n&#x27;
                           &#x27;            mNoteListFragment = new &#x27;
                           &#x27;NoteListFragment();\n&#x27;
                           &#x27;            FragmentTransaction &#x27;
                           &#x27;fragmentTransaction = &#x27;
                           &#x27;getFragmentManager().beginTransaction();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;fragmentTransaction.add(R.id.noteFragmentContainer, &#x27;
                           &#x27;mNoteListFragment, TAG_NOTE_LIST);\n&#x27;
                           &#x27;            fragmentTransaction.commit();\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            mNoteListFragment = (NoteListFragment) &#x27;
                           &#x27;getFragmentManager().findFragmentByTag(TAG_NOTE_LIST);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Configuration config = &#x27;
                           &#x27;getBaseContext().getResources().getConfiguration();\n&#x27;
                           &#x27;        if ((config.screenLayout\n&#x27;
                           &#x27;                &amp; &#x27;
                           &#x27;Configuration.SCREENLAYOUT_SIZE_MASK)\n&#x27;
                           &#x27;                &gt;= &#x27;
                           &#x27;Configuration.SCREENLAYOUT_SIZE_LARGE) {\n&#x27;
                           &#x27;            mIsLargeScreen = true;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR) &#x27;
                           &#x27;!= null) {\n&#x27;
                           &#x27;                mNoteEditorFragment = &#x27;
                           &#x27;(NoteEditorFragment) &#x27;
                           &#x27;getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR);\n&#x27;
                           &#x27;            } else if (config.orientation == &#x27;
                           &#x27;Configuration.ORIENTATION_LANDSCAPE) {\n&#x27;
                           &#x27;                mIsLandscape = true;\n&#x27;
                           &#x27;                addEditorFragment();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        ActionBar ab = getActionBar();\n&#x27;
                           &#x27;        &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);\n&#x27;
                           &#x27;        ab.setDisplayShowTitleEnabled(false);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mUndoBarController = new &#x27;
                           &#x27;UndoBarController(findViewById(R.id.undobar), &#x27;
                           &#x27;this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;getFragmentManager().addOnBackStackChangedListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (currentApp.getSimperium().getUser() == &#x27;
                           &#x27;null || &#x27;
                           &#x27;currentApp.getSimperium().getUser().needsAuthentication()) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            startLoginActivity();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        &#x27;
                           &#x27;currentApp.getSimperium().setAuthenticationListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(Intent.ACTION_SEND.equals(getIntent().getAction())) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            // Check share action\n&#x27;
                           &#x27;            Intent intent = getIntent();\n&#x27;
                           &#x27;            String text = &#x27;
                           &#x27;intent.getStringExtra(Intent.EXTRA_TEXT);\n&#x27;
                           &#x27;            if (text != null) {\n&#x27;
                           &#x27;                Note note = &#x27;
                           &#x27;mNotesBucket.newObject();\n&#x27;
                           &#x27;                note.setContent(text);\n&#x27;
                           &#x27;                note.save();\n&#x27;
                           &#x27;                onNoteSelected(note);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private void addEditorFragment() {\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;        FragmentTransaction ft = &#x27;
                           &#x27;fm.beginTransaction();\n&#x27;
                           &#x27;        mNoteEditorFragment = new &#x27;
                           &#x27;NoteEditorFragment();\n&#x27;
                           &#x27;        ft.add(R.id.noteFragmentContainer, &#x27;
                           &#x27;mNoteEditorFragment, TAG_NOTE_EDITOR);\n&#x27;
                           &#x27;        ft.commit();\n&#x27;
                           &#x27;        fm.executePendingTransactions();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onResume() {\n&#x27;
                           &#x27;        super.onResume();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.addOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.addOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.addOnDeleteObjectListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        configureActionBar();\n&#x27;
                           &#x27;        invalidateOptionsMenu();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onPause() {\n&#x27;
                           &#x27;        super.onPause();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.removeOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.removeOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.removeOnDeleteObjectListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // received a change from the network, refresh &#x27;
                           &#x27;the list and the editor\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onChange(Bucket&lt;Note&gt; bucket, &#x27;
                           &#x27;Bucket.ChangeType type, String key) {\n&#x27;
                           &#x27;        final boolean resetEditor = mCurrentNote &#x27;
                           &#x27;!= null &amp;&amp; &#x27;
                           &#x27;mCurrentNote.getSimperiumKey().equals(key);\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                mNoteListFragment.refreshList();\n&#x27;
                           &#x27;                if (!resetEditor) return;\n&#x27;
                           &#x27;                if (mNoteEditorFragment != null) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteEditorFragment.refreshContent();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onSaveObject(Bucket&lt;Note&gt; bucket, &#x27;
                           &#x27;Note object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                mNoteListFragment.refreshList();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onDeleteObject(Bucket&lt;Note&gt; &#x27;
                           &#x27;bucket, Note object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                mNoteListFragment.refreshList();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public boolean isLargeScreen() {\n&#x27;
                           &#x27;        return mIsLargeScreen;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public boolean isLargeScreenLandscape() {\n&#x27;
                           &#x27;        return mIsLargeScreen &amp;&amp; mIsLandscape;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // nbradbury 01-Apr-2013\n&#x27;
                           &#x27;    private NoteListFragment getNoteListFragment() &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        return mNoteListFragment;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onCreateOptionsMenu(Menu menu) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        super.onCreateOptionsMenu(menu);\n&#x27;
                           &#x27;        MenuInflater inflater = &#x27;
                           &#x27;getMenuInflater();\n&#x27;
                           &#x27;        inflater.inflate(R.menu.notes_list, &#x27;
                           &#x27;menu);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mSearchMenuItem = &#x27;
                           &#x27;menu.findItem(R.id.menu_search);\n&#x27;
                           &#x27;        mSearchView = (SearchView) &#x27;
                           &#x27;mSearchMenuItem.getActionView();\n&#x27;
                           &#x27;        mSearchView.setOnQueryTextListener(new &#x27;
                           &#x27;SearchView.OnQueryTextListener() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onQueryTextChange(String newText) {\n&#x27;
                           &#x27;                if (newText != null &amp;&amp; &#x27;
                           &#x27;mSearchMenuItem.isActionViewExpanded())\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;getNoteListFragment().searchNotes(newText);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onQueryTextSubmit(String queryText) {\n&#x27;
                           &#x27;                if (queryText != null)\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;getNoteListFragment().searchNotes(queryText);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mSearchMenuItem.setOnActionExpandListener(new &#x27;
                           &#x27;MenuItem.OnActionExpandListener() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onMenuItemActionExpand(MenuItem menuItem) {\n&#x27;
                           &#x27;                showDetailPlaceholder();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onMenuItemActionCollapse(MenuItem menuItem) {\n&#x27;
                           &#x27;                // Show all notes again\n&#x27;
                           &#x27;                &#x27;
                           &#x27;getNoteListFragment().clearSearch();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;        if (fm.getBackStackEntryCount() &gt; 0) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_preferences).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(true);\n&#x27;
                           &#x27;            if (mCurrentNote != null &amp;&amp; &#x27;
                           &#x27;mCurrentNote.isDeleted())\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setTitle(R.string.undelete);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_edit_tags).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(false);\n&#x27;
                           &#x27;        } else if (isLargeScreenLandscape()) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setHomeButtonEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_preferences).setVisible(true);\n&#x27;
                           &#x27;            if (mCurrentNote != null) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(true);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(true);\n&#x27;
                           &#x27;            } else {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(false);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(false);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_edit_tags).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(false);\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setHomeButtonEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_preferences).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_edit_tags).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(false);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        // Are we looking at the trash? Adjust &#x27;
                           &#x27;menu accordingly.\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(getActionBar().getSelectedNavigationIndex() == &#x27;
                           &#x27;TRASH_SELECTED_ID) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(false);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        return true;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onOptionsItemSelected(MenuItem &#x27;
                           &#x27;item) {\n&#x27;
                           &#x27;        switch (item.getItemId()) {\n&#x27;
                           &#x27;            case R.id.menu_preferences:\n&#x27;
                           &#x27;                // nbradbury - use &#x27;
                           &#x27;startActivityForResult so onActivityResult can &#x27;
                           &#x27;detect when user returns from preferences\n&#x27;
                           &#x27;                Intent i = new Intent(this, &#x27;
                           &#x27;PreferencesActivity.class);\n&#x27;
                           &#x27;                startActivityForResult(i, &#x27;
                           &#x27;Simplenote.INTENT_PREFERENCES);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_edit_tags:\n&#x27;
                           &#x27;                Intent editTagsIntent = new &#x27;
                           &#x27;Intent(this, TagsListActivity.class);\n&#x27;
                           &#x27;                startActivity(editTagsIntent);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_create_note:\n&#x27;
                           &#x27;                getNoteListFragment().addNote();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_share:\n&#x27;
                           &#x27;                if (mCurrentNote != null) {\n&#x27;
                           &#x27;                    Intent shareIntent = new &#x27;
                           &#x27;Intent(android.content.Intent.ACTION_SEND);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;shareIntent.setType(&quot;text/plain&quot;);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;shareIntent.putExtra(android.content.Intent.EXTRA_TEXT, &#x27;
                           &#x27;mCurrentNote.getContent());\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;startActivity(Intent.createChooser(shareIntent, &#x27;
                           &#x27;getResources().getString(R.string.share_note)));\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_delete:\n&#x27;
                           &#x27;                if (mNoteEditorFragment != null) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    if (mCurrentNote != null) {\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;mCurrentNote.setDeleted(!mCurrentNote.isDeleted());\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;mCurrentNote.setModificationDate(Calendar.getInstance());\n&#x27;
                           &#x27;                        mCurrentNote.save();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                        if &#x27;
                           &#x27;(mCurrentNote.isDeleted()) {\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;mUndoBarController.setDeletedNote(mCurrentNote);\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;mUndoBarController.showUndoBar(false, &#x27;
                           &#x27;getString(R.string.note_deleted), null);\n&#x27;
                           &#x27;                        }\n&#x27;
                           &#x27;                        showDetailPlaceholder();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                    popNoteDetail();\n&#x27;
                           &#x27;                    NoteListFragment fragment = &#x27;
                           &#x27;getNoteListFragment();\n&#x27;
                           &#x27;                    if (fragment != null) {\n&#x27;
                           &#x27;                        fragment.getPrefs();\n&#x27;
                           &#x27;                        fragment.refreshList();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_empty_trash:\n&#x27;
                           &#x27;                AlertDialog.Builder alert = new &#x27;
                           &#x27;AlertDialog.Builder(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setTitle(R.string.empty_trash);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setMessage(R.string.confirm_empty_trash);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setPositiveButton(R.string.yes, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                    public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                        new &#x27;
                           &#x27;emptyTrashTask().execute();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                });\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setNegativeButton(R.string.no, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                    public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                        // Do nothing, just &#x27;
                           &#x27;closing the dialog\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                });\n&#x27;
                           &#x27;                alert.show();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case android.R.id.home:\n&#x27;
                           &#x27;                popNoteDetail();\n&#x27;
                           &#x27;                invalidateOptionsMenu();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            default:\n&#x27;
                           &#x27;                return &#x27;
                           &#x27;super.onOptionsItemSelected(item);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void popNoteDetail() {\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;        if (fm.getBackStackEntryCount() &gt; 0) {\n&#x27;
                           &#x27;            try {\n&#x27;
                           &#x27;                fm.popBackStack();\n&#x27;
                           &#x27;            } catch (Exception e) {\n&#x27;
                           &#x27;                e.printStackTrace();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Callback method from {@link &#x27;
                           &#x27;NoteListFragment.Callbacks} indicating that\n&#x27;
                           &#x27;     * the item with the given ID was selected.\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onNoteSelected(Note note) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (mSearchMenuItem != null)\n&#x27;
                           &#x27;            mSearchMenuItem.collapseActionView();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mCurrentNote = note;\n&#x27;
                           &#x27;        String noteKey = note == null ? &quot;none&quot; : &#x27;
                           &#x27;note.getSimperiumKey();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (!isLargeScreenLandscape()) {\n&#x27;
                           &#x27;            ActionBar ab = getActionBar();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);\n&#x27;
                           &#x27;            ab.setDisplayShowTitleEnabled(true);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            // Create editor fragment\n&#x27;
                           &#x27;            Bundle arguments = new Bundle();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;arguments.putString(NoteEditorFragment.ARG_ITEM_ID, &#x27;
                           &#x27;noteKey);\n&#x27;
                           &#x27;            mNoteEditorFragment = new &#x27;
                           &#x27;NoteEditorFragment();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;mNoteEditorFragment.setArguments(arguments);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            // Add editor fragment to stack\n&#x27;
                           &#x27;            FragmentTransaction ft = &#x27;
                           &#x27;fm.beginTransaction();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;ft.setCustomAnimations(R.animator.slide_in, &#x27;
                           &#x27;R.animator.zoom_in_and_fade, &#x27;
                           &#x27;R.animator.zoom_out_and_fade, &#x27;
                           &#x27;R.animator.slide_out);\n&#x27;
                           &#x27;            ft.replace(R.id.noteFragmentContainer, &#x27;
                           &#x27;mNoteEditorFragment);\n&#x27;
                           &#x27;            ft.addToBackStack(null);\n&#x27;
                           &#x27;            ft.commit();\n&#x27;
                           &#x27;            fm.executePendingTransactions();\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            mNoteEditorFragment.setNote(note);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getNoteListFragment().setNoteSelected(note);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        invalidateOptionsMenu();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onNavigationItemSelected(int &#x27;
                           &#x27;itemPosition, long itemId) {\n&#x27;
                           &#x27;        // TODO Auto-generated method stub\n&#x27;
                           &#x27;        return false;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;onAuthenticationStatusChange(User.AuthenticationStatus &#x27;
                           &#x27;status) {\n&#x27;
                           &#x27;        if (status == &#x27;
                           &#x27;User.AuthenticationStatus.NOT_AUTHENTICATED) {\n&#x27;
                           &#x27;            startLoginActivity();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void startLoginActivity() {\n&#x27;
                           &#x27;        Intent loginIntent = new Intent(this, &#x27;
                           &#x27;LoginActivity.class);\n&#x27;
                           &#x27;        startActivityForResult(loginIntent, &#x27;
                           &#x27;Simperium.SIGNUP_SIGNIN_REQUEST);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onActivityResult(int &#x27;
                           &#x27;requestCode, int resultCode, Intent data) {\n&#x27;
                           &#x27;        super.onActivityResult(requestCode, &#x27;
                           &#x27;resultCode, data);\n&#x27;
                           &#x27;        switch (requestCode) {\n&#x27;
                           &#x27;            case Simperium.SIGNUP_SIGNIN_REQUEST:\n&#x27;
                           &#x27;                if (resultCode == &#x27;
                           &#x27;RESULT_CANCELED)\n&#x27;
                           &#x27;                    finish();\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;            case Simplenote.INTENT_PREFERENCES:\n&#x27;
                           &#x27;                // nbradbury - refresh note list &#x27;
                           &#x27;when user returns from preferences (in case they &#x27;
                           &#x27;changed anything)\n&#x27;
                           &#x27;                NoteListFragment fragment = &#x27;
                           &#x27;getNoteListFragment();\n&#x27;
                           &#x27;                if (fragment != null) {\n&#x27;
                           &#x27;                    fragment.getPrefs();\n&#x27;
                           &#x27;                    fragment.refreshList();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onUndo(Parcelable p) {\n&#x27;
                           &#x27;        if (mUndoBarController != null &amp;&amp; &#x27;
                           &#x27;mUndoBarController.getDeletedNote() != null) {\n&#x27;
                           &#x27;            Note deletedNote = &#x27;
                           &#x27;mUndoBarController.getDeletedNote();\n&#x27;
                           &#x27;            if (deletedNote != null) {\n&#x27;
                           &#x27;                deletedNote.setDeleted(false);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;deletedNote.setModificationDate(Calendar.getInstance());\n&#x27;
                           &#x27;                deletedNote.save();\n&#x27;
                           &#x27;                NoteListFragment fragment = &#x27;
                           &#x27;getNoteListFragment();\n&#x27;
                           &#x27;                if (fragment != null) {\n&#x27;
                           &#x27;                    fragment.getPrefs();\n&#x27;
                           &#x27;                    fragment.refreshList();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onBackStackChanged() {\n&#x27;
                           &#x27;        configureActionBar();\n&#x27;
                           &#x27;        invalidateOptionsMenu();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private void configureActionBar() {\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(getFragmentManager().getBackStackEntryCount() &gt; &#x27;
                           &#x27;0) {\n&#x27;
                           &#x27;            ActionBar ab = getActionBar();\n&#x27;
                           &#x27;            if (ab != null) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setDisplayShowTitleEnabled(true);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            ActionBar ab = getActionBar();\n&#x27;
                           &#x27;            if (ab != null) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setDisplayShowTitleEnabled(false);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;onConfigurationChanged(Configuration newConfig) {\n&#x27;
                           &#x27;        super.onConfigurationChanged(newConfig);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (mIsLargeScreen) {\n&#x27;
                           &#x27;            if (newConfig.orientation == &#x27;
                           &#x27;Configuration.ORIENTATION_LANDSCAPE) {\n&#x27;
                           &#x27;                // Add the editor fragment\n&#x27;
                           &#x27;                mIsLandscape = true;\n&#x27;
                           &#x27;                popNoteDetail();\n&#x27;
                           &#x27;                addEditorFragment();\n&#x27;
                           &#x27;                if (mNoteListFragment != null) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteListFragment.setActivateOnItemClick(true);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                // Select the current note on a &#x27;
                           &#x27;tablet\n&#x27;
                           &#x27;                if (mCurrentNote != null)\n&#x27;
                           &#x27;                    onNoteSelected(mCurrentNote);\n&#x27;
                           &#x27;                invalidateOptionsMenu();\n&#x27;
                           &#x27;            } else if (newConfig.orientation == &#x27;
                           &#x27;Configuration.ORIENTATION_PORTRAIT &amp;&amp; &#x27;
                           &#x27;mNoteEditorFragment != null) {\n&#x27;
                           &#x27;                // Remove the editor fragment when &#x27;
                           &#x27;rotating back to portrait\n&#x27;
                           &#x27;                mIsLandscape = false;\n&#x27;
                           &#x27;                mCurrentNote = null;\n&#x27;
                           &#x27;                if (mNoteListFragment != null) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteListFragment.setActivateOnItemClick(false);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteListFragment.refreshList();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;                FragmentTransaction ft = &#x27;
                           &#x27;fm.beginTransaction();\n&#x27;
                           &#x27;                ft.remove(mNoteEditorFragment);\n&#x27;
                           &#x27;                mNoteEditorFragment = null;\n&#x27;
                           &#x27;                ft.commit();\n&#x27;
                           &#x27;                fm.executePendingTransactions();\n&#x27;
                           &#x27;                invalidateOptionsMenu();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void showDetailPlaceholder() {\n&#x27;
                           &#x27;        if (isLargeScreenLandscape() &amp;&amp; &#x27;
                           &#x27;mNoteEditorFragment != null) {\n&#x27;
                           &#x27;            mCurrentNote = null;\n&#x27;
                           &#x27;            invalidateOptionsMenu();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;mNoteEditorFragment.setPlaceholderVisible(true);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class emptyTrashTask extends &#x27;
                           &#x27;AsyncTask&lt;Void, Void, Void&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        protected Void doInBackground(Void... &#x27;
                           &#x27;voids) {\n&#x27;
                           &#x27;            Simplenote application = (Simplenote) &#x27;
                           &#x27;getApplication();\n&#x27;
                           &#x27;            Bucket&lt;Note&gt; noteBucket = &#x27;
                           &#x27;application.getNotesBucket();\n&#x27;
                           &#x27;            Query&lt;Note&gt; query = &#x27;
                           &#x27;Note.allDeleted(noteBucket);\n&#x27;
                           &#x27;            Bucket.ObjectCursor c = &#x27;
                           &#x27;query.execute();\n&#x27;
                           &#x27;            while (c.moveToNext()) {\n&#x27;
                           &#x27;                c.getObject().delete();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            return null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;package com.automattic.simplenote;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import android.app.ActionBar;\n&#x27;
                           &#x27;import android.app.Activity;\n&#x27;
                           &#x27;import android.app.AlertDialog;\n&#x27;
                           &#x27;import android.app.FragmentManager;\n&#x27;
                           &#x27;import android.app.FragmentTransaction;\n&#x27;
                           &#x27;import android.content.DialogInterface;\n&#x27;
                           &#x27;import android.content.Intent;\n&#x27;
                           &#x27;import android.content.res.Configuration;\n&#x27;
                           &#x27;import android.os.AsyncTask;\n&#x27;
                           &#x27;import android.os.Bundle;\n&#x27;
                           &#x27;import android.os.Parcelable;\n&#x27;
                           &#x27;import android.view.Menu;\n&#x27;
                           &#x27;import android.view.MenuInflater;\n&#x27;
                           &#x27;import android.view.MenuItem;\n&#x27;
                           &#x27;import android.widget.SearchView;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.automattic.simplenote.models.Note;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.automattic.simplenote.utils.UndoBarController;\n&#x27;
                           &#x27;import com.simperium.Simperium;\n&#x27;
                           &#x27;import com.simperium.client.Bucket;\n&#x27;
                           &#x27;import com.simperium.client.LoginActivity;\n&#x27;
                           &#x27;import com.simperium.client.Query;\n&#x27;
                           &#x27;import com.simperium.client.User;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.util.Calendar;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * An activity representing a list of Notes.\n&#x27;
                           &#x27; * &lt;p/&gt;\n&#x27;
                           &#x27; * The activity makes heavy use of fragments. The &#x27;
                           &#x27;list of items is a\n&#x27;
                           &#x27; * {@link NoteListFragment} and the item details &#x27;
                           &#x27;(if present) is a\n&#x27;
                           &#x27; * {@link NoteEditorFragment}.\n&#x27;
                           &#x27; * &lt;p/&gt;\n&#x27;
                           &#x27; * This activity also implements the required &#x27;
                           &#x27;{@link NoteListFragment.Callbacks}\n&#x27;
                           &#x27; * interface to listen for item selections.\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;public class NotesActivity extends Activity &#x27;
                           &#x27;implements\n&#x27;
                           &#x27;        NoteListFragment.Callbacks, &#x27;
                           &#x27;ActionBar.OnNavigationListener,\n&#x27;
                           &#x27;        User.AuthenticationListener, &#x27;
                           &#x27;UndoBarController.UndoListener,\n&#x27;
                           &#x27;        &#x27;
                           &#x27;FragmentManager.OnBackStackChangedListener, &#x27;
                           &#x27;Bucket.Listener&lt;Note&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private boolean mIsLargeScreen, mIsLandscape;\n&#x27;
                           &#x27;    private UndoBarController mUndoBarController;\n&#x27;
                           &#x27;    private SearchView mSearchView;\n&#x27;
                           &#x27;    private MenuItem mSearchMenuItem;\n&#x27;
                           &#x27;    private NoteListFragment mNoteListFragment;\n&#x27;
                           &#x27;    private NoteEditorFragment &#x27;
                           &#x27;mNoteEditorFragment;\n&#x27;
                           &#x27;    private Note mCurrentNote;\n&#x27;
                           &#x27;    private Bucket&lt;Note&gt; mNotesBucket;\n&#x27;
                           &#x27;    private int TRASH_SELECTED_ID = 1;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static String TAG_NOTE_LIST = &#x27;
                           &#x27;&quot;noteList&quot;;\n&#x27;
                           &#x27;    public static String TAG_NOTE_EDITOR = &#x27;
                           &#x27;&quot;noteEditor&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onCreate(Bundle &#x27;
                           &#x27;savedInstanceState) {\n&#x27;
                           &#x27;        super.onCreate(savedInstanceState);\n&#x27;
                           &#x27;        Simplenote currentApp = (Simplenote) &#x27;
                           &#x27;getApplication();\n&#x27;
                           &#x27;        mNotesBucket = &#x27;
                           &#x27;currentApp.getNotesBucket();\n&#x27;
                           &#x27;        setContentView(R.layout.activity_notes);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (savedInstanceState == null) {\n&#x27;
                           &#x27;            mNoteListFragment = new &#x27;
                           &#x27;NoteListFragment();\n&#x27;
                           &#x27;            FragmentTransaction &#x27;
                           &#x27;fragmentTransaction = &#x27;
                           &#x27;getFragmentManager().beginTransaction();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;fragmentTransaction.add(R.id.noteFragmentContainer, &#x27;
                           &#x27;mNoteListFragment, TAG_NOTE_LIST);\n&#x27;
                           &#x27;            fragmentTransaction.commit();\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            mNoteListFragment = (NoteListFragment) &#x27;
                           &#x27;getFragmentManager().findFragmentByTag(TAG_NOTE_LIST);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Configuration config = &#x27;
                           &#x27;getBaseContext().getResources().getConfiguration();\n&#x27;
                           &#x27;        if ((config.screenLayout\n&#x27;
                           &#x27;                &amp; &#x27;
                           &#x27;Configuration.SCREENLAYOUT_SIZE_MASK)\n&#x27;
                           &#x27;                &gt;= &#x27;
                           &#x27;Configuration.SCREENLAYOUT_SIZE_LARGE) {\n&#x27;
                           &#x27;            mIsLargeScreen = true;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR) &#x27;
                           &#x27;!= null) {\n&#x27;
                           &#x27;                mNoteEditorFragment = &#x27;
                           &#x27;(NoteEditorFragment) &#x27;
                           &#x27;getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR);\n&#x27;
                           &#x27;            } else if (config.orientation == &#x27;
                           &#x27;Configuration.ORIENTATION_LANDSCAPE) {\n&#x27;
                           &#x27;                mIsLandscape = true;\n&#x27;
                           &#x27;                addEditorFragment();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        ActionBar ab = getActionBar();\n&#x27;
                           &#x27;        &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);\n&#x27;
                           &#x27;        ab.setDisplayShowTitleEnabled(false);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mUndoBarController = new &#x27;
                           &#x27;UndoBarController(findViewById(R.id.undobar), &#x27;
                           &#x27;this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;getFragmentManager().addOnBackStackChangedListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (currentApp.getSimperium().getUser() == &#x27;
                           &#x27;null || &#x27;
                           &#x27;currentApp.getSimperium().getUser().needsAuthentication()) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            startLoginActivity();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        &#x27;
                           &#x27;currentApp.getSimperium().setAuthenticationListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(Intent.ACTION_SEND.equals(getIntent().getAction())) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            // Check share action\n&#x27;
                           &#x27;            Intent intent = getIntent();\n&#x27;
                           &#x27;            String text = &#x27;
                           &#x27;intent.getStringExtra(Intent.EXTRA_TEXT);\n&#x27;
                           &#x27;            if (text != null) {\n&#x27;
                           &#x27;                Note note = &#x27;
                           &#x27;mNotesBucket.newObject();\n&#x27;
                           &#x27;                note.setContent(text);\n&#x27;
                           &#x27;                note.save();\n&#x27;
                           &#x27;                onNoteSelected(note);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private void addEditorFragment() {\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;        FragmentTransaction ft = &#x27;
                           &#x27;fm.beginTransaction();\n&#x27;
                           &#x27;        mNoteEditorFragment = new &#x27;
                           &#x27;NoteEditorFragment();\n&#x27;
                           &#x27;        ft.add(R.id.noteFragmentContainer, &#x27;
                           &#x27;mNoteEditorFragment, TAG_NOTE_EDITOR);\n&#x27;
                           &#x27;        ft.commit();\n&#x27;
                           &#x27;        fm.executePendingTransactions();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onResume() {\n&#x27;
                           &#x27;        super.onResume();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.addOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.addOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.addOnDeleteObjectListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        configureActionBar();\n&#x27;
                           &#x27;        invalidateOptionsMenu();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onPause() {\n&#x27;
                           &#x27;        super.onPause();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.removeOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.removeOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.removeOnDeleteObjectListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // received a change from the network, refresh &#x27;
                           &#x27;the list and the editor\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onChange(Bucket&lt;Note&gt; bucket, &#x27;
                           &#x27;Bucket.ChangeType type, String key) {\n&#x27;
                           &#x27;        final boolean resetEditor = mCurrentNote &#x27;
                           &#x27;!= null &amp;&amp; &#x27;
                           &#x27;mCurrentNote.getSimperiumKey().equals(key);\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                mNoteListFragment.refreshList();\n&#x27;
                           &#x27;                if (!resetEditor) return;\n&#x27;
                           &#x27;                if (mNoteEditorFragment != null) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteEditorFragment.refreshContent();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onSaveObject(Bucket&lt;Note&gt; bucket, &#x27;
                           &#x27;Note object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                mNoteListFragment.refreshList();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onDeleteObject(Bucket&lt;Note&gt; &#x27;
                           &#x27;bucket, Note object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                mNoteListFragment.refreshList();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public boolean isLargeScreen() {\n&#x27;
                           &#x27;        return mIsLargeScreen;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public boolean isLargeScreenLandscape() {\n&#x27;
                           &#x27;        return mIsLargeScreen &amp;&amp; mIsLandscape;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // nbradbury 01-Apr-2013\n&#x27;
                           &#x27;    private NoteListFragment getNoteListFragment() &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        return mNoteListFragment;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onCreateOptionsMenu(Menu menu) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        super.onCreateOptionsMenu(menu);\n&#x27;
                           &#x27;        MenuInflater inflater = &#x27;
                           &#x27;getMenuInflater();\n&#x27;
                           &#x27;        inflater.inflate(R.menu.notes_list, &#x27;
                           &#x27;menu);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mSearchMenuItem = &#x27;
                           &#x27;menu.findItem(R.id.menu_search);\n&#x27;
                           &#x27;        mSearchView = (SearchView) &#x27;
                           &#x27;mSearchMenuItem.getActionView();\n&#x27;
                           &#x27;        mSearchView.setOnQueryTextListener(new &#x27;
                           &#x27;SearchView.OnQueryTextListener() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onQueryTextChange(String newText) {\n&#x27;
                           &#x27;                if (newText != null &amp;&amp; &#x27;
                           &#x27;mSearchMenuItem.isActionViewExpanded())\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;getNoteListFragment().searchNotes(newText);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onQueryTextSubmit(String queryText) {\n&#x27;
                           &#x27;                if (queryText != null)\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;getNoteListFragment().searchNotes(queryText);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mSearchMenuItem.setOnActionExpandListener(new &#x27;
                           &#x27;MenuItem.OnActionExpandListener() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onMenuItemActionExpand(MenuItem menuItem) {\n&#x27;
                           &#x27;                showDetailPlaceholder();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onMenuItemActionCollapse(MenuItem menuItem) {\n&#x27;
                           &#x27;                // Show all notes again\n&#x27;
                           &#x27;                &#x27;
                           &#x27;getNoteListFragment().clearSearch();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;        if (fm.getBackStackEntryCount() &gt; 0) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_preferences).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(true);\n&#x27;
                           &#x27;            if (mCurrentNote != null &amp;&amp; &#x27;
                           &#x27;mCurrentNote.isDeleted())\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setTitle(R.string.undelete);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_edit_tags).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(false);\n&#x27;
                           &#x27;        } else if (isLargeScreenLandscape()) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setHomeButtonEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_preferences).setVisible(true);\n&#x27;
                           &#x27;            if (mCurrentNote != null) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(true);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(true);\n&#x27;
                           &#x27;            } else {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(false);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(false);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_edit_tags).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(false);\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setHomeButtonEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_preferences).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_edit_tags).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(false);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        // Are we looking at the trash? Adjust &#x27;
                           &#x27;menu accordingly.\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(getActionBar().getSelectedNavigationIndex() == &#x27;
                           &#x27;TRASH_SELECTED_ID) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(false);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        return true;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onOptionsItemSelected(MenuItem &#x27;
                           &#x27;item) {\n&#x27;
                           &#x27;        switch (item.getItemId()) {\n&#x27;
                           &#x27;            case R.id.menu_preferences:\n&#x27;
                           &#x27;                // nbradbury - use &#x27;
                           &#x27;startActivityForResult so onActivityResult can &#x27;
                           &#x27;detect when user returns from preferences\n&#x27;
                           &#x27;                Intent i = new Intent(this, &#x27;
                           &#x27;PreferencesActivity.class);\n&#x27;
                           &#x27;                startActivityForResult(i, &#x27;
                           &#x27;Simplenote.INTENT_PREFERENCES);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_edit_tags:\n&#x27;
                           &#x27;                Intent editTagsIntent = new &#x27;
                           &#x27;Intent(this, TagsListActivity.class);\n&#x27;
                           &#x27;                startActivity(editTagsIntent);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_create_note:\n&#x27;
                           &#x27;                getNoteListFragment().addNote();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_share:\n&#x27;
                           &#x27;                if (mCurrentNote != null) {\n&#x27;
                           &#x27;                    Intent shareIntent = new &#x27;
                           &#x27;Intent(android.content.Intent.ACTION_SEND);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;shareIntent.setType(&quot;text/plain&quot;);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;shareIntent.putExtra(android.content.Intent.EXTRA_TEXT, &#x27;
                           &#x27;mCurrentNote.getContent());\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;startActivity(Intent.createChooser(shareIntent, &#x27;
                           &#x27;getResources().getString(R.string.share_note)));\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_delete:\n&#x27;
                           &#x27;                if (mNoteEditorFragment != null) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    if (mCurrentNote != null) {\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;mCurrentNote.setDeleted(!mCurrentNote.isDeleted());\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;mCurrentNote.setModificationDate(Calendar.getInstance());\n&#x27;
                           &#x27;                        mCurrentNote.save();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                        if &#x27;
                           &#x27;(mCurrentNote.isDeleted()) {\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;mUndoBarController.setDeletedNote(mCurrentNote);\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;mUndoBarController.showUndoBar(false, &#x27;
                           &#x27;getString(R.string.note_deleted), null);\n&#x27;
                           &#x27;                        }\n&#x27;
                           &#x27;                        showDetailPlaceholder();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                    popNoteDetail();\n&#x27;
                           &#x27;                    NoteListFragment fragment = &#x27;
                           &#x27;getNoteListFragment();\n&#x27;
                           &#x27;                    if (fragment != null) {\n&#x27;
                           &#x27;                        fragment.getPrefs();\n&#x27;
                           &#x27;                        fragment.refreshList();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_empty_trash:\n&#x27;
                           &#x27;                AlertDialog.Builder alert = new &#x27;
                           &#x27;AlertDialog.Builder(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setTitle(R.string.empty_trash);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setMessage(R.string.confirm_empty_trash);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setPositiveButton(R.string.yes, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                    public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                        new &#x27;
                           &#x27;emptyTrashTask().execute();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                });\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setNegativeButton(R.string.no, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                    public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                        // Do nothing, just &#x27;
                           &#x27;closing the dialog\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                });\n&#x27;
                           &#x27;                alert.show();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case android.R.id.home:\n&#x27;
                           &#x27;                popNoteDetail();\n&#x27;
                           &#x27;                invalidateOptionsMenu();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            default:\n&#x27;
                           &#x27;                return &#x27;
                           &#x27;super.onOptionsItemSelected(item);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void popNoteDetail() {\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;        if (fm.getBackStackEntryCount() &gt; 0) {\n&#x27;
                           &#x27;            try {\n&#x27;
                           &#x27;                fm.popBackStack();\n&#x27;
                           &#x27;            } catch (Exception e) {\n&#x27;
                           &#x27;                e.printStackTrace();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Callback method from {@link &#x27;
                           &#x27;NoteListFragment.Callbacks} indicating that\n&#x27;
                           &#x27;     * the item with the given ID was selected.\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onNoteSelected(Note note) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (mSearchMenuItem != null)\n&#x27;
                           &#x27;            mSearchMenuItem.collapseActionView();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mCurrentNote = note;\n&#x27;
                           &#x27;        String noteKey = note == null ? &quot;none&quot; : &#x27;
                           &#x27;note.getSimperiumKey();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (!isLargeScreenLandscape()) {\n&#x27;
                           &#x27;            ActionBar ab = getActionBar();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);\n&#x27;
                           &#x27;            ab.setDisplayShowTitleEnabled(true);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            // Create editor fragment\n&#x27;
                           &#x27;            Bundle arguments = new Bundle();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;arguments.putString(NoteEditorFragment.ARG_ITEM_ID, &#x27;
                           &#x27;noteKey);\n&#x27;
                           &#x27;            mNoteEditorFragment = new &#x27;
                           &#x27;NoteEditorFragment();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;mNoteEditorFragment.setArguments(arguments);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            // Add editor fragment to stack\n&#x27;
                           &#x27;            FragmentTransaction ft = &#x27;
                           &#x27;fm.beginTransaction();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;ft.setCustomAnimations(R.animator.slide_in, &#x27;
                           &#x27;R.animator.zoom_in_and_fade, &#x27;
                           &#x27;R.animator.zoom_out_and_fade, &#x27;
                           &#x27;R.animator.slide_out);\n&#x27;
                           &#x27;            ft.replace(R.id.noteFragmentContainer, &#x27;
                           &#x27;mNoteEditorFragment);\n&#x27;
                           &#x27;            ft.addToBackStack(null);\n&#x27;
                           &#x27;            ft.commit();\n&#x27;
                           &#x27;            fm.executePendingTransactions();\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            mNoteEditorFragment.setNote(note);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getNoteListFragment().setNoteSelected(note);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        invalidateOptionsMenu();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onNavigationItemSelected(int &#x27;
                           &#x27;itemPosition, long itemId) {\n&#x27;
                           &#x27;        // TODO Auto-generated method stub\n&#x27;
                           &#x27;        return false;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;onAuthenticationStatusChange(User.AuthenticationStatus &#x27;
                           &#x27;status) {\n&#x27;
                           &#x27;        if (status == &#x27;
                           &#x27;User.AuthenticationStatus.NOT_AUTHENTICATED) {\n&#x27;
                           &#x27;            startLoginActivity();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void startLoginActivity() {\n&#x27;
                           &#x27;        Intent loginIntent = new Intent(this, &#x27;
                           &#x27;LoginActivity.class);\n&#x27;
                           &#x27;        startActivityForResult(loginIntent, &#x27;
                           &#x27;Simperium.SIGNUP_SIGNIN_REQUEST);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onActivityResult(int &#x27;
                           &#x27;requestCode, int resultCode, Intent data) {\n&#x27;
                           &#x27;        super.onActivityResult(requestCode, &#x27;
                           &#x27;resultCode, data);\n&#x27;
                           &#x27;        switch (requestCode) {\n&#x27;
                           &#x27;            case Simperium.SIGNUP_SIGNIN_REQUEST:\n&#x27;
                           &#x27;                if (resultCode == &#x27;
                           &#x27;RESULT_CANCELED)\n&#x27;
                           &#x27;                    finish();\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;            case Simplenote.INTENT_PREFERENCES:\n&#x27;
                           &#x27;                // nbradbury - refresh note list &#x27;
                           &#x27;when user returns from preferences (in case they &#x27;
                           &#x27;changed anything)\n&#x27;
                           &#x27;                NoteListFragment fragment = &#x27;
                           &#x27;getNoteListFragment();\n&#x27;
                           &#x27;                if (fragment != null) {\n&#x27;
                           &#x27;                    fragment.getPrefs();\n&#x27;
                           &#x27;                    fragment.refreshList();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onUndo(Parcelable p) {\n&#x27;
                           &#x27;        if (mUndoBarController != null &amp;&amp; &#x27;
                           &#x27;mUndoBarController.getDeletedNote() != null) {\n&#x27;
                           &#x27;            Note deletedNote = &#x27;
                           &#x27;mUndoBarController.getDeletedNote();\n&#x27;
                           &#x27;            if (deletedNote != null) {\n&#x27;
                           &#x27;                deletedNote.setDeleted(false);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;deletedNote.setModificationDate(Calendar.getInstance());\n&#x27;
                           &#x27;                deletedNote.save();\n&#x27;
                           &#x27;                NoteListFragment fragment = &#x27;
                           &#x27;getNoteListFragment();\n&#x27;
                           &#x27;                if (fragment != null) {\n&#x27;
                           &#x27;                    fragment.getPrefs();\n&#x27;
                           &#x27;                    fragment.refreshList();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onBackStackChanged() {\n&#x27;
                           &#x27;        configureActionBar();\n&#x27;
                           &#x27;        invalidateOptionsMenu();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private void configureActionBar() {\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(getFragmentManager().getBackStackEntryCount() &gt; &#x27;
                           &#x27;0) {\n&#x27;
                           &#x27;            ActionBar ab = getActionBar();\n&#x27;
                           &#x27;            if (ab != null) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setDisplayShowTitleEnabled(true);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            ActionBar ab = getActionBar();\n&#x27;
                           &#x27;            if (ab != null) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setDisplayShowTitleEnabled(false);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;onConfigurationChanged(Configuration newConfig) {\n&#x27;
                           &#x27;        super.onConfigurationChanged(newConfig);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (mIsLargeScreen) {\n&#x27;
                           &#x27;            if (newConfig.orientation == &#x27;
                           &#x27;Configuration.ORIENTATION_LANDSCAPE) {\n&#x27;
                           &#x27;                // Add the editor fragment\n&#x27;
                           &#x27;                mIsLandscape = true;\n&#x27;
                           &#x27;                popNoteDetail();\n&#x27;
                           &#x27;                addEditorFragment();\n&#x27;
                           &#x27;                if (mNoteListFragment != null) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteListFragment.setActivateOnItemClick(true);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                // Select the current note on a &#x27;
                           &#x27;tablet\n&#x27;
                           &#x27;                if (mCurrentNote != null)\n&#x27;
                           &#x27;                    onNoteSelected(mCurrentNote);\n&#x27;
                           &#x27;                invalidateOptionsMenu();\n&#x27;
                           &#x27;            } else if (newConfig.orientation == &#x27;
                           &#x27;Configuration.ORIENTATION_PORTRAIT &amp;&amp; &#x27;
                           &#x27;mNoteEditorFragment != null) {\n&#x27;
                           &#x27;                // Remove the editor fragment when &#x27;
                           &#x27;rotating back to portrait\n&#x27;
                           &#x27;                mIsLandscape = false;\n&#x27;
                           &#x27;                mCurrentNote = null;\n&#x27;
                           &#x27;                if (mNoteListFragment != null) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteListFragment.setActivateOnItemClick(false);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteListFragment.refreshList();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;                FragmentTransaction ft = &#x27;
                           &#x27;fm.beginTransaction();\n&#x27;
                           &#x27;                ft.remove(mNoteEditorFragment);\n&#x27;
                           &#x27;                mNoteEditorFragment = null;\n&#x27;
                           &#x27;                ft.commit();\n&#x27;
                           &#x27;                fm.executePendingTransactions();\n&#x27;
                           &#x27;                invalidateOptionsMenu();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void showDetailPlaceholder() {\n&#x27;
                           &#x27;        if (isLargeScreenLandscape() &amp;&amp; &#x27;
                           &#x27;mNoteEditorFragment != null) {\n&#x27;
                           &#x27;            mCurrentNote = null;\n&#x27;
                           &#x27;            invalidateOptionsMenu();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;mNoteEditorFragment.setPlaceholderVisible(true);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class emptyTrashTask extends &#x27;
                           &#x27;AsyncTask&lt;Void, Void, Void&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        protected Void doInBackground(Void... &#x27;
                           &#x27;voids) {\n&#x27;
                           &#x27;            Simplenote application = (Simplenote) &#x27;
                           &#x27;getApplication();\n&#x27;
                           &#x27;            Bucket&lt;Note&gt; noteBucket = &#x27;
                           &#x27;application.getNotesBucket();\n&#x27;
                           &#x27;            Query&lt;Note&gt; query = &#x27;
                           &#x27;Note.allDeleted(noteBucket);\n&#x27;
                           &#x27;            Bucket.ObjectCursor c = &#x27;
                           &#x27;query.execute();\n&#x27;
                           &#x27;            while (c.moveToNext()) {\n&#x27;
                           &#x27;                c.getObject().delete();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            return null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;\n&#x27;
                           &#x27;package com.automattic.simplenote;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import android.app.ActionBar;\n&#x27;
                           &#x27;import android.app.Activity;\n&#x27;
                           &#x27;import android.app.AlertDialog;\n&#x27;
                           &#x27;import android.app.FragmentManager;\n&#x27;
                           &#x27;import android.app.FragmentTransaction;\n&#x27;
                           &#x27;import android.content.DialogInterface;\n&#x27;
                           &#x27;import android.content.Intent;\n&#x27;
                           &#x27;import android.content.res.Configuration;\n&#x27;
                           &#x27;import android.os.AsyncTask;\n&#x27;
                           &#x27;import android.os.Bundle;\n&#x27;
                           &#x27;import android.os.Parcelable;\n&#x27;
                           &#x27;import android.view.Menu;\n&#x27;
                           &#x27;import android.view.MenuInflater;\n&#x27;
                           &#x27;import android.view.MenuItem;\n&#x27;
                           &#x27;import android.widget.SearchView;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.automattic.simplenote.models.Note;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.automattic.simplenote.utils.UndoBarController;\n&#x27;
                           &#x27;import com.simperium.Simperium;\n&#x27;
                           &#x27;import com.simperium.client.Bucket;\n&#x27;
                           &#x27;import com.simperium.client.LoginActivity;\n&#x27;
                           &#x27;import com.simperium.client.Query;\n&#x27;
                           &#x27;import com.simperium.client.User;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.util.Calendar;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * An activity representing a list of Notes.\n&#x27;
                           &#x27; * &lt;p/&gt;\n&#x27;
                           &#x27; * The activity makes heavy use of fragments. The &#x27;
                           &#x27;list of items is a\n&#x27;
                           &#x27; * {@link NoteListFragment} and the item details &#x27;
                           &#x27;(if present) is a\n&#x27;
                           &#x27; * {@link NoteEditorFragment}.\n&#x27;
                           &#x27; * &lt;p/&gt;\n&#x27;
                           &#x27; * This activity also implements the required &#x27;
                           &#x27;{@link NoteListFragment.Callbacks}\n&#x27;
                           &#x27; * interface to listen for item selections.\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;public class NotesActivity extends Activity &#x27;
                           &#x27;implements\n&#x27;
                           &#x27;        NoteListFragment.Callbacks, &#x27;
                           &#x27;ActionBar.OnNavigationListener,\n&#x27;
                           &#x27;        User.AuthenticationListener, &#x27;
                           &#x27;UndoBarController.UndoListener,\n&#x27;
                           &#x27;        &#x27;
                           &#x27;FragmentManager.OnBackStackChangedListener, &#x27;
                           &#x27;Bucket.Listener&lt;Note&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private boolean mIsLargeScreen, mIsLandscape;\n&#x27;
                           &#x27;    private UndoBarController mUndoBarController;\n&#x27;
                           &#x27;    private SearchView mSearchView;\n&#x27;
                           &#x27;    private MenuItem mSearchMenuItem;\n&#x27;
                           &#x27;    private NoteListFragment mNoteListFragment;\n&#x27;
                           &#x27;    private NoteEditorFragment &#x27;
                           &#x27;mNoteEditorFragment;\n&#x27;
                           &#x27;    private Note mCurrentNote;\n&#x27;
                           &#x27;    private Bucket&lt;Note&gt; mNotesBucket;\n&#x27;
                           &#x27;    private int TRASH_SELECTED_ID = 1;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static String TAG_NOTE_LIST = &#x27;
                           &#x27;&quot;noteList&quot;;\n&#x27;
                           &#x27;    public static String TAG_NOTE_EDITOR = &#x27;
                           &#x27;&quot;noteEditor&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onCreate(Bundle &#x27;
                           &#x27;savedInstanceState) {\n&#x27;
                           &#x27;        super.onCreate(savedInstanceState);\n&#x27;
                           &#x27;        Simplenote currentApp = (Simplenote) &#x27;
                           &#x27;getApplication();\n&#x27;
                           &#x27;        mNotesBucket = &#x27;
                           &#x27;currentApp.getNotesBucket();\n&#x27;
                           &#x27;        setContentView(R.layout.activity_notes);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (savedInstanceState == null) {\n&#x27;
                           &#x27;            mNoteListFragment = new &#x27;
                           &#x27;NoteListFragment();\n&#x27;
                           &#x27;            FragmentTransaction &#x27;
                           &#x27;fragmentTransaction = &#x27;
                           &#x27;getFragmentManager().beginTransaction();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;fragmentTransaction.add(R.id.noteFragmentContainer, &#x27;
                           &#x27;mNoteListFragment, TAG_NOTE_LIST);\n&#x27;
                           &#x27;            fragmentTransaction.commit();\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            mNoteListFragment = (NoteListFragment) &#x27;
                           &#x27;getFragmentManager().findFragmentByTag(TAG_NOTE_LIST);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Configuration config = &#x27;
                           &#x27;getBaseContext().getResources().getConfiguration();\n&#x27;
                           &#x27;        if ((config.screenLayout\n&#x27;
                           &#x27;                &amp; &#x27;
                           &#x27;Configuration.SCREENLAYOUT_SIZE_MASK)\n&#x27;
                           &#x27;                &gt;= &#x27;
                           &#x27;Configuration.SCREENLAYOUT_SIZE_LARGE) {\n&#x27;
                           &#x27;            mIsLargeScreen = true;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR) &#x27;
                           &#x27;!= null) {\n&#x27;
                           &#x27;                mNoteEditorFragment = &#x27;
                           &#x27;(NoteEditorFragment) &#x27;
                           &#x27;getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR);\n&#x27;
                           &#x27;            } else if (config.orientation == &#x27;
                           &#x27;Configuration.ORIENTATION_LANDSCAPE) {\n&#x27;
                           &#x27;                mIsLandscape = true;\n&#x27;
                           &#x27;                addEditorFragment();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        ActionBar ab = getActionBar();\n&#x27;
                           &#x27;        &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);\n&#x27;
                           &#x27;        ab.setDisplayShowTitleEnabled(false);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mUndoBarController = new &#x27;
                           &#x27;UndoBarController(findViewById(R.id.undobar), &#x27;
                           &#x27;this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;getFragmentManager().addOnBackStackChangedListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (currentApp.getSimperium().getUser() == &#x27;
                           &#x27;null || &#x27;
                           &#x27;currentApp.getSimperium().getUser().needsAuthentication()) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            startLoginActivity();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        &#x27;
                           &#x27;currentApp.getSimperium().setAuthenticationListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(Intent.ACTION_SEND.equals(getIntent().getAction())) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            // Check share action\n&#x27;
                           &#x27;            Intent intent = getIntent();\n&#x27;
                           &#x27;            String text = &#x27;
                           &#x27;intent.getStringExtra(Intent.EXTRA_TEXT);\n&#x27;
                           &#x27;            if (text != null) {\n&#x27;
                           &#x27;                Note note = &#x27;
                           &#x27;mNotesBucket.newObject();\n&#x27;
                           &#x27;                note.setContent(text);\n&#x27;
                           &#x27;                note.save();\n&#x27;
                           &#x27;                onNoteSelected(note);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private void addEditorFragment() {\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;        FragmentTransaction ft = &#x27;
                           &#x27;fm.beginTransaction();\n&#x27;
                           &#x27;        mNoteEditorFragment = new &#x27;
                           &#x27;NoteEditorFragment();\n&#x27;
                           &#x27;        ft.add(R.id.noteFragmentContainer, &#x27;
                           &#x27;mNoteEditorFragment, TAG_NOTE_EDITOR);\n&#x27;
                           &#x27;        ft.commit();\n&#x27;
                           &#x27;        fm.executePendingTransactions();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onResume() {\n&#x27;
                           &#x27;        super.onResume();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.addOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.addOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.addOnDeleteObjectListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        configureActionBar();\n&#x27;
                           &#x27;        invalidateOptionsMenu();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onPause() {\n&#x27;
                           &#x27;        super.onPause();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.removeOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.removeOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.removeOnDeleteObjectListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // received a change from the network, refresh &#x27;
                           &#x27;the list and the editor\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onChange(Bucket&lt;Note&gt; bucket, &#x27;
                           &#x27;Bucket.ChangeType type, String key) {\n&#x27;
                           &#x27;        final boolean resetEditor = mCurrentNote &#x27;
                           &#x27;!= null &amp;&amp; &#x27;
                           &#x27;mCurrentNote.getSimperiumKey().equals(key);\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                mNoteListFragment.refreshList();\n&#x27;
                           &#x27;                if (!resetEditor) return;\n&#x27;
                           &#x27;                if (mNoteEditorFragment != null) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteEditorFragment.refreshContent();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onSaveObject(Bucket&lt;Note&gt; bucket, &#x27;
                           &#x27;Note object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                mNoteListFragment.refreshList();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onDeleteObject(Bucket&lt;Note&gt; &#x27;
                           &#x27;bucket, Note object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                mNoteListFragment.refreshList();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public boolean isLargeScreen() {\n&#x27;
                           &#x27;        return mIsLargeScreen;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public boolean isLargeScreenLandscape() {\n&#x27;
                           &#x27;        return mIsLargeScreen &amp;&amp; mIsLandscape;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // nbradbury 01-Apr-2013\n&#x27;
                           &#x27;    private NoteListFragment getNoteListFragment() &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        return mNoteListFragment;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onCreateOptionsMenu(Menu menu) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        super.onCreateOptionsMenu(menu);\n&#x27;
                           &#x27;        MenuInflater inflater = &#x27;
                           &#x27;getMenuInflater();\n&#x27;
                           &#x27;        inflater.inflate(R.menu.notes_list, &#x27;
                           &#x27;menu);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mSearchMenuItem = &#x27;
                           &#x27;menu.findItem(R.id.menu_search);\n&#x27;
                           &#x27;        mSearchView = (SearchView) &#x27;
                           &#x27;mSearchMenuItem.getActionView();\n&#x27;
                           &#x27;        mSearchView.setOnQueryTextListener(new &#x27;
                           &#x27;SearchView.OnQueryTextListener() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onQueryTextChange(String newText) {\n&#x27;
                           &#x27;                if (newText != null &amp;&amp; &#x27;
                           &#x27;mSearchMenuItem.isActionViewExpanded())\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;getNoteListFragment().searchNotes(newText);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onQueryTextSubmit(String queryText) {\n&#x27;
                           &#x27;                if (queryText != null)\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;getNoteListFragment().searchNotes(queryText);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mSearchMenuItem.setOnActionExpandListener(new &#x27;
                           &#x27;MenuItem.OnActionExpandListener() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onMenuItemActionExpand(MenuItem menuItem) {\n&#x27;
                           &#x27;                showDetailPlaceholder();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onMenuItemActionCollapse(MenuItem menuItem) {\n&#x27;
                           &#x27;                // Show all notes again\n&#x27;
                           &#x27;                &#x27;
                           &#x27;getNoteListFragment().clearSearch();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;        if (fm.getBackStackEntryCount() &gt; 0) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_preferences).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(true);\n&#x27;
                           &#x27;            if (mCurrentNote != null &amp;&amp; &#x27;
                           &#x27;mCurrentNote.isDeleted())\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setTitle(R.string.undelete);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_edit_tags).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(false);\n&#x27;
                           &#x27;        } else if (isLargeScreenLandscape()) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setHomeButtonEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_preferences).setVisible(true);\n&#x27;
                           &#x27;            if (mCurrentNote != null) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(true);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(true);\n&#x27;
                           &#x27;            } else {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(false);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(false);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_edit_tags).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(false);\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setHomeButtonEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_preferences).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_edit_tags).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(false);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        // Are we looking at the trash? Adjust &#x27;
                           &#x27;menu accordingly.\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(getActionBar().getSelectedNavigationIndex() == &#x27;
                           &#x27;TRASH_SELECTED_ID) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(false);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        return true;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onOptionsItemSelected(MenuItem &#x27;
                           &#x27;item) {\n&#x27;
                           &#x27;        switch (item.getItemId()) {\n&#x27;
                           &#x27;            case R.id.menu_preferences:\n&#x27;
                           &#x27;                // nbradbury - use &#x27;
                           &#x27;startActivityForResult so onActivityResult can &#x27;
                           &#x27;detect when user returns from preferences\n&#x27;
                           &#x27;                Intent i = new Intent(this, &#x27;
                           &#x27;PreferencesActivity.class);\n&#x27;
                           &#x27;                startActivityForResult(i, &#x27;
                           &#x27;Simplenote.INTENT_PREFERENCES);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_edit_tags:\n&#x27;
                           &#x27;                Intent editTagsIntent = new &#x27;
                           &#x27;Intent(this, TagsListActivity.class);\n&#x27;
                           &#x27;                startActivity(editTagsIntent);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_create_note:\n&#x27;
                           &#x27;                getNoteListFragment().addNote();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_share:\n&#x27;
                           &#x27;                if (mCurrentNote != null) {\n&#x27;
                           &#x27;                    Intent shareIntent = new &#x27;
                           &#x27;Intent(android.content.Intent.ACTION_SEND);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;shareIntent.setType(&quot;text/plain&quot;);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;shareIntent.putExtra(android.content.Intent.EXTRA_TEXT, &#x27;
                           &#x27;mCurrentNote.getContent());\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;startActivity(Intent.createChooser(shareIntent, &#x27;
                           &#x27;getResources().getString(R.string.share_note)));\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_delete:\n&#x27;
                           &#x27;                if (mNoteEditorFragment != null) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    if (mCurrentNote != null) {\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;mCurrentNote.setDeleted(!mCurrentNote.isDeleted());\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;mCurrentNote.setModificationDate(Calendar.getInstance());\n&#x27;
                           &#x27;                        mCurrentNote.save();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                        if &#x27;
                           &#x27;(mCurrentNote.isDeleted()) {\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;mUndoBarController.setDeletedNote(mCurrentNote);\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;mUndoBarController.showUndoBar(false, &#x27;
                           &#x27;getString(R.string.note_deleted), null);\n&#x27;
                           &#x27;                        }\n&#x27;
                           &#x27;                        showDetailPlaceholder();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                    popNoteDetail();\n&#x27;
                           &#x27;                    NoteListFragment fragment = &#x27;
                           &#x27;getNoteListFragment();\n&#x27;
                           &#x27;                    if (fragment != null) {\n&#x27;
                           &#x27;                        fragment.getPrefs();\n&#x27;
                           &#x27;                        fragment.refreshList();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_empty_trash:\n&#x27;
                           &#x27;                AlertDialog.Builder alert = new &#x27;
                           &#x27;AlertDialog.Builder(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setTitle(R.string.empty_trash);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setMessage(R.string.confirm_empty_trash);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setPositiveButton(R.string.yes, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                    public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                        new &#x27;
                           &#x27;emptyTrashTask().execute();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                });\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setNegativeButton(R.string.no, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                    public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                        // Do nothing, just &#x27;
                           &#x27;closing the dialog\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                });\n&#x27;
                           &#x27;                alert.show();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case android.R.id.home:\n&#x27;
                           &#x27;                popNoteDetail();\n&#x27;
                           &#x27;                invalidateOptionsMenu();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            default:\n&#x27;
                           &#x27;                return &#x27;
                           &#x27;super.onOptionsItemSelected(item);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void popNoteDetail() {\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;        if (fm.getBackStackEntryCount() &gt; 0) {\n&#x27;
                           &#x27;            try {\n&#x27;
                           &#x27;                fm.popBackStack();\n&#x27;
                           &#x27;            } catch (Exception e) {\n&#x27;
                           &#x27;                e.printStackTrace();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Callback method from {@link &#x27;
                           &#x27;NoteListFragment.Callbacks} indicating that\n&#x27;
                           &#x27;     * the item with the given ID was selected.\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onNoteSelected(Note note) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (mSearchMenuItem != null)\n&#x27;
                           &#x27;            mSearchMenuItem.collapseActionView();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mCurrentNote = note;\n&#x27;
                           &#x27;        String noteKey = note == null ? &quot;none&quot; : &#x27;
                           &#x27;note.getSimperiumKey();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (!isLargeScreenLandscape()) {\n&#x27;
                           &#x27;            ActionBar ab = getActionBar();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);\n&#x27;
                           &#x27;            ab.setDisplayShowTitleEnabled(true);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            // Create editor fragment\n&#x27;
                           &#x27;            Bundle arguments = new Bundle();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;arguments.putString(NoteEditorFragment.ARG_ITEM_ID, &#x27;
                           &#x27;noteKey);\n&#x27;
                           &#x27;            mNoteEditorFragment = new &#x27;
                           &#x27;NoteEditorFragment();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;mNoteEditorFragment.setArguments(arguments);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            // Add editor fragment to stack\n&#x27;
                           &#x27;            FragmentTransaction ft = &#x27;
                           &#x27;fm.beginTransaction();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;ft.setCustomAnimations(R.animator.slide_in, &#x27;
                           &#x27;R.animator.zoom_in_and_fade, &#x27;
                           &#x27;R.animator.zoom_out_and_fade, &#x27;
                           &#x27;R.animator.slide_out);\n&#x27;
                           &#x27;            ft.replace(R.id.noteFragmentContainer, &#x27;
                           &#x27;mNoteEditorFragment);\n&#x27;
                           &#x27;            ft.addToBackStack(null);\n&#x27;
                           &#x27;            ft.commit();\n&#x27;
                           &#x27;            fm.executePendingTransactions();\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            mNoteEditorFragment.setNote(note);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getNoteListFragment().setNoteSelected(note);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        invalidateOptionsMenu();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onNavigationItemSelected(int &#x27;
                           &#x27;itemPosition, long itemId) {\n&#x27;
                           &#x27;        // TODO Auto-generated method stub\n&#x27;
                           &#x27;        return false;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;onAuthenticationStatusChange(User.AuthenticationStatus &#x27;
                           &#x27;status) {\n&#x27;
                           &#x27;        if (status == &#x27;
                           &#x27;User.AuthenticationStatus.NOT_AUTHENTICATED) {\n&#x27;
                           &#x27;            startLoginActivity();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void startLoginActivity() {\n&#x27;
                           &#x27;        Intent loginIntent = new Intent(this, &#x27;
                           &#x27;LoginActivity.class);\n&#x27;
                           &#x27;        startActivityForResult(loginIntent, &#x27;
                           &#x27;Simperium.SIGNUP_SIGNIN_REQUEST);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onActivityResult(int &#x27;
                           &#x27;requestCode, int resultCode, Intent data) {\n&#x27;
                           &#x27;        super.onActivityResult(requestCode, &#x27;
                           &#x27;resultCode, data);\n&#x27;
                           &#x27;        switch (requestCode) {\n&#x27;
                           &#x27;            case Simperium.SIGNUP_SIGNIN_REQUEST:\n&#x27;
                           &#x27;                if (resultCode == &#x27;
                           &#x27;RESULT_CANCELED)\n&#x27;
                           &#x27;                    finish();\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;            case Simplenote.INTENT_PREFERENCES:\n&#x27;
                           &#x27;                // nbradbury - refresh note list &#x27;
                           &#x27;when user returns from preferences (in case they &#x27;
                           &#x27;changed anything)\n&#x27;
                           &#x27;                NoteListFragment fragment = &#x27;
                           &#x27;getNoteListFragment();\n&#x27;
                           &#x27;                if (fragment != null) {\n&#x27;
                           &#x27;                    fragment.getPrefs();\n&#x27;
                           &#x27;                    fragment.refreshList();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onUndo(Parcelable p) {\n&#x27;
                           &#x27;        if (mUndoBarController != null &amp;&amp; &#x27;
                           &#x27;mUndoBarController.getDeletedNote() != null) {\n&#x27;
                           &#x27;            Note deletedNote = &#x27;
                           &#x27;mUndoBarController.getDeletedNote();\n&#x27;
                           &#x27;            if (deletedNote != null) {\n&#x27;
                           &#x27;                deletedNote.setDeleted(false);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;deletedNote.setModificationDate(Calendar.getInstance());\n&#x27;
                           &#x27;                deletedNote.save();\n&#x27;
                           &#x27;                NoteListFragment fragment = &#x27;
                           &#x27;getNoteListFragment();\n&#x27;
                           &#x27;                if (fragment != null) {\n&#x27;
                           &#x27;                    fragment.getPrefs();\n&#x27;
                           &#x27;                    fragment.refreshList();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onBackStackChanged() {\n&#x27;
                           &#x27;        configureActionBar();\n&#x27;
                           &#x27;        invalidateOptionsMenu();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private void configureActionBar() {\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(getFragmentManager().getBackStackEntryCount() &gt; &#x27;
                           &#x27;0) {\n&#x27;
                           &#x27;            ActionBar ab = getActionBar();\n&#x27;
                           &#x27;            if (ab != null) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setDisplayShowTitleEnabled(true);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            ActionBar ab = getActionBar();\n&#x27;
                           &#x27;            if (ab != null) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setDisplayShowTitleEnabled(false);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;onConfigurationChanged(Configuration newConfig) {\n&#x27;
                           &#x27;        super.onConfigurationChanged(newConfig);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (mIsLargeScreen) {\n&#x27;
                           &#x27;            if (newConfig.orientation == &#x27;
                           &#x27;Configuration.ORIENTATION_LANDSCAPE) {\n&#x27;
                           &#x27;                // Add the editor fragment\n&#x27;
                           &#x27;                mIsLandscape = true;\n&#x27;
                           &#x27;                popNoteDetail();\n&#x27;
                           &#x27;                addEditorFragment();\n&#x27;
                           &#x27;                if (mNoteListFragment != null) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteListFragment.setActivateOnItemClick(true);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                // Select the current note on a &#x27;
                           &#x27;tablet\n&#x27;
                           &#x27;                if (mCurrentNote != null)\n&#x27;
                           &#x27;                    onNoteSelected(mCurrentNote);\n&#x27;
                           &#x27;                invalidateOptionsMenu();\n&#x27;
                           &#x27;            } else if (newConfig.orientation == &#x27;
                           &#x27;Configuration.ORIENTATION_PORTRAIT &amp;&amp; &#x27;
                           &#x27;mNoteEditorFragment != null) {\n&#x27;
                           &#x27;                // Remove the editor fragment when &#x27;
                           &#x27;rotating back to portrait\n&#x27;
                           &#x27;                mIsLandscape = false;\n&#x27;
                           &#x27;                mCurrentNote = null;\n&#x27;
                           &#x27;                if (mNoteListFragment != null) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteListFragment.setActivateOnItemClick(false);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteListFragment.refreshList();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;                FragmentTransaction ft = &#x27;
                           &#x27;fm.beginTransaction();\n&#x27;
                           &#x27;                ft.remove(mNoteEditorFragment);\n&#x27;
                           &#x27;                mNoteEditorFragment = null;\n&#x27;
                           &#x27;                ft.commit();\n&#x27;
                           &#x27;                fm.executePendingTransactions();\n&#x27;
                           &#x27;                invalidateOptionsMenu();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void showDetailPlaceholder() {\n&#x27;
                           &#x27;        if (isLargeScreenLandscape() &amp;&amp; &#x27;
                           &#x27;mNoteEditorFragment != null) {\n&#x27;
                           &#x27;            mCurrentNote = null;\n&#x27;
                           &#x27;            invalidateOptionsMenu();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;mNoteEditorFragment.setPlaceholderVisible(true);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class emptyTrashTask extends &#x27;
                           &#x27;AsyncTask&lt;Void, Void, Void&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        protected Void doInBackground(Void... &#x27;
                           &#x27;voids) {\n&#x27;
                           &#x27;            Simplenote application = (Simplenote) &#x27;
                           &#x27;getApplication();\n&#x27;
                           &#x27;            Bucket&lt;Note&gt; noteBucket = &#x27;
                           &#x27;application.getNotesBucket();\n&#x27;
                           &#x27;            Query&lt;Note&gt; query = &#x27;
                           &#x27;Note.allDeleted(noteBucket);\n&#x27;
                           &#x27;            Bucket.ObjectCursor c = &#x27;
                           &#x27;query.execute();\n&#x27;
                           &#x27;            while (c.moveToNext()) {\n&#x27;
                           &#x27;                c.getObject().delete();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            return null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;}\n&#x27;}],
   &#x27;mergers&#x27;: {&#x27;baseline&#x27;, &#x27;spork&#x27;, &#x27;jfstmerge&#x27;}}],
 [{&#x27;eq&#x27;: [{&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;package com.automattic.simplenote;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import android.app.ActionBar;\n&#x27;
                           &#x27;import android.app.Activity;\n&#x27;
                           &#x27;import android.app.AlertDialog;\n&#x27;
                           &#x27;import android.app.FragmentManager;\n&#x27;
                           &#x27;import android.app.FragmentTransaction;\n&#x27;
                           &#x27;import android.content.DialogInterface;\n&#x27;
                           &#x27;import android.content.Intent;\n&#x27;
                           &#x27;import android.content.res.Configuration;\n&#x27;
                           &#x27;import android.os.AsyncTask;\n&#x27;
                           &#x27;import android.os.Bundle;\n&#x27;
                           &#x27;import android.os.Parcelable;\n&#x27;
                           &#x27;import android.view.Menu;\n&#x27;
                           &#x27;import android.view.MenuInflater;\n&#x27;
                           &#x27;import android.view.MenuItem;\n&#x27;
                           &#x27;import android.widget.SearchView;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.automattic.simplenote.models.Note;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.automattic.simplenote.utils.UndoBarController;\n&#x27;
                           &#x27;import com.simperium.Simperium;\n&#x27;
                           &#x27;import com.simperium.client.Bucket;\n&#x27;
                           &#x27;import com.simperium.client.LoginActivity;\n&#x27;
                           &#x27;import com.simperium.client.Query;\n&#x27;
                           &#x27;import com.simperium.client.User;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.util.Calendar;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * An activity representing a list of Notes.\n&#x27;
                           &#x27; * &lt;p/&gt;\n&#x27;
                           &#x27; * The activity makes heavy use of fragments. The &#x27;
                           &#x27;list of items is a\n&#x27;
                           &#x27; * {@link NoteListFragment} and the item details &#x27;
                           &#x27;(if present) is a\n&#x27;
                           &#x27; * {@link NoteEditorFragment}.\n&#x27;
                           &#x27; * &lt;p/&gt;\n&#x27;
                           &#x27; * This activity also implements the required &#x27;
                           &#x27;{@link NoteListFragment.Callbacks}\n&#x27;
                           &#x27; * interface to listen for item selections.\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;public class NotesActivity extends Activity &#x27;
                           &#x27;implements\n&#x27;
                           &#x27;        NoteListFragment.Callbacks, &#x27;
                           &#x27;ActionBar.OnNavigationListener,\n&#x27;
                           &#x27;        User.AuthenticationListener, &#x27;
                           &#x27;UndoBarController.UndoListener,\n&#x27;
                           &#x27;        &#x27;
                           &#x27;FragmentManager.OnBackStackChangedListener, &#x27;
                           &#x27;Bucket.Listener&lt;Note&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private boolean mIsLargeScreen, mIsLandscape;\n&#x27;
                           &#x27;    private UndoBarController mUndoBarController;\n&#x27;
                           &#x27;    private SearchView mSearchView;\n&#x27;
                           &#x27;    private MenuItem mSearchMenuItem;\n&#x27;
                           &#x27;    private NoteListFragment mNoteListFragment;\n&#x27;
                           &#x27;    private NoteEditorFragment &#x27;
                           &#x27;mNoteEditorFragment;\n&#x27;
                           &#x27;    private Note mCurrentNote;\n&#x27;
                           &#x27;    private Bucket&lt;Note&gt; mNotesBucket;\n&#x27;
                           &#x27;    private int TRASH_SELECTED_ID = 1;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static String TAG_NOTE_LIST = &#x27;
                           &#x27;&quot;noteList&quot;;\n&#x27;
                           &#x27;    public static String TAG_NOTE_EDITOR = &#x27;
                           &#x27;&quot;noteEditor&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onCreate(Bundle &#x27;
                           &#x27;savedInstanceState) {\n&#x27;
                           &#x27;        super.onCreate(savedInstanceState);\n&#x27;
                           &#x27;        Simplenote currentApp = (Simplenote) &#x27;
                           &#x27;getApplication();\n&#x27;
                           &#x27;        mNotesBucket = &#x27;
                           &#x27;currentApp.getNotesBucket();\n&#x27;
                           &#x27;        setContentView(R.layout.activity_notes);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (savedInstanceState == null) {\n&#x27;
                           &#x27;            mNoteListFragment = new &#x27;
                           &#x27;NoteListFragment();\n&#x27;
                           &#x27;            FragmentTransaction &#x27;
                           &#x27;fragmentTransaction = &#x27;
                           &#x27;getFragmentManager().beginTransaction();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;fragmentTransaction.add(R.id.noteFragmentContainer, &#x27;
                           &#x27;mNoteListFragment, TAG_NOTE_LIST);\n&#x27;
                           &#x27;            fragmentTransaction.commit();\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            mNoteListFragment = (NoteListFragment) &#x27;
                           &#x27;getFragmentManager().findFragmentByTag(TAG_NOTE_LIST);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Configuration config = &#x27;
                           &#x27;getBaseContext().getResources().getConfiguration();\n&#x27;
                           &#x27;        if ((config.screenLayout\n&#x27;
                           &#x27;                &amp; &#x27;
                           &#x27;Configuration.SCREENLAYOUT_SIZE_MASK)\n&#x27;
                           &#x27;                &gt;= &#x27;
                           &#x27;Configuration.SCREENLAYOUT_SIZE_LARGE) {\n&#x27;
                           &#x27;            mIsLargeScreen = true;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR) &#x27;
                           &#x27;!= null) {\n&#x27;
                           &#x27;                mNoteEditorFragment = &#x27;
                           &#x27;(NoteEditorFragment) &#x27;
                           &#x27;getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR);\n&#x27;
                           &#x27;            } else if (config.orientation == &#x27;
                           &#x27;Configuration.ORIENTATION_LANDSCAPE) {\n&#x27;
                           &#x27;                mIsLandscape = true;\n&#x27;
                           &#x27;                addEditorFragment();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        ActionBar ab = getActionBar();\n&#x27;
                           &#x27;        &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);\n&#x27;
                           &#x27;        ab.setDisplayShowTitleEnabled(false);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mUndoBarController = new &#x27;
                           &#x27;UndoBarController(findViewById(R.id.undobar), &#x27;
                           &#x27;this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;getFragmentManager().addOnBackStackChangedListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (currentApp.getSimperium().getUser() == &#x27;
                           &#x27;null || &#x27;
                           &#x27;currentApp.getSimperium().getUser().needsAuthentication()) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            startLoginActivity();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        &#x27;
                           &#x27;currentApp.getSimperium().setAuthenticationListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(Intent.ACTION_SEND.equals(getIntent().getAction())) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            // Check share action\n&#x27;
                           &#x27;            Intent intent = getIntent();\n&#x27;
                           &#x27;            String text = &#x27;
                           &#x27;intent.getStringExtra(Intent.EXTRA_TEXT);\n&#x27;
                           &#x27;            if (text != null) {\n&#x27;
                           &#x27;                Note note = &#x27;
                           &#x27;mNotesBucket.newObject();\n&#x27;
                           &#x27;                note.setContent(text);\n&#x27;
                           &#x27;                note.save();\n&#x27;
                           &#x27;                onNoteSelected(note);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private void addEditorFragment() {\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;        FragmentTransaction ft = &#x27;
                           &#x27;fm.beginTransaction();\n&#x27;
                           &#x27;        mNoteEditorFragment = new &#x27;
                           &#x27;NoteEditorFragment();\n&#x27;
                           &#x27;        ft.add(R.id.noteFragmentContainer, &#x27;
                           &#x27;mNoteEditorFragment, TAG_NOTE_EDITOR);\n&#x27;
                           &#x27;        ft.commit();\n&#x27;
                           &#x27;        fm.executePendingTransactions();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onResume() {\n&#x27;
                           &#x27;        super.onResume();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.addOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.addOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.addOnDeleteObjectListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        configureActionBar();\n&#x27;
                           &#x27;        invalidateOptionsMenu();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onPause() {\n&#x27;
                           &#x27;        super.onPause();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.removeOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.removeOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.removeOnDeleteObjectListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // received a change from the network, refresh &#x27;
                           &#x27;the list and the editor\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onChange(Bucket&lt;Note&gt; bucket, &#x27;
                           &#x27;Bucket.ChangeType type, String key) {\n&#x27;
                           &#x27;        final boolean resetEditor = mCurrentNote &#x27;
                           &#x27;!= null &amp;&amp; &#x27;
                           &#x27;mCurrentNote.getSimperiumKey().equals(key);\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                mNoteListFragment.refreshList();\n&#x27;
                           &#x27;                if (!resetEditor) return;\n&#x27;
                           &#x27;                if (mNoteEditorFragment != null) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteEditorFragment.refreshContent();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onSaveObject(Bucket&lt;Note&gt; bucket, &#x27;
                           &#x27;Note object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                mNoteListFragment.refreshList();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onDeleteObject(Bucket&lt;Note&gt; &#x27;
                           &#x27;bucket, Note object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                mNoteListFragment.refreshList();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public boolean isLargeScreen() {\n&#x27;
                           &#x27;        return mIsLargeScreen;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public boolean isLargeScreenLandscape() {\n&#x27;
                           &#x27;        return mIsLargeScreen &amp;&amp; mIsLandscape;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // nbradbury 01-Apr-2013\n&#x27;
                           &#x27;    private NoteListFragment getNoteListFragment() &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        return mNoteListFragment;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onCreateOptionsMenu(Menu menu) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        super.onCreateOptionsMenu(menu);\n&#x27;
                           &#x27;        MenuInflater inflater = &#x27;
                           &#x27;getMenuInflater();\n&#x27;
                           &#x27;        inflater.inflate(R.menu.notes_list, &#x27;
                           &#x27;menu);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mSearchMenuItem = &#x27;
                           &#x27;menu.findItem(R.id.menu_search);\n&#x27;
                           &#x27;        mSearchView = (SearchView) &#x27;
                           &#x27;mSearchMenuItem.getActionView();\n&#x27;
                           &#x27;        mSearchView.setOnQueryTextListener(new &#x27;
                           &#x27;SearchView.OnQueryTextListener() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onQueryTextChange(String newText) {\n&#x27;
                           &#x27;                if (newText != null &amp;&amp; &#x27;
                           &#x27;mSearchMenuItem.isActionViewExpanded())\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;getNoteListFragment().searchNotes(newText);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onQueryTextSubmit(String queryText) {\n&#x27;
                           &#x27;                if (queryText != null)\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;getNoteListFragment().searchNotes(queryText);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mSearchMenuItem.setOnActionExpandListener(new &#x27;
                           &#x27;MenuItem.OnActionExpandListener() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onMenuItemActionExpand(MenuItem menuItem) {\n&#x27;
                           &#x27;                showDetailPlaceholder();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onMenuItemActionCollapse(MenuItem menuItem) {\n&#x27;
                           &#x27;                // Show all notes again\n&#x27;
                           &#x27;                &#x27;
                           &#x27;getNoteListFragment().clearSearch();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;        if (fm.getBackStackEntryCount() &gt; 0) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_preferences).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(true);\n&#x27;
                           &#x27;            if (mCurrentNote != null &amp;&amp; &#x27;
                           &#x27;mCurrentNote.isDeleted())\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setTitle(R.string.undelete);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_edit_tags).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(false);\n&#x27;
                           &#x27;        } else if (isLargeScreenLandscape()) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setHomeButtonEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_preferences).setVisible(true);\n&#x27;
                           &#x27;            if (mCurrentNote != null) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(true);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(true);\n&#x27;
                           &#x27;            } else {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(false);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(false);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_edit_tags).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(false);\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setHomeButtonEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_preferences).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_edit_tags).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(false);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        // Are we looking at the trash? Adjust &#x27;
                           &#x27;menu accordingly.\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(getActionBar().getSelectedNavigationIndex() == &#x27;
                           &#x27;TRASH_SELECTED_ID) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(false);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        return true;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onOptionsItemSelected(MenuItem &#x27;
                           &#x27;item) {\n&#x27;
                           &#x27;        switch (item.getItemId()) {\n&#x27;
                           &#x27;            case R.id.menu_preferences:\n&#x27;
                           &#x27;                // nbradbury - use &#x27;
                           &#x27;startActivityForResult so onActivityResult can &#x27;
                           &#x27;detect when user returns from preferences\n&#x27;
                           &#x27;                Intent i = new Intent(this, &#x27;
                           &#x27;PreferencesActivity.class);\n&#x27;
                           &#x27;                startActivityForResult(i, &#x27;
                           &#x27;Simplenote.INTENT_PREFERENCES);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_edit_tags:\n&#x27;
                           &#x27;                Intent editTagsIntent = new &#x27;
                           &#x27;Intent(this, TagsListActivity.class);\n&#x27;
                           &#x27;                startActivity(editTagsIntent);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_create_note:\n&#x27;
                           &#x27;                getNoteListFragment().addNote();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_share:\n&#x27;
                           &#x27;                if (mCurrentNote != null) {\n&#x27;
                           &#x27;                    Intent shareIntent = new &#x27;
                           &#x27;Intent(android.content.Intent.ACTION_SEND);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;shareIntent.setType(&quot;text/plain&quot;);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;shareIntent.putExtra(android.content.Intent.EXTRA_TEXT, &#x27;
                           &#x27;mCurrentNote.getContent());\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;startActivity(Intent.createChooser(shareIntent, &#x27;
                           &#x27;getResources().getString(R.string.share_note)));\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_delete:\n&#x27;
                           &#x27;                if (mNoteEditorFragment != null) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    if (mCurrentNote != null) {\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;mCurrentNote.setDeleted(!mCurrentNote.isDeleted());\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;mCurrentNote.setModificationDate(Calendar.getInstance());\n&#x27;
                           &#x27;                        mCurrentNote.save();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                        if &#x27;
                           &#x27;(mCurrentNote.isDeleted()) {\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;mUndoBarController.setDeletedNote(mCurrentNote);\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;mUndoBarController.showUndoBar(false, &#x27;
                           &#x27;getString(R.string.note_deleted), null);\n&#x27;
                           &#x27;                        }\n&#x27;
                           &#x27;                        showDetailPlaceholder();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                    popNoteDetail();\n&#x27;
                           &#x27;                    NoteListFragment fragment = &#x27;
                           &#x27;getNoteListFragment();\n&#x27;
                           &#x27;                    if (fragment != null) {\n&#x27;
                           &#x27;                        fragment.getPrefs();\n&#x27;
                           &#x27;                        fragment.refreshList();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_empty_trash:\n&#x27;
                           &#x27;                AlertDialog.Builder alert = new &#x27;
                           &#x27;AlertDialog.Builder(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setTitle(R.string.empty_trash);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setMessage(R.string.confirm_empty_trash);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setPositiveButton(R.string.yes, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                    public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                        new &#x27;
                           &#x27;emptyTrashTask().execute();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                });\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setNegativeButton(R.string.no, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                    public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                        // Do nothing, just &#x27;
                           &#x27;closing the dialog\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                });\n&#x27;
                           &#x27;                alert.show();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case android.R.id.home:\n&#x27;
                           &#x27;                popNoteDetail();\n&#x27;
                           &#x27;                invalidateOptionsMenu();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            default:\n&#x27;
                           &#x27;                return &#x27;
                           &#x27;super.onOptionsItemSelected(item);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void popNoteDetail() {\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;        if (fm.getBackStackEntryCount() &gt; 0) {\n&#x27;
                           &#x27;            try {\n&#x27;
                           &#x27;                fm.popBackStack();\n&#x27;
                           &#x27;            } catch (Exception e) {\n&#x27;
                           &#x27;                e.printStackTrace();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Callback method from {@link &#x27;
                           &#x27;NoteListFragment.Callbacks} indicating that\n&#x27;
                           &#x27;     * the item with the given ID was selected.\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onNoteSelected(Note note) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (mSearchMenuItem != null)\n&#x27;
                           &#x27;            mSearchMenuItem.collapseActionView();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mCurrentNote = note;\n&#x27;
                           &#x27;        String noteKey = note == null ? &quot;none&quot; : &#x27;
                           &#x27;note.getSimperiumKey();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (!isLargeScreenLandscape()) {\n&#x27;
                           &#x27;            ActionBar ab = getActionBar();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);\n&#x27;
                           &#x27;            ab.setDisplayShowTitleEnabled(true);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            // Create editor fragment\n&#x27;
                           &#x27;            Bundle arguments = new Bundle();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;arguments.putString(NoteEditorFragment.ARG_ITEM_ID, &#x27;
                           &#x27;noteKey);\n&#x27;
                           &#x27;            mNoteEditorFragment = new &#x27;
                           &#x27;NoteEditorFragment();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;mNoteEditorFragment.setArguments(arguments);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            // Add editor fragment to stack\n&#x27;
                           &#x27;            FragmentTransaction ft = &#x27;
                           &#x27;fm.beginTransaction();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;ft.setCustomAnimations(R.animator.slide_in, &#x27;
                           &#x27;R.animator.zoom_in_and_fade, &#x27;
                           &#x27;R.animator.zoom_out_and_fade, &#x27;
                           &#x27;R.animator.slide_out);\n&#x27;
                           &#x27;            ft.replace(R.id.noteFragmentContainer, &#x27;
                           &#x27;mNoteEditorFragment);\n&#x27;
                           &#x27;            ft.addToBackStack(null);\n&#x27;
                           &#x27;            ft.commit();\n&#x27;
                           &#x27;            fm.executePendingTransactions();\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            mNoteEditorFragment.setNote(note);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getNoteListFragment().setNoteSelected(note);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        invalidateOptionsMenu();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onNavigationItemSelected(int &#x27;
                           &#x27;itemPosition, long itemId) {\n&#x27;
                           &#x27;        // TODO Auto-generated method stub\n&#x27;
                           &#x27;        return false;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;onAuthenticationStatusChange(User.AuthenticationStatus &#x27;
                           &#x27;status) {\n&#x27;
                           &#x27;        if (status == &#x27;
                           &#x27;User.AuthenticationStatus.NOT_AUTHENTICATED) {\n&#x27;
                           &#x27;            startLoginActivity();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void startLoginActivity() {\n&#x27;
                           &#x27;        Intent loginIntent = new Intent(this, &#x27;
                           &#x27;LoginActivity.class);\n&#x27;
                           &#x27;        startActivityForResult(loginIntent, &#x27;
                           &#x27;Simperium.SIGNUP_SIGNIN_REQUEST);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onActivityResult(int &#x27;
                           &#x27;requestCode, int resultCode, Intent data) {\n&#x27;
                           &#x27;        super.onActivityResult(requestCode, &#x27;
                           &#x27;resultCode, data);\n&#x27;
                           &#x27;        switch (requestCode) {\n&#x27;
                           &#x27;            case Simperium.SIGNUP_SIGNIN_REQUEST:\n&#x27;
                           &#x27;                if (resultCode == &#x27;
                           &#x27;RESULT_CANCELED)\n&#x27;
                           &#x27;                    finish();\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;            case Simplenote.INTENT_PREFERENCES:\n&#x27;
                           &#x27;                // nbradbury - refresh note list &#x27;
                           &#x27;when user returns from preferences (in case they &#x27;
                           &#x27;changed anything)\n&#x27;
                           &#x27;                NoteListFragment fragment = &#x27;
                           &#x27;getNoteListFragment();\n&#x27;
                           &#x27;                if (fragment != null) {\n&#x27;
                           &#x27;                    fragment.getPrefs();\n&#x27;
                           &#x27;                    fragment.refreshList();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onUndo(Parcelable p) {\n&#x27;
                           &#x27;        if (mUndoBarController != null &amp;&amp; &#x27;
                           &#x27;mUndoBarController.getDeletedNote() != null) {\n&#x27;
                           &#x27;            Note deletedNote = &#x27;
                           &#x27;mUndoBarController.getDeletedNote();\n&#x27;
                           &#x27;            if (deletedNote != null) {\n&#x27;
                           &#x27;                deletedNote.setDeleted(false);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;deletedNote.setModificationDate(Calendar.getInstance());\n&#x27;
                           &#x27;                deletedNote.save();\n&#x27;
                           &#x27;                NoteListFragment fragment = &#x27;
                           &#x27;getNoteListFragment();\n&#x27;
                           &#x27;                if (fragment != null) {\n&#x27;
                           &#x27;                    fragment.getPrefs();\n&#x27;
                           &#x27;                    fragment.refreshList();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onBackStackChanged() {\n&#x27;
                           &#x27;        configureActionBar();\n&#x27;
                           &#x27;        invalidateOptionsMenu();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private void configureActionBar() {\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(getFragmentManager().getBackStackEntryCount() &gt; &#x27;
                           &#x27;0) {\n&#x27;
                           &#x27;            ActionBar ab = getActionBar();\n&#x27;
                           &#x27;            if (ab != null) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setDisplayShowTitleEnabled(true);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            ActionBar ab = getActionBar();\n&#x27;
                           &#x27;            if (ab != null) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setDisplayShowTitleEnabled(false);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;onConfigurationChanged(Configuration newConfig) {\n&#x27;
                           &#x27;        super.onConfigurationChanged(newConfig);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (mIsLargeScreen) {\n&#x27;
                           &#x27;            if (newConfig.orientation == &#x27;
                           &#x27;Configuration.ORIENTATION_LANDSCAPE) {\n&#x27;
                           &#x27;                // Add the editor fragment\n&#x27;
                           &#x27;                mIsLandscape = true;\n&#x27;
                           &#x27;                popNoteDetail();\n&#x27;
                           &#x27;                addEditorFragment();\n&#x27;
                           &#x27;                if (mNoteListFragment != null) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteListFragment.setActivateOnItemClick(true);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                // Select the current note on a &#x27;
                           &#x27;tablet\n&#x27;
                           &#x27;                if (mCurrentNote != null)\n&#x27;
                           &#x27;                    onNoteSelected(mCurrentNote);\n&#x27;
                           &#x27;                invalidateOptionsMenu();\n&#x27;
                           &#x27;            } else if (newConfig.orientation == &#x27;
                           &#x27;Configuration.ORIENTATION_PORTRAIT &amp;&amp; &#x27;
                           &#x27;mNoteEditorFragment != null) {\n&#x27;
                           &#x27;                // Remove the editor fragment when &#x27;
                           &#x27;rotating back to portrait\n&#x27;
                           &#x27;                mIsLandscape = false;\n&#x27;
                           &#x27;                mCurrentNote = null;\n&#x27;
                           &#x27;                if (mNoteListFragment != null) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteListFragment.setActivateOnItemClick(false);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteListFragment.refreshList();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;                FragmentTransaction ft = &#x27;
                           &#x27;fm.beginTransaction();\n&#x27;
                           &#x27;                ft.remove(mNoteEditorFragment);\n&#x27;
                           &#x27;                mNoteEditorFragment = null;\n&#x27;
                           &#x27;                ft.commit();\n&#x27;
                           &#x27;                fm.executePendingTransactions();\n&#x27;
                           &#x27;                invalidateOptionsMenu();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void showDetailPlaceholder() {\n&#x27;
                           &#x27;        if (isLargeScreenLandscape() &amp;&amp; &#x27;
                           &#x27;mNoteEditorFragment != null) {\n&#x27;
                           &#x27;            mCurrentNote = null;\n&#x27;
                           &#x27;            invalidateOptionsMenu();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;mNoteEditorFragment.setPlaceholderVisible(true);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class emptyTrashTask extends &#x27;
                           &#x27;AsyncTask&lt;Void, Void, Void&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        protected Void doInBackground(Void... &#x27;
                           &#x27;voids) {\n&#x27;
                           &#x27;            Simplenote application = (Simplenote) &#x27;
                           &#x27;getApplication();\n&#x27;
                           &#x27;            Bucket&lt;Note&gt; noteBucket = &#x27;
                           &#x27;application.getNotesBucket();\n&#x27;
                           &#x27;            Query&lt;Note&gt; query = &#x27;
                           &#x27;Note.allDeleted(noteBucket);\n&#x27;
                           &#x27;            Bucket.ObjectCursor c = &#x27;
                           &#x27;query.execute();\n&#x27;
                           &#x27;            while (c.moveToNext()) {\n&#x27;
                           &#x27;                c.getObject().delete();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            return null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;package com.automattic.simplenote;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import android.app.ActionBar;\n&#x27;
                           &#x27;import android.app.Activity;\n&#x27;
                           &#x27;import android.app.AlertDialog;\n&#x27;
                           &#x27;import android.app.FragmentManager;\n&#x27;
                           &#x27;import android.app.FragmentTransaction;\n&#x27;
                           &#x27;import android.content.DialogInterface;\n&#x27;
                           &#x27;import android.content.Intent;\n&#x27;
                           &#x27;import android.content.res.Configuration;\n&#x27;
                           &#x27;import android.os.AsyncTask;\n&#x27;
                           &#x27;import android.os.Bundle;\n&#x27;
                           &#x27;import android.os.Parcelable;\n&#x27;
                           &#x27;import android.view.Menu;\n&#x27;
                           &#x27;import android.view.MenuInflater;\n&#x27;
                           &#x27;import android.view.MenuItem;\n&#x27;
                           &#x27;import android.widget.SearchView;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.automattic.simplenote.models.Note;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.automattic.simplenote.utils.UndoBarController;\n&#x27;
                           &#x27;import com.simperium.Simperium;\n&#x27;
                           &#x27;import com.simperium.client.Bucket;\n&#x27;
                           &#x27;import com.simperium.client.LoginActivity;\n&#x27;
                           &#x27;import com.simperium.client.Query;\n&#x27;
                           &#x27;import com.simperium.client.User;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.util.Calendar;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * An activity representing a list of Notes.\n&#x27;
                           &#x27; * &lt;p/&gt;\n&#x27;
                           &#x27; * The activity makes heavy use of fragments. The &#x27;
                           &#x27;list of items is a\n&#x27;
                           &#x27; * {@link NoteListFragment} and the item details &#x27;
                           &#x27;(if present) is a\n&#x27;
                           &#x27; * {@link NoteEditorFragment}.\n&#x27;
                           &#x27; * &lt;p/&gt;\n&#x27;
                           &#x27; * This activity also implements the required &#x27;
                           &#x27;{@link NoteListFragment.Callbacks}\n&#x27;
                           &#x27; * interface to listen for item selections.\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;public class NotesActivity extends Activity &#x27;
                           &#x27;implements\n&#x27;
                           &#x27;        NoteListFragment.Callbacks, &#x27;
                           &#x27;ActionBar.OnNavigationListener,\n&#x27;
                           &#x27;        User.AuthenticationListener, &#x27;
                           &#x27;UndoBarController.UndoListener,\n&#x27;
                           &#x27;        &#x27;
                           &#x27;FragmentManager.OnBackStackChangedListener, &#x27;
                           &#x27;Bucket.Listener&lt;Note&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private boolean mIsLargeScreen, mIsLandscape;\n&#x27;
                           &#x27;    private UndoBarController mUndoBarController;\n&#x27;
                           &#x27;    private SearchView mSearchView;\n&#x27;
                           &#x27;    private MenuItem mSearchMenuItem;\n&#x27;
                           &#x27;    private NoteListFragment mNoteListFragment;\n&#x27;
                           &#x27;    private NoteEditorFragment &#x27;
                           &#x27;mNoteEditorFragment;\n&#x27;
                           &#x27;    private Note mCurrentNote;\n&#x27;
                           &#x27;    private Bucket&lt;Note&gt; mNotesBucket;\n&#x27;
                           &#x27;    private int TRASH_SELECTED_ID = 1;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static String TAG_NOTE_LIST = &#x27;
                           &#x27;&quot;noteList&quot;;\n&#x27;
                           &#x27;    public static String TAG_NOTE_EDITOR = &#x27;
                           &#x27;&quot;noteEditor&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onCreate(Bundle &#x27;
                           &#x27;savedInstanceState) {\n&#x27;
                           &#x27;        super.onCreate(savedInstanceState);\n&#x27;
                           &#x27;        Simplenote currentApp = (Simplenote) &#x27;
                           &#x27;getApplication();\n&#x27;
                           &#x27;        mNotesBucket = &#x27;
                           &#x27;currentApp.getNotesBucket();\n&#x27;
                           &#x27;        setContentView(R.layout.activity_notes);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (savedInstanceState == null) {\n&#x27;
                           &#x27;            mNoteListFragment = new &#x27;
                           &#x27;NoteListFragment();\n&#x27;
                           &#x27;            FragmentTransaction &#x27;
                           &#x27;fragmentTransaction = &#x27;
                           &#x27;getFragmentManager().beginTransaction();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;fragmentTransaction.add(R.id.noteFragmentContainer, &#x27;
                           &#x27;mNoteListFragment, TAG_NOTE_LIST);\n&#x27;
                           &#x27;            fragmentTransaction.commit();\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            mNoteListFragment = (NoteListFragment) &#x27;
                           &#x27;getFragmentManager().findFragmentByTag(TAG_NOTE_LIST);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Configuration config = &#x27;
                           &#x27;getBaseContext().getResources().getConfiguration();\n&#x27;
                           &#x27;        if ((config.screenLayout\n&#x27;
                           &#x27;                &amp; &#x27;
                           &#x27;Configuration.SCREENLAYOUT_SIZE_MASK)\n&#x27;
                           &#x27;                &gt;= &#x27;
                           &#x27;Configuration.SCREENLAYOUT_SIZE_LARGE) {\n&#x27;
                           &#x27;            mIsLargeScreen = true;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR) &#x27;
                           &#x27;!= null) {\n&#x27;
                           &#x27;                mNoteEditorFragment = &#x27;
                           &#x27;(NoteEditorFragment) &#x27;
                           &#x27;getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR);\n&#x27;
                           &#x27;            } else if (config.orientation == &#x27;
                           &#x27;Configuration.ORIENTATION_LANDSCAPE) {\n&#x27;
                           &#x27;                mIsLandscape = true;\n&#x27;
                           &#x27;                addEditorFragment();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        ActionBar ab = getActionBar();\n&#x27;
                           &#x27;        &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);\n&#x27;
                           &#x27;        ab.setDisplayShowTitleEnabled(false);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mUndoBarController = new &#x27;
                           &#x27;UndoBarController(findViewById(R.id.undobar), &#x27;
                           &#x27;this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;getFragmentManager().addOnBackStackChangedListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (currentApp.getSimperium().getUser() == &#x27;
                           &#x27;null || &#x27;
                           &#x27;currentApp.getSimperium().getUser().needsAuthentication()) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            startLoginActivity();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        &#x27;
                           &#x27;currentApp.getSimperium().setAuthenticationListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(Intent.ACTION_SEND.equals(getIntent().getAction())) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            // Check share action\n&#x27;
                           &#x27;            Intent intent = getIntent();\n&#x27;
                           &#x27;            String text = &#x27;
                           &#x27;intent.getStringExtra(Intent.EXTRA_TEXT);\n&#x27;
                           &#x27;            if (text != null) {\n&#x27;
                           &#x27;                Note note = &#x27;
                           &#x27;mNotesBucket.newObject();\n&#x27;
                           &#x27;                note.setContent(text);\n&#x27;
                           &#x27;                note.save();\n&#x27;
                           &#x27;                onNoteSelected(note);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private void addEditorFragment() {\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;        FragmentTransaction ft = &#x27;
                           &#x27;fm.beginTransaction();\n&#x27;
                           &#x27;        mNoteEditorFragment = new &#x27;
                           &#x27;NoteEditorFragment();\n&#x27;
                           &#x27;        ft.add(R.id.noteFragmentContainer, &#x27;
                           &#x27;mNoteEditorFragment, TAG_NOTE_EDITOR);\n&#x27;
                           &#x27;        ft.commit();\n&#x27;
                           &#x27;        fm.executePendingTransactions();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onResume() {\n&#x27;
                           &#x27;        super.onResume();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.addOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.addOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.addOnDeleteObjectListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        configureActionBar();\n&#x27;
                           &#x27;        invalidateOptionsMenu();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onPause() {\n&#x27;
                           &#x27;        super.onPause();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.removeOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.removeOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.removeOnDeleteObjectListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // received a change from the network, refresh &#x27;
                           &#x27;the list and the editor\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onChange(Bucket&lt;Note&gt; bucket, &#x27;
                           &#x27;Bucket.ChangeType type, String key) {\n&#x27;
                           &#x27;        final boolean resetEditor = mCurrentNote &#x27;
                           &#x27;!= null &amp;&amp; &#x27;
                           &#x27;mCurrentNote.getSimperiumKey().equals(key);\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                mNoteListFragment.refreshList();\n&#x27;
                           &#x27;                if (!resetEditor) return;\n&#x27;
                           &#x27;                if (mNoteEditorFragment != null) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteEditorFragment.refreshContent();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onSaveObject(Bucket&lt;Note&gt; bucket, &#x27;
                           &#x27;Note object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                mNoteListFragment.refreshList();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onDeleteObject(Bucket&lt;Note&gt; &#x27;
                           &#x27;bucket, Note object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                mNoteListFragment.refreshList();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public boolean isLargeScreen() {\n&#x27;
                           &#x27;        return mIsLargeScreen;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public boolean isLargeScreenLandscape() {\n&#x27;
                           &#x27;        return mIsLargeScreen &amp;&amp; mIsLandscape;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // nbradbury 01-Apr-2013\n&#x27;
                           &#x27;    private NoteListFragment getNoteListFragment() &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        return mNoteListFragment;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onCreateOptionsMenu(Menu menu) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        super.onCreateOptionsMenu(menu);\n&#x27;
                           &#x27;        MenuInflater inflater = &#x27;
                           &#x27;getMenuInflater();\n&#x27;
                           &#x27;        inflater.inflate(R.menu.notes_list, &#x27;
                           &#x27;menu);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mSearchMenuItem = &#x27;
                           &#x27;menu.findItem(R.id.menu_search);\n&#x27;
                           &#x27;        mSearchView = (SearchView) &#x27;
                           &#x27;mSearchMenuItem.getActionView();\n&#x27;
                           &#x27;        mSearchView.setOnQueryTextListener(new &#x27;
                           &#x27;SearchView.OnQueryTextListener() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onQueryTextChange(String newText) {\n&#x27;
                           &#x27;                if (newText != null &amp;&amp; &#x27;
                           &#x27;mSearchMenuItem.isActionViewExpanded())\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;getNoteListFragment().searchNotes(newText);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onQueryTextSubmit(String queryText) {\n&#x27;
                           &#x27;                if (queryText != null)\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;getNoteListFragment().searchNotes(queryText);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mSearchMenuItem.setOnActionExpandListener(new &#x27;
                           &#x27;MenuItem.OnActionExpandListener() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onMenuItemActionExpand(MenuItem menuItem) {\n&#x27;
                           &#x27;                showDetailPlaceholder();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onMenuItemActionCollapse(MenuItem menuItem) {\n&#x27;
                           &#x27;                // Show all notes again\n&#x27;
                           &#x27;                &#x27;
                           &#x27;getNoteListFragment().clearSearch();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;        if (fm.getBackStackEntryCount() &gt; 0) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_preferences).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(true);\n&#x27;
                           &#x27;            if (mCurrentNote != null &amp;&amp; &#x27;
                           &#x27;mCurrentNote.isDeleted())\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setTitle(R.string.undelete);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_edit_tags).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(false);\n&#x27;
                           &#x27;        } else if (isLargeScreenLandscape()) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setHomeButtonEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_preferences).setVisible(true);\n&#x27;
                           &#x27;            if (mCurrentNote != null) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(true);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(true);\n&#x27;
                           &#x27;            } else {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(false);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(false);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_edit_tags).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(false);\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setHomeButtonEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_preferences).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_edit_tags).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(false);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        // Are we looking at the trash? Adjust &#x27;
                           &#x27;menu accordingly.\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(getActionBar().getSelectedNavigationIndex() == &#x27;
                           &#x27;TRASH_SELECTED_ID) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(false);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        return true;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onOptionsItemSelected(MenuItem &#x27;
                           &#x27;item) {\n&#x27;
                           &#x27;        switch (item.getItemId()) {\n&#x27;
                           &#x27;            case R.id.menu_preferences:\n&#x27;
                           &#x27;                // nbradbury - use &#x27;
                           &#x27;startActivityForResult so onActivityResult can &#x27;
                           &#x27;detect when user returns from preferences\n&#x27;
                           &#x27;                Intent i = new Intent(this, &#x27;
                           &#x27;PreferencesActivity.class);\n&#x27;
                           &#x27;                startActivityForResult(i, &#x27;
                           &#x27;Simplenote.INTENT_PREFERENCES);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_edit_tags:\n&#x27;
                           &#x27;                Intent editTagsIntent = new &#x27;
                           &#x27;Intent(this, TagsListActivity.class);\n&#x27;
                           &#x27;                startActivity(editTagsIntent);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_create_note:\n&#x27;
                           &#x27;                getNoteListFragment().addNote();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_share:\n&#x27;
                           &#x27;                if (mCurrentNote != null) {\n&#x27;
                           &#x27;                    Intent shareIntent = new &#x27;
                           &#x27;Intent(android.content.Intent.ACTION_SEND);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;shareIntent.setType(&quot;text/plain&quot;);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;shareIntent.putExtra(android.content.Intent.EXTRA_TEXT, &#x27;
                           &#x27;mCurrentNote.getContent());\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;startActivity(Intent.createChooser(shareIntent, &#x27;
                           &#x27;getResources().getString(R.string.share_note)));\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_delete:\n&#x27;
                           &#x27;                if (mNoteEditorFragment != null) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    if (mCurrentNote != null) {\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;mCurrentNote.setDeleted(!mCurrentNote.isDeleted());\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;mCurrentNote.setModificationDate(Calendar.getInstance());\n&#x27;
                           &#x27;                        mCurrentNote.save();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                        if &#x27;
                           &#x27;(mCurrentNote.isDeleted()) {\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;mUndoBarController.setDeletedNote(mCurrentNote);\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;mUndoBarController.showUndoBar(false, &#x27;
                           &#x27;getString(R.string.note_deleted), null);\n&#x27;
                           &#x27;                        }\n&#x27;
                           &#x27;                        showDetailPlaceholder();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                    popNoteDetail();\n&#x27;
                           &#x27;                    NoteListFragment fragment = &#x27;
                           &#x27;getNoteListFragment();\n&#x27;
                           &#x27;                    if (fragment != null) {\n&#x27;
                           &#x27;                        fragment.getPrefs();\n&#x27;
                           &#x27;                        fragment.refreshList();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_empty_trash:\n&#x27;
                           &#x27;                AlertDialog.Builder alert = new &#x27;
                           &#x27;AlertDialog.Builder(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setTitle(R.string.empty_trash);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setMessage(R.string.confirm_empty_trash);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setPositiveButton(R.string.yes, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                    public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                        new &#x27;
                           &#x27;emptyTrashTask().execute();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                });\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setNegativeButton(R.string.no, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                    public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                        // Do nothing, just &#x27;
                           &#x27;closing the dialog\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                });\n&#x27;
                           &#x27;                alert.show();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case android.R.id.home:\n&#x27;
                           &#x27;                popNoteDetail();\n&#x27;
                           &#x27;                invalidateOptionsMenu();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            default:\n&#x27;
                           &#x27;                return &#x27;
                           &#x27;super.onOptionsItemSelected(item);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void popNoteDetail() {\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;        if (fm.getBackStackEntryCount() &gt; 0) {\n&#x27;
                           &#x27;            try {\n&#x27;
                           &#x27;                fm.popBackStack();\n&#x27;
                           &#x27;            } catch (Exception e) {\n&#x27;
                           &#x27;                e.printStackTrace();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Callback method from {@link &#x27;
                           &#x27;NoteListFragment.Callbacks} indicating that\n&#x27;
                           &#x27;     * the item with the given ID was selected.\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onNoteSelected(Note note) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (mSearchMenuItem != null)\n&#x27;
                           &#x27;            mSearchMenuItem.collapseActionView();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mCurrentNote = note;\n&#x27;
                           &#x27;        String noteKey = note == null ? &quot;none&quot; : &#x27;
                           &#x27;note.getSimperiumKey();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (!isLargeScreenLandscape()) {\n&#x27;
                           &#x27;            ActionBar ab = getActionBar();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);\n&#x27;
                           &#x27;            ab.setDisplayShowTitleEnabled(true);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            // Create editor fragment\n&#x27;
                           &#x27;            Bundle arguments = new Bundle();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;arguments.putString(NoteEditorFragment.ARG_ITEM_ID, &#x27;
                           &#x27;noteKey);\n&#x27;
                           &#x27;            mNoteEditorFragment = new &#x27;
                           &#x27;NoteEditorFragment();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;mNoteEditorFragment.setArguments(arguments);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            // Add editor fragment to stack\n&#x27;
                           &#x27;            FragmentTransaction ft = &#x27;
                           &#x27;fm.beginTransaction();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;ft.setCustomAnimations(R.animator.slide_in, &#x27;
                           &#x27;R.animator.zoom_in_and_fade, &#x27;
                           &#x27;R.animator.zoom_out_and_fade, &#x27;
                           &#x27;R.animator.slide_out);\n&#x27;
                           &#x27;            ft.replace(R.id.noteFragmentContainer, &#x27;
                           &#x27;mNoteEditorFragment);\n&#x27;
                           &#x27;            ft.addToBackStack(null);\n&#x27;
                           &#x27;            ft.commit();\n&#x27;
                           &#x27;            fm.executePendingTransactions();\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            mNoteEditorFragment.setNote(note);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getNoteListFragment().setNoteSelected(note);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        invalidateOptionsMenu();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onNavigationItemSelected(int &#x27;
                           &#x27;itemPosition, long itemId) {\n&#x27;
                           &#x27;        // TODO Auto-generated method stub\n&#x27;
                           &#x27;        return false;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;onAuthenticationStatusChange(User.AuthenticationStatus &#x27;
                           &#x27;status) {\n&#x27;
                           &#x27;        if (status == &#x27;
                           &#x27;User.AuthenticationStatus.NOT_AUTHENTICATED) {\n&#x27;
                           &#x27;            startLoginActivity();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void startLoginActivity() {\n&#x27;
                           &#x27;        Intent loginIntent = new Intent(this, &#x27;
                           &#x27;LoginActivity.class);\n&#x27;
                           &#x27;        startActivityForResult(loginIntent, &#x27;
                           &#x27;Simperium.SIGNUP_SIGNIN_REQUEST);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onActivityResult(int &#x27;
                           &#x27;requestCode, int resultCode, Intent data) {\n&#x27;
                           &#x27;        super.onActivityResult(requestCode, &#x27;
                           &#x27;resultCode, data);\n&#x27;
                           &#x27;        switch (requestCode) {\n&#x27;
                           &#x27;            case Simperium.SIGNUP_SIGNIN_REQUEST:\n&#x27;
                           &#x27;                if (resultCode == &#x27;
                           &#x27;RESULT_CANCELED)\n&#x27;
                           &#x27;                    finish();\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;            case Simplenote.INTENT_PREFERENCES:\n&#x27;
                           &#x27;                // nbradbury - refresh note list &#x27;
                           &#x27;when user returns from preferences (in case they &#x27;
                           &#x27;changed anything)\n&#x27;
                           &#x27;                NoteListFragment fragment = &#x27;
                           &#x27;getNoteListFragment();\n&#x27;
                           &#x27;                if (fragment != null) {\n&#x27;
                           &#x27;                    fragment.getPrefs();\n&#x27;
                           &#x27;                    fragment.refreshList();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onUndo(Parcelable p) {\n&#x27;
                           &#x27;        if (mUndoBarController != null &amp;&amp; &#x27;
                           &#x27;mUndoBarController.getDeletedNote() != null) {\n&#x27;
                           &#x27;            Note deletedNote = &#x27;
                           &#x27;mUndoBarController.getDeletedNote();\n&#x27;
                           &#x27;            if (deletedNote != null) {\n&#x27;
                           &#x27;                deletedNote.setDeleted(false);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;deletedNote.setModificationDate(Calendar.getInstance());\n&#x27;
                           &#x27;                deletedNote.save();\n&#x27;
                           &#x27;                NoteListFragment fragment = &#x27;
                           &#x27;getNoteListFragment();\n&#x27;
                           &#x27;                if (fragment != null) {\n&#x27;
                           &#x27;                    fragment.getPrefs();\n&#x27;
                           &#x27;                    fragment.refreshList();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onBackStackChanged() {\n&#x27;
                           &#x27;        configureActionBar();\n&#x27;
                           &#x27;        invalidateOptionsMenu();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private void configureActionBar() {\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(getFragmentManager().getBackStackEntryCount() &gt; &#x27;
                           &#x27;0) {\n&#x27;
                           &#x27;            ActionBar ab = getActionBar();\n&#x27;
                           &#x27;            if (ab != null) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setDisplayShowTitleEnabled(true);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            ActionBar ab = getActionBar();\n&#x27;
                           &#x27;            if (ab != null) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setDisplayShowTitleEnabled(false);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;onConfigurationChanged(Configuration newConfig) {\n&#x27;
                           &#x27;        super.onConfigurationChanged(newConfig);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (mIsLargeScreen) {\n&#x27;
                           &#x27;            if (newConfig.orientation == &#x27;
                           &#x27;Configuration.ORIENTATION_LANDSCAPE) {\n&#x27;
                           &#x27;                // Add the editor fragment\n&#x27;
                           &#x27;                mIsLandscape = true;\n&#x27;
                           &#x27;                popNoteDetail();\n&#x27;
                           &#x27;                addEditorFragment();\n&#x27;
                           &#x27;                if (mNoteListFragment != null) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteListFragment.setActivateOnItemClick(true);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                // Select the current note on a &#x27;
                           &#x27;tablet\n&#x27;
                           &#x27;                if (mCurrentNote != null)\n&#x27;
                           &#x27;                    onNoteSelected(mCurrentNote);\n&#x27;
                           &#x27;                invalidateOptionsMenu();\n&#x27;
                           &#x27;            } else if (newConfig.orientation == &#x27;
                           &#x27;Configuration.ORIENTATION_PORTRAIT &amp;&amp; &#x27;
                           &#x27;mNoteEditorFragment != null) {\n&#x27;
                           &#x27;                // Remove the editor fragment when &#x27;
                           &#x27;rotating back to portrait\n&#x27;
                           &#x27;                mIsLandscape = false;\n&#x27;
                           &#x27;                mCurrentNote = null;\n&#x27;
                           &#x27;                if (mNoteListFragment != null) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteListFragment.setActivateOnItemClick(false);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteListFragment.refreshList();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;                FragmentTransaction ft = &#x27;
                           &#x27;fm.beginTransaction();\n&#x27;
                           &#x27;                ft.remove(mNoteEditorFragment);\n&#x27;
                           &#x27;                mNoteEditorFragment = null;\n&#x27;
                           &#x27;                ft.commit();\n&#x27;
                           &#x27;                fm.executePendingTransactions();\n&#x27;
                           &#x27;                invalidateOptionsMenu();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void showDetailPlaceholder() {\n&#x27;
                           &#x27;        if (isLargeScreenLandscape() &amp;&amp; &#x27;
                           &#x27;mNoteEditorFragment != null) {\n&#x27;
                           &#x27;            mCurrentNote = null;\n&#x27;
                           &#x27;            invalidateOptionsMenu();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;mNoteEditorFragment.setPlaceholderVisible(true);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class emptyTrashTask extends &#x27;
                           &#x27;AsyncTask&lt;Void, Void, Void&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        protected Void doInBackground(Void... &#x27;
                           &#x27;voids) {\n&#x27;
                           &#x27;            Simplenote application = (Simplenote) &#x27;
                           &#x27;getApplication();\n&#x27;
                           &#x27;            Bucket&lt;Note&gt; noteBucket = &#x27;
                           &#x27;application.getNotesBucket();\n&#x27;
                           &#x27;            Query&lt;Note&gt; query = &#x27;
                           &#x27;Note.allDeleted(noteBucket);\n&#x27;
                           &#x27;            Bucket.ObjectCursor c = &#x27;
                           &#x27;query.execute();\n&#x27;
                           &#x27;            while (c.moveToNext()) {\n&#x27;
                           &#x27;                c.getObject().delete();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            return null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;\n&#x27;
                           &#x27;package com.automattic.simplenote;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import android.app.ActionBar;\n&#x27;
                           &#x27;import android.app.Activity;\n&#x27;
                           &#x27;import android.app.AlertDialog;\n&#x27;
                           &#x27;import android.app.FragmentManager;\n&#x27;
                           &#x27;import android.app.FragmentTransaction;\n&#x27;
                           &#x27;import android.content.DialogInterface;\n&#x27;
                           &#x27;import android.content.Intent;\n&#x27;
                           &#x27;import android.content.res.Configuration;\n&#x27;
                           &#x27;import android.os.AsyncTask;\n&#x27;
                           &#x27;import android.os.Bundle;\n&#x27;
                           &#x27;import android.os.Parcelable;\n&#x27;
                           &#x27;import android.view.Menu;\n&#x27;
                           &#x27;import android.view.MenuInflater;\n&#x27;
                           &#x27;import android.view.MenuItem;\n&#x27;
                           &#x27;import android.widget.SearchView;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.automattic.simplenote.models.Note;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.automattic.simplenote.utils.UndoBarController;\n&#x27;
                           &#x27;import com.simperium.Simperium;\n&#x27;
                           &#x27;import com.simperium.client.Bucket;\n&#x27;
                           &#x27;import com.simperium.client.LoginActivity;\n&#x27;
                           &#x27;import com.simperium.client.Query;\n&#x27;
                           &#x27;import com.simperium.client.User;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.util.Calendar;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * An activity representing a list of Notes.\n&#x27;
                           &#x27; * &lt;p/&gt;\n&#x27;
                           &#x27; * The activity makes heavy use of fragments. The &#x27;
                           &#x27;list of items is a\n&#x27;
                           &#x27; * {@link NoteListFragment} and the item details &#x27;
                           &#x27;(if present) is a\n&#x27;
                           &#x27; * {@link NoteEditorFragment}.\n&#x27;
                           &#x27; * &lt;p/&gt;\n&#x27;
                           &#x27; * This activity also implements the required &#x27;
                           &#x27;{@link NoteListFragment.Callbacks}\n&#x27;
                           &#x27; * interface to listen for item selections.\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;public class NotesActivity extends Activity &#x27;
                           &#x27;implements\n&#x27;
                           &#x27;        NoteListFragment.Callbacks, &#x27;
                           &#x27;ActionBar.OnNavigationListener,\n&#x27;
                           &#x27;        User.AuthenticationListener, &#x27;
                           &#x27;UndoBarController.UndoListener,\n&#x27;
                           &#x27;        &#x27;
                           &#x27;FragmentManager.OnBackStackChangedListener, &#x27;
                           &#x27;Bucket.Listener&lt;Note&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private boolean mIsLargeScreen, mIsLandscape;\n&#x27;
                           &#x27;    private UndoBarController mUndoBarController;\n&#x27;
                           &#x27;    private SearchView mSearchView;\n&#x27;
                           &#x27;    private MenuItem mSearchMenuItem;\n&#x27;
                           &#x27;    private NoteListFragment mNoteListFragment;\n&#x27;
                           &#x27;    private NoteEditorFragment &#x27;
                           &#x27;mNoteEditorFragment;\n&#x27;
                           &#x27;    private Note mCurrentNote;\n&#x27;
                           &#x27;    private Bucket&lt;Note&gt; mNotesBucket;\n&#x27;
                           &#x27;    private int TRASH_SELECTED_ID = 1;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static String TAG_NOTE_LIST = &#x27;
                           &#x27;&quot;noteList&quot;;\n&#x27;
                           &#x27;    public static String TAG_NOTE_EDITOR = &#x27;
                           &#x27;&quot;noteEditor&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onCreate(Bundle &#x27;
                           &#x27;savedInstanceState) {\n&#x27;
                           &#x27;        super.onCreate(savedInstanceState);\n&#x27;
                           &#x27;        Simplenote currentApp = (Simplenote) &#x27;
                           &#x27;getApplication();\n&#x27;
                           &#x27;        mNotesBucket = &#x27;
                           &#x27;currentApp.getNotesBucket();\n&#x27;
                           &#x27;        setContentView(R.layout.activity_notes);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (savedInstanceState == null) {\n&#x27;
                           &#x27;            mNoteListFragment = new &#x27;
                           &#x27;NoteListFragment();\n&#x27;
                           &#x27;            FragmentTransaction &#x27;
                           &#x27;fragmentTransaction = &#x27;
                           &#x27;getFragmentManager().beginTransaction();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;fragmentTransaction.add(R.id.noteFragmentContainer, &#x27;
                           &#x27;mNoteListFragment, TAG_NOTE_LIST);\n&#x27;
                           &#x27;            fragmentTransaction.commit();\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            mNoteListFragment = (NoteListFragment) &#x27;
                           &#x27;getFragmentManager().findFragmentByTag(TAG_NOTE_LIST);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Configuration config = &#x27;
                           &#x27;getBaseContext().getResources().getConfiguration();\n&#x27;
                           &#x27;        if ((config.screenLayout\n&#x27;
                           &#x27;                &amp; &#x27;
                           &#x27;Configuration.SCREENLAYOUT_SIZE_MASK)\n&#x27;
                           &#x27;                &gt;= &#x27;
                           &#x27;Configuration.SCREENLAYOUT_SIZE_LARGE) {\n&#x27;
                           &#x27;            mIsLargeScreen = true;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR) &#x27;
                           &#x27;!= null) {\n&#x27;
                           &#x27;                mNoteEditorFragment = &#x27;
                           &#x27;(NoteEditorFragment) &#x27;
                           &#x27;getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR);\n&#x27;
                           &#x27;            } else if (config.orientation == &#x27;
                           &#x27;Configuration.ORIENTATION_LANDSCAPE) {\n&#x27;
                           &#x27;                mIsLandscape = true;\n&#x27;
                           &#x27;                addEditorFragment();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        ActionBar ab = getActionBar();\n&#x27;
                           &#x27;        &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);\n&#x27;
                           &#x27;        ab.setDisplayShowTitleEnabled(false);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mUndoBarController = new &#x27;
                           &#x27;UndoBarController(findViewById(R.id.undobar), &#x27;
                           &#x27;this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;getFragmentManager().addOnBackStackChangedListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (currentApp.getSimperium().getUser() == &#x27;
                           &#x27;null || &#x27;
                           &#x27;currentApp.getSimperium().getUser().needsAuthentication()) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            startLoginActivity();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        &#x27;
                           &#x27;currentApp.getSimperium().setAuthenticationListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(Intent.ACTION_SEND.equals(getIntent().getAction())) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            // Check share action\n&#x27;
                           &#x27;            Intent intent = getIntent();\n&#x27;
                           &#x27;            String text = &#x27;
                           &#x27;intent.getStringExtra(Intent.EXTRA_TEXT);\n&#x27;
                           &#x27;            if (text != null) {\n&#x27;
                           &#x27;                Note note = &#x27;
                           &#x27;mNotesBucket.newObject();\n&#x27;
                           &#x27;                note.setContent(text);\n&#x27;
                           &#x27;                note.save();\n&#x27;
                           &#x27;                onNoteSelected(note);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private void addEditorFragment() {\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;        FragmentTransaction ft = &#x27;
                           &#x27;fm.beginTransaction();\n&#x27;
                           &#x27;        mNoteEditorFragment = new &#x27;
                           &#x27;NoteEditorFragment();\n&#x27;
                           &#x27;        ft.add(R.id.noteFragmentContainer, &#x27;
                           &#x27;mNoteEditorFragment, TAG_NOTE_EDITOR);\n&#x27;
                           &#x27;        ft.commit();\n&#x27;
                           &#x27;        fm.executePendingTransactions();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onResume() {\n&#x27;
                           &#x27;        super.onResume();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.addOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.addOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.addOnDeleteObjectListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        configureActionBar();\n&#x27;
                           &#x27;        invalidateOptionsMenu();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onPause() {\n&#x27;
                           &#x27;        super.onPause();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.removeOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.removeOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mNotesBucket.removeOnDeleteObjectListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // received a change from the network, refresh &#x27;
                           &#x27;the list and the editor\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onChange(Bucket&lt;Note&gt; bucket, &#x27;
                           &#x27;Bucket.ChangeType type, String key) {\n&#x27;
                           &#x27;        final boolean resetEditor = mCurrentNote &#x27;
                           &#x27;!= null &amp;&amp; &#x27;
                           &#x27;mCurrentNote.getSimperiumKey().equals(key);\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                mNoteListFragment.refreshList();\n&#x27;
                           &#x27;                if (!resetEditor) return;\n&#x27;
                           &#x27;                if (mNoteEditorFragment != null) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteEditorFragment.refreshContent();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onSaveObject(Bucket&lt;Note&gt; bucket, &#x27;
                           &#x27;Note object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                mNoteListFragment.refreshList();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onDeleteObject(Bucket&lt;Note&gt; &#x27;
                           &#x27;bucket, Note object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                mNoteListFragment.refreshList();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public boolean isLargeScreen() {\n&#x27;
                           &#x27;        return mIsLargeScreen;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public boolean isLargeScreenLandscape() {\n&#x27;
                           &#x27;        return mIsLargeScreen &amp;&amp; mIsLandscape;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // nbradbury 01-Apr-2013\n&#x27;
                           &#x27;    private NoteListFragment getNoteListFragment() &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        return mNoteListFragment;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onCreateOptionsMenu(Menu menu) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        super.onCreateOptionsMenu(menu);\n&#x27;
                           &#x27;        MenuInflater inflater = &#x27;
                           &#x27;getMenuInflater();\n&#x27;
                           &#x27;        inflater.inflate(R.menu.notes_list, &#x27;
                           &#x27;menu);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mSearchMenuItem = &#x27;
                           &#x27;menu.findItem(R.id.menu_search);\n&#x27;
                           &#x27;        mSearchView = (SearchView) &#x27;
                           &#x27;mSearchMenuItem.getActionView();\n&#x27;
                           &#x27;        mSearchView.setOnQueryTextListener(new &#x27;
                           &#x27;SearchView.OnQueryTextListener() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onQueryTextChange(String newText) {\n&#x27;
                           &#x27;                if (newText != null &amp;&amp; &#x27;
                           &#x27;mSearchMenuItem.isActionViewExpanded())\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;getNoteListFragment().searchNotes(newText);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onQueryTextSubmit(String queryText) {\n&#x27;
                           &#x27;                if (queryText != null)\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;getNoteListFragment().searchNotes(queryText);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mSearchMenuItem.setOnActionExpandListener(new &#x27;
                           &#x27;MenuItem.OnActionExpandListener() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onMenuItemActionExpand(MenuItem menuItem) {\n&#x27;
                           &#x27;                showDetailPlaceholder();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public boolean &#x27;
                           &#x27;onMenuItemActionCollapse(MenuItem menuItem) {\n&#x27;
                           &#x27;                // Show all notes again\n&#x27;
                           &#x27;                &#x27;
                           &#x27;getNoteListFragment().clearSearch();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;        if (fm.getBackStackEntryCount() &gt; 0) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_preferences).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(true);\n&#x27;
                           &#x27;            if (mCurrentNote != null &amp;&amp; &#x27;
                           &#x27;mCurrentNote.isDeleted())\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setTitle(R.string.undelete);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_edit_tags).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(false);\n&#x27;
                           &#x27;        } else if (isLargeScreenLandscape()) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setHomeButtonEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_preferences).setVisible(true);\n&#x27;
                           &#x27;            if (mCurrentNote != null) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(true);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(true);\n&#x27;
                           &#x27;            } else {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(false);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(false);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_edit_tags).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(false);\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getActionBar().setHomeButtonEnabled(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_preferences).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_delete).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_edit_tags).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(false);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        // Are we looking at the trash? Adjust &#x27;
                           &#x27;menu accordingly.\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(getActionBar().getSelectedNavigationIndex() == &#x27;
                           &#x27;TRASH_SELECTED_ID) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_empty_trash).setVisible(true);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_create_note).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_search).setVisible(false);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;menu.findItem(R.id.menu_share).setVisible(false);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        return true;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onOptionsItemSelected(MenuItem &#x27;
                           &#x27;item) {\n&#x27;
                           &#x27;        switch (item.getItemId()) {\n&#x27;
                           &#x27;            case R.id.menu_preferences:\n&#x27;
                           &#x27;                // nbradbury - use &#x27;
                           &#x27;startActivityForResult so onActivityResult can &#x27;
                           &#x27;detect when user returns from preferences\n&#x27;
                           &#x27;                Intent i = new Intent(this, &#x27;
                           &#x27;PreferencesActivity.class);\n&#x27;
                           &#x27;                startActivityForResult(i, &#x27;
                           &#x27;Simplenote.INTENT_PREFERENCES);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_edit_tags:\n&#x27;
                           &#x27;                Intent editTagsIntent = new &#x27;
                           &#x27;Intent(this, TagsListActivity.class);\n&#x27;
                           &#x27;                startActivity(editTagsIntent);\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_create_note:\n&#x27;
                           &#x27;                getNoteListFragment().addNote();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_share:\n&#x27;
                           &#x27;                if (mCurrentNote != null) {\n&#x27;
                           &#x27;                    Intent shareIntent = new &#x27;
                           &#x27;Intent(android.content.Intent.ACTION_SEND);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;shareIntent.setType(&quot;text/plain&quot;);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;shareIntent.putExtra(android.content.Intent.EXTRA_TEXT, &#x27;
                           &#x27;mCurrentNote.getContent());\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;startActivity(Intent.createChooser(shareIntent, &#x27;
                           &#x27;getResources().getString(R.string.share_note)));\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_delete:\n&#x27;
                           &#x27;                if (mNoteEditorFragment != null) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    if (mCurrentNote != null) {\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;mCurrentNote.setDeleted(!mCurrentNote.isDeleted());\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;mCurrentNote.setModificationDate(Calendar.getInstance());\n&#x27;
                           &#x27;                        mCurrentNote.save();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                        if &#x27;
                           &#x27;(mCurrentNote.isDeleted()) {\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;mUndoBarController.setDeletedNote(mCurrentNote);\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;mUndoBarController.showUndoBar(false, &#x27;
                           &#x27;getString(R.string.note_deleted), null);\n&#x27;
                           &#x27;                        }\n&#x27;
                           &#x27;                        showDetailPlaceholder();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                    popNoteDetail();\n&#x27;
                           &#x27;                    NoteListFragment fragment = &#x27;
                           &#x27;getNoteListFragment();\n&#x27;
                           &#x27;                    if (fragment != null) {\n&#x27;
                           &#x27;                        fragment.getPrefs();\n&#x27;
                           &#x27;                        fragment.refreshList();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case R.id.menu_empty_trash:\n&#x27;
                           &#x27;                AlertDialog.Builder alert = new &#x27;
                           &#x27;AlertDialog.Builder(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setTitle(R.string.empty_trash);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setMessage(R.string.confirm_empty_trash);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setPositiveButton(R.string.yes, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                    public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                        new &#x27;
                           &#x27;emptyTrashTask().execute();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                });\n&#x27;
                           &#x27;                &#x27;
                           &#x27;alert.setNegativeButton(R.string.no, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                    public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                        // Do nothing, just &#x27;
                           &#x27;closing the dialog\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                });\n&#x27;
                           &#x27;                alert.show();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            case android.R.id.home:\n&#x27;
                           &#x27;                popNoteDetail();\n&#x27;
                           &#x27;                invalidateOptionsMenu();\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            default:\n&#x27;
                           &#x27;                return &#x27;
                           &#x27;super.onOptionsItemSelected(item);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void popNoteDetail() {\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;        if (fm.getBackStackEntryCount() &gt; 0) {\n&#x27;
                           &#x27;            try {\n&#x27;
                           &#x27;                fm.popBackStack();\n&#x27;
                           &#x27;            } catch (Exception e) {\n&#x27;
                           &#x27;                e.printStackTrace();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Callback method from {@link &#x27;
                           &#x27;NoteListFragment.Callbacks} indicating that\n&#x27;
                           &#x27;     * the item with the given ID was selected.\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onNoteSelected(Note note) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (mSearchMenuItem != null)\n&#x27;
                           &#x27;            mSearchMenuItem.collapseActionView();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mCurrentNote = note;\n&#x27;
                           &#x27;        String noteKey = note == null ? &quot;none&quot; : &#x27;
                           &#x27;note.getSimperiumKey();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (!isLargeScreenLandscape()) {\n&#x27;
                           &#x27;            ActionBar ab = getActionBar();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);\n&#x27;
                           &#x27;            ab.setDisplayShowTitleEnabled(true);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            // Create editor fragment\n&#x27;
                           &#x27;            Bundle arguments = new Bundle();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;arguments.putString(NoteEditorFragment.ARG_ITEM_ID, &#x27;
                           &#x27;noteKey);\n&#x27;
                           &#x27;            mNoteEditorFragment = new &#x27;
                           &#x27;NoteEditorFragment();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;mNoteEditorFragment.setArguments(arguments);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            // Add editor fragment to stack\n&#x27;
                           &#x27;            FragmentTransaction ft = &#x27;
                           &#x27;fm.beginTransaction();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;ft.setCustomAnimations(R.animator.slide_in, &#x27;
                           &#x27;R.animator.zoom_in_and_fade, &#x27;
                           &#x27;R.animator.zoom_out_and_fade, &#x27;
                           &#x27;R.animator.slide_out);\n&#x27;
                           &#x27;            ft.replace(R.id.noteFragmentContainer, &#x27;
                           &#x27;mNoteEditorFragment);\n&#x27;
                           &#x27;            ft.addToBackStack(null);\n&#x27;
                           &#x27;            ft.commit();\n&#x27;
                           &#x27;            fm.executePendingTransactions();\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            mNoteEditorFragment.setNote(note);\n&#x27;
                           &#x27;            &#x27;
                           &#x27;getNoteListFragment().setNoteSelected(note);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        invalidateOptionsMenu();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onNavigationItemSelected(int &#x27;
                           &#x27;itemPosition, long itemId) {\n&#x27;
                           &#x27;        // TODO Auto-generated method stub\n&#x27;
                           &#x27;        return false;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;onAuthenticationStatusChange(User.AuthenticationStatus &#x27;
                           &#x27;status) {\n&#x27;
                           &#x27;        if (status == &#x27;
                           &#x27;User.AuthenticationStatus.NOT_AUTHENTICATED) {\n&#x27;
                           &#x27;            startLoginActivity();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void startLoginActivity() {\n&#x27;
                           &#x27;        Intent loginIntent = new Intent(this, &#x27;
                           &#x27;LoginActivity.class);\n&#x27;
                           &#x27;        startActivityForResult(loginIntent, &#x27;
                           &#x27;Simperium.SIGNUP_SIGNIN_REQUEST);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onActivityResult(int &#x27;
                           &#x27;requestCode, int resultCode, Intent data) {\n&#x27;
                           &#x27;        super.onActivityResult(requestCode, &#x27;
                           &#x27;resultCode, data);\n&#x27;
                           &#x27;        switch (requestCode) {\n&#x27;
                           &#x27;            case Simperium.SIGNUP_SIGNIN_REQUEST:\n&#x27;
                           &#x27;                if (resultCode == &#x27;
                           &#x27;RESULT_CANCELED)\n&#x27;
                           &#x27;                    finish();\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;            case Simplenote.INTENT_PREFERENCES:\n&#x27;
                           &#x27;                // nbradbury - refresh note list &#x27;
                           &#x27;when user returns from preferences (in case they &#x27;
                           &#x27;changed anything)\n&#x27;
                           &#x27;                NoteListFragment fragment = &#x27;
                           &#x27;getNoteListFragment();\n&#x27;
                           &#x27;                if (fragment != null) {\n&#x27;
                           &#x27;                    fragment.getPrefs();\n&#x27;
                           &#x27;                    fragment.refreshList();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onUndo(Parcelable p) {\n&#x27;
                           &#x27;        if (mUndoBarController != null &amp;&amp; &#x27;
                           &#x27;mUndoBarController.getDeletedNote() != null) {\n&#x27;
                           &#x27;            Note deletedNote = &#x27;
                           &#x27;mUndoBarController.getDeletedNote();\n&#x27;
                           &#x27;            if (deletedNote != null) {\n&#x27;
                           &#x27;                deletedNote.setDeleted(false);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;deletedNote.setModificationDate(Calendar.getInstance());\n&#x27;
                           &#x27;                deletedNote.save();\n&#x27;
                           &#x27;                NoteListFragment fragment = &#x27;
                           &#x27;getNoteListFragment();\n&#x27;
                           &#x27;                if (fragment != null) {\n&#x27;
                           &#x27;                    fragment.getPrefs();\n&#x27;
                           &#x27;                    fragment.refreshList();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onBackStackChanged() {\n&#x27;
                           &#x27;        configureActionBar();\n&#x27;
                           &#x27;        invalidateOptionsMenu();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private void configureActionBar() {\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(getFragmentManager().getBackStackEntryCount() &gt; &#x27;
                           &#x27;0) {\n&#x27;
                           &#x27;            ActionBar ab = getActionBar();\n&#x27;
                           &#x27;            if (ab != null) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setDisplayShowTitleEnabled(true);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            ActionBar ab = getActionBar();\n&#x27;
                           &#x27;            if (ab != null) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);\n&#x27;
                           &#x27;                &#x27;
                           &#x27;ab.setDisplayShowTitleEnabled(false);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;onConfigurationChanged(Configuration newConfig) {\n&#x27;
                           &#x27;        super.onConfigurationChanged(newConfig);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (mIsLargeScreen) {\n&#x27;
                           &#x27;            if (newConfig.orientation == &#x27;
                           &#x27;Configuration.ORIENTATION_LANDSCAPE) {\n&#x27;
                           &#x27;                // Add the editor fragment\n&#x27;
                           &#x27;                mIsLandscape = true;\n&#x27;
                           &#x27;                popNoteDetail();\n&#x27;
                           &#x27;                addEditorFragment();\n&#x27;
                           &#x27;                if (mNoteListFragment != null) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteListFragment.setActivateOnItemClick(true);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                // Select the current note on a &#x27;
                           &#x27;tablet\n&#x27;
                           &#x27;                if (mCurrentNote != null)\n&#x27;
                           &#x27;                    onNoteSelected(mCurrentNote);\n&#x27;
                           &#x27;                invalidateOptionsMenu();\n&#x27;
                           &#x27;            } else if (newConfig.orientation == &#x27;
                           &#x27;Configuration.ORIENTATION_PORTRAIT &amp;&amp; &#x27;
                           &#x27;mNoteEditorFragment != null) {\n&#x27;
                           &#x27;                // Remove the editor fragment when &#x27;
                           &#x27;rotating back to portrait\n&#x27;
                           &#x27;                mIsLandscape = false;\n&#x27;
                           &#x27;                mCurrentNote = null;\n&#x27;
                           &#x27;                if (mNoteListFragment != null) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteListFragment.setActivateOnItemClick(false);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;mNoteListFragment.refreshList();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                FragmentManager fm = &#x27;
                           &#x27;getFragmentManager();\n&#x27;
                           &#x27;                FragmentTransaction ft = &#x27;
                           &#x27;fm.beginTransaction();\n&#x27;
                           &#x27;                ft.remove(mNoteEditorFragment);\n&#x27;
                           &#x27;                mNoteEditorFragment = null;\n&#x27;
                           &#x27;                ft.commit();\n&#x27;
                           &#x27;                fm.executePendingTransactions();\n&#x27;
                           &#x27;                invalidateOptionsMenu();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void showDetailPlaceholder() {\n&#x27;
                           &#x27;        if (isLargeScreenLandscape() &amp;&amp; &#x27;
                           &#x27;mNoteEditorFragment != null) {\n&#x27;
                           &#x27;            mCurrentNote = null;\n&#x27;
                           &#x27;            invalidateOptionsMenu();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;mNoteEditorFragment.setPlaceholderVisible(true);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class emptyTrashTask extends &#x27;
                           &#x27;AsyncTask&lt;Void, Void, Void&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        protected Void doInBackground(Void... &#x27;
                           &#x27;voids) {\n&#x27;
                           &#x27;            Simplenote application = (Simplenote) &#x27;
                           &#x27;getApplication();\n&#x27;
                           &#x27;            Bucket&lt;Note&gt; noteBucket = &#x27;
                           &#x27;application.getNotesBucket();\n&#x27;
                           &#x27;            Query&lt;Note&gt; query = &#x27;
                           &#x27;Note.allDeleted(noteBucket);\n&#x27;
                           &#x27;            Bucket.ObjectCursor c = &#x27;
                           &#x27;query.execute();\n&#x27;
                           &#x27;            while (c.moveToNext()) {\n&#x27;
                           &#x27;                c.getObject().delete();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            return null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;}\n&#x27;}],
   &#x27;mergers&#x27;: {&#x27;baseline&#x27;, &#x27;spork&#x27;, &#x27;jfstmerge&#x27;}}]]</pre>
          </body>
        </html>
        