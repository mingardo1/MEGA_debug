<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>37</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    37
                    <a href="36.html">prev</a>
                    <a href="38.html">next</a>
                    <a href="37_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    AriaLyy/Aria_b301590869f31d3a44039c34fcd8bec944b5b7f8_Aria/src/main/java/com/arialyy/aria/core/download/downloader/DownloadGroupUtil.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;b301590869f31d3a44039c34fcd8bec944b5b7f8:Aria/src/main/java/com/arialyy/aria/core/download/downloader/DownloadGroupUtil.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;b301590869f31d3a44039c34fcd8bec944b5b7f8^1:Aria/src/main/java/com/arialyy/aria/core/download/downloader/DownloadGroupUtil.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;b301590869f31d3a44039c34fcd8bec944b5b7f8^2:Aria/src/main/java/com/arialyy/aria/core/download/downloader/DownloadGroupUtil.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;426c148370677ae2daf8fd879d4a76bdfd2b7f3d:Aria/src/main/java/com/arialyy/aria/core/download/downloader/DownloadGroupUtil.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [bj]], subset: [[b], [bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="4634392904032211814" onmouseenter="enter('4634392904032211814');" onmouseout="out('4634392904032211814');" style="">  16 package com.arialyy.aria.core.download.downloader;                                                       </span>
<span  style="">  17                                                                                                          </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  18 import android.util.SparseArray;                                                                         </span>
<span class="5028823532254250595" onmouseenter="enter('5028823532254250595');" onmouseout="out('5028823532254250595');" style="">  19 import com.arialyy.aria.core.common.CompleteInfo;                                                        </span>
<span class="-3094174390533083180" onmouseenter="enter('-3094174390533083180');" onmouseout="out('-3094174390533083180');" style="">  20 import com.arialyy.aria.core.common.IUtil;                                                               </span>
<span class="-1788009330887423510" onmouseenter="enter('-1788009330887423510');" onmouseout="out('-1788009330887423510');" style="">  21 import com.arialyy.aria.core.common.OnFileInfoCallback;                                                  </span>
<span class="5290109400157436023" onmouseenter="enter('5290109400157436023');" onmouseout="out('5290109400157436023');" style="">  22 import com.arialyy.aria.core.download.DownloadGroupTaskEntity;                                           </span>
<span class="8636089030381561336" onmouseenter="enter('8636089030381561336');" onmouseout="out('8636089030381561336');" style="">  23 import com.arialyy.aria.core.download.DownloadTaskEntity;                                                </span>
<span class="-5016163043314935005" onmouseenter="enter('-5016163043314935005');" onmouseout="out('-5016163043314935005');" style="">  24 import com.arialyy.aria.core.inf.IEntity;                                                                </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  25 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  26 import java.util.Set;                                                                                    </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  27 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  28 import java.util.concurrent.Executors;                                                                   </span>
<span  style="">  29                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  30 /**                                                                                                      </span>
<span class="1321179419529258125" onmouseenter="enter('1321179419529258125');" onmouseout="out('1321179419529258125');" style="">  31  * Created by AriaL on 2017/6/30.                                                                        </span>
<span class="7496304558415279260" onmouseenter="enter('7496304558415279260');" onmouseout="out('7496304558415279260');" style="">  32  * 任务组下载工具                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  33  */                                                                                                      </span>
<span class="753905216202195114" onmouseenter="enter('753905216202195114');" onmouseout="out('753905216202195114');" style="">  34 public class DownloadGroupUtil extends AbsGroupUtil implements IUtil {                                   </span>
<span class="3933744472183840087" onmouseenter="enter('3933744472183840087');" onmouseout="out('3933744472183840087');" style="">  35   private final String TAG = &quot;DownloadGroupUtil&quot;;                                                        </span>
<span class="4123530941227175815" onmouseenter="enter('4123530941227175815');" onmouseout="out('4123530941227175815');" style="">  36   private ExecutorService mInfoPool;                                                                     </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  37 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-7564141945772075227" onmouseenter="enter('-7564141945772075227');" onmouseout="out('-7564141945772075227');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  38   private int mInitCompleteNum, mInitFailNum;                                                            </span>
<span class="7994908627964275637" onmouseenter="enter('7994908627964275637');" onmouseout="out('7994908627964275637');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  39   private boolean isStop = false, isStart = false;                                                       </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  40 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-7564141945772075227" onmouseenter="enter('-7564141945772075227');" onmouseout="out('-7564141945772075227');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41   private int mInitCompleteNum, mInitFailNum;                                                            </span>
<span class="8161357676031878454" onmouseenter="enter('8161357676031878454');" onmouseout="out('8161357676031878454');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42   private boolean isStop = false;                                                                        </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44   /**                                                                                                    </span>
<span class="6416521976967220365" onmouseenter="enter('6416521976967220365');" onmouseout="out('6416521976967220365');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45    * 文件信息回调组                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46    */                                                                                                    </span>
<span class="-5994431595118905059" onmouseenter="enter('-5994431595118905059');" onmouseout="out('-5994431595118905059');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47   private SparseArray&lt;OnFileInfoCallback&gt; mFileInfoCallbacks = new SparseArray&lt;&gt;();                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48                                                                                                          </span>
<span class="-3731711094107651611" onmouseenter="enter('-3731711094107651611');" onmouseout="out('-3731711094107651611');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49   public DownloadGroupUtil(IDownloadGroupListener listener, DownloadGroupTaskEntity taskEntity) {        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  50 =======                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  51   /**                                                                                                    </span>
<span class="1482282106677302068" onmouseenter="enter('1482282106677302068');" onmouseout="out('1482282106677302068');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  52    * 初始化完成的任务数                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  53    */                                                                                                    </span>
<span class="4248926893461222874" onmouseenter="enter('4248926893461222874');" onmouseout="out('4248926893461222874');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  54   private int mInitCompleteNum;                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  55   /**                                                                                                    </span>
<span class="5189388546664003005" onmouseenter="enter('5189388546664003005');" onmouseout="out('5189388546664003005');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  56    * 初始化失败的任务数                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  57    */                                                                                                    </span>
<span class="-2622077359609901637" onmouseenter="enter('-2622077359609901637');" onmouseout="out('-2622077359609901637');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  58   private int mInitFailNum;                                                                              </span>
<span class="8161357676031878454" onmouseenter="enter('8161357676031878454');" onmouseout="out('8161357676031878454');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  59   private boolean isStop = false;                                                                        </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  60 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span  style="">  61                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  62   /**                                                                                                    </span>
<span class="6416521976967220365" onmouseenter="enter('6416521976967220365');" onmouseout="out('6416521976967220365');" style="">  63    * 文件信息回调组                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  64    */                                                                                                    </span>
<span class="-5994431595118905059" onmouseenter="enter('-5994431595118905059');" onmouseout="out('-5994431595118905059');" style="">  65   private SparseArray&lt;OnFileInfoCallback&gt; mFileInfoCallbacks = new SparseArray&lt;&gt;();                      </span>
<span  style="">  66                                                                                                          </span>
<span class="-3731711094107651611" onmouseenter="enter('-3731711094107651611');" onmouseout="out('-3731711094107651611');" style="">  67   public DownloadGroupUtil(IDownloadGroupListener listener, DownloadGroupTaskEntity taskEntity) {        </span>
<span class="-7841553057471002442" onmouseenter="enter('-7841553057471002442');" onmouseout="out('-7841553057471002442');" style="">  68     super(listener, taskEntity);                                                                         </span>
<span class="-6453187294675473758" onmouseenter="enter('-6453187294675473758');" onmouseout="out('-6453187294675473758');" style="">  69     mInfoPool = Executors.newCachedThreadPool();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70   }                                                                                                      </span>
<span  style="">  71                                                                                                          </span>
<span class="7947472288428602188" onmouseenter="enter('7947472288428602188');" onmouseout="out('7947472288428602188');" style="">  72   @Override int getTaskType() {                                                                          </span>
<span class="-9017418965458996171" onmouseenter="enter('-9017418965458996171');" onmouseout="out('-9017418965458996171');" style="">  73     return HTTP_GROUP;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  74   }                                                                                                      </span>
<span  style="">  75                                                                                                          </span>
<span class="2093106455269248536" onmouseenter="enter('2093106455269248536');" onmouseout="out('2093106455269248536');" style="">  76   @Override public void onCancel() {                                                                     </span>
<span class="-5705545244356268786" onmouseenter="enter('-5705545244356268786');" onmouseout="out('-5705545244356268786');" style="">  77     super.onCancel();                                                                                    </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style="">  78     isStop = true;                                                                                       </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style="">  79     if (!mInfoPool.isShutdown()) {                                                                       </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style="">  80       mInfoPool.shutdown();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  81     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  82   }                                                                                                      </span>
<span  style="">  83                                                                                                          </span>
<span class="8218595092732559103" onmouseenter="enter('8218595092732559103');" onmouseout="out('8218595092732559103');" style="">  84   @Override protected void onStop() {                                                                    </span>
<span class="-4376279779571809033" onmouseenter="enter('-4376279779571809033');" onmouseout="out('-4376279779571809033');" style="">  85     super.onStop();                                                                                      </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style="">  86     isStop = true;                                                                                       </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style="">  87     if (!mInfoPool.isShutdown()) {                                                                       </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style="">  88       mInfoPool.shutdown();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  89     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90   }                                                                                                      </span>
<span  style="">  91                                                                                                          </span>
<span class="7849318491336065590" onmouseenter="enter('7849318491336065590');" onmouseout="out('7849318491336065590');" style="">  92   @Override protected void onStart() {                                                                   </span>
<span class="5012053197150764509" onmouseenter="enter('5012053197150764509');" onmouseout="out('5012053197150764509');" style="">  93     onPre();                                                                                             </span>
<span class="-8222534604477057787" onmouseenter="enter('-8222534604477057787');" onmouseout="out('-8222534604477057787');" style="">  94     isStop = false;                                                                                      </span>
<span class="7225088664243368020" onmouseenter="enter('7225088664243368020');" onmouseout="out('7225088664243368020');" style="">  95     if (mCompleteNum == mGroupSize) {                                                                    </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="">  96       mListener.onComplete();                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  97       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98     }                                                                                                    </span>
<span  style="">  99                                                                                                          </span>
<span class="-6546016058818690530" onmouseenter="enter('-6546016058818690530');" onmouseout="out('-6546016058818690530');" style=""> 100     if (mExeMap.size() == 0) {                                                                           </span>
<span class="7944887971155137312" onmouseenter="enter('7944887971155137312');" onmouseout="out('7944887971155137312');" style=""> 101       ALog.e(TAG, &quot;任务组无可执行任务&quot;);                                                                          </span>
<span class="-2850265295753937963" onmouseenter="enter('-2850265295753937963');" onmouseout="out('-2850265295753937963');" style=""> 102       mListener.onFail(false);                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 103       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104     }                                                                                                    </span>
<span class="4774762395313474868" onmouseenter="enter('4774762395313474868');" onmouseout="out('4774762395313474868');" style=""> 105     Set&lt;String&gt; keys = mExeMap.keySet();                                                                 </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style=""> 106     for (String key : keys) {                                                                            </span>
<span class="221423537684250497" onmouseenter="enter('221423537684250497');" onmouseout="out('221423537684250497');" style=""> 107       DownloadTaskEntity taskEntity = mExeMap.get(key);                                                  </span>
<span class="2875409705898122648" onmouseenter="enter('2875409705898122648');" onmouseout="out('2875409705898122648');" style=""> 108       if (taskEntity != null) {                                                                          </span>
<span class="3825460913713262848" onmouseenter="enter('3825460913713262848');" onmouseout="out('3825460913713262848');" style=""> 109         if (taskEntity.getState() != IEntity.STATE_FAIL                                                  </span>
<span class="4045344078755509632" onmouseenter="enter('4045344078755509632');" onmouseout="out('4045344078755509632');" style=""> 110             &amp;&amp; taskEntity.getState() != IEntity.STATE_WAIT) {                                            </span>
<span class="8328172117625509207" onmouseenter="enter('8328172117625509207');" onmouseout="out('8328172117625509207');" style=""> 111           mInitCompleteNum++;                                                                            </span>
<span class="-8219370924340117849" onmouseenter="enter('-8219370924340117849');" onmouseout="out('-8219370924340117849');" style=""> 112           createChildDownload(taskEntity);                                                               </span>
<span class="-8081180094332432926" onmouseenter="enter('-8081180094332432926');" onmouseout="out('-8081180094332432926');" style=""> 113           checkStartFlow();                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 114         } else {                                                                                         </span>
<span class="4135184626453358547" onmouseenter="enter('4135184626453358547');" onmouseout="out('4135184626453358547');" style=""> 115           mInfoPool.execute(createFileInfoThread(taskEntity));                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118     }                                                                                                    </span>
<span class="9042102165861284735" onmouseenter="enter('9042102165861284735');" onmouseout="out('9042102165861284735');" style=""> 119     if (mCurrentLocation == mTotalLen) {                                                                 </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 120       mListener.onComplete();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 122   }                                                                                                      </span>
<span  style=""> 123                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 124   /**                                                                                                    </span>
<span class="-4547374311767626615" onmouseenter="enter('-4547374311767626615');" onmouseout="out('-4547374311767626615');" style=""> 125    * 创建文件信息获取线程                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 126    */                                                                                                    </span>
<span class="5921359649843257629" onmouseenter="enter('5921359649843257629');" onmouseout="out('5921359649843257629');" style=""> 127   private HttpFileInfoThread createFileInfoThread(DownloadTaskEntity taskEntity) {                       </span>
<span class="3806302679560349109" onmouseenter="enter('3806302679560349109');" onmouseout="out('3806302679560349109');" style=""> 128     OnFileInfoCallback callback = mFileInfoCallbacks.get(taskEntity.hashCode());                         </span>
<span  style=""> 129                                                                                                          </span>
<span class="-5681834850649759939" onmouseenter="enter('-5681834850649759939');" onmouseout="out('-5681834850649759939');" style=""> 130     if (callback == null) {                                                                              </span>
<span class="-2247249715703717317" onmouseenter="enter('-2247249715703717317');" onmouseout="out('-2247249715703717317');" style=""> 131       callback = new OnFileInfoCallback() {                                                              </span>
<span class="4970948900553010157" onmouseenter="enter('4970948900553010157');" onmouseout="out('4970948900553010157');" style=""> 132         int failNum = 0;                                                                                 </span>
<span  style=""> 133                                                                                                          </span>
<span class="-2050288510094905379" onmouseenter="enter('-2050288510094905379');" onmouseout="out('-2050288510094905379');" style=""> 134         @Override public void onComplete(String url, CompleteInfo info) {                                </span>
<span class="1256565039411408673" onmouseenter="enter('1256565039411408673');" onmouseout="out('1256565039411408673');" style=""> 135           if (isStop) return;                                                                            </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style=""> 136           DownloadTaskEntity te = mExeMap.get(url);                                                      </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style=""> 137           if (te != null) {                                                                              </span>
<span class="-2199112578045619452" onmouseenter="enter('-2199112578045619452');" onmouseout="out('-2199112578045619452');" style=""> 138             if (isNeedLoadFileSize) {                                                                    </span>
<span class="-1062870475604154862" onmouseenter="enter('-1062870475604154862');" onmouseout="out('-1062870475604154862');" style=""> 139               mTotalLen += te.getEntity().getFileSize();                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140             }                                                                                            </span>
<span class="-6053482025677790768" onmouseenter="enter('-6053482025677790768');" onmouseout="out('-6053482025677790768');" style=""> 141             createChildDownload(te);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142           }                                                                                              </span>
<span class="8328172117625509207" onmouseenter="enter('8328172117625509207');" onmouseout="out('8328172117625509207');" style=""> 143           mInitCompleteNum++;                                                                            </span>
<span  style=""> 144                                                                                                          </span>
<span class="-8081180094332432926" onmouseenter="enter('-8081180094332432926');" onmouseout="out('-8081180094332432926');" style=""> 145           checkStartFlow();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146         }                                                                                                </span>
<span  style=""> 147                                                                                                          </span>
<span class="5765667375964195772" onmouseenter="enter('5765667375964195772');" onmouseout="out('5765667375964195772');" style=""> 148         @Override public void onFail(String url, String errorMsg, boolean needRetry) {                   </span>
<span class="1256565039411408673" onmouseenter="enter('1256565039411408673');" onmouseout="out('1256565039411408673');" style=""> 149           if (isStop) return;                                                                            </span>
<span class="3623631062921094381" onmouseenter="enter('3623631062921094381');" onmouseout="out('3623631062921094381');" style=""> 150           ALog.e(TAG, String.format(&quot;任务【%s】初始化失败&quot;, url));                                                </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style=""> 151           DownloadTaskEntity te = mExeMap.get(url);                                                      </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style=""> 152           if (te != null) {                                                                              </span>
<span class="-3434538459014877633" onmouseenter="enter('-3434538459014877633');" onmouseout="out('-3434538459014877633');" style=""> 153             mFailMap.put(url, te);                                                                       </span>
<span class="8595174373746499082" onmouseenter="enter('8595174373746499082');" onmouseout="out('8595174373746499082');" style=""> 154             mFileInfoCallbacks.put(te.hashCode(), this);                                                 </span>
<span class="1598851862534193089" onmouseenter="enter('1598851862534193089');" onmouseout="out('1598851862534193089');" style=""> 155             mExeMap.remove(url);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156           }                                                                                              </span>
<span class="-3126918587586078524" onmouseenter="enter('-3126918587586078524');" onmouseout="out('-3126918587586078524');" style=""> 157           //404链接不重试下载                                                                                   </span>
<span class="-8234013754580914183" onmouseenter="enter('-8234013754580914183');" onmouseout="out('-8234013754580914183');" style=""> 158           //if (failNum &lt; 3 &amp;&amp; !errorMsg.contains(&quot;错误码：404&quot;) &amp;&amp; !errorMsg.contains(                      </span>
<span class="-8709538774858874340" onmouseenter="enter('-8709538774858874340');" onmouseout="out('-8709538774858874340');" style=""> 159           //    &quot;UnknownHostException&quot;)) {                                                               </span>
<span class="4026410517121233117" onmouseenter="enter('4026410517121233117');" onmouseout="out('4026410517121233117');" style=""> 160           //  mInfoPool.execute(createFileInfoThread(te));                                               </span>
<span class="-9042505775003468696" onmouseenter="enter('-9042505775003468696');" onmouseout="out('-9042505775003468696');" style=""> 161           //} else {                                                                                     </span>
<span class="1565591895697134979" onmouseenter="enter('1565591895697134979');" onmouseout="out('1565591895697134979');" style=""> 162           //  mInitFailNum++;                                                                            </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style=""> 163           //}                                                                                            </span>
<span class="41491989208140212" onmouseenter="enter('41491989208140212');" onmouseout="out('41491989208140212');" style=""> 164           //failNum++;                                                                                   </span>
<span class="-2723952096500307408" onmouseenter="enter('-2723952096500307408');" onmouseout="out('-2723952096500307408');" style=""> 165           mInitFailNum++;                                                                                </span>
<span class="-8081180094332432926" onmouseenter="enter('-8081180094332432926');" onmouseout="out('-8081180094332432926');" style=""> 166           checkStartFlow();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167         }                                                                                                </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 168       };                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169     }                                                                                                    </span>
<span class="8019628728195433582" onmouseenter="enter('8019628728195433582');" onmouseout="out('8019628728195433582');" style=""> 170     return new HttpFileInfoThread(taskEntity, callback);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171   }                                                                                                      </span>
<span  style=""> 172                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 173   /**                                                                                                    </span>
<span class="2541186966995292996" onmouseenter="enter('2541186966995292996');" onmouseout="out('2541186966995292996');" style=""> 174    * 检查能否启动下载流程                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 175    */                                                                                                    </span>
<span class="-2867752194918434513" onmouseenter="enter('-2867752194918434513');" onmouseout="out('-2867752194918434513');" style=""> 176   private void checkStartFlow() {                                                                        </span>
<span class="6122674786435742337" onmouseenter="enter('6122674786435742337');" onmouseout="out('6122674786435742337');" style=""> 177     synchronized (DownloadGroupUtil.class) {                                                             </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 178 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-1218661801474368606" onmouseenter="enter('-1218661801474368606');" onmouseout="out('-1218661801474368606');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 179       if (!isStart &amp;&amp; (mInitCompleteNum + mInitFailNum &gt;= mGroupSize || !isNeedLoadFileSize)) {          </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 180 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="6122674786435742337" onmouseenter="enter('6122674786435742337');" onmouseout="out('6122674786435742337');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181     synchronized (DownloadGroupUtil.class) {                                                             </span>
<span class="343993768859733057" onmouseenter="enter('343993768859733057');" onmouseout="out('343993768859733057');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182       if (mInitCompleteNum + mInitFailNum &gt;= mGroupSize || !isNeedLoadFileSize) {                        </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183         startRunningFlow();                                                                              </span>
<span class="4169610006794036589" onmouseenter="enter('4169610006794036589');" onmouseout="out('4169610006794036589');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184         updateFileSize();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188 }                                                                                                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 189 =======                                                                                                  </span>
<span class="4224064111605117456" onmouseenter="enter('4224064111605117456');" onmouseout="out('4224064111605117456');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190       if (mInitFailNum == mGroupSize){                                                                   </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 191         closeTimer(false);                                                                               </span>
<span class="-4116834270158797210" onmouseenter="enter('-4116834270158797210');" onmouseout="out('-4116834270158797210');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192         mListener.onFail(true);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193       }                                                                                                  </span>
<span class="1828548532727566043" onmouseenter="enter('1828548532727566043');" onmouseout="out('1828548532727566043');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194       if (mInitCompleteNum + mInitFailNum == mGroupSize || !isNeedLoadFileSize) {                        </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 195 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style=""> 196         startRunningFlow();                                                                              </span>
<span class="4169610006794036589" onmouseenter="enter('4169610006794036589');" onmouseout="out('4169610006794036589');" style=""> 197         updateFileSize();                                                                                </span>
<span class="-6219947928101527010" onmouseenter="enter('-6219947928101527010');" onmouseout="out('-6219947928101527010');" style=""> 198         isStart = true;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="4634392904032211814" onmouseenter="enter('4634392904032211814');" onmouseout="out('4634392904032211814');" style="">  16 package com.arialyy.aria.core.download.downloader;                                                       </span>
<span  style="">  17                                                                                                          </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  18 import android.util.SparseArray;                                                                         </span>
<span class="5028823532254250595" onmouseenter="enter('5028823532254250595');" onmouseout="out('5028823532254250595');" style="">  19 import com.arialyy.aria.core.common.CompleteInfo;                                                        </span>
<span class="-3094174390533083180" onmouseenter="enter('-3094174390533083180');" onmouseout="out('-3094174390533083180');" style="">  20 import com.arialyy.aria.core.common.IUtil;                                                               </span>
<span class="-1788009330887423510" onmouseenter="enter('-1788009330887423510');" onmouseout="out('-1788009330887423510');" style="">  21 import com.arialyy.aria.core.common.OnFileInfoCallback;                                                  </span>
<span class="5290109400157436023" onmouseenter="enter('5290109400157436023');" onmouseout="out('5290109400157436023');" style="">  22 import com.arialyy.aria.core.download.DownloadGroupTaskEntity;                                           </span>
<span class="8636089030381561336" onmouseenter="enter('8636089030381561336');" onmouseout="out('8636089030381561336');" style="">  23 import com.arialyy.aria.core.download.DownloadTaskEntity;                                                </span>
<span class="-5016163043314935005" onmouseenter="enter('-5016163043314935005');" onmouseout="out('-5016163043314935005');" style="">  24 import com.arialyy.aria.core.inf.IEntity;                                                                </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  25 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  26 import java.util.Set;                                                                                    </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  27 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  28 import java.util.concurrent.Executors;                                                                   </span>
<span  style="">  29                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  30 /**                                                                                                      </span>
<span class="1321179419529258125" onmouseenter="enter('1321179419529258125');" onmouseout="out('1321179419529258125');" style="">  31  * Created by AriaL on 2017/6/30.                                                                        </span>
<span class="7496304558415279260" onmouseenter="enter('7496304558415279260');" onmouseout="out('7496304558415279260');" style="">  32  * 任务组下载工具                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  33  */                                                                                                      </span>
<span class="753905216202195114" onmouseenter="enter('753905216202195114');" onmouseout="out('753905216202195114');" style="">  34 public class DownloadGroupUtil extends AbsGroupUtil implements IUtil {                                   </span>
<span class="3933744472183840087" onmouseenter="enter('3933744472183840087');" onmouseout="out('3933744472183840087');" style="">  35   private final String TAG = &quot;DownloadGroupUtil&quot;;                                                        </span>
<span class="4123530941227175815" onmouseenter="enter('4123530941227175815');" onmouseout="out('4123530941227175815');" style="">  36   private ExecutorService mInfoPool;                                                                     </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  37   /**                                                                                                    </span>
<span class="1482282106677302068" onmouseenter="enter('1482282106677302068');" onmouseout="out('1482282106677302068');" style="">  38    * 初始化完成的任务数                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  39    */                                                                                                    </span>
<span class="4248926893461222874" onmouseenter="enter('4248926893461222874');" onmouseout="out('4248926893461222874');" style="">  40   private int mInitCompleteNum;                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  41   /**                                                                                                    </span>
<span class="5189388546664003005" onmouseenter="enter('5189388546664003005');" onmouseout="out('5189388546664003005');" style="">  42    * 初始化失败的任务数                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  43    */                                                                                                    </span>
<span class="-2622077359609901637" onmouseenter="enter('-2622077359609901637');" onmouseout="out('-2622077359609901637');" style="">  44   private int mInitFailNum;                                                                              </span>
<span class="7994908627964275637" onmouseenter="enter('7994908627964275637');" onmouseout="out('7994908627964275637');" style="">  45   private boolean isStop = false, isStart = false;                                                       </span>
<span  style="">  46                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  47   /**                                                                                                    </span>
<span class="6416521976967220365" onmouseenter="enter('6416521976967220365');" onmouseout="out('6416521976967220365');" style="">  48    * 文件信息回调组                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  49    */                                                                                                    </span>
<span class="-5994431595118905059" onmouseenter="enter('-5994431595118905059');" onmouseout="out('-5994431595118905059');" style="">  50   private SparseArray&lt;OnFileInfoCallback&gt; mFileInfoCallbacks = new SparseArray&lt;&gt;();                      </span>
<span  style="">  51                                                                                                          </span>
<span class="-3731711094107651611" onmouseenter="enter('-3731711094107651611');" onmouseout="out('-3731711094107651611');" style="">  52   public DownloadGroupUtil(IDownloadGroupListener listener, DownloadGroupTaskEntity taskEntity) {        </span>
<span class="-7841553057471002442" onmouseenter="enter('-7841553057471002442');" onmouseout="out('-7841553057471002442');" style="">  53     super(listener, taskEntity);                                                                         </span>
<span class="-6453187294675473758" onmouseenter="enter('-6453187294675473758');" onmouseout="out('-6453187294675473758');" style="">  54     mInfoPool = Executors.newCachedThreadPool();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  55   }                                                                                                      </span>
<span  style="">  56                                                                                                          </span>
<span class="7947472288428602188" onmouseenter="enter('7947472288428602188');" onmouseout="out('7947472288428602188');" style="">  57   @Override int getTaskType() {                                                                          </span>
<span class="-9017418965458996171" onmouseenter="enter('-9017418965458996171');" onmouseout="out('-9017418965458996171');" style="">  58     return HTTP_GROUP;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  59   }                                                                                                      </span>
<span  style="">  60                                                                                                          </span>
<span class="2093106455269248536" onmouseenter="enter('2093106455269248536');" onmouseout="out('2093106455269248536');" style="">  61   @Override public void onCancel() {                                                                     </span>
<span class="-5705545244356268786" onmouseenter="enter('-5705545244356268786');" onmouseout="out('-5705545244356268786');" style="">  62     super.onCancel();                                                                                    </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style="">  63     isStop = true;                                                                                       </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style="">  64     if (!mInfoPool.isShutdown()) {                                                                       </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style="">  65       mInfoPool.shutdown();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  66     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  67   }                                                                                                      </span>
<span  style="">  68                                                                                                          </span>
<span class="8218595092732559103" onmouseenter="enter('8218595092732559103');" onmouseout="out('8218595092732559103');" style="">  69   @Override protected void onStop() {                                                                    </span>
<span class="-4376279779571809033" onmouseenter="enter('-4376279779571809033');" onmouseout="out('-4376279779571809033');" style="">  70     super.onStop();                                                                                      </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style="">  71     isStop = true;                                                                                       </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style="">  72     if (!mInfoPool.isShutdown()) {                                                                       </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style="">  73       mInfoPool.shutdown();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  74     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  75   }                                                                                                      </span>
<span  style="">  76                                                                                                          </span>
<span class="7849318491336065590" onmouseenter="enter('7849318491336065590');" onmouseout="out('7849318491336065590');" style="">  77   @Override protected void onStart() {                                                                   </span>
<span class="5012053197150764509" onmouseenter="enter('5012053197150764509');" onmouseout="out('5012053197150764509');" style="">  78     onPre();                                                                                             </span>
<span class="-8222534604477057787" onmouseenter="enter('-8222534604477057787');" onmouseout="out('-8222534604477057787');" style="">  79     isStop = false;                                                                                      </span>
<span class="7225088664243368020" onmouseenter="enter('7225088664243368020');" onmouseout="out('7225088664243368020');" style="">  80     if (mCompleteNum == mGroupSize) {                                                                    </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="">  81       mListener.onComplete();                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  82       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  83     }                                                                                                    </span>
<span  style="">  84                                                                                                          </span>
<span class="-6546016058818690530" onmouseenter="enter('-6546016058818690530');" onmouseout="out('-6546016058818690530');" style="">  85     if (mExeMap.size() == 0) {                                                                           </span>
<span class="7944887971155137312" onmouseenter="enter('7944887971155137312');" onmouseout="out('7944887971155137312');" style="">  86       ALog.e(TAG, &quot;任务组无可执行任务&quot;);                                                                          </span>
<span class="-2850265295753937963" onmouseenter="enter('-2850265295753937963');" onmouseout="out('-2850265295753937963');" style="">  87       mListener.onFail(false);                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  88       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  89     }                                                                                                    </span>
<span class="4774762395313474868" onmouseenter="enter('4774762395313474868');" onmouseout="out('4774762395313474868');" style="">  90     Set&lt;String&gt; keys = mExeMap.keySet();                                                                 </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="">  91     for (String key : keys) {                                                                            </span>
<span class="221423537684250497" onmouseenter="enter('221423537684250497');" onmouseout="out('221423537684250497');" style="">  92       DownloadTaskEntity taskEntity = mExeMap.get(key);                                                  </span>
<span class="2875409705898122648" onmouseenter="enter('2875409705898122648');" onmouseout="out('2875409705898122648');" style="">  93       if (taskEntity != null) {                                                                          </span>
<span class="3825460913713262848" onmouseenter="enter('3825460913713262848');" onmouseout="out('3825460913713262848');" style="">  94         if (taskEntity.getState() != IEntity.STATE_FAIL                                                  </span>
<span class="4045344078755509632" onmouseenter="enter('4045344078755509632');" onmouseout="out('4045344078755509632');" style="">  95             &amp;&amp; taskEntity.getState() != IEntity.STATE_WAIT) {                                            </span>
<span class="8328172117625509207" onmouseenter="enter('8328172117625509207');" onmouseout="out('8328172117625509207');" style="">  96           mInitCompleteNum++;                                                                            </span>
<span class="-8219370924340117849" onmouseenter="enter('-8219370924340117849');" onmouseout="out('-8219370924340117849');" style="">  97           createChildDownload(taskEntity);                                                               </span>
<span class="-8081180094332432926" onmouseenter="enter('-8081180094332432926');" onmouseout="out('-8081180094332432926');" style="">  98           checkStartFlow();                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  99         } else {                                                                                         </span>
<span class="4135184626453358547" onmouseenter="enter('4135184626453358547');" onmouseout="out('4135184626453358547');" style=""> 100           mInfoPool.execute(createFileInfoThread(taskEntity));                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103     }                                                                                                    </span>
<span class="9042102165861284735" onmouseenter="enter('9042102165861284735');" onmouseout="out('9042102165861284735');" style=""> 104     if (mCurrentLocation == mTotalLen) {                                                                 </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 105       mListener.onComplete();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107   }                                                                                                      </span>
<span  style=""> 108                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 109   /**                                                                                                    </span>
<span class="-4547374311767626615" onmouseenter="enter('-4547374311767626615');" onmouseout="out('-4547374311767626615');" style=""> 110    * 创建文件信息获取线程                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 111    */                                                                                                    </span>
<span class="5921359649843257629" onmouseenter="enter('5921359649843257629');" onmouseout="out('5921359649843257629');" style=""> 112   private HttpFileInfoThread createFileInfoThread(DownloadTaskEntity taskEntity) {                       </span>
<span class="3806302679560349109" onmouseenter="enter('3806302679560349109');" onmouseout="out('3806302679560349109');" style=""> 113     OnFileInfoCallback callback = mFileInfoCallbacks.get(taskEntity.hashCode());                         </span>
<span  style=""> 114                                                                                                          </span>
<span class="-5681834850649759939" onmouseenter="enter('-5681834850649759939');" onmouseout="out('-5681834850649759939');" style=""> 115     if (callback == null) {                                                                              </span>
<span class="-2247249715703717317" onmouseenter="enter('-2247249715703717317');" onmouseout="out('-2247249715703717317');" style=""> 116       callback = new OnFileInfoCallback() {                                                              </span>
<span class="4970948900553010157" onmouseenter="enter('4970948900553010157');" onmouseout="out('4970948900553010157');" style=""> 117         int failNum = 0;                                                                                 </span>
<span  style=""> 118                                                                                                          </span>
<span class="-2050288510094905379" onmouseenter="enter('-2050288510094905379');" onmouseout="out('-2050288510094905379');" style=""> 119         @Override public void onComplete(String url, CompleteInfo info) {                                </span>
<span class="1256565039411408673" onmouseenter="enter('1256565039411408673');" onmouseout="out('1256565039411408673');" style=""> 120           if (isStop) return;                                                                            </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style=""> 121           DownloadTaskEntity te = mExeMap.get(url);                                                      </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style=""> 122           if (te != null) {                                                                              </span>
<span class="-2199112578045619452" onmouseenter="enter('-2199112578045619452');" onmouseout="out('-2199112578045619452');" style=""> 123             if (isNeedLoadFileSize) {                                                                    </span>
<span class="-1062870475604154862" onmouseenter="enter('-1062870475604154862');" onmouseout="out('-1062870475604154862');" style=""> 124               mTotalLen += te.getEntity().getFileSize();                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 125             }                                                                                            </span>
<span class="-6053482025677790768" onmouseenter="enter('-6053482025677790768');" onmouseout="out('-6053482025677790768');" style=""> 126             createChildDownload(te);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127           }                                                                                              </span>
<span class="8328172117625509207" onmouseenter="enter('8328172117625509207');" onmouseout="out('8328172117625509207');" style=""> 128           mInitCompleteNum++;                                                                            </span>
<span  style=""> 129                                                                                                          </span>
<span class="-8081180094332432926" onmouseenter="enter('-8081180094332432926');" onmouseout="out('-8081180094332432926');" style=""> 130           checkStartFlow();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131         }                                                                                                </span>
<span  style=""> 132                                                                                                          </span>
<span class="5765667375964195772" onmouseenter="enter('5765667375964195772');" onmouseout="out('5765667375964195772');" style=""> 133         @Override public void onFail(String url, String errorMsg, boolean needRetry) {                   </span>
<span class="1256565039411408673" onmouseenter="enter('1256565039411408673');" onmouseout="out('1256565039411408673');" style=""> 134           if (isStop) return;                                                                            </span>
<span class="3623631062921094381" onmouseenter="enter('3623631062921094381');" onmouseout="out('3623631062921094381');" style=""> 135           ALog.e(TAG, String.format(&quot;任务【%s】初始化失败&quot;, url));                                                </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style=""> 136           DownloadTaskEntity te = mExeMap.get(url);                                                      </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style=""> 137           if (te != null) {                                                                              </span>
<span class="-3434538459014877633" onmouseenter="enter('-3434538459014877633');" onmouseout="out('-3434538459014877633');" style=""> 138             mFailMap.put(url, te);                                                                       </span>
<span class="8595174373746499082" onmouseenter="enter('8595174373746499082');" onmouseout="out('8595174373746499082');" style=""> 139             mFileInfoCallbacks.put(te.hashCode(), this);                                                 </span>
<span class="1598851862534193089" onmouseenter="enter('1598851862534193089');" onmouseout="out('1598851862534193089');" style=""> 140             mExeMap.remove(url);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141           }                                                                                              </span>
<span class="-3126918587586078524" onmouseenter="enter('-3126918587586078524');" onmouseout="out('-3126918587586078524');" style=""> 142           //404链接不重试下载                                                                                   </span>
<span class="-8234013754580914183" onmouseenter="enter('-8234013754580914183');" onmouseout="out('-8234013754580914183');" style=""> 143           //if (failNum &lt; 3 &amp;&amp; !errorMsg.contains(&quot;错误码：404&quot;) &amp;&amp; !errorMsg.contains(                      </span>
<span class="-8709538774858874340" onmouseenter="enter('-8709538774858874340');" onmouseout="out('-8709538774858874340');" style=""> 144           //    &quot;UnknownHostException&quot;)) {                                                               </span>
<span class="4026410517121233117" onmouseenter="enter('4026410517121233117');" onmouseout="out('4026410517121233117');" style=""> 145           //  mInfoPool.execute(createFileInfoThread(te));                                               </span>
<span class="-9042505775003468696" onmouseenter="enter('-9042505775003468696');" onmouseout="out('-9042505775003468696');" style=""> 146           //} else {                                                                                     </span>
<span class="1565591895697134979" onmouseenter="enter('1565591895697134979');" onmouseout="out('1565591895697134979');" style=""> 147           //  mInitFailNum++;                                                                            </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style=""> 148           //}                                                                                            </span>
<span class="41491989208140212" onmouseenter="enter('41491989208140212');" onmouseout="out('41491989208140212');" style=""> 149           //failNum++;                                                                                   </span>
<span class="-2723952096500307408" onmouseenter="enter('-2723952096500307408');" onmouseout="out('-2723952096500307408');" style=""> 150           mInitFailNum++;                                                                                </span>
<span class="-8081180094332432926" onmouseenter="enter('-8081180094332432926');" onmouseout="out('-8081180094332432926');" style=""> 151           checkStartFlow();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152         }                                                                                                </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 153       };                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154     }                                                                                                    </span>
<span class="8019628728195433582" onmouseenter="enter('8019628728195433582');" onmouseout="out('8019628728195433582');" style=""> 155     return new HttpFileInfoThread(taskEntity, callback);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156   }                                                                                                      </span>
<span  style=""> 157                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 158   /**                                                                                                    </span>
<span class="2541186966995292996" onmouseenter="enter('2541186966995292996');" onmouseout="out('2541186966995292996');" style=""> 159    * 检查能否启动下载流程                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 160    */                                                                                                    </span>
<span class="-2867752194918434513" onmouseenter="enter('-2867752194918434513');" onmouseout="out('-2867752194918434513');" style=""> 161   private void checkStartFlow() {                                                                        </span>
<span class="6122674786435742337" onmouseenter="enter('6122674786435742337');" onmouseout="out('6122674786435742337');" style=""> 162     synchronized (DownloadGroupUtil.class) {                                                             </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 163 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-1218661801474368606" onmouseenter="enter('-1218661801474368606');" onmouseout="out('-1218661801474368606');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 164       if (!isStart &amp;&amp; (mInitCompleteNum + mInitFailNum &gt;= mGroupSize || !isNeedLoadFileSize)) {          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 165 ||||||| BASE                                                                                             </span>
<span class="343993768859733057" onmouseenter="enter('343993768859733057');" onmouseout="out('343993768859733057');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 166       if (mInitCompleteNum + mInitFailNum &gt;= mGroupSize || !isNeedLoadFileSize) {                        </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 167         startRunningFlow();                                                                              </span>
<span class="4169610006794036589" onmouseenter="enter('4169610006794036589');" onmouseout="out('4169610006794036589');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168         updateFileSize();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170     }                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 171 =======                                                                                                  </span>
<span class="4224064111605117456" onmouseenter="enter('4224064111605117456');" onmouseout="out('4224064111605117456');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 172       if (mInitFailNum == mGroupSize){                                                                   </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 173         closeTimer(false);                                                                               </span>
<span class="-4116834270158797210" onmouseenter="enter('-4116834270158797210');" onmouseout="out('-4116834270158797210');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174         mListener.onFail(true);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175       }                                                                                                  </span>
<span class="1828548532727566043" onmouseenter="enter('1828548532727566043');" onmouseout="out('1828548532727566043');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176       if (mInitCompleteNum + mInitFailNum == mGroupSize || !isNeedLoadFileSize) {                        </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 177 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style=""> 178         startRunningFlow();                                                                              </span>
<span class="4169610006794036589" onmouseenter="enter('4169610006794036589');" onmouseout="out('4169610006794036589');" style=""> 179         updateFileSize();                                                                                </span>
<span class="-6219947928101527010" onmouseenter="enter('-6219947928101527010');" onmouseout="out('-6219947928101527010');" style=""> 180         isStart = true;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184 }                                                                                                        </span>
















</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="4634392904032211814" onmouseenter="enter('4634392904032211814');" onmouseout="out('4634392904032211814');" style="">  16 package com.arialyy.aria.core.download.downloader;                                                       </span>
<span  style="">  17                                                                                                          </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  18 import android.util.SparseArray;                                                                         </span>
<span class="5028823532254250595" onmouseenter="enter('5028823532254250595');" onmouseout="out('5028823532254250595');" style="">  19 import com.arialyy.aria.core.common.CompleteInfo;                                                        </span>
<span class="-3094174390533083180" onmouseenter="enter('-3094174390533083180');" onmouseout="out('-3094174390533083180');" style="">  20 import com.arialyy.aria.core.common.IUtil;                                                               </span>
<span class="-1788009330887423510" onmouseenter="enter('-1788009330887423510');" onmouseout="out('-1788009330887423510');" style="">  21 import com.arialyy.aria.core.common.OnFileInfoCallback;                                                  </span>
<span class="5290109400157436023" onmouseenter="enter('5290109400157436023');" onmouseout="out('5290109400157436023');" style="">  22 import com.arialyy.aria.core.download.DownloadGroupTaskEntity;                                           </span>
<span class="8636089030381561336" onmouseenter="enter('8636089030381561336');" onmouseout="out('8636089030381561336');" style="">  23 import com.arialyy.aria.core.download.DownloadTaskEntity;                                                </span>
<span class="-5016163043314935005" onmouseenter="enter('-5016163043314935005');" onmouseout="out('-5016163043314935005');" style="">  24 import com.arialyy.aria.core.inf.IEntity;                                                                </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  25 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  26 import java.util.Set;                                                                                    </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  27 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  28 import java.util.concurrent.Executors;                                                                   </span>
<span  style="">  29                                                                                                          </span>
<span  style="">  30                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  31 /**                                                                                                      </span>
<span class="1321179419529258125" onmouseenter="enter('1321179419529258125');" onmouseout="out('1321179419529258125');" style="">  32  * Created by AriaL on 2017/6/30.                                                                        </span>
<span class="7496304558415279260" onmouseenter="enter('7496304558415279260');" onmouseout="out('7496304558415279260');" style="">  33  * 任务组下载工具                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  34  */                                                                                                      </span>
<span class="753905216202195114" onmouseenter="enter('753905216202195114');" onmouseout="out('753905216202195114');" style="">  35 public class DownloadGroupUtil extends AbsGroupUtil implements IUtil {                                   </span>
<span class="3933744472183840087" onmouseenter="enter('3933744472183840087');" onmouseout="out('3933744472183840087');" style="">  36   private final String TAG = &quot;DownloadGroupUtil&quot;;                                                        </span>
<span  style="">  37                                                                                                          </span>
<span class="4123530941227175815" onmouseenter="enter('4123530941227175815');" onmouseout="out('4123530941227175815');" style="">  38   private ExecutorService mInfoPool;                                                                     </span>
<span  style="">  39                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  40   /**                                                                                                    </span>
<span class="1482282106677302068" onmouseenter="enter('1482282106677302068');" onmouseout="out('1482282106677302068');" style="">  41    * 初始化完成的任务数                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  42    */                                                                                                    </span>
<span class="4248926893461222874" onmouseenter="enter('4248926893461222874');" onmouseout="out('4248926893461222874');" style="">  43   private int mInitCompleteNum;                                                                          </span>
<span  style="">  44                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  45   /**                                                                                                    </span>
<span class="5189388546664003005" onmouseenter="enter('5189388546664003005');" onmouseout="out('5189388546664003005');" style="">  46    * 初始化失败的任务数                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  47    */                                                                                                    </span>
<span class="-2622077359609901637" onmouseenter="enter('-2622077359609901637');" onmouseout="out('-2622077359609901637');" style="">  48   private int mInitFailNum;                                                                              </span>
<span  style="">  49                                                                                                          </span>
<span class="8161357676031878454" onmouseenter="enter('8161357676031878454');" onmouseout="out('8161357676031878454');" style="">  50   private boolean isStop = false;                                                                        </span>
<span  style="">  51                                                                                                          </span>
<span class="-2631564169414184669" onmouseenter="enter('-2631564169414184669');" onmouseout="out('-2631564169414184669');" style="">  52   private boolean isStart = false;                                                                       </span>
<span  style="">  53                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  54   /**                                                                                                    </span>
<span class="6416521976967220365" onmouseenter="enter('6416521976967220365');" onmouseout="out('6416521976967220365');" style="">  55    * 文件信息回调组                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  56    */                                                                                                    </span>
<span class="-5994431595118905059" onmouseenter="enter('-5994431595118905059');" onmouseout="out('-5994431595118905059');" style="">  57   private SparseArray&lt;OnFileInfoCallback&gt; mFileInfoCallbacks = new SparseArray&lt;&gt;();                      </span>
<span  style="">  58                                                                                                          </span>
<span class="-3731711094107651611" onmouseenter="enter('-3731711094107651611');" onmouseout="out('-3731711094107651611');" style="">  59   public DownloadGroupUtil(IDownloadGroupListener listener, DownloadGroupTaskEntity taskEntity) {        </span>
<span class="-7841553057471002442" onmouseenter="enter('-7841553057471002442');" onmouseout="out('-7841553057471002442');" style="">  60     super(listener, taskEntity);                                                                         </span>
<span class="-6453187294675473758" onmouseenter="enter('-6453187294675473758');" onmouseout="out('-6453187294675473758');" style="">  61     mInfoPool = Executors.newCachedThreadPool();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  62   }                                                                                                      </span>
<span  style="">  63                                                                                                          </span>
<span class="7947472288428602188" onmouseenter="enter('7947472288428602188');" onmouseout="out('7947472288428602188');" style="">  64   @Override int getTaskType() {                                                                          </span>
<span class="-9017418965458996171" onmouseenter="enter('-9017418965458996171');" onmouseout="out('-9017418965458996171');" style="">  65     return HTTP_GROUP;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  66   }                                                                                                      </span>
<span  style="">  67                                                                                                          </span>
<span class="2093106455269248536" onmouseenter="enter('2093106455269248536');" onmouseout="out('2093106455269248536');" style="">  68   @Override public void onCancel() {                                                                     </span>
<span class="-5705545244356268786" onmouseenter="enter('-5705545244356268786');" onmouseout="out('-5705545244356268786');" style="">  69     super.onCancel();                                                                                    </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style="">  70     isStop = true;                                                                                       </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style="">  71     if (!mInfoPool.isShutdown()) {                                                                       </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style="">  72       mInfoPool.shutdown();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  73     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  74   }                                                                                                      </span>
<span  style="">  75                                                                                                          </span>
<span class="8218595092732559103" onmouseenter="enter('8218595092732559103');" onmouseout="out('8218595092732559103');" style="">  76   @Override protected void onStop() {                                                                    </span>
<span class="-4376279779571809033" onmouseenter="enter('-4376279779571809033');" onmouseout="out('-4376279779571809033');" style="">  77     super.onStop();                                                                                      </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style="">  78     isStop = true;                                                                                       </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style="">  79     if (!mInfoPool.isShutdown()) {                                                                       </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style="">  80       mInfoPool.shutdown();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  81     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  82   }                                                                                                      </span>
<span  style="">  83                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  84   @Override                                                                                              </span>
<span class="-6246497570696443466" onmouseenter="enter('-6246497570696443466');" onmouseout="out('-6246497570696443466');" style="">  85   protected void onStart() {                                                                             </span>
<span class="5012053197150764509" onmouseenter="enter('5012053197150764509');" onmouseout="out('5012053197150764509');" style="">  86     onPre();                                                                                             </span>
<span class="-8222534604477057787" onmouseenter="enter('-8222534604477057787');" onmouseout="out('-8222534604477057787');" style="">  87     isStop = false;                                                                                      </span>
<span class="7225088664243368020" onmouseenter="enter('7225088664243368020');" onmouseout="out('7225088664243368020');" style="">  88     if (mCompleteNum == mGroupSize) {                                                                    </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="">  89       mListener.onComplete();                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  90       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91     }                                                                                                    </span>
<span class="-6546016058818690530" onmouseenter="enter('-6546016058818690530');" onmouseout="out('-6546016058818690530');" style="">  92     if (mExeMap.size() == 0) {                                                                           </span>
<span class="7944887971155137312" onmouseenter="enter('7944887971155137312');" onmouseout="out('7944887971155137312');" style="">  93       ALog.e(TAG, &quot;任务组无可执行任务&quot;);                                                                          </span>
<span class="-2850265295753937963" onmouseenter="enter('-2850265295753937963');" onmouseout="out('-2850265295753937963');" style="">  94       mListener.onFail(false);                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  95       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96     }                                                                                                    </span>
<span class="4774762395313474868" onmouseenter="enter('4774762395313474868');" onmouseout="out('4774762395313474868');" style="">  97     Set&lt;String&gt; keys = mExeMap.keySet();                                                                 </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="">  98     for (String key : keys) {                                                                            </span>
<span class="221423537684250497" onmouseenter="enter('221423537684250497');" onmouseout="out('221423537684250497');" style="">  99       DownloadTaskEntity taskEntity = mExeMap.get(key);                                                  </span>
<span class="2875409705898122648" onmouseenter="enter('2875409705898122648');" onmouseout="out('2875409705898122648');" style=""> 100       if (taskEntity != null) {                                                                          </span>
<span class="-3535177471444042692" onmouseenter="enter('-3535177471444042692');" onmouseout="out('-3535177471444042692');" style=""><abbr title=" 101         if ((taskEntity.getState() != IEntity.STATE_FAIL) &amp;&amp; (taskEntity.getState() != IEntity.STATE_WAIT)) {"> 101         if ((taskEntity.getState() != IEntity.STATE_FAIL) &amp;&amp; (taskEntity.getState() != IEntity.STATE_WAIT🔵</abbr></span>
<span class="8328172117625509207" onmouseenter="enter('8328172117625509207');" onmouseout="out('8328172117625509207');" style=""> 102           mInitCompleteNum++;                                                                            </span>
<span class="-8219370924340117849" onmouseenter="enter('-8219370924340117849');" onmouseout="out('-8219370924340117849');" style=""> 103           createChildDownload(taskEntity);                                                               </span>
<span class="-8081180094332432926" onmouseenter="enter('-8081180094332432926');" onmouseout="out('-8081180094332432926');" style=""> 104           checkStartFlow();                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 105         } else {                                                                                         </span>
<span class="4135184626453358547" onmouseenter="enter('4135184626453358547');" onmouseout="out('4135184626453358547');" style=""> 106           mInfoPool.execute(createFileInfoThread(taskEntity));                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 109     }                                                                                                    </span>
<span class="9042102165861284735" onmouseenter="enter('9042102165861284735');" onmouseout="out('9042102165861284735');" style=""> 110     if (mCurrentLocation == mTotalLen) {                                                                 </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 111       mListener.onComplete();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113   }                                                                                                      </span>
<span  style=""> 114                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 115   /**                                                                                                    </span>
<span class="-4547374311767626615" onmouseenter="enter('-4547374311767626615');" onmouseout="out('-4547374311767626615');" style=""> 116    * 创建文件信息获取线程                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 117    */                                                                                                    </span>
<span class="5921359649843257629" onmouseenter="enter('5921359649843257629');" onmouseout="out('5921359649843257629');" style=""> 118   private HttpFileInfoThread createFileInfoThread(DownloadTaskEntity taskEntity) {                       </span>
<span class="3806302679560349109" onmouseenter="enter('3806302679560349109');" onmouseout="out('3806302679560349109');" style=""> 119     OnFileInfoCallback callback = mFileInfoCallbacks.get(taskEntity.hashCode());                         </span>
<span class="-5681834850649759939" onmouseenter="enter('-5681834850649759939');" onmouseout="out('-5681834850649759939');" style=""> 120     if (callback == null) {                                                                              </span>
<span class="-2247249715703717317" onmouseenter="enter('-2247249715703717317');" onmouseout="out('-2247249715703717317');" style=""> 121       callback = new OnFileInfoCallback() {                                                              </span>
<span class="4970948900553010157" onmouseenter="enter('4970948900553010157');" onmouseout="out('4970948900553010157');" style=""> 122         int failNum = 0;                                                                                 </span>
<span  style=""> 123                                                                                                          </span>
<span class="-2050288510094905379" onmouseenter="enter('-2050288510094905379');" onmouseout="out('-2050288510094905379');" style=""> 124         @Override public void onComplete(String url, CompleteInfo info) {                                </span>
<span class="1256565039411408673" onmouseenter="enter('1256565039411408673');" onmouseout="out('1256565039411408673');" style=""> 125           if (isStop) return;                                                                            </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style=""> 126           DownloadTaskEntity te = mExeMap.get(url);                                                      </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style=""> 127           if (te != null) {                                                                              </span>
<span class="-2199112578045619452" onmouseenter="enter('-2199112578045619452');" onmouseout="out('-2199112578045619452');" style=""> 128             if (isNeedLoadFileSize) {                                                                    </span>
<span class="-1062870475604154862" onmouseenter="enter('-1062870475604154862');" onmouseout="out('-1062870475604154862');" style=""> 129               mTotalLen += te.getEntity().getFileSize();                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 130             }                                                                                            </span>
<span class="-6053482025677790768" onmouseenter="enter('-6053482025677790768');" onmouseout="out('-6053482025677790768');" style=""> 131             createChildDownload(te);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132           }                                                                                              </span>
<span class="8328172117625509207" onmouseenter="enter('8328172117625509207');" onmouseout="out('8328172117625509207');" style=""> 133           mInitCompleteNum++;                                                                            </span>
<span  style=""> 134                                                                                                          </span>
<span class="-8081180094332432926" onmouseenter="enter('-8081180094332432926');" onmouseout="out('-8081180094332432926');" style=""> 135           checkStartFlow();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136         }                                                                                                </span>
<span  style=""> 137                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 138         @Override                                                                                        </span>
<span class="-7906939573519482827" onmouseenter="enter('-7906939573519482827');" onmouseout="out('-7906939573519482827');" style=""> 139         public void onFail(String url, String errorMsg, boolean needRetry) {                             </span>
<span class="7677583571575855110" onmouseenter="enter('7677583571575855110');" onmouseout="out('7677583571575855110');" style=""> 140           if (isStop) {                                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 141             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142           }                                                                                              </span>
<span class="3623631062921094381" onmouseenter="enter('3623631062921094381');" onmouseout="out('3623631062921094381');" style=""> 143           ALog.e(TAG, String.format(&quot;任务【%s】初始化失败&quot;, url));                                                </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style=""> 144           DownloadTaskEntity te = mExeMap.get(url);                                                      </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style=""> 145           if (te != null) {                                                                              </span>
<span class="-3434538459014877633" onmouseenter="enter('-3434538459014877633');" onmouseout="out('-3434538459014877633');" style=""> 146             mFailMap.put(url, te);                                                                       </span>
<span class="8595174373746499082" onmouseenter="enter('8595174373746499082');" onmouseout="out('8595174373746499082');" style=""> 147             mFileInfoCallbacks.put(te.hashCode(), this);                                                 </span>
<span class="1598851862534193089" onmouseenter="enter('1598851862534193089');" onmouseout="out('1598851862534193089');" style=""> 148             mExeMap.remove(url);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 149           }                                                                                              </span>
<span class="-1988176769654886833" onmouseenter="enter('-1988176769654886833');" onmouseout="out('-1988176769654886833');" style=""> 150           // 404链接不重试下载                                                                                  </span>
<span class="-4185640851716271667" onmouseenter="enter('-4185640851716271667');" onmouseout="out('-4185640851716271667');" style=""> 151           // if (failNum &lt; 3 &amp;&amp; !errorMsg.contains(&quot;错误码：404&quot;) &amp;&amp; !errorMsg.contains(                     </span>
<span class="1803573827534911035" onmouseenter="enter('1803573827534911035');" onmouseout="out('1803573827534911035');" style=""> 152           // &quot;UnknownHostException&quot;)) {                                                                  </span>
<span class="7444581750991334911" onmouseenter="enter('7444581750991334911');" onmouseout="out('7444581750991334911');" style=""> 153           // mInfoPool.execute(createFileInfoThread(te));                                                </span>
<span class="4350798338449213113" onmouseenter="enter('4350798338449213113');" onmouseout="out('4350798338449213113');" style=""> 154           // } else {                                                                                    </span>
<span class="-6824476321819591993" onmouseenter="enter('-6824476321819591993');" onmouseout="out('-6824476321819591993');" style=""> 155           // mInitFailNum++;                                                                             </span>
<span class="6190421505795807923" onmouseenter="enter('6190421505795807923');" onmouseout="out('6190421505795807923');" style=""> 156           // }                                                                                           </span>
<span class="-6221408749672919828" onmouseenter="enter('-6221408749672919828');" onmouseout="out('-6221408749672919828');" style=""> 157           // failNum++;                                                                                  </span>
<span class="-2723952096500307408" onmouseenter="enter('-2723952096500307408');" onmouseout="out('-2723952096500307408');" style=""> 158           mInitFailNum++;                                                                                </span>
<span class="-8081180094332432926" onmouseenter="enter('-8081180094332432926');" onmouseout="out('-8081180094332432926');" style=""> 159           checkStartFlow();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160         }                                                                                                </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 161       };                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162     }                                                                                                    </span>
<span class="8019628728195433582" onmouseenter="enter('8019628728195433582');" onmouseout="out('8019628728195433582');" style=""> 163     return new HttpFileInfoThread(taskEntity, callback);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164   }                                                                                                      </span>
<span  style=""> 165                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 166   /**                                                                                                    </span>
<span class="2541186966995292996" onmouseenter="enter('2541186966995292996');" onmouseout="out('2541186966995292996');" style=""> 167    * 检查能否启动下载流程                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 168    */                                                                                                    </span>
<span class="-2867752194918434513" onmouseenter="enter('-2867752194918434513');" onmouseout="out('-2867752194918434513');" style=""> 169   private void checkStartFlow() {                                                                        </span>
<span class="-3212539869120881927" onmouseenter="enter('-3212539869120881927');" onmouseout="out('-3212539869120881927');" style=""> 170     synchronized(DownloadGroupUtil.class) {                                                              </span>
<span class="3428090853425484076" onmouseenter="enter('3428090853425484076');" onmouseout="out('3428090853425484076');" style=""> 171       if (mInitFailNum == mGroupSize) {                                                                  </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style=""> 172         closeTimer(false);                                                                               </span>
<span class="-4116834270158797210" onmouseenter="enter('-4116834270158797210');" onmouseout="out('-4116834270158797210');" style=""> 173         mListener.onFail(true);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174       }                                                                                                  </span>
<span class="-2400202343425879466" onmouseenter="enter('-2400202343425879466');" onmouseout="out('-2400202343425879466');" style=""> 175       if ((!isStart) &amp;&amp; (((mInitCompleteNum + mInitFailNum) == mGroupSize) || (!isNeedLoadFileSize))) {  </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style=""> 176         startRunningFlow();                                                                              </span>
<span class="4169610006794036589" onmouseenter="enter('4169610006794036589');" onmouseout="out('4169610006794036589');" style=""> 177         updateFileSize();                                                                                </span>
<span class="-6219947928101527010" onmouseenter="enter('-6219947928101527010');" onmouseout="out('-6219947928101527010');" style=""> 178         isStart = true;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182 }                                                                                                        </span>


















</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="4634392904032211814" onmouseenter="enter('4634392904032211814');" onmouseout="out('4634392904032211814');" style="">  16  package com.arialyy.aria.core.download.downloader;                                                                </span>
<span  style="">  17                                                                                                                    </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  18  import android.util.SparseArray;                                                                                  </span>
<span class="5028823532254250595" onmouseenter="enter('5028823532254250595');" onmouseout="out('5028823532254250595');" style="">  19  import com.arialyy.aria.core.common.CompleteInfo;                                                                 </span>
<span class="-3094174390533083180" onmouseenter="enter('-3094174390533083180');" onmouseout="out('-3094174390533083180');" style="">  20  import com.arialyy.aria.core.common.IUtil;                                                                        </span>
<span class="-1788009330887423510" onmouseenter="enter('-1788009330887423510');" onmouseout="out('-1788009330887423510');" style="">  21  import com.arialyy.aria.core.common.OnFileInfoCallback;                                                           </span>
<span class="5290109400157436023" onmouseenter="enter('5290109400157436023');" onmouseout="out('5290109400157436023');" style="">  22  import com.arialyy.aria.core.download.DownloadGroupTaskEntity;                                                    </span>
<span class="8636089030381561336" onmouseenter="enter('8636089030381561336');" onmouseout="out('8636089030381561336');" style="">  23  import com.arialyy.aria.core.download.DownloadTaskEntity;                                                         </span>
<span class="-5016163043314935005" onmouseenter="enter('-5016163043314935005');" onmouseout="out('-5016163043314935005');" style="">  24  import com.arialyy.aria.core.inf.IEntity;                                                                         </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  25  import com.arialyy.aria.util.ALog;                                                                                </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  26  import java.util.Set;                                                                                             </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  27  import java.util.concurrent.ExecutorService;                                                                      </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  28  import java.util.concurrent.Executors;                                                                            </span>
<span  style="">  29                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  30  /**                                                                                                               </span>
<span class="1321179419529258125" onmouseenter="enter('1321179419529258125');" onmouseout="out('1321179419529258125');" style="">  31   * Created by AriaL on 2017/6/30.                                                                                 </span>
<span class="7496304558415279260" onmouseenter="enter('7496304558415279260');" onmouseout="out('7496304558415279260');" style="">  32   * 任务组下载工具                                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  33   */                                                                                                               </span>
<span class="753905216202195114" onmouseenter="enter('753905216202195114');" onmouseout="out('753905216202195114');" style="">  34  public class DownloadGroupUtil extends AbsGroupUtil implements IUtil {                                            </span>
<span class="3933744472183840087" onmouseenter="enter('3933744472183840087');" onmouseout="out('3933744472183840087');" style="">  35    private final String TAG = &quot;DownloadGroupUtil&quot;;                                                                 </span>
<span class="4123530941227175815" onmouseenter="enter('4123530941227175815');" onmouseout="out('4123530941227175815');" style="">  36    private ExecutorService mInfoPool;                                                                              </span>
<span class="-7564141945772075227" onmouseenter="enter('-7564141945772075227');" onmouseout="out('-7564141945772075227');" style="">  37    private int mInitCompleteNum, mInitFailNum;                                                                     </span>








<span class="8161357676031878454" onmouseenter="enter('8161357676031878454');" onmouseout="out('8161357676031878454');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  38 -  private boolean isStop = false;                                                                                 </span>
<span class="7994908627964275637" onmouseenter="enter('7994908627964275637');" onmouseout="out('7994908627964275637');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  39 +  private boolean isStop = false, isStart = false;                                                                </span>
<span  style="">  40                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  41    /**                                                                                                             </span>
<span class="6416521976967220365" onmouseenter="enter('6416521976967220365');" onmouseout="out('6416521976967220365');" style="">  42     * 文件信息回调组                                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  43     */                                                                                                             </span>
<span class="-5994431595118905059" onmouseenter="enter('-5994431595118905059');" onmouseout="out('-5994431595118905059');" style="">  44    private SparseArray&lt;OnFileInfoCallback&gt; mFileInfoCallbacks = new SparseArray&lt;&gt;();                               </span>
<span  style="">  45                                                                                                                    </span>
<span class="-3731711094107651611" onmouseenter="enter('-3731711094107651611');" onmouseout="out('-3731711094107651611');" style="">  46    public DownloadGroupUtil(IDownloadGroupListener listener, DownloadGroupTaskEntity taskEntity) {                 </span>
<span class="-7841553057471002442" onmouseenter="enter('-7841553057471002442');" onmouseout="out('-7841553057471002442');" style="">  47      super(listener, taskEntity);                                                                                  </span>
<span class="-6453187294675473758" onmouseenter="enter('-6453187294675473758');" onmouseout="out('-6453187294675473758');" style="">  48      mInfoPool = Executors.newCachedThreadPool();                                                                  </span>
<span class="5012053197150764509" onmouseenter="enter('5012053197150764509');" onmouseout="out('5012053197150764509');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  49 -    onPre();                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  50    }                                                                                                               </span>
<span  style="">  51                                                                                                                    </span>
<span class="7947472288428602188" onmouseenter="enter('7947472288428602188');" onmouseout="out('7947472288428602188');" style="">  52    @Override int getTaskType() {                                                                                   </span>
<span class="-9017418965458996171" onmouseenter="enter('-9017418965458996171');" onmouseout="out('-9017418965458996171');" style="">  53      return HTTP_GROUP;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  54    }                                                                                                               </span>
<span  style="">  55                                                                                                                    </span>
<span class="2093106455269248536" onmouseenter="enter('2093106455269248536');" onmouseout="out('2093106455269248536');" style="">  56    @Override public void onCancel() {                                                                              </span>
<span class="-5705545244356268786" onmouseenter="enter('-5705545244356268786');" onmouseout="out('-5705545244356268786');" style="">  57      super.onCancel();                                                                                             </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style="">  58      isStop = true;                                                                                                </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style="">  59      if (!mInfoPool.isShutdown()) {                                                                                </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style="">  60        mInfoPool.shutdown();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  61      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  62    }                                                                                                               </span>
<span  style="">  63                                                                                                                    </span>
<span class="8218595092732559103" onmouseenter="enter('8218595092732559103');" onmouseout="out('8218595092732559103');" style="">  64    @Override protected void onStop() {                                                                             </span>
<span class="-4376279779571809033" onmouseenter="enter('-4376279779571809033');" onmouseout="out('-4376279779571809033');" style="">  65      super.onStop();                                                                                               </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style="">  66      isStop = true;                                                                                                </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style="">  67      if (!mInfoPool.isShutdown()) {                                                                                </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style="">  68        mInfoPool.shutdown();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  69      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70    }                                                                                                               </span>
<span  style="">  71                                                                                                                    </span>
<span class="7849318491336065590" onmouseenter="enter('7849318491336065590');" onmouseout="out('7849318491336065590');" style="">  72    @Override protected void onStart() {                                                                            </span>
<span class="8068463127664630279" onmouseenter="enter('8068463127664630279');" onmouseout="out('8068463127664630279');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  73 -    super.onStart();                                                                                              </span>
<span class="5012053197150764509" onmouseenter="enter('5012053197150764509');" onmouseout="out('5012053197150764509');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  74 +    onPre();                                                                                                      </span>
<span class="-8222534604477057787" onmouseenter="enter('-8222534604477057787');" onmouseout="out('-8222534604477057787');" style="">  75      isStop = false;                                                                                               </span>
<span class="7225088664243368020" onmouseenter="enter('7225088664243368020');" onmouseout="out('7225088664243368020');" style="">  76      if (mCompleteNum == mGroupSize) {                                                                             </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="">  77        mListener.onComplete();                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  78        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  79      }                                                                                                             </span>
<span  style="">  80                                                                                                                    </span>
<span class="-6546016058818690530" onmouseenter="enter('-6546016058818690530');" onmouseout="out('-6546016058818690530');" style="">  81      if (mExeMap.size() == 0) {                                                                                    </span>
<span class="7944887971155137312" onmouseenter="enter('7944887971155137312');" onmouseout="out('7944887971155137312');" style="">  82        ALog.e(TAG, &quot;任务组无可执行任务&quot;);                                                                                   </span>
<span class="-2850265295753937963" onmouseenter="enter('-2850265295753937963');" onmouseout="out('-2850265295753937963');" style="">  83        mListener.onFail(false);                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  84        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85      }                                                                                                             </span>
<span class="4774762395313474868" onmouseenter="enter('4774762395313474868');" onmouseout="out('4774762395313474868');" style="">  86      Set&lt;String&gt; keys = mExeMap.keySet();                                                                          </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="">  87      for (String key : keys) {                                                                                     </span>
<span class="221423537684250497" onmouseenter="enter('221423537684250497');" onmouseout="out('221423537684250497');" style="">  88        DownloadTaskEntity taskEntity = mExeMap.get(key);                                                           </span>
<span class="2875409705898122648" onmouseenter="enter('2875409705898122648');" onmouseout="out('2875409705898122648');" style="">  89        if (taskEntity != null) {                                                                                   </span>
<span class="3825460913713262848" onmouseenter="enter('3825460913713262848');" onmouseout="out('3825460913713262848');" style="">  90          if (taskEntity.getState() != IEntity.STATE_FAIL                                                           </span>
<span class="4045344078755509632" onmouseenter="enter('4045344078755509632');" onmouseout="out('4045344078755509632');" style="">  91              &amp;&amp; taskEntity.getState() != IEntity.STATE_WAIT) {                                                     </span>
<span class="8328172117625509207" onmouseenter="enter('8328172117625509207');" onmouseout="out('8328172117625509207');" style="">  92            mInitCompleteNum++;                                                                                     </span>
<span class="-8219370924340117849" onmouseenter="enter('-8219370924340117849');" onmouseout="out('-8219370924340117849');" style="">  93            createChildDownload(taskEntity);                                                                        </span>
<span class="-8081180094332432926" onmouseenter="enter('-8081180094332432926');" onmouseout="out('-8081180094332432926');" style="">  94            checkStartFlow();                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  95          } else {                                                                                                  </span>
<span class="4135184626453358547" onmouseenter="enter('4135184626453358547');" onmouseout="out('4135184626453358547');" style="">  96            mInfoPool.execute(createFileInfoThread(taskEntity));                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99      }                                                                                                             </span>
<span class="9042102165861284735" onmouseenter="enter('9042102165861284735');" onmouseout="out('9042102165861284735');" style=""> 100      if (mCurrentLocation == mTotalLen) {                                                                          </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 101        mListener.onComplete();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103    }                                                                                                               </span>
<span  style=""> 104                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 105    /**                                                                                                             </span>
<span class="-4547374311767626615" onmouseenter="enter('-4547374311767626615');" onmouseout="out('-4547374311767626615');" style=""> 106     * 创建文件信息获取线程                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 107     */                                                                                                             </span>
<span class="5921359649843257629" onmouseenter="enter('5921359649843257629');" onmouseout="out('5921359649843257629');" style=""> 108    private HttpFileInfoThread createFileInfoThread(DownloadTaskEntity taskEntity) {                                </span>
<span class="3806302679560349109" onmouseenter="enter('3806302679560349109');" onmouseout="out('3806302679560349109');" style=""> 109      OnFileInfoCallback callback = mFileInfoCallbacks.get(taskEntity.hashCode());                                  </span>
<span  style=""> 110                                                                                                                    </span>
<span class="-5681834850649759939" onmouseenter="enter('-5681834850649759939');" onmouseout="out('-5681834850649759939');" style=""> 111      if (callback == null) {                                                                                       </span>
<span class="-2247249715703717317" onmouseenter="enter('-2247249715703717317');" onmouseout="out('-2247249715703717317');" style=""> 112        callback = new OnFileInfoCallback() {                                                                       </span>
<span class="4970948900553010157" onmouseenter="enter('4970948900553010157');" onmouseout="out('4970948900553010157');" style=""> 113          int failNum = 0;                                                                                          </span>
<span  style=""> 114                                                                                                                    </span>
<span class="-2050288510094905379" onmouseenter="enter('-2050288510094905379');" onmouseout="out('-2050288510094905379');" style=""> 115          @Override public void onComplete(String url, CompleteInfo info) {                                         </span>
<span class="1256565039411408673" onmouseenter="enter('1256565039411408673');" onmouseout="out('1256565039411408673');" style=""> 116            if (isStop) return;                                                                                     </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style=""> 117            DownloadTaskEntity te = mExeMap.get(url);                                                               </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style=""> 118            if (te != null) {                                                                                       </span>
<span class="-2199112578045619452" onmouseenter="enter('-2199112578045619452');" onmouseout="out('-2199112578045619452');" style=""> 119              if (isNeedLoadFileSize) {                                                                             </span>
<span class="-1062870475604154862" onmouseenter="enter('-1062870475604154862');" onmouseout="out('-1062870475604154862');" style=""> 120                mTotalLen += te.getEntity().getFileSize();                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121              }                                                                                                     </span>
<span class="-6053482025677790768" onmouseenter="enter('-6053482025677790768');" onmouseout="out('-6053482025677790768');" style=""> 122              createChildDownload(te);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123            }                                                                                                       </span>
<span class="8328172117625509207" onmouseenter="enter('8328172117625509207');" onmouseout="out('8328172117625509207');" style=""> 124            mInitCompleteNum++;                                                                                     </span>
<span  style=""> 125                                                                                                                    </span>
<span class="-8081180094332432926" onmouseenter="enter('-8081180094332432926');" onmouseout="out('-8081180094332432926');" style=""> 126            checkStartFlow();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127          }                                                                                                         </span>
<span  style=""> 128                                                                                                                    </span>
<span class="5765667375964195772" onmouseenter="enter('5765667375964195772');" onmouseout="out('5765667375964195772');" style=""> 129          @Override public void onFail(String url, String errorMsg, boolean needRetry) {                            </span>
<span class="1256565039411408673" onmouseenter="enter('1256565039411408673');" onmouseout="out('1256565039411408673');" style=""> 130            if (isStop) return;                                                                                     </span>
<span class="2366820206004574467" onmouseenter="enter('2366820206004574467');" onmouseout="out('2366820206004574467');" style=""> 131            ALog.e(TAG, &quot;任务【&quot; + url + &quot;】初始化失败。&quot;);                                                                   </span>

<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style=""> 132            DownloadTaskEntity te = mExeMap.get(url);                                                               </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style=""> 133            if (te != null) {                                                                                       </span>
<span class="-3434538459014877633" onmouseenter="enter('-3434538459014877633');" onmouseout="out('-3434538459014877633');" style=""> 134              mFailMap.put(url, te);                                                                                </span>
<span class="8595174373746499082" onmouseenter="enter('8595174373746499082');" onmouseout="out('8595174373746499082');" style=""> 135              mFileInfoCallbacks.put(te.hashCode(), this);                                                          </span>
<span class="1598851862534193089" onmouseenter="enter('1598851862534193089');" onmouseout="out('1598851862534193089');" style=""> 136              mExeMap.remove(url);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137            }                                                                                                       </span>
<span class="-3126918587586078524" onmouseenter="enter('-3126918587586078524');" onmouseout="out('-3126918587586078524');" style=""> 138            //404链接不重试下载                                                                                            </span>
<span class="-8234013754580914183" onmouseenter="enter('-8234013754580914183');" onmouseout="out('-8234013754580914183');" style=""> 139            //if (failNum &lt; 3 &amp;&amp; !errorMsg.contains(&quot;错误码：404&quot;) &amp;&amp; !errorMsg.contains(                               </span>
<span class="-8709538774858874340" onmouseenter="enter('-8709538774858874340');" onmouseout="out('-8709538774858874340');" style=""> 140            //    &quot;UnknownHostException&quot;)) {                                                                        </span>
<span class="4026410517121233117" onmouseenter="enter('4026410517121233117');" onmouseout="out('4026410517121233117');" style=""> 141            //  mInfoPool.execute(createFileInfoThread(te));                                                        </span>
<span class="-9042505775003468696" onmouseenter="enter('-9042505775003468696');" onmouseout="out('-9042505775003468696');" style=""> 142            //} else {                                                                                              </span>
<span class="1565591895697134979" onmouseenter="enter('1565591895697134979');" onmouseout="out('1565591895697134979');" style=""> 143            //  mInitFailNum++;                                                                                     </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style=""> 144            //}                                                                                                     </span>
<span class="41491989208140212" onmouseenter="enter('41491989208140212');" onmouseout="out('41491989208140212');" style=""> 145            //failNum++;                                                                                            </span>
<span class="-2723952096500307408" onmouseenter="enter('-2723952096500307408');" onmouseout="out('-2723952096500307408');" style=""> 146            mInitFailNum++;                                                                                         </span>
<span class="-8081180094332432926" onmouseenter="enter('-8081180094332432926');" onmouseout="out('-8081180094332432926');" style=""> 147            checkStartFlow();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148          }                                                                                                         </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 149        };                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 150      }                                                                                                             </span>
<span class="8019628728195433582" onmouseenter="enter('8019628728195433582');" onmouseout="out('8019628728195433582');" style=""> 151      return new HttpFileInfoThread(taskEntity, callback);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152    }                                                                                                               </span>
<span  style=""> 153                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 154    /**                                                                                                             </span>
<span class="2541186966995292996" onmouseenter="enter('2541186966995292996');" onmouseout="out('2541186966995292996');" style=""> 155     * 检查能否启动下载流程                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 156     */                                                                                                             </span>
<span class="-2867752194918434513" onmouseenter="enter('-2867752194918434513');" onmouseout="out('-2867752194918434513');" style=""> 157    private void checkStartFlow() {                                                                                 </span>
<span class="6122674786435742337" onmouseenter="enter('6122674786435742337');" onmouseout="out('6122674786435742337');" style=""> 158      synchronized (DownloadGroupUtil.class) {                                                                      </span>
<span class="343993768859733057" onmouseenter="enter('343993768859733057');" onmouseout="out('343993768859733057');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 159 -      if (mInitCompleteNum + mInitFailNum &gt;= mGroupSize || !isNeedLoadFileSize) {                                 </span>
<span class="-1218661801474368606" onmouseenter="enter('-1218661801474368606');" onmouseout="out('-1218661801474368606');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 160 +      if (!isStart &amp;&amp; (mInitCompleteNum + mInitFailNum &gt;= mGroupSize || !isNeedLoadFileSize)) {                   </span>




<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style=""> 161          startRunningFlow();                                                                                       </span>
<span class="4169610006794036589" onmouseenter="enter('4169610006794036589');" onmouseout="out('4169610006794036589');" style=""> 162          updateFileSize();                                                                                         </span>
<span class="-6219947928101527010" onmouseenter="enter('-6219947928101527010');" onmouseout="out('-6219947928101527010');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 163 +        isStart = true;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166    }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="4634392904032211814" onmouseenter="enter('4634392904032211814');" onmouseout="out('4634392904032211814');" style="">  16  package com.arialyy.aria.core.download.downloader;                                                                </span>
<span  style="">  17                                                                                                                    </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  18  import android.util.SparseArray;                                                                                  </span>
<span class="5028823532254250595" onmouseenter="enter('5028823532254250595');" onmouseout="out('5028823532254250595');" style="">  19  import com.arialyy.aria.core.common.CompleteInfo;                                                                 </span>
<span class="-3094174390533083180" onmouseenter="enter('-3094174390533083180');" onmouseout="out('-3094174390533083180');" style="">  20  import com.arialyy.aria.core.common.IUtil;                                                                        </span>
<span class="-1788009330887423510" onmouseenter="enter('-1788009330887423510');" onmouseout="out('-1788009330887423510');" style="">  21  import com.arialyy.aria.core.common.OnFileInfoCallback;                                                           </span>
<span class="5290109400157436023" onmouseenter="enter('5290109400157436023');" onmouseout="out('5290109400157436023');" style="">  22  import com.arialyy.aria.core.download.DownloadGroupTaskEntity;                                                    </span>
<span class="8636089030381561336" onmouseenter="enter('8636089030381561336');" onmouseout="out('8636089030381561336');" style="">  23  import com.arialyy.aria.core.download.DownloadTaskEntity;                                                         </span>
<span class="-5016163043314935005" onmouseenter="enter('-5016163043314935005');" onmouseout="out('-5016163043314935005');" style="">  24  import com.arialyy.aria.core.inf.IEntity;                                                                         </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  25  import com.arialyy.aria.util.ALog;                                                                                </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  26  import java.util.Set;                                                                                             </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  27  import java.util.concurrent.ExecutorService;                                                                      </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  28  import java.util.concurrent.Executors;                                                                            </span>
<span  style="">  29                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  30  /**                                                                                                               </span>
<span class="1321179419529258125" onmouseenter="enter('1321179419529258125');" onmouseout="out('1321179419529258125');" style="">  31   * Created by AriaL on 2017/6/30.                                                                                 </span>
<span class="7496304558415279260" onmouseenter="enter('7496304558415279260');" onmouseout="out('7496304558415279260');" style="">  32   * 任务组下载工具                                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  33   */                                                                                                               </span>
<span class="753905216202195114" onmouseenter="enter('753905216202195114');" onmouseout="out('753905216202195114');" style="">  34  public class DownloadGroupUtil extends AbsGroupUtil implements IUtil {                                            </span>
<span class="3933744472183840087" onmouseenter="enter('3933744472183840087');" onmouseout="out('3933744472183840087');" style="">  35    private final String TAG = &quot;DownloadGroupUtil&quot;;                                                                 </span>
<span class="4123530941227175815" onmouseenter="enter('4123530941227175815');" onmouseout="out('4123530941227175815');" style="">  36    private ExecutorService mInfoPool;                                                                              </span>
<span class="-7564141945772075227" onmouseenter="enter('-7564141945772075227');" onmouseout="out('-7564141945772075227');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  37 -  private int mInitCompleteNum, mInitFailNum;                                                                     </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  38 +  /**                                                                                                             </span>
<span class="1482282106677302068" onmouseenter="enter('1482282106677302068');" onmouseout="out('1482282106677302068');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  39 +   * 初始化完成的任务数                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  40 +   */                                                                                                             </span>
<span class="4248926893461222874" onmouseenter="enter('4248926893461222874');" onmouseout="out('4248926893461222874');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  41 +  private int mInitCompleteNum;                                                                                   </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  42 +  /**                                                                                                             </span>
<span class="5189388546664003005" onmouseenter="enter('5189388546664003005');" onmouseout="out('5189388546664003005');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  43 +   * 初始化失败的任务数                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  44 +   */                                                                                                             </span>
<span class="-2622077359609901637" onmouseenter="enter('-2622077359609901637');" onmouseout="out('-2622077359609901637');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  45 +  private int mInitFailNum;                                                                                       </span>
<span class="8161357676031878454" onmouseenter="enter('8161357676031878454');" onmouseout="out('8161357676031878454');" style="">  46    private boolean isStop = false;                                                                                 </span>

<span  style="">  47                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  48    /**                                                                                                             </span>
<span class="6416521976967220365" onmouseenter="enter('6416521976967220365');" onmouseout="out('6416521976967220365');" style="">  49     * 文件信息回调组                                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  50     */                                                                                                             </span>
<span class="-5994431595118905059" onmouseenter="enter('-5994431595118905059');" onmouseout="out('-5994431595118905059');" style="">  51    private SparseArray&lt;OnFileInfoCallback&gt; mFileInfoCallbacks = new SparseArray&lt;&gt;();                               </span>
<span  style="">  52                                                                                                                    </span>
<span class="-3731711094107651611" onmouseenter="enter('-3731711094107651611');" onmouseout="out('-3731711094107651611');" style="">  53    public DownloadGroupUtil(IDownloadGroupListener listener, DownloadGroupTaskEntity taskEntity) {                 </span>
<span class="-7841553057471002442" onmouseenter="enter('-7841553057471002442');" onmouseout="out('-7841553057471002442');" style="">  54      super(listener, taskEntity);                                                                                  </span>
<span class="-6453187294675473758" onmouseenter="enter('-6453187294675473758');" onmouseout="out('-6453187294675473758');" style="">  55      mInfoPool = Executors.newCachedThreadPool();                                                                  </span>
<span class="5012053197150764509" onmouseenter="enter('5012053197150764509');" onmouseout="out('5012053197150764509');" style="">  56      onPre();                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  57    }                                                                                                               </span>
<span  style="">  58                                                                                                                    </span>
<span class="7947472288428602188" onmouseenter="enter('7947472288428602188');" onmouseout="out('7947472288428602188');" style="">  59    @Override int getTaskType() {                                                                                   </span>
<span class="-9017418965458996171" onmouseenter="enter('-9017418965458996171');" onmouseout="out('-9017418965458996171');" style="">  60      return HTTP_GROUP;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  61    }                                                                                                               </span>
<span  style="">  62                                                                                                                    </span>
<span class="2093106455269248536" onmouseenter="enter('2093106455269248536');" onmouseout="out('2093106455269248536');" style="">  63    @Override public void onCancel() {                                                                              </span>
<span class="-5705545244356268786" onmouseenter="enter('-5705545244356268786');" onmouseout="out('-5705545244356268786');" style="">  64      super.onCancel();                                                                                             </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style="">  65      isStop = true;                                                                                                </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style="">  66      if (!mInfoPool.isShutdown()) {                                                                                </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style="">  67        mInfoPool.shutdown();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  68      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  69    }                                                                                                               </span>
<span  style="">  70                                                                                                                    </span>
<span class="8218595092732559103" onmouseenter="enter('8218595092732559103');" onmouseout="out('8218595092732559103');" style="">  71    @Override protected void onStop() {                                                                             </span>
<span class="-4376279779571809033" onmouseenter="enter('-4376279779571809033');" onmouseout="out('-4376279779571809033');" style="">  72      super.onStop();                                                                                               </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style="">  73      isStop = true;                                                                                                </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style="">  74      if (!mInfoPool.isShutdown()) {                                                                                </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style="">  75        mInfoPool.shutdown();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  76      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77    }                                                                                                               </span>
<span  style="">  78                                                                                                                    </span>
<span class="7849318491336065590" onmouseenter="enter('7849318491336065590');" onmouseout="out('7849318491336065590');" style="">  79    @Override protected void onStart() {                                                                            </span>
<span class="8068463127664630279" onmouseenter="enter('8068463127664630279');" onmouseout="out('8068463127664630279');" style="">  80      super.onStart();                                                                                              </span>

<span class="-8222534604477057787" onmouseenter="enter('-8222534604477057787');" onmouseout="out('-8222534604477057787');" style="">  81      isStop = false;                                                                                               </span>
<span class="7225088664243368020" onmouseenter="enter('7225088664243368020');" onmouseout="out('7225088664243368020');" style="">  82      if (mCompleteNum == mGroupSize) {                                                                             </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="">  83        mListener.onComplete();                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  84        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85      }                                                                                                             </span>
<span  style="">  86                                                                                                                    </span>
<span class="-6546016058818690530" onmouseenter="enter('-6546016058818690530');" onmouseout="out('-6546016058818690530');" style="">  87      if (mExeMap.size() == 0) {                                                                                    </span>
<span class="7944887971155137312" onmouseenter="enter('7944887971155137312');" onmouseout="out('7944887971155137312');" style="">  88        ALog.e(TAG, &quot;任务组无可执行任务&quot;);                                                                                   </span>
<span class="-2850265295753937963" onmouseenter="enter('-2850265295753937963');" onmouseout="out('-2850265295753937963');" style="">  89        mListener.onFail(false);                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  90        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91      }                                                                                                             </span>
<span class="4774762395313474868" onmouseenter="enter('4774762395313474868');" onmouseout="out('4774762395313474868');" style="">  92      Set&lt;String&gt; keys = mExeMap.keySet();                                                                          </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="">  93      for (String key : keys) {                                                                                     </span>
<span class="221423537684250497" onmouseenter="enter('221423537684250497');" onmouseout="out('221423537684250497');" style="">  94        DownloadTaskEntity taskEntity = mExeMap.get(key);                                                           </span>
<span class="2875409705898122648" onmouseenter="enter('2875409705898122648');" onmouseout="out('2875409705898122648');" style="">  95        if (taskEntity != null) {                                                                                   </span>
<span class="3825460913713262848" onmouseenter="enter('3825460913713262848');" onmouseout="out('3825460913713262848');" style="">  96          if (taskEntity.getState() != IEntity.STATE_FAIL                                                           </span>
<span class="4045344078755509632" onmouseenter="enter('4045344078755509632');" onmouseout="out('4045344078755509632');" style="">  97              &amp;&amp; taskEntity.getState() != IEntity.STATE_WAIT) {                                                     </span>
<span class="8328172117625509207" onmouseenter="enter('8328172117625509207');" onmouseout="out('8328172117625509207');" style="">  98            mInitCompleteNum++;                                                                                     </span>
<span class="-8219370924340117849" onmouseenter="enter('-8219370924340117849');" onmouseout="out('-8219370924340117849');" style="">  99            createChildDownload(taskEntity);                                                                        </span>
<span class="-8081180094332432926" onmouseenter="enter('-8081180094332432926');" onmouseout="out('-8081180094332432926');" style=""> 100            checkStartFlow();                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 101          } else {                                                                                                  </span>
<span class="4135184626453358547" onmouseenter="enter('4135184626453358547');" onmouseout="out('4135184626453358547');" style=""> 102            mInfoPool.execute(createFileInfoThread(taskEntity));                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105      }                                                                                                             </span>
<span class="9042102165861284735" onmouseenter="enter('9042102165861284735');" onmouseout="out('9042102165861284735');" style=""> 106      if (mCurrentLocation == mTotalLen) {                                                                          </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 107        mListener.onComplete();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 109    }                                                                                                               </span>
<span  style=""> 110                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 111    /**                                                                                                             </span>
<span class="-4547374311767626615" onmouseenter="enter('-4547374311767626615');" onmouseout="out('-4547374311767626615');" style=""> 112     * 创建文件信息获取线程                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 113     */                                                                                                             </span>
<span class="5921359649843257629" onmouseenter="enter('5921359649843257629');" onmouseout="out('5921359649843257629');" style=""> 114    private HttpFileInfoThread createFileInfoThread(DownloadTaskEntity taskEntity) {                                </span>
<span class="3806302679560349109" onmouseenter="enter('3806302679560349109');" onmouseout="out('3806302679560349109');" style=""> 115      OnFileInfoCallback callback = mFileInfoCallbacks.get(taskEntity.hashCode());                                  </span>
<span  style=""> 116                                                                                                                    </span>
<span class="-5681834850649759939" onmouseenter="enter('-5681834850649759939');" onmouseout="out('-5681834850649759939');" style=""> 117      if (callback == null) {                                                                                       </span>
<span class="-2247249715703717317" onmouseenter="enter('-2247249715703717317');" onmouseout="out('-2247249715703717317');" style=""> 118        callback = new OnFileInfoCallback() {                                                                       </span>
<span class="4970948900553010157" onmouseenter="enter('4970948900553010157');" onmouseout="out('4970948900553010157');" style=""> 119          int failNum = 0;                                                                                          </span>
<span  style=""> 120                                                                                                                    </span>
<span class="-2050288510094905379" onmouseenter="enter('-2050288510094905379');" onmouseout="out('-2050288510094905379');" style=""> 121          @Override public void onComplete(String url, CompleteInfo info) {                                         </span>
<span class="1256565039411408673" onmouseenter="enter('1256565039411408673');" onmouseout="out('1256565039411408673');" style=""> 122            if (isStop) return;                                                                                     </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style=""> 123            DownloadTaskEntity te = mExeMap.get(url);                                                               </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style=""> 124            if (te != null) {                                                                                       </span>
<span class="-2199112578045619452" onmouseenter="enter('-2199112578045619452');" onmouseout="out('-2199112578045619452');" style=""> 125              if (isNeedLoadFileSize) {                                                                             </span>
<span class="-1062870475604154862" onmouseenter="enter('-1062870475604154862');" onmouseout="out('-1062870475604154862');" style=""> 126                mTotalLen += te.getEntity().getFileSize();                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127              }                                                                                                     </span>
<span class="-6053482025677790768" onmouseenter="enter('-6053482025677790768');" onmouseout="out('-6053482025677790768');" style=""> 128              createChildDownload(te);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 129            }                                                                                                       </span>
<span class="8328172117625509207" onmouseenter="enter('8328172117625509207');" onmouseout="out('8328172117625509207');" style=""> 130            mInitCompleteNum++;                                                                                     </span>
<span  style=""> 131                                                                                                                    </span>
<span class="-8081180094332432926" onmouseenter="enter('-8081180094332432926');" onmouseout="out('-8081180094332432926');" style=""> 132            checkStartFlow();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133          }                                                                                                         </span>
<span  style=""> 134                                                                                                                    </span>
<span class="5765667375964195772" onmouseenter="enter('5765667375964195772');" onmouseout="out('5765667375964195772');" style=""> 135          @Override public void onFail(String url, String errorMsg, boolean needRetry) {                            </span>
<span class="1256565039411408673" onmouseenter="enter('1256565039411408673');" onmouseout="out('1256565039411408673');" style=""> 136            if (isStop) return;                                                                                     </span>
<span class="2366820206004574467" onmouseenter="enter('2366820206004574467');" onmouseout="out('2366820206004574467');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 137 -          ALog.e(TAG, &quot;任务【&quot; + url + &quot;】初始化失败。&quot;);                                                                   </span>
<span class="3623631062921094381" onmouseenter="enter('3623631062921094381');" onmouseout="out('3623631062921094381');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 138 +          ALog.e(TAG, String.format(&quot;任务【%s】初始化失败&quot;, url));                                                         </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style=""> 139            DownloadTaskEntity te = mExeMap.get(url);                                                               </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style=""> 140            if (te != null) {                                                                                       </span>
<span class="-3434538459014877633" onmouseenter="enter('-3434538459014877633');" onmouseout="out('-3434538459014877633');" style=""> 141              mFailMap.put(url, te);                                                                                </span>
<span class="8595174373746499082" onmouseenter="enter('8595174373746499082');" onmouseout="out('8595174373746499082');" style=""> 142              mFileInfoCallbacks.put(te.hashCode(), this);                                                          </span>
<span class="1598851862534193089" onmouseenter="enter('1598851862534193089');" onmouseout="out('1598851862534193089');" style=""> 143              mExeMap.remove(url);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144            }                                                                                                       </span>
<span class="-3126918587586078524" onmouseenter="enter('-3126918587586078524');" onmouseout="out('-3126918587586078524');" style=""> 145            //404链接不重试下载                                                                                            </span>
<span class="-8234013754580914183" onmouseenter="enter('-8234013754580914183');" onmouseout="out('-8234013754580914183');" style=""> 146            //if (failNum &lt; 3 &amp;&amp; !errorMsg.contains(&quot;错误码：404&quot;) &amp;&amp; !errorMsg.contains(                               </span>
<span class="-8709538774858874340" onmouseenter="enter('-8709538774858874340');" onmouseout="out('-8709538774858874340');" style=""> 147            //    &quot;UnknownHostException&quot;)) {                                                                        </span>
<span class="4026410517121233117" onmouseenter="enter('4026410517121233117');" onmouseout="out('4026410517121233117');" style=""> 148            //  mInfoPool.execute(createFileInfoThread(te));                                                        </span>
<span class="-9042505775003468696" onmouseenter="enter('-9042505775003468696');" onmouseout="out('-9042505775003468696');" style=""> 149            //} else {                                                                                              </span>
<span class="1565591895697134979" onmouseenter="enter('1565591895697134979');" onmouseout="out('1565591895697134979');" style=""> 150            //  mInitFailNum++;                                                                                     </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style=""> 151            //}                                                                                                     </span>
<span class="41491989208140212" onmouseenter="enter('41491989208140212');" onmouseout="out('41491989208140212');" style=""> 152            //failNum++;                                                                                            </span>
<span class="-2723952096500307408" onmouseenter="enter('-2723952096500307408');" onmouseout="out('-2723952096500307408');" style=""> 153            mInitFailNum++;                                                                                         </span>
<span class="-8081180094332432926" onmouseenter="enter('-8081180094332432926');" onmouseout="out('-8081180094332432926');" style=""> 154            checkStartFlow();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155          }                                                                                                         </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 156        };                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157      }                                                                                                             </span>
<span class="8019628728195433582" onmouseenter="enter('8019628728195433582');" onmouseout="out('8019628728195433582');" style=""> 158      return new HttpFileInfoThread(taskEntity, callback);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159    }                                                                                                               </span>
<span  style=""> 160                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 161    /**                                                                                                             </span>
<span class="2541186966995292996" onmouseenter="enter('2541186966995292996');" onmouseout="out('2541186966995292996');" style=""> 162     * 检查能否启动下载流程                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 163     */                                                                                                             </span>
<span class="-2867752194918434513" onmouseenter="enter('-2867752194918434513');" onmouseout="out('-2867752194918434513');" style=""> 164    private void checkStartFlow() {                                                                                 </span>
<span class="6122674786435742337" onmouseenter="enter('6122674786435742337');" onmouseout="out('6122674786435742337');" style=""> 165      synchronized (DownloadGroupUtil.class) {                                                                      </span>
<span class="343993768859733057" onmouseenter="enter('343993768859733057');" onmouseout="out('343993768859733057');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 166 -      if (mInitCompleteNum + mInitFailNum &gt;= mGroupSize || !isNeedLoadFileSize) {                                 </span>
<span class="4224064111605117456" onmouseenter="enter('4224064111605117456');" onmouseout="out('4224064111605117456');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 167 +      if (mInitFailNum == mGroupSize){                                                                            </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 168 +        closeTimer(false);                                                                                        </span>
<span class="-4116834270158797210" onmouseenter="enter('-4116834270158797210');" onmouseout="out('-4116834270158797210');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 169 +        mListener.onFail(true);                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 170 +      }                                                                                                           </span>
<span class="1828548532727566043" onmouseenter="enter('1828548532727566043');" onmouseout="out('1828548532727566043');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 171 +      if (mInitCompleteNum + mInitFailNum == mGroupSize || !isNeedLoadFileSize) {                                 </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style=""> 172          startRunningFlow();                                                                                       </span>
<span class="4169610006794036589" onmouseenter="enter('4169610006794036589');" onmouseout="out('4169610006794036589');" style=""> 173          updateFileSize();                                                                                         </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176    }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            