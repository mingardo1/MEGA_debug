<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>273</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    273
                    <a href="272.html">prev</a>
                    <a href="274.html">next</a>
                    <a href="273_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    BroadleafCommerce/BroadleafCommerce_7372a30b9f3190df28e61f8437f110c95d36b4fa_core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/offer/dao/OfferAuditDaoImpl.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;7372a30b9f3190df28e61f8437f110c95d36b4fa:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/offer/dao/OfferAuditDaoImpl.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;7372a30b9f3190df28e61f8437f110c95d36b4fa^1:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/offer/dao/OfferAuditDaoImpl.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;7372a30b9f3190df28e61f8437f110c95d36b4fa^2:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/offer/dao/OfferAuditDaoImpl.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;65989a8b6469e6f21626a6b7292822865b1618ba:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/offer/dao/OfferAuditDaoImpl.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [j], [s]], subset: [[bj], [s]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3  * BroadleafCommerce Framework                                                                           </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="4581976383907508446" onmouseenter="enter('4581976383907508446');" onmouseout="out('4581976383907508446');" style="">  18 package org.broadleafcommerce.core.offer.dao;                                                            </span>
<span  style="">  19                                                                                                          </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  20 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  21 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="4111478795314305516" onmouseenter="enter('4111478795314305516');" onmouseout="out('4111478795314305516');" style="">  22 import org.broadleafcommerce.common.persistence.EntityConfiguration;                                     </span>
<span class="1373992879208813777" onmouseenter="enter('1373992879208813777');" onmouseout="out('1373992879208813777');" style="">  23 import org.broadleafcommerce.common.time.SystemTime;                                                     </span>
<span class="8922526534929083638" onmouseenter="enter('8922526534929083638');" onmouseout="out('8922526534929083638');" style="">  24 import org.broadleafcommerce.common.util.dao.TypedQueryBuilder;                                          </span>
<span class="64523562193483090" onmouseenter="enter('64523562193483090');" onmouseout="out('64523562193483090');" style="">  25 import org.broadleafcommerce.core.offer.domain.OfferAudit;                                               </span>
<span class="-5495020915230320478" onmouseenter="enter('-5495020915230320478');" onmouseout="out('-5495020915230320478');" style="">  26 import org.broadleafcommerce.core.offer.domain.OfferAuditImpl;                                           </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  27 import org.broadleafcommerce.core.order.domain.Order;                                                    </span>
<span class="-9126455085472227806" onmouseenter="enter('-9126455085472227806');" onmouseout="out('-9126455085472227806');" style="">  28 import org.broadleafcommerce.core.order.domain.OrderImpl;                                                </span>
<span class="614288234168063731" onmouseenter="enter('614288234168063731');" onmouseout="out('614288234168063731');" style="">  29 import org.broadleafcommerce.core.order.service.type.OrderStatus;                                        </span>
<span class="-4190555539420257130" onmouseenter="enter('-4190555539420257130');" onmouseout="out('-4190555539420257130');" style="">  30 import org.springframework.stereotype.Repository;                                                        </span>
<span  style="">  31                                                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  32 import java.util.ArrayList;                                                                              </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  33 import java.util.Calendar;                                                                               </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="">  34 import java.util.Date;                                                                                   </span>
<span class="-4685965902094386510" onmouseenter="enter('-4685965902094386510');" onmouseout="out('-4685965902094386510');" style="">  35 import java.util.GregorianCalendar;                                                                      </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  36 import java.util.List;                                                                                   </span>
<span  style="">  37                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  38 import javax.annotation.Resource;                                                                        </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  39 import javax.persistence.EntityManager;                                                                  </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  40 import javax.persistence.PersistenceContext;                                                             </span>
<span class="6539032290250175619" onmouseenter="enter('6539032290250175619');" onmouseout="out('6539032290250175619');" style="">  41 import javax.persistence.TypedQuery;                                                                     </span>
<span class="8485852916582699615" onmouseenter="enter('8485852916582699615');" onmouseout="out('8485852916582699615');" style="">  42 import javax.persistence.criteria.CriteriaBuilder;                                                       </span>
<span class="9191540725958216337" onmouseenter="enter('9191540725958216337');" onmouseout="out('9191540725958216337');" style="">  43 import javax.persistence.criteria.CriteriaQuery;                                                         </span>
<span class="7244103982108254428" onmouseenter="enter('7244103982108254428');" onmouseout="out('7244103982108254428');" style="">  44 import javax.persistence.criteria.Predicate;                                                             </span>
<span class="5782830673162504954" onmouseenter="enter('5782830673162504954');" onmouseout="out('5782830673162504954');" style="">  45 import javax.persistence.criteria.Root;                                                                  </span>
<span  style="">  46                                                                                                          </span>
<span class="2189143306704906144" onmouseenter="enter('2189143306704906144');" onmouseout="out('2189143306704906144');" style="">  47 @Repository(&quot;blOfferAuditDao&quot;)                                                                           </span>
<span class="6923906510730234638" onmouseenter="enter('6923906510730234638');" onmouseout="out('6923906510730234638');" style="">  48 public class OfferAuditDaoImpl implements OfferAuditDao {                                                </span>
<span  style="">  49                                                                                                          </span>
<span class="-6459053967516643845" onmouseenter="enter('-6459053967516643845');" onmouseout="out('-6459053967516643845');" style="">  50     protected static final Log LOG = LogFactory.getLog(OfferAuditDaoImpl.class);                         </span>
<span  style="">  51                                                                                                          </span>
<span class="-491914183795829879" onmouseenter="enter('-491914183795829879');" onmouseout="out('-491914183795829879');" style="">  52     private static final Long NULL_ACCOUNT_ID = null;                                                    </span>
<span class="4392557768743364645" onmouseenter="enter('4392557768743364645');" onmouseout="out('4392557768743364645');" style="">  53     private static final Long NULL_CUSTOMER_ID = null;                                                   </span>
<span  style="">  54                                                                                                          </span>
<span class="-4259734795637808055" onmouseenter="enter('-4259734795637808055');" onmouseout="out('-4259734795637808055');" style="">  55     @PersistenceContext(unitName=&quot;blPU&quot;)                                                                 </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style="">  56     protected EntityManager em;                                                                          </span>
<span  style="">  57                                                                                                          </span>
<span class="1637373992155499263" onmouseenter="enter('1637373992155499263');" onmouseout="out('1637373992155499263');" style="">  58     @Resource(name=&quot;blEntityConfiguration&quot;)                                                              </span>
<span class="-8812870795397979367" onmouseenter="enter('-8812870795397979367');" onmouseout="out('-8812870795397979367');" style="">  59     protected EntityConfiguration entityConfiguration;                                                   </span>
<span  style="">  60                                                                                                          </span>
<span class="-7049669380064237434" onmouseenter="enter('-7049669380064237434');" onmouseout="out('-7049669380064237434');" style="">  61     protected Long currentDateResolution = 3600000L;                                                     </span>
<span class="-3015759496674095868" onmouseenter="enter('-3015759496674095868');" onmouseout="out('-3015759496674095868');" style="">  62     protected Date cachedDate = SystemTime.asDate();                                                     </span>
<span  style="">  63                                                                                                          </span>
<span class="-1267510524885549695" onmouseenter="enter('-1267510524885549695');" onmouseout="out('-1267510524885549695');" style="">  64     protected Date getCurrentDateAfterFactoringInDateResolution() {                                      </span>
<span class="7456092887221268123" onmouseenter="enter('7456092887221268123');" onmouseout="out('7456092887221268123');" style=""><abbr title="  65         Date returnDate = SystemTime.getCurrentDateWithinTimeResolution(cachedDate, getCurrentDateResolution());">  65         Date returnDate = SystemTime.getCurrentDateWithinTimeResolution(cachedDate, getCurrentDateResolutðŸ”µ</abbr></span>
<span class="-701896352794694369" onmouseenter="enter('-701896352794694369');" onmouseout="out('-701896352794694369');" style="">  66         if (returnDate != cachedDate) {                                                                  </span>
<span class="5100208720017764216" onmouseenter="enter('5100208720017764216');" onmouseout="out('5100208720017764216');" style="">  67             if (SystemTime.shouldCacheDate()) {                                                          </span>
<span class="-2842817032367762030" onmouseenter="enter('-2842817032367762030');" onmouseout="out('-2842817032367762030');" style="">  68                 cachedDate = returnDate;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  69             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70         }                                                                                                </span>
<span class="8495881565272727908" onmouseenter="enter('8495881565272727908');" onmouseout="out('8495881565272727908');" style="">  71         return returnDate;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  72     }                                                                                                    </span>
<span  style="">  73                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  74     @Override                                                                                            </span>
<span class="6767135535803548971" onmouseenter="enter('6767135535803548971');" onmouseout="out('6767135535803548971');" style="">  75     public OfferAudit create() {                                                                         </span>
<span class="3805797155674316037" onmouseenter="enter('3805797155674316037');" onmouseout="out('3805797155674316037');" style="">  76         return ((OfferAudit) entityConfiguration.createEntityInstance(OfferAudit.class.getName()));      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77     }                                                                                                    </span>
<span  style="">  78                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  79     @Override                                                                                            </span>
<span class="-952767806084988342" onmouseenter="enter('-952767806084988342');" onmouseout="out('-952767806084988342');" style="">  80     public void delete(final OfferAudit offerAudit) {                                                    </span>
<span class="2838826885943543038" onmouseenter="enter('2838826885943543038');" onmouseout="out('2838826885943543038');" style="">  81         OfferAudit loa = offerAudit;                                                                     </span>
<span  style="">  82                                                                                                          </span>
<span class="4622151386703876716" onmouseenter="enter('4622151386703876716');" onmouseout="out('4622151386703876716');" style="">  83         if (!em.contains(loa)) {                                                                         </span>
<span class="8756231357348641283" onmouseenter="enter('8756231357348641283');" onmouseout="out('8756231357348641283');" style="">  84             loa = readAuditById(offerAudit.getId());                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85         }                                                                                                </span>
<span  style="">  86                                                                                                          </span>
<span class="524329334072964961" onmouseenter="enter('524329334072964961');" onmouseout="out('524329334072964961');" style="">  87         em.remove(loa);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  88     }                                                                                                    </span>
<span  style="">  89                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  90     @Override                                                                                            </span>
<span class="-2141129694682598847" onmouseenter="enter('-2141129694682598847');" onmouseout="out('-2141129694682598847');" style="">  91     public OfferAudit save(final OfferAudit offerAudit) {                                                </span>
<span class="-2813547888935568298" onmouseenter="enter('-2813547888935568298');" onmouseout="out('-2813547888935568298');" style="">  92         return em.merge(offerAudit);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93     }                                                                                                    </span>
<span  style="">  94                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  95     @Override                                                                                            </span>
<span class="-390957289170684724" onmouseenter="enter('-390957289170684724');" onmouseout="out('-390957289170684724');" style="">  96     public OfferAudit readAuditById(final Long offerAuditId) {                                           </span>
<span class="-2996840779846502092" onmouseenter="enter('-2996840779846502092');" onmouseout="out('-2996840779846502092');" style="">  97         return em.find(OfferAuditImpl.class, offerAuditId);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98     }                                                                                                    </span>
<span  style="">  99                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 100     @Override                                                                                            </span>
<span class="3411365851442909550" onmouseenter="enter('3411365851442909550');" onmouseout="out('3411365851442909550');" style=""> 101     public Long countUsesByCustomer(Order order, Long customerId, Long offerId) {                        </span>
<span class="-2974270557069561693" onmouseenter="enter('-2974270557069561693');" onmouseout="out('-2974270557069561693');" style=""> 102         return countUsesByCustomer(order, customerId, offerId, null);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103     }                                                                                                    </span>
<span  style=""> 104                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 105     @Override                                                                                            </span>
<span class="4451867570096397072" onmouseenter="enter('4451867570096397072');" onmouseout="out('4451867570096397072');" style=""> 106     public Long countUsesByAccount(Order order, Long accountId, Long offerId) {                          </span>
<span class="-4556253105265349228" onmouseenter="enter('-4556253105265349228');" onmouseout="out('-4556253105265349228');" style=""> 107         return countUsesByAccount(order, accountId, offerId, null);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108     }                                                                                                    </span>
<span  style=""> 109                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 110     @Override                                                                                            </span>
<span class="-8843695615789214022" onmouseenter="enter('-8843695615789214022');" onmouseout="out('-8843695615789214022');" style=""> 111     public Long countUsesByAccount(Order order, Long accountId, Long offerId, Long minimumDaysPerUsage) {</span>
<span class="8502471645147940958" onmouseenter="enter('8502471645147940958');" onmouseout="out('8502471645147940958');" style=""><abbr title=" 112         return countUsesByAccountOrCustomer(order, NULL_CUSTOMER_ID, accountId, offerId, minimumDaysPerUsage);"> 112         return countUsesByAccountOrCustomer(order, NULL_CUSTOMER_ID, accountId, offerId, minimumDaysPerUsðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113     }                                                                                                    </span>
<span  style=""> 114                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 115     @Override                                                                                            </span>
<span class="-8998115950668362110" onmouseenter="enter('-8998115950668362110');" onmouseout="out('-8998115950668362110');" style=""><abbr title=" 116     public Long countUsesByCustomer(Order order, Long customerId, Long offerId, Long minimumDaysPerUsage) {"> 116     public Long countUsesByCustomer(Order order, Long customerId, Long offerId, Long minimumDaysPerUsage)ðŸ”µ</abbr></span>
<span class="354199176914940576" onmouseenter="enter('354199176914940576');" onmouseout="out('354199176914940576');" style=""><abbr title=" 117         return countUsesByAccountOrCustomer(order, customerId, NULL_ACCOUNT_ID, offerId, minimumDaysPerUsage);"> 117         return countUsesByAccountOrCustomer(order, customerId, NULL_ACCOUNT_ID, offerId, minimumDaysPerUsðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118     }                                                                                                    </span>
<span  style=""> 119                                                                                                          </span>
<span class="1120399754244046360" onmouseenter="enter('1120399754244046360');" onmouseout="out('1120399754244046360');" style=""><abbr title=" 120     protected Long countUsesByAccountOrCustomer(Order order, Long customerId, Long accountId, Long offerId, Long minimumDaysPerUsage) {"> 120     protected Long countUsesByAccountOrCustomer(Order order, Long customerId, Long accountId, Long offerIðŸ”µ</abbr></span>
<span class="2959951002703615279" onmouseenter="enter('2959951002703615279');" onmouseout="out('2959951002703615279');" style=""> 121         CriteriaBuilder builder = em.getCriteriaBuilder();                                               </span>
<span class="1553585152448885012" onmouseenter="enter('1553585152448885012');" onmouseout="out('1553585152448885012');" style=""> 122         CriteriaQuery&lt;Long&gt; criteria = builder.createQuery(Long.class);                                  </span>
<span class="3736188372297695145" onmouseenter="enter('3736188372297695145');" onmouseout="out('3736188372297695145');" style=""> 123         Root&lt;OfferAuditImpl&gt; root = criteria.from(OfferAuditImpl.class);                                 </span>
<span class="794269994561015699" onmouseenter="enter('794269994561015699');" onmouseout="out('794269994561015699');" style=""> 124         Root&lt;OrderImpl&gt; orderRoot = criteria.from(OrderImpl.class);                                      </span>
<span class="-6081006627188172407" onmouseenter="enter('-6081006627188172407');" onmouseout="out('-6081006627188172407');" style=""> 125         criteria.select(builder.count(root));                                                            </span>
<span  style=""> 126                                                                                                          </span>
<span class="-7985475506215634506" onmouseenter="enter('-7985475506215634506');" onmouseout="out('-7985475506215634506');" style=""> 127         Predicate customerOrAccountPredicate = null;                                                     </span>
<span  style=""> 128                                                                                                          </span>
<span class="-8452861246579893242" onmouseenter="enter('-8452861246579893242');" onmouseout="out('-8452861246579893242');" style=""> 129         if (customerId != null) {                                                                        </span>
<span class="4779664179124354463" onmouseenter="enter('4779664179124354463');" onmouseout="out('4779664179124354463');" style=""> 130             customerOrAccountPredicate = builder.equal(root.get(&quot;customerId&quot;), customerId);              </span>
<span class="2030117130977549016" onmouseenter="enter('2030117130977549016');" onmouseout="out('2030117130977549016');" style=""> 131         } else if (accountId != null) {                                                                  </span>
<span class="-8726287971348706514" onmouseenter="enter('-8726287971348706514');" onmouseout="out('-8726287971348706514');" style=""> 132             customerOrAccountPredicate = builder.equal(root.get(&quot;accountId&quot;), accountId);                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 133         } else {                                                                                         </span>
<span class="9008286842041895655" onmouseenter="enter('9008286842041895655');" onmouseout="out('9008286842041895655');" style=""> 134             LOG.debug(&quot;Count uses by account or customer called without an account or a customer.&quot;);     </span>
<span class="-7938083568872702361" onmouseenter="enter('-7938083568872702361');" onmouseout="out('-7938083568872702361');" style=""> 135             return 0L;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136         }                                                                                                </span>
<span  style=""> 137                                                                                                          </span>
<span class="4776002924984894403" onmouseenter="enter('4776002924984894403');" onmouseout="out('4776002924984894403');" style=""> 138         List&lt;Predicate&gt; restrictions = new ArrayList&lt;&gt;();                                                </span>
<span class="5027674226344040100" onmouseenter="enter('5027674226344040100');" onmouseout="out('5027674226344040100');" style=""> 139         restrictions.add(                                                                                </span>
<span class="-7082427283179034359" onmouseenter="enter('-7082427283179034359');" onmouseout="out('-7082427283179034359');" style=""> 140             builder.and(                                                                                 </span>
<span class="-7914490944514500831" onmouseenter="enter('-7914490944514500831');" onmouseout="out('-7914490944514500831');" style=""> 141                         customerOrAccountPredicate, builder.equal(root.get(&quot;offerId&quot;), offerId),         </span>
<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style=""> 142                 builder.or(                                                                              </span>
<span class="8658744865879024739" onmouseenter="enter('8658744865879024739');" onmouseout="out('8658744865879024739');" style=""> 143                     builder.notEqual(root.get(&quot;orderId&quot;),  getOrderId(order)),                           </span>
<span class="5874404523520811803" onmouseenter="enter('5874404523520811803');" onmouseout="out('5874404523520811803');" style=""> 144                     builder.isNull(root.get(&quot;orderId&quot;))                                                  </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 145 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146                         )                                                                                </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 147 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148             )                                                                                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149         );                                                                                               </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150                                                                                                          </span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151         criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                        </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153         try {                                                                                            </span>
<span class="-8065100963523804356" onmouseenter="enter('-8065100963523804356');" onmouseout="out('-8065100963523804356');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154             return em.createQuery(criteria).getSingleResult();                                           </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155         } catch (Exception e) {                                                                          </span>
<span class="8796996608272497134" onmouseenter="enter('8796996608272497134');" onmouseout="out('8796996608272497134');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156             LOG.error(&quot;Error counting offer uses by customer.&quot;, e);                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160                                                                                                          </span>
<span class="-6144322825734226959" onmouseenter="enter('-6144322825734226959');" onmouseout="out('-6144322825734226959');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161     protected Long getOrderId(Order order) {                                                             </span>
<span class="9203448067690384131" onmouseenter="enter('9203448067690384131');" onmouseout="out('9203448067690384131');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162         return order.getId();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164                                                                                                          </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165     @Deprecated                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 166     @Override                                                                                            </span>
<span class="8572688489452949307" onmouseenter="enter('8572688489452949307');" onmouseout="out('8572688489452949307');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 167     public Long countUsesByCustomer(Long customerId, Long offerId) {                                     </span>
<span class="8560132629948814289" onmouseenter="enter('8560132629948814289');" onmouseout="out('8560132629948814289');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168         TypedQuery&lt;Long&gt; query = new TypedQueryBuilder&lt;&gt;(OfferAudit.class, &quot;offerAudit&quot;)                 </span>
<span class="-997680114505620220" onmouseenter="enter('-997680114505620220');" onmouseout="out('-997680114505620220');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169                 .addRestriction(&quot;offerAudit.customerId&quot;, &quot;=&quot;, customerId)                                </span>
<span class="6019838381362188725" onmouseenter="enter('6019838381362188725');" onmouseout="out('6019838381362188725');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170                 .addRestriction(&quot;offerAudit.offerId&quot;, &quot;=&quot;, offerId)                                      </span>
<span class="-7681019580808200885" onmouseenter="enter('-7681019580808200885');" onmouseout="out('-7681019580808200885');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 171                 .toCountQuery(em);                                                                       </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172                                                                                                          </span>
<span class="-5318016161907480331" onmouseenter="enter('-5318016161907480331');" onmouseout="out('-5318016161907480331');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173         return query.getSingleResult();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176     @Override                                                                                            </span>
<span class="7435846264829736595" onmouseenter="enter('7435846264829736595');" onmouseout="out('7435846264829736595');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177     public Long countOfferCodeUses(Order order, Long offerCodeId) {                                      </span>
<span class="2959951002703615279" onmouseenter="enter('2959951002703615279');" onmouseout="out('2959951002703615279');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178         CriteriaBuilder builder = em.getCriteriaBuilder();                                               </span>
<span class="1553585152448885012" onmouseenter="enter('1553585152448885012');" onmouseout="out('1553585152448885012');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179         CriteriaQuery&lt;Long&gt; criteria = builder.createQuery(Long.class);                                  </span>
<span class="3736188372297695145" onmouseenter="enter('3736188372297695145');" onmouseout="out('3736188372297695145');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180         Root&lt;OfferAuditImpl&gt; root = criteria.from(OfferAuditImpl.class);                                 </span>
<span class="-6081006627188172407" onmouseenter="enter('-6081006627188172407');" onmouseout="out('-6081006627188172407');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181         criteria.select(builder.count(root));                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182                                                                                                          </span>
<span class="4776002924984894403" onmouseenter="enter('4776002924984894403');" onmouseout="out('4776002924984894403');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183         List&lt;Predicate&gt; restrictions = new ArrayList&lt;&gt;();                                                </span>
<span class="5027674226344040100" onmouseenter="enter('5027674226344040100');" onmouseout="out('5027674226344040100');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184         restrictions.add(                                                                                </span>
<span class="-7082427283179034359" onmouseenter="enter('-7082427283179034359');" onmouseout="out('-7082427283179034359');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185             builder.and(                                                                                 </span>
<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186                 builder.or(                                                                              </span>
<span class="8658744865879024739" onmouseenter="enter('8658744865879024739');" onmouseout="out('8658744865879024739');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187                     builder.notEqual(root.get(&quot;orderId&quot;),  getOrderId(order)),                           </span>
<span class="5874404523520811803" onmouseenter="enter('5874404523520811803');" onmouseout="out('5874404523520811803');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188                     builder.isNull(root.get(&quot;orderId&quot;))                                                  </span>
<span class="5925056120740059197" onmouseenter="enter('5925056120740059197');" onmouseout="out('5925056120740059197');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189                 ),                                                                                       </span>
<span class="5451941685929252196" onmouseenter="enter('5451941685929252196');" onmouseout="out('5451941685929252196');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190                 builder.equal(root.get(&quot;offerCodeId&quot;), offerCodeId)                                      </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191             )                                                                                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192         );                                                                                               </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 193                                                                                                          </span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 194         criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                        </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196         try {                                                                                            </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 197 =======                                                                                                  </span>
<span class="5925056120740059197" onmouseenter="enter('5925056120740059197');" onmouseout="out('5925056120740059197');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198                 ),                                                                                       </span>
<span class="8365281357792220432" onmouseenter="enter('8365281357792220432');" onmouseout="out('8365281357792220432');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199                 builder.equal(root.get(&quot;customerId&quot;), customerId),                                       </span>
<span class="8151852281836570637" onmouseenter="enter('8151852281836570637');" onmouseout="out('8151852281836570637');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200                 builder.equal(root.get(&quot;offerId&quot;), offerId),                                             </span>
<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201                 builder.or(                                                                              </span>
<span class="-5053751442564412129" onmouseenter="enter('-5053751442564412129');" onmouseout="out('-5053751442564412129');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202                         builder.isNull(root.get(&quot;orderId&quot;)),                                             </span>
<span class="-7082427283179034359" onmouseenter="enter('-7082427283179034359');" onmouseout="out('-7082427283179034359');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203                         builder.and(                                                                     </span>
<span class="1300697703598493370" onmouseenter="enter('1300697703598493370');" onmouseout="out('1300697703598493370');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 204                                 builder.notEqual(orderRoot.get(&quot;status&quot;),OrderStatus.CANCELLED.getType()),"> 204                                 builder.notEqual(orderRoot.get(&quot;status&quot;),OrderStatus.CANCELLED.getType())ðŸ”µ</abbr></span>
<span class="-8867673829603152997" onmouseenter="enter('-8867673829603152997');" onmouseout="out('-8867673829603152997');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205                                 builder.equal(orderRoot.get(&quot;id&quot;),root.get(&quot;orderId&quot;))                   </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 206                         )                                                                                </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207                 )                                                                                        </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 208 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style=""> 209             )                                                                                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 210         );                                                                                               </span>
<span  style=""> 211                                                                                                          </span>
<span class="2330639200187190199" onmouseenter="enter('2330639200187190199');" onmouseout="out('2330639200187190199');" style=""> 212         if (minimumDaysPerUsage != null &amp;&amp; minimumDaysPerUsage != 0L) {                                  </span>
<span class="-6741860991329977308" onmouseenter="enter('-6741860991329977308');" onmouseout="out('-6741860991329977308');" style=""> 213             Date currentDate = getCurrentDateAfterFactoringInDateResolution();                           </span>
<span  style=""> 214                                                                                                          </span>
<span class="-4251495261730735242" onmouseenter="enter('-4251495261730735242');" onmouseout="out('-4251495261730735242');" style=""> 215             Calendar previousCalendar = new GregorianCalendar();                                         </span>
<span  style=""> 216                                                                                                          </span>
<span class="-675573854089282254" onmouseenter="enter('-675573854089282254');" onmouseout="out('-675573854089282254');" style=""> 217             previousCalendar.setTime(currentDate);                                                       </span>
<span class="1475910684470385723" onmouseenter="enter('1475910684470385723');" onmouseout="out('1475910684470385723');" style=""> 218             previousCalendar.add(Calendar.DAY_OF_YEAR, -minimumDaysPerUsage.intValue());                 </span>
<span  style=""> 219                                                                                                          </span>
<span class="3776274754744251807" onmouseenter="enter('3776274754744251807');" onmouseout="out('3776274754744251807');" style=""><abbr title=" 220             restrictions.add(builder.between(root.&lt;Date&gt;get(&quot;redeemedDate&quot;), previousCalendar.getTime(), currentDate));"> 220             restrictions.add(builder.between(root.&lt;Date&gt;get(&quot;redeemedDate&quot;), previousCalendar.getTime(), ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221         }                                                                                                </span>
<span  style=""> 222                                                                                                          </span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style=""> 223         criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                        </span>
<span  style=""> 224                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 225         try {                                                                                            </span>
<span class="-8065100963523804356" onmouseenter="enter('-8065100963523804356');" onmouseout="out('-8065100963523804356');" style=""> 226             return em.createQuery(criteria).getSingleResult();                                           </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 227         } catch (Exception e) {                                                                          </span>
<span class="8796996608272497134" onmouseenter="enter('8796996608272497134');" onmouseout="out('8796996608272497134');" style=""> 228             LOG.error(&quot;Error counting offer uses by customer.&quot;, e);                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 229             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231     }                                                                                                    </span>
<span  style=""> 232                                                                                                          </span>
<span class="-6144322825734226959" onmouseenter="enter('-6144322825734226959');" onmouseout="out('-6144322825734226959');" style=""> 233     protected Long getOrderId(Order order) {                                                             </span>
<span class="9203448067690384131" onmouseenter="enter('9203448067690384131');" onmouseout="out('9203448067690384131');" style=""> 234         return order.getId();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235     }                                                                                                    </span>
<span  style=""> 236                                                                                                          </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 237     @Deprecated                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 238     @Override                                                                                            </span>
<span class="8572688489452949307" onmouseenter="enter('8572688489452949307');" onmouseout="out('8572688489452949307');" style=""> 239     public Long countUsesByCustomer(Long customerId, Long offerId) {                                     </span>
<span class="8560132629948814289" onmouseenter="enter('8560132629948814289');" onmouseout="out('8560132629948814289');" style=""> 240         TypedQuery&lt;Long&gt; query = new TypedQueryBuilder&lt;&gt;(OfferAudit.class, &quot;offerAudit&quot;)                 </span>
<span class="-997680114505620220" onmouseenter="enter('-997680114505620220');" onmouseout="out('-997680114505620220');" style=""> 241                 .addRestriction(&quot;offerAudit.customerId&quot;, &quot;=&quot;, customerId)                                </span>
<span class="6019838381362188725" onmouseenter="enter('6019838381362188725');" onmouseout="out('6019838381362188725');" style=""> 242                 .addRestriction(&quot;offerAudit.offerId&quot;, &quot;=&quot;, offerId)                                      </span>
<span class="-7681019580808200885" onmouseenter="enter('-7681019580808200885');" onmouseout="out('-7681019580808200885');" style=""> 243                 .toCountQuery(em);                                                                       </span>
<span  style=""> 244                                                                                                          </span>
<span class="-5318016161907480331" onmouseenter="enter('-5318016161907480331');" onmouseout="out('-5318016161907480331');" style=""> 245         return query.getSingleResult();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246     }                                                                                                    </span>
<span  style=""> 247                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 248     @Override                                                                                            </span>
<span class="7435846264829736595" onmouseenter="enter('7435846264829736595');" onmouseout="out('7435846264829736595');" style=""> 249     public Long countOfferCodeUses(Order order, Long offerCodeId) {                                      </span>
<span class="2959951002703615279" onmouseenter="enter('2959951002703615279');" onmouseout="out('2959951002703615279');" style=""> 250         CriteriaBuilder builder = em.getCriteriaBuilder();                                               </span>
<span class="1553585152448885012" onmouseenter="enter('1553585152448885012');" onmouseout="out('1553585152448885012');" style=""> 251         CriteriaQuery&lt;Long&gt; criteria = builder.createQuery(Long.class);                                  </span>
<span class="3736188372297695145" onmouseenter="enter('3736188372297695145');" onmouseout="out('3736188372297695145');" style=""> 252         Root&lt;OfferAuditImpl&gt; root = criteria.from(OfferAuditImpl.class);                                 </span>
<span class="794269994561015699" onmouseenter="enter('794269994561015699');" onmouseout="out('794269994561015699');" style=""> 253         Root&lt;OrderImpl&gt; orderRoot = criteria.from(OrderImpl.class);                                      </span>
<span class="-6081006627188172407" onmouseenter="enter('-6081006627188172407');" onmouseout="out('-6081006627188172407');" style=""> 254         criteria.select(builder.count(root));                                                            </span>
<span  style=""> 255                                                                                                          </span>
<span class="4776002924984894403" onmouseenter="enter('4776002924984894403');" onmouseout="out('4776002924984894403');" style=""> 256         List&lt;Predicate&gt; restrictions = new ArrayList&lt;&gt;();                                                </span>
<span class="5027674226344040100" onmouseenter="enter('5027674226344040100');" onmouseout="out('5027674226344040100');" style=""> 257         restrictions.add(                                                                                </span>
<span class="-7082427283179034359" onmouseenter="enter('-7082427283179034359');" onmouseout="out('-7082427283179034359');" style=""> 258             builder.and(                                                                                 </span>
<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style=""> 259                 builder.or(                                                                              </span>
<span class="8658744865879024739" onmouseenter="enter('8658744865879024739');" onmouseout="out('8658744865879024739');" style=""> 260                     builder.notEqual(root.get(&quot;orderId&quot;),  getOrderId(order)),                           </span>
<span class="5874404523520811803" onmouseenter="enter('5874404523520811803');" onmouseout="out('5874404523520811803');" style=""> 261                     builder.isNull(root.get(&quot;orderId&quot;))                                                  </span>
<span class="5925056120740059197" onmouseenter="enter('5925056120740059197');" onmouseout="out('5925056120740059197');" style=""> 262                 ),                                                                                       </span>
<span class="-6010231986318593576" onmouseenter="enter('-6010231986318593576');" onmouseout="out('-6010231986318593576');" style=""> 263                 builder.equal(root.get(&quot;offerCodeId&quot;), offerCodeId),                                     </span>
<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style=""> 264                 builder.or(                                                                              </span>
<span class="-5053751442564412129" onmouseenter="enter('-5053751442564412129');" onmouseout="out('-5053751442564412129');" style=""> 265                         builder.isNull(root.get(&quot;orderId&quot;)),                                             </span>
<span class="-7082427283179034359" onmouseenter="enter('-7082427283179034359');" onmouseout="out('-7082427283179034359');" style=""> 266                         builder.and(                                                                     </span>
<span class="1300697703598493370" onmouseenter="enter('1300697703598493370');" onmouseout="out('1300697703598493370');" style=""><abbr title=" 267                                 builder.notEqual(orderRoot.get(&quot;status&quot;),OrderStatus.CANCELLED.getType()),"> 267                                 builder.notEqual(orderRoot.get(&quot;status&quot;),OrderStatus.CANCELLED.getType())ðŸ”µ</abbr></span>
<span class="-8867673829603152997" onmouseenter="enter('-8867673829603152997');" onmouseout="out('-8867673829603152997');" style=""> 268                                 builder.equal(orderRoot.get(&quot;id&quot;),root.get(&quot;orderId&quot;))                   </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style=""> 269                         )                                                                                </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style=""> 270                 )                                                                                        </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style=""> 271             )                                                                                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 272         );                                                                                               </span>
<span  style=""> 273                                                                                                          </span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style=""> 274         criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                        </span>
<span  style=""> 275                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 276         try {                                                                                            </span>
<span class="-8065100963523804356" onmouseenter="enter('-8065100963523804356');" onmouseout="out('-8065100963523804356');" style=""> 277             return em.createQuery(criteria).getSingleResult();                                           </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 278         } catch (Exception e) {                                                                          </span>
<span class="9213130492528639989" onmouseenter="enter('9213130492528639989');" onmouseout="out('9213130492528639989');" style=""> 279             LOG.error(&quot;Error counting offer code uses.&quot;, e);                                             </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 280             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282     }                                                                                                    </span>
<span  style=""> 283                                                                                                          </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 284     @Deprecated                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 285     @Override                                                                                            </span>
<span class="4183689894295086547" onmouseenter="enter('4183689894295086547');" onmouseout="out('4183689894295086547');" style=""> 286     public Long countOfferCodeUses(Long offerCodeId) {                                                   </span>
<span class="8560132629948814289" onmouseenter="enter('8560132629948814289');" onmouseout="out('8560132629948814289');" style=""> 287         TypedQuery&lt;Long&gt; query = new TypedQueryBuilder&lt;&gt;(OfferAudit.class, &quot;offerAudit&quot;)                 </span>
<span class="-2760927246990072011" onmouseenter="enter('-2760927246990072011');" onmouseout="out('-2760927246990072011');" style=""> 288                 .addRestriction(&quot;offerAudit.offerCodeId&quot;, &quot;=&quot;, offerCodeId)                              </span>
<span class="-7681019580808200885" onmouseenter="enter('-7681019580808200885');" onmouseout="out('-7681019580808200885');" style=""> 289                 .toCountQuery(em);                                                                       </span>
<span  style=""> 290                                                                                                          </span>
<span class="-5318016161907480331" onmouseenter="enter('-5318016161907480331');" onmouseout="out('-5318016161907480331');" style=""> 291         return query.getSingleResult();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292     }                                                                                                    </span>
<span  style=""> 293                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 294     @Override                                                                                            </span>
<span class="1997128441202003654" onmouseenter="enter('1997128441202003654');" onmouseout="out('1997128441202003654');" style=""> 295     public List&lt;OfferAudit&gt; readOfferAuditsByOrderId(Long orderId) {                                     </span>
<span class="6895483049015333951" onmouseenter="enter('6895483049015333951');" onmouseout="out('6895483049015333951');" style=""> 296         TypedQuery&lt;OfferAudit&gt; query = new TypedQueryBuilder&lt;&gt;(OfferAudit.class, &quot;offerAudit&quot;)           </span>
<span class="-6559521421523619479" onmouseenter="enter('-6559521421523619479');" onmouseout="out('-6559521421523619479');" style=""> 297                 .addRestriction(&quot;offerAudit.orderId&quot;, &quot;=&quot;, orderId)                                      </span>
<span class="-7189622533419316302" onmouseenter="enter('-7189622533419316302');" onmouseout="out('-7189622533419316302');" style=""> 298                 .toQuery(em);                                                                            </span>
<span  style=""> 299                                                                                                          </span>
<span class="6708314796189813357" onmouseenter="enter('6708314796189813357');" onmouseout="out('6708314796189813357');" style=""> 300         return query.getResultList();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301     }                                                                                                    </span>
<span  style=""> 302                                                                                                          </span>
<span  style=""> 303                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 304     @Override                                                                                            </span>
<span class="5477970363726054314" onmouseenter="enter('5477970363726054314');" onmouseout="out('5477970363726054314');" style=""> 305     public Long getCurrentDateResolution() {                                                             </span>
<span class="-7988021434068185318" onmouseenter="enter('-7988021434068185318');" onmouseout="out('-7988021434068185318');" style=""> 306         return currentDateResolution;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307     }                                                                                                    </span>
<span  style=""> 308                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 309     @Override                                                                                            </span>
<span class="-271762138402286644" onmouseenter="enter('-271762138402286644');" onmouseout="out('-271762138402286644');" style=""> 310     public void setCurrentDateResolution(Long currentDateResolution) {                                   </span>
<span class="-7813324798835187266" onmouseenter="enter('-7813324798835187266');" onmouseout="out('-7813324798835187266');" style=""> 311         this.currentDateResolution = currentDateResolution;                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312     }                                                                                                    </span>
<span  style=""> 313                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 314 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3  * BroadleafCommerce Framework                                                                           </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="4581976383907508446" onmouseenter="enter('4581976383907508446');" onmouseout="out('4581976383907508446');" style="">  18 package org.broadleafcommerce.core.offer.dao;                                                            </span>
<span  style="">  19                                                                                                          </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  20 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  21 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="4111478795314305516" onmouseenter="enter('4111478795314305516');" onmouseout="out('4111478795314305516');" style="">  22 import org.broadleafcommerce.common.persistence.EntityConfiguration;                                     </span>
<span class="1373992879208813777" onmouseenter="enter('1373992879208813777');" onmouseout="out('1373992879208813777');" style="">  23 import org.broadleafcommerce.common.time.SystemTime;                                                     </span>
<span class="8922526534929083638" onmouseenter="enter('8922526534929083638');" onmouseout="out('8922526534929083638');" style="">  24 import org.broadleafcommerce.common.util.dao.TypedQueryBuilder;                                          </span>
<span class="64523562193483090" onmouseenter="enter('64523562193483090');" onmouseout="out('64523562193483090');" style="">  25 import org.broadleafcommerce.core.offer.domain.OfferAudit;                                               </span>
<span class="-5495020915230320478" onmouseenter="enter('-5495020915230320478');" onmouseout="out('-5495020915230320478');" style="">  26 import org.broadleafcommerce.core.offer.domain.OfferAuditImpl;                                           </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  27 import org.broadleafcommerce.core.order.domain.Order;                                                    </span>
<span class="-9126455085472227806" onmouseenter="enter('-9126455085472227806');" onmouseout="out('-9126455085472227806');" style="">  28 import org.broadleafcommerce.core.order.domain.OrderImpl;                                                </span>
<span class="614288234168063731" onmouseenter="enter('614288234168063731');" onmouseout="out('614288234168063731');" style="">  29 import org.broadleafcommerce.core.order.service.type.OrderStatus;                                        </span>
<span class="-4190555539420257130" onmouseenter="enter('-4190555539420257130');" onmouseout="out('-4190555539420257130');" style="">  30 import org.springframework.stereotype.Repository;                                                        </span>
<span  style="">  31                                                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  32 import java.util.ArrayList;                                                                              </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  33 import java.util.Calendar;                                                                               </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="">  34 import java.util.Date;                                                                                   </span>
<span class="-4685965902094386510" onmouseenter="enter('-4685965902094386510');" onmouseout="out('-4685965902094386510');" style="">  35 import java.util.GregorianCalendar;                                                                      </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  36 import java.util.List;                                                                                   </span>
<span  style="">  37                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  38 import javax.annotation.Resource;                                                                        </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  39 import javax.persistence.EntityManager;                                                                  </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  40 import javax.persistence.PersistenceContext;                                                             </span>
<span class="6539032290250175619" onmouseenter="enter('6539032290250175619');" onmouseout="out('6539032290250175619');" style="">  41 import javax.persistence.TypedQuery;                                                                     </span>
<span class="8485852916582699615" onmouseenter="enter('8485852916582699615');" onmouseout="out('8485852916582699615');" style="">  42 import javax.persistence.criteria.CriteriaBuilder;                                                       </span>
<span class="9191540725958216337" onmouseenter="enter('9191540725958216337');" onmouseout="out('9191540725958216337');" style="">  43 import javax.persistence.criteria.CriteriaQuery;                                                         </span>
<span class="7244103982108254428" onmouseenter="enter('7244103982108254428');" onmouseout="out('7244103982108254428');" style="">  44 import javax.persistence.criteria.Predicate;                                                             </span>
<span class="5782830673162504954" onmouseenter="enter('5782830673162504954');" onmouseout="out('5782830673162504954');" style="">  45 import javax.persistence.criteria.Root;                                                                  </span>
<span  style="">  46                                                                                                          </span>
<span class="2189143306704906144" onmouseenter="enter('2189143306704906144');" onmouseout="out('2189143306704906144');" style="">  47 @Repository(&quot;blOfferAuditDao&quot;)                                                                           </span>
<span class="6923906510730234638" onmouseenter="enter('6923906510730234638');" onmouseout="out('6923906510730234638');" style="">  48 public class OfferAuditDaoImpl implements OfferAuditDao {                                                </span>
<span  style="">  49                                                                                                          </span>
<span class="-6459053967516643845" onmouseenter="enter('-6459053967516643845');" onmouseout="out('-6459053967516643845');" style="">  50     protected static final Log LOG = LogFactory.getLog(OfferAuditDaoImpl.class);                         </span>
<span  style="">  51                                                                                                          </span>
<span class="-491914183795829879" onmouseenter="enter('-491914183795829879');" onmouseout="out('-491914183795829879');" style="">  52     private static final Long NULL_ACCOUNT_ID = null;                                                    </span>
<span class="4392557768743364645" onmouseenter="enter('4392557768743364645');" onmouseout="out('4392557768743364645');" style="">  53     private static final Long NULL_CUSTOMER_ID = null;                                                   </span>
<span  style="">  54                                                                                                          </span>
<span class="-4259734795637808055" onmouseenter="enter('-4259734795637808055');" onmouseout="out('-4259734795637808055');" style="">  55     @PersistenceContext(unitName=&quot;blPU&quot;)                                                                 </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style="">  56     protected EntityManager em;                                                                          </span>
<span  style="">  57                                                                                                          </span>
<span class="1637373992155499263" onmouseenter="enter('1637373992155499263');" onmouseout="out('1637373992155499263');" style="">  58     @Resource(name=&quot;blEntityConfiguration&quot;)                                                              </span>
<span class="-8812870795397979367" onmouseenter="enter('-8812870795397979367');" onmouseout="out('-8812870795397979367');" style="">  59     protected EntityConfiguration entityConfiguration;                                                   </span>
<span  style="">  60                                                                                                          </span>
<span class="-7049669380064237434" onmouseenter="enter('-7049669380064237434');" onmouseout="out('-7049669380064237434');" style="">  61     protected Long currentDateResolution = 3600000L;                                                     </span>
<span class="-3015759496674095868" onmouseenter="enter('-3015759496674095868');" onmouseout="out('-3015759496674095868');" style="">  62     protected Date cachedDate = SystemTime.asDate();                                                     </span>
<span  style="">  63                                                                                                          </span>
<span class="-1267510524885549695" onmouseenter="enter('-1267510524885549695');" onmouseout="out('-1267510524885549695');" style="">  64     protected Date getCurrentDateAfterFactoringInDateResolution() {                                      </span>
<span class="7456092887221268123" onmouseenter="enter('7456092887221268123');" onmouseout="out('7456092887221268123');" style=""><abbr title="  65         Date returnDate = SystemTime.getCurrentDateWithinTimeResolution(cachedDate, getCurrentDateResolution());">  65         Date returnDate = SystemTime.getCurrentDateWithinTimeResolution(cachedDate, getCurrentDateResolutðŸ”µ</abbr></span>
<span class="-701896352794694369" onmouseenter="enter('-701896352794694369');" onmouseout="out('-701896352794694369');" style="">  66         if (returnDate != cachedDate) {                                                                  </span>
<span class="5100208720017764216" onmouseenter="enter('5100208720017764216');" onmouseout="out('5100208720017764216');" style="">  67             if (SystemTime.shouldCacheDate()) {                                                          </span>
<span class="-2842817032367762030" onmouseenter="enter('-2842817032367762030');" onmouseout="out('-2842817032367762030');" style="">  68                 cachedDate = returnDate;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  69             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70         }                                                                                                </span>
<span class="8495881565272727908" onmouseenter="enter('8495881565272727908');" onmouseout="out('8495881565272727908');" style="">  71         return returnDate;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  72     }                                                                                                    </span>
<span  style="">  73                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  74     @Override                                                                                            </span>
<span class="6767135535803548971" onmouseenter="enter('6767135535803548971');" onmouseout="out('6767135535803548971');" style="">  75     public OfferAudit create() {                                                                         </span>
<span class="3805797155674316037" onmouseenter="enter('3805797155674316037');" onmouseout="out('3805797155674316037');" style="">  76         return ((OfferAudit) entityConfiguration.createEntityInstance(OfferAudit.class.getName()));      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77     }                                                                                                    </span>
<span  style="">  78                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  79     @Override                                                                                            </span>
<span class="-952767806084988342" onmouseenter="enter('-952767806084988342');" onmouseout="out('-952767806084988342');" style="">  80     public void delete(final OfferAudit offerAudit) {                                                    </span>
<span class="2838826885943543038" onmouseenter="enter('2838826885943543038');" onmouseout="out('2838826885943543038');" style="">  81         OfferAudit loa = offerAudit;                                                                     </span>
<span  style="">  82                                                                                                          </span>
<span class="4622151386703876716" onmouseenter="enter('4622151386703876716');" onmouseout="out('4622151386703876716');" style="">  83         if (!em.contains(loa)) {                                                                         </span>
<span class="8756231357348641283" onmouseenter="enter('8756231357348641283');" onmouseout="out('8756231357348641283');" style="">  84             loa = readAuditById(offerAudit.getId());                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85         }                                                                                                </span>
<span  style="">  86                                                                                                          </span>
<span class="524329334072964961" onmouseenter="enter('524329334072964961');" onmouseout="out('524329334072964961');" style="">  87         em.remove(loa);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  88     }                                                                                                    </span>
<span  style="">  89                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  90     @Override                                                                                            </span>
<span class="-2141129694682598847" onmouseenter="enter('-2141129694682598847');" onmouseout="out('-2141129694682598847');" style="">  91     public OfferAudit save(final OfferAudit offerAudit) {                                                </span>
<span class="-2813547888935568298" onmouseenter="enter('-2813547888935568298');" onmouseout="out('-2813547888935568298');" style="">  92         return em.merge(offerAudit);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93     }                                                                                                    </span>
<span  style="">  94                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  95     @Override                                                                                            </span>
<span class="-390957289170684724" onmouseenter="enter('-390957289170684724');" onmouseout="out('-390957289170684724');" style="">  96     public OfferAudit readAuditById(final Long offerAuditId) {                                           </span>
<span class="-2996840779846502092" onmouseenter="enter('-2996840779846502092');" onmouseout="out('-2996840779846502092');" style="">  97         return em.find(OfferAuditImpl.class, offerAuditId);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98     }                                                                                                    </span>
<span  style="">  99                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 100     @Override                                                                                            </span>
<span class="3411365851442909550" onmouseenter="enter('3411365851442909550');" onmouseout="out('3411365851442909550');" style=""> 101     public Long countUsesByCustomer(Order order, Long customerId, Long offerId) {                        </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 102 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-2974270557069561693" onmouseenter="enter('-2974270557069561693');" onmouseout="out('-2974270557069561693');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103         return countUsesByCustomer(order, customerId, offerId, null);                                    </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 104 ||||||| BASE                                                                                             </span>
<span class="2959951002703615279" onmouseenter="enter('2959951002703615279');" onmouseout="out('2959951002703615279');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105         CriteriaBuilder builder = em.getCriteriaBuilder();                                               </span>
<span class="1553585152448885012" onmouseenter="enter('1553585152448885012');" onmouseout="out('1553585152448885012');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106         CriteriaQuery&lt;Long&gt; criteria = builder.createQuery(Long.class);                                  </span>
<span class="3736188372297695145" onmouseenter="enter('3736188372297695145');" onmouseout="out('3736188372297695145');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107         Root&lt;OfferAuditImpl&gt; root = criteria.from(OfferAuditImpl.class);                                 </span>
<span class="-6081006627188172407" onmouseenter="enter('-6081006627188172407');" onmouseout="out('-6081006627188172407');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108         criteria.select(builder.count(root));                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109                                                                                                          </span>
<span class="4776002924984894403" onmouseenter="enter('4776002924984894403');" onmouseout="out('4776002924984894403');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110         List&lt;Predicate&gt; restrictions = new ArrayList&lt;&gt;();                                                </span>
<span class="5027674226344040100" onmouseenter="enter('5027674226344040100');" onmouseout="out('5027674226344040100');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111         restrictions.add(                                                                                </span>
<span class="-7082427283179034359" onmouseenter="enter('-7082427283179034359');" onmouseout="out('-7082427283179034359');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112             builder.and(                                                                                 </span>
<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113                 builder.or(                                                                              </span>
<span class="8658744865879024739" onmouseenter="enter('8658744865879024739');" onmouseout="out('8658744865879024739');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114                     builder.notEqual(root.get(&quot;orderId&quot;),  getOrderId(order)),                           </span>
<span class="5874404523520811803" onmouseenter="enter('5874404523520811803');" onmouseout="out('5874404523520811803');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115                     builder.isNull(root.get(&quot;orderId&quot;))                                                  </span>
<span class="5925056120740059197" onmouseenter="enter('5925056120740059197');" onmouseout="out('5925056120740059197');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116                 ),                                                                                       </span>
<span class="8365281357792220432" onmouseenter="enter('8365281357792220432');" onmouseout="out('8365281357792220432');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117                 builder.equal(root.get(&quot;customerId&quot;), customerId),                                       </span>
<span class="-5899645011040314126" onmouseenter="enter('-5899645011040314126');" onmouseout="out('-5899645011040314126');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118                 builder.equal(root.get(&quot;offerId&quot;), offerId)                                              </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119             )                                                                                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120         );                                                                                               </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121                                                                                                          </span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122         criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                        </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124         try {                                                                                            </span>
<span class="-8065100963523804356" onmouseenter="enter('-8065100963523804356');" onmouseout="out('-8065100963523804356');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125             return em.createQuery(criteria).getSingleResult();                                           </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126         } catch (Exception e) {                                                                          </span>
<span class="8796996608272497134" onmouseenter="enter('8796996608272497134');" onmouseout="out('8796996608272497134');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127             LOG.error(&quot;Error counting offer uses by customer.&quot;, e);                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130     }                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 131 =======                                                                                                  </span>
<span class="2959951002703615279" onmouseenter="enter('2959951002703615279');" onmouseout="out('2959951002703615279');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 132         CriteriaBuilder builder = em.getCriteriaBuilder();                                               </span>
<span class="1553585152448885012" onmouseenter="enter('1553585152448885012');" onmouseout="out('1553585152448885012');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 133         CriteriaQuery&lt;Long&gt; criteria = builder.createQuery(Long.class);                                  </span>
<span class="3736188372297695145" onmouseenter="enter('3736188372297695145');" onmouseout="out('3736188372297695145');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 134         Root&lt;OfferAuditImpl&gt; root = criteria.from(OfferAuditImpl.class);                                 </span>
<span class="794269994561015699" onmouseenter="enter('794269994561015699');" onmouseout="out('794269994561015699');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135         Root&lt;OrderImpl&gt; orderRoot = criteria.from(OrderImpl.class);                                      </span>
<span class="-6081006627188172407" onmouseenter="enter('-6081006627188172407');" onmouseout="out('-6081006627188172407');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136         criteria.select(builder.count(root));                                                            </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137                                                                                                          </span>
<span class="4776002924984894403" onmouseenter="enter('4776002924984894403');" onmouseout="out('4776002924984894403');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138         List&lt;Predicate&gt; restrictions = new ArrayList&lt;&gt;();                                                </span>
<span class="5027674226344040100" onmouseenter="enter('5027674226344040100');" onmouseout="out('5027674226344040100');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 139         restrictions.add(                                                                                </span>
<span class="-7082427283179034359" onmouseenter="enter('-7082427283179034359');" onmouseout="out('-7082427283179034359');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 140             builder.and(                                                                                 </span>
<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 141                 builder.or(                                                                              </span>
<span class="8658744865879024739" onmouseenter="enter('8658744865879024739');" onmouseout="out('8658744865879024739');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 142                     builder.notEqual(root.get(&quot;orderId&quot;),  getOrderId(order)),                           </span>
<span class="5874404523520811803" onmouseenter="enter('5874404523520811803');" onmouseout="out('5874404523520811803');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143                     builder.isNull(root.get(&quot;orderId&quot;))                                                  </span>
<span class="5925056120740059197" onmouseenter="enter('5925056120740059197');" onmouseout="out('5925056120740059197');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144                 ),                                                                                       </span>
<span class="8365281357792220432" onmouseenter="enter('8365281357792220432');" onmouseout="out('8365281357792220432');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145                 builder.equal(root.get(&quot;customerId&quot;), customerId),                                       </span>
<span class="8151852281836570637" onmouseenter="enter('8151852281836570637');" onmouseout="out('8151852281836570637');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146                 builder.equal(root.get(&quot;offerId&quot;), offerId),                                             </span>
<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147                 builder.or(                                                                              </span>
<span class="-5053751442564412129" onmouseenter="enter('-5053751442564412129');" onmouseout="out('-5053751442564412129');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148                         builder.isNull(root.get(&quot;orderId&quot;)),                                             </span>
<span class="-7082427283179034359" onmouseenter="enter('-7082427283179034359');" onmouseout="out('-7082427283179034359');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149                         builder.and(                                                                     </span>
<span class="1300697703598493370" onmouseenter="enter('1300697703598493370');" onmouseout="out('1300697703598493370');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 150                                 builder.notEqual(orderRoot.get(&quot;status&quot;),OrderStatus.CANCELLED.getType()),"> 150                                 builder.notEqual(orderRoot.get(&quot;status&quot;),OrderStatus.CANCELLED.getType())ðŸ”µ</abbr></span>
<span class="-8867673829603152997" onmouseenter="enter('-8867673829603152997');" onmouseout="out('-8867673829603152997');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151                                 builder.equal(orderRoot.get(&quot;id&quot;),root.get(&quot;orderId&quot;))                   </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152                         )                                                                                </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153                 )                                                                                        </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154             )                                                                                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155         );                                                                                               </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156                                                                                                          </span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157         criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                        </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159         try {                                                                                            </span>
<span class="-8065100963523804356" onmouseenter="enter('-8065100963523804356');" onmouseout="out('-8065100963523804356');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 160             return em.createQuery(criteria).getSingleResult();                                           </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 161         } catch (Exception e) {                                                                          </span>
<span class="8796996608272497134" onmouseenter="enter('8796996608272497134');" onmouseout="out('8796996608272497134');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 162             LOG.error(&quot;Error counting offer uses by customer.&quot;, e);                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 163             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 164         }                                                                                                </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 165 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166     }                                                                                                    </span>
<span  style=""> 167                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 168     @Override                                                                                            </span>
<span class="4451867570096397072" onmouseenter="enter('4451867570096397072');" onmouseout="out('4451867570096397072');" style=""> 169     public Long countUsesByAccount(Order order, Long accountId, Long offerId) {                          </span>
<span class="-4556253105265349228" onmouseenter="enter('-4556253105265349228');" onmouseout="out('-4556253105265349228');" style=""> 170         return countUsesByAccount(order, accountId, offerId, null);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171     }                                                                                                    </span>
<span  style=""> 172                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 173     @Override                                                                                            </span>
<span class="-8843695615789214022" onmouseenter="enter('-8843695615789214022');" onmouseout="out('-8843695615789214022');" style=""> 174     public Long countUsesByAccount(Order order, Long accountId, Long offerId, Long minimumDaysPerUsage) {</span>
<span class="8502471645147940958" onmouseenter="enter('8502471645147940958');" onmouseout="out('8502471645147940958');" style=""><abbr title=" 175         return countUsesByAccountOrCustomer(order, NULL_CUSTOMER_ID, accountId, offerId, minimumDaysPerUsage);"> 175         return countUsesByAccountOrCustomer(order, NULL_CUSTOMER_ID, accountId, offerId, minimumDaysPerUsðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176     }                                                                                                    </span>
<span  style=""> 177                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 178     @Override                                                                                            </span>
<span class="-8998115950668362110" onmouseenter="enter('-8998115950668362110');" onmouseout="out('-8998115950668362110');" style=""><abbr title=" 179     public Long countUsesByCustomer(Order order, Long customerId, Long offerId, Long minimumDaysPerUsage) {"> 179     public Long countUsesByCustomer(Order order, Long customerId, Long offerId, Long minimumDaysPerUsage)ðŸ”µ</abbr></span>
<span class="354199176914940576" onmouseenter="enter('354199176914940576');" onmouseout="out('354199176914940576');" style=""><abbr title=" 180         return countUsesByAccountOrCustomer(order, customerId, NULL_ACCOUNT_ID, offerId, minimumDaysPerUsage);"> 180         return countUsesByAccountOrCustomer(order, customerId, NULL_ACCOUNT_ID, offerId, minimumDaysPerUsðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181     }                                                                                                    </span>
<span  style=""> 182                                                                                                          </span>
<span class="1120399754244046360" onmouseenter="enter('1120399754244046360');" onmouseout="out('1120399754244046360');" style=""><abbr title=" 183     protected Long countUsesByAccountOrCustomer(Order order, Long customerId, Long accountId, Long offerId, Long minimumDaysPerUsage) {"> 183     protected Long countUsesByAccountOrCustomer(Order order, Long customerId, Long accountId, Long offerIðŸ”µ</abbr></span>
<span class="2959951002703615279" onmouseenter="enter('2959951002703615279');" onmouseout="out('2959951002703615279');" style=""> 184         CriteriaBuilder builder = em.getCriteriaBuilder();                                               </span>
<span class="1553585152448885012" onmouseenter="enter('1553585152448885012');" onmouseout="out('1553585152448885012');" style=""> 185         CriteriaQuery&lt;Long&gt; criteria = builder.createQuery(Long.class);                                  </span>
<span class="3736188372297695145" onmouseenter="enter('3736188372297695145');" onmouseout="out('3736188372297695145');" style=""> 186         Root&lt;OfferAuditImpl&gt; root = criteria.from(OfferAuditImpl.class);                                 </span>
<span class="-6081006627188172407" onmouseenter="enter('-6081006627188172407');" onmouseout="out('-6081006627188172407');" style=""> 187         criteria.select(builder.count(root));                                                            </span>
<span  style=""> 188                                                                                                          </span>
<span class="-7985475506215634506" onmouseenter="enter('-7985475506215634506');" onmouseout="out('-7985475506215634506');" style=""> 189         Predicate customerOrAccountPredicate = null;                                                     </span>
<span  style=""> 190                                                                                                          </span>
<span class="-8452861246579893242" onmouseenter="enter('-8452861246579893242');" onmouseout="out('-8452861246579893242');" style=""> 191         if (customerId != null) {                                                                        </span>
<span class="4779664179124354463" onmouseenter="enter('4779664179124354463');" onmouseout="out('4779664179124354463');" style=""> 192             customerOrAccountPredicate = builder.equal(root.get(&quot;customerId&quot;), customerId);              </span>
<span class="2030117130977549016" onmouseenter="enter('2030117130977549016');" onmouseout="out('2030117130977549016');" style=""> 193         } else if (accountId != null) {                                                                  </span>
<span class="-8726287971348706514" onmouseenter="enter('-8726287971348706514');" onmouseout="out('-8726287971348706514');" style=""> 194             customerOrAccountPredicate = builder.equal(root.get(&quot;accountId&quot;), accountId);                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 195         } else {                                                                                         </span>
<span class="9008286842041895655" onmouseenter="enter('9008286842041895655');" onmouseout="out('9008286842041895655');" style=""> 196             LOG.debug(&quot;Count uses by account or customer called without an account or a customer.&quot;);     </span>
<span class="-7938083568872702361" onmouseenter="enter('-7938083568872702361');" onmouseout="out('-7938083568872702361');" style=""> 197             return 0L;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198         }                                                                                                </span>
<span  style=""> 199                                                                                                          </span>
<span class="4776002924984894403" onmouseenter="enter('4776002924984894403');" onmouseout="out('4776002924984894403');" style=""> 200         List&lt;Predicate&gt; restrictions = new ArrayList&lt;&gt;();                                                </span>
<span class="5027674226344040100" onmouseenter="enter('5027674226344040100');" onmouseout="out('5027674226344040100');" style=""> 201         restrictions.add(                                                                                </span>
<span class="-7082427283179034359" onmouseenter="enter('-7082427283179034359');" onmouseout="out('-7082427283179034359');" style=""> 202             builder.and(                                                                                 </span>
<span class="-7914490944514500831" onmouseenter="enter('-7914490944514500831');" onmouseout="out('-7914490944514500831');" style=""> 203                         customerOrAccountPredicate, builder.equal(root.get(&quot;offerId&quot;), offerId),         </span>
<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style=""> 204                 builder.or(                                                                              </span>
<span class="8658744865879024739" onmouseenter="enter('8658744865879024739');" onmouseout="out('8658744865879024739');" style=""> 205                     builder.notEqual(root.get(&quot;orderId&quot;),  getOrderId(order)),                           </span>
<span class="5874404523520811803" onmouseenter="enter('5874404523520811803');" onmouseout="out('5874404523520811803');" style=""> 206                     builder.isNull(root.get(&quot;orderId&quot;))                                                  </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style=""> 207                         )                                                                                </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style=""> 208             )                                                                                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 209         );                                                                                               </span>
<span  style=""> 210                                                                                                          </span>
<span class="2330639200187190199" onmouseenter="enter('2330639200187190199');" onmouseout="out('2330639200187190199');" style=""> 211         if (minimumDaysPerUsage != null &amp;&amp; minimumDaysPerUsage != 0L) {                                  </span>
<span class="-6741860991329977308" onmouseenter="enter('-6741860991329977308');" onmouseout="out('-6741860991329977308');" style=""> 212             Date currentDate = getCurrentDateAfterFactoringInDateResolution();                           </span>
<span  style=""> 213                                                                                                          </span>
<span class="-4251495261730735242" onmouseenter="enter('-4251495261730735242');" onmouseout="out('-4251495261730735242');" style=""> 214             Calendar previousCalendar = new GregorianCalendar();                                         </span>
<span  style=""> 215                                                                                                          </span>
<span class="-675573854089282254" onmouseenter="enter('-675573854089282254');" onmouseout="out('-675573854089282254');" style=""> 216             previousCalendar.setTime(currentDate);                                                       </span>
<span class="1475910684470385723" onmouseenter="enter('1475910684470385723');" onmouseout="out('1475910684470385723');" style=""> 217             previousCalendar.add(Calendar.DAY_OF_YEAR, -minimumDaysPerUsage.intValue());                 </span>
<span  style=""> 218                                                                                                          </span>
<span class="3776274754744251807" onmouseenter="enter('3776274754744251807');" onmouseout="out('3776274754744251807');" style=""><abbr title=" 219             restrictions.add(builder.between(root.&lt;Date&gt;get(&quot;redeemedDate&quot;), previousCalendar.getTime(), currentDate));"> 219             restrictions.add(builder.between(root.&lt;Date&gt;get(&quot;redeemedDate&quot;), previousCalendar.getTime(), ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220         }                                                                                                </span>
<span  style=""> 221                                                                                                          </span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style=""> 222         criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                        </span>
<span  style=""> 223                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 224         try {                                                                                            </span>
<span class="-8065100963523804356" onmouseenter="enter('-8065100963523804356');" onmouseout="out('-8065100963523804356');" style=""> 225             return em.createQuery(criteria).getSingleResult();                                           </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 226         } catch (Exception e) {                                                                          </span>
<span class="8796996608272497134" onmouseenter="enter('8796996608272497134');" onmouseout="out('8796996608272497134');" style=""> 227             LOG.error(&quot;Error counting offer uses by customer.&quot;, e);                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 228             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230     }                                                                                                    </span>
<span  style=""> 231                                                                                                          </span>
<span class="-6144322825734226959" onmouseenter="enter('-6144322825734226959');" onmouseout="out('-6144322825734226959');" style=""> 232     protected Long getOrderId(Order order) {                                                             </span>
<span class="9203448067690384131" onmouseenter="enter('9203448067690384131');" onmouseout="out('9203448067690384131');" style=""> 233         return order.getId();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234     }                                                                                                    </span>
<span  style=""> 235                                                                                                          </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 236     @Deprecated                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 237     @Override                                                                                            </span>
<span class="8572688489452949307" onmouseenter="enter('8572688489452949307');" onmouseout="out('8572688489452949307');" style=""> 238     public Long countUsesByCustomer(Long customerId, Long offerId) {                                     </span>
<span class="8560132629948814289" onmouseenter="enter('8560132629948814289');" onmouseout="out('8560132629948814289');" style=""> 239         TypedQuery&lt;Long&gt; query = new TypedQueryBuilder&lt;&gt;(OfferAudit.class, &quot;offerAudit&quot;)                 </span>
<span class="-997680114505620220" onmouseenter="enter('-997680114505620220');" onmouseout="out('-997680114505620220');" style=""> 240                 .addRestriction(&quot;offerAudit.customerId&quot;, &quot;=&quot;, customerId)                                </span>
<span class="6019838381362188725" onmouseenter="enter('6019838381362188725');" onmouseout="out('6019838381362188725');" style=""> 241                 .addRestriction(&quot;offerAudit.offerId&quot;, &quot;=&quot;, offerId)                                      </span>
<span class="-7681019580808200885" onmouseenter="enter('-7681019580808200885');" onmouseout="out('-7681019580808200885');" style=""> 242                 .toCountQuery(em);                                                                       </span>
<span  style=""> 243                                                                                                          </span>
<span class="-5318016161907480331" onmouseenter="enter('-5318016161907480331');" onmouseout="out('-5318016161907480331');" style=""> 244         return query.getSingleResult();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245     }                                                                                                    </span>
<span  style=""> 246                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 247     @Override                                                                                            </span>
<span class="7435846264829736595" onmouseenter="enter('7435846264829736595');" onmouseout="out('7435846264829736595');" style=""> 248     public Long countOfferCodeUses(Order order, Long offerCodeId) {                                      </span>
<span class="2959951002703615279" onmouseenter="enter('2959951002703615279');" onmouseout="out('2959951002703615279');" style=""> 249         CriteriaBuilder builder = em.getCriteriaBuilder();                                               </span>
<span class="1553585152448885012" onmouseenter="enter('1553585152448885012');" onmouseout="out('1553585152448885012');" style=""> 250         CriteriaQuery&lt;Long&gt; criteria = builder.createQuery(Long.class);                                  </span>
<span class="3736188372297695145" onmouseenter="enter('3736188372297695145');" onmouseout="out('3736188372297695145');" style=""> 251         Root&lt;OfferAuditImpl&gt; root = criteria.from(OfferAuditImpl.class);                                 </span>
<span class="794269994561015699" onmouseenter="enter('794269994561015699');" onmouseout="out('794269994561015699');" style=""> 252         Root&lt;OrderImpl&gt; orderRoot = criteria.from(OrderImpl.class);                                      </span>
<span class="-6081006627188172407" onmouseenter="enter('-6081006627188172407');" onmouseout="out('-6081006627188172407');" style=""> 253         criteria.select(builder.count(root));                                                            </span>
<span  style=""> 254                                                                                                          </span>
<span class="4776002924984894403" onmouseenter="enter('4776002924984894403');" onmouseout="out('4776002924984894403');" style=""> 255         List&lt;Predicate&gt; restrictions = new ArrayList&lt;&gt;();                                                </span>
<span class="5027674226344040100" onmouseenter="enter('5027674226344040100');" onmouseout="out('5027674226344040100');" style=""> 256         restrictions.add(                                                                                </span>
<span class="-7082427283179034359" onmouseenter="enter('-7082427283179034359');" onmouseout="out('-7082427283179034359');" style=""> 257             builder.and(                                                                                 </span>
<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style=""> 258                 builder.or(                                                                              </span>
<span class="8658744865879024739" onmouseenter="enter('8658744865879024739');" onmouseout="out('8658744865879024739');" style=""> 259                     builder.notEqual(root.get(&quot;orderId&quot;),  getOrderId(order)),                           </span>
<span class="5874404523520811803" onmouseenter="enter('5874404523520811803');" onmouseout="out('5874404523520811803');" style=""> 260                     builder.isNull(root.get(&quot;orderId&quot;))                                                  </span>
<span class="5925056120740059197" onmouseenter="enter('5925056120740059197');" onmouseout="out('5925056120740059197');" style=""> 261                 ),                                                                                       </span>
<span class="-6010231986318593576" onmouseenter="enter('-6010231986318593576');" onmouseout="out('-6010231986318593576');" style=""> 262                 builder.equal(root.get(&quot;offerCodeId&quot;), offerCodeId),                                     </span>
<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style=""> 263                 builder.or(                                                                              </span>
<span class="-5053751442564412129" onmouseenter="enter('-5053751442564412129');" onmouseout="out('-5053751442564412129');" style=""> 264                         builder.isNull(root.get(&quot;orderId&quot;)),                                             </span>
<span class="-7082427283179034359" onmouseenter="enter('-7082427283179034359');" onmouseout="out('-7082427283179034359');" style=""> 265                         builder.and(                                                                     </span>
<span class="1300697703598493370" onmouseenter="enter('1300697703598493370');" onmouseout="out('1300697703598493370');" style=""><abbr title=" 266                                 builder.notEqual(orderRoot.get(&quot;status&quot;),OrderStatus.CANCELLED.getType()),"> 266                                 builder.notEqual(orderRoot.get(&quot;status&quot;),OrderStatus.CANCELLED.getType())ðŸ”µ</abbr></span>
<span class="-8867673829603152997" onmouseenter="enter('-8867673829603152997');" onmouseout="out('-8867673829603152997');" style=""> 267                                 builder.equal(orderRoot.get(&quot;id&quot;),root.get(&quot;orderId&quot;))                   </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style=""> 268                         )                                                                                </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style=""> 269                 )                                                                                        </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style=""> 270             )                                                                                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 271         );                                                                                               </span>
<span  style=""> 272                                                                                                          </span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style=""> 273         criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                        </span>
<span  style=""> 274                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 275         try {                                                                                            </span>
<span class="-8065100963523804356" onmouseenter="enter('-8065100963523804356');" onmouseout="out('-8065100963523804356');" style=""> 276             return em.createQuery(criteria).getSingleResult();                                           </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 277         } catch (Exception e) {                                                                          </span>
<span class="9213130492528639989" onmouseenter="enter('9213130492528639989');" onmouseout="out('9213130492528639989');" style=""> 278             LOG.error(&quot;Error counting offer code uses.&quot;, e);                                             </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 279             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281     }                                                                                                    </span>
<span  style=""> 282                                                                                                          </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 283     @Deprecated                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 284     @Override                                                                                            </span>
<span class="4183689894295086547" onmouseenter="enter('4183689894295086547');" onmouseout="out('4183689894295086547');" style=""> 285     public Long countOfferCodeUses(Long offerCodeId) {                                                   </span>
<span class="8560132629948814289" onmouseenter="enter('8560132629948814289');" onmouseout="out('8560132629948814289');" style=""> 286         TypedQuery&lt;Long&gt; query = new TypedQueryBuilder&lt;&gt;(OfferAudit.class, &quot;offerAudit&quot;)                 </span>
<span class="-2760927246990072011" onmouseenter="enter('-2760927246990072011');" onmouseout="out('-2760927246990072011');" style=""> 287                 .addRestriction(&quot;offerAudit.offerCodeId&quot;, &quot;=&quot;, offerCodeId)                              </span>
<span class="-7681019580808200885" onmouseenter="enter('-7681019580808200885');" onmouseout="out('-7681019580808200885');" style=""> 288                 .toCountQuery(em);                                                                       </span>
<span  style=""> 289                                                                                                          </span>
<span class="-5318016161907480331" onmouseenter="enter('-5318016161907480331');" onmouseout="out('-5318016161907480331');" style=""> 290         return query.getSingleResult();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291     }                                                                                                    </span>
<span  style=""> 292                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 293     @Override                                                                                            </span>
<span class="1997128441202003654" onmouseenter="enter('1997128441202003654');" onmouseout="out('1997128441202003654');" style=""> 294     public List&lt;OfferAudit&gt; readOfferAuditsByOrderId(Long orderId) {                                     </span>
<span class="6895483049015333951" onmouseenter="enter('6895483049015333951');" onmouseout="out('6895483049015333951');" style=""> 295         TypedQuery&lt;OfferAudit&gt; query = new TypedQueryBuilder&lt;&gt;(OfferAudit.class, &quot;offerAudit&quot;)           </span>
<span class="-6559521421523619479" onmouseenter="enter('-6559521421523619479');" onmouseout="out('-6559521421523619479');" style=""> 296                 .addRestriction(&quot;offerAudit.orderId&quot;, &quot;=&quot;, orderId)                                      </span>
<span class="-7189622533419316302" onmouseenter="enter('-7189622533419316302');" onmouseout="out('-7189622533419316302');" style=""> 297                 .toQuery(em);                                                                            </span>
<span  style=""> 298                                                                                                          </span>
<span class="6708314796189813357" onmouseenter="enter('6708314796189813357');" onmouseout="out('6708314796189813357');" style=""> 299         return query.getResultList();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300     }                                                                                                    </span>
<span  style=""> 301                                                                                                          </span>
<span  style=""> 302                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 303     @Override                                                                                            </span>
<span class="5477970363726054314" onmouseenter="enter('5477970363726054314');" onmouseout="out('5477970363726054314');" style=""> 304     public Long getCurrentDateResolution() {                                                             </span>
<span class="-7988021434068185318" onmouseenter="enter('-7988021434068185318');" onmouseout="out('-7988021434068185318');" style=""> 305         return currentDateResolution;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306     }                                                                                                    </span>
<span  style=""> 307                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 308     @Override                                                                                            </span>
<span class="-271762138402286644" onmouseenter="enter('-271762138402286644');" onmouseout="out('-271762138402286644');" style=""> 309     public void setCurrentDateResolution(Long currentDateResolution) {                                   </span>
<span class="-7813324798835187266" onmouseenter="enter('-7813324798835187266');" onmouseout="out('-7813324798835187266');" style=""> 310         this.currentDateResolution = currentDateResolution;                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311     }                                                                                                    </span>
<span  style=""> 312                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 313 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3  * BroadleafCommerce Framework                                                                           </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="4581976383907508446" onmouseenter="enter('4581976383907508446');" onmouseout="out('4581976383907508446');" style="">  18 package org.broadleafcommerce.core.offer.dao;                                                            </span>
<span  style="">  19                                                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  20 import java.util.ArrayList;                                                                              </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  21 import java.util.Calendar;                                                                               </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="">  22 import java.util.Date;                                                                                   </span>
<span class="-4685965902094386510" onmouseenter="enter('-4685965902094386510');" onmouseout="out('-4685965902094386510');" style="">  23 import java.util.GregorianCalendar;                                                                      </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  24 import java.util.List;                                                                                   </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  25 import javax.annotation.Resource;                                                                        </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  26 import javax.persistence.EntityManager;                                                                  </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  27 import javax.persistence.PersistenceContext;                                                             </span>
<span class="6539032290250175619" onmouseenter="enter('6539032290250175619');" onmouseout="out('6539032290250175619');" style="">  28 import javax.persistence.TypedQuery;                                                                     </span>
<span class="8485852916582699615" onmouseenter="enter('8485852916582699615');" onmouseout="out('8485852916582699615');" style="">  29 import javax.persistence.criteria.CriteriaBuilder;                                                       </span>
<span class="9191540725958216337" onmouseenter="enter('9191540725958216337');" onmouseout="out('9191540725958216337');" style="">  30 import javax.persistence.criteria.CriteriaQuery;                                                         </span>
<span class="7244103982108254428" onmouseenter="enter('7244103982108254428');" onmouseout="out('7244103982108254428');" style="">  31 import javax.persistence.criteria.Predicate;                                                             </span>
<span class="5782830673162504954" onmouseenter="enter('5782830673162504954');" onmouseout="out('5782830673162504954');" style="">  32 import javax.persistence.criteria.Root;                                                                  </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  33 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  34 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="4111478795314305516" onmouseenter="enter('4111478795314305516');" onmouseout="out('4111478795314305516');" style="">  35 import org.broadleafcommerce.common.persistence.EntityConfiguration;                                     </span>
<span class="1373992879208813777" onmouseenter="enter('1373992879208813777');" onmouseout="out('1373992879208813777');" style="">  36 import org.broadleafcommerce.common.time.SystemTime;                                                     </span>
<span class="8922526534929083638" onmouseenter="enter('8922526534929083638');" onmouseout="out('8922526534929083638');" style="">  37 import org.broadleafcommerce.common.util.dao.TypedQueryBuilder;                                          </span>
<span class="64523562193483090" onmouseenter="enter('64523562193483090');" onmouseout="out('64523562193483090');" style="">  38 import org.broadleafcommerce.core.offer.domain.OfferAudit;                                               </span>
<span class="-5495020915230320478" onmouseenter="enter('-5495020915230320478');" onmouseout="out('-5495020915230320478');" style="">  39 import org.broadleafcommerce.core.offer.domain.OfferAuditImpl;                                           </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  40 import org.broadleafcommerce.core.order.domain.Order;                                                    </span>
<span class="-9126455085472227806" onmouseenter="enter('-9126455085472227806');" onmouseout="out('-9126455085472227806');" style="">  41 import org.broadleafcommerce.core.order.domain.OrderImpl;                                                </span>
<span class="614288234168063731" onmouseenter="enter('614288234168063731');" onmouseout="out('614288234168063731');" style="">  42 import org.broadleafcommerce.core.order.service.type.OrderStatus;                                        </span>
<span class="-4190555539420257130" onmouseenter="enter('-4190555539420257130');" onmouseout="out('-4190555539420257130');" style="">  43 import org.springframework.stereotype.Repository;                                                        </span>
<span  style="">  44                                                                                                          </span>
<span  style="">  45                                                                                                          </span>
<span class="2189143306704906144" onmouseenter="enter('2189143306704906144');" onmouseout="out('2189143306704906144');" style="">  46 @Repository(&quot;blOfferAuditDao&quot;)                                                                           </span>
<span class="6923906510730234638" onmouseenter="enter('6923906510730234638');" onmouseout="out('6923906510730234638');" style="">  47 public class OfferAuditDaoImpl implements OfferAuditDao {                                                </span>
<span class="-6459053967516643845" onmouseenter="enter('-6459053967516643845');" onmouseout="out('-6459053967516643845');" style="">  48     protected static final Log LOG = LogFactory.getLog(OfferAuditDaoImpl.class);                         </span>
<span  style="">  49                                                                                                          </span>
<span class="-491914183795829879" onmouseenter="enter('-491914183795829879');" onmouseout="out('-491914183795829879');" style="">  50     private static final Long NULL_ACCOUNT_ID = null;                                                    </span>
<span  style="">  51                                                                                                          </span>
<span class="4392557768743364645" onmouseenter="enter('4392557768743364645');" onmouseout="out('4392557768743364645');" style="">  52     private static final Long NULL_CUSTOMER_ID = null;                                                   </span>
<span  style="">  53                                                                                                          </span>
<span class="-4259734795637808055" onmouseenter="enter('-4259734795637808055');" onmouseout="out('-4259734795637808055');" style="">  54     @PersistenceContext(unitName=&quot;blPU&quot;)                                                                 </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style="">  55     protected EntityManager em;                                                                          </span>
<span  style="">  56                                                                                                          </span>
<span class="1637373992155499263" onmouseenter="enter('1637373992155499263');" onmouseout="out('1637373992155499263');" style="">  57     @Resource(name=&quot;blEntityConfiguration&quot;)                                                              </span>
<span class="-8812870795397979367" onmouseenter="enter('-8812870795397979367');" onmouseout="out('-8812870795397979367');" style="">  58     protected EntityConfiguration entityConfiguration;                                                   </span>
<span  style="">  59                                                                                                          </span>
<span class="-7049669380064237434" onmouseenter="enter('-7049669380064237434');" onmouseout="out('-7049669380064237434');" style="">  60     protected Long currentDateResolution = 3600000L;                                                     </span>
<span  style="">  61                                                                                                          </span>
<span class="-3015759496674095868" onmouseenter="enter('-3015759496674095868');" onmouseout="out('-3015759496674095868');" style="">  62     protected Date cachedDate = SystemTime.asDate();                                                     </span>
<span  style="">  63                                                                                                          </span>
<span class="-1267510524885549695" onmouseenter="enter('-1267510524885549695');" onmouseout="out('-1267510524885549695');" style="">  64     protected Date getCurrentDateAfterFactoringInDateResolution() {                                      </span>
<span class="7456092887221268123" onmouseenter="enter('7456092887221268123');" onmouseout="out('7456092887221268123');" style=""><abbr title="  65         Date returnDate = SystemTime.getCurrentDateWithinTimeResolution(cachedDate, getCurrentDateResolution());">  65         Date returnDate = SystemTime.getCurrentDateWithinTimeResolution(cachedDate, getCurrentDateResolutðŸ”µ</abbr></span>
<span class="-701896352794694369" onmouseenter="enter('-701896352794694369');" onmouseout="out('-701896352794694369');" style="">  66         if (returnDate != cachedDate) {                                                                  </span>
<span class="5100208720017764216" onmouseenter="enter('5100208720017764216');" onmouseout="out('5100208720017764216');" style="">  67             if (SystemTime.shouldCacheDate()) {                                                          </span>
<span class="-2842817032367762030" onmouseenter="enter('-2842817032367762030');" onmouseout="out('-2842817032367762030');" style="">  68                 cachedDate = returnDate;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  69             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70         }                                                                                                </span>
<span class="8495881565272727908" onmouseenter="enter('8495881565272727908');" onmouseout="out('8495881565272727908');" style="">  71         return returnDate;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  72     }                                                                                                    </span>
<span  style="">  73                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  74     @Override                                                                                            </span>
<span class="6767135535803548971" onmouseenter="enter('6767135535803548971');" onmouseout="out('6767135535803548971');" style="">  75     public OfferAudit create() {                                                                         </span>
<span class="3805797155674316037" onmouseenter="enter('3805797155674316037');" onmouseout="out('3805797155674316037');" style="">  76         return ((OfferAudit) entityConfiguration.createEntityInstance(OfferAudit.class.getName()));      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77     }                                                                                                    </span>
<span  style="">  78                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  79     @Override                                                                                            </span>
<span class="-952767806084988342" onmouseenter="enter('-952767806084988342');" onmouseout="out('-952767806084988342');" style="">  80     public void delete(final OfferAudit offerAudit) {                                                    </span>
<span class="2838826885943543038" onmouseenter="enter('2838826885943543038');" onmouseout="out('2838826885943543038');" style="">  81         OfferAudit loa = offerAudit;                                                                     </span>
<span  style="">  82                                                                                                          </span>
<span class="4622151386703876716" onmouseenter="enter('4622151386703876716');" onmouseout="out('4622151386703876716');" style="">  83         if (!em.contains(loa)) {                                                                         </span>
<span class="8756231357348641283" onmouseenter="enter('8756231357348641283');" onmouseout="out('8756231357348641283');" style="">  84             loa = readAuditById(offerAudit.getId());                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85         }                                                                                                </span>
<span  style="">  86                                                                                                          </span>
<span class="524329334072964961" onmouseenter="enter('524329334072964961');" onmouseout="out('524329334072964961');" style="">  87         em.remove(loa);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  88     }                                                                                                    </span>
<span  style="">  89                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  90     @Override                                                                                            </span>
<span class="-2141129694682598847" onmouseenter="enter('-2141129694682598847');" onmouseout="out('-2141129694682598847');" style="">  91     public OfferAudit save(final OfferAudit offerAudit) {                                                </span>
<span class="-2813547888935568298" onmouseenter="enter('-2813547888935568298');" onmouseout="out('-2813547888935568298');" style="">  92         return em.merge(offerAudit);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93     }                                                                                                    </span>
<span  style="">  94                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  95     @Override                                                                                            </span>
<span class="-390957289170684724" onmouseenter="enter('-390957289170684724');" onmouseout="out('-390957289170684724');" style="">  96     public OfferAudit readAuditById(final Long offerAuditId) {                                           </span>
<span class="-2996840779846502092" onmouseenter="enter('-2996840779846502092');" onmouseout="out('-2996840779846502092');" style="">  97         return em.find(OfferAuditImpl.class, offerAuditId);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98     }                                                                                                    </span>
<span  style="">  99                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 100     @Override                                                                                            </span>
<span class="3411365851442909550" onmouseenter="enter('3411365851442909550');" onmouseout="out('3411365851442909550');" style=""> 101     public Long countUsesByCustomer(Order order, Long customerId, Long offerId) {                        </span>
<span class="-2974270557069561693" onmouseenter="enter('-2974270557069561693');" onmouseout="out('-2974270557069561693');" style=""> 102         return countUsesByCustomer(order, customerId, offerId, null);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103     }                                                                                                    </span>
<span  style=""> 104                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 105     @Override                                                                                            </span>
<span class="4451867570096397072" onmouseenter="enter('4451867570096397072');" onmouseout="out('4451867570096397072');" style=""> 106     public Long countUsesByAccount(Order order, Long accountId, Long offerId) {                          </span>
<span class="-4556253105265349228" onmouseenter="enter('-4556253105265349228');" onmouseout="out('-4556253105265349228');" style=""> 107         return countUsesByAccount(order, accountId, offerId, null);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108     }                                                                                                    </span>
<span  style=""> 109                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 110     @Override                                                                                            </span>
<span class="-8843695615789214022" onmouseenter="enter('-8843695615789214022');" onmouseout="out('-8843695615789214022');" style=""> 111     public Long countUsesByAccount(Order order, Long accountId, Long offerId, Long minimumDaysPerUsage) {</span>
<span class="8502471645147940958" onmouseenter="enter('8502471645147940958');" onmouseout="out('8502471645147940958');" style=""><abbr title=" 112         return countUsesByAccountOrCustomer(order, NULL_CUSTOMER_ID, accountId, offerId, minimumDaysPerUsage);"> 112         return countUsesByAccountOrCustomer(order, NULL_CUSTOMER_ID, accountId, offerId, minimumDaysPerUsðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113     }                                                                                                    </span>
<span  style=""> 114                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 115     @Override                                                                                            </span>
<span class="-8998115950668362110" onmouseenter="enter('-8998115950668362110');" onmouseout="out('-8998115950668362110');" style=""><abbr title=" 116     public Long countUsesByCustomer(Order order, Long customerId, Long offerId, Long minimumDaysPerUsage) {"> 116     public Long countUsesByCustomer(Order order, Long customerId, Long offerId, Long minimumDaysPerUsage)ðŸ”µ</abbr></span>
<span class="354199176914940576" onmouseenter="enter('354199176914940576');" onmouseout="out('354199176914940576');" style=""><abbr title=" 117         return countUsesByAccountOrCustomer(order, customerId, NULL_ACCOUNT_ID, offerId, minimumDaysPerUsage);"> 117         return countUsesByAccountOrCustomer(order, customerId, NULL_ACCOUNT_ID, offerId, minimumDaysPerUsðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118     }                                                                                                    </span>
<span  style=""> 119                                                                                                          </span>
<span class="1120399754244046360" onmouseenter="enter('1120399754244046360');" onmouseout="out('1120399754244046360');" style=""><abbr title=" 120     protected Long countUsesByAccountOrCustomer(Order order, Long customerId, Long accountId, Long offerId, Long minimumDaysPerUsage) {"> 120     protected Long countUsesByAccountOrCustomer(Order order, Long customerId, Long accountId, Long offerIðŸ”µ</abbr></span>
<span class="2959951002703615279" onmouseenter="enter('2959951002703615279');" onmouseout="out('2959951002703615279');" style=""> 121         CriteriaBuilder builder = em.getCriteriaBuilder();                                               </span>
<span class="8161502146814554426" onmouseenter="enter('8161502146814554426');" onmouseout="out('8161502146814554426');" style=""> 122         CriteriaQuery&lt;Long&gt; criteria = builder.createQuery(java.lang.Long.class);                        </span>
<span class="3736188372297695145" onmouseenter="enter('3736188372297695145');" onmouseout="out('3736188372297695145');" style=""> 123         Root&lt;OfferAuditImpl&gt; root = criteria.from(OfferAuditImpl.class);                                 </span>
<span class="794269994561015699" onmouseenter="enter('794269994561015699');" onmouseout="out('794269994561015699');" style=""> 124         Root&lt;OrderImpl&gt; orderRoot = criteria.from(OrderImpl.class);                                      </span>
<span class="-6081006627188172407" onmouseenter="enter('-6081006627188172407');" onmouseout="out('-6081006627188172407');" style=""> 125         criteria.select(builder.count(root));                                                            </span>
<span class="-7985475506215634506" onmouseenter="enter('-7985475506215634506');" onmouseout="out('-7985475506215634506');" style=""> 126         Predicate customerOrAccountPredicate = null;                                                     </span>
<span class="-8452861246579893242" onmouseenter="enter('-8452861246579893242');" onmouseout="out('-8452861246579893242');" style=""> 127         if (customerId != null) {                                                                        </span>
<span class="4779664179124354463" onmouseenter="enter('4779664179124354463');" onmouseout="out('4779664179124354463');" style=""> 128             customerOrAccountPredicate = builder.equal(root.get(&quot;customerId&quot;), customerId);              </span>
<span class="2030117130977549016" onmouseenter="enter('2030117130977549016');" onmouseout="out('2030117130977549016');" style=""> 129         } else if (accountId != null) {                                                                  </span>
<span class="-8726287971348706514" onmouseenter="enter('-8726287971348706514');" onmouseout="out('-8726287971348706514');" style=""> 130             customerOrAccountPredicate = builder.equal(root.get(&quot;accountId&quot;), accountId);                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 131         } else {                                                                                         </span>
<span class="9008286842041895655" onmouseenter="enter('9008286842041895655');" onmouseout="out('9008286842041895655');" style=""> 132             LOG.debug(&quot;Count uses by account or customer called without an account or a customer.&quot;);     </span>
<span class="-7938083568872702361" onmouseenter="enter('-7938083568872702361');" onmouseout="out('-7938083568872702361');" style=""> 133             return 0L;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134         }                                                                                                </span>
<span class="4776002924984894403" onmouseenter="enter('4776002924984894403');" onmouseout="out('4776002924984894403');" style=""> 135         List&lt;Predicate&gt; restrictions = new ArrayList&lt;&gt;();                                                </span>
<span class="-8476680270794886743" onmouseenter="enter('-8476680270794886743');" onmouseout="out('-8476680270794886743');" style=""><abbr title=" 136         restrictions.add(builder.and(customerOrAccountPredicate, builder.equal(root.get(&quot;offerId&quot;), offerId),"> 136         restrictions.add(builder.and(customerOrAccountPredicate, builder.equal(root.get(&quot;offerId&quot;), offerðŸ”µ</abbr></span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 137 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 138                 builder.or(                                                                              </span>
<span class="8658744865879024739" onmouseenter="enter('8658744865879024739');" onmouseout="out('8658744865879024739');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139                     builder.notEqual(root.get(&quot;orderId&quot;),  getOrderId(order)),                           </span>
<span class="5874404523520811803" onmouseenter="enter('5874404523520811803');" onmouseout="out('5874404523520811803');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140                     builder.isNull(root.get(&quot;orderId&quot;))                                                  </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141                 )                                                                                        </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 142 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 143 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 143 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 144 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145                                                                                                          </span>
<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146                 builder.or(                                                                              </span>
<span class="-5053751442564412129" onmouseenter="enter('-5053751442564412129');" onmouseout="out('-5053751442564412129');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147                         builder.isNull(root.get(&quot;orderId&quot;)),                                             </span>
<span class="-7082427283179034359" onmouseenter="enter('-7082427283179034359');" onmouseout="out('-7082427283179034359');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148                         builder.and(                                                                     </span>
<span class="1300697703598493370" onmouseenter="enter('1300697703598493370');" onmouseout="out('1300697703598493370');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 149                                 builder.notEqual(orderRoot.get(&quot;status&quot;),OrderStatus.CANCELLED.getType()),"> 149                                 builder.notEqual(orderRoot.get(&quot;status&quot;),OrderStatus.CANCELLED.getType())ðŸ”µ</abbr></span>
<span class="-8867673829603152997" onmouseenter="enter('-8867673829603152997');" onmouseout="out('-8867673829603152997');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150                                 builder.equal(orderRoot.get(&quot;id&quot;),root.get(&quot;orderId&quot;))                   </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151                         )                                                                                </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152                 )                                                                                        </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 153 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="3699784701886273761" onmouseenter="enter('3699784701886273761');" onmouseout="out('3699784701886273761');" style=""> 154         ));                                                                                              </span>
<span class="497110639789085928" onmouseenter="enter('497110639789085928');" onmouseout="out('497110639789085928');" style=""> 155         if ((minimumDaysPerUsage != null) &amp;&amp; (minimumDaysPerUsage != 0L)) {                              </span>
<span class="-6741860991329977308" onmouseenter="enter('-6741860991329977308');" onmouseout="out('-6741860991329977308');" style=""> 156             Date currentDate = getCurrentDateAfterFactoringInDateResolution();                           </span>
<span class="-4251495261730735242" onmouseenter="enter('-4251495261730735242');" onmouseout="out('-4251495261730735242');" style=""> 157             Calendar previousCalendar = new GregorianCalendar();                                         </span>
<span class="-675573854089282254" onmouseenter="enter('-675573854089282254');" onmouseout="out('-675573854089282254');" style=""> 158             previousCalendar.setTime(currentDate);                                                       </span>
<span class="1475910684470385723" onmouseenter="enter('1475910684470385723');" onmouseout="out('1475910684470385723');" style=""> 159             previousCalendar.add(Calendar.DAY_OF_YEAR, -minimumDaysPerUsage.intValue());                 </span>
<span class="3776274754744251807" onmouseenter="enter('3776274754744251807');" onmouseout="out('3776274754744251807');" style=""><abbr title=" 160             restrictions.add(builder.between(root.&lt;Date&gt;get(&quot;redeemedDate&quot;), previousCalendar.getTime(), currentDate));"> 160             restrictions.add(builder.between(root.&lt;Date&gt;get(&quot;redeemedDate&quot;), previousCalendar.getTime(), ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161         }                                                                                                </span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style=""> 162         criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 163         try {                                                                                            </span>
<span class="-8065100963523804356" onmouseenter="enter('-8065100963523804356');" onmouseout="out('-8065100963523804356');" style=""> 164             return em.createQuery(criteria).getSingleResult();                                           </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 165         } catch (java.lang.Exception e) {                                                                </span>
<span class="8796996608272497134" onmouseenter="enter('8796996608272497134');" onmouseout="out('8796996608272497134');" style=""> 166             LOG.error(&quot;Error counting offer uses by customer.&quot;, e);                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 167             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169     }                                                                                                    </span>
<span  style=""> 170                                                                                                          </span>
<span class="-6144322825734226959" onmouseenter="enter('-6144322825734226959');" onmouseout="out('-6144322825734226959');" style=""> 171     protected Long getOrderId(Order order) {                                                             </span>
<span class="9203448067690384131" onmouseenter="enter('9203448067690384131');" onmouseout="out('9203448067690384131');" style=""> 172         return order.getId();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173     }                                                                                                    </span>
<span  style=""> 174                                                                                                          </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 175     @Deprecated                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 176     @Override                                                                                            </span>
<span class="8572688489452949307" onmouseenter="enter('8572688489452949307');" onmouseout="out('8572688489452949307');" style=""> 177     public Long countUsesByCustomer(Long customerId, Long offerId) {                                     </span>
<span class="8560132629948814289" onmouseenter="enter('8560132629948814289');" onmouseout="out('8560132629948814289');" style=""> 178         TypedQuery&lt;Long&gt; query = new TypedQueryBuilder&lt;&gt;(OfferAudit.class, &quot;offerAudit&quot;)                 </span>
<span class="-997680114505620220" onmouseenter="enter('-997680114505620220');" onmouseout="out('-997680114505620220');" style=""> 179                 .addRestriction(&quot;offerAudit.customerId&quot;, &quot;=&quot;, customerId)                                </span>
<span class="6019838381362188725" onmouseenter="enter('6019838381362188725');" onmouseout="out('6019838381362188725');" style=""> 180                 .addRestriction(&quot;offerAudit.offerId&quot;, &quot;=&quot;, offerId)                                      </span>
<span class="-7681019580808200885" onmouseenter="enter('-7681019580808200885');" onmouseout="out('-7681019580808200885');" style=""> 181                 .toCountQuery(em);                                                                       </span>
<span  style=""> 182                                                                                                          </span>
<span class="-5318016161907480331" onmouseenter="enter('-5318016161907480331');" onmouseout="out('-5318016161907480331');" style=""> 183         return query.getSingleResult();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184     }                                                                                                    </span>
<span  style=""> 185                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 186     @Override                                                                                            </span>
<span class="7435846264829736595" onmouseenter="enter('7435846264829736595');" onmouseout="out('7435846264829736595');" style=""> 187     public Long countOfferCodeUses(Order order, Long offerCodeId) {                                      </span>
<span class="2959951002703615279" onmouseenter="enter('2959951002703615279');" onmouseout="out('2959951002703615279');" style=""> 188         CriteriaBuilder builder = em.getCriteriaBuilder();                                               </span>
<span class="8161502146814554426" onmouseenter="enter('8161502146814554426');" onmouseout="out('8161502146814554426');" style=""> 189         CriteriaQuery&lt;Long&gt; criteria = builder.createQuery(java.lang.Long.class);                        </span>
<span class="3736188372297695145" onmouseenter="enter('3736188372297695145');" onmouseout="out('3736188372297695145');" style=""> 190         Root&lt;OfferAuditImpl&gt; root = criteria.from(OfferAuditImpl.class);                                 </span>
<span class="794269994561015699" onmouseenter="enter('794269994561015699');" onmouseout="out('794269994561015699');" style=""> 191         Root&lt;OrderImpl&gt; orderRoot = criteria.from(OrderImpl.class);                                      </span>
<span class="-6081006627188172407" onmouseenter="enter('-6081006627188172407');" onmouseout="out('-6081006627188172407');" style=""> 192         criteria.select(builder.count(root));                                                            </span>
<span class="4776002924984894403" onmouseenter="enter('4776002924984894403');" onmouseout="out('4776002924984894403');" style=""> 193         List&lt;Predicate&gt; restrictions = new ArrayList&lt;&gt;();                                                </span>
<span class="-1849624516397730329" onmouseenter="enter('-1849624516397730329');" onmouseout="out('-1849624516397730329');" style=""><abbr title=" 194         restrictions.add(builder.and(builder.or(builder.notEqual(root.get(&quot;orderId&quot;), getOrderId(order)), builder.isNull(root.get(&quot;orderId&quot;))), builder.equal(root.get(&quot;offerCodeId&quot;), offerCodeId), builder.or(builder.isNull(root.get(&quot;orderId&quot;)), builder.and(builder.notEqual(orderRoot.get(&quot;status&quot;), OrderStatus.CANCELLED.getType()), builder.equal(orderRoot.get(&quot;id&quot;), root.get(&quot;orderId&quot;))))));"> 194         restrictions.add(builder.and(builder.or(builder.notEqual(root.get(&quot;orderId&quot;), getOrderId(order)),ðŸ”µ</abbr></span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style=""> 195         criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 196         try {                                                                                            </span>
<span class="-8065100963523804356" onmouseenter="enter('-8065100963523804356');" onmouseout="out('-8065100963523804356');" style=""> 197             return em.createQuery(criteria).getSingleResult();                                           </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 198         } catch (java.lang.Exception e) {                                                                </span>
<span class="9213130492528639989" onmouseenter="enter('9213130492528639989');" onmouseout="out('9213130492528639989');" style=""> 199             LOG.error(&quot;Error counting offer code uses.&quot;, e);                                             </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 200             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202     }                                                                                                    </span>
<span  style=""> 203                                                                                                          </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 204     @Deprecated                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 205     @Override                                                                                            </span>
<span class="4183689894295086547" onmouseenter="enter('4183689894295086547');" onmouseout="out('4183689894295086547');" style=""> 206     public Long countOfferCodeUses(Long offerCodeId) {                                                   </span>
<span class="8560132629948814289" onmouseenter="enter('8560132629948814289');" onmouseout="out('8560132629948814289');" style=""> 207         TypedQuery&lt;Long&gt; query = new TypedQueryBuilder&lt;&gt;(OfferAudit.class, &quot;offerAudit&quot;)                 </span>
<span class="-2760927246990072011" onmouseenter="enter('-2760927246990072011');" onmouseout="out('-2760927246990072011');" style=""> 208                 .addRestriction(&quot;offerAudit.offerCodeId&quot;, &quot;=&quot;, offerCodeId)                              </span>
<span class="-7681019580808200885" onmouseenter="enter('-7681019580808200885');" onmouseout="out('-7681019580808200885');" style=""> 209                 .toCountQuery(em);                                                                       </span>
<span  style=""> 210                                                                                                          </span>
<span class="-5318016161907480331" onmouseenter="enter('-5318016161907480331');" onmouseout="out('-5318016161907480331');" style=""> 211         return query.getSingleResult();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212     }                                                                                                    </span>
<span  style=""> 213                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 214     @Override                                                                                            </span>
<span class="1997128441202003654" onmouseenter="enter('1997128441202003654');" onmouseout="out('1997128441202003654');" style=""> 215     public List&lt;OfferAudit&gt; readOfferAuditsByOrderId(Long orderId) {                                     </span>
<span class="6895483049015333951" onmouseenter="enter('6895483049015333951');" onmouseout="out('6895483049015333951');" style=""> 216         TypedQuery&lt;OfferAudit&gt; query = new TypedQueryBuilder&lt;&gt;(OfferAudit.class, &quot;offerAudit&quot;)           </span>
<span class="-6559521421523619479" onmouseenter="enter('-6559521421523619479');" onmouseout="out('-6559521421523619479');" style=""> 217                 .addRestriction(&quot;offerAudit.orderId&quot;, &quot;=&quot;, orderId)                                      </span>
<span class="-7189622533419316302" onmouseenter="enter('-7189622533419316302');" onmouseout="out('-7189622533419316302');" style=""> 218                 .toQuery(em);                                                                            </span>
<span  style=""> 219                                                                                                          </span>
<span class="6708314796189813357" onmouseenter="enter('6708314796189813357');" onmouseout="out('6708314796189813357');" style=""> 220         return query.getResultList();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221     }                                                                                                    </span>
<span  style=""> 222                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 223     @Override                                                                                            </span>
<span class="5477970363726054314" onmouseenter="enter('5477970363726054314');" onmouseout="out('5477970363726054314');" style=""> 224     public Long getCurrentDateResolution() {                                                             </span>
<span class="-7988021434068185318" onmouseenter="enter('-7988021434068185318');" onmouseout="out('-7988021434068185318');" style=""> 225         return currentDateResolution;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226     }                                                                                                    </span>
<span  style=""> 227                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 228     @Override                                                                                            </span>
<span class="-271762138402286644" onmouseenter="enter('-271762138402286644');" onmouseout="out('-271762138402286644');" style=""> 229     public void setCurrentDateResolution(Long currentDateResolution) {                                   </span>
<span class="-7813324798835187266" onmouseenter="enter('-7813324798835187266');" onmouseout="out('-7813324798835187266');" style=""> 230         this.currentDateResolution = currentDateResolution;                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232 }                                                                                                        </span>
















































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3   * BroadleafCommerce Framework                                                                                    </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="4581976383907508446" onmouseenter="enter('4581976383907508446');" onmouseout="out('4581976383907508446');" style="">  18  package org.broadleafcommerce.core.offer.dao;                                                                     </span>
<span  style="">  19                                                                                                                    </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  20  import org.apache.commons.logging.Log;                                                                            </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  21  import org.apache.commons.logging.LogFactory;                                                                     </span>
<span class="4111478795314305516" onmouseenter="enter('4111478795314305516');" onmouseout="out('4111478795314305516');" style="">  22  import org.broadleafcommerce.common.persistence.EntityConfiguration;                                              </span>
<span class="1373992879208813777" onmouseenter="enter('1373992879208813777');" onmouseout="out('1373992879208813777');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  23 +import org.broadleafcommerce.common.time.SystemTime;                                                              </span>
<span class="8922526534929083638" onmouseenter="enter('8922526534929083638');" onmouseout="out('8922526534929083638');" style="">  24  import org.broadleafcommerce.common.util.dao.TypedQueryBuilder;                                                   </span>
<span class="64523562193483090" onmouseenter="enter('64523562193483090');" onmouseout="out('64523562193483090');" style="">  25  import org.broadleafcommerce.core.offer.domain.OfferAudit;                                                        </span>
<span class="-5495020915230320478" onmouseenter="enter('-5495020915230320478');" onmouseout="out('-5495020915230320478');" style="">  26  import org.broadleafcommerce.core.offer.domain.OfferAuditImpl;                                                    </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  27  import org.broadleafcommerce.core.order.domain.Order;                                                             </span>


<span class="-4190555539420257130" onmouseenter="enter('-4190555539420257130');" onmouseout="out('-4190555539420257130');" style="">  28  import org.springframework.stereotype.Repository;                                                                 </span>
<span  style="">  29                                                                                                                    </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  30  import java.util.ArrayList;                                                                                       </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  31 +import java.util.Calendar;                                                                                        </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  32 +import java.util.Date;                                                                                            </span>
<span class="-4685965902094386510" onmouseenter="enter('-4685965902094386510');" onmouseout="out('-4685965902094386510');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  33 +import java.util.GregorianCalendar;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  34  import java.util.List;                                                                                            </span>
<span  style="">  35                                                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  36  import javax.annotation.Resource;                                                                                 </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  37  import javax.persistence.EntityManager;                                                                           </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  38  import javax.persistence.PersistenceContext;                                                                      </span>
<span class="6539032290250175619" onmouseenter="enter('6539032290250175619');" onmouseout="out('6539032290250175619');" style="">  39  import javax.persistence.TypedQuery;                                                                              </span>
<span class="8485852916582699615" onmouseenter="enter('8485852916582699615');" onmouseout="out('8485852916582699615');" style="">  40  import javax.persistence.criteria.CriteriaBuilder;                                                                </span>
<span class="9191540725958216337" onmouseenter="enter('9191540725958216337');" onmouseout="out('9191540725958216337');" style="">  41  import javax.persistence.criteria.CriteriaQuery;                                                                  </span>
<span class="7244103982108254428" onmouseenter="enter('7244103982108254428');" onmouseout="out('7244103982108254428');" style="">  42  import javax.persistence.criteria.Predicate;                                                                      </span>
<span class="5782830673162504954" onmouseenter="enter('5782830673162504954');" onmouseout="out('5782830673162504954');" style="">  43  import javax.persistence.criteria.Root;                                                                           </span>
<span  style="">  44                                                                                                                    </span>
<span class="2189143306704906144" onmouseenter="enter('2189143306704906144');" onmouseout="out('2189143306704906144');" style="">  45  @Repository(&quot;blOfferAuditDao&quot;)                                                                                    </span>
<span class="6923906510730234638" onmouseenter="enter('6923906510730234638');" onmouseout="out('6923906510730234638');" style="">  46  public class OfferAuditDaoImpl implements OfferAuditDao {                                                         </span>
<span  style="">  47                                                                                                                    </span>
<span class="-6459053967516643845" onmouseenter="enter('-6459053967516643845');" onmouseout="out('-6459053967516643845');" style="">  48      protected static final Log LOG = LogFactory.getLog(OfferAuditDaoImpl.class);                                  </span>
<span  style="">  49                                                                                                                    </span>
<span class="-491914183795829879" onmouseenter="enter('-491914183795829879');" onmouseout="out('-491914183795829879');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  50 +    private static final Long NULL_ACCOUNT_ID = null;                                                             </span>
<span class="4392557768743364645" onmouseenter="enter('4392557768743364645');" onmouseout="out('4392557768743364645');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  51 +    private static final Long NULL_CUSTOMER_ID = null;                                                            </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  52 +                                                                                                                  </span>
<span class="-4259734795637808055" onmouseenter="enter('-4259734795637808055');" onmouseout="out('-4259734795637808055');" style="">  53      @PersistenceContext(unitName=&quot;blPU&quot;)                                                                          </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style="">  54      protected EntityManager em;                                                                                   </span>
<span  style="">  55                                                                                                                    </span>
<span class="1637373992155499263" onmouseenter="enter('1637373992155499263');" onmouseout="out('1637373992155499263');" style="">  56      @Resource(name=&quot;blEntityConfiguration&quot;)                                                                       </span>
<span class="-8812870795397979367" onmouseenter="enter('-8812870795397979367');" onmouseout="out('-8812870795397979367');" style="">  57      protected EntityConfiguration entityConfiguration;                                                            </span>
<span  style="">  58                                                                                                                    </span>
<span class="-7049669380064237434" onmouseenter="enter('-7049669380064237434');" onmouseout="out('-7049669380064237434');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  59 +    protected Long currentDateResolution = 3600000L;                                                              </span>
<span class="-3015759496674095868" onmouseenter="enter('-3015759496674095868');" onmouseout="out('-3015759496674095868');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  60 +    protected Date cachedDate = SystemTime.asDate();                                                              </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  61 +                                                                                                                  </span>
<span class="-1267510524885549695" onmouseenter="enter('-1267510524885549695');" onmouseout="out('-1267510524885549695');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  62 +    protected Date getCurrentDateAfterFactoringInDateResolution() {                                               </span>
<span class="7456092887221268123" onmouseenter="enter('7456092887221268123');" onmouseout="out('7456092887221268123');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  63 +        Date returnDate = SystemTime.getCurrentDateWithinTimeResolution(cachedDate, getCurrentDateResolution());  </span>
<span class="-701896352794694369" onmouseenter="enter('-701896352794694369');" onmouseout="out('-701896352794694369');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  64 +        if (returnDate != cachedDate) {                                                                           </span>
<span class="5100208720017764216" onmouseenter="enter('5100208720017764216');" onmouseout="out('5100208720017764216');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  65 +            if (SystemTime.shouldCacheDate()) {                                                                   </span>
<span class="-2842817032367762030" onmouseenter="enter('-2842817032367762030');" onmouseout="out('-2842817032367762030');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +                cachedDate = returnDate;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  67 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  68 +        }                                                                                                         </span>
<span class="8495881565272727908" onmouseenter="enter('8495881565272727908');" onmouseout="out('8495881565272727908');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  69 +        return returnDate;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  70 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  71 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  72      @Override                                                                                                     </span>
<span class="6767135535803548971" onmouseenter="enter('6767135535803548971');" onmouseout="out('6767135535803548971');" style="">  73      public OfferAudit create() {                                                                                  </span>
<span class="3805797155674316037" onmouseenter="enter('3805797155674316037');" onmouseout="out('3805797155674316037');" style="">  74          return ((OfferAudit) entityConfiguration.createEntityInstance(OfferAudit.class.getName()));               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  75      }                                                                                                             </span>
<span  style="">  76                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  77      @Override                                                                                                     </span>
<span class="-952767806084988342" onmouseenter="enter('-952767806084988342');" onmouseout="out('-952767806084988342');" style="">  78      public void delete(final OfferAudit offerAudit) {                                                             </span>
<span class="2838826885943543038" onmouseenter="enter('2838826885943543038');" onmouseout="out('2838826885943543038');" style="">  79          OfferAudit loa = offerAudit;                                                                              </span>
<span  style="">  80                                                                                                                    </span>
<span class="4622151386703876716" onmouseenter="enter('4622151386703876716');" onmouseout="out('4622151386703876716');" style="">  81          if (!em.contains(loa)) {                                                                                  </span>
<span class="8756231357348641283" onmouseenter="enter('8756231357348641283');" onmouseout="out('8756231357348641283');" style="">  82              loa = readAuditById(offerAudit.getId());                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  83          }                                                                                                         </span>
<span  style="">  84                                                                                                                    </span>
<span class="524329334072964961" onmouseenter="enter('524329334072964961');" onmouseout="out('524329334072964961');" style="">  85          em.remove(loa);                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  86      }                                                                                                             </span>
<span  style="">  87                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  88      @Override                                                                                                     </span>
<span class="-2141129694682598847" onmouseenter="enter('-2141129694682598847');" onmouseout="out('-2141129694682598847');" style="">  89      public OfferAudit save(final OfferAudit offerAudit) {                                                         </span>
<span class="-2813547888935568298" onmouseenter="enter('-2813547888935568298');" onmouseout="out('-2813547888935568298');" style="">  90          return em.merge(offerAudit);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91      }                                                                                                             </span>
<span  style="">  92                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  93      @Override                                                                                                     </span>
<span class="-390957289170684724" onmouseenter="enter('-390957289170684724');" onmouseout="out('-390957289170684724');" style="">  94      public OfferAudit readAuditById(final Long offerAuditId) {                                                    </span>
<span class="-2996840779846502092" onmouseenter="enter('-2996840779846502092');" onmouseout="out('-2996840779846502092');" style="">  95          return em.find(OfferAuditImpl.class, offerAuditId);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96      }                                                                                                             </span>
<span  style="">  97                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  98      @Override                                                                                                     </span>
<span class="3411365851442909550" onmouseenter="enter('3411365851442909550');" onmouseout="out('3411365851442909550');" style="">  99      public Long countUsesByCustomer(Order order, Long customerId, Long offerId) {                                 </span>
<span class="-2974270557069561693" onmouseenter="enter('-2974270557069561693');" onmouseout="out('-2974270557069561693');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +        return countUsesByCustomer(order, customerId, offerId, null);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 103 +    @Override                                                                                                     </span>
<span class="4451867570096397072" onmouseenter="enter('4451867570096397072');" onmouseout="out('4451867570096397072');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +    public Long countUsesByAccount(Order order, Long accountId, Long offerId) {                                   </span>
<span class="-4556253105265349228" onmouseenter="enter('-4556253105265349228');" onmouseout="out('-4556253105265349228');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +        return countUsesByAccount(order, accountId, offerId, null);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 107 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 108 +    @Override                                                                                                     </span>
<span class="-8843695615789214022" onmouseenter="enter('-8843695615789214022');" onmouseout="out('-8843695615789214022');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 109 +    public Long countUsesByAccount(Order order, Long accountId, Long offerId, Long minimumDaysPerUsage) {         </span>
<span class="8502471645147940958" onmouseenter="enter('8502471645147940958');" onmouseout="out('8502471645147940958');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 110 +        return countUsesByAccountOrCustomer(order, NULL_CUSTOMER_ID, accountId, offerId, minimumDaysPerUsage);    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 111 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 112 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 113 +    @Override                                                                                                     </span>
<span class="-8998115950668362110" onmouseenter="enter('-8998115950668362110');" onmouseout="out('-8998115950668362110');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 114 +    public Long countUsesByCustomer(Order order, Long customerId, Long offerId, Long minimumDaysPerUsage) {       </span>
<span class="354199176914940576" onmouseenter="enter('354199176914940576');" onmouseout="out('354199176914940576');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 115 +        return countUsesByAccountOrCustomer(order, customerId, NULL_ACCOUNT_ID, offerId, minimumDaysPerUsage);    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 116 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 117 +                                                                                                                  </span>
<span class="1120399754244046360" onmouseenter="enter('1120399754244046360');" onmouseout="out('1120399754244046360');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 118 +    protected Long countUsesByAccountOrCustomer(Order order, Long customerId, Long accountId, Long offerId, Long minimumDaysPerUsage) {"> 118 +    protected Long countUsesByAccountOrCustomer(Order order, Long customerId, Long accountId, Long offerId, Long mðŸ”µ</abbr></span>
<span class="2959951002703615279" onmouseenter="enter('2959951002703615279');" onmouseout="out('2959951002703615279');" style=""> 119          CriteriaBuilder builder = em.getCriteriaBuilder();                                                        </span>
<span class="1553585152448885012" onmouseenter="enter('1553585152448885012');" onmouseout="out('1553585152448885012');" style=""> 120          CriteriaQuery&lt;Long&gt; criteria = builder.createQuery(Long.class);                                           </span>
<span class="3736188372297695145" onmouseenter="enter('3736188372297695145');" onmouseout="out('3736188372297695145');" style=""> 121          Root&lt;OfferAuditImpl&gt; root = criteria.from(OfferAuditImpl.class);                                          </span>

<span class="-6081006627188172407" onmouseenter="enter('-6081006627188172407');" onmouseout="out('-6081006627188172407');" style=""> 122          criteria.select(builder.count(root));                                                                     </span>
<span  style=""> 123                                                                                                                    </span>
<span class="-7985475506215634506" onmouseenter="enter('-7985475506215634506');" onmouseout="out('-7985475506215634506');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +        Predicate customerOrAccountPredicate = null;                                                              </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +                                                                                                                  </span>
<span class="-8452861246579893242" onmouseenter="enter('-8452861246579893242');" onmouseout="out('-8452861246579893242');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +        if (customerId != null) {                                                                                 </span>
<span class="4779664179124354463" onmouseenter="enter('4779664179124354463');" onmouseout="out('4779664179124354463');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +            customerOrAccountPredicate = builder.equal(root.get(&quot;customerId&quot;), customerId);                       </span>
<span class="2030117130977549016" onmouseenter="enter('2030117130977549016');" onmouseout="out('2030117130977549016');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +        } else if (accountId != null) {                                                                           </span>
<span class="-8726287971348706514" onmouseenter="enter('-8726287971348706514');" onmouseout="out('-8726287971348706514');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 129 +            customerOrAccountPredicate = builder.equal(root.get(&quot;accountId&quot;), accountId);                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 130 +        } else {                                                                                                  </span>
<span class="9008286842041895655" onmouseenter="enter('9008286842041895655');" onmouseout="out('9008286842041895655');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 131 +            LOG.debug(&quot;Count uses by account or customer called without an account or a customer.&quot;);              </span>
<span class="-7938083568872702361" onmouseenter="enter('-7938083568872702361');" onmouseout="out('-7938083568872702361');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 132 +            return 0L;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 133 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 134 +                                                                                                                  </span>
<span class="4776002924984894403" onmouseenter="enter('4776002924984894403');" onmouseout="out('4776002924984894403');" style=""> 135          List&lt;Predicate&gt; restrictions = new ArrayList&lt;&gt;();                                                         </span>
<span class="5027674226344040100" onmouseenter="enter('5027674226344040100');" onmouseout="out('5027674226344040100');" style=""> 136          restrictions.add(                                                                                         </span>
<span class="-7082427283179034359" onmouseenter="enter('-7082427283179034359');" onmouseout="out('-7082427283179034359');" style=""> 137              builder.and(                                                                                          </span>
<span class="-7914490944514500831" onmouseenter="enter('-7914490944514500831');" onmouseout="out('-7914490944514500831');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 138 +                        customerOrAccountPredicate, builder.equal(root.get(&quot;offerId&quot;), offerId),                  </span>
<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style=""> 139                  builder.or(                                                                                       </span>
<span class="8658744865879024739" onmouseenter="enter('8658744865879024739');" onmouseout="out('8658744865879024739');" style=""> 140                      builder.notEqual(root.get(&quot;orderId&quot;),  getOrderId(order)),                                    </span>
<span class="5874404523520811803" onmouseenter="enter('5874404523520811803');" onmouseout="out('5874404523520811803');" style=""> 141                      builder.isNull(root.get(&quot;orderId&quot;))                                                           </span>
<span class="5925056120740059197" onmouseenter="enter('5925056120740059197');" onmouseout="out('5925056120740059197');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 142 -                ),                                                                                                </span>
<span class="8365281357792220432" onmouseenter="enter('8365281357792220432');" onmouseout="out('8365281357792220432');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 143 -                builder.equal(root.get(&quot;customerId&quot;), customerId),                                                </span>
<span class="-5899645011040314126" onmouseenter="enter('-5899645011040314126');" onmouseout="out('-5899645011040314126');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 144 -                builder.equal(root.get(&quot;offerId&quot;), offerId)                                                       </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +                        )                                                                                         </span>







<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style=""> 146              )                                                                                                     </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 147          );                                                                                                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +                                                                                                                  </span>
<span class="2330639200187190199" onmouseenter="enter('2330639200187190199');" onmouseout="out('2330639200187190199');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 149 +        if (minimumDaysPerUsage != null &amp;&amp; minimumDaysPerUsage != 0L) {                                           </span>
<span class="-6741860991329977308" onmouseenter="enter('-6741860991329977308');" onmouseout="out('-6741860991329977308');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +            Date currentDate = getCurrentDateAfterFactoringInDateResolution();                                    </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +                                                                                                                  </span>
<span class="-4251495261730735242" onmouseenter="enter('-4251495261730735242');" onmouseout="out('-4251495261730735242');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +            Calendar previousCalendar = new GregorianCalendar();                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 153 +                                                                                                                  </span>
<span class="-675573854089282254" onmouseenter="enter('-675573854089282254');" onmouseout="out('-675573854089282254');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 154 +            previousCalendar.setTime(currentDate);                                                                </span>
<span class="1475910684470385723" onmouseenter="enter('1475910684470385723');" onmouseout="out('1475910684470385723');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +            previousCalendar.add(Calendar.DAY_OF_YEAR, -minimumDaysPerUsage.intValue());                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 156 +                                                                                                                  </span>
<span class="3776274754744251807" onmouseenter="enter('3776274754744251807');" onmouseout="out('3776274754744251807');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 157 +            restrictions.add(builder.between(root.&lt;Date&gt;get(&quot;redeemedDate&quot;), previousCalendar.getTime(), currentDate));"> 157 +            restrictions.add(builder.between(root.&lt;Date&gt;get(&quot;redeemedDate&quot;), previousCalendar.getTime(), currentDaðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 158 +        }                                                                                                         </span>
<span  style=""> 159                                                                                                                    </span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style=""> 160          criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                                 </span>
<span  style=""> 161                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 162          try {                                                                                                     </span>
<span class="-8065100963523804356" onmouseenter="enter('-8065100963523804356');" onmouseout="out('-8065100963523804356');" style=""> 163              return em.createQuery(criteria).getSingleResult();                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 164          } catch (Exception e) {                                                                                   </span>
<span class="8796996608272497134" onmouseenter="enter('8796996608272497134');" onmouseout="out('8796996608272497134');" style=""> 165              LOG.error(&quot;Error counting offer uses by customer.&quot;, e);                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 166              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168      }                                                                                                             </span>
<span  style=""> 169                                                                                                                    </span>
<span class="-6144322825734226959" onmouseenter="enter('-6144322825734226959');" onmouseout="out('-6144322825734226959');" style=""> 170      protected Long getOrderId(Order order) {                                                                      </span>
<span class="9203448067690384131" onmouseenter="enter('9203448067690384131');" onmouseout="out('9203448067690384131');" style=""> 171          return order.getId();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172      }                                                                                                             </span>
<span  style=""> 173                                                                                                                    </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 174      @Deprecated                                                                                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 175      @Override                                                                                                     </span>
<span class="8572688489452949307" onmouseenter="enter('8572688489452949307');" onmouseout="out('8572688489452949307');" style=""> 176      public Long countUsesByCustomer(Long customerId, Long offerId) {                                              </span>
<span class="8560132629948814289" onmouseenter="enter('8560132629948814289');" onmouseout="out('8560132629948814289');" style=""> 177          TypedQuery&lt;Long&gt; query = new TypedQueryBuilder&lt;&gt;(OfferAudit.class, &quot;offerAudit&quot;)                          </span>
<span class="-997680114505620220" onmouseenter="enter('-997680114505620220');" onmouseout="out('-997680114505620220');" style=""> 178                  .addRestriction(&quot;offerAudit.customerId&quot;, &quot;=&quot;, customerId)                                         </span>
<span class="6019838381362188725" onmouseenter="enter('6019838381362188725');" onmouseout="out('6019838381362188725');" style=""> 179                  .addRestriction(&quot;offerAudit.offerId&quot;, &quot;=&quot;, offerId)                                               </span>
<span class="-7681019580808200885" onmouseenter="enter('-7681019580808200885');" onmouseout="out('-7681019580808200885');" style=""> 180                  .toCountQuery(em);                                                                                </span>
<span  style=""> 181                                                                                                                    </span>
<span class="-5318016161907480331" onmouseenter="enter('-5318016161907480331');" onmouseout="out('-5318016161907480331');" style=""> 182          return query.getSingleResult();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183      }                                                                                                             </span>
<span  style=""> 184                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 185      @Override                                                                                                     </span>
<span class="7435846264829736595" onmouseenter="enter('7435846264829736595');" onmouseout="out('7435846264829736595');" style=""> 186      public Long countOfferCodeUses(Order order, Long offerCodeId) {                                               </span>
<span class="2959951002703615279" onmouseenter="enter('2959951002703615279');" onmouseout="out('2959951002703615279');" style=""> 187          CriteriaBuilder builder = em.getCriteriaBuilder();                                                        </span>
<span class="1553585152448885012" onmouseenter="enter('1553585152448885012');" onmouseout="out('1553585152448885012');" style=""> 188          CriteriaQuery&lt;Long&gt; criteria = builder.createQuery(Long.class);                                           </span>
<span class="3736188372297695145" onmouseenter="enter('3736188372297695145');" onmouseout="out('3736188372297695145');" style=""> 189          Root&lt;OfferAuditImpl&gt; root = criteria.from(OfferAuditImpl.class);                                          </span>

<span class="-6081006627188172407" onmouseenter="enter('-6081006627188172407');" onmouseout="out('-6081006627188172407');" style=""> 190          criteria.select(builder.count(root));                                                                     </span>
<span  style=""> 191                                                                                                                    </span>
<span class="4776002924984894403" onmouseenter="enter('4776002924984894403');" onmouseout="out('4776002924984894403');" style=""> 192          List&lt;Predicate&gt; restrictions = new ArrayList&lt;&gt;();                                                         </span>
<span class="5027674226344040100" onmouseenter="enter('5027674226344040100');" onmouseout="out('5027674226344040100');" style=""> 193          restrictions.add(                                                                                         </span>
<span class="-7082427283179034359" onmouseenter="enter('-7082427283179034359');" onmouseout="out('-7082427283179034359');" style=""> 194              builder.and(                                                                                          </span>
<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style=""> 195                  builder.or(                                                                                       </span>
<span class="8658744865879024739" onmouseenter="enter('8658744865879024739');" onmouseout="out('8658744865879024739');" style=""> 196                      builder.notEqual(root.get(&quot;orderId&quot;),  getOrderId(order)),                                    </span>
<span class="5874404523520811803" onmouseenter="enter('5874404523520811803');" onmouseout="out('5874404523520811803');" style=""> 197                      builder.isNull(root.get(&quot;orderId&quot;))                                                           </span>
<span class="5925056120740059197" onmouseenter="enter('5925056120740059197');" onmouseout="out('5925056120740059197');" style=""> 198                  ),                                                                                                </span>
<span class="5451941685929252196" onmouseenter="enter('5451941685929252196');" onmouseout="out('5451941685929252196');" style=""> 199                  builder.equal(root.get(&quot;offerCodeId&quot;), offerCodeId)                                               </span>








<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style=""> 200              )                                                                                                     </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 201          );                                                                                                        </span>
<span  style=""> 202                                                                                                                    </span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style=""> 203          criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                                 </span>
<span  style=""> 204                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 205          try {                                                                                                     </span>
<span class="-8065100963523804356" onmouseenter="enter('-8065100963523804356');" onmouseout="out('-8065100963523804356');" style=""> 206              return em.createQuery(criteria).getSingleResult();                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 207          } catch (Exception e) {                                                                                   </span>
<span class="9213130492528639989" onmouseenter="enter('9213130492528639989');" onmouseout="out('9213130492528639989');" style=""> 208              LOG.error(&quot;Error counting offer code uses.&quot;, e);                                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 209              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211      }                                                                                                             </span>
<span  style=""> 212                                                                                                                    </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 213      @Deprecated                                                                                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 214      @Override                                                                                                     </span>
<span class="4183689894295086547" onmouseenter="enter('4183689894295086547');" onmouseout="out('4183689894295086547');" style=""> 215      public Long countOfferCodeUses(Long offerCodeId) {                                                            </span>
<span class="8560132629948814289" onmouseenter="enter('8560132629948814289');" onmouseout="out('8560132629948814289');" style=""> 216          TypedQuery&lt;Long&gt; query = new TypedQueryBuilder&lt;&gt;(OfferAudit.class, &quot;offerAudit&quot;)                          </span>
<span class="-2760927246990072011" onmouseenter="enter('-2760927246990072011');" onmouseout="out('-2760927246990072011');" style=""> 217                  .addRestriction(&quot;offerAudit.offerCodeId&quot;, &quot;=&quot;, offerCodeId)                                       </span>
<span class="-7681019580808200885" onmouseenter="enter('-7681019580808200885');" onmouseout="out('-7681019580808200885');" style=""> 218                  .toCountQuery(em);                                                                                </span>
<span  style=""> 219                                                                                                                    </span>
<span class="-5318016161907480331" onmouseenter="enter('-5318016161907480331');" onmouseout="out('-5318016161907480331');" style=""> 220          return query.getSingleResult();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221      }                                                                                                             </span>
<span  style=""> 222                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 223      @Override                                                                                                     </span>
<span class="1997128441202003654" onmouseenter="enter('1997128441202003654');" onmouseout="out('1997128441202003654');" style=""> 224      public List&lt;OfferAudit&gt; readOfferAuditsByOrderId(Long orderId) {                                              </span>
<span class="6895483049015333951" onmouseenter="enter('6895483049015333951');" onmouseout="out('6895483049015333951');" style=""> 225          TypedQuery&lt;OfferAudit&gt; query = new TypedQueryBuilder&lt;&gt;(OfferAudit.class, &quot;offerAudit&quot;)                    </span>
<span class="-6559521421523619479" onmouseenter="enter('-6559521421523619479');" onmouseout="out('-6559521421523619479');" style=""> 226                  .addRestriction(&quot;offerAudit.orderId&quot;, &quot;=&quot;, orderId)                                               </span>
<span class="-7189622533419316302" onmouseenter="enter('-7189622533419316302');" onmouseout="out('-7189622533419316302');" style=""> 227                  .toQuery(em);                                                                                     </span>
<span  style=""> 228                                                                                                                    </span>
<span class="6708314796189813357" onmouseenter="enter('6708314796189813357');" onmouseout="out('6708314796189813357');" style=""> 229          return query.getResultList();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230      }                                                                                                             </span>
<span  style=""> 231                                                                                                                    </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 232 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 233 +    @Override                                                                                                     </span>
<span class="5477970363726054314" onmouseenter="enter('5477970363726054314');" onmouseout="out('5477970363726054314');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 234 +    public Long getCurrentDateResolution() {                                                                      </span>
<span class="-7988021434068185318" onmouseenter="enter('-7988021434068185318');" onmouseout="out('-7988021434068185318');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 235 +        return currentDateResolution;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 236 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 237 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 238 +    @Override                                                                                                     </span>
<span class="-271762138402286644" onmouseenter="enter('-271762138402286644');" onmouseout="out('-271762138402286644');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 239 +    public void setCurrentDateResolution(Long currentDateResolution) {                                            </span>
<span class="-7813324798835187266" onmouseenter="enter('-7813324798835187266');" onmouseout="out('-7813324798835187266');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 240 +        this.currentDateResolution = currentDateResolution;                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +                                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3   * BroadleafCommerce Framework                                                                                    </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="4581976383907508446" onmouseenter="enter('4581976383907508446');" onmouseout="out('4581976383907508446');" style="">  18  package org.broadleafcommerce.core.offer.dao;                                                                     </span>
<span  style="">  19                                                                                                                    </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  20  import org.apache.commons.logging.Log;                                                                            </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  21  import org.apache.commons.logging.LogFactory;                                                                     </span>
<span class="4111478795314305516" onmouseenter="enter('4111478795314305516');" onmouseout="out('4111478795314305516');" style="">  22  import org.broadleafcommerce.common.persistence.EntityConfiguration;                                              </span>

<span class="8922526534929083638" onmouseenter="enter('8922526534929083638');" onmouseout="out('8922526534929083638');" style="">  23  import org.broadleafcommerce.common.util.dao.TypedQueryBuilder;                                                   </span>
<span class="64523562193483090" onmouseenter="enter('64523562193483090');" onmouseout="out('64523562193483090');" style="">  24  import org.broadleafcommerce.core.offer.domain.OfferAudit;                                                        </span>
<span class="-5495020915230320478" onmouseenter="enter('-5495020915230320478');" onmouseout="out('-5495020915230320478');" style="">  25  import org.broadleafcommerce.core.offer.domain.OfferAuditImpl;                                                    </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  26  import org.broadleafcommerce.core.order.domain.Order;                                                             </span>
<span class="-9126455085472227806" onmouseenter="enter('-9126455085472227806');" onmouseout="out('-9126455085472227806');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  27 +import org.broadleafcommerce.core.order.domain.OrderImpl;                                                         </span>
<span class="614288234168063731" onmouseenter="enter('614288234168063731');" onmouseout="out('614288234168063731');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  28 +import org.broadleafcommerce.core.order.service.type.OrderStatus;                                                 </span>
<span class="-4190555539420257130" onmouseenter="enter('-4190555539420257130');" onmouseout="out('-4190555539420257130');" style="">  29  import org.springframework.stereotype.Repository;                                                                 </span>
<span  style="">  30                                                                                                                    </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  31  import java.util.ArrayList;                                                                                       </span>



<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  32  import java.util.List;                                                                                            </span>
<span  style="">  33                                                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  34  import javax.annotation.Resource;                                                                                 </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  35  import javax.persistence.EntityManager;                                                                           </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  36  import javax.persistence.PersistenceContext;                                                                      </span>
<span class="6539032290250175619" onmouseenter="enter('6539032290250175619');" onmouseout="out('6539032290250175619');" style="">  37  import javax.persistence.TypedQuery;                                                                              </span>
<span class="8485852916582699615" onmouseenter="enter('8485852916582699615');" onmouseout="out('8485852916582699615');" style="">  38  import javax.persistence.criteria.CriteriaBuilder;                                                                </span>
<span class="9191540725958216337" onmouseenter="enter('9191540725958216337');" onmouseout="out('9191540725958216337');" style="">  39  import javax.persistence.criteria.CriteriaQuery;                                                                  </span>
<span class="7244103982108254428" onmouseenter="enter('7244103982108254428');" onmouseout="out('7244103982108254428');" style="">  40  import javax.persistence.criteria.Predicate;                                                                      </span>
<span class="5782830673162504954" onmouseenter="enter('5782830673162504954');" onmouseout="out('5782830673162504954');" style="">  41  import javax.persistence.criteria.Root;                                                                           </span>
<span  style="">  42                                                                                                                    </span>
<span class="2189143306704906144" onmouseenter="enter('2189143306704906144');" onmouseout="out('2189143306704906144');" style="">  43  @Repository(&quot;blOfferAuditDao&quot;)                                                                                    </span>
<span class="6923906510730234638" onmouseenter="enter('6923906510730234638');" onmouseout="out('6923906510730234638');" style="">  44  public class OfferAuditDaoImpl implements OfferAuditDao {                                                         </span>
<span  style="">  45                                                                                                                    </span>
<span class="-6459053967516643845" onmouseenter="enter('-6459053967516643845');" onmouseout="out('-6459053967516643845');" style="">  46      protected static final Log LOG = LogFactory.getLog(OfferAuditDaoImpl.class);                                  </span>
<span  style="">  47                                                                                                                    </span>



<span class="-4259734795637808055" onmouseenter="enter('-4259734795637808055');" onmouseout="out('-4259734795637808055');" style="">  48      @PersistenceContext(unitName=&quot;blPU&quot;)                                                                          </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style="">  49      protected EntityManager em;                                                                                   </span>
<span  style="">  50                                                                                                                    </span>
<span class="1637373992155499263" onmouseenter="enter('1637373992155499263');" onmouseout="out('1637373992155499263');" style="">  51      @Resource(name=&quot;blEntityConfiguration&quot;)                                                                       </span>
<span class="-8812870795397979367" onmouseenter="enter('-8812870795397979367');" onmouseout="out('-8812870795397979367');" style="">  52      protected EntityConfiguration entityConfiguration;                                                            </span>
<span  style="">  53                                                                                                                    </span>













<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  54      @Override                                                                                                     </span>
<span class="6767135535803548971" onmouseenter="enter('6767135535803548971');" onmouseout="out('6767135535803548971');" style="">  55      public OfferAudit create() {                                                                                  </span>
<span class="3805797155674316037" onmouseenter="enter('3805797155674316037');" onmouseout="out('3805797155674316037');" style="">  56          return ((OfferAudit) entityConfiguration.createEntityInstance(OfferAudit.class.getName()));               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  57      }                                                                                                             </span>
<span  style="">  58                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  59      @Override                                                                                                     </span>
<span class="-952767806084988342" onmouseenter="enter('-952767806084988342');" onmouseout="out('-952767806084988342');" style="">  60      public void delete(final OfferAudit offerAudit) {                                                             </span>
<span class="2838826885943543038" onmouseenter="enter('2838826885943543038');" onmouseout="out('2838826885943543038');" style="">  61          OfferAudit loa = offerAudit;                                                                              </span>
<span  style="">  62                                                                                                                    </span>
<span class="4622151386703876716" onmouseenter="enter('4622151386703876716');" onmouseout="out('4622151386703876716');" style="">  63          if (!em.contains(loa)) {                                                                                  </span>
<span class="8756231357348641283" onmouseenter="enter('8756231357348641283');" onmouseout="out('8756231357348641283');" style="">  64              loa = readAuditById(offerAudit.getId());                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  65          }                                                                                                         </span>
<span  style="">  66                                                                                                                    </span>
<span class="524329334072964961" onmouseenter="enter('524329334072964961');" onmouseout="out('524329334072964961');" style="">  67          em.remove(loa);                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  68      }                                                                                                             </span>
<span  style="">  69                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  70      @Override                                                                                                     </span>
<span class="-2141129694682598847" onmouseenter="enter('-2141129694682598847');" onmouseout="out('-2141129694682598847');" style="">  71      public OfferAudit save(final OfferAudit offerAudit) {                                                         </span>
<span class="-2813547888935568298" onmouseenter="enter('-2813547888935568298');" onmouseout="out('-2813547888935568298');" style="">  72          return em.merge(offerAudit);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  73      }                                                                                                             </span>
<span  style="">  74                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  75      @Override                                                                                                     </span>
<span class="-390957289170684724" onmouseenter="enter('-390957289170684724');" onmouseout="out('-390957289170684724');" style="">  76      public OfferAudit readAuditById(final Long offerAuditId) {                                                    </span>
<span class="-2996840779846502092" onmouseenter="enter('-2996840779846502092');" onmouseout="out('-2996840779846502092');" style="">  77          return em.find(OfferAuditImpl.class, offerAuditId);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78      }                                                                                                             </span>
<span  style="">  79                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  80      @Override                                                                                                     </span>
<span class="3411365851442909550" onmouseenter="enter('3411365851442909550');" onmouseout="out('3411365851442909550');" style="">  81      public Long countUsesByCustomer(Order order, Long customerId, Long offerId) {                                 </span>



















<span class="2959951002703615279" onmouseenter="enter('2959951002703615279');" onmouseout="out('2959951002703615279');" style="">  82          CriteriaBuilder builder = em.getCriteriaBuilder();                                                        </span>
<span class="1553585152448885012" onmouseenter="enter('1553585152448885012');" onmouseout="out('1553585152448885012');" style="">  83          CriteriaQuery&lt;Long&gt; criteria = builder.createQuery(Long.class);                                           </span>
<span class="3736188372297695145" onmouseenter="enter('3736188372297695145');" onmouseout="out('3736188372297695145');" style="">  84          Root&lt;OfferAuditImpl&gt; root = criteria.from(OfferAuditImpl.class);                                          </span>
<span class="794269994561015699" onmouseenter="enter('794269994561015699');" onmouseout="out('794269994561015699');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  85 +        Root&lt;OrderImpl&gt; orderRoot = criteria.from(OrderImpl.class);                                               </span>
<span class="-6081006627188172407" onmouseenter="enter('-6081006627188172407');" onmouseout="out('-6081006627188172407');" style="">  86          criteria.select(builder.count(root));                                                                     </span>
<span  style="">  87                                                                                                                    </span>











<span class="4776002924984894403" onmouseenter="enter('4776002924984894403');" onmouseout="out('4776002924984894403');" style="">  88          List&lt;Predicate&gt; restrictions = new ArrayList&lt;&gt;();                                                         </span>
<span class="5027674226344040100" onmouseenter="enter('5027674226344040100');" onmouseout="out('5027674226344040100');" style="">  89          restrictions.add(                                                                                         </span>
<span class="-7082427283179034359" onmouseenter="enter('-7082427283179034359');" onmouseout="out('-7082427283179034359');" style="">  90              builder.and(                                                                                          </span>

<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style="">  91                  builder.or(                                                                                       </span>
<span class="8658744865879024739" onmouseenter="enter('8658744865879024739');" onmouseout="out('8658744865879024739');" style="">  92                      builder.notEqual(root.get(&quot;orderId&quot;),  getOrderId(order)),                                    </span>
<span class="5874404523520811803" onmouseenter="enter('5874404523520811803');" onmouseout="out('5874404523520811803');" style="">  93                      builder.isNull(root.get(&quot;orderId&quot;))                                                           </span>
<span class="5925056120740059197" onmouseenter="enter('5925056120740059197');" onmouseout="out('5925056120740059197');" style="">  94                  ),                                                                                                </span>
<span class="8365281357792220432" onmouseenter="enter('8365281357792220432');" onmouseout="out('8365281357792220432');" style="">  95                  builder.equal(root.get(&quot;customerId&quot;), customerId),                                                </span>
<span class="-5899645011040314126" onmouseenter="enter('-5899645011040314126');" onmouseout="out('-5899645011040314126');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  96 -                builder.equal(root.get(&quot;offerId&quot;), offerId)                                                       </span>
<span class="8151852281836570637" onmouseenter="enter('8151852281836570637');" onmouseout="out('8151852281836570637');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +                builder.equal(root.get(&quot;offerId&quot;), offerId),                                                      </span>
<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +                builder.or(                                                                                       </span>
<span class="-5053751442564412129" onmouseenter="enter('-5053751442564412129');" onmouseout="out('-5053751442564412129');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +                        builder.isNull(root.get(&quot;orderId&quot;)),                                                      </span>
<span class="-7082427283179034359" onmouseenter="enter('-7082427283179034359');" onmouseout="out('-7082427283179034359');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +                        builder.and(                                                                              </span>
<span class="1300697703598493370" onmouseenter="enter('1300697703598493370');" onmouseout="out('1300697703598493370');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +                                builder.notEqual(orderRoot.get(&quot;status&quot;),OrderStatus.CANCELLED.getType()),        </span>
<span class="-8867673829603152997" onmouseenter="enter('-8867673829603152997');" onmouseout="out('-8867673829603152997');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +                                builder.equal(orderRoot.get(&quot;id&quot;),root.get(&quot;orderId&quot;))                            </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 103 +                        )                                                                                         </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +                )                                                                                                 </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style=""> 105              )                                                                                                     </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 106          );                                                                                                        </span>











<span  style=""> 107                                                                                                                    </span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style=""> 108          criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                                 </span>
<span  style=""> 109                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 110          try {                                                                                                     </span>
<span class="-8065100963523804356" onmouseenter="enter('-8065100963523804356');" onmouseout="out('-8065100963523804356');" style=""> 111              return em.createQuery(criteria).getSingleResult();                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 112          } catch (Exception e) {                                                                                   </span>
<span class="8796996608272497134" onmouseenter="enter('8796996608272497134');" onmouseout="out('8796996608272497134');" style=""> 113              LOG.error(&quot;Error counting offer uses by customer.&quot;, e);                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 114              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116      }                                                                                                             </span>
<span  style=""> 117                                                                                                                    </span>
<span class="-6144322825734226959" onmouseenter="enter('-6144322825734226959');" onmouseout="out('-6144322825734226959');" style=""> 118      protected Long getOrderId(Order order) {                                                                      </span>
<span class="9203448067690384131" onmouseenter="enter('9203448067690384131');" onmouseout="out('9203448067690384131');" style=""> 119          return order.getId();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 120      }                                                                                                             </span>
<span  style=""> 121                                                                                                                    </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 122      @Deprecated                                                                                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 123      @Override                                                                                                     </span>
<span class="8572688489452949307" onmouseenter="enter('8572688489452949307');" onmouseout="out('8572688489452949307');" style=""> 124      public Long countUsesByCustomer(Long customerId, Long offerId) {                                              </span>
<span class="8560132629948814289" onmouseenter="enter('8560132629948814289');" onmouseout="out('8560132629948814289');" style=""> 125          TypedQuery&lt;Long&gt; query = new TypedQueryBuilder&lt;&gt;(OfferAudit.class, &quot;offerAudit&quot;)                          </span>
<span class="-997680114505620220" onmouseenter="enter('-997680114505620220');" onmouseout="out('-997680114505620220');" style=""> 126                  .addRestriction(&quot;offerAudit.customerId&quot;, &quot;=&quot;, customerId)                                         </span>
<span class="6019838381362188725" onmouseenter="enter('6019838381362188725');" onmouseout="out('6019838381362188725');" style=""> 127                  .addRestriction(&quot;offerAudit.offerId&quot;, &quot;=&quot;, offerId)                                               </span>
<span class="-7681019580808200885" onmouseenter="enter('-7681019580808200885');" onmouseout="out('-7681019580808200885');" style=""> 128                  .toCountQuery(em);                                                                                </span>
<span  style=""> 129                                                                                                                    </span>
<span class="-5318016161907480331" onmouseenter="enter('-5318016161907480331');" onmouseout="out('-5318016161907480331');" style=""> 130          return query.getSingleResult();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131      }                                                                                                             </span>
<span  style=""> 132                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 133      @Override                                                                                                     </span>
<span class="7435846264829736595" onmouseenter="enter('7435846264829736595');" onmouseout="out('7435846264829736595');" style=""> 134      public Long countOfferCodeUses(Order order, Long offerCodeId) {                                               </span>
<span class="2959951002703615279" onmouseenter="enter('2959951002703615279');" onmouseout="out('2959951002703615279');" style=""> 135          CriteriaBuilder builder = em.getCriteriaBuilder();                                                        </span>
<span class="1553585152448885012" onmouseenter="enter('1553585152448885012');" onmouseout="out('1553585152448885012');" style=""> 136          CriteriaQuery&lt;Long&gt; criteria = builder.createQuery(Long.class);                                           </span>
<span class="3736188372297695145" onmouseenter="enter('3736188372297695145');" onmouseout="out('3736188372297695145');" style=""> 137          Root&lt;OfferAuditImpl&gt; root = criteria.from(OfferAuditImpl.class);                                          </span>
<span class="794269994561015699" onmouseenter="enter('794269994561015699');" onmouseout="out('794269994561015699');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 138 +        Root&lt;OrderImpl&gt; orderRoot = criteria.from(OrderImpl.class);                                               </span>
<span class="-6081006627188172407" onmouseenter="enter('-6081006627188172407');" onmouseout="out('-6081006627188172407');" style=""> 139          criteria.select(builder.count(root));                                                                     </span>
<span  style=""> 140                                                                                                                    </span>
<span class="4776002924984894403" onmouseenter="enter('4776002924984894403');" onmouseout="out('4776002924984894403');" style=""> 141          List&lt;Predicate&gt; restrictions = new ArrayList&lt;&gt;();                                                         </span>
<span class="5027674226344040100" onmouseenter="enter('5027674226344040100');" onmouseout="out('5027674226344040100');" style=""> 142          restrictions.add(                                                                                         </span>
<span class="-7082427283179034359" onmouseenter="enter('-7082427283179034359');" onmouseout="out('-7082427283179034359');" style=""> 143              builder.and(                                                                                          </span>
<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style=""> 144                  builder.or(                                                                                       </span>
<span class="8658744865879024739" onmouseenter="enter('8658744865879024739');" onmouseout="out('8658744865879024739');" style=""> 145                      builder.notEqual(root.get(&quot;orderId&quot;),  getOrderId(order)),                                    </span>
<span class="5874404523520811803" onmouseenter="enter('5874404523520811803');" onmouseout="out('5874404523520811803');" style=""> 146                      builder.isNull(root.get(&quot;orderId&quot;))                                                           </span>
<span class="5925056120740059197" onmouseenter="enter('5925056120740059197');" onmouseout="out('5925056120740059197');" style=""> 147                  ),                                                                                                </span>
<span class="5451941685929252196" onmouseenter="enter('5451941685929252196');" onmouseout="out('5451941685929252196');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 148 -                builder.equal(root.get(&quot;offerCodeId&quot;), offerCodeId)                                               </span>
<span class="-6010231986318593576" onmouseenter="enter('-6010231986318593576');" onmouseout="out('-6010231986318593576');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 149 +                builder.equal(root.get(&quot;offerCodeId&quot;), offerCodeId),                                              </span>
<span class="-651214555734234838" onmouseenter="enter('-651214555734234838');" onmouseout="out('-651214555734234838');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +                builder.or(                                                                                       </span>
<span class="-5053751442564412129" onmouseenter="enter('-5053751442564412129');" onmouseout="out('-5053751442564412129');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +                        builder.isNull(root.get(&quot;orderId&quot;)),                                                      </span>
<span class="-7082427283179034359" onmouseenter="enter('-7082427283179034359');" onmouseout="out('-7082427283179034359');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +                        builder.and(                                                                              </span>
<span class="1300697703598493370" onmouseenter="enter('1300697703598493370');" onmouseout="out('1300697703598493370');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 153 +                                builder.notEqual(orderRoot.get(&quot;status&quot;),OrderStatus.CANCELLED.getType()),        </span>
<span class="-8867673829603152997" onmouseenter="enter('-8867673829603152997');" onmouseout="out('-8867673829603152997');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 154 +                                builder.equal(orderRoot.get(&quot;id&quot;),root.get(&quot;orderId&quot;))                            </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +                        )                                                                                         </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 156 +                )                                                                                                 </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style=""> 157              )                                                                                                     </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 158          );                                                                                                        </span>
<span  style=""> 159                                                                                                                    </span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style=""> 160          criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                                 </span>
<span  style=""> 161                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 162          try {                                                                                                     </span>
<span class="-8065100963523804356" onmouseenter="enter('-8065100963523804356');" onmouseout="out('-8065100963523804356');" style=""> 163              return em.createQuery(criteria).getSingleResult();                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 164          } catch (Exception e) {                                                                                   </span>
<span class="9213130492528639989" onmouseenter="enter('9213130492528639989');" onmouseout="out('9213130492528639989');" style=""> 165              LOG.error(&quot;Error counting offer code uses.&quot;, e);                                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 166              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168      }                                                                                                             </span>
<span  style=""> 169                                                                                                                    </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 170      @Deprecated                                                                                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 171      @Override                                                                                                     </span>
<span class="4183689894295086547" onmouseenter="enter('4183689894295086547');" onmouseout="out('4183689894295086547');" style=""> 172      public Long countOfferCodeUses(Long offerCodeId) {                                                            </span>
<span class="8560132629948814289" onmouseenter="enter('8560132629948814289');" onmouseout="out('8560132629948814289');" style=""> 173          TypedQuery&lt;Long&gt; query = new TypedQueryBuilder&lt;&gt;(OfferAudit.class, &quot;offerAudit&quot;)                          </span>
<span class="-2760927246990072011" onmouseenter="enter('-2760927246990072011');" onmouseout="out('-2760927246990072011');" style=""> 174                  .addRestriction(&quot;offerAudit.offerCodeId&quot;, &quot;=&quot;, offerCodeId)                                       </span>
<span class="-7681019580808200885" onmouseenter="enter('-7681019580808200885');" onmouseout="out('-7681019580808200885');" style=""> 175                  .toCountQuery(em);                                                                                </span>
<span  style=""> 176                                                                                                                    </span>
<span class="-5318016161907480331" onmouseenter="enter('-5318016161907480331');" onmouseout="out('-5318016161907480331');" style=""> 177          return query.getSingleResult();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178      }                                                                                                             </span>
<span  style=""> 179                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 180      @Override                                                                                                     </span>
<span class="1997128441202003654" onmouseenter="enter('1997128441202003654');" onmouseout="out('1997128441202003654');" style=""> 181      public List&lt;OfferAudit&gt; readOfferAuditsByOrderId(Long orderId) {                                              </span>
<span class="6895483049015333951" onmouseenter="enter('6895483049015333951');" onmouseout="out('6895483049015333951');" style=""> 182          TypedQuery&lt;OfferAudit&gt; query = new TypedQueryBuilder&lt;&gt;(OfferAudit.class, &quot;offerAudit&quot;)                    </span>
<span class="-6559521421523619479" onmouseenter="enter('-6559521421523619479');" onmouseout="out('-6559521421523619479');" style=""> 183                  .addRestriction(&quot;offerAudit.orderId&quot;, &quot;=&quot;, orderId)                                               </span>
<span class="-7189622533419316302" onmouseenter="enter('-7189622533419316302');" onmouseout="out('-7189622533419316302');" style=""> 184                  .toQuery(em);                                                                                     </span>
<span  style=""> 185                                                                                                                    </span>
<span class="6708314796189813357" onmouseenter="enter('6708314796189813357');" onmouseout="out('6708314796189813357');" style=""> 186          return query.getResultList();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187      }                                                                                                             </span>
<span  style=""> 188                                                                                                                    </span>











<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            