<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>258</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    258
                    <a href="257.html">prev</a>
                    <a href="259.html">next</a>
                    <a href="258_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    BroadleafCommerce/BroadleafCommerce_522131259c6f69ad7467dfcaf422c74f0f4c667c_admin/broadleaf-admin-module/src/main/java/org/broadleafcommerce/admin/server/service/handler/SkuCustomPersistenceHandler.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;522131259c6f69ad7467dfcaf422c74f0f4c667c:admin/broadleaf-admin-module/src/main/java/org/broadleafcommerce/admin/server/service/handler/SkuCustomPersistenceHandler.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;522131259c6f69ad7467dfcaf422c74f0f4c667c^1:admin/broadleaf-admin-module/src/main/java/org/broadleafcommerce/admin/server/service/handler/SkuCustomPersistenceHandler.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;522131259c6f69ad7467dfcaf422c74f0f4c667c^2:admin/broadleaf-admin-module/src/main/java/org/broadleafcommerce/admin/server/service/handler/SkuCustomPersistenceHandler.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;f5f52a0a63fcbc018b0183c6fbb4fa4c84da7d26:admin/broadleaf-admin-module/src/main/java/org/broadleafcommerce/admin/server/service/handler/SkuCustomPersistenceHandler.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj], [b], [s]], subset: [[bsj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-1249558187989023334" onmouseenter="enter('-1249558187989023334');" onmouseout="out('-1249558187989023334');" style="">   3  * BroadleafCommerce Admin Module                                                                        </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span class="3565305863144860564" onmouseenter="enter('3565305863144860564');" onmouseout="out('3565305863144860564');" style="">  19 package org.broadleafcommerce.admin.server.service.handler;                                              </span>
<span  style="">  20                                                                                                          </span>
<span class="-5484142805323860658" onmouseenter="enter('-5484142805323860658');" onmouseout="out('-5484142805323860658');" style="">  21 import static com.google.common.base.CharMatcher.DIGIT;                                                  </span>
<span  style="">  22                                                                                                          </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  23 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="2953846583056246827" onmouseenter="enter('2953846583056246827');" onmouseout="out('2953846583056246827');" style="">  24 import org.apache.commons.collections.Transformer;                                                       </span>
<span class="-4661043417888464228" onmouseenter="enter('-4661043417888464228');" onmouseout="out('-4661043417888464228');" style="">  25 import org.apache.commons.lang.BooleanUtils;                                                             </span>
<span class="2359514128542055982" onmouseenter="enter('2359514128542055982');" onmouseout="out('2359514128542055982');" style="">  26 import org.apache.commons.lang3.ArrayUtils;                                                              </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  27 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="-6922428965258674124" onmouseenter="enter('-6922428965258674124');" onmouseout="out('-6922428965258674124');" style="">  28 import org.apache.commons.lang3.math.NumberUtils;                                                        </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  29 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  30 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="5500044680393520896" onmouseenter="enter('5500044680393520896');" onmouseout="out('5500044680393520896');" style="">  31 import org.broadleafcommerce.admin.server.service.SkuMetadataCacheService;                               </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  32 import org.broadleafcommerce.common.exception.ServiceException;                                          </span>
<span class="-2413957740330241600" onmouseenter="enter('-2413957740330241600');" onmouseout="out('-2413957740330241600');" style="">  33 import org.broadleafcommerce.common.presentation.client.LookupType;                                      </span>
<span class="-212317658512913375" onmouseenter="enter('-212317658512913375');" onmouseout="out('-212317658512913375');" style="">  34 import org.broadleafcommerce.common.presentation.client.OperationType;                                   </span>
<span class="7296089998360266547" onmouseenter="enter('7296089998360266547');" onmouseout="out('7296089998360266547');" style="">  35 import org.broadleafcommerce.common.presentation.client.PersistencePerspectiveItemType;                  </span>
<span class="1362364260528215152" onmouseenter="enter('1362364260528215152');" onmouseout="out('1362364260528215152');" style="">  36 import org.broadleafcommerce.common.presentation.client.SupportedFieldType;                              </span>
<span class="-7583443881845767348" onmouseenter="enter('-7583443881845767348');" onmouseout="out('-7583443881845767348');" style="">  37 import org.broadleafcommerce.common.presentation.client.VisibilityEnum;                                  </span>
<span class="-2818686525334833130" onmouseenter="enter('-2818686525334833130');" onmouseout="out('-2818686525334833130');" style="">  38 import org.broadleafcommerce.common.sandbox.SandBoxHelper;                                               </span>
<span class="-3909806959928975034" onmouseenter="enter('-3909806959928975034');" onmouseout="out('-3909806959928975034');" style="">  39 import org.broadleafcommerce.common.util.BLCCollectionUtils;                                             </span>
<span class="-3347161074136237116" onmouseenter="enter('-3347161074136237116');" onmouseout="out('-3347161074136237116');" style="">  40 import org.broadleafcommerce.common.util.StringUtil;                                                     </span>
<span class="-8028747938757529269" onmouseenter="enter('-8028747938757529269');" onmouseout="out('-8028747938757529269');" style="">  41 import org.broadleafcommerce.common.util.TypedTransformer;                                               </span>
<span class="2901117953480421393" onmouseenter="enter('2901117953480421393');" onmouseout="out('2901117953480421393');" style="">  42 import org.broadleafcommerce.common.util.dao.DynamicDaoHelperImpl;                                       </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  43 import org.broadleafcommerce.core.catalog.domain.Product;                                                </span>
<span class="8587718080948629089" onmouseenter="enter('8587718080948629089');" onmouseout="out('8587718080948629089');" style="">  44 import org.broadleafcommerce.core.catalog.domain.ProductBundle;                                          </span>
<span class="-85811185251521902" onmouseenter="enter('-85811185251521902');" onmouseout="out('-85811185251521902');" style="">  45 import org.broadleafcommerce.core.catalog.domain.ProductImpl;                                            </span>
<span class="6224071758335975205" onmouseenter="enter('6224071758335975205');" onmouseout="out('6224071758335975205');" style="">  46 import org.broadleafcommerce.core.catalog.domain.ProductOption;                                          </span>
<span class="-6385470104782105538" onmouseenter="enter('-6385470104782105538');" onmouseout="out('-6385470104782105538');" style="">  47 import org.broadleafcommerce.core.catalog.domain.ProductOptionImpl;                                      </span>
<span class="-7937345987210941259" onmouseenter="enter('-7937345987210941259');" onmouseout="out('-7937345987210941259');" style="">  48 import org.broadleafcommerce.core.catalog.domain.ProductOptionValue;                                     </span>
<span class="7369709806901157478" onmouseenter="enter('7369709806901157478');" onmouseout="out('7369709806901157478');" style="">  49 import org.broadleafcommerce.core.catalog.domain.ProductOptionValueImpl;                                 </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  50 import org.broadleafcommerce.core.catalog.domain.Sku;                                                    </span>
<span class="1181568146405964825" onmouseenter="enter('1181568146405964825');" onmouseout="out('1181568146405964825');" style="">  51 import org.broadleafcommerce.core.catalog.domain.SkuImpl;                                                </span>
<span class="688919036808372243" onmouseenter="enter('688919036808372243');" onmouseout="out('688919036808372243');" style="">  52 import org.broadleafcommerce.core.catalog.domain.SkuProductOptionValueXref;                              </span>
<span class="-3196712195758579658" onmouseenter="enter('-3196712195758579658');" onmouseout="out('-3196712195758579658');" style="">  53 import org.broadleafcommerce.core.catalog.domain.SkuProductOptionValueXrefImpl;                          </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  54 import org.broadleafcommerce.core.catalog.service.CatalogService;                                        </span>
<span class="4427537537958608766" onmouseenter="enter('4427537537958608766');" onmouseout="out('4427537537958608766');" style="">  55 import org.broadleafcommerce.openadmin.dto.BasicFieldMetadata;                                           </span>
<span class="-1607559599739253077" onmouseenter="enter('-1607559599739253077');" onmouseout="out('-1607559599739253077');" style="">  56 import org.broadleafcommerce.openadmin.dto.ClassMetadata;                                                </span>
<span class="-8970007776478821592" onmouseenter="enter('-8970007776478821592');" onmouseout="out('-8970007776478821592');" style="">  57 import org.broadleafcommerce.openadmin.dto.CriteriaTransferObject;                                       </span>
<span class="-4742435063138209714" onmouseenter="enter('-4742435063138209714');" onmouseout="out('-4742435063138209714');" style="">  58 import org.broadleafcommerce.openadmin.dto.DynamicResultSet;                                             </span>
<span class="-5093421835888664541" onmouseenter="enter('-5093421835888664541');" onmouseout="out('-5093421835888664541');" style="">  59 import org.broadleafcommerce.openadmin.dto.Entity;                                                       </span>
<span class="-8829499667991596741" onmouseenter="enter('-8829499667991596741');" onmouseout="out('-8829499667991596741');" style="">  60 import org.broadleafcommerce.openadmin.dto.FieldMetadata;                                                </span>
<span class="6369021917986026789" onmouseenter="enter('6369021917986026789');" onmouseout="out('6369021917986026789');" style="">  61 import org.broadleafcommerce.openadmin.dto.FilterAndSortCriteria;                                        </span>
<span class="7333603239996951733" onmouseenter="enter('7333603239996951733');" onmouseout="out('7333603239996951733');" style="">  62 import org.broadleafcommerce.openadmin.dto.MergedPropertyType;                                           </span>
<span class="5387066876064049952" onmouseenter="enter('5387066876064049952');" onmouseout="out('5387066876064049952');" style="">  63 import org.broadleafcommerce.openadmin.dto.PersistencePackage;                                           </span>
<span class="8079401142601162613" onmouseenter="enter('8079401142601162613');" onmouseout="out('8079401142601162613');" style="">  64 import org.broadleafcommerce.openadmin.dto.PersistencePerspective;                                       </span>
<span class="1983554291461039357" onmouseenter="enter('1983554291461039357');" onmouseout="out('1983554291461039357');" style="">  65 import org.broadleafcommerce.openadmin.dto.Property;                                                     </span>
<span class="1696571253156436279" onmouseenter="enter('1696571253156436279');" onmouseout="out('1696571253156436279');" style="">  66 import org.broadleafcommerce.openadmin.dto.SectionCrumb;                                                 </span>
<span class="-8828889589519173652" onmouseenter="enter('-8828889589519173652');" onmouseout="out('-8828889589519173652');" style="">  67 import org.broadleafcommerce.openadmin.server.dao.DynamicEntityDao;                                      </span>
<span class="-9217168395336380631" onmouseenter="enter('-9217168395336380631');" onmouseout="out('-9217168395336380631');" style="">  68 import org.broadleafcommerce.openadmin.server.service.handler.CustomPersistenceHandlerAdapter;           </span>
<span class="-1454726158681359973" onmouseenter="enter('-1454726158681359973');" onmouseout="out('-1454726158681359973');" style="">  69 import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceManager;                    </span>
<span class="97669409268306845" onmouseenter="enter('97669409268306845');" onmouseout="out('97669409268306845');" style="">  70 import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceManagerFactory;             </span>
<span class="-9205099315907051841" onmouseenter="enter('-9205099315907051841');" onmouseout="out('-9205099315907051841');" style="">  71 import org.broadleafcommerce.openadmin.server.service.persistence.module.InspectHelper;                  </span>
<span class="8253709771214222101" onmouseenter="enter('8253709771214222101');" onmouseout="out('8253709771214222101');" style="">  72 import org.broadleafcommerce.openadmin.server.service.persistence.module.PersistenceModule;              </span>
<span class="5407139061354632707" onmouseenter="enter('5407139061354632707');" onmouseout="out('5407139061354632707');" style="">  73 import org.broadleafcommerce.openadmin.server.service.persistence.module.RecordHelper;                   </span>
<span class="-4125327013079009203" onmouseenter="enter('-4125327013079009203');" onmouseout="out('-4125327013079009203');" style="">  74 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.CriteriaTranslator;    </span>
<span class="7637154476457570035" onmouseenter="enter('7637154476457570035');" onmouseout="out('7637154476457570035');" style="">  75 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPath;             </span>
<span class="1663650800150084878" onmouseenter="enter('1663650800150084878');" onmouseout="out('1663650800150084878');" style="">  76 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPathBuilder;      </span>
<span class="7520439988643323618" onmouseenter="enter('7520439988643323618');" onmouseout="out('7520439988643323618');" style="">  77 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FilterMapping;         </span>
<span class="-8754722050104399052" onmouseenter="enter('-8754722050104399052');" onmouseout="out('-8754722050104399052');" style="">  78 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.Restriction;           </span>
<span class="2225343043491731861" onmouseenter="enter('2225343043491731861');" onmouseout="out('2225343043491731861');" style=""><abbr title="  79 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.predicate.PredicateProvider;">  79 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.predicate.PredicateProvðŸ”µ</abbr></span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  80 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  81 import org.springframework.stereotype.Component;                                                         </span>
<span  style="">  82                                                                                                          </span>
<span class="5998602906817463685" onmouseenter="enter('5998602906817463685');" onmouseout="out('5998602906817463685');" style="">  83 import java.io.Serializable;                                                                             </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  84 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  85 import java.util.Arrays;                                                                                 </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  86 import java.util.Collection;                                                                             </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  87 import java.util.Collections;                                                                            </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  88 import java.util.HashMap;                                                                                </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  89 import java.util.Iterator;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  90 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  91 import java.util.Map;                                                                                    </span>
<span  style="">  92                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  93 import javax.annotation.Resource;                                                                        </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  94 import javax.persistence.EntityManager;                                                                  </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  95 import javax.persistence.PersistenceContext;                                                             </span>
<span class="6539032290250175619" onmouseenter="enter('6539032290250175619');" onmouseout="out('6539032290250175619');" style="">  96 import javax.persistence.TypedQuery;                                                                     </span>
<span class="8485852916582699615" onmouseenter="enter('8485852916582699615');" onmouseout="out('8485852916582699615');" style="">  97 import javax.persistence.criteria.CriteriaBuilder;                                                       </span>
<span class="2535099540501772744" onmouseenter="enter('2535099540501772744');" onmouseout="out('2535099540501772744');" style="">  98 import javax.persistence.criteria.From;                                                                  </span>
<span class="5773424155764142692" onmouseenter="enter('5773424155764142692');" onmouseout="out('5773424155764142692');" style="">  99 import javax.persistence.criteria.Path;                                                                  </span>
<span class="7244103982108254428" onmouseenter="enter('7244103982108254428');" onmouseout="out('7244103982108254428');" style=""> 100 import javax.persistence.criteria.Predicate;                                                             </span>
<span  style=""> 101                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 102 /**                                                                                                      </span>
<span class="-2581105714976122669" onmouseenter="enter('-2581105714976122669');" onmouseout="out('-2581105714976122669');" style=""> 103  * @author Phillip Verheyden                                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 104  *                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 105  */                                                                                                      </span>
<span class="-4061322517816489282" onmouseenter="enter('-4061322517816489282');" onmouseout="out('-4061322517816489282');" style=""> 106 @Component(&quot;blSkuCustomPersistenceHandler&quot;)                                                              </span>
<span class="-1865408177148521742" onmouseenter="enter('-1865408177148521742');" onmouseout="out('-1865408177148521742');" style=""> 107 public class SkuCustomPersistenceHandler extends CustomPersistenceHandlerAdapter {                       </span>
<span  style=""> 108                                                                                                          </span>
<span class="-8713958385326184455" onmouseenter="enter('-8713958385326184455');" onmouseout="out('-8713958385326184455');" style=""> 109     private static final Log LOG = LogFactory.getLog(SkuCustomPersistenceHandler.class);                 </span>
<span  style=""> 110                                                                                                          </span>
<span class="363907699147620123" onmouseenter="enter('363907699147620123');" onmouseout="out('363907699147620123');" style=""> 111     public static String PRODUCT_OPTION_FIELD_PREFIX = &quot;productOption&quot;;                                  </span>
<span class="5644485626870470186" onmouseenter="enter('5644485626870470186');" onmouseout="out('5644485626870470186');" style=""> 112     public static String INVENTORY_ONLY_CRITERIA = &quot;onlyInventoryProperties&quot;;                            </span>
<span  style=""> 113                                                                                                          </span>
<span class="-4251425677142148253" onmouseenter="enter('-4251425677142148253');" onmouseout="out('-4251425677142148253');" style=""> 114     @Value(&quot;${use.to.one.lookup.sku.product.option.value:false}&quot;)                                        </span>
<span class="6110895124324481806" onmouseenter="enter('6110895124324481806');" onmouseout="out('6110895124324481806');" style=""> 115     protected boolean useToOneLookupSkuProductOptionValue = false;                                       </span>
<span  style=""> 116                                                                                                          </span>
<span class="-7681629157280888116" onmouseenter="enter('-7681629157280888116');" onmouseout="out('-7681629157280888116');" style=""> 117     @Resource(name =&quot;blSkuMetadataCacheService&quot;)                                                         </span>
<span class="5822417842178589229" onmouseenter="enter('5822417842178589229');" onmouseout="out('5822417842178589229');" style=""> 118     protected SkuMetadataCacheService skuMetadataCacheService;                                           </span>
<span  style=""> 119                                                                                                          </span>
<span class="8317365465805033193" onmouseenter="enter('8317365465805033193');" onmouseout="out('8317365465805033193');" style=""> 120     @Resource(name=&quot;blAdornedTargetListPersistenceModule&quot;)                                               </span>
<span class="878998746675668437" onmouseenter="enter('878998746675668437');" onmouseout="out('878998746675668437');" style=""> 121     protected PersistenceModule adornedPersistenceModule;                                                </span>
<span  style=""> 122                                                                                                          </span>
<span class="-7011722868621328349" onmouseenter="enter('-7011722868621328349');" onmouseout="out('-7011722868621328349');" style=""> 123     @Resource(name = &quot;blSkuCustomPersistenceHandlerExtensionManager&quot;)                                    </span>
<span class="-9007673134867108683" onmouseenter="enter('-9007673134867108683');" onmouseout="out('-9007673134867108683');" style=""> 124     protected SkuCustomPersistenceHandlerExtensionManager extensionManager;                              </span>
<span  style=""> 125                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 126     /**                                                                                                  </span>
<span class="4136366527029974243" onmouseenter="enter('4136366527029974243');" onmouseout="out('4136366527029974243');" style=""><abbr title=" 127      * This represents the field that all of the product option values will be stored in. This would be used in the case"> 127      * This represents the field that all of the product option values will be stored in. This would be uðŸ”µ</abbr></span>
<span class="6047944382158863307" onmouseenter="enter('6047944382158863307');" onmouseout="out('6047944382158863307');" style=""><abbr title=" 128      * where there are a bunch of product options and displaying each option as a grid header would have everything"> 128      * where there are a bunch of product options and displaying each option as a grid header would have ðŸ”µ</abbr></span>
<span class="-3054662628739130883" onmouseenter="enter('-3054662628739130883');" onmouseout="out('-3054662628739130883');" style=""> 129      * squashed together. Filtering on this field is currently unsupported.                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 130      */                                                                                                  </span>
<span class="5445041667615320295" onmouseenter="enter('5445041667615320295');" onmouseout="out('5445041667615320295');" style=""> 131     public static String CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME = &quot;consolidatedProductOptions&quot;;         </span>
<span class="-2903820884082764399" onmouseenter="enter('-2903820884082764399');" onmouseout="out('-2903820884082764399');" style=""> 132     public static String CONSOLIDATED_PRODUCT_OPTIONS_DELIMETER = &quot;; &quot;;                                  </span>
<span  style=""> 133                                                                                                          </span>
<span class="5554818697985539506" onmouseenter="enter('5554818697985539506');" onmouseout="out('5554818697985539506');" style=""> 134     @Resource(name=&quot;blCatalogService&quot;)                                                                   </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style=""> 135     protected CatalogService catalogService;                                                             </span>
<span  style=""> 136                                                                                                          </span>
<span class="5710637357667853932" onmouseenter="enter('5710637357667853932');" onmouseout="out('5710637357667853932');" style=""> 137     @PersistenceContext(unitName = &quot;blPU&quot;)                                                               </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style=""> 138     protected EntityManager em;                                                                          </span>
<span  style=""> 139                                                                                                          </span>
<span class="-2696154002193407400" onmouseenter="enter('-2696154002193407400');" onmouseout="out('-2696154002193407400');" style=""> 140     @Resource(name = &quot;blCriteriaTranslator&quot;)                                                             </span>
<span class="6548648040486234931" onmouseenter="enter('6548648040486234931');" onmouseout="out('6548648040486234931');" style=""> 141     protected CriteriaTranslator criteriaTranslator;                                                     </span>
<span  style=""> 142                                                                                                          </span>
<span class="-3946461589801993391" onmouseenter="enter('-3946461589801993391');" onmouseout="out('-3946461589801993391');" style=""> 143     @Resource(name = &quot;blSandBoxHelper&quot;)                                                                  </span>
<span class="-7799183597372200632" onmouseenter="enter('-7799183597372200632');" onmouseout="out('-7799183597372200632');" style=""> 144     protected SandBoxHelper sandBoxHelper;                                                               </span>
<span  style=""> 145                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 146     @Override                                                                                            </span>
<span class="998850855763553690" onmouseenter="enter('998850855763553690');" onmouseout="out('998850855763553690');" style=""> 147     public Boolean canHandleInspect(PersistencePackage persistencePackage) {                             </span>
<span class="-5823917578938895674" onmouseenter="enter('-5823917578938895674');" onmouseout="out('-5823917578938895674');" style=""><abbr title=" 148         return canHandle(persistencePackage, persistencePackage.getPersistencePerspective().getOperationTypes()"> 148         return canHandle(persistencePackage, persistencePackage.getPersistencePerspective().getOperationTðŸ”µ</abbr></span>
<span class="9015299385431722883" onmouseenter="enter('9015299385431722883');" onmouseout="out('9015299385431722883');" style=""> 149                 .getInspectType());                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 150     }                                                                                                    </span>
<span  style=""> 151                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 152     @Override                                                                                            </span>
<span class="-8556163469002491307" onmouseenter="enter('-8556163469002491307');" onmouseout="out('-8556163469002491307');" style=""> 153     public Boolean canHandleFetch(PersistencePackage persistencePackage) {                               </span>
<span class="10418940480604143" onmouseenter="enter('10418940480604143');" onmouseout="out('10418940480604143');" style=""><abbr title=" 154         OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFetchType();"> 154         OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFðŸ”µ</abbr></span>
<span class="8754300242813385255" onmouseenter="enter('8754300242813385255');" onmouseout="out('8754300242813385255');" style=""> 155         return canHandle(persistencePackage, fetchType);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156     }                                                                                                    </span>
<span  style=""> 157                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 158     @Override                                                                                            </span>
<span class="1712661648493993457" onmouseenter="enter('1712661648493993457');" onmouseout="out('1712661648493993457');" style=""> 159     public Boolean canHandleAdd(PersistencePackage persistencePackage) {                                 </span>
<span class="-5221489961679899774" onmouseenter="enter('-5221489961679899774');" onmouseout="out('-5221489961679899774');" style=""><abbr title=" 160         OperationType addType = persistencePackage.getPersistencePerspective().getOperationTypes().getAddType();"> 160         OperationType addType = persistencePackage.getPersistencePerspective().getOperationTypes().getAddðŸ”µ</abbr></span>
<span class="1238914713862050599" onmouseenter="enter('1238914713862050599');" onmouseout="out('1238914713862050599');" style=""> 161         return canHandle(persistencePackage, addType);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162     }                                                                                                    </span>
<span  style=""> 163                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 164     @Override                                                                                            </span>
<span class="5315207923223107799" onmouseenter="enter('5315207923223107799');" onmouseout="out('5315207923223107799');" style=""> 165     public Boolean canHandleUpdate(PersistencePackage persistencePackage) {                              </span>
<span class="8318706485461606240" onmouseenter="enter('8318706485461606240');" onmouseout="out('8318706485461606240');" style=""><abbr title=" 166         OperationType updateType = persistencePackage.getPersistencePerspective().getOperationTypes().getUpdateType();"> 166         OperationType updateType = persistencePackage.getPersistencePerspective().getOperationTypes().getðŸ”µ</abbr></span>
<span class="7628662592758046218" onmouseenter="enter('7628662592758046218');" onmouseout="out('7628662592758046218');" style=""> 167         return canHandle(persistencePackage, updateType);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168     }                                                                                                    </span>
<span  style=""> 169                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 170     /**                                                                                                  </span>
<span class="6990985093790140011" onmouseenter="enter('6990985093790140011');" onmouseout="out('6990985093790140011');" style=""><abbr title=" 171      * Since this is the default for all Skus, it&#x27;s possible that we are providing custom criteria for this"> 171      * Since this is the default for all Skus, it&#x27;s possible that we are providing custom criteria for thðŸ”µ</abbr></span>
<span class="-7639041005907295879" onmouseenter="enter('-7639041005907295879');" onmouseout="out('-7639041005907295879');" style=""><abbr title=" 172      * Sku lookup. In that case, we probably want to delegate to a child class, so only use this particular"> 172      * Sku lookup. In that case, we probably want to delegate to a child class, so only use this particulðŸ”µ</abbr></span>
<span class="3567117971388930965" onmouseenter="enter('3567117971388930965');" onmouseout="out('3567117971388930965');" style=""><abbr title=" 173      * persistence handler if there is no custom criteria being used and the ceiling entity is an instance of Sku. The"> 173      * persistence handler if there is no custom criteria being used and the ceiling entity is an instancðŸ”µ</abbr></span>
<span class="-9191698445538453171" onmouseenter="enter('-9191698445538453171');" onmouseout="out('-9191698445538453171');" style=""><abbr title=" 174      * exception to this rule is when we are pulling back Media, since the admin actually uses Sku for the ceiling entity"> 174      * exception to this rule is when we are pulling back Media, since the admin actually uses Sku for thðŸ”µ</abbr></span>
<span class="1646505885713320498" onmouseenter="enter('1646505885713320498');" onmouseout="out('1646505885713320498');" style=""><abbr title=" 175      * class name. That should be handled by the map structure module though, so only handle things in the Sku custom"> 175      * class name. That should be handled by the map structure module though, so only handle things in thðŸ”µ</abbr></span>
<span class="-3435293659936443508" onmouseenter="enter('-3435293659936443508');" onmouseout="out('-3435293659936443508');" style=""> 176      * persistence handler for OperationType.BASIC                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 177      *                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 178      */                                                                                                  </span>
<span class="-401224984339352861" onmouseenter="enter('-401224984339352861');" onmouseout="out('-401224984339352861');" style=""> 179     protected Boolean canHandle(PersistencePackage persistencePackage, OperationType operationType) {    </span>
<span class="2519389108374285224" onmouseenter="enter('2519389108374285224');" onmouseout="out('2519389108374285224');" style=""><abbr title=" 180         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname();"> 180         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 181         try {                                                                                            </span>
<span class="3859607212114051755" onmouseenter="enter('3859607212114051755');" onmouseout="out('3859607212114051755');" style=""> 182             Class testClass = Class.forName(ceilingEntityFullyQualifiedClassname);                       </span>
<span class="-6258271003107251148" onmouseenter="enter('-6258271003107251148');" onmouseout="out('-6258271003107251148');" style=""> 183             return Sku.class.isAssignableFrom(testClass) &amp;&amp;                                              </span>
<span class="6374297613382618653" onmouseenter="enter('6374297613382618653');" onmouseout="out('6374297613382618653');" style=""> 184                     //ArrayUtils.isEmpty(persistencePackage.getCustomCriteria()) &amp;&amp;                      </span>
<span class="-7558498583587542431" onmouseenter="enter('-7558498583587542431');" onmouseout="out('-7558498583587542431');" style=""> 185                     OperationType.BASIC.equals(operationType) &amp;&amp;                                         </span>
<span class="-2045231318111877972" onmouseenter="enter('-2045231318111877972');" onmouseout="out('-2045231318111877972');" style=""><abbr title=" 186                     (persistencePackage.getPersistencePerspective().getPersistencePerspectiveItems().get(PersistencePerspectiveItemType.ADORNEDTARGETLIST) == null);"> 186                     (persistencePackage.getPersistencePerspective().getPersistencePerspectiveItems().get(ðŸ”µ</abbr></span>
<span class="1054888787890391626" onmouseenter="enter('1054888787890391626');" onmouseout="out('1054888787890391626');" style=""> 187         } catch (ClassNotFoundException e) {                                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 188             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190     }                                                                                                    </span>
<span  style=""> 191                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 192     /**                                                                                                  </span>
<span class="330022396980695391" onmouseenter="enter('330022396980695391');" onmouseout="out('330022396980695391');" style=""> 193      * Build out the extra fields for the product options                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 194      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 195     @Override                                                                                            </span>
<span class="4696212939538128393" onmouseenter="enter('4696212939538128393');" onmouseout="out('4696212939538128393');" style=""><abbr title=" 196     public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, InspectHelper helper) throws ServiceException {"> 196     public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 197         try {                                                                                            </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""><abbr title=" 198             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();"> 198             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective(ðŸ”µ</abbr></span>
<span class="5084133214681633572" onmouseenter="enter('5084133214681633572');" onmouseout="out('5084133214681633572');" style=""> 199             Map&lt;MergedPropertyType, Map&lt;String, FieldMetadata&gt;&gt; allMergedProperties = new HashMap&lt;&gt;();   </span>
<span  style=""> 200                                                                                                          </span>
<span class="8224436115361654738" onmouseenter="enter('8224436115361654738');" onmouseout="out('8224436115361654738');" style=""> 201             String productIdStr = getOwningProductId(persistencePackage.getSectionCrumbs());             </span>
<span class="8874992536138016800" onmouseenter="enter('8874992536138016800');" onmouseout="out('8874992536138016800');" style=""> 202             String cacheKey = skuMetadataCacheService.buildCacheKey(productIdStr);                       </span>
<span  style=""> 203                                                                                                          </span>
<span class="4935255304884851121" onmouseenter="enter('4935255304884851121');" onmouseout="out('4935255304884851121');" style=""> 204             Map&lt;String, FieldMetadata&gt; properties = null;                                                </span>
<span class="-7786224376670761804" onmouseenter="enter('-7786224376670761804');" onmouseout="out('-7786224376670761804');" style=""> 205             boolean useCache = skuMetadataCacheService.useCache();                                       </span>
<span class="6293418362193794054" onmouseenter="enter('6293418362193794054');" onmouseout="out('6293418362193794054');" style=""> 206             if (useCache) {                                                                              </span>
<span class="-3485340186081071120" onmouseenter="enter('-3485340186081071120');" onmouseout="out('-3485340186081071120');" style=""> 207                 properties = skuMetadataCacheService.getFromCache(cacheKey);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208             }                                                                                            </span>
<span class="-6785810758643658869" onmouseenter="enter('-6785810758643658869');" onmouseout="out('-6785810758643658869');" style=""> 209             if (properties == null) {                                                                    </span>
<span class="-5990030037269165261" onmouseenter="enter('-5990030037269165261');" onmouseout="out('-5990030037269165261');" style=""> 210                 //Grab the default properties for the Sku                                                </span>
<span class="8769638039057755276" onmouseenter="enter('8769638039057755276');" onmouseout="out('8769638039057755276');" style=""><abbr title=" 211                 properties = helper.getSimpleMergedProperties(SkuImpl.class.getName(), persistencePerspective);"> 211                 properties = helper.getSimpleMergedProperties(SkuImpl.class.getName(), persistencePerspecðŸ”µ</abbr></span>
<span  style=""> 212                                                                                                          </span>
<span class="4572678014865473520" onmouseenter="enter('4572678014865473520');" onmouseout="out('4572678014865473520');" style=""> 213                 boolean isFirstCriteriaNAN = productIdStr == null;                                       </span>
<span class="3252503566680993088" onmouseenter="enter('3252503566680993088');" onmouseout="out('3252503566680993088');" style=""> 214                 if (!isFirstCriteriaNAN &amp;&amp; useToOneLookupSkuProductOptionValue) {                        </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 215 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-5518906673453958172" onmouseenter="enter('-5518906673453958172');" onmouseout="out('-5518906673453958172');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 216                     isFirstCriteriaNAN = !NumberUtils.isParsable(productIdStr);                          </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 217 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="8769638039057755276" onmouseenter="enter('8769638039057755276');" onmouseout="out('8769638039057755276');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 218                 properties = helper.getSimpleMergedProperties(SkuImpl.class.getName(), persistencePerspective);"> 218                 properties = helper.getSimpleMergedProperties(SkuImpl.class.getName(), persistencePerspecðŸ”µ</abbr></span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 219                                                                                                          </span>
<span class="630916579208170345" onmouseenter="enter('630916579208170345');" onmouseout="out('630916579208170345');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 220                 boolean isFirstCriteriaNAN = persistencePackage.getCustomCriteria() == null || persistencePackage.getCustomCriteria().length == 0;"> 220                 boolean isFirstCriteriaNAN = persistencePackage.getCustomCriteria() == null || persistencðŸ”µ</abbr></span>
<span class="3252503566680993088" onmouseenter="enter('3252503566680993088');" onmouseout="out('3252503566680993088');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 221                 if (!isFirstCriteriaNAN &amp;&amp; useToOneLookupSkuProductOptionValue) {                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 222 =======                                                                                                  </span>
<span class="-9185431242058274610" onmouseenter="enter('-9185431242058274610');" onmouseout="out('-9185431242058274610');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 223                     isFirstCriteriaNAN = !NumberUtils.isNumber(productIdStr);                            </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 224 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225                 }                                                                                        </span>
<span class="-1057552343227044346" onmouseenter="enter('-1057552343227044346');" onmouseout="out('-1057552343227044346');" style=""> 226                 if (isFirstCriteriaNAN) {                                                                </span>
<span class="-6228644381152217188" onmouseenter="enter('-6228644381152217188');" onmouseout="out('-6228644381152217188');" style=""> 227                     //look up all the ProductOptions and then create new fields for each of them         </span>
<span class="-5911163386440462712" onmouseenter="enter('-5911163386440462712');" onmouseout="out('-5911163386440462712');" style=""> 228                     List&lt;ProductOption&gt; options = catalogService.readAllProductOptions();                </span>
<span class="-6720626788939973914" onmouseenter="enter('-6720626788939973914');" onmouseout="out('-6720626788939973914');" style=""> 229                     int order = 0;                                                                       </span>
<span class="-3626227932157062862" onmouseenter="enter('-3626227932157062862');" onmouseout="out('-3626227932157062862');" style=""> 230                     for (ProductOption option : options) {                                               </span>
<span class="-2894964408662309595" onmouseenter="enter('-2894964408662309595');" onmouseout="out('-2894964408662309595');" style=""> 231                         //add this to the built Sku properties                                           </span>
<span class="-6525885484902667726" onmouseenter="enter('-6525885484902667726');" onmouseout="out('-6525885484902667726');" style=""> 232                         FieldMetadata md = createIndividualOptionField(option, order);                   </span>
<span class="8898370236947645542" onmouseenter="enter('8898370236947645542');" onmouseout="out('8898370236947645542');" style=""> 233                         if (md != null) {                                                                </span>
<span class="-8011968882232877757" onmouseenter="enter('-8011968882232877757');" onmouseout="out('-8011968882232877757');" style=""> 234                             properties.put(&quot;productOption&quot; + option.getId(), md);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236                     }                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 237                 } else {                                                                                 </span>
<span class="-4312271314847345000" onmouseenter="enter('-4312271314847345000');" onmouseout="out('-4312271314847345000');" style=""> 238                     // If we have a product to filter the list of available product options, then use it </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 239                     try {                                                                                </span>
<span class="2407810897627048437" onmouseenter="enter('2407810897627048437');" onmouseout="out('2407810897627048437');" style=""> 240                         Long productId = Long.parseLong(productIdStr);                                   </span>
<span class="-4586946436800548085" onmouseenter="enter('-4586946436800548085');" onmouseout="out('-4586946436800548085');" style=""> 241                         Product product = catalogService.findProductById(productId);                     </span>
<span class="-8670197725029820971" onmouseenter="enter('-8670197725029820971');" onmouseout="out('-8670197725029820971');" style=""> 242                         for (ProductOption option : product.getProductOptions()) {                       </span>
<span class="1960418873000138214" onmouseenter="enter('1960418873000138214');" onmouseout="out('1960418873000138214');" style=""> 243                             FieldMetadata md = createIndividualOptionField(option, 0);                   </span>
<span class="8898370236947645542" onmouseenter="enter('8898370236947645542');" onmouseout="out('8898370236947645542');" style=""> 244                             if (md != null) {                                                            </span>
<span class="-8011968882232877757" onmouseenter="enter('-8011968882232877757');" onmouseout="out('-8011968882232877757');" style=""> 245                                 properties.put(&quot;productOption&quot; + option.getId(), md);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247                         }                                                                                </span>
<span class="7366941412324817508" onmouseenter="enter('7366941412324817508');" onmouseout="out('7366941412324817508');" style=""> 248                     } catch (NumberFormatException e) {                                                  </span>
<span class="-1877352964924956330" onmouseenter="enter('-1877352964924956330');" onmouseout="out('-1877352964924956330');" style=""> 249                         // there wasn&#x27;t a valid product id, just don&#x27;t do anything                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251                 }                                                                                        </span>
<span  style=""> 252                                                                                                          </span>
<span class="-4150172021442827260" onmouseenter="enter('-4150172021442827260');" onmouseout="out('-4150172021442827260');" style=""><abbr title=" 253                 //also build the consolidated field; if using the SkuBasicClientEntityModule then this field will be"> 253                 //also build the consolidated field; if using the SkuBasicClientEntityModule then this fiðŸ”µ</abbr></span>
<span class="-6012146770615121121" onmouseenter="enter('-6012146770615121121');" onmouseout="out('-6012146770615121121');" style=""> 254                 //permanently hidden                                                                     </span>
<span class="2721680110186827865" onmouseenter="enter('2721680110186827865');" onmouseout="out('2721680110186827865');" style=""><abbr title=" 255                 properties.put(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME, createConsolidatedOptionField(SkuImpl.class));"> 255                 properties.put(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME, createConsolidatedOptionField(SkuðŸ”µ</abbr></span>
<span  style=""> 256                                                                                                          </span>
<span class="6293418362193794054" onmouseenter="enter('6293418362193794054');" onmouseout="out('6293418362193794054');" style=""> 257                 if (useCache) {                                                                          </span>
<span class="1689829812062092848" onmouseenter="enter('1689829812062092848');" onmouseout="out('1689829812062092848');" style=""> 258                     skuMetadataCacheService.addToCache(cacheKey, properties);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260             }                                                                                            </span>
<span  style=""> 261                                                                                                          </span>
<span class="-5708738706047923554" onmouseenter="enter('-5708738706047923554');" onmouseout="out('-5708738706047923554');" style=""> 262             allMergedProperties.put(MergedPropertyType.PRIMARY, properties);                             </span>
<span  style=""> 263                                                                                                          </span>
<span class="3581259712058738264" onmouseenter="enter('3581259712058738264');" onmouseout="out('3581259712058738264');" style=""> 264             //allow the adorned list to contribute properties as well in the case of Sku bundle items    </span>
<span class="4464917262062588204" onmouseenter="enter('4464917262062588204');" onmouseout="out('4464917262062588204');" style=""> 265             adornedPersistenceModule.setPersistenceManager((PersistenceManager)helper);                  </span>
<span class="-5923303721993025135" onmouseenter="enter('-5923303721993025135');" onmouseout="out('-5923303721993025135');" style=""> 266             adornedPersistenceModule.updateMergedProperties(persistencePackage, allMergedProperties);    </span>
<span  style=""> 267                                                                                                          </span>
<span class="-4755998569329183714" onmouseenter="enter('-4755998569329183714');" onmouseout="out('-4755998569329183714');" style=""><abbr title=" 268             Class&lt;?&gt;[] entityClasses = dynamicEntityDao.getAllPolymorphicEntitiesFromCeiling(SkuImpl.class);"> 268             Class&lt;?&gt;[] entityClasses = dynamicEntityDao.getAllPolymorphicEntitiesFromCeiling(SkuImpl.clasðŸ”µ</abbr></span>
<span  style=""> 269                                                                                                          </span>
<span class="-4526006421593645811" onmouseenter="enter('-4526006421593645811');" onmouseout="out('-4526006421593645811');" style=""><abbr title=" 270             for (Map.Entry&lt;MergedPropertyType, Map&lt;String, FieldMetadata&gt;&gt; entry : allMergedProperties.entrySet()) {"> 270             for (Map.Entry&lt;MergedPropertyType, Map&lt;String, FieldMetadata&gt;&gt; entry : allMergedProperties.enðŸ”µ</abbr></span>
<span class="5289188932531096512" onmouseenter="enter('5289188932531096512');" onmouseout="out('5289188932531096512');" style=""> 271                 filterOutProductMetadata(entry.getValue());                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272             }                                                                                            </span>
<span  style=""> 273                                                                                                          </span>
<span class="-8821755242796986609" onmouseenter="enter('-8821755242796986609');" onmouseout="out('-8821755242796986609');" style=""><abbr title=" 274             ClassMetadata mergedMetadata = helper.buildClassMetadata(entityClasses, persistencePackage, allMergedProperties);"> 274             ClassMetadata mergedMetadata = helper.buildClassMetadata(entityClasses, persistencePackage, aðŸ”µ</abbr></span>
<span class="5692867683696224654" onmouseenter="enter('5692867683696224654');" onmouseout="out('5692867683696224654');" style=""> 275             DynamicResultSet results = new DynamicResultSet(mergedMetadata, null, null);                 </span>
<span  style=""> 276                                                                                                          </span>
<span class="225205592763971576" onmouseenter="enter('225205592763971576');" onmouseout="out('225205592763971576');" style=""> 277             return results;                                                                              </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 278         } catch (Exception e) {                                                                          </span>
<span class="5888084531497929280" onmouseenter="enter('5888084531497929280');" onmouseout="out('5888084531497929280');" style=""> 279             ServiceException ex = new ServiceException(&quot;Unable to retrieve inspection results for &quot; +    </span>
<span class="6417711820622805051" onmouseenter="enter('6417711820622805051');" onmouseout="out('6417711820622805051');" style=""> 280                     persistencePackage.getCeilingEntityFullyQualifiedClassname(), e);                    </span>
<span class="8479095309709473887" onmouseenter="enter('8479095309709473887');" onmouseout="out('8479095309709473887');" style=""> 281             throw ex;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283     }                                                                                                    </span>
<span  style=""> 284                                                                                                          </span>
<span class="7792500831321188662" onmouseenter="enter('7792500831321188662');" onmouseout="out('7792500831321188662');" style=""> 285     protected String getOwningProductId(SectionCrumb[] sectionCrumbs) {                                  </span>
<span class="5995078305082040448" onmouseenter="enter('5995078305082040448');" onmouseout="out('5995078305082040448');" style=""> 286         if (ArrayUtils.isNotEmpty(sectionCrumbs) &amp;&amp; ProductImpl.class.getCanonicalName()                 </span>
<span class="-5371969237667246856" onmouseenter="enter('-5371969237667246856');" onmouseout="out('-5371969237667246856');" style=""> 287                 .equals(sectionCrumbs[0].getSectionIdentifier())) {                                      </span>
<span class="1460529894614018184" onmouseenter="enter('1460529894614018184');" onmouseout="out('1460529894614018184');" style=""> 288             return sectionCrumbs[0].getSectionId();                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 290         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291     }                                                                                                    </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 292 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 293                                                                                                          </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 294 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-976216753136159975" onmouseenter="enter('-976216753136159975');" onmouseout="out('-976216753136159975');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295         List&lt;String&gt; removeKeys = new ArrayList&lt;&gt;();                                                     </span>
<span class="-6833083889726135539" onmouseenter="enter('-6833083889726135539');" onmouseout="out('-6833083889726135539');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 296         for (Map.Entry&lt;String, FieldMetadata&gt; entry : map.entrySet()) {                                  </span>
<span class="-6943676522367592499" onmouseenter="enter('-6943676522367592499');" onmouseout="out('-6943676522367592499');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297             if (entry.getKey().contains(&quot;defaultProduct.&quot;) || entry.getKey().contains(&quot;product.&quot;)) {     </span>
<span class="6428107256625953551" onmouseenter="enter('6428107256625953551');" onmouseout="out('6428107256625953551');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298                 removeKeys.add(entry.getKey());                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 299 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 300                                                                                                          </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 301 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-6584484392335358741" onmouseenter="enter('-6584484392335358741');" onmouseout="out('-6584484392335358741');" style=""> 302     protected void filterOutProductMetadata(Map&lt;String, FieldMetadata&gt; map) {                            </span>
<span class="5728154390973133711" onmouseenter="enter('5728154390973133711');" onmouseout="out('5728154390973133711');" style=""><abbr title=" 303         //TODO we shouldn&#x27;t have to filter out these keys here -- we should be able to exclude using @AdminPresentation,"> 303         //TODO we shouldn&#x27;t have to filter out these keys here -- we should be able to exclude using @AdmðŸ”µ</abbr></span>
<span class="-7743625525232386179" onmouseenter="enter('-7743625525232386179');" onmouseout="out('-7743625525232386179');" style=""> 304         //but there&#x27;s a bug preventing this behavior from completely working correctly                   </span>
<span class="-976216753136159975" onmouseenter="enter('-976216753136159975');" onmouseout="out('-976216753136159975');" style=""> 305         List&lt;String&gt; removeKeys = new ArrayList&lt;&gt;();                                                     </span>
<span class="-6833083889726135539" onmouseenter="enter('-6833083889726135539');" onmouseout="out('-6833083889726135539');" style=""> 306         for (Map.Entry&lt;String, FieldMetadata&gt; entry : map.entrySet()) {                                  </span>
<span class="-6943676522367592499" onmouseenter="enter('-6943676522367592499');" onmouseout="out('-6943676522367592499');" style=""> 307             if (entry.getKey().contains(&quot;defaultProduct.&quot;) || entry.getKey().contains(&quot;product.&quot;)) {     </span>
<span class="6428107256625953551" onmouseenter="enter('6428107256625953551');" onmouseout="out('6428107256625953551');" style=""> 308                 removeKeys.add(entry.getKey());                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 310         }                                                                                                </span>
<span class="7925962848224625040" onmouseenter="enter('7925962848224625040');" onmouseout="out('7925962848224625040');" style=""> 311         for (String removeKey : removeKeys) {                                                            </span>
<span class="-7725303831891910229" onmouseenter="enter('-7725303831891910229');" onmouseout="out('-7725303831891910229');" style=""> 312             map.remove(removeKey);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 313         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 314     }                                                                                                    </span>
<span  style=""> 315                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 316     /**                                                                                                  </span>
<span class="8475757947277110833" onmouseenter="enter('8475757947277110833');" onmouseout="out('8475757947277110833');" style=""><abbr title=" 317      * Creates the metadata necessary for displaying all of the product option values in a single field. The display of this"> 317      * Creates the metadata necessary for displaying all of the product option values in a single field. ðŸ”µ</abbr></span>
<span class="-7291252168371203717" onmouseenter="enter('-7291252168371203717');" onmouseout="out('-7291252168371203717');" style=""><abbr title=" 318      * field is a single string with every product option value appended to it separated by a semicolon. This method should"> 318      * field is a single string with every product option value appended to it separated by a semicolon. ðŸ”µ</abbr></span>
<span class="1992999426370183590" onmouseenter="enter('1992999426370183590');" onmouseout="out('1992999426370183590');" style=""><abbr title=" 319      * be invoked on an inspect for whatever is utilizing this so that the property will be ready to be populated on fetch."> 319      * be invoked on an inspect for whatever is utilizing this so that the property will be ready to be pðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 320      *                                                                                                   </span>
<span class="-6637674095635137344" onmouseenter="enter('-6637674095635137344');" onmouseout="out('-6637674095635137344');" style=""><abbr title=" 321      * The metadata that is returned will also be set to prominent by default so that it will be ready to display on whatever"> 321      * The metadata that is returned will also be set to prominent by default so that it will be ready toðŸ”µ</abbr></span>
<span class="-511871035138294277" onmouseenter="enter('-511871035138294277');" onmouseout="out('-511871035138294277');" style=""><abbr title=" 322      * grid is being inspected. If you do not want this behavior you will need to override this functionality in the metadata"> 322      * grid is being inspected. If you do not want this behavior you will need to override this functionaðŸ”µ</abbr></span>
<span class="3179613037749712904" onmouseenter="enter('3179613037749712904');" onmouseout="out('3179613037749712904');" style=""> 323      * that is returned.                                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 324      *                                                                                                   </span>
<span class="7116239974974757712" onmouseenter="enter('7116239974974757712');" onmouseout="out('7116239974974757712');" style=""><abbr title=" 325      * @param inheritedFromType which type this should appear on. This would normally be SkuImpl.class, but if you want to"> 325      * @param inheritedFromType which type this should appear on. This would normally be SkuImpl.class, bðŸ”µ</abbr></span>
<span class="167462497314507165" onmouseenter="enter('167462497314507165');" onmouseout="out('167462497314507165');" style=""> 326      * display this field with a different entity then this should be that entity                        </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 327      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 328      */                                                                                                  </span>
<span class="-1192927872819846099" onmouseenter="enter('-1192927872819846099');" onmouseout="out('-1192927872819846099');" style=""> 329     public FieldMetadata createConsolidatedOptionField(Class&lt;?&gt; inheritedFromType) {                     </span>
<span class="-7895492162900601652" onmouseenter="enter('-7895492162900601652');" onmouseout="out('-7895492162900601652');" style=""> 330         BasicFieldMetadata metadata = new BasicFieldMetadata();                                          </span>
<span class="1112932430275912677" onmouseenter="enter('1112932430275912677');" onmouseout="out('1112932430275912677');" style=""> 331         metadata.setFieldType(SupportedFieldType.STRING);                                                </span>
<span class="6091769410078062740" onmouseenter="enter('6091769410078062740');" onmouseout="out('6091769410078062740');" style=""> 332         metadata.setMutable(false);                                                                      </span>
<span class="2561191544941929216" onmouseenter="enter('2561191544941929216');" onmouseout="out('2561191544941929216');" style=""> 333         metadata.setInheritedFromType(inheritedFromType.getName());                                      </span>
<span  style=""> 334                                                                                                          </span>
<span class="7921709413407422398" onmouseenter="enter('7921709413407422398');" onmouseout="out('7921709413407422398');" style=""><abbr title=" 335         metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCache()));"> 335         metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useðŸ”µ</abbr></span>
<span class="7303907294085574775" onmouseenter="enter('7303907294085574775');" onmouseout="out('7303907294085574775');" style=""> 336         metadata.setForeignKeyCollection(false);                                                         </span>
<span class="-1649079592520542152" onmouseenter="enter('-1649079592520542152');" onmouseout="out('-1649079592520542152');" style=""> 337         metadata.setMergedPropertyType(MergedPropertyType.PRIMARY);                                      </span>
<span  style=""> 338                                                                                                          </span>
<span class="6688700612838924202" onmouseenter="enter('6688700612838924202');" onmouseout="out('6688700612838924202');" style=""> 339         metadata.setName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                                       </span>
<span class="173658654284287974" onmouseenter="enter('173658654284287974');" onmouseout="out('173658654284287974');" style=""> 340         metadata.setFriendlyName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                               </span>
<span class="5589230730632374582" onmouseenter="enter('5589230730632374582');" onmouseout="out('5589230730632374582');" style=""> 341         metadata.setGroup(&quot;&quot;);                                                                           </span>
<span class="8683462265874380595" onmouseenter="enter('8683462265874380595');" onmouseout="out('8683462265874380595');" style=""> 342         metadata.setExplicitFieldType(SupportedFieldType.UNKNOWN);                                       </span>
<span class="-6445843447872579066" onmouseenter="enter('-6445843447872579066');" onmouseout="out('-6445843447872579066');" style=""> 343         metadata.setProminent(true);                                                                     </span>
<span class="-4820234772877671615" onmouseenter="enter('-4820234772877671615');" onmouseout="out('-4820234772877671615');" style=""> 344         metadata.setVisibility(VisibilityEnum.FORM_HIDDEN);                                              </span>
<span class="8945700141771923055" onmouseenter="enter('8945700141771923055');" onmouseout="out('8945700141771923055');" style=""> 345         metadata.setBroadleafEnumeration(&quot;&quot;);                                                            </span>
<span class="1775531838265915895" onmouseenter="enter('1775531838265915895');" onmouseout="out('1775531838265915895');" style=""> 346         metadata.setReadOnly(true);                                                                      </span>
<span class="-7171521581678886800" onmouseenter="enter('-7171521581678886800');" onmouseout="out('-7171521581678886800');" style=""> 347         metadata.setRequiredOverride(false);                                                             </span>
<span class="-4496921391259172818" onmouseenter="enter('-4496921391259172818');" onmouseout="out('-4496921391259172818');" style=""> 348         metadata.setGridOrder(Integer.MAX_VALUE);                                                        </span>
<span  style=""> 349                                                                                                          </span>
<span class="-6736542809122384852" onmouseenter="enter('-6736542809122384852');" onmouseout="out('-6736542809122384852');" style=""> 350         return metadata;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351     }                                                                                                    </span>
<span  style=""> 352                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 353     /**                                                                                                  </span>
<span class="-8205275851682999693" onmouseenter="enter('-8205275851682999693');" onmouseout="out('-8205275851682999693');" style=""><abbr title=" 354      * Returns a {@link Property} filled out with a delimited list of the &lt;b&gt;values&lt;/b&gt; that are passed in. This should be"> 354      * Returns a {@link Property} filled out with a delimited list of the &lt;b&gt;values&lt;/b&gt; that are passed iðŸ”µ</abbr></span>
<span class="-4713707283922918694" onmouseenter="enter('-4713707283922918694');" onmouseout="out('-4713707283922918694');" style=""> 355      * invoked on a fetch and the returned property should be added to the fetched {@link Entity} dto.   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 356      *                                                                                                   </span>
<span class="2073888098879145111" onmouseenter="enter('2073888098879145111');" onmouseout="out('2073888098879145111');" style=""> 357      * @param values                                                                                     </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 358      * @return                                                                                           </span>
<span class="3015934350861870420" onmouseenter="enter('3015934350861870420');" onmouseout="out('3015934350861870420');" style=""> 359      * @see {@link #createConsolidatedOptionField(Class)};                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 360      */                                                                                                  </span>
<span class="-4797739079142470258" onmouseenter="enter('-4797739079142470258');" onmouseout="out('-4797739079142470258');" style=""> 361     public Property getConsolidatedOptionProperty(Collection&lt;ProductOptionValue&gt; values) {               </span>
<span class="6856864467058713906" onmouseenter="enter('6856864467058713906');" onmouseout="out('6856864467058713906');" style=""> 362         Property optionValueProperty = new Property();                                                   </span>
<span class="6345005840174859359" onmouseenter="enter('6345005840174859359');" onmouseout="out('6345005840174859359');" style=""> 363         optionValueProperty.setName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                            </span>
<span  style=""> 364                                                                                                          </span>
<span class="4968742745228384146" onmouseenter="enter('4968742745228384146');" onmouseout="out('4968742745228384146');" style=""> 365         //order the values by the display order of their correspond product option                       </span>
<span class="-6409609658063536117" onmouseenter="enter('-6409609658063536117');" onmouseout="out('-6409609658063536117');" style=""> 366         //        Collections.sort(values, new Comparator&lt;ProductOptionValue&gt;() {                        </span>
<span class="-8064130612454474190" onmouseenter="enter('-8064130612454474190');" onmouseout="out('-8064130612454474190');" style=""> 367         //                                                                                               </span>
<span class="5501927314430930673" onmouseenter="enter('5501927314430930673');" onmouseout="out('5501927314430930673');" style=""> 368         //            @Override                                                                          </span>
<span class="9147587799683858413" onmouseenter="enter('9147587799683858413');" onmouseout="out('9147587799683858413');" style=""> 369         //            public int compare(ProductOptionValue value1, ProductOptionValue value2) {         </span>
<span class="368329491788158591" onmouseenter="enter('368329491788158591');" onmouseout="out('368329491788158591');" style=""><abbr title=" 370         //                return new CompareToBuilder().append(value1.getProductOption().getDisplayOrder(),"> 370         //                return new CompareToBuilder().append(value1.getProductOption().getDisplayOrder(ðŸ”µ</abbr></span>
<span class="8754156396924172260" onmouseenter="enter('8754156396924172260');" onmouseout="out('8754156396924172260');" style=""> 371         //                        value2.getProductOption().getDisplayOrder()).toComparison();           </span>
<span class="1818990376901269570" onmouseenter="enter('1818990376901269570');" onmouseout="out('1818990376901269570');" style=""> 372         //            }                                                                                  </span>
<span class="-1155227284920485909" onmouseenter="enter('-1155227284920485909');" onmouseout="out('-1155227284920485909');" style=""> 373         //        });                                                                                    </span>
<span  style=""> 374                                                                                                          </span>
<span class="-2061482055453175047" onmouseenter="enter('-2061482055453175047');" onmouseout="out('-2061482055453175047');" style=""> 375         ArrayList&lt;String&gt; stringValues = new ArrayList&lt;&gt;();                                              </span>
<span class="-7157508124377790495" onmouseenter="enter('-7157508124377790495');" onmouseout="out('-7157508124377790495');" style=""> 376         CollectionUtils.collect(values, new Transformer() {                                              </span>
<span  style=""> 377                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 378             @Override                                                                                    </span>
<span class="-2718541205900117239" onmouseenter="enter('-2718541205900117239');" onmouseout="out('-2718541205900117239');" style=""> 379             public Object transform(Object input) {                                                      </span>
<span class="-2749337455813426805" onmouseenter="enter('-2749337455813426805');" onmouseout="out('-2749337455813426805');" style=""> 380                 return ((ProductOptionValue) input).getAttributeValue();                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 381             }                                                                                            </span>
<span class="-236589394719861606" onmouseenter="enter('-236589394719861606');" onmouseout="out('-236589394719861606');" style=""> 382         }, stringValues);                                                                                </span>
<span  style=""> 383                                                                                                          </span>
<span class="-3159140932312278736" onmouseenter="enter('-3159140932312278736');" onmouseout="out('-3159140932312278736');" style=""><abbr title=" 384         optionValueProperty.setValue(StringUtils.join(stringValues, CONSOLIDATED_PRODUCT_OPTIONS_DELIMETER));"> 384         optionValueProperty.setValue(StringUtils.join(stringValues, CONSOLIDATED_PRODUCT_OPTIONS_DELIMETEðŸ”µ</abbr></span>
<span class="-6819592353936650784" onmouseenter="enter('-6819592353936650784');" onmouseout="out('-6819592353936650784');" style=""> 385         return optionValueProperty;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 386     }                                                                                                    </span>
<span  style=""> 387                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 388     /**                                                                                                  </span>
<span class="4216744498315651983" onmouseenter="enter('4216744498315651983');" onmouseout="out('4216744498315651983');" style=""> 389      * @return a blank {@link Property} corresponding to the CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 390      */                                                                                                  </span>
<span class="7598660974779837355" onmouseenter="enter('7598660974779837355');" onmouseout="out('7598660974779837355');" style=""> 391     public Property getBlankConsolidatedOptionProperty() {                                               </span>
<span class="6856864467058713906" onmouseenter="enter('6856864467058713906');" onmouseout="out('6856864467058713906');" style=""> 392         Property optionValueProperty = new Property();                                                   </span>
<span class="6345005840174859359" onmouseenter="enter('6345005840174859359');" onmouseout="out('6345005840174859359');" style=""> 393         optionValueProperty.setName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                            </span>
<span class="-7065335864511569913" onmouseenter="enter('-7065335864511569913');" onmouseout="out('-7065335864511569913');" style=""> 394         optionValueProperty.setValue(&quot;&quot;);                                                                </span>
<span class="-6819592353936650784" onmouseenter="enter('-6819592353936650784');" onmouseout="out('-6819592353936650784');" style=""> 395         return optionValueProperty;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 396     }                                                                                                    </span>
<span  style=""> 397                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 398     /**                                                                                                  </span>
<span class="6557988157037524501" onmouseenter="enter('6557988157037524501');" onmouseout="out('6557988157037524501');" style=""><abbr title=" 399      * &lt;p&gt;Creates an individual property for the specified product option. This should set up an enum field whose values will"> 399      * &lt;p&gt;Creates an individual property for the specified product option. This should set up an enum fieðŸ”µ</abbr></span>
<span class="5038223503928989560" onmouseenter="enter('5038223503928989560');" onmouseout="out('5038223503928989560');" style=""><abbr title=" 400      * be the option values for this option.  This is useful when you would like to display each product option in as its"> 400      * be the option values for this option.  This is useful when you would like to display each product ðŸ”µ</abbr></span>
<span class="9009411457822617231" onmouseenter="enter('9009411457822617231');" onmouseout="out('9009411457822617231');" style=""> 401      * own field in a grid so that you can further filter by product option values.&lt;/p&gt;                  </span>
<span class="-8656076573134722150" onmouseenter="enter('-8656076573134722150');" onmouseout="out('-8656076573134722150');" style=""><abbr title=" 402      * &lt;p&gt;In order for these fields to be utilized property on the fetch, in the GWT frontend you must use the"> 402      * &lt;p&gt;In order for these fields to be utilized property on the fetch, in the GWT frontend you must usðŸ”µ</abbr></span>
<span class="-3536572176551507765" onmouseenter="enter('-3536572176551507765');" onmouseout="out('-3536572176551507765');" style=""> 403      * for your datasource.&lt;/p&gt;                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 404      *                                                                                                   </span>
<span class="8674570395008402319" onmouseenter="enter('8674570395008402319');" onmouseout="out('8674570395008402319');" style=""> 405      * @param option                                                                                     </span>
<span class="6414796960983960786" onmouseenter="enter('6414796960983960786');" onmouseout="out('6414796960983960786');" style=""> 406      * @param order                                                                                      </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 407      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 408      */                                                                                                  </span>
<span class="8795563977758647136" onmouseenter="enter('8795563977758647136');" onmouseout="out('8795563977758647136');" style=""> 409     public FieldMetadata createIndividualOptionField(ProductOption option, int order) {                  </span>
<span class="7200486368414049440" onmouseenter="enter('7200486368414049440');" onmouseout="out('7200486368414049440');" style=""> 410         if (useToOneLookupSkuProductOptionValue) {                                                       </span>
<span class="-5634467253732639986" onmouseenter="enter('-5634467253732639986');" onmouseout="out('-5634467253732639986');" style=""> 411             return createToOneIndividualOptionField(option, order);                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 412         } else {                                                                                         </span>
<span class="7936034563418693343" onmouseenter="enter('7936034563418693343');" onmouseout="out('7936034563418693343');" style=""> 413             return createExplicitEnumerationIndividualOptionField(option, order);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 414         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415     }                                                                                                    </span>
<span  style=""> 416                                                                                                          </span>
<span class="-8892069303256438111" onmouseenter="enter('-8892069303256438111');" onmouseout="out('-8892069303256438111');" style=""><abbr title=" 417     protected FieldMetadata createExplicitEnumerationIndividualOptionField(ProductOption option, int order) {"> 417     protected FieldMetadata createExplicitEnumerationIndividualOptionField(ProductOption option, int ordeðŸ”µ</abbr></span>
<span class="-7895492162900601652" onmouseenter="enter('-7895492162900601652');" onmouseout="out('-7895492162900601652');" style=""> 418         BasicFieldMetadata metadata = new BasicFieldMetadata();                                          </span>
<span class="-2416891430670029479" onmouseenter="enter('-2416891430670029479');" onmouseout="out('-2416891430670029479');" style=""> 419         List&lt;ProductOptionValue&gt; allowedValues = option.getAllowedValues();                              </span>
<span class="9151233583168413632" onmouseenter="enter('9151233583168413632');" onmouseout="out('9151233583168413632');" style=""> 420         if (CollectionUtils.isNotEmpty(allowedValues)) {                                                 </span>
<span class="4285129340737600689" onmouseenter="enter('4285129340737600689');" onmouseout="out('4285129340737600689');" style=""> 421             metadata.setFieldType(SupportedFieldType.EXPLICIT_ENUMERATION);                              </span>
<span class="-6206284717251400514" onmouseenter="enter('-6206284717251400514');" onmouseout="out('-6206284717251400514');" style=""> 422             metadata.setMutable(true);                                                                   </span>
<span class="8194069883044431071" onmouseenter="enter('8194069883044431071');" onmouseout="out('8194069883044431071');" style=""> 423             metadata.setInheritedFromType(SkuImpl.class.getName());                                      </span>
<span class="7921709413407422398" onmouseenter="enter('7921709413407422398');" onmouseout="out('7921709413407422398');" style=""><abbr title=" 424             metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCache()));"> 424             metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheServiceðŸ”µ</abbr></span>
<span class="7303907294085574775" onmouseenter="enter('7303907294085574775');" onmouseout="out('7303907294085574775');" style=""> 425             metadata.setForeignKeyCollection(false);                                                     </span>
<span class="-1649079592520542152" onmouseenter="enter('-1649079592520542152');" onmouseout="out('-1649079592520542152');" style=""> 426             metadata.setMergedPropertyType(MergedPropertyType.PRIMARY);                                  </span>
<span  style=""> 427                                                                                                          </span>
<span class="-1089414754199454043" onmouseenter="enter('-1089414754199454043');" onmouseout="out('-1089414754199454043');" style=""> 428             //Set up the enumeration based on the product option values                                  </span>
<span class="-4938595371513432920" onmouseenter="enter('-4938595371513432920');" onmouseout="out('-4938595371513432920');" style=""> 429             String[][] optionValues = new String[allowedValues.size()][2];                               </span>
<span class="6205975934798560127" onmouseenter="enter('6205975934798560127');" onmouseout="out('6205975934798560127');" style=""> 430             for (int i = 0; i &lt; allowedValues.size(); i++) {                                             </span>
<span class="5655693563027021374" onmouseenter="enter('5655693563027021374');" onmouseout="out('5655693563027021374');" style=""> 431                 ProductOptionValue value = option.getAllowedValues().get(i);                             </span>
<span class="-6097967761511863324" onmouseenter="enter('-6097967761511863324');" onmouseout="out('-6097967761511863324');" style=""> 432                 optionValues[i][0] = value.getId().toString();                                           </span>
<span class="-2028520644986671717" onmouseenter="enter('-2028520644986671717');" onmouseout="out('-2028520644986671717');" style=""> 433                 optionValues[i][1] = value.getAttributeValue();                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 434             }                                                                                            </span>
<span class="8277090772710644263" onmouseenter="enter('8277090772710644263');" onmouseout="out('8277090772710644263');" style=""> 435             metadata.setEnumerationValues(optionValues);                                                 </span>
<span  style=""> 436                                                                                                          </span>
<span class="1748190162337854256" onmouseenter="enter('1748190162337854256');" onmouseout="out('1748190162337854256');" style=""> 437             metadata.setName(PRODUCT_OPTION_FIELD_PREFIX + option.getId());                              </span>
<span class="7017269500484793927" onmouseenter="enter('7017269500484793927');" onmouseout="out('7017269500484793927');" style=""> 438             metadata.setFriendlyName(option.getLabel());                                                 </span>
<span class="6085246036283927461" onmouseenter="enter('6085246036283927461');" onmouseout="out('6085246036283927461');" style=""> 439             metadata.setGroup(&quot;productOption_group&quot;);                                                    </span>
<span class="-8050220525630720562" onmouseenter="enter('-8050220525630720562');" onmouseout="out('-8050220525630720562');" style=""> 440             metadata.setGroupOrder(-1);                                                                  </span>
<span class="3406381469360124301" onmouseenter="enter('3406381469360124301');" onmouseout="out('3406381469360124301');" style=""> 441             metadata.setOrder(order);                                                                    </span>
<span class="8683462265874380595" onmouseenter="enter('8683462265874380595');" onmouseout="out('8683462265874380595');" style=""> 442             metadata.setExplicitFieldType(SupportedFieldType.UNKNOWN);                                   </span>
<span class="-6994608424159816416" onmouseenter="enter('-6994608424159816416');" onmouseout="out('-6994608424159816416');" style=""> 443             metadata.setProminent(false);                                                                </span>
<span class="6274758849936387106" onmouseenter="enter('6274758849936387106');" onmouseout="out('6274758849936387106');" style=""> 444             metadata.setVisibility(VisibilityEnum.FORM_EXPLICITLY_SHOWN);                                </span>
<span class="8945700141771923055" onmouseenter="enter('8945700141771923055');" onmouseout="out('8945700141771923055');" style=""> 445             metadata.setBroadleafEnumeration(&quot;&quot;);                                                        </span>
<span class="8076682597610338410" onmouseenter="enter('8076682597610338410');" onmouseout="out('8076682597610338410');" style=""> 446             metadata.setReadOnly(false);                                                                 </span>
<span class="2131936785391707598" onmouseenter="enter('2131936785391707598');" onmouseout="out('2131936785391707598');" style=""> 447             metadata.setRequiredOverride(BooleanUtils.isFalse(option.getRequired()));                    </span>
<span  style=""> 448                                                                                                          </span>
<span class="-6736542809122384852" onmouseenter="enter('-6736542809122384852');" onmouseout="out('-6736542809122384852');" style=""> 449             return metadata;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 450         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 451         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 452     }                                                                                                    </span>
<span  style=""> 453                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 454     /**                                                                                                  </span>
<span class="7683644189550699004" onmouseenter="enter('7683644189550699004');" onmouseout="out('7683644189550699004');" style=""><abbr title=" 455      * Using a ToOne lookup performs much better for large product option value lists, speeds up initial page load,"> 455      * Using a ToOne lookup performs much better for large product option value lists, speeds up initial ðŸ”µ</abbr></span>
<span class="-6062867542246075622" onmouseenter="enter('-6062867542246075622');" onmouseout="out('-6062867542246075622');" style=""><abbr title=" 456      * and is generally more accurate in relation to option value updates and how they impact available selections and cache."> 456      * and is generally more accurate in relation to option value updates and how they impact available sðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 457      *                                                                                                   </span>
<span class="8674570395008402319" onmouseenter="enter('8674570395008402319');" onmouseout="out('8674570395008402319');" style=""> 458      * @param option                                                                                     </span>
<span class="6414796960983960786" onmouseenter="enter('6414796960983960786');" onmouseout="out('6414796960983960786');" style=""> 459      * @param order                                                                                      </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 460      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 461      */                                                                                                  </span>
<span class="6879137344207562675" onmouseenter="enter('6879137344207562675');" onmouseout="out('6879137344207562675');" style=""> 462     protected FieldMetadata createToOneIndividualOptionField(ProductOption option, int order) {          </span>
<span class="-8449939433228375667" onmouseenter="enter('-8449939433228375667');" onmouseout="out('-8449939433228375667');" style=""> 463         PersistenceManager persistenceManager = PersistenceManagerFactory.getPersistenceManager();       </span>
<span class="-4187363957527008750" onmouseenter="enter('-4187363957527008750');" onmouseout="out('-4187363957527008750');" style=""> 464         FilterMapping filterMapping = new FilterMapping().withDirectFilterValues(                        </span>
<span class="-3894749102720902409" onmouseenter="enter('-3894749102720902409');" onmouseout="out('-3894749102720902409');" style=""><abbr title=" 465                 sandBoxHelper.mergeCloneIds(ProductOptionImpl.class, option.getId())).withRestriction(new Restriction()"> 465                 sandBoxHelper.mergeCloneIds(ProductOptionImpl.class, option.getId())).withRestriction(newðŸ”µ</abbr></span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 466             .withPredicateProvider(new PredicateProvider() {                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 467                 @Override                                                                                </span>
<span class="-5588636227064039300" onmouseenter="enter('-5588636227064039300');" onmouseout="out('-5588636227064039300');" style=""><abbr title=" 468                 public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder, From root,"> 468                 public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuildeðŸ”µ</abbr></span>
<span class="-2899522305959899483" onmouseenter="enter('-2899522305959899483');" onmouseout="out('-2899522305959899483');" style=""><abbr title=" 469                                                 String ceilingEntity, String fullPropertyName, Path explicitPath, List directValues) {"> 469                                                 String ceilingEntity, String fullPropertyName, Path expliðŸ”µ</abbr></span>
<span class="-933702984903214818" onmouseenter="enter('-933702984903214818');" onmouseout="out('-933702984903214818');" style=""> 470                     return root.get(&quot;productOption&quot;).get(&quot;id&quot;).in(directValues);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 471             }                                                                                            </span>
<span class="-800954676578401248" onmouseenter="enter('-800954676578401248');" onmouseout="out('-800954676578401248');" style=""> 472         }));                                                                                             </span>
<span class="9067714061330870114" onmouseenter="enter('9067714061330870114');" onmouseout="out('9067714061330870114');" style=""> 473         List&lt;FilterMapping&gt; mappings = new ArrayList&lt;&gt;();                                                </span>
<span class="345189471467363285" onmouseenter="enter('345189471467363285');" onmouseout="out('345189471467363285');" style=""> 474         mappings.add(filterMapping);                                                                     </span>
<span class="7291356103073076244" onmouseenter="enter('7291356103073076244');" onmouseout="out('7291356103073076244');" style=""><abbr title=" 475         TypedQuery&lt;Serializable&gt; countQuery = criteriaTranslator.translateCountQuery(persistenceManager.getDynamicEntityDao(),"> 475         TypedQuery&lt;Serializable&gt; countQuery = criteriaTranslator.translateCountQuery(persistenceManager.gðŸ”µ</abbr></span>
<span class="-6376296202628097343" onmouseenter="enter('-6376296202628097343');" onmouseout="out('-6376296202628097343');" style=""> 476                 ProductOptionValueImpl.class.getName(), mappings);                                       </span>
<span class="5779175921552777483" onmouseenter="enter('5779175921552777483');" onmouseout="out('5779175921552777483');" style=""> 477         Long count = (Long) countQuery.getSingleResult();                                                </span>
<span class="3590816377844072638" onmouseenter="enter('3590816377844072638');" onmouseout="out('3590816377844072638');" style=""> 478         BasicFieldMetadata metadata = null;                                                              </span>
<span class="7377439406723422491" onmouseenter="enter('7377439406723422491');" onmouseout="out('7377439406723422491');" style=""> 479         if (count &gt; 0) {                                                                                 </span>
<span class="-1273552772110171187" onmouseenter="enter('-1273552772110171187');" onmouseout="out('-1273552772110171187');" style=""> 480             metadata = new BasicFieldMetadata();                                                         </span>
<span class="7837199979125359629" onmouseenter="enter('7837199979125359629');" onmouseout="out('7837199979125359629');" style=""> 481             metadata.setFieldType(SupportedFieldType.ADDITIONAL_FOREIGN_KEY);                            </span>
<span class="-7466329847812031362" onmouseenter="enter('-7466329847812031362');" onmouseout="out('-7466329847812031362');" style=""> 482             metadata.setSecondaryType(SupportedFieldType.INTEGER);                                       </span>
<span class="-31286131392644862" onmouseenter="enter('-31286131392644862');" onmouseout="out('-31286131392644862');" style=""> 483             metadata.setForeignKeyProperty(&quot;id&quot;);                                                        </span>
<span class="332716961677554697" onmouseenter="enter('332716961677554697');" onmouseout="out('332716961677554697');" style=""> 484             metadata.setForeignKeyClass(ProductOptionValueImpl.class.getName());                         </span>
<span class="-4184418208857498113" onmouseenter="enter('-4184418208857498113');" onmouseout="out('-4184418208857498113');" style=""> 485             metadata.setForeignKeyDisplayValueProperty(&quot;attributeValue&quot;);                                </span>
<span class="4257701647031084459" onmouseenter="enter('4257701647031084459');" onmouseout="out('4257701647031084459');" style=""> 486             metadata.setLookupDisplayProperty(&quot;attributeValue&quot;);                                         </span>
<span class="7303907294085574775" onmouseenter="enter('7303907294085574775');" onmouseout="out('7303907294085574775');" style=""> 487             metadata.setForeignKeyCollection(false);                                                     </span>
<span class="6675602877003966627" onmouseenter="enter('6675602877003966627');" onmouseout="out('6675602877003966627');" style=""> 488             metadata.setCustomCriteria(new String[]{&quot;option=&quot; + String.valueOf(option.getId())});        </span>
<span class="1748190162337854256" onmouseenter="enter('1748190162337854256');" onmouseout="out('1748190162337854256');" style=""> 489             metadata.setName(PRODUCT_OPTION_FIELD_PREFIX + option.getId());                              </span>
<span class="7017269500484793927" onmouseenter="enter('7017269500484793927');" onmouseout="out('7017269500484793927');" style=""> 490             metadata.setFriendlyName(option.getLabel());                                                 </span>
<span class="6085246036283927461" onmouseenter="enter('6085246036283927461');" onmouseout="out('6085246036283927461');" style=""> 491             metadata.setGroup(&quot;productOption_group&quot;);                                                    </span>
<span class="-8050220525630720562" onmouseenter="enter('-8050220525630720562');" onmouseout="out('-8050220525630720562');" style=""> 492             metadata.setGroupOrder(-1);                                                                  </span>
<span class="3406381469360124301" onmouseenter="enter('3406381469360124301');" onmouseout="out('3406381469360124301');" style=""> 493             metadata.setOrder(order);                                                                    </span>
<span class="2043314380305444305" onmouseenter="enter('2043314380305444305');" onmouseout="out('2043314380305444305');" style=""> 494             metadata.setExplicitFieldType(SupportedFieldType.ADDITIONAL_FOREIGN_KEY);                    </span>
<span class="-6994608424159816416" onmouseenter="enter('-6994608424159816416');" onmouseout="out('-6994608424159816416');" style=""> 495             metadata.setProminent(false);                                                                </span>
<span class="6274758849936387106" onmouseenter="enter('6274758849936387106');" onmouseout="out('6274758849936387106');" style=""> 496             metadata.setVisibility(VisibilityEnum.FORM_EXPLICITLY_SHOWN);                                </span>
<span class="8076682597610338410" onmouseenter="enter('8076682597610338410');" onmouseout="out('8076682597610338410');" style=""> 497             metadata.setReadOnly(false);                                                                 </span>
<span class="-4603246565563510167" onmouseenter="enter('-4603246565563510167');" onmouseout="out('-4603246565563510167');" style=""><abbr title=" 498             //these may not be actually required, but the CPH has this as a requirement for parsing the data, so we&#x27;ll stick with it here"> 498             //these may not be actually required, but the CPH has this as a requirement for parsing the dðŸ”µ</abbr></span>
<span class="6102752219358130186" onmouseenter="enter('6102752219358130186');" onmouseout="out('6102752219358130186');" style=""> 499             metadata.setRequiredOverride(true);                                                          </span>
<span class="-3053289446243924099" onmouseenter="enter('-3053289446243924099');" onmouseout="out('-3053289446243924099');" style=""> 500             metadata.setLookupType(LookupType.STANDARD);                                                 </span>
<span class="-6206284717251400514" onmouseenter="enter('-6206284717251400514');" onmouseout="out('-6206284717251400514');" style=""> 501             metadata.setMutable(true);                                                                   </span>
<span class="8194069883044431071" onmouseenter="enter('8194069883044431071');" onmouseout="out('8194069883044431071');" style=""> 502             metadata.setInheritedFromType(SkuImpl.class.getName());                                      </span>
<span class="7921709413407422398" onmouseenter="enter('7921709413407422398');" onmouseout="out('7921709413407422398');" style=""><abbr title=" 503             metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCache()));"> 503             metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheServiceðŸ”µ</abbr></span>
<span class="-1649079592520542152" onmouseenter="enter('-1649079592520542152');" onmouseout="out('-1649079592520542152');" style=""> 504             metadata.setMergedPropertyType(MergedPropertyType.PRIMARY);                                  </span>
<span class="5062289219461079509" onmouseenter="enter('5062289219461079509');" onmouseout="out('5062289219461079509');" style=""> 505             metadata.setTargetClass(SkuImpl.class.getName());                                            </span>
<span class="-6501495819508426588" onmouseenter="enter('-6501495819508426588');" onmouseout="out('-6501495819508426588');" style=""> 506             metadata.setFieldName(PRODUCT_OPTION_FIELD_PREFIX + option.getId());                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 507         }                                                                                                </span>
<span class="-6736542809122384852" onmouseenter="enter('-6736542809122384852');" onmouseout="out('-6736542809122384852');" style=""> 508         return metadata;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 509     }                                                                                                    </span>
<span  style=""> 510                                                                                                          </span>
<span class="7948482626287429940" onmouseenter="enter('7948482626287429940');" onmouseout="out('7948482626287429940');" style=""> 511     @SuppressWarnings(&quot;unchecked&quot;)                                                                       </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 512     @Override                                                                                            </span>
<span class="-1282377985319068039" onmouseenter="enter('-1282377985319068039');" onmouseout="out('-1282377985319068039');" style=""><abbr title=" 513     public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 513     public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynaðŸ”µ</abbr></span>
<span class="2519389108374285224" onmouseenter="enter('2519389108374285224');" onmouseout="out('2519389108374285224');" style=""><abbr title=" 514         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname();"> 514         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 515         try {                                                                                            </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""><abbr title=" 516             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();"> 516             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective(ðŸ”µ</abbr></span>
<span class="-4474933170501730421" onmouseenter="enter('-4474933170501730421');" onmouseout="out('-4474933170501730421');" style=""> 517             //get the default properties from Sku and its subclasses                                     </span>
<span class="-1647605982225346371" onmouseenter="enter('-1647605982225346371');" onmouseout="out('-1647605982225346371');" style=""><abbr title=" 518             Map&lt;String, FieldMetadata&gt; originalProps = helper.getSimpleMergedProperties(Sku.class.getName(), persistencePerspective);"> 518             Map&lt;String, FieldMetadata&gt; originalProps = helper.getSimpleMergedProperties(Sku.class.getNameðŸ”µ</abbr></span>
<span  style=""> 519                                                                                                          </span>
<span class="796362017556902885" onmouseenter="enter('796362017556902885');" onmouseout="out('796362017556902885');" style=""> 520             //Pull back the Skus based on the criteria from the client                                   </span>
<span class="-363648758652557915" onmouseenter="enter('-363648758652557915');" onmouseout="out('-363648758652557915');" style=""><abbr title=" 521             List&lt;FilterMapping&gt; filterMappings = helper.getFilterMappings(persistencePerspective, cto, ceilingEntityFullyQualifiedClassname, originalProps);"> 521             List&lt;FilterMapping&gt; filterMappings = helper.getFilterMappings(persistencePerspective, cto, ceðŸ”µ</abbr></span>
<span  style=""> 522                                                                                                          </span>
<span class="-3675685187725351740" onmouseenter="enter('-3675685187725351740');" onmouseout="out('-3675685187725351740');" style=""> 523             //allow subclasses to provide additional criteria before executing the query                 </span>
<span class="-7008588708271197253" onmouseenter="enter('-7008588708271197253');" onmouseout="out('-7008588708271197253');" style=""> 524             applyProductOptionValueCriteria(filterMappings, cto, persistencePackage, null);              </span>
<span class="4646076149717404025" onmouseenter="enter('4646076149717404025');" onmouseout="out('4646076149717404025');" style=""> 525             applySkuBundleItemValueCriteria(filterMappings, cto, persistencePackage);                    </span>
<span class="-2737785807325266" onmouseenter="enter('-2737785807325266');" onmouseout="out('-2737785807325266');" style=""> 526             applyAdditionalFetchCriteria(filterMappings, cto, persistencePackage);                       </span>
<span  style=""> 527                                                                                                          </span>
<span class="-4634567455719757558" onmouseenter="enter('-4634567455719757558');" onmouseout="out('-4634567455719757558');" style=""><abbr title=" 528             List&lt;Serializable&gt; records = helper.getPersistentRecords(persistencePackage.getCeilingEntityFullyQualifiedClassname(), filterMappings, cto.getFirstResult(), cto.getMaxResults());"> 528             List&lt;Serializable&gt; records = helper.getPersistentRecords(persistencePackage.getCeilingEntityFðŸ”µ</abbr></span>
<span class="-5982273033000910285" onmouseenter="enter('-5982273033000910285');" onmouseout="out('-5982273033000910285');" style=""> 529             //Convert Skus into the client-side Entity representation                                    </span>
<span class="-2996861390233909505" onmouseenter="enter('-2996861390233909505');" onmouseout="out('-2996861390233909505');" style=""> 530             Entity[] payload = helper.getRecords(originalProps, records);                                </span>
<span  style=""> 531                                                                                                          </span>
<span class="-4184869795171170066" onmouseenter="enter('-4184869795171170066');" onmouseout="out('-4184869795171170066');" style=""><abbr title=" 532             int totalRecords = helper.getTotalRecords(persistencePackage.getCeilingEntityFullyQualifiedClassname(), filterMappings);"> 532             int totalRecords = helper.getTotalRecords(persistencePackage.getCeilingEntityFullyQualifiedClðŸ”µ</abbr></span>
<span  style=""> 533                                                                                                          </span>
<span class="-3763055148335758582" onmouseenter="enter('-3763055148335758582');" onmouseout="out('-3763055148335758582');" style=""><abbr title=" 534             //Now fill out the relevant properties for the product options for the Skus that were returned"> 534             //Now fill out the relevant properties for the product options for the Skus that were returneðŸ”µ</abbr></span>
<span class="7697812602397668509" onmouseenter="enter('7697812602397668509');" onmouseout="out('7697812602397668509');" style=""> 535             updateProductOptionFieldsForFetch(records, payload);                                         </span>
<span  style=""> 536                                                                                                          </span>
<span class="-8933105127068001704" onmouseenter="enter('-8933105127068001704');" onmouseout="out('-8933105127068001704');" style=""> 537             return new DynamicResultSet(payload, totalRecords);                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 538         } catch (Exception e) {                                                                          </span>
<span class="733531699862187915" onmouseenter="enter('733531699862187915');" onmouseout="out('733531699862187915');" style=""><abbr title=" 539             throw new ServiceException(&quot;Unable to perform fetch for entity: &quot; + ceilingEntityFullyQualifiedClassname, e);"> 539             throw new ServiceException(&quot;Unable to perform fetch for entity: &quot; + ceilingEntityFullyQualifiðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 540         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 541     }                                                                                                    </span>
<span  style=""> 542                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 543     /**                                                                                                  </span>
<span class="-7824652902262605659" onmouseenter="enter('-7824652902262605659');" onmouseout="out('-7824652902262605659');" style=""><abbr title=" 544      * Sets the {@link ProductOptionValue}s of the given {@link Sku}s in a list format for display in a ListGrid context."> 544      * Sets the {@link ProductOptionValue}s of the given {@link Sku}s in a list format for display in a LðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 545      *                                                                                                   </span>
<span class="-4052130305078083276" onmouseenter="enter('-4052130305078083276');" onmouseout="out('-4052130305078083276');" style=""> 546      * @param records                                                                                    </span>
<span class="-6904460697287898969" onmouseenter="enter('-6904460697287898969');" onmouseout="out('-6904460697287898969');" style=""> 547      * @param payload                                                                                    </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 548      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 549      */                                                                                                  </span>
<span class="3124517244149022485" onmouseenter="enter('3124517244149022485');" onmouseout="out('3124517244149022485');" style=""> 550     public void updateProductOptionFieldsForFetch(List&lt;Serializable&gt; records, Entity[] payload) {        </span>
<span class="-7972041122971845939" onmouseenter="enter('-7972041122971845939');" onmouseout="out('-7972041122971845939');" style=""> 551         for (int i = 0; i &lt; records.size(); i++) {                                                       </span>
<span class="-3191004483130397206" onmouseenter="enter('-3191004483130397206');" onmouseout="out('-3191004483130397206');" style=""> 552             Sku sku = (Sku) records.get(i);                                                              </span>
<span class="6067761635845867397" onmouseenter="enter('6067761635845867397');" onmouseout="out('6067761635845867397');" style=""> 553             Entity entity = payload[i];                                                                  </span>
<span  style=""> 554                                                                                                          </span>
<span class="-1747148511640135280" onmouseenter="enter('-1747148511640135280');" onmouseout="out('-1747148511640135280');" style=""><abbr title=" 555             List&lt;ProductOptionValue&gt; optionValues = BLCCollectionUtils.collectList(sku.getProductOptionValueXrefs(), new TypedTransformer&lt;ProductOptionValue&gt;() {"> 555             List&lt;ProductOptionValue&gt; optionValues = BLCCollectionUtils.collectList(sku.getProductOptionVaðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 556                 @Override                                                                                </span>
<span class="1152092933178682803" onmouseenter="enter('1152092933178682803');" onmouseout="out('1152092933178682803');" style=""> 557                 public ProductOptionValue transform(Object input) {                                      </span>
<span class="-8868352318711405431" onmouseenter="enter('-8868352318711405431');" onmouseout="out('-8868352318711405431');" style=""> 558                     return ((SkuProductOptionValueXref) input).getProductOptionValue();                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 559                 }                                                                                        </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 560             });                                                                                          </span>
<span  style=""> 561                                                                                                          </span>
<span class="-1852425527821468846" onmouseenter="enter('-1852425527821468846');" onmouseout="out('-1852425527821468846');" style=""> 562             for (ProductOptionValue value : optionValues) {                                              </span>
<span class="6080984475054679236" onmouseenter="enter('6080984475054679236');" onmouseout="out('6080984475054679236');" style=""> 563                 Property optionProperty = new Property();                                                </span>
<span class="4438211203610377533" onmouseenter="enter('4438211203610377533');" onmouseout="out('4438211203610377533');" style=""> 564                 optionProperty.setName(PRODUCT_OPTION_FIELD_PREFIX + value.getProductOption().getId());  </span>
<span class="-3040338369255071721" onmouseenter="enter('-3040338369255071721');" onmouseout="out('-3040338369255071721');" style=""> 565                 optionProperty.setValue(value.getId().toString());                                       </span>
<span class="4260727162498882307" onmouseenter="enter('4260727162498882307');" onmouseout="out('4260727162498882307');" style=""> 566                 optionProperty.setDisplayValue(value.getAttributeValue());                               </span>
<span class="1859377182209271680" onmouseenter="enter('1859377182209271680');" onmouseout="out('1859377182209271680');" style=""> 567                 entity.addProperty(optionProperty);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 568             }                                                                                            </span>
<span  style=""> 569                                                                                                          </span>
<span class="4597418554840578281" onmouseenter="enter('4597418554840578281');" onmouseout="out('4597418554840578281');" style=""> 570             if (CollectionUtils.isNotEmpty(optionValues)) {                                              </span>
<span class="5213586233451889239" onmouseenter="enter('5213586233451889239');" onmouseout="out('5213586233451889239');" style=""> 571                 entity.addProperty(getConsolidatedOptionProperty(optionValues));                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 572             } else {                                                                                     </span>
<span class="-6341791635059832722" onmouseenter="enter('-6341791635059832722');" onmouseout="out('-6341791635059832722');" style=""> 573                 entity.addProperty(getBlankConsolidatedOptionProperty());                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 574             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 575         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 576     }                                                                                                    </span>
<span  style=""> 577                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 578     /**                                                                                                  </span>
<span class="7787882510504443634" onmouseenter="enter('7787882510504443634');" onmouseout="out('7787882510504443634');" style=""><abbr title=" 579      * Add filter restriction such that a ProductBundle cannot add its own default sku as a Sku Bundle Item"> 579      * Add filter restriction such that a ProductBundle cannot add its own default sku as a Sku Bundle ItðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 580      */                                                                                                  </span>
<span class="-7214039343588646460" onmouseenter="enter('-7214039343588646460');" onmouseout="out('-7214039343588646460');" style=""><abbr title=" 581     private void applySkuBundleItemValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PersistencePackage persistencePackage) {"> 581     private void applySkuBundleItemValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObjeðŸ”µ</abbr></span>
<span class="-8187222964943103604" onmouseenter="enter('-8187222964943103604');" onmouseout="out('-8187222964943103604');" style=""> 582         SectionCrumb[] sectionCrumbs = persistencePackage.getSectionCrumbs();                            </span>
<span class="-1899330423728999759" onmouseenter="enter('-1899330423728999759');" onmouseout="out('-1899330423728999759');" style=""> 583         if (isSkuBundleItemLookup(persistencePackage, sectionCrumbs)) {                                  </span>
<span class="8268114114086125791" onmouseenter="enter('8268114114086125791');" onmouseout="out('8268114114086125791');" style=""> 584             final Long defaultSkuId = getOwningProductBundlesDefaultSkuId(sectionCrumbs[0]);             </span>
<span  style=""> 585                                                                                                          </span>
<span class="8197169377808819118" onmouseenter="enter('8197169377808819118');" onmouseout="out('8197169377808819118');" style=""> 586             filterMappings.add(new FilterMapping()                                                       </span>
<span class="-2686901866072439951" onmouseenter="enter('-2686901866072439951');" onmouseout="out('-2686901866072439951');" style=""> 587                     .withDirectFilterValues(Collections.singletonList(defaultSkuId))                     </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 588                     .withRestriction(new Restriction()                                                   </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 589                                     .withPredicateProvider(new PredicateProvider() {                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 590                                         @Override                                                        </span>
<span class="-6543887403560352788" onmouseenter="enter('-6543887403560352788');" onmouseout="out('-6543887403560352788');" style=""> 591                                         public Predicate buildPredicate(CriteriaBuilder builder,         </span>
<span class="-7125560532692692259" onmouseenter="enter('-7125560532692692259');" onmouseout="out('-7125560532692692259');" style=""> 592                                                 FieldPathBuilder fieldPathBuilder,                       </span>
<span class="8221798817053541417" onmouseenter="enter('8221798817053541417');" onmouseout="out('8221798817053541417');" style=""> 593                                                 From root, String ceilingEntity,                         </span>
<span class="-5624751861859036647" onmouseenter="enter('-5624751861859036647');" onmouseout="out('-5624751861859036647');" style=""> 594                                                 String fullPropertyName, Path explicitPath,              </span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style=""> 595                                                 List directValues) {                                     </span>
<span class="4460015033870714518" onmouseenter="enter('4460015033870714518');" onmouseout="out('4460015033870714518');" style=""> 596                                             return builder.notEqual(root, directValues.get(0));          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 597                                         }                                                                </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 598                                     })                                                                   </span>
<span class="3699784701886273761" onmouseenter="enter('3699784701886273761');" onmouseout="out('3699784701886273761');" style=""> 599                     ));                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 600         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 601     }                                                                                                    </span>
<span  style=""> 602                                                                                                          </span>
<span class="-2798114006144580065" onmouseenter="enter('-2798114006144580065');" onmouseout="out('-2798114006144580065');" style=""> 603     private boolean isSkuBundleItemLookup(PersistencePackage pkg, SectionCrumb[] sectionCrumbs) {        </span>
<span class="1586917148156434191" onmouseenter="enter('1586917148156434191');" onmouseout="out('1586917148156434191');" style=""> 604         boolean owningClassMatch = false;                                                                </span>
<span class="-67344974392233049" onmouseenter="enter('-67344974392233049');" onmouseout="out('-67344974392233049');" style=""> 605         boolean requestingFieldMatch = false;                                                            </span>
<span  style=""> 606                                                                                                          </span>
<span class="-4586108065315097422" onmouseenter="enter('-4586108065315097422');" onmouseout="out('-4586108065315097422');" style=""> 607         if (pkg.getCustomCriteria() == null || ArrayUtils.isEmpty(sectionCrumbs)) {                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 608             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 609         }                                                                                                </span>
<span  style=""> 610                                                                                                          </span>
<span class="-2549092676085499199" onmouseenter="enter('-2549092676085499199');" onmouseout="out('-2549092676085499199');" style=""> 611         for (String criteria : pkg.getCustomCriteria()) {                                                </span>
<span class="-2108620833305617258" onmouseenter="enter('-2108620833305617258');" onmouseout="out('-2108620833305617258');" style=""><abbr title=" 612             if (&quot;owningClass=org.broadleafcommerce.core.catalog.domain.SkuBundleItemImpl&quot;.equals(criteria)) {"> 612             if (&quot;owningClass=org.broadleafcommerce.core.catalog.domain.SkuBundleItemImpl&quot;.equals(criteriaðŸ”µ</abbr></span>
<span class="8041666773318789268" onmouseenter="enter('8041666773318789268');" onmouseout="out('8041666773318789268');" style=""> 613                 owningClassMatch = true;                                                                 </span>
<span class="4858029770045852471" onmouseenter="enter('4858029770045852471');" onmouseout="out('4858029770045852471');" style=""> 614             } else if (&quot;requestingField=sku&quot;.equals(criteria)) {                                         </span>
<span class="-1860793199325339033" onmouseenter="enter('-1860793199325339033');" onmouseout="out('-1860793199325339033');" style=""> 615                 requestingFieldMatch = true;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 616             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 617         }                                                                                                </span>
<span  style=""> 618                                                                                                          </span>
<span class="-3217646211476483325" onmouseenter="enter('-3217646211476483325');" onmouseout="out('-3217646211476483325');" style=""><abbr title=" 619         boolean sectionCrumbMatch = ProductImpl.class.getCanonicalName().equals(sectionCrumbs[0].getSectionIdentifier());"> 619         boolean sectionCrumbMatch = ProductImpl.class.getCanonicalName().equals(sectionCrumbs[0].getSectiðŸ”µ</abbr></span>
<span  style=""> 620                                                                                                          </span>
<span class="6240774352197414719" onmouseenter="enter('6240774352197414719');" onmouseout="out('6240774352197414719');" style=""> 621         return owningClassMatch &amp;&amp; requestingFieldMatch &amp;&amp; sectionCrumbMatch;                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 622     }                                                                                                    </span>
<span  style=""> 623                                                                                                          </span>
<span class="-1671571892486457707" onmouseenter="enter('-1671571892486457707');" onmouseout="out('-1671571892486457707');" style=""> 624     private Long getOwningProductBundlesDefaultSkuId(SectionCrumb sectionCrumb) {                        </span>
<span class="2328697212854986127" onmouseenter="enter('2328697212854986127');" onmouseout="out('2328697212854986127');" style=""> 625         if (ProductImpl.class.getCanonicalName().equals(sectionCrumb.getSectionIdentifier())             </span>
<span class="-9004648441586212047" onmouseenter="enter('-9004648441586212047');" onmouseout="out('-9004648441586212047');" style=""> 626                 &amp;&amp; sectionCrumb.getSectionId() != null) {                                                </span>
<span class="4513323716586759964" onmouseenter="enter('4513323716586759964');" onmouseout="out('4513323716586759964');" style=""><abbr title=" 627             ProductBundle productBundle = (ProductBundle) catalogService.findProductById(Long.valueOf(sectionCrumb.getSectionId()));"> 627             ProductBundle productBundle = (ProductBundle) catalogService.findProductById(Long.valueOf(secðŸ”µ</abbr></span>
<span class="4400035530065637673" onmouseenter="enter('4400035530065637673');" onmouseout="out('4400035530065637673');" style=""> 628             return productBundle.getDefaultSku().getId();                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 629         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 630         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 631     }                                                                                                    </span>
<span  style=""> 632                                                                                                          </span>
<span class="-7687230963098454148" onmouseenter="enter('-7687230963098454148');" onmouseout="out('-7687230963098454148');" style=""><abbr title=" 633     public void applyProductOptionValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PersistencePackage persistencePackage, String skuPropertyPrefix) {"> 633     public void applyProductOptionValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObjecðŸ”µ</abbr></span>
<span  style=""> 634                                                                                                          </span>
<span class="942620444934049587" onmouseenter="enter('942620444934049587');" onmouseout="out('942620444934049587');" style=""> 635         //if the front                                                                                   </span>
<span class="8112796229062982729" onmouseenter="enter('8112796229062982729');" onmouseout="out('8112796229062982729');" style=""> 636         final List&lt;Long&gt; productOptionValueFilterIDs = new ArrayList&lt;&gt;();                                </span>
<span class="-6853245302921753815" onmouseenter="enter('-6853245302921753815');" onmouseout="out('-6853245302921753815');" style=""> 637         for (String filterProperty : cto.getCriteriaMap().keySet()) {                                    </span>
<span class="-4107857553734806058" onmouseenter="enter('-4107857553734806058');" onmouseout="out('-4107857553734806058');" style=""> 638             if (filterProperty.startsWith(PRODUCT_OPTION_FIELD_PREFIX)) {                                </span>
<span class="-1621748473978415179" onmouseenter="enter('-1621748473978415179');" onmouseout="out('-1621748473978415179');" style=""> 639                 FilterAndSortCriteria criteria = cto.get(filterProperty);                                </span>
<span class="5553495253525789791" onmouseenter="enter('5553495253525789791');" onmouseout="out('5553495253525789791');" style=""> 640                 productOptionValueFilterIDs.add(Long.parseLong(criteria.getFilterValues().get(0)));      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 641             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 642         }                                                                                                </span>
<span  style=""> 643                                                                                                          </span>
<span class="4522856558687017152" onmouseenter="enter('4522856558687017152');" onmouseout="out('4522856558687017152');" style=""> 644         //also determine if there is a consolidated POV query                                            </span>
<span class="-8501099544391483771" onmouseenter="enter('-8501099544391483771');" onmouseout="out('-8501099544391483771');" style=""> 645         final List&lt;String&gt; productOptionValueFilterValues = new ArrayList&lt;&gt;();                           </span>
<span class="-3774683769233331029" onmouseenter="enter('-3774683769233331029');" onmouseout="out('-3774683769233331029');" style=""> 646         FilterAndSortCriteria consolidatedCriteria = cto.get(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);   </span>
<span class="3919937138964866453" onmouseenter="enter('3919937138964866453');" onmouseout="out('3919937138964866453');" style=""> 647         if (!consolidatedCriteria.getFilterValues().isEmpty()) {                                         </span>
<span class="-8697432381506519263" onmouseenter="enter('-8697432381506519263');" onmouseout="out('-8697432381506519263');" style=""> 648             //the criteria in this case would be a semi-colon delimeter value list                       </span>
<span class="-2544935018250883467" onmouseenter="enter('-2544935018250883467');" onmouseout="out('-2544935018250883467');" style=""><abbr title=" 649             productOptionValueFilterValues.addAll(Arrays.asList(StringUtils.split(consolidatedCriteria.getFilterValues().get(0), CONSOLIDATED_PRODUCT_OPTIONS_DELIMETER)));"> 649             productOptionValueFilterValues.addAll(Arrays.asList(StringUtils.split(consolidatedCriteria.geðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 650         }                                                                                                </span>
<span  style=""> 651                                                                                                          </span>
<span class="-3296023389552605288" onmouseenter="enter('-3296023389552605288');" onmouseout="out('-3296023389552605288');" style=""> 652         if (productOptionValueFilterIDs.size() &gt; 0) {                                                    </span>
<span class="-3028331070500986006" onmouseenter="enter('-3028331070500986006');" onmouseout="out('-3028331070500986006');" style=""> 653             FilterMapping filterMapping = new FilterMapping()                                            </span>
<span class="3198376136531373476" onmouseenter="enter('3198376136531373476');" onmouseout="out('3198376136531373476');" style=""><abbr title=" 654                 .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?&quot;&quot;:skuPropertyPrefix + &quot;.productOptionValueXrefs.productOptionValue.id&quot;))"> 654                 .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?ðŸ”µ</abbr></span>
<span class="-3630476675353547213" onmouseenter="enter('-3630476675353547213');" onmouseout="out('-3630476675353547213');" style=""> 655                 .withDirectFilterValues(productOptionValueFilterIDs)                                     </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 656                 .withRestriction(new Restriction()                                                       </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 657                     .withPredicateProvider(new PredicateProvider() {                                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 658                         @Override                                                                        </span>
<span class="-33431144742852463" onmouseenter="enter('-33431144742852463');" onmouseout="out('-33431144742852463');" style=""><abbr title=" 659                         public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,"> 659                         public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPaðŸ”µ</abbr></span>
<span class="8221798817053541417" onmouseenter="enter('8221798817053541417');" onmouseout="out('8221798817053541417');" style=""> 660                                                         From root, String ceilingEntity,                 </span>
<span class="-6963673837518342908" onmouseenter="enter('-6963673837518342908');" onmouseout="out('-6963673837518342908');" style=""><abbr title=" 661                                                         String fullPropertyName, Path explicitPath, List directValues) {"> 661                                                         String fullPropertyName, Path explicitPath, List ðŸ”µ</abbr></span>
<span class="-6719486958351285112" onmouseenter="enter('-6719486958351285112');" onmouseout="out('-6719486958351285112');" style=""> 662                             return explicitPath.as(Long.class).in(directValues);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 663                         }                                                                                </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 664                     })                                                                                   </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 665                 );                                                                                       </span>
<span class="-2605411155138525883" onmouseenter="enter('-2605411155138525883');" onmouseout="out('-2605411155138525883');" style=""> 666             filterMappings.add(filterMapping);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 667         }                                                                                                </span>
<span class="36743717647982951" onmouseenter="enter('36743717647982951');" onmouseout="out('36743717647982951');" style=""> 668         if (productOptionValueFilterValues.size() &gt; 0) {                                                 </span>
<span class="-3028331070500986006" onmouseenter="enter('-3028331070500986006');" onmouseout="out('-3028331070500986006');" style=""> 669             FilterMapping filterMapping = new FilterMapping()                                            </span>
<span class="8503258665314341487" onmouseenter="enter('8503258665314341487');" onmouseout="out('8503258665314341487');" style=""><abbr title=" 670                 .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?&quot;&quot;:skuPropertyPrefix + &quot;.productOptionValueXrefs.productOptionValue.attributeValue&quot;))"> 670                 .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?ðŸ”µ</abbr></span>
<span class="-7312773306171765245" onmouseenter="enter('-7312773306171765245');" onmouseout="out('-7312773306171765245');" style=""> 671                 .withDirectFilterValues(productOptionValueFilterValues)                                  </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 672                 .withRestriction(new Restriction()                                                       </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 673                     .withPredicateProvider(new PredicateProvider() {                                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 674                         @Override                                                                        </span>
<span class="-33431144742852463" onmouseenter="enter('-33431144742852463');" onmouseout="out('-33431144742852463');" style=""><abbr title=" 675                         public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,"> 675                         public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPaðŸ”µ</abbr></span>
<span class="8221798817053541417" onmouseenter="enter('8221798817053541417');" onmouseout="out('8221798817053541417');" style=""> 676                                                         From root, String ceilingEntity,                 </span>
<span class="-6963673837518342908" onmouseenter="enter('-6963673837518342908');" onmouseout="out('-6963673837518342908');" style=""><abbr title=" 677                                                         String fullPropertyName, Path explicitPath, List directValues) {"> 677                                                         String fullPropertyName, Path explicitPath, List ðŸ”µ</abbr></span>
<span class="-2981715763030013918" onmouseenter="enter('-2981715763030013918');" onmouseout="out('-2981715763030013918');" style=""> 678                             return explicitPath.as(String.class).in(directValues);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 679                         }                                                                                </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 680                     })                                                                                   </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 681                 );                                                                                       </span>
<span class="-2605411155138525883" onmouseenter="enter('-2605411155138525883');" onmouseout="out('-2605411155138525883');" style=""> 682             filterMappings.add(filterMapping);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 683         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 684     }                                                                                                    </span>
<span  style=""> 685                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 686     /**                                                                                                  </span>
<span class="-8618302828054746698" onmouseenter="enter('-8618302828054746698');" onmouseout="out('-8618302828054746698');" style=""><abbr title=" 687      * &lt;p&gt;Available override point for subclasses if they would like to add additional criteria via the queryCritiera. At the"> 687      * &lt;p&gt;Available override point for subclasses if they would like to add additional criteria via the qðŸ”µ</abbr></span>
<span class="5710282049517599386" onmouseenter="enter('5710282049517599386');" onmouseout="out('5710282049517599386');" style=""><abbr title=" 688      * point that this method has been called, criteria from the frontend has already been applied, thus allowing you to"> 688      * point that this method has been called, criteria from the frontend has already been applied, thus ðŸ”µ</abbr></span>
<span class="-8977449216901818262" onmouseenter="enter('-8977449216901818262');" onmouseout="out('-8977449216901818262');" style=""> 689      * override from there as well.&lt;/p&gt;                                                                  </span>
<span class="6192892703049124137" onmouseenter="enter('6192892703049124137');" onmouseout="out('6192892703049124137');" style=""><abbr title=" 690      * &lt;p&gt;Subclasses that choose to override this should also call this super method so that correct filter criteria"> 690      * &lt;p&gt;Subclasses that choose to override this should also call this super method so that correct filtðŸ”µ</abbr></span>
<span class="4504111184556558489" onmouseenter="enter('4504111184556558489');" onmouseout="out('4504111184556558489');" style=""> 691      * can be applied for product option values&lt;/p&gt;                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 692      *                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 693      */                                                                                                  </span>
<span class="6595350754076949595" onmouseenter="enter('6595350754076949595');" onmouseout="out('6595350754076949595');" style=""><abbr title=" 694     public void applyAdditionalFetchCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PersistencePackage persistencePackage) {"> 694     public void applyAdditionalFetchCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cðŸ”µ</abbr></span>
<span class="-9143014012238338039" onmouseenter="enter('-9143014012238338039');" onmouseout="out('-9143014012238338039');" style=""> 695         //unimplemented                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 696     }                                                                                                    </span>
<span  style=""> 697                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 698     @Override                                                                                            </span>
<span class="-3782560920985534584" onmouseenter="enter('-3782560920985534584');" onmouseout="out('-3782560920985534584');" style=""><abbr title=" 699     public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 699     public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 700         Entity entity = persistencePackage.getEntity();                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 701         try {                                                                                            </span>
<span class="2168419604722842668" onmouseenter="enter('2168419604722842668');" onmouseout="out('2168419604722842668');" style=""> 702             //Fill out the Sku instance from the form                                                    </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""><abbr title=" 703             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();"> 703             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective(ðŸ”µ</abbr></span>
<span class="-2646375190695846844" onmouseenter="enter('-2646375190695846844');" onmouseout="out('-2646375190695846844');" style=""> 704             Sku adminInstance = (Sku) Class.forName(entity.getType()[0]).newInstance();                  </span>
<span class="1729465429044706845" onmouseenter="enter('1729465429044706845');" onmouseout="out('1729465429044706845');" style=""><abbr title=" 705             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getName(), persistencePerspective);"> 705             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getNaðŸ”µ</abbr></span>
<span class="-7453227611519095000" onmouseenter="enter('-7453227611519095000');" onmouseout="out('-7453227611519095000');" style=""> 706             filterOutProductMetadata(adminProperties);                                                   </span>
<span class="2916291722905579881" onmouseenter="enter('2916291722905579881');" onmouseout="out('2916291722905579881');" style=""><abbr title=" 707             adminInstance = (Sku) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);"> 707             adminInstance = (Sku) helper.createPopulatedInstance(adminInstance, entity, adminProperties, ðŸ”µ</abbr></span>
<span  style=""> 708                                                                                                          </span>
<span class="561479470093632813" onmouseenter="enter('561479470093632813');" onmouseout="out('561479470093632813');" style=""> 709             //Verify that there isn&#x27;t already a Sku for this particular product option value combo       </span>
<span class="-7646105610360359073" onmouseenter="enter('-7646105610360359073');" onmouseout="out('-7646105610360359073');" style=""> 710             Entity errorEntity = validateUniqueProductOptionValueCombination(adminInstance.getProduct(), </span>
<span class="7978785476337646518" onmouseenter="enter('7978785476337646518');" onmouseout="out('7978785476337646518');" style=""><abbr title=" 711                                                                              getProductOptionProperties(entity),"> 711                                                                              getProductOptionProperties(eðŸ”µ</abbr></span>
<span class="-5950258146809433717" onmouseenter="enter('-5950258146809433717');" onmouseout="out('-5950258146809433717');" style=""> 712                                                                              null);                      </span>
<span class="315758838568217561" onmouseenter="enter('315758838568217561');" onmouseout="out('315758838568217561');" style=""> 713             if (errorEntity != null) {                                                                   </span>
<span class="-6380597201056661281" onmouseenter="enter('-6380597201056661281');" onmouseout="out('-6380597201056661281');" style=""> 714                 entity.setPropertyValidationErrors(errorEntity.getPropertyValidationErrors());           </span>
<span class="-7572797105708032926" onmouseenter="enter('-7572797105708032926');" onmouseout="out('-7572797105708032926');" style=""> 715                 return entity;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 716             }                                                                                            </span>
<span  style=""> 717                                                                                                          </span>
<span class="-5884073955982735941" onmouseenter="enter('-5884073955982735941');" onmouseout="out('-5884073955982735941');" style=""> 718             //persist the newly-created Sku                                                              </span>
<span class="8006946942803724880" onmouseenter="enter('8006946942803724880');" onmouseout="out('8006946942803724880');" style=""> 719             adminInstance = dynamicEntityDao.persist(adminInstance);                                     </span>
<span  style=""> 720                                                                                                          </span>
<span class="-704220126533799367" onmouseenter="enter('-704220126533799367');" onmouseout="out('-704220126533799367');" style=""> 721             //associate the product option values                                                        </span>
<span class="4472814042081188939" onmouseenter="enter('4472814042081188939');" onmouseout="out('4472814042081188939');" style=""> 722             associateProductOptionValuesToSku(entity, adminInstance, dynamicEntityDao);                  </span>
<span  style=""> 723                                                                                                          </span>
<span class="-5246565985745556188" onmouseenter="enter('-5246565985745556188');" onmouseout="out('-5246565985745556188');" style=""> 724             //After associating the product option values, save off the Sku                              </span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 725             adminInstance = dynamicEntityDao.merge(adminInstance);                                       </span>
<span  style=""> 726                                                                                                          </span>
<span class="-2729035098975137606" onmouseenter="enter('-2729035098975137606');" onmouseout="out('-2729035098975137606');" style=""> 727             //Fill out the DTO and add in the product option value properties to it                      </span>
<span class="8927160133375333586" onmouseenter="enter('8927160133375333586');" onmouseout="out('8927160133375333586');" style=""> 728             Entity result = helper.getRecord(adminProperties, adminInstance, null, null);                </span>
<span class="-1352652314153256295" onmouseenter="enter('-1352652314153256295');" onmouseout="out('-1352652314153256295');" style=""> 729             for (Property property : getProductOptionProperties(entity)) {                               </span>
<span class="-6991744037283748574" onmouseenter="enter('-6991744037283748574');" onmouseout="out('-6991744037283748574');" style=""> 730                 result.addProperty(property);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 731             }                                                                                            </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 732             return result;                                                                               </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 733         } catch (Exception e) {                                                                          </span>
<span class="3314391270131938130" onmouseenter="enter('3314391270131938130');" onmouseout="out('3314391270131938130');" style=""> 734             throw new ServiceException(&quot;Unable to perform fetch for entity: &quot; + Sku.class.getName(), e); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 735         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 736     }                                                                                                    </span>
<span  style=""> 737                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 738     @Override                                                                                            </span>
<span class="-7421665622225711363" onmouseenter="enter('-7421665622225711363');" onmouseout="out('-7421665622225711363');" style=""><abbr title=" 739     public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 739     public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 740         Entity entity = persistencePackage.getEntity();                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 741         try {                                                                                            </span>
<span class="2168419604722842668" onmouseenter="enter('2168419604722842668');" onmouseout="out('2168419604722842668');" style=""> 742             //Fill out the Sku instance from the form                                                    </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""><abbr title=" 743             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();"> 743             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective(ðŸ”µ</abbr></span>
<span class="1729465429044706845" onmouseenter="enter('1729465429044706845');" onmouseout="out('1729465429044706845');" style=""><abbr title=" 744             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getName(), persistencePerspective);"> 744             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getNaðŸ”µ</abbr></span>
<span class="-7453227611519095000" onmouseenter="enter('-7453227611519095000');" onmouseout="out('-7453227611519095000');" style=""> 745             filterOutProductMetadata(adminProperties);                                                   </span>
<span class="-5056229965271915337" onmouseenter="enter('-5056229965271915337');" onmouseout="out('-5056229965271915337');" style=""> 746             Object primaryKey = helper.getPrimaryKey(entity, adminProperties);                           </span>
<span class="5076299244443205355" onmouseenter="enter('5076299244443205355');" onmouseout="out('5076299244443205355');" style=""><abbr title=" 747             Sku adminInstance = (Sku) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]), primaryKey);"> 747             Sku adminInstance = (Sku) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]), primaðŸ”µ</abbr></span>
<span class="2916291722905579881" onmouseenter="enter('2916291722905579881');" onmouseout="out('2916291722905579881');" style=""><abbr title=" 748             adminInstance = (Sku) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);"> 748             adminInstance = (Sku) helper.createPopulatedInstance(adminInstance, entity, adminProperties, ðŸ”µ</abbr></span>
<span  style=""> 749                                                                                                          </span>
<span class="561479470093632813" onmouseenter="enter('561479470093632813');" onmouseout="out('561479470093632813');" style=""> 750             //Verify that there isn&#x27;t already a Sku for this particular product option value combo       </span>
<span class="-7646105610360359073" onmouseenter="enter('-7646105610360359073');" onmouseout="out('-7646105610360359073');" style=""> 751             Entity errorEntity = validateUniqueProductOptionValueCombination(adminInstance.getProduct(), </span>
<span class="7978785476337646518" onmouseenter="enter('7978785476337646518');" onmouseout="out('7978785476337646518');" style=""><abbr title=" 752                                                                             getProductOptionProperties(entity),"> 752                                                                             getProductOptionProperties(enðŸ”µ</abbr></span>
<span class="-2741785419016191367" onmouseenter="enter('-2741785419016191367');" onmouseout="out('-2741785419016191367');" style=""> 753                                                                             adminInstance);              </span>
<span class="315758838568217561" onmouseenter="enter('315758838568217561');" onmouseout="out('315758838568217561');" style=""> 754             if (errorEntity != null) {                                                                   </span>
<span class="-6380597201056661281" onmouseenter="enter('-6380597201056661281');" onmouseout="out('-6380597201056661281');" style=""> 755                 entity.setPropertyValidationErrors(errorEntity.getPropertyValidationErrors());           </span>
<span class="-7572797105708032926" onmouseenter="enter('-7572797105708032926');" onmouseout="out('-7572797105708032926');" style=""> 756                 return entity;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 757             }                                                                                            </span>
<span  style=""> 758                                                                                                          </span>
<span class="-1592345858824912592" onmouseenter="enter('-1592345858824912592');" onmouseout="out('-1592345858824912592');" style=""> 759             // Only modify product options if this ISN&#x27;T an update for inventory properties              </span>
<span class="-4074871831516694131" onmouseenter="enter('-4074871831516694131');" onmouseout="out('-4074871831516694131');" style=""> 760             if (!persistencePackage.containsCriteria(INVENTORY_ONLY_CRITERIA)) {                         </span>
<span class="4472814042081188939" onmouseenter="enter('4472814042081188939');" onmouseout="out('4472814042081188939');" style=""> 761                 associateProductOptionValuesToSku(entity, adminInstance, dynamicEntityDao);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 762             }                                                                                            </span>
<span  style=""> 763                                                                                                          </span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 764             adminInstance = dynamicEntityDao.merge(adminInstance);                                       </span>
<span  style=""> 765                                                                                                          </span>
<span class="6972089533394912781" onmouseenter="enter('6972089533394912781');" onmouseout="out('6972089533394912781');" style=""> 766             extensionManager.getProxy().skuUpdated(adminInstance);                                       </span>
<span  style=""> 767                                                                                                          </span>
<span class="-2729035098975137606" onmouseenter="enter('-2729035098975137606');" onmouseout="out('-2729035098975137606');" style=""> 768             //Fill out the DTO and add in the product option value properties to it                      </span>
<span class="8927160133375333586" onmouseenter="enter('8927160133375333586');" onmouseout="out('8927160133375333586');" style=""> 769             Entity result = helper.getRecord(adminProperties, adminInstance, null, null);                </span>
<span class="-1352652314153256295" onmouseenter="enter('-1352652314153256295');" onmouseout="out('-1352652314153256295');" style=""> 770             for (Property property : getProductOptionProperties(entity)) {                               </span>
<span class="-6991744037283748574" onmouseenter="enter('-6991744037283748574');" onmouseout="out('-6991744037283748574');" style=""> 771                 result.addProperty(property);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 772             }                                                                                            </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 773             return result;                                                                               </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 774         } catch (Exception e) {                                                                          </span>
<span class="-5937019774393085643" onmouseenter="enter('-5937019774393085643');" onmouseout="out('-5937019774393085643');" style=""> 775             throw new ServiceException(&quot;Unable to perform update for entity: &quot; + Sku.class.getName(), e);</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 776         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 777     }                                                                                                    </span>
<span  style=""> 778                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 779     @Override                                                                                            </span>
<span class="9216576132440445278" onmouseenter="enter('9216576132440445278');" onmouseout="out('9216576132440445278');" style=""> 780     protected String[] getPolymorphicClasses(Class&lt;?&gt; clazz, EntityManager em, boolean useCache) {       </span>
<span class="858198974140428987" onmouseenter="enter('858198974140428987');" onmouseout="out('858198974140428987');" style=""> 781         DynamicDaoHelperImpl helper = new DynamicDaoHelperImpl();                                        </span>
<span class="5646922235819357545" onmouseenter="enter('5646922235819357545');" onmouseout="out('5646922235819357545');" style=""> 782         Class&lt;?&gt;[] classes = helper.getAllPolymorphicEntitiesFromCeiling(clazz, true, useCache);         </span>
<span class="5925953156034592661" onmouseenter="enter('5925953156034592661');" onmouseout="out('5925953156034592661');" style=""> 783         String[] result = new String[classes.length];                                                    </span>
<span class="-8402235850457988496" onmouseenter="enter('-8402235850457988496');" onmouseout="out('-8402235850457988496');" style=""> 784         for (int i = 0; i &lt; classes.length; i++) {                                                       </span>
<span class="-4624814724789256168" onmouseenter="enter('-4624814724789256168');" onmouseout="out('-4624814724789256168');" style=""> 785             result[i] = classes[i].getName();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 786         }                                                                                                </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 787         return result;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 788     }                                                                                                    </span>
<span  style=""> 789                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 790     /**                                                                                                  </span>
<span class="-7623474717715637457" onmouseenter="enter('-7623474717715637457');" onmouseout="out('-7623474717715637457');" style=""><abbr title=" 791      * This initially removes all of the product option values that are currently related to the Sku and then re-associates"> 791      * This initially removes all of the product option values that are currently related to the Sku and ðŸ”µ</abbr></span>
<span class="919168598745235587" onmouseenter="enter('919168598745235587');" onmouseout="out('919168598745235587');" style=""> 792      * the {@link ProductOptionValue}s                                                                   </span>
<span class="5381683285013722867" onmouseenter="enter('5381683285013722867');" onmouseout="out('5381683285013722867');" style=""> 793      * @param entity                                                                                     </span>
<span class="-3727775444071594306" onmouseenter="enter('-3727775444071594306');" onmouseout="out('-3727775444071594306');" style=""> 794      * @param adminInstance                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 795      */                                                                                                  </span>
<span class="-5580154930501003130" onmouseenter="enter('-5580154930501003130');" onmouseout="out('-5580154930501003130');" style=""><abbr title=" 796     protected void associateProductOptionValuesToSku(Entity entity, Sku adminInstance, DynamicEntityDao dynamicEntityDao) {"> 796     protected void associateProductOptionValuesToSku(Entity entity, Sku adminInstance, DynamicEntityDao dðŸ”µ</abbr></span>
<span class="-2108418430173822456" onmouseenter="enter('-2108418430173822456');" onmouseout="out('-2108418430173822456');" style=""> 797         //Get the list of product option value ids that were selected from the form                      </span>
<span class="1634824265941381194" onmouseenter="enter('1634824265941381194');" onmouseout="out('1634824265941381194');" style=""> 798         List&lt;Long&gt; productOptionValueIds = new ArrayList&lt;&gt;();                                            </span>
<span class="-1352652314153256295" onmouseenter="enter('-1352652314153256295');" onmouseout="out('-1352652314153256295');" style=""> 799         for (Property property : getProductOptionProperties(entity)) {                                   </span>
<span class="-2394430384756952955" onmouseenter="enter('-2394430384756952955');" onmouseout="out('-2394430384756952955');" style=""> 800             Long propId = Long.parseLong(property.getValue());                                           </span>
<span class="-4973643473801343364" onmouseenter="enter('-4973643473801343364');" onmouseout="out('-4973643473801343364');" style=""> 801             productOptionValueIds.add(propId);                                                           </span>
<span class="882791416935144082" onmouseenter="enter('882791416935144082');" onmouseout="out('882791416935144082');" style=""> 802             property.setIsDirty(true);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 803         }                                                                                                </span>
<span  style=""> 804                                                                                                          </span>
<span class="5599600967733699964" onmouseenter="enter('5599600967733699964');" onmouseout="out('5599600967733699964');" style=""> 805         // Only process associations if product option value changes came in via the form                </span>
<span class="-927227770795358535" onmouseenter="enter('-927227770795358535');" onmouseout="out('-927227770795358535');" style=""> 806         if (CollectionUtils.isNotEmpty(productOptionValueIds)) {                                         </span>
<span class="-836715987756422691" onmouseenter="enter('-836715987756422691');" onmouseout="out('-836715987756422691');" style=""> 807             //remove the current list of product option values from the Sku                              </span>
<span class="3024457150101065569" onmouseenter="enter('3024457150101065569');" onmouseout="out('3024457150101065569');" style=""> 808             if (adminInstance.getProductOptionValueXrefs().size() &gt; 0) {                                 </span>
<span class="-348971082300775720" onmouseenter="enter('-348971082300775720');" onmouseout="out('-348971082300775720');" style=""><abbr title=" 809                 Iterator&lt;SkuProductOptionValueXref&gt; iterator = adminInstance.getProductOptionValueXrefs().iterator();"> 809                 Iterator&lt;SkuProductOptionValueXref&gt; iterator = adminInstance.getProductOptionValueXrefs()ðŸ”µ</abbr></span>
<span class="977968488612897428" onmouseenter="enter('977968488612897428');" onmouseout="out('977968488612897428');" style=""> 810                 while (iterator.hasNext()) {                                                             </span>
<span class="296261963919855061" onmouseenter="enter('296261963919855061');" onmouseout="out('296261963919855061');" style=""> 811                     dynamicEntityDao.remove(iterator.next());                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 812                 }                                                                                        </span>
<span class="-7399149246786578987" onmouseenter="enter('-7399149246786578987');" onmouseout="out('-7399149246786578987');" style=""> 813                 dynamicEntityDao.merge(adminInstance);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 814             }                                                                                            </span>
<span  style=""> 815                                                                                                          </span>
<span class="-4534125068586212273" onmouseenter="enter('-4534125068586212273');" onmouseout="out('-4534125068586212273');" style=""> 816             //Associate the product option values from the form with the Sku                             </span>
<span class="-2263388685273571690" onmouseenter="enter('-2263388685273571690');" onmouseout="out('-2263388685273571690');" style=""> 817             for (Long id : productOptionValueIds) {                                                      </span>
<span class="-1845535430062096532" onmouseenter="enter('-1845535430062096532');" onmouseout="out('-1845535430062096532');" style=""><abbr title=" 818                 //Simply find the changed ProductOptionValues directly - seems to work better with sandboxing code"> 818                 //Simply find the changed ProductOptionValues directly - seems to work better with sandboðŸ”µ</abbr></span>
<span class="-2351207014655688291" onmouseenter="enter('-2351207014655688291');" onmouseout="out('-2351207014655688291');" style=""><abbr title=" 819                 ProductOptionValue pov = (ProductOptionValue) dynamicEntityDao.find(ProductOptionValueImpl.class, id);"> 819                 ProductOptionValue pov = (ProductOptionValue) dynamicEntityDao.find(ProductOptionValueImpðŸ”µ</abbr></span>
<span class="6521746250086557424" onmouseenter="enter('6521746250086557424');" onmouseout="out('6521746250086557424');" style=""> 820                 SkuProductOptionValueXref xref = new SkuProductOptionValueXrefImpl(adminInstance, pov);  </span>
<span class="-8084022359180624494" onmouseenter="enter('-8084022359180624494');" onmouseout="out('-8084022359180624494');" style=""> 821                 xref = dynamicEntityDao.merge(xref);                                                     </span>
<span class="-4176466516175169486" onmouseenter="enter('-4176466516175169486');" onmouseout="out('-4176466516175169486');" style=""> 822                 adminInstance.getProductOptionValueXrefs().add(xref);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 823             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 824         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 825     }                                                                                                    </span>
<span  style=""> 826                                                                                                          </span>
<span class="-7856904959937096406" onmouseenter="enter('-7856904959937096406');" onmouseout="out('-7856904959937096406');" style=""> 827     protected List&lt;Property&gt; getProductOptionProperties(Entity entity) {                                 </span>
<span class="-8583115342580003925" onmouseenter="enter('-8583115342580003925');" onmouseout="out('-8583115342580003925');" style=""> 828         List&lt;Property&gt; productOptionProperties = new ArrayList&lt;&gt;();                                      </span>
<span class="-5346955267205588229" onmouseenter="enter('-5346955267205588229');" onmouseout="out('-5346955267205588229');" style=""> 829         for (Property property : entity.getProperties()) {                                               </span>
<span class="-4364715296212150710" onmouseenter="enter('-4364715296212150710');" onmouseout="out('-4364715296212150710');" style=""> 830             if (property.getName().startsWith(PRODUCT_OPTION_FIELD_PREFIX)) {                            </span>
<span class="4660153000567545168" onmouseenter="enter('4660153000567545168');" onmouseout="out('4660153000567545168');" style=""> 831                 productOptionProperties.add(property);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 832             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 833         }                                                                                                </span>
<span class="-7955791568854160092" onmouseenter="enter('-7955791568854160092');" onmouseout="out('-7955791568854160092');" style=""> 834         return productOptionProperties;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 835     }                                                                                                    </span>
<span  style=""> 836                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 837     /**                                                                                                  </span>
<span class="1365192302683773708" onmouseenter="enter('1365192302683773708');" onmouseout="out('1365192302683773708');" style=""><abbr title=" 838      * Ensures that the given list of {@link ProductOptionValue} IDs is unique for the given {@link Product}."> 838      * Ensures that the given list of {@link ProductOptionValue} IDs is unique for the given {@link ProduðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 839      *                                                                                                   </span>
<span class="181270108197628031" onmouseenter="enter('181270108197628031');" onmouseout="out('181270108197628031');" style=""><abbr title=" 840      * If sku browsing is enabled, then it is assumed that a single combination of {@link ProductOptionValue} IDs"> 840      * If sku browsing is enabled, then it is assumed that a single combination of {@link ProductOptionVaðŸ”µ</abbr></span>
<span class="-9042834622684422857" onmouseenter="enter('-9042834622684422857');" onmouseout="out('-9042834622684422857');" style=""><abbr title=" 841      * is not unique and more than one {@link Sku} could have the exact same combination of {@link ProductOptionValue} IDs."> 841      * is not unique and more than one {@link Sku} could have the exact same combination of {@link ProducðŸ”µ</abbr></span>
<span class="8880319067663877918" onmouseenter="enter('8880319067663877918');" onmouseout="out('8880319067663877918');" style=""> 842      * In this case, the following validation is skipped.                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 843      *                                                                                                   </span>
<span class="-1391920893822957351" onmouseenter="enter('-1391920893822957351');" onmouseout="out('-1391920893822957351');" style=""> 844      * @param product                                                                                    </span>
<span class="-5594036901015815590" onmouseenter="enter('-5594036901015815590');" onmouseout="out('-5594036901015815590');" style=""> 845      * @param productOptionProperties                                                                    </span>
<span class="-6460801320187933305" onmouseenter="enter('-6460801320187933305');" onmouseout="out('-6460801320187933305');" style=""><abbr title=" 846      * @param currentSku - for update operations, this is the current Sku that is being updated; should be excluded from"> 846      * @param currentSku - for update operations, this is the current Sku that is being updated; should bðŸ”µ</abbr></span>
<span class="-9039397817177530475" onmouseenter="enter('-9039397817177530475');" onmouseout="out('-9039397817177530475');" style=""> 847      * attempting validation                                                                             </span>
<span class="3147013888049433291" onmouseenter="enter('3147013888049433291');" onmouseout="out('3147013888049433291');" style=""> 848      * @return &lt;b&gt;null&lt;/b&gt; if successfully validation, the error entity otherwise                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 849      */                                                                                                  </span>
<span class="4098410267680721468" onmouseenter="enter('4098410267680721468');" onmouseout="out('4098410267680721468');" style=""><abbr title=" 850     protected Entity validateUniqueProductOptionValueCombination(Product product, List&lt;Property&gt; productOptionProperties, Sku currentSku) {"> 850     protected Entity validateUniqueProductOptionValueCombination(Product product, List&lt;Property&gt; productOðŸ”µ</abbr></span>
<span class="-5247886246871174474" onmouseenter="enter('-5247886246871174474');" onmouseout="out('-5247886246871174474');" style=""> 851         //do not attempt POV validation if no PO properties were passed in                               </span>
<span class="3871558701454434845" onmouseenter="enter('3871558701454434845');" onmouseout="out('3871558701454434845');" style=""> 852         if (CollectionUtils.isNotEmpty(productOptionProperties)) {                                       </span>
<span class="1634824265941381194" onmouseenter="enter('1634824265941381194');" onmouseout="out('1634824265941381194');" style=""> 853             List&lt;Long&gt; productOptionValueIds = new ArrayList&lt;&gt;();                                        </span>
<span class="-3576685812737207515" onmouseenter="enter('-3576685812737207515');" onmouseout="out('-3576685812737207515');" style=""> 854             for (Property property : productOptionProperties) {                                          </span>
<span class="-2118064041595259984" onmouseenter="enter('-2118064041595259984');" onmouseout="out('-2118064041595259984');" style=""> 855                 productOptionValueIds.add(Long.parseLong(property.getValue()));                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 856             }                                                                                            </span>
<span  style=""> 857                                                                                                          </span>
<span class="-2493564654197817042" onmouseenter="enter('-2493564654197817042');" onmouseout="out('-2493564654197817042');" style=""> 858             boolean validated = true;                                                                    </span>
<span class="7949927824524618864" onmouseenter="enter('7949927824524618864');" onmouseout="out('7949927824524618864');" style=""> 859             for (Sku sku : product.getAdditionalSkus()) {                                                </span>
<span class="2891953471366425035" onmouseenter="enter('2891953471366425035');" onmouseout="out('2891953471366425035');" style=""> 860                 if (currentSku == null || !sku.getId().equals(currentSku.getId())) {                     </span>
<span class="-3952558990885951835" onmouseenter="enter('-3952558990885951835');" onmouseout="out('-3952558990885951835');" style=""> 861                     List&lt;Long&gt; testList = new ArrayList&lt;&gt;();                                             </span>
<span class="-7407157514043427301" onmouseenter="enter('-7407157514043427301');" onmouseout="out('-7407157514043427301');" style=""> 862                     for (ProductOptionValue optionValue : sku.getProductOptionValues()) {                </span>
<span class="261748784534089861" onmouseenter="enter('261748784534089861');" onmouseout="out('261748784534089861');" style=""> 863                         testList.add(optionValue.getId());                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 864                     }                                                                                    </span>
<span  style=""> 865                                                                                                          </span>
<span class="-5224728573656644718" onmouseenter="enter('-5224728573656644718');" onmouseout="out('-5224728573656644718');" style=""> 866                     if (CollectionUtils.isNotEmpty(testList) &amp;&amp;                                          </span>
<span class="-8535753245269677627" onmouseenter="enter('-8535753245269677627');" onmouseout="out('-8535753245269677627');" style=""> 867                             productOptionValueIds.containsAll(testList) &amp;&amp;                               </span>
<span class="4715989752758376255" onmouseenter="enter('4715989752758376255');" onmouseout="out('4715989752758376255');" style=""> 868                             productOptionValueIds.size() == testList.size()) {                           </span>
<span class="6265709580977530731" onmouseenter="enter('6265709580977530731');" onmouseout="out('6265709580977530731');" style=""> 869                         validated = false;                                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 870                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 871                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 872                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 873             }                                                                                            </span>
<span  style=""> 874                                                                                                          </span>
<span class="5370947014016399578" onmouseenter="enter('5370947014016399578');" onmouseout="out('5370947014016399578');" style=""> 875             if (!validated) {                                                                            </span>
<span class="605992171615497910" onmouseenter="enter('605992171615497910');" onmouseout="out('605992171615497910');" style=""> 876                 Entity errorEntity = new Entity();                                                       </span>
<span class="4071390277457465045" onmouseenter="enter('4071390277457465045');" onmouseout="out('4071390277457465045');" style=""> 877                 for (Property productOptionProperty : productOptionProperties) {                         </span>
<span class="-3018953048999428832" onmouseenter="enter('-3018953048999428832');" onmouseout="out('-3018953048999428832');" style=""> 878                     errorEntity.addValidationError(productOptionProperty.getName(), &quot;uniqueSkuError&quot;);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 879                 }                                                                                        </span>
<span class="-5923031647519224540" onmouseenter="enter('-5923031647519224540');" onmouseout="out('-5923031647519224540');" style=""> 880                 return errorEntity;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 881             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 882         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 883         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 884     }                                                                                                    </span>
<span  style=""> 885                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 886 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-1249558187989023334" onmouseenter="enter('-1249558187989023334');" onmouseout="out('-1249558187989023334');" style="">   3  * BroadleafCommerce Admin Module                                                                        </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span class="3565305863144860564" onmouseenter="enter('3565305863144860564');" onmouseout="out('3565305863144860564');" style="">  19 package org.broadleafcommerce.admin.server.service.handler;                                              </span>
<span  style="">  20                                                                                                          </span>
<span class="-5484142805323860658" onmouseenter="enter('-5484142805323860658');" onmouseout="out('-5484142805323860658');" style="">  21 import static com.google.common.base.CharMatcher.DIGIT;                                                  </span>
<span  style="">  22                                                                                                          </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  23 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="2953846583056246827" onmouseenter="enter('2953846583056246827');" onmouseout="out('2953846583056246827');" style="">  24 import org.apache.commons.collections.Transformer;                                                       </span>
<span class="-4661043417888464228" onmouseenter="enter('-4661043417888464228');" onmouseout="out('-4661043417888464228');" style="">  25 import org.apache.commons.lang.BooleanUtils;                                                             </span>
<span class="2359514128542055982" onmouseenter="enter('2359514128542055982');" onmouseout="out('2359514128542055982');" style="">  26 import org.apache.commons.lang3.ArrayUtils;                                                              </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  27 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="-6922428965258674124" onmouseenter="enter('-6922428965258674124');" onmouseout="out('-6922428965258674124');" style="">  28 import org.apache.commons.lang3.math.NumberUtils;                                                        </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  29 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  30 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="5500044680393520896" onmouseenter="enter('5500044680393520896');" onmouseout="out('5500044680393520896');" style="">  31 import org.broadleafcommerce.admin.server.service.SkuMetadataCacheService;                               </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  32 import org.broadleafcommerce.common.exception.ServiceException;                                          </span>
<span class="-2413957740330241600" onmouseenter="enter('-2413957740330241600');" onmouseout="out('-2413957740330241600');" style="">  33 import org.broadleafcommerce.common.presentation.client.LookupType;                                      </span>
<span class="-212317658512913375" onmouseenter="enter('-212317658512913375');" onmouseout="out('-212317658512913375');" style="">  34 import org.broadleafcommerce.common.presentation.client.OperationType;                                   </span>
<span class="7296089998360266547" onmouseenter="enter('7296089998360266547');" onmouseout="out('7296089998360266547');" style="">  35 import org.broadleafcommerce.common.presentation.client.PersistencePerspectiveItemType;                  </span>
<span class="1362364260528215152" onmouseenter="enter('1362364260528215152');" onmouseout="out('1362364260528215152');" style="">  36 import org.broadleafcommerce.common.presentation.client.SupportedFieldType;                              </span>
<span class="-7583443881845767348" onmouseenter="enter('-7583443881845767348');" onmouseout="out('-7583443881845767348');" style="">  37 import org.broadleafcommerce.common.presentation.client.VisibilityEnum;                                  </span>
<span class="-2818686525334833130" onmouseenter="enter('-2818686525334833130');" onmouseout="out('-2818686525334833130');" style="">  38 import org.broadleafcommerce.common.sandbox.SandBoxHelper;                                               </span>
<span class="-3909806959928975034" onmouseenter="enter('-3909806959928975034');" onmouseout="out('-3909806959928975034');" style="">  39 import org.broadleafcommerce.common.util.BLCCollectionUtils;                                             </span>
<span class="-3347161074136237116" onmouseenter="enter('-3347161074136237116');" onmouseout="out('-3347161074136237116');" style="">  40 import org.broadleafcommerce.common.util.StringUtil;                                                     </span>
<span class="-8028747938757529269" onmouseenter="enter('-8028747938757529269');" onmouseout="out('-8028747938757529269');" style="">  41 import org.broadleafcommerce.common.util.TypedTransformer;                                               </span>
<span class="2901117953480421393" onmouseenter="enter('2901117953480421393');" onmouseout="out('2901117953480421393');" style="">  42 import org.broadleafcommerce.common.util.dao.DynamicDaoHelperImpl;                                       </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  43 import org.broadleafcommerce.core.catalog.domain.Product;                                                </span>
<span class="8587718080948629089" onmouseenter="enter('8587718080948629089');" onmouseout="out('8587718080948629089');" style="">  44 import org.broadleafcommerce.core.catalog.domain.ProductBundle;                                          </span>
<span class="-85811185251521902" onmouseenter="enter('-85811185251521902');" onmouseout="out('-85811185251521902');" style="">  45 import org.broadleafcommerce.core.catalog.domain.ProductImpl;                                            </span>
<span class="6224071758335975205" onmouseenter="enter('6224071758335975205');" onmouseout="out('6224071758335975205');" style="">  46 import org.broadleafcommerce.core.catalog.domain.ProductOption;                                          </span>
<span class="-6385470104782105538" onmouseenter="enter('-6385470104782105538');" onmouseout="out('-6385470104782105538');" style="">  47 import org.broadleafcommerce.core.catalog.domain.ProductOptionImpl;                                      </span>
<span class="-7937345987210941259" onmouseenter="enter('-7937345987210941259');" onmouseout="out('-7937345987210941259');" style="">  48 import org.broadleafcommerce.core.catalog.domain.ProductOptionValue;                                     </span>
<span class="7369709806901157478" onmouseenter="enter('7369709806901157478');" onmouseout="out('7369709806901157478');" style="">  49 import org.broadleafcommerce.core.catalog.domain.ProductOptionValueImpl;                                 </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  50 import org.broadleafcommerce.core.catalog.domain.Sku;                                                    </span>
<span class="1181568146405964825" onmouseenter="enter('1181568146405964825');" onmouseout="out('1181568146405964825');" style="">  51 import org.broadleafcommerce.core.catalog.domain.SkuImpl;                                                </span>
<span class="688919036808372243" onmouseenter="enter('688919036808372243');" onmouseout="out('688919036808372243');" style="">  52 import org.broadleafcommerce.core.catalog.domain.SkuProductOptionValueXref;                              </span>
<span class="-3196712195758579658" onmouseenter="enter('-3196712195758579658');" onmouseout="out('-3196712195758579658');" style="">  53 import org.broadleafcommerce.core.catalog.domain.SkuProductOptionValueXrefImpl;                          </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  54 import org.broadleafcommerce.core.catalog.service.CatalogService;                                        </span>
<span class="4427537537958608766" onmouseenter="enter('4427537537958608766');" onmouseout="out('4427537537958608766');" style="">  55 import org.broadleafcommerce.openadmin.dto.BasicFieldMetadata;                                           </span>
<span class="-1607559599739253077" onmouseenter="enter('-1607559599739253077');" onmouseout="out('-1607559599739253077');" style="">  56 import org.broadleafcommerce.openadmin.dto.ClassMetadata;                                                </span>
<span class="-8970007776478821592" onmouseenter="enter('-8970007776478821592');" onmouseout="out('-8970007776478821592');" style="">  57 import org.broadleafcommerce.openadmin.dto.CriteriaTransferObject;                                       </span>
<span class="-4742435063138209714" onmouseenter="enter('-4742435063138209714');" onmouseout="out('-4742435063138209714');" style="">  58 import org.broadleafcommerce.openadmin.dto.DynamicResultSet;                                             </span>
<span class="-5093421835888664541" onmouseenter="enter('-5093421835888664541');" onmouseout="out('-5093421835888664541');" style="">  59 import org.broadleafcommerce.openadmin.dto.Entity;                                                       </span>
<span class="-8829499667991596741" onmouseenter="enter('-8829499667991596741');" onmouseout="out('-8829499667991596741');" style="">  60 import org.broadleafcommerce.openadmin.dto.FieldMetadata;                                                </span>
<span class="6369021917986026789" onmouseenter="enter('6369021917986026789');" onmouseout="out('6369021917986026789');" style="">  61 import org.broadleafcommerce.openadmin.dto.FilterAndSortCriteria;                                        </span>
<span class="7333603239996951733" onmouseenter="enter('7333603239996951733');" onmouseout="out('7333603239996951733');" style="">  62 import org.broadleafcommerce.openadmin.dto.MergedPropertyType;                                           </span>
<span class="5387066876064049952" onmouseenter="enter('5387066876064049952');" onmouseout="out('5387066876064049952');" style="">  63 import org.broadleafcommerce.openadmin.dto.PersistencePackage;                                           </span>
<span class="8079401142601162613" onmouseenter="enter('8079401142601162613');" onmouseout="out('8079401142601162613');" style="">  64 import org.broadleafcommerce.openadmin.dto.PersistencePerspective;                                       </span>
<span class="1983554291461039357" onmouseenter="enter('1983554291461039357');" onmouseout="out('1983554291461039357');" style="">  65 import org.broadleafcommerce.openadmin.dto.Property;                                                     </span>
<span class="1696571253156436279" onmouseenter="enter('1696571253156436279');" onmouseout="out('1696571253156436279');" style="">  66 import org.broadleafcommerce.openadmin.dto.SectionCrumb;                                                 </span>
<span class="-8828889589519173652" onmouseenter="enter('-8828889589519173652');" onmouseout="out('-8828889589519173652');" style="">  67 import org.broadleafcommerce.openadmin.server.dao.DynamicEntityDao;                                      </span>
<span class="-9217168395336380631" onmouseenter="enter('-9217168395336380631');" onmouseout="out('-9217168395336380631');" style="">  68 import org.broadleafcommerce.openadmin.server.service.handler.CustomPersistenceHandlerAdapter;           </span>
<span class="-1454726158681359973" onmouseenter="enter('-1454726158681359973');" onmouseout="out('-1454726158681359973');" style="">  69 import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceManager;                    </span>
<span class="97669409268306845" onmouseenter="enter('97669409268306845');" onmouseout="out('97669409268306845');" style="">  70 import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceManagerFactory;             </span>
<span class="-9205099315907051841" onmouseenter="enter('-9205099315907051841');" onmouseout="out('-9205099315907051841');" style="">  71 import org.broadleafcommerce.openadmin.server.service.persistence.module.InspectHelper;                  </span>
<span class="8253709771214222101" onmouseenter="enter('8253709771214222101');" onmouseout="out('8253709771214222101');" style="">  72 import org.broadleafcommerce.openadmin.server.service.persistence.module.PersistenceModule;              </span>
<span class="5407139061354632707" onmouseenter="enter('5407139061354632707');" onmouseout="out('5407139061354632707');" style="">  73 import org.broadleafcommerce.openadmin.server.service.persistence.module.RecordHelper;                   </span>
<span class="-4125327013079009203" onmouseenter="enter('-4125327013079009203');" onmouseout="out('-4125327013079009203');" style="">  74 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.CriteriaTranslator;    </span>
<span class="7637154476457570035" onmouseenter="enter('7637154476457570035');" onmouseout="out('7637154476457570035');" style="">  75 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPath;             </span>
<span class="1663650800150084878" onmouseenter="enter('1663650800150084878');" onmouseout="out('1663650800150084878');" style="">  76 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPathBuilder;      </span>
<span class="7520439988643323618" onmouseenter="enter('7520439988643323618');" onmouseout="out('7520439988643323618');" style="">  77 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FilterMapping;         </span>
<span class="-8754722050104399052" onmouseenter="enter('-8754722050104399052');" onmouseout="out('-8754722050104399052');" style="">  78 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.Restriction;           </span>
<span class="2225343043491731861" onmouseenter="enter('2225343043491731861');" onmouseout="out('2225343043491731861');" style=""><abbr title="  79 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.predicate.PredicateProvider;">  79 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.predicate.PredicateProvðŸ”µ</abbr></span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  80 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  81 import org.springframework.stereotype.Component;                                                         </span>
<span  style="">  82                                                                                                          </span>
<span class="5998602906817463685" onmouseenter="enter('5998602906817463685');" onmouseout="out('5998602906817463685');" style="">  83 import java.io.Serializable;                                                                             </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  84 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  85 import java.util.Arrays;                                                                                 </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  86 import java.util.Collection;                                                                             </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  87 import java.util.Collections;                                                                            </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  88 import java.util.HashMap;                                                                                </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  89 import java.util.Iterator;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  90 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  91 import java.util.Map;                                                                                    </span>
<span  style="">  92                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  93 import javax.annotation.Resource;                                                                        </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  94 import javax.persistence.EntityManager;                                                                  </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  95 import javax.persistence.PersistenceContext;                                                             </span>
<span class="6539032290250175619" onmouseenter="enter('6539032290250175619');" onmouseout="out('6539032290250175619');" style="">  96 import javax.persistence.TypedQuery;                                                                     </span>
<span class="8485852916582699615" onmouseenter="enter('8485852916582699615');" onmouseout="out('8485852916582699615');" style="">  97 import javax.persistence.criteria.CriteriaBuilder;                                                       </span>
<span class="2535099540501772744" onmouseenter="enter('2535099540501772744');" onmouseout="out('2535099540501772744');" style="">  98 import javax.persistence.criteria.From;                                                                  </span>
<span class="5773424155764142692" onmouseenter="enter('5773424155764142692');" onmouseout="out('5773424155764142692');" style="">  99 import javax.persistence.criteria.Path;                                                                  </span>
<span class="7244103982108254428" onmouseenter="enter('7244103982108254428');" onmouseout="out('7244103982108254428');" style=""> 100 import javax.persistence.criteria.Predicate;                                                             </span>
<span  style=""> 101                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 102 /**                                                                                                      </span>
<span class="-2581105714976122669" onmouseenter="enter('-2581105714976122669');" onmouseout="out('-2581105714976122669');" style=""> 103  * @author Phillip Verheyden                                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 104  *                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 105  */                                                                                                      </span>
<span class="-4061322517816489282" onmouseenter="enter('-4061322517816489282');" onmouseout="out('-4061322517816489282');" style=""> 106 @Component(&quot;blSkuCustomPersistenceHandler&quot;)                                                              </span>
<span class="-1865408177148521742" onmouseenter="enter('-1865408177148521742');" onmouseout="out('-1865408177148521742');" style=""> 107 public class SkuCustomPersistenceHandler extends CustomPersistenceHandlerAdapter {                       </span>
<span  style=""> 108                                                                                                          </span>
<span class="-8713958385326184455" onmouseenter="enter('-8713958385326184455');" onmouseout="out('-8713958385326184455');" style=""> 109     private static final Log LOG = LogFactory.getLog(SkuCustomPersistenceHandler.class);                 </span>
<span  style=""> 110                                                                                                          </span>
<span class="363907699147620123" onmouseenter="enter('363907699147620123');" onmouseout="out('363907699147620123');" style=""> 111     public static String PRODUCT_OPTION_FIELD_PREFIX = &quot;productOption&quot;;                                  </span>
<span class="5644485626870470186" onmouseenter="enter('5644485626870470186');" onmouseout="out('5644485626870470186');" style=""> 112     public static String INVENTORY_ONLY_CRITERIA = &quot;onlyInventoryProperties&quot;;                            </span>
<span  style=""> 113                                                                                                          </span>
<span class="-4251425677142148253" onmouseenter="enter('-4251425677142148253');" onmouseout="out('-4251425677142148253');" style=""> 114     @Value(&quot;${use.to.one.lookup.sku.product.option.value:false}&quot;)                                        </span>
<span class="6110895124324481806" onmouseenter="enter('6110895124324481806');" onmouseout="out('6110895124324481806');" style=""> 115     protected boolean useToOneLookupSkuProductOptionValue = false;                                       </span>
<span  style=""> 116                                                                                                          </span>
<span class="-7681629157280888116" onmouseenter="enter('-7681629157280888116');" onmouseout="out('-7681629157280888116');" style=""> 117     @Resource(name =&quot;blSkuMetadataCacheService&quot;)                                                         </span>
<span class="5822417842178589229" onmouseenter="enter('5822417842178589229');" onmouseout="out('5822417842178589229');" style=""> 118     protected SkuMetadataCacheService skuMetadataCacheService;                                           </span>
<span  style=""> 119                                                                                                          </span>
<span class="8317365465805033193" onmouseenter="enter('8317365465805033193');" onmouseout="out('8317365465805033193');" style=""> 120     @Resource(name=&quot;blAdornedTargetListPersistenceModule&quot;)                                               </span>
<span class="878998746675668437" onmouseenter="enter('878998746675668437');" onmouseout="out('878998746675668437');" style=""> 121     protected PersistenceModule adornedPersistenceModule;                                                </span>
<span  style=""> 122                                                                                                          </span>
<span class="-7011722868621328349" onmouseenter="enter('-7011722868621328349');" onmouseout="out('-7011722868621328349');" style=""> 123     @Resource(name = &quot;blSkuCustomPersistenceHandlerExtensionManager&quot;)                                    </span>
<span class="-9007673134867108683" onmouseenter="enter('-9007673134867108683');" onmouseout="out('-9007673134867108683');" style=""> 124     protected SkuCustomPersistenceHandlerExtensionManager extensionManager;                              </span>
<span  style=""> 125                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 126     /**                                                                                                  </span>
<span class="4136366527029974243" onmouseenter="enter('4136366527029974243');" onmouseout="out('4136366527029974243');" style=""><abbr title=" 127      * This represents the field that all of the product option values will be stored in. This would be used in the case"> 127      * This represents the field that all of the product option values will be stored in. This would be uðŸ”µ</abbr></span>
<span class="6047944382158863307" onmouseenter="enter('6047944382158863307');" onmouseout="out('6047944382158863307');" style=""><abbr title=" 128      * where there are a bunch of product options and displaying each option as a grid header would have everything"> 128      * where there are a bunch of product options and displaying each option as a grid header would have ðŸ”µ</abbr></span>
<span class="-3054662628739130883" onmouseenter="enter('-3054662628739130883');" onmouseout="out('-3054662628739130883');" style=""> 129      * squashed together. Filtering on this field is currently unsupported.                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 130      */                                                                                                  </span>
<span class="5445041667615320295" onmouseenter="enter('5445041667615320295');" onmouseout="out('5445041667615320295');" style=""> 131     public static String CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME = &quot;consolidatedProductOptions&quot;;         </span>
<span class="-2903820884082764399" onmouseenter="enter('-2903820884082764399');" onmouseout="out('-2903820884082764399');" style=""> 132     public static String CONSOLIDATED_PRODUCT_OPTIONS_DELIMETER = &quot;; &quot;;                                  </span>
<span  style=""> 133                                                                                                          </span>
<span class="5554818697985539506" onmouseenter="enter('5554818697985539506');" onmouseout="out('5554818697985539506');" style=""> 134     @Resource(name=&quot;blCatalogService&quot;)                                                                   </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style=""> 135     protected CatalogService catalogService;                                                             </span>
<span  style=""> 136                                                                                                          </span>
<span class="5710637357667853932" onmouseenter="enter('5710637357667853932');" onmouseout="out('5710637357667853932');" style=""> 137     @PersistenceContext(unitName = &quot;blPU&quot;)                                                               </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style=""> 138     protected EntityManager em;                                                                          </span>
<span  style=""> 139                                                                                                          </span>
<span class="-2696154002193407400" onmouseenter="enter('-2696154002193407400');" onmouseout="out('-2696154002193407400');" style=""> 140     @Resource(name = &quot;blCriteriaTranslator&quot;)                                                             </span>
<span class="6548648040486234931" onmouseenter="enter('6548648040486234931');" onmouseout="out('6548648040486234931');" style=""> 141     protected CriteriaTranslator criteriaTranslator;                                                     </span>
<span  style=""> 142                                                                                                          </span>
<span class="-3946461589801993391" onmouseenter="enter('-3946461589801993391');" onmouseout="out('-3946461589801993391');" style=""> 143     @Resource(name = &quot;blSandBoxHelper&quot;)                                                                  </span>
<span class="-7799183597372200632" onmouseenter="enter('-7799183597372200632');" onmouseout="out('-7799183597372200632');" style=""> 144     protected SandBoxHelper sandBoxHelper;                                                               </span>
<span  style=""> 145                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 146     @Override                                                                                            </span>
<span class="998850855763553690" onmouseenter="enter('998850855763553690');" onmouseout="out('998850855763553690');" style=""> 147     public Boolean canHandleInspect(PersistencePackage persistencePackage) {                             </span>
<span class="-5823917578938895674" onmouseenter="enter('-5823917578938895674');" onmouseout="out('-5823917578938895674');" style=""><abbr title=" 148         return canHandle(persistencePackage, persistencePackage.getPersistencePerspective().getOperationTypes()"> 148         return canHandle(persistencePackage, persistencePackage.getPersistencePerspective().getOperationTðŸ”µ</abbr></span>
<span class="9015299385431722883" onmouseenter="enter('9015299385431722883');" onmouseout="out('9015299385431722883');" style=""> 149                 .getInspectType());                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 150     }                                                                                                    </span>
<span  style=""> 151                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 152     @Override                                                                                            </span>
<span class="-8556163469002491307" onmouseenter="enter('-8556163469002491307');" onmouseout="out('-8556163469002491307');" style=""> 153     public Boolean canHandleFetch(PersistencePackage persistencePackage) {                               </span>
<span class="10418940480604143" onmouseenter="enter('10418940480604143');" onmouseout="out('10418940480604143');" style=""><abbr title=" 154         OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFetchType();"> 154         OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFðŸ”µ</abbr></span>
<span class="8754300242813385255" onmouseenter="enter('8754300242813385255');" onmouseout="out('8754300242813385255');" style=""> 155         return canHandle(persistencePackage, fetchType);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156     }                                                                                                    </span>
<span  style=""> 157                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 158     @Override                                                                                            </span>
<span class="1712661648493993457" onmouseenter="enter('1712661648493993457');" onmouseout="out('1712661648493993457');" style=""> 159     public Boolean canHandleAdd(PersistencePackage persistencePackage) {                                 </span>
<span class="-5221489961679899774" onmouseenter="enter('-5221489961679899774');" onmouseout="out('-5221489961679899774');" style=""><abbr title=" 160         OperationType addType = persistencePackage.getPersistencePerspective().getOperationTypes().getAddType();"> 160         OperationType addType = persistencePackage.getPersistencePerspective().getOperationTypes().getAddðŸ”µ</abbr></span>
<span class="1238914713862050599" onmouseenter="enter('1238914713862050599');" onmouseout="out('1238914713862050599');" style=""> 161         return canHandle(persistencePackage, addType);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162     }                                                                                                    </span>
<span  style=""> 163                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 164     @Override                                                                                            </span>
<span class="5315207923223107799" onmouseenter="enter('5315207923223107799');" onmouseout="out('5315207923223107799');" style=""> 165     public Boolean canHandleUpdate(PersistencePackage persistencePackage) {                              </span>
<span class="8318706485461606240" onmouseenter="enter('8318706485461606240');" onmouseout="out('8318706485461606240');" style=""><abbr title=" 166         OperationType updateType = persistencePackage.getPersistencePerspective().getOperationTypes().getUpdateType();"> 166         OperationType updateType = persistencePackage.getPersistencePerspective().getOperationTypes().getðŸ”µ</abbr></span>
<span class="7628662592758046218" onmouseenter="enter('7628662592758046218');" onmouseout="out('7628662592758046218');" style=""> 167         return canHandle(persistencePackage, updateType);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168     }                                                                                                    </span>
<span  style=""> 169                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 170     /**                                                                                                  </span>
<span class="6990985093790140011" onmouseenter="enter('6990985093790140011');" onmouseout="out('6990985093790140011');" style=""><abbr title=" 171      * Since this is the default for all Skus, it&#x27;s possible that we are providing custom criteria for this"> 171      * Since this is the default for all Skus, it&#x27;s possible that we are providing custom criteria for thðŸ”µ</abbr></span>
<span class="-7639041005907295879" onmouseenter="enter('-7639041005907295879');" onmouseout="out('-7639041005907295879');" style=""><abbr title=" 172      * Sku lookup. In that case, we probably want to delegate to a child class, so only use this particular"> 172      * Sku lookup. In that case, we probably want to delegate to a child class, so only use this particulðŸ”µ</abbr></span>
<span class="3567117971388930965" onmouseenter="enter('3567117971388930965');" onmouseout="out('3567117971388930965');" style=""><abbr title=" 173      * persistence handler if there is no custom criteria being used and the ceiling entity is an instance of Sku. The"> 173      * persistence handler if there is no custom criteria being used and the ceiling entity is an instancðŸ”µ</abbr></span>
<span class="-9191698445538453171" onmouseenter="enter('-9191698445538453171');" onmouseout="out('-9191698445538453171');" style=""><abbr title=" 174      * exception to this rule is when we are pulling back Media, since the admin actually uses Sku for the ceiling entity"> 174      * exception to this rule is when we are pulling back Media, since the admin actually uses Sku for thðŸ”µ</abbr></span>
<span class="1646505885713320498" onmouseenter="enter('1646505885713320498');" onmouseout="out('1646505885713320498');" style=""><abbr title=" 175      * class name. That should be handled by the map structure module though, so only handle things in the Sku custom"> 175      * class name. That should be handled by the map structure module though, so only handle things in thðŸ”µ</abbr></span>
<span class="-3435293659936443508" onmouseenter="enter('-3435293659936443508');" onmouseout="out('-3435293659936443508');" style=""> 176      * persistence handler for OperationType.BASIC                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 177      *                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 178      */                                                                                                  </span>
<span class="-401224984339352861" onmouseenter="enter('-401224984339352861');" onmouseout="out('-401224984339352861');" style=""> 179     protected Boolean canHandle(PersistencePackage persistencePackage, OperationType operationType) {    </span>
<span class="2519389108374285224" onmouseenter="enter('2519389108374285224');" onmouseout="out('2519389108374285224');" style=""><abbr title=" 180         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname();"> 180         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 181         try {                                                                                            </span>
<span class="3859607212114051755" onmouseenter="enter('3859607212114051755');" onmouseout="out('3859607212114051755');" style=""> 182             Class testClass = Class.forName(ceilingEntityFullyQualifiedClassname);                       </span>
<span class="-6258271003107251148" onmouseenter="enter('-6258271003107251148');" onmouseout="out('-6258271003107251148');" style=""> 183             return Sku.class.isAssignableFrom(testClass) &amp;&amp;                                              </span>
<span class="6374297613382618653" onmouseenter="enter('6374297613382618653');" onmouseout="out('6374297613382618653');" style=""> 184                     //ArrayUtils.isEmpty(persistencePackage.getCustomCriteria()) &amp;&amp;                      </span>
<span class="-7558498583587542431" onmouseenter="enter('-7558498583587542431');" onmouseout="out('-7558498583587542431');" style=""> 185                     OperationType.BASIC.equals(operationType) &amp;&amp;                                         </span>
<span class="-2045231318111877972" onmouseenter="enter('-2045231318111877972');" onmouseout="out('-2045231318111877972');" style=""><abbr title=" 186                     (persistencePackage.getPersistencePerspective().getPersistencePerspectiveItems().get(PersistencePerspectiveItemType.ADORNEDTARGETLIST) == null);"> 186                     (persistencePackage.getPersistencePerspective().getPersistencePerspectiveItems().get(ðŸ”µ</abbr></span>
<span class="1054888787890391626" onmouseenter="enter('1054888787890391626');" onmouseout="out('1054888787890391626');" style=""> 187         } catch (ClassNotFoundException e) {                                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 188             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190     }                                                                                                    </span>
<span  style=""> 191                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 192     /**                                                                                                  </span>
<span class="330022396980695391" onmouseenter="enter('330022396980695391');" onmouseout="out('330022396980695391');" style=""> 193      * Build out the extra fields for the product options                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 194      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 195     @Override                                                                                            </span>
<span class="4696212939538128393" onmouseenter="enter('4696212939538128393');" onmouseout="out('4696212939538128393');" style=""><abbr title=" 196     public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, InspectHelper helper) throws ServiceException {"> 196     public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 197         try {                                                                                            </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""><abbr title=" 198             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();"> 198             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective(ðŸ”µ</abbr></span>
<span class="5084133214681633572" onmouseenter="enter('5084133214681633572');" onmouseout="out('5084133214681633572');" style=""> 199             Map&lt;MergedPropertyType, Map&lt;String, FieldMetadata&gt;&gt; allMergedProperties = new HashMap&lt;&gt;();   </span>
<span  style=""> 200                                                                                                          </span>
<span class="8224436115361654738" onmouseenter="enter('8224436115361654738');" onmouseout="out('8224436115361654738');" style=""> 201             String productIdStr = getOwningProductId(persistencePackage.getSectionCrumbs());             </span>
<span class="8874992536138016800" onmouseenter="enter('8874992536138016800');" onmouseout="out('8874992536138016800');" style=""> 202             String cacheKey = skuMetadataCacheService.buildCacheKey(productIdStr);                       </span>
<span  style=""> 203                                                                                                          </span>
<span class="4935255304884851121" onmouseenter="enter('4935255304884851121');" onmouseout="out('4935255304884851121');" style=""> 204             Map&lt;String, FieldMetadata&gt; properties = null;                                                </span>
<span class="-7786224376670761804" onmouseenter="enter('-7786224376670761804');" onmouseout="out('-7786224376670761804');" style=""> 205             boolean useCache = skuMetadataCacheService.useCache();                                       </span>
<span class="6293418362193794054" onmouseenter="enter('6293418362193794054');" onmouseout="out('6293418362193794054');" style=""> 206             if (useCache) {                                                                              </span>
<span class="-3485340186081071120" onmouseenter="enter('-3485340186081071120');" onmouseout="out('-3485340186081071120');" style=""> 207                 properties = skuMetadataCacheService.getFromCache(cacheKey);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208             }                                                                                            </span>
<span class="-6785810758643658869" onmouseenter="enter('-6785810758643658869');" onmouseout="out('-6785810758643658869');" style=""> 209             if (properties == null) {                                                                    </span>
<span class="-5990030037269165261" onmouseenter="enter('-5990030037269165261');" onmouseout="out('-5990030037269165261');" style=""> 210                 //Grab the default properties for the Sku                                                </span>
<span class="8769638039057755276" onmouseenter="enter('8769638039057755276');" onmouseout="out('8769638039057755276');" style=""><abbr title=" 211                 properties = helper.getSimpleMergedProperties(SkuImpl.class.getName(), persistencePerspective);"> 211                 properties = helper.getSimpleMergedProperties(SkuImpl.class.getName(), persistencePerspecðŸ”µ</abbr></span>
<span  style=""> 212                                                                                                          </span>
<span class="4572678014865473520" onmouseenter="enter('4572678014865473520');" onmouseout="out('4572678014865473520');" style=""> 213                 boolean isFirstCriteriaNAN = productIdStr == null;                                       </span>
<span class="3252503566680993088" onmouseenter="enter('3252503566680993088');" onmouseout="out('3252503566680993088');" style=""> 214                 if (!isFirstCriteriaNAN &amp;&amp; useToOneLookupSkuProductOptionValue) {                        </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 215 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-5518906673453958172" onmouseenter="enter('-5518906673453958172');" onmouseout="out('-5518906673453958172');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 216                     isFirstCriteriaNAN = !NumberUtils.isParsable(productIdStr);                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 217 ||||||| BASE                                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 218                                                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 219 =======                                                                                                  </span>
<span class="-9185431242058274610" onmouseenter="enter('-9185431242058274610');" onmouseout="out('-9185431242058274610');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 220                     isFirstCriteriaNAN = !NumberUtils.isNumber(productIdStr);                            </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 221 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222                 }                                                                                        </span>
<span class="-1057552343227044346" onmouseenter="enter('-1057552343227044346');" onmouseout="out('-1057552343227044346');" style=""> 223                 if (isFirstCriteriaNAN) {                                                                </span>
<span class="-6228644381152217188" onmouseenter="enter('-6228644381152217188');" onmouseout="out('-6228644381152217188');" style=""> 224                     //look up all the ProductOptions and then create new fields for each of them         </span>
<span class="-5911163386440462712" onmouseenter="enter('-5911163386440462712');" onmouseout="out('-5911163386440462712');" style=""> 225                     List&lt;ProductOption&gt; options = catalogService.readAllProductOptions();                </span>
<span class="-6720626788939973914" onmouseenter="enter('-6720626788939973914');" onmouseout="out('-6720626788939973914');" style=""> 226                     int order = 0;                                                                       </span>
<span class="-3626227932157062862" onmouseenter="enter('-3626227932157062862');" onmouseout="out('-3626227932157062862');" style=""> 227                     for (ProductOption option : options) {                                               </span>
<span class="-2894964408662309595" onmouseenter="enter('-2894964408662309595');" onmouseout="out('-2894964408662309595');" style=""> 228                         //add this to the built Sku properties                                           </span>
<span class="-6525885484902667726" onmouseenter="enter('-6525885484902667726');" onmouseout="out('-6525885484902667726');" style=""> 229                         FieldMetadata md = createIndividualOptionField(option, order);                   </span>
<span class="8898370236947645542" onmouseenter="enter('8898370236947645542');" onmouseout="out('8898370236947645542');" style=""> 230                         if (md != null) {                                                                </span>
<span class="-8011968882232877757" onmouseenter="enter('-8011968882232877757');" onmouseout="out('-8011968882232877757');" style=""> 231                             properties.put(&quot;productOption&quot; + option.getId(), md);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233                     }                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 234                 } else {                                                                                 </span>
<span class="-4312271314847345000" onmouseenter="enter('-4312271314847345000');" onmouseout="out('-4312271314847345000');" style=""> 235                     // If we have a product to filter the list of available product options, then use it </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 236                     try {                                                                                </span>
<span class="2407810897627048437" onmouseenter="enter('2407810897627048437');" onmouseout="out('2407810897627048437');" style=""> 237                         Long productId = Long.parseLong(productIdStr);                                   </span>
<span class="-4586946436800548085" onmouseenter="enter('-4586946436800548085');" onmouseout="out('-4586946436800548085');" style=""> 238                         Product product = catalogService.findProductById(productId);                     </span>
<span class="-8670197725029820971" onmouseenter="enter('-8670197725029820971');" onmouseout="out('-8670197725029820971');" style=""> 239                         for (ProductOption option : product.getProductOptions()) {                       </span>
<span class="1960418873000138214" onmouseenter="enter('1960418873000138214');" onmouseout="out('1960418873000138214');" style=""> 240                             FieldMetadata md = createIndividualOptionField(option, 0);                   </span>
<span class="8898370236947645542" onmouseenter="enter('8898370236947645542');" onmouseout="out('8898370236947645542');" style=""> 241                             if (md != null) {                                                            </span>
<span class="-8011968882232877757" onmouseenter="enter('-8011968882232877757');" onmouseout="out('-8011968882232877757');" style=""> 242                                 properties.put(&quot;productOption&quot; + option.getId(), md);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244                         }                                                                                </span>
<span class="7366941412324817508" onmouseenter="enter('7366941412324817508');" onmouseout="out('7366941412324817508');" style=""> 245                     } catch (NumberFormatException e) {                                                  </span>
<span class="-1877352964924956330" onmouseenter="enter('-1877352964924956330');" onmouseout="out('-1877352964924956330');" style=""> 246                         // there wasn&#x27;t a valid product id, just don&#x27;t do anything                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248                 }                                                                                        </span>
<span  style=""> 249                                                                                                          </span>
<span class="-4150172021442827260" onmouseenter="enter('-4150172021442827260');" onmouseout="out('-4150172021442827260');" style=""><abbr title=" 250                 //also build the consolidated field; if using the SkuBasicClientEntityModule then this field will be"> 250                 //also build the consolidated field; if using the SkuBasicClientEntityModule then this fiðŸ”µ</abbr></span>
<span class="-6012146770615121121" onmouseenter="enter('-6012146770615121121');" onmouseout="out('-6012146770615121121');" style=""> 251                 //permanently hidden                                                                     </span>
<span class="2721680110186827865" onmouseenter="enter('2721680110186827865');" onmouseout="out('2721680110186827865');" style=""><abbr title=" 252                 properties.put(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME, createConsolidatedOptionField(SkuImpl.class));"> 252                 properties.put(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME, createConsolidatedOptionField(SkuðŸ”µ</abbr></span>
<span  style=""> 253                                                                                                          </span>
<span class="6293418362193794054" onmouseenter="enter('6293418362193794054');" onmouseout="out('6293418362193794054');" style=""> 254                 if (useCache) {                                                                          </span>
<span class="1689829812062092848" onmouseenter="enter('1689829812062092848');" onmouseout="out('1689829812062092848');" style=""> 255                     skuMetadataCacheService.addToCache(cacheKey, properties);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 256                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257             }                                                                                            </span>
<span  style=""> 258                                                                                                          </span>
<span class="-5708738706047923554" onmouseenter="enter('-5708738706047923554');" onmouseout="out('-5708738706047923554');" style=""> 259             allMergedProperties.put(MergedPropertyType.PRIMARY, properties);                             </span>
<span  style=""> 260                                                                                                          </span>
<span class="3581259712058738264" onmouseenter="enter('3581259712058738264');" onmouseout="out('3581259712058738264');" style=""> 261             //allow the adorned list to contribute properties as well in the case of Sku bundle items    </span>
<span class="4464917262062588204" onmouseenter="enter('4464917262062588204');" onmouseout="out('4464917262062588204');" style=""> 262             adornedPersistenceModule.setPersistenceManager((PersistenceManager)helper);                  </span>
<span class="-5923303721993025135" onmouseenter="enter('-5923303721993025135');" onmouseout="out('-5923303721993025135');" style=""> 263             adornedPersistenceModule.updateMergedProperties(persistencePackage, allMergedProperties);    </span>
<span  style=""> 264                                                                                                          </span>
<span class="-4755998569329183714" onmouseenter="enter('-4755998569329183714');" onmouseout="out('-4755998569329183714');" style=""><abbr title=" 265             Class&lt;?&gt;[] entityClasses = dynamicEntityDao.getAllPolymorphicEntitiesFromCeiling(SkuImpl.class);"> 265             Class&lt;?&gt;[] entityClasses = dynamicEntityDao.getAllPolymorphicEntitiesFromCeiling(SkuImpl.clasðŸ”µ</abbr></span>
<span  style=""> 266                                                                                                          </span>
<span class="-4526006421593645811" onmouseenter="enter('-4526006421593645811');" onmouseout="out('-4526006421593645811');" style=""><abbr title=" 267             for (Map.Entry&lt;MergedPropertyType, Map&lt;String, FieldMetadata&gt;&gt; entry : allMergedProperties.entrySet()) {"> 267             for (Map.Entry&lt;MergedPropertyType, Map&lt;String, FieldMetadata&gt;&gt; entry : allMergedProperties.enðŸ”µ</abbr></span>
<span class="5289188932531096512" onmouseenter="enter('5289188932531096512');" onmouseout="out('5289188932531096512');" style=""> 268                 filterOutProductMetadata(entry.getValue());                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269             }                                                                                            </span>
<span  style=""> 270                                                                                                          </span>
<span class="-8821755242796986609" onmouseenter="enter('-8821755242796986609');" onmouseout="out('-8821755242796986609');" style=""><abbr title=" 271             ClassMetadata mergedMetadata = helper.buildClassMetadata(entityClasses, persistencePackage, allMergedProperties);"> 271             ClassMetadata mergedMetadata = helper.buildClassMetadata(entityClasses, persistencePackage, aðŸ”µ</abbr></span>
<span class="5692867683696224654" onmouseenter="enter('5692867683696224654');" onmouseout="out('5692867683696224654');" style=""> 272             DynamicResultSet results = new DynamicResultSet(mergedMetadata, null, null);                 </span>
<span  style=""> 273                                                                                                          </span>
<span class="225205592763971576" onmouseenter="enter('225205592763971576');" onmouseout="out('225205592763971576');" style=""> 274             return results;                                                                              </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 275         } catch (Exception e) {                                                                          </span>
<span class="5888084531497929280" onmouseenter="enter('5888084531497929280');" onmouseout="out('5888084531497929280');" style=""> 276             ServiceException ex = new ServiceException(&quot;Unable to retrieve inspection results for &quot; +    </span>
<span class="6417711820622805051" onmouseenter="enter('6417711820622805051');" onmouseout="out('6417711820622805051');" style=""> 277                     persistencePackage.getCeilingEntityFullyQualifiedClassname(), e);                    </span>
<span class="8479095309709473887" onmouseenter="enter('8479095309709473887');" onmouseout="out('8479095309709473887');" style=""> 278             throw ex;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280     }                                                                                                    </span>
<span  style=""> 281                                                                                                          </span>
<span class="7792500831321188662" onmouseenter="enter('7792500831321188662');" onmouseout="out('7792500831321188662');" style=""> 282     protected String getOwningProductId(SectionCrumb[] sectionCrumbs) {                                  </span>
<span class="5995078305082040448" onmouseenter="enter('5995078305082040448');" onmouseout="out('5995078305082040448');" style=""> 283         if (ArrayUtils.isNotEmpty(sectionCrumbs) &amp;&amp; ProductImpl.class.getCanonicalName()                 </span>
<span class="-5371969237667246856" onmouseenter="enter('-5371969237667246856');" onmouseout="out('-5371969237667246856');" style=""> 284                 .equals(sectionCrumbs[0].getSectionIdentifier())) {                                      </span>
<span class="1460529894614018184" onmouseenter="enter('1460529894614018184');" onmouseout="out('1460529894614018184');" style=""> 285             return sectionCrumbs[0].getSectionId();                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 287         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288     }                                                                                                    </span>
<span  style=""> 289                                                                                                          </span>
<span class="-6584484392335358741" onmouseenter="enter('-6584484392335358741');" onmouseout="out('-6584484392335358741');" style=""> 290     protected void filterOutProductMetadata(Map&lt;String, FieldMetadata&gt; map) {                            </span>
<span class="5728154390973133711" onmouseenter="enter('5728154390973133711');" onmouseout="out('5728154390973133711');" style=""><abbr title=" 291         //TODO we shouldn&#x27;t have to filter out these keys here -- we should be able to exclude using @AdminPresentation,"> 291         //TODO we shouldn&#x27;t have to filter out these keys here -- we should be able to exclude using @AdmðŸ”µ</abbr></span>
<span class="-7743625525232386179" onmouseenter="enter('-7743625525232386179');" onmouseout="out('-7743625525232386179');" style=""> 292         //but there&#x27;s a bug preventing this behavior from completely working correctly                   </span>
<span class="-976216753136159975" onmouseenter="enter('-976216753136159975');" onmouseout="out('-976216753136159975');" style=""> 293         List&lt;String&gt; removeKeys = new ArrayList&lt;&gt;();                                                     </span>
<span class="-6833083889726135539" onmouseenter="enter('-6833083889726135539');" onmouseout="out('-6833083889726135539');" style=""> 294         for (Map.Entry&lt;String, FieldMetadata&gt; entry : map.entrySet()) {                                  </span>
<span class="-6943676522367592499" onmouseenter="enter('-6943676522367592499');" onmouseout="out('-6943676522367592499');" style=""> 295             if (entry.getKey().contains(&quot;defaultProduct.&quot;) || entry.getKey().contains(&quot;product.&quot;)) {     </span>
<span class="6428107256625953551" onmouseenter="enter('6428107256625953551');" onmouseout="out('6428107256625953551');" style=""> 296                 removeKeys.add(entry.getKey());                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298         }                                                                                                </span>
<span class="7925962848224625040" onmouseenter="enter('7925962848224625040');" onmouseout="out('7925962848224625040');" style=""> 299         for (String removeKey : removeKeys) {                                                            </span>
<span class="-7725303831891910229" onmouseenter="enter('-7725303831891910229');" onmouseout="out('-7725303831891910229');" style=""> 300             map.remove(removeKey);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302     }                                                                                                    </span>
<span  style=""> 303                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 304     /**                                                                                                  </span>
<span class="8475757947277110833" onmouseenter="enter('8475757947277110833');" onmouseout="out('8475757947277110833');" style=""><abbr title=" 305      * Creates the metadata necessary for displaying all of the product option values in a single field. The display of this"> 305      * Creates the metadata necessary for displaying all of the product option values in a single field. ðŸ”µ</abbr></span>
<span class="-7291252168371203717" onmouseenter="enter('-7291252168371203717');" onmouseout="out('-7291252168371203717');" style=""><abbr title=" 306      * field is a single string with every product option value appended to it separated by a semicolon. This method should"> 306      * field is a single string with every product option value appended to it separated by a semicolon. ðŸ”µ</abbr></span>
<span class="1992999426370183590" onmouseenter="enter('1992999426370183590');" onmouseout="out('1992999426370183590');" style=""><abbr title=" 307      * be invoked on an inspect for whatever is utilizing this so that the property will be ready to be populated on fetch."> 307      * be invoked on an inspect for whatever is utilizing this so that the property will be ready to be pðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 308      *                                                                                                   </span>
<span class="-6637674095635137344" onmouseenter="enter('-6637674095635137344');" onmouseout="out('-6637674095635137344');" style=""><abbr title=" 309      * The metadata that is returned will also be set to prominent by default so that it will be ready to display on whatever"> 309      * The metadata that is returned will also be set to prominent by default so that it will be ready toðŸ”µ</abbr></span>
<span class="-511871035138294277" onmouseenter="enter('-511871035138294277');" onmouseout="out('-511871035138294277');" style=""><abbr title=" 310      * grid is being inspected. If you do not want this behavior you will need to override this functionality in the metadata"> 310      * grid is being inspected. If you do not want this behavior you will need to override this functionaðŸ”µ</abbr></span>
<span class="3179613037749712904" onmouseenter="enter('3179613037749712904');" onmouseout="out('3179613037749712904');" style=""> 311      * that is returned.                                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 312      *                                                                                                   </span>
<span class="7116239974974757712" onmouseenter="enter('7116239974974757712');" onmouseout="out('7116239974974757712');" style=""><abbr title=" 313      * @param inheritedFromType which type this should appear on. This would normally be SkuImpl.class, but if you want to"> 313      * @param inheritedFromType which type this should appear on. This would normally be SkuImpl.class, bðŸ”µ</abbr></span>
<span class="167462497314507165" onmouseenter="enter('167462497314507165');" onmouseout="out('167462497314507165');" style=""> 314      * display this field with a different entity then this should be that entity                        </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 315      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 316      */                                                                                                  </span>
<span class="-1192927872819846099" onmouseenter="enter('-1192927872819846099');" onmouseout="out('-1192927872819846099');" style=""> 317     public FieldMetadata createConsolidatedOptionField(Class&lt;?&gt; inheritedFromType) {                     </span>
<span class="-7895492162900601652" onmouseenter="enter('-7895492162900601652');" onmouseout="out('-7895492162900601652');" style=""> 318         BasicFieldMetadata metadata = new BasicFieldMetadata();                                          </span>
<span class="1112932430275912677" onmouseenter="enter('1112932430275912677');" onmouseout="out('1112932430275912677');" style=""> 319         metadata.setFieldType(SupportedFieldType.STRING);                                                </span>
<span class="6091769410078062740" onmouseenter="enter('6091769410078062740');" onmouseout="out('6091769410078062740');" style=""> 320         metadata.setMutable(false);                                                                      </span>
<span class="2561191544941929216" onmouseenter="enter('2561191544941929216');" onmouseout="out('2561191544941929216');" style=""> 321         metadata.setInheritedFromType(inheritedFromType.getName());                                      </span>
<span  style=""> 322                                                                                                          </span>
<span class="7921709413407422398" onmouseenter="enter('7921709413407422398');" onmouseout="out('7921709413407422398');" style=""><abbr title=" 323         metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCache()));"> 323         metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useðŸ”µ</abbr></span>
<span class="7303907294085574775" onmouseenter="enter('7303907294085574775');" onmouseout="out('7303907294085574775');" style=""> 324         metadata.setForeignKeyCollection(false);                                                         </span>
<span class="-1649079592520542152" onmouseenter="enter('-1649079592520542152');" onmouseout="out('-1649079592520542152');" style=""> 325         metadata.setMergedPropertyType(MergedPropertyType.PRIMARY);                                      </span>
<span  style=""> 326                                                                                                          </span>
<span class="6688700612838924202" onmouseenter="enter('6688700612838924202');" onmouseout="out('6688700612838924202');" style=""> 327         metadata.setName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                                       </span>
<span class="173658654284287974" onmouseenter="enter('173658654284287974');" onmouseout="out('173658654284287974');" style=""> 328         metadata.setFriendlyName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                               </span>
<span class="5589230730632374582" onmouseenter="enter('5589230730632374582');" onmouseout="out('5589230730632374582');" style=""> 329         metadata.setGroup(&quot;&quot;);                                                                           </span>
<span class="8683462265874380595" onmouseenter="enter('8683462265874380595');" onmouseout="out('8683462265874380595');" style=""> 330         metadata.setExplicitFieldType(SupportedFieldType.UNKNOWN);                                       </span>
<span class="-6445843447872579066" onmouseenter="enter('-6445843447872579066');" onmouseout="out('-6445843447872579066');" style=""> 331         metadata.setProminent(true);                                                                     </span>
<span class="-4820234772877671615" onmouseenter="enter('-4820234772877671615');" onmouseout="out('-4820234772877671615');" style=""> 332         metadata.setVisibility(VisibilityEnum.FORM_HIDDEN);                                              </span>
<span class="8945700141771923055" onmouseenter="enter('8945700141771923055');" onmouseout="out('8945700141771923055');" style=""> 333         metadata.setBroadleafEnumeration(&quot;&quot;);                                                            </span>
<span class="1775531838265915895" onmouseenter="enter('1775531838265915895');" onmouseout="out('1775531838265915895');" style=""> 334         metadata.setReadOnly(true);                                                                      </span>
<span class="-7171521581678886800" onmouseenter="enter('-7171521581678886800');" onmouseout="out('-7171521581678886800');" style=""> 335         metadata.setRequiredOverride(false);                                                             </span>
<span class="-4496921391259172818" onmouseenter="enter('-4496921391259172818');" onmouseout="out('-4496921391259172818');" style=""> 336         metadata.setGridOrder(Integer.MAX_VALUE);                                                        </span>
<span  style=""> 337                                                                                                          </span>
<span class="-6736542809122384852" onmouseenter="enter('-6736542809122384852');" onmouseout="out('-6736542809122384852');" style=""> 338         return metadata;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339     }                                                                                                    </span>
<span  style=""> 340                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 341     /**                                                                                                  </span>
<span class="-8205275851682999693" onmouseenter="enter('-8205275851682999693');" onmouseout="out('-8205275851682999693');" style=""><abbr title=" 342      * Returns a {@link Property} filled out with a delimited list of the &lt;b&gt;values&lt;/b&gt; that are passed in. This should be"> 342      * Returns a {@link Property} filled out with a delimited list of the &lt;b&gt;values&lt;/b&gt; that are passed iðŸ”µ</abbr></span>
<span class="-4713707283922918694" onmouseenter="enter('-4713707283922918694');" onmouseout="out('-4713707283922918694');" style=""> 343      * invoked on a fetch and the returned property should be added to the fetched {@link Entity} dto.   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 344      *                                                                                                   </span>
<span class="2073888098879145111" onmouseenter="enter('2073888098879145111');" onmouseout="out('2073888098879145111');" style=""> 345      * @param values                                                                                     </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 346      * @return                                                                                           </span>
<span class="3015934350861870420" onmouseenter="enter('3015934350861870420');" onmouseout="out('3015934350861870420');" style=""> 347      * @see {@link #createConsolidatedOptionField(Class)};                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 348      */                                                                                                  </span>
<span class="-4797739079142470258" onmouseenter="enter('-4797739079142470258');" onmouseout="out('-4797739079142470258');" style=""> 349     public Property getConsolidatedOptionProperty(Collection&lt;ProductOptionValue&gt; values) {               </span>
<span class="6856864467058713906" onmouseenter="enter('6856864467058713906');" onmouseout="out('6856864467058713906');" style=""> 350         Property optionValueProperty = new Property();                                                   </span>
<span class="6345005840174859359" onmouseenter="enter('6345005840174859359');" onmouseout="out('6345005840174859359');" style=""> 351         optionValueProperty.setName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                            </span>
<span  style=""> 352                                                                                                          </span>
<span class="4968742745228384146" onmouseenter="enter('4968742745228384146');" onmouseout="out('4968742745228384146');" style=""> 353         //order the values by the display order of their correspond product option                       </span>
<span class="-6409609658063536117" onmouseenter="enter('-6409609658063536117');" onmouseout="out('-6409609658063536117');" style=""> 354         //        Collections.sort(values, new Comparator&lt;ProductOptionValue&gt;() {                        </span>
<span class="-8064130612454474190" onmouseenter="enter('-8064130612454474190');" onmouseout="out('-8064130612454474190');" style=""> 355         //                                                                                               </span>
<span class="5501927314430930673" onmouseenter="enter('5501927314430930673');" onmouseout="out('5501927314430930673');" style=""> 356         //            @Override                                                                          </span>
<span class="9147587799683858413" onmouseenter="enter('9147587799683858413');" onmouseout="out('9147587799683858413');" style=""> 357         //            public int compare(ProductOptionValue value1, ProductOptionValue value2) {         </span>
<span class="368329491788158591" onmouseenter="enter('368329491788158591');" onmouseout="out('368329491788158591');" style=""><abbr title=" 358         //                return new CompareToBuilder().append(value1.getProductOption().getDisplayOrder(),"> 358         //                return new CompareToBuilder().append(value1.getProductOption().getDisplayOrder(ðŸ”µ</abbr></span>
<span class="8754156396924172260" onmouseenter="enter('8754156396924172260');" onmouseout="out('8754156396924172260');" style=""> 359         //                        value2.getProductOption().getDisplayOrder()).toComparison();           </span>
<span class="1818990376901269570" onmouseenter="enter('1818990376901269570');" onmouseout="out('1818990376901269570');" style=""> 360         //            }                                                                                  </span>
<span class="-1155227284920485909" onmouseenter="enter('-1155227284920485909');" onmouseout="out('-1155227284920485909');" style=""> 361         //        });                                                                                    </span>
<span  style=""> 362                                                                                                          </span>
<span class="-2061482055453175047" onmouseenter="enter('-2061482055453175047');" onmouseout="out('-2061482055453175047');" style=""> 363         ArrayList&lt;String&gt; stringValues = new ArrayList&lt;&gt;();                                              </span>
<span class="-7157508124377790495" onmouseenter="enter('-7157508124377790495');" onmouseout="out('-7157508124377790495');" style=""> 364         CollectionUtils.collect(values, new Transformer() {                                              </span>
<span  style=""> 365                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 366             @Override                                                                                    </span>
<span class="-2718541205900117239" onmouseenter="enter('-2718541205900117239');" onmouseout="out('-2718541205900117239');" style=""> 367             public Object transform(Object input) {                                                      </span>
<span class="-2749337455813426805" onmouseenter="enter('-2749337455813426805');" onmouseout="out('-2749337455813426805');" style=""> 368                 return ((ProductOptionValue) input).getAttributeValue();                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369             }                                                                                            </span>
<span class="-236589394719861606" onmouseenter="enter('-236589394719861606');" onmouseout="out('-236589394719861606');" style=""> 370         }, stringValues);                                                                                </span>
<span  style=""> 371                                                                                                          </span>
<span class="-3159140932312278736" onmouseenter="enter('-3159140932312278736');" onmouseout="out('-3159140932312278736');" style=""><abbr title=" 372         optionValueProperty.setValue(StringUtils.join(stringValues, CONSOLIDATED_PRODUCT_OPTIONS_DELIMETER));"> 372         optionValueProperty.setValue(StringUtils.join(stringValues, CONSOLIDATED_PRODUCT_OPTIONS_DELIMETEðŸ”µ</abbr></span>
<span class="-6819592353936650784" onmouseenter="enter('-6819592353936650784');" onmouseout="out('-6819592353936650784');" style=""> 373         return optionValueProperty;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374     }                                                                                                    </span>
<span  style=""> 375                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 376     /**                                                                                                  </span>
<span class="4216744498315651983" onmouseenter="enter('4216744498315651983');" onmouseout="out('4216744498315651983');" style=""> 377      * @return a blank {@link Property} corresponding to the CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 378      */                                                                                                  </span>
<span class="7598660974779837355" onmouseenter="enter('7598660974779837355');" onmouseout="out('7598660974779837355');" style=""> 379     public Property getBlankConsolidatedOptionProperty() {                                               </span>
<span class="6856864467058713906" onmouseenter="enter('6856864467058713906');" onmouseout="out('6856864467058713906');" style=""> 380         Property optionValueProperty = new Property();                                                   </span>
<span class="6345005840174859359" onmouseenter="enter('6345005840174859359');" onmouseout="out('6345005840174859359');" style=""> 381         optionValueProperty.setName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                            </span>
<span class="-7065335864511569913" onmouseenter="enter('-7065335864511569913');" onmouseout="out('-7065335864511569913');" style=""> 382         optionValueProperty.setValue(&quot;&quot;);                                                                </span>
<span class="-6819592353936650784" onmouseenter="enter('-6819592353936650784');" onmouseout="out('-6819592353936650784');" style=""> 383         return optionValueProperty;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 384     }                                                                                                    </span>
<span  style=""> 385                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 386     /**                                                                                                  </span>
<span class="6557988157037524501" onmouseenter="enter('6557988157037524501');" onmouseout="out('6557988157037524501');" style=""><abbr title=" 387      * &lt;p&gt;Creates an individual property for the specified product option. This should set up an enum field whose values will"> 387      * &lt;p&gt;Creates an individual property for the specified product option. This should set up an enum fieðŸ”µ</abbr></span>
<span class="5038223503928989560" onmouseenter="enter('5038223503928989560');" onmouseout="out('5038223503928989560');" style=""><abbr title=" 388      * be the option values for this option.  This is useful when you would like to display each product option in as its"> 388      * be the option values for this option.  This is useful when you would like to display each product ðŸ”µ</abbr></span>
<span class="9009411457822617231" onmouseenter="enter('9009411457822617231');" onmouseout="out('9009411457822617231');" style=""> 389      * own field in a grid so that you can further filter by product option values.&lt;/p&gt;                  </span>
<span class="-8656076573134722150" onmouseenter="enter('-8656076573134722150');" onmouseout="out('-8656076573134722150');" style=""><abbr title=" 390      * &lt;p&gt;In order for these fields to be utilized property on the fetch, in the GWT frontend you must use the"> 390      * &lt;p&gt;In order for these fields to be utilized property on the fetch, in the GWT frontend you must usðŸ”µ</abbr></span>
<span class="-3536572176551507765" onmouseenter="enter('-3536572176551507765');" onmouseout="out('-3536572176551507765');" style=""> 391      * for your datasource.&lt;/p&gt;                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 392      *                                                                                                   </span>
<span class="8674570395008402319" onmouseenter="enter('8674570395008402319');" onmouseout="out('8674570395008402319');" style=""> 393      * @param option                                                                                     </span>
<span class="6414796960983960786" onmouseenter="enter('6414796960983960786');" onmouseout="out('6414796960983960786');" style=""> 394      * @param order                                                                                      </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 395      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 396      */                                                                                                  </span>
<span class="8795563977758647136" onmouseenter="enter('8795563977758647136');" onmouseout="out('8795563977758647136');" style=""> 397     public FieldMetadata createIndividualOptionField(ProductOption option, int order) {                  </span>
<span class="7200486368414049440" onmouseenter="enter('7200486368414049440');" onmouseout="out('7200486368414049440');" style=""> 398         if (useToOneLookupSkuProductOptionValue) {                                                       </span>
<span class="-5634467253732639986" onmouseenter="enter('-5634467253732639986');" onmouseout="out('-5634467253732639986');" style=""> 399             return createToOneIndividualOptionField(option, order);                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 400         } else {                                                                                         </span>
<span class="7936034563418693343" onmouseenter="enter('7936034563418693343');" onmouseout="out('7936034563418693343');" style=""> 401             return createExplicitEnumerationIndividualOptionField(option, order);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403     }                                                                                                    </span>
<span  style=""> 404                                                                                                          </span>
<span class="-8892069303256438111" onmouseenter="enter('-8892069303256438111');" onmouseout="out('-8892069303256438111');" style=""><abbr title=" 405     protected FieldMetadata createExplicitEnumerationIndividualOptionField(ProductOption option, int order) {"> 405     protected FieldMetadata createExplicitEnumerationIndividualOptionField(ProductOption option, int ordeðŸ”µ</abbr></span>
<span class="-7895492162900601652" onmouseenter="enter('-7895492162900601652');" onmouseout="out('-7895492162900601652');" style=""> 406         BasicFieldMetadata metadata = new BasicFieldMetadata();                                          </span>
<span class="-2416891430670029479" onmouseenter="enter('-2416891430670029479');" onmouseout="out('-2416891430670029479');" style=""> 407         List&lt;ProductOptionValue&gt; allowedValues = option.getAllowedValues();                              </span>
<span class="9151233583168413632" onmouseenter="enter('9151233583168413632');" onmouseout="out('9151233583168413632');" style=""> 408         if (CollectionUtils.isNotEmpty(allowedValues)) {                                                 </span>
<span class="4285129340737600689" onmouseenter="enter('4285129340737600689');" onmouseout="out('4285129340737600689');" style=""> 409             metadata.setFieldType(SupportedFieldType.EXPLICIT_ENUMERATION);                              </span>
<span class="-6206284717251400514" onmouseenter="enter('-6206284717251400514');" onmouseout="out('-6206284717251400514');" style=""> 410             metadata.setMutable(true);                                                                   </span>
<span class="8194069883044431071" onmouseenter="enter('8194069883044431071');" onmouseout="out('8194069883044431071');" style=""> 411             metadata.setInheritedFromType(SkuImpl.class.getName());                                      </span>
<span class="7921709413407422398" onmouseenter="enter('7921709413407422398');" onmouseout="out('7921709413407422398');" style=""><abbr title=" 412             metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCache()));"> 412             metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheServiceðŸ”µ</abbr></span>
<span class="7303907294085574775" onmouseenter="enter('7303907294085574775');" onmouseout="out('7303907294085574775');" style=""> 413             metadata.setForeignKeyCollection(false);                                                     </span>
<span class="-1649079592520542152" onmouseenter="enter('-1649079592520542152');" onmouseout="out('-1649079592520542152');" style=""> 414             metadata.setMergedPropertyType(MergedPropertyType.PRIMARY);                                  </span>
<span  style=""> 415                                                                                                          </span>
<span class="-1089414754199454043" onmouseenter="enter('-1089414754199454043');" onmouseout="out('-1089414754199454043');" style=""> 416             //Set up the enumeration based on the product option values                                  </span>
<span class="-4938595371513432920" onmouseenter="enter('-4938595371513432920');" onmouseout="out('-4938595371513432920');" style=""> 417             String[][] optionValues = new String[allowedValues.size()][2];                               </span>
<span class="6205975934798560127" onmouseenter="enter('6205975934798560127');" onmouseout="out('6205975934798560127');" style=""> 418             for (int i = 0; i &lt; allowedValues.size(); i++) {                                             </span>
<span class="5655693563027021374" onmouseenter="enter('5655693563027021374');" onmouseout="out('5655693563027021374');" style=""> 419                 ProductOptionValue value = option.getAllowedValues().get(i);                             </span>
<span class="-6097967761511863324" onmouseenter="enter('-6097967761511863324');" onmouseout="out('-6097967761511863324');" style=""> 420                 optionValues[i][0] = value.getId().toString();                                           </span>
<span class="-2028520644986671717" onmouseenter="enter('-2028520644986671717');" onmouseout="out('-2028520644986671717');" style=""> 421                 optionValues[i][1] = value.getAttributeValue();                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 422             }                                                                                            </span>
<span class="8277090772710644263" onmouseenter="enter('8277090772710644263');" onmouseout="out('8277090772710644263');" style=""> 423             metadata.setEnumerationValues(optionValues);                                                 </span>
<span  style=""> 424                                                                                                          </span>
<span class="1748190162337854256" onmouseenter="enter('1748190162337854256');" onmouseout="out('1748190162337854256');" style=""> 425             metadata.setName(PRODUCT_OPTION_FIELD_PREFIX + option.getId());                              </span>
<span class="7017269500484793927" onmouseenter="enter('7017269500484793927');" onmouseout="out('7017269500484793927');" style=""> 426             metadata.setFriendlyName(option.getLabel());                                                 </span>
<span class="6085246036283927461" onmouseenter="enter('6085246036283927461');" onmouseout="out('6085246036283927461');" style=""> 427             metadata.setGroup(&quot;productOption_group&quot;);                                                    </span>
<span class="-8050220525630720562" onmouseenter="enter('-8050220525630720562');" onmouseout="out('-8050220525630720562');" style=""> 428             metadata.setGroupOrder(-1);                                                                  </span>
<span class="3406381469360124301" onmouseenter="enter('3406381469360124301');" onmouseout="out('3406381469360124301');" style=""> 429             metadata.setOrder(order);                                                                    </span>
<span class="8683462265874380595" onmouseenter="enter('8683462265874380595');" onmouseout="out('8683462265874380595');" style=""> 430             metadata.setExplicitFieldType(SupportedFieldType.UNKNOWN);                                   </span>
<span class="-6994608424159816416" onmouseenter="enter('-6994608424159816416');" onmouseout="out('-6994608424159816416');" style=""> 431             metadata.setProminent(false);                                                                </span>
<span class="6274758849936387106" onmouseenter="enter('6274758849936387106');" onmouseout="out('6274758849936387106');" style=""> 432             metadata.setVisibility(VisibilityEnum.FORM_EXPLICITLY_SHOWN);                                </span>
<span class="8945700141771923055" onmouseenter="enter('8945700141771923055');" onmouseout="out('8945700141771923055');" style=""> 433             metadata.setBroadleafEnumeration(&quot;&quot;);                                                        </span>
<span class="8076682597610338410" onmouseenter="enter('8076682597610338410');" onmouseout="out('8076682597610338410');" style=""> 434             metadata.setReadOnly(false);                                                                 </span>
<span class="2131936785391707598" onmouseenter="enter('2131936785391707598');" onmouseout="out('2131936785391707598');" style=""> 435             metadata.setRequiredOverride(BooleanUtils.isFalse(option.getRequired()));                    </span>
<span  style=""> 436                                                                                                          </span>
<span class="-6736542809122384852" onmouseenter="enter('-6736542809122384852');" onmouseout="out('-6736542809122384852');" style=""> 437             return metadata;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 438         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 439         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 440     }                                                                                                    </span>
<span  style=""> 441                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 442     /**                                                                                                  </span>
<span class="7683644189550699004" onmouseenter="enter('7683644189550699004');" onmouseout="out('7683644189550699004');" style=""><abbr title=" 443      * Using a ToOne lookup performs much better for large product option value lists, speeds up initial page load,"> 443      * Using a ToOne lookup performs much better for large product option value lists, speeds up initial ðŸ”µ</abbr></span>
<span class="-6062867542246075622" onmouseenter="enter('-6062867542246075622');" onmouseout="out('-6062867542246075622');" style=""><abbr title=" 444      * and is generally more accurate in relation to option value updates and how they impact available selections and cache."> 444      * and is generally more accurate in relation to option value updates and how they impact available sðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 445      *                                                                                                   </span>
<span class="8674570395008402319" onmouseenter="enter('8674570395008402319');" onmouseout="out('8674570395008402319');" style=""> 446      * @param option                                                                                     </span>
<span class="6414796960983960786" onmouseenter="enter('6414796960983960786');" onmouseout="out('6414796960983960786');" style=""> 447      * @param order                                                                                      </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 448      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 449      */                                                                                                  </span>
<span class="6879137344207562675" onmouseenter="enter('6879137344207562675');" onmouseout="out('6879137344207562675');" style=""> 450     protected FieldMetadata createToOneIndividualOptionField(ProductOption option, int order) {          </span>
<span class="-8449939433228375667" onmouseenter="enter('-8449939433228375667');" onmouseout="out('-8449939433228375667');" style=""> 451         PersistenceManager persistenceManager = PersistenceManagerFactory.getPersistenceManager();       </span>
<span class="-4187363957527008750" onmouseenter="enter('-4187363957527008750');" onmouseout="out('-4187363957527008750');" style=""> 452         FilterMapping filterMapping = new FilterMapping().withDirectFilterValues(                        </span>
<span class="-3894749102720902409" onmouseenter="enter('-3894749102720902409');" onmouseout="out('-3894749102720902409');" style=""><abbr title=" 453                 sandBoxHelper.mergeCloneIds(ProductOptionImpl.class, option.getId())).withRestriction(new Restriction()"> 453                 sandBoxHelper.mergeCloneIds(ProductOptionImpl.class, option.getId())).withRestriction(newðŸ”µ</abbr></span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 454             .withPredicateProvider(new PredicateProvider() {                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 455                 @Override                                                                                </span>
<span class="-5588636227064039300" onmouseenter="enter('-5588636227064039300');" onmouseout="out('-5588636227064039300');" style=""><abbr title=" 456                 public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder, From root,"> 456                 public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuildeðŸ”µ</abbr></span>
<span class="-2899522305959899483" onmouseenter="enter('-2899522305959899483');" onmouseout="out('-2899522305959899483');" style=""><abbr title=" 457                                                 String ceilingEntity, String fullPropertyName, Path explicitPath, List directValues) {"> 457                                                 String ceilingEntity, String fullPropertyName, Path expliðŸ”µ</abbr></span>
<span class="-933702984903214818" onmouseenter="enter('-933702984903214818');" onmouseout="out('-933702984903214818');" style=""> 458                     return root.get(&quot;productOption&quot;).get(&quot;id&quot;).in(directValues);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 459             }                                                                                            </span>
<span class="-800954676578401248" onmouseenter="enter('-800954676578401248');" onmouseout="out('-800954676578401248');" style=""> 460         }));                                                                                             </span>
<span class="9067714061330870114" onmouseenter="enter('9067714061330870114');" onmouseout="out('9067714061330870114');" style=""> 461         List&lt;FilterMapping&gt; mappings = new ArrayList&lt;&gt;();                                                </span>
<span class="345189471467363285" onmouseenter="enter('345189471467363285');" onmouseout="out('345189471467363285');" style=""> 462         mappings.add(filterMapping);                                                                     </span>
<span class="7291356103073076244" onmouseenter="enter('7291356103073076244');" onmouseout="out('7291356103073076244');" style=""><abbr title=" 463         TypedQuery&lt;Serializable&gt; countQuery = criteriaTranslator.translateCountQuery(persistenceManager.getDynamicEntityDao(),"> 463         TypedQuery&lt;Serializable&gt; countQuery = criteriaTranslator.translateCountQuery(persistenceManager.gðŸ”µ</abbr></span>
<span class="-6376296202628097343" onmouseenter="enter('-6376296202628097343');" onmouseout="out('-6376296202628097343');" style=""> 464                 ProductOptionValueImpl.class.getName(), mappings);                                       </span>
<span class="5779175921552777483" onmouseenter="enter('5779175921552777483');" onmouseout="out('5779175921552777483');" style=""> 465         Long count = (Long) countQuery.getSingleResult();                                                </span>
<span class="3590816377844072638" onmouseenter="enter('3590816377844072638');" onmouseout="out('3590816377844072638');" style=""> 466         BasicFieldMetadata metadata = null;                                                              </span>
<span class="7377439406723422491" onmouseenter="enter('7377439406723422491');" onmouseout="out('7377439406723422491');" style=""> 467         if (count &gt; 0) {                                                                                 </span>
<span class="-1273552772110171187" onmouseenter="enter('-1273552772110171187');" onmouseout="out('-1273552772110171187');" style=""> 468             metadata = new BasicFieldMetadata();                                                         </span>
<span class="7837199979125359629" onmouseenter="enter('7837199979125359629');" onmouseout="out('7837199979125359629');" style=""> 469             metadata.setFieldType(SupportedFieldType.ADDITIONAL_FOREIGN_KEY);                            </span>
<span class="-7466329847812031362" onmouseenter="enter('-7466329847812031362');" onmouseout="out('-7466329847812031362');" style=""> 470             metadata.setSecondaryType(SupportedFieldType.INTEGER);                                       </span>
<span class="-31286131392644862" onmouseenter="enter('-31286131392644862');" onmouseout="out('-31286131392644862');" style=""> 471             metadata.setForeignKeyProperty(&quot;id&quot;);                                                        </span>
<span class="332716961677554697" onmouseenter="enter('332716961677554697');" onmouseout="out('332716961677554697');" style=""> 472             metadata.setForeignKeyClass(ProductOptionValueImpl.class.getName());                         </span>
<span class="-4184418208857498113" onmouseenter="enter('-4184418208857498113');" onmouseout="out('-4184418208857498113');" style=""> 473             metadata.setForeignKeyDisplayValueProperty(&quot;attributeValue&quot;);                                </span>
<span class="4257701647031084459" onmouseenter="enter('4257701647031084459');" onmouseout="out('4257701647031084459');" style=""> 474             metadata.setLookupDisplayProperty(&quot;attributeValue&quot;);                                         </span>
<span class="7303907294085574775" onmouseenter="enter('7303907294085574775');" onmouseout="out('7303907294085574775');" style=""> 475             metadata.setForeignKeyCollection(false);                                                     </span>
<span class="6675602877003966627" onmouseenter="enter('6675602877003966627');" onmouseout="out('6675602877003966627');" style=""> 476             metadata.setCustomCriteria(new String[]{&quot;option=&quot; + String.valueOf(option.getId())});        </span>
<span class="1748190162337854256" onmouseenter="enter('1748190162337854256');" onmouseout="out('1748190162337854256');" style=""> 477             metadata.setName(PRODUCT_OPTION_FIELD_PREFIX + option.getId());                              </span>
<span class="7017269500484793927" onmouseenter="enter('7017269500484793927');" onmouseout="out('7017269500484793927');" style=""> 478             metadata.setFriendlyName(option.getLabel());                                                 </span>
<span class="6085246036283927461" onmouseenter="enter('6085246036283927461');" onmouseout="out('6085246036283927461');" style=""> 479             metadata.setGroup(&quot;productOption_group&quot;);                                                    </span>
<span class="-8050220525630720562" onmouseenter="enter('-8050220525630720562');" onmouseout="out('-8050220525630720562');" style=""> 480             metadata.setGroupOrder(-1);                                                                  </span>
<span class="3406381469360124301" onmouseenter="enter('3406381469360124301');" onmouseout="out('3406381469360124301');" style=""> 481             metadata.setOrder(order);                                                                    </span>
<span class="2043314380305444305" onmouseenter="enter('2043314380305444305');" onmouseout="out('2043314380305444305');" style=""> 482             metadata.setExplicitFieldType(SupportedFieldType.ADDITIONAL_FOREIGN_KEY);                    </span>
<span class="-6994608424159816416" onmouseenter="enter('-6994608424159816416');" onmouseout="out('-6994608424159816416');" style=""> 483             metadata.setProminent(false);                                                                </span>
<span class="6274758849936387106" onmouseenter="enter('6274758849936387106');" onmouseout="out('6274758849936387106');" style=""> 484             metadata.setVisibility(VisibilityEnum.FORM_EXPLICITLY_SHOWN);                                </span>
<span class="8076682597610338410" onmouseenter="enter('8076682597610338410');" onmouseout="out('8076682597610338410');" style=""> 485             metadata.setReadOnly(false);                                                                 </span>
<span class="-4603246565563510167" onmouseenter="enter('-4603246565563510167');" onmouseout="out('-4603246565563510167');" style=""><abbr title=" 486             //these may not be actually required, but the CPH has this as a requirement for parsing the data, so we&#x27;ll stick with it here"> 486             //these may not be actually required, but the CPH has this as a requirement for parsing the dðŸ”µ</abbr></span>
<span class="6102752219358130186" onmouseenter="enter('6102752219358130186');" onmouseout="out('6102752219358130186');" style=""> 487             metadata.setRequiredOverride(true);                                                          </span>
<span class="-3053289446243924099" onmouseenter="enter('-3053289446243924099');" onmouseout="out('-3053289446243924099');" style=""> 488             metadata.setLookupType(LookupType.STANDARD);                                                 </span>
<span class="-6206284717251400514" onmouseenter="enter('-6206284717251400514');" onmouseout="out('-6206284717251400514');" style=""> 489             metadata.setMutable(true);                                                                   </span>
<span class="8194069883044431071" onmouseenter="enter('8194069883044431071');" onmouseout="out('8194069883044431071');" style=""> 490             metadata.setInheritedFromType(SkuImpl.class.getName());                                      </span>
<span class="7921709413407422398" onmouseenter="enter('7921709413407422398');" onmouseout="out('7921709413407422398');" style=""><abbr title=" 491             metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCache()));"> 491             metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheServiceðŸ”µ</abbr></span>
<span class="-1649079592520542152" onmouseenter="enter('-1649079592520542152');" onmouseout="out('-1649079592520542152');" style=""> 492             metadata.setMergedPropertyType(MergedPropertyType.PRIMARY);                                  </span>
<span class="5062289219461079509" onmouseenter="enter('5062289219461079509');" onmouseout="out('5062289219461079509');" style=""> 493             metadata.setTargetClass(SkuImpl.class.getName());                                            </span>
<span class="-6501495819508426588" onmouseenter="enter('-6501495819508426588');" onmouseout="out('-6501495819508426588');" style=""> 494             metadata.setFieldName(PRODUCT_OPTION_FIELD_PREFIX + option.getId());                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 495         }                                                                                                </span>
<span class="-6736542809122384852" onmouseenter="enter('-6736542809122384852');" onmouseout="out('-6736542809122384852');" style=""> 496         return metadata;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 497     }                                                                                                    </span>
<span  style=""> 498                                                                                                          </span>
<span class="7948482626287429940" onmouseenter="enter('7948482626287429940');" onmouseout="out('7948482626287429940');" style=""> 499     @SuppressWarnings(&quot;unchecked&quot;)                                                                       </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 500     @Override                                                                                            </span>
<span class="-1282377985319068039" onmouseenter="enter('-1282377985319068039');" onmouseout="out('-1282377985319068039');" style=""><abbr title=" 501     public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 501     public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynaðŸ”µ</abbr></span>
<span class="2519389108374285224" onmouseenter="enter('2519389108374285224');" onmouseout="out('2519389108374285224');" style=""><abbr title=" 502         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname();"> 502         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 503         try {                                                                                            </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""><abbr title=" 504             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();"> 504             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective(ðŸ”µ</abbr></span>
<span class="-4474933170501730421" onmouseenter="enter('-4474933170501730421');" onmouseout="out('-4474933170501730421');" style=""> 505             //get the default properties from Sku and its subclasses                                     </span>
<span class="-1647605982225346371" onmouseenter="enter('-1647605982225346371');" onmouseout="out('-1647605982225346371');" style=""><abbr title=" 506             Map&lt;String, FieldMetadata&gt; originalProps = helper.getSimpleMergedProperties(Sku.class.getName(), persistencePerspective);"> 506             Map&lt;String, FieldMetadata&gt; originalProps = helper.getSimpleMergedProperties(Sku.class.getNameðŸ”µ</abbr></span>
<span  style=""> 507                                                                                                          </span>
<span class="796362017556902885" onmouseenter="enter('796362017556902885');" onmouseout="out('796362017556902885');" style=""> 508             //Pull back the Skus based on the criteria from the client                                   </span>
<span class="-363648758652557915" onmouseenter="enter('-363648758652557915');" onmouseout="out('-363648758652557915');" style=""><abbr title=" 509             List&lt;FilterMapping&gt; filterMappings = helper.getFilterMappings(persistencePerspective, cto, ceilingEntityFullyQualifiedClassname, originalProps);"> 509             List&lt;FilterMapping&gt; filterMappings = helper.getFilterMappings(persistencePerspective, cto, ceðŸ”µ</abbr></span>
<span  style=""> 510                                                                                                          </span>
<span class="-3675685187725351740" onmouseenter="enter('-3675685187725351740');" onmouseout="out('-3675685187725351740');" style=""> 511             //allow subclasses to provide additional criteria before executing the query                 </span>
<span class="-7008588708271197253" onmouseenter="enter('-7008588708271197253');" onmouseout="out('-7008588708271197253');" style=""> 512             applyProductOptionValueCriteria(filterMappings, cto, persistencePackage, null);              </span>
<span class="4646076149717404025" onmouseenter="enter('4646076149717404025');" onmouseout="out('4646076149717404025');" style=""> 513             applySkuBundleItemValueCriteria(filterMappings, cto, persistencePackage);                    </span>
<span class="-2737785807325266" onmouseenter="enter('-2737785807325266');" onmouseout="out('-2737785807325266');" style=""> 514             applyAdditionalFetchCriteria(filterMappings, cto, persistencePackage);                       </span>
<span  style=""> 515                                                                                                          </span>
<span class="-4634567455719757558" onmouseenter="enter('-4634567455719757558');" onmouseout="out('-4634567455719757558');" style=""><abbr title=" 516             List&lt;Serializable&gt; records = helper.getPersistentRecords(persistencePackage.getCeilingEntityFullyQualifiedClassname(), filterMappings, cto.getFirstResult(), cto.getMaxResults());"> 516             List&lt;Serializable&gt; records = helper.getPersistentRecords(persistencePackage.getCeilingEntityFðŸ”µ</abbr></span>
<span class="-5982273033000910285" onmouseenter="enter('-5982273033000910285');" onmouseout="out('-5982273033000910285');" style=""> 517             //Convert Skus into the client-side Entity representation                                    </span>
<span class="-2996861390233909505" onmouseenter="enter('-2996861390233909505');" onmouseout="out('-2996861390233909505');" style=""> 518             Entity[] payload = helper.getRecords(originalProps, records);                                </span>
<span  style=""> 519                                                                                                          </span>
<span class="-4184869795171170066" onmouseenter="enter('-4184869795171170066');" onmouseout="out('-4184869795171170066');" style=""><abbr title=" 520             int totalRecords = helper.getTotalRecords(persistencePackage.getCeilingEntityFullyQualifiedClassname(), filterMappings);"> 520             int totalRecords = helper.getTotalRecords(persistencePackage.getCeilingEntityFullyQualifiedClðŸ”µ</abbr></span>
<span  style=""> 521                                                                                                          </span>
<span class="-3763055148335758582" onmouseenter="enter('-3763055148335758582');" onmouseout="out('-3763055148335758582');" style=""><abbr title=" 522             //Now fill out the relevant properties for the product options for the Skus that were returned"> 522             //Now fill out the relevant properties for the product options for the Skus that were returneðŸ”µ</abbr></span>
<span class="7697812602397668509" onmouseenter="enter('7697812602397668509');" onmouseout="out('7697812602397668509');" style=""> 523             updateProductOptionFieldsForFetch(records, payload);                                         </span>
<span  style=""> 524                                                                                                          </span>
<span class="-8933105127068001704" onmouseenter="enter('-8933105127068001704');" onmouseout="out('-8933105127068001704');" style=""> 525             return new DynamicResultSet(payload, totalRecords);                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 526         } catch (Exception e) {                                                                          </span>
<span class="733531699862187915" onmouseenter="enter('733531699862187915');" onmouseout="out('733531699862187915');" style=""><abbr title=" 527             throw new ServiceException(&quot;Unable to perform fetch for entity: &quot; + ceilingEntityFullyQualifiedClassname, e);"> 527             throw new ServiceException(&quot;Unable to perform fetch for entity: &quot; + ceilingEntityFullyQualifiðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 528         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 529     }                                                                                                    </span>
<span  style=""> 530                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 531     /**                                                                                                  </span>
<span class="-7824652902262605659" onmouseenter="enter('-7824652902262605659');" onmouseout="out('-7824652902262605659');" style=""><abbr title=" 532      * Sets the {@link ProductOptionValue}s of the given {@link Sku}s in a list format for display in a ListGrid context."> 532      * Sets the {@link ProductOptionValue}s of the given {@link Sku}s in a list format for display in a LðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 533      *                                                                                                   </span>
<span class="-4052130305078083276" onmouseenter="enter('-4052130305078083276');" onmouseout="out('-4052130305078083276');" style=""> 534      * @param records                                                                                    </span>
<span class="-6904460697287898969" onmouseenter="enter('-6904460697287898969');" onmouseout="out('-6904460697287898969');" style=""> 535      * @param payload                                                                                    </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 536      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 537      */                                                                                                  </span>
<span class="3124517244149022485" onmouseenter="enter('3124517244149022485');" onmouseout="out('3124517244149022485');" style=""> 538     public void updateProductOptionFieldsForFetch(List&lt;Serializable&gt; records, Entity[] payload) {        </span>
<span class="-7972041122971845939" onmouseenter="enter('-7972041122971845939');" onmouseout="out('-7972041122971845939');" style=""> 539         for (int i = 0; i &lt; records.size(); i++) {                                                       </span>
<span class="-3191004483130397206" onmouseenter="enter('-3191004483130397206');" onmouseout="out('-3191004483130397206');" style=""> 540             Sku sku = (Sku) records.get(i);                                                              </span>
<span class="6067761635845867397" onmouseenter="enter('6067761635845867397');" onmouseout="out('6067761635845867397');" style=""> 541             Entity entity = payload[i];                                                                  </span>
<span  style=""> 542                                                                                                          </span>
<span class="-1747148511640135280" onmouseenter="enter('-1747148511640135280');" onmouseout="out('-1747148511640135280');" style=""><abbr title=" 543             List&lt;ProductOptionValue&gt; optionValues = BLCCollectionUtils.collectList(sku.getProductOptionValueXrefs(), new TypedTransformer&lt;ProductOptionValue&gt;() {"> 543             List&lt;ProductOptionValue&gt; optionValues = BLCCollectionUtils.collectList(sku.getProductOptionVaðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 544                 @Override                                                                                </span>
<span class="1152092933178682803" onmouseenter="enter('1152092933178682803');" onmouseout="out('1152092933178682803');" style=""> 545                 public ProductOptionValue transform(Object input) {                                      </span>
<span class="-8868352318711405431" onmouseenter="enter('-8868352318711405431');" onmouseout="out('-8868352318711405431');" style=""> 546                     return ((SkuProductOptionValueXref) input).getProductOptionValue();                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 547                 }                                                                                        </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 548             });                                                                                          </span>
<span  style=""> 549                                                                                                          </span>
<span class="-1852425527821468846" onmouseenter="enter('-1852425527821468846');" onmouseout="out('-1852425527821468846');" style=""> 550             for (ProductOptionValue value : optionValues) {                                              </span>
<span class="6080984475054679236" onmouseenter="enter('6080984475054679236');" onmouseout="out('6080984475054679236');" style=""> 551                 Property optionProperty = new Property();                                                </span>
<span class="4438211203610377533" onmouseenter="enter('4438211203610377533');" onmouseout="out('4438211203610377533');" style=""> 552                 optionProperty.setName(PRODUCT_OPTION_FIELD_PREFIX + value.getProductOption().getId());  </span>
<span class="-3040338369255071721" onmouseenter="enter('-3040338369255071721');" onmouseout="out('-3040338369255071721');" style=""> 553                 optionProperty.setValue(value.getId().toString());                                       </span>
<span class="4260727162498882307" onmouseenter="enter('4260727162498882307');" onmouseout="out('4260727162498882307');" style=""> 554                 optionProperty.setDisplayValue(value.getAttributeValue());                               </span>
<span class="1859377182209271680" onmouseenter="enter('1859377182209271680');" onmouseout="out('1859377182209271680');" style=""> 555                 entity.addProperty(optionProperty);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 556             }                                                                                            </span>
<span  style=""> 557                                                                                                          </span>
<span class="4597418554840578281" onmouseenter="enter('4597418554840578281');" onmouseout="out('4597418554840578281');" style=""> 558             if (CollectionUtils.isNotEmpty(optionValues)) {                                              </span>
<span class="5213586233451889239" onmouseenter="enter('5213586233451889239');" onmouseout="out('5213586233451889239');" style=""> 559                 entity.addProperty(getConsolidatedOptionProperty(optionValues));                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 560             } else {                                                                                     </span>
<span class="-6341791635059832722" onmouseenter="enter('-6341791635059832722');" onmouseout="out('-6341791635059832722');" style=""> 561                 entity.addProperty(getBlankConsolidatedOptionProperty());                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 562             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 563         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 564     }                                                                                                    </span>
<span  style=""> 565                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 566     /**                                                                                                  </span>
<span class="7787882510504443634" onmouseenter="enter('7787882510504443634');" onmouseout="out('7787882510504443634');" style=""><abbr title=" 567      * Add filter restriction such that a ProductBundle cannot add its own default sku as a Sku Bundle Item"> 567      * Add filter restriction such that a ProductBundle cannot add its own default sku as a Sku Bundle ItðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 568      */                                                                                                  </span>
<span class="-7214039343588646460" onmouseenter="enter('-7214039343588646460');" onmouseout="out('-7214039343588646460');" style=""><abbr title=" 569     private void applySkuBundleItemValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PersistencePackage persistencePackage) {"> 569     private void applySkuBundleItemValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObjeðŸ”µ</abbr></span>
<span class="-8187222964943103604" onmouseenter="enter('-8187222964943103604');" onmouseout="out('-8187222964943103604');" style=""> 570         SectionCrumb[] sectionCrumbs = persistencePackage.getSectionCrumbs();                            </span>
<span class="-1899330423728999759" onmouseenter="enter('-1899330423728999759');" onmouseout="out('-1899330423728999759');" style=""> 571         if (isSkuBundleItemLookup(persistencePackage, sectionCrumbs)) {                                  </span>
<span class="8268114114086125791" onmouseenter="enter('8268114114086125791');" onmouseout="out('8268114114086125791');" style=""> 572             final Long defaultSkuId = getOwningProductBundlesDefaultSkuId(sectionCrumbs[0]);             </span>
<span  style=""> 573                                                                                                          </span>
<span class="8197169377808819118" onmouseenter="enter('8197169377808819118');" onmouseout="out('8197169377808819118');" style=""> 574             filterMappings.add(new FilterMapping()                                                       </span>
<span class="-2686901866072439951" onmouseenter="enter('-2686901866072439951');" onmouseout="out('-2686901866072439951');" style=""> 575                     .withDirectFilterValues(Collections.singletonList(defaultSkuId))                     </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 576                     .withRestriction(new Restriction()                                                   </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 577                                     .withPredicateProvider(new PredicateProvider() {                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 578                                         @Override                                                        </span>
<span class="-6543887403560352788" onmouseenter="enter('-6543887403560352788');" onmouseout="out('-6543887403560352788');" style=""> 579                                         public Predicate buildPredicate(CriteriaBuilder builder,         </span>
<span class="-7125560532692692259" onmouseenter="enter('-7125560532692692259');" onmouseout="out('-7125560532692692259');" style=""> 580                                                 FieldPathBuilder fieldPathBuilder,                       </span>
<span class="8221798817053541417" onmouseenter="enter('8221798817053541417');" onmouseout="out('8221798817053541417');" style=""> 581                                                 From root, String ceilingEntity,                         </span>
<span class="-5624751861859036647" onmouseenter="enter('-5624751861859036647');" onmouseout="out('-5624751861859036647');" style=""> 582                                                 String fullPropertyName, Path explicitPath,              </span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style=""> 583                                                 List directValues) {                                     </span>
<span class="4460015033870714518" onmouseenter="enter('4460015033870714518');" onmouseout="out('4460015033870714518');" style=""> 584                                             return builder.notEqual(root, directValues.get(0));          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 585                                         }                                                                </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 586                                     })                                                                   </span>
<span class="3699784701886273761" onmouseenter="enter('3699784701886273761');" onmouseout="out('3699784701886273761');" style=""> 587                     ));                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 588         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 589     }                                                                                                    </span>
<span  style=""> 590                                                                                                          </span>
<span class="-2798114006144580065" onmouseenter="enter('-2798114006144580065');" onmouseout="out('-2798114006144580065');" style=""> 591     private boolean isSkuBundleItemLookup(PersistencePackage pkg, SectionCrumb[] sectionCrumbs) {        </span>
<span class="1586917148156434191" onmouseenter="enter('1586917148156434191');" onmouseout="out('1586917148156434191');" style=""> 592         boolean owningClassMatch = false;                                                                </span>
<span class="-67344974392233049" onmouseenter="enter('-67344974392233049');" onmouseout="out('-67344974392233049');" style=""> 593         boolean requestingFieldMatch = false;                                                            </span>
<span  style=""> 594                                                                                                          </span>
<span class="-4586108065315097422" onmouseenter="enter('-4586108065315097422');" onmouseout="out('-4586108065315097422');" style=""> 595         if (pkg.getCustomCriteria() == null || ArrayUtils.isEmpty(sectionCrumbs)) {                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 596             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 597         }                                                                                                </span>
<span  style=""> 598                                                                                                          </span>
<span class="-2549092676085499199" onmouseenter="enter('-2549092676085499199');" onmouseout="out('-2549092676085499199');" style=""> 599         for (String criteria : pkg.getCustomCriteria()) {                                                </span>
<span class="-2108620833305617258" onmouseenter="enter('-2108620833305617258');" onmouseout="out('-2108620833305617258');" style=""><abbr title=" 600             if (&quot;owningClass=org.broadleafcommerce.core.catalog.domain.SkuBundleItemImpl&quot;.equals(criteria)) {"> 600             if (&quot;owningClass=org.broadleafcommerce.core.catalog.domain.SkuBundleItemImpl&quot;.equals(criteriaðŸ”µ</abbr></span>
<span class="8041666773318789268" onmouseenter="enter('8041666773318789268');" onmouseout="out('8041666773318789268');" style=""> 601                 owningClassMatch = true;                                                                 </span>
<span class="4858029770045852471" onmouseenter="enter('4858029770045852471');" onmouseout="out('4858029770045852471');" style=""> 602             } else if (&quot;requestingField=sku&quot;.equals(criteria)) {                                         </span>
<span class="-1860793199325339033" onmouseenter="enter('-1860793199325339033');" onmouseout="out('-1860793199325339033');" style=""> 603                 requestingFieldMatch = true;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 604             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 605         }                                                                                                </span>
<span  style=""> 606                                                                                                          </span>
<span class="-3217646211476483325" onmouseenter="enter('-3217646211476483325');" onmouseout="out('-3217646211476483325');" style=""><abbr title=" 607         boolean sectionCrumbMatch = ProductImpl.class.getCanonicalName().equals(sectionCrumbs[0].getSectionIdentifier());"> 607         boolean sectionCrumbMatch = ProductImpl.class.getCanonicalName().equals(sectionCrumbs[0].getSectiðŸ”µ</abbr></span>
<span  style=""> 608                                                                                                          </span>
<span class="6240774352197414719" onmouseenter="enter('6240774352197414719');" onmouseout="out('6240774352197414719');" style=""> 609         return owningClassMatch &amp;&amp; requestingFieldMatch &amp;&amp; sectionCrumbMatch;                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 610     }                                                                                                    </span>
<span  style=""> 611                                                                                                          </span>
<span class="-1671571892486457707" onmouseenter="enter('-1671571892486457707');" onmouseout="out('-1671571892486457707');" style=""> 612     private Long getOwningProductBundlesDefaultSkuId(SectionCrumb sectionCrumb) {                        </span>
<span class="2328697212854986127" onmouseenter="enter('2328697212854986127');" onmouseout="out('2328697212854986127');" style=""> 613         if (ProductImpl.class.getCanonicalName().equals(sectionCrumb.getSectionIdentifier())             </span>
<span class="-9004648441586212047" onmouseenter="enter('-9004648441586212047');" onmouseout="out('-9004648441586212047');" style=""> 614                 &amp;&amp; sectionCrumb.getSectionId() != null) {                                                </span>
<span class="4513323716586759964" onmouseenter="enter('4513323716586759964');" onmouseout="out('4513323716586759964');" style=""><abbr title=" 615             ProductBundle productBundle = (ProductBundle) catalogService.findProductById(Long.valueOf(sectionCrumb.getSectionId()));"> 615             ProductBundle productBundle = (ProductBundle) catalogService.findProductById(Long.valueOf(secðŸ”µ</abbr></span>
<span class="4400035530065637673" onmouseenter="enter('4400035530065637673');" onmouseout="out('4400035530065637673');" style=""> 616             return productBundle.getDefaultSku().getId();                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 617         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 618         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 619     }                                                                                                    </span>
<span  style=""> 620                                                                                                          </span>
<span class="-7687230963098454148" onmouseenter="enter('-7687230963098454148');" onmouseout="out('-7687230963098454148');" style=""><abbr title=" 621     public void applyProductOptionValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PersistencePackage persistencePackage, String skuPropertyPrefix) {"> 621     public void applyProductOptionValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObjecðŸ”µ</abbr></span>
<span  style=""> 622                                                                                                          </span>
<span class="942620444934049587" onmouseenter="enter('942620444934049587');" onmouseout="out('942620444934049587');" style=""> 623         //if the front                                                                                   </span>
<span class="8112796229062982729" onmouseenter="enter('8112796229062982729');" onmouseout="out('8112796229062982729');" style=""> 624         final List&lt;Long&gt; productOptionValueFilterIDs = new ArrayList&lt;&gt;();                                </span>
<span class="-6853245302921753815" onmouseenter="enter('-6853245302921753815');" onmouseout="out('-6853245302921753815');" style=""> 625         for (String filterProperty : cto.getCriteriaMap().keySet()) {                                    </span>
<span class="-4107857553734806058" onmouseenter="enter('-4107857553734806058');" onmouseout="out('-4107857553734806058');" style=""> 626             if (filterProperty.startsWith(PRODUCT_OPTION_FIELD_PREFIX)) {                                </span>
<span class="-1621748473978415179" onmouseenter="enter('-1621748473978415179');" onmouseout="out('-1621748473978415179');" style=""> 627                 FilterAndSortCriteria criteria = cto.get(filterProperty);                                </span>
<span class="5553495253525789791" onmouseenter="enter('5553495253525789791');" onmouseout="out('5553495253525789791');" style=""> 628                 productOptionValueFilterIDs.add(Long.parseLong(criteria.getFilterValues().get(0)));      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 629             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 630         }                                                                                                </span>
<span  style=""> 631                                                                                                          </span>
<span class="4522856558687017152" onmouseenter="enter('4522856558687017152');" onmouseout="out('4522856558687017152');" style=""> 632         //also determine if there is a consolidated POV query                                            </span>
<span class="-8501099544391483771" onmouseenter="enter('-8501099544391483771');" onmouseout="out('-8501099544391483771');" style=""> 633         final List&lt;String&gt; productOptionValueFilterValues = new ArrayList&lt;&gt;();                           </span>
<span class="-3774683769233331029" onmouseenter="enter('-3774683769233331029');" onmouseout="out('-3774683769233331029');" style=""> 634         FilterAndSortCriteria consolidatedCriteria = cto.get(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);   </span>
<span class="3919937138964866453" onmouseenter="enter('3919937138964866453');" onmouseout="out('3919937138964866453');" style=""> 635         if (!consolidatedCriteria.getFilterValues().isEmpty()) {                                         </span>
<span class="-8697432381506519263" onmouseenter="enter('-8697432381506519263');" onmouseout="out('-8697432381506519263');" style=""> 636             //the criteria in this case would be a semi-colon delimeter value list                       </span>
<span class="-2544935018250883467" onmouseenter="enter('-2544935018250883467');" onmouseout="out('-2544935018250883467');" style=""><abbr title=" 637             productOptionValueFilterValues.addAll(Arrays.asList(StringUtils.split(consolidatedCriteria.getFilterValues().get(0), CONSOLIDATED_PRODUCT_OPTIONS_DELIMETER)));"> 637             productOptionValueFilterValues.addAll(Arrays.asList(StringUtils.split(consolidatedCriteria.geðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 638         }                                                                                                </span>
<span  style=""> 639                                                                                                          </span>
<span class="-3296023389552605288" onmouseenter="enter('-3296023389552605288');" onmouseout="out('-3296023389552605288');" style=""> 640         if (productOptionValueFilterIDs.size() &gt; 0) {                                                    </span>
<span class="-3028331070500986006" onmouseenter="enter('-3028331070500986006');" onmouseout="out('-3028331070500986006');" style=""> 641             FilterMapping filterMapping = new FilterMapping()                                            </span>
<span class="3198376136531373476" onmouseenter="enter('3198376136531373476');" onmouseout="out('3198376136531373476');" style=""><abbr title=" 642                 .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?&quot;&quot;:skuPropertyPrefix + &quot;.productOptionValueXrefs.productOptionValue.id&quot;))"> 642                 .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?ðŸ”µ</abbr></span>
<span class="-3630476675353547213" onmouseenter="enter('-3630476675353547213');" onmouseout="out('-3630476675353547213');" style=""> 643                 .withDirectFilterValues(productOptionValueFilterIDs)                                     </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 644                 .withRestriction(new Restriction()                                                       </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 645                     .withPredicateProvider(new PredicateProvider() {                                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 646                         @Override                                                                        </span>
<span class="-33431144742852463" onmouseenter="enter('-33431144742852463');" onmouseout="out('-33431144742852463');" style=""><abbr title=" 647                         public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,"> 647                         public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPaðŸ”µ</abbr></span>
<span class="8221798817053541417" onmouseenter="enter('8221798817053541417');" onmouseout="out('8221798817053541417');" style=""> 648                                                         From root, String ceilingEntity,                 </span>
<span class="-6963673837518342908" onmouseenter="enter('-6963673837518342908');" onmouseout="out('-6963673837518342908');" style=""><abbr title=" 649                                                         String fullPropertyName, Path explicitPath, List directValues) {"> 649                                                         String fullPropertyName, Path explicitPath, List ðŸ”µ</abbr></span>
<span class="-6719486958351285112" onmouseenter="enter('-6719486958351285112');" onmouseout="out('-6719486958351285112');" style=""> 650                             return explicitPath.as(Long.class).in(directValues);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 651                         }                                                                                </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 652                     })                                                                                   </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 653                 );                                                                                       </span>
<span class="-2605411155138525883" onmouseenter="enter('-2605411155138525883');" onmouseout="out('-2605411155138525883');" style=""> 654             filterMappings.add(filterMapping);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 655         }                                                                                                </span>
<span class="36743717647982951" onmouseenter="enter('36743717647982951');" onmouseout="out('36743717647982951');" style=""> 656         if (productOptionValueFilterValues.size() &gt; 0) {                                                 </span>
<span class="-3028331070500986006" onmouseenter="enter('-3028331070500986006');" onmouseout="out('-3028331070500986006');" style=""> 657             FilterMapping filterMapping = new FilterMapping()                                            </span>
<span class="8503258665314341487" onmouseenter="enter('8503258665314341487');" onmouseout="out('8503258665314341487');" style=""><abbr title=" 658                 .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?&quot;&quot;:skuPropertyPrefix + &quot;.productOptionValueXrefs.productOptionValue.attributeValue&quot;))"> 658                 .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?ðŸ”µ</abbr></span>
<span class="-7312773306171765245" onmouseenter="enter('-7312773306171765245');" onmouseout="out('-7312773306171765245');" style=""> 659                 .withDirectFilterValues(productOptionValueFilterValues)                                  </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 660                 .withRestriction(new Restriction()                                                       </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 661                     .withPredicateProvider(new PredicateProvider() {                                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 662                         @Override                                                                        </span>
<span class="-33431144742852463" onmouseenter="enter('-33431144742852463');" onmouseout="out('-33431144742852463');" style=""><abbr title=" 663                         public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,"> 663                         public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPaðŸ”µ</abbr></span>
<span class="8221798817053541417" onmouseenter="enter('8221798817053541417');" onmouseout="out('8221798817053541417');" style=""> 664                                                         From root, String ceilingEntity,                 </span>
<span class="-6963673837518342908" onmouseenter="enter('-6963673837518342908');" onmouseout="out('-6963673837518342908');" style=""><abbr title=" 665                                                         String fullPropertyName, Path explicitPath, List directValues) {"> 665                                                         String fullPropertyName, Path explicitPath, List ðŸ”µ</abbr></span>
<span class="-2981715763030013918" onmouseenter="enter('-2981715763030013918');" onmouseout="out('-2981715763030013918');" style=""> 666                             return explicitPath.as(String.class).in(directValues);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 667                         }                                                                                </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 668                     })                                                                                   </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 669                 );                                                                                       </span>
<span class="-2605411155138525883" onmouseenter="enter('-2605411155138525883');" onmouseout="out('-2605411155138525883');" style=""> 670             filterMappings.add(filterMapping);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 671         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 672     }                                                                                                    </span>
<span  style=""> 673                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 674     /**                                                                                                  </span>
<span class="-8618302828054746698" onmouseenter="enter('-8618302828054746698');" onmouseout="out('-8618302828054746698');" style=""><abbr title=" 675      * &lt;p&gt;Available override point for subclasses if they would like to add additional criteria via the queryCritiera. At the"> 675      * &lt;p&gt;Available override point for subclasses if they would like to add additional criteria via the qðŸ”µ</abbr></span>
<span class="5710282049517599386" onmouseenter="enter('5710282049517599386');" onmouseout="out('5710282049517599386');" style=""><abbr title=" 676      * point that this method has been called, criteria from the frontend has already been applied, thus allowing you to"> 676      * point that this method has been called, criteria from the frontend has already been applied, thus ðŸ”µ</abbr></span>
<span class="-8977449216901818262" onmouseenter="enter('-8977449216901818262');" onmouseout="out('-8977449216901818262');" style=""> 677      * override from there as well.&lt;/p&gt;                                                                  </span>
<span class="6192892703049124137" onmouseenter="enter('6192892703049124137');" onmouseout="out('6192892703049124137');" style=""><abbr title=" 678      * &lt;p&gt;Subclasses that choose to override this should also call this super method so that correct filter criteria"> 678      * &lt;p&gt;Subclasses that choose to override this should also call this super method so that correct filtðŸ”µ</abbr></span>
<span class="4504111184556558489" onmouseenter="enter('4504111184556558489');" onmouseout="out('4504111184556558489');" style=""> 679      * can be applied for product option values&lt;/p&gt;                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 680      *                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 681      */                                                                                                  </span>
<span class="6595350754076949595" onmouseenter="enter('6595350754076949595');" onmouseout="out('6595350754076949595');" style=""><abbr title=" 682     public void applyAdditionalFetchCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PersistencePackage persistencePackage) {"> 682     public void applyAdditionalFetchCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cðŸ”µ</abbr></span>
<span class="-9143014012238338039" onmouseenter="enter('-9143014012238338039');" onmouseout="out('-9143014012238338039');" style=""> 683         //unimplemented                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 684     }                                                                                                    </span>
<span  style=""> 685                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 686     @Override                                                                                            </span>
<span class="-3782560920985534584" onmouseenter="enter('-3782560920985534584');" onmouseout="out('-3782560920985534584');" style=""><abbr title=" 687     public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 687     public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 688         Entity entity = persistencePackage.getEntity();                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 689         try {                                                                                            </span>
<span class="2168419604722842668" onmouseenter="enter('2168419604722842668');" onmouseout="out('2168419604722842668');" style=""> 690             //Fill out the Sku instance from the form                                                    </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""><abbr title=" 691             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();"> 691             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective(ðŸ”µ</abbr></span>
<span class="-2646375190695846844" onmouseenter="enter('-2646375190695846844');" onmouseout="out('-2646375190695846844');" style=""> 692             Sku adminInstance = (Sku) Class.forName(entity.getType()[0]).newInstance();                  </span>
<span class="1729465429044706845" onmouseenter="enter('1729465429044706845');" onmouseout="out('1729465429044706845');" style=""><abbr title=" 693             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getName(), persistencePerspective);"> 693             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getNaðŸ”µ</abbr></span>
<span class="-7453227611519095000" onmouseenter="enter('-7453227611519095000');" onmouseout="out('-7453227611519095000');" style=""> 694             filterOutProductMetadata(adminProperties);                                                   </span>
<span class="2916291722905579881" onmouseenter="enter('2916291722905579881');" onmouseout="out('2916291722905579881');" style=""><abbr title=" 695             adminInstance = (Sku) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);"> 695             adminInstance = (Sku) helper.createPopulatedInstance(adminInstance, entity, adminProperties, ðŸ”µ</abbr></span>
<span  style=""> 696                                                                                                          </span>
<span class="561479470093632813" onmouseenter="enter('561479470093632813');" onmouseout="out('561479470093632813');" style=""> 697             //Verify that there isn&#x27;t already a Sku for this particular product option value combo       </span>
<span class="-7646105610360359073" onmouseenter="enter('-7646105610360359073');" onmouseout="out('-7646105610360359073');" style=""> 698             Entity errorEntity = validateUniqueProductOptionValueCombination(adminInstance.getProduct(), </span>
<span class="7978785476337646518" onmouseenter="enter('7978785476337646518');" onmouseout="out('7978785476337646518');" style=""><abbr title=" 699                                                                              getProductOptionProperties(entity),"> 699                                                                              getProductOptionProperties(eðŸ”µ</abbr></span>
<span class="-5950258146809433717" onmouseenter="enter('-5950258146809433717');" onmouseout="out('-5950258146809433717');" style=""> 700                                                                              null);                      </span>
<span class="315758838568217561" onmouseenter="enter('315758838568217561');" onmouseout="out('315758838568217561');" style=""> 701             if (errorEntity != null) {                                                                   </span>
<span class="-6380597201056661281" onmouseenter="enter('-6380597201056661281');" onmouseout="out('-6380597201056661281');" style=""> 702                 entity.setPropertyValidationErrors(errorEntity.getPropertyValidationErrors());           </span>
<span class="-7572797105708032926" onmouseenter="enter('-7572797105708032926');" onmouseout="out('-7572797105708032926');" style=""> 703                 return entity;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 704             }                                                                                            </span>
<span  style=""> 705                                                                                                          </span>
<span class="-5884073955982735941" onmouseenter="enter('-5884073955982735941');" onmouseout="out('-5884073955982735941');" style=""> 706             //persist the newly-created Sku                                                              </span>
<span class="8006946942803724880" onmouseenter="enter('8006946942803724880');" onmouseout="out('8006946942803724880');" style=""> 707             adminInstance = dynamicEntityDao.persist(adminInstance);                                     </span>
<span  style=""> 708                                                                                                          </span>
<span class="-704220126533799367" onmouseenter="enter('-704220126533799367');" onmouseout="out('-704220126533799367');" style=""> 709             //associate the product option values                                                        </span>
<span class="4472814042081188939" onmouseenter="enter('4472814042081188939');" onmouseout="out('4472814042081188939');" style=""> 710             associateProductOptionValuesToSku(entity, adminInstance, dynamicEntityDao);                  </span>
<span  style=""> 711                                                                                                          </span>
<span class="-5246565985745556188" onmouseenter="enter('-5246565985745556188');" onmouseout="out('-5246565985745556188');" style=""> 712             //After associating the product option values, save off the Sku                              </span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 713             adminInstance = dynamicEntityDao.merge(adminInstance);                                       </span>
<span  style=""> 714                                                                                                          </span>
<span class="-2729035098975137606" onmouseenter="enter('-2729035098975137606');" onmouseout="out('-2729035098975137606');" style=""> 715             //Fill out the DTO and add in the product option value properties to it                      </span>
<span class="8927160133375333586" onmouseenter="enter('8927160133375333586');" onmouseout="out('8927160133375333586');" style=""> 716             Entity result = helper.getRecord(adminProperties, adminInstance, null, null);                </span>
<span class="-1352652314153256295" onmouseenter="enter('-1352652314153256295');" onmouseout="out('-1352652314153256295');" style=""> 717             for (Property property : getProductOptionProperties(entity)) {                               </span>
<span class="-6991744037283748574" onmouseenter="enter('-6991744037283748574');" onmouseout="out('-6991744037283748574');" style=""> 718                 result.addProperty(property);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 719             }                                                                                            </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 720             return result;                                                                               </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 721         } catch (Exception e) {                                                                          </span>
<span class="3314391270131938130" onmouseenter="enter('3314391270131938130');" onmouseout="out('3314391270131938130');" style=""> 722             throw new ServiceException(&quot;Unable to perform fetch for entity: &quot; + Sku.class.getName(), e); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 723         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 724     }                                                                                                    </span>
<span  style=""> 725                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 726     @Override                                                                                            </span>
<span class="-7421665622225711363" onmouseenter="enter('-7421665622225711363');" onmouseout="out('-7421665622225711363');" style=""><abbr title=" 727     public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 727     public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 728         Entity entity = persistencePackage.getEntity();                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 729         try {                                                                                            </span>
<span class="2168419604722842668" onmouseenter="enter('2168419604722842668');" onmouseout="out('2168419604722842668');" style=""> 730             //Fill out the Sku instance from the form                                                    </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""><abbr title=" 731             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();"> 731             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective(ðŸ”µ</abbr></span>
<span class="1729465429044706845" onmouseenter="enter('1729465429044706845');" onmouseout="out('1729465429044706845');" style=""><abbr title=" 732             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getName(), persistencePerspective);"> 732             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getNaðŸ”µ</abbr></span>
<span class="-7453227611519095000" onmouseenter="enter('-7453227611519095000');" onmouseout="out('-7453227611519095000');" style=""> 733             filterOutProductMetadata(adminProperties);                                                   </span>
<span class="-5056229965271915337" onmouseenter="enter('-5056229965271915337');" onmouseout="out('-5056229965271915337');" style=""> 734             Object primaryKey = helper.getPrimaryKey(entity, adminProperties);                           </span>
<span class="5076299244443205355" onmouseenter="enter('5076299244443205355');" onmouseout="out('5076299244443205355');" style=""><abbr title=" 735             Sku adminInstance = (Sku) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]), primaryKey);"> 735             Sku adminInstance = (Sku) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]), primaðŸ”µ</abbr></span>
<span class="2916291722905579881" onmouseenter="enter('2916291722905579881');" onmouseout="out('2916291722905579881');" style=""><abbr title=" 736             adminInstance = (Sku) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);"> 736             adminInstance = (Sku) helper.createPopulatedInstance(adminInstance, entity, adminProperties, ðŸ”µ</abbr></span>
<span  style=""> 737                                                                                                          </span>
<span class="561479470093632813" onmouseenter="enter('561479470093632813');" onmouseout="out('561479470093632813');" style=""> 738             //Verify that there isn&#x27;t already a Sku for this particular product option value combo       </span>
<span class="-7646105610360359073" onmouseenter="enter('-7646105610360359073');" onmouseout="out('-7646105610360359073');" style=""> 739             Entity errorEntity = validateUniqueProductOptionValueCombination(adminInstance.getProduct(), </span>
<span class="7978785476337646518" onmouseenter="enter('7978785476337646518');" onmouseout="out('7978785476337646518');" style=""><abbr title=" 740                                                                             getProductOptionProperties(entity),"> 740                                                                             getProductOptionProperties(enðŸ”µ</abbr></span>
<span class="-2741785419016191367" onmouseenter="enter('-2741785419016191367');" onmouseout="out('-2741785419016191367');" style=""> 741                                                                             adminInstance);              </span>
<span class="315758838568217561" onmouseenter="enter('315758838568217561');" onmouseout="out('315758838568217561');" style=""> 742             if (errorEntity != null) {                                                                   </span>
<span class="-6380597201056661281" onmouseenter="enter('-6380597201056661281');" onmouseout="out('-6380597201056661281');" style=""> 743                 entity.setPropertyValidationErrors(errorEntity.getPropertyValidationErrors());           </span>
<span class="-7572797105708032926" onmouseenter="enter('-7572797105708032926');" onmouseout="out('-7572797105708032926');" style=""> 744                 return entity;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 745             }                                                                                            </span>
<span  style=""> 746                                                                                                          </span>
<span class="-1592345858824912592" onmouseenter="enter('-1592345858824912592');" onmouseout="out('-1592345858824912592');" style=""> 747             // Only modify product options if this ISN&#x27;T an update for inventory properties              </span>
<span class="-4074871831516694131" onmouseenter="enter('-4074871831516694131');" onmouseout="out('-4074871831516694131');" style=""> 748             if (!persistencePackage.containsCriteria(INVENTORY_ONLY_CRITERIA)) {                         </span>
<span class="4472814042081188939" onmouseenter="enter('4472814042081188939');" onmouseout="out('4472814042081188939');" style=""> 749                 associateProductOptionValuesToSku(entity, adminInstance, dynamicEntityDao);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 750             }                                                                                            </span>
<span  style=""> 751                                                                                                          </span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 752             adminInstance = dynamicEntityDao.merge(adminInstance);                                       </span>
<span  style=""> 753                                                                                                          </span>
<span class="6972089533394912781" onmouseenter="enter('6972089533394912781');" onmouseout="out('6972089533394912781');" style=""> 754             extensionManager.getProxy().skuUpdated(adminInstance);                                       </span>
<span  style=""> 755                                                                                                          </span>
<span class="-2729035098975137606" onmouseenter="enter('-2729035098975137606');" onmouseout="out('-2729035098975137606');" style=""> 756             //Fill out the DTO and add in the product option value properties to it                      </span>
<span class="8927160133375333586" onmouseenter="enter('8927160133375333586');" onmouseout="out('8927160133375333586');" style=""> 757             Entity result = helper.getRecord(adminProperties, adminInstance, null, null);                </span>
<span class="-1352652314153256295" onmouseenter="enter('-1352652314153256295');" onmouseout="out('-1352652314153256295');" style=""> 758             for (Property property : getProductOptionProperties(entity)) {                               </span>
<span class="-6991744037283748574" onmouseenter="enter('-6991744037283748574');" onmouseout="out('-6991744037283748574');" style=""> 759                 result.addProperty(property);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 760             }                                                                                            </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 761             return result;                                                                               </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 762         } catch (Exception e) {                                                                          </span>
<span class="-5937019774393085643" onmouseenter="enter('-5937019774393085643');" onmouseout="out('-5937019774393085643');" style=""> 763             throw new ServiceException(&quot;Unable to perform update for entity: &quot; + Sku.class.getName(), e);</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 764         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 765     }                                                                                                    </span>
<span  style=""> 766                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 767     @Override                                                                                            </span>
<span class="9216576132440445278" onmouseenter="enter('9216576132440445278');" onmouseout="out('9216576132440445278');" style=""> 768     protected String[] getPolymorphicClasses(Class&lt;?&gt; clazz, EntityManager em, boolean useCache) {       </span>
<span class="858198974140428987" onmouseenter="enter('858198974140428987');" onmouseout="out('858198974140428987');" style=""> 769         DynamicDaoHelperImpl helper = new DynamicDaoHelperImpl();                                        </span>
<span class="5646922235819357545" onmouseenter="enter('5646922235819357545');" onmouseout="out('5646922235819357545');" style=""> 770         Class&lt;?&gt;[] classes = helper.getAllPolymorphicEntitiesFromCeiling(clazz, true, useCache);         </span>
<span class="5925953156034592661" onmouseenter="enter('5925953156034592661');" onmouseout="out('5925953156034592661');" style=""> 771         String[] result = new String[classes.length];                                                    </span>
<span class="-8402235850457988496" onmouseenter="enter('-8402235850457988496');" onmouseout="out('-8402235850457988496');" style=""> 772         for (int i = 0; i &lt; classes.length; i++) {                                                       </span>
<span class="-4624814724789256168" onmouseenter="enter('-4624814724789256168');" onmouseout="out('-4624814724789256168');" style=""> 773             result[i] = classes[i].getName();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 774         }                                                                                                </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 775         return result;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 776     }                                                                                                    </span>
<span  style=""> 777                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 778     /**                                                                                                  </span>
<span class="-7623474717715637457" onmouseenter="enter('-7623474717715637457');" onmouseout="out('-7623474717715637457');" style=""><abbr title=" 779      * This initially removes all of the product option values that are currently related to the Sku and then re-associates"> 779      * This initially removes all of the product option values that are currently related to the Sku and ðŸ”µ</abbr></span>
<span class="919168598745235587" onmouseenter="enter('919168598745235587');" onmouseout="out('919168598745235587');" style=""> 780      * the {@link ProductOptionValue}s                                                                   </span>
<span class="5381683285013722867" onmouseenter="enter('5381683285013722867');" onmouseout="out('5381683285013722867');" style=""> 781      * @param entity                                                                                     </span>
<span class="-3727775444071594306" onmouseenter="enter('-3727775444071594306');" onmouseout="out('-3727775444071594306');" style=""> 782      * @param adminInstance                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 783      */                                                                                                  </span>
<span class="-5580154930501003130" onmouseenter="enter('-5580154930501003130');" onmouseout="out('-5580154930501003130');" style=""><abbr title=" 784     protected void associateProductOptionValuesToSku(Entity entity, Sku adminInstance, DynamicEntityDao dynamicEntityDao) {"> 784     protected void associateProductOptionValuesToSku(Entity entity, Sku adminInstance, DynamicEntityDao dðŸ”µ</abbr></span>
<span class="-2108418430173822456" onmouseenter="enter('-2108418430173822456');" onmouseout="out('-2108418430173822456');" style=""> 785         //Get the list of product option value ids that were selected from the form                      </span>
<span class="1634824265941381194" onmouseenter="enter('1634824265941381194');" onmouseout="out('1634824265941381194');" style=""> 786         List&lt;Long&gt; productOptionValueIds = new ArrayList&lt;&gt;();                                            </span>
<span class="-1352652314153256295" onmouseenter="enter('-1352652314153256295');" onmouseout="out('-1352652314153256295');" style=""> 787         for (Property property : getProductOptionProperties(entity)) {                                   </span>
<span class="-2394430384756952955" onmouseenter="enter('-2394430384756952955');" onmouseout="out('-2394430384756952955');" style=""> 788             Long propId = Long.parseLong(property.getValue());                                           </span>
<span class="-4973643473801343364" onmouseenter="enter('-4973643473801343364');" onmouseout="out('-4973643473801343364');" style=""> 789             productOptionValueIds.add(propId);                                                           </span>
<span class="882791416935144082" onmouseenter="enter('882791416935144082');" onmouseout="out('882791416935144082');" style=""> 790             property.setIsDirty(true);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 791         }                                                                                                </span>
<span  style=""> 792                                                                                                          </span>
<span class="5599600967733699964" onmouseenter="enter('5599600967733699964');" onmouseout="out('5599600967733699964');" style=""> 793         // Only process associations if product option value changes came in via the form                </span>
<span class="-927227770795358535" onmouseenter="enter('-927227770795358535');" onmouseout="out('-927227770795358535');" style=""> 794         if (CollectionUtils.isNotEmpty(productOptionValueIds)) {                                         </span>
<span class="-836715987756422691" onmouseenter="enter('-836715987756422691');" onmouseout="out('-836715987756422691');" style=""> 795             //remove the current list of product option values from the Sku                              </span>
<span class="3024457150101065569" onmouseenter="enter('3024457150101065569');" onmouseout="out('3024457150101065569');" style=""> 796             if (adminInstance.getProductOptionValueXrefs().size() &gt; 0) {                                 </span>
<span class="-348971082300775720" onmouseenter="enter('-348971082300775720');" onmouseout="out('-348971082300775720');" style=""><abbr title=" 797                 Iterator&lt;SkuProductOptionValueXref&gt; iterator = adminInstance.getProductOptionValueXrefs().iterator();"> 797                 Iterator&lt;SkuProductOptionValueXref&gt; iterator = adminInstance.getProductOptionValueXrefs()ðŸ”µ</abbr></span>
<span class="977968488612897428" onmouseenter="enter('977968488612897428');" onmouseout="out('977968488612897428');" style=""> 798                 while (iterator.hasNext()) {                                                             </span>
<span class="296261963919855061" onmouseenter="enter('296261963919855061');" onmouseout="out('296261963919855061');" style=""> 799                     dynamicEntityDao.remove(iterator.next());                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 800                 }                                                                                        </span>
<span class="-7399149246786578987" onmouseenter="enter('-7399149246786578987');" onmouseout="out('-7399149246786578987');" style=""> 801                 dynamicEntityDao.merge(adminInstance);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 802             }                                                                                            </span>
<span  style=""> 803                                                                                                          </span>
<span class="-4534125068586212273" onmouseenter="enter('-4534125068586212273');" onmouseout="out('-4534125068586212273');" style=""> 804             //Associate the product option values from the form with the Sku                             </span>
<span class="-2263388685273571690" onmouseenter="enter('-2263388685273571690');" onmouseout="out('-2263388685273571690');" style=""> 805             for (Long id : productOptionValueIds) {                                                      </span>
<span class="-1845535430062096532" onmouseenter="enter('-1845535430062096532');" onmouseout="out('-1845535430062096532');" style=""><abbr title=" 806                 //Simply find the changed ProductOptionValues directly - seems to work better with sandboxing code"> 806                 //Simply find the changed ProductOptionValues directly - seems to work better with sandboðŸ”µ</abbr></span>
<span class="-2351207014655688291" onmouseenter="enter('-2351207014655688291');" onmouseout="out('-2351207014655688291');" style=""><abbr title=" 807                 ProductOptionValue pov = (ProductOptionValue) dynamicEntityDao.find(ProductOptionValueImpl.class, id);"> 807                 ProductOptionValue pov = (ProductOptionValue) dynamicEntityDao.find(ProductOptionValueImpðŸ”µ</abbr></span>
<span class="6521746250086557424" onmouseenter="enter('6521746250086557424');" onmouseout="out('6521746250086557424');" style=""> 808                 SkuProductOptionValueXref xref = new SkuProductOptionValueXrefImpl(adminInstance, pov);  </span>
<span class="-8084022359180624494" onmouseenter="enter('-8084022359180624494');" onmouseout="out('-8084022359180624494');" style=""> 809                 xref = dynamicEntityDao.merge(xref);                                                     </span>
<span class="-4176466516175169486" onmouseenter="enter('-4176466516175169486');" onmouseout="out('-4176466516175169486');" style=""> 810                 adminInstance.getProductOptionValueXrefs().add(xref);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 811             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 812         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 813     }                                                                                                    </span>
<span  style=""> 814                                                                                                          </span>
<span class="-7856904959937096406" onmouseenter="enter('-7856904959937096406');" onmouseout="out('-7856904959937096406');" style=""> 815     protected List&lt;Property&gt; getProductOptionProperties(Entity entity) {                                 </span>
<span class="-8583115342580003925" onmouseenter="enter('-8583115342580003925');" onmouseout="out('-8583115342580003925');" style=""> 816         List&lt;Property&gt; productOptionProperties = new ArrayList&lt;&gt;();                                      </span>
<span class="-5346955267205588229" onmouseenter="enter('-5346955267205588229');" onmouseout="out('-5346955267205588229');" style=""> 817         for (Property property : entity.getProperties()) {                                               </span>
<span class="-4364715296212150710" onmouseenter="enter('-4364715296212150710');" onmouseout="out('-4364715296212150710');" style=""> 818             if (property.getName().startsWith(PRODUCT_OPTION_FIELD_PREFIX)) {                            </span>
<span class="4660153000567545168" onmouseenter="enter('4660153000567545168');" onmouseout="out('4660153000567545168');" style=""> 819                 productOptionProperties.add(property);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 820             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 821         }                                                                                                </span>
<span class="-7955791568854160092" onmouseenter="enter('-7955791568854160092');" onmouseout="out('-7955791568854160092');" style=""> 822         return productOptionProperties;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 823     }                                                                                                    </span>
<span  style=""> 824                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 825     /**                                                                                                  </span>
<span class="1365192302683773708" onmouseenter="enter('1365192302683773708');" onmouseout="out('1365192302683773708');" style=""><abbr title=" 826      * Ensures that the given list of {@link ProductOptionValue} IDs is unique for the given {@link Product}."> 826      * Ensures that the given list of {@link ProductOptionValue} IDs is unique for the given {@link ProduðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 827      *                                                                                                   </span>
<span class="181270108197628031" onmouseenter="enter('181270108197628031');" onmouseout="out('181270108197628031');" style=""><abbr title=" 828      * If sku browsing is enabled, then it is assumed that a single combination of {@link ProductOptionValue} IDs"> 828      * If sku browsing is enabled, then it is assumed that a single combination of {@link ProductOptionVaðŸ”µ</abbr></span>
<span class="-9042834622684422857" onmouseenter="enter('-9042834622684422857');" onmouseout="out('-9042834622684422857');" style=""><abbr title=" 829      * is not unique and more than one {@link Sku} could have the exact same combination of {@link ProductOptionValue} IDs."> 829      * is not unique and more than one {@link Sku} could have the exact same combination of {@link ProducðŸ”µ</abbr></span>
<span class="8880319067663877918" onmouseenter="enter('8880319067663877918');" onmouseout="out('8880319067663877918');" style=""> 830      * In this case, the following validation is skipped.                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 831      *                                                                                                   </span>
<span class="-1391920893822957351" onmouseenter="enter('-1391920893822957351');" onmouseout="out('-1391920893822957351');" style=""> 832      * @param product                                                                                    </span>
<span class="-5594036901015815590" onmouseenter="enter('-5594036901015815590');" onmouseout="out('-5594036901015815590');" style=""> 833      * @param productOptionProperties                                                                    </span>
<span class="-6460801320187933305" onmouseenter="enter('-6460801320187933305');" onmouseout="out('-6460801320187933305');" style=""><abbr title=" 834      * @param currentSku - for update operations, this is the current Sku that is being updated; should be excluded from"> 834      * @param currentSku - for update operations, this is the current Sku that is being updated; should bðŸ”µ</abbr></span>
<span class="-9039397817177530475" onmouseenter="enter('-9039397817177530475');" onmouseout="out('-9039397817177530475');" style=""> 835      * attempting validation                                                                             </span>
<span class="3147013888049433291" onmouseenter="enter('3147013888049433291');" onmouseout="out('3147013888049433291');" style=""> 836      * @return &lt;b&gt;null&lt;/b&gt; if successfully validation, the error entity otherwise                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 837      */                                                                                                  </span>
<span class="4098410267680721468" onmouseenter="enter('4098410267680721468');" onmouseout="out('4098410267680721468');" style=""><abbr title=" 838     protected Entity validateUniqueProductOptionValueCombination(Product product, List&lt;Property&gt; productOptionProperties, Sku currentSku) {"> 838     protected Entity validateUniqueProductOptionValueCombination(Product product, List&lt;Property&gt; productOðŸ”µ</abbr></span>
<span class="-5247886246871174474" onmouseenter="enter('-5247886246871174474');" onmouseout="out('-5247886246871174474');" style=""> 839         //do not attempt POV validation if no PO properties were passed in                               </span>
<span class="3871558701454434845" onmouseenter="enter('3871558701454434845');" onmouseout="out('3871558701454434845');" style=""> 840         if (CollectionUtils.isNotEmpty(productOptionProperties)) {                                       </span>
<span class="1634824265941381194" onmouseenter="enter('1634824265941381194');" onmouseout="out('1634824265941381194');" style=""> 841             List&lt;Long&gt; productOptionValueIds = new ArrayList&lt;&gt;();                                        </span>
<span class="-3576685812737207515" onmouseenter="enter('-3576685812737207515');" onmouseout="out('-3576685812737207515');" style=""> 842             for (Property property : productOptionProperties) {                                          </span>
<span class="-2118064041595259984" onmouseenter="enter('-2118064041595259984');" onmouseout="out('-2118064041595259984');" style=""> 843                 productOptionValueIds.add(Long.parseLong(property.getValue()));                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 844             }                                                                                            </span>
<span  style=""> 845                                                                                                          </span>
<span class="-2493564654197817042" onmouseenter="enter('-2493564654197817042');" onmouseout="out('-2493564654197817042');" style=""> 846             boolean validated = true;                                                                    </span>
<span class="7949927824524618864" onmouseenter="enter('7949927824524618864');" onmouseout="out('7949927824524618864');" style=""> 847             for (Sku sku : product.getAdditionalSkus()) {                                                </span>
<span class="2891953471366425035" onmouseenter="enter('2891953471366425035');" onmouseout="out('2891953471366425035');" style=""> 848                 if (currentSku == null || !sku.getId().equals(currentSku.getId())) {                     </span>
<span class="-3952558990885951835" onmouseenter="enter('-3952558990885951835');" onmouseout="out('-3952558990885951835');" style=""> 849                     List&lt;Long&gt; testList = new ArrayList&lt;&gt;();                                             </span>
<span class="-7407157514043427301" onmouseenter="enter('-7407157514043427301');" onmouseout="out('-7407157514043427301');" style=""> 850                     for (ProductOptionValue optionValue : sku.getProductOptionValues()) {                </span>
<span class="261748784534089861" onmouseenter="enter('261748784534089861');" onmouseout="out('261748784534089861');" style=""> 851                         testList.add(optionValue.getId());                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 852                     }                                                                                    </span>
<span  style=""> 853                                                                                                          </span>
<span class="-5224728573656644718" onmouseenter="enter('-5224728573656644718');" onmouseout="out('-5224728573656644718');" style=""> 854                     if (CollectionUtils.isNotEmpty(testList) &amp;&amp;                                          </span>
<span class="-8535753245269677627" onmouseenter="enter('-8535753245269677627');" onmouseout="out('-8535753245269677627');" style=""> 855                             productOptionValueIds.containsAll(testList) &amp;&amp;                               </span>
<span class="4715989752758376255" onmouseenter="enter('4715989752758376255');" onmouseout="out('4715989752758376255');" style=""> 856                             productOptionValueIds.size() == testList.size()) {                           </span>
<span class="6265709580977530731" onmouseenter="enter('6265709580977530731');" onmouseout="out('6265709580977530731');" style=""> 857                         validated = false;                                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 858                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 859                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 860                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 861             }                                                                                            </span>
<span  style=""> 862                                                                                                          </span>
<span class="5370947014016399578" onmouseenter="enter('5370947014016399578');" onmouseout="out('5370947014016399578');" style=""> 863             if (!validated) {                                                                            </span>
<span class="605992171615497910" onmouseenter="enter('605992171615497910');" onmouseout="out('605992171615497910');" style=""> 864                 Entity errorEntity = new Entity();                                                       </span>
<span class="4071390277457465045" onmouseenter="enter('4071390277457465045');" onmouseout="out('4071390277457465045');" style=""> 865                 for (Property productOptionProperty : productOptionProperties) {                         </span>
<span class="-3018953048999428832" onmouseenter="enter('-3018953048999428832');" onmouseout="out('-3018953048999428832');" style=""> 866                     errorEntity.addValidationError(productOptionProperty.getName(), &quot;uniqueSkuError&quot;);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 867                 }                                                                                        </span>
<span class="-5923031647519224540" onmouseenter="enter('-5923031647519224540');" onmouseout="out('-5923031647519224540');" style=""> 868                 return errorEntity;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 869             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 870         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 871         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 872     }                                                                                                    </span>
<span  style=""> 873                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 874 }                                                                                                        </span>










</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-1249558187989023334" onmouseenter="enter('-1249558187989023334');" onmouseout="out('-1249558187989023334');" style="">   3  * BroadleafCommerce Admin Module                                                                        </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="3565305863144860564" onmouseenter="enter('3565305863144860564');" onmouseout="out('3565305863144860564');" style="">  18 package org.broadleafcommerce.admin.server.service.handler;                                              </span>
<span  style="">  19                                                                                                          </span>
<span class="5998602906817463685" onmouseenter="enter('5998602906817463685');" onmouseout="out('5998602906817463685');" style="">  20 import java.io.Serializable;                                                                             </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  21 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  22 import java.util.Arrays;                                                                                 </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  23 import java.util.Collection;                                                                             </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  24 import java.util.Collections;                                                                            </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  25 import java.util.HashMap;                                                                                </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  26 import java.util.Iterator;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  27 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  28 import java.util.Map;                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  29 import javax.annotation.Resource;                                                                        </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  30 import javax.persistence.EntityManager;                                                                  </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  31 import javax.persistence.PersistenceContext;                                                             </span>
<span class="6539032290250175619" onmouseenter="enter('6539032290250175619');" onmouseout="out('6539032290250175619');" style="">  32 import javax.persistence.TypedQuery;                                                                     </span>
<span class="8485852916582699615" onmouseenter="enter('8485852916582699615');" onmouseout="out('8485852916582699615');" style="">  33 import javax.persistence.criteria.CriteriaBuilder;                                                       </span>
<span class="2535099540501772744" onmouseenter="enter('2535099540501772744');" onmouseout="out('2535099540501772744');" style="">  34 import javax.persistence.criteria.From;                                                                  </span>
<span class="5773424155764142692" onmouseenter="enter('5773424155764142692');" onmouseout="out('5773424155764142692');" style="">  35 import javax.persistence.criteria.Path;                                                                  </span>
<span class="7244103982108254428" onmouseenter="enter('7244103982108254428');" onmouseout="out('7244103982108254428');" style="">  36 import javax.persistence.criteria.Predicate;                                                             </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  37 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="2953846583056246827" onmouseenter="enter('2953846583056246827');" onmouseout="out('2953846583056246827');" style="">  38 import org.apache.commons.collections.Transformer;                                                       </span>
<span class="-4661043417888464228" onmouseenter="enter('-4661043417888464228');" onmouseout="out('-4661043417888464228');" style="">  39 import org.apache.commons.lang.BooleanUtils;                                                             </span>
<span class="2359514128542055982" onmouseenter="enter('2359514128542055982');" onmouseout="out('2359514128542055982');" style="">  40 import org.apache.commons.lang3.ArrayUtils;                                                              </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  41 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="-6922428965258674124" onmouseenter="enter('-6922428965258674124');" onmouseout="out('-6922428965258674124');" style="">  42 import org.apache.commons.lang3.math.NumberUtils;                                                        </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  43 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  44 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="5500044680393520896" onmouseenter="enter('5500044680393520896');" onmouseout="out('5500044680393520896');" style="">  45 import org.broadleafcommerce.admin.server.service.SkuMetadataCacheService;                               </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  46 import org.broadleafcommerce.common.exception.ServiceException;                                          </span>
<span class="-2413957740330241600" onmouseenter="enter('-2413957740330241600');" onmouseout="out('-2413957740330241600');" style="">  47 import org.broadleafcommerce.common.presentation.client.LookupType;                                      </span>
<span class="-212317658512913375" onmouseenter="enter('-212317658512913375');" onmouseout="out('-212317658512913375');" style="">  48 import org.broadleafcommerce.common.presentation.client.OperationType;                                   </span>
<span class="7296089998360266547" onmouseenter="enter('7296089998360266547');" onmouseout="out('7296089998360266547');" style="">  49 import org.broadleafcommerce.common.presentation.client.PersistencePerspectiveItemType;                  </span>
<span class="1362364260528215152" onmouseenter="enter('1362364260528215152');" onmouseout="out('1362364260528215152');" style="">  50 import org.broadleafcommerce.common.presentation.client.SupportedFieldType;                              </span>
<span class="-7583443881845767348" onmouseenter="enter('-7583443881845767348');" onmouseout="out('-7583443881845767348');" style="">  51 import org.broadleafcommerce.common.presentation.client.VisibilityEnum;                                  </span>
<span class="-2818686525334833130" onmouseenter="enter('-2818686525334833130');" onmouseout="out('-2818686525334833130');" style="">  52 import org.broadleafcommerce.common.sandbox.SandBoxHelper;                                               </span>
<span class="-3909806959928975034" onmouseenter="enter('-3909806959928975034');" onmouseout="out('-3909806959928975034');" style="">  53 import org.broadleafcommerce.common.util.BLCCollectionUtils;                                             </span>
<span class="-3347161074136237116" onmouseenter="enter('-3347161074136237116');" onmouseout="out('-3347161074136237116');" style="">  54 import org.broadleafcommerce.common.util.StringUtil;                                                     </span>
<span class="-8028747938757529269" onmouseenter="enter('-8028747938757529269');" onmouseout="out('-8028747938757529269');" style="">  55 import org.broadleafcommerce.common.util.TypedTransformer;                                               </span>
<span class="2901117953480421393" onmouseenter="enter('2901117953480421393');" onmouseout="out('2901117953480421393');" style="">  56 import org.broadleafcommerce.common.util.dao.DynamicDaoHelperImpl;                                       </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  57 import org.broadleafcommerce.core.catalog.domain.Product;                                                </span>
<span class="8587718080948629089" onmouseenter="enter('8587718080948629089');" onmouseout="out('8587718080948629089');" style="">  58 import org.broadleafcommerce.core.catalog.domain.ProductBundle;                                          </span>
<span class="-85811185251521902" onmouseenter="enter('-85811185251521902');" onmouseout="out('-85811185251521902');" style="">  59 import org.broadleafcommerce.core.catalog.domain.ProductImpl;                                            </span>
<span class="6224071758335975205" onmouseenter="enter('6224071758335975205');" onmouseout="out('6224071758335975205');" style="">  60 import org.broadleafcommerce.core.catalog.domain.ProductOption;                                          </span>
<span class="-6385470104782105538" onmouseenter="enter('-6385470104782105538');" onmouseout="out('-6385470104782105538');" style="">  61 import org.broadleafcommerce.core.catalog.domain.ProductOptionImpl;                                      </span>
<span class="-7937345987210941259" onmouseenter="enter('-7937345987210941259');" onmouseout="out('-7937345987210941259');" style="">  62 import org.broadleafcommerce.core.catalog.domain.ProductOptionValue;                                     </span>
<span class="7369709806901157478" onmouseenter="enter('7369709806901157478');" onmouseout="out('7369709806901157478');" style="">  63 import org.broadleafcommerce.core.catalog.domain.ProductOptionValueImpl;                                 </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  64 import org.broadleafcommerce.core.catalog.domain.Sku;                                                    </span>
<span class="1181568146405964825" onmouseenter="enter('1181568146405964825');" onmouseout="out('1181568146405964825');" style="">  65 import org.broadleafcommerce.core.catalog.domain.SkuImpl;                                                </span>
<span class="688919036808372243" onmouseenter="enter('688919036808372243');" onmouseout="out('688919036808372243');" style="">  66 import org.broadleafcommerce.core.catalog.domain.SkuProductOptionValueXref;                              </span>
<span class="-3196712195758579658" onmouseenter="enter('-3196712195758579658');" onmouseout="out('-3196712195758579658');" style="">  67 import org.broadleafcommerce.core.catalog.domain.SkuProductOptionValueXrefImpl;                          </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  68 import org.broadleafcommerce.core.catalog.service.CatalogService;                                        </span>
<span class="4427537537958608766" onmouseenter="enter('4427537537958608766');" onmouseout="out('4427537537958608766');" style="">  69 import org.broadleafcommerce.openadmin.dto.BasicFieldMetadata;                                           </span>
<span class="-1607559599739253077" onmouseenter="enter('-1607559599739253077');" onmouseout="out('-1607559599739253077');" style="">  70 import org.broadleafcommerce.openadmin.dto.ClassMetadata;                                                </span>
<span class="-8970007776478821592" onmouseenter="enter('-8970007776478821592');" onmouseout="out('-8970007776478821592');" style="">  71 import org.broadleafcommerce.openadmin.dto.CriteriaTransferObject;                                       </span>
<span class="-4742435063138209714" onmouseenter="enter('-4742435063138209714');" onmouseout="out('-4742435063138209714');" style="">  72 import org.broadleafcommerce.openadmin.dto.DynamicResultSet;                                             </span>
<span class="-5093421835888664541" onmouseenter="enter('-5093421835888664541');" onmouseout="out('-5093421835888664541');" style="">  73 import org.broadleafcommerce.openadmin.dto.Entity;                                                       </span>
<span class="-8829499667991596741" onmouseenter="enter('-8829499667991596741');" onmouseout="out('-8829499667991596741');" style="">  74 import org.broadleafcommerce.openadmin.dto.FieldMetadata;                                                </span>
<span class="6369021917986026789" onmouseenter="enter('6369021917986026789');" onmouseout="out('6369021917986026789');" style="">  75 import org.broadleafcommerce.openadmin.dto.FilterAndSortCriteria;                                        </span>
<span class="7333603239996951733" onmouseenter="enter('7333603239996951733');" onmouseout="out('7333603239996951733');" style="">  76 import org.broadleafcommerce.openadmin.dto.MergedPropertyType;                                           </span>
<span class="5387066876064049952" onmouseenter="enter('5387066876064049952');" onmouseout="out('5387066876064049952');" style="">  77 import org.broadleafcommerce.openadmin.dto.PersistencePackage;                                           </span>
<span class="8079401142601162613" onmouseenter="enter('8079401142601162613');" onmouseout="out('8079401142601162613');" style="">  78 import org.broadleafcommerce.openadmin.dto.PersistencePerspective;                                       </span>
<span class="1983554291461039357" onmouseenter="enter('1983554291461039357');" onmouseout="out('1983554291461039357');" style="">  79 import org.broadleafcommerce.openadmin.dto.Property;                                                     </span>
<span class="1696571253156436279" onmouseenter="enter('1696571253156436279');" onmouseout="out('1696571253156436279');" style="">  80 import org.broadleafcommerce.openadmin.dto.SectionCrumb;                                                 </span>
<span class="-8828889589519173652" onmouseenter="enter('-8828889589519173652');" onmouseout="out('-8828889589519173652');" style="">  81 import org.broadleafcommerce.openadmin.server.dao.DynamicEntityDao;                                      </span>
<span class="-9217168395336380631" onmouseenter="enter('-9217168395336380631');" onmouseout="out('-9217168395336380631');" style="">  82 import org.broadleafcommerce.openadmin.server.service.handler.CustomPersistenceHandlerAdapter;           </span>
<span class="-1454726158681359973" onmouseenter="enter('-1454726158681359973');" onmouseout="out('-1454726158681359973');" style="">  83 import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceManager;                    </span>
<span class="97669409268306845" onmouseenter="enter('97669409268306845');" onmouseout="out('97669409268306845');" style="">  84 import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceManagerFactory;             </span>
<span class="-9205099315907051841" onmouseenter="enter('-9205099315907051841');" onmouseout="out('-9205099315907051841');" style="">  85 import org.broadleafcommerce.openadmin.server.service.persistence.module.InspectHelper;                  </span>
<span class="8253709771214222101" onmouseenter="enter('8253709771214222101');" onmouseout="out('8253709771214222101');" style="">  86 import org.broadleafcommerce.openadmin.server.service.persistence.module.PersistenceModule;              </span>
<span class="5407139061354632707" onmouseenter="enter('5407139061354632707');" onmouseout="out('5407139061354632707');" style="">  87 import org.broadleafcommerce.openadmin.server.service.persistence.module.RecordHelper;                   </span>
<span class="-4125327013079009203" onmouseenter="enter('-4125327013079009203');" onmouseout="out('-4125327013079009203');" style="">  88 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.CriteriaTranslator;    </span>
<span class="7637154476457570035" onmouseenter="enter('7637154476457570035');" onmouseout="out('7637154476457570035');" style="">  89 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPath;             </span>
<span class="1663650800150084878" onmouseenter="enter('1663650800150084878');" onmouseout="out('1663650800150084878');" style="">  90 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPathBuilder;      </span>
<span class="7520439988643323618" onmouseenter="enter('7520439988643323618');" onmouseout="out('7520439988643323618');" style="">  91 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FilterMapping;         </span>
<span class="-8754722050104399052" onmouseenter="enter('-8754722050104399052');" onmouseout="out('-8754722050104399052');" style="">  92 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.Restriction;           </span>
<span class="2225343043491731861" onmouseenter="enter('2225343043491731861');" onmouseout="out('2225343043491731861');" style=""><abbr title="  93 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.predicate.PredicateProvider;">  93 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.predicate.PredicateProvðŸ”µ</abbr></span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  94 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  95 import org.springframework.stereotype.Component;                                                         </span>
<span class="-5484142805323860658" onmouseenter="enter('-5484142805323860658');" onmouseout="out('-5484142805323860658');" style="">  96 import static com.google.common.base.CharMatcher.DIGIT;                                                  </span>
<span  style="">  97                                                                                                          </span>
<span  style="">  98                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  99 /**                                                                                                      </span>
<span class="-2581105714976122669" onmouseenter="enter('-2581105714976122669');" onmouseout="out('-2581105714976122669');" style=""> 100  * @author Phillip Verheyden                                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 101  *                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 102  */                                                                                                      </span>
<span class="-4061322517816489282" onmouseenter="enter('-4061322517816489282');" onmouseout="out('-4061322517816489282');" style=""> 103 @Component(&quot;blSkuCustomPersistenceHandler&quot;)                                                              </span>
<span class="-1865408177148521742" onmouseenter="enter('-1865408177148521742');" onmouseout="out('-1865408177148521742');" style=""> 104 public class SkuCustomPersistenceHandler extends CustomPersistenceHandlerAdapter {                       </span>
<span class="-8713958385326184455" onmouseenter="enter('-8713958385326184455');" onmouseout="out('-8713958385326184455');" style=""> 105     private static final Log LOG = LogFactory.getLog(SkuCustomPersistenceHandler.class);                 </span>
<span  style=""> 106                                                                                                          </span>
<span class="363907699147620123" onmouseenter="enter('363907699147620123');" onmouseout="out('363907699147620123');" style=""> 107     public static String PRODUCT_OPTION_FIELD_PREFIX = &quot;productOption&quot;;                                  </span>
<span  style=""> 108                                                                                                          </span>
<span class="5644485626870470186" onmouseenter="enter('5644485626870470186');" onmouseout="out('5644485626870470186');" style=""> 109     public static String INVENTORY_ONLY_CRITERIA = &quot;onlyInventoryProperties&quot;;                            </span>
<span  style=""> 110                                                                                                          </span>
<span class="-4251425677142148253" onmouseenter="enter('-4251425677142148253');" onmouseout="out('-4251425677142148253');" style=""> 111     @Value(&quot;${use.to.one.lookup.sku.product.option.value:false}&quot;)                                        </span>
<span class="6110895124324481806" onmouseenter="enter('6110895124324481806');" onmouseout="out('6110895124324481806');" style=""> 112     protected boolean useToOneLookupSkuProductOptionValue = false;                                       </span>
<span  style=""> 113                                                                                                          </span>
<span class="-7681629157280888116" onmouseenter="enter('-7681629157280888116');" onmouseout="out('-7681629157280888116');" style=""> 114     @Resource(name =&quot;blSkuMetadataCacheService&quot;)                                                         </span>
<span class="5822417842178589229" onmouseenter="enter('5822417842178589229');" onmouseout="out('5822417842178589229');" style=""> 115     protected SkuMetadataCacheService skuMetadataCacheService;                                           </span>
<span  style=""> 116                                                                                                          </span>
<span class="8317365465805033193" onmouseenter="enter('8317365465805033193');" onmouseout="out('8317365465805033193');" style=""> 117     @Resource(name=&quot;blAdornedTargetListPersistenceModule&quot;)                                               </span>
<span class="878998746675668437" onmouseenter="enter('878998746675668437');" onmouseout="out('878998746675668437');" style=""> 118     protected PersistenceModule adornedPersistenceModule;                                                </span>
<span  style=""> 119                                                                                                          </span>
<span class="-7011722868621328349" onmouseenter="enter('-7011722868621328349');" onmouseout="out('-7011722868621328349');" style=""> 120     @Resource(name = &quot;blSkuCustomPersistenceHandlerExtensionManager&quot;)                                    </span>
<span class="-9007673134867108683" onmouseenter="enter('-9007673134867108683');" onmouseout="out('-9007673134867108683');" style=""> 121     protected SkuCustomPersistenceHandlerExtensionManager extensionManager;                              </span>
<span  style=""> 122                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 123     /**                                                                                                  </span>
<span class="4136366527029974243" onmouseenter="enter('4136366527029974243');" onmouseout="out('4136366527029974243');" style=""><abbr title=" 124      * This represents the field that all of the product option values will be stored in. This would be used in the case"> 124      * This represents the field that all of the product option values will be stored in. This would be uðŸ”µ</abbr></span>
<span class="6047944382158863307" onmouseenter="enter('6047944382158863307');" onmouseout="out('6047944382158863307');" style=""><abbr title=" 125      * where there are a bunch of product options and displaying each option as a grid header would have everything"> 125      * where there are a bunch of product options and displaying each option as a grid header would have ðŸ”µ</abbr></span>
<span class="-3054662628739130883" onmouseenter="enter('-3054662628739130883');" onmouseout="out('-3054662628739130883');" style=""> 126      * squashed together. Filtering on this field is currently unsupported.                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 127      */                                                                                                  </span>
<span class="5445041667615320295" onmouseenter="enter('5445041667615320295');" onmouseout="out('5445041667615320295');" style=""> 128     public static String CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME = &quot;consolidatedProductOptions&quot;;         </span>
<span  style=""> 129                                                                                                          </span>
<span class="-2903820884082764399" onmouseenter="enter('-2903820884082764399');" onmouseout="out('-2903820884082764399');" style=""> 130     public static String CONSOLIDATED_PRODUCT_OPTIONS_DELIMETER = &quot;; &quot;;                                  </span>
<span  style=""> 131                                                                                                          </span>
<span class="5554818697985539506" onmouseenter="enter('5554818697985539506');" onmouseout="out('5554818697985539506');" style=""> 132     @Resource(name=&quot;blCatalogService&quot;)                                                                   </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style=""> 133     protected CatalogService catalogService;                                                             </span>
<span  style=""> 134                                                                                                          </span>
<span class="5710637357667853932" onmouseenter="enter('5710637357667853932');" onmouseout="out('5710637357667853932');" style=""> 135     @PersistenceContext(unitName = &quot;blPU&quot;)                                                               </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style=""> 136     protected EntityManager em;                                                                          </span>
<span  style=""> 137                                                                                                          </span>
<span class="-2696154002193407400" onmouseenter="enter('-2696154002193407400');" onmouseout="out('-2696154002193407400');" style=""> 138     @Resource(name = &quot;blCriteriaTranslator&quot;)                                                             </span>
<span class="6548648040486234931" onmouseenter="enter('6548648040486234931');" onmouseout="out('6548648040486234931');" style=""> 139     protected CriteriaTranslator criteriaTranslator;                                                     </span>
<span  style=""> 140                                                                                                          </span>
<span class="-3946461589801993391" onmouseenter="enter('-3946461589801993391');" onmouseout="out('-3946461589801993391');" style=""> 141     @Resource(name = &quot;blSandBoxHelper&quot;)                                                                  </span>
<span class="-7799183597372200632" onmouseenter="enter('-7799183597372200632');" onmouseout="out('-7799183597372200632');" style=""> 142     protected SandBoxHelper sandBoxHelper;                                                               </span>
<span  style=""> 143                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 144     @Override                                                                                            </span>
<span class="998850855763553690" onmouseenter="enter('998850855763553690');" onmouseout="out('998850855763553690');" style=""> 145     public Boolean canHandleInspect(PersistencePackage persistencePackage) {                             </span>
<span class="-5823917578938895674" onmouseenter="enter('-5823917578938895674');" onmouseout="out('-5823917578938895674');" style=""><abbr title=" 146         return canHandle(persistencePackage, persistencePackage.getPersistencePerspective().getOperationTypes()"> 146         return canHandle(persistencePackage, persistencePackage.getPersistencePerspective().getOperationTðŸ”µ</abbr></span>
<span class="9015299385431722883" onmouseenter="enter('9015299385431722883');" onmouseout="out('9015299385431722883');" style=""> 147                 .getInspectType());                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148     }                                                                                                    </span>
<span  style=""> 149                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 150     @Override                                                                                            </span>
<span class="-8556163469002491307" onmouseenter="enter('-8556163469002491307');" onmouseout="out('-8556163469002491307');" style=""> 151     public Boolean canHandleFetch(PersistencePackage persistencePackage) {                               </span>
<span class="10418940480604143" onmouseenter="enter('10418940480604143');" onmouseout="out('10418940480604143');" style=""><abbr title=" 152         OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFetchType();"> 152         OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFðŸ”µ</abbr></span>
<span class="8754300242813385255" onmouseenter="enter('8754300242813385255');" onmouseout="out('8754300242813385255');" style=""> 153         return canHandle(persistencePackage, fetchType);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154     }                                                                                                    </span>
<span  style=""> 155                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 156     @Override                                                                                            </span>
<span class="1712661648493993457" onmouseenter="enter('1712661648493993457');" onmouseout="out('1712661648493993457');" style=""> 157     public Boolean canHandleAdd(PersistencePackage persistencePackage) {                                 </span>
<span class="-5221489961679899774" onmouseenter="enter('-5221489961679899774');" onmouseout="out('-5221489961679899774');" style=""><abbr title=" 158         OperationType addType = persistencePackage.getPersistencePerspective().getOperationTypes().getAddType();"> 158         OperationType addType = persistencePackage.getPersistencePerspective().getOperationTypes().getAddðŸ”µ</abbr></span>
<span class="1238914713862050599" onmouseenter="enter('1238914713862050599');" onmouseout="out('1238914713862050599');" style=""> 159         return canHandle(persistencePackage, addType);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160     }                                                                                                    </span>
<span  style=""> 161                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 162     @Override                                                                                            </span>
<span class="5315207923223107799" onmouseenter="enter('5315207923223107799');" onmouseout="out('5315207923223107799');" style=""> 163     public Boolean canHandleUpdate(PersistencePackage persistencePackage) {                              </span>
<span class="8318706485461606240" onmouseenter="enter('8318706485461606240');" onmouseout="out('8318706485461606240');" style=""><abbr title=" 164         OperationType updateType = persistencePackage.getPersistencePerspective().getOperationTypes().getUpdateType();"> 164         OperationType updateType = persistencePackage.getPersistencePerspective().getOperationTypes().getðŸ”µ</abbr></span>
<span class="7628662592758046218" onmouseenter="enter('7628662592758046218');" onmouseout="out('7628662592758046218');" style=""> 165         return canHandle(persistencePackage, updateType);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166     }                                                                                                    </span>
<span  style=""> 167                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 168     /**                                                                                                  </span>
<span class="6990985093790140011" onmouseenter="enter('6990985093790140011');" onmouseout="out('6990985093790140011');" style=""><abbr title=" 169      * Since this is the default for all Skus, it&#x27;s possible that we are providing custom criteria for this"> 169      * Since this is the default for all Skus, it&#x27;s possible that we are providing custom criteria for thðŸ”µ</abbr></span>
<span class="-7639041005907295879" onmouseenter="enter('-7639041005907295879');" onmouseout="out('-7639041005907295879');" style=""><abbr title=" 170      * Sku lookup. In that case, we probably want to delegate to a child class, so only use this particular"> 170      * Sku lookup. In that case, we probably want to delegate to a child class, so only use this particulðŸ”µ</abbr></span>
<span class="3567117971388930965" onmouseenter="enter('3567117971388930965');" onmouseout="out('3567117971388930965');" style=""><abbr title=" 171      * persistence handler if there is no custom criteria being used and the ceiling entity is an instance of Sku. The"> 171      * persistence handler if there is no custom criteria being used and the ceiling entity is an instancðŸ”µ</abbr></span>
<span class="-9191698445538453171" onmouseenter="enter('-9191698445538453171');" onmouseout="out('-9191698445538453171');" style=""><abbr title=" 172      * exception to this rule is when we are pulling back Media, since the admin actually uses Sku for the ceiling entity"> 172      * exception to this rule is when we are pulling back Media, since the admin actually uses Sku for thðŸ”µ</abbr></span>
<span class="1646505885713320498" onmouseenter="enter('1646505885713320498');" onmouseout="out('1646505885713320498');" style=""><abbr title=" 173      * class name. That should be handled by the map structure module though, so only handle things in the Sku custom"> 173      * class name. That should be handled by the map structure module though, so only handle things in thðŸ”µ</abbr></span>
<span class="-3435293659936443508" onmouseenter="enter('-3435293659936443508');" onmouseout="out('-3435293659936443508');" style=""> 174      * persistence handler for OperationType.BASIC                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 175      *                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 176      */                                                                                                  </span>
<span class="-401224984339352861" onmouseenter="enter('-401224984339352861');" onmouseout="out('-401224984339352861');" style=""> 177     protected Boolean canHandle(PersistencePackage persistencePackage, OperationType operationType) {    </span>
<span class="2519389108374285224" onmouseenter="enter('2519389108374285224');" onmouseout="out('2519389108374285224');" style=""><abbr title=" 178         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname();"> 178         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 179         try {                                                                                            </span>
<span class="3859607212114051755" onmouseenter="enter('3859607212114051755');" onmouseout="out('3859607212114051755');" style=""> 180             Class testClass = Class.forName(ceilingEntityFullyQualifiedClassname);                       </span>
<span class="-6258271003107251148" onmouseenter="enter('-6258271003107251148');" onmouseout="out('-6258271003107251148');" style=""> 181             return Sku.class.isAssignableFrom(testClass) &amp;&amp;                                              </span>
<span class="6374297613382618653" onmouseenter="enter('6374297613382618653');" onmouseout="out('6374297613382618653');" style=""> 182                     //ArrayUtils.isEmpty(persistencePackage.getCustomCriteria()) &amp;&amp;                      </span>
<span class="-7558498583587542431" onmouseenter="enter('-7558498583587542431');" onmouseout="out('-7558498583587542431');" style=""> 183                     OperationType.BASIC.equals(operationType) &amp;&amp;                                         </span>
<span class="-2045231318111877972" onmouseenter="enter('-2045231318111877972');" onmouseout="out('-2045231318111877972');" style=""><abbr title=" 184                     (persistencePackage.getPersistencePerspective().getPersistencePerspectiveItems().get(PersistencePerspectiveItemType.ADORNEDTARGETLIST) == null);"> 184                     (persistencePackage.getPersistencePerspective().getPersistencePerspectiveItems().get(ðŸ”µ</abbr></span>
<span class="1054888787890391626" onmouseenter="enter('1054888787890391626');" onmouseout="out('1054888787890391626');" style=""> 185         } catch (ClassNotFoundException e) {                                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 186             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188     }                                                                                                    </span>
<span  style=""> 189                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 190     /**                                                                                                  </span>
<span class="330022396980695391" onmouseenter="enter('330022396980695391');" onmouseout="out('330022396980695391');" style=""> 191      * Build out the extra fields for the product options                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 192      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 193     @Override                                                                                            </span>
<span class="4696212939538128393" onmouseenter="enter('4696212939538128393');" onmouseout="out('4696212939538128393');" style=""><abbr title=" 194     public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, InspectHelper helper) throws ServiceException {"> 194     public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 195         try {                                                                                            </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""><abbr title=" 196             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();"> 196             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective(ðŸ”µ</abbr></span>
<span class="5084133214681633572" onmouseenter="enter('5084133214681633572');" onmouseout="out('5084133214681633572');" style=""> 197             Map&lt;MergedPropertyType, Map&lt;String, FieldMetadata&gt;&gt; allMergedProperties = new HashMap&lt;&gt;();   </span>
<span class="8224436115361654738" onmouseenter="enter('8224436115361654738');" onmouseout="out('8224436115361654738');" style=""> 198             String productIdStr = getOwningProductId(persistencePackage.getSectionCrumbs());             </span>
<span class="8874992536138016800" onmouseenter="enter('8874992536138016800');" onmouseout="out('8874992536138016800');" style=""> 199             String cacheKey = skuMetadataCacheService.buildCacheKey(productIdStr);                       </span>
<span class="4935255304884851121" onmouseenter="enter('4935255304884851121');" onmouseout="out('4935255304884851121');" style=""> 200             Map&lt;String, FieldMetadata&gt; properties = null;                                                </span>
<span class="-7786224376670761804" onmouseenter="enter('-7786224376670761804');" onmouseout="out('-7786224376670761804');" style=""> 201             boolean useCache = skuMetadataCacheService.useCache();                                       </span>
<span class="6293418362193794054" onmouseenter="enter('6293418362193794054');" onmouseout="out('6293418362193794054');" style=""> 202             if (useCache) {                                                                              </span>
<span class="-3485340186081071120" onmouseenter="enter('-3485340186081071120');" onmouseout="out('-3485340186081071120');" style=""> 203                 properties = skuMetadataCacheService.getFromCache(cacheKey);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204             }                                                                                            </span>
<span class="-6785810758643658869" onmouseenter="enter('-6785810758643658869');" onmouseout="out('-6785810758643658869');" style=""> 205             if (properties == null) {                                                                    </span>
<span class="-8049454456400691879" onmouseenter="enter('-8049454456400691879');" onmouseout="out('-8049454456400691879');" style=""> 206                 // Grab the default properties for the Sku                                               </span>
<span class="8769638039057755276" onmouseenter="enter('8769638039057755276');" onmouseout="out('8769638039057755276');" style=""><abbr title=" 207                 properties = helper.getSimpleMergedProperties(SkuImpl.class.getName(), persistencePerspective);"> 207                 properties = helper.getSimpleMergedProperties(SkuImpl.class.getName(), persistencePerspecðŸ”µ</abbr></span>
<span class="4572678014865473520" onmouseenter="enter('4572678014865473520');" onmouseout="out('4572678014865473520');" style=""> 208                 boolean isFirstCriteriaNAN = productIdStr == null;                                       </span>
<span class="3041231560908753869" onmouseenter="enter('3041231560908753869');" onmouseout="out('3041231560908753869');" style=""> 209                 if ((!isFirstCriteriaNAN) &amp;&amp; useToOneLookupSkuProductOptionValue) {                      </span>
<span class="739323014665919562" onmouseenter="enter('739323014665919562');" onmouseout="out('739323014665919562');" style=""> 210                     isFirstCriteriaNAN = !;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211                 }                                                                                        </span>
<span class="-1057552343227044346" onmouseenter="enter('-1057552343227044346');" onmouseout="out('-1057552343227044346');" style=""> 212                 if (isFirstCriteriaNAN) {                                                                </span>
<span class="-4808201889908041373" onmouseenter="enter('-4808201889908041373');" onmouseout="out('-4808201889908041373');" style=""> 213                     // look up all the ProductOptions and then create new fields for each of them        </span>
<span class="-5911163386440462712" onmouseenter="enter('-5911163386440462712');" onmouseout="out('-5911163386440462712');" style=""> 214                     List&lt;ProductOption&gt; options = catalogService.readAllProductOptions();                </span>
<span class="-6720626788939973914" onmouseenter="enter('-6720626788939973914');" onmouseout="out('-6720626788939973914');" style=""> 215                     int order = 0;                                                                       </span>
<span class="-3626227932157062862" onmouseenter="enter('-3626227932157062862');" onmouseout="out('-3626227932157062862');" style=""> 216                     for (ProductOption option : options) {                                               </span>
<span class="3496103183278354414" onmouseenter="enter('3496103183278354414');" onmouseout="out('3496103183278354414');" style=""> 217                         // add this to the built Sku properties                                          </span>
<span class="-6525885484902667726" onmouseenter="enter('-6525885484902667726');" onmouseout="out('-6525885484902667726');" style=""> 218                         FieldMetadata md = createIndividualOptionField(option, order);                   </span>
<span class="8898370236947645542" onmouseenter="enter('8898370236947645542');" onmouseout="out('8898370236947645542');" style=""> 219                         if (md != null) {                                                                </span>
<span class="-8011968882232877757" onmouseenter="enter('-8011968882232877757');" onmouseout="out('-8011968882232877757');" style=""> 220                             properties.put(&quot;productOption&quot; + option.getId(), md);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222                     }                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 223                 } else {                                                                                 </span>
<span class="-4312271314847345000" onmouseenter="enter('-4312271314847345000');" onmouseout="out('-4312271314847345000');" style=""> 224                     // If we have a product to filter the list of available product options, then use it </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 225                     try {                                                                                </span>
<span class="2407810897627048437" onmouseenter="enter('2407810897627048437');" onmouseout="out('2407810897627048437');" style=""> 226                         Long productId = Long.parseLong(productIdStr);                                   </span>
<span class="-4586946436800548085" onmouseenter="enter('-4586946436800548085');" onmouseout="out('-4586946436800548085');" style=""> 227                         Product product = catalogService.findProductById(productId);                     </span>
<span class="-8670197725029820971" onmouseenter="enter('-8670197725029820971');" onmouseout="out('-8670197725029820971');" style=""> 228                         for (ProductOption option : product.getProductOptions()) {                       </span>
<span class="1960418873000138214" onmouseenter="enter('1960418873000138214');" onmouseout="out('1960418873000138214');" style=""> 229                             FieldMetadata md = createIndividualOptionField(option, 0);                   </span>
<span class="8898370236947645542" onmouseenter="enter('8898370236947645542');" onmouseout="out('8898370236947645542');" style=""> 230                             if (md != null) {                                                            </span>
<span class="-8011968882232877757" onmouseenter="enter('-8011968882232877757');" onmouseout="out('-8011968882232877757');" style=""> 231                                 properties.put(&quot;productOption&quot; + option.getId(), md);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233                         }                                                                                </span>
<span class="5607511864385965813" onmouseenter="enter('5607511864385965813');" onmouseout="out('5607511864385965813');" style=""> 234                     } catch (java.lang.NumberFormatException e) {                                        </span>
<span class="-1877352964924956330" onmouseenter="enter('-1877352964924956330');" onmouseout="out('-1877352964924956330');" style=""> 235                         // there wasn&#x27;t a valid product id, just don&#x27;t do anything                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237                 }                                                                                        </span>
<span class="-3474708947978439589" onmouseenter="enter('-3474708947978439589');" onmouseout="out('-3474708947978439589');" style=""><abbr title=" 238                 // also build the consolidated field; if using the SkuBasicClientEntityModule then this field will be"> 238                 // also build the consolidated field; if using the SkuBasicClientEntityModule then this fðŸ”µ</abbr></span>
<span class="-28577534716265495" onmouseenter="enter('-28577534716265495');" onmouseout="out('-28577534716265495');" style=""> 239                 // permanently hidden                                                                    </span>
<span class="2721680110186827865" onmouseenter="enter('2721680110186827865');" onmouseout="out('2721680110186827865');" style=""><abbr title=" 240                 properties.put(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME, createConsolidatedOptionField(SkuImpl.class));"> 240                 properties.put(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME, createConsolidatedOptionField(SkuðŸ”µ</abbr></span>
<span class="6293418362193794054" onmouseenter="enter('6293418362193794054');" onmouseout="out('6293418362193794054');" style=""> 241                 if (useCache) {                                                                          </span>
<span class="1689829812062092848" onmouseenter="enter('1689829812062092848');" onmouseout="out('1689829812062092848');" style=""> 242                     skuMetadataCacheService.addToCache(cacheKey, properties);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244             }                                                                                            </span>
<span class="-5708738706047923554" onmouseenter="enter('-5708738706047923554');" onmouseout="out('-5708738706047923554');" style=""> 245             allMergedProperties.put(MergedPropertyType.PRIMARY, properties);                             </span>
<span class="7675658451386605299" onmouseenter="enter('7675658451386605299');" onmouseout="out('7675658451386605299');" style=""> 246             // allow the adorned list to contribute properties as well in the case of Sku bundle items   </span>
<span class="-3556502415085978160" onmouseenter="enter('-3556502415085978160');" onmouseout="out('-3556502415085978160');" style=""> 247             adornedPersistenceModule.setPersistenceManager(((PersistenceManager) (helper)));             </span>
<span class="-5923303721993025135" onmouseenter="enter('-5923303721993025135');" onmouseout="out('-5923303721993025135');" style=""> 248             adornedPersistenceModule.updateMergedProperties(persistencePackage, allMergedProperties);    </span>
<span class="-4755998569329183714" onmouseenter="enter('-4755998569329183714');" onmouseout="out('-4755998569329183714');" style=""><abbr title=" 249             Class&lt;?&gt;[] entityClasses = dynamicEntityDao.getAllPolymorphicEntitiesFromCeiling(SkuImpl.class);"> 249             Class&lt;?&gt;[] entityClasses = dynamicEntityDao.getAllPolymorphicEntitiesFromCeiling(SkuImpl.clasðŸ”µ</abbr></span>
<span class="-4526006421593645811" onmouseenter="enter('-4526006421593645811');" onmouseout="out('-4526006421593645811');" style=""><abbr title=" 250             for (Map.Entry&lt;MergedPropertyType, Map&lt;String, FieldMetadata&gt;&gt; entry : allMergedProperties.entrySet()) {"> 250             for (Map.Entry&lt;MergedPropertyType, Map&lt;String, FieldMetadata&gt;&gt; entry : allMergedProperties.enðŸ”µ</abbr></span>
<span class="5289188932531096512" onmouseenter="enter('5289188932531096512');" onmouseout="out('5289188932531096512');" style=""> 251                 filterOutProductMetadata(entry.getValue());                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252             }                                                                                            </span>
<span class="-8821755242796986609" onmouseenter="enter('-8821755242796986609');" onmouseout="out('-8821755242796986609');" style=""><abbr title=" 253             ClassMetadata mergedMetadata = helper.buildClassMetadata(entityClasses, persistencePackage, allMergedProperties);"> 253             ClassMetadata mergedMetadata = helper.buildClassMetadata(entityClasses, persistencePackage, aðŸ”µ</abbr></span>
<span class="5692867683696224654" onmouseenter="enter('5692867683696224654');" onmouseout="out('5692867683696224654');" style=""> 254             DynamicResultSet results = new DynamicResultSet(mergedMetadata, null, null);                 </span>
<span class="225205592763971576" onmouseenter="enter('225205592763971576');" onmouseout="out('225205592763971576');" style=""> 255             return results;                                                                              </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 256         } catch (java.lang.Exception e) {                                                                </span>
<span class="-6544848650202582407" onmouseenter="enter('-6544848650202582407');" onmouseout="out('-6544848650202582407');" style=""><abbr title=" 257             ServiceException ex = new ServiceException(&quot;Unable to retrieve inspection results for &quot; + persistencePackage.getCeilingEntityFullyQualifiedClassname(), e);"> 257             ServiceException ex = new ServiceException(&quot;Unable to retrieve inspection results for &quot; + perðŸ”µ</abbr></span>
<span class="8479095309709473887" onmouseenter="enter('8479095309709473887');" onmouseout="out('8479095309709473887');" style=""> 258             throw ex;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260     }                                                                                                    </span>
<span  style=""> 261                                                                                                          </span>
<span class="7792500831321188662" onmouseenter="enter('7792500831321188662');" onmouseout="out('7792500831321188662');" style=""> 262     protected String getOwningProductId(SectionCrumb[] sectionCrumbs) {                                  </span>
<span class="-7944229369720653873" onmouseenter="enter('-7944229369720653873');" onmouseout="out('-7944229369720653873');" style=""><abbr title=" 263         if (ArrayUtils.isNotEmpty(sectionCrumbs) &amp;&amp; ProductImpl.class.getCanonicalName().equals(sectionCrumbs[0].getSectionIdentifier())) {"> 263         if (ArrayUtils.isNotEmpty(sectionCrumbs) &amp;&amp; ProductImpl.class.getCanonicalName().equals(sectionCrðŸ”µ</abbr></span>
<span class="1460529894614018184" onmouseenter="enter('1460529894614018184');" onmouseout="out('1460529894614018184');" style=""> 264             return sectionCrumbs[0].getSectionId();                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265         }                                                                                                </span>
<span  style=""> 266                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 267 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 268             return null;                                                                                 </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 269 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 270 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 270 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 271 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 272                                                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 273         return null;                                                                                     </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 274 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span  style=""> 275                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276     }                                                                                                    </span>
<span  style=""> 277                                                                                                          </span>
<span class="-6584484392335358741" onmouseenter="enter('-6584484392335358741');" onmouseout="out('-6584484392335358741');" style=""> 278     protected void filterOutProductMetadata(Map&lt;String, FieldMetadata&gt; map) {                            </span>
<span class="5728154390973133711" onmouseenter="enter('5728154390973133711');" onmouseout="out('5728154390973133711');" style=""><abbr title=" 279         //TODO we shouldn&#x27;t have to filter out these keys here -- we should be able to exclude using @AdminPresentation,"> 279         //TODO we shouldn&#x27;t have to filter out these keys here -- we should be able to exclude using @AdmðŸ”µ</abbr></span>
<span class="-7743625525232386179" onmouseenter="enter('-7743625525232386179');" onmouseout="out('-7743625525232386179');" style=""> 280         //but there&#x27;s a bug preventing this behavior from completely working correctly                   </span>
<span class="-976216753136159975" onmouseenter="enter('-976216753136159975');" onmouseout="out('-976216753136159975');" style=""> 281         List&lt;String&gt; removeKeys = new ArrayList&lt;&gt;();                                                     </span>
<span class="-6833083889726135539" onmouseenter="enter('-6833083889726135539');" onmouseout="out('-6833083889726135539');" style=""> 282         for (Map.Entry&lt;String, FieldMetadata&gt; entry : map.entrySet()) {                                  </span>
<span class="-6943676522367592499" onmouseenter="enter('-6943676522367592499');" onmouseout="out('-6943676522367592499');" style=""> 283             if (entry.getKey().contains(&quot;defaultProduct.&quot;) || entry.getKey().contains(&quot;product.&quot;)) {     </span>
<span class="6428107256625953551" onmouseenter="enter('6428107256625953551');" onmouseout="out('6428107256625953551');" style=""> 284                 removeKeys.add(entry.getKey());                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286         }                                                                                                </span>
<span class="7925962848224625040" onmouseenter="enter('7925962848224625040');" onmouseout="out('7925962848224625040');" style=""> 287         for (String removeKey : removeKeys) {                                                            </span>
<span class="-7725303831891910229" onmouseenter="enter('-7725303831891910229');" onmouseout="out('-7725303831891910229');" style=""> 288             map.remove(removeKey);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290     }                                                                                                    </span>
<span  style=""> 291                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 292     /**                                                                                                  </span>
<span class="8475757947277110833" onmouseenter="enter('8475757947277110833');" onmouseout="out('8475757947277110833');" style=""><abbr title=" 293      * Creates the metadata necessary for displaying all of the product option values in a single field. The display of this"> 293      * Creates the metadata necessary for displaying all of the product option values in a single field. ðŸ”µ</abbr></span>
<span class="-7291252168371203717" onmouseenter="enter('-7291252168371203717');" onmouseout="out('-7291252168371203717');" style=""><abbr title=" 294      * field is a single string with every product option value appended to it separated by a semicolon. This method should"> 294      * field is a single string with every product option value appended to it separated by a semicolon. ðŸ”µ</abbr></span>
<span class="1992999426370183590" onmouseenter="enter('1992999426370183590');" onmouseout="out('1992999426370183590');" style=""><abbr title=" 295      * be invoked on an inspect for whatever is utilizing this so that the property will be ready to be populated on fetch."> 295      * be invoked on an inspect for whatever is utilizing this so that the property will be ready to be pðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 296      *                                                                                                   </span>
<span class="-6637674095635137344" onmouseenter="enter('-6637674095635137344');" onmouseout="out('-6637674095635137344');" style=""><abbr title=" 297      * The metadata that is returned will also be set to prominent by default so that it will be ready to display on whatever"> 297      * The metadata that is returned will also be set to prominent by default so that it will be ready toðŸ”µ</abbr></span>
<span class="-511871035138294277" onmouseenter="enter('-511871035138294277');" onmouseout="out('-511871035138294277');" style=""><abbr title=" 298      * grid is being inspected. If you do not want this behavior you will need to override this functionality in the metadata"> 298      * grid is being inspected. If you do not want this behavior you will need to override this functionaðŸ”µ</abbr></span>
<span class="3179613037749712904" onmouseenter="enter('3179613037749712904');" onmouseout="out('3179613037749712904');" style=""> 299      * that is returned.                                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 300      *                                                                                                   </span>
<span class="7116239974974757712" onmouseenter="enter('7116239974974757712');" onmouseout="out('7116239974974757712');" style=""><abbr title=" 301      * @param inheritedFromType which type this should appear on. This would normally be SkuImpl.class, but if you want to"> 301      * @param inheritedFromType which type this should appear on. This would normally be SkuImpl.class, bðŸ”µ</abbr></span>
<span class="167462497314507165" onmouseenter="enter('167462497314507165');" onmouseout="out('167462497314507165');" style=""> 302      * display this field with a different entity then this should be that entity                        </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 303      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 304      */                                                                                                  </span>
<span class="-1192927872819846099" onmouseenter="enter('-1192927872819846099');" onmouseout="out('-1192927872819846099');" style=""> 305     public FieldMetadata createConsolidatedOptionField(Class&lt;?&gt; inheritedFromType) {                     </span>
<span class="-7895492162900601652" onmouseenter="enter('-7895492162900601652');" onmouseout="out('-7895492162900601652');" style=""> 306         BasicFieldMetadata metadata = new BasicFieldMetadata();                                          </span>
<span class="1112932430275912677" onmouseenter="enter('1112932430275912677');" onmouseout="out('1112932430275912677');" style=""> 307         metadata.setFieldType(SupportedFieldType.STRING);                                                </span>
<span class="6091769410078062740" onmouseenter="enter('6091769410078062740');" onmouseout="out('6091769410078062740');" style=""> 308         metadata.setMutable(false);                                                                      </span>
<span class="2561191544941929216" onmouseenter="enter('2561191544941929216');" onmouseout="out('2561191544941929216');" style=""> 309         metadata.setInheritedFromType(inheritedFromType.getName());                                      </span>
<span  style=""> 310                                                                                                          </span>
<span class="7921709413407422398" onmouseenter="enter('7921709413407422398');" onmouseout="out('7921709413407422398');" style=""><abbr title=" 311         metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCache()));"> 311         metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useðŸ”µ</abbr></span>
<span class="7303907294085574775" onmouseenter="enter('7303907294085574775');" onmouseout="out('7303907294085574775');" style=""> 312         metadata.setForeignKeyCollection(false);                                                         </span>
<span class="-1649079592520542152" onmouseenter="enter('-1649079592520542152');" onmouseout="out('-1649079592520542152');" style=""> 313         metadata.setMergedPropertyType(MergedPropertyType.PRIMARY);                                      </span>
<span  style=""> 314                                                                                                          </span>
<span class="6688700612838924202" onmouseenter="enter('6688700612838924202');" onmouseout="out('6688700612838924202');" style=""> 315         metadata.setName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                                       </span>
<span class="173658654284287974" onmouseenter="enter('173658654284287974');" onmouseout="out('173658654284287974');" style=""> 316         metadata.setFriendlyName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                               </span>
<span class="5589230730632374582" onmouseenter="enter('5589230730632374582');" onmouseout="out('5589230730632374582');" style=""> 317         metadata.setGroup(&quot;&quot;);                                                                           </span>
<span class="8683462265874380595" onmouseenter="enter('8683462265874380595');" onmouseout="out('8683462265874380595');" style=""> 318         metadata.setExplicitFieldType(SupportedFieldType.UNKNOWN);                                       </span>
<span class="-6445843447872579066" onmouseenter="enter('-6445843447872579066');" onmouseout="out('-6445843447872579066');" style=""> 319         metadata.setProminent(true);                                                                     </span>
<span class="-4820234772877671615" onmouseenter="enter('-4820234772877671615');" onmouseout="out('-4820234772877671615');" style=""> 320         metadata.setVisibility(VisibilityEnum.FORM_HIDDEN);                                              </span>
<span class="8945700141771923055" onmouseenter="enter('8945700141771923055');" onmouseout="out('8945700141771923055');" style=""> 321         metadata.setBroadleafEnumeration(&quot;&quot;);                                                            </span>
<span class="1775531838265915895" onmouseenter="enter('1775531838265915895');" onmouseout="out('1775531838265915895');" style=""> 322         metadata.setReadOnly(true);                                                                      </span>
<span class="-7171521581678886800" onmouseenter="enter('-7171521581678886800');" onmouseout="out('-7171521581678886800');" style=""> 323         metadata.setRequiredOverride(false);                                                             </span>
<span class="-4496921391259172818" onmouseenter="enter('-4496921391259172818');" onmouseout="out('-4496921391259172818');" style=""> 324         metadata.setGridOrder(Integer.MAX_VALUE);                                                        </span>
<span  style=""> 325                                                                                                          </span>
<span class="-6736542809122384852" onmouseenter="enter('-6736542809122384852');" onmouseout="out('-6736542809122384852');" style=""> 326         return metadata;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327     }                                                                                                    </span>
<span  style=""> 328                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 329     /**                                                                                                  </span>
<span class="-8205275851682999693" onmouseenter="enter('-8205275851682999693');" onmouseout="out('-8205275851682999693');" style=""><abbr title=" 330      * Returns a {@link Property} filled out with a delimited list of the &lt;b&gt;values&lt;/b&gt; that are passed in. This should be"> 330      * Returns a {@link Property} filled out with a delimited list of the &lt;b&gt;values&lt;/b&gt; that are passed iðŸ”µ</abbr></span>
<span class="-4713707283922918694" onmouseenter="enter('-4713707283922918694');" onmouseout="out('-4713707283922918694');" style=""> 331      * invoked on a fetch and the returned property should be added to the fetched {@link Entity} dto.   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 332      *                                                                                                   </span>
<span class="2073888098879145111" onmouseenter="enter('2073888098879145111');" onmouseout="out('2073888098879145111');" style=""> 333      * @param values                                                                                     </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 334      * @return                                                                                           </span>
<span class="3015934350861870420" onmouseenter="enter('3015934350861870420');" onmouseout="out('3015934350861870420');" style=""> 335      * @see {@link #createConsolidatedOptionField(Class)};                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 336      */                                                                                                  </span>
<span class="-4797739079142470258" onmouseenter="enter('-4797739079142470258');" onmouseout="out('-4797739079142470258');" style=""> 337     public Property getConsolidatedOptionProperty(Collection&lt;ProductOptionValue&gt; values) {               </span>
<span class="6856864467058713906" onmouseenter="enter('6856864467058713906');" onmouseout="out('6856864467058713906');" style=""> 338         Property optionValueProperty = new Property();                                                   </span>
<span class="6345005840174859359" onmouseenter="enter('6345005840174859359');" onmouseout="out('6345005840174859359');" style=""> 339         optionValueProperty.setName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                            </span>
<span  style=""> 340                                                                                                          </span>
<span class="4968742745228384146" onmouseenter="enter('4968742745228384146');" onmouseout="out('4968742745228384146');" style=""> 341         //order the values by the display order of their correspond product option                       </span>
<span class="-6409609658063536117" onmouseenter="enter('-6409609658063536117');" onmouseout="out('-6409609658063536117');" style=""> 342         //        Collections.sort(values, new Comparator&lt;ProductOptionValue&gt;() {                        </span>
<span class="-8064130612454474190" onmouseenter="enter('-8064130612454474190');" onmouseout="out('-8064130612454474190');" style=""> 343         //                                                                                               </span>
<span class="5501927314430930673" onmouseenter="enter('5501927314430930673');" onmouseout="out('5501927314430930673');" style=""> 344         //            @Override                                                                          </span>
<span class="9147587799683858413" onmouseenter="enter('9147587799683858413');" onmouseout="out('9147587799683858413');" style=""> 345         //            public int compare(ProductOptionValue value1, ProductOptionValue value2) {         </span>
<span class="368329491788158591" onmouseenter="enter('368329491788158591');" onmouseout="out('368329491788158591');" style=""><abbr title=" 346         //                return new CompareToBuilder().append(value1.getProductOption().getDisplayOrder(),"> 346         //                return new CompareToBuilder().append(value1.getProductOption().getDisplayOrder(ðŸ”µ</abbr></span>
<span class="8754156396924172260" onmouseenter="enter('8754156396924172260');" onmouseout="out('8754156396924172260');" style=""> 347         //                        value2.getProductOption().getDisplayOrder()).toComparison();           </span>
<span class="1818990376901269570" onmouseenter="enter('1818990376901269570');" onmouseout="out('1818990376901269570');" style=""> 348         //            }                                                                                  </span>
<span class="-1155227284920485909" onmouseenter="enter('-1155227284920485909');" onmouseout="out('-1155227284920485909');" style=""> 349         //        });                                                                                    </span>
<span  style=""> 350                                                                                                          </span>
<span class="-2061482055453175047" onmouseenter="enter('-2061482055453175047');" onmouseout="out('-2061482055453175047');" style=""> 351         ArrayList&lt;String&gt; stringValues = new ArrayList&lt;&gt;();                                              </span>
<span class="-7157508124377790495" onmouseenter="enter('-7157508124377790495');" onmouseout="out('-7157508124377790495');" style=""> 352         CollectionUtils.collect(values, new Transformer() {                                              </span>
<span  style=""> 353                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 354             @Override                                                                                    </span>
<span class="-2718541205900117239" onmouseenter="enter('-2718541205900117239');" onmouseout="out('-2718541205900117239');" style=""> 355             public Object transform(Object input) {                                                      </span>
<span class="-2749337455813426805" onmouseenter="enter('-2749337455813426805');" onmouseout="out('-2749337455813426805');" style=""> 356                 return ((ProductOptionValue) input).getAttributeValue();                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357             }                                                                                            </span>
<span class="-236589394719861606" onmouseenter="enter('-236589394719861606');" onmouseout="out('-236589394719861606');" style=""> 358         }, stringValues);                                                                                </span>
<span  style=""> 359                                                                                                          </span>
<span class="-3159140932312278736" onmouseenter="enter('-3159140932312278736');" onmouseout="out('-3159140932312278736');" style=""><abbr title=" 360         optionValueProperty.setValue(StringUtils.join(stringValues, CONSOLIDATED_PRODUCT_OPTIONS_DELIMETER));"> 360         optionValueProperty.setValue(StringUtils.join(stringValues, CONSOLIDATED_PRODUCT_OPTIONS_DELIMETEðŸ”µ</abbr></span>
<span class="-6819592353936650784" onmouseenter="enter('-6819592353936650784');" onmouseout="out('-6819592353936650784');" style=""> 361         return optionValueProperty;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 362     }                                                                                                    </span>
<span  style=""> 363                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 364     /**                                                                                                  </span>
<span class="4216744498315651983" onmouseenter="enter('4216744498315651983');" onmouseout="out('4216744498315651983');" style=""> 365      * @return a blank {@link Property} corresponding to the CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 366      */                                                                                                  </span>
<span class="7598660974779837355" onmouseenter="enter('7598660974779837355');" onmouseout="out('7598660974779837355');" style=""> 367     public Property getBlankConsolidatedOptionProperty() {                                               </span>
<span class="6856864467058713906" onmouseenter="enter('6856864467058713906');" onmouseout="out('6856864467058713906');" style=""> 368         Property optionValueProperty = new Property();                                                   </span>
<span class="6345005840174859359" onmouseenter="enter('6345005840174859359');" onmouseout="out('6345005840174859359');" style=""> 369         optionValueProperty.setName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                            </span>
<span class="-7065335864511569913" onmouseenter="enter('-7065335864511569913');" onmouseout="out('-7065335864511569913');" style=""> 370         optionValueProperty.setValue(&quot;&quot;);                                                                </span>
<span class="-6819592353936650784" onmouseenter="enter('-6819592353936650784');" onmouseout="out('-6819592353936650784');" style=""> 371         return optionValueProperty;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372     }                                                                                                    </span>
<span  style=""> 373                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 374     /**                                                                                                  </span>
<span class="6557988157037524501" onmouseenter="enter('6557988157037524501');" onmouseout="out('6557988157037524501');" style=""><abbr title=" 375      * &lt;p&gt;Creates an individual property for the specified product option. This should set up an enum field whose values will"> 375      * &lt;p&gt;Creates an individual property for the specified product option. This should set up an enum fieðŸ”µ</abbr></span>
<span class="5038223503928989560" onmouseenter="enter('5038223503928989560');" onmouseout="out('5038223503928989560');" style=""><abbr title=" 376      * be the option values for this option.  This is useful when you would like to display each product option in as its"> 376      * be the option values for this option.  This is useful when you would like to display each product ðŸ”µ</abbr></span>
<span class="9009411457822617231" onmouseenter="enter('9009411457822617231');" onmouseout="out('9009411457822617231');" style=""> 377      * own field in a grid so that you can further filter by product option values.&lt;/p&gt;                  </span>
<span class="-8656076573134722150" onmouseenter="enter('-8656076573134722150');" onmouseout="out('-8656076573134722150');" style=""><abbr title=" 378      * &lt;p&gt;In order for these fields to be utilized property on the fetch, in the GWT frontend you must use the"> 378      * &lt;p&gt;In order for these fields to be utilized property on the fetch, in the GWT frontend you must usðŸ”µ</abbr></span>
<span class="-3536572176551507765" onmouseenter="enter('-3536572176551507765');" onmouseout="out('-3536572176551507765');" style=""> 379      * for your datasource.&lt;/p&gt;                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 380      *                                                                                                   </span>
<span class="8674570395008402319" onmouseenter="enter('8674570395008402319');" onmouseout="out('8674570395008402319');" style=""> 381      * @param option                                                                                     </span>
<span class="6414796960983960786" onmouseenter="enter('6414796960983960786');" onmouseout="out('6414796960983960786');" style=""> 382      * @param order                                                                                      </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 383      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 384      */                                                                                                  </span>
<span class="8795563977758647136" onmouseenter="enter('8795563977758647136');" onmouseout="out('8795563977758647136');" style=""> 385     public FieldMetadata createIndividualOptionField(ProductOption option, int order) {                  </span>
<span class="7200486368414049440" onmouseenter="enter('7200486368414049440');" onmouseout="out('7200486368414049440');" style=""> 386         if (useToOneLookupSkuProductOptionValue) {                                                       </span>
<span class="-5634467253732639986" onmouseenter="enter('-5634467253732639986');" onmouseout="out('-5634467253732639986');" style=""> 387             return createToOneIndividualOptionField(option, order);                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 388         } else {                                                                                         </span>
<span class="7936034563418693343" onmouseenter="enter('7936034563418693343');" onmouseout="out('7936034563418693343');" style=""> 389             return createExplicitEnumerationIndividualOptionField(option, order);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 391     }                                                                                                    </span>
<span  style=""> 392                                                                                                          </span>
<span class="-8892069303256438111" onmouseenter="enter('-8892069303256438111');" onmouseout="out('-8892069303256438111');" style=""><abbr title=" 393     protected FieldMetadata createExplicitEnumerationIndividualOptionField(ProductOption option, int order) {"> 393     protected FieldMetadata createExplicitEnumerationIndividualOptionField(ProductOption option, int ordeðŸ”µ</abbr></span>
<span class="-7895492162900601652" onmouseenter="enter('-7895492162900601652');" onmouseout="out('-7895492162900601652');" style=""> 394         BasicFieldMetadata metadata = new BasicFieldMetadata();                                          </span>
<span class="-2416891430670029479" onmouseenter="enter('-2416891430670029479');" onmouseout="out('-2416891430670029479');" style=""> 395         List&lt;ProductOptionValue&gt; allowedValues = option.getAllowedValues();                              </span>
<span class="9151233583168413632" onmouseenter="enter('9151233583168413632');" onmouseout="out('9151233583168413632');" style=""> 396         if (CollectionUtils.isNotEmpty(allowedValues)) {                                                 </span>
<span class="4285129340737600689" onmouseenter="enter('4285129340737600689');" onmouseout="out('4285129340737600689');" style=""> 397             metadata.setFieldType(SupportedFieldType.EXPLICIT_ENUMERATION);                              </span>
<span class="-6206284717251400514" onmouseenter="enter('-6206284717251400514');" onmouseout="out('-6206284717251400514');" style=""> 398             metadata.setMutable(true);                                                                   </span>
<span class="8194069883044431071" onmouseenter="enter('8194069883044431071');" onmouseout="out('8194069883044431071');" style=""> 399             metadata.setInheritedFromType(SkuImpl.class.getName());                                      </span>
<span class="7921709413407422398" onmouseenter="enter('7921709413407422398');" onmouseout="out('7921709413407422398');" style=""><abbr title=" 400             metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCache()));"> 400             metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheServiceðŸ”µ</abbr></span>
<span class="7303907294085574775" onmouseenter="enter('7303907294085574775');" onmouseout="out('7303907294085574775');" style=""> 401             metadata.setForeignKeyCollection(false);                                                     </span>
<span class="-1649079592520542152" onmouseenter="enter('-1649079592520542152');" onmouseout="out('-1649079592520542152');" style=""> 402             metadata.setMergedPropertyType(MergedPropertyType.PRIMARY);                                  </span>
<span  style=""> 403                                                                                                          </span>
<span class="-1089414754199454043" onmouseenter="enter('-1089414754199454043');" onmouseout="out('-1089414754199454043');" style=""> 404             //Set up the enumeration based on the product option values                                  </span>
<span class="-4938595371513432920" onmouseenter="enter('-4938595371513432920');" onmouseout="out('-4938595371513432920');" style=""> 405             String[][] optionValues = new String[allowedValues.size()][2];                               </span>
<span class="6205975934798560127" onmouseenter="enter('6205975934798560127');" onmouseout="out('6205975934798560127');" style=""> 406             for (int i = 0; i &lt; allowedValues.size(); i++) {                                             </span>
<span class="5655693563027021374" onmouseenter="enter('5655693563027021374');" onmouseout="out('5655693563027021374');" style=""> 407                 ProductOptionValue value = option.getAllowedValues().get(i);                             </span>
<span class="-6097967761511863324" onmouseenter="enter('-6097967761511863324');" onmouseout="out('-6097967761511863324');" style=""> 408                 optionValues[i][0] = value.getId().toString();                                           </span>
<span class="-2028520644986671717" onmouseenter="enter('-2028520644986671717');" onmouseout="out('-2028520644986671717');" style=""> 409                 optionValues[i][1] = value.getAttributeValue();                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410             }                                                                                            </span>
<span class="8277090772710644263" onmouseenter="enter('8277090772710644263');" onmouseout="out('8277090772710644263');" style=""> 411             metadata.setEnumerationValues(optionValues);                                                 </span>
<span  style=""> 412                                                                                                          </span>
<span class="1748190162337854256" onmouseenter="enter('1748190162337854256');" onmouseout="out('1748190162337854256');" style=""> 413             metadata.setName(PRODUCT_OPTION_FIELD_PREFIX + option.getId());                              </span>
<span class="7017269500484793927" onmouseenter="enter('7017269500484793927');" onmouseout="out('7017269500484793927');" style=""> 414             metadata.setFriendlyName(option.getLabel());                                                 </span>
<span class="6085246036283927461" onmouseenter="enter('6085246036283927461');" onmouseout="out('6085246036283927461');" style=""> 415             metadata.setGroup(&quot;productOption_group&quot;);                                                    </span>
<span class="-8050220525630720562" onmouseenter="enter('-8050220525630720562');" onmouseout="out('-8050220525630720562');" style=""> 416             metadata.setGroupOrder(-1);                                                                  </span>
<span class="3406381469360124301" onmouseenter="enter('3406381469360124301');" onmouseout="out('3406381469360124301');" style=""> 417             metadata.setOrder(order);                                                                    </span>
<span class="8683462265874380595" onmouseenter="enter('8683462265874380595');" onmouseout="out('8683462265874380595');" style=""> 418             metadata.setExplicitFieldType(SupportedFieldType.UNKNOWN);                                   </span>
<span class="-6994608424159816416" onmouseenter="enter('-6994608424159816416');" onmouseout="out('-6994608424159816416');" style=""> 419             metadata.setProminent(false);                                                                </span>
<span class="6274758849936387106" onmouseenter="enter('6274758849936387106');" onmouseout="out('6274758849936387106');" style=""> 420             metadata.setVisibility(VisibilityEnum.FORM_EXPLICITLY_SHOWN);                                </span>
<span class="8945700141771923055" onmouseenter="enter('8945700141771923055');" onmouseout="out('8945700141771923055');" style=""> 421             metadata.setBroadleafEnumeration(&quot;&quot;);                                                        </span>
<span class="8076682597610338410" onmouseenter="enter('8076682597610338410');" onmouseout="out('8076682597610338410');" style=""> 422             metadata.setReadOnly(false);                                                                 </span>
<span class="2131936785391707598" onmouseenter="enter('2131936785391707598');" onmouseout="out('2131936785391707598');" style=""> 423             metadata.setRequiredOverride(BooleanUtils.isFalse(option.getRequired()));                    </span>
<span  style=""> 424                                                                                                          </span>
<span class="-6736542809122384852" onmouseenter="enter('-6736542809122384852');" onmouseout="out('-6736542809122384852');" style=""> 425             return metadata;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 426         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 427         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 428     }                                                                                                    </span>
<span  style=""> 429                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 430     /**                                                                                                  </span>
<span class="7683644189550699004" onmouseenter="enter('7683644189550699004');" onmouseout="out('7683644189550699004');" style=""><abbr title=" 431      * Using a ToOne lookup performs much better for large product option value lists, speeds up initial page load,"> 431      * Using a ToOne lookup performs much better for large product option value lists, speeds up initial ðŸ”µ</abbr></span>
<span class="-6062867542246075622" onmouseenter="enter('-6062867542246075622');" onmouseout="out('-6062867542246075622');" style=""><abbr title=" 432      * and is generally more accurate in relation to option value updates and how they impact available selections and cache."> 432      * and is generally more accurate in relation to option value updates and how they impact available sðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 433      *                                                                                                   </span>
<span class="8674570395008402319" onmouseenter="enter('8674570395008402319');" onmouseout="out('8674570395008402319');" style=""> 434      * @param option                                                                                     </span>
<span class="6414796960983960786" onmouseenter="enter('6414796960983960786');" onmouseout="out('6414796960983960786');" style=""> 435      * @param order                                                                                      </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 436      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 437      */                                                                                                  </span>
<span class="6879137344207562675" onmouseenter="enter('6879137344207562675');" onmouseout="out('6879137344207562675');" style=""> 438     protected FieldMetadata createToOneIndividualOptionField(ProductOption option, int order) {          </span>
<span class="-8449939433228375667" onmouseenter="enter('-8449939433228375667');" onmouseout="out('-8449939433228375667');" style=""> 439         PersistenceManager persistenceManager = PersistenceManagerFactory.getPersistenceManager();       </span>
<span class="-4187363957527008750" onmouseenter="enter('-4187363957527008750');" onmouseout="out('-4187363957527008750');" style=""> 440         FilterMapping filterMapping = new FilterMapping().withDirectFilterValues(                        </span>
<span class="-3894749102720902409" onmouseenter="enter('-3894749102720902409');" onmouseout="out('-3894749102720902409');" style=""><abbr title=" 441                 sandBoxHelper.mergeCloneIds(ProductOptionImpl.class, option.getId())).withRestriction(new Restriction()"> 441                 sandBoxHelper.mergeCloneIds(ProductOptionImpl.class, option.getId())).withRestriction(newðŸ”µ</abbr></span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 442             .withPredicateProvider(new PredicateProvider() {                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 443                 @Override                                                                                </span>
<span class="-5588636227064039300" onmouseenter="enter('-5588636227064039300');" onmouseout="out('-5588636227064039300');" style=""><abbr title=" 444                 public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder, From root,"> 444                 public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuildeðŸ”µ</abbr></span>
<span class="-2899522305959899483" onmouseenter="enter('-2899522305959899483');" onmouseout="out('-2899522305959899483');" style=""><abbr title=" 445                                                 String ceilingEntity, String fullPropertyName, Path explicitPath, List directValues) {"> 445                                                 String ceilingEntity, String fullPropertyName, Path expliðŸ”µ</abbr></span>
<span class="-933702984903214818" onmouseenter="enter('-933702984903214818');" onmouseout="out('-933702984903214818');" style=""> 446                     return root.get(&quot;productOption&quot;).get(&quot;id&quot;).in(directValues);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 447             }                                                                                            </span>
<span class="-800954676578401248" onmouseenter="enter('-800954676578401248');" onmouseout="out('-800954676578401248');" style=""> 448         }));                                                                                             </span>
<span class="9067714061330870114" onmouseenter="enter('9067714061330870114');" onmouseout="out('9067714061330870114');" style=""> 449         List&lt;FilterMapping&gt; mappings = new ArrayList&lt;&gt;();                                                </span>
<span class="345189471467363285" onmouseenter="enter('345189471467363285');" onmouseout="out('345189471467363285');" style=""> 450         mappings.add(filterMapping);                                                                     </span>
<span class="7291356103073076244" onmouseenter="enter('7291356103073076244');" onmouseout="out('7291356103073076244');" style=""><abbr title=" 451         TypedQuery&lt;Serializable&gt; countQuery = criteriaTranslator.translateCountQuery(persistenceManager.getDynamicEntityDao(),"> 451         TypedQuery&lt;Serializable&gt; countQuery = criteriaTranslator.translateCountQuery(persistenceManager.gðŸ”µ</abbr></span>
<span class="-6376296202628097343" onmouseenter="enter('-6376296202628097343');" onmouseout="out('-6376296202628097343');" style=""> 452                 ProductOptionValueImpl.class.getName(), mappings);                                       </span>
<span class="5779175921552777483" onmouseenter="enter('5779175921552777483');" onmouseout="out('5779175921552777483');" style=""> 453         Long count = (Long) countQuery.getSingleResult();                                                </span>
<span class="3590816377844072638" onmouseenter="enter('3590816377844072638');" onmouseout="out('3590816377844072638');" style=""> 454         BasicFieldMetadata metadata = null;                                                              </span>
<span class="7377439406723422491" onmouseenter="enter('7377439406723422491');" onmouseout="out('7377439406723422491');" style=""> 455         if (count &gt; 0) {                                                                                 </span>
<span class="-1273552772110171187" onmouseenter="enter('-1273552772110171187');" onmouseout="out('-1273552772110171187');" style=""> 456             metadata = new BasicFieldMetadata();                                                         </span>
<span class="7837199979125359629" onmouseenter="enter('7837199979125359629');" onmouseout="out('7837199979125359629');" style=""> 457             metadata.setFieldType(SupportedFieldType.ADDITIONAL_FOREIGN_KEY);                            </span>
<span class="-7466329847812031362" onmouseenter="enter('-7466329847812031362');" onmouseout="out('-7466329847812031362');" style=""> 458             metadata.setSecondaryType(SupportedFieldType.INTEGER);                                       </span>
<span class="-31286131392644862" onmouseenter="enter('-31286131392644862');" onmouseout="out('-31286131392644862');" style=""> 459             metadata.setForeignKeyProperty(&quot;id&quot;);                                                        </span>
<span class="332716961677554697" onmouseenter="enter('332716961677554697');" onmouseout="out('332716961677554697');" style=""> 460             metadata.setForeignKeyClass(ProductOptionValueImpl.class.getName());                         </span>
<span class="-4184418208857498113" onmouseenter="enter('-4184418208857498113');" onmouseout="out('-4184418208857498113');" style=""> 461             metadata.setForeignKeyDisplayValueProperty(&quot;attributeValue&quot;);                                </span>
<span class="4257701647031084459" onmouseenter="enter('4257701647031084459');" onmouseout="out('4257701647031084459');" style=""> 462             metadata.setLookupDisplayProperty(&quot;attributeValue&quot;);                                         </span>
<span class="7303907294085574775" onmouseenter="enter('7303907294085574775');" onmouseout="out('7303907294085574775');" style=""> 463             metadata.setForeignKeyCollection(false);                                                     </span>
<span class="6675602877003966627" onmouseenter="enter('6675602877003966627');" onmouseout="out('6675602877003966627');" style=""> 464             metadata.setCustomCriteria(new String[]{&quot;option=&quot; + String.valueOf(option.getId())});        </span>
<span class="1748190162337854256" onmouseenter="enter('1748190162337854256');" onmouseout="out('1748190162337854256');" style=""> 465             metadata.setName(PRODUCT_OPTION_FIELD_PREFIX + option.getId());                              </span>
<span class="7017269500484793927" onmouseenter="enter('7017269500484793927');" onmouseout="out('7017269500484793927');" style=""> 466             metadata.setFriendlyName(option.getLabel());                                                 </span>
<span class="6085246036283927461" onmouseenter="enter('6085246036283927461');" onmouseout="out('6085246036283927461');" style=""> 467             metadata.setGroup(&quot;productOption_group&quot;);                                                    </span>
<span class="-8050220525630720562" onmouseenter="enter('-8050220525630720562');" onmouseout="out('-8050220525630720562');" style=""> 468             metadata.setGroupOrder(-1);                                                                  </span>
<span class="3406381469360124301" onmouseenter="enter('3406381469360124301');" onmouseout="out('3406381469360124301');" style=""> 469             metadata.setOrder(order);                                                                    </span>
<span class="2043314380305444305" onmouseenter="enter('2043314380305444305');" onmouseout="out('2043314380305444305');" style=""> 470             metadata.setExplicitFieldType(SupportedFieldType.ADDITIONAL_FOREIGN_KEY);                    </span>
<span class="-6994608424159816416" onmouseenter="enter('-6994608424159816416');" onmouseout="out('-6994608424159816416');" style=""> 471             metadata.setProminent(false);                                                                </span>
<span class="6274758849936387106" onmouseenter="enter('6274758849936387106');" onmouseout="out('6274758849936387106');" style=""> 472             metadata.setVisibility(VisibilityEnum.FORM_EXPLICITLY_SHOWN);                                </span>
<span class="8076682597610338410" onmouseenter="enter('8076682597610338410');" onmouseout="out('8076682597610338410');" style=""> 473             metadata.setReadOnly(false);                                                                 </span>
<span class="-4603246565563510167" onmouseenter="enter('-4603246565563510167');" onmouseout="out('-4603246565563510167');" style=""><abbr title=" 474             //these may not be actually required, but the CPH has this as a requirement for parsing the data, so we&#x27;ll stick with it here"> 474             //these may not be actually required, but the CPH has this as a requirement for parsing the dðŸ”µ</abbr></span>
<span class="6102752219358130186" onmouseenter="enter('6102752219358130186');" onmouseout="out('6102752219358130186');" style=""> 475             metadata.setRequiredOverride(true);                                                          </span>
<span class="-3053289446243924099" onmouseenter="enter('-3053289446243924099');" onmouseout="out('-3053289446243924099');" style=""> 476             metadata.setLookupType(LookupType.STANDARD);                                                 </span>
<span class="-6206284717251400514" onmouseenter="enter('-6206284717251400514');" onmouseout="out('-6206284717251400514');" style=""> 477             metadata.setMutable(true);                                                                   </span>
<span class="8194069883044431071" onmouseenter="enter('8194069883044431071');" onmouseout="out('8194069883044431071');" style=""> 478             metadata.setInheritedFromType(SkuImpl.class.getName());                                      </span>
<span class="7921709413407422398" onmouseenter="enter('7921709413407422398');" onmouseout="out('7921709413407422398');" style=""><abbr title=" 479             metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCache()));"> 479             metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheServiceðŸ”µ</abbr></span>
<span class="-1649079592520542152" onmouseenter="enter('-1649079592520542152');" onmouseout="out('-1649079592520542152');" style=""> 480             metadata.setMergedPropertyType(MergedPropertyType.PRIMARY);                                  </span>
<span class="5062289219461079509" onmouseenter="enter('5062289219461079509');" onmouseout="out('5062289219461079509');" style=""> 481             metadata.setTargetClass(SkuImpl.class.getName());                                            </span>
<span class="-6501495819508426588" onmouseenter="enter('-6501495819508426588');" onmouseout="out('-6501495819508426588');" style=""> 482             metadata.setFieldName(PRODUCT_OPTION_FIELD_PREFIX + option.getId());                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 483         }                                                                                                </span>
<span class="-6736542809122384852" onmouseenter="enter('-6736542809122384852');" onmouseout="out('-6736542809122384852');" style=""> 484         return metadata;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485     }                                                                                                    </span>
<span  style=""> 486                                                                                                          </span>
<span class="7948482626287429940" onmouseenter="enter('7948482626287429940');" onmouseout="out('7948482626287429940');" style=""> 487     @SuppressWarnings(&quot;unchecked&quot;)                                                                       </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 488     @Override                                                                                            </span>
<span class="-1282377985319068039" onmouseenter="enter('-1282377985319068039');" onmouseout="out('-1282377985319068039');" style=""><abbr title=" 489     public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 489     public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynaðŸ”µ</abbr></span>
<span class="2519389108374285224" onmouseenter="enter('2519389108374285224');" onmouseout="out('2519389108374285224');" style=""><abbr title=" 490         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname();"> 490         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 491         try {                                                                                            </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""><abbr title=" 492             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();"> 492             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective(ðŸ”µ</abbr></span>
<span class="-4474933170501730421" onmouseenter="enter('-4474933170501730421');" onmouseout="out('-4474933170501730421');" style=""> 493             //get the default properties from Sku and its subclasses                                     </span>
<span class="-1647605982225346371" onmouseenter="enter('-1647605982225346371');" onmouseout="out('-1647605982225346371');" style=""><abbr title=" 494             Map&lt;String, FieldMetadata&gt; originalProps = helper.getSimpleMergedProperties(Sku.class.getName(), persistencePerspective);"> 494             Map&lt;String, FieldMetadata&gt; originalProps = helper.getSimpleMergedProperties(Sku.class.getNameðŸ”µ</abbr></span>
<span  style=""> 495                                                                                                          </span>
<span class="796362017556902885" onmouseenter="enter('796362017556902885');" onmouseout="out('796362017556902885');" style=""> 496             //Pull back the Skus based on the criteria from the client                                   </span>
<span class="-363648758652557915" onmouseenter="enter('-363648758652557915');" onmouseout="out('-363648758652557915');" style=""><abbr title=" 497             List&lt;FilterMapping&gt; filterMappings = helper.getFilterMappings(persistencePerspective, cto, ceilingEntityFullyQualifiedClassname, originalProps);"> 497             List&lt;FilterMapping&gt; filterMappings = helper.getFilterMappings(persistencePerspective, cto, ceðŸ”µ</abbr></span>
<span  style=""> 498                                                                                                          </span>
<span class="-3675685187725351740" onmouseenter="enter('-3675685187725351740');" onmouseout="out('-3675685187725351740');" style=""> 499             //allow subclasses to provide additional criteria before executing the query                 </span>
<span class="-7008588708271197253" onmouseenter="enter('-7008588708271197253');" onmouseout="out('-7008588708271197253');" style=""> 500             applyProductOptionValueCriteria(filterMappings, cto, persistencePackage, null);              </span>
<span class="4646076149717404025" onmouseenter="enter('4646076149717404025');" onmouseout="out('4646076149717404025');" style=""> 501             applySkuBundleItemValueCriteria(filterMappings, cto, persistencePackage);                    </span>
<span class="-2737785807325266" onmouseenter="enter('-2737785807325266');" onmouseout="out('-2737785807325266');" style=""> 502             applyAdditionalFetchCriteria(filterMappings, cto, persistencePackage);                       </span>
<span  style=""> 503                                                                                                          </span>
<span class="-4634567455719757558" onmouseenter="enter('-4634567455719757558');" onmouseout="out('-4634567455719757558');" style=""><abbr title=" 504             List&lt;Serializable&gt; records = helper.getPersistentRecords(persistencePackage.getCeilingEntityFullyQualifiedClassname(), filterMappings, cto.getFirstResult(), cto.getMaxResults());"> 504             List&lt;Serializable&gt; records = helper.getPersistentRecords(persistencePackage.getCeilingEntityFðŸ”µ</abbr></span>
<span class="-5982273033000910285" onmouseenter="enter('-5982273033000910285');" onmouseout="out('-5982273033000910285');" style=""> 505             //Convert Skus into the client-side Entity representation                                    </span>
<span class="-2996861390233909505" onmouseenter="enter('-2996861390233909505');" onmouseout="out('-2996861390233909505');" style=""> 506             Entity[] payload = helper.getRecords(originalProps, records);                                </span>
<span  style=""> 507                                                                                                          </span>
<span class="-4184869795171170066" onmouseenter="enter('-4184869795171170066');" onmouseout="out('-4184869795171170066');" style=""><abbr title=" 508             int totalRecords = helper.getTotalRecords(persistencePackage.getCeilingEntityFullyQualifiedClassname(), filterMappings);"> 508             int totalRecords = helper.getTotalRecords(persistencePackage.getCeilingEntityFullyQualifiedClðŸ”µ</abbr></span>
<span  style=""> 509                                                                                                          </span>
<span class="-3763055148335758582" onmouseenter="enter('-3763055148335758582');" onmouseout="out('-3763055148335758582');" style=""><abbr title=" 510             //Now fill out the relevant properties for the product options for the Skus that were returned"> 510             //Now fill out the relevant properties for the product options for the Skus that were returneðŸ”µ</abbr></span>
<span class="7697812602397668509" onmouseenter="enter('7697812602397668509');" onmouseout="out('7697812602397668509');" style=""> 511             updateProductOptionFieldsForFetch(records, payload);                                         </span>
<span  style=""> 512                                                                                                          </span>
<span class="-8933105127068001704" onmouseenter="enter('-8933105127068001704');" onmouseout="out('-8933105127068001704');" style=""> 513             return new DynamicResultSet(payload, totalRecords);                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 514         } catch (Exception e) {                                                                          </span>
<span class="733531699862187915" onmouseenter="enter('733531699862187915');" onmouseout="out('733531699862187915');" style=""><abbr title=" 515             throw new ServiceException(&quot;Unable to perform fetch for entity: &quot; + ceilingEntityFullyQualifiedClassname, e);"> 515             throw new ServiceException(&quot;Unable to perform fetch for entity: &quot; + ceilingEntityFullyQualifiðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 516         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 517     }                                                                                                    </span>
<span  style=""> 518                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 519     /**                                                                                                  </span>
<span class="-7824652902262605659" onmouseenter="enter('-7824652902262605659');" onmouseout="out('-7824652902262605659');" style=""><abbr title=" 520      * Sets the {@link ProductOptionValue}s of the given {@link Sku}s in a list format for display in a ListGrid context."> 520      * Sets the {@link ProductOptionValue}s of the given {@link Sku}s in a list format for display in a LðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 521      *                                                                                                   </span>
<span class="-4052130305078083276" onmouseenter="enter('-4052130305078083276');" onmouseout="out('-4052130305078083276');" style=""> 522      * @param records                                                                                    </span>
<span class="-6904460697287898969" onmouseenter="enter('-6904460697287898969');" onmouseout="out('-6904460697287898969');" style=""> 523      * @param payload                                                                                    </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 524      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 525      */                                                                                                  </span>
<span class="3124517244149022485" onmouseenter="enter('3124517244149022485');" onmouseout="out('3124517244149022485');" style=""> 526     public void updateProductOptionFieldsForFetch(List&lt;Serializable&gt; records, Entity[] payload) {        </span>
<span class="-7972041122971845939" onmouseenter="enter('-7972041122971845939');" onmouseout="out('-7972041122971845939');" style=""> 527         for (int i = 0; i &lt; records.size(); i++) {                                                       </span>
<span class="-3191004483130397206" onmouseenter="enter('-3191004483130397206');" onmouseout="out('-3191004483130397206');" style=""> 528             Sku sku = (Sku) records.get(i);                                                              </span>
<span class="6067761635845867397" onmouseenter="enter('6067761635845867397');" onmouseout="out('6067761635845867397');" style=""> 529             Entity entity = payload[i];                                                                  </span>
<span  style=""> 530                                                                                                          </span>
<span class="-1747148511640135280" onmouseenter="enter('-1747148511640135280');" onmouseout="out('-1747148511640135280');" style=""><abbr title=" 531             List&lt;ProductOptionValue&gt; optionValues = BLCCollectionUtils.collectList(sku.getProductOptionValueXrefs(), new TypedTransformer&lt;ProductOptionValue&gt;() {"> 531             List&lt;ProductOptionValue&gt; optionValues = BLCCollectionUtils.collectList(sku.getProductOptionVaðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 532                 @Override                                                                                </span>
<span class="1152092933178682803" onmouseenter="enter('1152092933178682803');" onmouseout="out('1152092933178682803');" style=""> 533                 public ProductOptionValue transform(Object input) {                                      </span>
<span class="-8868352318711405431" onmouseenter="enter('-8868352318711405431');" onmouseout="out('-8868352318711405431');" style=""> 534                     return ((SkuProductOptionValueXref) input).getProductOptionValue();                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 535                 }                                                                                        </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 536             });                                                                                          </span>
<span  style=""> 537                                                                                                          </span>
<span class="-1852425527821468846" onmouseenter="enter('-1852425527821468846');" onmouseout="out('-1852425527821468846');" style=""> 538             for (ProductOptionValue value : optionValues) {                                              </span>
<span class="6080984475054679236" onmouseenter="enter('6080984475054679236');" onmouseout="out('6080984475054679236');" style=""> 539                 Property optionProperty = new Property();                                                </span>
<span class="4438211203610377533" onmouseenter="enter('4438211203610377533');" onmouseout="out('4438211203610377533');" style=""> 540                 optionProperty.setName(PRODUCT_OPTION_FIELD_PREFIX + value.getProductOption().getId());  </span>
<span class="-3040338369255071721" onmouseenter="enter('-3040338369255071721');" onmouseout="out('-3040338369255071721');" style=""> 541                 optionProperty.setValue(value.getId().toString());                                       </span>
<span class="4260727162498882307" onmouseenter="enter('4260727162498882307');" onmouseout="out('4260727162498882307');" style=""> 542                 optionProperty.setDisplayValue(value.getAttributeValue());                               </span>
<span class="1859377182209271680" onmouseenter="enter('1859377182209271680');" onmouseout="out('1859377182209271680');" style=""> 543                 entity.addProperty(optionProperty);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 544             }                                                                                            </span>
<span  style=""> 545                                                                                                          </span>
<span class="4597418554840578281" onmouseenter="enter('4597418554840578281');" onmouseout="out('4597418554840578281');" style=""> 546             if (CollectionUtils.isNotEmpty(optionValues)) {                                              </span>
<span class="5213586233451889239" onmouseenter="enter('5213586233451889239');" onmouseout="out('5213586233451889239');" style=""> 547                 entity.addProperty(getConsolidatedOptionProperty(optionValues));                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 548             } else {                                                                                     </span>
<span class="-6341791635059832722" onmouseenter="enter('-6341791635059832722');" onmouseout="out('-6341791635059832722');" style=""> 549                 entity.addProperty(getBlankConsolidatedOptionProperty());                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 550             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 551         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 552     }                                                                                                    </span>
<span  style=""> 553                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 554     /**                                                                                                  </span>
<span class="7787882510504443634" onmouseenter="enter('7787882510504443634');" onmouseout="out('7787882510504443634');" style=""><abbr title=" 555      * Add filter restriction such that a ProductBundle cannot add its own default sku as a Sku Bundle Item"> 555      * Add filter restriction such that a ProductBundle cannot add its own default sku as a Sku Bundle ItðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 556      */                                                                                                  </span>
<span class="-7214039343588646460" onmouseenter="enter('-7214039343588646460');" onmouseout="out('-7214039343588646460');" style=""><abbr title=" 557     private void applySkuBundleItemValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PersistencePackage persistencePackage) {"> 557     private void applySkuBundleItemValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObjeðŸ”µ</abbr></span>
<span class="-8187222964943103604" onmouseenter="enter('-8187222964943103604');" onmouseout="out('-8187222964943103604');" style=""> 558         SectionCrumb[] sectionCrumbs = persistencePackage.getSectionCrumbs();                            </span>
<span class="-1899330423728999759" onmouseenter="enter('-1899330423728999759');" onmouseout="out('-1899330423728999759');" style=""> 559         if (isSkuBundleItemLookup(persistencePackage, sectionCrumbs)) {                                  </span>
<span class="8268114114086125791" onmouseenter="enter('8268114114086125791');" onmouseout="out('8268114114086125791');" style=""> 560             final Long defaultSkuId = getOwningProductBundlesDefaultSkuId(sectionCrumbs[0]);             </span>
<span  style=""> 561                                                                                                          </span>
<span class="8197169377808819118" onmouseenter="enter('8197169377808819118');" onmouseout="out('8197169377808819118');" style=""> 562             filterMappings.add(new FilterMapping()                                                       </span>
<span class="-2686901866072439951" onmouseenter="enter('-2686901866072439951');" onmouseout="out('-2686901866072439951');" style=""> 563                     .withDirectFilterValues(Collections.singletonList(defaultSkuId))                     </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 564                     .withRestriction(new Restriction()                                                   </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 565                                     .withPredicateProvider(new PredicateProvider() {                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 566                                         @Override                                                        </span>
<span class="-6543887403560352788" onmouseenter="enter('-6543887403560352788');" onmouseout="out('-6543887403560352788');" style=""> 567                                         public Predicate buildPredicate(CriteriaBuilder builder,         </span>
<span class="-7125560532692692259" onmouseenter="enter('-7125560532692692259');" onmouseout="out('-7125560532692692259');" style=""> 568                                                 FieldPathBuilder fieldPathBuilder,                       </span>
<span class="8221798817053541417" onmouseenter="enter('8221798817053541417');" onmouseout="out('8221798817053541417');" style=""> 569                                                 From root, String ceilingEntity,                         </span>
<span class="-5624751861859036647" onmouseenter="enter('-5624751861859036647');" onmouseout="out('-5624751861859036647');" style=""> 570                                                 String fullPropertyName, Path explicitPath,              </span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style=""> 571                                                 List directValues) {                                     </span>
<span class="4460015033870714518" onmouseenter="enter('4460015033870714518');" onmouseout="out('4460015033870714518');" style=""> 572                                             return builder.notEqual(root, directValues.get(0));          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 573                                         }                                                                </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 574                                     })                                                                   </span>
<span class="3699784701886273761" onmouseenter="enter('3699784701886273761');" onmouseout="out('3699784701886273761');" style=""> 575                     ));                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 576         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 577     }                                                                                                    </span>
<span  style=""> 578                                                                                                          </span>
<span class="-2798114006144580065" onmouseenter="enter('-2798114006144580065');" onmouseout="out('-2798114006144580065');" style=""> 579     private boolean isSkuBundleItemLookup(PersistencePackage pkg, SectionCrumb[] sectionCrumbs) {        </span>
<span class="1586917148156434191" onmouseenter="enter('1586917148156434191');" onmouseout="out('1586917148156434191');" style=""> 580         boolean owningClassMatch = false;                                                                </span>
<span class="-67344974392233049" onmouseenter="enter('-67344974392233049');" onmouseout="out('-67344974392233049');" style=""> 581         boolean requestingFieldMatch = false;                                                            </span>
<span  style=""> 582                                                                                                          </span>
<span class="-4586108065315097422" onmouseenter="enter('-4586108065315097422');" onmouseout="out('-4586108065315097422');" style=""> 583         if (pkg.getCustomCriteria() == null || ArrayUtils.isEmpty(sectionCrumbs)) {                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 584             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 585         }                                                                                                </span>
<span  style=""> 586                                                                                                          </span>
<span class="-2549092676085499199" onmouseenter="enter('-2549092676085499199');" onmouseout="out('-2549092676085499199');" style=""> 587         for (String criteria : pkg.getCustomCriteria()) {                                                </span>
<span class="-2108620833305617258" onmouseenter="enter('-2108620833305617258');" onmouseout="out('-2108620833305617258');" style=""><abbr title=" 588             if (&quot;owningClass=org.broadleafcommerce.core.catalog.domain.SkuBundleItemImpl&quot;.equals(criteria)) {"> 588             if (&quot;owningClass=org.broadleafcommerce.core.catalog.domain.SkuBundleItemImpl&quot;.equals(criteriaðŸ”µ</abbr></span>
<span class="8041666773318789268" onmouseenter="enter('8041666773318789268');" onmouseout="out('8041666773318789268');" style=""> 589                 owningClassMatch = true;                                                                 </span>
<span class="4858029770045852471" onmouseenter="enter('4858029770045852471');" onmouseout="out('4858029770045852471');" style=""> 590             } else if (&quot;requestingField=sku&quot;.equals(criteria)) {                                         </span>
<span class="-1860793199325339033" onmouseenter="enter('-1860793199325339033');" onmouseout="out('-1860793199325339033');" style=""> 591                 requestingFieldMatch = true;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 592             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 593         }                                                                                                </span>
<span  style=""> 594                                                                                                          </span>
<span class="-3217646211476483325" onmouseenter="enter('-3217646211476483325');" onmouseout="out('-3217646211476483325');" style=""><abbr title=" 595         boolean sectionCrumbMatch = ProductImpl.class.getCanonicalName().equals(sectionCrumbs[0].getSectionIdentifier());"> 595         boolean sectionCrumbMatch = ProductImpl.class.getCanonicalName().equals(sectionCrumbs[0].getSectiðŸ”µ</abbr></span>
<span  style=""> 596                                                                                                          </span>
<span class="6240774352197414719" onmouseenter="enter('6240774352197414719');" onmouseout="out('6240774352197414719');" style=""> 597         return owningClassMatch &amp;&amp; requestingFieldMatch &amp;&amp; sectionCrumbMatch;                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 598     }                                                                                                    </span>
<span  style=""> 599                                                                                                          </span>
<span class="-1671571892486457707" onmouseenter="enter('-1671571892486457707');" onmouseout="out('-1671571892486457707');" style=""> 600     private Long getOwningProductBundlesDefaultSkuId(SectionCrumb sectionCrumb) {                        </span>
<span class="2328697212854986127" onmouseenter="enter('2328697212854986127');" onmouseout="out('2328697212854986127');" style=""> 601         if (ProductImpl.class.getCanonicalName().equals(sectionCrumb.getSectionIdentifier())             </span>
<span class="-9004648441586212047" onmouseenter="enter('-9004648441586212047');" onmouseout="out('-9004648441586212047');" style=""> 602                 &amp;&amp; sectionCrumb.getSectionId() != null) {                                                </span>
<span class="4513323716586759964" onmouseenter="enter('4513323716586759964');" onmouseout="out('4513323716586759964');" style=""><abbr title=" 603             ProductBundle productBundle = (ProductBundle) catalogService.findProductById(Long.valueOf(sectionCrumb.getSectionId()));"> 603             ProductBundle productBundle = (ProductBundle) catalogService.findProductById(Long.valueOf(secðŸ”µ</abbr></span>
<span class="4400035530065637673" onmouseenter="enter('4400035530065637673');" onmouseout="out('4400035530065637673');" style=""> 604             return productBundle.getDefaultSku().getId();                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 605         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 606         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 607     }                                                                                                    </span>
<span  style=""> 608                                                                                                          </span>
<span class="-7687230963098454148" onmouseenter="enter('-7687230963098454148');" onmouseout="out('-7687230963098454148');" style=""><abbr title=" 609     public void applyProductOptionValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PersistencePackage persistencePackage, String skuPropertyPrefix) {"> 609     public void applyProductOptionValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObjecðŸ”µ</abbr></span>
<span  style=""> 610                                                                                                          </span>
<span class="942620444934049587" onmouseenter="enter('942620444934049587');" onmouseout="out('942620444934049587');" style=""> 611         //if the front                                                                                   </span>
<span class="8112796229062982729" onmouseenter="enter('8112796229062982729');" onmouseout="out('8112796229062982729');" style=""> 612         final List&lt;Long&gt; productOptionValueFilterIDs = new ArrayList&lt;&gt;();                                </span>
<span class="-6853245302921753815" onmouseenter="enter('-6853245302921753815');" onmouseout="out('-6853245302921753815');" style=""> 613         for (String filterProperty : cto.getCriteriaMap().keySet()) {                                    </span>
<span class="-4107857553734806058" onmouseenter="enter('-4107857553734806058');" onmouseout="out('-4107857553734806058');" style=""> 614             if (filterProperty.startsWith(PRODUCT_OPTION_FIELD_PREFIX)) {                                </span>
<span class="-1621748473978415179" onmouseenter="enter('-1621748473978415179');" onmouseout="out('-1621748473978415179');" style=""> 615                 FilterAndSortCriteria criteria = cto.get(filterProperty);                                </span>
<span class="5553495253525789791" onmouseenter="enter('5553495253525789791');" onmouseout="out('5553495253525789791');" style=""> 616                 productOptionValueFilterIDs.add(Long.parseLong(criteria.getFilterValues().get(0)));      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 617             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 618         }                                                                                                </span>
<span  style=""> 619                                                                                                          </span>
<span class="4522856558687017152" onmouseenter="enter('4522856558687017152');" onmouseout="out('4522856558687017152');" style=""> 620         //also determine if there is a consolidated POV query                                            </span>
<span class="-8501099544391483771" onmouseenter="enter('-8501099544391483771');" onmouseout="out('-8501099544391483771');" style=""> 621         final List&lt;String&gt; productOptionValueFilterValues = new ArrayList&lt;&gt;();                           </span>
<span class="-3774683769233331029" onmouseenter="enter('-3774683769233331029');" onmouseout="out('-3774683769233331029');" style=""> 622         FilterAndSortCriteria consolidatedCriteria = cto.get(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);   </span>
<span class="3919937138964866453" onmouseenter="enter('3919937138964866453');" onmouseout="out('3919937138964866453');" style=""> 623         if (!consolidatedCriteria.getFilterValues().isEmpty()) {                                         </span>
<span class="-8697432381506519263" onmouseenter="enter('-8697432381506519263');" onmouseout="out('-8697432381506519263');" style=""> 624             //the criteria in this case would be a semi-colon delimeter value list                       </span>
<span class="-2544935018250883467" onmouseenter="enter('-2544935018250883467');" onmouseout="out('-2544935018250883467');" style=""><abbr title=" 625             productOptionValueFilterValues.addAll(Arrays.asList(StringUtils.split(consolidatedCriteria.getFilterValues().get(0), CONSOLIDATED_PRODUCT_OPTIONS_DELIMETER)));"> 625             productOptionValueFilterValues.addAll(Arrays.asList(StringUtils.split(consolidatedCriteria.geðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 626         }                                                                                                </span>
<span  style=""> 627                                                                                                          </span>
<span class="-3296023389552605288" onmouseenter="enter('-3296023389552605288');" onmouseout="out('-3296023389552605288');" style=""> 628         if (productOptionValueFilterIDs.size() &gt; 0) {                                                    </span>
<span class="-3028331070500986006" onmouseenter="enter('-3028331070500986006');" onmouseout="out('-3028331070500986006');" style=""> 629             FilterMapping filterMapping = new FilterMapping()                                            </span>
<span class="3198376136531373476" onmouseenter="enter('3198376136531373476');" onmouseout="out('3198376136531373476');" style=""><abbr title=" 630                 .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?&quot;&quot;:skuPropertyPrefix + &quot;.productOptionValueXrefs.productOptionValue.id&quot;))"> 630                 .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?ðŸ”µ</abbr></span>
<span class="-3630476675353547213" onmouseenter="enter('-3630476675353547213');" onmouseout="out('-3630476675353547213');" style=""> 631                 .withDirectFilterValues(productOptionValueFilterIDs)                                     </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 632                 .withRestriction(new Restriction()                                                       </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 633                     .withPredicateProvider(new PredicateProvider() {                                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 634                         @Override                                                                        </span>
<span class="-33431144742852463" onmouseenter="enter('-33431144742852463');" onmouseout="out('-33431144742852463');" style=""><abbr title=" 635                         public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,"> 635                         public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPaðŸ”µ</abbr></span>
<span class="8221798817053541417" onmouseenter="enter('8221798817053541417');" onmouseout="out('8221798817053541417');" style=""> 636                                                         From root, String ceilingEntity,                 </span>
<span class="-6963673837518342908" onmouseenter="enter('-6963673837518342908');" onmouseout="out('-6963673837518342908');" style=""><abbr title=" 637                                                         String fullPropertyName, Path explicitPath, List directValues) {"> 637                                                         String fullPropertyName, Path explicitPath, List ðŸ”µ</abbr></span>
<span class="-6719486958351285112" onmouseenter="enter('-6719486958351285112');" onmouseout="out('-6719486958351285112');" style=""> 638                             return explicitPath.as(Long.class).in(directValues);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 639                         }                                                                                </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 640                     })                                                                                   </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 641                 );                                                                                       </span>
<span class="-2605411155138525883" onmouseenter="enter('-2605411155138525883');" onmouseout="out('-2605411155138525883');" style=""> 642             filterMappings.add(filterMapping);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 643         }                                                                                                </span>
<span class="36743717647982951" onmouseenter="enter('36743717647982951');" onmouseout="out('36743717647982951');" style=""> 644         if (productOptionValueFilterValues.size() &gt; 0) {                                                 </span>
<span class="-3028331070500986006" onmouseenter="enter('-3028331070500986006');" onmouseout="out('-3028331070500986006');" style=""> 645             FilterMapping filterMapping = new FilterMapping()                                            </span>
<span class="8503258665314341487" onmouseenter="enter('8503258665314341487');" onmouseout="out('8503258665314341487');" style=""><abbr title=" 646                 .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?&quot;&quot;:skuPropertyPrefix + &quot;.productOptionValueXrefs.productOptionValue.attributeValue&quot;))"> 646                 .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?ðŸ”µ</abbr></span>
<span class="-7312773306171765245" onmouseenter="enter('-7312773306171765245');" onmouseout="out('-7312773306171765245');" style=""> 647                 .withDirectFilterValues(productOptionValueFilterValues)                                  </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 648                 .withRestriction(new Restriction()                                                       </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 649                     .withPredicateProvider(new PredicateProvider() {                                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 650                         @Override                                                                        </span>
<span class="-33431144742852463" onmouseenter="enter('-33431144742852463');" onmouseout="out('-33431144742852463');" style=""><abbr title=" 651                         public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,"> 651                         public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPaðŸ”µ</abbr></span>
<span class="8221798817053541417" onmouseenter="enter('8221798817053541417');" onmouseout="out('8221798817053541417');" style=""> 652                                                         From root, String ceilingEntity,                 </span>
<span class="-6963673837518342908" onmouseenter="enter('-6963673837518342908');" onmouseout="out('-6963673837518342908');" style=""><abbr title=" 653                                                         String fullPropertyName, Path explicitPath, List directValues) {"> 653                                                         String fullPropertyName, Path explicitPath, List ðŸ”µ</abbr></span>
<span class="-2981715763030013918" onmouseenter="enter('-2981715763030013918');" onmouseout="out('-2981715763030013918');" style=""> 654                             return explicitPath.as(String.class).in(directValues);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 655                         }                                                                                </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 656                     })                                                                                   </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 657                 );                                                                                       </span>
<span class="-2605411155138525883" onmouseenter="enter('-2605411155138525883');" onmouseout="out('-2605411155138525883');" style=""> 658             filterMappings.add(filterMapping);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 659         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 660     }                                                                                                    </span>
<span  style=""> 661                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 662     /**                                                                                                  </span>
<span class="-8618302828054746698" onmouseenter="enter('-8618302828054746698');" onmouseout="out('-8618302828054746698');" style=""><abbr title=" 663      * &lt;p&gt;Available override point for subclasses if they would like to add additional criteria via the queryCritiera. At the"> 663      * &lt;p&gt;Available override point for subclasses if they would like to add additional criteria via the qðŸ”µ</abbr></span>
<span class="5710282049517599386" onmouseenter="enter('5710282049517599386');" onmouseout="out('5710282049517599386');" style=""><abbr title=" 664      * point that this method has been called, criteria from the frontend has already been applied, thus allowing you to"> 664      * point that this method has been called, criteria from the frontend has already been applied, thus ðŸ”µ</abbr></span>
<span class="-8977449216901818262" onmouseenter="enter('-8977449216901818262');" onmouseout="out('-8977449216901818262');" style=""> 665      * override from there as well.&lt;/p&gt;                                                                  </span>
<span class="6192892703049124137" onmouseenter="enter('6192892703049124137');" onmouseout="out('6192892703049124137');" style=""><abbr title=" 666      * &lt;p&gt;Subclasses that choose to override this should also call this super method so that correct filter criteria"> 666      * &lt;p&gt;Subclasses that choose to override this should also call this super method so that correct filtðŸ”µ</abbr></span>
<span class="4504111184556558489" onmouseenter="enter('4504111184556558489');" onmouseout="out('4504111184556558489');" style=""> 667      * can be applied for product option values&lt;/p&gt;                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 668      *                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 669      */                                                                                                  </span>
<span class="6595350754076949595" onmouseenter="enter('6595350754076949595');" onmouseout="out('6595350754076949595');" style=""><abbr title=" 670     public void applyAdditionalFetchCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PersistencePackage persistencePackage) {"> 670     public void applyAdditionalFetchCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cðŸ”µ</abbr></span>
<span class="-9143014012238338039" onmouseenter="enter('-9143014012238338039');" onmouseout="out('-9143014012238338039');" style=""> 671         //unimplemented                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 672     }                                                                                                    </span>
<span  style=""> 673                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 674     @Override                                                                                            </span>
<span class="-3782560920985534584" onmouseenter="enter('-3782560920985534584');" onmouseout="out('-3782560920985534584');" style=""><abbr title=" 675     public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 675     public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 676         Entity entity = persistencePackage.getEntity();                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 677         try {                                                                                            </span>
<span class="2168419604722842668" onmouseenter="enter('2168419604722842668');" onmouseout="out('2168419604722842668');" style=""> 678             //Fill out the Sku instance from the form                                                    </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""><abbr title=" 679             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();"> 679             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective(ðŸ”µ</abbr></span>
<span class="-2646375190695846844" onmouseenter="enter('-2646375190695846844');" onmouseout="out('-2646375190695846844');" style=""> 680             Sku adminInstance = (Sku) Class.forName(entity.getType()[0]).newInstance();                  </span>
<span class="1729465429044706845" onmouseenter="enter('1729465429044706845');" onmouseout="out('1729465429044706845');" style=""><abbr title=" 681             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getName(), persistencePerspective);"> 681             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getNaðŸ”µ</abbr></span>
<span class="-7453227611519095000" onmouseenter="enter('-7453227611519095000');" onmouseout="out('-7453227611519095000');" style=""> 682             filterOutProductMetadata(adminProperties);                                                   </span>
<span class="2916291722905579881" onmouseenter="enter('2916291722905579881');" onmouseout="out('2916291722905579881');" style=""><abbr title=" 683             adminInstance = (Sku) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);"> 683             adminInstance = (Sku) helper.createPopulatedInstance(adminInstance, entity, adminProperties, ðŸ”µ</abbr></span>
<span  style=""> 684                                                                                                          </span>
<span class="561479470093632813" onmouseenter="enter('561479470093632813');" onmouseout="out('561479470093632813');" style=""> 685             //Verify that there isn&#x27;t already a Sku for this particular product option value combo       </span>
<span class="-7646105610360359073" onmouseenter="enter('-7646105610360359073');" onmouseout="out('-7646105610360359073');" style=""> 686             Entity errorEntity = validateUniqueProductOptionValueCombination(adminInstance.getProduct(), </span>
<span class="7978785476337646518" onmouseenter="enter('7978785476337646518');" onmouseout="out('7978785476337646518');" style=""><abbr title=" 687                                                                              getProductOptionProperties(entity),"> 687                                                                              getProductOptionProperties(eðŸ”µ</abbr></span>
<span class="-5950258146809433717" onmouseenter="enter('-5950258146809433717');" onmouseout="out('-5950258146809433717');" style=""> 688                                                                              null);                      </span>
<span class="315758838568217561" onmouseenter="enter('315758838568217561');" onmouseout="out('315758838568217561');" style=""> 689             if (errorEntity != null) {                                                                   </span>
<span class="-6380597201056661281" onmouseenter="enter('-6380597201056661281');" onmouseout="out('-6380597201056661281');" style=""> 690                 entity.setPropertyValidationErrors(errorEntity.getPropertyValidationErrors());           </span>
<span class="-7572797105708032926" onmouseenter="enter('-7572797105708032926');" onmouseout="out('-7572797105708032926');" style=""> 691                 return entity;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 692             }                                                                                            </span>
<span  style=""> 693                                                                                                          </span>
<span class="-5884073955982735941" onmouseenter="enter('-5884073955982735941');" onmouseout="out('-5884073955982735941');" style=""> 694             //persist the newly-created Sku                                                              </span>
<span class="8006946942803724880" onmouseenter="enter('8006946942803724880');" onmouseout="out('8006946942803724880');" style=""> 695             adminInstance = dynamicEntityDao.persist(adminInstance);                                     </span>
<span  style=""> 696                                                                                                          </span>
<span class="-704220126533799367" onmouseenter="enter('-704220126533799367');" onmouseout="out('-704220126533799367');" style=""> 697             //associate the product option values                                                        </span>
<span class="4472814042081188939" onmouseenter="enter('4472814042081188939');" onmouseout="out('4472814042081188939');" style=""> 698             associateProductOptionValuesToSku(entity, adminInstance, dynamicEntityDao);                  </span>
<span  style=""> 699                                                                                                          </span>
<span class="-5246565985745556188" onmouseenter="enter('-5246565985745556188');" onmouseout="out('-5246565985745556188');" style=""> 700             //After associating the product option values, save off the Sku                              </span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 701             adminInstance = dynamicEntityDao.merge(adminInstance);                                       </span>
<span  style=""> 702                                                                                                          </span>
<span class="-2729035098975137606" onmouseenter="enter('-2729035098975137606');" onmouseout="out('-2729035098975137606');" style=""> 703             //Fill out the DTO and add in the product option value properties to it                      </span>
<span class="8927160133375333586" onmouseenter="enter('8927160133375333586');" onmouseout="out('8927160133375333586');" style=""> 704             Entity result = helper.getRecord(adminProperties, adminInstance, null, null);                </span>
<span class="-1352652314153256295" onmouseenter="enter('-1352652314153256295');" onmouseout="out('-1352652314153256295');" style=""> 705             for (Property property : getProductOptionProperties(entity)) {                               </span>
<span class="-6991744037283748574" onmouseenter="enter('-6991744037283748574');" onmouseout="out('-6991744037283748574');" style=""> 706                 result.addProperty(property);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 707             }                                                                                            </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 708             return result;                                                                               </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 709         } catch (Exception e) {                                                                          </span>
<span class="3314391270131938130" onmouseenter="enter('3314391270131938130');" onmouseout="out('3314391270131938130');" style=""> 710             throw new ServiceException(&quot;Unable to perform fetch for entity: &quot; + Sku.class.getName(), e); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 711         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 712     }                                                                                                    </span>
<span  style=""> 713                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 714     @Override                                                                                            </span>
<span class="-7421665622225711363" onmouseenter="enter('-7421665622225711363');" onmouseout="out('-7421665622225711363');" style=""><abbr title=" 715     public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 715     public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 716         Entity entity = persistencePackage.getEntity();                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 717         try {                                                                                            </span>
<span class="2168419604722842668" onmouseenter="enter('2168419604722842668');" onmouseout="out('2168419604722842668');" style=""> 718             //Fill out the Sku instance from the form                                                    </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""><abbr title=" 719             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();"> 719             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective(ðŸ”µ</abbr></span>
<span class="1729465429044706845" onmouseenter="enter('1729465429044706845');" onmouseout="out('1729465429044706845');" style=""><abbr title=" 720             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getName(), persistencePerspective);"> 720             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getNaðŸ”µ</abbr></span>
<span class="-7453227611519095000" onmouseenter="enter('-7453227611519095000');" onmouseout="out('-7453227611519095000');" style=""> 721             filterOutProductMetadata(adminProperties);                                                   </span>
<span class="-5056229965271915337" onmouseenter="enter('-5056229965271915337');" onmouseout="out('-5056229965271915337');" style=""> 722             Object primaryKey = helper.getPrimaryKey(entity, adminProperties);                           </span>
<span class="5076299244443205355" onmouseenter="enter('5076299244443205355');" onmouseout="out('5076299244443205355');" style=""><abbr title=" 723             Sku adminInstance = (Sku) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]), primaryKey);"> 723             Sku adminInstance = (Sku) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]), primaðŸ”µ</abbr></span>
<span class="2916291722905579881" onmouseenter="enter('2916291722905579881');" onmouseout="out('2916291722905579881');" style=""><abbr title=" 724             adminInstance = (Sku) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);"> 724             adminInstance = (Sku) helper.createPopulatedInstance(adminInstance, entity, adminProperties, ðŸ”µ</abbr></span>
<span  style=""> 725                                                                                                          </span>
<span class="561479470093632813" onmouseenter="enter('561479470093632813');" onmouseout="out('561479470093632813');" style=""> 726             //Verify that there isn&#x27;t already a Sku for this particular product option value combo       </span>
<span class="-7646105610360359073" onmouseenter="enter('-7646105610360359073');" onmouseout="out('-7646105610360359073');" style=""> 727             Entity errorEntity = validateUniqueProductOptionValueCombination(adminInstance.getProduct(), </span>
<span class="7978785476337646518" onmouseenter="enter('7978785476337646518');" onmouseout="out('7978785476337646518');" style=""><abbr title=" 728                                                                             getProductOptionProperties(entity),"> 728                                                                             getProductOptionProperties(enðŸ”µ</abbr></span>
<span class="-2741785419016191367" onmouseenter="enter('-2741785419016191367');" onmouseout="out('-2741785419016191367');" style=""> 729                                                                             adminInstance);              </span>
<span class="315758838568217561" onmouseenter="enter('315758838568217561');" onmouseout="out('315758838568217561');" style=""> 730             if (errorEntity != null) {                                                                   </span>
<span class="-6380597201056661281" onmouseenter="enter('-6380597201056661281');" onmouseout="out('-6380597201056661281');" style=""> 731                 entity.setPropertyValidationErrors(errorEntity.getPropertyValidationErrors());           </span>
<span class="-7572797105708032926" onmouseenter="enter('-7572797105708032926');" onmouseout="out('-7572797105708032926');" style=""> 732                 return entity;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 733             }                                                                                            </span>
<span  style=""> 734                                                                                                          </span>
<span class="-1592345858824912592" onmouseenter="enter('-1592345858824912592');" onmouseout="out('-1592345858824912592');" style=""> 735             // Only modify product options if this ISN&#x27;T an update for inventory properties              </span>
<span class="-4074871831516694131" onmouseenter="enter('-4074871831516694131');" onmouseout="out('-4074871831516694131');" style=""> 736             if (!persistencePackage.containsCriteria(INVENTORY_ONLY_CRITERIA)) {                         </span>
<span class="4472814042081188939" onmouseenter="enter('4472814042081188939');" onmouseout="out('4472814042081188939');" style=""> 737                 associateProductOptionValuesToSku(entity, adminInstance, dynamicEntityDao);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 738             }                                                                                            </span>
<span  style=""> 739                                                                                                          </span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 740             adminInstance = dynamicEntityDao.merge(adminInstance);                                       </span>
<span  style=""> 741                                                                                                          </span>
<span class="6972089533394912781" onmouseenter="enter('6972089533394912781');" onmouseout="out('6972089533394912781');" style=""> 742             extensionManager.getProxy().skuUpdated(adminInstance);                                       </span>
<span  style=""> 743                                                                                                          </span>
<span class="-2729035098975137606" onmouseenter="enter('-2729035098975137606');" onmouseout="out('-2729035098975137606');" style=""> 744             //Fill out the DTO and add in the product option value properties to it                      </span>
<span class="8927160133375333586" onmouseenter="enter('8927160133375333586');" onmouseout="out('8927160133375333586');" style=""> 745             Entity result = helper.getRecord(adminProperties, adminInstance, null, null);                </span>
<span class="-1352652314153256295" onmouseenter="enter('-1352652314153256295');" onmouseout="out('-1352652314153256295');" style=""> 746             for (Property property : getProductOptionProperties(entity)) {                               </span>
<span class="-6991744037283748574" onmouseenter="enter('-6991744037283748574');" onmouseout="out('-6991744037283748574');" style=""> 747                 result.addProperty(property);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 748             }                                                                                            </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 749             return result;                                                                               </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 750         } catch (Exception e) {                                                                          </span>
<span class="-5937019774393085643" onmouseenter="enter('-5937019774393085643');" onmouseout="out('-5937019774393085643');" style=""> 751             throw new ServiceException(&quot;Unable to perform update for entity: &quot; + Sku.class.getName(), e);</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 752         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 753     }                                                                                                    </span>
<span  style=""> 754                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 755     @Override                                                                                            </span>
<span class="9216576132440445278" onmouseenter="enter('9216576132440445278');" onmouseout="out('9216576132440445278');" style=""> 756     protected String[] getPolymorphicClasses(Class&lt;?&gt; clazz, EntityManager em, boolean useCache) {       </span>
<span class="858198974140428987" onmouseenter="enter('858198974140428987');" onmouseout="out('858198974140428987');" style=""> 757         DynamicDaoHelperImpl helper = new DynamicDaoHelperImpl();                                        </span>
<span class="5646922235819357545" onmouseenter="enter('5646922235819357545');" onmouseout="out('5646922235819357545');" style=""> 758         Class&lt;?&gt;[] classes = helper.getAllPolymorphicEntitiesFromCeiling(clazz, true, useCache);         </span>
<span class="5925953156034592661" onmouseenter="enter('5925953156034592661');" onmouseout="out('5925953156034592661');" style=""> 759         String[] result = new String[classes.length];                                                    </span>
<span class="-8402235850457988496" onmouseenter="enter('-8402235850457988496');" onmouseout="out('-8402235850457988496');" style=""> 760         for (int i = 0; i &lt; classes.length; i++) {                                                       </span>
<span class="-4624814724789256168" onmouseenter="enter('-4624814724789256168');" onmouseout="out('-4624814724789256168');" style=""> 761             result[i] = classes[i].getName();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 762         }                                                                                                </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 763         return result;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 764     }                                                                                                    </span>
<span  style=""> 765                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 766     /**                                                                                                  </span>
<span class="-7623474717715637457" onmouseenter="enter('-7623474717715637457');" onmouseout="out('-7623474717715637457');" style=""><abbr title=" 767      * This initially removes all of the product option values that are currently related to the Sku and then re-associates"> 767      * This initially removes all of the product option values that are currently related to the Sku and ðŸ”µ</abbr></span>
<span class="919168598745235587" onmouseenter="enter('919168598745235587');" onmouseout="out('919168598745235587');" style=""> 768      * the {@link ProductOptionValue}s                                                                   </span>
<span class="5381683285013722867" onmouseenter="enter('5381683285013722867');" onmouseout="out('5381683285013722867');" style=""> 769      * @param entity                                                                                     </span>
<span class="-3727775444071594306" onmouseenter="enter('-3727775444071594306');" onmouseout="out('-3727775444071594306');" style=""> 770      * @param adminInstance                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 771      */                                                                                                  </span>
<span class="-5580154930501003130" onmouseenter="enter('-5580154930501003130');" onmouseout="out('-5580154930501003130');" style=""><abbr title=" 772     protected void associateProductOptionValuesToSku(Entity entity, Sku adminInstance, DynamicEntityDao dynamicEntityDao) {"> 772     protected void associateProductOptionValuesToSku(Entity entity, Sku adminInstance, DynamicEntityDao dðŸ”µ</abbr></span>
<span class="-2108418430173822456" onmouseenter="enter('-2108418430173822456');" onmouseout="out('-2108418430173822456');" style=""> 773         //Get the list of product option value ids that were selected from the form                      </span>
<span class="1634824265941381194" onmouseenter="enter('1634824265941381194');" onmouseout="out('1634824265941381194');" style=""> 774         List&lt;Long&gt; productOptionValueIds = new ArrayList&lt;&gt;();                                            </span>
<span class="-1352652314153256295" onmouseenter="enter('-1352652314153256295');" onmouseout="out('-1352652314153256295');" style=""> 775         for (Property property : getProductOptionProperties(entity)) {                                   </span>
<span class="-2394430384756952955" onmouseenter="enter('-2394430384756952955');" onmouseout="out('-2394430384756952955');" style=""> 776             Long propId = Long.parseLong(property.getValue());                                           </span>
<span class="-4973643473801343364" onmouseenter="enter('-4973643473801343364');" onmouseout="out('-4973643473801343364');" style=""> 777             productOptionValueIds.add(propId);                                                           </span>
<span class="882791416935144082" onmouseenter="enter('882791416935144082');" onmouseout="out('882791416935144082');" style=""> 778             property.setIsDirty(true);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 779         }                                                                                                </span>
<span  style=""> 780                                                                                                          </span>
<span class="5599600967733699964" onmouseenter="enter('5599600967733699964');" onmouseout="out('5599600967733699964');" style=""> 781         // Only process associations if product option value changes came in via the form                </span>
<span class="-927227770795358535" onmouseenter="enter('-927227770795358535');" onmouseout="out('-927227770795358535');" style=""> 782         if (CollectionUtils.isNotEmpty(productOptionValueIds)) {                                         </span>
<span class="-836715987756422691" onmouseenter="enter('-836715987756422691');" onmouseout="out('-836715987756422691');" style=""> 783             //remove the current list of product option values from the Sku                              </span>
<span class="3024457150101065569" onmouseenter="enter('3024457150101065569');" onmouseout="out('3024457150101065569');" style=""> 784             if (adminInstance.getProductOptionValueXrefs().size() &gt; 0) {                                 </span>
<span class="-348971082300775720" onmouseenter="enter('-348971082300775720');" onmouseout="out('-348971082300775720');" style=""><abbr title=" 785                 Iterator&lt;SkuProductOptionValueXref&gt; iterator = adminInstance.getProductOptionValueXrefs().iterator();"> 785                 Iterator&lt;SkuProductOptionValueXref&gt; iterator = adminInstance.getProductOptionValueXrefs()ðŸ”µ</abbr></span>
<span class="977968488612897428" onmouseenter="enter('977968488612897428');" onmouseout="out('977968488612897428');" style=""> 786                 while (iterator.hasNext()) {                                                             </span>
<span class="296261963919855061" onmouseenter="enter('296261963919855061');" onmouseout="out('296261963919855061');" style=""> 787                     dynamicEntityDao.remove(iterator.next());                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 788                 }                                                                                        </span>
<span class="-7399149246786578987" onmouseenter="enter('-7399149246786578987');" onmouseout="out('-7399149246786578987');" style=""> 789                 dynamicEntityDao.merge(adminInstance);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 790             }                                                                                            </span>
<span  style=""> 791                                                                                                          </span>
<span class="-4534125068586212273" onmouseenter="enter('-4534125068586212273');" onmouseout="out('-4534125068586212273');" style=""> 792             //Associate the product option values from the form with the Sku                             </span>
<span class="-2263388685273571690" onmouseenter="enter('-2263388685273571690');" onmouseout="out('-2263388685273571690');" style=""> 793             for (Long id : productOptionValueIds) {                                                      </span>
<span class="-1845535430062096532" onmouseenter="enter('-1845535430062096532');" onmouseout="out('-1845535430062096532');" style=""><abbr title=" 794                 //Simply find the changed ProductOptionValues directly - seems to work better with sandboxing code"> 794                 //Simply find the changed ProductOptionValues directly - seems to work better with sandboðŸ”µ</abbr></span>
<span class="-2351207014655688291" onmouseenter="enter('-2351207014655688291');" onmouseout="out('-2351207014655688291');" style=""><abbr title=" 795                 ProductOptionValue pov = (ProductOptionValue) dynamicEntityDao.find(ProductOptionValueImpl.class, id);"> 795                 ProductOptionValue pov = (ProductOptionValue) dynamicEntityDao.find(ProductOptionValueImpðŸ”µ</abbr></span>
<span class="6521746250086557424" onmouseenter="enter('6521746250086557424');" onmouseout="out('6521746250086557424');" style=""> 796                 SkuProductOptionValueXref xref = new SkuProductOptionValueXrefImpl(adminInstance, pov);  </span>
<span class="-8084022359180624494" onmouseenter="enter('-8084022359180624494');" onmouseout="out('-8084022359180624494');" style=""> 797                 xref = dynamicEntityDao.merge(xref);                                                     </span>
<span class="-4176466516175169486" onmouseenter="enter('-4176466516175169486');" onmouseout="out('-4176466516175169486');" style=""> 798                 adminInstance.getProductOptionValueXrefs().add(xref);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 799             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 800         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 801     }                                                                                                    </span>
<span  style=""> 802                                                                                                          </span>
<span class="-7856904959937096406" onmouseenter="enter('-7856904959937096406');" onmouseout="out('-7856904959937096406');" style=""> 803     protected List&lt;Property&gt; getProductOptionProperties(Entity entity) {                                 </span>
<span class="-8583115342580003925" onmouseenter="enter('-8583115342580003925');" onmouseout="out('-8583115342580003925');" style=""> 804         List&lt;Property&gt; productOptionProperties = new ArrayList&lt;&gt;();                                      </span>
<span class="-5346955267205588229" onmouseenter="enter('-5346955267205588229');" onmouseout="out('-5346955267205588229');" style=""> 805         for (Property property : entity.getProperties()) {                                               </span>
<span class="-4364715296212150710" onmouseenter="enter('-4364715296212150710');" onmouseout="out('-4364715296212150710');" style=""> 806             if (property.getName().startsWith(PRODUCT_OPTION_FIELD_PREFIX)) {                            </span>
<span class="4660153000567545168" onmouseenter="enter('4660153000567545168');" onmouseout="out('4660153000567545168');" style=""> 807                 productOptionProperties.add(property);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 808             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 809         }                                                                                                </span>
<span class="-7955791568854160092" onmouseenter="enter('-7955791568854160092');" onmouseout="out('-7955791568854160092');" style=""> 810         return productOptionProperties;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 811     }                                                                                                    </span>
<span  style=""> 812                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 813     /**                                                                                                  </span>
<span class="1365192302683773708" onmouseenter="enter('1365192302683773708');" onmouseout="out('1365192302683773708');" style=""><abbr title=" 814      * Ensures that the given list of {@link ProductOptionValue} IDs is unique for the given {@link Product}."> 814      * Ensures that the given list of {@link ProductOptionValue} IDs is unique for the given {@link ProduðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 815      *                                                                                                   </span>
<span class="181270108197628031" onmouseenter="enter('181270108197628031');" onmouseout="out('181270108197628031');" style=""><abbr title=" 816      * If sku browsing is enabled, then it is assumed that a single combination of {@link ProductOptionValue} IDs"> 816      * If sku browsing is enabled, then it is assumed that a single combination of {@link ProductOptionVaðŸ”µ</abbr></span>
<span class="-9042834622684422857" onmouseenter="enter('-9042834622684422857');" onmouseout="out('-9042834622684422857');" style=""><abbr title=" 817      * is not unique and more than one {@link Sku} could have the exact same combination of {@link ProductOptionValue} IDs."> 817      * is not unique and more than one {@link Sku} could have the exact same combination of {@link ProducðŸ”µ</abbr></span>
<span class="8880319067663877918" onmouseenter="enter('8880319067663877918');" onmouseout="out('8880319067663877918');" style=""> 818      * In this case, the following validation is skipped.                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 819      *                                                                                                   </span>
<span class="-1391920893822957351" onmouseenter="enter('-1391920893822957351');" onmouseout="out('-1391920893822957351');" style=""> 820      * @param product                                                                                    </span>
<span class="-5594036901015815590" onmouseenter="enter('-5594036901015815590');" onmouseout="out('-5594036901015815590');" style=""> 821      * @param productOptionProperties                                                                    </span>
<span class="-6460801320187933305" onmouseenter="enter('-6460801320187933305');" onmouseout="out('-6460801320187933305');" style=""><abbr title=" 822      * @param currentSku - for update operations, this is the current Sku that is being updated; should be excluded from"> 822      * @param currentSku - for update operations, this is the current Sku that is being updated; should bðŸ”µ</abbr></span>
<span class="-9039397817177530475" onmouseenter="enter('-9039397817177530475');" onmouseout="out('-9039397817177530475');" style=""> 823      * attempting validation                                                                             </span>
<span class="3147013888049433291" onmouseenter="enter('3147013888049433291');" onmouseout="out('3147013888049433291');" style=""> 824      * @return &lt;b&gt;null&lt;/b&gt; if successfully validation, the error entity otherwise                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 825      */                                                                                                  </span>
<span class="4098410267680721468" onmouseenter="enter('4098410267680721468');" onmouseout="out('4098410267680721468');" style=""><abbr title=" 826     protected Entity validateUniqueProductOptionValueCombination(Product product, List&lt;Property&gt; productOptionProperties, Sku currentSku) {"> 826     protected Entity validateUniqueProductOptionValueCombination(Product product, List&lt;Property&gt; productOðŸ”µ</abbr></span>
<span class="-2015027760676864422" onmouseenter="enter('-2015027760676864422');" onmouseout="out('-2015027760676864422');" style=""> 827         // do not attempt POV validation if no PO properties were passed in                              </span>
<span class="3871558701454434845" onmouseenter="enter('3871558701454434845');" onmouseout="out('3871558701454434845');" style=""> 828         if (CollectionUtils.isNotEmpty(productOptionProperties)) {                                       </span>
<span class="1634824265941381194" onmouseenter="enter('1634824265941381194');" onmouseout="out('1634824265941381194');" style=""> 829             List&lt;Long&gt; productOptionValueIds = new ArrayList&lt;&gt;();                                        </span>
<span class="-3576685812737207515" onmouseenter="enter('-3576685812737207515');" onmouseout="out('-3576685812737207515');" style=""> 830             for (Property property : productOptionProperties) {                                          </span>
<span class="-2118064041595259984" onmouseenter="enter('-2118064041595259984');" onmouseout="out('-2118064041595259984');" style=""> 831                 productOptionValueIds.add(Long.parseLong(property.getValue()));                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 832             }                                                                                            </span>
<span class="-2493564654197817042" onmouseenter="enter('-2493564654197817042');" onmouseout="out('-2493564654197817042');" style=""> 833             boolean validated = true;                                                                    </span>
<span class="7949927824524618864" onmouseenter="enter('7949927824524618864');" onmouseout="out('7949927824524618864');" style=""> 834             for (Sku sku : product.getAdditionalSkus()) {                                                </span>
<span class="-3465897321258144779" onmouseenter="enter('-3465897321258144779');" onmouseout="out('-3465897321258144779');" style=""> 835                 if ((currentSku == null) || (!sku.getId().equals(currentSku.getId()))) {                 </span>
<span class="-3952558990885951835" onmouseenter="enter('-3952558990885951835');" onmouseout="out('-3952558990885951835');" style=""> 836                     List&lt;Long&gt; testList = new ArrayList&lt;&gt;();                                             </span>
<span class="-7407157514043427301" onmouseenter="enter('-7407157514043427301');" onmouseout="out('-7407157514043427301');" style=""> 837                     for (ProductOptionValue optionValue : sku.getProductOptionValues()) {                </span>
<span class="261748784534089861" onmouseenter="enter('261748784534089861');" onmouseout="out('261748784534089861');" style=""> 838                         testList.add(optionValue.getId());                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 839                     }                                                                                    </span>
<span class="-6586262598457810768" onmouseenter="enter('-6586262598457810768');" onmouseout="out('-6586262598457810768');" style=""><abbr title=" 840                     if ((CollectionUtils.isNotEmpty(testList) &amp;&amp; productOptionValueIds.containsAll(testList)) &amp;&amp; (productOptionValueIds.size() == testList.size())) {"> 840                     if ((CollectionUtils.isNotEmpty(testList) &amp;&amp; productOptionValueIds.containsAll(testLiðŸ”µ</abbr></span>
<span class="6265709580977530731" onmouseenter="enter('6265709580977530731');" onmouseout="out('6265709580977530731');" style=""> 841                         validated = false;                                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 842                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 843                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 844                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 845             }                                                                                            </span>
<span class="5370947014016399578" onmouseenter="enter('5370947014016399578');" onmouseout="out('5370947014016399578');" style=""> 846             if (!validated) {                                                                            </span>
<span class="605992171615497910" onmouseenter="enter('605992171615497910');" onmouseout="out('605992171615497910');" style=""> 847                 Entity errorEntity = new Entity();                                                       </span>
<span class="4071390277457465045" onmouseenter="enter('4071390277457465045');" onmouseout="out('4071390277457465045');" style=""> 848                 for (Property productOptionProperty : productOptionProperties) {                         </span>
<span class="-3018953048999428832" onmouseenter="enter('-3018953048999428832');" onmouseout="out('-3018953048999428832');" style=""> 849                     errorEntity.addValidationError(productOptionProperty.getName(), &quot;uniqueSkuError&quot;);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 850                 }                                                                                        </span>
<span class="-5923031647519224540" onmouseenter="enter('-5923031647519224540');" onmouseout="out('-5923031647519224540');" style=""> 851                 return errorEntity;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 852             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 853         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 854         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 855     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 856 }                                                                                                        </span>




























</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-1249558187989023334" onmouseenter="enter('-1249558187989023334');" onmouseout="out('-1249558187989023334');" style="">   3   * BroadleafCommerce Admin Module                                                                                 </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span class="3565305863144860564" onmouseenter="enter('3565305863144860564');" onmouseout="out('3565305863144860564');" style="">  19  package org.broadleafcommerce.admin.server.service.handler;                                                       </span>
<span  style="">  20                                                                                                                    </span>
<span class="-5484142805323860658" onmouseenter="enter('-5484142805323860658');" onmouseout="out('-5484142805323860658');" style="">  21  import static com.google.common.base.CharMatcher.DIGIT;                                                           </span>
<span  style="">  22                                                                                                                    </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  23  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="2953846583056246827" onmouseenter="enter('2953846583056246827');" onmouseout="out('2953846583056246827');" style="">  24  import org.apache.commons.collections.Transformer;                                                                </span>
<span class="-4661043417888464228" onmouseenter="enter('-4661043417888464228');" onmouseout="out('-4661043417888464228');" style="">  25  import org.apache.commons.lang.BooleanUtils;                                                                      </span>
<span class="2359514128542055982" onmouseenter="enter('2359514128542055982');" onmouseout="out('2359514128542055982');" style="">  26  import org.apache.commons.lang3.ArrayUtils;                                                                       </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  27  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="-6922428965258674124" onmouseenter="enter('-6922428965258674124');" onmouseout="out('-6922428965258674124');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  28 +import org.apache.commons.lang3.math.NumberUtils;                                                                 </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  29  import org.apache.commons.logging.Log;                                                                            </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  30  import org.apache.commons.logging.LogFactory;                                                                     </span>
<span class="5500044680393520896" onmouseenter="enter('5500044680393520896');" onmouseout="out('5500044680393520896');" style="">  31  import org.broadleafcommerce.admin.server.service.SkuMetadataCacheService;                                        </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  32  import org.broadleafcommerce.common.exception.ServiceException;                                                   </span>
<span class="-2413957740330241600" onmouseenter="enter('-2413957740330241600');" onmouseout="out('-2413957740330241600');" style="">  33  import org.broadleafcommerce.common.presentation.client.LookupType;                                               </span>
<span class="-212317658512913375" onmouseenter="enter('-212317658512913375');" onmouseout="out('-212317658512913375');" style="">  34  import org.broadleafcommerce.common.presentation.client.OperationType;                                            </span>
<span class="7296089998360266547" onmouseenter="enter('7296089998360266547');" onmouseout="out('7296089998360266547');" style="">  35  import org.broadleafcommerce.common.presentation.client.PersistencePerspectiveItemType;                           </span>
<span class="1362364260528215152" onmouseenter="enter('1362364260528215152');" onmouseout="out('1362364260528215152');" style="">  36  import org.broadleafcommerce.common.presentation.client.SupportedFieldType;                                       </span>
<span class="-7583443881845767348" onmouseenter="enter('-7583443881845767348');" onmouseout="out('-7583443881845767348');" style="">  37  import org.broadleafcommerce.common.presentation.client.VisibilityEnum;                                           </span>
<span class="-2818686525334833130" onmouseenter="enter('-2818686525334833130');" onmouseout="out('-2818686525334833130');" style="">  38  import org.broadleafcommerce.common.sandbox.SandBoxHelper;                                                        </span>
<span class="-3909806959928975034" onmouseenter="enter('-3909806959928975034');" onmouseout="out('-3909806959928975034');" style="">  39  import org.broadleafcommerce.common.util.BLCCollectionUtils;                                                      </span>
<span class="-3347161074136237116" onmouseenter="enter('-3347161074136237116');" onmouseout="out('-3347161074136237116');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  40 +import org.broadleafcommerce.common.util.StringUtil;                                                              </span>
<span class="-8028747938757529269" onmouseenter="enter('-8028747938757529269');" onmouseout="out('-8028747938757529269');" style="">  41  import org.broadleafcommerce.common.util.TypedTransformer;                                                        </span>
<span class="2901117953480421393" onmouseenter="enter('2901117953480421393');" onmouseout="out('2901117953480421393');" style="">  42  import org.broadleafcommerce.common.util.dao.DynamicDaoHelperImpl;                                                </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  43  import org.broadleafcommerce.core.catalog.domain.Product;                                                         </span>
<span class="8587718080948629089" onmouseenter="enter('8587718080948629089');" onmouseout="out('8587718080948629089');" style="">  44  import org.broadleafcommerce.core.catalog.domain.ProductBundle;                                                   </span>
<span class="-85811185251521902" onmouseenter="enter('-85811185251521902');" onmouseout="out('-85811185251521902');" style="">  45  import org.broadleafcommerce.core.catalog.domain.ProductImpl;                                                     </span>
<span class="6224071758335975205" onmouseenter="enter('6224071758335975205');" onmouseout="out('6224071758335975205');" style="">  46  import org.broadleafcommerce.core.catalog.domain.ProductOption;                                                   </span>
<span class="-6385470104782105538" onmouseenter="enter('-6385470104782105538');" onmouseout="out('-6385470104782105538');" style="">  47  import org.broadleafcommerce.core.catalog.domain.ProductOptionImpl;                                               </span>
<span class="-7937345987210941259" onmouseenter="enter('-7937345987210941259');" onmouseout="out('-7937345987210941259');" style="">  48  import org.broadleafcommerce.core.catalog.domain.ProductOptionValue;                                              </span>
<span class="7369709806901157478" onmouseenter="enter('7369709806901157478');" onmouseout="out('7369709806901157478');" style="">  49  import org.broadleafcommerce.core.catalog.domain.ProductOptionValueImpl;                                          </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  50  import org.broadleafcommerce.core.catalog.domain.Sku;                                                             </span>
<span class="1181568146405964825" onmouseenter="enter('1181568146405964825');" onmouseout="out('1181568146405964825');" style="">  51  import org.broadleafcommerce.core.catalog.domain.SkuImpl;                                                         </span>
<span class="688919036808372243" onmouseenter="enter('688919036808372243');" onmouseout="out('688919036808372243');" style="">  52  import org.broadleafcommerce.core.catalog.domain.SkuProductOptionValueXref;                                       </span>
<span class="-3196712195758579658" onmouseenter="enter('-3196712195758579658');" onmouseout="out('-3196712195758579658');" style="">  53  import org.broadleafcommerce.core.catalog.domain.SkuProductOptionValueXrefImpl;                                   </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  54  import org.broadleafcommerce.core.catalog.service.CatalogService;                                                 </span>
<span class="4427537537958608766" onmouseenter="enter('4427537537958608766');" onmouseout="out('4427537537958608766');" style="">  55  import org.broadleafcommerce.openadmin.dto.BasicFieldMetadata;                                                    </span>
<span class="-1607559599739253077" onmouseenter="enter('-1607559599739253077');" onmouseout="out('-1607559599739253077');" style="">  56  import org.broadleafcommerce.openadmin.dto.ClassMetadata;                                                         </span>
<span class="-8970007776478821592" onmouseenter="enter('-8970007776478821592');" onmouseout="out('-8970007776478821592');" style="">  57  import org.broadleafcommerce.openadmin.dto.CriteriaTransferObject;                                                </span>
<span class="-4742435063138209714" onmouseenter="enter('-4742435063138209714');" onmouseout="out('-4742435063138209714');" style="">  58  import org.broadleafcommerce.openadmin.dto.DynamicResultSet;                                                      </span>
<span class="-5093421835888664541" onmouseenter="enter('-5093421835888664541');" onmouseout="out('-5093421835888664541');" style="">  59  import org.broadleafcommerce.openadmin.dto.Entity;                                                                </span>
<span class="-8829499667991596741" onmouseenter="enter('-8829499667991596741');" onmouseout="out('-8829499667991596741');" style="">  60  import org.broadleafcommerce.openadmin.dto.FieldMetadata;                                                         </span>
<span class="6369021917986026789" onmouseenter="enter('6369021917986026789');" onmouseout="out('6369021917986026789');" style="">  61  import org.broadleafcommerce.openadmin.dto.FilterAndSortCriteria;                                                 </span>
<span class="7333603239996951733" onmouseenter="enter('7333603239996951733');" onmouseout="out('7333603239996951733');" style="">  62  import org.broadleafcommerce.openadmin.dto.MergedPropertyType;                                                    </span>
<span class="5387066876064049952" onmouseenter="enter('5387066876064049952');" onmouseout="out('5387066876064049952');" style="">  63  import org.broadleafcommerce.openadmin.dto.PersistencePackage;                                                    </span>
<span class="8079401142601162613" onmouseenter="enter('8079401142601162613');" onmouseout="out('8079401142601162613');" style="">  64  import org.broadleafcommerce.openadmin.dto.PersistencePerspective;                                                </span>
<span class="1983554291461039357" onmouseenter="enter('1983554291461039357');" onmouseout="out('1983554291461039357');" style="">  65  import org.broadleafcommerce.openadmin.dto.Property;                                                              </span>
<span class="1696571253156436279" onmouseenter="enter('1696571253156436279');" onmouseout="out('1696571253156436279');" style="">  66  import org.broadleafcommerce.openadmin.dto.SectionCrumb;                                                          </span>
<span class="-8828889589519173652" onmouseenter="enter('-8828889589519173652');" onmouseout="out('-8828889589519173652');" style="">  67  import org.broadleafcommerce.openadmin.server.dao.DynamicEntityDao;                                               </span>
<span class="-9217168395336380631" onmouseenter="enter('-9217168395336380631');" onmouseout="out('-9217168395336380631');" style="">  68  import org.broadleafcommerce.openadmin.server.service.handler.CustomPersistenceHandlerAdapter;                    </span>
<span class="-1454726158681359973" onmouseenter="enter('-1454726158681359973');" onmouseout="out('-1454726158681359973');" style="">  69  import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceManager;                             </span>
<span class="97669409268306845" onmouseenter="enter('97669409268306845');" onmouseout="out('97669409268306845');" style="">  70  import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceManagerFactory;                      </span>
<span class="-9205099315907051841" onmouseenter="enter('-9205099315907051841');" onmouseout="out('-9205099315907051841');" style="">  71  import org.broadleafcommerce.openadmin.server.service.persistence.module.InspectHelper;                           </span>
<span class="8253709771214222101" onmouseenter="enter('8253709771214222101');" onmouseout="out('8253709771214222101');" style="">  72  import org.broadleafcommerce.openadmin.server.service.persistence.module.PersistenceModule;                       </span>
<span class="5407139061354632707" onmouseenter="enter('5407139061354632707');" onmouseout="out('5407139061354632707');" style="">  73  import org.broadleafcommerce.openadmin.server.service.persistence.module.RecordHelper;                            </span>
<span class="-4125327013079009203" onmouseenter="enter('-4125327013079009203');" onmouseout="out('-4125327013079009203');" style="">  74  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.CriteriaTranslator;             </span>
<span class="7637154476457570035" onmouseenter="enter('7637154476457570035');" onmouseout="out('7637154476457570035');" style="">  75  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPath;                      </span>
<span class="1663650800150084878" onmouseenter="enter('1663650800150084878');" onmouseout="out('1663650800150084878');" style="">  76  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPathBuilder;               </span>
<span class="7520439988643323618" onmouseenter="enter('7520439988643323618');" onmouseout="out('7520439988643323618');" style="">  77  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FilterMapping;                  </span>
<span class="-8754722050104399052" onmouseenter="enter('-8754722050104399052');" onmouseout="out('-8754722050104399052');" style="">  78  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.Restriction;                    </span>
<span class="2225343043491731861" onmouseenter="enter('2225343043491731861');" onmouseout="out('2225343043491731861');" style="">  79  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.predicate.PredicateProvider;    </span>
<span class="-582519941885656893" onmouseenter="enter('-582519941885656893');" onmouseout="out('-582519941885656893');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  80 -import org.hibernate.ejb.HibernateEntityManager;                                                                  </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  81  import org.springframework.beans.factory.annotation.Value;                                                        </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  82  import org.springframework.stereotype.Component;                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  83 +                                                                                                                  </span>
<span class="5998602906817463685" onmouseenter="enter('5998602906817463685');" onmouseout="out('5998602906817463685');" style="">  84  import java.io.Serializable;                                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  85  import java.util.ArrayList;                                                                                       </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  86  import java.util.Arrays;                                                                                          </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  87  import java.util.Collection;                                                                                      </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  88  import java.util.Collections;                                                                                     </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  89  import java.util.HashMap;                                                                                         </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  90  import java.util.Iterator;                                                                                        </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  91  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  92  import java.util.Map;                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  93 +                                                                                                                  </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  94  import javax.annotation.Resource;                                                                                 </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  95  import javax.persistence.EntityManager;                                                                           </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  96  import javax.persistence.PersistenceContext;                                                                      </span>
<span class="6539032290250175619" onmouseenter="enter('6539032290250175619');" onmouseout="out('6539032290250175619');" style="">  97  import javax.persistence.TypedQuery;                                                                              </span>
<span class="8485852916582699615" onmouseenter="enter('8485852916582699615');" onmouseout="out('8485852916582699615');" style="">  98  import javax.persistence.criteria.CriteriaBuilder;                                                                </span>
<span class="2535099540501772744" onmouseenter="enter('2535099540501772744');" onmouseout="out('2535099540501772744');" style="">  99  import javax.persistence.criteria.From;                                                                           </span>
<span class="5773424155764142692" onmouseenter="enter('5773424155764142692');" onmouseout="out('5773424155764142692');" style=""> 100  import javax.persistence.criteria.Path;                                                                           </span>
<span class="7244103982108254428" onmouseenter="enter('7244103982108254428');" onmouseout="out('7244103982108254428');" style=""> 101  import javax.persistence.criteria.Predicate;                                                                      </span>
<span  style=""> 102                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 103  /**                                                                                                               </span>
<span class="-2581105714976122669" onmouseenter="enter('-2581105714976122669');" onmouseout="out('-2581105714976122669');" style=""> 104   * @author Phillip Verheyden                                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 105   *                                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 106   */                                                                                                               </span>
<span class="-4061322517816489282" onmouseenter="enter('-4061322517816489282');" onmouseout="out('-4061322517816489282');" style=""> 107  @Component(&quot;blSkuCustomPersistenceHandler&quot;)                                                                       </span>
<span class="-1865408177148521742" onmouseenter="enter('-1865408177148521742');" onmouseout="out('-1865408177148521742');" style=""> 108  public class SkuCustomPersistenceHandler extends CustomPersistenceHandlerAdapter {                                </span>
<span  style=""> 109                                                                                                                    </span>
<span class="-8713958385326184455" onmouseenter="enter('-8713958385326184455');" onmouseout="out('-8713958385326184455');" style=""> 110      private static final Log LOG = LogFactory.getLog(SkuCustomPersistenceHandler.class);                          </span>
<span  style=""> 111                                                                                                                    </span>
<span class="363907699147620123" onmouseenter="enter('363907699147620123');" onmouseout="out('363907699147620123');" style=""> 112      public static String PRODUCT_OPTION_FIELD_PREFIX = &quot;productOption&quot;;                                           </span>
<span class="5644485626870470186" onmouseenter="enter('5644485626870470186');" onmouseout="out('5644485626870470186');" style=""> 113      public static String INVENTORY_ONLY_CRITERIA = &quot;onlyInventoryProperties&quot;;                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 114 -                                                                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 115 -                                                                                                                  </span>
<span class="-7778680861452564194" onmouseenter="enter('-7778680861452564194');" onmouseout="out('-7778680861452564194');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 116 -    @Value(&quot;${solr.index.use.sku}&quot;)                                                                               </span>
<span class="4533755734414020763" onmouseenter="enter('4533755734414020763');" onmouseout="out('4533755734414020763');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 117 -    protected boolean useSku;                                                                                     </span>
<span  style=""> 118                                                                                                                    </span>
<span class="-4251425677142148253" onmouseenter="enter('-4251425677142148253');" onmouseout="out('-4251425677142148253');" style=""> 119      @Value(&quot;${use.to.one.lookup.sku.product.option.value:false}&quot;)                                                 </span>
<span class="6110895124324481806" onmouseenter="enter('6110895124324481806');" onmouseout="out('6110895124324481806');" style=""> 120      protected boolean useToOneLookupSkuProductOptionValue = false;                                                </span>
<span  style=""> 121                                                                                                                    </span>
<span class="-7681629157280888116" onmouseenter="enter('-7681629157280888116');" onmouseout="out('-7681629157280888116');" style=""> 122      @Resource(name =&quot;blSkuMetadataCacheService&quot;)                                                                  </span>
<span class="5822417842178589229" onmouseenter="enter('5822417842178589229');" onmouseout="out('5822417842178589229');" style=""> 123      protected SkuMetadataCacheService skuMetadataCacheService;                                                    </span>
<span  style=""> 124                                                                                                                    </span>
<span class="8317365465805033193" onmouseenter="enter('8317365465805033193');" onmouseout="out('8317365465805033193');" style=""> 125      @Resource(name=&quot;blAdornedTargetListPersistenceModule&quot;)                                                        </span>
<span class="878998746675668437" onmouseenter="enter('878998746675668437');" onmouseout="out('878998746675668437');" style=""> 126      protected PersistenceModule adornedPersistenceModule;                                                         </span>
<span  style=""> 127                                                                                                                    </span>
<span class="-7011722868621328349" onmouseenter="enter('-7011722868621328349');" onmouseout="out('-7011722868621328349');" style=""> 128      @Resource(name = &quot;blSkuCustomPersistenceHandlerExtensionManager&quot;)                                             </span>
<span class="-9007673134867108683" onmouseenter="enter('-9007673134867108683');" onmouseout="out('-9007673134867108683');" style=""> 129      protected SkuCustomPersistenceHandlerExtensionManager extensionManager;                                       </span>
<span  style=""> 130                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 131      /**                                                                                                           </span>
<span class="4136366527029974243" onmouseenter="enter('4136366527029974243');" onmouseout="out('4136366527029974243');" style=""><abbr title=" 132       * This represents the field that all of the product option values will be stored in. This would be used in the case"> 132       * This represents the field that all of the product option values will be stored in. This would be used in thðŸ”µ</abbr></span>
<span class="6047944382158863307" onmouseenter="enter('6047944382158863307');" onmouseout="out('6047944382158863307');" style=""><abbr title=" 133       * where there are a bunch of product options and displaying each option as a grid header would have everything"> 133       * where there are a bunch of product options and displaying each option as a grid header would have everythinðŸ”µ</abbr></span>
<span class="-3054662628739130883" onmouseenter="enter('-3054662628739130883');" onmouseout="out('-3054662628739130883');" style=""> 134       * squashed together. Filtering on this field is currently unsupported.                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 135       */                                                                                                           </span>
<span class="5445041667615320295" onmouseenter="enter('5445041667615320295');" onmouseout="out('5445041667615320295');" style=""> 136      public static String CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME = &quot;consolidatedProductOptions&quot;;                  </span>
<span class="-2903820884082764399" onmouseenter="enter('-2903820884082764399');" onmouseout="out('-2903820884082764399');" style=""> 137      public static String CONSOLIDATED_PRODUCT_OPTIONS_DELIMETER = &quot;; &quot;;                                           </span>
<span  style=""> 138                                                                                                                    </span>
<span class="5554818697985539506" onmouseenter="enter('5554818697985539506');" onmouseout="out('5554818697985539506');" style=""> 139      @Resource(name=&quot;blCatalogService&quot;)                                                                            </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style=""> 140      protected CatalogService catalogService;                                                                      </span>
<span  style=""> 141                                                                                                                    </span>
<span class="5710637357667853932" onmouseenter="enter('5710637357667853932');" onmouseout="out('5710637357667853932');" style=""> 142      @PersistenceContext(unitName = &quot;blPU&quot;)                                                                        </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style=""> 143      protected EntityManager em;                                                                                   </span>
<span  style=""> 144                                                                                                                    </span>
<span class="-2696154002193407400" onmouseenter="enter('-2696154002193407400');" onmouseout="out('-2696154002193407400');" style=""> 145      @Resource(name = &quot;blCriteriaTranslator&quot;)                                                                      </span>
<span class="6548648040486234931" onmouseenter="enter('6548648040486234931');" onmouseout="out('6548648040486234931');" style=""> 146      protected CriteriaTranslator criteriaTranslator;                                                              </span>
<span  style=""> 147                                                                                                                    </span>
<span class="-3946461589801993391" onmouseenter="enter('-3946461589801993391');" onmouseout="out('-3946461589801993391');" style=""> 148      @Resource(name = &quot;blSandBoxHelper&quot;)                                                                           </span>
<span class="-7799183597372200632" onmouseenter="enter('-7799183597372200632');" onmouseout="out('-7799183597372200632');" style=""> 149      protected SandBoxHelper sandBoxHelper;                                                                        </span>
<span  style=""> 150                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 151      @Override                                                                                                     </span>
<span class="998850855763553690" onmouseenter="enter('998850855763553690');" onmouseout="out('998850855763553690');" style=""> 152      public Boolean canHandleInspect(PersistencePackage persistencePackage) {                                      </span>
<span class="-5823917578938895674" onmouseenter="enter('-5823917578938895674');" onmouseout="out('-5823917578938895674');" style=""> 153          return canHandle(persistencePackage, persistencePackage.getPersistencePerspective().getOperationTypes()   </span>
<span class="9015299385431722883" onmouseenter="enter('9015299385431722883');" onmouseout="out('9015299385431722883');" style=""> 154                  .getInspectType());                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155      }                                                                                                             </span>
<span  style=""> 156                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 157      @Override                                                                                                     </span>
<span class="-8556163469002491307" onmouseenter="enter('-8556163469002491307');" onmouseout="out('-8556163469002491307');" style=""> 158      public Boolean canHandleFetch(PersistencePackage persistencePackage) {                                        </span>
<span class="10418940480604143" onmouseenter="enter('10418940480604143');" onmouseout="out('10418940480604143');" style=""><abbr title=" 159          OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFetchType();"> 159          OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFetchType(ðŸ”µ</abbr></span>
<span class="8754300242813385255" onmouseenter="enter('8754300242813385255');" onmouseout="out('8754300242813385255');" style=""> 160          return canHandle(persistencePackage, fetchType);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161      }                                                                                                             </span>
<span  style=""> 162                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 163      @Override                                                                                                     </span>
<span class="1712661648493993457" onmouseenter="enter('1712661648493993457');" onmouseout="out('1712661648493993457');" style=""> 164      public Boolean canHandleAdd(PersistencePackage persistencePackage) {                                          </span>
<span class="-5221489961679899774" onmouseenter="enter('-5221489961679899774');" onmouseout="out('-5221489961679899774');" style=""> 165          OperationType addType = persistencePackage.getPersistencePerspective().getOperationTypes().getAddType();  </span>
<span class="1238914713862050599" onmouseenter="enter('1238914713862050599');" onmouseout="out('1238914713862050599');" style=""> 166          return canHandle(persistencePackage, addType);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167      }                                                                                                             </span>
<span  style=""> 168                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 169      @Override                                                                                                     </span>
<span class="5315207923223107799" onmouseenter="enter('5315207923223107799');" onmouseout="out('5315207923223107799');" style=""> 170      public Boolean canHandleUpdate(PersistencePackage persistencePackage) {                                       </span>
<span class="8318706485461606240" onmouseenter="enter('8318706485461606240');" onmouseout="out('8318706485461606240');" style=""><abbr title=" 171          OperationType updateType = persistencePackage.getPersistencePerspective().getOperationTypes().getUpdateType();"> 171          OperationType updateType = persistencePackage.getPersistencePerspective().getOperationTypes().getUpdateTypðŸ”µ</abbr></span>
<span class="7628662592758046218" onmouseenter="enter('7628662592758046218');" onmouseout="out('7628662592758046218');" style=""> 172          return canHandle(persistencePackage, updateType);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173      }                                                                                                             </span>
<span  style=""> 174                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 175      /**                                                                                                           </span>
<span class="6990985093790140011" onmouseenter="enter('6990985093790140011');" onmouseout="out('6990985093790140011');" style=""> 176       * Since this is the default for all Skus, it&#x27;s possible that we are providing custom criteria for this       </span>
<span class="-7639041005907295879" onmouseenter="enter('-7639041005907295879');" onmouseout="out('-7639041005907295879');" style=""> 177       * Sku lookup. In that case, we probably want to delegate to a child class, so only use this particular       </span>
<span class="3567117971388930965" onmouseenter="enter('3567117971388930965');" onmouseout="out('3567117971388930965');" style=""><abbr title=" 178       * persistence handler if there is no custom criteria being used and the ceiling entity is an instance of Sku. The"> 178       * persistence handler if there is no custom criteria being used and the ceiling entity is an instance of Sku.ðŸ”µ</abbr></span>
<span class="-9191698445538453171" onmouseenter="enter('-9191698445538453171');" onmouseout="out('-9191698445538453171');" style=""><abbr title=" 179       * exception to this rule is when we are pulling back Media, since the admin actually uses Sku for the ceiling entity"> 179       * exception to this rule is when we are pulling back Media, since the admin actually uses Sku for the ceilingðŸ”µ</abbr></span>
<span class="1646505885713320498" onmouseenter="enter('1646505885713320498');" onmouseout="out('1646505885713320498');" style=""><abbr title=" 180       * class name. That should be handled by the map structure module though, so only handle things in the Sku custom"> 180       * class name. That should be handled by the map structure module though, so only handle things in the Sku cusðŸ”µ</abbr></span>
<span class="-3435293659936443508" onmouseenter="enter('-3435293659936443508');" onmouseout="out('-3435293659936443508');" style=""> 181       * persistence handler for OperationType.BASIC                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 182       *                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 183       */                                                                                                           </span>
<span class="-401224984339352861" onmouseenter="enter('-401224984339352861');" onmouseout="out('-401224984339352861');" style=""> 184      protected Boolean canHandle(PersistencePackage persistencePackage, OperationType operationType) {             </span>
<span class="2519389108374285224" onmouseenter="enter('2519389108374285224');" onmouseout="out('2519389108374285224');" style=""><abbr title=" 185          String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname();"> 185          String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname()ðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 186          try {                                                                                                     </span>
<span class="3859607212114051755" onmouseenter="enter('3859607212114051755');" onmouseout="out('3859607212114051755');" style=""> 187              Class testClass = Class.forName(ceilingEntityFullyQualifiedClassname);                                </span>
<span class="-6258271003107251148" onmouseenter="enter('-6258271003107251148');" onmouseout="out('-6258271003107251148');" style=""> 188              return Sku.class.isAssignableFrom(testClass) &amp;&amp;                                                       </span>
<span class="6374297613382618653" onmouseenter="enter('6374297613382618653');" onmouseout="out('6374297613382618653');" style=""> 189                      //ArrayUtils.isEmpty(persistencePackage.getCustomCriteria()) &amp;&amp;                               </span>
<span class="-7558498583587542431" onmouseenter="enter('-7558498583587542431');" onmouseout="out('-7558498583587542431');" style=""> 190                      OperationType.BASIC.equals(operationType) &amp;&amp;                                                  </span>
<span class="-2045231318111877972" onmouseenter="enter('-2045231318111877972');" onmouseout="out('-2045231318111877972');" style=""><abbr title=" 191                      (persistencePackage.getPersistencePerspective().getPersistencePerspectiveItems().get(PersistencePerspectiveItemType.ADORNEDTARGETLIST) == null);"> 191                      (persistencePackage.getPersistencePerspective().getPersistencePerspectiveItems().get(PersistenðŸ”µ</abbr></span>
<span class="1054888787890391626" onmouseenter="enter('1054888787890391626');" onmouseout="out('1054888787890391626');" style=""> 192          } catch (ClassNotFoundException e) {                                                                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 193              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195      }                                                                                                             </span>
<span  style=""> 196                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 197      /**                                                                                                           </span>
<span class="330022396980695391" onmouseenter="enter('330022396980695391');" onmouseout="out('330022396980695391');" style=""> 198       * Build out the extra fields for the product options                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 199       */                                                                                                           </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 200      @Override                                                                                                     </span>
<span class="4696212939538128393" onmouseenter="enter('4696212939538128393');" onmouseout="out('4696212939538128393');" style=""><abbr title=" 201      public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, InspectHelper helper) throws ServiceException {"> 201      public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, InspðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 202          try {                                                                                                     </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""> 203              PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();       </span>
<span class="5084133214681633572" onmouseenter="enter('5084133214681633572');" onmouseout="out('5084133214681633572');" style=""> 204              Map&lt;MergedPropertyType, Map&lt;String, FieldMetadata&gt;&gt; allMergedProperties = new HashMap&lt;&gt;();            </span>
<span  style=""> 205                                                                                                                    </span>
<span class="8604411225055729762" onmouseenter="enter('8604411225055729762');" onmouseout="out('8604411225055729762');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 206 -            String productIdStr = null;                                                                           </span>
<span class="6768248097235931624" onmouseenter="enter('6768248097235931624');" onmouseout="out('6768248097235931624');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 207 -            if (persistencePackage.getCustomCriteria() != null &amp;&amp; persistencePackage.getCustomCriteria().length &gt; 0) {"> 207 -            if (persistencePackage.getCustomCriteria() != null &amp;&amp; persistencePackage.getCustomCriteria().length &gt; ðŸ”µ</abbr></span>
<span class="2023823587809168814" onmouseenter="enter('2023823587809168814');" onmouseout="out('2023823587809168814');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 208 -                productIdStr = persistencePackage.getCustomCriteria()[0];                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 209 -            }                                                                                                     </span>
<span class="8224436115361654738" onmouseenter="enter('8224436115361654738');" onmouseout="out('8224436115361654738');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 210 +            String productIdStr = getOwningProductId(persistencePackage.getSectionCrumbs());                      </span>
<span class="8874992536138016800" onmouseenter="enter('8874992536138016800');" onmouseout="out('8874992536138016800');" style=""> 211              String cacheKey = skuMetadataCacheService.buildCacheKey(productIdStr);                                </span>
<span  style=""> 212                                                                                                                    </span>
<span class="4935255304884851121" onmouseenter="enter('4935255304884851121');" onmouseout="out('4935255304884851121');" style=""> 213              Map&lt;String, FieldMetadata&gt; properties = null;                                                         </span>
<span class="-7786224376670761804" onmouseenter="enter('-7786224376670761804');" onmouseout="out('-7786224376670761804');" style=""> 214              boolean useCache = skuMetadataCacheService.useCache();                                                </span>
<span class="6293418362193794054" onmouseenter="enter('6293418362193794054');" onmouseout="out('6293418362193794054');" style=""> 215              if (useCache) {                                                                                       </span>
<span class="-3485340186081071120" onmouseenter="enter('-3485340186081071120');" onmouseout="out('-3485340186081071120');" style=""> 216                  properties = skuMetadataCacheService.getFromCache(cacheKey);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217              }                                                                                                     </span>
<span class="-6785810758643658869" onmouseenter="enter('-6785810758643658869');" onmouseout="out('-6785810758643658869');" style=""> 218              if (properties == null) {                                                                             </span>
<span class="-5990030037269165261" onmouseenter="enter('-5990030037269165261');" onmouseout="out('-5990030037269165261');" style=""> 219                  //Grab the default properties for the Sku                                                         </span>
<span class="8769638039057755276" onmouseenter="enter('8769638039057755276');" onmouseout="out('8769638039057755276');" style=""> 220                  properties = helper.getSimpleMergedProperties(SkuImpl.class.getName(), persistencePerspective);   </span>
<span  style=""> 221                                                                                                                    </span>
<span class="630916579208170345" onmouseenter="enter('630916579208170345');" onmouseout="out('630916579208170345');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 222 -                boolean isFirstCriteriaNAN = persistencePackage.getCustomCriteria() == null || persistencePackage.getCustomCriteria().length == 0;"> 222 -                boolean isFirstCriteriaNAN = persistencePackage.getCustomCriteria() == null || persistencePackage.ðŸ”µ</abbr></span>
<span class="4572678014865473520" onmouseenter="enter('4572678014865473520');" onmouseout="out('4572678014865473520');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +                boolean isFirstCriteriaNAN = productIdStr == null;                                                </span>
<span class="3252503566680993088" onmouseenter="enter('3252503566680993088');" onmouseout="out('3252503566680993088');" style=""> 224                  if (!isFirstCriteriaNAN &amp;&amp; useToOneLookupSkuProductOptionValue) {                                 </span>
<span class="7017874790097466956" onmouseenter="enter('7017874790097466956');" onmouseout="out('7017874790097466956');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 225 -                    isFirstCriteriaNAN = !DIGIT.matchesAllOf(persistencePackage.getCustomCriteria()[0]);          </span>
<span class="-5518906673453958172" onmouseenter="enter('-5518906673453958172');" onmouseout="out('-5518906673453958172');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 226 +                    isFirstCriteriaNAN = !NumberUtils.isParsable(productIdStr);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227                  }                                                                                                 </span>
<span class="-1057552343227044346" onmouseenter="enter('-1057552343227044346');" onmouseout="out('-1057552343227044346');" style=""> 228                  if (isFirstCriteriaNAN) {                                                                         </span>
<span class="-6228644381152217188" onmouseenter="enter('-6228644381152217188');" onmouseout="out('-6228644381152217188');" style=""> 229                      //look up all the ProductOptions and then create new fields for each of them                  </span>
<span class="-5911163386440462712" onmouseenter="enter('-5911163386440462712');" onmouseout="out('-5911163386440462712');" style=""> 230                      List&lt;ProductOption&gt; options = catalogService.readAllProductOptions();                         </span>
<span class="-6720626788939973914" onmouseenter="enter('-6720626788939973914');" onmouseout="out('-6720626788939973914');" style=""> 231                      int order = 0;                                                                                </span>
<span class="-3626227932157062862" onmouseenter="enter('-3626227932157062862');" onmouseout="out('-3626227932157062862');" style=""> 232                      for (ProductOption option : options) {                                                        </span>
<span class="-2894964408662309595" onmouseenter="enter('-2894964408662309595');" onmouseout="out('-2894964408662309595');" style=""> 233                          //add this to the built Sku properties                                                    </span>
<span class="-6525885484902667726" onmouseenter="enter('-6525885484902667726');" onmouseout="out('-6525885484902667726');" style=""> 234                          FieldMetadata md = createIndividualOptionField(option, order);                            </span>
<span class="8898370236947645542" onmouseenter="enter('8898370236947645542');" onmouseout="out('8898370236947645542');" style=""> 235                          if (md != null) {                                                                         </span>
<span class="-8011968882232877757" onmouseenter="enter('-8011968882232877757');" onmouseout="out('-8011968882232877757');" style=""> 236                              properties.put(&quot;productOption&quot; + option.getId(), md);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238                      }                                                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 239                  } else {                                                                                          </span>
<span class="-4312271314847345000" onmouseenter="enter('-4312271314847345000');" onmouseout="out('-4312271314847345000');" style=""> 240                      // If we have a product to filter the list of available product options, then use it          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 241                      try {                                                                                         </span>
<span class="-5024641366798728468" onmouseenter="enter('-5024641366798728468');" onmouseout="out('-5024641366798728468');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 242 -                        Long productId = Long.parseLong(persistencePackage.getCustomCriteria()[0]);               </span>
<span class="2407810897627048437" onmouseenter="enter('2407810897627048437');" onmouseout="out('2407810897627048437');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 243 +                        Long productId = Long.parseLong(productIdStr);                                            </span>
<span class="-4586946436800548085" onmouseenter="enter('-4586946436800548085');" onmouseout="out('-4586946436800548085');" style=""> 244                          Product product = catalogService.findProductById(productId);                              </span>
<span class="-8670197725029820971" onmouseenter="enter('-8670197725029820971');" onmouseout="out('-8670197725029820971');" style=""> 245                          for (ProductOption option : product.getProductOptions()) {                                </span>
<span class="1960418873000138214" onmouseenter="enter('1960418873000138214');" onmouseout="out('1960418873000138214');" style=""> 246                              FieldMetadata md = createIndividualOptionField(option, 0);                            </span>
<span class="8898370236947645542" onmouseenter="enter('8898370236947645542');" onmouseout="out('8898370236947645542');" style=""> 247                              if (md != null) {                                                                     </span>
<span class="-8011968882232877757" onmouseenter="enter('-8011968882232877757');" onmouseout="out('-8011968882232877757');" style=""> 248                                  properties.put(&quot;productOption&quot; + option.getId(), md);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250                          }                                                                                         </span>
<span class="7366941412324817508" onmouseenter="enter('7366941412324817508');" onmouseout="out('7366941412324817508');" style=""> 251                      } catch (NumberFormatException e) {                                                           </span>
<span class="-539761885704419036" onmouseenter="enter('-539761885704419036');" onmouseout="out('-539761885704419036');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 252 -                        // the criteria wasn&#x27;t a product id, just don&#x27;t do anything                               </span>
<span class="-1877352964924956330" onmouseenter="enter('-1877352964924956330');" onmouseout="out('-1877352964924956330');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 253 +                        // there wasn&#x27;t a valid product id, just don&#x27;t do anything                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255                  }                                                                                                 </span>
<span  style=""> 256                                                                                                                    </span>
<span class="-4150172021442827260" onmouseenter="enter('-4150172021442827260');" onmouseout="out('-4150172021442827260');" style=""><abbr title=" 257                  //also build the consolidated field; if using the SkuBasicClientEntityModule then this field will be"> 257                  //also build the consolidated field; if using the SkuBasicClientEntityModule then this field will ðŸ”µ</abbr></span>
<span class="-6012146770615121121" onmouseenter="enter('-6012146770615121121');" onmouseout="out('-6012146770615121121');" style=""> 258                  //permanently hidden                                                                              </span>
<span class="2721680110186827865" onmouseenter="enter('2721680110186827865');" onmouseout="out('2721680110186827865');" style=""><abbr title=" 259                  properties.put(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME, createConsolidatedOptionField(SkuImpl.class));"> 259                  properties.put(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME, createConsolidatedOptionField(SkuImpl.clasðŸ”µ</abbr></span>
<span  style=""> 260                                                                                                                    </span>
<span class="6293418362193794054" onmouseenter="enter('6293418362193794054');" onmouseout="out('6293418362193794054');" style=""> 261                  if (useCache) {                                                                                   </span>
<span class="1689829812062092848" onmouseenter="enter('1689829812062092848');" onmouseout="out('1689829812062092848');" style=""> 262                      skuMetadataCacheService.addToCache(cacheKey, properties);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264              }                                                                                                     </span>
<span  style=""> 265                                                                                                                    </span>
<span class="-5708738706047923554" onmouseenter="enter('-5708738706047923554');" onmouseout="out('-5708738706047923554');" style=""> 266              allMergedProperties.put(MergedPropertyType.PRIMARY, properties);                                      </span>
<span  style=""> 267                                                                                                                    </span>
<span class="3581259712058738264" onmouseenter="enter('3581259712058738264');" onmouseout="out('3581259712058738264');" style=""> 268              //allow the adorned list to contribute properties as well in the case of Sku bundle items             </span>
<span class="4464917262062588204" onmouseenter="enter('4464917262062588204');" onmouseout="out('4464917262062588204');" style=""> 269              adornedPersistenceModule.setPersistenceManager((PersistenceManager)helper);                           </span>
<span class="-5923303721993025135" onmouseenter="enter('-5923303721993025135');" onmouseout="out('-5923303721993025135');" style=""> 270              adornedPersistenceModule.updateMergedProperties(persistencePackage, allMergedProperties);             </span>
<span  style=""> 271                                                                                                                    </span>
<span class="-4755998569329183714" onmouseenter="enter('-4755998569329183714');" onmouseout="out('-4755998569329183714');" style=""> 272              Class&lt;?&gt;[] entityClasses = dynamicEntityDao.getAllPolymorphicEntitiesFromCeiling(SkuImpl.class);      </span>
<span  style=""> 273                                                                                                                    </span>
<span class="-4526006421593645811" onmouseenter="enter('-4526006421593645811');" onmouseout="out('-4526006421593645811');" style=""><abbr title=" 274              for (Map.Entry&lt;MergedPropertyType, Map&lt;String, FieldMetadata&gt;&gt; entry : allMergedProperties.entrySet()) {"> 274              for (Map.Entry&lt;MergedPropertyType, Map&lt;String, FieldMetadata&gt;&gt; entry : allMergedProperties.entrySet())ðŸ”µ</abbr></span>
<span class="5289188932531096512" onmouseenter="enter('5289188932531096512');" onmouseout="out('5289188932531096512');" style=""> 275                  filterOutProductMetadata(entry.getValue());                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276              }                                                                                                     </span>
<span  style=""> 277                                                                                                                    </span>
<span class="-8821755242796986609" onmouseenter="enter('-8821755242796986609');" onmouseout="out('-8821755242796986609');" style=""><abbr title=" 278              ClassMetadata mergedMetadata = helper.buildClassMetadata(entityClasses, persistencePackage, allMergedProperties);"> 278              ClassMetadata mergedMetadata = helper.buildClassMetadata(entityClasses, persistencePackage, allMergedPðŸ”µ</abbr></span>
<span class="5692867683696224654" onmouseenter="enter('5692867683696224654');" onmouseout="out('5692867683696224654');" style=""> 279              DynamicResultSet results = new DynamicResultSet(mergedMetadata, null, null);                          </span>
<span  style=""> 280                                                                                                                    </span>
<span class="225205592763971576" onmouseenter="enter('225205592763971576');" onmouseout="out('225205592763971576');" style=""> 281              return results;                                                                                       </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 282          } catch (Exception e) {                                                                                   </span>
<span class="5888084531497929280" onmouseenter="enter('5888084531497929280');" onmouseout="out('5888084531497929280');" style=""> 283              ServiceException ex = new ServiceException(&quot;Unable to retrieve inspection results for &quot; +             </span>
<span class="6417711820622805051" onmouseenter="enter('6417711820622805051');" onmouseout="out('6417711820622805051');" style=""> 284                      persistencePackage.getCeilingEntityFullyQualifiedClassname(), e);                             </span>
<span class="8479095309709473887" onmouseenter="enter('8479095309709473887');" onmouseout="out('8479095309709473887');" style=""> 285              throw ex;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 287 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 288 +                                                                                                                  </span>
<span class="7792500831321188662" onmouseenter="enter('7792500831321188662');" onmouseout="out('7792500831321188662');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 289 +    protected String getOwningProductId(SectionCrumb[] sectionCrumbs) {                                           </span>
<span class="5995078305082040448" onmouseenter="enter('5995078305082040448');" onmouseout="out('5995078305082040448');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 290 +        if (ArrayUtils.isNotEmpty(sectionCrumbs) &amp;&amp; ProductImpl.class.getCanonicalName()                          </span>
<span class="-5371969237667246856" onmouseenter="enter('-5371969237667246856');" onmouseout="out('-5371969237667246856');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 291 +                .equals(sectionCrumbs[0].getSectionIdentifier())) {                                               </span>
<span class="1460529894614018184" onmouseenter="enter('1460529894614018184');" onmouseout="out('1460529894614018184');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 292 +            return sectionCrumbs[0].getSectionId();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 293 +        }                                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 294 +        return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295      }                                                                                                             </span>
<span  style=""> 296                                                                                                                    </span>
<span class="-6584484392335358741" onmouseenter="enter('-6584484392335358741');" onmouseout="out('-6584484392335358741');" style=""> 297      protected void filterOutProductMetadata(Map&lt;String, FieldMetadata&gt; map) {                                     </span>
<span class="5728154390973133711" onmouseenter="enter('5728154390973133711');" onmouseout="out('5728154390973133711');" style=""><abbr title=" 298          //TODO we shouldn&#x27;t have to filter out these keys here -- we should be able to exclude using @AdminPresentation,"> 298          //TODO we shouldn&#x27;t have to filter out these keys here -- we should be able to exclude using @AdminPresentðŸ”µ</abbr></span>
<span class="-7743625525232386179" onmouseenter="enter('-7743625525232386179');" onmouseout="out('-7743625525232386179');" style=""> 299          //but there&#x27;s a bug preventing this behavior from completely working correctly                            </span>
<span class="-976216753136159975" onmouseenter="enter('-976216753136159975');" onmouseout="out('-976216753136159975');" style=""> 300          List&lt;String&gt; removeKeys = new ArrayList&lt;&gt;();                                                              </span>
<span class="-6833083889726135539" onmouseenter="enter('-6833083889726135539');" onmouseout="out('-6833083889726135539');" style=""> 301          for (Map.Entry&lt;String, FieldMetadata&gt; entry : map.entrySet()) {                                           </span>
<span class="-6943676522367592499" onmouseenter="enter('-6943676522367592499');" onmouseout="out('-6943676522367592499');" style=""> 302              if (entry.getKey().contains(&quot;defaultProduct.&quot;) || entry.getKey().contains(&quot;product.&quot;)) {              </span>
<span class="6428107256625953551" onmouseenter="enter('6428107256625953551');" onmouseout="out('6428107256625953551');" style=""> 303                  removeKeys.add(entry.getKey());                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 305          }                                                                                                         </span>
<span class="7925962848224625040" onmouseenter="enter('7925962848224625040');" onmouseout="out('7925962848224625040');" style=""> 306          for (String removeKey : removeKeys) {                                                                     </span>
<span class="-7725303831891910229" onmouseenter="enter('-7725303831891910229');" onmouseout="out('-7725303831891910229');" style=""> 307              map.remove(removeKey);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309      }                                                                                                             </span>
<span  style=""> 310                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 311      /**                                                                                                           </span>
<span class="8475757947277110833" onmouseenter="enter('8475757947277110833');" onmouseout="out('8475757947277110833');" style=""><abbr title=" 312       * Creates the metadata necessary for displaying all of the product option values in a single field. The display of this"> 312       * Creates the metadata necessary for displaying all of the product option values in a single field. The displðŸ”µ</abbr></span>
<span class="-7291252168371203717" onmouseenter="enter('-7291252168371203717');" onmouseout="out('-7291252168371203717');" style=""><abbr title=" 313       * field is a single string with every product option value appended to it separated by a semicolon. This method should"> 313       * field is a single string with every product option value appended to it separated by a semicolon. This methðŸ”µ</abbr></span>
<span class="1992999426370183590" onmouseenter="enter('1992999426370183590');" onmouseout="out('1992999426370183590');" style=""><abbr title=" 314       * be invoked on an inspect for whatever is utilizing this so that the property will be ready to be populated on fetch."> 314       * be invoked on an inspect for whatever is utilizing this so that the property will be ready to be populated ðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 315       *                                                                                                            </span>
<span class="-6637674095635137344" onmouseenter="enter('-6637674095635137344');" onmouseout="out('-6637674095635137344');" style=""><abbr title=" 316       * The metadata that is returned will also be set to prominent by default so that it will be ready to display on whatever"> 316       * The metadata that is returned will also be set to prominent by default so that it will be ready to display ðŸ”µ</abbr></span>
<span class="-511871035138294277" onmouseenter="enter('-511871035138294277');" onmouseout="out('-511871035138294277');" style=""><abbr title=" 317       * grid is being inspected. If you do not want this behavior you will need to override this functionality in the metadata"> 317       * grid is being inspected. If you do not want this behavior you will need to override this functionality in tðŸ”µ</abbr></span>
<span class="3179613037749712904" onmouseenter="enter('3179613037749712904');" onmouseout="out('3179613037749712904');" style=""> 318       * that is returned.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 319       *                                                                                                            </span>
<span class="7116239974974757712" onmouseenter="enter('7116239974974757712');" onmouseout="out('7116239974974757712');" style=""><abbr title=" 320       * @param inheritedFromType which type this should appear on. This would normally be SkuImpl.class, but if you want to"> 320       * @param inheritedFromType which type this should appear on. This would normally be SkuImpl.class, but if youðŸ”µ</abbr></span>
<span class="167462497314507165" onmouseenter="enter('167462497314507165');" onmouseout="out('167462497314507165');" style=""> 321       * display this field with a different entity then this should be that entity                                 </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 322       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 323       */                                                                                                           </span>
<span class="-1192927872819846099" onmouseenter="enter('-1192927872819846099');" onmouseout="out('-1192927872819846099');" style=""> 324      public FieldMetadata createConsolidatedOptionField(Class&lt;?&gt; inheritedFromType) {                              </span>
<span class="-7895492162900601652" onmouseenter="enter('-7895492162900601652');" onmouseout="out('-7895492162900601652');" style=""> 325          BasicFieldMetadata metadata = new BasicFieldMetadata();                                                   </span>
<span class="1112932430275912677" onmouseenter="enter('1112932430275912677');" onmouseout="out('1112932430275912677');" style=""> 326          metadata.setFieldType(SupportedFieldType.STRING);                                                         </span>
<span class="6091769410078062740" onmouseenter="enter('6091769410078062740');" onmouseout="out('6091769410078062740');" style=""> 327          metadata.setMutable(false);                                                                               </span>
<span class="2561191544941929216" onmouseenter="enter('2561191544941929216');" onmouseout="out('2561191544941929216');" style=""> 328          metadata.setInheritedFromType(inheritedFromType.getName());                                               </span>
<span  style=""> 329                                                                                                                    </span>
<span class="7921709413407422398" onmouseenter="enter('7921709413407422398');" onmouseout="out('7921709413407422398');" style=""><abbr title=" 330          metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCache()));"> 330          metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCache()))ðŸ”µ</abbr></span>
<span class="7303907294085574775" onmouseenter="enter('7303907294085574775');" onmouseout="out('7303907294085574775');" style=""> 331          metadata.setForeignKeyCollection(false);                                                                  </span>
<span class="-1649079592520542152" onmouseenter="enter('-1649079592520542152');" onmouseout="out('-1649079592520542152');" style=""> 332          metadata.setMergedPropertyType(MergedPropertyType.PRIMARY);                                               </span>
<span  style=""> 333                                                                                                                    </span>
<span class="6688700612838924202" onmouseenter="enter('6688700612838924202');" onmouseout="out('6688700612838924202');" style=""> 334          metadata.setName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                                                </span>
<span class="173658654284287974" onmouseenter="enter('173658654284287974');" onmouseout="out('173658654284287974');" style=""> 335          metadata.setFriendlyName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                                        </span>
<span class="5589230730632374582" onmouseenter="enter('5589230730632374582');" onmouseout="out('5589230730632374582');" style=""> 336          metadata.setGroup(&quot;&quot;);                                                                                    </span>
<span class="8683462265874380595" onmouseenter="enter('8683462265874380595');" onmouseout="out('8683462265874380595');" style=""> 337          metadata.setExplicitFieldType(SupportedFieldType.UNKNOWN);                                                </span>
<span class="-6445843447872579066" onmouseenter="enter('-6445843447872579066');" onmouseout="out('-6445843447872579066');" style=""> 338          metadata.setProminent(true);                                                                              </span>
<span class="-4820234772877671615" onmouseenter="enter('-4820234772877671615');" onmouseout="out('-4820234772877671615');" style=""> 339          metadata.setVisibility(VisibilityEnum.FORM_HIDDEN);                                                       </span>
<span class="8945700141771923055" onmouseenter="enter('8945700141771923055');" onmouseout="out('8945700141771923055');" style=""> 340          metadata.setBroadleafEnumeration(&quot;&quot;);                                                                     </span>
<span class="1775531838265915895" onmouseenter="enter('1775531838265915895');" onmouseout="out('1775531838265915895');" style=""> 341          metadata.setReadOnly(true);                                                                               </span>
<span class="-7171521581678886800" onmouseenter="enter('-7171521581678886800');" onmouseout="out('-7171521581678886800');" style=""> 342          metadata.setRequiredOverride(false);                                                                      </span>
<span class="-4496921391259172818" onmouseenter="enter('-4496921391259172818');" onmouseout="out('-4496921391259172818');" style=""> 343          metadata.setGridOrder(Integer.MAX_VALUE);                                                                 </span>
<span  style=""> 344                                                                                                                    </span>
<span class="-6736542809122384852" onmouseenter="enter('-6736542809122384852');" onmouseout="out('-6736542809122384852');" style=""> 345          return metadata;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 346      }                                                                                                             </span>
<span  style=""> 347                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 348      /**                                                                                                           </span>
<span class="-8205275851682999693" onmouseenter="enter('-8205275851682999693');" onmouseout="out('-8205275851682999693');" style=""><abbr title=" 349       * Returns a {@link Property} filled out with a delimited list of the &lt;b&gt;values&lt;/b&gt; that are passed in. This should be"> 349       * Returns a {@link Property} filled out with a delimited list of the &lt;b&gt;values&lt;/b&gt; that are passed in. This sðŸ”µ</abbr></span>
<span class="-4713707283922918694" onmouseenter="enter('-4713707283922918694');" onmouseout="out('-4713707283922918694');" style=""> 350       * invoked on a fetch and the returned property should be added to the fetched {@link Entity} dto.            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 351       *                                                                                                            </span>
<span class="2073888098879145111" onmouseenter="enter('2073888098879145111');" onmouseout="out('2073888098879145111');" style=""> 352       * @param values                                                                                              </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 353       * @return                                                                                                    </span>
<span class="3015934350861870420" onmouseenter="enter('3015934350861870420');" onmouseout="out('3015934350861870420');" style=""> 354       * @see {@link #createConsolidatedOptionField(Class)};                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 355       */                                                                                                           </span>
<span class="-4797739079142470258" onmouseenter="enter('-4797739079142470258');" onmouseout="out('-4797739079142470258');" style=""> 356      public Property getConsolidatedOptionProperty(Collection&lt;ProductOptionValue&gt; values) {                        </span>
<span class="6856864467058713906" onmouseenter="enter('6856864467058713906');" onmouseout="out('6856864467058713906');" style=""> 357          Property optionValueProperty = new Property();                                                            </span>
<span class="6345005840174859359" onmouseenter="enter('6345005840174859359');" onmouseout="out('6345005840174859359');" style=""> 358          optionValueProperty.setName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                                     </span>
<span  style=""> 359                                                                                                                    </span>
<span class="4968742745228384146" onmouseenter="enter('4968742745228384146');" onmouseout="out('4968742745228384146');" style=""> 360          //order the values by the display order of their correspond product option                                </span>
<span class="-6409609658063536117" onmouseenter="enter('-6409609658063536117');" onmouseout="out('-6409609658063536117');" style=""> 361          //        Collections.sort(values, new Comparator&lt;ProductOptionValue&gt;() {                                 </span>
<span class="-8064130612454474190" onmouseenter="enter('-8064130612454474190');" onmouseout="out('-8064130612454474190');" style=""> 362          //                                                                                                        </span>
<span class="5501927314430930673" onmouseenter="enter('5501927314430930673');" onmouseout="out('5501927314430930673');" style=""> 363          //            @Override                                                                                   </span>
<span class="9147587799683858413" onmouseenter="enter('9147587799683858413');" onmouseout="out('9147587799683858413');" style=""> 364          //            public int compare(ProductOptionValue value1, ProductOptionValue value2) {                  </span>
<span class="368329491788158591" onmouseenter="enter('368329491788158591');" onmouseout="out('368329491788158591');" style=""> 365          //                return new CompareToBuilder().append(value1.getProductOption().getDisplayOrder(),       </span>
<span class="8754156396924172260" onmouseenter="enter('8754156396924172260');" onmouseout="out('8754156396924172260');" style=""> 366          //                        value2.getProductOption().getDisplayOrder()).toComparison();                    </span>
<span class="1818990376901269570" onmouseenter="enter('1818990376901269570');" onmouseout="out('1818990376901269570');" style=""> 367          //            }                                                                                           </span>
<span class="-1155227284920485909" onmouseenter="enter('-1155227284920485909');" onmouseout="out('-1155227284920485909');" style=""> 368          //        });                                                                                             </span>
<span  style=""> 369                                                                                                                    </span>
<span class="-2061482055453175047" onmouseenter="enter('-2061482055453175047');" onmouseout="out('-2061482055453175047');" style=""> 370          ArrayList&lt;String&gt; stringValues = new ArrayList&lt;&gt;();                                                       </span>
<span class="-7157508124377790495" onmouseenter="enter('-7157508124377790495');" onmouseout="out('-7157508124377790495');" style=""> 371          CollectionUtils.collect(values, new Transformer() {                                                       </span>
<span  style=""> 372                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 373              @Override                                                                                             </span>
<span class="-2718541205900117239" onmouseenter="enter('-2718541205900117239');" onmouseout="out('-2718541205900117239');" style=""> 374              public Object transform(Object input) {                                                               </span>
<span class="-2749337455813426805" onmouseenter="enter('-2749337455813426805');" onmouseout="out('-2749337455813426805');" style=""> 375                  return ((ProductOptionValue) input).getAttributeValue();                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376              }                                                                                                     </span>
<span class="-236589394719861606" onmouseenter="enter('-236589394719861606');" onmouseout="out('-236589394719861606');" style=""> 377          }, stringValues);                                                                                         </span>
<span  style=""> 378                                                                                                                    </span>
<span class="-3159140932312278736" onmouseenter="enter('-3159140932312278736');" onmouseout="out('-3159140932312278736');" style=""> 379          optionValueProperty.setValue(StringUtils.join(stringValues, CONSOLIDATED_PRODUCT_OPTIONS_DELIMETER));     </span>
<span class="-6819592353936650784" onmouseenter="enter('-6819592353936650784');" onmouseout="out('-6819592353936650784');" style=""> 380          return optionValueProperty;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 381      }                                                                                                             </span>
<span  style=""> 382                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 383      /**                                                                                                           </span>
<span class="4216744498315651983" onmouseenter="enter('4216744498315651983');" onmouseout="out('4216744498315651983');" style=""> 384       * @return a blank {@link Property} corresponding to the CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 385       */                                                                                                           </span>
<span class="7598660974779837355" onmouseenter="enter('7598660974779837355');" onmouseout="out('7598660974779837355');" style=""> 386      public Property getBlankConsolidatedOptionProperty() {                                                        </span>
<span class="6856864467058713906" onmouseenter="enter('6856864467058713906');" onmouseout="out('6856864467058713906');" style=""> 387          Property optionValueProperty = new Property();                                                            </span>
<span class="6345005840174859359" onmouseenter="enter('6345005840174859359');" onmouseout="out('6345005840174859359');" style=""> 388          optionValueProperty.setName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                                     </span>
<span class="-7065335864511569913" onmouseenter="enter('-7065335864511569913');" onmouseout="out('-7065335864511569913');" style=""> 389          optionValueProperty.setValue(&quot;&quot;);                                                                         </span>
<span class="-6819592353936650784" onmouseenter="enter('-6819592353936650784');" onmouseout="out('-6819592353936650784');" style=""> 390          return optionValueProperty;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 391      }                                                                                                             </span>
<span  style=""> 392                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 393      /**                                                                                                           </span>
<span class="6557988157037524501" onmouseenter="enter('6557988157037524501');" onmouseout="out('6557988157037524501');" style=""><abbr title=" 394       * &lt;p&gt;Creates an individual property for the specified product option. This should set up an enum field whose values will"> 394       * &lt;p&gt;Creates an individual property for the specified product option. This should set up an enum field whose ðŸ”µ</abbr></span>
<span class="5038223503928989560" onmouseenter="enter('5038223503928989560');" onmouseout="out('5038223503928989560');" style=""><abbr title=" 395       * be the option values for this option.  This is useful when you would like to display each product option in as its"> 395       * be the option values for this option.  This is useful when you would like to display each product option inðŸ”µ</abbr></span>
<span class="9009411457822617231" onmouseenter="enter('9009411457822617231');" onmouseout="out('9009411457822617231');" style=""> 396       * own field in a grid so that you can further filter by product option values.&lt;/p&gt;                           </span>
<span class="-8656076573134722150" onmouseenter="enter('-8656076573134722150');" onmouseout="out('-8656076573134722150');" style=""> 397       * &lt;p&gt;In order for these fields to be utilized property on the fetch, in the GWT frontend you must use the    </span>
<span class="-3536572176551507765" onmouseenter="enter('-3536572176551507765');" onmouseout="out('-3536572176551507765');" style=""> 398       * for your datasource.&lt;/p&gt;                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 399       *                                                                                                            </span>
<span class="8674570395008402319" onmouseenter="enter('8674570395008402319');" onmouseout="out('8674570395008402319');" style=""> 400       * @param option                                                                                              </span>
<span class="6414796960983960786" onmouseenter="enter('6414796960983960786');" onmouseout="out('6414796960983960786');" style=""> 401       * @param order                                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 402       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 403       */                                                                                                           </span>
<span class="8795563977758647136" onmouseenter="enter('8795563977758647136');" onmouseout="out('8795563977758647136');" style=""> 404      public FieldMetadata createIndividualOptionField(ProductOption option, int order) {                           </span>
<span class="7200486368414049440" onmouseenter="enter('7200486368414049440');" onmouseout="out('7200486368414049440');" style=""> 405          if (useToOneLookupSkuProductOptionValue) {                                                                </span>
<span class="-5634467253732639986" onmouseenter="enter('-5634467253732639986');" onmouseout="out('-5634467253732639986');" style=""> 406              return createToOneIndividualOptionField(option, order);                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 407          } else {                                                                                                  </span>
<span class="7936034563418693343" onmouseenter="enter('7936034563418693343');" onmouseout="out('7936034563418693343');" style=""> 408              return createExplicitEnumerationIndividualOptionField(option, order);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 409          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410      }                                                                                                             </span>
<span  style=""> 411                                                                                                                    </span>
<span class="-8892069303256438111" onmouseenter="enter('-8892069303256438111');" onmouseout="out('-8892069303256438111');" style=""> 412      protected FieldMetadata createExplicitEnumerationIndividualOptionField(ProductOption option, int order) {     </span>
<span class="-7895492162900601652" onmouseenter="enter('-7895492162900601652');" onmouseout="out('-7895492162900601652');" style=""> 413          BasicFieldMetadata metadata = new BasicFieldMetadata();                                                   </span>
<span class="-2416891430670029479" onmouseenter="enter('-2416891430670029479');" onmouseout="out('-2416891430670029479');" style=""> 414          List&lt;ProductOptionValue&gt; allowedValues = option.getAllowedValues();                                       </span>
<span class="9151233583168413632" onmouseenter="enter('9151233583168413632');" onmouseout="out('9151233583168413632');" style=""> 415          if (CollectionUtils.isNotEmpty(allowedValues)) {                                                          </span>
<span class="4285129340737600689" onmouseenter="enter('4285129340737600689');" onmouseout="out('4285129340737600689');" style=""> 416              metadata.setFieldType(SupportedFieldType.EXPLICIT_ENUMERATION);                                       </span>
<span class="-6206284717251400514" onmouseenter="enter('-6206284717251400514');" onmouseout="out('-6206284717251400514');" style=""> 417              metadata.setMutable(true);                                                                            </span>
<span class="8194069883044431071" onmouseenter="enter('8194069883044431071');" onmouseout="out('8194069883044431071');" style=""> 418              metadata.setInheritedFromType(SkuImpl.class.getName());                                               </span>
<span class="7921709413407422398" onmouseenter="enter('7921709413407422398');" onmouseout="out('7921709413407422398');" style=""><abbr title=" 419              metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCache()));"> 419              metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCacheðŸ”µ</abbr></span>
<span class="7303907294085574775" onmouseenter="enter('7303907294085574775');" onmouseout="out('7303907294085574775');" style=""> 420              metadata.setForeignKeyCollection(false);                                                              </span>
<span class="-1649079592520542152" onmouseenter="enter('-1649079592520542152');" onmouseout="out('-1649079592520542152');" style=""> 421              metadata.setMergedPropertyType(MergedPropertyType.PRIMARY);                                           </span>
<span  style=""> 422                                                                                                                    </span>
<span class="-1089414754199454043" onmouseenter="enter('-1089414754199454043');" onmouseout="out('-1089414754199454043');" style=""> 423              //Set up the enumeration based on the product option values                                           </span>
<span class="-4938595371513432920" onmouseenter="enter('-4938595371513432920');" onmouseout="out('-4938595371513432920');" style=""> 424              String[][] optionValues = new String[allowedValues.size()][2];                                        </span>
<span class="6205975934798560127" onmouseenter="enter('6205975934798560127');" onmouseout="out('6205975934798560127');" style=""> 425              for (int i = 0; i &lt; allowedValues.size(); i++) {                                                      </span>
<span class="5655693563027021374" onmouseenter="enter('5655693563027021374');" onmouseout="out('5655693563027021374');" style=""> 426                  ProductOptionValue value = option.getAllowedValues().get(i);                                      </span>
<span class="-6097967761511863324" onmouseenter="enter('-6097967761511863324');" onmouseout="out('-6097967761511863324');" style=""> 427                  optionValues[i][0] = value.getId().toString();                                                    </span>
<span class="-2028520644986671717" onmouseenter="enter('-2028520644986671717');" onmouseout="out('-2028520644986671717');" style=""> 428                  optionValues[i][1] = value.getAttributeValue();                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 429              }                                                                                                     </span>
<span class="8277090772710644263" onmouseenter="enter('8277090772710644263');" onmouseout="out('8277090772710644263');" style=""> 430              metadata.setEnumerationValues(optionValues);                                                          </span>
<span  style=""> 431                                                                                                                    </span>
<span class="1748190162337854256" onmouseenter="enter('1748190162337854256');" onmouseout="out('1748190162337854256');" style=""> 432              metadata.setName(PRODUCT_OPTION_FIELD_PREFIX + option.getId());                                       </span>
<span class="7017269500484793927" onmouseenter="enter('7017269500484793927');" onmouseout="out('7017269500484793927');" style=""> 433              metadata.setFriendlyName(option.getLabel());                                                          </span>
<span class="6085246036283927461" onmouseenter="enter('6085246036283927461');" onmouseout="out('6085246036283927461');" style=""> 434              metadata.setGroup(&quot;productOption_group&quot;);                                                             </span>
<span class="-8050220525630720562" onmouseenter="enter('-8050220525630720562');" onmouseout="out('-8050220525630720562');" style=""> 435              metadata.setGroupOrder(-1);                                                                           </span>
<span class="3406381469360124301" onmouseenter="enter('3406381469360124301');" onmouseout="out('3406381469360124301');" style=""> 436              metadata.setOrder(order);                                                                             </span>
<span class="8683462265874380595" onmouseenter="enter('8683462265874380595');" onmouseout="out('8683462265874380595');" style=""> 437              metadata.setExplicitFieldType(SupportedFieldType.UNKNOWN);                                            </span>
<span class="-6994608424159816416" onmouseenter="enter('-6994608424159816416');" onmouseout="out('-6994608424159816416');" style=""> 438              metadata.setProminent(false);                                                                         </span>
<span class="6274758849936387106" onmouseenter="enter('6274758849936387106');" onmouseout="out('6274758849936387106');" style=""> 439              metadata.setVisibility(VisibilityEnum.FORM_EXPLICITLY_SHOWN);                                         </span>
<span class="8945700141771923055" onmouseenter="enter('8945700141771923055');" onmouseout="out('8945700141771923055');" style=""> 440              metadata.setBroadleafEnumeration(&quot;&quot;);                                                                 </span>
<span class="8076682597610338410" onmouseenter="enter('8076682597610338410');" onmouseout="out('8076682597610338410');" style=""> 441              metadata.setReadOnly(false);                                                                          </span>
<span class="2131936785391707598" onmouseenter="enter('2131936785391707598');" onmouseout="out('2131936785391707598');" style=""> 442              metadata.setRequiredOverride(BooleanUtils.isFalse(option.getRequired()));                             </span>
<span  style=""> 443                                                                                                                    </span>
<span class="-6736542809122384852" onmouseenter="enter('-6736542809122384852');" onmouseout="out('-6736542809122384852');" style=""> 444              return metadata;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 445          }                                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 446          return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 447      }                                                                                                             </span>
<span  style=""> 448                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 449      /**                                                                                                           </span>
<span class="7683644189550699004" onmouseenter="enter('7683644189550699004');" onmouseout="out('7683644189550699004');" style=""><abbr title=" 450       * Using a ToOne lookup performs much better for large product option value lists, speeds up initial page load,"> 450       * Using a ToOne lookup performs much better for large product option value lists, speeds up initial page loadðŸ”µ</abbr></span>
<span class="-6062867542246075622" onmouseenter="enter('-6062867542246075622');" onmouseout="out('-6062867542246075622');" style=""><abbr title=" 451       * and is generally more accurate in relation to option value updates and how they impact available selections and cache."> 451       * and is generally more accurate in relation to option value updates and how they impact available selectionsðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 452       *                                                                                                            </span>
<span class="8674570395008402319" onmouseenter="enter('8674570395008402319');" onmouseout="out('8674570395008402319');" style=""> 453       * @param option                                                                                              </span>
<span class="6414796960983960786" onmouseenter="enter('6414796960983960786');" onmouseout="out('6414796960983960786');" style=""> 454       * @param order                                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 455       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 456       */                                                                                                           </span>
<span class="6879137344207562675" onmouseenter="enter('6879137344207562675');" onmouseout="out('6879137344207562675');" style=""> 457      protected FieldMetadata createToOneIndividualOptionField(ProductOption option, int order) {                   </span>
<span class="-8449939433228375667" onmouseenter="enter('-8449939433228375667');" onmouseout="out('-8449939433228375667');" style=""> 458          PersistenceManager persistenceManager = PersistenceManagerFactory.getPersistenceManager();                </span>
<span class="-4187363957527008750" onmouseenter="enter('-4187363957527008750');" onmouseout="out('-4187363957527008750');" style=""> 459          FilterMapping filterMapping = new FilterMapping().withDirectFilterValues(                                 </span>
<span class="-3894749102720902409" onmouseenter="enter('-3894749102720902409');" onmouseout="out('-3894749102720902409');" style=""><abbr title=" 460                  sandBoxHelper.mergeCloneIds(ProductOptionImpl.class, option.getId())).withRestriction(new Restriction()"> 460                  sandBoxHelper.mergeCloneIds(ProductOptionImpl.class, option.getId())).withRestriction(new RestrictðŸ”µ</abbr></span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 461              .withPredicateProvider(new PredicateProvider() {                                                      </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 462                  @Override                                                                                         </span>
<span class="-5588636227064039300" onmouseenter="enter('-5588636227064039300');" onmouseout="out('-5588636227064039300');" style=""><abbr title=" 463                  public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder, From root,"> 463                  public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder, From rðŸ”µ</abbr></span>
<span class="-2899522305959899483" onmouseenter="enter('-2899522305959899483');" onmouseout="out('-2899522305959899483');" style=""><abbr title=" 464                                                  String ceilingEntity, String fullPropertyName, Path explicitPath, List directValues) {"> 464                                                  String ceilingEntity, String fullPropertyName, Path explicitPath, ðŸ”µ</abbr></span>
<span class="-933702984903214818" onmouseenter="enter('-933702984903214818');" onmouseout="out('-933702984903214818');" style=""> 465                      return root.get(&quot;productOption&quot;).get(&quot;id&quot;).in(directValues);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 466              }                                                                                                     </span>
<span class="-800954676578401248" onmouseenter="enter('-800954676578401248');" onmouseout="out('-800954676578401248');" style=""> 467          }));                                                                                                      </span>
<span class="9067714061330870114" onmouseenter="enter('9067714061330870114');" onmouseout="out('9067714061330870114');" style=""> 468          List&lt;FilterMapping&gt; mappings = new ArrayList&lt;&gt;();                                                         </span>
<span class="345189471467363285" onmouseenter="enter('345189471467363285');" onmouseout="out('345189471467363285');" style=""> 469          mappings.add(filterMapping);                                                                              </span>
<span class="7291356103073076244" onmouseenter="enter('7291356103073076244');" onmouseout="out('7291356103073076244');" style=""><abbr title=" 470          TypedQuery&lt;Serializable&gt; countQuery = criteriaTranslator.translateCountQuery(persistenceManager.getDynamicEntityDao(),"> 470          TypedQuery&lt;Serializable&gt; countQuery = criteriaTranslator.translateCountQuery(persistenceManager.getDynamicðŸ”µ</abbr></span>
<span class="-6376296202628097343" onmouseenter="enter('-6376296202628097343');" onmouseout="out('-6376296202628097343');" style=""> 471                  ProductOptionValueImpl.class.getName(), mappings);                                                </span>
<span class="5779175921552777483" onmouseenter="enter('5779175921552777483');" onmouseout="out('5779175921552777483');" style=""> 472          Long count = (Long) countQuery.getSingleResult();                                                         </span>
<span class="3590816377844072638" onmouseenter="enter('3590816377844072638');" onmouseout="out('3590816377844072638');" style=""> 473          BasicFieldMetadata metadata = null;                                                                       </span>
<span class="7377439406723422491" onmouseenter="enter('7377439406723422491');" onmouseout="out('7377439406723422491');" style=""> 474          if (count &gt; 0) {                                                                                          </span>
<span class="-1273552772110171187" onmouseenter="enter('-1273552772110171187');" onmouseout="out('-1273552772110171187');" style=""> 475              metadata = new BasicFieldMetadata();                                                                  </span>
<span class="7837199979125359629" onmouseenter="enter('7837199979125359629');" onmouseout="out('7837199979125359629');" style=""> 476              metadata.setFieldType(SupportedFieldType.ADDITIONAL_FOREIGN_KEY);                                     </span>
<span class="-7466329847812031362" onmouseenter="enter('-7466329847812031362');" onmouseout="out('-7466329847812031362');" style=""> 477              metadata.setSecondaryType(SupportedFieldType.INTEGER);                                                </span>
<span class="-31286131392644862" onmouseenter="enter('-31286131392644862');" onmouseout="out('-31286131392644862');" style=""> 478              metadata.setForeignKeyProperty(&quot;id&quot;);                                                                 </span>
<span class="332716961677554697" onmouseenter="enter('332716961677554697');" onmouseout="out('332716961677554697');" style=""> 479              metadata.setForeignKeyClass(ProductOptionValueImpl.class.getName());                                  </span>
<span class="-4184418208857498113" onmouseenter="enter('-4184418208857498113');" onmouseout="out('-4184418208857498113');" style=""> 480              metadata.setForeignKeyDisplayValueProperty(&quot;attributeValue&quot;);                                         </span>
<span class="4257701647031084459" onmouseenter="enter('4257701647031084459');" onmouseout="out('4257701647031084459');" style=""> 481              metadata.setLookupDisplayProperty(&quot;attributeValue&quot;);                                                  </span>
<span class="7303907294085574775" onmouseenter="enter('7303907294085574775');" onmouseout="out('7303907294085574775');" style=""> 482              metadata.setForeignKeyCollection(false);                                                              </span>
<span class="6675602877003966627" onmouseenter="enter('6675602877003966627');" onmouseout="out('6675602877003966627');" style=""> 483              metadata.setCustomCriteria(new String[]{&quot;option=&quot; + String.valueOf(option.getId())});                 </span>
<span class="1748190162337854256" onmouseenter="enter('1748190162337854256');" onmouseout="out('1748190162337854256');" style=""> 484              metadata.setName(PRODUCT_OPTION_FIELD_PREFIX + option.getId());                                       </span>
<span class="7017269500484793927" onmouseenter="enter('7017269500484793927');" onmouseout="out('7017269500484793927');" style=""> 485              metadata.setFriendlyName(option.getLabel());                                                          </span>
<span class="6085246036283927461" onmouseenter="enter('6085246036283927461');" onmouseout="out('6085246036283927461');" style=""> 486              metadata.setGroup(&quot;productOption_group&quot;);                                                             </span>
<span class="-8050220525630720562" onmouseenter="enter('-8050220525630720562');" onmouseout="out('-8050220525630720562');" style=""> 487              metadata.setGroupOrder(-1);                                                                           </span>
<span class="3406381469360124301" onmouseenter="enter('3406381469360124301');" onmouseout="out('3406381469360124301');" style=""> 488              metadata.setOrder(order);                                                                             </span>
<span class="2043314380305444305" onmouseenter="enter('2043314380305444305');" onmouseout="out('2043314380305444305');" style=""> 489              metadata.setExplicitFieldType(SupportedFieldType.ADDITIONAL_FOREIGN_KEY);                             </span>
<span class="-6994608424159816416" onmouseenter="enter('-6994608424159816416');" onmouseout="out('-6994608424159816416');" style=""> 490              metadata.setProminent(false);                                                                         </span>
<span class="6274758849936387106" onmouseenter="enter('6274758849936387106');" onmouseout="out('6274758849936387106');" style=""> 491              metadata.setVisibility(VisibilityEnum.FORM_EXPLICITLY_SHOWN);                                         </span>
<span class="8076682597610338410" onmouseenter="enter('8076682597610338410');" onmouseout="out('8076682597610338410');" style=""> 492              metadata.setReadOnly(false);                                                                          </span>
<span class="-4603246565563510167" onmouseenter="enter('-4603246565563510167');" onmouseout="out('-4603246565563510167');" style=""><abbr title=" 493              //these may not be actually required, but the CPH has this as a requirement for parsing the data, so we&#x27;ll stick with it here"> 493              //these may not be actually required, but the CPH has this as a requirement for parsing the data, so wðŸ”µ</abbr></span>
<span class="6102752219358130186" onmouseenter="enter('6102752219358130186');" onmouseout="out('6102752219358130186');" style=""> 494              metadata.setRequiredOverride(true);                                                                   </span>
<span class="-3053289446243924099" onmouseenter="enter('-3053289446243924099');" onmouseout="out('-3053289446243924099');" style=""> 495              metadata.setLookupType(LookupType.STANDARD);                                                          </span>
<span class="-6206284717251400514" onmouseenter="enter('-6206284717251400514');" onmouseout="out('-6206284717251400514');" style=""> 496              metadata.setMutable(true);                                                                            </span>
<span class="8194069883044431071" onmouseenter="enter('8194069883044431071');" onmouseout="out('8194069883044431071');" style=""> 497              metadata.setInheritedFromType(SkuImpl.class.getName());                                               </span>
<span class="7921709413407422398" onmouseenter="enter('7921709413407422398');" onmouseout="out('7921709413407422398');" style=""><abbr title=" 498              metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCache()));"> 498              metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCacheðŸ”µ</abbr></span>
<span class="-1649079592520542152" onmouseenter="enter('-1649079592520542152');" onmouseout="out('-1649079592520542152');" style=""> 499              metadata.setMergedPropertyType(MergedPropertyType.PRIMARY);                                           </span>
<span class="5062289219461079509" onmouseenter="enter('5062289219461079509');" onmouseout="out('5062289219461079509');" style=""> 500              metadata.setTargetClass(SkuImpl.class.getName());                                                     </span>
<span class="-6501495819508426588" onmouseenter="enter('-6501495819508426588');" onmouseout="out('-6501495819508426588');" style=""> 501              metadata.setFieldName(PRODUCT_OPTION_FIELD_PREFIX + option.getId());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 502          }                                                                                                         </span>
<span class="-6736542809122384852" onmouseenter="enter('-6736542809122384852');" onmouseout="out('-6736542809122384852');" style=""> 503          return metadata;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 504      }                                                                                                             </span>
<span  style=""> 505                                                                                                                    </span>
<span class="7948482626287429940" onmouseenter="enter('7948482626287429940');" onmouseout="out('7948482626287429940');" style=""> 506      @SuppressWarnings(&quot;unchecked&quot;)                                                                                </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 507      @Override                                                                                                     </span>
<span class="-1282377985319068039" onmouseenter="enter('-1282377985319068039');" onmouseout="out('-1282377985319068039');" style=""><abbr title=" 508      public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 508      public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynamicEntityðŸ”µ</abbr></span>
<span class="2519389108374285224" onmouseenter="enter('2519389108374285224');" onmouseout="out('2519389108374285224');" style=""><abbr title=" 509          String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname();"> 509          String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname()ðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 510          try {                                                                                                     </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""> 511              PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();       </span>
<span class="-4474933170501730421" onmouseenter="enter('-4474933170501730421');" onmouseout="out('-4474933170501730421');" style=""> 512              //get the default properties from Sku and its subclasses                                              </span>
<span class="-1647605982225346371" onmouseenter="enter('-1647605982225346371');" onmouseout="out('-1647605982225346371');" style=""><abbr title=" 513              Map&lt;String, FieldMetadata&gt; originalProps = helper.getSimpleMergedProperties(Sku.class.getName(), persistencePerspective);"> 513              Map&lt;String, FieldMetadata&gt; originalProps = helper.getSimpleMergedProperties(Sku.class.getName(), persiðŸ”µ</abbr></span>
<span  style=""> 514                                                                                                                    </span>
<span class="796362017556902885" onmouseenter="enter('796362017556902885');" onmouseout="out('796362017556902885');" style=""> 515              //Pull back the Skus based on the criteria from the client                                            </span>
<span class="-363648758652557915" onmouseenter="enter('-363648758652557915');" onmouseout="out('-363648758652557915');" style=""><abbr title=" 516              List&lt;FilterMapping&gt; filterMappings = helper.getFilterMappings(persistencePerspective, cto, ceilingEntityFullyQualifiedClassname, originalProps);"> 516              List&lt;FilterMapping&gt; filterMappings = helper.getFilterMappings(persistencePerspective, cto, ceilingEntiðŸ”µ</abbr></span>
<span  style=""> 517                                                                                                                    </span>
<span class="-3675685187725351740" onmouseenter="enter('-3675685187725351740');" onmouseout="out('-3675685187725351740');" style=""> 518              //allow subclasses to provide additional criteria before executing the query                          </span>
<span class="-7008588708271197253" onmouseenter="enter('-7008588708271197253');" onmouseout="out('-7008588708271197253');" style=""> 519              applyProductOptionValueCriteria(filterMappings, cto, persistencePackage, null);                       </span>
<span class="4646076149717404025" onmouseenter="enter('4646076149717404025');" onmouseout="out('4646076149717404025');" style=""> 520              applySkuBundleItemValueCriteria(filterMappings, cto, persistencePackage);                             </span>
<span class="-2737785807325266" onmouseenter="enter('-2737785807325266');" onmouseout="out('-2737785807325266');" style=""> 521              applyAdditionalFetchCriteria(filterMappings, cto, persistencePackage);                                </span>
<span  style=""> 522                                                                                                                    </span>
<span class="-4634567455719757558" onmouseenter="enter('-4634567455719757558');" onmouseout="out('-4634567455719757558');" style=""><abbr title=" 523              List&lt;Serializable&gt; records = helper.getPersistentRecords(persistencePackage.getCeilingEntityFullyQualifiedClassname(), filterMappings, cto.getFirstResult(), cto.getMaxResults());"> 523              List&lt;Serializable&gt; records = helper.getPersistentRecords(persistencePackage.getCeilingEntityFullyQualiðŸ”µ</abbr></span>
<span class="-5982273033000910285" onmouseenter="enter('-5982273033000910285');" onmouseout="out('-5982273033000910285');" style=""> 524              //Convert Skus into the client-side Entity representation                                             </span>
<span class="-2996861390233909505" onmouseenter="enter('-2996861390233909505');" onmouseout="out('-2996861390233909505');" style=""> 525              Entity[] payload = helper.getRecords(originalProps, records);                                         </span>
<span  style=""> 526                                                                                                                    </span>
<span class="-4184869795171170066" onmouseenter="enter('-4184869795171170066');" onmouseout="out('-4184869795171170066');" style=""><abbr title=" 527              int totalRecords = helper.getTotalRecords(persistencePackage.getCeilingEntityFullyQualifiedClassname(), filterMappings);"> 527              int totalRecords = helper.getTotalRecords(persistencePackage.getCeilingEntityFullyQualifiedClassname()ðŸ”µ</abbr></span>
<span  style=""> 528                                                                                                                    </span>
<span class="-3763055148335758582" onmouseenter="enter('-3763055148335758582');" onmouseout="out('-3763055148335758582');" style=""> 529              //Now fill out the relevant properties for the product options for the Skus that were returned        </span>
<span class="7697812602397668509" onmouseenter="enter('7697812602397668509');" onmouseout="out('7697812602397668509');" style=""> 530              updateProductOptionFieldsForFetch(records, payload);                                                  </span>
<span  style=""> 531                                                                                                                    </span>
<span class="-8933105127068001704" onmouseenter="enter('-8933105127068001704');" onmouseout="out('-8933105127068001704');" style=""> 532              return new DynamicResultSet(payload, totalRecords);                                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 533          } catch (Exception e) {                                                                                   </span>
<span class="733531699862187915" onmouseenter="enter('733531699862187915');" onmouseout="out('733531699862187915');" style=""><abbr title=" 534              throw new ServiceException(&quot;Unable to perform fetch for entity: &quot; + ceilingEntityFullyQualifiedClassname, e);"> 534              throw new ServiceException(&quot;Unable to perform fetch for entity: &quot; + ceilingEntityFullyQualifiedClassnaðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 535          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 536      }                                                                                                             </span>
<span  style=""> 537                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 538      /**                                                                                                           </span>
<span class="-7824652902262605659" onmouseenter="enter('-7824652902262605659');" onmouseout="out('-7824652902262605659');" style=""><abbr title=" 539       * Sets the {@link ProductOptionValue}s of the given {@link Sku}s in a list format for display in a ListGrid context."> 539       * Sets the {@link ProductOptionValue}s of the given {@link Sku}s in a list format for display in a ListGrid cðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 540       *                                                                                                            </span>
<span class="-4052130305078083276" onmouseenter="enter('-4052130305078083276');" onmouseout="out('-4052130305078083276');" style=""> 541       * @param records                                                                                             </span>
<span class="-6904460697287898969" onmouseenter="enter('-6904460697287898969');" onmouseout="out('-6904460697287898969');" style=""> 542       * @param payload                                                                                             </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 543       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 544       */                                                                                                           </span>
<span class="3124517244149022485" onmouseenter="enter('3124517244149022485');" onmouseout="out('3124517244149022485');" style=""> 545      public void updateProductOptionFieldsForFetch(List&lt;Serializable&gt; records, Entity[] payload) {                 </span>
<span class="-7972041122971845939" onmouseenter="enter('-7972041122971845939');" onmouseout="out('-7972041122971845939');" style=""> 546          for (int i = 0; i &lt; records.size(); i++) {                                                                </span>
<span class="-3191004483130397206" onmouseenter="enter('-3191004483130397206');" onmouseout="out('-3191004483130397206');" style=""> 547              Sku sku = (Sku) records.get(i);                                                                       </span>
<span class="6067761635845867397" onmouseenter="enter('6067761635845867397');" onmouseout="out('6067761635845867397');" style=""> 548              Entity entity = payload[i];                                                                           </span>
<span  style=""> 549                                                                                                                    </span>
<span class="-1747148511640135280" onmouseenter="enter('-1747148511640135280');" onmouseout="out('-1747148511640135280');" style=""><abbr title=" 550              List&lt;ProductOptionValue&gt; optionValues = BLCCollectionUtils.collectList(sku.getProductOptionValueXrefs(), new TypedTransformer&lt;ProductOptionValue&gt;() {"> 550              List&lt;ProductOptionValue&gt; optionValues = BLCCollectionUtils.collectList(sku.getProductOptionValueXrefs(ðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 551                  @Override                                                                                         </span>
<span class="1152092933178682803" onmouseenter="enter('1152092933178682803');" onmouseout="out('1152092933178682803');" style=""> 552                  public ProductOptionValue transform(Object input) {                                               </span>
<span class="-8868352318711405431" onmouseenter="enter('-8868352318711405431');" onmouseout="out('-8868352318711405431');" style=""> 553                      return ((SkuProductOptionValueXref) input).getProductOptionValue();                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 554                  }                                                                                                 </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 555              });                                                                                                   </span>
<span  style=""> 556                                                                                                                    </span>
<span class="-1852425527821468846" onmouseenter="enter('-1852425527821468846');" onmouseout="out('-1852425527821468846');" style=""> 557              for (ProductOptionValue value : optionValues) {                                                       </span>
<span class="6080984475054679236" onmouseenter="enter('6080984475054679236');" onmouseout="out('6080984475054679236');" style=""> 558                  Property optionProperty = new Property();                                                         </span>
<span class="4438211203610377533" onmouseenter="enter('4438211203610377533');" onmouseout="out('4438211203610377533');" style=""> 559                  optionProperty.setName(PRODUCT_OPTION_FIELD_PREFIX + value.getProductOption().getId());           </span>
<span class="-3040338369255071721" onmouseenter="enter('-3040338369255071721');" onmouseout="out('-3040338369255071721');" style=""> 560                  optionProperty.setValue(value.getId().toString());                                                </span>
<span class="4260727162498882307" onmouseenter="enter('4260727162498882307');" onmouseout="out('4260727162498882307');" style=""> 561                  optionProperty.setDisplayValue(value.getAttributeValue());                                        </span>
<span class="1859377182209271680" onmouseenter="enter('1859377182209271680');" onmouseout="out('1859377182209271680');" style=""> 562                  entity.addProperty(optionProperty);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 563              }                                                                                                     </span>
<span  style=""> 564                                                                                                                    </span>
<span class="4597418554840578281" onmouseenter="enter('4597418554840578281');" onmouseout="out('4597418554840578281');" style=""> 565              if (CollectionUtils.isNotEmpty(optionValues)) {                                                       </span>
<span class="5213586233451889239" onmouseenter="enter('5213586233451889239');" onmouseout="out('5213586233451889239');" style=""> 566                  entity.addProperty(getConsolidatedOptionProperty(optionValues));                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 567              } else {                                                                                              </span>
<span class="-6341791635059832722" onmouseenter="enter('-6341791635059832722');" onmouseout="out('-6341791635059832722');" style=""> 568                  entity.addProperty(getBlankConsolidatedOptionProperty());                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 569              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 570          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 571      }                                                                                                             </span>
<span  style=""> 572                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 573      /**                                                                                                           </span>
<span class="7787882510504443634" onmouseenter="enter('7787882510504443634');" onmouseout="out('7787882510504443634');" style=""> 574       * Add filter restriction such that a ProductBundle cannot add its own default sku as a Sku Bundle Item       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 575       */                                                                                                           </span>
<span class="-7214039343588646460" onmouseenter="enter('-7214039343588646460');" onmouseout="out('-7214039343588646460');" style=""><abbr title=" 576      private void applySkuBundleItemValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PersistencePackage persistencePackage) {"> 576      private void applySkuBundleItemValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PðŸ”µ</abbr></span>
<span class="-8187222964943103604" onmouseenter="enter('-8187222964943103604');" onmouseout="out('-8187222964943103604');" style=""> 577          SectionCrumb[] sectionCrumbs = persistencePackage.getSectionCrumbs();                                     </span>
<span class="-1899330423728999759" onmouseenter="enter('-1899330423728999759');" onmouseout="out('-1899330423728999759');" style=""> 578          if (isSkuBundleItemLookup(persistencePackage, sectionCrumbs)) {                                           </span>
<span class="8268114114086125791" onmouseenter="enter('8268114114086125791');" onmouseout="out('8268114114086125791');" style=""> 579              final Long defaultSkuId = getOwningProductBundlesDefaultSkuId(sectionCrumbs[0]);                      </span>
<span  style=""> 580                                                                                                                    </span>
<span class="8197169377808819118" onmouseenter="enter('8197169377808819118');" onmouseout="out('8197169377808819118');" style=""> 581              filterMappings.add(new FilterMapping()                                                                </span>
<span class="-2686901866072439951" onmouseenter="enter('-2686901866072439951');" onmouseout="out('-2686901866072439951');" style=""> 582                      .withDirectFilterValues(Collections.singletonList(defaultSkuId))                              </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 583                      .withRestriction(new Restriction()                                                            </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 584                                      .withPredicateProvider(new PredicateProvider() {                              </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 585                                          @Override                                                                 </span>
<span class="-6543887403560352788" onmouseenter="enter('-6543887403560352788');" onmouseout="out('-6543887403560352788');" style=""> 586                                          public Predicate buildPredicate(CriteriaBuilder builder,                  </span>
<span class="-7125560532692692259" onmouseenter="enter('-7125560532692692259');" onmouseout="out('-7125560532692692259');" style=""> 587                                                  FieldPathBuilder fieldPathBuilder,                                </span>
<span class="8221798817053541417" onmouseenter="enter('8221798817053541417');" onmouseout="out('8221798817053541417');" style=""> 588                                                  From root, String ceilingEntity,                                  </span>
<span class="-5624751861859036647" onmouseenter="enter('-5624751861859036647');" onmouseout="out('-5624751861859036647');" style=""> 589                                                  String fullPropertyName, Path explicitPath,                       </span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style=""> 590                                                  List directValues) {                                              </span>
<span class="4460015033870714518" onmouseenter="enter('4460015033870714518');" onmouseout="out('4460015033870714518');" style=""> 591                                              return builder.notEqual(root, directValues.get(0));                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 592                                          }                                                                         </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 593                                      })                                                                            </span>
<span class="3699784701886273761" onmouseenter="enter('3699784701886273761');" onmouseout="out('3699784701886273761');" style=""> 594                      ));                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 595          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 596      }                                                                                                             </span>
<span  style=""> 597                                                                                                                    </span>
<span class="-2798114006144580065" onmouseenter="enter('-2798114006144580065');" onmouseout="out('-2798114006144580065');" style=""> 598      private boolean isSkuBundleItemLookup(PersistencePackage pkg, SectionCrumb[] sectionCrumbs) {                 </span>
<span class="1586917148156434191" onmouseenter="enter('1586917148156434191');" onmouseout="out('1586917148156434191');" style=""> 599          boolean owningClassMatch = false;                                                                         </span>
<span class="-67344974392233049" onmouseenter="enter('-67344974392233049');" onmouseout="out('-67344974392233049');" style=""> 600          boolean requestingFieldMatch = false;                                                                     </span>
<span  style=""> 601                                                                                                                    </span>
<span class="-4586108065315097422" onmouseenter="enter('-4586108065315097422');" onmouseout="out('-4586108065315097422');" style=""> 602          if (pkg.getCustomCriteria() == null || ArrayUtils.isEmpty(sectionCrumbs)) {                               </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 603              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 604          }                                                                                                         </span>
<span  style=""> 605                                                                                                                    </span>
<span class="-2549092676085499199" onmouseenter="enter('-2549092676085499199');" onmouseout="out('-2549092676085499199');" style=""> 606          for (String criteria : pkg.getCustomCriteria()) {                                                         </span>
<span class="-2108620833305617258" onmouseenter="enter('-2108620833305617258');" onmouseout="out('-2108620833305617258');" style=""> 607              if (&quot;owningClass=org.broadleafcommerce.core.catalog.domain.SkuBundleItemImpl&quot;.equals(criteria)) {     </span>
<span class="8041666773318789268" onmouseenter="enter('8041666773318789268');" onmouseout="out('8041666773318789268');" style=""> 608                  owningClassMatch = true;                                                                          </span>
<span class="4858029770045852471" onmouseenter="enter('4858029770045852471');" onmouseout="out('4858029770045852471');" style=""> 609              } else if (&quot;requestingField=sku&quot;.equals(criteria)) {                                                  </span>
<span class="-1860793199325339033" onmouseenter="enter('-1860793199325339033');" onmouseout="out('-1860793199325339033');" style=""> 610                  requestingFieldMatch = true;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 611              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 612          }                                                                                                         </span>
<span  style=""> 613                                                                                                                    </span>
<span class="-3217646211476483325" onmouseenter="enter('-3217646211476483325');" onmouseout="out('-3217646211476483325');" style=""><abbr title=" 614          boolean sectionCrumbMatch = ProductImpl.class.getCanonicalName().equals(sectionCrumbs[0].getSectionIdentifier());"> 614          boolean sectionCrumbMatch = ProductImpl.class.getCanonicalName().equals(sectionCrumbs[0].getSectionIdentifðŸ”µ</abbr></span>
<span  style=""> 615                                                                                                                    </span>
<span class="6240774352197414719" onmouseenter="enter('6240774352197414719');" onmouseout="out('6240774352197414719');" style=""> 616          return owningClassMatch &amp;&amp; requestingFieldMatch &amp;&amp; sectionCrumbMatch;                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 617      }                                                                                                             </span>
<span  style=""> 618                                                                                                                    </span>
<span class="-1671571892486457707" onmouseenter="enter('-1671571892486457707');" onmouseout="out('-1671571892486457707');" style=""> 619      private Long getOwningProductBundlesDefaultSkuId(SectionCrumb sectionCrumb) {                                 </span>
<span class="2328697212854986127" onmouseenter="enter('2328697212854986127');" onmouseout="out('2328697212854986127');" style=""> 620          if (ProductImpl.class.getCanonicalName().equals(sectionCrumb.getSectionIdentifier())                      </span>
<span class="-9004648441586212047" onmouseenter="enter('-9004648441586212047');" onmouseout="out('-9004648441586212047');" style=""> 621                  &amp;&amp; sectionCrumb.getSectionId() != null) {                                                         </span>
<span class="4513323716586759964" onmouseenter="enter('4513323716586759964');" onmouseout="out('4513323716586759964');" style=""><abbr title=" 622              ProductBundle productBundle = (ProductBundle) catalogService.findProductById(Long.valueOf(sectionCrumb.getSectionId()));"> 622              ProductBundle productBundle = (ProductBundle) catalogService.findProductById(Long.valueOf(sectionCrumbðŸ”µ</abbr></span>
<span class="4400035530065637673" onmouseenter="enter('4400035530065637673');" onmouseout="out('4400035530065637673');" style=""> 623              return productBundle.getDefaultSku().getId();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 624          }                                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 625          return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 626      }                                                                                                             </span>
<span  style=""> 627                                                                                                                    </span>
<span class="-7687230963098454148" onmouseenter="enter('-7687230963098454148');" onmouseout="out('-7687230963098454148');" style=""><abbr title=" 628      public void applyProductOptionValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PersistencePackage persistencePackage, String skuPropertyPrefix) {"> 628      public void applyProductOptionValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PeðŸ”µ</abbr></span>
<span  style=""> 629                                                                                                                    </span>
<span class="942620444934049587" onmouseenter="enter('942620444934049587');" onmouseout="out('942620444934049587');" style=""> 630          //if the front                                                                                            </span>
<span class="8112796229062982729" onmouseenter="enter('8112796229062982729');" onmouseout="out('8112796229062982729');" style=""> 631          final List&lt;Long&gt; productOptionValueFilterIDs = new ArrayList&lt;&gt;();                                         </span>
<span class="-6853245302921753815" onmouseenter="enter('-6853245302921753815');" onmouseout="out('-6853245302921753815');" style=""> 632          for (String filterProperty : cto.getCriteriaMap().keySet()) {                                             </span>
<span class="-4107857553734806058" onmouseenter="enter('-4107857553734806058');" onmouseout="out('-4107857553734806058');" style=""> 633              if (filterProperty.startsWith(PRODUCT_OPTION_FIELD_PREFIX)) {                                         </span>
<span class="-1621748473978415179" onmouseenter="enter('-1621748473978415179');" onmouseout="out('-1621748473978415179');" style=""> 634                  FilterAndSortCriteria criteria = cto.get(filterProperty);                                         </span>
<span class="5553495253525789791" onmouseenter="enter('5553495253525789791');" onmouseout="out('5553495253525789791');" style=""> 635                  productOptionValueFilterIDs.add(Long.parseLong(criteria.getFilterValues().get(0)));               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 636              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 637          }                                                                                                         </span>
<span  style=""> 638                                                                                                                    </span>
<span class="4522856558687017152" onmouseenter="enter('4522856558687017152');" onmouseout="out('4522856558687017152');" style=""> 639          //also determine if there is a consolidated POV query                                                     </span>
<span class="-8501099544391483771" onmouseenter="enter('-8501099544391483771');" onmouseout="out('-8501099544391483771');" style=""> 640          final List&lt;String&gt; productOptionValueFilterValues = new ArrayList&lt;&gt;();                                    </span>
<span class="-3774683769233331029" onmouseenter="enter('-3774683769233331029');" onmouseout="out('-3774683769233331029');" style=""> 641          FilterAndSortCriteria consolidatedCriteria = cto.get(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);            </span>
<span class="3919937138964866453" onmouseenter="enter('3919937138964866453');" onmouseout="out('3919937138964866453');" style=""> 642          if (!consolidatedCriteria.getFilterValues().isEmpty()) {                                                  </span>
<span class="-8697432381506519263" onmouseenter="enter('-8697432381506519263');" onmouseout="out('-8697432381506519263');" style=""> 643              //the criteria in this case would be a semi-colon delimeter value list                                </span>
<span class="-2544935018250883467" onmouseenter="enter('-2544935018250883467');" onmouseout="out('-2544935018250883467');" style=""><abbr title=" 644              productOptionValueFilterValues.addAll(Arrays.asList(StringUtils.split(consolidatedCriteria.getFilterValues().get(0), CONSOLIDATED_PRODUCT_OPTIONS_DELIMETER)));"> 644              productOptionValueFilterValues.addAll(Arrays.asList(StringUtils.split(consolidatedCriteria.getFilterVaðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 645          }                                                                                                         </span>
<span  style=""> 646                                                                                                                    </span>
<span class="-3296023389552605288" onmouseenter="enter('-3296023389552605288');" onmouseout="out('-3296023389552605288');" style=""> 647          if (productOptionValueFilterIDs.size() &gt; 0) {                                                             </span>
<span class="-3028331070500986006" onmouseenter="enter('-3028331070500986006');" onmouseout="out('-3028331070500986006');" style=""> 648              FilterMapping filterMapping = new FilterMapping()                                                     </span>
<span class="3198376136531373476" onmouseenter="enter('3198376136531373476');" onmouseout="out('3198376136531373476');" style=""><abbr title=" 649                  .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?&quot;&quot;:skuPropertyPrefix + &quot;.productOptionValueXrefs.productOptionValue.id&quot;))"> 649                  .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?&quot;&quot;:skuProðŸ”µ</abbr></span>
<span class="-3630476675353547213" onmouseenter="enter('-3630476675353547213');" onmouseout="out('-3630476675353547213');" style=""> 650                  .withDirectFilterValues(productOptionValueFilterIDs)                                              </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 651                  .withRestriction(new Restriction()                                                                </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 652                      .withPredicateProvider(new PredicateProvider() {                                              </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 653                          @Override                                                                                 </span>
<span class="-33431144742852463" onmouseenter="enter('-33431144742852463');" onmouseout="out('-33431144742852463');" style=""><abbr title=" 654                          public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,"> 654                          public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilderðŸ”µ</abbr></span>
<span class="8221798817053541417" onmouseenter="enter('8221798817053541417');" onmouseout="out('8221798817053541417');" style=""> 655                                                          From root, String ceilingEntity,                          </span>
<span class="-6963673837518342908" onmouseenter="enter('-6963673837518342908');" onmouseout="out('-6963673837518342908');" style=""><abbr title=" 656                                                          String fullPropertyName, Path explicitPath, List directValues) {"> 656                                                          String fullPropertyName, Path explicitPath, List directValðŸ”µ</abbr></span>
<span class="-6719486958351285112" onmouseenter="enter('-6719486958351285112');" onmouseout="out('-6719486958351285112');" style=""> 657                              return explicitPath.as(Long.class).in(directValues);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 658                          }                                                                                         </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 659                      })                                                                                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 660                  );                                                                                                </span>
<span class="-2605411155138525883" onmouseenter="enter('-2605411155138525883');" onmouseout="out('-2605411155138525883');" style=""> 661              filterMappings.add(filterMapping);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 662          }                                                                                                         </span>
<span class="36743717647982951" onmouseenter="enter('36743717647982951');" onmouseout="out('36743717647982951');" style=""> 663          if (productOptionValueFilterValues.size() &gt; 0) {                                                          </span>
<span class="-3028331070500986006" onmouseenter="enter('-3028331070500986006');" onmouseout="out('-3028331070500986006');" style=""> 664              FilterMapping filterMapping = new FilterMapping()                                                     </span>
<span class="8503258665314341487" onmouseenter="enter('8503258665314341487');" onmouseout="out('8503258665314341487');" style=""><abbr title=" 665                  .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?&quot;&quot;:skuPropertyPrefix + &quot;.productOptionValueXrefs.productOptionValue.attributeValue&quot;))"> 665                  .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?&quot;&quot;:skuProðŸ”µ</abbr></span>
<span class="-7312773306171765245" onmouseenter="enter('-7312773306171765245');" onmouseout="out('-7312773306171765245');" style=""> 666                  .withDirectFilterValues(productOptionValueFilterValues)                                           </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 667                  .withRestriction(new Restriction()                                                                </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 668                      .withPredicateProvider(new PredicateProvider() {                                              </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 669                          @Override                                                                                 </span>
<span class="-33431144742852463" onmouseenter="enter('-33431144742852463');" onmouseout="out('-33431144742852463');" style=""><abbr title=" 670                          public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,"> 670                          public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilderðŸ”µ</abbr></span>
<span class="8221798817053541417" onmouseenter="enter('8221798817053541417');" onmouseout="out('8221798817053541417');" style=""> 671                                                          From root, String ceilingEntity,                          </span>
<span class="-6963673837518342908" onmouseenter="enter('-6963673837518342908');" onmouseout="out('-6963673837518342908');" style=""><abbr title=" 672                                                          String fullPropertyName, Path explicitPath, List directValues) {"> 672                                                          String fullPropertyName, Path explicitPath, List directValðŸ”µ</abbr></span>
<span class="-2981715763030013918" onmouseenter="enter('-2981715763030013918');" onmouseout="out('-2981715763030013918');" style=""> 673                              return explicitPath.as(String.class).in(directValues);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 674                          }                                                                                         </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 675                      })                                                                                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 676                  );                                                                                                </span>
<span class="-2605411155138525883" onmouseenter="enter('-2605411155138525883');" onmouseout="out('-2605411155138525883');" style=""> 677              filterMappings.add(filterMapping);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 678          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 679      }                                                                                                             </span>
<span  style=""> 680                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 681      /**                                                                                                           </span>
<span class="-8618302828054746698" onmouseenter="enter('-8618302828054746698');" onmouseout="out('-8618302828054746698');" style=""><abbr title=" 682       * &lt;p&gt;Available override point for subclasses if they would like to add additional criteria via the queryCritiera. At the"> 682       * &lt;p&gt;Available override point for subclasses if they would like to add additional criteria via the queryCritiðŸ”µ</abbr></span>
<span class="5710282049517599386" onmouseenter="enter('5710282049517599386');" onmouseout="out('5710282049517599386');" style=""><abbr title=" 683       * point that this method has been called, criteria from the frontend has already been applied, thus allowing you to"> 683       * point that this method has been called, criteria from the frontend has already been applied, thus allowing ðŸ”µ</abbr></span>
<span class="-8977449216901818262" onmouseenter="enter('-8977449216901818262');" onmouseout="out('-8977449216901818262');" style=""> 684       * override from there as well.&lt;/p&gt;                                                                           </span>
<span class="6192892703049124137" onmouseenter="enter('6192892703049124137');" onmouseout="out('6192892703049124137');" style=""><abbr title=" 685       * &lt;p&gt;Subclasses that choose to override this should also call this super method so that correct filter criteria"> 685       * &lt;p&gt;Subclasses that choose to override this should also call this super method so that correct filter criterðŸ”µ</abbr></span>
<span class="4504111184556558489" onmouseenter="enter('4504111184556558489');" onmouseout="out('4504111184556558489');" style=""> 686       * can be applied for product option values&lt;/p&gt;                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 687       *                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 688       */                                                                                                           </span>
<span class="6595350754076949595" onmouseenter="enter('6595350754076949595');" onmouseout="out('6595350754076949595');" style=""><abbr title=" 689      public void applyAdditionalFetchCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PersistencePackage persistencePackage) {"> 689      public void applyAdditionalFetchCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PersiðŸ”µ</abbr></span>
<span class="-9143014012238338039" onmouseenter="enter('-9143014012238338039');" onmouseout="out('-9143014012238338039');" style=""> 690          //unimplemented                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 691      }                                                                                                             </span>
<span  style=""> 692                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 693      @Override                                                                                                     </span>
<span class="-3782560920985534584" onmouseenter="enter('-3782560920985534584');" onmouseout="out('-3782560920985534584');" style=""><abbr title=" 694      public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 694      public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helpeðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 695          Entity entity = persistencePackage.getEntity();                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 696          try {                                                                                                     </span>
<span class="2168419604722842668" onmouseenter="enter('2168419604722842668');" onmouseout="out('2168419604722842668');" style=""> 697              //Fill out the Sku instance from the form                                                             </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""> 698              PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();       </span>
<span class="-2646375190695846844" onmouseenter="enter('-2646375190695846844');" onmouseout="out('-2646375190695846844');" style=""> 699              Sku adminInstance = (Sku) Class.forName(entity.getType()[0]).newInstance();                           </span>
<span class="1729465429044706845" onmouseenter="enter('1729465429044706845');" onmouseout="out('1729465429044706845');" style=""><abbr title=" 700              Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getName(), persistencePerspective);"> 700              Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getName(), perðŸ”µ</abbr></span>
<span class="-7453227611519095000" onmouseenter="enter('-7453227611519095000');" onmouseout="out('-7453227611519095000');" style=""> 701              filterOutProductMetadata(adminProperties);                                                            </span>
<span class="2916291722905579881" onmouseenter="enter('2916291722905579881');" onmouseout="out('2916291722905579881');" style=""> 702              adminInstance = (Sku) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);  </span>
<span  style=""> 703                                                                                                                    </span>
<span class="561479470093632813" onmouseenter="enter('561479470093632813');" onmouseout="out('561479470093632813');" style=""> 704              //Verify that there isn&#x27;t already a Sku for this particular product option value combo                </span>
<span class="-7646105610360359073" onmouseenter="enter('-7646105610360359073');" onmouseout="out('-7646105610360359073');" style=""> 705              Entity errorEntity = validateUniqueProductOptionValueCombination(adminInstance.getProduct(),          </span>
<span class="7978785476337646518" onmouseenter="enter('7978785476337646518');" onmouseout="out('7978785476337646518');" style=""> 706                                                                               getProductOptionProperties(entity),  </span>
<span class="-5950258146809433717" onmouseenter="enter('-5950258146809433717');" onmouseout="out('-5950258146809433717');" style=""> 707                                                                               null);                               </span>
<span class="315758838568217561" onmouseenter="enter('315758838568217561');" onmouseout="out('315758838568217561');" style=""> 708              if (errorEntity != null) {                                                                            </span>
<span class="-6380597201056661281" onmouseenter="enter('-6380597201056661281');" onmouseout="out('-6380597201056661281');" style=""> 709                  entity.setPropertyValidationErrors(errorEntity.getPropertyValidationErrors());                    </span>
<span class="-7572797105708032926" onmouseenter="enter('-7572797105708032926');" onmouseout="out('-7572797105708032926');" style=""> 710                  return entity;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 711              }                                                                                                     </span>
<span  style=""> 712                                                                                                                    </span>
<span class="-5884073955982735941" onmouseenter="enter('-5884073955982735941');" onmouseout="out('-5884073955982735941');" style=""> 713              //persist the newly-created Sku                                                                       </span>
<span class="8006946942803724880" onmouseenter="enter('8006946942803724880');" onmouseout="out('8006946942803724880');" style=""> 714              adminInstance = dynamicEntityDao.persist(adminInstance);                                              </span>
<span  style=""> 715                                                                                                                    </span>
<span class="-704220126533799367" onmouseenter="enter('-704220126533799367');" onmouseout="out('-704220126533799367');" style=""> 716              //associate the product option values                                                                 </span>
<span class="4472814042081188939" onmouseenter="enter('4472814042081188939');" onmouseout="out('4472814042081188939');" style=""> 717              associateProductOptionValuesToSku(entity, adminInstance, dynamicEntityDao);                           </span>
<span  style=""> 718                                                                                                                    </span>
<span class="-5246565985745556188" onmouseenter="enter('-5246565985745556188');" onmouseout="out('-5246565985745556188');" style=""> 719              //After associating the product option values, save off the Sku                                       </span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 720              adminInstance = dynamicEntityDao.merge(adminInstance);                                                </span>
<span  style=""> 721                                                                                                                    </span>
<span class="-2729035098975137606" onmouseenter="enter('-2729035098975137606');" onmouseout="out('-2729035098975137606');" style=""> 722              //Fill out the DTO and add in the product option value properties to it                               </span>
<span class="8927160133375333586" onmouseenter="enter('8927160133375333586');" onmouseout="out('8927160133375333586');" style=""> 723              Entity result = helper.getRecord(adminProperties, adminInstance, null, null);                         </span>
<span class="-1352652314153256295" onmouseenter="enter('-1352652314153256295');" onmouseout="out('-1352652314153256295');" style=""> 724              for (Property property : getProductOptionProperties(entity)) {                                        </span>
<span class="-6991744037283748574" onmouseenter="enter('-6991744037283748574');" onmouseout="out('-6991744037283748574');" style=""> 725                  result.addProperty(property);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 726              }                                                                                                     </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 727              return result;                                                                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 728          } catch (Exception e) {                                                                                   </span>
<span class="3314391270131938130" onmouseenter="enter('3314391270131938130');" onmouseout="out('3314391270131938130');" style=""> 729              throw new ServiceException(&quot;Unable to perform fetch for entity: &quot; + Sku.class.getName(), e);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 730          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 731      }                                                                                                             </span>
<span  style=""> 732                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 733      @Override                                                                                                     </span>
<span class="-7421665622225711363" onmouseenter="enter('-7421665622225711363');" onmouseout="out('-7421665622225711363');" style=""><abbr title=" 734      public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 734      public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper heðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 735          Entity entity = persistencePackage.getEntity();                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 736          try {                                                                                                     </span>
<span class="2168419604722842668" onmouseenter="enter('2168419604722842668');" onmouseout="out('2168419604722842668');" style=""> 737              //Fill out the Sku instance from the form                                                             </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""> 738              PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();       </span>
<span class="1729465429044706845" onmouseenter="enter('1729465429044706845');" onmouseout="out('1729465429044706845');" style=""><abbr title=" 739              Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getName(), persistencePerspective);"> 739              Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getName(), perðŸ”µ</abbr></span>
<span class="-7453227611519095000" onmouseenter="enter('-7453227611519095000');" onmouseout="out('-7453227611519095000');" style=""> 740              filterOutProductMetadata(adminProperties);                                                            </span>
<span class="-5056229965271915337" onmouseenter="enter('-5056229965271915337');" onmouseout="out('-5056229965271915337');" style=""> 741              Object primaryKey = helper.getPrimaryKey(entity, adminProperties);                                    </span>
<span class="5076299244443205355" onmouseenter="enter('5076299244443205355');" onmouseout="out('5076299244443205355');" style=""> 742              Sku adminInstance = (Sku) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]), primaryKey);  </span>
<span class="2916291722905579881" onmouseenter="enter('2916291722905579881');" onmouseout="out('2916291722905579881');" style=""> 743              adminInstance = (Sku) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);  </span>
<span  style=""> 744                                                                                                                    </span>
<span class="561479470093632813" onmouseenter="enter('561479470093632813');" onmouseout="out('561479470093632813');" style=""> 745              //Verify that there isn&#x27;t already a Sku for this particular product option value combo                </span>
<span class="-7646105610360359073" onmouseenter="enter('-7646105610360359073');" onmouseout="out('-7646105610360359073');" style=""> 746              Entity errorEntity = validateUniqueProductOptionValueCombination(adminInstance.getProduct(),          </span>
<span class="7978785476337646518" onmouseenter="enter('7978785476337646518');" onmouseout="out('7978785476337646518');" style=""> 747                                                                              getProductOptionProperties(entity),   </span>
<span class="-2741785419016191367" onmouseenter="enter('-2741785419016191367');" onmouseout="out('-2741785419016191367');" style=""> 748                                                                              adminInstance);                       </span>
<span class="315758838568217561" onmouseenter="enter('315758838568217561');" onmouseout="out('315758838568217561');" style=""> 749              if (errorEntity != null) {                                                                            </span>
<span class="-6380597201056661281" onmouseenter="enter('-6380597201056661281');" onmouseout="out('-6380597201056661281');" style=""> 750                  entity.setPropertyValidationErrors(errorEntity.getPropertyValidationErrors());                    </span>
<span class="-7572797105708032926" onmouseenter="enter('-7572797105708032926');" onmouseout="out('-7572797105708032926');" style=""> 751                  return entity;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 752              }                                                                                                     </span>
<span  style=""> 753                                                                                                                    </span>
<span class="-1592345858824912592" onmouseenter="enter('-1592345858824912592');" onmouseout="out('-1592345858824912592');" style=""> 754              // Only modify product options if this ISN&#x27;T an update for inventory properties                       </span>
<span class="-4074871831516694131" onmouseenter="enter('-4074871831516694131');" onmouseout="out('-4074871831516694131');" style=""> 755              if (!persistencePackage.containsCriteria(INVENTORY_ONLY_CRITERIA)) {                                  </span>
<span class="4472814042081188939" onmouseenter="enter('4472814042081188939');" onmouseout="out('4472814042081188939');" style=""> 756                  associateProductOptionValuesToSku(entity, adminInstance, dynamicEntityDao);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 757              }                                                                                                     </span>
<span  style=""> 758                                                                                                                    </span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 759              adminInstance = dynamicEntityDao.merge(adminInstance);                                                </span>
<span  style=""> 760                                                                                                                    </span>
<span class="6972089533394912781" onmouseenter="enter('6972089533394912781');" onmouseout="out('6972089533394912781');" style=""> 761              extensionManager.getProxy().skuUpdated(adminInstance);                                                </span>
<span  style=""> 762                                                                                                                    </span>
<span class="-2729035098975137606" onmouseenter="enter('-2729035098975137606');" onmouseout="out('-2729035098975137606');" style=""> 763              //Fill out the DTO and add in the product option value properties to it                               </span>
<span class="8927160133375333586" onmouseenter="enter('8927160133375333586');" onmouseout="out('8927160133375333586');" style=""> 764              Entity result = helper.getRecord(adminProperties, adminInstance, null, null);                         </span>
<span class="-1352652314153256295" onmouseenter="enter('-1352652314153256295');" onmouseout="out('-1352652314153256295');" style=""> 765              for (Property property : getProductOptionProperties(entity)) {                                        </span>
<span class="-6991744037283748574" onmouseenter="enter('-6991744037283748574');" onmouseout="out('-6991744037283748574');" style=""> 766                  result.addProperty(property);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 767              }                                                                                                     </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 768              return result;                                                                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 769          } catch (Exception e) {                                                                                   </span>
<span class="-5937019774393085643" onmouseenter="enter('-5937019774393085643');" onmouseout="out('-5937019774393085643');" style=""> 770              throw new ServiceException(&quot;Unable to perform update for entity: &quot; + Sku.class.getName(), e);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 771          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 772      }                                                                                                             </span>
<span  style=""> 773                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 774      @Override                                                                                                     </span>
<span class="9216576132440445278" onmouseenter="enter('9216576132440445278');" onmouseout="out('9216576132440445278');" style=""> 775      protected String[] getPolymorphicClasses(Class&lt;?&gt; clazz, EntityManager em, boolean useCache) {                </span>
<span class="858198974140428987" onmouseenter="enter('858198974140428987');" onmouseout="out('858198974140428987');" style=""> 776          DynamicDaoHelperImpl helper = new DynamicDaoHelperImpl();                                                 </span>
<span class="5862655439879943987" onmouseenter="enter('5862655439879943987');" onmouseout="out('5862655439879943987');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 777 -        Class&lt;?&gt;[] classes = helper.getAllPolymorphicEntitiesFromCeiling(clazz,                                   </span>
<span class="7212693925267149793" onmouseenter="enter('7212693925267149793');" onmouseout="out('7212693925267149793');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 778 -                helper.getSessionFactory((HibernateEntityManager) em), true, useCache);                           </span>
<span class="5646922235819357545" onmouseenter="enter('5646922235819357545');" onmouseout="out('5646922235819357545');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 779 +        Class&lt;?&gt;[] classes = helper.getAllPolymorphicEntitiesFromCeiling(clazz, true, useCache);                  </span>
<span class="5925953156034592661" onmouseenter="enter('5925953156034592661');" onmouseout="out('5925953156034592661');" style=""> 780          String[] result = new String[classes.length];                                                             </span>
<span class="-8402235850457988496" onmouseenter="enter('-8402235850457988496');" onmouseout="out('-8402235850457988496');" style=""> 781          for (int i = 0; i &lt; classes.length; i++) {                                                                </span>
<span class="-4624814724789256168" onmouseenter="enter('-4624814724789256168');" onmouseout="out('-4624814724789256168');" style=""> 782              result[i] = classes[i].getName();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 783          }                                                                                                         </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 784          return result;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 785      }                                                                                                             </span>
<span  style=""> 786                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 787      /**                                                                                                           </span>
<span class="-7623474717715637457" onmouseenter="enter('-7623474717715637457');" onmouseout="out('-7623474717715637457');" style=""><abbr title=" 788       * This initially removes all of the product option values that are currently related to the Sku and then re-associates"> 788       * This initially removes all of the product option values that are currently related to the Sku and then re-aðŸ”µ</abbr></span>
<span class="919168598745235587" onmouseenter="enter('919168598745235587');" onmouseout="out('919168598745235587');" style=""> 789       * the {@link ProductOptionValue}s                                                                            </span>
<span class="5381683285013722867" onmouseenter="enter('5381683285013722867');" onmouseout="out('5381683285013722867');" style=""> 790       * @param entity                                                                                              </span>
<span class="-3727775444071594306" onmouseenter="enter('-3727775444071594306');" onmouseout="out('-3727775444071594306');" style=""> 791       * @param adminInstance                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 792       */                                                                                                           </span>
<span class="-5580154930501003130" onmouseenter="enter('-5580154930501003130');" onmouseout="out('-5580154930501003130');" style=""><abbr title=" 793      protected void associateProductOptionValuesToSku(Entity entity, Sku adminInstance, DynamicEntityDao dynamicEntityDao) {"> 793      protected void associateProductOptionValuesToSku(Entity entity, Sku adminInstance, DynamicEntityDao dynamicEntðŸ”µ</abbr></span>
<span class="-2108418430173822456" onmouseenter="enter('-2108418430173822456');" onmouseout="out('-2108418430173822456');" style=""> 794          //Get the list of product option value ids that were selected from the form                               </span>
<span class="1634824265941381194" onmouseenter="enter('1634824265941381194');" onmouseout="out('1634824265941381194');" style=""> 795          List&lt;Long&gt; productOptionValueIds = new ArrayList&lt;&gt;();                                                     </span>
<span class="-1352652314153256295" onmouseenter="enter('-1352652314153256295');" onmouseout="out('-1352652314153256295');" style=""> 796          for (Property property : getProductOptionProperties(entity)) {                                            </span>
<span class="-2394430384756952955" onmouseenter="enter('-2394430384756952955');" onmouseout="out('-2394430384756952955');" style=""> 797              Long propId = Long.parseLong(property.getValue());                                                    </span>
<span class="-4973643473801343364" onmouseenter="enter('-4973643473801343364');" onmouseout="out('-4973643473801343364');" style=""> 798              productOptionValueIds.add(propId);                                                                    </span>
<span class="882791416935144082" onmouseenter="enter('882791416935144082');" onmouseout="out('882791416935144082');" style=""> 799              property.setIsDirty(true);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 800          }                                                                                                         </span>
<span  style=""> 801                                                                                                                    </span>
<span class="5599600967733699964" onmouseenter="enter('5599600967733699964');" onmouseout="out('5599600967733699964');" style=""> 802          // Only process associations if product option value changes came in via the form                         </span>
<span class="-927227770795358535" onmouseenter="enter('-927227770795358535');" onmouseout="out('-927227770795358535');" style=""> 803          if (CollectionUtils.isNotEmpty(productOptionValueIds)) {                                                  </span>
<span class="-836715987756422691" onmouseenter="enter('-836715987756422691');" onmouseout="out('-836715987756422691');" style=""> 804              //remove the current list of product option values from the Sku                                       </span>
<span class="3024457150101065569" onmouseenter="enter('3024457150101065569');" onmouseout="out('3024457150101065569');" style=""> 805              if (adminInstance.getProductOptionValueXrefs().size() &gt; 0) {                                          </span>
<span class="-348971082300775720" onmouseenter="enter('-348971082300775720');" onmouseout="out('-348971082300775720');" style=""><abbr title=" 806                  Iterator&lt;SkuProductOptionValueXref&gt; iterator = adminInstance.getProductOptionValueXrefs().iterator();"> 806                  Iterator&lt;SkuProductOptionValueXref&gt; iterator = adminInstance.getProductOptionValueXrefs().iteratorðŸ”µ</abbr></span>
<span class="977968488612897428" onmouseenter="enter('977968488612897428');" onmouseout="out('977968488612897428');" style=""> 807                  while (iterator.hasNext()) {                                                                      </span>
<span class="296261963919855061" onmouseenter="enter('296261963919855061');" onmouseout="out('296261963919855061');" style=""> 808                      dynamicEntityDao.remove(iterator.next());                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 809                  }                                                                                                 </span>
<span class="-7399149246786578987" onmouseenter="enter('-7399149246786578987');" onmouseout="out('-7399149246786578987');" style=""> 810                  dynamicEntityDao.merge(adminInstance);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 811              }                                                                                                     </span>
<span  style=""> 812                                                                                                                    </span>
<span class="-4534125068586212273" onmouseenter="enter('-4534125068586212273');" onmouseout="out('-4534125068586212273');" style=""> 813              //Associate the product option values from the form with the Sku                                      </span>
<span class="-2263388685273571690" onmouseenter="enter('-2263388685273571690');" onmouseout="out('-2263388685273571690');" style=""> 814              for (Long id : productOptionValueIds) {                                                               </span>
<span class="-1845535430062096532" onmouseenter="enter('-1845535430062096532');" onmouseout="out('-1845535430062096532');" style=""> 815                  //Simply find the changed ProductOptionValues directly - seems to work better with sandboxing code</span>
<span class="-2351207014655688291" onmouseenter="enter('-2351207014655688291');" onmouseout="out('-2351207014655688291');" style=""><abbr title=" 816                  ProductOptionValue pov = (ProductOptionValue) dynamicEntityDao.find(ProductOptionValueImpl.class, id);"> 816                  ProductOptionValue pov = (ProductOptionValue) dynamicEntityDao.find(ProductOptionValueImpl.class, ðŸ”µ</abbr></span>
<span class="6521746250086557424" onmouseenter="enter('6521746250086557424');" onmouseout="out('6521746250086557424');" style=""> 817                  SkuProductOptionValueXref xref = new SkuProductOptionValueXrefImpl(adminInstance, pov);           </span>
<span class="-8084022359180624494" onmouseenter="enter('-8084022359180624494');" onmouseout="out('-8084022359180624494');" style=""> 818                  xref = dynamicEntityDao.merge(xref);                                                              </span>
<span class="-4176466516175169486" onmouseenter="enter('-4176466516175169486');" onmouseout="out('-4176466516175169486');" style=""> 819                  adminInstance.getProductOptionValueXrefs().add(xref);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 820              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 821          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 822      }                                                                                                             </span>
<span  style=""> 823                                                                                                                    </span>
<span class="-7856904959937096406" onmouseenter="enter('-7856904959937096406');" onmouseout="out('-7856904959937096406');" style=""> 824      protected List&lt;Property&gt; getProductOptionProperties(Entity entity) {                                          </span>
<span class="-8583115342580003925" onmouseenter="enter('-8583115342580003925');" onmouseout="out('-8583115342580003925');" style=""> 825          List&lt;Property&gt; productOptionProperties = new ArrayList&lt;&gt;();                                               </span>
<span class="-5346955267205588229" onmouseenter="enter('-5346955267205588229');" onmouseout="out('-5346955267205588229');" style=""> 826          for (Property property : entity.getProperties()) {                                                        </span>
<span class="-4364715296212150710" onmouseenter="enter('-4364715296212150710');" onmouseout="out('-4364715296212150710');" style=""> 827              if (property.getName().startsWith(PRODUCT_OPTION_FIELD_PREFIX)) {                                     </span>
<span class="4660153000567545168" onmouseenter="enter('4660153000567545168');" onmouseout="out('4660153000567545168');" style=""> 828                  productOptionProperties.add(property);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 829              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 830          }                                                                                                         </span>
<span class="-7955791568854160092" onmouseenter="enter('-7955791568854160092');" onmouseout="out('-7955791568854160092');" style=""> 831          return productOptionProperties;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 832      }                                                                                                             </span>
<span  style=""> 833                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 834      /**                                                                                                           </span>
<span class="1365192302683773708" onmouseenter="enter('1365192302683773708');" onmouseout="out('1365192302683773708');" style=""> 835       * Ensures that the given list of {@link ProductOptionValue} IDs is unique for the given {@link Product}.     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 836       *                                                                                                            </span>
<span class="181270108197628031" onmouseenter="enter('181270108197628031');" onmouseout="out('181270108197628031');" style=""> 837       * If sku browsing is enabled, then it is assumed that a single combination of {@link ProductOptionValue} IDs </span>
<span class="-9042834622684422857" onmouseenter="enter('-9042834622684422857');" onmouseout="out('-9042834622684422857');" style=""><abbr title=" 838       * is not unique and more than one {@link Sku} could have the exact same combination of {@link ProductOptionValue} IDs."> 838       * is not unique and more than one {@link Sku} could have the exact same combination of {@link ProductOptionVaðŸ”µ</abbr></span>
<span class="8880319067663877918" onmouseenter="enter('8880319067663877918');" onmouseout="out('8880319067663877918');" style=""> 839       * In this case, the following validation is skipped.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 840       *                                                                                                            </span>
<span class="-1391920893822957351" onmouseenter="enter('-1391920893822957351');" onmouseout="out('-1391920893822957351');" style=""> 841       * @param product                                                                                             </span>
<span class="-5594036901015815590" onmouseenter="enter('-5594036901015815590');" onmouseout="out('-5594036901015815590');" style=""> 842       * @param productOptionProperties                                                                             </span>
<span class="-6460801320187933305" onmouseenter="enter('-6460801320187933305');" onmouseout="out('-6460801320187933305');" style=""><abbr title=" 843       * @param currentSku - for update operations, this is the current Sku that is being updated; should be excluded from"> 843       * @param currentSku - for update operations, this is the current Sku that is being updated; should be excludeðŸ”µ</abbr></span>
<span class="-9039397817177530475" onmouseenter="enter('-9039397817177530475');" onmouseout="out('-9039397817177530475');" style=""> 844       * attempting validation                                                                                      </span>
<span class="3147013888049433291" onmouseenter="enter('3147013888049433291');" onmouseout="out('3147013888049433291');" style=""> 845       * @return &lt;b&gt;null&lt;/b&gt; if successfully validation, the error entity otherwise                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 846       */                                                                                                           </span>
<span class="4098410267680721468" onmouseenter="enter('4098410267680721468');" onmouseout="out('4098410267680721468');" style=""><abbr title=" 847      protected Entity validateUniqueProductOptionValueCombination(Product product, List&lt;Property&gt; productOptionProperties, Sku currentSku) {"> 847      protected Entity validateUniqueProductOptionValueCombination(Product product, List&lt;Property&gt; productOptionPropðŸ”µ</abbr></span>
<span class="4942377315120176487" onmouseenter="enter('4942377315120176487');" onmouseout="out('4942377315120176487');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 848 -        if(useSku) {                                                                                              </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 849 -            return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 850 -        }                                                                                                         </span>
<span class="-5247886246871174474" onmouseenter="enter('-5247886246871174474');" onmouseout="out('-5247886246871174474');" style=""> 851          //do not attempt POV validation if no PO properties were passed in                                        </span>
<span class="3871558701454434845" onmouseenter="enter('3871558701454434845');" onmouseout="out('3871558701454434845');" style=""> 852          if (CollectionUtils.isNotEmpty(productOptionProperties)) {                                                </span>
<span class="1634824265941381194" onmouseenter="enter('1634824265941381194');" onmouseout="out('1634824265941381194');" style=""> 853              List&lt;Long&gt; productOptionValueIds = new ArrayList&lt;&gt;();                                                 </span>
<span class="-3576685812737207515" onmouseenter="enter('-3576685812737207515');" onmouseout="out('-3576685812737207515');" style=""> 854              for (Property property : productOptionProperties) {                                                   </span>
<span class="-2118064041595259984" onmouseenter="enter('-2118064041595259984');" onmouseout="out('-2118064041595259984');" style=""> 855                  productOptionValueIds.add(Long.parseLong(property.getValue()));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 856              }                                                                                                     </span>
<span  style=""> 857                                                                                                                    </span>
<span class="-2493564654197817042" onmouseenter="enter('-2493564654197817042');" onmouseout="out('-2493564654197817042');" style=""> 858              boolean validated = true;                                                                             </span>
<span class="7949927824524618864" onmouseenter="enter('7949927824524618864');" onmouseout="out('7949927824524618864');" style=""> 859              for (Sku sku : product.getAdditionalSkus()) {                                                         </span>
<span class="2891953471366425035" onmouseenter="enter('2891953471366425035');" onmouseout="out('2891953471366425035');" style=""> 860                  if (currentSku == null || !sku.getId().equals(currentSku.getId())) {                              </span>
<span class="-3952558990885951835" onmouseenter="enter('-3952558990885951835');" onmouseout="out('-3952558990885951835');" style=""> 861                      List&lt;Long&gt; testList = new ArrayList&lt;&gt;();                                                      </span>
<span class="-7407157514043427301" onmouseenter="enter('-7407157514043427301');" onmouseout="out('-7407157514043427301');" style=""> 862                      for (ProductOptionValue optionValue : sku.getProductOptionValues()) {                         </span>
<span class="261748784534089861" onmouseenter="enter('261748784534089861');" onmouseout="out('261748784534089861');" style=""> 863                          testList.add(optionValue.getId());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 864                      }                                                                                             </span>
<span  style=""> 865                                                                                                                    </span>
<span class="-5224728573656644718" onmouseenter="enter('-5224728573656644718');" onmouseout="out('-5224728573656644718');" style=""> 866                      if (CollectionUtils.isNotEmpty(testList) &amp;&amp;                                                   </span>
<span class="-8535753245269677627" onmouseenter="enter('-8535753245269677627');" onmouseout="out('-8535753245269677627');" style=""> 867                              productOptionValueIds.containsAll(testList) &amp;&amp;                                        </span>
<span class="4715989752758376255" onmouseenter="enter('4715989752758376255');" onmouseout="out('4715989752758376255');" style=""> 868                              productOptionValueIds.size() == testList.size()) {                                    </span>
<span class="6265709580977530731" onmouseenter="enter('6265709580977530731');" onmouseout="out('6265709580977530731');" style=""> 869                          validated = false;                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 870                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 871                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 872                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 873              }                                                                                                     </span>
<span  style=""> 874                                                                                                                    </span>
<span class="5370947014016399578" onmouseenter="enter('5370947014016399578');" onmouseout="out('5370947014016399578');" style=""> 875              if (!validated) {                                                                                     </span>
<span class="605992171615497910" onmouseenter="enter('605992171615497910');" onmouseout="out('605992171615497910');" style=""> 876                  Entity errorEntity = new Entity();                                                                </span>
<span class="4071390277457465045" onmouseenter="enter('4071390277457465045');" onmouseout="out('4071390277457465045');" style=""> 877                  for (Property productOptionProperty : productOptionProperties) {                                  </span>
<span class="-3018953048999428832" onmouseenter="enter('-3018953048999428832');" onmouseout="out('-3018953048999428832');" style=""> 878                      errorEntity.addValidationError(productOptionProperty.getName(), &quot;uniqueSkuError&quot;);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 879                  }                                                                                                 </span>
<span class="-5923031647519224540" onmouseenter="enter('-5923031647519224540');" onmouseout="out('-5923031647519224540');" style=""> 880                  return errorEntity;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 881              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 882          }                                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 883          return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 884      }                                                                                                             </span>
<span  style=""> 885                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 886  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-1249558187989023334" onmouseenter="enter('-1249558187989023334');" onmouseout="out('-1249558187989023334');" style="">   3   * BroadleafCommerce Admin Module                                                                                 </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span class="3565305863144860564" onmouseenter="enter('3565305863144860564');" onmouseout="out('3565305863144860564');" style="">  19  package org.broadleafcommerce.admin.server.service.handler;                                                       </span>
<span  style="">  20                                                                                                                    </span>
<span class="-5484142805323860658" onmouseenter="enter('-5484142805323860658');" onmouseout="out('-5484142805323860658');" style="">  21  import static com.google.common.base.CharMatcher.DIGIT;                                                           </span>
<span  style="">  22                                                                                                                    </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  23  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="2953846583056246827" onmouseenter="enter('2953846583056246827');" onmouseout="out('2953846583056246827');" style="">  24  import org.apache.commons.collections.Transformer;                                                                </span>
<span class="-4661043417888464228" onmouseenter="enter('-4661043417888464228');" onmouseout="out('-4661043417888464228');" style="">  25  import org.apache.commons.lang.BooleanUtils;                                                                      </span>
<span class="2359514128542055982" onmouseenter="enter('2359514128542055982');" onmouseout="out('2359514128542055982');" style="">  26  import org.apache.commons.lang3.ArrayUtils;                                                                       </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  27  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="-6922428965258674124" onmouseenter="enter('-6922428965258674124');" onmouseout="out('-6922428965258674124');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  28 +import org.apache.commons.lang3.math.NumberUtils;                                                                 </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  29  import org.apache.commons.logging.Log;                                                                            </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  30  import org.apache.commons.logging.LogFactory;                                                                     </span>
<span class="5500044680393520896" onmouseenter="enter('5500044680393520896');" onmouseout="out('5500044680393520896');" style="">  31  import org.broadleafcommerce.admin.server.service.SkuMetadataCacheService;                                        </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  32  import org.broadleafcommerce.common.exception.ServiceException;                                                   </span>
<span class="-2413957740330241600" onmouseenter="enter('-2413957740330241600');" onmouseout="out('-2413957740330241600');" style="">  33  import org.broadleafcommerce.common.presentation.client.LookupType;                                               </span>
<span class="-212317658512913375" onmouseenter="enter('-212317658512913375');" onmouseout="out('-212317658512913375');" style="">  34  import org.broadleafcommerce.common.presentation.client.OperationType;                                            </span>
<span class="7296089998360266547" onmouseenter="enter('7296089998360266547');" onmouseout="out('7296089998360266547');" style="">  35  import org.broadleafcommerce.common.presentation.client.PersistencePerspectiveItemType;                           </span>
<span class="1362364260528215152" onmouseenter="enter('1362364260528215152');" onmouseout="out('1362364260528215152');" style="">  36  import org.broadleafcommerce.common.presentation.client.SupportedFieldType;                                       </span>
<span class="-7583443881845767348" onmouseenter="enter('-7583443881845767348');" onmouseout="out('-7583443881845767348');" style="">  37  import org.broadleafcommerce.common.presentation.client.VisibilityEnum;                                           </span>
<span class="-2818686525334833130" onmouseenter="enter('-2818686525334833130');" onmouseout="out('-2818686525334833130');" style="">  38  import org.broadleafcommerce.common.sandbox.SandBoxHelper;                                                        </span>
<span class="-3909806959928975034" onmouseenter="enter('-3909806959928975034');" onmouseout="out('-3909806959928975034');" style="">  39  import org.broadleafcommerce.common.util.BLCCollectionUtils;                                                      </span>
<span class="-3347161074136237116" onmouseenter="enter('-3347161074136237116');" onmouseout="out('-3347161074136237116');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  40 +import org.broadleafcommerce.common.util.StringUtil;                                                              </span>
<span class="-8028747938757529269" onmouseenter="enter('-8028747938757529269');" onmouseout="out('-8028747938757529269');" style="">  41  import org.broadleafcommerce.common.util.TypedTransformer;                                                        </span>
<span class="2901117953480421393" onmouseenter="enter('2901117953480421393');" onmouseout="out('2901117953480421393');" style="">  42  import org.broadleafcommerce.common.util.dao.DynamicDaoHelperImpl;                                                </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  43  import org.broadleafcommerce.core.catalog.domain.Product;                                                         </span>
<span class="8587718080948629089" onmouseenter="enter('8587718080948629089');" onmouseout="out('8587718080948629089');" style="">  44  import org.broadleafcommerce.core.catalog.domain.ProductBundle;                                                   </span>
<span class="-85811185251521902" onmouseenter="enter('-85811185251521902');" onmouseout="out('-85811185251521902');" style="">  45  import org.broadleafcommerce.core.catalog.domain.ProductImpl;                                                     </span>
<span class="6224071758335975205" onmouseenter="enter('6224071758335975205');" onmouseout="out('6224071758335975205');" style="">  46  import org.broadleafcommerce.core.catalog.domain.ProductOption;                                                   </span>
<span class="-6385470104782105538" onmouseenter="enter('-6385470104782105538');" onmouseout="out('-6385470104782105538');" style="">  47  import org.broadleafcommerce.core.catalog.domain.ProductOptionImpl;                                               </span>
<span class="-7937345987210941259" onmouseenter="enter('-7937345987210941259');" onmouseout="out('-7937345987210941259');" style="">  48  import org.broadleafcommerce.core.catalog.domain.ProductOptionValue;                                              </span>
<span class="7369709806901157478" onmouseenter="enter('7369709806901157478');" onmouseout="out('7369709806901157478');" style="">  49  import org.broadleafcommerce.core.catalog.domain.ProductOptionValueImpl;                                          </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  50  import org.broadleafcommerce.core.catalog.domain.Sku;                                                             </span>
<span class="1181568146405964825" onmouseenter="enter('1181568146405964825');" onmouseout="out('1181568146405964825');" style="">  51  import org.broadleafcommerce.core.catalog.domain.SkuImpl;                                                         </span>
<span class="688919036808372243" onmouseenter="enter('688919036808372243');" onmouseout="out('688919036808372243');" style="">  52  import org.broadleafcommerce.core.catalog.domain.SkuProductOptionValueXref;                                       </span>
<span class="-3196712195758579658" onmouseenter="enter('-3196712195758579658');" onmouseout="out('-3196712195758579658');" style="">  53  import org.broadleafcommerce.core.catalog.domain.SkuProductOptionValueXrefImpl;                                   </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  54  import org.broadleafcommerce.core.catalog.service.CatalogService;                                                 </span>
<span class="4427537537958608766" onmouseenter="enter('4427537537958608766');" onmouseout="out('4427537537958608766');" style="">  55  import org.broadleafcommerce.openadmin.dto.BasicFieldMetadata;                                                    </span>
<span class="-1607559599739253077" onmouseenter="enter('-1607559599739253077');" onmouseout="out('-1607559599739253077');" style="">  56  import org.broadleafcommerce.openadmin.dto.ClassMetadata;                                                         </span>
<span class="-8970007776478821592" onmouseenter="enter('-8970007776478821592');" onmouseout="out('-8970007776478821592');" style="">  57  import org.broadleafcommerce.openadmin.dto.CriteriaTransferObject;                                                </span>
<span class="-4742435063138209714" onmouseenter="enter('-4742435063138209714');" onmouseout="out('-4742435063138209714');" style="">  58  import org.broadleafcommerce.openadmin.dto.DynamicResultSet;                                                      </span>
<span class="-5093421835888664541" onmouseenter="enter('-5093421835888664541');" onmouseout="out('-5093421835888664541');" style="">  59  import org.broadleafcommerce.openadmin.dto.Entity;                                                                </span>
<span class="-8829499667991596741" onmouseenter="enter('-8829499667991596741');" onmouseout="out('-8829499667991596741');" style="">  60  import org.broadleafcommerce.openadmin.dto.FieldMetadata;                                                         </span>
<span class="6369021917986026789" onmouseenter="enter('6369021917986026789');" onmouseout="out('6369021917986026789');" style="">  61  import org.broadleafcommerce.openadmin.dto.FilterAndSortCriteria;                                                 </span>
<span class="7333603239996951733" onmouseenter="enter('7333603239996951733');" onmouseout="out('7333603239996951733');" style="">  62  import org.broadleafcommerce.openadmin.dto.MergedPropertyType;                                                    </span>
<span class="5387066876064049952" onmouseenter="enter('5387066876064049952');" onmouseout="out('5387066876064049952');" style="">  63  import org.broadleafcommerce.openadmin.dto.PersistencePackage;                                                    </span>
<span class="8079401142601162613" onmouseenter="enter('8079401142601162613');" onmouseout="out('8079401142601162613');" style="">  64  import org.broadleafcommerce.openadmin.dto.PersistencePerspective;                                                </span>
<span class="1983554291461039357" onmouseenter="enter('1983554291461039357');" onmouseout="out('1983554291461039357');" style="">  65  import org.broadleafcommerce.openadmin.dto.Property;                                                              </span>
<span class="1696571253156436279" onmouseenter="enter('1696571253156436279');" onmouseout="out('1696571253156436279');" style="">  66  import org.broadleafcommerce.openadmin.dto.SectionCrumb;                                                          </span>
<span class="-8828889589519173652" onmouseenter="enter('-8828889589519173652');" onmouseout="out('-8828889589519173652');" style="">  67  import org.broadleafcommerce.openadmin.server.dao.DynamicEntityDao;                                               </span>
<span class="-9217168395336380631" onmouseenter="enter('-9217168395336380631');" onmouseout="out('-9217168395336380631');" style="">  68  import org.broadleafcommerce.openadmin.server.service.handler.CustomPersistenceHandlerAdapter;                    </span>
<span class="-1454726158681359973" onmouseenter="enter('-1454726158681359973');" onmouseout="out('-1454726158681359973');" style="">  69  import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceManager;                             </span>
<span class="97669409268306845" onmouseenter="enter('97669409268306845');" onmouseout="out('97669409268306845');" style="">  70  import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceManagerFactory;                      </span>
<span class="-9205099315907051841" onmouseenter="enter('-9205099315907051841');" onmouseout="out('-9205099315907051841');" style="">  71  import org.broadleafcommerce.openadmin.server.service.persistence.module.InspectHelper;                           </span>
<span class="8253709771214222101" onmouseenter="enter('8253709771214222101');" onmouseout="out('8253709771214222101');" style="">  72  import org.broadleafcommerce.openadmin.server.service.persistence.module.PersistenceModule;                       </span>
<span class="5407139061354632707" onmouseenter="enter('5407139061354632707');" onmouseout="out('5407139061354632707');" style="">  73  import org.broadleafcommerce.openadmin.server.service.persistence.module.RecordHelper;                            </span>
<span class="-4125327013079009203" onmouseenter="enter('-4125327013079009203');" onmouseout="out('-4125327013079009203');" style="">  74  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.CriteriaTranslator;             </span>
<span class="7637154476457570035" onmouseenter="enter('7637154476457570035');" onmouseout="out('7637154476457570035');" style="">  75  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPath;                      </span>
<span class="1663650800150084878" onmouseenter="enter('1663650800150084878');" onmouseout="out('1663650800150084878');" style="">  76  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPathBuilder;               </span>
<span class="7520439988643323618" onmouseenter="enter('7520439988643323618');" onmouseout="out('7520439988643323618');" style="">  77  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FilterMapping;                  </span>
<span class="-8754722050104399052" onmouseenter="enter('-8754722050104399052');" onmouseout="out('-8754722050104399052');" style="">  78  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.Restriction;                    </span>
<span class="2225343043491731861" onmouseenter="enter('2225343043491731861');" onmouseout="out('2225343043491731861');" style="">  79  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.predicate.PredicateProvider;    </span>
<span class="-582519941885656893" onmouseenter="enter('-582519941885656893');" onmouseout="out('-582519941885656893');" style="">  80  import org.hibernate.ejb.HibernateEntityManager;                                                                  </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  81  import org.springframework.beans.factory.annotation.Value;                                                        </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  82  import org.springframework.stereotype.Component;                                                                  </span>

<span class="5998602906817463685" onmouseenter="enter('5998602906817463685');" onmouseout="out('5998602906817463685');" style="">  83  import java.io.Serializable;                                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  84  import java.util.ArrayList;                                                                                       </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  85  import java.util.Arrays;                                                                                          </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  86  import java.util.Collection;                                                                                      </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  87  import java.util.Collections;                                                                                     </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  88  import java.util.HashMap;                                                                                         </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  89  import java.util.Iterator;                                                                                        </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  90  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  91  import java.util.Map;                                                                                             </span>

<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  92  import javax.annotation.Resource;                                                                                 </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  93  import javax.persistence.EntityManager;                                                                           </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  94  import javax.persistence.PersistenceContext;                                                                      </span>
<span class="6539032290250175619" onmouseenter="enter('6539032290250175619');" onmouseout="out('6539032290250175619');" style="">  95  import javax.persistence.TypedQuery;                                                                              </span>
<span class="8485852916582699615" onmouseenter="enter('8485852916582699615');" onmouseout="out('8485852916582699615');" style="">  96  import javax.persistence.criteria.CriteriaBuilder;                                                                </span>
<span class="2535099540501772744" onmouseenter="enter('2535099540501772744');" onmouseout="out('2535099540501772744');" style="">  97  import javax.persistence.criteria.From;                                                                           </span>
<span class="5773424155764142692" onmouseenter="enter('5773424155764142692');" onmouseout="out('5773424155764142692');" style="">  98  import javax.persistence.criteria.Path;                                                                           </span>
<span class="7244103982108254428" onmouseenter="enter('7244103982108254428');" onmouseout="out('7244103982108254428');" style="">  99  import javax.persistence.criteria.Predicate;                                                                      </span>
<span  style=""> 100                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 101  /**                                                                                                               </span>
<span class="-2581105714976122669" onmouseenter="enter('-2581105714976122669');" onmouseout="out('-2581105714976122669');" style=""> 102   * @author Phillip Verheyden                                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 103   *                                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 104   */                                                                                                               </span>
<span class="-4061322517816489282" onmouseenter="enter('-4061322517816489282');" onmouseout="out('-4061322517816489282');" style=""> 105  @Component(&quot;blSkuCustomPersistenceHandler&quot;)                                                                       </span>
<span class="-1865408177148521742" onmouseenter="enter('-1865408177148521742');" onmouseout="out('-1865408177148521742');" style=""> 106  public class SkuCustomPersistenceHandler extends CustomPersistenceHandlerAdapter {                                </span>
<span  style=""> 107                                                                                                                    </span>
<span class="-8713958385326184455" onmouseenter="enter('-8713958385326184455');" onmouseout="out('-8713958385326184455');" style=""> 108      private static final Log LOG = LogFactory.getLog(SkuCustomPersistenceHandler.class);                          </span>
<span  style=""> 109                                                                                                                    </span>
<span class="363907699147620123" onmouseenter="enter('363907699147620123');" onmouseout="out('363907699147620123');" style=""> 110      public static String PRODUCT_OPTION_FIELD_PREFIX = &quot;productOption&quot;;                                           </span>
<span class="5644485626870470186" onmouseenter="enter('5644485626870470186');" onmouseout="out('5644485626870470186');" style=""> 111      public static String INVENTORY_ONLY_CRITERIA = &quot;onlyInventoryProperties&quot;;                                     </span>
<span  style=""> 112                                                                                                                    </span>
<span  style=""> 113                                                                                                                    </span>
<span class="-7778680861452564194" onmouseenter="enter('-7778680861452564194');" onmouseout="out('-7778680861452564194');" style=""> 114      @Value(&quot;${solr.index.use.sku}&quot;)                                                                               </span>
<span class="4533755734414020763" onmouseenter="enter('4533755734414020763');" onmouseout="out('4533755734414020763');" style=""> 115      protected boolean useSku;                                                                                     </span>
<span  style=""> 116                                                                                                                    </span>
<span class="-4251425677142148253" onmouseenter="enter('-4251425677142148253');" onmouseout="out('-4251425677142148253');" style=""> 117      @Value(&quot;${use.to.one.lookup.sku.product.option.value:false}&quot;)                                                 </span>
<span class="6110895124324481806" onmouseenter="enter('6110895124324481806');" onmouseout="out('6110895124324481806');" style=""> 118      protected boolean useToOneLookupSkuProductOptionValue = false;                                                </span>
<span  style=""> 119                                                                                                                    </span>
<span class="-7681629157280888116" onmouseenter="enter('-7681629157280888116');" onmouseout="out('-7681629157280888116');" style=""> 120      @Resource(name =&quot;blSkuMetadataCacheService&quot;)                                                                  </span>
<span class="5822417842178589229" onmouseenter="enter('5822417842178589229');" onmouseout="out('5822417842178589229');" style=""> 121      protected SkuMetadataCacheService skuMetadataCacheService;                                                    </span>
<span  style=""> 122                                                                                                                    </span>
<span class="8317365465805033193" onmouseenter="enter('8317365465805033193');" onmouseout="out('8317365465805033193');" style=""> 123      @Resource(name=&quot;blAdornedTargetListPersistenceModule&quot;)                                                        </span>
<span class="878998746675668437" onmouseenter="enter('878998746675668437');" onmouseout="out('878998746675668437');" style=""> 124      protected PersistenceModule adornedPersistenceModule;                                                         </span>
<span  style=""> 125                                                                                                                    </span>
<span class="-7011722868621328349" onmouseenter="enter('-7011722868621328349');" onmouseout="out('-7011722868621328349');" style=""> 126      @Resource(name = &quot;blSkuCustomPersistenceHandlerExtensionManager&quot;)                                             </span>
<span class="-9007673134867108683" onmouseenter="enter('-9007673134867108683');" onmouseout="out('-9007673134867108683');" style=""> 127      protected SkuCustomPersistenceHandlerExtensionManager extensionManager;                                       </span>
<span  style=""> 128                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 129      /**                                                                                                           </span>
<span class="4136366527029974243" onmouseenter="enter('4136366527029974243');" onmouseout="out('4136366527029974243');" style=""><abbr title=" 130       * This represents the field that all of the product option values will be stored in. This would be used in the case"> 130       * This represents the field that all of the product option values will be stored in. This would be used in thðŸ”µ</abbr></span>
<span class="6047944382158863307" onmouseenter="enter('6047944382158863307');" onmouseout="out('6047944382158863307');" style=""><abbr title=" 131       * where there are a bunch of product options and displaying each option as a grid header would have everything"> 131       * where there are a bunch of product options and displaying each option as a grid header would have everythinðŸ”µ</abbr></span>
<span class="-3054662628739130883" onmouseenter="enter('-3054662628739130883');" onmouseout="out('-3054662628739130883');" style=""> 132       * squashed together. Filtering on this field is currently unsupported.                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 133       */                                                                                                           </span>
<span class="5445041667615320295" onmouseenter="enter('5445041667615320295');" onmouseout="out('5445041667615320295');" style=""> 134      public static String CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME = &quot;consolidatedProductOptions&quot;;                  </span>
<span class="-2903820884082764399" onmouseenter="enter('-2903820884082764399');" onmouseout="out('-2903820884082764399');" style=""> 135      public static String CONSOLIDATED_PRODUCT_OPTIONS_DELIMETER = &quot;; &quot;;                                           </span>
<span  style=""> 136                                                                                                                    </span>
<span class="5554818697985539506" onmouseenter="enter('5554818697985539506');" onmouseout="out('5554818697985539506');" style=""> 137      @Resource(name=&quot;blCatalogService&quot;)                                                                            </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style=""> 138      protected CatalogService catalogService;                                                                      </span>
<span  style=""> 139                                                                                                                    </span>
<span class="5710637357667853932" onmouseenter="enter('5710637357667853932');" onmouseout="out('5710637357667853932');" style=""> 140      @PersistenceContext(unitName = &quot;blPU&quot;)                                                                        </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style=""> 141      protected EntityManager em;                                                                                   </span>
<span  style=""> 142                                                                                                                    </span>
<span class="-2696154002193407400" onmouseenter="enter('-2696154002193407400');" onmouseout="out('-2696154002193407400');" style=""> 143      @Resource(name = &quot;blCriteriaTranslator&quot;)                                                                      </span>
<span class="6548648040486234931" onmouseenter="enter('6548648040486234931');" onmouseout="out('6548648040486234931');" style=""> 144      protected CriteriaTranslator criteriaTranslator;                                                              </span>
<span  style=""> 145                                                                                                                    </span>
<span class="-3946461589801993391" onmouseenter="enter('-3946461589801993391');" onmouseout="out('-3946461589801993391');" style=""> 146      @Resource(name = &quot;blSandBoxHelper&quot;)                                                                           </span>
<span class="-7799183597372200632" onmouseenter="enter('-7799183597372200632');" onmouseout="out('-7799183597372200632');" style=""> 147      protected SandBoxHelper sandBoxHelper;                                                                        </span>
<span  style=""> 148                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 149      @Override                                                                                                     </span>
<span class="998850855763553690" onmouseenter="enter('998850855763553690');" onmouseout="out('998850855763553690');" style=""> 150      public Boolean canHandleInspect(PersistencePackage persistencePackage) {                                      </span>
<span class="-5823917578938895674" onmouseenter="enter('-5823917578938895674');" onmouseout="out('-5823917578938895674');" style=""> 151          return canHandle(persistencePackage, persistencePackage.getPersistencePerspective().getOperationTypes()   </span>
<span class="9015299385431722883" onmouseenter="enter('9015299385431722883');" onmouseout="out('9015299385431722883');" style=""> 152                  .getInspectType());                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 153      }                                                                                                             </span>
<span  style=""> 154                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 155      @Override                                                                                                     </span>
<span class="-8556163469002491307" onmouseenter="enter('-8556163469002491307');" onmouseout="out('-8556163469002491307');" style=""> 156      public Boolean canHandleFetch(PersistencePackage persistencePackage) {                                        </span>
<span class="10418940480604143" onmouseenter="enter('10418940480604143');" onmouseout="out('10418940480604143');" style=""><abbr title=" 157          OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFetchType();"> 157          OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFetchType(ðŸ”µ</abbr></span>
<span class="8754300242813385255" onmouseenter="enter('8754300242813385255');" onmouseout="out('8754300242813385255');" style=""> 158          return canHandle(persistencePackage, fetchType);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159      }                                                                                                             </span>
<span  style=""> 160                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 161      @Override                                                                                                     </span>
<span class="1712661648493993457" onmouseenter="enter('1712661648493993457');" onmouseout="out('1712661648493993457');" style=""> 162      public Boolean canHandleAdd(PersistencePackage persistencePackage) {                                          </span>
<span class="-5221489961679899774" onmouseenter="enter('-5221489961679899774');" onmouseout="out('-5221489961679899774');" style=""> 163          OperationType addType = persistencePackage.getPersistencePerspective().getOperationTypes().getAddType();  </span>
<span class="1238914713862050599" onmouseenter="enter('1238914713862050599');" onmouseout="out('1238914713862050599');" style=""> 164          return canHandle(persistencePackage, addType);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165      }                                                                                                             </span>
<span  style=""> 166                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 167      @Override                                                                                                     </span>
<span class="5315207923223107799" onmouseenter="enter('5315207923223107799');" onmouseout="out('5315207923223107799');" style=""> 168      public Boolean canHandleUpdate(PersistencePackage persistencePackage) {                                       </span>
<span class="8318706485461606240" onmouseenter="enter('8318706485461606240');" onmouseout="out('8318706485461606240');" style=""><abbr title=" 169          OperationType updateType = persistencePackage.getPersistencePerspective().getOperationTypes().getUpdateType();"> 169          OperationType updateType = persistencePackage.getPersistencePerspective().getOperationTypes().getUpdateTypðŸ”µ</abbr></span>
<span class="7628662592758046218" onmouseenter="enter('7628662592758046218');" onmouseout="out('7628662592758046218');" style=""> 170          return canHandle(persistencePackage, updateType);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171      }                                                                                                             </span>
<span  style=""> 172                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 173      /**                                                                                                           </span>
<span class="6990985093790140011" onmouseenter="enter('6990985093790140011');" onmouseout="out('6990985093790140011');" style=""> 174       * Since this is the default for all Skus, it&#x27;s possible that we are providing custom criteria for this       </span>
<span class="-7639041005907295879" onmouseenter="enter('-7639041005907295879');" onmouseout="out('-7639041005907295879');" style=""> 175       * Sku lookup. In that case, we probably want to delegate to a child class, so only use this particular       </span>
<span class="3567117971388930965" onmouseenter="enter('3567117971388930965');" onmouseout="out('3567117971388930965');" style=""><abbr title=" 176       * persistence handler if there is no custom criteria being used and the ceiling entity is an instance of Sku. The"> 176       * persistence handler if there is no custom criteria being used and the ceiling entity is an instance of Sku.ðŸ”µ</abbr></span>
<span class="-9191698445538453171" onmouseenter="enter('-9191698445538453171');" onmouseout="out('-9191698445538453171');" style=""><abbr title=" 177       * exception to this rule is when we are pulling back Media, since the admin actually uses Sku for the ceiling entity"> 177       * exception to this rule is when we are pulling back Media, since the admin actually uses Sku for the ceilingðŸ”µ</abbr></span>
<span class="1646505885713320498" onmouseenter="enter('1646505885713320498');" onmouseout="out('1646505885713320498');" style=""><abbr title=" 178       * class name. That should be handled by the map structure module though, so only handle things in the Sku custom"> 178       * class name. That should be handled by the map structure module though, so only handle things in the Sku cusðŸ”µ</abbr></span>
<span class="-3435293659936443508" onmouseenter="enter('-3435293659936443508');" onmouseout="out('-3435293659936443508');" style=""> 179       * persistence handler for OperationType.BASIC                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 180       *                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 181       */                                                                                                           </span>
<span class="-401224984339352861" onmouseenter="enter('-401224984339352861');" onmouseout="out('-401224984339352861');" style=""> 182      protected Boolean canHandle(PersistencePackage persistencePackage, OperationType operationType) {             </span>
<span class="2519389108374285224" onmouseenter="enter('2519389108374285224');" onmouseout="out('2519389108374285224');" style=""><abbr title=" 183          String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname();"> 183          String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname()ðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 184          try {                                                                                                     </span>
<span class="3859607212114051755" onmouseenter="enter('3859607212114051755');" onmouseout="out('3859607212114051755');" style=""> 185              Class testClass = Class.forName(ceilingEntityFullyQualifiedClassname);                                </span>
<span class="-6258271003107251148" onmouseenter="enter('-6258271003107251148');" onmouseout="out('-6258271003107251148');" style=""> 186              return Sku.class.isAssignableFrom(testClass) &amp;&amp;                                                       </span>
<span class="6374297613382618653" onmouseenter="enter('6374297613382618653');" onmouseout="out('6374297613382618653');" style=""> 187                      //ArrayUtils.isEmpty(persistencePackage.getCustomCriteria()) &amp;&amp;                               </span>
<span class="-7558498583587542431" onmouseenter="enter('-7558498583587542431');" onmouseout="out('-7558498583587542431');" style=""> 188                      OperationType.BASIC.equals(operationType) &amp;&amp;                                                  </span>
<span class="-2045231318111877972" onmouseenter="enter('-2045231318111877972');" onmouseout="out('-2045231318111877972');" style=""><abbr title=" 189                      (persistencePackage.getPersistencePerspective().getPersistencePerspectiveItems().get(PersistencePerspectiveItemType.ADORNEDTARGETLIST) == null);"> 189                      (persistencePackage.getPersistencePerspective().getPersistencePerspectiveItems().get(PersistenðŸ”µ</abbr></span>
<span class="1054888787890391626" onmouseenter="enter('1054888787890391626');" onmouseout="out('1054888787890391626');" style=""> 190          } catch (ClassNotFoundException e) {                                                                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 191              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193      }                                                                                                             </span>
<span  style=""> 194                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 195      /**                                                                                                           </span>
<span class="330022396980695391" onmouseenter="enter('330022396980695391');" onmouseout="out('330022396980695391');" style=""> 196       * Build out the extra fields for the product options                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 197       */                                                                                                           </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 198      @Override                                                                                                     </span>
<span class="4696212939538128393" onmouseenter="enter('4696212939538128393');" onmouseout="out('4696212939538128393');" style=""><abbr title=" 199      public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, InspectHelper helper) throws ServiceException {"> 199      public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, InspðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 200          try {                                                                                                     </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""> 201              PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();       </span>
<span class="5084133214681633572" onmouseenter="enter('5084133214681633572');" onmouseout="out('5084133214681633572');" style=""> 202              Map&lt;MergedPropertyType, Map&lt;String, FieldMetadata&gt;&gt; allMergedProperties = new HashMap&lt;&gt;();            </span>
<span  style=""> 203                                                                                                                    </span>
<span class="8604411225055729762" onmouseenter="enter('8604411225055729762');" onmouseout="out('8604411225055729762');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 204 -            String productIdStr = null;                                                                           </span>
<span class="6768248097235931624" onmouseenter="enter('6768248097235931624');" onmouseout="out('6768248097235931624');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 205 -            if (persistencePackage.getCustomCriteria() != null &amp;&amp; persistencePackage.getCustomCriteria().length &gt; 0) {"> 205 -            if (persistencePackage.getCustomCriteria() != null &amp;&amp; persistencePackage.getCustomCriteria().length &gt; ðŸ”µ</abbr></span>
<span class="2023823587809168814" onmouseenter="enter('2023823587809168814');" onmouseout="out('2023823587809168814');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 206 -                productIdStr = persistencePackage.getCustomCriteria()[0];                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 207 -            }                                                                                                     </span>
<span class="8224436115361654738" onmouseenter="enter('8224436115361654738');" onmouseout="out('8224436115361654738');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 208 +            String productIdStr = getOwningProductId(persistencePackage.getSectionCrumbs());                      </span>
<span class="8874992536138016800" onmouseenter="enter('8874992536138016800');" onmouseout="out('8874992536138016800');" style=""> 209              String cacheKey = skuMetadataCacheService.buildCacheKey(productIdStr);                                </span>
<span  style=""> 210                                                                                                                    </span>
<span class="4935255304884851121" onmouseenter="enter('4935255304884851121');" onmouseout="out('4935255304884851121');" style=""> 211              Map&lt;String, FieldMetadata&gt; properties = null;                                                         </span>
<span class="-7786224376670761804" onmouseenter="enter('-7786224376670761804');" onmouseout="out('-7786224376670761804');" style=""> 212              boolean useCache = skuMetadataCacheService.useCache();                                                </span>
<span class="6293418362193794054" onmouseenter="enter('6293418362193794054');" onmouseout="out('6293418362193794054');" style=""> 213              if (useCache) {                                                                                       </span>
<span class="-3485340186081071120" onmouseenter="enter('-3485340186081071120');" onmouseout="out('-3485340186081071120');" style=""> 214                  properties = skuMetadataCacheService.getFromCache(cacheKey);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215              }                                                                                                     </span>
<span class="-6785810758643658869" onmouseenter="enter('-6785810758643658869');" onmouseout="out('-6785810758643658869');" style=""> 216              if (properties == null) {                                                                             </span>
<span class="-5990030037269165261" onmouseenter="enter('-5990030037269165261');" onmouseout="out('-5990030037269165261');" style=""> 217                  //Grab the default properties for the Sku                                                         </span>
<span class="8769638039057755276" onmouseenter="enter('8769638039057755276');" onmouseout="out('8769638039057755276');" style=""> 218                  properties = helper.getSimpleMergedProperties(SkuImpl.class.getName(), persistencePerspective);   </span>
<span  style=""> 219                                                                                                                    </span>
<span class="630916579208170345" onmouseenter="enter('630916579208170345');" onmouseout="out('630916579208170345');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 220 -                boolean isFirstCriteriaNAN = persistencePackage.getCustomCriteria() == null || persistencePackage.getCustomCriteria().length == 0;"> 220 -                boolean isFirstCriteriaNAN = persistencePackage.getCustomCriteria() == null || persistencePackage.ðŸ”µ</abbr></span>
<span class="4572678014865473520" onmouseenter="enter('4572678014865473520');" onmouseout="out('4572678014865473520');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +                boolean isFirstCriteriaNAN = productIdStr == null;                                                </span>
<span class="3252503566680993088" onmouseenter="enter('3252503566680993088');" onmouseout="out('3252503566680993088');" style=""> 222                  if (!isFirstCriteriaNAN &amp;&amp; useToOneLookupSkuProductOptionValue) {                                 </span>
<span class="7017874790097466956" onmouseenter="enter('7017874790097466956');" onmouseout="out('7017874790097466956');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 223 -                    isFirstCriteriaNAN = !DIGIT.matchesAllOf(persistencePackage.getCustomCriteria()[0]);          </span>
<span class="-9185431242058274610" onmouseenter="enter('-9185431242058274610');" onmouseout="out('-9185431242058274610');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 224 +                    isFirstCriteriaNAN = !NumberUtils.isNumber(productIdStr);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225                  }                                                                                                 </span>
<span class="-1057552343227044346" onmouseenter="enter('-1057552343227044346');" onmouseout="out('-1057552343227044346');" style=""> 226                  if (isFirstCriteriaNAN) {                                                                         </span>
<span class="-6228644381152217188" onmouseenter="enter('-6228644381152217188');" onmouseout="out('-6228644381152217188');" style=""> 227                      //look up all the ProductOptions and then create new fields for each of them                  </span>
<span class="-5911163386440462712" onmouseenter="enter('-5911163386440462712');" onmouseout="out('-5911163386440462712');" style=""> 228                      List&lt;ProductOption&gt; options = catalogService.readAllProductOptions();                         </span>
<span class="-6720626788939973914" onmouseenter="enter('-6720626788939973914');" onmouseout="out('-6720626788939973914');" style=""> 229                      int order = 0;                                                                                </span>
<span class="-3626227932157062862" onmouseenter="enter('-3626227932157062862');" onmouseout="out('-3626227932157062862');" style=""> 230                      for (ProductOption option : options) {                                                        </span>
<span class="-2894964408662309595" onmouseenter="enter('-2894964408662309595');" onmouseout="out('-2894964408662309595');" style=""> 231                          //add this to the built Sku properties                                                    </span>
<span class="-6525885484902667726" onmouseenter="enter('-6525885484902667726');" onmouseout="out('-6525885484902667726');" style=""> 232                          FieldMetadata md = createIndividualOptionField(option, order);                            </span>
<span class="8898370236947645542" onmouseenter="enter('8898370236947645542');" onmouseout="out('8898370236947645542');" style=""> 233                          if (md != null) {                                                                         </span>
<span class="-8011968882232877757" onmouseenter="enter('-8011968882232877757');" onmouseout="out('-8011968882232877757');" style=""> 234                              properties.put(&quot;productOption&quot; + option.getId(), md);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236                      }                                                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 237                  } else {                                                                                          </span>
<span class="-4312271314847345000" onmouseenter="enter('-4312271314847345000');" onmouseout="out('-4312271314847345000');" style=""> 238                      // If we have a product to filter the list of available product options, then use it          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 239                      try {                                                                                         </span>
<span class="-5024641366798728468" onmouseenter="enter('-5024641366798728468');" onmouseout="out('-5024641366798728468');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 240 -                        Long productId = Long.parseLong(persistencePackage.getCustomCriteria()[0]);               </span>
<span class="2407810897627048437" onmouseenter="enter('2407810897627048437');" onmouseout="out('2407810897627048437');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +                        Long productId = Long.parseLong(productIdStr);                                            </span>
<span class="-4586946436800548085" onmouseenter="enter('-4586946436800548085');" onmouseout="out('-4586946436800548085');" style=""> 242                          Product product = catalogService.findProductById(productId);                              </span>
<span class="-8670197725029820971" onmouseenter="enter('-8670197725029820971');" onmouseout="out('-8670197725029820971');" style=""> 243                          for (ProductOption option : product.getProductOptions()) {                                </span>
<span class="1960418873000138214" onmouseenter="enter('1960418873000138214');" onmouseout="out('1960418873000138214');" style=""> 244                              FieldMetadata md = createIndividualOptionField(option, 0);                            </span>
<span class="8898370236947645542" onmouseenter="enter('8898370236947645542');" onmouseout="out('8898370236947645542');" style=""> 245                              if (md != null) {                                                                     </span>
<span class="-8011968882232877757" onmouseenter="enter('-8011968882232877757');" onmouseout="out('-8011968882232877757');" style=""> 246                                  properties.put(&quot;productOption&quot; + option.getId(), md);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248                          }                                                                                         </span>
<span class="7366941412324817508" onmouseenter="enter('7366941412324817508');" onmouseout="out('7366941412324817508');" style=""> 249                      } catch (NumberFormatException e) {                                                           </span>
<span class="-539761885704419036" onmouseenter="enter('-539761885704419036');" onmouseout="out('-539761885704419036');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 250 -                        // the criteria wasn&#x27;t a product id, just don&#x27;t do anything                               </span>
<span class="-1877352964924956330" onmouseenter="enter('-1877352964924956330');" onmouseout="out('-1877352964924956330');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +                        // there wasn&#x27;t a valid product id, just don&#x27;t do anything                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253                  }                                                                                                 </span>
<span  style=""> 254                                                                                                                    </span>
<span class="-4150172021442827260" onmouseenter="enter('-4150172021442827260');" onmouseout="out('-4150172021442827260');" style=""><abbr title=" 255                  //also build the consolidated field; if using the SkuBasicClientEntityModule then this field will be"> 255                  //also build the consolidated field; if using the SkuBasicClientEntityModule then this field will ðŸ”µ</abbr></span>
<span class="-6012146770615121121" onmouseenter="enter('-6012146770615121121');" onmouseout="out('-6012146770615121121');" style=""> 256                  //permanently hidden                                                                              </span>
<span class="2721680110186827865" onmouseenter="enter('2721680110186827865');" onmouseout="out('2721680110186827865');" style=""><abbr title=" 257                  properties.put(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME, createConsolidatedOptionField(SkuImpl.class));"> 257                  properties.put(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME, createConsolidatedOptionField(SkuImpl.clasðŸ”µ</abbr></span>
<span  style=""> 258                                                                                                                    </span>
<span class="6293418362193794054" onmouseenter="enter('6293418362193794054');" onmouseout="out('6293418362193794054');" style=""> 259                  if (useCache) {                                                                                   </span>
<span class="1689829812062092848" onmouseenter="enter('1689829812062092848');" onmouseout="out('1689829812062092848');" style=""> 260                      skuMetadataCacheService.addToCache(cacheKey, properties);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262              }                                                                                                     </span>
<span  style=""> 263                                                                                                                    </span>
<span class="-5708738706047923554" onmouseenter="enter('-5708738706047923554');" onmouseout="out('-5708738706047923554');" style=""> 264              allMergedProperties.put(MergedPropertyType.PRIMARY, properties);                                      </span>
<span  style=""> 265                                                                                                                    </span>
<span class="3581259712058738264" onmouseenter="enter('3581259712058738264');" onmouseout="out('3581259712058738264');" style=""> 266              //allow the adorned list to contribute properties as well in the case of Sku bundle items             </span>
<span class="4464917262062588204" onmouseenter="enter('4464917262062588204');" onmouseout="out('4464917262062588204');" style=""> 267              adornedPersistenceModule.setPersistenceManager((PersistenceManager)helper);                           </span>
<span class="-5923303721993025135" onmouseenter="enter('-5923303721993025135');" onmouseout="out('-5923303721993025135');" style=""> 268              adornedPersistenceModule.updateMergedProperties(persistencePackage, allMergedProperties);             </span>
<span  style=""> 269                                                                                                                    </span>
<span class="-4755998569329183714" onmouseenter="enter('-4755998569329183714');" onmouseout="out('-4755998569329183714');" style=""> 270              Class&lt;?&gt;[] entityClasses = dynamicEntityDao.getAllPolymorphicEntitiesFromCeiling(SkuImpl.class);      </span>
<span  style=""> 271                                                                                                                    </span>
<span class="-4526006421593645811" onmouseenter="enter('-4526006421593645811');" onmouseout="out('-4526006421593645811');" style=""><abbr title=" 272              for (Map.Entry&lt;MergedPropertyType, Map&lt;String, FieldMetadata&gt;&gt; entry : allMergedProperties.entrySet()) {"> 272              for (Map.Entry&lt;MergedPropertyType, Map&lt;String, FieldMetadata&gt;&gt; entry : allMergedProperties.entrySet())ðŸ”µ</abbr></span>
<span class="5289188932531096512" onmouseenter="enter('5289188932531096512');" onmouseout="out('5289188932531096512');" style=""> 273                  filterOutProductMetadata(entry.getValue());                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274              }                                                                                                     </span>
<span  style=""> 275                                                                                                                    </span>
<span class="-8821755242796986609" onmouseenter="enter('-8821755242796986609');" onmouseout="out('-8821755242796986609');" style=""><abbr title=" 276              ClassMetadata mergedMetadata = helper.buildClassMetadata(entityClasses, persistencePackage, allMergedProperties);"> 276              ClassMetadata mergedMetadata = helper.buildClassMetadata(entityClasses, persistencePackage, allMergedPðŸ”µ</abbr></span>
<span class="5692867683696224654" onmouseenter="enter('5692867683696224654');" onmouseout="out('5692867683696224654');" style=""> 277              DynamicResultSet results = new DynamicResultSet(mergedMetadata, null, null);                          </span>
<span  style=""> 278                                                                                                                    </span>
<span class="225205592763971576" onmouseenter="enter('225205592763971576');" onmouseout="out('225205592763971576');" style=""> 279              return results;                                                                                       </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 280          } catch (Exception e) {                                                                                   </span>
<span class="5888084531497929280" onmouseenter="enter('5888084531497929280');" onmouseout="out('5888084531497929280');" style=""> 281              ServiceException ex = new ServiceException(&quot;Unable to retrieve inspection results for &quot; +             </span>
<span class="6417711820622805051" onmouseenter="enter('6417711820622805051');" onmouseout="out('6417711820622805051');" style=""> 282                      persistencePackage.getCeilingEntityFullyQualifiedClassname(), e);                             </span>
<span class="8479095309709473887" onmouseenter="enter('8479095309709473887');" onmouseout="out('8479095309709473887');" style=""> 283              throw ex;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 285 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 286 +                                                                                                                  </span>
<span class="7792500831321188662" onmouseenter="enter('7792500831321188662');" onmouseout="out('7792500831321188662');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 287 +    protected String getOwningProductId(SectionCrumb[] sectionCrumbs) {                                           </span>
<span class="5995078305082040448" onmouseenter="enter('5995078305082040448');" onmouseout="out('5995078305082040448');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 288 +        if (ArrayUtils.isNotEmpty(sectionCrumbs) &amp;&amp; ProductImpl.class.getCanonicalName()                          </span>
<span class="-5371969237667246856" onmouseenter="enter('-5371969237667246856');" onmouseout="out('-5371969237667246856');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 289 +                .equals(sectionCrumbs[0].getSectionIdentifier())) {                                               </span>
<span class="1460529894614018184" onmouseenter="enter('1460529894614018184');" onmouseout="out('1460529894614018184');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 290 +            return sectionCrumbs[0].getSectionId();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 291 +        }                                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 292 +        return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293      }                                                                                                             </span>
<span  style=""> 294                                                                                                                    </span>
<span class="-6584484392335358741" onmouseenter="enter('-6584484392335358741');" onmouseout="out('-6584484392335358741');" style=""> 295      protected void filterOutProductMetadata(Map&lt;String, FieldMetadata&gt; map) {                                     </span>
<span class="5728154390973133711" onmouseenter="enter('5728154390973133711');" onmouseout="out('5728154390973133711');" style=""><abbr title=" 296          //TODO we shouldn&#x27;t have to filter out these keys here -- we should be able to exclude using @AdminPresentation,"> 296          //TODO we shouldn&#x27;t have to filter out these keys here -- we should be able to exclude using @AdminPresentðŸ”µ</abbr></span>
<span class="-7743625525232386179" onmouseenter="enter('-7743625525232386179');" onmouseout="out('-7743625525232386179');" style=""> 297          //but there&#x27;s a bug preventing this behavior from completely working correctly                            </span>
<span class="-976216753136159975" onmouseenter="enter('-976216753136159975');" onmouseout="out('-976216753136159975');" style=""> 298          List&lt;String&gt; removeKeys = new ArrayList&lt;&gt;();                                                              </span>
<span class="-6833083889726135539" onmouseenter="enter('-6833083889726135539');" onmouseout="out('-6833083889726135539');" style=""> 299          for (Map.Entry&lt;String, FieldMetadata&gt; entry : map.entrySet()) {                                           </span>
<span class="-6943676522367592499" onmouseenter="enter('-6943676522367592499');" onmouseout="out('-6943676522367592499');" style=""> 300              if (entry.getKey().contains(&quot;defaultProduct.&quot;) || entry.getKey().contains(&quot;product.&quot;)) {              </span>
<span class="6428107256625953551" onmouseenter="enter('6428107256625953551');" onmouseout="out('6428107256625953551');" style=""> 301                  removeKeys.add(entry.getKey());                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303          }                                                                                                         </span>
<span class="7925962848224625040" onmouseenter="enter('7925962848224625040');" onmouseout="out('7925962848224625040');" style=""> 304          for (String removeKey : removeKeys) {                                                                     </span>
<span class="-7725303831891910229" onmouseenter="enter('-7725303831891910229');" onmouseout="out('-7725303831891910229');" style=""> 305              map.remove(removeKey);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307      }                                                                                                             </span>
<span  style=""> 308                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 309      /**                                                                                                           </span>
<span class="8475757947277110833" onmouseenter="enter('8475757947277110833');" onmouseout="out('8475757947277110833');" style=""><abbr title=" 310       * Creates the metadata necessary for displaying all of the product option values in a single field. The display of this"> 310       * Creates the metadata necessary for displaying all of the product option values in a single field. The displðŸ”µ</abbr></span>
<span class="-7291252168371203717" onmouseenter="enter('-7291252168371203717');" onmouseout="out('-7291252168371203717');" style=""><abbr title=" 311       * field is a single string with every product option value appended to it separated by a semicolon. This method should"> 311       * field is a single string with every product option value appended to it separated by a semicolon. This methðŸ”µ</abbr></span>
<span class="1992999426370183590" onmouseenter="enter('1992999426370183590');" onmouseout="out('1992999426370183590');" style=""><abbr title=" 312       * be invoked on an inspect for whatever is utilizing this so that the property will be ready to be populated on fetch."> 312       * be invoked on an inspect for whatever is utilizing this so that the property will be ready to be populated ðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 313       *                                                                                                            </span>
<span class="-6637674095635137344" onmouseenter="enter('-6637674095635137344');" onmouseout="out('-6637674095635137344');" style=""><abbr title=" 314       * The metadata that is returned will also be set to prominent by default so that it will be ready to display on whatever"> 314       * The metadata that is returned will also be set to prominent by default so that it will be ready to display ðŸ”µ</abbr></span>
<span class="-511871035138294277" onmouseenter="enter('-511871035138294277');" onmouseout="out('-511871035138294277');" style=""><abbr title=" 315       * grid is being inspected. If you do not want this behavior you will need to override this functionality in the metadata"> 315       * grid is being inspected. If you do not want this behavior you will need to override this functionality in tðŸ”µ</abbr></span>
<span class="3179613037749712904" onmouseenter="enter('3179613037749712904');" onmouseout="out('3179613037749712904');" style=""> 316       * that is returned.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 317       *                                                                                                            </span>
<span class="7116239974974757712" onmouseenter="enter('7116239974974757712');" onmouseout="out('7116239974974757712');" style=""><abbr title=" 318       * @param inheritedFromType which type this should appear on. This would normally be SkuImpl.class, but if you want to"> 318       * @param inheritedFromType which type this should appear on. This would normally be SkuImpl.class, but if youðŸ”µ</abbr></span>
<span class="167462497314507165" onmouseenter="enter('167462497314507165');" onmouseout="out('167462497314507165');" style=""> 319       * display this field with a different entity then this should be that entity                                 </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 320       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 321       */                                                                                                           </span>
<span class="-1192927872819846099" onmouseenter="enter('-1192927872819846099');" onmouseout="out('-1192927872819846099');" style=""> 322      public FieldMetadata createConsolidatedOptionField(Class&lt;?&gt; inheritedFromType) {                              </span>
<span class="-7895492162900601652" onmouseenter="enter('-7895492162900601652');" onmouseout="out('-7895492162900601652');" style=""> 323          BasicFieldMetadata metadata = new BasicFieldMetadata();                                                   </span>
<span class="1112932430275912677" onmouseenter="enter('1112932430275912677');" onmouseout="out('1112932430275912677');" style=""> 324          metadata.setFieldType(SupportedFieldType.STRING);                                                         </span>
<span class="6091769410078062740" onmouseenter="enter('6091769410078062740');" onmouseout="out('6091769410078062740');" style=""> 325          metadata.setMutable(false);                                                                               </span>
<span class="2561191544941929216" onmouseenter="enter('2561191544941929216');" onmouseout="out('2561191544941929216');" style=""> 326          metadata.setInheritedFromType(inheritedFromType.getName());                                               </span>
<span  style=""> 327                                                                                                                    </span>
<span class="7921709413407422398" onmouseenter="enter('7921709413407422398');" onmouseout="out('7921709413407422398');" style=""><abbr title=" 328          metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCache()));"> 328          metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCache()))ðŸ”µ</abbr></span>
<span class="7303907294085574775" onmouseenter="enter('7303907294085574775');" onmouseout="out('7303907294085574775');" style=""> 329          metadata.setForeignKeyCollection(false);                                                                  </span>
<span class="-1649079592520542152" onmouseenter="enter('-1649079592520542152');" onmouseout="out('-1649079592520542152');" style=""> 330          metadata.setMergedPropertyType(MergedPropertyType.PRIMARY);                                               </span>
<span  style=""> 331                                                                                                                    </span>
<span class="6688700612838924202" onmouseenter="enter('6688700612838924202');" onmouseout="out('6688700612838924202');" style=""> 332          metadata.setName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                                                </span>
<span class="173658654284287974" onmouseenter="enter('173658654284287974');" onmouseout="out('173658654284287974');" style=""> 333          metadata.setFriendlyName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                                        </span>
<span class="5589230730632374582" onmouseenter="enter('5589230730632374582');" onmouseout="out('5589230730632374582');" style=""> 334          metadata.setGroup(&quot;&quot;);                                                                                    </span>
<span class="8683462265874380595" onmouseenter="enter('8683462265874380595');" onmouseout="out('8683462265874380595');" style=""> 335          metadata.setExplicitFieldType(SupportedFieldType.UNKNOWN);                                                </span>
<span class="-6445843447872579066" onmouseenter="enter('-6445843447872579066');" onmouseout="out('-6445843447872579066');" style=""> 336          metadata.setProminent(true);                                                                              </span>
<span class="-4820234772877671615" onmouseenter="enter('-4820234772877671615');" onmouseout="out('-4820234772877671615');" style=""> 337          metadata.setVisibility(VisibilityEnum.FORM_HIDDEN);                                                       </span>
<span class="8945700141771923055" onmouseenter="enter('8945700141771923055');" onmouseout="out('8945700141771923055');" style=""> 338          metadata.setBroadleafEnumeration(&quot;&quot;);                                                                     </span>
<span class="1775531838265915895" onmouseenter="enter('1775531838265915895');" onmouseout="out('1775531838265915895');" style=""> 339          metadata.setReadOnly(true);                                                                               </span>
<span class="-7171521581678886800" onmouseenter="enter('-7171521581678886800');" onmouseout="out('-7171521581678886800');" style=""> 340          metadata.setRequiredOverride(false);                                                                      </span>
<span class="-4496921391259172818" onmouseenter="enter('-4496921391259172818');" onmouseout="out('-4496921391259172818');" style=""> 341          metadata.setGridOrder(Integer.MAX_VALUE);                                                                 </span>
<span  style=""> 342                                                                                                                    </span>
<span class="-6736542809122384852" onmouseenter="enter('-6736542809122384852');" onmouseout="out('-6736542809122384852');" style=""> 343          return metadata;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 344      }                                                                                                             </span>
<span  style=""> 345                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 346      /**                                                                                                           </span>
<span class="-8205275851682999693" onmouseenter="enter('-8205275851682999693');" onmouseout="out('-8205275851682999693');" style=""><abbr title=" 347       * Returns a {@link Property} filled out with a delimited list of the &lt;b&gt;values&lt;/b&gt; that are passed in. This should be"> 347       * Returns a {@link Property} filled out with a delimited list of the &lt;b&gt;values&lt;/b&gt; that are passed in. This sðŸ”µ</abbr></span>
<span class="-4713707283922918694" onmouseenter="enter('-4713707283922918694');" onmouseout="out('-4713707283922918694');" style=""> 348       * invoked on a fetch and the returned property should be added to the fetched {@link Entity} dto.            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 349       *                                                                                                            </span>
<span class="2073888098879145111" onmouseenter="enter('2073888098879145111');" onmouseout="out('2073888098879145111');" style=""> 350       * @param values                                                                                              </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 351       * @return                                                                                                    </span>
<span class="3015934350861870420" onmouseenter="enter('3015934350861870420');" onmouseout="out('3015934350861870420');" style=""> 352       * @see {@link #createConsolidatedOptionField(Class)};                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 353       */                                                                                                           </span>
<span class="-4797739079142470258" onmouseenter="enter('-4797739079142470258');" onmouseout="out('-4797739079142470258');" style=""> 354      public Property getConsolidatedOptionProperty(Collection&lt;ProductOptionValue&gt; values) {                        </span>
<span class="6856864467058713906" onmouseenter="enter('6856864467058713906');" onmouseout="out('6856864467058713906');" style=""> 355          Property optionValueProperty = new Property();                                                            </span>
<span class="6345005840174859359" onmouseenter="enter('6345005840174859359');" onmouseout="out('6345005840174859359');" style=""> 356          optionValueProperty.setName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                                     </span>
<span  style=""> 357                                                                                                                    </span>
<span class="4968742745228384146" onmouseenter="enter('4968742745228384146');" onmouseout="out('4968742745228384146');" style=""> 358          //order the values by the display order of their correspond product option                                </span>
<span class="-6409609658063536117" onmouseenter="enter('-6409609658063536117');" onmouseout="out('-6409609658063536117');" style=""> 359          //        Collections.sort(values, new Comparator&lt;ProductOptionValue&gt;() {                                 </span>
<span class="-8064130612454474190" onmouseenter="enter('-8064130612454474190');" onmouseout="out('-8064130612454474190');" style=""> 360          //                                                                                                        </span>
<span class="5501927314430930673" onmouseenter="enter('5501927314430930673');" onmouseout="out('5501927314430930673');" style=""> 361          //            @Override                                                                                   </span>
<span class="9147587799683858413" onmouseenter="enter('9147587799683858413');" onmouseout="out('9147587799683858413');" style=""> 362          //            public int compare(ProductOptionValue value1, ProductOptionValue value2) {                  </span>
<span class="368329491788158591" onmouseenter="enter('368329491788158591');" onmouseout="out('368329491788158591');" style=""> 363          //                return new CompareToBuilder().append(value1.getProductOption().getDisplayOrder(),       </span>
<span class="8754156396924172260" onmouseenter="enter('8754156396924172260');" onmouseout="out('8754156396924172260');" style=""> 364          //                        value2.getProductOption().getDisplayOrder()).toComparison();                    </span>
<span class="1818990376901269570" onmouseenter="enter('1818990376901269570');" onmouseout="out('1818990376901269570');" style=""> 365          //            }                                                                                           </span>
<span class="-1155227284920485909" onmouseenter="enter('-1155227284920485909');" onmouseout="out('-1155227284920485909');" style=""> 366          //        });                                                                                             </span>
<span  style=""> 367                                                                                                                    </span>
<span class="-2061482055453175047" onmouseenter="enter('-2061482055453175047');" onmouseout="out('-2061482055453175047');" style=""> 368          ArrayList&lt;String&gt; stringValues = new ArrayList&lt;&gt;();                                                       </span>
<span class="-7157508124377790495" onmouseenter="enter('-7157508124377790495');" onmouseout="out('-7157508124377790495');" style=""> 369          CollectionUtils.collect(values, new Transformer() {                                                       </span>
<span  style=""> 370                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 371              @Override                                                                                             </span>
<span class="-2718541205900117239" onmouseenter="enter('-2718541205900117239');" onmouseout="out('-2718541205900117239');" style=""> 372              public Object transform(Object input) {                                                               </span>
<span class="-2749337455813426805" onmouseenter="enter('-2749337455813426805');" onmouseout="out('-2749337455813426805');" style=""> 373                  return ((ProductOptionValue) input).getAttributeValue();                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374              }                                                                                                     </span>
<span class="-236589394719861606" onmouseenter="enter('-236589394719861606');" onmouseout="out('-236589394719861606');" style=""> 375          }, stringValues);                                                                                         </span>
<span  style=""> 376                                                                                                                    </span>
<span class="-3159140932312278736" onmouseenter="enter('-3159140932312278736');" onmouseout="out('-3159140932312278736');" style=""> 377          optionValueProperty.setValue(StringUtils.join(stringValues, CONSOLIDATED_PRODUCT_OPTIONS_DELIMETER));     </span>
<span class="-6819592353936650784" onmouseenter="enter('-6819592353936650784');" onmouseout="out('-6819592353936650784');" style=""> 378          return optionValueProperty;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379      }                                                                                                             </span>
<span  style=""> 380                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 381      /**                                                                                                           </span>
<span class="4216744498315651983" onmouseenter="enter('4216744498315651983');" onmouseout="out('4216744498315651983');" style=""> 382       * @return a blank {@link Property} corresponding to the CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 383       */                                                                                                           </span>
<span class="7598660974779837355" onmouseenter="enter('7598660974779837355');" onmouseout="out('7598660974779837355');" style=""> 384      public Property getBlankConsolidatedOptionProperty() {                                                        </span>
<span class="6856864467058713906" onmouseenter="enter('6856864467058713906');" onmouseout="out('6856864467058713906');" style=""> 385          Property optionValueProperty = new Property();                                                            </span>
<span class="6345005840174859359" onmouseenter="enter('6345005840174859359');" onmouseout="out('6345005840174859359');" style=""> 386          optionValueProperty.setName(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);                                     </span>
<span class="-7065335864511569913" onmouseenter="enter('-7065335864511569913');" onmouseout="out('-7065335864511569913');" style=""> 387          optionValueProperty.setValue(&quot;&quot;);                                                                         </span>
<span class="-6819592353936650784" onmouseenter="enter('-6819592353936650784');" onmouseout="out('-6819592353936650784');" style=""> 388          return optionValueProperty;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 389      }                                                                                                             </span>
<span  style=""> 390                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 391      /**                                                                                                           </span>
<span class="6557988157037524501" onmouseenter="enter('6557988157037524501');" onmouseout="out('6557988157037524501');" style=""><abbr title=" 392       * &lt;p&gt;Creates an individual property for the specified product option. This should set up an enum field whose values will"> 392       * &lt;p&gt;Creates an individual property for the specified product option. This should set up an enum field whose ðŸ”µ</abbr></span>
<span class="5038223503928989560" onmouseenter="enter('5038223503928989560');" onmouseout="out('5038223503928989560');" style=""><abbr title=" 393       * be the option values for this option.  This is useful when you would like to display each product option in as its"> 393       * be the option values for this option.  This is useful when you would like to display each product option inðŸ”µ</abbr></span>
<span class="9009411457822617231" onmouseenter="enter('9009411457822617231');" onmouseout="out('9009411457822617231');" style=""> 394       * own field in a grid so that you can further filter by product option values.&lt;/p&gt;                           </span>
<span class="-8656076573134722150" onmouseenter="enter('-8656076573134722150');" onmouseout="out('-8656076573134722150');" style=""> 395       * &lt;p&gt;In order for these fields to be utilized property on the fetch, in the GWT frontend you must use the    </span>
<span class="-3536572176551507765" onmouseenter="enter('-3536572176551507765');" onmouseout="out('-3536572176551507765');" style=""> 396       * for your datasource.&lt;/p&gt;                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 397       *                                                                                                            </span>
<span class="8674570395008402319" onmouseenter="enter('8674570395008402319');" onmouseout="out('8674570395008402319');" style=""> 398       * @param option                                                                                              </span>
<span class="6414796960983960786" onmouseenter="enter('6414796960983960786');" onmouseout="out('6414796960983960786');" style=""> 399       * @param order                                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 400       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 401       */                                                                                                           </span>
<span class="8795563977758647136" onmouseenter="enter('8795563977758647136');" onmouseout="out('8795563977758647136');" style=""> 402      public FieldMetadata createIndividualOptionField(ProductOption option, int order) {                           </span>
<span class="7200486368414049440" onmouseenter="enter('7200486368414049440');" onmouseout="out('7200486368414049440');" style=""> 403          if (useToOneLookupSkuProductOptionValue) {                                                                </span>
<span class="-5634467253732639986" onmouseenter="enter('-5634467253732639986');" onmouseout="out('-5634467253732639986');" style=""> 404              return createToOneIndividualOptionField(option, order);                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 405          } else {                                                                                                  </span>
<span class="7936034563418693343" onmouseenter="enter('7936034563418693343');" onmouseout="out('7936034563418693343');" style=""> 406              return createExplicitEnumerationIndividualOptionField(option, order);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 407          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 408      }                                                                                                             </span>
<span  style=""> 409                                                                                                                    </span>
<span class="-8892069303256438111" onmouseenter="enter('-8892069303256438111');" onmouseout="out('-8892069303256438111');" style=""> 410      protected FieldMetadata createExplicitEnumerationIndividualOptionField(ProductOption option, int order) {     </span>
<span class="-7895492162900601652" onmouseenter="enter('-7895492162900601652');" onmouseout="out('-7895492162900601652');" style=""> 411          BasicFieldMetadata metadata = new BasicFieldMetadata();                                                   </span>
<span class="-2416891430670029479" onmouseenter="enter('-2416891430670029479');" onmouseout="out('-2416891430670029479');" style=""> 412          List&lt;ProductOptionValue&gt; allowedValues = option.getAllowedValues();                                       </span>
<span class="9151233583168413632" onmouseenter="enter('9151233583168413632');" onmouseout="out('9151233583168413632');" style=""> 413          if (CollectionUtils.isNotEmpty(allowedValues)) {                                                          </span>
<span class="4285129340737600689" onmouseenter="enter('4285129340737600689');" onmouseout="out('4285129340737600689');" style=""> 414              metadata.setFieldType(SupportedFieldType.EXPLICIT_ENUMERATION);                                       </span>
<span class="-6206284717251400514" onmouseenter="enter('-6206284717251400514');" onmouseout="out('-6206284717251400514');" style=""> 415              metadata.setMutable(true);                                                                            </span>
<span class="8194069883044431071" onmouseenter="enter('8194069883044431071');" onmouseout="out('8194069883044431071');" style=""> 416              metadata.setInheritedFromType(SkuImpl.class.getName());                                               </span>
<span class="7921709413407422398" onmouseenter="enter('7921709413407422398');" onmouseout="out('7921709413407422398');" style=""><abbr title=" 417              metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCache()));"> 417              metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCacheðŸ”µ</abbr></span>
<span class="7303907294085574775" onmouseenter="enter('7303907294085574775');" onmouseout="out('7303907294085574775');" style=""> 418              metadata.setForeignKeyCollection(false);                                                              </span>
<span class="-1649079592520542152" onmouseenter="enter('-1649079592520542152');" onmouseout="out('-1649079592520542152');" style=""> 419              metadata.setMergedPropertyType(MergedPropertyType.PRIMARY);                                           </span>
<span  style=""> 420                                                                                                                    </span>
<span class="-1089414754199454043" onmouseenter="enter('-1089414754199454043');" onmouseout="out('-1089414754199454043');" style=""> 421              //Set up the enumeration based on the product option values                                           </span>
<span class="-4938595371513432920" onmouseenter="enter('-4938595371513432920');" onmouseout="out('-4938595371513432920');" style=""> 422              String[][] optionValues = new String[allowedValues.size()][2];                                        </span>
<span class="6205975934798560127" onmouseenter="enter('6205975934798560127');" onmouseout="out('6205975934798560127');" style=""> 423              for (int i = 0; i &lt; allowedValues.size(); i++) {                                                      </span>
<span class="5655693563027021374" onmouseenter="enter('5655693563027021374');" onmouseout="out('5655693563027021374');" style=""> 424                  ProductOptionValue value = option.getAllowedValues().get(i);                                      </span>
<span class="-6097967761511863324" onmouseenter="enter('-6097967761511863324');" onmouseout="out('-6097967761511863324');" style=""> 425                  optionValues[i][0] = value.getId().toString();                                                    </span>
<span class="-2028520644986671717" onmouseenter="enter('-2028520644986671717');" onmouseout="out('-2028520644986671717');" style=""> 426                  optionValues[i][1] = value.getAttributeValue();                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 427              }                                                                                                     </span>
<span class="8277090772710644263" onmouseenter="enter('8277090772710644263');" onmouseout="out('8277090772710644263');" style=""> 428              metadata.setEnumerationValues(optionValues);                                                          </span>
<span  style=""> 429                                                                                                                    </span>
<span class="1748190162337854256" onmouseenter="enter('1748190162337854256');" onmouseout="out('1748190162337854256');" style=""> 430              metadata.setName(PRODUCT_OPTION_FIELD_PREFIX + option.getId());                                       </span>
<span class="7017269500484793927" onmouseenter="enter('7017269500484793927');" onmouseout="out('7017269500484793927');" style=""> 431              metadata.setFriendlyName(option.getLabel());                                                          </span>
<span class="6085246036283927461" onmouseenter="enter('6085246036283927461');" onmouseout="out('6085246036283927461');" style=""> 432              metadata.setGroup(&quot;productOption_group&quot;);                                                             </span>
<span class="-8050220525630720562" onmouseenter="enter('-8050220525630720562');" onmouseout="out('-8050220525630720562');" style=""> 433              metadata.setGroupOrder(-1);                                                                           </span>
<span class="3406381469360124301" onmouseenter="enter('3406381469360124301');" onmouseout="out('3406381469360124301');" style=""> 434              metadata.setOrder(order);                                                                             </span>
<span class="8683462265874380595" onmouseenter="enter('8683462265874380595');" onmouseout="out('8683462265874380595');" style=""> 435              metadata.setExplicitFieldType(SupportedFieldType.UNKNOWN);                                            </span>
<span class="-6994608424159816416" onmouseenter="enter('-6994608424159816416');" onmouseout="out('-6994608424159816416');" style=""> 436              metadata.setProminent(false);                                                                         </span>
<span class="6274758849936387106" onmouseenter="enter('6274758849936387106');" onmouseout="out('6274758849936387106');" style=""> 437              metadata.setVisibility(VisibilityEnum.FORM_EXPLICITLY_SHOWN);                                         </span>
<span class="8945700141771923055" onmouseenter="enter('8945700141771923055');" onmouseout="out('8945700141771923055');" style=""> 438              metadata.setBroadleafEnumeration(&quot;&quot;);                                                                 </span>
<span class="8076682597610338410" onmouseenter="enter('8076682597610338410');" onmouseout="out('8076682597610338410');" style=""> 439              metadata.setReadOnly(false);                                                                          </span>
<span class="2131936785391707598" onmouseenter="enter('2131936785391707598');" onmouseout="out('2131936785391707598');" style=""> 440              metadata.setRequiredOverride(BooleanUtils.isFalse(option.getRequired()));                             </span>
<span  style=""> 441                                                                                                                    </span>
<span class="-6736542809122384852" onmouseenter="enter('-6736542809122384852');" onmouseout="out('-6736542809122384852');" style=""> 442              return metadata;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 443          }                                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 444          return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 445      }                                                                                                             </span>
<span  style=""> 446                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 447      /**                                                                                                           </span>
<span class="7683644189550699004" onmouseenter="enter('7683644189550699004');" onmouseout="out('7683644189550699004');" style=""><abbr title=" 448       * Using a ToOne lookup performs much better for large product option value lists, speeds up initial page load,"> 448       * Using a ToOne lookup performs much better for large product option value lists, speeds up initial page loadðŸ”µ</abbr></span>
<span class="-6062867542246075622" onmouseenter="enter('-6062867542246075622');" onmouseout="out('-6062867542246075622');" style=""><abbr title=" 449       * and is generally more accurate in relation to option value updates and how they impact available selections and cache."> 449       * and is generally more accurate in relation to option value updates and how they impact available selectionsðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 450       *                                                                                                            </span>
<span class="8674570395008402319" onmouseenter="enter('8674570395008402319');" onmouseout="out('8674570395008402319');" style=""> 451       * @param option                                                                                              </span>
<span class="6414796960983960786" onmouseenter="enter('6414796960983960786');" onmouseout="out('6414796960983960786');" style=""> 452       * @param order                                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 453       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 454       */                                                                                                           </span>
<span class="6879137344207562675" onmouseenter="enter('6879137344207562675');" onmouseout="out('6879137344207562675');" style=""> 455      protected FieldMetadata createToOneIndividualOptionField(ProductOption option, int order) {                   </span>
<span class="-8449939433228375667" onmouseenter="enter('-8449939433228375667');" onmouseout="out('-8449939433228375667');" style=""> 456          PersistenceManager persistenceManager = PersistenceManagerFactory.getPersistenceManager();                </span>
<span class="-4187363957527008750" onmouseenter="enter('-4187363957527008750');" onmouseout="out('-4187363957527008750');" style=""> 457          FilterMapping filterMapping = new FilterMapping().withDirectFilterValues(                                 </span>
<span class="-3894749102720902409" onmouseenter="enter('-3894749102720902409');" onmouseout="out('-3894749102720902409');" style=""><abbr title=" 458                  sandBoxHelper.mergeCloneIds(ProductOptionImpl.class, option.getId())).withRestriction(new Restriction()"> 458                  sandBoxHelper.mergeCloneIds(ProductOptionImpl.class, option.getId())).withRestriction(new RestrictðŸ”µ</abbr></span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 459              .withPredicateProvider(new PredicateProvider() {                                                      </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 460                  @Override                                                                                         </span>
<span class="-5588636227064039300" onmouseenter="enter('-5588636227064039300');" onmouseout="out('-5588636227064039300');" style=""><abbr title=" 461                  public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder, From root,"> 461                  public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder, From rðŸ”µ</abbr></span>
<span class="-2899522305959899483" onmouseenter="enter('-2899522305959899483');" onmouseout="out('-2899522305959899483');" style=""><abbr title=" 462                                                  String ceilingEntity, String fullPropertyName, Path explicitPath, List directValues) {"> 462                                                  String ceilingEntity, String fullPropertyName, Path explicitPath, ðŸ”µ</abbr></span>
<span class="-933702984903214818" onmouseenter="enter('-933702984903214818');" onmouseout="out('-933702984903214818');" style=""> 463                      return root.get(&quot;productOption&quot;).get(&quot;id&quot;).in(directValues);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 464              }                                                                                                     </span>
<span class="-800954676578401248" onmouseenter="enter('-800954676578401248');" onmouseout="out('-800954676578401248');" style=""> 465          }));                                                                                                      </span>
<span class="9067714061330870114" onmouseenter="enter('9067714061330870114');" onmouseout="out('9067714061330870114');" style=""> 466          List&lt;FilterMapping&gt; mappings = new ArrayList&lt;&gt;();                                                         </span>
<span class="345189471467363285" onmouseenter="enter('345189471467363285');" onmouseout="out('345189471467363285');" style=""> 467          mappings.add(filterMapping);                                                                              </span>
<span class="7291356103073076244" onmouseenter="enter('7291356103073076244');" onmouseout="out('7291356103073076244');" style=""><abbr title=" 468          TypedQuery&lt;Serializable&gt; countQuery = criteriaTranslator.translateCountQuery(persistenceManager.getDynamicEntityDao(),"> 468          TypedQuery&lt;Serializable&gt; countQuery = criteriaTranslator.translateCountQuery(persistenceManager.getDynamicðŸ”µ</abbr></span>
<span class="-6376296202628097343" onmouseenter="enter('-6376296202628097343');" onmouseout="out('-6376296202628097343');" style=""> 469                  ProductOptionValueImpl.class.getName(), mappings);                                                </span>
<span class="5779175921552777483" onmouseenter="enter('5779175921552777483');" onmouseout="out('5779175921552777483');" style=""> 470          Long count = (Long) countQuery.getSingleResult();                                                         </span>
<span class="3590816377844072638" onmouseenter="enter('3590816377844072638');" onmouseout="out('3590816377844072638');" style=""> 471          BasicFieldMetadata metadata = null;                                                                       </span>
<span class="7377439406723422491" onmouseenter="enter('7377439406723422491');" onmouseout="out('7377439406723422491');" style=""> 472          if (count &gt; 0) {                                                                                          </span>
<span class="-1273552772110171187" onmouseenter="enter('-1273552772110171187');" onmouseout="out('-1273552772110171187');" style=""> 473              metadata = new BasicFieldMetadata();                                                                  </span>
<span class="7837199979125359629" onmouseenter="enter('7837199979125359629');" onmouseout="out('7837199979125359629');" style=""> 474              metadata.setFieldType(SupportedFieldType.ADDITIONAL_FOREIGN_KEY);                                     </span>
<span class="-7466329847812031362" onmouseenter="enter('-7466329847812031362');" onmouseout="out('-7466329847812031362');" style=""> 475              metadata.setSecondaryType(SupportedFieldType.INTEGER);                                                </span>
<span class="-31286131392644862" onmouseenter="enter('-31286131392644862');" onmouseout="out('-31286131392644862');" style=""> 476              metadata.setForeignKeyProperty(&quot;id&quot;);                                                                 </span>
<span class="332716961677554697" onmouseenter="enter('332716961677554697');" onmouseout="out('332716961677554697');" style=""> 477              metadata.setForeignKeyClass(ProductOptionValueImpl.class.getName());                                  </span>
<span class="-4184418208857498113" onmouseenter="enter('-4184418208857498113');" onmouseout="out('-4184418208857498113');" style=""> 478              metadata.setForeignKeyDisplayValueProperty(&quot;attributeValue&quot;);                                         </span>
<span class="4257701647031084459" onmouseenter="enter('4257701647031084459');" onmouseout="out('4257701647031084459');" style=""> 479              metadata.setLookupDisplayProperty(&quot;attributeValue&quot;);                                                  </span>
<span class="7303907294085574775" onmouseenter="enter('7303907294085574775');" onmouseout="out('7303907294085574775');" style=""> 480              metadata.setForeignKeyCollection(false);                                                              </span>
<span class="6675602877003966627" onmouseenter="enter('6675602877003966627');" onmouseout="out('6675602877003966627');" style=""> 481              metadata.setCustomCriteria(new String[]{&quot;option=&quot; + String.valueOf(option.getId())});                 </span>
<span class="1748190162337854256" onmouseenter="enter('1748190162337854256');" onmouseout="out('1748190162337854256');" style=""> 482              metadata.setName(PRODUCT_OPTION_FIELD_PREFIX + option.getId());                                       </span>
<span class="7017269500484793927" onmouseenter="enter('7017269500484793927');" onmouseout="out('7017269500484793927');" style=""> 483              metadata.setFriendlyName(option.getLabel());                                                          </span>
<span class="6085246036283927461" onmouseenter="enter('6085246036283927461');" onmouseout="out('6085246036283927461');" style=""> 484              metadata.setGroup(&quot;productOption_group&quot;);                                                             </span>
<span class="-8050220525630720562" onmouseenter="enter('-8050220525630720562');" onmouseout="out('-8050220525630720562');" style=""> 485              metadata.setGroupOrder(-1);                                                                           </span>
<span class="3406381469360124301" onmouseenter="enter('3406381469360124301');" onmouseout="out('3406381469360124301');" style=""> 486              metadata.setOrder(order);                                                                             </span>
<span class="2043314380305444305" onmouseenter="enter('2043314380305444305');" onmouseout="out('2043314380305444305');" style=""> 487              metadata.setExplicitFieldType(SupportedFieldType.ADDITIONAL_FOREIGN_KEY);                             </span>
<span class="-6994608424159816416" onmouseenter="enter('-6994608424159816416');" onmouseout="out('-6994608424159816416');" style=""> 488              metadata.setProminent(false);                                                                         </span>
<span class="6274758849936387106" onmouseenter="enter('6274758849936387106');" onmouseout="out('6274758849936387106');" style=""> 489              metadata.setVisibility(VisibilityEnum.FORM_EXPLICITLY_SHOWN);                                         </span>
<span class="8076682597610338410" onmouseenter="enter('8076682597610338410');" onmouseout="out('8076682597610338410');" style=""> 490              metadata.setReadOnly(false);                                                                          </span>
<span class="-4603246565563510167" onmouseenter="enter('-4603246565563510167');" onmouseout="out('-4603246565563510167');" style=""><abbr title=" 491              //these may not be actually required, but the CPH has this as a requirement for parsing the data, so we&#x27;ll stick with it here"> 491              //these may not be actually required, but the CPH has this as a requirement for parsing the data, so wðŸ”µ</abbr></span>
<span class="6102752219358130186" onmouseenter="enter('6102752219358130186');" onmouseout="out('6102752219358130186');" style=""> 492              metadata.setRequiredOverride(true);                                                                   </span>
<span class="-3053289446243924099" onmouseenter="enter('-3053289446243924099');" onmouseout="out('-3053289446243924099');" style=""> 493              metadata.setLookupType(LookupType.STANDARD);                                                          </span>
<span class="-6206284717251400514" onmouseenter="enter('-6206284717251400514');" onmouseout="out('-6206284717251400514');" style=""> 494              metadata.setMutable(true);                                                                            </span>
<span class="8194069883044431071" onmouseenter="enter('8194069883044431071');" onmouseout="out('8194069883044431071');" style=""> 495              metadata.setInheritedFromType(SkuImpl.class.getName());                                               </span>
<span class="7921709413407422398" onmouseenter="enter('7921709413407422398');" onmouseout="out('7921709413407422398');" style=""><abbr title=" 496              metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCache()));"> 496              metadata.setAvailableToTypes(getPolymorphicClasses(SkuImpl.class, em, skuMetadataCacheService.useCacheðŸ”µ</abbr></span>
<span class="-1649079592520542152" onmouseenter="enter('-1649079592520542152');" onmouseout="out('-1649079592520542152');" style=""> 497              metadata.setMergedPropertyType(MergedPropertyType.PRIMARY);                                           </span>
<span class="5062289219461079509" onmouseenter="enter('5062289219461079509');" onmouseout="out('5062289219461079509');" style=""> 498              metadata.setTargetClass(SkuImpl.class.getName());                                                     </span>
<span class="-6501495819508426588" onmouseenter="enter('-6501495819508426588');" onmouseout="out('-6501495819508426588');" style=""> 499              metadata.setFieldName(PRODUCT_OPTION_FIELD_PREFIX + option.getId());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 500          }                                                                                                         </span>
<span class="-6736542809122384852" onmouseenter="enter('-6736542809122384852');" onmouseout="out('-6736542809122384852');" style=""> 501          return metadata;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 502      }                                                                                                             </span>
<span  style=""> 503                                                                                                                    </span>
<span class="7948482626287429940" onmouseenter="enter('7948482626287429940');" onmouseout="out('7948482626287429940');" style=""> 504      @SuppressWarnings(&quot;unchecked&quot;)                                                                                </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 505      @Override                                                                                                     </span>
<span class="-1282377985319068039" onmouseenter="enter('-1282377985319068039');" onmouseout="out('-1282377985319068039');" style=""><abbr title=" 506      public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 506      public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynamicEntityðŸ”µ</abbr></span>
<span class="2519389108374285224" onmouseenter="enter('2519389108374285224');" onmouseout="out('2519389108374285224');" style=""><abbr title=" 507          String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname();"> 507          String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname()ðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 508          try {                                                                                                     </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""> 509              PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();       </span>
<span class="-4474933170501730421" onmouseenter="enter('-4474933170501730421');" onmouseout="out('-4474933170501730421');" style=""> 510              //get the default properties from Sku and its subclasses                                              </span>
<span class="-1647605982225346371" onmouseenter="enter('-1647605982225346371');" onmouseout="out('-1647605982225346371');" style=""><abbr title=" 511              Map&lt;String, FieldMetadata&gt; originalProps = helper.getSimpleMergedProperties(Sku.class.getName(), persistencePerspective);"> 511              Map&lt;String, FieldMetadata&gt; originalProps = helper.getSimpleMergedProperties(Sku.class.getName(), persiðŸ”µ</abbr></span>
<span  style=""> 512                                                                                                                    </span>
<span class="796362017556902885" onmouseenter="enter('796362017556902885');" onmouseout="out('796362017556902885');" style=""> 513              //Pull back the Skus based on the criteria from the client                                            </span>
<span class="-363648758652557915" onmouseenter="enter('-363648758652557915');" onmouseout="out('-363648758652557915');" style=""><abbr title=" 514              List&lt;FilterMapping&gt; filterMappings = helper.getFilterMappings(persistencePerspective, cto, ceilingEntityFullyQualifiedClassname, originalProps);"> 514              List&lt;FilterMapping&gt; filterMappings = helper.getFilterMappings(persistencePerspective, cto, ceilingEntiðŸ”µ</abbr></span>
<span  style=""> 515                                                                                                                    </span>
<span class="-3675685187725351740" onmouseenter="enter('-3675685187725351740');" onmouseout="out('-3675685187725351740');" style=""> 516              //allow subclasses to provide additional criteria before executing the query                          </span>
<span class="-7008588708271197253" onmouseenter="enter('-7008588708271197253');" onmouseout="out('-7008588708271197253');" style=""> 517              applyProductOptionValueCriteria(filterMappings, cto, persistencePackage, null);                       </span>
<span class="4646076149717404025" onmouseenter="enter('4646076149717404025');" onmouseout="out('4646076149717404025');" style=""> 518              applySkuBundleItemValueCriteria(filterMappings, cto, persistencePackage);                             </span>
<span class="-2737785807325266" onmouseenter="enter('-2737785807325266');" onmouseout="out('-2737785807325266');" style=""> 519              applyAdditionalFetchCriteria(filterMappings, cto, persistencePackage);                                </span>
<span  style=""> 520                                                                                                                    </span>
<span class="-4634567455719757558" onmouseenter="enter('-4634567455719757558');" onmouseout="out('-4634567455719757558');" style=""><abbr title=" 521              List&lt;Serializable&gt; records = helper.getPersistentRecords(persistencePackage.getCeilingEntityFullyQualifiedClassname(), filterMappings, cto.getFirstResult(), cto.getMaxResults());"> 521              List&lt;Serializable&gt; records = helper.getPersistentRecords(persistencePackage.getCeilingEntityFullyQualiðŸ”µ</abbr></span>
<span class="-5982273033000910285" onmouseenter="enter('-5982273033000910285');" onmouseout="out('-5982273033000910285');" style=""> 522              //Convert Skus into the client-side Entity representation                                             </span>
<span class="-2996861390233909505" onmouseenter="enter('-2996861390233909505');" onmouseout="out('-2996861390233909505');" style=""> 523              Entity[] payload = helper.getRecords(originalProps, records);                                         </span>
<span  style=""> 524                                                                                                                    </span>
<span class="-4184869795171170066" onmouseenter="enter('-4184869795171170066');" onmouseout="out('-4184869795171170066');" style=""><abbr title=" 525              int totalRecords = helper.getTotalRecords(persistencePackage.getCeilingEntityFullyQualifiedClassname(), filterMappings);"> 525              int totalRecords = helper.getTotalRecords(persistencePackage.getCeilingEntityFullyQualifiedClassname()ðŸ”µ</abbr></span>
<span  style=""> 526                                                                                                                    </span>
<span class="-3763055148335758582" onmouseenter="enter('-3763055148335758582');" onmouseout="out('-3763055148335758582');" style=""> 527              //Now fill out the relevant properties for the product options for the Skus that were returned        </span>
<span class="7697812602397668509" onmouseenter="enter('7697812602397668509');" onmouseout="out('7697812602397668509');" style=""> 528              updateProductOptionFieldsForFetch(records, payload);                                                  </span>
<span  style=""> 529                                                                                                                    </span>
<span class="-8933105127068001704" onmouseenter="enter('-8933105127068001704');" onmouseout="out('-8933105127068001704');" style=""> 530              return new DynamicResultSet(payload, totalRecords);                                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 531          } catch (Exception e) {                                                                                   </span>
<span class="733531699862187915" onmouseenter="enter('733531699862187915');" onmouseout="out('733531699862187915');" style=""><abbr title=" 532              throw new ServiceException(&quot;Unable to perform fetch for entity: &quot; + ceilingEntityFullyQualifiedClassname, e);"> 532              throw new ServiceException(&quot;Unable to perform fetch for entity: &quot; + ceilingEntityFullyQualifiedClassnaðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 533          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 534      }                                                                                                             </span>
<span  style=""> 535                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 536      /**                                                                                                           </span>
<span class="-7824652902262605659" onmouseenter="enter('-7824652902262605659');" onmouseout="out('-7824652902262605659');" style=""><abbr title=" 537       * Sets the {@link ProductOptionValue}s of the given {@link Sku}s in a list format for display in a ListGrid context."> 537       * Sets the {@link ProductOptionValue}s of the given {@link Sku}s in a list format for display in a ListGrid cðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 538       *                                                                                                            </span>
<span class="-4052130305078083276" onmouseenter="enter('-4052130305078083276');" onmouseout="out('-4052130305078083276');" style=""> 539       * @param records                                                                                             </span>
<span class="-6904460697287898969" onmouseenter="enter('-6904460697287898969');" onmouseout="out('-6904460697287898969');" style=""> 540       * @param payload                                                                                             </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 541       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 542       */                                                                                                           </span>
<span class="3124517244149022485" onmouseenter="enter('3124517244149022485');" onmouseout="out('3124517244149022485');" style=""> 543      public void updateProductOptionFieldsForFetch(List&lt;Serializable&gt; records, Entity[] payload) {                 </span>
<span class="-7972041122971845939" onmouseenter="enter('-7972041122971845939');" onmouseout="out('-7972041122971845939');" style=""> 544          for (int i = 0; i &lt; records.size(); i++) {                                                                </span>
<span class="-3191004483130397206" onmouseenter="enter('-3191004483130397206');" onmouseout="out('-3191004483130397206');" style=""> 545              Sku sku = (Sku) records.get(i);                                                                       </span>
<span class="6067761635845867397" onmouseenter="enter('6067761635845867397');" onmouseout="out('6067761635845867397');" style=""> 546              Entity entity = payload[i];                                                                           </span>
<span  style=""> 547                                                                                                                    </span>
<span class="-1747148511640135280" onmouseenter="enter('-1747148511640135280');" onmouseout="out('-1747148511640135280');" style=""><abbr title=" 548              List&lt;ProductOptionValue&gt; optionValues = BLCCollectionUtils.collectList(sku.getProductOptionValueXrefs(), new TypedTransformer&lt;ProductOptionValue&gt;() {"> 548              List&lt;ProductOptionValue&gt; optionValues = BLCCollectionUtils.collectList(sku.getProductOptionValueXrefs(ðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 549                  @Override                                                                                         </span>
<span class="1152092933178682803" onmouseenter="enter('1152092933178682803');" onmouseout="out('1152092933178682803');" style=""> 550                  public ProductOptionValue transform(Object input) {                                               </span>
<span class="-8868352318711405431" onmouseenter="enter('-8868352318711405431');" onmouseout="out('-8868352318711405431');" style=""> 551                      return ((SkuProductOptionValueXref) input).getProductOptionValue();                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 552                  }                                                                                                 </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 553              });                                                                                                   </span>
<span  style=""> 554                                                                                                                    </span>
<span class="-1852425527821468846" onmouseenter="enter('-1852425527821468846');" onmouseout="out('-1852425527821468846');" style=""> 555              for (ProductOptionValue value : optionValues) {                                                       </span>
<span class="6080984475054679236" onmouseenter="enter('6080984475054679236');" onmouseout="out('6080984475054679236');" style=""> 556                  Property optionProperty = new Property();                                                         </span>
<span class="4438211203610377533" onmouseenter="enter('4438211203610377533');" onmouseout="out('4438211203610377533');" style=""> 557                  optionProperty.setName(PRODUCT_OPTION_FIELD_PREFIX + value.getProductOption().getId());           </span>
<span class="-3040338369255071721" onmouseenter="enter('-3040338369255071721');" onmouseout="out('-3040338369255071721');" style=""> 558                  optionProperty.setValue(value.getId().toString());                                                </span>
<span class="4260727162498882307" onmouseenter="enter('4260727162498882307');" onmouseout="out('4260727162498882307');" style=""> 559                  optionProperty.setDisplayValue(value.getAttributeValue());                                        </span>
<span class="1859377182209271680" onmouseenter="enter('1859377182209271680');" onmouseout="out('1859377182209271680');" style=""> 560                  entity.addProperty(optionProperty);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 561              }                                                                                                     </span>
<span  style=""> 562                                                                                                                    </span>
<span class="4597418554840578281" onmouseenter="enter('4597418554840578281');" onmouseout="out('4597418554840578281');" style=""> 563              if (CollectionUtils.isNotEmpty(optionValues)) {                                                       </span>
<span class="5213586233451889239" onmouseenter="enter('5213586233451889239');" onmouseout="out('5213586233451889239');" style=""> 564                  entity.addProperty(getConsolidatedOptionProperty(optionValues));                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 565              } else {                                                                                              </span>
<span class="-6341791635059832722" onmouseenter="enter('-6341791635059832722');" onmouseout="out('-6341791635059832722');" style=""> 566                  entity.addProperty(getBlankConsolidatedOptionProperty());                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 567              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 568          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 569      }                                                                                                             </span>
<span  style=""> 570                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 571      /**                                                                                                           </span>
<span class="7787882510504443634" onmouseenter="enter('7787882510504443634');" onmouseout="out('7787882510504443634');" style=""> 572       * Add filter restriction such that a ProductBundle cannot add its own default sku as a Sku Bundle Item       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 573       */                                                                                                           </span>
<span class="-7214039343588646460" onmouseenter="enter('-7214039343588646460');" onmouseout="out('-7214039343588646460');" style=""><abbr title=" 574      private void applySkuBundleItemValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PersistencePackage persistencePackage) {"> 574      private void applySkuBundleItemValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PðŸ”µ</abbr></span>
<span class="-8187222964943103604" onmouseenter="enter('-8187222964943103604');" onmouseout="out('-8187222964943103604');" style=""> 575          SectionCrumb[] sectionCrumbs = persistencePackage.getSectionCrumbs();                                     </span>
<span class="-1899330423728999759" onmouseenter="enter('-1899330423728999759');" onmouseout="out('-1899330423728999759');" style=""> 576          if (isSkuBundleItemLookup(persistencePackage, sectionCrumbs)) {                                           </span>
<span class="8268114114086125791" onmouseenter="enter('8268114114086125791');" onmouseout="out('8268114114086125791');" style=""> 577              final Long defaultSkuId = getOwningProductBundlesDefaultSkuId(sectionCrumbs[0]);                      </span>
<span  style=""> 578                                                                                                                    </span>
<span class="8197169377808819118" onmouseenter="enter('8197169377808819118');" onmouseout="out('8197169377808819118');" style=""> 579              filterMappings.add(new FilterMapping()                                                                </span>
<span class="-2686901866072439951" onmouseenter="enter('-2686901866072439951');" onmouseout="out('-2686901866072439951');" style=""> 580                      .withDirectFilterValues(Collections.singletonList(defaultSkuId))                              </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 581                      .withRestriction(new Restriction()                                                            </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 582                                      .withPredicateProvider(new PredicateProvider() {                              </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 583                                          @Override                                                                 </span>
<span class="-6543887403560352788" onmouseenter="enter('-6543887403560352788');" onmouseout="out('-6543887403560352788');" style=""> 584                                          public Predicate buildPredicate(CriteriaBuilder builder,                  </span>
<span class="-7125560532692692259" onmouseenter="enter('-7125560532692692259');" onmouseout="out('-7125560532692692259');" style=""> 585                                                  FieldPathBuilder fieldPathBuilder,                                </span>
<span class="8221798817053541417" onmouseenter="enter('8221798817053541417');" onmouseout="out('8221798817053541417');" style=""> 586                                                  From root, String ceilingEntity,                                  </span>
<span class="-5624751861859036647" onmouseenter="enter('-5624751861859036647');" onmouseout="out('-5624751861859036647');" style=""> 587                                                  String fullPropertyName, Path explicitPath,                       </span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style=""> 588                                                  List directValues) {                                              </span>
<span class="4460015033870714518" onmouseenter="enter('4460015033870714518');" onmouseout="out('4460015033870714518');" style=""> 589                                              return builder.notEqual(root, directValues.get(0));                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 590                                          }                                                                         </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 591                                      })                                                                            </span>
<span class="3699784701886273761" onmouseenter="enter('3699784701886273761');" onmouseout="out('3699784701886273761');" style=""> 592                      ));                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 593          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 594      }                                                                                                             </span>
<span  style=""> 595                                                                                                                    </span>
<span class="-2798114006144580065" onmouseenter="enter('-2798114006144580065');" onmouseout="out('-2798114006144580065');" style=""> 596      private boolean isSkuBundleItemLookup(PersistencePackage pkg, SectionCrumb[] sectionCrumbs) {                 </span>
<span class="1586917148156434191" onmouseenter="enter('1586917148156434191');" onmouseout="out('1586917148156434191');" style=""> 597          boolean owningClassMatch = false;                                                                         </span>
<span class="-67344974392233049" onmouseenter="enter('-67344974392233049');" onmouseout="out('-67344974392233049');" style=""> 598          boolean requestingFieldMatch = false;                                                                     </span>
<span  style=""> 599                                                                                                                    </span>
<span class="-4586108065315097422" onmouseenter="enter('-4586108065315097422');" onmouseout="out('-4586108065315097422');" style=""> 600          if (pkg.getCustomCriteria() == null || ArrayUtils.isEmpty(sectionCrumbs)) {                               </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 601              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 602          }                                                                                                         </span>
<span  style=""> 603                                                                                                                    </span>
<span class="-2549092676085499199" onmouseenter="enter('-2549092676085499199');" onmouseout="out('-2549092676085499199');" style=""> 604          for (String criteria : pkg.getCustomCriteria()) {                                                         </span>
<span class="-2108620833305617258" onmouseenter="enter('-2108620833305617258');" onmouseout="out('-2108620833305617258');" style=""> 605              if (&quot;owningClass=org.broadleafcommerce.core.catalog.domain.SkuBundleItemImpl&quot;.equals(criteria)) {     </span>
<span class="8041666773318789268" onmouseenter="enter('8041666773318789268');" onmouseout="out('8041666773318789268');" style=""> 606                  owningClassMatch = true;                                                                          </span>
<span class="4858029770045852471" onmouseenter="enter('4858029770045852471');" onmouseout="out('4858029770045852471');" style=""> 607              } else if (&quot;requestingField=sku&quot;.equals(criteria)) {                                                  </span>
<span class="-1860793199325339033" onmouseenter="enter('-1860793199325339033');" onmouseout="out('-1860793199325339033');" style=""> 608                  requestingFieldMatch = true;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 609              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 610          }                                                                                                         </span>
<span  style=""> 611                                                                                                                    </span>
<span class="-3217646211476483325" onmouseenter="enter('-3217646211476483325');" onmouseout="out('-3217646211476483325');" style=""><abbr title=" 612          boolean sectionCrumbMatch = ProductImpl.class.getCanonicalName().equals(sectionCrumbs[0].getSectionIdentifier());"> 612          boolean sectionCrumbMatch = ProductImpl.class.getCanonicalName().equals(sectionCrumbs[0].getSectionIdentifðŸ”µ</abbr></span>
<span  style=""> 613                                                                                                                    </span>
<span class="6240774352197414719" onmouseenter="enter('6240774352197414719');" onmouseout="out('6240774352197414719');" style=""> 614          return owningClassMatch &amp;&amp; requestingFieldMatch &amp;&amp; sectionCrumbMatch;                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 615      }                                                                                                             </span>
<span  style=""> 616                                                                                                                    </span>
<span class="-1671571892486457707" onmouseenter="enter('-1671571892486457707');" onmouseout="out('-1671571892486457707');" style=""> 617      private Long getOwningProductBundlesDefaultSkuId(SectionCrumb sectionCrumb) {                                 </span>
<span class="2328697212854986127" onmouseenter="enter('2328697212854986127');" onmouseout="out('2328697212854986127');" style=""> 618          if (ProductImpl.class.getCanonicalName().equals(sectionCrumb.getSectionIdentifier())                      </span>
<span class="-9004648441586212047" onmouseenter="enter('-9004648441586212047');" onmouseout="out('-9004648441586212047');" style=""> 619                  &amp;&amp; sectionCrumb.getSectionId() != null) {                                                         </span>
<span class="4513323716586759964" onmouseenter="enter('4513323716586759964');" onmouseout="out('4513323716586759964');" style=""><abbr title=" 620              ProductBundle productBundle = (ProductBundle) catalogService.findProductById(Long.valueOf(sectionCrumb.getSectionId()));"> 620              ProductBundle productBundle = (ProductBundle) catalogService.findProductById(Long.valueOf(sectionCrumbðŸ”µ</abbr></span>
<span class="4400035530065637673" onmouseenter="enter('4400035530065637673');" onmouseout="out('4400035530065637673');" style=""> 621              return productBundle.getDefaultSku().getId();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 622          }                                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 623          return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 624      }                                                                                                             </span>
<span  style=""> 625                                                                                                                    </span>
<span class="-7687230963098454148" onmouseenter="enter('-7687230963098454148');" onmouseout="out('-7687230963098454148');" style=""><abbr title=" 626      public void applyProductOptionValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PersistencePackage persistencePackage, String skuPropertyPrefix) {"> 626      public void applyProductOptionValueCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PeðŸ”µ</abbr></span>
<span  style=""> 627                                                                                                                    </span>
<span class="942620444934049587" onmouseenter="enter('942620444934049587');" onmouseout="out('942620444934049587');" style=""> 628          //if the front                                                                                            </span>
<span class="8112796229062982729" onmouseenter="enter('8112796229062982729');" onmouseout="out('8112796229062982729');" style=""> 629          final List&lt;Long&gt; productOptionValueFilterIDs = new ArrayList&lt;&gt;();                                         </span>
<span class="-6853245302921753815" onmouseenter="enter('-6853245302921753815');" onmouseout="out('-6853245302921753815');" style=""> 630          for (String filterProperty : cto.getCriteriaMap().keySet()) {                                             </span>
<span class="-4107857553734806058" onmouseenter="enter('-4107857553734806058');" onmouseout="out('-4107857553734806058');" style=""> 631              if (filterProperty.startsWith(PRODUCT_OPTION_FIELD_PREFIX)) {                                         </span>
<span class="-1621748473978415179" onmouseenter="enter('-1621748473978415179');" onmouseout="out('-1621748473978415179');" style=""> 632                  FilterAndSortCriteria criteria = cto.get(filterProperty);                                         </span>
<span class="5553495253525789791" onmouseenter="enter('5553495253525789791');" onmouseout="out('5553495253525789791');" style=""> 633                  productOptionValueFilterIDs.add(Long.parseLong(criteria.getFilterValues().get(0)));               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 634              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 635          }                                                                                                         </span>
<span  style=""> 636                                                                                                                    </span>
<span class="4522856558687017152" onmouseenter="enter('4522856558687017152');" onmouseout="out('4522856558687017152');" style=""> 637          //also determine if there is a consolidated POV query                                                     </span>
<span class="-8501099544391483771" onmouseenter="enter('-8501099544391483771');" onmouseout="out('-8501099544391483771');" style=""> 638          final List&lt;String&gt; productOptionValueFilterValues = new ArrayList&lt;&gt;();                                    </span>
<span class="-3774683769233331029" onmouseenter="enter('-3774683769233331029');" onmouseout="out('-3774683769233331029');" style=""> 639          FilterAndSortCriteria consolidatedCriteria = cto.get(CONSOLIDATED_PRODUCT_OPTIONS_FIELD_NAME);            </span>
<span class="3919937138964866453" onmouseenter="enter('3919937138964866453');" onmouseout="out('3919937138964866453');" style=""> 640          if (!consolidatedCriteria.getFilterValues().isEmpty()) {                                                  </span>
<span class="-8697432381506519263" onmouseenter="enter('-8697432381506519263');" onmouseout="out('-8697432381506519263');" style=""> 641              //the criteria in this case would be a semi-colon delimeter value list                                </span>
<span class="-2544935018250883467" onmouseenter="enter('-2544935018250883467');" onmouseout="out('-2544935018250883467');" style=""><abbr title=" 642              productOptionValueFilterValues.addAll(Arrays.asList(StringUtils.split(consolidatedCriteria.getFilterValues().get(0), CONSOLIDATED_PRODUCT_OPTIONS_DELIMETER)));"> 642              productOptionValueFilterValues.addAll(Arrays.asList(StringUtils.split(consolidatedCriteria.getFilterVaðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 643          }                                                                                                         </span>
<span  style=""> 644                                                                                                                    </span>
<span class="-3296023389552605288" onmouseenter="enter('-3296023389552605288');" onmouseout="out('-3296023389552605288');" style=""> 645          if (productOptionValueFilterIDs.size() &gt; 0) {                                                             </span>
<span class="-3028331070500986006" onmouseenter="enter('-3028331070500986006');" onmouseout="out('-3028331070500986006');" style=""> 646              FilterMapping filterMapping = new FilterMapping()                                                     </span>
<span class="3198376136531373476" onmouseenter="enter('3198376136531373476');" onmouseout="out('3198376136531373476');" style=""><abbr title=" 647                  .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?&quot;&quot;:skuPropertyPrefix + &quot;.productOptionValueXrefs.productOptionValue.id&quot;))"> 647                  .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?&quot;&quot;:skuProðŸ”µ</abbr></span>
<span class="-3630476675353547213" onmouseenter="enter('-3630476675353547213');" onmouseout="out('-3630476675353547213');" style=""> 648                  .withDirectFilterValues(productOptionValueFilterIDs)                                              </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 649                  .withRestriction(new Restriction()                                                                </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 650                      .withPredicateProvider(new PredicateProvider() {                                              </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 651                          @Override                                                                                 </span>
<span class="-33431144742852463" onmouseenter="enter('-33431144742852463');" onmouseout="out('-33431144742852463');" style=""><abbr title=" 652                          public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,"> 652                          public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilderðŸ”µ</abbr></span>
<span class="8221798817053541417" onmouseenter="enter('8221798817053541417');" onmouseout="out('8221798817053541417');" style=""> 653                                                          From root, String ceilingEntity,                          </span>
<span class="-6963673837518342908" onmouseenter="enter('-6963673837518342908');" onmouseout="out('-6963673837518342908');" style=""><abbr title=" 654                                                          String fullPropertyName, Path explicitPath, List directValues) {"> 654                                                          String fullPropertyName, Path explicitPath, List directValðŸ”µ</abbr></span>
<span class="-6719486958351285112" onmouseenter="enter('-6719486958351285112');" onmouseout="out('-6719486958351285112');" style=""> 655                              return explicitPath.as(Long.class).in(directValues);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 656                          }                                                                                         </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 657                      })                                                                                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 658                  );                                                                                                </span>
<span class="-2605411155138525883" onmouseenter="enter('-2605411155138525883');" onmouseout="out('-2605411155138525883');" style=""> 659              filterMappings.add(filterMapping);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 660          }                                                                                                         </span>
<span class="36743717647982951" onmouseenter="enter('36743717647982951');" onmouseout="out('36743717647982951');" style=""> 661          if (productOptionValueFilterValues.size() &gt; 0) {                                                          </span>
<span class="-3028331070500986006" onmouseenter="enter('-3028331070500986006');" onmouseout="out('-3028331070500986006');" style=""> 662              FilterMapping filterMapping = new FilterMapping()                                                     </span>
<span class="8503258665314341487" onmouseenter="enter('8503258665314341487');" onmouseout="out('8503258665314341487');" style=""><abbr title=" 663                  .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?&quot;&quot;:skuPropertyPrefix + &quot;.productOptionValueXrefs.productOptionValue.attributeValue&quot;))"> 663                  .withFieldPath(new FieldPath().withTargetProperty(StringUtils.isEmpty(skuPropertyPrefix)?&quot;&quot;:skuProðŸ”µ</abbr></span>
<span class="-7312773306171765245" onmouseenter="enter('-7312773306171765245');" onmouseout="out('-7312773306171765245');" style=""> 664                  .withDirectFilterValues(productOptionValueFilterValues)                                           </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 665                  .withRestriction(new Restriction()                                                                </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 666                      .withPredicateProvider(new PredicateProvider() {                                              </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 667                          @Override                                                                                 </span>
<span class="-33431144742852463" onmouseenter="enter('-33431144742852463');" onmouseout="out('-33431144742852463');" style=""><abbr title=" 668                          public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,"> 668                          public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilderðŸ”µ</abbr></span>
<span class="8221798817053541417" onmouseenter="enter('8221798817053541417');" onmouseout="out('8221798817053541417');" style=""> 669                                                          From root, String ceilingEntity,                          </span>
<span class="-6963673837518342908" onmouseenter="enter('-6963673837518342908');" onmouseout="out('-6963673837518342908');" style=""><abbr title=" 670                                                          String fullPropertyName, Path explicitPath, List directValues) {"> 670                                                          String fullPropertyName, Path explicitPath, List directValðŸ”µ</abbr></span>
<span class="-2981715763030013918" onmouseenter="enter('-2981715763030013918');" onmouseout="out('-2981715763030013918');" style=""> 671                              return explicitPath.as(String.class).in(directValues);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 672                          }                                                                                         </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 673                      })                                                                                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 674                  );                                                                                                </span>
<span class="-2605411155138525883" onmouseenter="enter('-2605411155138525883');" onmouseout="out('-2605411155138525883');" style=""> 675              filterMappings.add(filterMapping);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 676          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 677      }                                                                                                             </span>
<span  style=""> 678                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 679      /**                                                                                                           </span>
<span class="-8618302828054746698" onmouseenter="enter('-8618302828054746698');" onmouseout="out('-8618302828054746698');" style=""><abbr title=" 680       * &lt;p&gt;Available override point for subclasses if they would like to add additional criteria via the queryCritiera. At the"> 680       * &lt;p&gt;Available override point for subclasses if they would like to add additional criteria via the queryCritiðŸ”µ</abbr></span>
<span class="5710282049517599386" onmouseenter="enter('5710282049517599386');" onmouseout="out('5710282049517599386');" style=""><abbr title=" 681       * point that this method has been called, criteria from the frontend has already been applied, thus allowing you to"> 681       * point that this method has been called, criteria from the frontend has already been applied, thus allowing ðŸ”µ</abbr></span>
<span class="-8977449216901818262" onmouseenter="enter('-8977449216901818262');" onmouseout="out('-8977449216901818262');" style=""> 682       * override from there as well.&lt;/p&gt;                                                                           </span>
<span class="6192892703049124137" onmouseenter="enter('6192892703049124137');" onmouseout="out('6192892703049124137');" style=""><abbr title=" 683       * &lt;p&gt;Subclasses that choose to override this should also call this super method so that correct filter criteria"> 683       * &lt;p&gt;Subclasses that choose to override this should also call this super method so that correct filter criterðŸ”µ</abbr></span>
<span class="4504111184556558489" onmouseenter="enter('4504111184556558489');" onmouseout="out('4504111184556558489');" style=""> 684       * can be applied for product option values&lt;/p&gt;                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 685       *                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 686       */                                                                                                           </span>
<span class="6595350754076949595" onmouseenter="enter('6595350754076949595');" onmouseout="out('6595350754076949595');" style=""><abbr title=" 687      public void applyAdditionalFetchCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PersistencePackage persistencePackage) {"> 687      public void applyAdditionalFetchCriteria(List&lt;FilterMapping&gt; filterMappings, CriteriaTransferObject cto, PersiðŸ”µ</abbr></span>
<span class="-9143014012238338039" onmouseenter="enter('-9143014012238338039');" onmouseout="out('-9143014012238338039');" style=""> 688          //unimplemented                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 689      }                                                                                                             </span>
<span  style=""> 690                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 691      @Override                                                                                                     </span>
<span class="-3782560920985534584" onmouseenter="enter('-3782560920985534584');" onmouseout="out('-3782560920985534584');" style=""><abbr title=" 692      public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 692      public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helpeðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 693          Entity entity = persistencePackage.getEntity();                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 694          try {                                                                                                     </span>
<span class="2168419604722842668" onmouseenter="enter('2168419604722842668');" onmouseout="out('2168419604722842668');" style=""> 695              //Fill out the Sku instance from the form                                                             </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""> 696              PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();       </span>
<span class="-2646375190695846844" onmouseenter="enter('-2646375190695846844');" onmouseout="out('-2646375190695846844');" style=""> 697              Sku adminInstance = (Sku) Class.forName(entity.getType()[0]).newInstance();                           </span>
<span class="1729465429044706845" onmouseenter="enter('1729465429044706845');" onmouseout="out('1729465429044706845');" style=""><abbr title=" 698              Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getName(), persistencePerspective);"> 698              Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getName(), perðŸ”µ</abbr></span>
<span class="-7453227611519095000" onmouseenter="enter('-7453227611519095000');" onmouseout="out('-7453227611519095000');" style=""> 699              filterOutProductMetadata(adminProperties);                                                            </span>
<span class="2916291722905579881" onmouseenter="enter('2916291722905579881');" onmouseout="out('2916291722905579881');" style=""> 700              adminInstance = (Sku) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);  </span>
<span  style=""> 701                                                                                                                    </span>
<span class="561479470093632813" onmouseenter="enter('561479470093632813');" onmouseout="out('561479470093632813');" style=""> 702              //Verify that there isn&#x27;t already a Sku for this particular product option value combo                </span>
<span class="-7646105610360359073" onmouseenter="enter('-7646105610360359073');" onmouseout="out('-7646105610360359073');" style=""> 703              Entity errorEntity = validateUniqueProductOptionValueCombination(adminInstance.getProduct(),          </span>
<span class="7978785476337646518" onmouseenter="enter('7978785476337646518');" onmouseout="out('7978785476337646518');" style=""> 704                                                                               getProductOptionProperties(entity),  </span>
<span class="-5950258146809433717" onmouseenter="enter('-5950258146809433717');" onmouseout="out('-5950258146809433717');" style=""> 705                                                                               null);                               </span>
<span class="315758838568217561" onmouseenter="enter('315758838568217561');" onmouseout="out('315758838568217561');" style=""> 706              if (errorEntity != null) {                                                                            </span>
<span class="-6380597201056661281" onmouseenter="enter('-6380597201056661281');" onmouseout="out('-6380597201056661281');" style=""> 707                  entity.setPropertyValidationErrors(errorEntity.getPropertyValidationErrors());                    </span>
<span class="-7572797105708032926" onmouseenter="enter('-7572797105708032926');" onmouseout="out('-7572797105708032926');" style=""> 708                  return entity;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 709              }                                                                                                     </span>
<span  style=""> 710                                                                                                                    </span>
<span class="-5884073955982735941" onmouseenter="enter('-5884073955982735941');" onmouseout="out('-5884073955982735941');" style=""> 711              //persist the newly-created Sku                                                                       </span>
<span class="8006946942803724880" onmouseenter="enter('8006946942803724880');" onmouseout="out('8006946942803724880');" style=""> 712              adminInstance = dynamicEntityDao.persist(adminInstance);                                              </span>
<span  style=""> 713                                                                                                                    </span>
<span class="-704220126533799367" onmouseenter="enter('-704220126533799367');" onmouseout="out('-704220126533799367');" style=""> 714              //associate the product option values                                                                 </span>
<span class="4472814042081188939" onmouseenter="enter('4472814042081188939');" onmouseout="out('4472814042081188939');" style=""> 715              associateProductOptionValuesToSku(entity, adminInstance, dynamicEntityDao);                           </span>
<span  style=""> 716                                                                                                                    </span>
<span class="-5246565985745556188" onmouseenter="enter('-5246565985745556188');" onmouseout="out('-5246565985745556188');" style=""> 717              //After associating the product option values, save off the Sku                                       </span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 718              adminInstance = dynamicEntityDao.merge(adminInstance);                                                </span>
<span  style=""> 719                                                                                                                    </span>
<span class="-2729035098975137606" onmouseenter="enter('-2729035098975137606');" onmouseout="out('-2729035098975137606');" style=""> 720              //Fill out the DTO and add in the product option value properties to it                               </span>
<span class="8927160133375333586" onmouseenter="enter('8927160133375333586');" onmouseout="out('8927160133375333586');" style=""> 721              Entity result = helper.getRecord(adminProperties, adminInstance, null, null);                         </span>
<span class="-1352652314153256295" onmouseenter="enter('-1352652314153256295');" onmouseout="out('-1352652314153256295');" style=""> 722              for (Property property : getProductOptionProperties(entity)) {                                        </span>
<span class="-6991744037283748574" onmouseenter="enter('-6991744037283748574');" onmouseout="out('-6991744037283748574');" style=""> 723                  result.addProperty(property);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 724              }                                                                                                     </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 725              return result;                                                                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 726          } catch (Exception e) {                                                                                   </span>
<span class="3314391270131938130" onmouseenter="enter('3314391270131938130');" onmouseout="out('3314391270131938130');" style=""> 727              throw new ServiceException(&quot;Unable to perform fetch for entity: &quot; + Sku.class.getName(), e);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 728          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 729      }                                                                                                             </span>
<span  style=""> 730                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 731      @Override                                                                                                     </span>
<span class="-7421665622225711363" onmouseenter="enter('-7421665622225711363');" onmouseout="out('-7421665622225711363');" style=""><abbr title=" 732      public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 732      public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper heðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 733          Entity entity = persistencePackage.getEntity();                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 734          try {                                                                                                     </span>
<span class="2168419604722842668" onmouseenter="enter('2168419604722842668');" onmouseout="out('2168419604722842668');" style=""> 735              //Fill out the Sku instance from the form                                                             </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""> 736              PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();       </span>
<span class="1729465429044706845" onmouseenter="enter('1729465429044706845');" onmouseout="out('1729465429044706845');" style=""><abbr title=" 737              Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getName(), persistencePerspective);"> 737              Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Sku.class.getName(), perðŸ”µ</abbr></span>
<span class="-7453227611519095000" onmouseenter="enter('-7453227611519095000');" onmouseout="out('-7453227611519095000');" style=""> 738              filterOutProductMetadata(adminProperties);                                                            </span>
<span class="-5056229965271915337" onmouseenter="enter('-5056229965271915337');" onmouseout="out('-5056229965271915337');" style=""> 739              Object primaryKey = helper.getPrimaryKey(entity, adminProperties);                                    </span>
<span class="5076299244443205355" onmouseenter="enter('5076299244443205355');" onmouseout="out('5076299244443205355');" style=""> 740              Sku adminInstance = (Sku) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]), primaryKey);  </span>
<span class="2916291722905579881" onmouseenter="enter('2916291722905579881');" onmouseout="out('2916291722905579881');" style=""> 741              adminInstance = (Sku) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);  </span>
<span  style=""> 742                                                                                                                    </span>
<span class="561479470093632813" onmouseenter="enter('561479470093632813');" onmouseout="out('561479470093632813');" style=""> 743              //Verify that there isn&#x27;t already a Sku for this particular product option value combo                </span>
<span class="-7646105610360359073" onmouseenter="enter('-7646105610360359073');" onmouseout="out('-7646105610360359073');" style=""> 744              Entity errorEntity = validateUniqueProductOptionValueCombination(adminInstance.getProduct(),          </span>
<span class="7978785476337646518" onmouseenter="enter('7978785476337646518');" onmouseout="out('7978785476337646518');" style=""> 745                                                                              getProductOptionProperties(entity),   </span>
<span class="-2741785419016191367" onmouseenter="enter('-2741785419016191367');" onmouseout="out('-2741785419016191367');" style=""> 746                                                                              adminInstance);                       </span>
<span class="315758838568217561" onmouseenter="enter('315758838568217561');" onmouseout="out('315758838568217561');" style=""> 747              if (errorEntity != null) {                                                                            </span>
<span class="-6380597201056661281" onmouseenter="enter('-6380597201056661281');" onmouseout="out('-6380597201056661281');" style=""> 748                  entity.setPropertyValidationErrors(errorEntity.getPropertyValidationErrors());                    </span>
<span class="-7572797105708032926" onmouseenter="enter('-7572797105708032926');" onmouseout="out('-7572797105708032926');" style=""> 749                  return entity;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 750              }                                                                                                     </span>
<span  style=""> 751                                                                                                                    </span>
<span class="-1592345858824912592" onmouseenter="enter('-1592345858824912592');" onmouseout="out('-1592345858824912592');" style=""> 752              // Only modify product options if this ISN&#x27;T an update for inventory properties                       </span>
<span class="-4074871831516694131" onmouseenter="enter('-4074871831516694131');" onmouseout="out('-4074871831516694131');" style=""> 753              if (!persistencePackage.containsCriteria(INVENTORY_ONLY_CRITERIA)) {                                  </span>
<span class="4472814042081188939" onmouseenter="enter('4472814042081188939');" onmouseout="out('4472814042081188939');" style=""> 754                  associateProductOptionValuesToSku(entity, adminInstance, dynamicEntityDao);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 755              }                                                                                                     </span>
<span  style=""> 756                                                                                                                    </span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 757              adminInstance = dynamicEntityDao.merge(adminInstance);                                                </span>
<span  style=""> 758                                                                                                                    </span>
<span class="6972089533394912781" onmouseenter="enter('6972089533394912781');" onmouseout="out('6972089533394912781');" style=""> 759              extensionManager.getProxy().skuUpdated(adminInstance);                                                </span>
<span  style=""> 760                                                                                                                    </span>
<span class="-2729035098975137606" onmouseenter="enter('-2729035098975137606');" onmouseout="out('-2729035098975137606');" style=""> 761              //Fill out the DTO and add in the product option value properties to it                               </span>
<span class="8927160133375333586" onmouseenter="enter('8927160133375333586');" onmouseout="out('8927160133375333586');" style=""> 762              Entity result = helper.getRecord(adminProperties, adminInstance, null, null);                         </span>
<span class="-1352652314153256295" onmouseenter="enter('-1352652314153256295');" onmouseout="out('-1352652314153256295');" style=""> 763              for (Property property : getProductOptionProperties(entity)) {                                        </span>
<span class="-6991744037283748574" onmouseenter="enter('-6991744037283748574');" onmouseout="out('-6991744037283748574');" style=""> 764                  result.addProperty(property);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 765              }                                                                                                     </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 766              return result;                                                                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 767          } catch (Exception e) {                                                                                   </span>
<span class="-5937019774393085643" onmouseenter="enter('-5937019774393085643');" onmouseout="out('-5937019774393085643');" style=""> 768              throw new ServiceException(&quot;Unable to perform update for entity: &quot; + Sku.class.getName(), e);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 769          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 770      }                                                                                                             </span>
<span  style=""> 771                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 772      @Override                                                                                                     </span>
<span class="9216576132440445278" onmouseenter="enter('9216576132440445278');" onmouseout="out('9216576132440445278');" style=""> 773      protected String[] getPolymorphicClasses(Class&lt;?&gt; clazz, EntityManager em, boolean useCache) {                </span>
<span class="858198974140428987" onmouseenter="enter('858198974140428987');" onmouseout="out('858198974140428987');" style=""> 774          DynamicDaoHelperImpl helper = new DynamicDaoHelperImpl();                                                 </span>
<span class="5862655439879943987" onmouseenter="enter('5862655439879943987');" onmouseout="out('5862655439879943987');" style=""> 775          Class&lt;?&gt;[] classes = helper.getAllPolymorphicEntitiesFromCeiling(clazz,                                   </span>
<span class="7212693925267149793" onmouseenter="enter('7212693925267149793');" onmouseout="out('7212693925267149793');" style=""> 776                  helper.getSessionFactory((HibernateEntityManager) em), true, useCache);                           </span>

<span class="5925953156034592661" onmouseenter="enter('5925953156034592661');" onmouseout="out('5925953156034592661');" style=""> 777          String[] result = new String[classes.length];                                                             </span>
<span class="-8402235850457988496" onmouseenter="enter('-8402235850457988496');" onmouseout="out('-8402235850457988496');" style=""> 778          for (int i = 0; i &lt; classes.length; i++) {                                                                </span>
<span class="-4624814724789256168" onmouseenter="enter('-4624814724789256168');" onmouseout="out('-4624814724789256168');" style=""> 779              result[i] = classes[i].getName();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 780          }                                                                                                         </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 781          return result;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 782      }                                                                                                             </span>
<span  style=""> 783                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 784      /**                                                                                                           </span>
<span class="-7623474717715637457" onmouseenter="enter('-7623474717715637457');" onmouseout="out('-7623474717715637457');" style=""><abbr title=" 785       * This initially removes all of the product option values that are currently related to the Sku and then re-associates"> 785       * This initially removes all of the product option values that are currently related to the Sku and then re-aðŸ”µ</abbr></span>
<span class="919168598745235587" onmouseenter="enter('919168598745235587');" onmouseout="out('919168598745235587');" style=""> 786       * the {@link ProductOptionValue}s                                                                            </span>
<span class="5381683285013722867" onmouseenter="enter('5381683285013722867');" onmouseout="out('5381683285013722867');" style=""> 787       * @param entity                                                                                              </span>
<span class="-3727775444071594306" onmouseenter="enter('-3727775444071594306');" onmouseout="out('-3727775444071594306');" style=""> 788       * @param adminInstance                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 789       */                                                                                                           </span>
<span class="-5580154930501003130" onmouseenter="enter('-5580154930501003130');" onmouseout="out('-5580154930501003130');" style=""><abbr title=" 790      protected void associateProductOptionValuesToSku(Entity entity, Sku adminInstance, DynamicEntityDao dynamicEntityDao) {"> 790      protected void associateProductOptionValuesToSku(Entity entity, Sku adminInstance, DynamicEntityDao dynamicEntðŸ”µ</abbr></span>
<span class="-2108418430173822456" onmouseenter="enter('-2108418430173822456');" onmouseout="out('-2108418430173822456');" style=""> 791          //Get the list of product option value ids that were selected from the form                               </span>
<span class="1634824265941381194" onmouseenter="enter('1634824265941381194');" onmouseout="out('1634824265941381194');" style=""> 792          List&lt;Long&gt; productOptionValueIds = new ArrayList&lt;&gt;();                                                     </span>
<span class="-1352652314153256295" onmouseenter="enter('-1352652314153256295');" onmouseout="out('-1352652314153256295');" style=""> 793          for (Property property : getProductOptionProperties(entity)) {                                            </span>
<span class="-2394430384756952955" onmouseenter="enter('-2394430384756952955');" onmouseout="out('-2394430384756952955');" style=""> 794              Long propId = Long.parseLong(property.getValue());                                                    </span>
<span class="-4973643473801343364" onmouseenter="enter('-4973643473801343364');" onmouseout="out('-4973643473801343364');" style=""> 795              productOptionValueIds.add(propId);                                                                    </span>
<span class="882791416935144082" onmouseenter="enter('882791416935144082');" onmouseout="out('882791416935144082');" style=""> 796              property.setIsDirty(true);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 797          }                                                                                                         </span>
<span  style=""> 798                                                                                                                    </span>
<span class="5599600967733699964" onmouseenter="enter('5599600967733699964');" onmouseout="out('5599600967733699964');" style=""> 799          // Only process associations if product option value changes came in via the form                         </span>
<span class="-927227770795358535" onmouseenter="enter('-927227770795358535');" onmouseout="out('-927227770795358535');" style=""> 800          if (CollectionUtils.isNotEmpty(productOptionValueIds)) {                                                  </span>
<span class="-836715987756422691" onmouseenter="enter('-836715987756422691');" onmouseout="out('-836715987756422691');" style=""> 801              //remove the current list of product option values from the Sku                                       </span>
<span class="3024457150101065569" onmouseenter="enter('3024457150101065569');" onmouseout="out('3024457150101065569');" style=""> 802              if (adminInstance.getProductOptionValueXrefs().size() &gt; 0) {                                          </span>
<span class="-348971082300775720" onmouseenter="enter('-348971082300775720');" onmouseout="out('-348971082300775720');" style=""><abbr title=" 803                  Iterator&lt;SkuProductOptionValueXref&gt; iterator = adminInstance.getProductOptionValueXrefs().iterator();"> 803                  Iterator&lt;SkuProductOptionValueXref&gt; iterator = adminInstance.getProductOptionValueXrefs().iteratorðŸ”µ</abbr></span>
<span class="977968488612897428" onmouseenter="enter('977968488612897428');" onmouseout="out('977968488612897428');" style=""> 804                  while (iterator.hasNext()) {                                                                      </span>
<span class="296261963919855061" onmouseenter="enter('296261963919855061');" onmouseout="out('296261963919855061');" style=""> 805                      dynamicEntityDao.remove(iterator.next());                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 806                  }                                                                                                 </span>
<span class="-7399149246786578987" onmouseenter="enter('-7399149246786578987');" onmouseout="out('-7399149246786578987');" style=""> 807                  dynamicEntityDao.merge(adminInstance);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 808              }                                                                                                     </span>
<span  style=""> 809                                                                                                                    </span>
<span class="-4534125068586212273" onmouseenter="enter('-4534125068586212273');" onmouseout="out('-4534125068586212273');" style=""> 810              //Associate the product option values from the form with the Sku                                      </span>
<span class="-2263388685273571690" onmouseenter="enter('-2263388685273571690');" onmouseout="out('-2263388685273571690');" style=""> 811              for (Long id : productOptionValueIds) {                                                               </span>
<span class="-1845535430062096532" onmouseenter="enter('-1845535430062096532');" onmouseout="out('-1845535430062096532');" style=""> 812                  //Simply find the changed ProductOptionValues directly - seems to work better with sandboxing code</span>
<span class="-2351207014655688291" onmouseenter="enter('-2351207014655688291');" onmouseout="out('-2351207014655688291');" style=""><abbr title=" 813                  ProductOptionValue pov = (ProductOptionValue) dynamicEntityDao.find(ProductOptionValueImpl.class, id);"> 813                  ProductOptionValue pov = (ProductOptionValue) dynamicEntityDao.find(ProductOptionValueImpl.class, ðŸ”µ</abbr></span>
<span class="6521746250086557424" onmouseenter="enter('6521746250086557424');" onmouseout="out('6521746250086557424');" style=""> 814                  SkuProductOptionValueXref xref = new SkuProductOptionValueXrefImpl(adminInstance, pov);           </span>
<span class="-8084022359180624494" onmouseenter="enter('-8084022359180624494');" onmouseout="out('-8084022359180624494');" style=""> 815                  xref = dynamicEntityDao.merge(xref);                                                              </span>
<span class="-4176466516175169486" onmouseenter="enter('-4176466516175169486');" onmouseout="out('-4176466516175169486');" style=""> 816                  adminInstance.getProductOptionValueXrefs().add(xref);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 817              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 818          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 819      }                                                                                                             </span>
<span  style=""> 820                                                                                                                    </span>
<span class="-7856904959937096406" onmouseenter="enter('-7856904959937096406');" onmouseout="out('-7856904959937096406');" style=""> 821      protected List&lt;Property&gt; getProductOptionProperties(Entity entity) {                                          </span>
<span class="-8583115342580003925" onmouseenter="enter('-8583115342580003925');" onmouseout="out('-8583115342580003925');" style=""> 822          List&lt;Property&gt; productOptionProperties = new ArrayList&lt;&gt;();                                               </span>
<span class="-5346955267205588229" onmouseenter="enter('-5346955267205588229');" onmouseout="out('-5346955267205588229');" style=""> 823          for (Property property : entity.getProperties()) {                                                        </span>
<span class="-4364715296212150710" onmouseenter="enter('-4364715296212150710');" onmouseout="out('-4364715296212150710');" style=""> 824              if (property.getName().startsWith(PRODUCT_OPTION_FIELD_PREFIX)) {                                     </span>
<span class="4660153000567545168" onmouseenter="enter('4660153000567545168');" onmouseout="out('4660153000567545168');" style=""> 825                  productOptionProperties.add(property);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 826              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 827          }                                                                                                         </span>
<span class="-7955791568854160092" onmouseenter="enter('-7955791568854160092');" onmouseout="out('-7955791568854160092');" style=""> 828          return productOptionProperties;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 829      }                                                                                                             </span>
<span  style=""> 830                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 831      /**                                                                                                           </span>
<span class="1365192302683773708" onmouseenter="enter('1365192302683773708');" onmouseout="out('1365192302683773708');" style=""> 832       * Ensures that the given list of {@link ProductOptionValue} IDs is unique for the given {@link Product}.     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 833       *                                                                                                            </span>
<span class="181270108197628031" onmouseenter="enter('181270108197628031');" onmouseout="out('181270108197628031');" style=""> 834       * If sku browsing is enabled, then it is assumed that a single combination of {@link ProductOptionValue} IDs </span>
<span class="-9042834622684422857" onmouseenter="enter('-9042834622684422857');" onmouseout="out('-9042834622684422857');" style=""><abbr title=" 835       * is not unique and more than one {@link Sku} could have the exact same combination of {@link ProductOptionValue} IDs."> 835       * is not unique and more than one {@link Sku} could have the exact same combination of {@link ProductOptionVaðŸ”µ</abbr></span>
<span class="8880319067663877918" onmouseenter="enter('8880319067663877918');" onmouseout="out('8880319067663877918');" style=""> 836       * In this case, the following validation is skipped.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 837       *                                                                                                            </span>
<span class="-1391920893822957351" onmouseenter="enter('-1391920893822957351');" onmouseout="out('-1391920893822957351');" style=""> 838       * @param product                                                                                             </span>
<span class="-5594036901015815590" onmouseenter="enter('-5594036901015815590');" onmouseout="out('-5594036901015815590');" style=""> 839       * @param productOptionProperties                                                                             </span>
<span class="-6460801320187933305" onmouseenter="enter('-6460801320187933305');" onmouseout="out('-6460801320187933305');" style=""><abbr title=" 840       * @param currentSku - for update operations, this is the current Sku that is being updated; should be excluded from"> 840       * @param currentSku - for update operations, this is the current Sku that is being updated; should be excludeðŸ”µ</abbr></span>
<span class="-9039397817177530475" onmouseenter="enter('-9039397817177530475');" onmouseout="out('-9039397817177530475');" style=""> 841       * attempting validation                                                                                      </span>
<span class="3147013888049433291" onmouseenter="enter('3147013888049433291');" onmouseout="out('3147013888049433291');" style=""> 842       * @return &lt;b&gt;null&lt;/b&gt; if successfully validation, the error entity otherwise                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 843       */                                                                                                           </span>
<span class="4098410267680721468" onmouseenter="enter('4098410267680721468');" onmouseout="out('4098410267680721468');" style=""><abbr title=" 844      protected Entity validateUniqueProductOptionValueCombination(Product product, List&lt;Property&gt; productOptionProperties, Sku currentSku) {"> 844      protected Entity validateUniqueProductOptionValueCombination(Product product, List&lt;Property&gt; productOptionPropðŸ”µ</abbr></span>
<span class="4942377315120176487" onmouseenter="enter('4942377315120176487');" onmouseout="out('4942377315120176487');" style=""> 845          if(useSku) {                                                                                              </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 846              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 847          }                                                                                                         </span>
<span class="-5247886246871174474" onmouseenter="enter('-5247886246871174474');" onmouseout="out('-5247886246871174474');" style=""> 848          //do not attempt POV validation if no PO properties were passed in                                        </span>
<span class="3871558701454434845" onmouseenter="enter('3871558701454434845');" onmouseout="out('3871558701454434845');" style=""> 849          if (CollectionUtils.isNotEmpty(productOptionProperties)) {                                                </span>
<span class="1634824265941381194" onmouseenter="enter('1634824265941381194');" onmouseout="out('1634824265941381194');" style=""> 850              List&lt;Long&gt; productOptionValueIds = new ArrayList&lt;&gt;();                                                 </span>
<span class="-3576685812737207515" onmouseenter="enter('-3576685812737207515');" onmouseout="out('-3576685812737207515');" style=""> 851              for (Property property : productOptionProperties) {                                                   </span>
<span class="-2118064041595259984" onmouseenter="enter('-2118064041595259984');" onmouseout="out('-2118064041595259984');" style=""> 852                  productOptionValueIds.add(Long.parseLong(property.getValue()));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 853              }                                                                                                     </span>
<span  style=""> 854                                                                                                                    </span>
<span class="-2493564654197817042" onmouseenter="enter('-2493564654197817042');" onmouseout="out('-2493564654197817042');" style=""> 855              boolean validated = true;                                                                             </span>
<span class="7949927824524618864" onmouseenter="enter('7949927824524618864');" onmouseout="out('7949927824524618864');" style=""> 856              for (Sku sku : product.getAdditionalSkus()) {                                                         </span>
<span class="2891953471366425035" onmouseenter="enter('2891953471366425035');" onmouseout="out('2891953471366425035');" style=""> 857                  if (currentSku == null || !sku.getId().equals(currentSku.getId())) {                              </span>
<span class="-3952558990885951835" onmouseenter="enter('-3952558990885951835');" onmouseout="out('-3952558990885951835');" style=""> 858                      List&lt;Long&gt; testList = new ArrayList&lt;&gt;();                                                      </span>
<span class="-7407157514043427301" onmouseenter="enter('-7407157514043427301');" onmouseout="out('-7407157514043427301');" style=""> 859                      for (ProductOptionValue optionValue : sku.getProductOptionValues()) {                         </span>
<span class="261748784534089861" onmouseenter="enter('261748784534089861');" onmouseout="out('261748784534089861');" style=""> 860                          testList.add(optionValue.getId());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 861                      }                                                                                             </span>
<span  style=""> 862                                                                                                                    </span>
<span class="-5224728573656644718" onmouseenter="enter('-5224728573656644718');" onmouseout="out('-5224728573656644718');" style=""> 863                      if (CollectionUtils.isNotEmpty(testList) &amp;&amp;                                                   </span>
<span class="-8535753245269677627" onmouseenter="enter('-8535753245269677627');" onmouseout="out('-8535753245269677627');" style=""> 864                              productOptionValueIds.containsAll(testList) &amp;&amp;                                        </span>
<span class="4715989752758376255" onmouseenter="enter('4715989752758376255');" onmouseout="out('4715989752758376255');" style=""> 865                              productOptionValueIds.size() == testList.size()) {                                    </span>
<span class="6265709580977530731" onmouseenter="enter('6265709580977530731');" onmouseout="out('6265709580977530731');" style=""> 866                          validated = false;                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 867                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 868                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 869                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 870              }                                                                                                     </span>
<span  style=""> 871                                                                                                                    </span>
<span class="5370947014016399578" onmouseenter="enter('5370947014016399578');" onmouseout="out('5370947014016399578');" style=""> 872              if (!validated) {                                                                                     </span>
<span class="605992171615497910" onmouseenter="enter('605992171615497910');" onmouseout="out('605992171615497910');" style=""> 873                  Entity errorEntity = new Entity();                                                                </span>
<span class="4071390277457465045" onmouseenter="enter('4071390277457465045');" onmouseout="out('4071390277457465045');" style=""> 874                  for (Property productOptionProperty : productOptionProperties) {                                  </span>
<span class="-3018953048999428832" onmouseenter="enter('-3018953048999428832');" onmouseout="out('-3018953048999428832');" style=""> 875                      errorEntity.addValidationError(productOptionProperty.getName(), &quot;uniqueSkuError&quot;);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 876                  }                                                                                                 </span>
<span class="-5923031647519224540" onmouseenter="enter('-5923031647519224540');" onmouseout="out('-5923031647519224540');" style=""> 877                  return errorEntity;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 878              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 879          }                                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 880          return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 881      }                                                                                                             </span>
<span  style=""> 882                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 883  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            