<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>225</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    225
                    <a href="224.html">prev</a>
                    <a href="226.html">next</a>
                    <a href="225_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    BroadleafCommerce/BroadleafCommerce_fd1394d8a0df0583b1f2c7c6fefa993051f65c10_core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/index/SolrIndexService.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;fd1394d8a0df0583b1f2c7c6fefa993051f65c10:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/index/SolrIndexService.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;fd1394d8a0df0583b1f2c7c6fefa993051f65c10^1:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/index/SolrIndexService.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;fd1394d8a0df0583b1f2c7c6fefa993051f65c10^2:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/index/SolrIndexService.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;f40b9b4e9d4d9c82000944599b1a359d6f8adba4:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/index/SolrIndexService.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 /*
   2  * #%L
   3  * BroadleafCommerce Framework
   4  * %%
   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce
   6  * %%
   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0
   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)
   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case
  10  * the Broadleaf End User License Agreement (EULA), Version 1.1
  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)
  12  * shall apply.
  13  * 
<abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr>
<abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr>
  16  * #L%
  17  */
  18 package org.broadleafcommerce.core.search.service.solr.index;
  19 
  20 import org.apache.solr.client.solrj.SolrClient;
  21 import org.apache.solr.client.solrj.SolrServerException;
  22 import org.apache.solr.common.SolrInputDocument;
  23 import org.broadleafcommerce.common.exception.ServiceException;
  24 import org.broadleafcommerce.common.locale.domain.Locale;
  25 import org.broadleafcommerce.core.catalog.domain.Indexable;
  26 import org.broadleafcommerce.core.search.domain.IndexField;
  27 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  28 import org.broadleafcommerce.core.search.service.solr.SolrConfiguration;</span>
  29 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 import org.broadleafcommerce.core.catalog.domain.Sku;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import org.broadleafcommerce.core.search.domain.IndexField;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 </span>
  33 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  34 import org.broadleafcommerce.core.search.service.solr.indexer.CatalogSolrIndexUpdateService;</span>
  35 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
  36 
  37 import java.io.IOException;
  38 import java.util.Collection;
  39 import java.util.List;
  40 
  41 /**
  42  * Service exposing several methods for creating a Solr index based on catalog product data.
  43  *
  44  * @see org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation
  45  * @author Andre Azzolini (apazzolini)
  46  * @author Jeff Fischer
  47  * @author Phillip Verheyden (phillipuniverse)
  48  */
  49 public interface SolrIndexService {
  50 
  51     /**
  52      * &lt;p&gt;
<abbr title="  53      * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collection and then swap">  53      * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collectiðŸ”µ</abbr>
<abbr title="  54      * out the active core/collection with the new version of the index (essentially replacing all documents that are">  54      * out the active core/collection with the new version of the index (essentially replacing all documeðŸ”µ</abbr>
  55      * currently in the index).
  56      * 
  57      * &lt;p&gt;
  58      * The order of methods that are apart of rebuilding the entire index:
  59      * &lt;ol&gt;
  60      *  &lt;li&gt;&lt;pre&gt;{@link #preBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  61      *  &lt;li&gt;&lt;pre&gt;{@link #buildIndex()}&lt;/pre&gt;&lt;/li&gt;
  62      *  &lt;li&gt;&lt;pre&gt;{@link #postBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  63      * &lt;/ol&gt;
  64      * 
  65      * 
  66      * @throws IOException 
  67      * @throws ServiceException
  68      */
  69     public void rebuildIndex() throws ServiceException, IOException;
  70 
  71     /**
<abbr title="  72      * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the current index. This">  72      * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the cuðŸ”µ</abbr>
  73      * is called at the beginning of {@link #rebuildIndex()}
  74      *
  75      * @throws ServiceException
  76      */
  77     public void preBuildIndex() throws ServiceException;
  78 
  79     /**
  80      * &lt;p&gt;
<abbr title="  81      * Handles all the document building for the current index rebuild. This is where all of the SolrIndexOperation&#x27;s need to be">  81      * Handles all the document building for the current index rebuild. This is where all of the SolrIndeðŸ”µ</abbr>
  82      * created, executed and the documents built and added to the Solr index
  83      * 
  84      * &lt;p&gt;
<abbr title="  85      * This is the method that should be overridden to specify which operations should be run to build the correct index.">  85      * This is the method that should be overridden to specify which operations should be run to build thðŸ”µ</abbr>
  86      *
  87      * @throws IOException
  88      * @throws ServiceException
  89      * @see {@link #rebuildIndex()}
  90      * @see {@link #preBuildIndex()}
  91      */
  92     public void buildIndex() throws IOException, ServiceException;
  93 
  94     /**
<abbr title="  95      * Executed after we do any indexing when rebuilding the current index. Usually this handles optimizing the index and swapping the cores.">  95      * Executed after we do any indexing when rebuilding the current index. Usually this handles optimiziðŸ”µ</abbr>
  96      *
  97      * @throws IOException
  98      * @throws ServiceException
  99      */
 100     public void postBuildIndex() throws IOException, ServiceException;
 101     
 102     /**
<abbr title=" 103      * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. This is the primary"> 103      * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. TðŸ”µ</abbr>
 104      * index operation used to rebuild the index.
 105      *
 106      * @return a SolrIndexOperation capable of rebuilding the current index
 107      */
 108     public SolrIndexOperation getReindexOperation();
 109 
 110     /**
 111      * Executes the given &lt;b&gt;operation&lt;/b&gt; in the correct method order
 112      *
 113      * @param operation the SolrIndexOperation that is to be executed
 114      * @throws ServiceException
 115      * @throws IOException
 116      */
<abbr title=" 117     public void executeSolrIndexOperation(SolrIndexOperation operation) throws ServiceException, IOException;"> 117     public void executeSolrIndexOperation(SolrIndexOperation operation) throws ServiceException, IOExceptðŸ”µ</abbr>
 118     
 119     /**
 120      * Builds a set of {@link Indexable}s against the given {@link SolrServer}
 121      * @param collection The collection to be used for incremental indexing
 122      * @param indexables the list of items to index
<abbr title=" 123      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this will"> 123      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is nuðŸ”µ</abbr>
 124      * simply return the documents that were built from &lt;b&gt;indexables&lt;/b&gt;
 125      * 
 126      * @throws ServiceException
 127      * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;
 128      */
<abbr title=" 129     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException;"> 129     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends IndexablðŸ”µ</abbr>
 130 
 131     /**
 132      * Builds a set of {@link Indexable}s against the given {@link SolrServer}
 133      * @param indexables the list of items to index
<abbr title=" 134      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this will"> 134      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is nuðŸ”µ</abbr>
 135      * simply return the documents that were built from &lt;b&gt;indexables&lt;/b&gt;
 136      * 
 137      * @throws ServiceException
 138      * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;
<abbr title=" 139      * @deprecated Use {@link #buildIncrementalIndex(String, List, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()} "> 139      * @deprecated Use {@link #buildIncrementalIndex(String, List, SolrClient)} instead so that the colleðŸ”µ</abbr>
 140      */
 141     @Deprecated
<abbr title=" 142     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException;"> 142     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrðŸ”µ</abbr>
 143 
 144     /**
 145      * Saves some global context that might be altered during indexing.
 146      * 
 147      * @return
 148      */
 149     public Object[] saveState();
 150 
 151     /**
 152      * Restores state that was saved prior to indexing that might have been altered.
 153      * 
 154      * @see #saveState()
 155      * @param pack
 156      */
 157     public void restoreState(Object[] pack);
 158 
 159     /**
<abbr title=" 160      * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@link #rebuildIndex()}"> 160      * Triggers the Solr optimize index function on the given server. This is typically called at the endðŸ”µ</abbr>
 161      * @param collection The collection to optimize
 162      * @param server The server to use to optimze the given collection
 163      * 
 164      * @throws ServiceException
 165      * @throws IOException
 166      */
 167     public void optimizeIndex(String collection, SolrClient server) throws ServiceException, IOException;
 168 
 169     /**
<abbr title=" 170      * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@link #rebuildIndex()}"> 170      * Triggers the Solr optimize index function on the given server. This is typically called at the endðŸ”µ</abbr>
 171      * @param server The server to use to optimze the default collection
 172      * 
 173      * @throws ServiceException
 174      * @throws IOException
<abbr title=" 175      * @deprecated Use {@link #optimizeIndex(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 175      * @deprecated Use {@link #optimizeIndex(String, SolrClient)} instead so that the collection that&#x27;s bðŸ”µ</abbr>
 176      */
 177     @Deprecated
 178     public void optimizeIndex(SolrClient server) throws ServiceException, IOException;
 179 
 180     /**
<abbr title=" 181      * Allows a commit to be called.  By default, the details of the commit will depend on system properties, including:"> 181      * Allows a commit to be called.  By default, the details of the commit will depend on system propertðŸ”µ</abbr>
 182      * 
<abbr title=" 183      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be configured in Solr."> 183      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) shðŸ”µ</abbr>
 184      * solr.index.softCommit - indicates if a soft commit should be performed
 185      * solr.index.waitSearcher - indicates if the process should wait for a searcher to be configured
 186      * solr.index.waitFlush - indicates if the process should wait for a flush to disk
 187      * @param collection The collection to commit
 188      * @param server The server used to commit the specified collection
 189      * 
 190      * @throws ServiceException
 191      * @throws IOException
 192      */
 193 
 194     public void commit(String collection, SolrClient server) throws ServiceException, IOException;
 195 
 196     /**
<abbr title=" 197      * Allows a commit to be called.  By default, the details of the commit will depend on system properties, including:"> 197      * Allows a commit to be called.  By default, the details of the commit will depend on system propertðŸ”µ</abbr>
 198      * 
<abbr title=" 199      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be configured in Solr."> 199      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) shðŸ”µ</abbr>
 200      * solr.index.softCommit - indicates if a soft commit should be performed
 201      * solr.index.waitSearcher - indicates if the process should wait for a searcher to be configured
 202      * solr.index.waitFlush - indicates if the process should wait for a flush to disk
 203      * @param server The server used to commit the default collection
 204      * 
 205      * @throws ServiceException
 206      * @throws IOException
<abbr title=" 207      * @deprecated Use {@link #commit(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 207      * @deprecated Use {@link #commit(String, SolrClient)} instead so that the collection that&#x27;s being usðŸ”µ</abbr>
 208      */
 209     @Deprecated
 210     public void commit(SolrClient server) throws ServiceException, IOException;
 211 
 212     /**
 213      * This allows an external caller to force a commit to the SolrClient.  See Solr Documentation for
<abbr title=" 214      * additional details.  If using softCommit, you should ensure that a hardCommit is performed, either "> 214      * additional details.  If using softCommit, you should ensure that a hardCommit is performed, eitherðŸ”µ</abbr>
 215      * using autoCommit, or at the end of the commit process to flush the changes to the disk.
 216      * 
 217      * Note that this method will force a commit even if solr.index.commit=false
 218      * @param collection The collection to commit
 219      * @param server - the SolrClient to use to commit the provided collection
<abbr title=" 220      * @param softCommit - soft commit is an efficient commit that does not write the data to the file system"> 220      * @param softCommit - soft commit is an efficient commit that does not write the data to the file syðŸ”µ</abbr>
 221      * @param waitSearcher - whether or not to wait for a new searcher to be created
 222      * @param waitFlush - whether or not to wait for a flush to disk.
 223      * 
 224      * @throws ServiceException
 225      * @throws IOException
 226      */
<abbr title=" 227     public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException;"> 227     public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boðŸ”µ</abbr>
 228 
 229     /**
 230      * This allows an external caller to force a commit to the SolrClient.  See Solr Documentation for
<abbr title=" 231      * additional details.  If using softCommit, you should ensure that a hardCommit is performed, either "> 231      * additional details.  If using softCommit, you should ensure that a hardCommit is performed, eitherðŸ”µ</abbr>
 232      * using autoCommit, or at the end of the commit process to flush the changes to the disk.
 233      * 
 234      * Note that this method will force a commit even if solr.index.commit=false
 235      * @param server - the SolrClient to commit with
<abbr title=" 236      * @param softCommit - soft commit is an efficient commit that does not write the data to the file system"> 236      * @param softCommit - soft commit is an efficient commit that does not write the data to the file syðŸ”µ</abbr>
 237      * @param waitSearcher - whether or not to wait for a new searcher to be created
 238      * @param waitFlush - whether or not to wait for a flush to disk.
 239      * 
 240      * @throws ServiceException
 241      * @throws IOException
<abbr title=" 242      * @deprecated Use {@link #commit(String, SolrClient, boolean, boolean, boolean)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 242      * @deprecated Use {@link #commit(String, SolrClient, boolean, boolean, boolean)} instead so that theðŸ”µ</abbr>
 243      */
 244     @Deprecated
<abbr title=" 245     public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException;"> 245     public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) thðŸ”µ</abbr>
 246 
<abbr title=" 247     public void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceException;"> 247     public void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceExceptionðŸ”µ</abbr>
 248     
 249     /**
<abbr title=" 250      * @deprecated Use {@link #deleteAllNamespaceDocuments(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 250      * @deprecated Use {@link #deleteAllNamespaceDocuments(String, SolrClient)} instead so that the colleðŸ”µ</abbr>
 251      */
 252     @Deprecated
 253     public void deleteAllNamespaceDocuments(SolrClient server) throws ServiceException;
 254 
 255     public void deleteAllDocuments(String collection, SolrClient server) throws ServiceException;
 256 
 257     /**
<abbr title=" 258      * @deprecated Use {@link #deleteAllDocuments(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 258      * @deprecated Use {@link #deleteAllDocuments(String, SolrClient)} instead so that the collection thaðŸ”µ</abbr>
 259      */
 260     @Deprecated
 261     public void deleteAllDocuments(SolrClient server) throws ServiceException;
 262 
 263     /**
 264      * Prints out the docs to the trace logger
 265      * 
 266      * @param documents
 267      */
 268     public void logDocuments(Collection&lt;SolrInputDocument&gt; documents);
 269 
 270     /**
 271      * @return a list of all possible locale prefixes to consider
 272      */
 273     public List&lt;Locale&gt; getAllLocales();
 274 
 275     /**
<abbr title=" 276      * Given a product, fields that relate to that product, and a list of locales and pricelists, builds a "> 276      * Given a product, fields that relate to that product, and a list of locales and pricelists, builds ðŸ”µ</abbr>
 277      * SolrInputDocument to be added to the Solr index.
 278      * 
 279      * @param product
 280      * @param fields
 281      * @param locales
 282      * @return the document
 283      */
<abbr title=" 284     public SolrInputDocument buildDocument(Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);"> 284     public SolrInputDocument buildDocument(Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locðŸ”µ</abbr>
 285 
 286     /**
 287      * SolrIndexService exposes {@link #buildIncrementalIndex(int, int, boolean)}.
<abbr title=" 288      * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation.CacheOperation},"> 288      * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.sðŸ”µ</abbr>
<abbr title=" 289      * a single cache will be used for all the contained calls to buildIncrementalIndex. Here&#x27;s an example:"> 289      * a single cache will be used for all the contained calls to buildIncrementalIndex. Here&#x27;s an examplðŸ”µ</abbr>
 290      * {@code
 291      *  performCachedOperation(new SolrIndexCachedOperation.CacheOperation() {
 292      *        @Override
 293      *        public void execute() throws ServiceException {
 294      *            int page = 0;
 295      *            while ((page * pageSize) &lt; numProducts) {
 296      *                buildIncrementalIndex(page, pageSize);
 297      *                page++;
 298      *            }
 299      *        }
 300      *    });
 301      * }
<abbr title=" 302      * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not necessary to call performCacheOperation"> 302      * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not ðŸ”µ</abbr>
 303      * for calls to rebuildIndex().
 304      *
 305      * @param cacheOperation the block of code to perform using a single cache for best performance
 306      * @throws ServiceException
 307      */
<abbr title=" 308     public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceException;"> 308     public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws SerðŸ”µ</abbr>
 309     
 310     /**
 311      * Iterates through the fields for this indexable and indexes any SearchField&#x27;s or SearchFacet&#x27;s.
 312      *  @param document
 313      * @param indexable
 314      * @param fields
 315      * @param locales
 316      */
<abbr title=" 317     public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);"> 317     public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexðŸ”µ</abbr>
 318 
 319     void deleteByQuery(String deleteQuery) throws SolrServerException, IOException;
 320 
 321     void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerException;
 322 
 323     void logDeleteQuery(String deleteQuery);
 324     
 325     /**
<abbr title=" 326      * Indicates if this should be used.  The alternative is to use {@link CatalogSolrIndexUpdateService}. By default, this is driven by the property, "> 326      * Indicates if this should be used.  The alternative is to use {@link CatalogSolrIndexUpdateService}ðŸ”µ</abbr>
 327      * &#x27;solr.catalog.useLegacySolrIndexer&#x27;, which defaults to true.
 328      * 
 329      * @return
 330      */
 331     public boolean useLegacyIndexer();
 332 }
 333 
 
 
 
 
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 /*
   2  * #%L
   3  * BroadleafCommerce Framework
   4  * %%
   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce
   6  * %%
   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0
   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)
   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case
  10  * the Broadleaf End User License Agreement (EULA), Version 1.1
  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)
  12  * shall apply.
  13  *
<abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr>
<abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr>
  16  * #L%
  17  */
  18 package org.broadleafcommerce.core.search.service.solr.index;
  19 
  20 import org.apache.solr.client.solrj.SolrClient;
  21 import org.apache.solr.client.solrj.SolrServerException;
  22 import org.apache.solr.common.SolrInputDocument;
  23 import org.broadleafcommerce.common.exception.ServiceException;
  24 import org.broadleafcommerce.common.locale.domain.Locale;
  25 import org.broadleafcommerce.core.catalog.domain.Indexable;
  26 import org.broadleafcommerce.core.search.domain.IndexField;
  27 import org.broadleafcommerce.core.search.service.solr.SolrConfiguration;
  28 import org.broadleafcommerce.core.search.service.solr.indexer.CatalogSolrIndexUpdateService;
  29 
  30 import java.io.IOException;
  31 import java.util.Collection;
  32 import java.util.List;
  33 
  34 /**
  35  * Service exposing several methods for creating a Solr index based on catalog product data.
  36  *
  37  * @see org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation
  38  * @author Andre Azzolini (apazzolini)
  39  * @author Jeff Fischer
  40  * @author Phillip Verheyden (phillipuniverse)
  41  */
  42 public interface SolrIndexService {
  43 
  44     /**
  45      * &lt;p&gt;
<abbr title="  46      * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collection and then swap">  46      * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collectiðŸ”µ</abbr>
<abbr title="  47      * out the active core/collection with the new version of the index (essentially replacing all documents that are">  47      * out the active core/collection with the new version of the index (essentially replacing all documeðŸ”µ</abbr>
  48      * currently in the index).
  49      *
  50      * &lt;p&gt;
  51      * The order of methods that are apart of rebuilding the entire index:
  52      * &lt;ol&gt;
  53      *  &lt;li&gt;&lt;pre&gt;{@link #preBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  54      *  &lt;li&gt;&lt;pre&gt;{@link #buildIndex()}&lt;/pre&gt;&lt;/li&gt;
  55      *  &lt;li&gt;&lt;pre&gt;{@link #postBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  56      * &lt;/ol&gt;
  57      *
  58      *
  59      * @throws IOException
  60      * @throws ServiceException
  61      */
  62     public void rebuildIndex() throws ServiceException, IOException;
  63 
  64     /**
<abbr title="  65      * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the current index. This">  65      * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the cuðŸ”µ</abbr>
  66      * is called at the beginning of {@link #rebuildIndex()}
  67      *
  68      * @throws ServiceException
  69      */
  70     public void preBuildIndex() throws ServiceException;
  71 
  72     /**
  73      * &lt;p&gt;
<abbr title="  74      * Handles all the document building for the current index rebuild. This is where all of the SolrIndexOperation&#x27;s need to be">  74      * Handles all the document building for the current index rebuild. This is where all of the SolrIndeðŸ”µ</abbr>
  75      * created, executed and the documents built and added to the Solr index
  76      *
  77      * &lt;p&gt;
<abbr title="  78      * This is the method that should be overridden to specify which operations should be run to build the correct index.">  78      * This is the method that should be overridden to specify which operations should be run to build thðŸ”µ</abbr>
  79      *
  80      * @throws IOException
  81      * @throws ServiceException
  82      * @see {@link #rebuildIndex()}
  83      * @see {@link #preBuildIndex()}
  84      */
  85     public void buildIndex() throws IOException, ServiceException;
  86 
  87     /**
<abbr title="  88      * Executed after we do any indexing when rebuilding the current index. Usually this handles optimizing the index and swapping the cores.">  88      * Executed after we do any indexing when rebuilding the current index. Usually this handles optimiziðŸ”µ</abbr>
  89      *
  90      * @throws IOException
  91      * @throws ServiceException
  92      */
  93     public void postBuildIndex() throws IOException, ServiceException;
  94 
  95     /**
<abbr title="  96      * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. This is the primary">  96      * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. TðŸ”µ</abbr>
  97      * index operation used to rebuild the index.
  98      *
  99      * @return a SolrIndexOperation capable of rebuilding the current index
 100      */
 101     public SolrIndexOperation getReindexOperation();
 102 
 103     /**
 104      * Executes the given &lt;b&gt;operation&lt;/b&gt; in the correct method order
 105      *
 106      * @param operation the SolrIndexOperation that is to be executed
 107      * @throws ServiceException
 108      * @throws IOException
 109      */
<abbr title=" 110     public void executeSolrIndexOperation(SolrIndexOperation operation) throws ServiceException, IOException;"> 110     public void executeSolrIndexOperation(SolrIndexOperation operation) throws ServiceException, IOExceptðŸ”µ</abbr>
 111 
 112     /**
 113      * Builds a set of {@link Indexable}s against the given {@link SolrServer}
 114      * @param collection The collection to be used for incremental indexing
 115      * @param indexables the list of items to index
<abbr title=" 116      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this will"> 116      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is nuðŸ”µ</abbr>
 117      * simply return the documents that were built from &lt;b&gt;indexables&lt;/b&gt;
 118      *
 119      * @throws ServiceException
 120      * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;
 121      */
<abbr title=" 122     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException;"> 122     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends IndexablðŸ”µ</abbr>
 123 
 124     /**
 125      * Builds a set of {@link Indexable}s against the given {@link SolrServer}
 126      * @param indexables the list of items to index
<abbr title=" 127      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this will"> 127      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is nuðŸ”µ</abbr>
 128      * simply return the documents that were built from &lt;b&gt;indexables&lt;/b&gt;
 129      *
 130      * @throws ServiceException
 131      * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;
<abbr title=" 132      * @deprecated Use {@link #buildIncrementalIndex(String, List, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 132      * @deprecated Use {@link #buildIncrementalIndex(String, List, SolrClient)} instead so that the colleðŸ”µ</abbr>
 133      */
 134     @Deprecated
<abbr title=" 135 public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException;"> 135 public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClieðŸ”µ</abbr>
 136 
 137     /**
 138      * Saves some global context that might be altered during indexing.
 139      *
 140      * @return
 141      */
 142     public Object[] saveState();
 143 
 144     /**
 145      * Restores state that was saved prior to indexing that might have been altered.
 146      *
 147      * @see #saveState()
 148      * @param pack
 149      */
 150     public void restoreState(Object[] pack);
 151 
 152     /**
<abbr title=" 153      * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@link #rebuildIndex()}"> 153      * Triggers the Solr optimize index function on the given server. This is typically called at the endðŸ”µ</abbr>
 154      * @param collection The collection to optimize
 155      * @param server The server to use to optimze the given collection
 156      *
 157      * @throws ServiceException
 158      * @throws IOException
 159      */
 160     public void optimizeIndex(String collection, SolrClient server) throws ServiceException, IOException;
 161 
 162     /**
<abbr title=" 163      * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@link #rebuildIndex()}"> 163      * Triggers the Solr optimize index function on the given server. This is typically called at the endðŸ”µ</abbr>
 164      * @param server The server to use to optimze the default collection
 165      *
 166      * @throws ServiceException
 167      * @throws IOException
<abbr title=" 168      * @deprecated Use {@link #optimizeIndex(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 168      * @deprecated Use {@link #optimizeIndex(String, SolrClient)} instead so that the collection that&#x27;s bðŸ”µ</abbr>
 169      */
 170     @Deprecated
 171 public void optimizeIndex(SolrClient server) throws ServiceException, IOException;
 172 
 173     /**
<abbr title=" 174      * Allows a commit to be called.  By default, the details of the commit will depend on system properties, including:"> 174      * Allows a commit to be called.  By default, the details of the commit will depend on system propertðŸ”µ</abbr>
 175      *
<abbr title=" 176      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be configured in Solr."> 176      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) shðŸ”µ</abbr>
 177      * solr.index.softCommit - indicates if a soft commit should be performed
 178      * solr.index.waitSearcher - indicates if the process should wait for a searcher to be configured
 179      * solr.index.waitFlush - indicates if the process should wait for a flush to disk
 180      * @param collection The collection to commit
 181      * @param server The server used to commit the specified collection
 182      *
 183      * @throws ServiceException
 184      * @throws IOException
 185      */
 186 
 187     public void commit(String collection, SolrClient server) throws ServiceException, IOException;
 188 
 189     /**
<abbr title=" 190      * Allows a commit to be called.  By default, the details of the commit will depend on system properties, including:"> 190      * Allows a commit to be called.  By default, the details of the commit will depend on system propertðŸ”µ</abbr>
 191      *
<abbr title=" 192      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be configured in Solr."> 192      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) shðŸ”µ</abbr>
 193      * solr.index.softCommit - indicates if a soft commit should be performed
 194      * solr.index.waitSearcher - indicates if the process should wait for a searcher to be configured
 195      * solr.index.waitFlush - indicates if the process should wait for a flush to disk
 196      * @param server The server used to commit the default collection
 197      *
 198      * @throws ServiceException
 199      * @throws IOException
<abbr title=" 200      * @deprecated Use {@link #commit(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 200      * @deprecated Use {@link #commit(String, SolrClient)} instead so that the collection that&#x27;s being usðŸ”µ</abbr>
 201      */
 202     @Deprecated
 203 public void commit(SolrClient server) throws ServiceException, IOException;
 204 
 205     /**
 206      * This allows an external caller to force a commit to the SolrClient.  See Solr Documentation for
 207      * additional details.  If using softCommit, you should ensure that a hardCommit is performed, either
 208      * using autoCommit, or at the end of the commit process to flush the changes to the disk.
 209      *
 210      * Note that this method will force a commit even if solr.index.commit=false
 211      * @param collection The collection to commit
 212      * @param server - the SolrClient to use to commit the provided collection
<abbr title=" 213      * @param softCommit - soft commit is an efficient commit that does not write the data to the file system"> 213      * @param softCommit - soft commit is an efficient commit that does not write the data to the file syðŸ”µ</abbr>
 214      * @param waitSearcher - whether or not to wait for a new searcher to be created
 215      * @param waitFlush - whether or not to wait for a flush to disk.
 216      *
 217      * @throws ServiceException
 218      * @throws IOException
 219      */
<abbr title=" 220     public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException;"> 220     public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boðŸ”µ</abbr>
 221 
 222     /**
 223      * This allows an external caller to force a commit to the SolrClient.  See Solr Documentation for
 224      * additional details.  If using softCommit, you should ensure that a hardCommit is performed, either
 225      * using autoCommit, or at the end of the commit process to flush the changes to the disk.
 226      *
 227      * Note that this method will force a commit even if solr.index.commit=false
 228      * @param server - the SolrClient to commit with
<abbr title=" 229      * @param softCommit - soft commit is an efficient commit that does not write the data to the file system"> 229      * @param softCommit - soft commit is an efficient commit that does not write the data to the file syðŸ”µ</abbr>
 230      * @param waitSearcher - whether or not to wait for a new searcher to be created
 231      * @param waitFlush - whether or not to wait for a flush to disk.
 232      *
 233      * @throws ServiceException
 234      * @throws IOException
<abbr title=" 235      * @deprecated Use {@link #commit(String, SolrClient, boolean, boolean, boolean)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 235      * @deprecated Use {@link #commit(String, SolrClient, boolean, boolean, boolean)} instead so that theðŸ”µ</abbr>
 236      */
 237     @Deprecated
<abbr title=" 238 public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException;"> 238 public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throwsðŸ”µ</abbr>
 239 
<abbr title=" 240     public void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceException;"> 240     public void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceExceptionðŸ”µ</abbr>
 241 
 242     /**
<abbr title=" 243      * @deprecated Use {@link #deleteAllNamespaceDocuments(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 243      * @deprecated Use {@link #deleteAllNamespaceDocuments(String, SolrClient)} instead so that the colleðŸ”µ</abbr>
 244      */
 245     @Deprecated
 246 public void deleteAllNamespaceDocuments(SolrClient server) throws ServiceException;
 247 
 248     public void deleteAllDocuments(String collection, SolrClient server) throws ServiceException;
 249 
 250     /**
<abbr title=" 251      * @deprecated Use {@link #deleteAllDocuments(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 251      * @deprecated Use {@link #deleteAllDocuments(String, SolrClient)} instead so that the collection thaðŸ”µ</abbr>
 252      */
 253     @Deprecated
 254 public void deleteAllDocuments(SolrClient server) throws ServiceException;
 255 
 256     /**
 257      * Prints out the docs to the trace logger
 258      *
 259      * @param documents
 260      */
 261     public void logDocuments(Collection&lt;SolrInputDocument&gt; documents);
 262 
 263     /**
 264      * @return a list of all possible locale prefixes to consider
 265      */
 266     public List&lt;Locale&gt; getAllLocales();
 267 
 268     /**
<abbr title=" 269      * Given a product, fields that relate to that product, and a list of locales and pricelists, builds a"> 269      * Given a product, fields that relate to that product, and a list of locales and pricelists, builds ðŸ”µ</abbr>
 270      * SolrInputDocument to be added to the Solr index.
 271      *
 272      * @param product
 273      * @param fields
 274      * @param locales
 275      * @return the document
 276      */
<abbr title=" 277     public SolrInputDocument buildDocument(Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);"> 277     public SolrInputDocument buildDocument(Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locðŸ”µ</abbr>
 278 
 279     /**
 280      * SolrIndexService exposes {@link #buildIncrementalIndex(int, int, boolean)}.
<abbr title=" 281      * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation.CacheOperation},"> 281      * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.sðŸ”µ</abbr>
<abbr title=" 282      * a single cache will be used for all the contained calls to buildIncrementalIndex. Here&#x27;s an example:"> 282      * a single cache will be used for all the contained calls to buildIncrementalIndex. Here&#x27;s an examplðŸ”µ</abbr>
 283      * {@code
 284      *  performCachedOperation(new SolrIndexCachedOperation.CacheOperation() {
 285      *        @Override
 286      *        public void execute() throws ServiceException {
 287      *            int page = 0;
 288      *            while ((page * pageSize) &lt; numProducts) {
 289      *                buildIncrementalIndex(page, pageSize);
 290      *                page++;
 291      *            }
 292      *        }
 293      *    });
 294      * }
<abbr title=" 295      * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not necessary to call performCacheOperation"> 295      * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not ðŸ”µ</abbr>
 296      * for calls to rebuildIndex().
 297      *
 298      * @param cacheOperation the block of code to perform using a single cache for best performance
 299      * @throws ServiceException
 300      */
<abbr title=" 301     public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceException;"> 301     public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws SerðŸ”µ</abbr>
 302 
 303     /**
 304      * Iterates through the fields for this indexable and indexes any SearchField&#x27;s or SearchFacet&#x27;s.
 305      *  @param document
 306      * @param indexable
 307      * @param fields
 308      * @param locales
 309      */
<abbr title=" 310     public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);"> 310     public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexðŸ”µ</abbr>
 311 
 312     void deleteByQuery(String deleteQuery) throws SolrServerException, IOException;
 313 
 314     void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerException;
 315 
 316     void logDeleteQuery(String deleteQuery);
 317 
 318     /**
<abbr title=" 319      * Indicates if this should be used.  The alternative is to use {@link CatalogSolrIndexUpdateService}. By default, this is driven by the property,"> 319      * Indicates if this should be used.  The alternative is to use {@link CatalogSolrIndexUpdateService}ðŸ”µ</abbr>
 320      * &#x27;solr.catalog.useLegacySolrIndexer&#x27;, which defaults to true.
 321      *
 322      * @return
 323      */
 324     public boolean useLegacyIndexer();
 325 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 /*
   2  * #%L
   3  * BroadleafCommerce Framework
   4  * %%
   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce
   6  * %%
   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0
   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)
   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case
  10  * the Broadleaf End User License Agreement (EULA), Version 1.1
  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)
  12  * shall apply.
  13  *
<abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr>
<abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr>
  16  * #L%
  17  */
  18 package org.broadleafcommerce.core.search.service.solr.index;
  19 
  20 import java.io.IOException;
  21 import java.util.Collection;
  22 import java.util.List;
  23 import org.apache.solr.client.solrj.SolrClient;
  24 import org.apache.solr.client.solrj.SolrServerException;
  25 import org.apache.solr.common.SolrInputDocument;
  26 import org.broadleafcommerce.common.exception.ServiceException;
  27 import org.broadleafcommerce.common.locale.domain.Locale;
  28 import org.broadleafcommerce.core.catalog.domain.Indexable;
  29 import org.broadleafcommerce.core.search.domain.IndexField;
  30 import org.broadleafcommerce.core.search.service.solr.SolrConfiguration;
  31 import org.broadleafcommerce.core.search.service.solr.indexer.CatalogSolrIndexUpdateService;
  32 
  33 
  34 /**
  35  * Service exposing several methods for creating a Solr index based on catalog product data.
  36  *
  37  * @see org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation
  38  * @author Andre Azzolini (apazzolini)
  39  * @author Jeff Fischer
  40  * @author Phillip Verheyden (phillipuniverse)
  41  */
  42 public interface SolrIndexService {
  43     /**
  44      * &lt;p&gt;
<abbr title="  45      * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collection and then swap">  45      * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collectiðŸ”µ</abbr>
<abbr title="  46      * out the active core/collection with the new version of the index (essentially replacing all documents that are">  46      * out the active core/collection with the new version of the index (essentially replacing all documeðŸ”µ</abbr>
  47      * currently in the index).
  48      *
  49      * &lt;p&gt;
  50      * The order of methods that are apart of rebuilding the entire index:
  51      * &lt;ol&gt;
  52      *  &lt;li&gt;&lt;pre&gt;{@link #preBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  53      *  &lt;li&gt;&lt;pre&gt;{@link #buildIndex()}&lt;/pre&gt;&lt;/li&gt;
  54      *  &lt;li&gt;&lt;pre&gt;{@link #postBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  55      * &lt;/ol&gt;
  56      *
  57      *
  58      * @throws IOException
  59      * @throws ServiceException
  60      */
  61     public void rebuildIndex() throws ServiceException, IOException;
  62 
  63     /**
<abbr title="  64      * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the current index. This">  64      * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the cuðŸ”µ</abbr>
  65      * is called at the beginning of {@link #rebuildIndex()}
  66      *
  67      * @throws ServiceException
  68      */
  69     public void preBuildIndex() throws ServiceException;
  70 
  71     /**
  72      * &lt;p&gt;
<abbr title="  73      * Handles all the document building for the current index rebuild. This is where all of the SolrIndexOperation&#x27;s need to be">  73      * Handles all the document building for the current index rebuild. This is where all of the SolrIndeðŸ”µ</abbr>
  74      * created, executed and the documents built and added to the Solr index
  75      *
  76      * &lt;p&gt;
<abbr title="  77      * This is the method that should be overridden to specify which operations should be run to build the correct index.">  77      * This is the method that should be overridden to specify which operations should be run to build thðŸ”µ</abbr>
  78      *
  79      * @throws IOException
  80      * @throws ServiceException
  81      * @see {@link #rebuildIndex()}
  82      * @see {@link #preBuildIndex()}
  83      */
  84     public void buildIndex() throws IOException, ServiceException;
  85 
  86     /**
<abbr title="  87      * Executed after we do any indexing when rebuilding the current index. Usually this handles optimizing the index and swapping the cores.">  87      * Executed after we do any indexing when rebuilding the current index. Usually this handles optimiziðŸ”µ</abbr>
  88      *
  89      * @throws IOException
  90      * @throws ServiceException
  91      */
  92     public void postBuildIndex() throws IOException, ServiceException;
  93 
  94     /**
<abbr title="  95      * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. This is the primary">  95      * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. TðŸ”µ</abbr>
  96      * index operation used to rebuild the index.
  97      *
  98      * @return a SolrIndexOperation capable of rebuilding the current index
  99      */
 100     public SolrIndexOperation getReindexOperation();
 101 
 102     /**
 103      * Executes the given &lt;b&gt;operation&lt;/b&gt; in the correct method order
 104      *
 105      * @param operation the SolrIndexOperation that is to be executed
 106      * @throws ServiceException
 107      * @throws IOException
 108      */
<abbr title=" 109     public void executeSolrIndexOperation(SolrIndexOperation operation) throws ServiceException, IOException;"> 109     public void executeSolrIndexOperation(SolrIndexOperation operation) throws ServiceException, IOExceptðŸ”µ</abbr>
 110 
 111     /**
 112      * Builds a set of {@link Indexable}s against the given {@link SolrServer}
 113      *
 114      * @param indexables
 115      * 		the list of items to index
 116      * @param solrServer
 117      * 		if non-null, adds and commits the indexed documents to the server. If this is null, this will
 118      * 		simply return the documents that were built from &lt;b&gt;indexables&lt;/b&gt;
 119      * @throws ServiceException
 120      *
 121      * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;
 122      * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;
 123      */
<abbr title=" 124     public abstract Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException;"> 124     public abstract Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extendsðŸ”µ</abbr>
 125 
 126     /**
 127      * Builds a set of {@link Indexable}s against the given {@link SolrServer}
 128      * @param indexables the list of items to index
<abbr title=" 129      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this will"> 129      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is nuðŸ”µ</abbr>
 130      * simply return the documents that were built from &lt;b&gt;indexables&lt;/b&gt;
 131      *
 132      * @throws ServiceException
 133      * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;
<abbr title=" 134      * @deprecated Use {@link #buildIncrementalIndex(String, List, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 134      * @deprecated Use {@link #buildIncrementalIndex(String, List, SolrClient)} instead so that the colleðŸ”µ</abbr>
 135      */
 136     @Deprecated
<abbr title=" 137     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException;"> 137     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrðŸ”µ</abbr>
 138 
 139     /**
 140      * Saves some global context that might be altered during indexing.
 141      *
 142      * @return
 143      */
 144     public Object[] saveState();
 145 
 146     /**
 147      * Restores state that was saved prior to indexing that might have been altered.
 148      *
 149      * @see #saveState()
 150      * @param pack
 151      */
 152     public void restoreState(Object[] pack);
 153 
 154     /**
<abbr title=" 155      * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@link #rebuildIndex()}"> 155      * Triggers the Solr optimize index function on the given server. This is typically called at the endðŸ”µ</abbr>
 156      *
 157      * @param server
 158      *
 159      * @throws ServiceException
 160      *
 161      * @throws IOException
 162      *
 163      * @throws IOException
 164      *
 165      */
<abbr title=" 166     public abstract void optimizeIndex(String collection, SolrClient server) throws ServiceException, IOException;"> 166     public abstract void optimizeIndex(String collection, SolrClient server) throws ServiceException, IOEðŸ”µ</abbr>
 167 
 168     /**
<abbr title=" 169      * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@link #rebuildIndex()}"> 169      * Triggers the Solr optimize index function on the given server. This is typically called at the endðŸ”µ</abbr>
 170      * @param server The server to use to optimze the default collection
 171      *
 172      * @throws ServiceException
 173      * @throws IOException
<abbr title=" 174      * @deprecated Use {@link #optimizeIndex(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 174      * @deprecated Use {@link #optimizeIndex(String, SolrClient)} instead so that the collection that&#x27;s bðŸ”µ</abbr>
 175      */
 176     @Deprecated
 177     public void optimizeIndex(SolrClient server) throws ServiceException, IOException;
 178 
 179     /**
<abbr title=" 180      * Allows a commit to be called.  By default, the details of the commit will depend on system properties, including:"> 180      * Allows a commit to be called.  By default, the details of the commit will depend on system propertðŸ”µ</abbr>
 181      *
<abbr title=" 182      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be configured in Solr."> 182      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) shðŸ”µ</abbr>
 183      * solr.index.softCommit - indicates if a soft commit should be performed
 184      * solr.index.waitSearcher - indicates if the process should wait for a searcher to be configured
 185      * solr.index.waitFlush - indicates if the process should wait for a flush to disk
 186      *
 187      * @param server
 188      *
 189      * @throws ServiceException
 190      *
 191      * @throws IOException
 192      *
 193      * @throws IOException
 194      *
 195      */
<abbr title=" 196     public abstract void commit(String collection, SolrClient server) throws ServiceException, IOException;"> 196     public abstract void commit(String collection, SolrClient server) throws ServiceException, IOExceptioðŸ”µ</abbr>
 197 
 198     /**
<abbr title=" 199      * Allows a commit to be called.  By default, the details of the commit will depend on system properties, including:"> 199      * Allows a commit to be called.  By default, the details of the commit will depend on system propertðŸ”µ</abbr>
 200      *
<abbr title=" 201      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be configured in Solr."> 201      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) shðŸ”µ</abbr>
 202      * solr.index.softCommit - indicates if a soft commit should be performed
 203      * solr.index.waitSearcher - indicates if the process should wait for a searcher to be configured
 204      * solr.index.waitFlush - indicates if the process should wait for a flush to disk
 205      * @param server The server used to commit the default collection
 206      *
 207      * @throws ServiceException
 208      * @throws IOException
<abbr title=" 209      * @deprecated Use {@link #commit(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 209      * @deprecated Use {@link #commit(String, SolrClient)} instead so that the collection that&#x27;s being usðŸ”µ</abbr>
 210      */
 211     @Deprecated
 212     public void commit(SolrClient server) throws ServiceException, IOException;
 213 
 214     /**
 215      * This allows an external caller to force a commit to the SolrClient.  See Solr Documentation for
 216      * additional details.  If using softCommit, you should ensure that a hardCommit is performed, either
 217      * using autoCommit, or at the end of the commit process to flush the changes to the disk.
 218      *
 219      * Note that this method will force a commit even if solr.index.commit=false
 220      *
 221      * @param server
 222      * 		- the SolrClient to update
 223      * @param softCommit
 224      * 		- soft commit is an efficient commit that does not write the data to the file system
 225      * @param waitSearcher
 226      * 		- whether or not to wait for a new searcher to be created
 227      * @param waitFlush
 228      * 		- whether or not to wait for a flush to disk.
 229      * @throws ServiceException
 230      *
 231      * @throws IOException
 232      *
 233      * @throws IOException
 234      *
 235      */
<abbr title=" 236     public abstract void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException;"> 236     public abstract void commit(String collection, SolrClient server, boolean softCommit, boolean waitSeaðŸ”µ</abbr>
 237 
 238     /**
 239      * This allows an external caller to force a commit to the SolrClient.  See Solr Documentation for
 240      * additional details.  If using softCommit, you should ensure that a hardCommit is performed, either
 241      * using autoCommit, or at the end of the commit process to flush the changes to the disk.
 242      *
 243      * Note that this method will force a commit even if solr.index.commit=false
 244      * @param server - the SolrClient to commit with
<abbr title=" 245      * @param softCommit - soft commit is an efficient commit that does not write the data to the file system"> 245      * @param softCommit - soft commit is an efficient commit that does not write the data to the file syðŸ”µ</abbr>
 246      * @param waitSearcher - whether or not to wait for a new searcher to be created
 247      * @param waitFlush - whether or not to wait for a flush to disk.
 248      *
 249      * @throws ServiceException
 250      * @throws IOException
<abbr title=" 251      * @deprecated Use {@link #commit(String, SolrClient, boolean, boolean, boolean)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 251      * @deprecated Use {@link #commit(String, SolrClient, boolean, boolean, boolean)} instead so that theðŸ”µ</abbr>
 252      */
 253     @Deprecated
<abbr title=" 254     public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException;"> 254     public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) thðŸ”µ</abbr>
 255 
<abbr title=" 256     public abstract void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceException;"> 256     public abstract void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceðŸ”µ</abbr>
 257 
 258     /**
<abbr title=" 259      * @deprecated Use {@link #deleteAllNamespaceDocuments(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 259      * @deprecated Use {@link #deleteAllNamespaceDocuments(String, SolrClient)} instead so that the colleðŸ”µ</abbr>
 260      */
 261     @Deprecated
 262     public abstract void deleteAllNamespaceDocuments(SolrClient server) throws ServiceException;
 263 
<abbr title=" 264     public abstract void deleteAllDocuments(String collection, SolrClient server) throws ServiceException;"> 264     public abstract void deleteAllDocuments(String collection, SolrClient server) throws ServiceExceptionðŸ”µ</abbr>
 265 
 266     /**
 267      *
 268      *
 269      * @param skus
 270      *
 271      */
 272     @Deprecated
 273     public abstract void deleteAllDocuments(SolrClient server) throws ServiceException;
 274 
 275     /**
 276      * Prints out the docs to the trace logger
 277      *
 278      * @param documents
 279      */
 280     public void logDocuments(Collection&lt;SolrInputDocument&gt; documents);
 281 
 282     /**
 283      * @return a list of all possible locale prefixes to consider
 284      */
 285     public List&lt;Locale&gt; getAllLocales();
 286 
 287     /**
<abbr title=" 288      * Given a product, fields that relate to that product, and a list of locales and pricelists, builds a"> 288      * Given a product, fields that relate to that product, and a list of locales and pricelists, builds ðŸ”µ</abbr>
 289      * SolrInputDocument to be added to the Solr index.
 290      *
 291      * @param product
 292      * @param fields
 293      * @param locales
 294      * @return the document
 295      */
<abbr title=" 296     public SolrInputDocument buildDocument(Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);"> 296     public SolrInputDocument buildDocument(Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locðŸ”µ</abbr>
 297 
 298     /**
 299      * SolrIndexService exposes {@link #buildIncrementalIndex(int, int, boolean)}.
<abbr title=" 300      * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation.CacheOperation},"> 300      * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.sðŸ”µ</abbr>
<abbr title=" 301      * a single cache will be used for all the contained calls to buildIncrementalIndex. Here&#x27;s an example:"> 301      * a single cache will be used for all the contained calls to buildIncrementalIndex. Here&#x27;s an examplðŸ”µ</abbr>
 302      * {@code
 303      *  performCachedOperation(new SolrIndexCachedOperation.CacheOperation() {
 304      *        @Override
 305      *        public void execute() throws ServiceException {
 306      *            int page = 0;
 307      *            while ((page * pageSize) &lt; numProducts) {
 308      *                buildIncrementalIndex(page, pageSize);
 309      *                page++;
 310      *            }
 311      *        }
 312      *    });
 313      * }
<abbr title=" 314      * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not necessary to call performCacheOperation"> 314      * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not ðŸ”µ</abbr>
 315      * for calls to rebuildIndex().
 316      *
 317      * @param cacheOperation the block of code to perform using a single cache for best performance
 318      * @throws ServiceException
 319      */
<abbr title=" 320     public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceException;"> 320     public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws SerðŸ”µ</abbr>
 321 
 322     /**
 323      * Iterates through the fields for this indexable and indexes any SearchField&#x27;s or SearchFacet&#x27;s.
 324      *  @param document
 325      * @param indexable
 326      * @param fields
 327      * @param locales
 328      */
<abbr title=" 329     public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);"> 329     public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexðŸ”µ</abbr>
 330 
 331     void deleteByQuery(String deleteQuery) throws SolrServerException, IOException;
 332 
 333     void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerException;
 334 
 335     void logDeleteQuery(String deleteQuery);
 336 
 337     /**
<abbr title=" 338      * Indicates if this should be used.  The alternative is to use {@link CatalogSolrIndexUpdateService}. By default, this is driven by the property,"> 338      * Indicates if this should be used.  The alternative is to use {@link CatalogSolrIndexUpdateService}ðŸ”µ</abbr>
 339      * &#x27;solr.catalog.useLegacySolrIndexer&#x27;, which defaults to true.
 340      *
 341      * @return
 342      */
 343     public boolean useLegacyIndexer();
 344 }</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  /*
   2   * #%L
   3   * BroadleafCommerce Framework
   4   * %%
   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce
   6   * %%
   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0
   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)
   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case
  10   * the Broadleaf End User License Agreement (EULA), Version 1.1
  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)
  12   * shall apply.
  13   *
<abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr>
  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.
  16   * #L%
  17   */
  18  package org.broadleafcommerce.core.search.service.solr.index;
  19  
  20  import org.apache.solr.client.solrj.SolrClient;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  21 -import org.apache.solr.client.solrj.SolrServer;</span>
  22  import org.apache.solr.client.solrj.SolrServerException;
  23  import org.apache.solr.common.SolrInputDocument;
  24  import org.broadleafcommerce.common.exception.ServiceException;
  25  import org.broadleafcommerce.common.locale.domain.Locale;
  26  import org.broadleafcommerce.core.catalog.domain.Indexable;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  27 -import org.broadleafcommerce.core.catalog.domain.Sku;</span>
  28  import org.broadleafcommerce.core.search.domain.IndexField;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  29 +import org.broadleafcommerce.core.search.service.solr.SolrConfiguration;</span>
  30  
  31  import java.io.IOException;
  32  import java.util.Collection;
  33  import java.util.List;
  34  
  35  /**
  36   * Service exposing several methods for creating a Solr index based on catalog product data.
  37   *
  38   * @see org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation
  39   * @author Andre Azzolini (apazzolini)
  40   * @author Jeff Fischer
  41   * @author Phillip Verheyden (phillipuniverse)
  42   */
  43  public interface SolrIndexService {
  44  
  45      /**
  46       * &lt;p&gt;
<abbr title="  47       * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collection and then swap">  47       * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collection and thðŸ”µ</abbr>
<abbr title="  48       * out the active core/collection with the new version of the index (essentially replacing all documents that are">  48       * out the active core/collection with the new version of the index (essentially replacing all documents that ðŸ”µ</abbr>
  49       * currently in the index).
  50       *
  51       * &lt;p&gt;
  52       * The order of methods that are apart of rebuilding the entire index:
  53       * &lt;ol&gt;
  54       *  &lt;li&gt;&lt;pre&gt;{@link #preBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  55       *  &lt;li&gt;&lt;pre&gt;{@link #buildIndex()}&lt;/pre&gt;&lt;/li&gt;
  56       *  &lt;li&gt;&lt;pre&gt;{@link #postBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  57       * &lt;/ol&gt;
  58       *
  59       *
  60       * @throws IOException
  61       * @throws ServiceException
  62       */
  63      public void rebuildIndex() throws ServiceException, IOException;
  64  
  65      /**
<abbr title="  66       * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the current index. This">  66       * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the current indðŸ”µ</abbr>
  67       * is called at the beginning of {@link #rebuildIndex()}
  68       *
  69       * @throws ServiceException
  70       */
  71      public void preBuildIndex() throws ServiceException;
  72  
  73      /**
  74       * &lt;p&gt;
<abbr title="  75       * Handles all the document building for the current index rebuild. This is where all of the SolrIndexOperation&#x27;s need to be">  75       * Handles all the document building for the current index rebuild. This is where all of the SolrIndexOperatioðŸ”µ</abbr>
  76       * created, executed and the documents built and added to the Solr index
  77       *
  78       * &lt;p&gt;
<abbr title="  79       * This is the method that should be overridden to specify which operations should be run to build the correct index.">  79       * This is the method that should be overridden to specify which operations should be run to build the correctðŸ”µ</abbr>
  80       *
  81       * @throws IOException
  82       * @throws ServiceException
  83       * @see {@link #rebuildIndex()}
  84       * @see {@link #preBuildIndex()}
  85       */
  86      public void buildIndex() throws IOException, ServiceException;
  87  
  88      /**
<abbr title="  89       * Executed after we do any indexing when rebuilding the current index. Usually this handles optimizing the index and swapping the cores.">  89       * Executed after we do any indexing when rebuilding the current index. Usually this handles optimizing the inðŸ”µ</abbr>
  90       *
  91       * @throws IOException
  92       * @throws ServiceException
  93       */
  94      public void postBuildIndex() throws IOException, ServiceException;
  95  
  96      /**
<abbr title="  97       * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. This is the primary">  97       * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. This is thðŸ”µ</abbr>
  98       * index operation used to rebuild the index.
  99       *
 100       * @return a SolrIndexOperation capable of rebuilding the current index
 101       */
 102      public SolrIndexOperation getReindexOperation();
 103  
 104      /**
 105       * Executes the given &lt;b&gt;operation&lt;/b&gt; in the correct method order
 106       *
 107       * @param operation the SolrIndexOperation that is to be executed
 108       * @throws ServiceException
 109       * @throws IOException
 110       */
 111      public void executeSolrIndexOperation(SolrIndexOperation operation) throws ServiceException, IOException;
 112  
 113      /**
 114       * Builds a set of {@link Indexable}s against the given {@link SolrServer}
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 115 -     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 116 +     * @param collection The collection to be used for incremental indexing</span>
 117       * @param indexables the list of items to index
<abbr title=" 118       * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this will"> 118       * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this ðŸ”µ</abbr>
 119       * simply return the documents that were built from &lt;b&gt;indexables&lt;/b&gt;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +     *</span>
 121       * @throws ServiceException
 122       * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;
 123       */
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 124 +    public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException;"> 124 +    public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends Indexable&gt; indexaðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +     * Builds a set of {@link Indexable}s against the given {@link SolrServer}</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +     * @param indexables the list of items to index</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 129 +     * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this will"> 129 +     * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 130 +     * simply return the documents that were built from &lt;b&gt;indexables&lt;/b&gt;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 131 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 132 +     * @throws ServiceException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 133 +     * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 134 +     * @deprecated Use {@link #buildIncrementalIndex(String, List, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 134 +     * @deprecated Use {@link #buildIncrementalIndex(String, List, SolrClient)} instead so that the collection thaðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 135 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 136 +    @Deprecated</span>
<abbr title=" 137      public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException;"> 137      public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient soðŸ”µ</abbr>
 138  
 139      /**
 140       * Saves some global context that might be altered during indexing.
 141       *
 142       * @return
 143       */
 144      public Object[] saveState();
 145  
 146      /**
 147       * Restores state that was saved prior to indexing that might have been altered.
 148       *
 149       * @see #saveState()
 150       * @param pack
 151       */
 152      public void restoreState(Object[] pack);
 153  
 154      /**
<abbr title=" 155       * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@link #rebuildIndex()}"> 155       * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@lðŸ”µ</abbr>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 156 -     *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 157 -     * @param server</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 158 -     * @throws ServiceException</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 159 -     * @throws IOException</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 160 -     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 161 +     * @param collection The collection to optimize</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 162 +     * @param server The server to use to optimze the given collection</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 163 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 164 +     * @throws ServiceException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 165 +     * @throws IOException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 166 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 167 +    public void optimizeIndex(String collection, SolrClient server) throws ServiceException, IOException;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 168 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 169 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 170 +     * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@link #rebuildIndex()}"> 170 +     * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@lðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 171 +     * @param server The server to use to optimze the default collection</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 172 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 173 +     * @throws ServiceException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 174 +     * @throws IOException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 175 +     * @deprecated Use {@link #optimizeIndex(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 175 +     * @deprecated Use {@link #optimizeIndex(String, SolrClient)} instead so that the collection that&#x27;s being usedðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +    @Deprecated</span>
 178      public void optimizeIndex(SolrClient server) throws ServiceException, IOException;
 179  
 180      /**
<abbr title=" 181       * Allows a commit to be called.  By default, the details of the commit will depend on system properties, including:"> 181       * Allows a commit to be called.  By default, the details of the commit will depend on system properties, inclðŸ”µ</abbr>
 182       *
<abbr title=" 183       * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be configured in Solr."> 183       * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be cðŸ”µ</abbr>
 184       * solr.index.softCommit - indicates if a soft commit should be performed
 185       * solr.index.waitSearcher - indicates if the process should wait for a searcher to be configured
 186       * solr.index.waitFlush - indicates if the process should wait for a flush to disk
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 187 -     *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 188 -     * @param server</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 189 -     * @throws ServiceException</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 190 -     * @throws IOException</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 191 -     */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 192 -</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 193 +     * @param collection The collection to commit</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 194 +     * @param server The server used to commit the specified collection</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 195 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 196 +     * @throws ServiceException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 197 +     * @throws IOException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 198 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 199 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 200 +    public void commit(String collection, SolrClient server) throws ServiceException, IOException;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 201 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 202 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 203 +     * Allows a commit to be called.  By default, the details of the commit will depend on system properties, including:"> 203 +     * Allows a commit to be called.  By default, the details of the commit will depend on system properties, inclðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 204 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 205 +     * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be configured in Solr."> 205 +     * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be cðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 206 +     * solr.index.softCommit - indicates if a soft commit should be performed</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 207 +     * solr.index.waitSearcher - indicates if the process should wait for a searcher to be configured</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 208 +     * solr.index.waitFlush - indicates if the process should wait for a flush to disk</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 209 +     * @param server The server used to commit the default collection</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 210 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 211 +     * @throws ServiceException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 212 +     * @throws IOException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 213 +     * @deprecated Use {@link #commit(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 213 +     * @deprecated Use {@link #commit(String, SolrClient)} instead so that the collection that&#x27;s being used can beðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 214 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 215 +    @Deprecated</span>
 216      public void commit(SolrClient server) throws ServiceException, IOException;
 217  
 218      /**
 219       * This allows an external caller to force a commit to the SolrClient.  See Solr Documentation for
 220       * additional details.  If using softCommit, you should ensure that a hardCommit is performed, either
 221       * using autoCommit, or at the end of the commit process to flush the changes to the disk.
 222       *
 223       * Note that this method will force a commit even if solr.index.commit=false
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 224 -     *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 225 -     * @param server - the SolrClient to update</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 226 +     * @param collection The collection to commit</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 227 +     * @param server - the SolrClient to use to commit the provided collection</span>
 228       * @param softCommit - soft commit is an efficient commit that does not write the data to the file system
 229       * @param waitSearcher - whether or not to wait for a new searcher to be created
 230       * @param waitFlush - whether or not to wait for a flush to disk.
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 231 -     * @throws ServiceException</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 232 -     * @throws IOException</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 233 -     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 234 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 235 +     * @throws ServiceException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 236 +     * @throws IOException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 237 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 238 +    public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException;"> 238 +    public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boolean waiðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 239 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 240 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +     * This allows an external caller to force a commit to the SolrClient.  See Solr Documentation for</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +     * additional details.  If using softCommit, you should ensure that a hardCommit is performed, either</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 243 +     * using autoCommit, or at the end of the commit process to flush the changes to the disk.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 244 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 245 +     * Note that this method will force a commit even if solr.index.commit=false</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 246 +     * @param server - the SolrClient to commit with</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 247 +     * @param softCommit - soft commit is an efficient commit that does not write the data to the file system</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 248 +     * @param waitSearcher - whether or not to wait for a new searcher to be created</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 249 +     * @param waitFlush - whether or not to wait for a flush to disk.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 250 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +     * @throws ServiceException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +     * @throws IOException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 253 +     * @deprecated Use {@link #commit(String, SolrClient, boolean, boolean, boolean)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 253 +     * @deprecated Use {@link #commit(String, SolrClient, boolean, boolean, boolean)} instead so that the collectiðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 254 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 255 +    @Deprecated</span>
<abbr title=" 256      public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException;"> 256      public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServðŸ”µ</abbr>
 257  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 258 +    public void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceException;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 259 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 260 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 261 +     * @deprecated Use {@link #deleteAllNamespaceDocuments(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 261 +     * @deprecated Use {@link #deleteAllNamespaceDocuments(String, SolrClient)} instead so that the collection thaðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 262 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 263 +    @Deprecated</span>
 264      public void deleteAllNamespaceDocuments(SolrClient server) throws ServiceException;
 265  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 266 +    public void deleteAllDocuments(String collection, SolrClient server) throws ServiceException;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 267 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 268 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 269 +     * @deprecated Use {@link #deleteAllDocuments(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 269 +     * @deprecated Use {@link #deleteAllDocuments(String, SolrClient)} instead so that the collection that&#x27;s beingðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 270 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 271 +    @Deprecated</span>
 272      public void deleteAllDocuments(SolrClient server) throws ServiceException;
 273  
 274      /**
 275       * Prints out the docs to the trace logger
 276       *
 277       * @param documents
 278       */
 279      public void logDocuments(Collection&lt;SolrInputDocument&gt; documents);
 280  
 281      /**
 282       * @return a list of all possible locale prefixes to consider
 283       */
 284      public List&lt;Locale&gt; getAllLocales();
 285  
 286      /**
 287       * Given a product, fields that relate to that product, and a list of locales and pricelists, builds a
 288       * SolrInputDocument to be added to the Solr index.
 289       *
 290       * @param product
 291       * @param fields
 292       * @param locales
 293       * @return the document
 294       */
 295      public SolrInputDocument buildDocument(Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);
 296  
 297      /**
 298       * SolrIndexService exposes {@link #buildIncrementalIndex(int, int, boolean)}.
<abbr title=" 299       * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation.CacheOperation},"> 299       * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.solr.indexðŸ”µ</abbr>
 300       * a single cache will be used for all the contained calls to buildIncrementalIndex. Here&#x27;s an example:
 301       * {@code
 302       *  performCachedOperation(new SolrIndexCachedOperation.CacheOperation() {
 303       *        @Override
 304       *        public void execute() throws ServiceException {
 305       *            int page = 0;
 306       *            while ((page * pageSize) &lt; numProducts) {
 307       *                buildIncrementalIndex(page, pageSize);
 308       *                page++;
 309       *            }
 310       *        }
 311       *    });
 312       * }
<abbr title=" 313       * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not necessary to call performCacheOperation"> 313       * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not necessaryðŸ”µ</abbr>
 314       * for calls to rebuildIndex().
 315       *
 316       * @param cacheOperation the block of code to perform using a single cache for best performance
 317       * @throws ServiceException
 318       */
<abbr title=" 319      public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceException;"> 319      public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceExcepðŸ”µ</abbr>
 320  
 321      /**
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 322 -     * &lt;p&gt;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 323 -     * Filters out Skus that shouldn&#x27;t be indexed if any of the following are true:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 324 -     *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 325 -     * &lt;p&gt;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 326 -     * &lt;ol&gt;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 327 -     *  &lt;li&gt;If it&#x27;s inactive&lt;/li&gt;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 328 -     *  &lt;li&gt;If it&#x27;s a default Sku and shouldn&#x27;t be sold without product options&lt;/li&gt;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 329 -     *  &lt;li&gt;If it&#x27;s a default Sku for a Product Bundle&lt;/li&gt;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 330 -     * &lt;/ol&gt;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 331 -     *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 332 -     * @param skus</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 333 -     * @return a new list based on the given set of &lt;b&gt;skus&lt;/b&gt; that only contains Skus that should be indexed</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 334 -     */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 335 -    public List&lt;Sku&gt; filterIndexableSkus(List&lt;Sku&gt; skus);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 336 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 337 -    /**</span>
 338       * Iterates through the fields for this indexable and indexes any SearchField&#x27;s or SearchFacet&#x27;s.
 339       *  @param document
 340       * @param indexable
 341       * @param fields
 342       * @param locales
 343       */
<abbr title=" 344      public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);"> 344      public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fiðŸ”µ</abbr>
 345  
 346      void deleteByQuery(String deleteQuery) throws SolrServerException, IOException;
 347  
 348      void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerException;
 349  
 350      void logDeleteQuery(String deleteQuery);








 351  }</pre></td>
                            <td><pre>   1  /*
   2   * #%L
   3   * BroadleafCommerce Framework
   4   * %%
   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce
   6   * %%
   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0
   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)
   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case
  10   * the Broadleaf End User License Agreement (EULA), Version 1.1
  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)
  12   * shall apply.
  13   *
<abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr>
  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.
  16   * #L%
  17   */
  18  package org.broadleafcommerce.core.search.service.solr.index;
  19  
  20  import org.apache.solr.client.solrj.SolrClient;
  21  import org.apache.solr.client.solrj.SolrServer;
  22  import org.apache.solr.client.solrj.SolrServerException;
  23  import org.apache.solr.common.SolrInputDocument;
  24  import org.broadleafcommerce.common.exception.ServiceException;
  25  import org.broadleafcommerce.common.locale.domain.Locale;
  26  import org.broadleafcommerce.core.catalog.domain.Indexable;
  27  import org.broadleafcommerce.core.catalog.domain.Sku;
  28  import org.broadleafcommerce.core.search.domain.IndexField;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  29 +import org.broadleafcommerce.core.search.service.solr.indexer.CatalogSolrIndexUpdateService;</span>
  30  
  31  import java.io.IOException;
  32  import java.util.Collection;
  33  import java.util.List;
  34  
  35  /**
  36   * Service exposing several methods for creating a Solr index based on catalog product data.
  37   *
  38   * @see org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation
  39   * @author Andre Azzolini (apazzolini)
  40   * @author Jeff Fischer
  41   * @author Phillip Verheyden (phillipuniverse)
  42   */
  43  public interface SolrIndexService {
  44  
  45      /**
  46       * &lt;p&gt;
<abbr title="  47       * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collection and then swap">  47       * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collection and thðŸ”µ</abbr>
<abbr title="  48       * out the active core/collection with the new version of the index (essentially replacing all documents that are">  48       * out the active core/collection with the new version of the index (essentially replacing all documents that ðŸ”µ</abbr>
  49       * currently in the index).
  50       *
  51       * &lt;p&gt;
  52       * The order of methods that are apart of rebuilding the entire index:
  53       * &lt;ol&gt;
  54       *  &lt;li&gt;&lt;pre&gt;{@link #preBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  55       *  &lt;li&gt;&lt;pre&gt;{@link #buildIndex()}&lt;/pre&gt;&lt;/li&gt;
  56       *  &lt;li&gt;&lt;pre&gt;{@link #postBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  57       * &lt;/ol&gt;
  58       *
  59       *
  60       * @throws IOException
  61       * @throws ServiceException
  62       */
  63      public void rebuildIndex() throws ServiceException, IOException;
  64  
  65      /**
<abbr title="  66       * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the current index. This">  66       * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the current indðŸ”µ</abbr>
  67       * is called at the beginning of {@link #rebuildIndex()}
  68       *
  69       * @throws ServiceException
  70       */
  71      public void preBuildIndex() throws ServiceException;
  72  
  73      /**
  74       * &lt;p&gt;
<abbr title="  75       * Handles all the document building for the current index rebuild. This is where all of the SolrIndexOperation&#x27;s need to be">  75       * Handles all the document building for the current index rebuild. This is where all of the SolrIndexOperatioðŸ”µ</abbr>
  76       * created, executed and the documents built and added to the Solr index
  77       *
  78       * &lt;p&gt;
<abbr title="  79       * This is the method that should be overridden to specify which operations should be run to build the correct index.">  79       * This is the method that should be overridden to specify which operations should be run to build the correctðŸ”µ</abbr>
  80       *
  81       * @throws IOException
  82       * @throws ServiceException
  83       * @see {@link #rebuildIndex()}
  84       * @see {@link #preBuildIndex()}
  85       */
  86      public void buildIndex() throws IOException, ServiceException;
  87  
  88      /**
<abbr title="  89       * Executed after we do any indexing when rebuilding the current index. Usually this handles optimizing the index and swapping the cores.">  89       * Executed after we do any indexing when rebuilding the current index. Usually this handles optimizing the inðŸ”µ</abbr>
  90       *
  91       * @throws IOException
  92       * @throws ServiceException
  93       */
  94      public void postBuildIndex() throws IOException, ServiceException;
  95  
  96      /**
<abbr title="  97       * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. This is the primary">  97       * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. This is thðŸ”µ</abbr>
  98       * index operation used to rebuild the index.
  99       *
 100       * @return a SolrIndexOperation capable of rebuilding the current index
 101       */
 102      public SolrIndexOperation getReindexOperation();
 103  
 104      /**
 105       * Executes the given &lt;b&gt;operation&lt;/b&gt; in the correct method order
 106       *
 107       * @param operation the SolrIndexOperation that is to be executed
 108       * @throws ServiceException
 109       * @throws IOException
 110       */
 111      public void executeSolrIndexOperation(SolrIndexOperation operation) throws ServiceException, IOException;
 112  
 113      /**
 114       * Builds a set of {@link Indexable}s against the given {@link SolrServer}
 115       *

 116       * @param indexables the list of items to index
<abbr title=" 117       * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this will"> 117       * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this ðŸ”µ</abbr>
 118       * simply return the documents that were built from &lt;b&gt;indexables&lt;/b&gt;

 119       * @throws ServiceException
 120       * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;
 121       */













<abbr title=" 122      public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException;"> 122      public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient soðŸ”µ</abbr>
 123  
 124      /**
 125       * Saves some global context that might be altered during indexing.
 126       *
 127       * @return
 128       */
 129      public Object[] saveState();
 130  
 131      /**
 132       * Restores state that was saved prior to indexing that might have been altered.
 133       *
 134       * @see #saveState()
 135       * @param pack
 136       */
 137      public void restoreState(Object[] pack);
 138  
 139      /**
<abbr title=" 140       * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@link #rebuildIndex()}"> 140       * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@lðŸ”µ</abbr>
 141       *
 142       * @param server
 143       * @throws ServiceException
 144       * @throws IOException
 145       */

















 146      public void optimizeIndex(SolrClient server) throws ServiceException, IOException;
 147  
 148      /**
<abbr title=" 149       * Allows a commit to be called.  By default, the details of the commit will depend on system properties, including:"> 149       * Allows a commit to be called.  By default, the details of the commit will depend on system properties, inclðŸ”µ</abbr>
 150       *
<abbr title=" 151       * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be configured in Solr."> 151       * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be cðŸ”µ</abbr>
 152       * solr.index.softCommit - indicates if a soft commit should be performed
 153       * solr.index.waitSearcher - indicates if the process should wait for a searcher to be configured
 154       * solr.index.waitFlush - indicates if the process should wait for a flush to disk
 155       *
 156       * @param server
 157       * @throws ServiceException
 158       * @throws IOException
 159       */
 160  























 161      public void commit(SolrClient server) throws ServiceException, IOException;
 162  
 163      /**
 164       * This allows an external caller to force a commit to the SolrClient.  See Solr Documentation for
 165       * additional details.  If using softCommit, you should ensure that a hardCommit is performed, either
 166       * using autoCommit, or at the end of the commit process to flush the changes to the disk.
 167       *
 168       * Note that this method will force a commit even if solr.index.commit=false
 169       *
 170       * @param server - the SolrClient to update


 171       * @param softCommit - soft commit is an efficient commit that does not write the data to the file system
 172       * @param waitSearcher - whether or not to wait for a new searcher to be created
 173       * @param waitFlush - whether or not to wait for a flush to disk.
 174       * @throws ServiceException
 175       * @throws IOException
 176       */






















<abbr title=" 177      public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException;"> 177      public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServðŸ”µ</abbr>
 178  






 179      public void deleteAllNamespaceDocuments(SolrClient server) throws ServiceException;
 180  






 181      public void deleteAllDocuments(SolrClient server) throws ServiceException;
 182  
 183      /**
 184       * Prints out the docs to the trace logger
 185       *
 186       * @param documents
 187       */
 188      public void logDocuments(Collection&lt;SolrInputDocument&gt; documents);
 189  
 190      /**
 191       * @return a list of all possible locale prefixes to consider
 192       */
 193      public List&lt;Locale&gt; getAllLocales();
 194  
 195      /**
 196       * Given a product, fields that relate to that product, and a list of locales and pricelists, builds a
 197       * SolrInputDocument to be added to the Solr index.
 198       *
 199       * @param product
 200       * @param fields
 201       * @param locales
 202       * @return the document
 203       */
 204      public SolrInputDocument buildDocument(Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);
 205  
 206      /**
 207       * SolrIndexService exposes {@link #buildIncrementalIndex(int, int, boolean)}.
<abbr title=" 208       * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation.CacheOperation},"> 208       * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.solr.indexðŸ”µ</abbr>
 209       * a single cache will be used for all the contained calls to buildIncrementalIndex. Here&#x27;s an example:
 210       * {@code
 211       *  performCachedOperation(new SolrIndexCachedOperation.CacheOperation() {
 212       *        @Override
 213       *        public void execute() throws ServiceException {
 214       *            int page = 0;
 215       *            while ((page * pageSize) &lt; numProducts) {
 216       *                buildIncrementalIndex(page, pageSize);
 217       *                page++;
 218       *            }
 219       *        }
 220       *    });
 221       * }
<abbr title=" 222       * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not necessary to call performCacheOperation"> 222       * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not necessaryðŸ”µ</abbr>
 223       * for calls to rebuildIndex().
 224       *
 225       * @param cacheOperation the block of code to perform using a single cache for best performance
 226       * @throws ServiceException
 227       */
<abbr title=" 228      public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceException;"> 228      public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceExcepðŸ”µ</abbr>
 229  
 230      /**
 231       * &lt;p&gt;
 232       * Filters out Skus that shouldn&#x27;t be indexed if any of the following are true:
 233       *
 234       * &lt;p&gt;
 235       * &lt;ol&gt;
 236       *  &lt;li&gt;If it&#x27;s inactive&lt;/li&gt;
 237       *  &lt;li&gt;If it&#x27;s a default Sku and shouldn&#x27;t be sold without product options&lt;/li&gt;
 238       *  &lt;li&gt;If it&#x27;s a default Sku for a Product Bundle&lt;/li&gt;
 239       * &lt;/ol&gt;
 240       *
 241       * @param skus
 242       * @return a new list based on the given set of &lt;b&gt;skus&lt;/b&gt; that only contains Skus that should be indexed
 243       */
 244      public List&lt;Sku&gt; filterIndexableSkus(List&lt;Sku&gt; skus);
 245  
 246      /**
 247       * Iterates through the fields for this indexable and indexes any SearchField&#x27;s or SearchFacet&#x27;s.
 248       *  @param document
 249       * @param indexable
 250       * @param fields
 251       * @param locales
 252       */
<abbr title=" 253      public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);"> 253      public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fiðŸ”µ</abbr>
 254  
 255      void deleteByQuery(String deleteQuery) throws SolrServerException, IOException;
 256  
 257      void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerException;
 258  
 259      void logDeleteQuery(String deleteQuery);
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 260 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 261 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 262 +     * Indicates if this should be used.  The alternative is to use {@link CatalogSolrIndexUpdateService}. By default, this is driven by the property,"> 262 +     * Indicates if this should be used.  The alternative is to use {@link CatalogSolrIndexUpdateService}. By defaðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 263 +     * &#x27;solr.catalog.useLegacySolrIndexer&#x27;, which defaults to true.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 264 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 265 +     * @return</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 266 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 267 +    public boolean useLegacyIndexer();</span>
 268  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            