<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>78</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    78
                    <a href="77.html">prev</a>
                    <a href="79.html">next</a>
                    <a href="78_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    CarGuo/GSYVideoPlayer_5f2ec5bba1e993bd2142fb8506716e29792caaeb_app/src/main/java/com/example/gsyvideoplayer/DetailControlActivity.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CarGuo\GSYVideoPlayer show &quot;5f2ec5bba1e993bd2142fb8506716e29792caaeb:app/src/main/java/com/example/gsyvideoplayer/DetailControlActivity.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CarGuo\GSYVideoPlayer show &quot;5f2ec5bba1e993bd2142fb8506716e29792caaeb^1:app/src/main/java/com/example/gsyvideoplayer/DetailControlActivity.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CarGuo\GSYVideoPlayer show &quot;5f2ec5bba1e993bd2142fb8506716e29792caaeb^2:app/src/main/java/com/example/gsyvideoplayer/DetailControlActivity.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CarGuo\GSYVideoPlayer show &quot;3b95c518ed76af696e22a4380a88d67304e0e5a6:app/src/main/java/com/example/gsyvideoplayer/DetailControlActivity.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj], [bj]], subset: [[bj], [bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 package com.example.gsyvideoplayer;
   2 
   3 import android.Manifest;
   4 import android.app.AlertDialog;
   5 import android.content.DialogInterface;
   6 import android.content.res.Configuration;
   7 import android.graphics.Bitmap;
   8 import android.os.Bundle;
   9 import android.support.annotation.NonNull;
  10 import android.support.v4.widget.NestedScrollView;
  11 import android.view.View;
  12 import android.widget.Button;
  13 import android.widget.ImageView;
  14 import android.widget.RelativeLayout;
  15 import android.widget.Toast;
  16 
  17 import com.bumptech.glide.Glide;
  18 import com.bumptech.glide.request.RequestOptions;
  19 import com.example.gsyvideoplayer.utils.CommonUtil;
  20 import com.example.gsyvideoplayer.utils.JumpUtils;
  21 import com.example.gsyvideoplayer.video.SampleControlVideo;
  22 import com.shuyu.gsyvideoplayer.GSYBaseActivityDetail;
  23 import com.shuyu.gsyvideoplayer.GSYVideoManager;
  24 import com.shuyu.gsyvideoplayer.builder.GSYVideoOptionBuilder;
  25 import com.shuyu.gsyvideoplayer.listener.GSYVideoGifSaveListener;
  26 import com.shuyu.gsyvideoplayer.listener.GSYVideoShotListener;
  27 import com.shuyu.gsyvideoplayer.listener.LockClickListener;
  28 import com.shuyu.gsyvideoplayer.model.VideoOptionModel;
  29 import com.shuyu.gsyvideoplayer.utils.Debuger;
  30 import com.shuyu.gsyvideoplayer.utils.FileUtils;
  31 import com.shuyu.gsyvideoplayer.utils.GifCreateHelper;
  32 import com.shuyu.gsyvideoplayer.video.StandardGSYVideoPlayer;
  33 import com.shuyu.gsyvideoplayer.video.base.GSYBaseVideoPlayer;
  34 
  35 import java.io.File;
  36 import java.io.FileNotFoundException;
  37 import java.util.ArrayList;
  38 import java.util.List;
  39 
  40 import butterknife.BindView;
  41 import butterknife.ButterKnife;
  42 import permissions.dispatcher.NeedsPermission;
  43 import permissions.dispatcher.OnNeverAskAgain;
  44 import permissions.dispatcher.OnPermissionDenied;
  45 import permissions.dispatcher.OnShowRationale;
  46 import permissions.dispatcher.PermissionRequest;
  47 import permissions.dispatcher.RuntimePermissions;
  48 import tv.danmaku.ijk.media.player.IjkMediaPlayer;
  49 
  50 /**
  51  * sampleVideoæ”¯æŒå…¨å±ä¸éå…¨å±åˆ‡æ¢çš„æ¸…æ™°åº¦ï¼Œæ—‹è½¬ï¼Œé•œåƒç­‰åŠŸèƒ½.
  52  * Activityå¯ä»¥ç»§æ‰¿GSYBaseActivityDetailå®ç°è¯¦æƒ…æ¨¡å¼çš„é¡µé¢
  53  * æˆ–è€…å‚è€ƒDetailPlayerã€DetailListPlayerå®ç°
  54  * &lt;p&gt;
  55  * Created by guoshuyu on 2017/6/18.
  56  */
  57 @RuntimePermissions
  58 public class DetailControlActivity extends GSYBaseActivityDetail&lt;StandardGSYVideoPlayer&gt; {
  59 
  60     @BindView(R.id.post_detail_nested_scroll)
  61     NestedScrollView postDetailNestedScroll;
  62 
  63     @BindView(R.id.detail_player)
  64     SampleControlVideo detailPlayer;
  65 
  66     @BindView(R.id.activity_detail_player)
  67     RelativeLayout activityDetailPlayer;
  68 
  69     @BindView(R.id.change_speed)
  70     Button changeSpeed;
  71 
  72 
  73     @BindView(R.id.jump)
  74     Button jump;
  75 
  76     @BindView(R.id.shot)
  77     Button shot;
  78 
  79     @BindView(R.id.start_gif)
  80     Button startGif;
  81 
  82     @BindView(R.id.stop_gif)
  83     Button stopGif;
  84 
  85     @BindView(R.id.loadingView)
  86     View loadingView;
  87 
  88     private String url = &quot;http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4&quot;;
  89     //private String url = &quot;http://livecdn1.news.cn/Live_MajorEvent01Phone/manifest.m3u8&quot;;
<abbr title="  90     //private String url = &quot;https://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/8908d124aa839d0d3fa9593855ef5957.m3u8&quot;;">  90     //private String url = &quot;https://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/ğŸ”µ</abbr>
<abbr title="  91     //private String url2 = &quot;http://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/3aca1a0db8db9418dcbc765848c8903e.m3u8&quot;;">  91     //private String url2 = &quot;http://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/ğŸ”µ</abbr>
  92 
  93 
  94     private GifCreateHelper mGifCreateHelper;
  95 
  96     private float speed = 1;
  97 
  98     @Override
  99     protected void onCreate(Bundle savedInstanceState) {
 100         super.onCreate(savedInstanceState);
 101         setContentView(R.layout.activity_detail_control);
 102         ButterKnife.bind(this);
 103 
 104         resolveNormalVideoUI();
 105 
 106         initVideoBuilderMode();
 107 
 108         initGifHelper();
 109 
 110         detailPlayer.setLockClickListener(new LockClickListener() {
 111             @Override
 112             public void onClick(View view, boolean lock) {
 113                 //if (orientationUtils != null) {
 114                 //é…åˆä¸‹æ–¹çš„onConfigurationChanged
 115                 //orientationUtils.setEnable(!lock);
 116                 //}
 117             }
 118         });
 119 
 120         changeSpeed.setOnClickListener(new View.OnClickListener() {
 121             @Override
 122             public void onClick(View v) {
 123                 resolveTypeUI();
 124             }
 125         });
 126 
 127         /*VideoOptionModel videoOptionModel =
 128                 new VideoOptionModel(IjkMediaPlayer.OPT_CATEGORY_FORMAT, &quot;dns_cache_clear&quot;, 1);
 129         List&lt;VideoOptionModel&gt; list = new ArrayList&lt;&gt;();
 130         list.add(videoOptionModel);
 131         videoOptionModel =
 132                 new VideoOptionModel(IjkMediaPlayer.OPT_CATEGORY_FORMAT, &quot;rtsp_transport&quot;, &quot;tcp&quot;);
 133         list.add(videoOptionModel);
 134         GSYVideoManager.instance().setOptionModelList(list);*/
 135 
 136         jump.setOnClickListener(new View.OnClickListener() {
 137             @Override
 138             public void onClick(View v) {
 139                 JumpUtils.gotoControl(DetailControlActivity.this);
 140                 //startActivity(new Intent(DetailControlActivity.this, MainActivity.class));
 141             }
 142         });
 143 
 144         shot.setOnClickListener(new View.OnClickListener() {
 145             @Override
 146             public void onClick(View v) {
<abbr title=" 147                 DetailControlActivityPermissionsDispatcher.shotImageWithPermissionCheck(DetailControlActivity.this, v);"> 147                 DetailControlActivityPermissionsDispatcher.shotImageWithPermissionCheck(DetailControlActiğŸ”µ</abbr>
 148             }
 149         });
 150 
 151 
 152         startGif.setOnClickListener(new View.OnClickListener() {
 153             @Override
 154             public void onClick(View v) {
<abbr title=" 155                 DetailControlActivityPermissionsDispatcher.startGifWithPermissionCheck(DetailControlActivity.this);"> 155                 DetailControlActivityPermissionsDispatcher.startGifWithPermissionCheck(DetailControlActivğŸ”µ</abbr>
 156             }
 157         });
 158 
 159         stopGif.setOnClickListener(new View.OnClickListener() {
 160             @Override
 161             public void onClick(View v) {
 162                 stopGif();
 163             }
 164         });
 165 
 166         loadingView.setOnClickListener(new View.OnClickListener() {
 167             @Override
 168             public void onClick(View v) {
 169                 //do nothing
 170             }
 171         });
 172     }
 173 
 174     @Override
 175     public StandardGSYVideoPlayer getGSYVideoPlayer() {
 176         return detailPlayer;
 177     }
 178 
 179     @Override
 180     public GSYVideoOptionBuilder getGSYVideoOptionBuilder() {
 181         //å†…ç½®å°é¢å¯å‚è€ƒSampleCoverVideo
 182         ImageView imageView = new ImageView(this);
 183         loadCover(imageView, url);
 184         return new GSYVideoOptionBuilder()
 185                 .setThumbImageView(imageView)
 186                 .setUrl(url)
 187                 .setCacheWithPlay(true)
 188                 .setVideoTitle(&quot; &quot;)
 189                 .setIsTouchWiget(true)
 190                 .setRotateViewAuto(false)
 191                 .setLockLand(false)
 192                 .setShowFullAnimation(true)//æ‰“å¼€åŠ¨ç”»
 193                 .setNeedLockFull(true)
 194                 .setSeekRatio(1);
 195     }
 196 
 197     @Override
 198     public void clickForFullScreen() {
 199 
 200     }
 201 
 202     @Override
 203     protected void onDestroy() {
 204         super.onDestroy();
 205         mGifCreateHelper.cancelTask();
 206     }
 207 
 208 
 209     /*******************************ç«–å±å…¨å±å¼€å§‹************************************/
 210 
 211     @Override
 212     public void initVideo() {
 213         super.initVideo();
 214         //é‡è½½åå®ç°ç‚¹å‡»ï¼Œä¸æ¨ªå±
 215         if (getGSYVideoPlayer().getFullscreenButton() != null) {
 216             getGSYVideoPlayer().getFullscreenButton().setOnClickListener(new View.OnClickListener() {
 217                 @Override
 218                 public void onClick(View v) {
 219                     //ç¬¬ä¸€ä¸ªtrueæ˜¯å¦éœ€è¦éšè—actionbarï¼Œç¬¬äºŒä¸ªtrueæ˜¯å¦éœ€è¦éšè—statusbar
 220                     getGSYVideoPlayer().startWindowFullscreen(DetailControlActivity.this, true, true);
 221                 }
 222             });
 223         }
 224     }
 225 
 226 
 227     /**
 228      * æ˜¯å¦å¯åŠ¨æ—‹è½¬æ¨ªå±ï¼Œtrueè¡¨ç¤ºå¯åŠ¨
 229      *
 230      * @return true
 231      */
 232     @Override
 233     public boolean getDetailOrientationRotateAuto() {
 234         return false;
 235     }
 236 
 237     //é‡è½½åå…³é—­é‡åŠ›æ—‹è½¬
 238     @Override
 239     public void onConfigurationChanged(Configuration newConfig) {
 240         super.onConfigurationChanged(newConfig);
 241         orientationUtils.setEnable(false);
 242     }
 243 
 244     //é‡è½½åä¸åšä»»ä½•äº‹æƒ…ï¼Œå®ç°ç«–å±å…¨å±
 245     @Override
 246     public void onQuitFullscreen(String url, Object... objects) {
 247         super.onQuitFullscreen(url, objects);
 248     }
 249 
 250     /*******************************ç«–å±å…¨å±ç»“æŸ************************************/
 251 
 252     private void initGifHelper() {
 253         mGifCreateHelper = new GifCreateHelper(detailPlayer, new GSYVideoGifSaveListener() {
 254             @Override
 255             public void result(boolean success, File file) {
 256                 detailPlayer.post(new Runnable() {
 257                     @Override
 258                     public void run() {
 259                         loadingView.setVisibility(View.GONE);
 260                         Toast.makeText(detailPlayer.getContext(), &quot;åˆ›å»ºæˆåŠŸ&quot;, Toast.LENGTH_LONG).show();
 261                     }
 262                 });
 263             }
 264 
 265             @Override
 266             public void process(int curPosition, int total) {
 267                 Debuger.printfError(&quot; current &quot; + curPosition + &quot; total &quot; + total);
 268             }
 269         });
 270     }
 271 
 272 
 273     /**
 274      * å¼€å§‹gifæˆªå›¾
 275      */
 276 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 277     @NeedsPermission(Manifest.permission.WRITE_EXTERNAL_STORAGE)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 278     void startGif() {</span>
 279 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280     private void startGif() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 281         //å¼€å§‹ç¼“å­˜å„ä¸ªå¸§</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 282         mGifCreateHelper.startGif(new File(FileUtils.getPath()));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 285 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287      * ç”Ÿæˆgif</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289     private void stopGif() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290         loadingView.setVisibility(View.VISIBLE);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 291         mGifCreateHelper.stopGif(new File(FileUtils.getPath(), &quot;GSY-Z-&quot; + System.currentTimeMillis() + &quot;.gif&quot;));"> 291         mGifCreateHelper.stopGif(new File(FileUtils.getPath(), &quot;GSY-Z-&quot; + System.currentTimeMillis() + &quot;.ğŸ”µ</abbr></span>
 292 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 293     private void startGif() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 294         Toast.makeText(this, &quot;é¡¹ç›®é‡Œç›®å‰æ²¡åšåŠ¨æ€æˆæƒï¼Œéœ€è¦ä½ å»åšè®¾ç½®é‡Œæˆæƒæ–‡ä»¶è¯»å–å“¦&quot;, Toast.LENGTH_LONG).show();</span>
 295 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 296         //å¼€å§‹ç¼“å­˜å„ä¸ªå¸§
 297         mGifCreateHelper.startGif(new File(FileUtils.getPath()));
 298 
 299     }
 300 
 301     /**
 302      * ç”Ÿæˆgif
 303      */
 304 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 305     void stopGif() {</span>
 306 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307         loadingView.setVisibility(View.VISIBLE);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 308         mGifCreateHelper.stopGif(new File(FileUtils.getPath(), &quot;GSY-Z-&quot; + System.currentTimeMillis() + &quot;.gif&quot;));"> 308         mGifCreateHelper.stopGif(new File(FileUtils.getPath(), &quot;GSY-Z-&quot; + System.currentTimeMillis() + &quot;.ğŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 309     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313      * è§†é¢‘æˆªå›¾</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314      * è¿™é‡Œæ²¡æœ‰åšè¯»å†™æœ¬åœ°sdå¡çš„æƒé™å¤„ç†ï¼Œè®°å¾—å®é™…ä½¿ç”¨è¦åŠ ä¸Š</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316     private void shotImage(final View v) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 317         //è·å–æˆªå›¾</span>
 318 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 319     private void stopGif() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 320         Toast.makeText(this, &quot;é¡¹ç›®é‡Œç›®å‰æ²¡åšåŠ¨æ€æˆæƒï¼Œéœ€è¦ä½ å»åšè®¾ç½®é‡Œæˆæƒæ–‡ä»¶è¯»å–å“¦&quot;, Toast.LENGTH_LONG).show();</span>
 321 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 322         loadingView.setVisibility(View.VISIBLE);
<abbr title=" 323         mGifCreateHelper.stopGif(new File(FileUtils.getPath(), &quot;GSY-Z-&quot; + System.currentTimeMillis() + &quot;.gif&quot;));"> 323         mGifCreateHelper.stopGif(new File(FileUtils.getPath(), &quot;GSY-Z-&quot; + System.currentTimeMillis() + &quot;.ğŸ”µ</abbr>
 324     }
 325 
 326     @OnShowRationale(Manifest.permission.WRITE_EXTERNAL_STORAGE)
 327     void showRationaleForCamera(final PermissionRequest request) {
 328         new AlertDialog.Builder(this)
 329                 .setMessage(&quot;å¿«ç»™æˆ‘æƒé™&quot;)
 330                 .setPositiveButton(&quot;å…è®¸&quot;, new DialogInterface.OnClickListener() {
 331                     @Override
 332                     public void onClick(DialogInterface dialog, int which) {
 333                         request.proceed();
 334                     }
 335                 })
 336                 .setNegativeButton(&quot;æ‹’ç»&quot;, new DialogInterface.OnClickListener() {
 337                     @Override
 338                     public void onClick(DialogInterface dialog, int which) {
 339                         request.cancel();
 340                     }
 341                 })
 342                 .show();
 343     }
 344 
 345     @OnPermissionDenied(Manifest.permission.WRITE_EXTERNAL_STORAGE)
 346     void showDeniedForCamera() {
 347         Toast.makeText(this, &quot;æ²¡æœ‰æƒé™å•Š&quot;, Toast.LENGTH_SHORT).show();
 348     }
 349 
 350     @OnNeverAskAgain(Manifest.permission.CAMERA)
 351     void showNeverAskForCamera() {
 352         Toast.makeText(this, &quot;å†æ¬¡æˆæƒ&quot;, Toast.LENGTH_SHORT).show();
 353     }
 354 
 355     /**
 356      * è§†é¢‘æˆªå›¾
 357      * è¿™é‡Œæ²¡æœ‰åšè¯»å†™æœ¬åœ°sdå¡çš„æƒé™å¤„ç†ï¼Œè®°å¾—å®é™…ä½¿ç”¨è¦åŠ ä¸Š
 358      */
 359     @NeedsPermission(Manifest.permission.WRITE_EXTERNAL_STORAGE)
 360     void shotImage(final View v) {
 361         //è·å–æˆªå›¾
 362         detailPlayer.taskShotPic(new GSYVideoShotListener() {
 363             @Override
 364             public void getBitmap(Bitmap bitmap) {
 365                 if (bitmap != null) {
 366                     try {
 367                         CommonUtil.saveBitmap(bitmap);
 368                     } catch (FileNotFoundException e) {
 369                         showToast(&quot;save fail &quot;);
 370                         e.printStackTrace();
 371                         return;
 372                     }
 373                     showToast(&quot;save success &quot;);
 374                 } else {
 375                     showToast(&quot;get bitmap fail &quot;);
 376                 }
 377             }
 378         });
 379 
 380     }
 381 
 382 
 383     private void loadCover(ImageView imageView, String url) {
 384 
 385         imageView.setScaleType(ImageView.ScaleType.CENTER_CROP);
 386         imageView.setImageResource(R.mipmap.xxx1);
 387 
 388         Glide.with(this.getApplicationContext())
 389                 .setDefaultRequestOptions(
 390                         new RequestOptions()
 391                                 .frame(3000000)
 392                                 .centerCrop()
 393                                 .error(R.mipmap.xxx2)
 394                                 .placeholder(R.mipmap.xxx1))
 395                 .load(url)
 396                 .into(imageView);
 397     }
 398 
 399     private void resolveNormalVideoUI() {
 400         //å¢åŠ title
 401         detailPlayer.getTitleTextView().setVisibility(View.GONE);
 402         detailPlayer.getBackButton().setVisibility(View.GONE);
 403     }
 404 
 405     /**
 406      * æ˜¾ç¤ºæ¯”ä¾‹
 407      * æ³¨æ„ï¼ŒGSYVideoType.setShowTypeæ˜¯å…¨å±€é™æ€ç”Ÿæ•ˆï¼Œé™¤éé‡å¯APPã€‚
 408      */
 409     private void resolveTypeUI() {
 410         if (speed == 1) {
 411             speed = 1.5f;
 412         } else if (speed == 1.5f) {
 413             speed = 2f;
 414         } else if (speed == 2) {
 415             speed = 0.5f;
 416         } else if (speed == 0.5f) {
 417             speed = 0.25f;
 418         } else if (speed == 0.25f) {
 419             speed = 1;
 420         }
 421         changeSpeed.setText(&quot;æ’­æ”¾é€Ÿåº¦ï¼š&quot; + speed);
 422         detailPlayer.setSpeedPlaying(speed, true);
 423     }
 424 
 425 
 426     private void showToast(final String tip) {
 427         detailPlayer.post(new Runnable() {
 428             @Override
 429             public void run() {
 430                 Toast.makeText(DetailControlActivity.this, tip, Toast.LENGTH_LONG).show();
 431             }
 432         });
 433     }
 434 
 435     @Override
<abbr title=" 436     public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {"> 436     public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[]ğŸ”µ</abbr>
 437         super.onRequestPermissionsResult(requestCode, permissions, grantResults);
 438         // NOTE: delegate the permission handling to generated method
<abbr title=" 439         DetailControlActivityPermissionsDispatcher.onRequestPermissionsResult(this, requestCode, grantResults);"> 439         DetailControlActivityPermissionsDispatcher.onRequestPermissionsResult(this, requestCode, grantResğŸ”µ</abbr>
 440     }
 441 
 442 }</pre></td>
                            <td><pre>   1 package com.example.gsyvideoplayer;
   2 
   3 import android.Manifest;
   4 import android.app.AlertDialog;
   5 import android.content.DialogInterface;
   6 import android.content.res.Configuration;
   7 import android.graphics.Bitmap;
   8 import android.os.Bundle;
   9 import android.support.annotation.NonNull;
  10 import android.support.v4.widget.NestedScrollView;
  11 import android.view.View;
  12 import android.widget.Button;
  13 import android.widget.ImageView;
  14 import android.widget.RelativeLayout;
  15 import android.widget.Toast;
  16 
  17 import com.bumptech.glide.Glide;
  18 import com.bumptech.glide.request.RequestOptions;
  19 import com.example.gsyvideoplayer.utils.CommonUtil;
  20 import com.example.gsyvideoplayer.utils.JumpUtils;
  21 import com.example.gsyvideoplayer.video.SampleControlVideo;
  22 import com.shuyu.gsyvideoplayer.GSYBaseActivityDetail;
  23 import com.shuyu.gsyvideoplayer.GSYVideoManager;
  24 import com.shuyu.gsyvideoplayer.builder.GSYVideoOptionBuilder;
  25 import com.shuyu.gsyvideoplayer.listener.GSYVideoGifSaveListener;
  26 import com.shuyu.gsyvideoplayer.listener.GSYVideoShotListener;
  27 import com.shuyu.gsyvideoplayer.listener.LockClickListener;
  28 import com.shuyu.gsyvideoplayer.model.VideoOptionModel;
  29 import com.shuyu.gsyvideoplayer.utils.Debuger;
  30 import com.shuyu.gsyvideoplayer.utils.FileUtils;
  31 import com.shuyu.gsyvideoplayer.utils.GifCreateHelper;
  32 import com.shuyu.gsyvideoplayer.video.StandardGSYVideoPlayer;
  33 import com.shuyu.gsyvideoplayer.video.base.GSYBaseVideoPlayer;
  34 
  35 import java.io.File;
  36 import java.io.FileNotFoundException;
  37 import java.util.ArrayList;
  38 import java.util.List;
  39 
  40 import butterknife.BindView;
  41 import butterknife.ButterKnife;
  42 import permissions.dispatcher.NeedsPermission;
  43 import permissions.dispatcher.OnNeverAskAgain;
  44 import permissions.dispatcher.OnPermissionDenied;
  45 import permissions.dispatcher.OnShowRationale;
  46 import permissions.dispatcher.PermissionRequest;
  47 import permissions.dispatcher.RuntimePermissions;
  48 import tv.danmaku.ijk.media.player.IjkMediaPlayer;
  49 
  50 /**
  51  * sampleVideoæ”¯æŒå…¨å±ä¸éå…¨å±åˆ‡æ¢çš„æ¸…æ™°åº¦ï¼Œæ—‹è½¬ï¼Œé•œåƒç­‰åŠŸèƒ½.
  52  * Activityå¯ä»¥ç»§æ‰¿GSYBaseActivityDetailå®ç°è¯¦æƒ…æ¨¡å¼çš„é¡µé¢
  53  * æˆ–è€…å‚è€ƒDetailPlayerã€DetailListPlayerå®ç°
  54  * &lt;p&gt;
  55  * Created by guoshuyu on 2017/6/18.
  56  */
  57 @RuntimePermissions
  58 public class DetailControlActivity extends GSYBaseActivityDetail&lt;StandardGSYVideoPlayer&gt; {
  59 
  60     @BindView(R.id.post_detail_nested_scroll)
  61     NestedScrollView postDetailNestedScroll;
  62 
  63     @BindView(R.id.detail_player)
  64     SampleControlVideo detailPlayer;
  65 
  66     @BindView(R.id.activity_detail_player)
  67     RelativeLayout activityDetailPlayer;
  68 
  69     @BindView(R.id.change_speed)
  70     Button changeSpeed;
  71 
  72 
  73     @BindView(R.id.jump)
  74     Button jump;
  75 
  76     @BindView(R.id.shot)
  77     Button shot;
  78 
  79     @BindView(R.id.start_gif)
  80     Button startGif;
  81 
  82     @BindView(R.id.stop_gif)
  83     Button stopGif;
  84 
  85     @BindView(R.id.loadingView)
  86     View loadingView;
  87 
  88     private String url = &quot;http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4&quot;;
  89     //private String url = &quot;http://livecdn1.news.cn/Live_MajorEvent01Phone/manifest.m3u8&quot;;
<abbr title="  90     //private String url = &quot;https://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/8908d124aa839d0d3fa9593855ef5957.m3u8&quot;;">  90     //private String url = &quot;https://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/ğŸ”µ</abbr>
<abbr title="  91     //private String url2 = &quot;http://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/3aca1a0db8db9418dcbc765848c8903e.m3u8&quot;;">  91     //private String url2 = &quot;http://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/ğŸ”µ</abbr>
  92 
  93 
  94     private GifCreateHelper mGifCreateHelper;
  95 
  96     private float speed = 1;
  97 
  98     @Override
  99     protected void onCreate(Bundle savedInstanceState) {
 100         super.onCreate(savedInstanceState);
 101         setContentView(R.layout.activity_detail_control);
 102         ButterKnife.bind(this);
 103 
 104         resolveNormalVideoUI();
 105 
 106         initVideoBuilderMode();
 107 
 108         initGifHelper();
 109 
 110         detailPlayer.setLockClickListener(new LockClickListener() {
 111             @Override
 112             public void onClick(View view, boolean lock) {
 113                 //if (orientationUtils != null) {
 114                 //é…åˆä¸‹æ–¹çš„onConfigurationChanged
 115                 //orientationUtils.setEnable(!lock);
 116                 //}
 117             }
 118         });
 119 
 120         changeSpeed.setOnClickListener(new View.OnClickListener() {
 121             @Override
 122             public void onClick(View v) {
 123                 resolveTypeUI();
 124             }
 125         });
 126 
 127         /*VideoOptionModel videoOptionModel =
 128                 new VideoOptionModel(IjkMediaPlayer.OPT_CATEGORY_FORMAT, &quot;dns_cache_clear&quot;, 1);
 129         List&lt;VideoOptionModel&gt; list = new ArrayList&lt;&gt;();
 130         list.add(videoOptionModel);
 131         videoOptionModel =
 132                 new VideoOptionModel(IjkMediaPlayer.OPT_CATEGORY_FORMAT, &quot;rtsp_transport&quot;, &quot;tcp&quot;);
 133         list.add(videoOptionModel);
 134         GSYVideoManager.instance().setOptionModelList(list);*/
 135 
 136         jump.setOnClickListener(new View.OnClickListener() {
 137             @Override
 138             public void onClick(View v) {
 139                 JumpUtils.gotoControl(DetailControlActivity.this);
 140                 //startActivity(new Intent(DetailControlActivity.this, MainActivity.class));
 141             }
 142         });
 143 
 144         shot.setOnClickListener(new View.OnClickListener() {
 145             @Override
 146             public void onClick(View v) {
<abbr title=" 147                 DetailControlActivityPermissionsDispatcher.shotImageWithPermissionCheck(DetailControlActivity.this, v);"> 147                 DetailControlActivityPermissionsDispatcher.shotImageWithPermissionCheck(DetailControlActiğŸ”µ</abbr>
 148             }
 149         });
 150 
 151 
 152         startGif.setOnClickListener(new View.OnClickListener() {
 153             @Override
 154             public void onClick(View v) {
<abbr title=" 155                 DetailControlActivityPermissionsDispatcher.startGifWithPermissionCheck(DetailControlActivity.this);"> 155                 DetailControlActivityPermissionsDispatcher.startGifWithPermissionCheck(DetailControlActivğŸ”µ</abbr>
 156             }
 157         });
 158 
 159         stopGif.setOnClickListener(new View.OnClickListener() {
 160             @Override
 161             public void onClick(View v) {
 162                 stopGif();
 163             }
 164         });
 165 
 166         loadingView.setOnClickListener(new View.OnClickListener() {
 167             @Override
 168             public void onClick(View v) {
 169                 //do nothing
 170             }
 171         });
 172     }
 173 
 174     @Override
 175     public StandardGSYVideoPlayer getGSYVideoPlayer() {
 176         return detailPlayer;
 177     }
 178 
 179     @Override
 180     public GSYVideoOptionBuilder getGSYVideoOptionBuilder() {
 181         //å†…ç½®å°é¢å¯å‚è€ƒSampleCoverVideo
 182         ImageView imageView = new ImageView(this);
 183         loadCover(imageView, url);
 184         return new GSYVideoOptionBuilder()
 185                 .setThumbImageView(imageView)
 186                 .setUrl(url)
 187                 .setCacheWithPlay(true)
 188                 .setVideoTitle(&quot; &quot;)
 189                 .setIsTouchWiget(true)
 190                 .setRotateViewAuto(false)
 191                 .setLockLand(false)
 192                 .setShowFullAnimation(true)//æ‰“å¼€åŠ¨ç”»
 193                 .setNeedLockFull(true)
 194                 .setSeekRatio(1);
 195     }
 196 
 197     @Override
 198     public void clickForFullScreen() {
 199 
 200     }
 201 
 202     @Override
 203     protected void onDestroy() {
 204         super.onDestroy();
 205         mGifCreateHelper.cancelTask();
 206     }
 207 
 208 
 209     /*******************************ç«–å±å…¨å±å¼€å§‹************************************/
 210 
 211     @Override
 212     public void initVideo() {
 213         super.initVideo();
 214         //é‡è½½åå®ç°ç‚¹å‡»ï¼Œä¸æ¨ªå±
 215         if (getGSYVideoPlayer().getFullscreenButton() != null) {
 216             getGSYVideoPlayer().getFullscreenButton().setOnClickListener(new View.OnClickListener() {
 217                 @Override
 218                 public void onClick(View v) {
 219                     //ç¬¬ä¸€ä¸ªtrueæ˜¯å¦éœ€è¦éšè—actionbarï¼Œç¬¬äºŒä¸ªtrueæ˜¯å¦éœ€è¦éšè—statusbar
 220                     getGSYVideoPlayer().startWindowFullscreen(DetailControlActivity.this, true, true);
 221                 }
 222             });
 223         }
 224     }
 225 
 226 
 227     /**
 228      * æ˜¯å¦å¯åŠ¨æ—‹è½¬æ¨ªå±ï¼Œtrueè¡¨ç¤ºå¯åŠ¨
 229      *
 230      * @return true
 231      */
 232     @Override
 233     public boolean getDetailOrientationRotateAuto() {
 234         return false;
 235     }
 236 
 237     //é‡è½½åå…³é—­é‡åŠ›æ—‹è½¬
 238     @Override
 239     public void onConfigurationChanged(Configuration newConfig) {
 240         super.onConfigurationChanged(newConfig);
 241         orientationUtils.setEnable(false);
 242     }
 243 
 244     //é‡è½½åä¸åšä»»ä½•äº‹æƒ…ï¼Œå®ç°ç«–å±å…¨å±
 245     @Override
 246     public void onQuitFullscreen(String url, Object... objects) {
 247         super.onQuitFullscreen(url, objects);
 248     }
 249 
 250     /*******************************ç«–å±å…¨å±ç»“æŸ************************************/
 251 
 252     private void initGifHelper() {
 253         mGifCreateHelper = new GifCreateHelper(detailPlayer, new GSYVideoGifSaveListener() {
 254             @Override
 255             public void result(boolean success, File file) {
 256                 detailPlayer.post(new Runnable() {
 257                     @Override
 258                     public void run() {
 259                         loadingView.setVisibility(View.GONE);
 260                         Toast.makeText(detailPlayer.getContext(), &quot;åˆ›å»ºæˆåŠŸ&quot;, Toast.LENGTH_LONG).show();
 261                     }
 262                 });
 263             }
 264 
 265             @Override
 266             public void process(int curPosition, int total) {
 267                 Debuger.printfError(&quot; current &quot; + curPosition + &quot; total &quot; + total);
 268             }
 269         });
 270     }
 271 
 272 
 273     /**
 274      * å¼€å§‹gifæˆªå›¾
 275      */
 276 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 277 @NeedsPermission(Manifest.permission.WRITE_EXTERNAL_STORAGE)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 278     void startGif() {</span>
 279 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280 private void startGif() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 281         //å¼€å§‹ç¼“å­˜å„ä¸ªå¸§</span>
 282 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 283 private void startGif() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284         Toast.makeText(this, &quot;é¡¹ç›®é‡Œç›®å‰æ²¡åšåŠ¨æ€æˆæƒï¼Œéœ€è¦ä½ å»åšè®¾ç½®é‡Œæˆæƒæ–‡ä»¶è¯»å–å“¦&quot;, Toast.LENGTH_LONG).show();</span>
 285 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 286         //å¼€å§‹ç¼“å­˜å„ä¸ªå¸§
 287         mGifCreateHelper.startGif(new File(FileUtils.getPath()));
 288 
 289     }
 290 
 291     /**
 292      * ç”Ÿæˆgif
 293      */
 294 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 295 void stopGif() {</span>
 296 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297 private void stopGif() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298         loadingView.setVisibility(View.VISIBLE);</span>
 299 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 300 private void stopGif() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 301         Toast.makeText(this, &quot;é¡¹ç›®é‡Œç›®å‰æ²¡åšåŠ¨æ€æˆæƒï¼Œéœ€è¦ä½ å»åšè®¾ç½®é‡Œæˆæƒæ–‡ä»¶è¯»å–å“¦&quot;, Toast.LENGTH_LONG).show();</span>
 302 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 303         loadingView.setVisibility(View.VISIBLE);
<abbr title=" 304         mGifCreateHelper.stopGif(new File(FileUtils.getPath(), &quot;GSY-Z-&quot; + System.currentTimeMillis() + &quot;.gif&quot;));"> 304         mGifCreateHelper.stopGif(new File(FileUtils.getPath(), &quot;GSY-Z-&quot; + System.currentTimeMillis() + &quot;.ğŸ”µ</abbr>
 305     }
 306 
 307     @OnShowRationale(Manifest.permission.WRITE_EXTERNAL_STORAGE)
 308     void showRationaleForCamera(final PermissionRequest request) {
 309         new AlertDialog.Builder(this)
 310                 .setMessage(&quot;å¿«ç»™æˆ‘æƒé™&quot;)
 311                 .setPositiveButton(&quot;å…è®¸&quot;, new DialogInterface.OnClickListener() {
 312                     @Override
 313                     public void onClick(DialogInterface dialog, int which) {
 314                         request.proceed();
 315                     }
 316                 })
 317                 .setNegativeButton(&quot;æ‹’ç»&quot;, new DialogInterface.OnClickListener() {
 318                     @Override
 319                     public void onClick(DialogInterface dialog, int which) {
 320                         request.cancel();
 321                     }
 322                 })
 323                 .show();
 324     }
 325 
 326     @OnPermissionDenied(Manifest.permission.WRITE_EXTERNAL_STORAGE)
 327     void showDeniedForCamera() {
 328         Toast.makeText(this, &quot;æ²¡æœ‰æƒé™å•Š&quot;, Toast.LENGTH_SHORT).show();
 329     }
 330 
 331     @OnNeverAskAgain(Manifest.permission.CAMERA)
 332     void showNeverAskForCamera() {
 333         Toast.makeText(this, &quot;å†æ¬¡æˆæƒ&quot;, Toast.LENGTH_SHORT).show();
 334     }
 335 
 336     /**
 337      * è§†é¢‘æˆªå›¾
 338      * è¿™é‡Œæ²¡æœ‰åšè¯»å†™æœ¬åœ°sdå¡çš„æƒé™å¤„ç†ï¼Œè®°å¾—å®é™…ä½¿ç”¨è¦åŠ ä¸Š
 339      */
 340     @NeedsPermission(Manifest.permission.WRITE_EXTERNAL_STORAGE)
 341     void shotImage(final View v) {
 342         //è·å–æˆªå›¾
 343         detailPlayer.taskShotPic(new GSYVideoShotListener() {
 344             @Override
 345             public void getBitmap(Bitmap bitmap) {
 346                 if (bitmap != null) {
 347                     try {
 348                         CommonUtil.saveBitmap(bitmap);
 349                     } catch (FileNotFoundException e) {
 350                         showToast(&quot;save fail &quot;);
 351                         e.printStackTrace();
 352                         return;
 353                     }
 354                     showToast(&quot;save success &quot;);
 355                 } else {
 356                     showToast(&quot;get bitmap fail &quot;);
 357                 }
 358             }
 359         });
 360 
 361     }
 362 
 363 
 364     private void loadCover(ImageView imageView, String url) {
 365 
 366         imageView.setScaleType(ImageView.ScaleType.CENTER_CROP);
 367         imageView.setImageResource(R.mipmap.xxx1);
 368 
 369         Glide.with(this.getApplicationContext())
 370                 .setDefaultRequestOptions(
 371                         new RequestOptions()
 372                                 .frame(3000000)
 373                                 .centerCrop()
 374                                 .error(R.mipmap.xxx2)
 375                                 .placeholder(R.mipmap.xxx1))
 376                 .load(url)
 377                 .into(imageView);
 378     }
 379 
 380     private void resolveNormalVideoUI() {
 381         //å¢åŠ title
 382         detailPlayer.getTitleTextView().setVisibility(View.GONE);
 383         detailPlayer.getBackButton().setVisibility(View.GONE);
 384     }
 385 
 386     /**
 387      * æ˜¾ç¤ºæ¯”ä¾‹
 388      * æ³¨æ„ï¼ŒGSYVideoType.setShowTypeæ˜¯å…¨å±€é™æ€ç”Ÿæ•ˆï¼Œé™¤éé‡å¯APPã€‚
 389      */
 390     private void resolveTypeUI() {
 391         if (speed == 1) {
 392             speed = 1.5f;
 393         } else if (speed == 1.5f) {
 394             speed = 2f;
 395         } else if (speed == 2) {
 396             speed = 0.5f;
 397         } else if (speed == 0.5f) {
 398             speed = 0.25f;
 399         } else if (speed == 0.25f) {
 400             speed = 1;
 401         }
 402         changeSpeed.setText(&quot;æ’­æ”¾é€Ÿåº¦ï¼š&quot; + speed);
 403         detailPlayer.setSpeedPlaying(speed, true);
 404     }
 405 
 406 
 407     private void showToast(final String tip) {
 408         detailPlayer.post(new Runnable() {
 409             @Override
 410             public void run() {
 411                 Toast.makeText(DetailControlActivity.this, tip, Toast.LENGTH_LONG).show();
 412             }
 413         });
 414     }
 415 
 416     @Override
<abbr title=" 417     public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {"> 417     public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[]ğŸ”µ</abbr>
 418         super.onRequestPermissionsResult(requestCode, permissions, grantResults);
 419         // NOTE: delegate the permission handling to generated method
<abbr title=" 420         DetailControlActivityPermissionsDispatcher.onRequestPermissionsResult(this, requestCode, grantResults);"> 420         DetailControlActivityPermissionsDispatcher.onRequestPermissionsResult(this, requestCode, grantResğŸ”µ</abbr>
 421     }
 422 
 423 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 package com.example.gsyvideoplayer;
   2 
   3 import android.Manifest;
   4 import android.app.AlertDialog;
   5 import android.content.DialogInterface;
   6 import android.content.res.Configuration;
   7 import android.graphics.Bitmap;
   8 import android.os.Bundle;
   9 import android.support.annotation.NonNull;
  10 import android.support.v4.widget.NestedScrollView;
  11 import android.view.View;
  12 import android.widget.Button;
  13 import android.widget.ImageView;
  14 import android.widget.RelativeLayout;
  15 import android.widget.Toast;
  16 import butterknife.BindView;
  17 import butterknife.ButterKnife;
  18 import com.bumptech.glide.Glide;
  19 import com.bumptech.glide.request.RequestOptions;
  20 import com.example.gsyvideoplayer.utils.CommonUtil;
  21 import com.example.gsyvideoplayer.utils.JumpUtils;
  22 import com.example.gsyvideoplayer.video.SampleControlVideo;
  23 import com.shuyu.gsyvideoplayer.GSYBaseActivityDetail;
  24 import com.shuyu.gsyvideoplayer.GSYVideoManager;
  25 import com.shuyu.gsyvideoplayer.builder.GSYVideoOptionBuilder;
  26 import com.shuyu.gsyvideoplayer.listener.GSYVideoGifSaveListener;
  27 import com.shuyu.gsyvideoplayer.listener.GSYVideoShotListener;
  28 import com.shuyu.gsyvideoplayer.listener.LockClickListener;
  29 import com.shuyu.gsyvideoplayer.model.VideoOptionModel;
  30 import com.shuyu.gsyvideoplayer.utils.Debuger;
  31 import com.shuyu.gsyvideoplayer.utils.FileUtils;
  32 import com.shuyu.gsyvideoplayer.utils.GifCreateHelper;
  33 import com.shuyu.gsyvideoplayer.video.StandardGSYVideoPlayer;
  34 import com.shuyu.gsyvideoplayer.video.base.GSYBaseVideoPlayer;
  35 import java.io.File;
  36 import java.io.FileNotFoundException;
  37 import java.util.ArrayList;
  38 import java.util.List;
  39 import permissions.dispatcher.NeedsPermission;
  40 import permissions.dispatcher.OnNeverAskAgain;
  41 import permissions.dispatcher.OnPermissionDenied;
  42 import permissions.dispatcher.OnShowRationale;
  43 import permissions.dispatcher.PermissionRequest;
  44 import permissions.dispatcher.RuntimePermissions;
  45 import tv.danmaku.ijk.media.player.IjkMediaPlayer;
  46 
  47 
  48 /**
  49  * sampleVideoæ”¯æŒå…¨å±ä¸éå…¨å±åˆ‡æ¢çš„æ¸…æ™°åº¦ï¼Œæ—‹è½¬ï¼Œé•œåƒç­‰åŠŸèƒ½.
  50  * Activityå¯ä»¥ç»§æ‰¿GSYBaseActivityDetailå®ç°è¯¦æƒ…æ¨¡å¼çš„é¡µé¢
  51  * æˆ–è€…å‚è€ƒDetailPlayerã€DetailListPlayerå®ç°
  52  * &lt;p&gt;
  53  * Created by guoshuyu on 2017/6/18.
  54  */
  55 @RuntimePermissions
  56 public class DetailControlActivity extends GSYBaseActivityDetail&lt;StandardGSYVideoPlayer&gt; {
  57     @BindView(R.id.post_detail_nested_scroll)
  58     NestedScrollView postDetailNestedScroll;
  59 
  60     @BindView(R.id.detail_player)
  61     SampleControlVideo detailPlayer;
  62 
  63     @BindView(R.id.activity_detail_player)
  64     RelativeLayout activityDetailPlayer;
  65 
  66     @BindView(R.id.change_speed)
  67     Button changeSpeed;
  68 
  69     @BindView(R.id.jump)
  70     Button jump;
  71 
  72     @BindView(R.id.shot)
  73     Button shot;
  74 
  75     @BindView(R.id.start_gif)
  76     Button startGif;
  77 
  78     @BindView(R.id.stop_gif)
  79     Button stopGif;
  80 
  81     @BindView(R.id.loadingView)
  82     View loadingView;
  83 
  84     private String url = &quot;http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4&quot;;
  85 
  86     //private String url = &quot;http://livecdn1.news.cn/Live_MajorEvent01Phone/manifest.m3u8&quot;;
<abbr title="  87     //private String url = &quot;https://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/8908d124aa839d0d3fa9593855ef5957.m3u8&quot;;">  87     //private String url = &quot;https://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/ğŸ”µ</abbr>
<abbr title="  88     //private String url2 = &quot;http://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/3aca1a0db8db9418dcbc765848c8903e.m3u8&quot;;">  88     //private String url2 = &quot;http://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/ğŸ”µ</abbr>
  89     //private String url = &quot;http://livecdn1.news.cn/Live_MajorEvent01Phone/manifest.m3u8&quot;;
<abbr title="  90     //private String url = &quot;https://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/8908d124aa839d0d3fa9593855ef5957.m3u8&quot;;">  90     //private String url = &quot;https://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/ğŸ”µ</abbr>
<abbr title="  91     //private String url2 = &quot;http://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/3aca1a0db8db9418dcbc765848c8903e.m3u8&quot;;">  91     //private String url2 = &quot;http://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/ğŸ”µ</abbr>
  92 
  93 
  94     private GifCreateHelper mGifCreateHelper;
  95 
  96     private float speed = 1;
  97 
  98     @Override
  99     protected void onCreate(Bundle savedInstanceState) {
 100         super.onCreate(savedInstanceState);
 101         setContentView(R.layout.activity_detail_control);
 102         ButterKnife.bind(this);
 103         resolveNormalVideoUI();
 104         initVideoBuilderMode();
 105         initGifHelper();
 106         detailPlayer.setLockClickListener(new LockClickListener() {
 107             @Override
 108             public void onClick(View view, boolean lock) {
 109                 // if (orientationUtils != null) {
 110                 // é…åˆä¸‹æ–¹çš„onConfigurationChanged
 111                 // orientationUtils.setEnable(!lock);
 112                 // }
 113             }
 114         });
 115         changeSpeed.setOnClickListener(new View.OnClickListener() {
 116             @Override
 117             public void onClick(View v) {
 118                 resolveTypeUI();
 119             }
 120         });
 121         /* VideoOptionModel videoOptionModel =
 122         new VideoOptionModel(IjkMediaPlayer.OPT_CATEGORY_FORMAT, &quot;dns_cache_clear&quot;, 1);
 123         List&lt;VideoOptionModel&gt; list = new ArrayList&lt;&gt;();
 124         list.add(videoOptionModel);
 125         videoOptionModel =
 126         new VideoOptionModel(IjkMediaPlayer.OPT_CATEGORY_FORMAT, &quot;rtsp_transport&quot;, &quot;tcp&quot;);
 127         list.add(videoOptionModel);
 128         GSYVideoManager.instance().setOptionModelList(list);
 129          */
 130         jump.setOnClickListener(new View.OnClickListener() {
 131             @Override
 132             public void onClick(View v) {
 133                 JumpUtils.gotoControl(DetailControlActivity.this);
 134                 // startActivity(new Intent(DetailControlActivity.this, MainActivity.class));
 135             }
 136         });
 137         shot.setOnClickListener(new View.OnClickListener() {
 138             @Override
 139             public void onClick(View v) {
<abbr title=" 140                 DetailControlActivityPermissionsDispatcher.shotImageWithPermissionCheck(DetailControlActivity.this, v);"> 140                 DetailControlActivityPermissionsDispatcher.shotImageWithPermissionCheck(DetailControlActiğŸ”µ</abbr>
 141             }
 142         });
 143         startGif.setOnClickListener(new View.OnClickListener() {
 144             @Override
 145             public void onClick(View v) {
<abbr title=" 146                 DetailControlActivityPermissionsDispatcher.startGifWithPermissionCheck(DetailControlActivity.this);"> 146                 DetailControlActivityPermissionsDispatcher.startGifWithPermissionCheck(DetailControlActivğŸ”µ</abbr>
 147             }
 148         });
 149         stopGif.setOnClickListener(new View.OnClickListener() {
 150             @Override
 151             public void onClick(View v) {
 152                 stopGif();
 153             }
 154         });
 155         loadingView.setOnClickListener(new View.OnClickListener() {
 156             @Override
 157             public void onClick(View v) {
 158                 // do nothing
 159             }
 160         });
 161     }
 162 
 163     @Override
 164     public StandardGSYVideoPlayer getGSYVideoPlayer() {
 165         return detailPlayer;
 166     }
 167 
 168     @Override
 169     public GSYVideoOptionBuilder getGSYVideoOptionBuilder() {
 170         //å†…ç½®å°é¢å¯å‚è€ƒSampleCoverVideo
 171         ImageView imageView = new ImageView(this);
 172         loadCover(imageView, url);
 173         return new GSYVideoOptionBuilder()
 174                 .setThumbImageView(imageView)
 175                 .setUrl(url)
 176                 .setCacheWithPlay(true)
 177                 .setVideoTitle(&quot; &quot;)
 178                 .setIsTouchWiget(true)
 179                 .setRotateViewAuto(false)
 180                 .setLockLand(false)
 181                 .setShowFullAnimation(true)//æ‰“å¼€åŠ¨ç”»
 182                 .setNeedLockFull(true)
 183                 .setSeekRatio(1);
 184     }
 185 
 186     @Override
 187     public void clickForFullScreen() {
 188 
 189     }
 190 
 191     @Override
 192     protected void onDestroy() {
 193         super.onDestroy();
 194         mGifCreateHelper.cancelTask();
 195     }
 196 
 197     /*******************************ç«–å±å…¨å±å¼€å§‹************************************/
 198 
 199     @Override
 200     public void initVideo() {
 201         super.initVideo();
 202         //é‡è½½åå®ç°ç‚¹å‡»ï¼Œä¸æ¨ªå±
 203         if (getGSYVideoPlayer().getFullscreenButton() != null) {
 204             getGSYVideoPlayer().getFullscreenButton().setOnClickListener(new View.OnClickListener() {
 205                 @Override
 206                 public void onClick(View v) {
 207                     //ç¬¬ä¸€ä¸ªtrueæ˜¯å¦éœ€è¦éšè—actionbarï¼Œç¬¬äºŒä¸ªtrueæ˜¯å¦éœ€è¦éšè—statusbar
 208                     getGSYVideoPlayer().startWindowFullscreen(DetailControlActivity.this, true, true);
 209                 }
 210             });
 211         }
 212     }
 213 
 214     /**
 215      * æ˜¯å¦å¯åŠ¨æ—‹è½¬æ¨ªå±ï¼Œtrueè¡¨ç¤ºå¯åŠ¨
 216      *
 217      * @return true
 218      */
 219     @Override
 220     public boolean getDetailOrientationRotateAuto() {
 221         return false;
 222     }
 223 
 224     //é‡è½½åå…³é—­é‡åŠ›æ—‹è½¬
 225     @Override
 226     public void onConfigurationChanged(Configuration newConfig) {
 227         super.onConfigurationChanged(newConfig);
 228         orientationUtils.setEnable(false);
 229     }
 230 
 231     //é‡è½½åä¸åšä»»ä½•äº‹æƒ…ï¼Œå®ç°ç«–å±å…¨å±
 232     @Override
 233     public void onQuitFullscreen(String url, Object... objects) {
 234         super.onQuitFullscreen(url, objects);
 235     }
 236 
 237     /*******************************ç«–å±å…¨å±ç»“æŸ************************************/
 238 
 239     private void initGifHelper() {
 240         mGifCreateHelper = new GifCreateHelper(detailPlayer, new GSYVideoGifSaveListener() {
 241             @Override
 242             public void result(boolean success, File file) {
 243                 detailPlayer.post(new Runnable() {
 244                     @Override
 245                     public void run() {
 246                         loadingView.setVisibility(View.GONE);
 247                         Toast.makeText(detailPlayer.getContext(), &quot;åˆ›å»ºæˆåŠŸ&quot;, Toast.LENGTH_LONG).show();
 248                     }
 249                 });
 250             }
 251 
 252             @Override
 253             public void process(int curPosition, int total) {
 254                 Debuger.printfError(&quot; current &quot; + curPosition + &quot; total &quot; + total);
 255             }
 256         });
 257     }
 258 
 259     /**
 260      * å¼€å§‹gifæˆªå›¾
 261      */
 262     @NeedsPermission(Manifest.permission.WRITE_EXTERNAL_STORAGE)
 263     void startGif() {
 264         Toast.makeText(this, &quot;é¡¹ç›®é‡Œç›®å‰æ²¡åšåŠ¨æ€æˆæƒï¼Œéœ€è¦ä½ å»åšè®¾ç½®é‡Œæˆæƒæ–‡ä»¶è¯»å–å“¦&quot;, Toast.LENGTH_LONG).show();
 265         // å¼€å§‹ç¼“å­˜å„ä¸ªå¸§
 266         mGifCreateHelper.startGif(new File(FileUtils.getPath()));
 267     }
 268 
 269     /**
 270      * ç”Ÿæˆgif
 271      */
 272     void stopGif() {
 273         Toast.makeText(this, &quot;é¡¹ç›®é‡Œç›®å‰æ²¡åšåŠ¨æ€æˆæƒï¼Œéœ€è¦ä½ å»åšè®¾ç½®é‡Œæˆæƒæ–‡ä»¶è¯»å–å“¦&quot;, Toast.LENGTH_LONG).show();
 274         loadingView.setVisibility(View.VISIBLE);
<abbr title=" 275         mGifCreateHelper.stopGif(new File(FileUtils.getPath(), (&quot;GSY-Z-&quot; + System.currentTimeMillis()) + &quot;.gif&quot;));"> 275         mGifCreateHelper.stopGif(new File(FileUtils.getPath(), (&quot;GSY-Z-&quot; + System.currentTimeMillis()) + ğŸ”µ</abbr>
 276     }
 277 
 278     @OnShowRationale(Manifest.permission.WRITE_EXTERNAL_STORAGE)
 279     void showRationaleForCamera(final PermissionRequest request) {
<abbr title=" 280         new AlertDialog.Builder(this).setMessage(&quot;å¿«ç»™æˆ‘æƒé™&quot;).setPositiveButton(&quot;å…è®¸&quot;, new DialogInterface.OnClickListener() {"> 280         new AlertDialog.Builder(this).setMessage(&quot;å¿«ç»™æˆ‘æƒé™&quot;).setPositiveButton(&quot;å…è®¸&quot;, new DialogInterface.OnCğŸ”µ</abbr>
 281             @Override
 282             public void onClick(DialogInterface dialog, int which) {
 283                 request.proceed();
 284             }
 285         }).setNegativeButton(&quot;æ‹’ç»&quot;, new DialogInterface.OnClickListener() {
 286             @Override
 287             public void onClick(DialogInterface dialog, int which) {
 288                 request.cancel();
 289             }
 290         }).show();
 291     }
 292 
 293     @OnPermissionDenied(Manifest.permission.WRITE_EXTERNAL_STORAGE)
 294     void showDeniedForCamera() {
 295         Toast.makeText(this, &quot;æ²¡æœ‰æƒé™å•Š&quot;, Toast.LENGTH_SHORT).show();
 296     }
 297 
 298     @OnNeverAskAgain(Manifest.permission.CAMERA)
 299     void showNeverAskForCamera() {
 300         Toast.makeText(this, &quot;å†æ¬¡æˆæƒ&quot;, Toast.LENGTH_SHORT).show();
 301     }
 302 
 303     /**
 304      * è§†é¢‘æˆªå›¾
 305      * è¿™é‡Œæ²¡æœ‰åšè¯»å†™æœ¬åœ°sdå¡çš„æƒé™å¤„ç†ï¼Œè®°å¾—å®é™…ä½¿ç”¨è¦åŠ ä¸Š
 306      */
 307     @NeedsPermission(Manifest.permission.WRITE_EXTERNAL_STORAGE)
 308     void shotImage(final View v) {
 309         // è·å–æˆªå›¾
 310         detailPlayer.taskShotPic(new GSYVideoShotListener() {
 311             @Override
 312             public void getBitmap(Bitmap bitmap) {
 313                 if (bitmap != null) {
 314                     try {
 315                         CommonUtil.saveBitmap(bitmap);
 316                     } catch (FileNotFoundException e) {
 317                         showToast(&quot;save fail &quot;);
 318                         e.printStackTrace();
 319                         return;
 320                     }
 321                     showToast(&quot;save success &quot;);
 322                 } else {
 323                     showToast(&quot;get bitmap fail &quot;);
 324                 }
 325             }
 326         });
 327     }
 328 
 329     private void loadCover(ImageView imageView, String url) {
 330 
 331         imageView.setScaleType(ImageView.ScaleType.CENTER_CROP);
 332         imageView.setImageResource(R.mipmap.xxx1);
 333 
 334         Glide.with(this.getApplicationContext())
 335                 .setDefaultRequestOptions(
 336                         new RequestOptions()
 337                                 .frame(3000000)
 338                                 .centerCrop()
 339                                 .error(R.mipmap.xxx2)
 340                                 .placeholder(R.mipmap.xxx1))
 341                 .load(url)
 342                 .into(imageView);
 343     }
 344 
 345     private void resolveNormalVideoUI() {
 346         //å¢åŠ title
 347         detailPlayer.getTitleTextView().setVisibility(View.GONE);
 348         detailPlayer.getBackButton().setVisibility(View.GONE);
 349     }
 350 
 351     /**
 352      * æ˜¾ç¤ºæ¯”ä¾‹
 353      * æ³¨æ„ï¼ŒGSYVideoType.setShowTypeæ˜¯å…¨å±€é™æ€ç”Ÿæ•ˆï¼Œé™¤éé‡å¯APPã€‚
 354      */
 355     private void resolveTypeUI() {
 356         if (speed == 1) {
 357             speed = 1.5f;
 358         } else if (speed == 1.5f) {
 359             speed = 2f;
 360         } else if (speed == 2) {
 361             speed = 0.5f;
 362         } else if (speed == 0.5f) {
 363             speed = 0.25f;
 364         } else if (speed == 0.25f) {
 365             speed = 1;
 366         }
 367         changeSpeed.setText(&quot;æ’­æ”¾é€Ÿåº¦ï¼š&quot; + speed);
 368         detailPlayer.setSpeedPlaying(speed, true);
 369     }
 370 
 371     private void showToast(final String tip) {
 372         detailPlayer.post(new Runnable() {
 373             @Override
 374             public void run() {
 375                 Toast.makeText(DetailControlActivity.this, tip, Toast.LENGTH_LONG).show();
 376             }
 377         });
 378     }
 379 
 380     @Override
<abbr title=" 381     public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {"> 381     public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[]ğŸ”µ</abbr>
 382         super.onRequestPermissionsResult(requestCode, permissions, grantResults);
 383         // NOTE: delegate the permission handling to generated method
<abbr title=" 384         DetailControlActivityPermissionsDispatcher.onRequestPermissionsResult(this, requestCode, grantResults);"> 384         DetailControlActivityPermissionsDispatcher.onRequestPermissionsResult(this, requestCode, grantResğŸ”µ</abbr>
 385     }
 386 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  package com.example.gsyvideoplayer;
   2  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   3 +import android.Manifest;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   4 +import android.app.AlertDialog;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   5 +import android.content.DialogInterface;</span>
   6  import android.content.res.Configuration;
   7  import android.graphics.Bitmap;
   8  import android.os.Bundle;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   9 +import android.support.annotation.NonNull;</span>
  10  import android.support.v4.widget.NestedScrollView;
  11  import android.view.View;
  12  import android.widget.Button;
  13  import android.widget.ImageView;
  14  import android.widget.RelativeLayout;
  15  import android.widget.Toast;
  16  
  17  import com.bumptech.glide.Glide;
  18  import com.bumptech.glide.request.RequestOptions;
  19  import com.example.gsyvideoplayer.utils.CommonUtil;
  20  import com.example.gsyvideoplayer.utils.JumpUtils;
  21  import com.example.gsyvideoplayer.video.SampleControlVideo;
  22  import com.shuyu.gsyvideoplayer.GSYBaseActivityDetail;
  23  import com.shuyu.gsyvideoplayer.GSYVideoManager;
  24  import com.shuyu.gsyvideoplayer.builder.GSYVideoOptionBuilder;
  25  import com.shuyu.gsyvideoplayer.listener.GSYVideoGifSaveListener;
  26  import com.shuyu.gsyvideoplayer.listener.GSYVideoShotListener;
  27  import com.shuyu.gsyvideoplayer.listener.LockClickListener;
  28  import com.shuyu.gsyvideoplayer.model.VideoOptionModel;
  29  import com.shuyu.gsyvideoplayer.utils.Debuger;
  30  import com.shuyu.gsyvideoplayer.utils.FileUtils;
  31  import com.shuyu.gsyvideoplayer.utils.GifCreateHelper;
  32  import com.shuyu.gsyvideoplayer.video.StandardGSYVideoPlayer;
  33  import com.shuyu.gsyvideoplayer.video.base.GSYBaseVideoPlayer;
  34  
  35  import java.io.File;
  36  import java.io.FileNotFoundException;
  37  import java.util.ArrayList;
  38  import java.util.List;
  39  
  40  import butterknife.BindView;
  41  import butterknife.ButterKnife;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  42 +import permissions.dispatcher.NeedsPermission;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  43 +import permissions.dispatcher.OnNeverAskAgain;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  44 +import permissions.dispatcher.OnPermissionDenied;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  45 +import permissions.dispatcher.OnShowRationale;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  46 +import permissions.dispatcher.PermissionRequest;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  47 +import permissions.dispatcher.RuntimePermissions;</span>
  48  import tv.danmaku.ijk.media.player.IjkMediaPlayer;
  49  
  50  /**
  51   * sampleVideoæ”¯æŒå…¨å±ä¸éå…¨å±åˆ‡æ¢çš„æ¸…æ™°åº¦ï¼Œæ—‹è½¬ï¼Œé•œåƒç­‰åŠŸèƒ½.
  52   * Activityå¯ä»¥ç»§æ‰¿GSYBaseActivityDetailå®ç°è¯¦æƒ…æ¨¡å¼çš„é¡µé¢
  53   * æˆ–è€…å‚è€ƒDetailPlayerã€DetailListPlayerå®ç°
  54   * &lt;p&gt;
  55   * Created by guoshuyu on 2017/6/18.
  56   */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  57 -</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  58 +@RuntimePermissions</span>
  59  public class DetailControlActivity extends GSYBaseActivityDetail&lt;StandardGSYVideoPlayer&gt; {
  60  
  61      @BindView(R.id.post_detail_nested_scroll)
  62      NestedScrollView postDetailNestedScroll;
  63  
  64      @BindView(R.id.detail_player)
  65      SampleControlVideo detailPlayer;
  66  
  67      @BindView(R.id.activity_detail_player)
  68      RelativeLayout activityDetailPlayer;
  69  
  70      @BindView(R.id.change_speed)
  71      Button changeSpeed;
  72  
  73  
  74      @BindView(R.id.jump)
  75      Button jump;
  76  
  77      @BindView(R.id.shot)
  78      Button shot;
  79  
  80      @BindView(R.id.start_gif)
  81      Button startGif;
  82  
  83      @BindView(R.id.stop_gif)
  84      Button stopGif;
  85  
  86      @BindView(R.id.loadingView)
  87      View loadingView;
  88  
  89      private String url = &quot;http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4&quot;;
  90      //private String url = &quot;http://livecdn1.news.cn/Live_MajorEvent01Phone/manifest.m3u8&quot;;
<abbr title="  91      //private String url = &quot;https://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/8908d124aa839d0d3fa9593855ef5957.m3u8&quot;;">  91      //private String url = &quot;https://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/8908d124ağŸ”µ</abbr>
<abbr title="  92      //private String url2 = &quot;http://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/3aca1a0db8db9418dcbc765848c8903e.m3u8&quot;;">  92      //private String url2 = &quot;http://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/3aca1a0dbğŸ”µ</abbr>
  93  
  94  
  95      private GifCreateHelper mGifCreateHelper;
  96  
  97      private float speed = 1;
  98  
  99      @Override
 100      protected void onCreate(Bundle savedInstanceState) {
 101          super.onCreate(savedInstanceState);
 102          setContentView(R.layout.activity_detail_control);
 103          ButterKnife.bind(this);
 104  
 105          resolveNormalVideoUI();
 106  
 107          initVideoBuilderMode();
 108  
 109          initGifHelper();
 110  
 111          detailPlayer.setLockClickListener(new LockClickListener() {
 112              @Override
 113              public void onClick(View view, boolean lock) {
 114                  //if (orientationUtils != null) {
 115                  //é…åˆä¸‹æ–¹çš„onConfigurationChanged
 116                  //orientationUtils.setEnable(!lock);
 117                  //}
 118              }
 119          });
 120  
 121          changeSpeed.setOnClickListener(new View.OnClickListener() {
 122              @Override
 123              public void onClick(View v) {
 124                  resolveTypeUI();
 125              }
 126          });
 127  
 128          /*VideoOptionModel videoOptionModel =
 129                  new VideoOptionModel(IjkMediaPlayer.OPT_CATEGORY_FORMAT, &quot;dns_cache_clear&quot;, 1);
 130          List&lt;VideoOptionModel&gt; list = new ArrayList&lt;&gt;();
 131          list.add(videoOptionModel);
 132          videoOptionModel =
 133                  new VideoOptionModel(IjkMediaPlayer.OPT_CATEGORY_FORMAT, &quot;rtsp_transport&quot;, &quot;tcp&quot;);
 134          list.add(videoOptionModel);
 135          GSYVideoManager.instance().setOptionModelList(list);*/
 136  
 137          jump.setOnClickListener(new View.OnClickListener() {
 138              @Override
 139              public void onClick(View v) {
 140                  JumpUtils.gotoControl(DetailControlActivity.this);
 141                  //startActivity(new Intent(DetailControlActivity.this, MainActivity.class));
 142              }
 143          });
 144  
 145          shot.setOnClickListener(new View.OnClickListener() {
 146              @Override
 147              public void onClick(View v) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 148 -                shotImage(v);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 149 +                DetailControlActivityPermissionsDispatcher.shotImageWithPermissionCheck(DetailControlActivity.this, v);"> 149 +                DetailControlActivityPermissionsDispatcher.shotImageWithPermissionCheck(DetailControlActivity.thisğŸ”µ</abbr></span>
 150              }
 151          });
 152  
 153  
 154          startGif.setOnClickListener(new View.OnClickListener() {
 155              @Override
 156              public void onClick(View v) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 157 -                startGif();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 158 +                DetailControlActivityPermissionsDispatcher.startGifWithPermissionCheck(DetailControlActivity.this);"> 158 +                DetailControlActivityPermissionsDispatcher.startGifWithPermissionCheck(DetailControlActivity.this)ğŸ”µ</abbr></span>
 159              }
 160          });
 161  
 162          stopGif.setOnClickListener(new View.OnClickListener() {
 163              @Override
 164              public void onClick(View v) {
 165                  stopGif();
 166              }
 167          });
 168  
 169          loadingView.setOnClickListener(new View.OnClickListener() {
 170              @Override
 171              public void onClick(View v) {
 172                  //do nothing
 173              }
 174          });
 175      }
 176  
 177      @Override
 178      public StandardGSYVideoPlayer getGSYVideoPlayer() {
 179          return detailPlayer;
 180      }
 181  
 182      @Override
 183      public GSYVideoOptionBuilder getGSYVideoOptionBuilder() {
 184          //å†…ç½®å°é¢å¯å‚è€ƒSampleCoverVideo
 185          ImageView imageView = new ImageView(this);
 186          loadCover(imageView, url);
 187          return new GSYVideoOptionBuilder()
 188                  .setThumbImageView(imageView)
 189                  .setUrl(url)
 190                  .setCacheWithPlay(true)
 191                  .setVideoTitle(&quot; &quot;)
 192                  .setIsTouchWiget(true)
 193                  .setRotateViewAuto(false)
 194                  .setLockLand(false)
 195                  .setShowFullAnimation(true)//æ‰“å¼€åŠ¨ç”»
 196                  .setNeedLockFull(true)
 197                  .setSeekRatio(1);
 198      }
 199  
 200      @Override
 201      public void clickForFullScreen() {
 202  
 203      }
 204  
 205      @Override
 206      protected void onDestroy() {
 207          super.onDestroy();
 208          mGifCreateHelper.cancelTask();
 209      }
 210  
 211  
 212      /*******************************ç«–å±å…¨å±å¼€å§‹************************************/
 213  
 214      @Override
 215      public void initVideo() {
 216          super.initVideo();
 217          //é‡è½½åå®ç°ç‚¹å‡»ï¼Œä¸æ¨ªå±
 218          if (getGSYVideoPlayer().getFullscreenButton() != null) {
 219              getGSYVideoPlayer().getFullscreenButton().setOnClickListener(new View.OnClickListener() {
 220                  @Override
 221                  public void onClick(View v) {
 222                      //ç¬¬ä¸€ä¸ªtrueæ˜¯å¦éœ€è¦éšè—actionbarï¼Œç¬¬äºŒä¸ªtrueæ˜¯å¦éœ€è¦éšè—statusbar
 223                      getGSYVideoPlayer().startWindowFullscreen(DetailControlActivity.this, true, true);
 224                  }
 225              });
 226          }
 227      }
 228  
 229  
 230      /**
 231       * æ˜¯å¦å¯åŠ¨æ—‹è½¬æ¨ªå±ï¼Œtrueè¡¨ç¤ºå¯åŠ¨
 232       *
 233       * @return true
 234       */
 235      @Override
 236      public boolean getDetailOrientationRotateAuto() {
 237          return false;
 238      }
 239  
 240      //é‡è½½åå…³é—­é‡åŠ›æ—‹è½¬
 241      @Override
 242      public void onConfigurationChanged(Configuration newConfig) {
 243          super.onConfigurationChanged(newConfig);
 244          orientationUtils.setEnable(false);
 245      }
 246  
 247      //é‡è½½åä¸åšä»»ä½•äº‹æƒ…ï¼Œå®ç°ç«–å±å…¨å±
 248      @Override
 249      public void onQuitFullscreen(String url, Object... objects) {
 250          super.onQuitFullscreen(url, objects);
 251      }
 252  
 253      /*******************************ç«–å±å…¨å±ç»“æŸ************************************/
 254  
 255      private void initGifHelper() {
 256          mGifCreateHelper = new GifCreateHelper(detailPlayer, new GSYVideoGifSaveListener() {
 257              @Override
 258              public void result(boolean success, File file) {
 259                  detailPlayer.post(new Runnable() {
 260                      @Override
 261                      public void run() {
 262                          loadingView.setVisibility(View.GONE);
 263                          Toast.makeText(detailPlayer.getContext(), &quot;åˆ›å»ºæˆåŠŸ&quot;, Toast.LENGTH_LONG).show();
 264                      }
 265                  });
 266              }
 267  
 268              @Override
 269              public void process(int curPosition, int total) {
 270                  Debuger.printfError(&quot; current &quot; + curPosition + &quot; total &quot; + total);
 271              }
 272          });
 273      }
 274  
 275  
 276      /**
 277       * å¼€å§‹gifæˆªå›¾
 278       */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 279 -    private void startGif() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 280 +    @NeedsPermission(Manifest.permission.WRITE_EXTERNAL_STORAGE)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 281 +    void startGif() {</span>
 282          //å¼€å§‹ç¼“å­˜å„ä¸ªå¸§
 283          mGifCreateHelper.startGif(new File(FileUtils.getPath()));
 284  
 285      }
 286  
 287      /**
 288       * ç”Ÿæˆgif
 289       */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 290 -    private void stopGif() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 291 +    void stopGif() {</span>
 292          loadingView.setVisibility(View.VISIBLE);
 293          mGifCreateHelper.stopGif(new File(FileUtils.getPath(), &quot;GSY-Z-&quot; + System.currentTimeMillis() + &quot;.gif&quot;));
 294      }
 295  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 296 +    @OnShowRationale(Manifest.permission.WRITE_EXTERNAL_STORAGE)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 297 +    void showRationaleForCamera(final PermissionRequest request) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 298 +        new AlertDialog.Builder(this)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 299 +                .setMessage(&quot;å¿«ç»™æˆ‘æƒé™&quot;)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 300 +                .setPositiveButton(&quot;å…è®¸&quot;, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 301 +                    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 302 +                    public void onClick(DialogInterface dialog, int which) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 303 +                        request.proceed();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 304 +                    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 305 +                })</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 306 +                .setNegativeButton(&quot;æ‹’ç»&quot;, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 307 +                    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 308 +                    public void onClick(DialogInterface dialog, int which) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 309 +                        request.cancel();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 310 +                    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 311 +                })</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 312 +                .show();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 313 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 314 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 315 +    @OnPermissionDenied(Manifest.permission.WRITE_EXTERNAL_STORAGE)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 316 +    void showDeniedForCamera() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 317 +        Toast.makeText(this, &quot;æ²¡æœ‰æƒé™å•Š&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 318 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 319 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 320 +    @OnNeverAskAgain(Manifest.permission.CAMERA)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 321 +    void showNeverAskForCamera() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 322 +        Toast.makeText(this, &quot;å†æ¬¡æˆæƒ&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 323 +    }</span>
 324  
 325      /**
 326       * è§†é¢‘æˆªå›¾
 327       * è¿™é‡Œæ²¡æœ‰åšè¯»å†™æœ¬åœ°sdå¡çš„æƒé™å¤„ç†ï¼Œè®°å¾—å®é™…ä½¿ç”¨è¦åŠ ä¸Š
 328       */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 329 -    private void shotImage(final View v) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 330 +    @NeedsPermission(Manifest.permission.WRITE_EXTERNAL_STORAGE)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 331 +    void shotImage(final View v) {</span>
 332          //è·å–æˆªå›¾
 333          detailPlayer.taskShotPic(new GSYVideoShotListener() {
 334              @Override
 335              public void getBitmap(Bitmap bitmap) {
 336                  if (bitmap != null) {
 337                      try {
 338                          CommonUtil.saveBitmap(bitmap);
 339                      } catch (FileNotFoundException e) {
 340                          showToast(&quot;save fail &quot;);
 341                          e.printStackTrace();
 342                          return;
 343                      }
 344                      showToast(&quot;save success &quot;);
 345                  } else {
 346                      showToast(&quot;get bitmap fail &quot;);
 347                  }
 348              }
 349          });
 350  
 351      }
 352  
 353  
 354      private void loadCover(ImageView imageView, String url) {
 355  
 356          imageView.setScaleType(ImageView.ScaleType.CENTER_CROP);
 357          imageView.setImageResource(R.mipmap.xxx1);
 358  
 359          Glide.with(this.getApplicationContext())
 360                  .setDefaultRequestOptions(
 361                          new RequestOptions()
 362                                  .frame(3000000)
 363                                  .centerCrop()
 364                                  .error(R.mipmap.xxx2)
 365                                  .placeholder(R.mipmap.xxx1))
 366                  .load(url)
 367                  .into(imageView);
 368      }
 369  
 370      private void resolveNormalVideoUI() {
 371          //å¢åŠ title
 372          detailPlayer.getTitleTextView().setVisibility(View.GONE);
 373          detailPlayer.getBackButton().setVisibility(View.GONE);
 374      }
 375  
 376      /**
 377       * æ˜¾ç¤ºæ¯”ä¾‹
 378       * æ³¨æ„ï¼ŒGSYVideoType.setShowTypeæ˜¯å…¨å±€é™æ€ç”Ÿæ•ˆï¼Œé™¤éé‡å¯APPã€‚
 379       */
 380      private void resolveTypeUI() {
 381          if (speed == 1) {
 382              speed = 1.5f;
 383          } else if (speed == 1.5f) {
 384              speed = 2f;
 385          } else if (speed == 2) {
 386              speed = 0.5f;
 387          } else if (speed == 0.5f) {
 388              speed = 0.25f;
 389          } else if (speed == 0.25f) {
 390              speed = 1;
 391          }
 392          changeSpeed.setText(&quot;æ’­æ”¾é€Ÿåº¦ï¼š&quot; + speed);
 393          detailPlayer.setSpeedPlaying(speed, true);
 394      }
 395  
 396  
 397      private void showToast(final String tip) {
 398          detailPlayer.post(new Runnable() {
 399              @Override
 400              public void run() {
 401                  Toast.makeText(DetailControlActivity.this, tip, Toast.LENGTH_LONG).show();
 402              }
 403          });
 404      }
 405  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 406 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 407 +    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {"> 407 +    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResğŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 408 +        super.onRequestPermissionsResult(requestCode, permissions, grantResults);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 409 +        // NOTE: delegate the permission handling to generated method</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 410 +        DetailControlActivityPermissionsDispatcher.onRequestPermissionsResult(this, requestCode, grantResults);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 411 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 412 +</span>
 413  }</pre></td>
                            <td><pre>   1  package com.example.gsyvideoplayer;
   2  



   3  import android.content.res.Configuration;
   4  import android.graphics.Bitmap;
   5  import android.os.Bundle;

   6  import android.support.v4.widget.NestedScrollView;
   7  import android.view.View;
   8  import android.widget.Button;
   9  import android.widget.ImageView;
  10  import android.widget.RelativeLayout;
  11  import android.widget.Toast;
  12  
  13  import com.bumptech.glide.Glide;
  14  import com.bumptech.glide.request.RequestOptions;
  15  import com.example.gsyvideoplayer.utils.CommonUtil;
  16  import com.example.gsyvideoplayer.utils.JumpUtils;
  17  import com.example.gsyvideoplayer.video.SampleControlVideo;
  18  import com.shuyu.gsyvideoplayer.GSYBaseActivityDetail;
  19  import com.shuyu.gsyvideoplayer.GSYVideoManager;
  20  import com.shuyu.gsyvideoplayer.builder.GSYVideoOptionBuilder;
  21  import com.shuyu.gsyvideoplayer.listener.GSYVideoGifSaveListener;
  22  import com.shuyu.gsyvideoplayer.listener.GSYVideoShotListener;
  23  import com.shuyu.gsyvideoplayer.listener.LockClickListener;
  24  import com.shuyu.gsyvideoplayer.model.VideoOptionModel;
  25  import com.shuyu.gsyvideoplayer.utils.Debuger;
  26  import com.shuyu.gsyvideoplayer.utils.FileUtils;
  27  import com.shuyu.gsyvideoplayer.utils.GifCreateHelper;
  28  import com.shuyu.gsyvideoplayer.video.StandardGSYVideoPlayer;
  29  import com.shuyu.gsyvideoplayer.video.base.GSYBaseVideoPlayer;
  30  
  31  import java.io.File;
  32  import java.io.FileNotFoundException;
  33  import java.util.ArrayList;
  34  import java.util.List;
  35  
  36  import butterknife.BindView;
  37  import butterknife.ButterKnife;






  38  import tv.danmaku.ijk.media.player.IjkMediaPlayer;
  39  
  40  /**
  41   * sampleVideoæ”¯æŒå…¨å±ä¸éå…¨å±åˆ‡æ¢çš„æ¸…æ™°åº¦ï¼Œæ—‹è½¬ï¼Œé•œåƒç­‰åŠŸèƒ½.
  42   * Activityå¯ä»¥ç»§æ‰¿GSYBaseActivityDetailå®ç°è¯¦æƒ…æ¨¡å¼çš„é¡µé¢
  43   * æˆ–è€…å‚è€ƒDetailPlayerã€DetailListPlayerå®ç°
  44   * &lt;p&gt;
  45   * Created by guoshuyu on 2017/6/18.
  46   */
  47  

  48  public class DetailControlActivity extends GSYBaseActivityDetail&lt;StandardGSYVideoPlayer&gt; {
  49  
  50      @BindView(R.id.post_detail_nested_scroll)
  51      NestedScrollView postDetailNestedScroll;
  52  
  53      @BindView(R.id.detail_player)
  54      SampleControlVideo detailPlayer;
  55  
  56      @BindView(R.id.activity_detail_player)
  57      RelativeLayout activityDetailPlayer;
  58  
  59      @BindView(R.id.change_speed)
  60      Button changeSpeed;
  61  
  62  
  63      @BindView(R.id.jump)
  64      Button jump;
  65  
  66      @BindView(R.id.shot)
  67      Button shot;
  68  
  69      @BindView(R.id.start_gif)
  70      Button startGif;
  71  
  72      @BindView(R.id.stop_gif)
  73      Button stopGif;
  74  
  75      @BindView(R.id.loadingView)
  76      View loadingView;
  77  
  78      private String url = &quot;http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4&quot;;
  79      //private String url = &quot;http://livecdn1.news.cn/Live_MajorEvent01Phone/manifest.m3u8&quot;;
<abbr title="  80      //private String url = &quot;https://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/8908d124aa839d0d3fa9593855ef5957.m3u8&quot;;">  80      //private String url = &quot;https://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/8908d124ağŸ”µ</abbr>
<abbr title="  81      //private String url2 = &quot;http://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/3aca1a0db8db9418dcbc765848c8903e.m3u8&quot;;">  81      //private String url2 = &quot;http://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/3aca1a0dbğŸ”µ</abbr>
  82  
  83  
  84      private GifCreateHelper mGifCreateHelper;
  85  
  86      private float speed = 1;
  87  
  88      @Override
  89      protected void onCreate(Bundle savedInstanceState) {
  90          super.onCreate(savedInstanceState);
  91          setContentView(R.layout.activity_detail_control);
  92          ButterKnife.bind(this);
  93  
  94          resolveNormalVideoUI();
  95  
  96          initVideoBuilderMode();
  97  
  98          initGifHelper();
  99  
 100          detailPlayer.setLockClickListener(new LockClickListener() {
 101              @Override
 102              public void onClick(View view, boolean lock) {
 103                  //if (orientationUtils != null) {
 104                  //é…åˆä¸‹æ–¹çš„onConfigurationChanged
 105                  //orientationUtils.setEnable(!lock);
 106                  //}
 107              }
 108          });
 109  
 110          changeSpeed.setOnClickListener(new View.OnClickListener() {
 111              @Override
 112              public void onClick(View v) {
 113                  resolveTypeUI();
 114              }
 115          });
 116  
 117          /*VideoOptionModel videoOptionModel =
 118                  new VideoOptionModel(IjkMediaPlayer.OPT_CATEGORY_FORMAT, &quot;dns_cache_clear&quot;, 1);
 119          List&lt;VideoOptionModel&gt; list = new ArrayList&lt;&gt;();
 120          list.add(videoOptionModel);
 121          videoOptionModel =
 122                  new VideoOptionModel(IjkMediaPlayer.OPT_CATEGORY_FORMAT, &quot;rtsp_transport&quot;, &quot;tcp&quot;);
 123          list.add(videoOptionModel);
 124          GSYVideoManager.instance().setOptionModelList(list);*/
 125  
 126          jump.setOnClickListener(new View.OnClickListener() {
 127              @Override
 128              public void onClick(View v) {
 129                  JumpUtils.gotoControl(DetailControlActivity.this);
 130                  //startActivity(new Intent(DetailControlActivity.this, MainActivity.class));
 131              }
 132          });
 133  
 134          shot.setOnClickListener(new View.OnClickListener() {
 135              @Override
 136              public void onClick(View v) {
 137                  shotImage(v);

 138              }
 139          });
 140  
 141  
 142          startGif.setOnClickListener(new View.OnClickListener() {
 143              @Override
 144              public void onClick(View v) {
 145                  startGif();

 146              }
 147          });
 148  
 149          stopGif.setOnClickListener(new View.OnClickListener() {
 150              @Override
 151              public void onClick(View v) {
 152                  stopGif();
 153              }
 154          });
 155  
 156          loadingView.setOnClickListener(new View.OnClickListener() {
 157              @Override
 158              public void onClick(View v) {
 159                  //do nothing
 160              }
 161          });
 162      }
 163  
 164      @Override
 165      public StandardGSYVideoPlayer getGSYVideoPlayer() {
 166          return detailPlayer;
 167      }
 168  
 169      @Override
 170      public GSYVideoOptionBuilder getGSYVideoOptionBuilder() {
 171          //å†…ç½®å°é¢å¯å‚è€ƒSampleCoverVideo
 172          ImageView imageView = new ImageView(this);
 173          loadCover(imageView, url);
 174          return new GSYVideoOptionBuilder()
 175                  .setThumbImageView(imageView)
 176                  .setUrl(url)
 177                  .setCacheWithPlay(true)
 178                  .setVideoTitle(&quot; &quot;)
 179                  .setIsTouchWiget(true)
 180                  .setRotateViewAuto(false)
 181                  .setLockLand(false)
 182                  .setShowFullAnimation(true)//æ‰“å¼€åŠ¨ç”»
 183                  .setNeedLockFull(true)
 184                  .setSeekRatio(1);
 185      }
 186  
 187      @Override
 188      public void clickForFullScreen() {
 189  
 190      }
 191  
 192      @Override
 193      protected void onDestroy() {
 194          super.onDestroy();
 195          mGifCreateHelper.cancelTask();
 196      }
 197  
 198  
 199      /*******************************ç«–å±å…¨å±å¼€å§‹************************************/
 200  
 201      @Override
 202      public void initVideo() {
 203          super.initVideo();
 204          //é‡è½½åå®ç°ç‚¹å‡»ï¼Œä¸æ¨ªå±
 205          if (getGSYVideoPlayer().getFullscreenButton() != null) {
 206              getGSYVideoPlayer().getFullscreenButton().setOnClickListener(new View.OnClickListener() {
 207                  @Override
 208                  public void onClick(View v) {
 209                      //ç¬¬ä¸€ä¸ªtrueæ˜¯å¦éœ€è¦éšè—actionbarï¼Œç¬¬äºŒä¸ªtrueæ˜¯å¦éœ€è¦éšè—statusbar
 210                      getGSYVideoPlayer().startWindowFullscreen(DetailControlActivity.this, true, true);
 211                  }
 212              });
 213          }
 214      }
 215  
 216  
 217      /**
 218       * æ˜¯å¦å¯åŠ¨æ—‹è½¬æ¨ªå±ï¼Œtrueè¡¨ç¤ºå¯åŠ¨
 219       *
 220       * @return true
 221       */
 222      @Override
 223      public boolean getDetailOrientationRotateAuto() {
 224          return false;
 225      }
 226  
 227      //é‡è½½åå…³é—­é‡åŠ›æ—‹è½¬
 228      @Override
 229      public void onConfigurationChanged(Configuration newConfig) {
 230          super.onConfigurationChanged(newConfig);
 231          orientationUtils.setEnable(false);
 232      }
 233  
 234      //é‡è½½åä¸åšä»»ä½•äº‹æƒ…ï¼Œå®ç°ç«–å±å…¨å±
 235      @Override
 236      public void onQuitFullscreen(String url, Object... objects) {
 237          super.onQuitFullscreen(url, objects);
 238      }
 239  
 240      /*******************************ç«–å±å…¨å±ç»“æŸ************************************/
 241  
 242      private void initGifHelper() {
 243          mGifCreateHelper = new GifCreateHelper(detailPlayer, new GSYVideoGifSaveListener() {
 244              @Override
 245              public void result(boolean success, File file) {
 246                  detailPlayer.post(new Runnable() {
 247                      @Override
 248                      public void run() {
 249                          loadingView.setVisibility(View.GONE);
 250                          Toast.makeText(detailPlayer.getContext(), &quot;åˆ›å»ºæˆåŠŸ&quot;, Toast.LENGTH_LONG).show();
 251                      }
 252                  });
 253              }
 254  
 255              @Override
 256              public void process(int curPosition, int total) {
 257                  Debuger.printfError(&quot; current &quot; + curPosition + &quot; total &quot; + total);
 258              }
 259          });
 260      }
 261  
 262  
 263      /**
 264       * å¼€å§‹gifæˆªå›¾
 265       */
 266      private void startGif() {
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 267 +        Toast.makeText(this, &quot;é¡¹ç›®é‡Œç›®å‰æ²¡åšåŠ¨æ€æˆæƒï¼Œéœ€è¦ä½ å»åšè®¾ç½®é‡Œæˆæƒæ–‡ä»¶è¯»å–å“¦&quot;, Toast.LENGTH_LONG).show();</span>

 268          //å¼€å§‹ç¼“å­˜å„ä¸ªå¸§
 269          mGifCreateHelper.startGif(new File(FileUtils.getPath()));
 270  
 271      }
 272  
 273      /**
 274       * ç”Ÿæˆgif
 275       */
 276      private void stopGif() {
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 277 +        Toast.makeText(this, &quot;é¡¹ç›®é‡Œç›®å‰æ²¡åšåŠ¨æ€æˆæƒï¼Œéœ€è¦ä½ å»åšè®¾ç½®é‡Œæˆæƒæ–‡ä»¶è¯»å–å“¦&quot;, Toast.LENGTH_LONG).show();</span>
 278          loadingView.setVisibility(View.VISIBLE);
 279          mGifCreateHelper.stopGif(new File(FileUtils.getPath(), &quot;GSY-Z-&quot; + System.currentTimeMillis() + &quot;.gif&quot;));
 280      }
 281  




























 282  
 283      /**
 284       * è§†é¢‘æˆªå›¾
 285       * è¿™é‡Œæ²¡æœ‰åšè¯»å†™æœ¬åœ°sdå¡çš„æƒé™å¤„ç†ï¼Œè®°å¾—å®é™…ä½¿ç”¨è¦åŠ ä¸Š
 286       */
 287      private void shotImage(final View v) {


 288          //è·å–æˆªå›¾
 289          detailPlayer.taskShotPic(new GSYVideoShotListener() {
 290              @Override
 291              public void getBitmap(Bitmap bitmap) {
 292                  if (bitmap != null) {
 293                      try {
 294                          CommonUtil.saveBitmap(bitmap);
 295                      } catch (FileNotFoundException e) {
 296                          showToast(&quot;save fail &quot;);
 297                          e.printStackTrace();
 298                          return;
 299                      }
 300                      showToast(&quot;save success &quot;);
 301                  } else {
 302                      showToast(&quot;get bitmap fail &quot;);
 303                  }
 304              }
 305          });
 306  
 307      }
 308  
 309  
 310      private void loadCover(ImageView imageView, String url) {
 311  
 312          imageView.setScaleType(ImageView.ScaleType.CENTER_CROP);
 313          imageView.setImageResource(R.mipmap.xxx1);
 314  
 315          Glide.with(this.getApplicationContext())
 316                  .setDefaultRequestOptions(
 317                          new RequestOptions()
 318                                  .frame(3000000)
 319                                  .centerCrop()
 320                                  .error(R.mipmap.xxx2)
 321                                  .placeholder(R.mipmap.xxx1))
 322                  .load(url)
 323                  .into(imageView);
 324      }
 325  
 326      private void resolveNormalVideoUI() {
 327          //å¢åŠ title
 328          detailPlayer.getTitleTextView().setVisibility(View.GONE);
 329          detailPlayer.getBackButton().setVisibility(View.GONE);
 330      }
 331  
 332      /**
 333       * æ˜¾ç¤ºæ¯”ä¾‹
 334       * æ³¨æ„ï¼ŒGSYVideoType.setShowTypeæ˜¯å…¨å±€é™æ€ç”Ÿæ•ˆï¼Œé™¤éé‡å¯APPã€‚
 335       */
 336      private void resolveTypeUI() {
 337          if (speed == 1) {
 338              speed = 1.5f;
 339          } else if (speed == 1.5f) {
 340              speed = 2f;
 341          } else if (speed == 2) {
 342              speed = 0.5f;
 343          } else if (speed == 0.5f) {
 344              speed = 0.25f;
 345          } else if (speed == 0.25f) {
 346              speed = 1;
 347          }
 348          changeSpeed.setText(&quot;æ’­æ”¾é€Ÿåº¦ï¼š&quot; + speed);
 349          detailPlayer.setSpeedPlaying(speed, true);
 350      }
 351  
 352  
 353      private void showToast(final String tip) {
 354          detailPlayer.post(new Runnable() {
 355              @Override
 356              public void run() {
 357                  Toast.makeText(DetailControlActivity.this, tip, Toast.LENGTH_LONG).show();
 358              }
 359          });
 360      }
 361  







 362  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            