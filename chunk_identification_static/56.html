<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>56</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    56
                    <a href="55.html">prev</a>
                    <a href="57.html">next</a>
                    <a href="56_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    AriaLyy/Aria_0d4f29d921f90eae739f3f468c1d492de3b42636_Aria/src/main/java/com/arialyy/aria/core/download/downloader/DownloadGroupUtil.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;0d4f29d921f90eae739f3f468c1d492de3b42636:Aria/src/main/java/com/arialyy/aria/core/download/downloader/DownloadGroupUtil.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;0d4f29d921f90eae739f3f468c1d492de3b42636^1:Aria/src/main/java/com/arialyy/aria/core/download/downloader/DownloadGroupUtil.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;0d4f29d921f90eae739f3f468c1d492de3b42636^2:Aria/src/main/java/com/arialyy/aria/core/download/downloader/DownloadGroupUtil.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;4f1412b55470f431a66ea1ebfe5e131652183b1b:Aria/src/main/java/com/arialyy/aria/core/download/downloader/DownloadGroupUtil.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [j]], subset: [[b], [j]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="4634392904032211814" onmouseenter="enter('4634392904032211814');" onmouseout="out('4634392904032211814');" style="">  16 package com.arialyy.aria.core.download.downloader;                                                       </span>
<span  style="">  17                                                                                                          </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  18 import android.util.SparseArray;                                                                         </span>
<span class="-3094174390533083180" onmouseenter="enter('-3094174390533083180');" onmouseout="out('-3094174390533083180');" style="">  19 import com.arialyy.aria.core.common.IUtil;                                                               </span>
<span class="5290109400157436023" onmouseenter="enter('5290109400157436023');" onmouseout="out('5290109400157436023');" style="">  20 import com.arialyy.aria.core.download.DownloadGroupTaskEntity;                                           </span>
<span class="8636089030381561336" onmouseenter="enter('8636089030381561336');" onmouseout="out('8636089030381561336');" style="">  21 import com.arialyy.aria.core.download.DownloadTaskEntity;                                                </span>
<span class="-5016163043314935005" onmouseenter="enter('-5016163043314935005');" onmouseout="out('-5016163043314935005');" style="">  22 import com.arialyy.aria.core.inf.IEntity;                                                                </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  23 import java.util.Set;                                                                                    </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  24 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  25 import java.util.concurrent.Executors;                                                                   </span>
<span  style="">  26                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  27 /**                                                                                                      </span>
<span class="1321179419529258125" onmouseenter="enter('1321179419529258125');" onmouseout="out('1321179419529258125');" style="">  28  * Created by AriaL on 2017/6/30.                                                                        </span>
<span class="7496304558415279260" onmouseenter="enter('7496304558415279260');" onmouseout="out('7496304558415279260');" style="">  29  * 任务组下载工具                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  30  */                                                                                                      </span>
<span class="753905216202195114" onmouseenter="enter('753905216202195114');" onmouseout="out('753905216202195114');" style="">  31 public class DownloadGroupUtil extends AbsGroupUtil implements IUtil {                                   </span>
<span class="3933744472183840087" onmouseenter="enter('3933744472183840087');" onmouseout="out('3933744472183840087');" style="">  32   private final String TAG = &quot;DownloadGroupUtil&quot;;                                                        </span>
<span class="4123530941227175815" onmouseenter="enter('4123530941227175815');" onmouseout="out('4123530941227175815');" style="">  33   private ExecutorService mInfoPool;                                                                     </span>
<span  style="">  34                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  35   /**                                                                                                    </span>
<span class="6416521976967220365" onmouseenter="enter('6416521976967220365');" onmouseout="out('6416521976967220365');" style="">  36    * 文件信息回调组                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  37    */                                                                                                    </span>
<span class="-5994431595118905059" onmouseenter="enter('-5994431595118905059');" onmouseout="out('-5994431595118905059');" style="">  38   private SparseArray&lt;OnFileInfoCallback&gt; mFileInfoCallbacks = new SparseArray&lt;&gt;();                      </span>
<span  style="">  39                                                                                                          </span>
<span class="-3731711094107651611" onmouseenter="enter('-3731711094107651611');" onmouseout="out('-3731711094107651611');" style="">  40   public DownloadGroupUtil(IDownloadGroupListener listener, DownloadGroupTaskEntity taskEntity) {        </span>
<span class="-7841553057471002442" onmouseenter="enter('-7841553057471002442');" onmouseout="out('-7841553057471002442');" style="">  41     super(listener, taskEntity);                                                                         </span>
<span class="-6453187294675473758" onmouseenter="enter('-6453187294675473758');" onmouseout="out('-6453187294675473758');" style="">  42     mInfoPool = Executors.newCachedThreadPool();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  43   }                                                                                                      </span>
<span  style="">  44                                                                                                          </span>
<span class="2093106455269248536" onmouseenter="enter('2093106455269248536');" onmouseout="out('2093106455269248536');" style="">  45   @Override public void onCancel() {                                                                     </span>
<span class="-5705545244356268786" onmouseenter="enter('-5705545244356268786');" onmouseout="out('-5705545244356268786');" style="">  46     super.onCancel();                                                                                    </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style="">  47     if (!mInfoPool.isShutdown()) {                                                                       </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style="">  48       mInfoPool.shutdown();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  49     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  50   }                                                                                                      </span>
<span  style="">  51                                                                                                          </span>
<span class="8218595092732559103" onmouseenter="enter('8218595092732559103');" onmouseout="out('8218595092732559103');" style="">  52   @Override protected void onStop() {                                                                    </span>
<span class="-4376279779571809033" onmouseenter="enter('-4376279779571809033');" onmouseout="out('-4376279779571809033');" style="">  53     super.onStop();                                                                                      </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style="">  54     if (!mInfoPool.isShutdown()) {                                                                       </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style="">  55       mInfoPool.shutdown();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  56     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  57   }                                                                                                      </span>
<span  style="">  58                                                                                                          </span>
<span class="7849318491336065590" onmouseenter="enter('7849318491336065590');" onmouseout="out('7849318491336065590');" style="">  59   @Override protected void onStart() {                                                                   </span>
<span class="8068463127664630279" onmouseenter="enter('8068463127664630279');" onmouseout="out('8068463127664630279');" style="">  60     super.onStart();                                                                                     </span>
<span class="4774762395313474868" onmouseenter="enter('4774762395313474868');" onmouseout="out('4774762395313474868');" style="">  61     Set&lt;String&gt; keys = mExeMap.keySet();                                                                 </span>
<span class="-8629982182851448523" onmouseenter="enter('-8629982182851448523');" onmouseout="out('-8629982182851448523');" style="">  62     int i = 0;                                                                                           </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="">  63     for (String key : keys) {                                                                            </span>
<span class="221423537684250497" onmouseenter="enter('221423537684250497');" onmouseout="out('221423537684250497');" style="">  64       DownloadTaskEntity taskEntity = mExeMap.get(key);                                                  </span>
<span class="2875409705898122648" onmouseenter="enter('2875409705898122648');" onmouseout="out('2875409705898122648');" style="">  65       if (taskEntity != null) {                                                                          </span>
<span class="3825460913713262848" onmouseenter="enter('3825460913713262848');" onmouseout="out('3825460913713262848');" style="">  66         if (taskEntity.getState() != IEntity.STATE_FAIL                                                  </span>
<span class="4045344078755509632" onmouseenter="enter('4045344078755509632');" onmouseout="out('4045344078755509632');" style="">  67             &amp;&amp; taskEntity.getState() != IEntity.STATE_WAIT) {                                            </span>
<span class="6449066979252177845" onmouseenter="enter('6449066979252177845');" onmouseout="out('6449066979252177845');" style="">  68           startChildDownload(taskEntity);                                                                </span>
<span class="-4968746635634186778" onmouseenter="enter('-4968746635634186778');" onmouseout="out('-4968746635634186778');" style="">  69           i++;                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  70         } else {                                                                                         </span>
<span class="4135184626453358547" onmouseenter="enter('4135184626453358547');" onmouseout="out('4135184626453358547');" style="">  71           mInfoPool.execute(createFileInfoThread(taskEntity));                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  72         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  73       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  74     }                                                                                                    </span>
<span class="-8434084337306400756" onmouseenter="enter('-8434084337306400756');" onmouseout="out('-8434084337306400756');" style="">  75     if (i == mExeMap.size()) startRunningFlow();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  76   }                                                                                                      </span>
<span  style="">  77                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  78   /**                                                                                                    </span>
<span class="-4547374311767626615" onmouseenter="enter('-4547374311767626615');" onmouseout="out('-4547374311767626615');" style="">  79    * 创建文件信息获取线程                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  80    */                                                                                                    </span>
<span class="5921359649843257629" onmouseenter="enter('5921359649843257629');" onmouseout="out('5921359649843257629');" style="">  81   private HttpFileInfoThread createFileInfoThread(DownloadTaskEntity taskEntity) {                       </span>
<span class="3806302679560349109" onmouseenter="enter('3806302679560349109');" onmouseout="out('3806302679560349109');" style="">  82     OnFileInfoCallback callback = mFileInfoCallbacks.get(taskEntity.hashCode());                         </span>
<span  style="">  83                                                                                                          </span>
<span class="-5681834850649759939" onmouseenter="enter('-5681834850649759939');" onmouseout="out('-5681834850649759939');" style="">  84     if (callback == null) {                                                                              </span>
<span class="-2247249715703717317" onmouseenter="enter('-2247249715703717317');" onmouseout="out('-2247249715703717317');" style="">  85       callback = new OnFileInfoCallback() {                                                              </span>
<span class="4970948900553010157" onmouseenter="enter('4970948900553010157');" onmouseout="out('4970948900553010157');" style="">  86         int failNum = 0;                                                                                 </span>
<span  style="">  87                                                                                                          </span>
<span class="-5145950279106892584" onmouseenter="enter('-5145950279106892584');" onmouseout="out('-5145950279106892584');" style="">  88         @Override public void onComplete(String url, int code) {                                         </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style="">  89           DownloadTaskEntity te = mExeMap.get(url);                                                      </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style="">  90           if (te != null) {                                                                              </span>
<span class="308930838644053042" onmouseenter="enter('308930838644053042');" onmouseout="out('308930838644053042');" style="">  91             mTotalSize += te.getEntity().getFileSize();                                                  </span>
<span class="-9118376655834637322" onmouseenter="enter('-9118376655834637322');" onmouseout="out('-9118376655834637322');" style="">  92             startChildDownload(te);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93           }                                                                                              </span>
<span class="-8520114986100534454" onmouseenter="enter('-8520114986100534454');" onmouseout="out('-8520114986100534454');" style="">  94           mInitNum++;                                                                                    </span>
<span class="-234450023538178691" onmouseenter="enter('-234450023538178691');" onmouseout="out('-234450023538178691');" style="">  95           if (mInitNum + mInitFailNum &gt;= mTaskEntity.getEntity().getSubTask().size()) {                  </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style="">  96             startRunningFlow();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97           }                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98         }                                                                                                </span>
<span  style="">  99                                                                                                          </span>
<span class="3522384484183979639" onmouseenter="enter('3522384484183979639');" onmouseout="out('3522384484183979639');" style=""> 100         @Override public void onFail(String url, String errorMsg) {                                      </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style=""> 101           DownloadTaskEntity te = mExeMap.get(url);                                                      </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style=""> 102           if (te != null) {                                                                              </span>
<span class="-3434538459014877633" onmouseenter="enter('-3434538459014877633');" onmouseout="out('-3434538459014877633');" style=""> 103             mFailMap.put(url, te);                                                                       </span>
<span class="8595174373746499082" onmouseenter="enter('8595174373746499082');" onmouseout="out('8595174373746499082');" style=""> 104             mFileInfoCallbacks.put(te.hashCode(), this);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105           }                                                                                              </span>
<span class="-3126918587586078524" onmouseenter="enter('-3126918587586078524');" onmouseout="out('-3126918587586078524');" style=""> 106           //404链接不重试下载                                                                                   </span>
<span class="-4716929270045128613" onmouseenter="enter('-4716929270045128613');" onmouseout="out('-4716929270045128613');" style=""> 107           if (failNum &lt; 10 &amp;&amp; !errorMsg.contains(&quot;错误码：404&quot;) &amp;&amp; !errorMsg.contains(                       </span>
<span class="5193671628245366377" onmouseenter="enter('5193671628245366377');" onmouseout="out('5193671628245366377');" style=""> 108               &quot;UnknownHostException&quot;)) {                                                                 </span>
<span class="-7158306797275734596" onmouseenter="enter('-7158306797275734596');" onmouseout="out('-7158306797275734596');" style=""> 109             mInfoPool.execute(createFileInfoThread(te));                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 110           } else {                                                                                       </span>
<span class="-2723952096500307408" onmouseenter="enter('-2723952096500307408');" onmouseout="out('-2723952096500307408');" style=""> 111             mInitFailNum++;                                                                              </span>
<span class="-1903130545068871575" onmouseenter="enter('-1903130545068871575');" onmouseout="out('-1903130545068871575');" style=""> 112             mActualTaskNum--;                                                                            </span>
<span class="-7251641660257607121" onmouseenter="enter('-7251641660257607121');" onmouseout="out('-7251641660257607121');" style=""> 113             if (mActualTaskNum &lt; 0) mActualTaskNum = 0;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114           }                                                                                              </span>
<span class="-4881470894519452809" onmouseenter="enter('-4881470894519452809');" onmouseout="out('-4881470894519452809');" style=""> 115           failNum++;                                                                                     </span>
<span class="-234450023538178691" onmouseenter="enter('-234450023538178691');" onmouseout="out('-234450023538178691');" style=""> 116           if (mInitNum + mInitFailNum &gt;= mTaskEntity.getEntity().getSubTask().size()) {                  </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style=""> 117             startRunningFlow();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118           }                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119         }                                                                                                </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 120       };                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121     }                                                                                                    </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 122 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-6395675362803657436" onmouseenter="enter('-6395675362803657436');" onmouseout="out('-6395675362803657436');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123     return new FileInfoThread(taskEntity, callback);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125                                                                                                          </span>
<span class="-9101626023155881186" onmouseenter="enter('-9101626023155881186');" onmouseout="out('-9101626023155881186');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126   private void closeTimer(boolean isRunning) {                                                           </span>
<span class="5231425380397002866" onmouseenter="enter('5231425380397002866');" onmouseout="out('5231425380397002866');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127     this.isRunning = isRunning;                                                                          </span>
<span class="-4343220603110256261" onmouseenter="enter('-4343220603110256261');" onmouseout="out('-4343220603110256261');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128     if (mTimer != null) {                                                                                </span>
<span class="6506490333649261220" onmouseenter="enter('6506490333649261220');" onmouseout="out('6506490333649261220');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129       mTimer.purge();                                                                                    </span>
<span class="3936422701741233911" onmouseenter="enter('3936422701741233911');" onmouseout="out('3936422701741233911');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130       mTimer.cancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 133                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 134   /**                                                                                                    </span>
<span class="-5673927707437898965" onmouseenter="enter('-5673927707437898965');" onmouseout="out('-5673927707437898965');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 135    * 开始进度流程                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 136    */                                                                                                    </span>
<span class="-8924856940436287042" onmouseenter="enter('-8924856940436287042');" onmouseout="out('-8924856940436287042');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 137   private void startRunningFlow() {                                                                      </span>
<span class="-4556811986576627418" onmouseenter="enter('-4556811986576627418');" onmouseout="out('-4556811986576627418');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 138     closeTimer(true);                                                                                    </span>
<span class="3412375698150633050" onmouseenter="enter('3412375698150633050');" onmouseout="out('3412375698150633050');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139     mListener.onPostPre(mTotalSize);                                                                     </span>
<span class="-6131324328119540818" onmouseenter="enter('-6131324328119540818');" onmouseout="out('-6131324328119540818');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140     mListener.onStart(mCurrentLocation);                                                                 </span>
<span class="9064905857115753880" onmouseenter="enter('9064905857115753880');" onmouseout="out('9064905857115753880');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141     mTimer = new Timer(true);                                                                            </span>
<span class="1767883212426599488" onmouseenter="enter('1767883212426599488');" onmouseout="out('1767883212426599488');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 142     mTimer.schedule(new TimerTask() {                                                                    </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 143       @Override public void run() {                                                                      </span>
<span class="-7587988653908595463" onmouseenter="enter('-7587988653908595463');" onmouseout="out('-7587988653908595463');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 144         if (!isRunning) {                                                                                </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 145           closeTimer(false);                                                                             </span>
<span class="-427374670960232487" onmouseenter="enter('-427374670960232487');" onmouseout="out('-427374670960232487');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146         } else if (mCurrentLocation &gt;= 0) {                                                              </span>
<span class="-778237943185100423" onmouseenter="enter('-778237943185100423');" onmouseout="out('-778237943185100423');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147           mListener.onProgress(mCurrentLocation);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 148         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 149       }                                                                                                  </span>
<span class="-7052623657160678735" onmouseenter="enter('-7052623657160678735');" onmouseout="out('-7052623657160678735');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 150     }, 0, 1000);                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 151   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 152                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 153   /**                                                                                                    </span>
<span class="-2915045833374537336" onmouseenter="enter('-2915045833374537336');" onmouseout="out('-2915045833374537336');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 154    * 启动子任务下载器                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 155    */                                                                                                    </span>
<span class="-4814508883416810996" onmouseenter="enter('-4814508883416810996');" onmouseout="out('-4814508883416810996');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 156   private void startChildDownload(DownloadTaskEntity taskEntity) {                                       </span>
<span class="-5214201566114754807" onmouseenter="enter('-5214201566114754807');" onmouseout="out('-5214201566114754807');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 157     ChildDownloadListener listener = new ChildDownloadListener(taskEntity);                              </span>
<span class="-7880859510389460827" onmouseenter="enter('-7880859510389460827');" onmouseout="out('-7880859510389460827');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 158     Downloader dt = new Downloader(listener, taskEntity);                                                </span>
<span class="-1715913392464468508" onmouseenter="enter('-1715913392464468508');" onmouseout="out('-1715913392464468508');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 159     mDownloaderMap.put(taskEntity.getEntity().getDownloadUrl(), dt);                                     </span>
<span class="-1714638633517896439" onmouseenter="enter('-1714638633517896439');" onmouseout="out('-1714638633517896439');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 160     if (mExePool.isShutdown()) return;                                                                   </span>
<span class="-268914413429947469" onmouseenter="enter('-268914413429947469');" onmouseout="out('-268914413429947469');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 161     mExePool.execute(dt);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 163                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 164   /**                                                                                                    </span>
<span class="6709099824921226015" onmouseenter="enter('6709099824921226015');" onmouseout="out('6709099824921226015');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 165    * 创建子任务下载信息                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166    */                                                                                                    </span>
<span class="2231847697649480847" onmouseenter="enter('2231847697649480847');" onmouseout="out('2231847697649480847');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 167   private DownloadTaskEntity createChildDownloadTask(DownloadEntity entity) {                            </span>
<span class="-5250283806161329316" onmouseenter="enter('-5250283806161329316');" onmouseout="out('-5250283806161329316');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 168     DownloadTaskEntity taskEntity = mTasksMap.get(entity.getDownloadUrl());                              </span>
<span class="2875409705898122648" onmouseenter="enter('2875409705898122648');" onmouseout="out('2875409705898122648');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 169     if (taskEntity != null) {                                                                            </span>
<span class="-6847855421842186847" onmouseenter="enter('-6847855421842186847');" onmouseout="out('-6847855421842186847');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170       taskEntity.entity = entity;                                                                        </span>
<span class="-9104005150390610221" onmouseenter="enter('-9104005150390610221');" onmouseout="out('-9104005150390610221');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 171       return taskEntity;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 172     }                                                                                                    </span>
<span class="-4885480137579962058" onmouseenter="enter('-4885480137579962058');" onmouseout="out('-4885480137579962058');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 173     taskEntity = new DownloadTaskEntity();                                                               </span>
<span class="-6847855421842186847" onmouseenter="enter('-6847855421842186847');" onmouseout="out('-6847855421842186847');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174     taskEntity.entity = entity;                                                                          </span>
<span class="-3732720384716012622" onmouseenter="enter('-3732720384716012622');" onmouseout="out('-3732720384716012622');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 175     taskEntity.headers = mTaskEntity.headers;                                                            </span>
<span class="-5768494270506887606" onmouseenter="enter('-5768494270506887606');" onmouseout="out('-5768494270506887606');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 176     taskEntity.requestEnum = mTaskEntity.requestEnum;                                                    </span>
<span class="6168081707298186636" onmouseenter="enter('6168081707298186636');" onmouseout="out('6168081707298186636');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 177     taskEntity.redirectUrlKey = mTaskEntity.redirectUrlKey;                                              </span>
<span class="3156827566400786541" onmouseenter="enter('3156827566400786541');" onmouseout="out('3156827566400786541');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 178     taskEntity.removeFile = mTaskEntity.removeFile;                                                      </span>
<span class="-1864665886871527246" onmouseenter="enter('-1864665886871527246');" onmouseout="out('-1864665886871527246');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 179     taskEntity.groupName = mTaskEntity.key;                                                              </span>
<span class="-5806686039329624679" onmouseenter="enter('-5806686039329624679');" onmouseout="out('-5806686039329624679');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 180     taskEntity.isGroupTask = true;                                                                       </span>
<span class="1590775701393149207" onmouseenter="enter('1590775701393149207');" onmouseout="out('1590775701393149207');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 181     taskEntity.key = entity.getDownloadPath();                                                           </span>
<span class="6178904090013830116" onmouseenter="enter('6178904090013830116');" onmouseout="out('6178904090013830116');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 182     taskEntity.save();                                                                                   </span>
<span class="-9104005150390610221" onmouseenter="enter('-9104005150390610221');" onmouseout="out('-9104005150390610221');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 183     return taskEntity;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 184   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 185                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 186   /**                                                                                                    </span>
<span class="7953531489350582006" onmouseenter="enter('7953531489350582006');" onmouseout="out('7953531489350582006');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 187    * 子任务事件监听                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 188    */                                                                                                    </span>
<span class="-3470753416804816360" onmouseenter="enter('-3470753416804816360');" onmouseout="out('-3470753416804816360');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 189   private class ChildDownloadListener implements IDownloadListener {                                     </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 190                                                                                                          </span>
<span class="1934457291382022470" onmouseenter="enter('1934457291382022470');" onmouseout="out('1934457291382022470');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 191     DownloadTaskEntity taskEntity;                                                                       </span>
<span class="-5258622463362253406" onmouseenter="enter('-5258622463362253406');" onmouseout="out('-5258622463362253406');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 192     DownloadEntity entity;                                                                               </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 193                                                                                                          </span>
<span class="5046313540994813291" onmouseenter="enter('5046313540994813291');" onmouseout="out('5046313540994813291');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 194     long lastLen = 0;                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 195                                                                                                          </span>
<span class="-4385074185507416044" onmouseenter="enter('-4385074185507416044');" onmouseout="out('-4385074185507416044');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 196     ChildDownloadListener(DownloadTaskEntity entity) {                                                   </span>
<span class="1703855892247108918" onmouseenter="enter('1703855892247108918');" onmouseout="out('1703855892247108918');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 197       this.taskEntity = entity;                                                                          </span>
<span class="-1050912213241719894" onmouseenter="enter('-1050912213241719894');" onmouseout="out('-1050912213241719894');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 198       this.entity = taskEntity.getEntity();                                                              </span>
<span class="6735191672939573635" onmouseenter="enter('6735191672939573635');" onmouseout="out('6735191672939573635');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 199       lastLen = this.entity.getCurrentProgress();                                                        </span>
<span class="4615984595129482352" onmouseenter="enter('4615984595129482352');" onmouseout="out('4615984595129482352');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 200       this.entity.setFailNum(0);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 201     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 202                                                                                                          </span>
<span class="1941248740392522719" onmouseenter="enter('1941248740392522719');" onmouseout="out('1941248740392522719');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 203     @Override public void onPre() {                                                                      </span>
<span class="1272045713932667636" onmouseenter="enter('1272045713932667636');" onmouseout="out('1272045713932667636');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 204       saveData(IEntity.STATE_PRE, -1);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 205     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 206                                                                                                          </span>
<span class="-6235441032293659444" onmouseenter="enter('-6235441032293659444');" onmouseout="out('-6235441032293659444');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 207     @Override public void onPostPre(long fileSize) {                                                     </span>
<span class="-8919115203469377593" onmouseenter="enter('-8919115203469377593');" onmouseout="out('-8919115203469377593');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 208       entity.setFileSize(fileSize);                                                                      </span>
<span class="-8129687735136084433" onmouseenter="enter('-8129687735136084433');" onmouseout="out('-8129687735136084433');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 209       entity.setConvertFileSize(CommonUtil.formatFileSize(fileSize));                                    </span>
<span class="-7950482897387591002" onmouseenter="enter('-7950482897387591002');" onmouseout="out('-7950482897387591002');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 210       saveData(IEntity.STATE_POST_PRE, -1);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 211     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 212                                                                                                          </span>
<span class="8211923352965833527" onmouseenter="enter('8211923352965833527');" onmouseout="out('8211923352965833527');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 213     @Override public void onResume(long resumeLocation) {                                                </span>
<span class="2291762294641027919" onmouseenter="enter('2291762294641027919');" onmouseout="out('2291762294641027919');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 214       saveData(IEntity.STATE_POST_PRE, IEntity.STATE_RUNNING);                                           </span>
<span class="8171258845364215777" onmouseenter="enter('8171258845364215777');" onmouseout="out('8171258845364215777');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 215       lastLen = resumeLocation;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 216     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 217                                                                                                          </span>
<span class="-3498891166253305351" onmouseenter="enter('-3498891166253305351');" onmouseout="out('-3498891166253305351');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 218     @Override public void onStart(long startLocation) {                                                  </span>
<span class="2291762294641027919" onmouseenter="enter('2291762294641027919');" onmouseout="out('2291762294641027919');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 219       saveData(IEntity.STATE_POST_PRE, IEntity.STATE_RUNNING);                                           </span>
<span class="-6451191897379263867" onmouseenter="enter('-6451191897379263867');" onmouseout="out('-6451191897379263867');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 220       lastLen = startLocation;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 221     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 222                                                                                                          </span>
<span class="-7946972766620409893" onmouseenter="enter('-7946972766620409893');" onmouseout="out('-7946972766620409893');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 223     @Override public void onProgress(long currentLocation) {                                             </span>
<span class="-6788340243894418006" onmouseenter="enter('-6788340243894418006');" onmouseout="out('-6788340243894418006');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 224       long speed = currentLocation - lastLen;                                                            </span>
<span class="-306662688114664893" onmouseenter="enter('-306662688114664893');" onmouseout="out('-306662688114664893');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 225       mCurrentLocation += speed;                                                                         </span>
<span class="-2754998682014897103" onmouseenter="enter('-2754998682014897103');" onmouseout="out('-2754998682014897103');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 226       lastLen = currentLocation;                                                                         </span>
<span class="-4238976656134225029" onmouseenter="enter('-4238976656134225029');" onmouseout="out('-4238976656134225029');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 227       entity.setCurrentProgress(currentLocation);                                                        </span>
<span class="3220981239855838635" onmouseenter="enter('3220981239855838635');" onmouseout="out('3220981239855838635');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 228       handleSpeed(speed);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 229     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 230                                                                                                          </span>
<span class="3409726051444324452" onmouseenter="enter('3409726051444324452');" onmouseout="out('3409726051444324452');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 231     @Override public void onStop(long stopLocation) {                                                    </span>
<span class="-1696356608019189548" onmouseenter="enter('-1696356608019189548');" onmouseout="out('-1696356608019189548');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 232       saveData(IEntity.STATE_STOP, stopLocation);                                                        </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 233       handleSpeed(0);                                                                                    </span>
<span class="-5925177778340562463" onmouseenter="enter('-5925177778340562463');" onmouseout="out('-5925177778340562463');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 234       mListener.onSubStop(entity);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 235     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 236                                                                                                          </span>
<span class="2093106455269248536" onmouseenter="enter('2093106455269248536');" onmouseout="out('2093106455269248536');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 237     @Override public void onCancel() {                                                                   </span>
<span class="-8209498279616463234" onmouseenter="enter('-8209498279616463234');" onmouseout="out('-8209498279616463234');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 238       saveData(IEntity.STATE_CANCEL, -1);                                                                </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 239       handleSpeed(0);                                                                                    </span>
<span class="-2639925523011962937" onmouseenter="enter('-2639925523011962937');" onmouseout="out('-2639925523011962937');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 240       mListener.onSubCancel(entity);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 241     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 242                                                                                                          </span>
<span class="7400813110786944810" onmouseenter="enter('7400813110786944810');" onmouseout="out('7400813110786944810');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 243     @Override public void onComplete() {                                                                 </span>
<span class="-4243478454233770036" onmouseenter="enter('-4243478454233770036');" onmouseout="out('-4243478454233770036');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 244       saveData(IEntity.STATE_COMPLETE, entity.getFileSize());                                            </span>
<span class="-1263526001176077168" onmouseenter="enter('-1263526001176077168');" onmouseout="out('-1263526001176077168');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 245       mCompleteNum++;                                                                                    </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 246       handleSpeed(0);                                                                                    </span>
<span class="-2907962166797260638" onmouseenter="enter('-2907962166797260638');" onmouseout="out('-2907962166797260638');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 247       mListener.onSubComplete(entity);                                                                   </span>
<span class="-6363872878771524946" onmouseenter="enter('-6363872878771524946');" onmouseout="out('-6363872878771524946');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 248       //如果子任务完成的数量和总任务数一致，表示任务组任务已经完成                                                                    </span>
<span class="7845605175596662348" onmouseenter="enter('7845605175596662348');" onmouseout="out('7845605175596662348');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 249       if (mCompleteNum &gt;= mTaskEntity.getEntity().getSubTask().size()) {                                 </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 250         closeTimer(false);                                                                               </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 251         mListener.onComplete();                                                                          </span>
<span class="3397040530661527737" onmouseenter="enter('3397040530661527737');" onmouseout="out('3397040530661527737');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 252       } else if (mCompleteNum + mFailNum &gt;= mActualTaskNum) {                                            </span>
<span class="-8854761308402599798" onmouseenter="enter('-8854761308402599798');" onmouseout="out('-8854761308402599798');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 253         //如果子任务完成数量加上失败的数量和总任务数一致，则任务组停止下载                                                               </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 254         closeTimer(false);                                                                               </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 255         mListener.onComplete();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 256       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 257     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 258                                                                                                          </span>
<span class="-8845666459040584461" onmouseenter="enter('-8845666459040584461');" onmouseout="out('-8845666459040584461');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 259     @Override public void onFail() {                                                                     </span>
<span class="-1614602823543137763" onmouseenter="enter('-1614602823543137763');" onmouseout="out('-1614602823543137763');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 260       entity.setFailNum(entity.getFailNum() + 1);                                                        </span>
<span class="9173216667172088818" onmouseenter="enter('9173216667172088818');" onmouseout="out('9173216667172088818');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 261       saveData(IEntity.STATE_FAIL, lastLen);                                                             </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 262       handleSpeed(0);                                                                                    </span>
<span class="2616907991847077571" onmouseenter="enter('2616907991847077571');" onmouseout="out('2616907991847077571');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 263       reTry();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 264     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 265                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 266     /**                                                                                                  </span>
<span class="9094883438601628482" onmouseenter="enter('9094883438601628482');" onmouseout="out('9094883438601628482');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 267      * 失败后重试下载，如果失败次数超过5次，不再重试                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 268      */                                                                                                  </span>
<span class="-6307491174755509331" onmouseenter="enter('-6307491174755509331');" onmouseout="out('-6307491174755509331');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 269     private void reTry() {                                                                               </span>
<span class="2413557230396081886" onmouseenter="enter('2413557230396081886');" onmouseout="out('2413557230396081886');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 270       if (entity.getFailNum() &lt; 5) {                                                                     </span>
<span class="3130304206991829788" onmouseenter="enter('3130304206991829788');" onmouseout="out('3130304206991829788');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 271         reStartTask();                                                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 272       } else {                                                                                           </span>
<span class="-4418339448232441007" onmouseenter="enter('-4418339448232441007');" onmouseout="out('-4418339448232441007');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 273         mFailNum++;                                                                                      </span>
<span class="-8499931761036179208" onmouseenter="enter('-8499931761036179208');" onmouseout="out('-8499931761036179208');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 274         mListener.onSubFail(entity);                                                                     </span>
<span class="-5088134094962551809" onmouseenter="enter('-5088134094962551809');" onmouseout="out('-5088134094962551809');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 275         //如果失败的任务数大于实际的下载任务数，任务组停止下载                                                                     </span>
<span class="-7579643381750577546" onmouseenter="enter('-7579643381750577546');" onmouseout="out('-7579643381750577546');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 276         if (mFailNum &gt;= mActualTaskNum) {                                                                </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 277           closeTimer(false);                                                                             </span>
<span class="5167771793225547847" onmouseenter="enter('5167771793225547847');" onmouseout="out('5167771793225547847');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 278           mListener.onStop(mCurrentLocation);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 279         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 280       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 281     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 282                                                                                                          </span>
<span class="-9166659205038143534" onmouseenter="enter('-9166659205038143534');" onmouseout="out('-9166659205038143534');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 283     private void reStartTask() {                                                                         </span>
<span class="694224692856620004" onmouseenter="enter('694224692856620004');" onmouseout="out('694224692856620004');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 284       Timer timer = new Timer();                                                                         </span>
<span class="-3995857028562557665" onmouseenter="enter('-3995857028562557665');" onmouseout="out('-3995857028562557665');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 285       timer.schedule(new TimerTask() {                                                                   </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 286         @Override public void run() {                                                                    </span>
<span class="-915554303021644808" onmouseenter="enter('-915554303021644808');" onmouseout="out('-915554303021644808');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 287           Downloader dt = mDownloaderMap.get(entity.getDownloadUrl());                                   </span>
<span class="8054045842810821752" onmouseenter="enter('8054045842810821752');" onmouseout="out('8054045842810821752');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 288           dt.startDownload();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 289         }                                                                                                </span>
<span class="1359862179938126399" onmouseenter="enter('1359862179938126399');" onmouseout="out('1359862179938126399');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 290       }, 3000);                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 291     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 292                                                                                                          </span>
<span class="7889271447688685611" onmouseenter="enter('7889271447688685611');" onmouseout="out('7889271447688685611');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 293     private void handleSpeed(long speed) {                                                               </span>
<span class="-8903176931212217262" onmouseenter="enter('-8903176931212217262');" onmouseout="out('-8903176931212217262');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 294       entity.setSpeed(speed);                                                                            </span>
<span class="-458871634303822896" onmouseenter="enter('-458871634303822896');" onmouseout="out('-458871634303822896');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 295       entity.setConvertSpeed(speed &lt;= 0 ? &quot;&quot; : CommonUtil.formatFileSize(speed) + &quot;/s&quot;);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 296     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 297                                                                                                          </span>
<span class="-8417795030437306969" onmouseenter="enter('-8417795030437306969');" onmouseout="out('-8417795030437306969');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 298     private void saveData(int state, long location) {                                                    </span>
<span class="1870432086074469274" onmouseenter="enter('1870432086074469274');" onmouseout="out('1870432086074469274');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 299       entity.setState(state);                                                                            </span>
<span class="5476417475415693432" onmouseenter="enter('5476417475415693432');" onmouseout="out('5476417475415693432');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 300       entity.setComplete(state == IEntity.STATE_COMPLETE);                                               </span>
<span class="-1375586946810284641" onmouseenter="enter('-1375586946810284641');" onmouseout="out('-1375586946810284641');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 301       if (entity.isComplete()) {                                                                         </span>
<span class="7860072371622563794" onmouseenter="enter('7860072371622563794');" onmouseout="out('7860072371622563794');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 302         entity.setCompleteTime(System.currentTimeMillis());                                              </span>
<span class="-417755752443399839" onmouseenter="enter('-417755752443399839');" onmouseout="out('-417755752443399839');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 303         entity.setCurrentProgress(entity.getFileSize());                                                 </span>
<span class="-4932930723349285601" onmouseenter="enter('-4932930723349285601');" onmouseout="out('-4932930723349285601');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 304       } else if (location &gt; 0) {                                                                         </span>
<span class="8919645422588846117" onmouseenter="enter('8919645422588846117');" onmouseout="out('8919645422588846117');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 305         entity.setCurrentProgress(location);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 306       }                                                                                                  </span>
<span class="-733466174510760140" onmouseenter="enter('-733466174510760140');" onmouseout="out('-733466174510760140');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 307       entity.update();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 308     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 309                                                                                                          </span>
<span class="-4067662255690266791" onmouseenter="enter('-4067662255690266791');" onmouseout="out('-4067662255690266791');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 310     @Override public void supportBreakpoint(boolean support) {                                           </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 311                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 312     }                                                                                                    </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 313 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="1524502011970861445" onmouseenter="enter('1524502011970861445');" onmouseout="out('1524502011970861445');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314     return mCurrentLocation;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316                                                                                                          </span>
<span class="8514823861416132786" onmouseenter="enter('8514823861416132786');" onmouseout="out('8514823861416132786');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 317   @Override public boolean isDownloading() {                                                             </span>
<span class="9152024351919709179" onmouseenter="enter('9152024351919709179');" onmouseout="out('9152024351919709179');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 318     return isRunning;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 319   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 320                                                                                                          </span>
<span class="8518544268347342740" onmouseenter="enter('8518544268347342740');" onmouseout="out('8518544268347342740');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 321   @Override public void cancelDownload() {                                                               </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 322     closeTimer(false);                                                                                   </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 323     mListener.onCancel();                                                                                </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 324     if (!mInfoPool.isShutdown()) {                                                                       </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 325       mInfoPool.shutdown();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 326     }                                                                                                    </span>
<span class="-566362124535735919" onmouseenter="enter('-566362124535735919');" onmouseout="out('-566362124535735919');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 327     if (!mExePool.isShutdown()) {                                                                        </span>
<span class="-9028679909484630999" onmouseenter="enter('-9028679909484630999');" onmouseout="out('-9028679909484630999');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 328       mExePool.shutdown();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 329     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 330                                                                                                          </span>
<span class="-121865910349791330" onmouseenter="enter('-121865910349791330');" onmouseout="out('-121865910349791330');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331     Set&lt;String&gt; keys = mDownloaderMap.keySet();                                                          </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332     for (String key : keys) {                                                                            </span>
<span class="4674592448761410649" onmouseenter="enter('4674592448761410649');" onmouseout="out('4674592448761410649');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333       Downloader dt = mDownloaderMap.get(key);                                                           </span>
<span class="4002339207918379493" onmouseenter="enter('4002339207918379493');" onmouseout="out('4002339207918379493');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334       if (dt != null) {                                                                                  </span>
<span class="-6177430030980743439" onmouseenter="enter('-6177430030980743439');" onmouseout="out('-6177430030980743439');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335         dt.cancelDownload();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337     }                                                                                                    </span>
<span class="-6812949802078178976" onmouseenter="enter('-6812949802078178976');" onmouseout="out('-6812949802078178976');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338     delDownloadInfo();                                                                                   </span>
<span class="3736236151466185350" onmouseenter="enter('3736236151466185350');" onmouseout="out('3736236151466185350');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339     mTaskEntity.deleteData();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342   /**                                                                                                    </span>
<span class="2811324672140469110" onmouseenter="enter('2811324672140469110');" onmouseout="out('2811324672140469110');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343    * 删除所有子任务的下载信息                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344    */                                                                                                    </span>
<span class="-7852351063311107832" onmouseenter="enter('-7852351063311107832');" onmouseout="out('-7852351063311107832');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345   private void delDownloadInfo() {                                                                       </span>
<span class="4623479770740533496" onmouseenter="enter('4623479770740533496');" onmouseout="out('4623479770740533496');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346     List&lt;DownloadTaskEntity&gt; tasks =                                                                     </span>
<span class="4222418289028627286" onmouseenter="enter('4222418289028627286');" onmouseout="out('4222418289028627286');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 347         DbEntity.findDatas(DownloadTaskEntity.class, &quot;groupName=?&quot;, mTaskEntity.key);                    </span>
<span class="-7059273340673847542" onmouseenter="enter('-7059273340673847542');" onmouseout="out('-7059273340673847542');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348     if (tasks == null || tasks.isEmpty()) return;                                                        </span>
<span class="-573879738747794463" onmouseenter="enter('-573879738747794463');" onmouseout="out('-573879738747794463');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349     for (DownloadTaskEntity taskEntity : tasks) {                                                        </span>
<span class="461901582083120312" onmouseenter="enter('461901582083120312');" onmouseout="out('461901582083120312');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350       CommonUtil.delDownloadTaskConfig(taskEntity.removeFile, taskEntity);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 353                                                                                                          </span>
<span class="-4596234023078912379" onmouseenter="enter('-4596234023078912379');" onmouseout="out('-4596234023078912379');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 354   @Override public void stopDownload() {                                                                 </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 355     closeTimer(false);                                                                                   </span>
<span class="5167771793225547847" onmouseenter="enter('5167771793225547847');" onmouseout="out('5167771793225547847');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 356     mListener.onStop(mCurrentLocation);                                                                  </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 357     if (!mInfoPool.isShutdown()) {                                                                       </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 358       mInfoPool.shutdown();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 359     }                                                                                                    </span>
<span class="-566362124535735919" onmouseenter="enter('-566362124535735919');" onmouseout="out('-566362124535735919');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 360     if (!mExePool.isShutdown()) {                                                                        </span>
<span class="-9028679909484630999" onmouseenter="enter('-9028679909484630999');" onmouseout="out('-9028679909484630999');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 361       mExePool.shutdown();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 362     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 363                                                                                                          </span>
<span class="-121865910349791330" onmouseenter="enter('-121865910349791330');" onmouseout="out('-121865910349791330');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 364     Set&lt;String&gt; keys = mDownloaderMap.keySet();                                                          </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 365     for (String key : keys) {                                                                            </span>
<span class="4674592448761410649" onmouseenter="enter('4674592448761410649');" onmouseout="out('4674592448761410649');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 366       Downloader dt = mDownloaderMap.get(key);                                                           </span>
<span class="4002339207918379493" onmouseenter="enter('4002339207918379493');" onmouseout="out('4002339207918379493');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 367       if (dt != null) {                                                                                  </span>
<span class="3167682315717751579" onmouseenter="enter('3167682315717751579');" onmouseout="out('3167682315717751579');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 368         dt.stopDownload();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 369       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 370     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 371   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 372                                                                                                          </span>
<span class="-4856178778199245062" onmouseenter="enter('-4856178778199245062');" onmouseout="out('-4856178778199245062');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 373   @Override public void startDownload() {                                                                </span>
<span class="720656867499890795" onmouseenter="enter('720656867499890795');" onmouseout="out('720656867499890795');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 374     isRunning = true;                                                                                    </span>
<span class="-4263343811101375569" onmouseenter="enter('-4263343811101375569');" onmouseout="out('-4263343811101375569');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 375     mFailNum = 0;                                                                                        </span>
<span class="4774762395313474868" onmouseenter="enter('4774762395313474868');" onmouseout="out('4774762395313474868');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 376     Set&lt;String&gt; keys = mExeMap.keySet();                                                                 </span>
<span class="2099174989180368882" onmouseenter="enter('2099174989180368882');" onmouseout="out('2099174989180368882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 377     mListener.onPre();                                                                                   </span>
<span class="-8629982182851448523" onmouseenter="enter('-8629982182851448523');" onmouseout="out('-8629982182851448523');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 378     int i = 0;                                                                                           </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 379     for (String key : keys) {                                                                            </span>
<span class="221423537684250497" onmouseenter="enter('221423537684250497');" onmouseout="out('221423537684250497');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 380       DownloadTaskEntity taskEntity = mExeMap.get(key);                                                  </span>
<span class="2875409705898122648" onmouseenter="enter('2875409705898122648');" onmouseout="out('2875409705898122648');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 381       if (taskEntity != null) {                                                                          </span>
<span class="3825460913713262848" onmouseenter="enter('3825460913713262848');" onmouseout="out('3825460913713262848');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 382         if (taskEntity.getState() != IEntity.STATE_FAIL                                                  </span>
<span class="4045344078755509632" onmouseenter="enter('4045344078755509632');" onmouseout="out('4045344078755509632');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 383             &amp;&amp; taskEntity.getState() != IEntity.STATE_WAIT) {                                            </span>
<span class="6449066979252177845" onmouseenter="enter('6449066979252177845');" onmouseout="out('6449066979252177845');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 384           startChildDownload(taskEntity);                                                                </span>
<span class="-4968746635634186778" onmouseenter="enter('-4968746635634186778');" onmouseout="out('-4968746635634186778');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 385           i++;                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 386         } else {                                                                                         </span>
<span class="4135184626453358547" onmouseenter="enter('4135184626453358547');" onmouseout="out('4135184626453358547');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 387           mInfoPool.execute(createFileInfoThread(taskEntity));                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 388         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 389       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 390     }                                                                                                    </span>
<span class="-8434084337306400756" onmouseenter="enter('-8434084337306400756');" onmouseout="out('-8434084337306400756');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 391     if (i == mExeMap.size()) startRunningFlow();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 392   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 393                                                                                                          </span>
<span class="-5762688668558425600" onmouseenter="enter('-5762688668558425600');" onmouseout="out('-5762688668558425600');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 394   @Override public void resumeDownload() {                                                               </span>
<span class="1497820413888703615" onmouseenter="enter('1497820413888703615');" onmouseout="out('1497820413888703615');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 395     startDownload();                                                                                     </span>
<span class="2432525506665579835" onmouseenter="enter('2432525506665579835');" onmouseout="out('2432525506665579835');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 396     mListener.onResume(mCurrentLocation);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 397   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 398                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 399   /**                                                                                                    </span>
<span class="-4547374311767626615" onmouseenter="enter('-4547374311767626615');" onmouseout="out('-4547374311767626615');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 400    * 创建文件信息获取线程                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 401    */                                                                                                    </span>
<span class="3938287834207978655" onmouseenter="enter('3938287834207978655');" onmouseout="out('3938287834207978655');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 402   private FileInfoThread createFileInfoThread(DownloadTaskEntity taskEntity) {                           </span>
<span class="-3840222843651584707" onmouseenter="enter('-3840222843651584707');" onmouseout="out('-3840222843651584707');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 403     FileInfoThread.OnFileInfoCallback callback = mFileInfoCallbacks.get(taskEntity.hashCode());          </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 404                                                                                                          </span>
<span class="-5681834850649759939" onmouseenter="enter('-5681834850649759939');" onmouseout="out('-5681834850649759939');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 405     if (callback == null) {                                                                              </span>
<span class="5413682592871947948" onmouseenter="enter('5413682592871947948');" onmouseout="out('5413682592871947948');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 406       callback = new FileInfoThread.OnFileInfoCallback() {                                               </span>
<span class="4970948900553010157" onmouseenter="enter('4970948900553010157');" onmouseout="out('4970948900553010157');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 407         int failNum = 0;                                                                                 </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 408                                                                                                          </span>
<span class="-5145950279106892584" onmouseenter="enter('-5145950279106892584');" onmouseout="out('-5145950279106892584');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 409         @Override public void onComplete(String url, int code) {                                         </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 410           DownloadTaskEntity te = mExeMap.get(url);                                                      </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 411           if (te != null) {                                                                              </span>
<span class="308930838644053042" onmouseenter="enter('308930838644053042');" onmouseout="out('308930838644053042');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 412             mTotalSize += te.getEntity().getFileSize();                                                  </span>
<span class="-9118376655834637322" onmouseenter="enter('-9118376655834637322');" onmouseout="out('-9118376655834637322');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 413             startChildDownload(te);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 414           }                                                                                              </span>
<span class="-8520114986100534454" onmouseenter="enter('-8520114986100534454');" onmouseout="out('-8520114986100534454');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 415           mInitNum++;                                                                                    </span>
<span class="-234450023538178691" onmouseenter="enter('-234450023538178691');" onmouseout="out('-234450023538178691');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 416           if (mInitNum + mInitFailNum &gt;= mTaskEntity.getEntity().getSubTask().size()) {                  </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 417             startRunningFlow();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 418           }                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 419         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 420                                                                                                          </span>
<span class="3522384484183979639" onmouseenter="enter('3522384484183979639');" onmouseout="out('3522384484183979639');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 421         @Override public void onFail(String url, String errorMsg) {                                      </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 422           DownloadTaskEntity te = mExeMap.get(url);                                                      </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 423           if (te != null) {                                                                              </span>
<span class="-3434538459014877633" onmouseenter="enter('-3434538459014877633');" onmouseout="out('-3434538459014877633');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 424             mFailMap.put(url, te);                                                                       </span>
<span class="8595174373746499082" onmouseenter="enter('8595174373746499082');" onmouseout="out('8595174373746499082');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 425             mFileInfoCallbacks.put(te.hashCode(), this);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 426           }                                                                                              </span>
<span class="-3126918587586078524" onmouseenter="enter('-3126918587586078524');" onmouseout="out('-3126918587586078524');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 427           //404链接不重试下载                                                                                   </span>
<span class="-4716929270045128613" onmouseenter="enter('-4716929270045128613');" onmouseout="out('-4716929270045128613');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 428           if (failNum &lt; 10 &amp;&amp; !errorMsg.contains(&quot;错误码：404&quot;) &amp;&amp; !errorMsg.contains(                       </span>
<span class="5193671628245366377" onmouseenter="enter('5193671628245366377');" onmouseout="out('5193671628245366377');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 429               &quot;UnknownHostException&quot;)) {                                                                 </span>
<span class="-7158306797275734596" onmouseenter="enter('-7158306797275734596');" onmouseout="out('-7158306797275734596');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 430             mInfoPool.execute(createFileInfoThread(te));                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 431           } else {                                                                                       </span>
<span class="-2723952096500307408" onmouseenter="enter('-2723952096500307408');" onmouseout="out('-2723952096500307408');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 432             mInitFailNum++;                                                                              </span>
<span class="-1903130545068871575" onmouseenter="enter('-1903130545068871575');" onmouseout="out('-1903130545068871575');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 433             mActualTaskNum--;                                                                            </span>
<span class="-7251641660257607121" onmouseenter="enter('-7251641660257607121');" onmouseout="out('-7251641660257607121');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 434             if (mActualTaskNum &lt; 0) mActualTaskNum = 0;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 435           }                                                                                              </span>
<span class="-4881470894519452809" onmouseenter="enter('-4881470894519452809');" onmouseout="out('-4881470894519452809');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 436           failNum++;                                                                                     </span>
<span class="-234450023538178691" onmouseenter="enter('-234450023538178691');" onmouseout="out('-234450023538178691');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 437           if (mInitNum + mInitFailNum &gt;= mTaskEntity.getEntity().getSubTask().size()) {                  </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 438             startRunningFlow();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 439           }                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 440         }                                                                                                </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 441       };                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 442     }                                                                                                    </span>
<span class="-6395675362803657436" onmouseenter="enter('-6395675362803657436');" onmouseout="out('-6395675362803657436');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 443     return new FileInfoThread(taskEntity, callback);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 444   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 445                                                                                                          </span>
<span class="-9101626023155881186" onmouseenter="enter('-9101626023155881186');" onmouseout="out('-9101626023155881186');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 446   private void closeTimer(boolean isRunning) {                                                           </span>
<span class="5231425380397002866" onmouseenter="enter('5231425380397002866');" onmouseout="out('5231425380397002866');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 447     this.isRunning = isRunning;                                                                          </span>
<span class="-4343220603110256261" onmouseenter="enter('-4343220603110256261');" onmouseout="out('-4343220603110256261');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 448     if (mTimer != null) {                                                                                </span>
<span class="6506490333649261220" onmouseenter="enter('6506490333649261220');" onmouseout="out('6506490333649261220');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 449       mTimer.purge();                                                                                    </span>
<span class="3936422701741233911" onmouseenter="enter('3936422701741233911');" onmouseout="out('3936422701741233911');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 450       mTimer.cancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 451     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 452   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 453                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 454   /**                                                                                                    </span>
<span class="-5673927707437898965" onmouseenter="enter('-5673927707437898965');" onmouseout="out('-5673927707437898965');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 455    * 开始进度流程                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 456    */                                                                                                    </span>
<span class="-8924856940436287042" onmouseenter="enter('-8924856940436287042');" onmouseout="out('-8924856940436287042');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 457   private void startRunningFlow() {                                                                      </span>
<span class="-4556811986576627418" onmouseenter="enter('-4556811986576627418');" onmouseout="out('-4556811986576627418');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 458     closeTimer(true);                                                                                    </span>
<span class="3412375698150633050" onmouseenter="enter('3412375698150633050');" onmouseout="out('3412375698150633050');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 459     mListener.onPostPre(mTotalSize);                                                                     </span>
<span class="-6131324328119540818" onmouseenter="enter('-6131324328119540818');" onmouseout="out('-6131324328119540818');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 460     mListener.onStart(mCurrentLocation);                                                                 </span>
<span class="9064905857115753880" onmouseenter="enter('9064905857115753880');" onmouseout="out('9064905857115753880');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 461     mTimer = new Timer(true);                                                                            </span>
<span class="1767883212426599488" onmouseenter="enter('1767883212426599488');" onmouseout="out('1767883212426599488');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 462     mTimer.schedule(new TimerTask() {                                                                    </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 463       @Override public void run() {                                                                      </span>
<span class="-7587988653908595463" onmouseenter="enter('-7587988653908595463');" onmouseout="out('-7587988653908595463');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 464         if (!isRunning) {                                                                                </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 465           closeTimer(false);                                                                             </span>
<span class="-427374670960232487" onmouseenter="enter('-427374670960232487');" onmouseout="out('-427374670960232487');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 466         } else if (mCurrentLocation &gt;= 0) {                                                              </span>
<span class="-778237943185100423" onmouseenter="enter('-778237943185100423');" onmouseout="out('-778237943185100423');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 467           mListener.onProgress(mCurrentLocation);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 468         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 469       }                                                                                                  </span>
<span class="-7052623657160678735" onmouseenter="enter('-7052623657160678735');" onmouseout="out('-7052623657160678735');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 470     }, 0, 1000);                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 471   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 472                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 473   /**                                                                                                    </span>
<span class="-2915045833374537336" onmouseenter="enter('-2915045833374537336');" onmouseout="out('-2915045833374537336');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 474    * 启动子任务下载器                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 475    */                                                                                                    </span>
<span class="-4814508883416810996" onmouseenter="enter('-4814508883416810996');" onmouseout="out('-4814508883416810996');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 476   private void startChildDownload(DownloadTaskEntity taskEntity) {                                       </span>
<span class="-5214201566114754807" onmouseenter="enter('-5214201566114754807');" onmouseout="out('-5214201566114754807');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 477     ChildDownloadListener listener = new ChildDownloadListener(taskEntity);                              </span>
<span class="-7880859510389460827" onmouseenter="enter('-7880859510389460827');" onmouseout="out('-7880859510389460827');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 478     Downloader dt = new Downloader(listener, taskEntity);                                                </span>
<span class="-1715913392464468508" onmouseenter="enter('-1715913392464468508');" onmouseout="out('-1715913392464468508');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 479     mDownloaderMap.put(taskEntity.getEntity().getDownloadUrl(), dt);                                     </span>
<span class="-1714638633517896439" onmouseenter="enter('-1714638633517896439');" onmouseout="out('-1714638633517896439');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 480     if (mExePool.isShutdown()) return;                                                                   </span>
<span class="-268914413429947469" onmouseenter="enter('-268914413429947469');" onmouseout="out('-268914413429947469');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 481     mExePool.execute(dt);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 482   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 483                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 484   /**                                                                                                    </span>
<span class="6709099824921226015" onmouseenter="enter('6709099824921226015');" onmouseout="out('6709099824921226015');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 485    * 创建子任务下载信息                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 486    */                                                                                                    </span>
<span class="2231847697649480847" onmouseenter="enter('2231847697649480847');" onmouseout="out('2231847697649480847');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 487   private DownloadTaskEntity createChildDownloadTask(DownloadEntity entity) {                            </span>
<span class="-5250283806161329316" onmouseenter="enter('-5250283806161329316');" onmouseout="out('-5250283806161329316');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 488     DownloadTaskEntity taskEntity = mTasksMap.get(entity.getDownloadUrl());                              </span>
<span class="2875409705898122648" onmouseenter="enter('2875409705898122648');" onmouseout="out('2875409705898122648');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 489     if (taskEntity != null) {                                                                            </span>
<span class="-6847855421842186847" onmouseenter="enter('-6847855421842186847');" onmouseout="out('-6847855421842186847');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 490       taskEntity.entity = entity;                                                                        </span>
<span class="-9104005150390610221" onmouseenter="enter('-9104005150390610221');" onmouseout="out('-9104005150390610221');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 491       return taskEntity;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 492     }                                                                                                    </span>
<span class="-4885480137579962058" onmouseenter="enter('-4885480137579962058');" onmouseout="out('-4885480137579962058');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 493     taskEntity = new DownloadTaskEntity();                                                               </span>
<span class="-6847855421842186847" onmouseenter="enter('-6847855421842186847');" onmouseout="out('-6847855421842186847');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 494     taskEntity.entity = entity;                                                                          </span>
<span class="-3732720384716012622" onmouseenter="enter('-3732720384716012622');" onmouseout="out('-3732720384716012622');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 495     taskEntity.headers = mTaskEntity.headers;                                                            </span>
<span class="-5768494270506887606" onmouseenter="enter('-5768494270506887606');" onmouseout="out('-5768494270506887606');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 496     taskEntity.requestEnum = mTaskEntity.requestEnum;                                                    </span>
<span class="6168081707298186636" onmouseenter="enter('6168081707298186636');" onmouseout="out('6168081707298186636');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 497     taskEntity.redirectUrlKey = mTaskEntity.redirectUrlKey;                                              </span>
<span class="3156827566400786541" onmouseenter="enter('3156827566400786541');" onmouseout="out('3156827566400786541');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 498     taskEntity.removeFile = mTaskEntity.removeFile;                                                      </span>
<span class="-1864665886871527246" onmouseenter="enter('-1864665886871527246');" onmouseout="out('-1864665886871527246');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 499     taskEntity.groupName = mTaskEntity.key;                                                              </span>
<span class="-5806686039329624679" onmouseenter="enter('-5806686039329624679');" onmouseout="out('-5806686039329624679');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 500     taskEntity.isGroupTask = true;                                                                       </span>
<span class="1590775701393149207" onmouseenter="enter('1590775701393149207');" onmouseout="out('1590775701393149207');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 501     taskEntity.key = entity.getDownloadPath();                                                           </span>
<span class="6178904090013830116" onmouseenter="enter('6178904090013830116');" onmouseout="out('6178904090013830116');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 502     taskEntity.save();                                                                                   </span>
<span class="-9104005150390610221" onmouseenter="enter('-9104005150390610221');" onmouseout="out('-9104005150390610221');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 503     return taskEntity;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 504   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 505                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 506   /**                                                                                                    </span>
<span class="7953531489350582006" onmouseenter="enter('7953531489350582006');" onmouseout="out('7953531489350582006');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 507    * 子任务事件监听                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 508    */                                                                                                    </span>
<span class="-3470753416804816360" onmouseenter="enter('-3470753416804816360');" onmouseout="out('-3470753416804816360');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 509   private class ChildDownloadListener implements IDownloadListener {                                     </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 510                                                                                                          </span>
<span class="1934457291382022470" onmouseenter="enter('1934457291382022470');" onmouseout="out('1934457291382022470');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 511     DownloadTaskEntity taskEntity;                                                                       </span>
<span class="-5258622463362253406" onmouseenter="enter('-5258622463362253406');" onmouseout="out('-5258622463362253406');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 512     DownloadEntity entity;                                                                               </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 513                                                                                                          </span>
<span class="5046313540994813291" onmouseenter="enter('5046313540994813291');" onmouseout="out('5046313540994813291');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 514     long lastLen = 0;                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 515                                                                                                          </span>
<span class="-4385074185507416044" onmouseenter="enter('-4385074185507416044');" onmouseout="out('-4385074185507416044');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 516     ChildDownloadListener(DownloadTaskEntity entity) {                                                   </span>
<span class="1703855892247108918" onmouseenter="enter('1703855892247108918');" onmouseout="out('1703855892247108918');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 517       this.taskEntity = entity;                                                                          </span>
<span class="-1050912213241719894" onmouseenter="enter('-1050912213241719894');" onmouseout="out('-1050912213241719894');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 518       this.entity = taskEntity.getEntity();                                                              </span>
<span class="6735191672939573635" onmouseenter="enter('6735191672939573635');" onmouseout="out('6735191672939573635');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 519       lastLen = this.entity.getCurrentProgress();                                                        </span>
<span class="4615984595129482352" onmouseenter="enter('4615984595129482352');" onmouseout="out('4615984595129482352');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 520       this.entity.setFailNum(0);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 521     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 522                                                                                                          </span>
<span class="1941248740392522719" onmouseenter="enter('1941248740392522719');" onmouseout="out('1941248740392522719');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 523     @Override public void onPre() {                                                                      </span>
<span class="1272045713932667636" onmouseenter="enter('1272045713932667636');" onmouseout="out('1272045713932667636');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 524       saveData(IEntity.STATE_PRE, -1);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 525     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 526                                                                                                          </span>
<span class="-6235441032293659444" onmouseenter="enter('-6235441032293659444');" onmouseout="out('-6235441032293659444');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 527     @Override public void onPostPre(long fileSize) {                                                     </span>
<span class="-8919115203469377593" onmouseenter="enter('-8919115203469377593');" onmouseout="out('-8919115203469377593');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 528       entity.setFileSize(fileSize);                                                                      </span>
<span class="-8129687735136084433" onmouseenter="enter('-8129687735136084433');" onmouseout="out('-8129687735136084433');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 529       entity.setConvertFileSize(CommonUtil.formatFileSize(fileSize));                                    </span>
<span class="-7950482897387591002" onmouseenter="enter('-7950482897387591002');" onmouseout="out('-7950482897387591002');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 530       saveData(IEntity.STATE_POST_PRE, -1);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 531     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 532                                                                                                          </span>
<span class="8211923352965833527" onmouseenter="enter('8211923352965833527');" onmouseout="out('8211923352965833527');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 533     @Override public void onResume(long resumeLocation) {                                                </span>
<span class="2291762294641027919" onmouseenter="enter('2291762294641027919');" onmouseout="out('2291762294641027919');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 534       saveData(IEntity.STATE_POST_PRE, IEntity.STATE_RUNNING);                                           </span>
<span class="8171258845364215777" onmouseenter="enter('8171258845364215777');" onmouseout="out('8171258845364215777');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 535       lastLen = resumeLocation;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 536     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 537                                                                                                          </span>
<span class="-3498891166253305351" onmouseenter="enter('-3498891166253305351');" onmouseout="out('-3498891166253305351');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 538     @Override public void onStart(long startLocation) {                                                  </span>
<span class="2291762294641027919" onmouseenter="enter('2291762294641027919');" onmouseout="out('2291762294641027919');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 539       saveData(IEntity.STATE_POST_PRE, IEntity.STATE_RUNNING);                                           </span>
<span class="-6451191897379263867" onmouseenter="enter('-6451191897379263867');" onmouseout="out('-6451191897379263867');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 540       lastLen = startLocation;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 541     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 542                                                                                                          </span>
<span class="-7946972766620409893" onmouseenter="enter('-7946972766620409893');" onmouseout="out('-7946972766620409893');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 543     @Override public void onProgress(long currentLocation) {                                             </span>
<span class="-6788340243894418006" onmouseenter="enter('-6788340243894418006');" onmouseout="out('-6788340243894418006');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 544       long speed = currentLocation - lastLen;                                                            </span>
<span class="-306662688114664893" onmouseenter="enter('-306662688114664893');" onmouseout="out('-306662688114664893');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 545       mCurrentLocation += speed;                                                                         </span>
<span class="-2754998682014897103" onmouseenter="enter('-2754998682014897103');" onmouseout="out('-2754998682014897103');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 546       lastLen = currentLocation;                                                                         </span>
<span class="-4238976656134225029" onmouseenter="enter('-4238976656134225029');" onmouseout="out('-4238976656134225029');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 547       entity.setCurrentProgress(currentLocation);                                                        </span>
<span class="3220981239855838635" onmouseenter="enter('3220981239855838635');" onmouseout="out('3220981239855838635');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 548       handleSpeed(speed);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 549     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 550                                                                                                          </span>
<span class="3409726051444324452" onmouseenter="enter('3409726051444324452');" onmouseout="out('3409726051444324452');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 551     @Override public void onStop(long stopLocation) {                                                    </span>
<span class="-1696356608019189548" onmouseenter="enter('-1696356608019189548');" onmouseout="out('-1696356608019189548');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 552       saveData(IEntity.STATE_STOP, stopLocation);                                                        </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 553       handleSpeed(0);                                                                                    </span>
<span class="-5925177778340562463" onmouseenter="enter('-5925177778340562463');" onmouseout="out('-5925177778340562463');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 554       mListener.onSubStop(entity);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 555     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 556                                                                                                          </span>
<span class="2093106455269248536" onmouseenter="enter('2093106455269248536');" onmouseout="out('2093106455269248536');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 557     @Override public void onCancel() {                                                                   </span>
<span class="-8209498279616463234" onmouseenter="enter('-8209498279616463234');" onmouseout="out('-8209498279616463234');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 558       saveData(IEntity.STATE_CANCEL, -1);                                                                </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 559       handleSpeed(0);                                                                                    </span>
<span class="-2639925523011962937" onmouseenter="enter('-2639925523011962937');" onmouseout="out('-2639925523011962937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 560       mListener.onSubCancel(entity);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 561     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 562                                                                                                          </span>
<span class="7400813110786944810" onmouseenter="enter('7400813110786944810');" onmouseout="out('7400813110786944810');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 563     @Override public void onComplete() {                                                                 </span>
<span class="-4243478454233770036" onmouseenter="enter('-4243478454233770036');" onmouseout="out('-4243478454233770036');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 564       saveData(IEntity.STATE_COMPLETE, entity.getFileSize());                                            </span>
<span class="-1263526001176077168" onmouseenter="enter('-1263526001176077168');" onmouseout="out('-1263526001176077168');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 565       mCompleteNum++;                                                                                    </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 566       handleSpeed(0);                                                                                    </span>
<span class="-2907962166797260638" onmouseenter="enter('-2907962166797260638');" onmouseout="out('-2907962166797260638');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 567       mListener.onSubComplete(entity);                                                                   </span>
<span class="-6363872878771524946" onmouseenter="enter('-6363872878771524946');" onmouseout="out('-6363872878771524946');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 568       //如果子任务完成的数量和总任务数一致，表示任务组任务已经完成                                                                    </span>
<span class="-3459195755403894456" onmouseenter="enter('-3459195755403894456');" onmouseout="out('-3459195755403894456');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 569       if (mCompleteNum &gt;= mTaskEntity.getEntity().getSubTask().size()){                                  </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 570         closeTimer(false);                                                                               </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 571         mListener.onComplete();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 572       }                                                                                                  </span>
<span class="-8854761308402599798" onmouseenter="enter('-8854761308402599798');" onmouseout="out('-8854761308402599798');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 573       //如果子任务完成数量加上失败的数量和总任务数一致，则任务组停止下载                                                                 </span>
<span class="-4400482220810116081" onmouseenter="enter('-4400482220810116081');" onmouseout="out('-4400482220810116081');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 574       if (mCompleteNum + mFailNum &gt;= mActualTaskNum) {                                                   </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 575         closeTimer(false);                                                                               </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 576         mListener.onComplete();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 577       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 578     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 579                                                                                                          </span>
<span class="-8845666459040584461" onmouseenter="enter('-8845666459040584461');" onmouseout="out('-8845666459040584461');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 580     @Override public void onFail() {                                                                     </span>
<span class="-1614602823543137763" onmouseenter="enter('-1614602823543137763');" onmouseout="out('-1614602823543137763');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 581       entity.setFailNum(entity.getFailNum() + 1);                                                        </span>
<span class="9173216667172088818" onmouseenter="enter('9173216667172088818');" onmouseout="out('9173216667172088818');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 582       saveData(IEntity.STATE_FAIL, lastLen);                                                             </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 583       handleSpeed(0);                                                                                    </span>
<span class="2616907991847077571" onmouseenter="enter('2616907991847077571');" onmouseout="out('2616907991847077571');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 584       reTry();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 585     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 586                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 587     /**                                                                                                  </span>
<span class="9094883438601628482" onmouseenter="enter('9094883438601628482');" onmouseout="out('9094883438601628482');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 588      * 失败后重试下载，如果失败次数超过5次，不再重试                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 589      */                                                                                                  </span>
<span class="-6307491174755509331" onmouseenter="enter('-6307491174755509331');" onmouseout="out('-6307491174755509331');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 590     private void reTry() {                                                                               </span>
<span class="2413557230396081886" onmouseenter="enter('2413557230396081886');" onmouseout="out('2413557230396081886');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 591       if (entity.getFailNum() &lt; 5) {                                                                     </span>
<span class="3130304206991829788" onmouseenter="enter('3130304206991829788');" onmouseout="out('3130304206991829788');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 592         reStartTask();                                                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 593       } else {                                                                                           </span>
<span class="-4418339448232441007" onmouseenter="enter('-4418339448232441007');" onmouseout="out('-4418339448232441007');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 594         mFailNum++;                                                                                      </span>
<span class="-8499931761036179208" onmouseenter="enter('-8499931761036179208');" onmouseout="out('-8499931761036179208');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 595         mListener.onSubFail(entity);                                                                     </span>
<span class="-5088134094962551809" onmouseenter="enter('-5088134094962551809');" onmouseout="out('-5088134094962551809');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 596         //如果失败的任务数大于实际的下载任务数，任务组停止下载                                                                     </span>
<span class="-7579643381750577546" onmouseenter="enter('-7579643381750577546');" onmouseout="out('-7579643381750577546');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 597         if (mFailNum &gt;= mActualTaskNum) {                                                                </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 598           closeTimer(false);                                                                             </span>
<span class="5167771793225547847" onmouseenter="enter('5167771793225547847');" onmouseout="out('5167771793225547847');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 599           mListener.onStop(mCurrentLocation);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 600         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 601       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 602     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 603                                                                                                          </span>
<span class="-9166659205038143534" onmouseenter="enter('-9166659205038143534');" onmouseout="out('-9166659205038143534');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 604     private void reStartTask() {                                                                         </span>
<span class="694224692856620004" onmouseenter="enter('694224692856620004');" onmouseout="out('694224692856620004');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 605       Timer timer = new Timer();                                                                         </span>
<span class="-3995857028562557665" onmouseenter="enter('-3995857028562557665');" onmouseout="out('-3995857028562557665');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 606       timer.schedule(new TimerTask() {                                                                   </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 607         @Override public void run() {                                                                    </span>
<span class="-915554303021644808" onmouseenter="enter('-915554303021644808');" onmouseout="out('-915554303021644808');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 608           Downloader dt = mDownloaderMap.get(entity.getDownloadUrl());                                   </span>
<span class="8054045842810821752" onmouseenter="enter('8054045842810821752');" onmouseout="out('8054045842810821752');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 609           dt.startDownload();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 610         }                                                                                                </span>
<span class="1359862179938126399" onmouseenter="enter('1359862179938126399');" onmouseout="out('1359862179938126399');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 611       }, 3000);                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 612     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 613                                                                                                          </span>
<span class="7889271447688685611" onmouseenter="enter('7889271447688685611');" onmouseout="out('7889271447688685611');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 614     private void handleSpeed(long speed) {                                                               </span>
<span class="-8903176931212217262" onmouseenter="enter('-8903176931212217262');" onmouseout="out('-8903176931212217262');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 615       entity.setSpeed(speed);                                                                            </span>
<span class="-458871634303822896" onmouseenter="enter('-458871634303822896');" onmouseout="out('-458871634303822896');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 616       entity.setConvertSpeed(speed &lt;= 0 ? &quot;&quot; : CommonUtil.formatFileSize(speed) + &quot;/s&quot;);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 617     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 618                                                                                                          </span>
<span class="-8417795030437306969" onmouseenter="enter('-8417795030437306969');" onmouseout="out('-8417795030437306969');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 619     private void saveData(int state, long location) {                                                    </span>
<span class="1870432086074469274" onmouseenter="enter('1870432086074469274');" onmouseout="out('1870432086074469274');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 620       entity.setState(state);                                                                            </span>
<span class="5476417475415693432" onmouseenter="enter('5476417475415693432');" onmouseout="out('5476417475415693432');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 621       entity.setComplete(state == IEntity.STATE_COMPLETE);                                               </span>
<span class="-1375586946810284641" onmouseenter="enter('-1375586946810284641');" onmouseout="out('-1375586946810284641');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 622       if (entity.isComplete()) {                                                                         </span>
<span class="7860072371622563794" onmouseenter="enter('7860072371622563794');" onmouseout="out('7860072371622563794');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 623         entity.setCompleteTime(System.currentTimeMillis());                                              </span>
<span class="-417755752443399839" onmouseenter="enter('-417755752443399839');" onmouseout="out('-417755752443399839');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 624         entity.setCurrentProgress(entity.getFileSize());                                                 </span>
<span class="-4932930723349285601" onmouseenter="enter('-4932930723349285601');" onmouseout="out('-4932930723349285601');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 625       } else if (location &gt; 0) {                                                                         </span>
<span class="8919645422588846117" onmouseenter="enter('8919645422588846117');" onmouseout="out('8919645422588846117');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 626         entity.setCurrentProgress(location);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 627       }                                                                                                  </span>
<span class="-733466174510760140" onmouseenter="enter('-733466174510760140');" onmouseout="out('-733466174510760140');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 628       entity.update();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 629     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 630                                                                                                          </span>
<span class="-4067662255690266791" onmouseenter="enter('-4067662255690266791');" onmouseout="out('-4067662255690266791');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 631     @Override public void supportBreakpoint(boolean support) {                                           </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 632                                                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 633 =======                                                                                                  </span>
<span class="8019628728195433582" onmouseenter="enter('8019628728195433582');" onmouseout="out('8019628728195433582');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 634     return new HttpFileInfoThread(taskEntity, callback);                                                 </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 635 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 636   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 637 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="4634392904032211814" onmouseenter="enter('4634392904032211814');" onmouseout="out('4634392904032211814');" style="">  16 package com.arialyy.aria.core.download.downloader;                                                       </span>
<span  style="">  17                                                                                                          </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  18 import android.util.SparseArray;                                                                         </span>
<span class="-3094174390533083180" onmouseenter="enter('-3094174390533083180');" onmouseout="out('-3094174390533083180');" style="">  19 import com.arialyy.aria.core.common.IUtil;                                                               </span>
<span class="5290109400157436023" onmouseenter="enter('5290109400157436023');" onmouseout="out('5290109400157436023');" style="">  20 import com.arialyy.aria.core.download.DownloadGroupTaskEntity;                                           </span>
<span class="8636089030381561336" onmouseenter="enter('8636089030381561336');" onmouseout="out('8636089030381561336');" style="">  21 import com.arialyy.aria.core.download.DownloadTaskEntity;                                                </span>
<span class="-5016163043314935005" onmouseenter="enter('-5016163043314935005');" onmouseout="out('-5016163043314935005');" style="">  22 import com.arialyy.aria.core.inf.IEntity;                                                                </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  23 import java.util.Set;                                                                                    </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  24 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  25 import java.util.concurrent.Executors;                                                                   </span>
<span  style="">  26                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  27 /**                                                                                                      </span>
<span class="1321179419529258125" onmouseenter="enter('1321179419529258125');" onmouseout="out('1321179419529258125');" style="">  28  * Created by AriaL on 2017/6/30.                                                                        </span>
<span class="7496304558415279260" onmouseenter="enter('7496304558415279260');" onmouseout="out('7496304558415279260');" style="">  29  * 任务组下载工具                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  30  */                                                                                                      </span>
<span class="753905216202195114" onmouseenter="enter('753905216202195114');" onmouseout="out('753905216202195114');" style="">  31 public class DownloadGroupUtil extends AbsGroupUtil implements IUtil {                                   </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">  32 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  33                                                                                                          </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  34                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  35  /**                                                                                                     </span>
<span class="7953531489350582006" onmouseenter="enter('7953531489350582006');" onmouseout="out('7953531489350582006');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  36   * 子任务事件监听                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  37   */                                                                                                     </span>
<span class="-3470753416804816360" onmouseenter="enter('-3470753416804816360');" onmouseout="out('-3470753416804816360');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  38  private class ChildDownloadListener implements IDownloadListener {                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  39                                                                                                          </span>
<span class="1934457291382022470" onmouseenter="enter('1934457291382022470');" onmouseout="out('1934457291382022470');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  40   DownloadTaskEntity taskEntity;                                                                         </span>
<span class="-5258622463362253406" onmouseenter="enter('-5258622463362253406');" onmouseout="out('-5258622463362253406');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41   DownloadEntity entity;                                                                                 </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42                                                                                                          </span>
<span class="5046313540994813291" onmouseenter="enter('5046313540994813291');" onmouseout="out('5046313540994813291');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  43   long lastLen = 0;                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  44                                                                                                          </span>
<span class="-4385074185507416044" onmouseenter="enter('-4385074185507416044');" onmouseout="out('-4385074185507416044');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  45   ChildDownloadListener(DownloadTaskEntity entity) {                                                     </span>
<span class="1703855892247108918" onmouseenter="enter('1703855892247108918');" onmouseout="out('1703855892247108918');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  46    this.taskEntity = entity;                                                                             </span>
<span class="-1050912213241719894" onmouseenter="enter('-1050912213241719894');" onmouseout="out('-1050912213241719894');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  47    this.entity = taskEntity.getEntity();                                                                 </span>
<span class="6735191672939573635" onmouseenter="enter('6735191672939573635');" onmouseout="out('6735191672939573635');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  48    lastLen = this.entity.getCurrentProgress();                                                           </span>
<span class="4615984595129482352" onmouseenter="enter('4615984595129482352');" onmouseout="out('4615984595129482352');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  49    this.entity.setFailNum(0);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  50   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  51                                                                                                          </span>
<span class="1941248740392522719" onmouseenter="enter('1941248740392522719');" onmouseout="out('1941248740392522719');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  52   @Override public void onPre() {                                                                        </span>
<span class="1272045713932667636" onmouseenter="enter('1272045713932667636');" onmouseout="out('1272045713932667636');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53    saveData(IEntity.STATE_PRE, -1);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55                                                                                                          </span>
<span class="-6235441032293659444" onmouseenter="enter('-6235441032293659444');" onmouseout="out('-6235441032293659444');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56   @Override public void onPostPre(long fileSize) {                                                       </span>
<span class="-8919115203469377593" onmouseenter="enter('-8919115203469377593');" onmouseout="out('-8919115203469377593');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57    entity.setFileSize(fileSize);                                                                         </span>
<span class="-8129687735136084433" onmouseenter="enter('-8129687735136084433');" onmouseout="out('-8129687735136084433');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58    entity.setConvertFileSize(CommonUtil.formatFileSize(fileSize));                                       </span>
<span class="-7950482897387591002" onmouseenter="enter('-7950482897387591002');" onmouseout="out('-7950482897387591002');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59    saveData(IEntity.STATE_POST_PRE, -1);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  61                                                                                                          </span>
<span class="8211923352965833527" onmouseenter="enter('8211923352965833527');" onmouseout="out('8211923352965833527');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  62   @Override public void onResume(long resumeLocation) {                                                  </span>
<span class="2291762294641027919" onmouseenter="enter('2291762294641027919');" onmouseout="out('2291762294641027919');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  63    saveData(IEntity.STATE_POST_PRE, IEntity.STATE_RUNNING);                                              </span>
<span class="8171258845364215777" onmouseenter="enter('8171258845364215777');" onmouseout="out('8171258845364215777');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  64    lastLen = resumeLocation;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  65   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  66                                                                                                          </span>
<span class="-3498891166253305351" onmouseenter="enter('-3498891166253305351');" onmouseout="out('-3498891166253305351');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67   @Override public void onStart(long startLocation) {                                                    </span>
<span class="2291762294641027919" onmouseenter="enter('2291762294641027919');" onmouseout="out('2291762294641027919');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  68    saveData(IEntity.STATE_POST_PRE, IEntity.STATE_RUNNING);                                              </span>
<span class="-6451191897379263867" onmouseenter="enter('-6451191897379263867');" onmouseout="out('-6451191897379263867');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  69    lastLen = startLocation;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  70   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  71                                                                                                          </span>
<span class="-7946972766620409893" onmouseenter="enter('-7946972766620409893');" onmouseout="out('-7946972766620409893');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  72   @Override public void onProgress(long currentLocation) {                                               </span>
<span class="-6788340243894418006" onmouseenter="enter('-6788340243894418006');" onmouseout="out('-6788340243894418006');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  73    long speed = currentLocation - lastLen;                                                               </span>
<span class="-306662688114664893" onmouseenter="enter('-306662688114664893');" onmouseout="out('-306662688114664893');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  74    mCurrentLocation += speed;                                                                            </span>
<span class="-2754998682014897103" onmouseenter="enter('-2754998682014897103');" onmouseout="out('-2754998682014897103');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  75    lastLen = currentLocation;                                                                            </span>
<span class="-4238976656134225029" onmouseenter="enter('-4238976656134225029');" onmouseout="out('-4238976656134225029');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76    entity.setCurrentProgress(currentLocation);                                                           </span>
<span class="3220981239855838635" onmouseenter="enter('3220981239855838635');" onmouseout="out('3220981239855838635');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77    handleSpeed(speed);                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  78   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  79                                                                                                          </span>
<span class="3409726051444324452" onmouseenter="enter('3409726051444324452');" onmouseout="out('3409726051444324452');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  80   @Override public void onStop(long stopLocation) {                                                      </span>
<span class="-1696356608019189548" onmouseenter="enter('-1696356608019189548');" onmouseout="out('-1696356608019189548');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  81    saveData(IEntity.STATE_STOP, stopLocation);                                                           </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  82    handleSpeed(0);                                                                                       </span>
<span class="-5925177778340562463" onmouseenter="enter('-5925177778340562463');" onmouseout="out('-5925177778340562463');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  83    mListener.onSubStop(entity);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  84   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85                                                                                                          </span>
<span class="2093106455269248536" onmouseenter="enter('2093106455269248536');" onmouseout="out('2093106455269248536');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  86   @Override public void onCancel() {                                                                     </span>
<span class="-8209498279616463234" onmouseenter="enter('-8209498279616463234');" onmouseout="out('-8209498279616463234');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  87    saveData(IEntity.STATE_CANCEL, -1);                                                                   </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  88    handleSpeed(0);                                                                                       </span>
<span class="-2639925523011962937" onmouseenter="enter('-2639925523011962937');" onmouseout="out('-2639925523011962937');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  89    mListener.onSubCancel(entity);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  90   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  91                                                                                                          </span>
<span class="7400813110786944810" onmouseenter="enter('7400813110786944810');" onmouseout="out('7400813110786944810');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  92   @Override public void onComplete() {                                                                   </span>
<span class="-4243478454233770036" onmouseenter="enter('-4243478454233770036');" onmouseout="out('-4243478454233770036');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  93    saveData(IEntity.STATE_COMPLETE, entity.getFileSize());                                               </span>
<span class="-1263526001176077168" onmouseenter="enter('-1263526001176077168');" onmouseout="out('-1263526001176077168');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  94    mCompleteNum++;                                                                                       </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  95    handleSpeed(0);                                                                                       </span>
<span class="-2907962166797260638" onmouseenter="enter('-2907962166797260638');" onmouseout="out('-2907962166797260638');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  96    mListener.onSubComplete(entity);                                                                      </span>
<span class="-6363872878771524946" onmouseenter="enter('-6363872878771524946');" onmouseout="out('-6363872878771524946');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  97    //如果子任务完成的数量和总任务数一致，表示任务组任务已经完成                                                                       </span>
<span class="7845605175596662348" onmouseenter="enter('7845605175596662348');" onmouseout="out('7845605175596662348');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  98    if (mCompleteNum &gt;= mTaskEntity.getEntity().getSubTask().size()) {                                    </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99     closeTimer(false);                                                                                   </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100     mListener.onComplete();                                                                              </span>
<span class="3397040530661527737" onmouseenter="enter('3397040530661527737');" onmouseout="out('3397040530661527737');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101    } else if (mCompleteNum + mFailNum &gt;= mActualTaskNum) {                                               </span>
<span class="-8854761308402599798" onmouseenter="enter('-8854761308402599798');" onmouseout="out('-8854761308402599798');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102     //如果子任务完成数量加上失败的数量和总任务数一致，则任务组停止下载                                                                   </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103     closeTimer(false);                                                                                   </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104     mListener.onComplete();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 105    }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107                                                                                                          </span>
<span class="-8845666459040584461" onmouseenter="enter('-8845666459040584461');" onmouseout="out('-8845666459040584461');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108   @Override public void onFail() {                                                                       </span>
<span class="-1614602823543137763" onmouseenter="enter('-1614602823543137763');" onmouseout="out('-1614602823543137763');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 109    entity.setFailNum(entity.getFailNum() + 1);                                                           </span>
<span class="9173216667172088818" onmouseenter="enter('9173216667172088818');" onmouseout="out('9173216667172088818');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 110    saveData(IEntity.STATE_FAIL, lastLen);                                                                </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 111    handleSpeed(0);                                                                                       </span>
<span class="2616907991847077571" onmouseenter="enter('2616907991847077571');" onmouseout="out('2616907991847077571');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112    reTry();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 114                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115   /**                                                                                                    </span>
<span class="9094883438601628482" onmouseenter="enter('9094883438601628482');" onmouseout="out('9094883438601628482');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116    * 失败后重试下载，如果失败次数超过5次，不再重试                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 117    */                                                                                                    </span>
<span class="-6307491174755509331" onmouseenter="enter('-6307491174755509331');" onmouseout="out('-6307491174755509331');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 118   private void reTry() {                                                                                 </span>
<span class="2413557230396081886" onmouseenter="enter('2413557230396081886');" onmouseout="out('2413557230396081886');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 119    if (entity.getFailNum() &lt; 5) {                                                                        </span>
<span class="3130304206991829788" onmouseenter="enter('3130304206991829788');" onmouseout="out('3130304206991829788');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120     reStartTask();                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121    } else {                                                                                              </span>
<span class="-4418339448232441007" onmouseenter="enter('-4418339448232441007');" onmouseout="out('-4418339448232441007');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122     mFailNum++;                                                                                          </span>
<span class="-8499931761036179208" onmouseenter="enter('-8499931761036179208');" onmouseout="out('-8499931761036179208');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123     mListener.onSubFail(entity);                                                                         </span>
<span class="-5088134094962551809" onmouseenter="enter('-5088134094962551809');" onmouseout="out('-5088134094962551809');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124     //如果失败的任务数大于实际的下载任务数，任务组停止下载                                                                         </span>
<span class="-7579643381750577546" onmouseenter="enter('-7579643381750577546');" onmouseout="out('-7579643381750577546');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125     if (mFailNum &gt;= mActualTaskNum) {                                                                    </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126      closeTimer(false);                                                                                  </span>
<span class="5167771793225547847" onmouseenter="enter('5167771793225547847');" onmouseout="out('5167771793225547847');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127      mListener.onStop(mCurrentLocation);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129    }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131                                                                                                          </span>
<span class="-9166659205038143534" onmouseenter="enter('-9166659205038143534');" onmouseout="out('-9166659205038143534');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132   private void reStartTask() {                                                                           </span>
<span class="694224692856620004" onmouseenter="enter('694224692856620004');" onmouseout="out('694224692856620004');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 133    Timer timer = new Timer();                                                                            </span>
<span class="-3995857028562557665" onmouseenter="enter('-3995857028562557665');" onmouseout="out('-3995857028562557665');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 134    timer.schedule(new TimerTask() {                                                                      </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 135     @Override public void run() {                                                                        </span>
<span class="-915554303021644808" onmouseenter="enter('-915554303021644808');" onmouseout="out('-915554303021644808');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 136      Downloader dt = mDownloaderMap.get(entity.getDownloadUrl());                                        </span>
<span class="8054045842810821752" onmouseenter="enter('8054045842810821752');" onmouseout="out('8054045842810821752');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 137      dt.startDownload();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 138     }                                                                                                    </span>
<span class="1359862179938126399" onmouseenter="enter('1359862179938126399');" onmouseout="out('1359862179938126399');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139    }, 3000);                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141                                                                                                          </span>
<span class="7889271447688685611" onmouseenter="enter('7889271447688685611');" onmouseout="out('7889271447688685611');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 142   private void handleSpeed(long speed) {                                                                 </span>
<span class="-8903176931212217262" onmouseenter="enter('-8903176931212217262');" onmouseout="out('-8903176931212217262');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 143    entity.setSpeed(speed);                                                                               </span>
<span class="-458871634303822896" onmouseenter="enter('-458871634303822896');" onmouseout="out('-458871634303822896');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 144    entity.setConvertSpeed(speed &lt;= 0 ? &quot;&quot; : CommonUtil.formatFileSize(speed) + &quot;/s&quot;);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 145   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146                                                                                                          </span>
<span class="-8417795030437306969" onmouseenter="enter('-8417795030437306969');" onmouseout="out('-8417795030437306969');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147   private void saveData(int state, long location) {                                                      </span>
<span class="1870432086074469274" onmouseenter="enter('1870432086074469274');" onmouseout="out('1870432086074469274');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 148    entity.setState(state);                                                                               </span>
<span class="5476417475415693432" onmouseenter="enter('5476417475415693432');" onmouseout="out('5476417475415693432');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 149    entity.setComplete(state == IEntity.STATE_COMPLETE);                                                  </span>
<span class="-1375586946810284641" onmouseenter="enter('-1375586946810284641');" onmouseout="out('-1375586946810284641');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 150    if (entity.isComplete()) {                                                                            </span>
<span class="7860072371622563794" onmouseenter="enter('7860072371622563794');" onmouseout="out('7860072371622563794');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 151     entity.setCompleteTime(System.currentTimeMillis());                                                  </span>
<span class="-417755752443399839" onmouseenter="enter('-417755752443399839');" onmouseout="out('-417755752443399839');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 152     entity.setCurrentProgress(entity.getFileSize());                                                     </span>
<span class="-4932930723349285601" onmouseenter="enter('-4932930723349285601');" onmouseout="out('-4932930723349285601');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 153    } else if (location &gt; 0) {                                                                            </span>
<span class="8919645422588846117" onmouseenter="enter('8919645422588846117');" onmouseout="out('8919645422588846117');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 154     entity.setCurrentProgress(location);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 155    }                                                                                                     </span>
<span class="-733466174510760140" onmouseenter="enter('-733466174510760140');" onmouseout="out('-733466174510760140');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 156    entity.update();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 157   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 158                                                                                                          </span>
<span class="-4067662255690266791" onmouseenter="enter('-4067662255690266791');" onmouseout="out('-4067662255690266791');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 159   @Override public void supportBreakpoint(boolean support) {                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 160                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 161   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162  }                                                                                                       </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 163 ||||||| BASE                                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 166  /**                                                                                                     </span>
<span class="7953531489350582006" onmouseenter="enter('7953531489350582006');" onmouseout="out('7953531489350582006');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 167   * 子任务事件监听                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168   */                                                                                                     </span>
<span class="-3470753416804816360" onmouseenter="enter('-3470753416804816360');" onmouseout="out('-3470753416804816360');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169  private class ChildDownloadListener implements IDownloadListener {                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170                                                                                                          </span>
<span class="1934457291382022470" onmouseenter="enter('1934457291382022470');" onmouseout="out('1934457291382022470');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 171   DownloadTaskEntity taskEntity;                                                                         </span>
<span class="-5258622463362253406" onmouseenter="enter('-5258622463362253406');" onmouseout="out('-5258622463362253406');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172   DownloadEntity entity;                                                                                 </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173                                                                                                          </span>
<span class="5046313540994813291" onmouseenter="enter('5046313540994813291');" onmouseout="out('5046313540994813291');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174   long lastLen = 0;                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175                                                                                                          </span>
<span class="-4385074185507416044" onmouseenter="enter('-4385074185507416044');" onmouseout="out('-4385074185507416044');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176   ChildDownloadListener(DownloadTaskEntity entity) {                                                     </span>
<span class="1703855892247108918" onmouseenter="enter('1703855892247108918');" onmouseout="out('1703855892247108918');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177    this.taskEntity = entity;                                                                             </span>
<span class="-1050912213241719894" onmouseenter="enter('-1050912213241719894');" onmouseout="out('-1050912213241719894');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178    this.entity = taskEntity.getEntity();                                                                 </span>
<span class="6735191672939573635" onmouseenter="enter('6735191672939573635');" onmouseout="out('6735191672939573635');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179    lastLen = this.entity.getCurrentProgress();                                                           </span>
<span class="4615984595129482352" onmouseenter="enter('4615984595129482352');" onmouseout="out('4615984595129482352');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180    this.entity.setFailNum(0);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182                                                                                                          </span>
<span class="1941248740392522719" onmouseenter="enter('1941248740392522719');" onmouseout="out('1941248740392522719');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183   @Override public void onPre() {                                                                        </span>
<span class="1272045713932667636" onmouseenter="enter('1272045713932667636');" onmouseout="out('1272045713932667636');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184    saveData(IEntity.STATE_PRE, -1);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186                                                                                                          </span>
<span class="-6235441032293659444" onmouseenter="enter('-6235441032293659444');" onmouseout="out('-6235441032293659444');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187   @Override public void onPostPre(long fileSize) {                                                       </span>
<span class="-8919115203469377593" onmouseenter="enter('-8919115203469377593');" onmouseout="out('-8919115203469377593');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188    entity.setFileSize(fileSize);                                                                         </span>
<span class="-8129687735136084433" onmouseenter="enter('-8129687735136084433');" onmouseout="out('-8129687735136084433');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189    entity.setConvertFileSize(CommonUtil.formatFileSize(fileSize));                                       </span>
<span class="-7950482897387591002" onmouseenter="enter('-7950482897387591002');" onmouseout="out('-7950482897387591002');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190    saveData(IEntity.STATE_POST_PRE, -1);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192                                                                                                          </span>
<span class="8211923352965833527" onmouseenter="enter('8211923352965833527');" onmouseout="out('8211923352965833527');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 193   @Override public void onResume(long resumeLocation) {                                                  </span>
<span class="2291762294641027919" onmouseenter="enter('2291762294641027919');" onmouseout="out('2291762294641027919');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 194    saveData(IEntity.STATE_POST_PRE, IEntity.STATE_RUNNING);                                              </span>
<span class="8171258845364215777" onmouseenter="enter('8171258845364215777');" onmouseout="out('8171258845364215777');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195    lastLen = resumeLocation;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197                                                                                                          </span>
<span class="-3498891166253305351" onmouseenter="enter('-3498891166253305351');" onmouseout="out('-3498891166253305351');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198   @Override public void onStart(long startLocation) {                                                    </span>
<span class="2291762294641027919" onmouseenter="enter('2291762294641027919');" onmouseout="out('2291762294641027919');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 199    saveData(IEntity.STATE_POST_PRE, IEntity.STATE_RUNNING);                                              </span>
<span class="-6451191897379263867" onmouseenter="enter('-6451191897379263867');" onmouseout="out('-6451191897379263867');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200    lastLen = startLocation;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 201   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 202                                                                                                          </span>
<span class="-7946972766620409893" onmouseenter="enter('-7946972766620409893');" onmouseout="out('-7946972766620409893');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 203   @Override public void onProgress(long currentLocation) {                                               </span>
<span class="-6788340243894418006" onmouseenter="enter('-6788340243894418006');" onmouseout="out('-6788340243894418006');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 204    long speed = currentLocation - lastLen;                                                               </span>
<span class="-306662688114664893" onmouseenter="enter('-306662688114664893');" onmouseout="out('-306662688114664893');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 205    mCurrentLocation += speed;                                                                            </span>
<span class="-2754998682014897103" onmouseenter="enter('-2754998682014897103');" onmouseout="out('-2754998682014897103');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 206    lastLen = currentLocation;                                                                            </span>
<span class="-4238976656134225029" onmouseenter="enter('-4238976656134225029');" onmouseout="out('-4238976656134225029');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 207    entity.setCurrentProgress(currentLocation);                                                           </span>
<span class="3220981239855838635" onmouseenter="enter('3220981239855838635');" onmouseout="out('3220981239855838635');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 208    handleSpeed(speed);                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 209   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210                                                                                                          </span>
<span class="3409726051444324452" onmouseenter="enter('3409726051444324452');" onmouseout="out('3409726051444324452');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 211   @Override public void onStop(long stopLocation) {                                                      </span>
<span class="-1696356608019189548" onmouseenter="enter('-1696356608019189548');" onmouseout="out('-1696356608019189548');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 212    saveData(IEntity.STATE_STOP, stopLocation);                                                           </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 213    handleSpeed(0);                                                                                       </span>
<span class="-5925177778340562463" onmouseenter="enter('-5925177778340562463');" onmouseout="out('-5925177778340562463');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 214    mListener.onSubStop(entity);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 215   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 216                                                                                                          </span>
<span class="2093106455269248536" onmouseenter="enter('2093106455269248536');" onmouseout="out('2093106455269248536');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 217   @Override public void onCancel() {                                                                     </span>
<span class="-8209498279616463234" onmouseenter="enter('-8209498279616463234');" onmouseout="out('-8209498279616463234');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 218    saveData(IEntity.STATE_CANCEL, -1);                                                                   </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 219    handleSpeed(0);                                                                                       </span>
<span class="-2639925523011962937" onmouseenter="enter('-2639925523011962937');" onmouseout="out('-2639925523011962937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 220    mListener.onSubCancel(entity);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 221   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 222                                                                                                          </span>
<span class="7400813110786944810" onmouseenter="enter('7400813110786944810');" onmouseout="out('7400813110786944810');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 223   @Override public void onComplete() {                                                                   </span>
<span class="-4243478454233770036" onmouseenter="enter('-4243478454233770036');" onmouseout="out('-4243478454233770036');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 224    saveData(IEntity.STATE_COMPLETE, entity.getFileSize());                                               </span>
<span class="-1263526001176077168" onmouseenter="enter('-1263526001176077168');" onmouseout="out('-1263526001176077168');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 225    mCompleteNum++;                                                                                       </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 226    handleSpeed(0);                                                                                       </span>
<span class="-2907962166797260638" onmouseenter="enter('-2907962166797260638');" onmouseout="out('-2907962166797260638');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 227    mListener.onSubComplete(entity);                                                                      </span>
<span class="-6363872878771524946" onmouseenter="enter('-6363872878771524946');" onmouseout="out('-6363872878771524946');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 228    //如果子任务完成的数量和总任务数一致，表示任务组任务已经完成                                                                       </span>
<span class="-3459195755403894456" onmouseenter="enter('-3459195755403894456');" onmouseout="out('-3459195755403894456');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 229    if (mCompleteNum &gt;= mTaskEntity.getEntity().getSubTask().size()){                                     </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 230     closeTimer(false);                                                                                   </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 231     mListener.onComplete();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 232    }                                                                                                     </span>
<span class="-8854761308402599798" onmouseenter="enter('-8854761308402599798');" onmouseout="out('-8854761308402599798');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 233    //如果子任务完成数量加上失败的数量和总任务数一致，则任务组停止下载                                                                    </span>
<span class="-4400482220810116081" onmouseenter="enter('-4400482220810116081');" onmouseout="out('-4400482220810116081');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 234    if (mCompleteNum + mFailNum &gt;= mActualTaskNum) {                                                      </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 235     closeTimer(false);                                                                                   </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 236     mListener.onComplete();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 237    }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 238   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 239                                                                                                          </span>
<span class="-8845666459040584461" onmouseenter="enter('-8845666459040584461');" onmouseout="out('-8845666459040584461');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 240   @Override public void onFail() {                                                                       </span>
<span class="-1614602823543137763" onmouseenter="enter('-1614602823543137763');" onmouseout="out('-1614602823543137763');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 241    entity.setFailNum(entity.getFailNum() + 1);                                                           </span>
<span class="9173216667172088818" onmouseenter="enter('9173216667172088818');" onmouseout="out('9173216667172088818');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 242    saveData(IEntity.STATE_FAIL, lastLen);                                                                </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 243    handleSpeed(0);                                                                                       </span>
<span class="2616907991847077571" onmouseenter="enter('2616907991847077571');" onmouseout="out('2616907991847077571');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 244    reTry();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 245   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 246                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 247   /**                                                                                                    </span>
<span class="9094883438601628482" onmouseenter="enter('9094883438601628482');" onmouseout="out('9094883438601628482');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248    * 失败后重试下载，如果失败次数超过5次，不再重试                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249    */                                                                                                    </span>
<span class="-6307491174755509331" onmouseenter="enter('-6307491174755509331');" onmouseout="out('-6307491174755509331');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250   private void reTry() {                                                                                 </span>
<span class="2413557230396081886" onmouseenter="enter('2413557230396081886');" onmouseout="out('2413557230396081886');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 251    if (entity.getFailNum() &lt; 5) {                                                                        </span>
<span class="3130304206991829788" onmouseenter="enter('3130304206991829788');" onmouseout="out('3130304206991829788');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 252     reStartTask();                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 253    } else {                                                                                              </span>
<span class="-4418339448232441007" onmouseenter="enter('-4418339448232441007');" onmouseout="out('-4418339448232441007');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 254     mFailNum++;                                                                                          </span>
<span class="-8499931761036179208" onmouseenter="enter('-8499931761036179208');" onmouseout="out('-8499931761036179208');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 255     mListener.onSubFail(entity);                                                                         </span>
<span class="-5088134094962551809" onmouseenter="enter('-5088134094962551809');" onmouseout="out('-5088134094962551809');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 256     //如果失败的任务数大于实际的下载任务数，任务组停止下载                                                                         </span>
<span class="-7579643381750577546" onmouseenter="enter('-7579643381750577546');" onmouseout="out('-7579643381750577546');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 257     if (mFailNum &gt;= mActualTaskNum) {                                                                    </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 258      closeTimer(false);                                                                                  </span>
<span class="5167771793225547847" onmouseenter="enter('5167771793225547847');" onmouseout="out('5167771793225547847');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 259      mListener.onStop(mCurrentLocation);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 260     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 261    }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 262   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 263                                                                                                          </span>
<span class="-9166659205038143534" onmouseenter="enter('-9166659205038143534');" onmouseout="out('-9166659205038143534');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264   private void reStartTask() {                                                                           </span>
<span class="694224692856620004" onmouseenter="enter('694224692856620004');" onmouseout="out('694224692856620004');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 265    Timer timer = new Timer();                                                                            </span>
<span class="-3995857028562557665" onmouseenter="enter('-3995857028562557665');" onmouseout="out('-3995857028562557665');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 266    timer.schedule(new TimerTask() {                                                                      </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 267     @Override public void run() {                                                                        </span>
<span class="-915554303021644808" onmouseenter="enter('-915554303021644808');" onmouseout="out('-915554303021644808');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 268      Downloader dt = mDownloaderMap.get(entity.getDownloadUrl());                                        </span>
<span class="8054045842810821752" onmouseenter="enter('8054045842810821752');" onmouseout="out('8054045842810821752');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 269      dt.startDownload();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 270     }                                                                                                    </span>
<span class="1359862179938126399" onmouseenter="enter('1359862179938126399');" onmouseout="out('1359862179938126399');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 271    }, 3000);                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 272   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 273                                                                                                          </span>
<span class="7889271447688685611" onmouseenter="enter('7889271447688685611');" onmouseout="out('7889271447688685611');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 274   private void handleSpeed(long speed) {                                                                 </span>
<span class="-8903176931212217262" onmouseenter="enter('-8903176931212217262');" onmouseout="out('-8903176931212217262');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 275    entity.setSpeed(speed);                                                                               </span>
<span class="-458871634303822896" onmouseenter="enter('-458871634303822896');" onmouseout="out('-458871634303822896');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 276    entity.setConvertSpeed(speed &lt;= 0 ? &quot;&quot; : CommonUtil.formatFileSize(speed) + &quot;/s&quot;);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 277   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 278                                                                                                          </span>
<span class="-8417795030437306969" onmouseenter="enter('-8417795030437306969');" onmouseout="out('-8417795030437306969');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279   private void saveData(int state, long location) {                                                      </span>
<span class="1870432086074469274" onmouseenter="enter('1870432086074469274');" onmouseout="out('1870432086074469274');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280    entity.setState(state);                                                                               </span>
<span class="5476417475415693432" onmouseenter="enter('5476417475415693432');" onmouseout="out('5476417475415693432');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 281    entity.setComplete(state == IEntity.STATE_COMPLETE);                                                  </span>
<span class="-1375586946810284641" onmouseenter="enter('-1375586946810284641');" onmouseout="out('-1375586946810284641');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 282    if (entity.isComplete()) {                                                                            </span>
<span class="7860072371622563794" onmouseenter="enter('7860072371622563794');" onmouseout="out('7860072371622563794');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283     entity.setCompleteTime(System.currentTimeMillis());                                                  </span>
<span class="-417755752443399839" onmouseenter="enter('-417755752443399839');" onmouseout="out('-417755752443399839');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284     entity.setCurrentProgress(entity.getFileSize());                                                     </span>
<span class="-4932930723349285601" onmouseenter="enter('-4932930723349285601');" onmouseout="out('-4932930723349285601');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 285    } else if (location &gt; 0) {                                                                            </span>
<span class="8919645422588846117" onmouseenter="enter('8919645422588846117');" onmouseout="out('8919645422588846117');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286     entity.setCurrentProgress(location);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287    }                                                                                                     </span>
<span class="-733466174510760140" onmouseenter="enter('-733466174510760140');" onmouseout="out('-733466174510760140');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288    entity.update();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290                                                                                                          </span>
<span class="-4067662255690266791" onmouseenter="enter('-4067662255690266791');" onmouseout="out('-4067662255690266791');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291   @Override public void supportBreakpoint(boolean support) {                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294  }                                                                                                       </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 295 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 296                                                                                                          </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 297 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="3933744472183840087" onmouseenter="enter('3933744472183840087');" onmouseout="out('3933744472183840087');" style=""> 298   private final String TAG = &quot;DownloadGroupUtil&quot;;                                                        </span>
<span class="4123530941227175815" onmouseenter="enter('4123530941227175815');" onmouseout="out('4123530941227175815');" style=""> 299   private ExecutorService mInfoPool;                                                                     </span>
<span  style=""> 300                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 301   /**                                                                                                    </span>
<span class="6416521976967220365" onmouseenter="enter('6416521976967220365');" onmouseout="out('6416521976967220365');" style=""> 302    * 文件信息回调组                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 303    */                                                                                                    </span>
<span class="-5994431595118905059" onmouseenter="enter('-5994431595118905059');" onmouseout="out('-5994431595118905059');" style=""> 304   private SparseArray&lt;OnFileInfoCallback&gt; mFileInfoCallbacks = new SparseArray&lt;&gt;();                      </span>
<span  style=""> 305                                                                                                          </span>
<span class="-3731711094107651611" onmouseenter="enter('-3731711094107651611');" onmouseout="out('-3731711094107651611');" style=""> 306   public DownloadGroupUtil(IDownloadGroupListener listener, DownloadGroupTaskEntity taskEntity) {        </span>
<span class="-7841553057471002442" onmouseenter="enter('-7841553057471002442');" onmouseout="out('-7841553057471002442');" style=""> 307     super(listener, taskEntity);                                                                         </span>
<span class="-6453187294675473758" onmouseenter="enter('-6453187294675473758');" onmouseout="out('-6453187294675473758');" style=""> 308     mInfoPool = Executors.newCachedThreadPool();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309   }                                                                                                      </span>
<span  style=""> 310                                                                                                          </span>
<span class="7849318491336065590" onmouseenter="enter('7849318491336065590');" onmouseout="out('7849318491336065590');" style=""> 311   @Override protected void onStart() {                                                                   </span>
<span class="8068463127664630279" onmouseenter="enter('8068463127664630279');" onmouseout="out('8068463127664630279');" style=""> 312     super.onStart();                                                                                     </span>
<span class="4774762395313474868" onmouseenter="enter('4774762395313474868');" onmouseout="out('4774762395313474868');" style=""> 313     Set&lt;String&gt; keys = mExeMap.keySet();                                                                 </span>
<span class="-8629982182851448523" onmouseenter="enter('-8629982182851448523');" onmouseout="out('-8629982182851448523');" style=""> 314     int i = 0;                                                                                           </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style=""> 315     for (String key : keys) {                                                                            </span>
<span class="221423537684250497" onmouseenter="enter('221423537684250497');" onmouseout="out('221423537684250497');" style=""> 316       DownloadTaskEntity taskEntity = mExeMap.get(key);                                                  </span>
<span class="2875409705898122648" onmouseenter="enter('2875409705898122648');" onmouseout="out('2875409705898122648');" style=""> 317       if (taskEntity != null) {                                                                          </span>
<span class="3825460913713262848" onmouseenter="enter('3825460913713262848');" onmouseout="out('3825460913713262848');" style=""> 318         if (taskEntity.getState() != IEntity.STATE_FAIL                                                  </span>
<span class="4045344078755509632" onmouseenter="enter('4045344078755509632');" onmouseout="out('4045344078755509632');" style=""> 319             &amp;&amp; taskEntity.getState() != IEntity.STATE_WAIT) {                                            </span>
<span class="6449066979252177845" onmouseenter="enter('6449066979252177845');" onmouseout="out('6449066979252177845');" style=""> 320           startChildDownload(taskEntity);                                                                </span>
<span class="-4968746635634186778" onmouseenter="enter('-4968746635634186778');" onmouseout="out('-4968746635634186778');" style=""> 321           i++;                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 322         } else {                                                                                         </span>
<span class="4135184626453358547" onmouseenter="enter('4135184626453358547');" onmouseout="out('4135184626453358547');" style=""> 323           mInfoPool.execute(createFileInfoThread(taskEntity));                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 324         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326     }                                                                                                    </span>
<span class="-8434084337306400756" onmouseenter="enter('-8434084337306400756');" onmouseout="out('-8434084337306400756');" style=""> 327     if (i == mExeMap.size()) startRunningFlow();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328   }                                                                                                      </span>
<span  style=""> 329                                                                                                          </span>
<span class="2093106455269248536" onmouseenter="enter('2093106455269248536');" onmouseout="out('2093106455269248536');" style=""> 330   @Override public void onCancel() {                                                                     </span>
<span class="-5705545244356268786" onmouseenter="enter('-5705545244356268786');" onmouseout="out('-5705545244356268786');" style=""> 331     super.onCancel();                                                                                    </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style=""> 332     if (!mInfoPool.isShutdown()) {                                                                       </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style=""> 333       mInfoPool.shutdown();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335   }                                                                                                      </span>
<span  style=""> 336                                                                                                          </span>
<span class="8218595092732559103" onmouseenter="enter('8218595092732559103');" onmouseout="out('8218595092732559103');" style=""> 337   @Override protected void onStop() {                                                                    </span>
<span class="-4376279779571809033" onmouseenter="enter('-4376279779571809033');" onmouseout="out('-4376279779571809033');" style=""> 338     super.onStop();                                                                                      </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style=""> 339     if (!mInfoPool.isShutdown()) {                                                                       </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style=""> 340       mInfoPool.shutdown();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 341     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342   }                                                                                                      </span>
<span  style=""> 343                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 344   /**                                                                                                    </span>
<span class="-4547374311767626615" onmouseenter="enter('-4547374311767626615');" onmouseout="out('-4547374311767626615');" style=""> 345    * 创建文件信息获取线程                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 346    */                                                                                                    </span>
<span class="5921359649843257629" onmouseenter="enter('5921359649843257629');" onmouseout="out('5921359649843257629');" style=""> 347   private HttpFileInfoThread createFileInfoThread(DownloadTaskEntity taskEntity) {                       </span>
<span class="3806302679560349109" onmouseenter="enter('3806302679560349109');" onmouseout="out('3806302679560349109');" style=""> 348     OnFileInfoCallback callback = mFileInfoCallbacks.get(taskEntity.hashCode());                         </span>
<span  style=""> 349                                                                                                          </span>
<span class="-5681834850649759939" onmouseenter="enter('-5681834850649759939');" onmouseout="out('-5681834850649759939');" style=""> 350     if (callback == null) {                                                                              </span>
<span class="-2247249715703717317" onmouseenter="enter('-2247249715703717317');" onmouseout="out('-2247249715703717317');" style=""> 351       callback = new OnFileInfoCallback() {                                                              </span>
<span class="4970948900553010157" onmouseenter="enter('4970948900553010157');" onmouseout="out('4970948900553010157');" style=""> 352         int failNum = 0;                                                                                 </span>
<span  style=""> 353                                                                                                          </span>
<span class="-5145950279106892584" onmouseenter="enter('-5145950279106892584');" onmouseout="out('-5145950279106892584');" style=""> 354         @Override public void onComplete(String url, int code) {                                         </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style=""> 355           DownloadTaskEntity te = mExeMap.get(url);                                                      </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style=""> 356           if (te != null) {                                                                              </span>
<span class="308930838644053042" onmouseenter="enter('308930838644053042');" onmouseout="out('308930838644053042');" style=""> 357             mTotalSize += te.getEntity().getFileSize();                                                  </span>
<span class="-9118376655834637322" onmouseenter="enter('-9118376655834637322');" onmouseout="out('-9118376655834637322');" style=""> 358             startChildDownload(te);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 359           }                                                                                              </span>
<span class="-8520114986100534454" onmouseenter="enter('-8520114986100534454');" onmouseout="out('-8520114986100534454');" style=""> 360           mInitNum++;                                                                                    </span>
<span class="-234450023538178691" onmouseenter="enter('-234450023538178691');" onmouseout="out('-234450023538178691');" style=""> 361           if (mInitNum + mInitFailNum &gt;= mTaskEntity.getEntity().getSubTask().size()) {                  </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style=""> 362             startRunningFlow();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363           }                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364         }                                                                                                </span>
<span  style=""> 365                                                                                                          </span>
<span class="3522384484183979639" onmouseenter="enter('3522384484183979639');" onmouseout="out('3522384484183979639');" style=""> 366         @Override public void onFail(String url, String errorMsg) {                                      </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style=""> 367           DownloadTaskEntity te = mExeMap.get(url);                                                      </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style=""> 368           if (te != null) {                                                                              </span>
<span class="-3434538459014877633" onmouseenter="enter('-3434538459014877633');" onmouseout="out('-3434538459014877633');" style=""> 369             mFailMap.put(url, te);                                                                       </span>
<span class="8595174373746499082" onmouseenter="enter('8595174373746499082');" onmouseout="out('8595174373746499082');" style=""> 370             mFileInfoCallbacks.put(te.hashCode(), this);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371           }                                                                                              </span>
<span class="-3126918587586078524" onmouseenter="enter('-3126918587586078524');" onmouseout="out('-3126918587586078524');" style=""> 372           //404链接不重试下载                                                                                   </span>
<span class="-4716929270045128613" onmouseenter="enter('-4716929270045128613');" onmouseout="out('-4716929270045128613');" style=""> 373           if (failNum &lt; 10 &amp;&amp; !errorMsg.contains(&quot;错误码：404&quot;) &amp;&amp; !errorMsg.contains(                       </span>
<span class="5193671628245366377" onmouseenter="enter('5193671628245366377');" onmouseout="out('5193671628245366377');" style=""> 374               &quot;UnknownHostException&quot;)) {                                                                 </span>
<span class="-7158306797275734596" onmouseenter="enter('-7158306797275734596');" onmouseout="out('-7158306797275734596');" style=""> 375             mInfoPool.execute(createFileInfoThread(te));                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 376           } else {                                                                                       </span>
<span class="-2723952096500307408" onmouseenter="enter('-2723952096500307408');" onmouseout="out('-2723952096500307408');" style=""> 377             mInitFailNum++;                                                                              </span>
<span class="-1903130545068871575" onmouseenter="enter('-1903130545068871575');" onmouseout="out('-1903130545068871575');" style=""> 378             mActualTaskNum--;                                                                            </span>
<span class="-7251641660257607121" onmouseenter="enter('-7251641660257607121');" onmouseout="out('-7251641660257607121');" style=""> 379             if (mActualTaskNum &lt; 0) mActualTaskNum = 0;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 380           }                                                                                              </span>
<span class="-4881470894519452809" onmouseenter="enter('-4881470894519452809');" onmouseout="out('-4881470894519452809');" style=""> 381           failNum++;                                                                                     </span>
<span class="-234450023538178691" onmouseenter="enter('-234450023538178691');" onmouseout="out('-234450023538178691');" style=""> 382           if (mInitNum + mInitFailNum &gt;= mTaskEntity.getEntity().getSubTask().size()) {                  </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style=""> 383             startRunningFlow();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 384           }                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385         }                                                                                                </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 386       };                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 387     }                                                                                                    </span>
<span class="8019628728195433582" onmouseenter="enter('8019628728195433582');" onmouseout="out('8019628728195433582');" style=""> 388     return new HttpFileInfoThread(taskEntity, callback);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 389   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390 }                                                                                                        </span>





















































































































































































































































</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="4634392904032211814" onmouseenter="enter('4634392904032211814');" onmouseout="out('4634392904032211814');" style="">  16 package com.arialyy.aria.core.download.downloader;                                                       </span>
<span  style="">  17                                                                                                          </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  18 import android.util.SparseArray;                                                                         </span>
<span class="-3094174390533083180" onmouseenter="enter('-3094174390533083180');" onmouseout="out('-3094174390533083180');" style="">  19 import com.arialyy.aria.core.common.IUtil;                                                               </span>
<span class="5290109400157436023" onmouseenter="enter('5290109400157436023');" onmouseout="out('5290109400157436023');" style="">  20 import com.arialyy.aria.core.download.DownloadGroupTaskEntity;                                           </span>
<span class="8636089030381561336" onmouseenter="enter('8636089030381561336');" onmouseout="out('8636089030381561336');" style="">  21 import com.arialyy.aria.core.download.DownloadTaskEntity;                                                </span>
<span class="-5016163043314935005" onmouseenter="enter('-5016163043314935005');" onmouseout="out('-5016163043314935005');" style="">  22 import com.arialyy.aria.core.inf.IEntity;                                                                </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  23 import java.util.Set;                                                                                    </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  24 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  25 import java.util.concurrent.Executors;                                                                   </span>
<span  style="">  26                                                                                                          </span>
<span  style="">  27                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  28 /**                                                                                                      </span>
<span class="1321179419529258125" onmouseenter="enter('1321179419529258125');" onmouseout="out('1321179419529258125');" style="">  29  * Created by AriaL on 2017/6/30.                                                                        </span>
<span class="7496304558415279260" onmouseenter="enter('7496304558415279260');" onmouseout="out('7496304558415279260');" style="">  30  * 任务组下载工具                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  31  */                                                                                                      </span>
<span class="753905216202195114" onmouseenter="enter('753905216202195114');" onmouseout="out('753905216202195114');" style="">  32 public class DownloadGroupUtil extends AbsGroupUtil implements IUtil {                                   </span>
<span class="3933744472183840087" onmouseenter="enter('3933744472183840087');" onmouseout="out('3933744472183840087');" style="">  33   private final String TAG = &quot;DownloadGroupUtil&quot;;                                                        </span>
<span  style="">  34                                                                                                          </span>
<span class="4123530941227175815" onmouseenter="enter('4123530941227175815');" onmouseout="out('4123530941227175815');" style="">  35   private ExecutorService mInfoPool;                                                                     </span>
<span  style="">  36                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  37   /**                                                                                                    </span>
<span class="6416521976967220365" onmouseenter="enter('6416521976967220365');" onmouseout="out('6416521976967220365');" style="">  38    * 文件信息回调组                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  39    */                                                                                                    </span>
<span class="-5994431595118905059" onmouseenter="enter('-5994431595118905059');" onmouseout="out('-5994431595118905059');" style="">  40   private SparseArray&lt;OnFileInfoCallback&gt; mFileInfoCallbacks = new SparseArray&lt;&gt;();                      </span>
<span  style="">  41                                                                                                          </span>
<span class="-3731711094107651611" onmouseenter="enter('-3731711094107651611');" onmouseout="out('-3731711094107651611');" style="">  42   public DownloadGroupUtil(IDownloadGroupListener listener, DownloadGroupTaskEntity taskEntity) {        </span>
<span class="-7841553057471002442" onmouseenter="enter('-7841553057471002442');" onmouseout="out('-7841553057471002442');" style="">  43     super(listener, taskEntity);                                                                         </span>
<span class="-6453187294675473758" onmouseenter="enter('-6453187294675473758');" onmouseout="out('-6453187294675473758');" style="">  44     mInfoPool = Executors.newCachedThreadPool();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  45   }                                                                                                      </span>
<span  style="">  46                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  47   @Override                                                                                              </span>
<span class="2622303874958043271" onmouseenter="enter('2622303874958043271');" onmouseout="out('2622303874958043271');" style="">  48   public void onCancel() {                                                                               </span>
<span class="-5705545244356268786" onmouseenter="enter('-5705545244356268786');" onmouseout="out('-5705545244356268786');" style="">  49     super.onCancel();                                                                                    </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style="">  50     if (!mInfoPool.isShutdown()) {                                                                       </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style="">  51       mInfoPool.shutdown();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  52     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  53   }                                                                                                      </span>
<span  style="">  54                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  55   @Override                                                                                              </span>
<span class="-531063095242678892" onmouseenter="enter('-531063095242678892');" onmouseout="out('-531063095242678892');" style="">  56   protected void onStop() {                                                                              </span>
<span class="-4376279779571809033" onmouseenter="enter('-4376279779571809033');" onmouseout="out('-4376279779571809033');" style="">  57     super.onStop();                                                                                      </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style="">  58     if (!mInfoPool.isShutdown()) {                                                                       </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style="">  59       mInfoPool.shutdown();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  60     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  61   }                                                                                                      </span>
<span  style="">  62                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  63   @Override                                                                                              </span>
<span class="-6246497570696443466" onmouseenter="enter('-6246497570696443466');" onmouseout="out('-6246497570696443466');" style="">  64   protected void onStart() {                                                                             </span>
<span class="8068463127664630279" onmouseenter="enter('8068463127664630279');" onmouseout="out('8068463127664630279');" style="">  65     super.onStart();                                                                                     </span>
<span class="4774762395313474868" onmouseenter="enter('4774762395313474868');" onmouseout="out('4774762395313474868');" style="">  66     Set&lt;String&gt; keys = mExeMap.keySet();                                                                 </span>
<span class="-8629982182851448523" onmouseenter="enter('-8629982182851448523');" onmouseout="out('-8629982182851448523');" style="">  67     int i = 0;                                                                                           </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="">  68     for (String key : keys) {                                                                            </span>
<span class="221423537684250497" onmouseenter="enter('221423537684250497');" onmouseout="out('221423537684250497');" style="">  69       DownloadTaskEntity taskEntity = mExeMap.get(key);                                                  </span>
<span class="2875409705898122648" onmouseenter="enter('2875409705898122648');" onmouseout="out('2875409705898122648');" style="">  70       if (taskEntity != null) {                                                                          </span>
<span class="-3535177471444042692" onmouseenter="enter('-3535177471444042692');" onmouseout="out('-3535177471444042692');" style=""><abbr title="  71         if ((taskEntity.getState() != IEntity.STATE_FAIL) &amp;&amp; (taskEntity.getState() != IEntity.STATE_WAIT)) {">  71         if ((taskEntity.getState() != IEntity.STATE_FAIL) &amp;&amp; (taskEntity.getState() != IEntity.STATE_WAIT🔵</abbr></span>
<span class="6449066979252177845" onmouseenter="enter('6449066979252177845');" onmouseout="out('6449066979252177845');" style="">  72           startChildDownload(taskEntity);                                                                </span>
<span class="-4968746635634186778" onmouseenter="enter('-4968746635634186778');" onmouseout="out('-4968746635634186778');" style="">  73           i++;                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  74         } else {                                                                                         </span>
<span class="4135184626453358547" onmouseenter="enter('4135184626453358547');" onmouseout="out('4135184626453358547');" style="">  75           mInfoPool.execute(createFileInfoThread(taskEntity));                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  76         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78     }                                                                                                    </span>
<span class="-2935735094872295740" onmouseenter="enter('-2935735094872295740');" onmouseout="out('-2935735094872295740');" style="">  79     if (i == mExeMap.size()) {                                                                           </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style="">  80       startRunningFlow();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  81     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  82   }                                                                                                      </span>
<span  style="">  83                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  84   /**                                                                                                    </span>
<span class="-4547374311767626615" onmouseenter="enter('-4547374311767626615');" onmouseout="out('-4547374311767626615');" style="">  85    * 创建文件信息获取线程                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  86    */                                                                                                    </span>
<span class="5921359649843257629" onmouseenter="enter('5921359649843257629');" onmouseout="out('5921359649843257629');" style="">  87   private HttpFileInfoThread createFileInfoThread(DownloadTaskEntity taskEntity) {                       </span>
<span class="3806302679560349109" onmouseenter="enter('3806302679560349109');" onmouseout="out('3806302679560349109');" style="">  88     OnFileInfoCallback callback = mFileInfoCallbacks.get(taskEntity.hashCode());                         </span>
<span class="-5681834850649759939" onmouseenter="enter('-5681834850649759939');" onmouseout="out('-5681834850649759939');" style="">  89     if (callback == null) {                                                                              </span>
<span class="-2247249715703717317" onmouseenter="enter('-2247249715703717317');" onmouseout="out('-2247249715703717317');" style="">  90       callback = new OnFileInfoCallback() {                                                              </span>
<span class="4970948900553010157" onmouseenter="enter('4970948900553010157');" onmouseout="out('4970948900553010157');" style="">  91         int failNum = 0;                                                                                 </span>
<span  style="">  92                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  93         @Override                                                                                        </span>
<span class="5203701742309610886" onmouseenter="enter('5203701742309610886');" onmouseout="out('5203701742309610886');" style="">  94         public void onComplete(String url, int code) {                                                   </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style="">  95           DownloadTaskEntity te = mExeMap.get(url);                                                      </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style="">  96           if (te != null) {                                                                              </span>
<span class="308930838644053042" onmouseenter="enter('308930838644053042');" onmouseout="out('308930838644053042');" style="">  97             mTotalSize += te.getEntity().getFileSize();                                                  </span>
<span class="-9118376655834637322" onmouseenter="enter('-9118376655834637322');" onmouseout="out('-9118376655834637322');" style="">  98             startChildDownload(te);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99           }                                                                                              </span>
<span class="-8520114986100534454" onmouseenter="enter('-8520114986100534454');" onmouseout="out('-8520114986100534454');" style=""> 100           mInitNum++;                                                                                    </span>
<span class="81916044585977439" onmouseenter="enter('81916044585977439');" onmouseout="out('81916044585977439');" style=""> 101           if ((mInitNum + mInitFailNum) &gt;= mTaskEntity.getEntity().getSubTask().size()) {                </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style=""> 102             startRunningFlow();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103           }                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104         }                                                                                                </span>
<span  style=""> 105                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 106         @Override                                                                                        </span>
<span class="5749921648843596073" onmouseenter="enter('5749921648843596073');" onmouseout="out('5749921648843596073');" style=""> 107         public void onFail(String url, String errorMsg) {                                                </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style=""> 108           DownloadTaskEntity te = mExeMap.get(url);                                                      </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style=""> 109           if (te != null) {                                                                              </span>
<span class="-3434538459014877633" onmouseenter="enter('-3434538459014877633');" onmouseout="out('-3434538459014877633');" style=""> 110             mFailMap.put(url, te);                                                                       </span>
<span class="8595174373746499082" onmouseenter="enter('8595174373746499082');" onmouseout="out('8595174373746499082');" style=""> 111             mFileInfoCallbacks.put(te.hashCode(), this);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112           }                                                                                              </span>
<span class="-3126918587586078524" onmouseenter="enter('-3126918587586078524');" onmouseout="out('-3126918587586078524');" style=""> 113           //404链接不重试下载                                                                                   </span>
<span class="-8305438702773313808" onmouseenter="enter('-8305438702773313808');" onmouseout="out('-8305438702773313808');" style=""><abbr title=" 114           if (((failNum &lt; 10) &amp;&amp; (!errorMsg.contains(&quot;错误码：404&quot;))) &amp;&amp; (!errorMsg.contains(&quot;UnknownHostException&quot;))) {"> 114           if (((failNum &lt; 10) &amp;&amp; (!errorMsg.contains(&quot;错误码：404&quot;))) &amp;&amp; (!errorMsg.contains(&quot;UnknownHostExce🔵</abbr></span>
<span class="-7158306797275734596" onmouseenter="enter('-7158306797275734596');" onmouseout="out('-7158306797275734596');" style=""> 115             mInfoPool.execute(createFileInfoThread(te));                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 116           } else {                                                                                       </span>
<span class="-2723952096500307408" onmouseenter="enter('-2723952096500307408');" onmouseout="out('-2723952096500307408');" style=""> 117             mInitFailNum++;                                                                              </span>
<span class="-1903130545068871575" onmouseenter="enter('-1903130545068871575');" onmouseout="out('-1903130545068871575');" style=""> 118             mActualTaskNum--;                                                                            </span>
<span class="-921135963277606337" onmouseenter="enter('-921135963277606337');" onmouseout="out('-921135963277606337');" style=""> 119             if (mActualTaskNum &lt; 0) {                                                                    </span>
<span class="-7977608774674832055" onmouseenter="enter('-7977608774674832055');" onmouseout="out('-7977608774674832055');" style=""> 120               mActualTaskNum = 0;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 122           }                                                                                              </span>
<span class="-4881470894519452809" onmouseenter="enter('-4881470894519452809');" onmouseout="out('-4881470894519452809');" style=""> 123           failNum++;                                                                                     </span>
<span class="81916044585977439" onmouseenter="enter('81916044585977439');" onmouseout="out('81916044585977439');" style=""> 124           if ((mInitNum + mInitFailNum) &gt;= mTaskEntity.getEntity().getSubTask().size()) {                </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style=""> 125             startRunningFlow();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126           }                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127         }                                                                                                </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 128       };                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 129     }                                                                                                    </span>
<span class="8019628728195433582" onmouseenter="enter('8019628728195433582');" onmouseout="out('8019628728195433582');" style=""> 130     return new HttpFileInfoThread(taskEntity, callback);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132 }                                                                                                        </span>























































































































































































































































































































































































































































































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="4634392904032211814" onmouseenter="enter('4634392904032211814');" onmouseout="out('4634392904032211814');" style="">  16  package com.arialyy.aria.core.download.downloader;                                                                </span>
<span  style="">  17                                                                                                                    </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  18  import android.util.SparseArray;                                                                                  </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="">  19  import com.arialyy.aria.core.download.DownloadEntity;                                                             </span>

<span class="5290109400157436023" onmouseenter="enter('5290109400157436023');" onmouseout="out('5290109400157436023');" style="">  20  import com.arialyy.aria.core.download.DownloadGroupTaskEntity;                                                    </span>
<span class="8636089030381561336" onmouseenter="enter('8636089030381561336');" onmouseout="out('8636089030381561336');" style="">  21  import com.arialyy.aria.core.download.DownloadTaskEntity;                                                         </span>
<span class="-5016163043314935005" onmouseenter="enter('-5016163043314935005');" onmouseout="out('-5016163043314935005');" style="">  22  import com.arialyy.aria.core.inf.IEntity;                                                                         </span>
<span class="-4499301116755301031" onmouseenter="enter('-4499301116755301031');" onmouseout="out('-4499301116755301031');" style="">  23  import com.arialyy.aria.orm.DbEntity;                                                                             </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="">  24  import com.arialyy.aria.util.CommonUtil;                                                                          </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  25  import java.io.File;                                                                                              </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  26  import java.util.HashMap;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  27  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  28  import java.util.Map;                                                                                             </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  29  import java.util.Set;                                                                                             </span>
<span class="-3789567581486736748" onmouseenter="enter('-3789567581486736748');" onmouseout="out('-3789567581486736748');" style="">  30  import java.util.Timer;                                                                                           </span>
<span class="-2321797189340986544" onmouseenter="enter('-2321797189340986544');" onmouseout="out('-2321797189340986544');" style="">  31  import java.util.TimerTask;                                                                                       </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  32  import java.util.concurrent.ExecutorService;                                                                      </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  33  import java.util.concurrent.Executors;                                                                            </span>
<span  style="">  34                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  35  /**                                                                                                               </span>
<span class="1321179419529258125" onmouseenter="enter('1321179419529258125');" onmouseout="out('1321179419529258125');" style="">  36   * Created by AriaL on 2017/6/30.                                                                                 </span>
<span class="7496304558415279260" onmouseenter="enter('7496304558415279260');" onmouseout="out('7496304558415279260');" style="">  37   * 任务组下载工具                                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  38   */                                                                                                               </span>
<span class="-8786887031173396836" onmouseenter="enter('-8786887031173396836');" onmouseout="out('-8786887031173396836');" style="">  39  public class DownloadGroupUtil implements IDownloadUtil {                                                         </span>

<span class="3933744472183840087" onmouseenter="enter('3933744472183840087');" onmouseout="out('3933744472183840087');" style="">  40    private final String TAG = &quot;DownloadGroupUtil&quot;;                                                                 </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  41    /**                                                                                                             </span>
<span class="-7260919609647756984" onmouseenter="enter('-7260919609647756984');" onmouseout="out('-7260919609647756984');" style="">  42     * 任务组所有任务总大小                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  43     */                                                                                                             </span>
<span class="9047411849985216426" onmouseenter="enter('9047411849985216426');" onmouseout="out('9047411849985216426');" style="">  44    private long mTotalSize = 0;                                                                                    </span>
<span class="5356975924392872579" onmouseenter="enter('5356975924392872579');" onmouseout="out('5356975924392872579');" style="">  45    private long mCurrentLocation = 0;                                                                              </span>
<span class="4123530941227175815" onmouseenter="enter('4123530941227175815');" onmouseout="out('4123530941227175815');" style="">  46    private ExecutorService mInfoPool;                                                                              </span>
<span class="731197334835106556" onmouseenter="enter('731197334835106556');" onmouseout="out('731197334835106556');" style="">  47    private ExecutorService mExePool;                                                                               </span>
<span class="914894699435640865" onmouseenter="enter('914894699435640865');" onmouseout="out('914894699435640865');" style="">  48    private IDownloadGroupListener mListener;                                                                       </span>
<span class="-1952793536017144796" onmouseenter="enter('-1952793536017144796');" onmouseout="out('-1952793536017144796');" style="">  49    private DownloadGroupTaskEntity mTaskEntity;                                                                    </span>
<span class="-7707598964647557450" onmouseenter="enter('-7707598964647557450');" onmouseout="out('-7707598964647557450');" style="">  50    private boolean isRunning = true;                                                                               </span>
<span class="2545797703164998155" onmouseenter="enter('2545797703164998155');" onmouseout="out('2545797703164998155');" style="">  51    private Timer mTimer;                                                                                           </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  52    /**                                                                                                             </span>
<span class="6552279459011062126" onmouseenter="enter('6552279459011062126');" onmouseout="out('6552279459011062126');" style="">  53     * 初始化完成的任务书数                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  54     */                                                                                                             </span>
<span class="4057129918445122430" onmouseenter="enter('4057129918445122430');" onmouseout="out('4057129918445122430');" style="">  55    private int mInitNum = 0;                                                                                       </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  56    /**                                                                                                             </span>
<span class="5189388546664003005" onmouseenter="enter('5189388546664003005');" onmouseout="out('5189388546664003005');" style="">  57     * 初始化失败的任务数                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  58     */                                                                                                             </span>
<span class="1036771418966180244" onmouseenter="enter('1036771418966180244');" onmouseout="out('1036771418966180244');" style="">  59    private int mInitFailNum = 0;                                                                                   </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  60    /**                                                                                                             </span>
<span class="-8396872691246251646" onmouseenter="enter('-8396872691246251646');" onmouseout="out('-8396872691246251646');" style="">  61     * 保存所有没有下载完成的任务，key为下载地址                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  62     */                                                                                                             </span>
<span class="-737569427765289884" onmouseenter="enter('-737569427765289884');" onmouseout="out('-737569427765289884');" style="">  63    private Map&lt;String, DownloadTaskEntity&gt; mExeMap = new HashMap&lt;&gt;();                                              </span>
<span  style="">  64                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  65    /**                                                                                                             </span>
<span class="-2253517741290947496" onmouseenter="enter('-2253517741290947496');" onmouseout="out('-2253517741290947496');" style="">  66     * 下载失败的映射表，key为下载地址                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  67     */                                                                                                             </span>
<span class="8167805223138120322" onmouseenter="enter('8167805223138120322');" onmouseout="out('8167805223138120322');" style="">  68    private Map&lt;String, DownloadTaskEntity&gt; mFailMap = new HashMap&lt;&gt;();                                             </span>
<span  style="">  69                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  70    /**                                                                                                             </span>
<span class="-547852276695370661" onmouseenter="enter('-547852276695370661');" onmouseout="out('-547852276695370661');" style="">  71     * 下载器映射表，key为下载地址                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  72     */                                                                                                             </span>
<span class="5540399942948507826" onmouseenter="enter('5540399942948507826');" onmouseout="out('5540399942948507826');" style="">  73    private Map&lt;String, Downloader&gt; mDownloaderMap = new HashMap&lt;&gt;();                                               </span>
<span  style="">  74                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  75    /**                                                                                                             </span>
<span class="6416521976967220365" onmouseenter="enter('6416521976967220365');" onmouseout="out('6416521976967220365');" style="">  76     * 文件信息回调组                                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  77     */                                                                                                             </span>
<span class="-6850429581361218592" onmouseenter="enter('-6850429581361218592');" onmouseout="out('-6850429581361218592');" style="">  78    private SparseArray&lt;FileInfoThread.OnFileInfoCallback&gt; mFileInfoCallbacks = new SparseArray&lt;&gt;();                </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  79    /**                                                                                                             </span>
<span class="408163778228676428" onmouseenter="enter('408163778228676428');" onmouseout="out('408163778228676428');" style="">  80     * 该任务组对应的所有任务                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  81     */                                                                                                             </span>
<span class="7413500652658984374" onmouseenter="enter('7413500652658984374');" onmouseout="out('7413500652658984374');" style="">  82    private Map&lt;String, DownloadTaskEntity&gt; mTasksMap = new HashMap&lt;&gt;();                                            </span>
<span class="-3880191924085857849" onmouseenter="enter('-3880191924085857849');" onmouseout="out('-3880191924085857849');" style="">  83    //已经完成的任务数                                                                                                      </span>
<span class="1341963505009583064" onmouseenter="enter('1341963505009583064');" onmouseout="out('1341963505009583064');" style="">  84    private int mCompleteNum = 0;                                                                                   </span>
<span class="-8515839460396392680" onmouseenter="enter('-8515839460396392680');" onmouseout="out('-8515839460396392680');" style="">  85    //失败的任务数                                                                                                        </span>
<span class="-7140144646327314748" onmouseenter="enter('-7140144646327314748');" onmouseout="out('-7140144646327314748');" style="">  86    private int mFailNum = 0;                                                                                       </span>
<span class="-4984923011450582537" onmouseenter="enter('-4984923011450582537');" onmouseout="out('-4984923011450582537');" style="">  87    //实际的下载任务数                                                                                                      </span>
<span class="8294491880415829469" onmouseenter="enter('8294491880415829469');" onmouseout="out('8294491880415829469');" style="">  88    private int mActualTaskNum = 0;                                                                                 </span>

<span  style="">  89                                                                                                                    </span>
<span class="-3731711094107651611" onmouseenter="enter('-3731711094107651611');" onmouseout="out('-3731711094107651611');" style="">  90    public DownloadGroupUtil(IDownloadGroupListener listener, DownloadGroupTaskEntity taskEntity) {                 </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="">  91      mListener = listener;                                                                                         </span>
<span class="8662994215762856538" onmouseenter="enter('8662994215762856538');" onmouseout="out('8662994215762856538');" style="">  92      mTaskEntity = taskEntity;                                                                                     </span>

<span class="-6453187294675473758" onmouseenter="enter('-6453187294675473758');" onmouseout="out('-6453187294675473758');" style="">  93      mInfoPool = Executors.newCachedThreadPool();                                                                  </span>
<span class="-8484916230991476700" onmouseenter="enter('-8484916230991476700');" onmouseout="out('-8484916230991476700');" style="">  94      mExePool = Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors());                          </span>
<span class="-6102770982770606898" onmouseenter="enter('-6102770982770606898');" onmouseout="out('-6102770982770606898');" style="">  95      mActualTaskNum = mTaskEntity.entity.getSubTask().size();                                                      </span>
<span class="4623479770740533496" onmouseenter="enter('4623479770740533496');" onmouseout="out('4623479770740533496');" style="">  96      List&lt;DownloadTaskEntity&gt; tasks =                                                                              </span>
<span class="4222418289028627286" onmouseenter="enter('4222418289028627286');" onmouseout="out('4222418289028627286');" style="">  97          DbEntity.findDatas(DownloadTaskEntity.class, &quot;groupName=?&quot;, mTaskEntity.key);                             </span>
<span class="6733199802755561211" onmouseenter="enter('6733199802755561211');" onmouseout="out('6733199802755561211');" style="">  98      if (tasks != null &amp;&amp; !tasks.isEmpty()) {                                                                      </span>
<span class="-8801083781759692574" onmouseenter="enter('-8801083781759692574');" onmouseout="out('-8801083781759692574');" style="">  99        for (DownloadTaskEntity te : tasks) {                                                                       </span>
<span class="334754947706091591" onmouseenter="enter('334754947706091591');" onmouseout="out('334754947706091591');" style=""> 100          mTasksMap.put(te.getEntity().getDownloadUrl(), te);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102      }                                                                                                             </span>
<span class="8411345017327588592" onmouseenter="enter('8411345017327588592');" onmouseout="out('8411345017327588592');" style=""> 103      for (DownloadEntity entity : mTaskEntity.entity.getSubTask()) {                                               </span>
<span class="-8554155214173149752" onmouseenter="enter('-8554155214173149752');" onmouseout="out('-8554155214173149752');" style=""> 104        File file = new File(entity.getDownloadPath());                                                             </span>
<span class="5531764893385126851" onmouseenter="enter('5531764893385126851');" onmouseout="out('5531764893385126851');" style=""> 105        if (entity.getState() == IEntity.STATE_COMPLETE &amp;&amp; file.exists()) {                                         </span>
<span class="-1263526001176077168" onmouseenter="enter('-1263526001176077168');" onmouseout="out('-1263526001176077168');" style=""> 106          mCompleteNum++;                                                                                           </span>
<span class="-8520114986100534454" onmouseenter="enter('-8520114986100534454');" onmouseout="out('-8520114986100534454');" style=""> 107          mInitNum++;                                                                                               </span>
<span class="7142921377873872227" onmouseenter="enter('7142921377873872227');" onmouseout="out('7142921377873872227');" style=""> 108          mCurrentLocation += entity.getFileSize();                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 109        } else {                                                                                                    </span>
<span class="-7309973109902623255" onmouseenter="enter('-7309973109902623255');" onmouseout="out('-7309973109902623255');" style=""> 110          mExeMap.put(entity.getDownloadUrl(), createChildDownloadTask(entity));                                    </span>
<span class="-5074924053200506841" onmouseenter="enter('-5074924053200506841');" onmouseout="out('-5074924053200506841');" style=""> 111          mCurrentLocation += entity.getCurrentProgress();                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112        }                                                                                                           </span>
<span class="2295562108744303806" onmouseenter="enter('2295562108744303806');" onmouseout="out('2295562108744303806');" style=""> 113        mTotalSize += entity.getFileSize();                                                                         </span>






<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115    }                                                                                                               </span>
<span  style=""> 116                                                                                                                    </span>
<span class="-4506592131726080634" onmouseenter="enter('-4506592131726080634');" onmouseout="out('-4506592131726080634');" style=""> 117    @Override public long getFileSize() {                                                                           </span>
<span class="2123125704645203645" onmouseenter="enter('2123125704645203645');" onmouseout="out('2123125704645203645');" style=""> 118      return mTotalSize;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119    }                                                                                                               </span>
<span  style=""> 120                                                                                                                    </span>
<span class="42588745782017963" onmouseenter="enter('42588745782017963');" onmouseout="out('42588745782017963');" style=""> 121    @Override public long getCurrentLocation() {                                                                    </span>
<span class="1524502011970861445" onmouseenter="enter('1524502011970861445');" onmouseout="out('1524502011970861445');" style=""> 122      return mCurrentLocation;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123    }                                                                                                               </span>
<span  style=""> 124                                                                                                                    </span>
<span class="8514823861416132786" onmouseenter="enter('8514823861416132786');" onmouseout="out('8514823861416132786');" style=""> 125    @Override public boolean isDownloading() {                                                                      </span>
<span class="9152024351919709179" onmouseenter="enter('9152024351919709179');" onmouseout="out('9152024351919709179');" style=""> 126      return isRunning;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127    }                                                                                                               </span>
<span  style=""> 128                                                                                                                    </span>
<span class="8518544268347342740" onmouseenter="enter('8518544268347342740');" onmouseout="out('8518544268347342740');" style=""> 129    @Override public void cancelDownload() {                                                                        </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style=""> 130      closeTimer(false);                                                                                            </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style=""> 131      mListener.onCancel();                                                                                         </span>


<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style=""> 132      if (!mInfoPool.isShutdown()) {                                                                                </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style=""> 133        mInfoPool.shutdown();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134      }                                                                                                             </span>
<span class="-566362124535735919" onmouseenter="enter('-566362124535735919');" onmouseout="out('-566362124535735919');" style=""> 135      if (!mExePool.isShutdown()) {                                                                                 </span>
<span class="-9028679909484630999" onmouseenter="enter('-9028679909484630999');" onmouseout="out('-9028679909484630999');" style=""> 136        mExePool.shutdown();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137      }                                                                                                             </span>
<span  style=""> 138                                                                                                                    </span>
<span class="-121865910349791330" onmouseenter="enter('-121865910349791330');" onmouseout="out('-121865910349791330');" style=""> 139      Set&lt;String&gt; keys = mDownloaderMap.keySet();                                                                   </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style=""> 140      for (String key : keys) {                                                                                     </span>
<span class="4674592448761410649" onmouseenter="enter('4674592448761410649');" onmouseout="out('4674592448761410649');" style=""> 141        Downloader dt = mDownloaderMap.get(key);                                                                    </span>
<span class="4002339207918379493" onmouseenter="enter('4002339207918379493');" onmouseout="out('4002339207918379493');" style=""> 142        if (dt != null) {                                                                                           </span>
<span class="-6177430030980743439" onmouseenter="enter('-6177430030980743439');" onmouseout="out('-6177430030980743439');" style=""> 143          dt.cancelDownload();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145      }                                                                                                             </span>
<span class="-6812949802078178976" onmouseenter="enter('-6812949802078178976');" onmouseout="out('-6812949802078178976');" style=""> 146      delDownloadInfo();                                                                                            </span>
<span class="3736236151466185350" onmouseenter="enter('3736236151466185350');" onmouseout="out('3736236151466185350');" style=""> 147      mTaskEntity.deleteData();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148    }                                                                                                               </span>
<span  style=""> 149                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 150    /**                                                                                                             </span>
<span class="2811324672140469110" onmouseenter="enter('2811324672140469110');" onmouseout="out('2811324672140469110');" style=""> 151     * 删除所有子任务的下载信息                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 152     */                                                                                                             </span>
<span class="-7852351063311107832" onmouseenter="enter('-7852351063311107832');" onmouseout="out('-7852351063311107832');" style=""> 153    private void delDownloadInfo() {                                                                                </span>
<span class="4623479770740533496" onmouseenter="enter('4623479770740533496');" onmouseout="out('4623479770740533496');" style=""> 154      List&lt;DownloadTaskEntity&gt; tasks =                                                                              </span>
<span class="4222418289028627286" onmouseenter="enter('4222418289028627286');" onmouseout="out('4222418289028627286');" style=""> 155          DbEntity.findDatas(DownloadTaskEntity.class, &quot;groupName=?&quot;, mTaskEntity.key);                             </span>
<span class="-7059273340673847542" onmouseenter="enter('-7059273340673847542');" onmouseout="out('-7059273340673847542');" style=""> 156      if (tasks == null || tasks.isEmpty()) return;                                                                 </span>
<span class="-573879738747794463" onmouseenter="enter('-573879738747794463');" onmouseout="out('-573879738747794463');" style=""> 157      for (DownloadTaskEntity taskEntity : tasks) {                                                                 </span>
<span class="461901582083120312" onmouseenter="enter('461901582083120312');" onmouseout="out('461901582083120312');" style=""> 158        CommonUtil.delDownloadTaskConfig(taskEntity.removeFile, taskEntity);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160    }                                                                                                               </span>
<span  style=""> 161                                                                                                                    </span>
<span class="-4596234023078912379" onmouseenter="enter('-4596234023078912379');" onmouseout="out('-4596234023078912379');" style=""> 162    @Override public void stopDownload() {                                                                          </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style=""> 163      closeTimer(false);                                                                                            </span>
<span class="5167771793225547847" onmouseenter="enter('5167771793225547847');" onmouseout="out('5167771793225547847');" style=""> 164      mListener.onStop(mCurrentLocation);                                                                           </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style=""> 165      if (!mInfoPool.isShutdown()) {                                                                                </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style=""> 166        mInfoPool.shutdown();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167      }                                                                                                             </span>
<span class="-566362124535735919" onmouseenter="enter('-566362124535735919');" onmouseout="out('-566362124535735919');" style=""> 168      if (!mExePool.isShutdown()) {                                                                                 </span>
<span class="-9028679909484630999" onmouseenter="enter('-9028679909484630999');" onmouseout="out('-9028679909484630999');" style=""> 169        mExePool.shutdown();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170      }                                                                                                             </span>
<span  style=""> 171                                                                                                                    </span>
<span class="-121865910349791330" onmouseenter="enter('-121865910349791330');" onmouseout="out('-121865910349791330');" style=""> 172      Set&lt;String&gt; keys = mDownloaderMap.keySet();                                                                   </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style=""> 173      for (String key : keys) {                                                                                     </span>
<span class="4674592448761410649" onmouseenter="enter('4674592448761410649');" onmouseout="out('4674592448761410649');" style=""> 174        Downloader dt = mDownloaderMap.get(key);                                                                    </span>
<span class="4002339207918379493" onmouseenter="enter('4002339207918379493');" onmouseout="out('4002339207918379493');" style=""> 175        if (dt != null) {                                                                                           </span>
<span class="3167682315717751579" onmouseenter="enter('3167682315717751579');" onmouseout="out('3167682315717751579');" style=""> 176          dt.stopDownload();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179    }                                                                                                               </span>
<span  style=""> 180                                                                                                                    </span>
<span class="-4856178778199245062" onmouseenter="enter('-4856178778199245062');" onmouseout="out('-4856178778199245062');" style=""> 181    @Override public void startDownload() {                                                                         </span>
<span class="720656867499890795" onmouseenter="enter('720656867499890795');" onmouseout="out('720656867499890795');" style=""> 182      isRunning = true;                                                                                             </span>
<span class="-4263343811101375569" onmouseenter="enter('-4263343811101375569');" onmouseout="out('-4263343811101375569');" style=""> 183      mFailNum = 0;                                                                                                 </span>


<span class="4774762395313474868" onmouseenter="enter('4774762395313474868');" onmouseout="out('4774762395313474868');" style=""> 184      Set&lt;String&gt; keys = mExeMap.keySet();                                                                          </span>
<span class="2099174989180368882" onmouseenter="enter('2099174989180368882');" onmouseout="out('2099174989180368882');" style=""> 185      mListener.onPre();                                                                                            </span>
<span class="-8629982182851448523" onmouseenter="enter('-8629982182851448523');" onmouseout="out('-8629982182851448523');" style=""> 186      int i = 0;                                                                                                    </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style=""> 187      for (String key : keys) {                                                                                     </span>
<span class="221423537684250497" onmouseenter="enter('221423537684250497');" onmouseout="out('221423537684250497');" style=""> 188        DownloadTaskEntity taskEntity = mExeMap.get(key);                                                           </span>
<span class="2875409705898122648" onmouseenter="enter('2875409705898122648');" onmouseout="out('2875409705898122648');" style=""> 189        if (taskEntity != null) {                                                                                   </span>
<span class="3825460913713262848" onmouseenter="enter('3825460913713262848');" onmouseout="out('3825460913713262848');" style=""> 190          if (taskEntity.getState() != IEntity.STATE_FAIL                                                           </span>
<span class="4045344078755509632" onmouseenter="enter('4045344078755509632');" onmouseout="out('4045344078755509632');" style=""> 191              &amp;&amp; taskEntity.getState() != IEntity.STATE_WAIT) {                                                     </span>
<span class="6449066979252177845" onmouseenter="enter('6449066979252177845');" onmouseout="out('6449066979252177845');" style=""> 192            startChildDownload(taskEntity);                                                                         </span>
<span class="-4968746635634186778" onmouseenter="enter('-4968746635634186778');" onmouseout="out('-4968746635634186778');" style=""> 193            i++;                                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 194          } else {                                                                                                  </span>
<span class="4135184626453358547" onmouseenter="enter('4135184626453358547');" onmouseout="out('4135184626453358547');" style=""> 195            mInfoPool.execute(createFileInfoThread(taskEntity));                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198      }                                                                                                             </span>
<span class="-8434084337306400756" onmouseenter="enter('-8434084337306400756');" onmouseout="out('-8434084337306400756');" style=""> 199      if (i == mExeMap.size()) startRunningFlow();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200    }                                                                                                               </span>
<span  style=""> 201                                                                                                                    </span>
<span class="-5762688668558425600" onmouseenter="enter('-5762688668558425600');" onmouseout="out('-5762688668558425600');" style=""> 202    @Override public void resumeDownload() {                                                                        </span>
<span class="1497820413888703615" onmouseenter="enter('1497820413888703615');" onmouseout="out('1497820413888703615');" style=""> 203      startDownload();                                                                                              </span>
<span class="2432525506665579835" onmouseenter="enter('2432525506665579835');" onmouseout="out('2432525506665579835');" style=""> 204      mListener.onResume(mCurrentLocation);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 205    }                                                                                                               </span>
<span  style=""> 206                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 207    /**                                                                                                             </span>
<span class="-4547374311767626615" onmouseenter="enter('-4547374311767626615');" onmouseout="out('-4547374311767626615');" style=""> 208     * 创建文件信息获取线程                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 209     */                                                                                                             </span>
<span class="3938287834207978655" onmouseenter="enter('3938287834207978655');" onmouseout="out('3938287834207978655');" style=""> 210    private FileInfoThread createFileInfoThread(DownloadTaskEntity taskEntity) {                                    </span>
<span class="-3840222843651584707" onmouseenter="enter('-3840222843651584707');" onmouseout="out('-3840222843651584707');" style=""> 211      FileInfoThread.OnFileInfoCallback callback = mFileInfoCallbacks.get(taskEntity.hashCode());                   </span>


<span  style=""> 212                                                                                                                    </span>
<span class="-5681834850649759939" onmouseenter="enter('-5681834850649759939');" onmouseout="out('-5681834850649759939');" style=""> 213      if (callback == null) {                                                                                       </span>
<span class="5413682592871947948" onmouseenter="enter('5413682592871947948');" onmouseout="out('5413682592871947948');" style=""> 214        callback = new FileInfoThread.OnFileInfoCallback() {                                                        </span>

<span class="4970948900553010157" onmouseenter="enter('4970948900553010157');" onmouseout="out('4970948900553010157');" style=""> 215          int failNum = 0;                                                                                          </span>
<span  style=""> 216                                                                                                                    </span>
<span class="-5145950279106892584" onmouseenter="enter('-5145950279106892584');" onmouseout="out('-5145950279106892584');" style=""> 217          @Override public void onComplete(String url, int code) {                                                  </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style=""> 218            DownloadTaskEntity te = mExeMap.get(url);                                                               </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style=""> 219            if (te != null) {                                                                                       </span>
<span class="308930838644053042" onmouseenter="enter('308930838644053042');" onmouseout="out('308930838644053042');" style=""> 220              mTotalSize += te.getEntity().getFileSize();                                                           </span>
<span class="-9118376655834637322" onmouseenter="enter('-9118376655834637322');" onmouseout="out('-9118376655834637322');" style=""> 221              startChildDownload(te);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222            }                                                                                                       </span>
<span class="-8520114986100534454" onmouseenter="enter('-8520114986100534454');" onmouseout="out('-8520114986100534454');" style=""> 223            mInitNum++;                                                                                             </span>
<span class="-234450023538178691" onmouseenter="enter('-234450023538178691');" onmouseout="out('-234450023538178691');" style=""> 224            if (mInitNum + mInitFailNum &gt;= mTaskEntity.getEntity().getSubTask().size()) {                           </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style=""> 225              startRunningFlow();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226            }                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227          }                                                                                                         </span>
<span  style=""> 228                                                                                                                    </span>
<span class="3522384484183979639" onmouseenter="enter('3522384484183979639');" onmouseout="out('3522384484183979639');" style=""> 229          @Override public void onFail(String url, String errorMsg) {                                               </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style=""> 230            DownloadTaskEntity te = mExeMap.get(url);                                                               </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style=""> 231            if (te != null) {                                                                                       </span>
<span class="-3434538459014877633" onmouseenter="enter('-3434538459014877633');" onmouseout="out('-3434538459014877633');" style=""> 232              mFailMap.put(url, te);                                                                                </span>
<span class="8595174373746499082" onmouseenter="enter('8595174373746499082');" onmouseout="out('8595174373746499082');" style=""> 233              mFileInfoCallbacks.put(te.hashCode(), this);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234            }                                                                                                       </span>
<span class="-3126918587586078524" onmouseenter="enter('-3126918587586078524');" onmouseout="out('-3126918587586078524');" style=""> 235            //404链接不重试下载                                                                                            </span>
<span class="-4716929270045128613" onmouseenter="enter('-4716929270045128613');" onmouseout="out('-4716929270045128613');" style=""> 236            if (failNum &lt; 10 &amp;&amp; !errorMsg.contains(&quot;错误码：404&quot;) &amp;&amp; !errorMsg.contains(                                </span>
<span class="5193671628245366377" onmouseenter="enter('5193671628245366377');" onmouseout="out('5193671628245366377');" style=""> 237                &quot;UnknownHostException&quot;)) {                                                                          </span>
<span class="-7158306797275734596" onmouseenter="enter('-7158306797275734596');" onmouseout="out('-7158306797275734596');" style=""> 238              mInfoPool.execute(createFileInfoThread(te));                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 239            } else {                                                                                                </span>
<span class="-2723952096500307408" onmouseenter="enter('-2723952096500307408');" onmouseout="out('-2723952096500307408');" style=""> 240              mInitFailNum++;                                                                                       </span>
<span class="-1903130545068871575" onmouseenter="enter('-1903130545068871575');" onmouseout="out('-1903130545068871575');" style=""> 241              mActualTaskNum--;                                                                                     </span>
<span class="-7251641660257607121" onmouseenter="enter('-7251641660257607121');" onmouseout="out('-7251641660257607121');" style=""> 242              if (mActualTaskNum &lt; 0) mActualTaskNum = 0;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243            }                                                                                                       </span>
<span class="-4881470894519452809" onmouseenter="enter('-4881470894519452809');" onmouseout="out('-4881470894519452809');" style=""> 244            failNum++;                                                                                              </span>
<span class="-234450023538178691" onmouseenter="enter('-234450023538178691');" onmouseout="out('-234450023538178691');" style=""> 245            if (mInitNum + mInitFailNum &gt;= mTaskEntity.getEntity().getSubTask().size()) {                           </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style=""> 246              startRunningFlow();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247            }                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248          }                                                                                                         </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 249        };                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250      }                                                                                                             </span>
<span class="-6395675362803657436" onmouseenter="enter('-6395675362803657436');" onmouseout="out('-6395675362803657436');" style=""> 251      return new FileInfoThread(taskEntity, callback);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252    }                                                                                                               </span>
<span  style=""> 253                                                                                                                    </span>
<span class="-9101626023155881186" onmouseenter="enter('-9101626023155881186');" onmouseout="out('-9101626023155881186');" style=""> 254    private void closeTimer(boolean isRunning) {                                                                    </span>
<span class="5231425380397002866" onmouseenter="enter('5231425380397002866');" onmouseout="out('5231425380397002866');" style=""> 255      this.isRunning = isRunning;                                                                                   </span>
<span class="-4343220603110256261" onmouseenter="enter('-4343220603110256261');" onmouseout="out('-4343220603110256261');" style=""> 256      if (mTimer != null) {                                                                                         </span>
<span class="6506490333649261220" onmouseenter="enter('6506490333649261220');" onmouseout="out('6506490333649261220');" style=""> 257        mTimer.purge();                                                                                             </span>
<span class="3936422701741233911" onmouseenter="enter('3936422701741233911');" onmouseout="out('3936422701741233911');" style=""> 258        mTimer.cancel();                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260    }                                                                                                               </span>
<span  style=""> 261                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 262    /**                                                                                                             </span>
<span class="-5673927707437898965" onmouseenter="enter('-5673927707437898965');" onmouseout="out('-5673927707437898965');" style=""> 263     * 开始进度流程                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 264     */                                                                                                             </span>
<span class="-8924856940436287042" onmouseenter="enter('-8924856940436287042');" onmouseout="out('-8924856940436287042');" style=""> 265    private void startRunningFlow() {                                                                               </span>
<span class="-4556811986576627418" onmouseenter="enter('-4556811986576627418');" onmouseout="out('-4556811986576627418');" style=""> 266      closeTimer(true);                                                                                             </span>
<span class="3412375698150633050" onmouseenter="enter('3412375698150633050');" onmouseout="out('3412375698150633050');" style=""> 267      mListener.onPostPre(mTotalSize);                                                                              </span>
<span class="-6131324328119540818" onmouseenter="enter('-6131324328119540818');" onmouseout="out('-6131324328119540818');" style=""> 268      mListener.onStart(mCurrentLocation);                                                                          </span>
<span class="9064905857115753880" onmouseenter="enter('9064905857115753880');" onmouseout="out('9064905857115753880');" style=""> 269      mTimer = new Timer(true);                                                                                     </span>
<span class="1767883212426599488" onmouseenter="enter('1767883212426599488');" onmouseout="out('1767883212426599488');" style=""> 270      mTimer.schedule(new TimerTask() {                                                                             </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 271        @Override public void run() {                                                                               </span>
<span class="-7587988653908595463" onmouseenter="enter('-7587988653908595463');" onmouseout="out('-7587988653908595463');" style=""> 272          if (!isRunning) {                                                                                         </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style=""> 273            closeTimer(false);                                                                                      </span>
<span class="-427374670960232487" onmouseenter="enter('-427374670960232487');" onmouseout="out('-427374670960232487');" style=""> 274          } else if (mCurrentLocation &gt;= 0) {                                                                       </span>
<span class="-778237943185100423" onmouseenter="enter('-778237943185100423');" onmouseout="out('-778237943185100423');" style=""> 275            mListener.onProgress(mCurrentLocation);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277        }                                                                                                           </span>
<span class="-7052623657160678735" onmouseenter="enter('-7052623657160678735');" onmouseout="out('-7052623657160678735');" style=""> 278      }, 0, 1000);                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279    }                                                                                                               </span>
<span  style=""> 280                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 281    /**                                                                                                             </span>
<span class="-2915045833374537336" onmouseenter="enter('-2915045833374537336');" onmouseout="out('-2915045833374537336');" style=""> 282     * 启动子任务下载器                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 283     */                                                                                                             </span>
<span class="-4814508883416810996" onmouseenter="enter('-4814508883416810996');" onmouseout="out('-4814508883416810996');" style=""> 284    private void startChildDownload(DownloadTaskEntity taskEntity) {                                                </span>
<span class="-5214201566114754807" onmouseenter="enter('-5214201566114754807');" onmouseout="out('-5214201566114754807');" style=""> 285      ChildDownloadListener listener = new ChildDownloadListener(taskEntity);                                       </span>
<span class="-7880859510389460827" onmouseenter="enter('-7880859510389460827');" onmouseout="out('-7880859510389460827');" style=""> 286      Downloader dt = new Downloader(listener, taskEntity);                                                         </span>
<span class="-1715913392464468508" onmouseenter="enter('-1715913392464468508');" onmouseout="out('-1715913392464468508');" style=""> 287      mDownloaderMap.put(taskEntity.getEntity().getDownloadUrl(), dt);                                              </span>
<span class="-1714638633517896439" onmouseenter="enter('-1714638633517896439');" onmouseout="out('-1714638633517896439');" style=""> 288      if (mExePool.isShutdown()) return;                                                                            </span>
<span class="-268914413429947469" onmouseenter="enter('-268914413429947469');" onmouseout="out('-268914413429947469');" style=""> 289      mExePool.execute(dt);                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290    }                                                                                                               </span>
<span  style=""> 291                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 292    /**                                                                                                             </span>
<span class="6709099824921226015" onmouseenter="enter('6709099824921226015');" onmouseout="out('6709099824921226015');" style=""> 293     * 创建子任务下载信息                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 294     */                                                                                                             </span>
<span class="2231847697649480847" onmouseenter="enter('2231847697649480847');" onmouseout="out('2231847697649480847');" style=""> 295    private DownloadTaskEntity createChildDownloadTask(DownloadEntity entity) {                                     </span>
<span class="-5250283806161329316" onmouseenter="enter('-5250283806161329316');" onmouseout="out('-5250283806161329316');" style=""> 296      DownloadTaskEntity taskEntity = mTasksMap.get(entity.getDownloadUrl());                                       </span>
<span class="2875409705898122648" onmouseenter="enter('2875409705898122648');" onmouseout="out('2875409705898122648');" style=""> 297      if (taskEntity != null) {                                                                                     </span>
<span class="-6847855421842186847" onmouseenter="enter('-6847855421842186847');" onmouseout="out('-6847855421842186847');" style=""> 298        taskEntity.entity = entity;                                                                                 </span>
<span class="-9104005150390610221" onmouseenter="enter('-9104005150390610221');" onmouseout="out('-9104005150390610221');" style=""> 299        return taskEntity;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300      }                                                                                                             </span>
<span class="-4885480137579962058" onmouseenter="enter('-4885480137579962058');" onmouseout="out('-4885480137579962058');" style=""> 301      taskEntity = new DownloadTaskEntity();                                                                        </span>
<span class="-6847855421842186847" onmouseenter="enter('-6847855421842186847');" onmouseout="out('-6847855421842186847');" style=""> 302      taskEntity.entity = entity;                                                                                   </span>
<span class="-3732720384716012622" onmouseenter="enter('-3732720384716012622');" onmouseout="out('-3732720384716012622');" style=""> 303      taskEntity.headers = mTaskEntity.headers;                                                                     </span>
<span class="-5768494270506887606" onmouseenter="enter('-5768494270506887606');" onmouseout="out('-5768494270506887606');" style=""> 304      taskEntity.requestEnum = mTaskEntity.requestEnum;                                                             </span>
<span class="6168081707298186636" onmouseenter="enter('6168081707298186636');" onmouseout="out('6168081707298186636');" style=""> 305      taskEntity.redirectUrlKey = mTaskEntity.redirectUrlKey;                                                       </span>
<span class="3156827566400786541" onmouseenter="enter('3156827566400786541');" onmouseout="out('3156827566400786541');" style=""> 306      taskEntity.removeFile = mTaskEntity.removeFile;                                                               </span>
<span class="-1864665886871527246" onmouseenter="enter('-1864665886871527246');" onmouseout="out('-1864665886871527246');" style=""> 307      taskEntity.groupName = mTaskEntity.key;                                                                       </span>
<span class="-5806686039329624679" onmouseenter="enter('-5806686039329624679');" onmouseout="out('-5806686039329624679');" style=""> 308      taskEntity.isGroupTask = true;                                                                                </span>
<span class="1590775701393149207" onmouseenter="enter('1590775701393149207');" onmouseout="out('1590775701393149207');" style=""> 309      taskEntity.key = entity.getDownloadPath();                                                                    </span>
<span class="6178904090013830116" onmouseenter="enter('6178904090013830116');" onmouseout="out('6178904090013830116');" style=""> 310      taskEntity.save();                                                                                            </span>
<span class="-9104005150390610221" onmouseenter="enter('-9104005150390610221');" onmouseout="out('-9104005150390610221');" style=""> 311      return taskEntity;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312    }                                                                                                               </span>
<span  style=""> 313                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 314    /**                                                                                                             </span>
<span class="7953531489350582006" onmouseenter="enter('7953531489350582006');" onmouseout="out('7953531489350582006');" style=""> 315     * 子任务事件监听                                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 316     */                                                                                                             </span>
<span class="-3470753416804816360" onmouseenter="enter('-3470753416804816360');" onmouseout="out('-3470753416804816360');" style=""> 317    private class ChildDownloadListener implements IDownloadListener {                                              </span>
<span  style=""> 318                                                                                                                    </span>
<span class="1934457291382022470" onmouseenter="enter('1934457291382022470');" onmouseout="out('1934457291382022470');" style=""> 319      DownloadTaskEntity taskEntity;                                                                                </span>
<span class="-5258622463362253406" onmouseenter="enter('-5258622463362253406');" onmouseout="out('-5258622463362253406');" style=""> 320      DownloadEntity entity;                                                                                        </span>
<span  style=""> 321                                                                                                                    </span>
<span class="5046313540994813291" onmouseenter="enter('5046313540994813291');" onmouseout="out('5046313540994813291');" style=""> 322      long lastLen = 0;                                                                                             </span>
<span  style=""> 323                                                                                                                    </span>
<span class="-4385074185507416044" onmouseenter="enter('-4385074185507416044');" onmouseout="out('-4385074185507416044');" style=""> 324      ChildDownloadListener(DownloadTaskEntity entity) {                                                            </span>
<span class="1703855892247108918" onmouseenter="enter('1703855892247108918');" onmouseout="out('1703855892247108918');" style=""> 325        this.taskEntity = entity;                                                                                   </span>
<span class="-1050912213241719894" onmouseenter="enter('-1050912213241719894');" onmouseout="out('-1050912213241719894');" style=""> 326        this.entity = taskEntity.getEntity();                                                                       </span>
<span class="6735191672939573635" onmouseenter="enter('6735191672939573635');" onmouseout="out('6735191672939573635');" style=""> 327        lastLen = this.entity.getCurrentProgress();                                                                 </span>
<span class="4615984595129482352" onmouseenter="enter('4615984595129482352');" onmouseout="out('4615984595129482352');" style=""> 328        this.entity.setFailNum(0);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 329      }                                                                                                             </span>
<span  style=""> 330                                                                                                                    </span>
<span class="1941248740392522719" onmouseenter="enter('1941248740392522719');" onmouseout="out('1941248740392522719');" style=""> 331      @Override public void onPre() {                                                                               </span>
<span class="1272045713932667636" onmouseenter="enter('1272045713932667636');" onmouseout="out('1272045713932667636');" style=""> 332        saveData(IEntity.STATE_PRE, -1);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 333      }                                                                                                             </span>
<span  style=""> 334                                                                                                                    </span>
<span class="-6235441032293659444" onmouseenter="enter('-6235441032293659444');" onmouseout="out('-6235441032293659444');" style=""> 335      @Override public void onPostPre(long fileSize) {                                                              </span>
<span class="-8919115203469377593" onmouseenter="enter('-8919115203469377593');" onmouseout="out('-8919115203469377593');" style=""> 336        entity.setFileSize(fileSize);                                                                               </span>
<span class="-8129687735136084433" onmouseenter="enter('-8129687735136084433');" onmouseout="out('-8129687735136084433');" style=""> 337        entity.setConvertFileSize(CommonUtil.formatFileSize(fileSize));                                             </span>
<span class="-7950482897387591002" onmouseenter="enter('-7950482897387591002');" onmouseout="out('-7950482897387591002');" style=""> 338        saveData(IEntity.STATE_POST_PRE, -1);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339      }                                                                                                             </span>
<span  style=""> 340                                                                                                                    </span>
<span class="8211923352965833527" onmouseenter="enter('8211923352965833527');" onmouseout="out('8211923352965833527');" style=""> 341      @Override public void onResume(long resumeLocation) {                                                         </span>
<span class="2291762294641027919" onmouseenter="enter('2291762294641027919');" onmouseout="out('2291762294641027919');" style=""> 342        saveData(IEntity.STATE_POST_PRE, IEntity.STATE_RUNNING);                                                    </span>
<span class="8171258845364215777" onmouseenter="enter('8171258845364215777');" onmouseout="out('8171258845364215777');" style=""> 343        lastLen = resumeLocation;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 344      }                                                                                                             </span>
<span  style=""> 345                                                                                                                    </span>
<span class="-3498891166253305351" onmouseenter="enter('-3498891166253305351');" onmouseout="out('-3498891166253305351');" style=""> 346      @Override public void onStart(long startLocation) {                                                           </span>
<span class="2291762294641027919" onmouseenter="enter('2291762294641027919');" onmouseout="out('2291762294641027919');" style=""> 347        saveData(IEntity.STATE_POST_PRE, IEntity.STATE_RUNNING);                                                    </span>
<span class="-6451191897379263867" onmouseenter="enter('-6451191897379263867');" onmouseout="out('-6451191897379263867');" style=""> 348        lastLen = startLocation;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349      }                                                                                                             </span>
<span  style=""> 350                                                                                                                    </span>
<span class="-7946972766620409893" onmouseenter="enter('-7946972766620409893');" onmouseout="out('-7946972766620409893');" style=""> 351      @Override public void onProgress(long currentLocation) {                                                      </span>
<span class="-6788340243894418006" onmouseenter="enter('-6788340243894418006');" onmouseout="out('-6788340243894418006');" style=""> 352        long speed = currentLocation - lastLen;                                                                     </span>
<span class="-306662688114664893" onmouseenter="enter('-306662688114664893');" onmouseout="out('-306662688114664893');" style=""> 353        mCurrentLocation += speed;                                                                                  </span>
<span class="-2754998682014897103" onmouseenter="enter('-2754998682014897103');" onmouseout="out('-2754998682014897103');" style=""> 354        lastLen = currentLocation;                                                                                  </span>
<span class="-4238976656134225029" onmouseenter="enter('-4238976656134225029');" onmouseout="out('-4238976656134225029');" style=""> 355        entity.setCurrentProgress(currentLocation);                                                                 </span>
<span class="3220981239855838635" onmouseenter="enter('3220981239855838635');" onmouseout="out('3220981239855838635');" style=""> 356        handleSpeed(speed);                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357      }                                                                                                             </span>
<span  style=""> 358                                                                                                                    </span>
<span class="3409726051444324452" onmouseenter="enter('3409726051444324452');" onmouseout="out('3409726051444324452');" style=""> 359      @Override public void onStop(long stopLocation) {                                                             </span>
<span class="-1696356608019189548" onmouseenter="enter('-1696356608019189548');" onmouseout="out('-1696356608019189548');" style=""> 360        saveData(IEntity.STATE_STOP, stopLocation);                                                                 </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style=""> 361        handleSpeed(0);                                                                                             </span>
<span class="-5925177778340562463" onmouseenter="enter('-5925177778340562463');" onmouseout="out('-5925177778340562463');" style=""> 362        mListener.onSubStop(entity);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363      }                                                                                                             </span>
<span  style=""> 364                                                                                                                    </span>
<span class="2093106455269248536" onmouseenter="enter('2093106455269248536');" onmouseout="out('2093106455269248536');" style=""> 365      @Override public void onCancel() {                                                                            </span>
<span class="-8209498279616463234" onmouseenter="enter('-8209498279616463234');" onmouseout="out('-8209498279616463234');" style=""> 366        saveData(IEntity.STATE_CANCEL, -1);                                                                         </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style=""> 367        handleSpeed(0);                                                                                             </span>
<span class="-2639925523011962937" onmouseenter="enter('-2639925523011962937');" onmouseout="out('-2639925523011962937');" style=""> 368        mListener.onSubCancel(entity);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369      }                                                                                                             </span>
<span  style=""> 370                                                                                                                    </span>
<span class="7400813110786944810" onmouseenter="enter('7400813110786944810');" onmouseout="out('7400813110786944810');" style=""> 371      @Override public void onComplete() {                                                                          </span>
<span class="-4243478454233770036" onmouseenter="enter('-4243478454233770036');" onmouseout="out('-4243478454233770036');" style=""> 372        saveData(IEntity.STATE_COMPLETE, entity.getFileSize());                                                     </span>
<span class="-1263526001176077168" onmouseenter="enter('-1263526001176077168');" onmouseout="out('-1263526001176077168');" style=""> 373        mCompleteNum++;                                                                                             </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style=""> 374        handleSpeed(0);                                                                                             </span>
<span class="-2907962166797260638" onmouseenter="enter('-2907962166797260638');" onmouseout="out('-2907962166797260638');" style=""> 375        mListener.onSubComplete(entity);                                                                            </span>
<span class="-6363872878771524946" onmouseenter="enter('-6363872878771524946');" onmouseout="out('-6363872878771524946');" style=""> 376        //如果子任务完成的数量和总任务数一致，表示任务组任务已经完成                                                                             </span>
<span class="-3459195755403894456" onmouseenter="enter('-3459195755403894456');" onmouseout="out('-3459195755403894456');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 377 -      if (mCompleteNum &gt;= mTaskEntity.getEntity().getSubTask().size()){                                           </span>
<span class="7845605175596662348" onmouseenter="enter('7845605175596662348');" onmouseout="out('7845605175596662348');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 378 +      if (mCompleteNum &gt;= mTaskEntity.getEntity().getSubTask().size()) {                                          </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style=""> 379          closeTimer(false);                                                                                        </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 380          mListener.onComplete();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 381 -      }                                                                                                           </span>
<span class="-8854761308402599798" onmouseenter="enter('-8854761308402599798');" onmouseout="out('-8854761308402599798');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 382 -      //如果子任务完成数量加上失败的数量和总任务数一致，则任务组停止下载                                                                          </span>
<span class="-4400482220810116081" onmouseenter="enter('-4400482220810116081');" onmouseout="out('-4400482220810116081');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 383 -      if (mCompleteNum + mFailNum &gt;= mActualTaskNum) {                                                            </span>
<span class="3397040530661527737" onmouseenter="enter('3397040530661527737');" onmouseout="out('3397040530661527737');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 384 +      } else if (mCompleteNum + mFailNum &gt;= mActualTaskNum) {                                                     </span>
<span class="-8854761308402599798" onmouseenter="enter('-8854761308402599798');" onmouseout="out('-8854761308402599798');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 385 +        //如果子任务完成数量加上失败的数量和总任务数一致，则任务组停止下载                                                                        </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style=""> 386          closeTimer(false);                                                                                        </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 387          mListener.onComplete();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 389      }                                                                                                             </span>
<span  style=""> 390                                                                                                                    </span>
<span class="-8845666459040584461" onmouseenter="enter('-8845666459040584461');" onmouseout="out('-8845666459040584461');" style=""> 391      @Override public void onFail() {                                                                              </span>
<span class="-1614602823543137763" onmouseenter="enter('-1614602823543137763');" onmouseout="out('-1614602823543137763');" style=""> 392        entity.setFailNum(entity.getFailNum() + 1);                                                                 </span>
<span class="9173216667172088818" onmouseenter="enter('9173216667172088818');" onmouseout="out('9173216667172088818');" style=""> 393        saveData(IEntity.STATE_FAIL, lastLen);                                                                      </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style=""> 394        handleSpeed(0);                                                                                             </span>
<span class="2616907991847077571" onmouseenter="enter('2616907991847077571');" onmouseout="out('2616907991847077571');" style=""> 395        reTry();                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 396      }                                                                                                             </span>
<span  style=""> 397                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 398      /**                                                                                                           </span>
<span class="9094883438601628482" onmouseenter="enter('9094883438601628482');" onmouseout="out('9094883438601628482');" style=""> 399       * 失败后重试下载，如果失败次数超过5次，不再重试                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 400       */                                                                                                           </span>
<span class="-6307491174755509331" onmouseenter="enter('-6307491174755509331');" onmouseout="out('-6307491174755509331');" style=""> 401      private void reTry() {                                                                                        </span>
<span class="2413557230396081886" onmouseenter="enter('2413557230396081886');" onmouseout="out('2413557230396081886');" style=""> 402        if (entity.getFailNum() &lt; 5) {                                                                              </span>
<span class="3130304206991829788" onmouseenter="enter('3130304206991829788');" onmouseout="out('3130304206991829788');" style=""> 403          reStartTask();                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 404        } else {                                                                                                    </span>
<span class="-4418339448232441007" onmouseenter="enter('-4418339448232441007');" onmouseout="out('-4418339448232441007');" style=""> 405          mFailNum++;                                                                                               </span>
<span class="-8499931761036179208" onmouseenter="enter('-8499931761036179208');" onmouseout="out('-8499931761036179208');" style=""> 406          mListener.onSubFail(entity);                                                                              </span>
<span class="-5088134094962551809" onmouseenter="enter('-5088134094962551809');" onmouseout="out('-5088134094962551809');" style=""> 407          //如果失败的任务数大于实际的下载任务数，任务组停止下载                                                                              </span>
<span class="-7579643381750577546" onmouseenter="enter('-7579643381750577546');" onmouseout="out('-7579643381750577546');" style=""> 408          if (mFailNum &gt;= mActualTaskNum) {                                                                         </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style=""> 409            closeTimer(false);                                                                                      </span>
<span class="5167771793225547847" onmouseenter="enter('5167771793225547847');" onmouseout="out('5167771793225547847');" style=""> 410            mListener.onStop(mCurrentLocation);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 411          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 413      }                                                                                                             </span>
<span  style=""> 414                                                                                                                    </span>
<span class="-9166659205038143534" onmouseenter="enter('-9166659205038143534');" onmouseout="out('-9166659205038143534');" style=""> 415      private void reStartTask() {                                                                                  </span>
<span class="694224692856620004" onmouseenter="enter('694224692856620004');" onmouseout="out('694224692856620004');" style=""> 416        Timer timer = new Timer();                                                                                  </span>
<span class="-3995857028562557665" onmouseenter="enter('-3995857028562557665');" onmouseout="out('-3995857028562557665');" style=""> 417        timer.schedule(new TimerTask() {                                                                            </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 418          @Override public void run() {                                                                             </span>
<span class="-915554303021644808" onmouseenter="enter('-915554303021644808');" onmouseout="out('-915554303021644808');" style=""> 419            Downloader dt = mDownloaderMap.get(entity.getDownloadUrl());                                            </span>
<span class="8054045842810821752" onmouseenter="enter('8054045842810821752');" onmouseout="out('8054045842810821752');" style=""> 420            dt.startDownload();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421          }                                                                                                         </span>
<span class="1359862179938126399" onmouseenter="enter('1359862179938126399');" onmouseout="out('1359862179938126399');" style=""> 422        }, 3000);                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 423      }                                                                                                             </span>
<span  style=""> 424                                                                                                                    </span>
<span class="7889271447688685611" onmouseenter="enter('7889271447688685611');" onmouseout="out('7889271447688685611');" style=""> 425      private void handleSpeed(long speed) {                                                                        </span>
<span class="-8903176931212217262" onmouseenter="enter('-8903176931212217262');" onmouseout="out('-8903176931212217262');" style=""> 426        entity.setSpeed(speed);                                                                                     </span>
<span class="-458871634303822896" onmouseenter="enter('-458871634303822896');" onmouseout="out('-458871634303822896');" style=""> 427        entity.setConvertSpeed(speed &lt;= 0 ? &quot;&quot; : CommonUtil.formatFileSize(speed) + &quot;/s&quot;);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 428      }                                                                                                             </span>
<span  style=""> 429                                                                                                                    </span>
<span class="-8417795030437306969" onmouseenter="enter('-8417795030437306969');" onmouseout="out('-8417795030437306969');" style=""> 430      private void saveData(int state, long location) {                                                             </span>
<span class="1870432086074469274" onmouseenter="enter('1870432086074469274');" onmouseout="out('1870432086074469274');" style=""> 431        entity.setState(state);                                                                                     </span>
<span class="5476417475415693432" onmouseenter="enter('5476417475415693432');" onmouseout="out('5476417475415693432');" style=""> 432        entity.setComplete(state == IEntity.STATE_COMPLETE);                                                        </span>
<span class="-1375586946810284641" onmouseenter="enter('-1375586946810284641');" onmouseout="out('-1375586946810284641');" style=""> 433        if (entity.isComplete()) {                                                                                  </span>
<span class="7860072371622563794" onmouseenter="enter('7860072371622563794');" onmouseout="out('7860072371622563794');" style=""> 434          entity.setCompleteTime(System.currentTimeMillis());                                                       </span>
<span class="-417755752443399839" onmouseenter="enter('-417755752443399839');" onmouseout="out('-417755752443399839');" style=""> 435          entity.setCurrentProgress(entity.getFileSize());                                                          </span>
<span class="-4932930723349285601" onmouseenter="enter('-4932930723349285601');" onmouseout="out('-4932930723349285601');" style=""> 436        } else if (location &gt; 0) {                                                                                  </span>
<span class="8919645422588846117" onmouseenter="enter('8919645422588846117');" onmouseout="out('8919645422588846117');" style=""> 437          entity.setCurrentProgress(location);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 438        }                                                                                                           </span>
<span class="-733466174510760140" onmouseenter="enter('-733466174510760140');" onmouseout="out('-733466174510760140');" style=""> 439        entity.update();                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 440      }                                                                                                             </span>
<span  style=""> 441                                                                                                                    </span>
<span class="-4067662255690266791" onmouseenter="enter('-4067662255690266791');" onmouseout="out('-4067662255690266791');" style=""> 442      @Override public void supportBreakpoint(boolean support) {                                                    </span>
<span  style=""> 443                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444      }                                                                                                             </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 445    }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 446  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="4634392904032211814" onmouseenter="enter('4634392904032211814');" onmouseout="out('4634392904032211814');" style="">  16  package com.arialyy.aria.core.download.downloader;                                                                </span>
<span  style="">  17                                                                                                                    </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  18  import android.util.SparseArray;                                                                                  </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  19 -import com.arialyy.aria.core.download.DownloadEntity;                                                             </span>
<span class="-3094174390533083180" onmouseenter="enter('-3094174390533083180');" onmouseout="out('-3094174390533083180');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  20 +import com.arialyy.aria.core.common.IUtil;                                                                        </span>
<span class="5290109400157436023" onmouseenter="enter('5290109400157436023');" onmouseout="out('5290109400157436023');" style="">  21  import com.arialyy.aria.core.download.DownloadGroupTaskEntity;                                                    </span>
<span class="8636089030381561336" onmouseenter="enter('8636089030381561336');" onmouseout="out('8636089030381561336');" style="">  22  import com.arialyy.aria.core.download.DownloadTaskEntity;                                                         </span>
<span class="-5016163043314935005" onmouseenter="enter('-5016163043314935005');" onmouseout="out('-5016163043314935005');" style="">  23  import com.arialyy.aria.core.inf.IEntity;                                                                         </span>
<span class="-4499301116755301031" onmouseenter="enter('-4499301116755301031');" onmouseout="out('-4499301116755301031');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  24 -import com.arialyy.aria.orm.DbEntity;                                                                             </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  25 -import com.arialyy.aria.util.CommonUtil;                                                                          </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  26 -import java.io.File;                                                                                              </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  27 -import java.util.HashMap;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  28 -import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  29 -import java.util.Map;                                                                                             </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  30  import java.util.Set;                                                                                             </span>
<span class="-3789567581486736748" onmouseenter="enter('-3789567581486736748');" onmouseout="out('-3789567581486736748');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  31 -import java.util.Timer;                                                                                           </span>
<span class="-2321797189340986544" onmouseenter="enter('-2321797189340986544');" onmouseout="out('-2321797189340986544');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  32 -import java.util.TimerTask;                                                                                       </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  33  import java.util.concurrent.ExecutorService;                                                                      </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  34  import java.util.concurrent.Executors;                                                                            </span>
<span  style="">  35                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  36  /**                                                                                                               </span>
<span class="1321179419529258125" onmouseenter="enter('1321179419529258125');" onmouseout="out('1321179419529258125');" style="">  37   * Created by AriaL on 2017/6/30.                                                                                 </span>
<span class="7496304558415279260" onmouseenter="enter('7496304558415279260');" onmouseout="out('7496304558415279260');" style="">  38   * 任务组下载工具                                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  39   */                                                                                                               </span>
<span class="-8786887031173396836" onmouseenter="enter('-8786887031173396836');" onmouseout="out('-8786887031173396836');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  40 -public class DownloadGroupUtil implements IDownloadUtil {                                                         </span>
<span class="753905216202195114" onmouseenter="enter('753905216202195114');" onmouseout="out('753905216202195114');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  41 +public class DownloadGroupUtil extends AbsGroupUtil implements IUtil {                                            </span>
<span class="3933744472183840087" onmouseenter="enter('3933744472183840087');" onmouseout="out('3933744472183840087');" style="">  42    private final String TAG = &quot;DownloadGroupUtil&quot;;                                                                 </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  43 -  /**                                                                                                             </span>
<span class="-7260919609647756984" onmouseenter="enter('-7260919609647756984');" onmouseout="out('-7260919609647756984');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  44 -   * 任务组所有任务总大小                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  45 -   */                                                                                                             </span>
<span class="9047411849985216426" onmouseenter="enter('9047411849985216426');" onmouseout="out('9047411849985216426');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  46 -  private long mTotalSize = 0;                                                                                    </span>
<span class="5356975924392872579" onmouseenter="enter('5356975924392872579');" onmouseout="out('5356975924392872579');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  47 -  private long mCurrentLocation = 0;                                                                              </span>
<span class="4123530941227175815" onmouseenter="enter('4123530941227175815');" onmouseout="out('4123530941227175815');" style="">  48    private ExecutorService mInfoPool;                                                                              </span>
<span class="731197334835106556" onmouseenter="enter('731197334835106556');" onmouseout="out('731197334835106556');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  49 -  private ExecutorService mExePool;                                                                               </span>
<span class="914894699435640865" onmouseenter="enter('914894699435640865');" onmouseout="out('914894699435640865');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  50 -  private IDownloadGroupListener mListener;                                                                       </span>
<span class="-1952793536017144796" onmouseenter="enter('-1952793536017144796');" onmouseout="out('-1952793536017144796');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  51 -  private DownloadGroupTaskEntity mTaskEntity;                                                                    </span>
<span class="-7707598964647557450" onmouseenter="enter('-7707598964647557450');" onmouseout="out('-7707598964647557450');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  52 -  private boolean isRunning = true;                                                                               </span>
<span class="2545797703164998155" onmouseenter="enter('2545797703164998155');" onmouseout="out('2545797703164998155');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  53 -  private Timer mTimer;                                                                                           </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  54 -  /**                                                                                                             </span>
<span class="6552279459011062126" onmouseenter="enter('6552279459011062126');" onmouseout="out('6552279459011062126');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  55 -   * 初始化完成的任务书数                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  56 -   */                                                                                                             </span>
<span class="4057129918445122430" onmouseenter="enter('4057129918445122430');" onmouseout="out('4057129918445122430');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  57 -  private int mInitNum = 0;                                                                                       </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  58 -  /**                                                                                                             </span>
<span class="5189388546664003005" onmouseenter="enter('5189388546664003005');" onmouseout="out('5189388546664003005');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  59 -   * 初始化失败的任务数                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  60 -   */                                                                                                             </span>
<span class="1036771418966180244" onmouseenter="enter('1036771418966180244');" onmouseout="out('1036771418966180244');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  61 -  private int mInitFailNum = 0;                                                                                   </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  62 -  /**                                                                                                             </span>
<span class="-8396872691246251646" onmouseenter="enter('-8396872691246251646');" onmouseout="out('-8396872691246251646');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  63 -   * 保存所有没有下载完成的任务，key为下载地址                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  64 -   */                                                                                                             </span>
<span class="-737569427765289884" onmouseenter="enter('-737569427765289884');" onmouseout="out('-737569427765289884');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  65 -  private Map&lt;String, DownloadTaskEntity&gt; mExeMap = new HashMap&lt;&gt;();                                              </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  66 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  67 -  /**                                                                                                             </span>
<span class="-2253517741290947496" onmouseenter="enter('-2253517741290947496');" onmouseout="out('-2253517741290947496');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  68 -   * 下载失败的映射表，key为下载地址                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  69 -   */                                                                                                             </span>
<span class="8167805223138120322" onmouseenter="enter('8167805223138120322');" onmouseout="out('8167805223138120322');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  70 -  private Map&lt;String, DownloadTaskEntity&gt; mFailMap = new HashMap&lt;&gt;();                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  71 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  72 -  /**                                                                                                             </span>
<span class="-547852276695370661" onmouseenter="enter('-547852276695370661');" onmouseout="out('-547852276695370661');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  73 -   * 下载器映射表，key为下载地址                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  74 -   */                                                                                                             </span>
<span class="5540399942948507826" onmouseenter="enter('5540399942948507826');" onmouseout="out('5540399942948507826');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  75 -  private Map&lt;String, Downloader&gt; mDownloaderMap = new HashMap&lt;&gt;();                                               </span>
<span  style="">  76                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  77    /**                                                                                                             </span>
<span class="6416521976967220365" onmouseenter="enter('6416521976967220365');" onmouseout="out('6416521976967220365');" style="">  78     * 文件信息回调组                                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  79     */                                                                                                             </span>
<span class="-6850429581361218592" onmouseenter="enter('-6850429581361218592');" onmouseout="out('-6850429581361218592');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  80 -  private SparseArray&lt;FileInfoThread.OnFileInfoCallback&gt; mFileInfoCallbacks = new SparseArray&lt;&gt;();                </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  81 -  /**                                                                                                             </span>
<span class="408163778228676428" onmouseenter="enter('408163778228676428');" onmouseout="out('408163778228676428');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  82 -   * 该任务组对应的所有任务                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  83 -   */                                                                                                             </span>
<span class="7413500652658984374" onmouseenter="enter('7413500652658984374');" onmouseout="out('7413500652658984374');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  84 -  private Map&lt;String, DownloadTaskEntity&gt; mTasksMap = new HashMap&lt;&gt;();                                            </span>
<span class="-3880191924085857849" onmouseenter="enter('-3880191924085857849');" onmouseout="out('-3880191924085857849');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  85 -  //已经完成的任务数                                                                                                      </span>
<span class="1341963505009583064" onmouseenter="enter('1341963505009583064');" onmouseout="out('1341963505009583064');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  86 -  private int mCompleteNum = 0;                                                                                   </span>
<span class="-8515839460396392680" onmouseenter="enter('-8515839460396392680');" onmouseout="out('-8515839460396392680');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  87 -  //失败的任务数                                                                                                        </span>
<span class="-7140144646327314748" onmouseenter="enter('-7140144646327314748');" onmouseout="out('-7140144646327314748');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  88 -  private int mFailNum = 0;                                                                                       </span>
<span class="-4984923011450582537" onmouseenter="enter('-4984923011450582537');" onmouseout="out('-4984923011450582537');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  89 -  //实际的下载任务数                                                                                                      </span>
<span class="8294491880415829469" onmouseenter="enter('8294491880415829469');" onmouseout="out('8294491880415829469');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  90 -  private int mActualTaskNum = 0;                                                                                 </span>
<span class="-5994431595118905059" onmouseenter="enter('-5994431595118905059');" onmouseout="out('-5994431595118905059');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  91 +  private SparseArray&lt;OnFileInfoCallback&gt; mFileInfoCallbacks = new SparseArray&lt;&gt;();                               </span>
<span  style="">  92                                                                                                                    </span>
<span class="-3731711094107651611" onmouseenter="enter('-3731711094107651611');" onmouseout="out('-3731711094107651611');" style="">  93    public DownloadGroupUtil(IDownloadGroupListener listener, DownloadGroupTaskEntity taskEntity) {                 </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  94 -    mListener = listener;                                                                                         </span>
<span class="8662994215762856538" onmouseenter="enter('8662994215762856538');" onmouseout="out('8662994215762856538');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  95 -    mTaskEntity = taskEntity;                                                                                     </span>
<span class="-7841553057471002442" onmouseenter="enter('-7841553057471002442');" onmouseout="out('-7841553057471002442');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  96 +    super(listener, taskEntity);                                                                                  </span>
<span class="-6453187294675473758" onmouseenter="enter('-6453187294675473758');" onmouseout="out('-6453187294675473758');" style="">  97      mInfoPool = Executors.newCachedThreadPool();                                                                  </span>
<span class="-8484916230991476700" onmouseenter="enter('-8484916230991476700');" onmouseout="out('-8484916230991476700');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  98 -    mExePool = Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors());                          </span>
<span class="-6102770982770606898" onmouseenter="enter('-6102770982770606898');" onmouseout="out('-6102770982770606898');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -    mActualTaskNum = mTaskEntity.entity.getSubTask().size();                                                      </span>
<span class="4623479770740533496" onmouseenter="enter('4623479770740533496');" onmouseout="out('4623479770740533496');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 100 -    List&lt;DownloadTaskEntity&gt; tasks =                                                                              </span>
<span class="4222418289028627286" onmouseenter="enter('4222418289028627286');" onmouseout="out('4222418289028627286');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 101 -        DbEntity.findDatas(DownloadTaskEntity.class, &quot;groupName=?&quot;, mTaskEntity.key);                             </span>
<span class="6733199802755561211" onmouseenter="enter('6733199802755561211');" onmouseout="out('6733199802755561211');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 102 -    if (tasks != null &amp;&amp; !tasks.isEmpty()) {                                                                      </span>
<span class="-8801083781759692574" onmouseenter="enter('-8801083781759692574');" onmouseout="out('-8801083781759692574');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 103 -      for (DownloadTaskEntity te : tasks) {                                                                       </span>
<span class="334754947706091591" onmouseenter="enter('334754947706091591');" onmouseout="out('334754947706091591');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 104 -        mTasksMap.put(te.getEntity().getDownloadUrl(), te);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 105 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 106 -    }                                                                                                             </span>
<span class="8411345017327588592" onmouseenter="enter('8411345017327588592');" onmouseout="out('8411345017327588592');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 107 -    for (DownloadEntity entity : mTaskEntity.entity.getSubTask()) {                                               </span>
<span class="-8554155214173149752" onmouseenter="enter('-8554155214173149752');" onmouseout="out('-8554155214173149752');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 108 -      File file = new File(entity.getDownloadPath());                                                             </span>
<span class="5531764893385126851" onmouseenter="enter('5531764893385126851');" onmouseout="out('5531764893385126851');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 109 -      if (entity.getState() == IEntity.STATE_COMPLETE &amp;&amp; file.exists()) {                                         </span>
<span class="-1263526001176077168" onmouseenter="enter('-1263526001176077168');" onmouseout="out('-1263526001176077168');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 110 -        mCompleteNum++;                                                                                           </span>
<span class="-8520114986100534454" onmouseenter="enter('-8520114986100534454');" onmouseout="out('-8520114986100534454');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 111 -        mInitNum++;                                                                                               </span>
<span class="7142921377873872227" onmouseenter="enter('7142921377873872227');" onmouseout="out('7142921377873872227');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 112 -        mCurrentLocation += entity.getFileSize();                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 113 -      } else {                                                                                                    </span>
<span class="-7309973109902623255" onmouseenter="enter('-7309973109902623255');" onmouseout="out('-7309973109902623255');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 114 -        mExeMap.put(entity.getDownloadUrl(), createChildDownloadTask(entity));                                    </span>
<span class="-5074924053200506841" onmouseenter="enter('-5074924053200506841');" onmouseout="out('-5074924053200506841');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 115 -        mCurrentLocation += entity.getCurrentProgress();                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 116 -      }                                                                                                           </span>
<span class="2295562108744303806" onmouseenter="enter('2295562108744303806');" onmouseout="out('2295562108744303806');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 117 -      mTotalSize += entity.getFileSize();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 118 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +                                                                                                                  </span>
<span class="2093106455269248536" onmouseenter="enter('2093106455269248536');" onmouseout="out('2093106455269248536');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +  @Override public void onCancel() {                                                                              </span>
<span class="-5705545244356268786" onmouseenter="enter('-5705545244356268786');" onmouseout="out('-5705545244356268786');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 121 +    super.onCancel();                                                                                             </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +    if (!mInfoPool.isShutdown()) {                                                                                </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +      mInfoPool.shutdown();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 125    }                                                                                                               </span>
<span  style=""> 126                                                                                                                    </span>
<span class="-4506592131726080634" onmouseenter="enter('-4506592131726080634');" onmouseout="out('-4506592131726080634');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 127 -  @Override public long getFileSize() {                                                                           </span>
<span class="2123125704645203645" onmouseenter="enter('2123125704645203645');" onmouseout="out('2123125704645203645');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 128 -    return mTotalSize;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 129 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 130 -                                                                                                                  </span>
<span class="42588745782017963" onmouseenter="enter('42588745782017963');" onmouseout="out('42588745782017963');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 131 -  @Override public long getCurrentLocation() {                                                                    </span>
<span class="1524502011970861445" onmouseenter="enter('1524502011970861445');" onmouseout="out('1524502011970861445');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 132 -    return mCurrentLocation;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 133 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 134 -                                                                                                                  </span>
<span class="8514823861416132786" onmouseenter="enter('8514823861416132786');" onmouseout="out('8514823861416132786');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 135 -  @Override public boolean isDownloading() {                                                                      </span>
<span class="9152024351919709179" onmouseenter="enter('9152024351919709179');" onmouseout="out('9152024351919709179');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 136 -    return isRunning;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 137 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 138 -                                                                                                                  </span>
<span class="8518544268347342740" onmouseenter="enter('8518544268347342740');" onmouseout="out('8518544268347342740');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 139 -  @Override public void cancelDownload() {                                                                        </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 140 -    closeTimer(false);                                                                                            </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 141 -    mListener.onCancel();                                                                                         </span>
<span class="8218595092732559103" onmouseenter="enter('8218595092732559103');" onmouseout="out('8218595092732559103');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +  @Override protected void onStop() {                                                                             </span>
<span class="-4376279779571809033" onmouseenter="enter('-4376279779571809033');" onmouseout="out('-4376279779571809033');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +    super.onStop();                                                                                               </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style=""> 144      if (!mInfoPool.isShutdown()) {                                                                                </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style=""> 145        mInfoPool.shutdown();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146      }                                                                                                             </span>
<span class="-566362124535735919" onmouseenter="enter('-566362124535735919');" onmouseout="out('-566362124535735919');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 147 -    if (!mExePool.isShutdown()) {                                                                                 </span>
<span class="-9028679909484630999" onmouseenter="enter('-9028679909484630999');" onmouseout="out('-9028679909484630999');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 148 -      mExePool.shutdown();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 149 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 150 -                                                                                                                  </span>
<span class="-121865910349791330" onmouseenter="enter('-121865910349791330');" onmouseout="out('-121865910349791330');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 151 -    Set&lt;String&gt; keys = mDownloaderMap.keySet();                                                                   </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 152 -    for (String key : keys) {                                                                                     </span>
<span class="4674592448761410649" onmouseenter="enter('4674592448761410649');" onmouseout="out('4674592448761410649');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 153 -      Downloader dt = mDownloaderMap.get(key);                                                                    </span>
<span class="4002339207918379493" onmouseenter="enter('4002339207918379493');" onmouseout="out('4002339207918379493');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 154 -      if (dt != null) {                                                                                           </span>
<span class="-6177430030980743439" onmouseenter="enter('-6177430030980743439');" onmouseout="out('-6177430030980743439');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 155 -        dt.cancelDownload();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 156 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 157 -    }                                                                                                             </span>
<span class="-6812949802078178976" onmouseenter="enter('-6812949802078178976');" onmouseout="out('-6812949802078178976');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 158 -    delDownloadInfo();                                                                                            </span>
<span class="3736236151466185350" onmouseenter="enter('3736236151466185350');" onmouseout="out('3736236151466185350');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 159 -    mTaskEntity.deleteData();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160    }                                                                                                               </span>
<span  style=""> 161                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 162 -  /**                                                                                                             </span>
<span class="2811324672140469110" onmouseenter="enter('2811324672140469110');" onmouseout="out('2811324672140469110');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 163 -   * 删除所有子任务的下载信息                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 164 -   */                                                                                                             </span>
<span class="-7852351063311107832" onmouseenter="enter('-7852351063311107832');" onmouseout="out('-7852351063311107832');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 165 -  private void delDownloadInfo() {                                                                                </span>
<span class="4623479770740533496" onmouseenter="enter('4623479770740533496');" onmouseout="out('4623479770740533496');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 166 -    List&lt;DownloadTaskEntity&gt; tasks =                                                                              </span>
<span class="4222418289028627286" onmouseenter="enter('4222418289028627286');" onmouseout="out('4222418289028627286');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 167 -        DbEntity.findDatas(DownloadTaskEntity.class, &quot;groupName=?&quot;, mTaskEntity.key);                             </span>
<span class="-7059273340673847542" onmouseenter="enter('-7059273340673847542');" onmouseout="out('-7059273340673847542');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 168 -    if (tasks == null || tasks.isEmpty()) return;                                                                 </span>
<span class="-573879738747794463" onmouseenter="enter('-573879738747794463');" onmouseout="out('-573879738747794463');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 169 -    for (DownloadTaskEntity taskEntity : tasks) {                                                                 </span>
<span class="461901582083120312" onmouseenter="enter('461901582083120312');" onmouseout="out('461901582083120312');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 170 -      CommonUtil.delDownloadTaskConfig(taskEntity.removeFile, taskEntity);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 171 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 172 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 173 -                                                                                                                  </span>
<span class="-4596234023078912379" onmouseenter="enter('-4596234023078912379');" onmouseout="out('-4596234023078912379');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 174 -  @Override public void stopDownload() {                                                                          </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 175 -    closeTimer(false);                                                                                            </span>
<span class="5167771793225547847" onmouseenter="enter('5167771793225547847');" onmouseout="out('5167771793225547847');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 176 -    mListener.onStop(mCurrentLocation);                                                                           </span>
<span class="-838625895390187156" onmouseenter="enter('-838625895390187156');" onmouseout="out('-838625895390187156');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 177 -    if (!mInfoPool.isShutdown()) {                                                                                </span>
<span class="8487743639879973664" onmouseenter="enter('8487743639879973664');" onmouseout="out('8487743639879973664');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 178 -      mInfoPool.shutdown();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 179 -    }                                                                                                             </span>
<span class="-566362124535735919" onmouseenter="enter('-566362124535735919');" onmouseout="out('-566362124535735919');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 180 -    if (!mExePool.isShutdown()) {                                                                                 </span>
<span class="-9028679909484630999" onmouseenter="enter('-9028679909484630999');" onmouseout="out('-9028679909484630999');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 181 -      mExePool.shutdown();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 182 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 183 -                                                                                                                  </span>
<span class="-121865910349791330" onmouseenter="enter('-121865910349791330');" onmouseout="out('-121865910349791330');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 184 -    Set&lt;String&gt; keys = mDownloaderMap.keySet();                                                                   </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 185 -    for (String key : keys) {                                                                                     </span>
<span class="4674592448761410649" onmouseenter="enter('4674592448761410649');" onmouseout="out('4674592448761410649');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 186 -      Downloader dt = mDownloaderMap.get(key);                                                                    </span>
<span class="4002339207918379493" onmouseenter="enter('4002339207918379493');" onmouseout="out('4002339207918379493');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 187 -      if (dt != null) {                                                                                           </span>
<span class="3167682315717751579" onmouseenter="enter('3167682315717751579');" onmouseout="out('3167682315717751579');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 188 -        dt.stopDownload();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 189 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 190 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 191 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 192 -                                                                                                                  </span>
<span class="-4856178778199245062" onmouseenter="enter('-4856178778199245062');" onmouseout="out('-4856178778199245062');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 193 -  @Override public void startDownload() {                                                                         </span>
<span class="720656867499890795" onmouseenter="enter('720656867499890795');" onmouseout="out('720656867499890795');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 194 -    isRunning = true;                                                                                             </span>
<span class="-4263343811101375569" onmouseenter="enter('-4263343811101375569');" onmouseout="out('-4263343811101375569');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 195 -    mFailNum = 0;                                                                                                 </span>
<span class="7849318491336065590" onmouseenter="enter('7849318491336065590');" onmouseout="out('7849318491336065590');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 196 +  @Override protected void onStart() {                                                                            </span>
<span class="8068463127664630279" onmouseenter="enter('8068463127664630279');" onmouseout="out('8068463127664630279');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 197 +    super.onStart();                                                                                              </span>
<span class="4774762395313474868" onmouseenter="enter('4774762395313474868');" onmouseout="out('4774762395313474868');" style=""> 198      Set&lt;String&gt; keys = mExeMap.keySet();                                                                          </span>
<span class="2099174989180368882" onmouseenter="enter('2099174989180368882');" onmouseout="out('2099174989180368882');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 199 -    mListener.onPre();                                                                                            </span>
<span class="-8629982182851448523" onmouseenter="enter('-8629982182851448523');" onmouseout="out('-8629982182851448523');" style=""> 200      int i = 0;                                                                                                    </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style=""> 201      for (String key : keys) {                                                                                     </span>
<span class="221423537684250497" onmouseenter="enter('221423537684250497');" onmouseout="out('221423537684250497');" style=""> 202        DownloadTaskEntity taskEntity = mExeMap.get(key);                                                           </span>
<span class="2875409705898122648" onmouseenter="enter('2875409705898122648');" onmouseout="out('2875409705898122648');" style=""> 203        if (taskEntity != null) {                                                                                   </span>
<span class="3825460913713262848" onmouseenter="enter('3825460913713262848');" onmouseout="out('3825460913713262848');" style=""> 204          if (taskEntity.getState() != IEntity.STATE_FAIL                                                           </span>
<span class="4045344078755509632" onmouseenter="enter('4045344078755509632');" onmouseout="out('4045344078755509632');" style=""> 205              &amp;&amp; taskEntity.getState() != IEntity.STATE_WAIT) {                                                     </span>
<span class="6449066979252177845" onmouseenter="enter('6449066979252177845');" onmouseout="out('6449066979252177845');" style=""> 206            startChildDownload(taskEntity);                                                                         </span>
<span class="-4968746635634186778" onmouseenter="enter('-4968746635634186778');" onmouseout="out('-4968746635634186778');" style=""> 207            i++;                                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 208          } else {                                                                                                  </span>
<span class="4135184626453358547" onmouseenter="enter('4135184626453358547');" onmouseout="out('4135184626453358547');" style=""> 209            mInfoPool.execute(createFileInfoThread(taskEntity));                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212      }                                                                                                             </span>
<span class="-8434084337306400756" onmouseenter="enter('-8434084337306400756');" onmouseout="out('-8434084337306400756');" style=""> 213      if (i == mExeMap.size()) startRunningFlow();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214    }                                                                                                               </span>
<span  style=""> 215                                                                                                                    </span>
<span class="-5762688668558425600" onmouseenter="enter('-5762688668558425600');" onmouseout="out('-5762688668558425600');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 216 -  @Override public void resumeDownload() {                                                                        </span>
<span class="1497820413888703615" onmouseenter="enter('1497820413888703615');" onmouseout="out('1497820413888703615');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 217 -    startDownload();                                                                                              </span>
<span class="2432525506665579835" onmouseenter="enter('2432525506665579835');" onmouseout="out('2432525506665579835');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 218 -    mListener.onResume(mCurrentLocation);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 219 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 220 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 221    /**                                                                                                             </span>
<span class="-4547374311767626615" onmouseenter="enter('-4547374311767626615');" onmouseout="out('-4547374311767626615');" style=""> 222     * 创建文件信息获取线程                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 223     */                                                                                                             </span>
<span class="3938287834207978655" onmouseenter="enter('3938287834207978655');" onmouseout="out('3938287834207978655');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 224 -  private FileInfoThread createFileInfoThread(DownloadTaskEntity taskEntity) {                                    </span>
<span class="-3840222843651584707" onmouseenter="enter('-3840222843651584707');" onmouseout="out('-3840222843651584707');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 225 -    FileInfoThread.OnFileInfoCallback callback = mFileInfoCallbacks.get(taskEntity.hashCode());                   </span>
<span class="5921359649843257629" onmouseenter="enter('5921359649843257629');" onmouseout="out('5921359649843257629');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 226 +  private HttpFileInfoThread createFileInfoThread(DownloadTaskEntity taskEntity) {                                </span>
<span class="3806302679560349109" onmouseenter="enter('3806302679560349109');" onmouseout="out('3806302679560349109');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 227 +    OnFileInfoCallback callback = mFileInfoCallbacks.get(taskEntity.hashCode());                                  </span>
<span  style=""> 228                                                                                                                    </span>
<span class="-5681834850649759939" onmouseenter="enter('-5681834850649759939');" onmouseout="out('-5681834850649759939');" style=""> 229      if (callback == null) {                                                                                       </span>
<span class="5413682592871947948" onmouseenter="enter('5413682592871947948');" onmouseout="out('5413682592871947948');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 230 -      callback = new FileInfoThread.OnFileInfoCallback() {                                                        </span>
<span class="-2247249715703717317" onmouseenter="enter('-2247249715703717317');" onmouseout="out('-2247249715703717317');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 231 +      callback = new OnFileInfoCallback() {                                                                       </span>
<span class="4970948900553010157" onmouseenter="enter('4970948900553010157');" onmouseout="out('4970948900553010157');" style=""> 232          int failNum = 0;                                                                                          </span>
<span  style=""> 233                                                                                                                    </span>
<span class="-5145950279106892584" onmouseenter="enter('-5145950279106892584');" onmouseout="out('-5145950279106892584');" style=""> 234          @Override public void onComplete(String url, int code) {                                                  </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style=""> 235            DownloadTaskEntity te = mExeMap.get(url);                                                               </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style=""> 236            if (te != null) {                                                                                       </span>
<span class="308930838644053042" onmouseenter="enter('308930838644053042');" onmouseout="out('308930838644053042');" style=""> 237              mTotalSize += te.getEntity().getFileSize();                                                           </span>
<span class="-9118376655834637322" onmouseenter="enter('-9118376655834637322');" onmouseout="out('-9118376655834637322');" style=""> 238              startChildDownload(te);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239            }                                                                                                       </span>
<span class="-8520114986100534454" onmouseenter="enter('-8520114986100534454');" onmouseout="out('-8520114986100534454');" style=""> 240            mInitNum++;                                                                                             </span>
<span class="-234450023538178691" onmouseenter="enter('-234450023538178691');" onmouseout="out('-234450023538178691');" style=""> 241            if (mInitNum + mInitFailNum &gt;= mTaskEntity.getEntity().getSubTask().size()) {                           </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style=""> 242              startRunningFlow();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243            }                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244          }                                                                                                         </span>
<span  style=""> 245                                                                                                                    </span>
<span class="3522384484183979639" onmouseenter="enter('3522384484183979639');" onmouseout="out('3522384484183979639');" style=""> 246          @Override public void onFail(String url, String errorMsg) {                                               </span>
<span class="8207446653137550410" onmouseenter="enter('8207446653137550410');" onmouseout="out('8207446653137550410');" style=""> 247            DownloadTaskEntity te = mExeMap.get(url);                                                               </span>
<span class="-6773434581829619326" onmouseenter="enter('-6773434581829619326');" onmouseout="out('-6773434581829619326');" style=""> 248            if (te != null) {                                                                                       </span>
<span class="-3434538459014877633" onmouseenter="enter('-3434538459014877633');" onmouseout="out('-3434538459014877633');" style=""> 249              mFailMap.put(url, te);                                                                                </span>
<span class="8595174373746499082" onmouseenter="enter('8595174373746499082');" onmouseout="out('8595174373746499082');" style=""> 250              mFileInfoCallbacks.put(te.hashCode(), this);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251            }                                                                                                       </span>
<span class="-3126918587586078524" onmouseenter="enter('-3126918587586078524');" onmouseout="out('-3126918587586078524');" style=""> 252            //404链接不重试下载                                                                                            </span>
<span class="-4716929270045128613" onmouseenter="enter('-4716929270045128613');" onmouseout="out('-4716929270045128613');" style=""> 253            if (failNum &lt; 10 &amp;&amp; !errorMsg.contains(&quot;错误码：404&quot;) &amp;&amp; !errorMsg.contains(                                </span>
<span class="5193671628245366377" onmouseenter="enter('5193671628245366377');" onmouseout="out('5193671628245366377');" style=""> 254                &quot;UnknownHostException&quot;)) {                                                                          </span>
<span class="-7158306797275734596" onmouseenter="enter('-7158306797275734596');" onmouseout="out('-7158306797275734596');" style=""> 255              mInfoPool.execute(createFileInfoThread(te));                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 256            } else {                                                                                                </span>
<span class="-2723952096500307408" onmouseenter="enter('-2723952096500307408');" onmouseout="out('-2723952096500307408');" style=""> 257              mInitFailNum++;                                                                                       </span>
<span class="-1903130545068871575" onmouseenter="enter('-1903130545068871575');" onmouseout="out('-1903130545068871575');" style=""> 258              mActualTaskNum--;                                                                                     </span>
<span class="-7251641660257607121" onmouseenter="enter('-7251641660257607121');" onmouseout="out('-7251641660257607121');" style=""> 259              if (mActualTaskNum &lt; 0) mActualTaskNum = 0;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260            }                                                                                                       </span>
<span class="-4881470894519452809" onmouseenter="enter('-4881470894519452809');" onmouseout="out('-4881470894519452809');" style=""> 261            failNum++;                                                                                              </span>
<span class="-234450023538178691" onmouseenter="enter('-234450023538178691');" onmouseout="out('-234450023538178691');" style=""> 262            if (mInitNum + mInitFailNum &gt;= mTaskEntity.getEntity().getSubTask().size()) {                           </span>
<span class="-5621980728718142439" onmouseenter="enter('-5621980728718142439');" onmouseout="out('-5621980728718142439');" style=""> 263              startRunningFlow();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264            }                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265          }                                                                                                         </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 266        };                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267      }                                                                                                             </span>
<span class="-6395675362803657436" onmouseenter="enter('-6395675362803657436');" onmouseout="out('-6395675362803657436');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 268 -    return new FileInfoThread(taskEntity, callback);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 269 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 270 -                                                                                                                  </span>
<span class="-9101626023155881186" onmouseenter="enter('-9101626023155881186');" onmouseout="out('-9101626023155881186');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 271 -  private void closeTimer(boolean isRunning) {                                                                    </span>
<span class="5231425380397002866" onmouseenter="enter('5231425380397002866');" onmouseout="out('5231425380397002866');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 272 -    this.isRunning = isRunning;                                                                                   </span>
<span class="-4343220603110256261" onmouseenter="enter('-4343220603110256261');" onmouseout="out('-4343220603110256261');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 273 -    if (mTimer != null) {                                                                                         </span>
<span class="6506490333649261220" onmouseenter="enter('6506490333649261220');" onmouseout="out('6506490333649261220');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 274 -      mTimer.purge();                                                                                             </span>
<span class="3936422701741233911" onmouseenter="enter('3936422701741233911');" onmouseout="out('3936422701741233911');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 275 -      mTimer.cancel();                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 276 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 277 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 278 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 279 -  /**                                                                                                             </span>
<span class="-5673927707437898965" onmouseenter="enter('-5673927707437898965');" onmouseout="out('-5673927707437898965');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 280 -   * 开始进度流程                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 281 -   */                                                                                                             </span>
<span class="-8924856940436287042" onmouseenter="enter('-8924856940436287042');" onmouseout="out('-8924856940436287042');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 282 -  private void startRunningFlow() {                                                                               </span>
<span class="-4556811986576627418" onmouseenter="enter('-4556811986576627418');" onmouseout="out('-4556811986576627418');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 283 -    closeTimer(true);                                                                                             </span>
<span class="3412375698150633050" onmouseenter="enter('3412375698150633050');" onmouseout="out('3412375698150633050');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 284 -    mListener.onPostPre(mTotalSize);                                                                              </span>
<span class="-6131324328119540818" onmouseenter="enter('-6131324328119540818');" onmouseout="out('-6131324328119540818');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 285 -    mListener.onStart(mCurrentLocation);                                                                          </span>
<span class="9064905857115753880" onmouseenter="enter('9064905857115753880');" onmouseout="out('9064905857115753880');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 286 -    mTimer = new Timer(true);                                                                                     </span>
<span class="1767883212426599488" onmouseenter="enter('1767883212426599488');" onmouseout="out('1767883212426599488');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 287 -    mTimer.schedule(new TimerTask() {                                                                             </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 288 -      @Override public void run() {                                                                               </span>
<span class="-7587988653908595463" onmouseenter="enter('-7587988653908595463');" onmouseout="out('-7587988653908595463');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 289 -        if (!isRunning) {                                                                                         </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 290 -          closeTimer(false);                                                                                      </span>
<span class="-427374670960232487" onmouseenter="enter('-427374670960232487');" onmouseout="out('-427374670960232487');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 291 -        } else if (mCurrentLocation &gt;= 0) {                                                                       </span>
<span class="-778237943185100423" onmouseenter="enter('-778237943185100423');" onmouseout="out('-778237943185100423');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 292 -          mListener.onProgress(mCurrentLocation);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 293 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 294 -      }                                                                                                           </span>
<span class="-7052623657160678735" onmouseenter="enter('-7052623657160678735');" onmouseout="out('-7052623657160678735');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 295 -    }, 0, 1000);                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 296 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 297 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 298 -  /**                                                                                                             </span>
<span class="-2915045833374537336" onmouseenter="enter('-2915045833374537336');" onmouseout="out('-2915045833374537336');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 299 -   * 启动子任务下载器                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 300 -   */                                                                                                             </span>
<span class="-4814508883416810996" onmouseenter="enter('-4814508883416810996');" onmouseout="out('-4814508883416810996');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 301 -  private void startChildDownload(DownloadTaskEntity taskEntity) {                                                </span>
<span class="-5214201566114754807" onmouseenter="enter('-5214201566114754807');" onmouseout="out('-5214201566114754807');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 302 -    ChildDownloadListener listener = new ChildDownloadListener(taskEntity);                                       </span>
<span class="-7880859510389460827" onmouseenter="enter('-7880859510389460827');" onmouseout="out('-7880859510389460827');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 303 -    Downloader dt = new Downloader(listener, taskEntity);                                                         </span>
<span class="-1715913392464468508" onmouseenter="enter('-1715913392464468508');" onmouseout="out('-1715913392464468508');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 304 -    mDownloaderMap.put(taskEntity.getEntity().getDownloadUrl(), dt);                                              </span>
<span class="-1714638633517896439" onmouseenter="enter('-1714638633517896439');" onmouseout="out('-1714638633517896439');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 305 -    if (mExePool.isShutdown()) return;                                                                            </span>
<span class="-268914413429947469" onmouseenter="enter('-268914413429947469');" onmouseout="out('-268914413429947469');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 306 -    mExePool.execute(dt);                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 307 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 308 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 309 -  /**                                                                                                             </span>
<span class="6709099824921226015" onmouseenter="enter('6709099824921226015');" onmouseout="out('6709099824921226015');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 310 -   * 创建子任务下载信息                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 311 -   */                                                                                                             </span>
<span class="2231847697649480847" onmouseenter="enter('2231847697649480847');" onmouseout="out('2231847697649480847');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 312 -  private DownloadTaskEntity createChildDownloadTask(DownloadEntity entity) {                                     </span>
<span class="-5250283806161329316" onmouseenter="enter('-5250283806161329316');" onmouseout="out('-5250283806161329316');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 313 -    DownloadTaskEntity taskEntity = mTasksMap.get(entity.getDownloadUrl());                                       </span>
<span class="2875409705898122648" onmouseenter="enter('2875409705898122648');" onmouseout="out('2875409705898122648');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 314 -    if (taskEntity != null) {                                                                                     </span>
<span class="-6847855421842186847" onmouseenter="enter('-6847855421842186847');" onmouseout="out('-6847855421842186847');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 315 -      taskEntity.entity = entity;                                                                                 </span>
<span class="-9104005150390610221" onmouseenter="enter('-9104005150390610221');" onmouseout="out('-9104005150390610221');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 316 -      return taskEntity;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 317 -    }                                                                                                             </span>
<span class="-4885480137579962058" onmouseenter="enter('-4885480137579962058');" onmouseout="out('-4885480137579962058');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 318 -    taskEntity = new DownloadTaskEntity();                                                                        </span>
<span class="-6847855421842186847" onmouseenter="enter('-6847855421842186847');" onmouseout="out('-6847855421842186847');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 319 -    taskEntity.entity = entity;                                                                                   </span>
<span class="-3732720384716012622" onmouseenter="enter('-3732720384716012622');" onmouseout="out('-3732720384716012622');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 320 -    taskEntity.headers = mTaskEntity.headers;                                                                     </span>
<span class="-5768494270506887606" onmouseenter="enter('-5768494270506887606');" onmouseout="out('-5768494270506887606');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 321 -    taskEntity.requestEnum = mTaskEntity.requestEnum;                                                             </span>
<span class="6168081707298186636" onmouseenter="enter('6168081707298186636');" onmouseout="out('6168081707298186636');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 322 -    taskEntity.redirectUrlKey = mTaskEntity.redirectUrlKey;                                                       </span>
<span class="3156827566400786541" onmouseenter="enter('3156827566400786541');" onmouseout="out('3156827566400786541');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 323 -    taskEntity.removeFile = mTaskEntity.removeFile;                                                               </span>
<span class="-1864665886871527246" onmouseenter="enter('-1864665886871527246');" onmouseout="out('-1864665886871527246');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 324 -    taskEntity.groupName = mTaskEntity.key;                                                                       </span>
<span class="-5806686039329624679" onmouseenter="enter('-5806686039329624679');" onmouseout="out('-5806686039329624679');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 325 -    taskEntity.isGroupTask = true;                                                                                </span>
<span class="1590775701393149207" onmouseenter="enter('1590775701393149207');" onmouseout="out('1590775701393149207');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 326 -    taskEntity.key = entity.getDownloadPath();                                                                    </span>
<span class="6178904090013830116" onmouseenter="enter('6178904090013830116');" onmouseout="out('6178904090013830116');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 327 -    taskEntity.save();                                                                                            </span>
<span class="-9104005150390610221" onmouseenter="enter('-9104005150390610221');" onmouseout="out('-9104005150390610221');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 328 -    return taskEntity;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 329 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 330 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 331 -  /**                                                                                                             </span>
<span class="7953531489350582006" onmouseenter="enter('7953531489350582006');" onmouseout="out('7953531489350582006');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 332 -   * 子任务事件监听                                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 333 -   */                                                                                                             </span>
<span class="-3470753416804816360" onmouseenter="enter('-3470753416804816360');" onmouseout="out('-3470753416804816360');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 334 -  private class ChildDownloadListener implements IDownloadListener {                                              </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 335 -                                                                                                                  </span>
<span class="1934457291382022470" onmouseenter="enter('1934457291382022470');" onmouseout="out('1934457291382022470');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 336 -    DownloadTaskEntity taskEntity;                                                                                </span>
<span class="-5258622463362253406" onmouseenter="enter('-5258622463362253406');" onmouseout="out('-5258622463362253406');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 337 -    DownloadEntity entity;                                                                                        </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 338 -                                                                                                                  </span>
<span class="5046313540994813291" onmouseenter="enter('5046313540994813291');" onmouseout="out('5046313540994813291');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 339 -    long lastLen = 0;                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 340 -                                                                                                                  </span>
<span class="-4385074185507416044" onmouseenter="enter('-4385074185507416044');" onmouseout="out('-4385074185507416044');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 341 -    ChildDownloadListener(DownloadTaskEntity entity) {                                                            </span>
<span class="1703855892247108918" onmouseenter="enter('1703855892247108918');" onmouseout="out('1703855892247108918');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 342 -      this.taskEntity = entity;                                                                                   </span>
<span class="-1050912213241719894" onmouseenter="enter('-1050912213241719894');" onmouseout="out('-1050912213241719894');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 343 -      this.entity = taskEntity.getEntity();                                                                       </span>
<span class="6735191672939573635" onmouseenter="enter('6735191672939573635');" onmouseout="out('6735191672939573635');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 344 -      lastLen = this.entity.getCurrentProgress();                                                                 </span>
<span class="4615984595129482352" onmouseenter="enter('4615984595129482352');" onmouseout="out('4615984595129482352');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 345 -      this.entity.setFailNum(0);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 346 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 347 -                                                                                                                  </span>
<span class="1941248740392522719" onmouseenter="enter('1941248740392522719');" onmouseout="out('1941248740392522719');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 348 -    @Override public void onPre() {                                                                               </span>
<span class="1272045713932667636" onmouseenter="enter('1272045713932667636');" onmouseout="out('1272045713932667636');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 349 -      saveData(IEntity.STATE_PRE, -1);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 350 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 351 -                                                                                                                  </span>
<span class="-6235441032293659444" onmouseenter="enter('-6235441032293659444');" onmouseout="out('-6235441032293659444');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 352 -    @Override public void onPostPre(long fileSize) {                                                              </span>
<span class="-8919115203469377593" onmouseenter="enter('-8919115203469377593');" onmouseout="out('-8919115203469377593');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 353 -      entity.setFileSize(fileSize);                                                                               </span>
<span class="-8129687735136084433" onmouseenter="enter('-8129687735136084433');" onmouseout="out('-8129687735136084433');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 354 -      entity.setConvertFileSize(CommonUtil.formatFileSize(fileSize));                                             </span>
<span class="-7950482897387591002" onmouseenter="enter('-7950482897387591002');" onmouseout="out('-7950482897387591002');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 355 -      saveData(IEntity.STATE_POST_PRE, -1);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 356 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 357 -                                                                                                                  </span>
<span class="8211923352965833527" onmouseenter="enter('8211923352965833527');" onmouseout="out('8211923352965833527');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 358 -    @Override public void onResume(long resumeLocation) {                                                         </span>
<span class="2291762294641027919" onmouseenter="enter('2291762294641027919');" onmouseout="out('2291762294641027919');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 359 -      saveData(IEntity.STATE_POST_PRE, IEntity.STATE_RUNNING);                                                    </span>
<span class="8171258845364215777" onmouseenter="enter('8171258845364215777');" onmouseout="out('8171258845364215777');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 360 -      lastLen = resumeLocation;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 361 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 362 -                                                                                                                  </span>
<span class="-3498891166253305351" onmouseenter="enter('-3498891166253305351');" onmouseout="out('-3498891166253305351');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 363 -    @Override public void onStart(long startLocation) {                                                           </span>
<span class="2291762294641027919" onmouseenter="enter('2291762294641027919');" onmouseout="out('2291762294641027919');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 364 -      saveData(IEntity.STATE_POST_PRE, IEntity.STATE_RUNNING);                                                    </span>
<span class="-6451191897379263867" onmouseenter="enter('-6451191897379263867');" onmouseout="out('-6451191897379263867');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 365 -      lastLen = startLocation;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 366 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 367 -                                                                                                                  </span>
<span class="-7946972766620409893" onmouseenter="enter('-7946972766620409893');" onmouseout="out('-7946972766620409893');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 368 -    @Override public void onProgress(long currentLocation) {                                                      </span>
<span class="-6788340243894418006" onmouseenter="enter('-6788340243894418006');" onmouseout="out('-6788340243894418006');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 369 -      long speed = currentLocation - lastLen;                                                                     </span>
<span class="-306662688114664893" onmouseenter="enter('-306662688114664893');" onmouseout="out('-306662688114664893');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 370 -      mCurrentLocation += speed;                                                                                  </span>
<span class="-2754998682014897103" onmouseenter="enter('-2754998682014897103');" onmouseout="out('-2754998682014897103');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 371 -      lastLen = currentLocation;                                                                                  </span>
<span class="-4238976656134225029" onmouseenter="enter('-4238976656134225029');" onmouseout="out('-4238976656134225029');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 372 -      entity.setCurrentProgress(currentLocation);                                                                 </span>
<span class="3220981239855838635" onmouseenter="enter('3220981239855838635');" onmouseout="out('3220981239855838635');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 373 -      handleSpeed(speed);                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 374 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 375 -                                                                                                                  </span>
<span class="3409726051444324452" onmouseenter="enter('3409726051444324452');" onmouseout="out('3409726051444324452');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 376 -    @Override public void onStop(long stopLocation) {                                                             </span>
<span class="-1696356608019189548" onmouseenter="enter('-1696356608019189548');" onmouseout="out('-1696356608019189548');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 377 -      saveData(IEntity.STATE_STOP, stopLocation);                                                                 </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 378 -      handleSpeed(0);                                                                                             </span>
<span class="-5925177778340562463" onmouseenter="enter('-5925177778340562463');" onmouseout="out('-5925177778340562463');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 379 -      mListener.onSubStop(entity);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 380 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 381 -                                                                                                                  </span>
<span class="2093106455269248536" onmouseenter="enter('2093106455269248536');" onmouseout="out('2093106455269248536');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 382 -    @Override public void onCancel() {                                                                            </span>
<span class="-8209498279616463234" onmouseenter="enter('-8209498279616463234');" onmouseout="out('-8209498279616463234');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 383 -      saveData(IEntity.STATE_CANCEL, -1);                                                                         </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 384 -      handleSpeed(0);                                                                                             </span>
<span class="-2639925523011962937" onmouseenter="enter('-2639925523011962937');" onmouseout="out('-2639925523011962937');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 385 -      mListener.onSubCancel(entity);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 386 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 387 -                                                                                                                  </span>
<span class="7400813110786944810" onmouseenter="enter('7400813110786944810');" onmouseout="out('7400813110786944810');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 388 -    @Override public void onComplete() {                                                                          </span>
<span class="-4243478454233770036" onmouseenter="enter('-4243478454233770036');" onmouseout="out('-4243478454233770036');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 389 -      saveData(IEntity.STATE_COMPLETE, entity.getFileSize());                                                     </span>
<span class="-1263526001176077168" onmouseenter="enter('-1263526001176077168');" onmouseout="out('-1263526001176077168');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 390 -      mCompleteNum++;                                                                                             </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 391 -      handleSpeed(0);                                                                                             </span>
<span class="-2907962166797260638" onmouseenter="enter('-2907962166797260638');" onmouseout="out('-2907962166797260638');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 392 -      mListener.onSubComplete(entity);                                                                            </span>
<span class="-6363872878771524946" onmouseenter="enter('-6363872878771524946');" onmouseout="out('-6363872878771524946');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 393 -      //如果子任务完成的数量和总任务数一致，表示任务组任务已经完成                                                                             </span>
<span class="-3459195755403894456" onmouseenter="enter('-3459195755403894456');" onmouseout="out('-3459195755403894456');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 394 -      if (mCompleteNum &gt;= mTaskEntity.getEntity().getSubTask().size()){                                           </span>

<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 395 -        closeTimer(false);                                                                                        </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 396 -        mListener.onComplete();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 397 -      }                                                                                                           </span>
<span class="-8854761308402599798" onmouseenter="enter('-8854761308402599798');" onmouseout="out('-8854761308402599798');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 398 -      //如果子任务完成数量加上失败的数量和总任务数一致，则任务组停止下载                                                                          </span>
<span class="-4400482220810116081" onmouseenter="enter('-4400482220810116081');" onmouseout="out('-4400482220810116081');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 399 -      if (mCompleteNum + mFailNum &gt;= mActualTaskNum) {                                                            </span>


<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 400 -        closeTimer(false);                                                                                        </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 401 -        mListener.onComplete();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 402 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 403 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 404 -                                                                                                                  </span>
<span class="-8845666459040584461" onmouseenter="enter('-8845666459040584461');" onmouseout="out('-8845666459040584461');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 405 -    @Override public void onFail() {                                                                              </span>
<span class="-1614602823543137763" onmouseenter="enter('-1614602823543137763');" onmouseout="out('-1614602823543137763');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 406 -      entity.setFailNum(entity.getFailNum() + 1);                                                                 </span>
<span class="9173216667172088818" onmouseenter="enter('9173216667172088818');" onmouseout="out('9173216667172088818');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 407 -      saveData(IEntity.STATE_FAIL, lastLen);                                                                      </span>
<span class="-8387007605453828562" onmouseenter="enter('-8387007605453828562');" onmouseout="out('-8387007605453828562');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 408 -      handleSpeed(0);                                                                                             </span>
<span class="2616907991847077571" onmouseenter="enter('2616907991847077571');" onmouseout="out('2616907991847077571');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 409 -      reTry();                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 410 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 411 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 412 -    /**                                                                                                           </span>
<span class="9094883438601628482" onmouseenter="enter('9094883438601628482');" onmouseout="out('9094883438601628482');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 413 -     * 失败后重试下载，如果失败次数超过5次，不再重试                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 414 -     */                                                                                                           </span>
<span class="-6307491174755509331" onmouseenter="enter('-6307491174755509331');" onmouseout="out('-6307491174755509331');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 415 -    private void reTry() {                                                                                        </span>
<span class="2413557230396081886" onmouseenter="enter('2413557230396081886');" onmouseout="out('2413557230396081886');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 416 -      if (entity.getFailNum() &lt; 5) {                                                                              </span>
<span class="3130304206991829788" onmouseenter="enter('3130304206991829788');" onmouseout="out('3130304206991829788');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 417 -        reStartTask();                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 418 -      } else {                                                                                                    </span>
<span class="-4418339448232441007" onmouseenter="enter('-4418339448232441007');" onmouseout="out('-4418339448232441007');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 419 -        mFailNum++;                                                                                               </span>
<span class="-8499931761036179208" onmouseenter="enter('-8499931761036179208');" onmouseout="out('-8499931761036179208');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 420 -        mListener.onSubFail(entity);                                                                              </span>
<span class="-5088134094962551809" onmouseenter="enter('-5088134094962551809');" onmouseout="out('-5088134094962551809');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 421 -        //如果失败的任务数大于实际的下载任务数，任务组停止下载                                                                              </span>
<span class="-7579643381750577546" onmouseenter="enter('-7579643381750577546');" onmouseout="out('-7579643381750577546');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 422 -        if (mFailNum &gt;= mActualTaskNum) {                                                                         </span>
<span class="3061937666707654943" onmouseenter="enter('3061937666707654943');" onmouseout="out('3061937666707654943');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 423 -          closeTimer(false);                                                                                      </span>
<span class="5167771793225547847" onmouseenter="enter('5167771793225547847');" onmouseout="out('5167771793225547847');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 424 -          mListener.onStop(mCurrentLocation);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 425 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 426 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 427 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 428 -                                                                                                                  </span>
<span class="-9166659205038143534" onmouseenter="enter('-9166659205038143534');" onmouseout="out('-9166659205038143534');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 429 -    private void reStartTask() {                                                                                  </span>
<span class="694224692856620004" onmouseenter="enter('694224692856620004');" onmouseout="out('694224692856620004');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 430 -      Timer timer = new Timer();                                                                                  </span>
<span class="-3995857028562557665" onmouseenter="enter('-3995857028562557665');" onmouseout="out('-3995857028562557665');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 431 -      timer.schedule(new TimerTask() {                                                                            </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 432 -        @Override public void run() {                                                                             </span>
<span class="-915554303021644808" onmouseenter="enter('-915554303021644808');" onmouseout="out('-915554303021644808');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 433 -          Downloader dt = mDownloaderMap.get(entity.getDownloadUrl());                                            </span>
<span class="8054045842810821752" onmouseenter="enter('8054045842810821752');" onmouseout="out('8054045842810821752');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 434 -          dt.startDownload();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 435 -        }                                                                                                         </span>
<span class="1359862179938126399" onmouseenter="enter('1359862179938126399');" onmouseout="out('1359862179938126399');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 436 -      }, 3000);                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 437 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 438 -                                                                                                                  </span>
<span class="7889271447688685611" onmouseenter="enter('7889271447688685611');" onmouseout="out('7889271447688685611');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 439 -    private void handleSpeed(long speed) {                                                                        </span>
<span class="-8903176931212217262" onmouseenter="enter('-8903176931212217262');" onmouseout="out('-8903176931212217262');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 440 -      entity.setSpeed(speed);                                                                                     </span>
<span class="-458871634303822896" onmouseenter="enter('-458871634303822896');" onmouseout="out('-458871634303822896');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 441 -      entity.setConvertSpeed(speed &lt;= 0 ? &quot;&quot; : CommonUtil.formatFileSize(speed) + &quot;/s&quot;);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 442 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 443 -                                                                                                                  </span>
<span class="-8417795030437306969" onmouseenter="enter('-8417795030437306969');" onmouseout="out('-8417795030437306969');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 444 -    private void saveData(int state, long location) {                                                             </span>
<span class="1870432086074469274" onmouseenter="enter('1870432086074469274');" onmouseout="out('1870432086074469274');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 445 -      entity.setState(state);                                                                                     </span>
<span class="5476417475415693432" onmouseenter="enter('5476417475415693432');" onmouseout="out('5476417475415693432');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 446 -      entity.setComplete(state == IEntity.STATE_COMPLETE);                                                        </span>
<span class="-1375586946810284641" onmouseenter="enter('-1375586946810284641');" onmouseout="out('-1375586946810284641');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 447 -      if (entity.isComplete()) {                                                                                  </span>
<span class="7860072371622563794" onmouseenter="enter('7860072371622563794');" onmouseout="out('7860072371622563794');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 448 -        entity.setCompleteTime(System.currentTimeMillis());                                                       </span>
<span class="-417755752443399839" onmouseenter="enter('-417755752443399839');" onmouseout="out('-417755752443399839');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 449 -        entity.setCurrentProgress(entity.getFileSize());                                                          </span>
<span class="-4932930723349285601" onmouseenter="enter('-4932930723349285601');" onmouseout="out('-4932930723349285601');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 450 -      } else if (location &gt; 0) {                                                                                  </span>
<span class="8919645422588846117" onmouseenter="enter('8919645422588846117');" onmouseout="out('8919645422588846117');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 451 -        entity.setCurrentProgress(location);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 452 -      }                                                                                                           </span>
<span class="-733466174510760140" onmouseenter="enter('-733466174510760140');" onmouseout="out('-733466174510760140');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 453 -      entity.update();                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 454 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 455 -                                                                                                                  </span>
<span class="-4067662255690266791" onmouseenter="enter('-4067662255690266791');" onmouseout="out('-4067662255690266791');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 456 -    @Override public void supportBreakpoint(boolean support) {                                                    </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 457 -                                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 458 -    }                                                                                                             </span>
<span class="8019628728195433582" onmouseenter="enter('8019628728195433582');" onmouseout="out('8019628728195433582');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 459 +    return new HttpFileInfoThread(taskEntity, callback);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 460    }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 461  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            