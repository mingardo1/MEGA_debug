<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>354</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    354
                    <a href="353.html">prev</a>
                    <a href="355.html">next</a>
                    <a href="354_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_999109be2fedd4c8ecb84850737b6444c04b35f6_core/src/main/java/com/dtstack/flink/sql/side/SideSqlExec.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;999109be2fedd4c8ecb84850737b6444c04b35f6:core/src/main/java/com/dtstack/flink/sql/side/SideSqlExec.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;999109be2fedd4c8ecb84850737b6444c04b35f6^1:core/src/main/java/com/dtstack/flink/sql/side/SideSqlExec.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;999109be2fedd4c8ecb84850737b6444c04b35f6^2:core/src/main/java/com/dtstack/flink/sql/side/SideSqlExec.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;622b4b8bf10b2c46c725d2ea85bf82c704d459c0:core/src/main/java/com/dtstack/flink/sql/side/SideSqlExec.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [b], [b], [b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  20 package com.dtstack.flink.sql.side;                                                                      </span>
<span  style="">  21                                                                                                          </span>
<span class="8826438848011158297" onmouseenter="enter('8826438848011158297');" onmouseout="out('8826438848011158297');" style="">  22 import com.dtstack.flink.sql.enums.ECacheType;                                                           </span>
<span class="1760694872476698727" onmouseenter="enter('1760694872476698727');" onmouseout="out('1760694872476698727');" style="">  23 import com.dtstack.flink.sql.exec.FlinkSQLExec;                                                          </span>
<span class="2626775214998945029" onmouseenter="enter('2626775214998945029');" onmouseout="out('2626775214998945029');" style="">  24 import com.dtstack.flink.sql.parser.CreateTmpTableParser;                                                </span>
<span class="7697893187981436175" onmouseenter="enter('7697893187981436175');" onmouseout="out('7697893187981436175');" style="">  25 import com.dtstack.flink.sql.side.operator.SideAsyncOperator;                                            </span>
<span class="-7456990469468101750" onmouseenter="enter('-7456990469468101750');" onmouseout="out('-7456990469468101750');" style="">  26 import com.dtstack.flink.sql.side.operator.SideWithAllCacheOperator;                                     </span>
<span class="4874498590411064411" onmouseenter="enter('4874498590411064411');" onmouseout="out('4874498590411064411');" style="">  27 import com.dtstack.flink.sql.util.ClassUtil;                                                             </span>
<span class="-4585055968129153397" onmouseenter="enter('-4585055968129153397');" onmouseout="out('-4585055968129153397');" style="">  28 import com.dtstack.flink.sql.util.ParseUtils;                                                            </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  29 import com.dtstack.flink.sql.util.TableUtils;                                                            </span>
<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  30 import com.google.common.base.Preconditions;                                                             </span>
<span class="-5849322492369628764" onmouseenter="enter('-5849322492369628764');" onmouseout="out('-5849322492369628764');" style="">  31 import com.google.common.collect.HashBasedTable;                                                         </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  32 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  33 import com.google.common.collect.Maps;                                                                   </span>
<span class="6390139568718476113" onmouseenter="enter('6390139568718476113');" onmouseout="out('6390139568718476113');" style="">  34 import com.google.common.collect.Sets;                                                                   </span>
<span class="5169042772451251702" onmouseenter="enter('5169042772451251702');" onmouseout="out('5169042772451251702');" style="">  35 import org.apache.calcite.sql.*;                                                                         </span>
<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="">  36 import org.apache.calcite.sql.parser.SqlParseException;                                                  </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  37 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  38 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="-4869246525166490693" onmouseenter="enter('-4869246525166490693');" onmouseout="out('-4869246525166490693');" style="">  39 import org.apache.flink.api.common.typeinfo.TypeInformation;                                             </span>
<span class="-5176867084763361213" onmouseenter="enter('-5176867084763361213');" onmouseout="out('-5176867084763361213');" style="">  40 import org.apache.flink.api.common.typeinfo.Types;                                                       </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  41 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  42 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="-2654529550501634008" onmouseenter="enter('-2654529550501634008');" onmouseout="out('-2654529550501634008');" style="">  43 import org.apache.flink.api.java.typeutils.TupleTypeInfo;                                                </span>
<span class="329774846923224587" onmouseenter="enter('329774846923224587');" onmouseout="out('329774846923224587');" style="">  44 import org.apache.flink.streaming.api.datastream.DataStream;                                             </span>
<span class="7654739943616372616" onmouseenter="enter('7654739943616372616');" onmouseout="out('7654739943616372616');" style="">  45 import org.apache.flink.table.api.EnvironmentSettings;                                                   </span>
<span class="5165777186879784670" onmouseenter="enter('5165777186879784670');" onmouseout="out('5165777186879784670');" style="">  46 import org.apache.flink.table.api.Table;                                                                 </span>
<span class="-8888728238394280005" onmouseenter="enter('-8888728238394280005');" onmouseout="out('-8888728238394280005');" style="">  47 import org.apache.flink.table.api.TableSchema;                                                           </span>
<span class="776922417053783834" onmouseenter="enter('776922417053783834');" onmouseout="out('776922417053783834');" style="">  48 import org.apache.flink.table.api.java.StreamTableEnvironment;                                           </span>
<span class="-1569555401775623611" onmouseenter="enter('-1569555401775623611');" onmouseout="out('-1569555401775623611');" style="">  49 import org.apache.flink.table.runtime.typeutils.BaseRowTypeInfo;                                         </span>
<span class="-7056535177411590719" onmouseenter="enter('-7056535177411590719');" onmouseout="out('-7056535177411590719');" style="">  50 import org.apache.flink.table.types.logical.LogicalType;                                                 </span>
<span class="6625190898426831134" onmouseenter="enter('6625190898426831134');" onmouseout="out('6625190898426831134');" style="">  51 import org.apache.flink.table.catalog.ObjectIdentifier;                                                  </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="">  52 import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                           </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  53 import org.apache.flink.types.Row;                                                                       </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  54 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  55 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  56                                                                                                          </span>
<span class="-608398790767092657" onmouseenter="enter('-608398790767092657');" onmouseout="out('-608398790767092657');" style="">  57 import java.time.LocalDateTime;                                                                          </span>
<span class="196713859697444637" onmouseenter="enter('196713859697444637');" onmouseout="out('196713859697444637');" style="">  58 import java.util.*;                                                                                      </span>
<span  style="">  59                                                                                                          </span>
<span class="7147213704442467623" onmouseenter="enter('7147213704442467623');" onmouseout="out('7147213704442467623');" style="">  60 import static org.apache.calcite.sql.SqlKind.*;                                                          </span>
<span  style="">  61                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  62 /**                                                                                                      </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  63  * Reason:                                                                                               </span>
<span class="-6082749432478588798" onmouseenter="enter('-6082749432478588798');" onmouseout="out('-6082749432478588798');" style="">  64  * Date: 2018/7/24                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  65  * Company: www.dtstack.com                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  66  *                                                                                                       </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  67  * @author xuchao                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  68  */                                                                                                      </span>
<span  style="">  69                                                                                                          </span>
<span class="-5079038956292767116" onmouseenter="enter('-5079038956292767116');" onmouseout="out('-5079038956292767116');" style="">  70 public class SideSqlExec {                                                                               </span>
<span  style="">  71                                                                                                          </span>
<span class="-8991898280301588076" onmouseenter="enter('-8991898280301588076');" onmouseout="out('-8991898280301588076');" style="">  72     private static final Logger LOG = LoggerFactory.getLogger(SideSqlExec.class);                        </span>
<span  style="">  73                                                                                                          </span>
<span class="-6334022460956670337" onmouseenter="enter('-6334022460956670337');" onmouseout="out('-6334022460956670337');" style="">  74     private String localSqlPluginPath = null;                                                            </span>
<span  style="">  75                                                                                                          </span>
<span class="-863593709646632598" onmouseenter="enter('-863593709646632598');" onmouseout="out('-863593709646632598');" style="">  76     private String tmpFields = null;                                                                     </span>
<span  style="">  77                                                                                                          </span>
<span class="2496130613254560337" onmouseenter="enter('2496130613254560337');" onmouseout="out('2496130613254560337');" style="">  78     private String pluginLoadMode = null;                                                                </span>
<span  style="">  79                                                                                                          </span>
<span class="8878309237265342483" onmouseenter="enter('8878309237265342483');" onmouseout="out('8878309237265342483');" style="">  80     private SidePredicatesParser sidePredicatesParser = new SidePredicatesParser();                      </span>
<span  style="">  81                                                                                                          </span>
<span class="4175687380086503813" onmouseenter="enter('4175687380086503813');" onmouseout="out('4175687380086503813');" style="">  82     private Map&lt;String, Table&gt; localTableCache = Maps.newHashMap();                                      </span>
<span  style="">  83                                                                                                          </span>
<span class="5235405798143461797" onmouseenter="enter('5235405798143461797');" onmouseout="out('5235405798143461797');" style="">  84     public void exec(String sql,                                                                         </span>
<span class="-876340320175790120" onmouseenter="enter('-876340320175790120');" onmouseout="out('-876340320175790120');" style="">  85                      Map&lt;String, AbstractSideTableInfo&gt; sideTableMap,                                    </span>
<span class="4244108408582304218" onmouseenter="enter('4244108408582304218');" onmouseout="out('4244108408582304218');" style="">  86                      StreamTableEnvironment tableEnv,                                                    </span>
<span class="-1493383746124052329" onmouseenter="enter('-1493383746124052329');" onmouseout="out('-1493383746124052329');" style="">  87                      Map&lt;String, Table&gt; tableCache,                                                      </span>
<span class="-7862911349817835208" onmouseenter="enter('-7862911349817835208');" onmouseout="out('-7862911349817835208');" style="">  88                      CreateTmpTableParser.SqlParserResult createView,                                    </span>
<span class="2986641263782067303" onmouseenter="enter('2986641263782067303');" onmouseout="out('2986641263782067303');" style="">  89                      String scope) throws Exception {                                                    </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  90 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  91 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-863593709646632598" onmouseenter="enter('-863593709646632598');" onmouseout="out('-863593709646632598');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92     private String tmpFields = null;                                                                     </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93                                                                                                          </span>
<span class="8878309237265342483" onmouseenter="enter('8878309237265342483');" onmouseout="out('8878309237265342483');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94     private SidePredicatesParser sidePredicatesParser = new SidePredicatesParser();                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95                                                                                                          </span>
<span class="4175687380086503813" onmouseenter="enter('4175687380086503813');" onmouseout="out('4175687380086503813');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96     private Map&lt;String, Table&gt; localTableCache = Maps.newHashMap();                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97                                                                                                          </span>
<span class="5235405798143461797" onmouseenter="enter('5235405798143461797');" onmouseout="out('5235405798143461797');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98     public void exec(String sql,                                                                         </span>
<span class="-876340320175790120" onmouseenter="enter('-876340320175790120');" onmouseout="out('-876340320175790120');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99                      Map&lt;String, AbstractSideTableInfo&gt; sideTableMap,                                    </span>
<span class="4244108408582304218" onmouseenter="enter('4244108408582304218');" onmouseout="out('4244108408582304218');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100                      StreamTableEnvironment tableEnv,                                                    </span>
<span class="-1493383746124052329" onmouseenter="enter('-1493383746124052329');" onmouseout="out('-1493383746124052329');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101                      Map&lt;String, Table&gt; tableCache,                                                      </span>
<span class="-7862911349817835208" onmouseenter="enter('-7862911349817835208');" onmouseout="out('-7862911349817835208');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102                      CreateTmpTableParser.SqlParserResult createView,                                    </span>
<span class="2986641263782067303" onmouseenter="enter('2986641263782067303');" onmouseout="out('2986641263782067303');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103                      String scope) throws Exception {                                                    </span>
<span class="-7184346740499807144" onmouseenter="enter('-7184346740499807144');" onmouseout="out('-7184346740499807144');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104         if(localSqlPluginPath == null){                                                                  </span>
<span class="4243357528698157424" onmouseenter="enter('4243357528698157424');" onmouseout="out('4243357528698157424');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105             throw new RuntimeException(&quot;need to set localSqlPluginPath&quot;);                                </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 106 =======                                                                                                  </span>
<span class="-8459786232159972392" onmouseenter="enter('-8459786232159972392');" onmouseout="out('-8459786232159972392');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 107         if (localSqlPluginPath == null) {                                                                </span>
<span class="4243357528698157424" onmouseenter="enter('4243357528698157424');" onmouseout="out('4243357528698157424');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 108             throw new RuntimeException(&quot;need to set localSqlPluginPath&quot;);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 109         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 110                                                                                                          </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 111 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-6307578536739293325" onmouseenter="enter('-6307578536739293325');" onmouseout="out('-6307578536739293325');" style=""> 112         localTableCache.putAll(tableCache);                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 113         try {                                                                                            </span>
<span class="-7778408363768085476" onmouseenter="enter('-7778408363768085476');" onmouseout="out('-7778408363768085476');" style=""> 114             sidePredicatesParser.fillPredicatesForSideTable(sql, sideTableMap);                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 115         } catch (Exception e) {                                                                          </span>
<span class="-6535415982741029210" onmouseenter="enter('-6535415982741029210');" onmouseout="out('-6535415982741029210');" style=""> 116             LOG.error(&quot;fill predicates for sideTable fail &quot;, e);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117         }                                                                                                </span>
<span  style=""> 118                                                                                                          </span>
<span class="-2666540822034943406" onmouseenter="enter('-2666540822034943406');" onmouseout="out('-2666540822034943406');" style=""> 119         if (createView != null) {                                                                        </span>
<span class="-5051922790285322929" onmouseenter="enter('-5051922790285322929');" onmouseout="out('-5051922790285322929');" style=""> 120             LOG.warn(&quot;create view info\n&quot;);                                                              </span>
<span class="4994977519661454238" onmouseenter="enter('4994977519661454238');" onmouseout="out('4994977519661454238');" style=""> 121             LOG.warn(createView.getExecSql());                                                           </span>
<span class="-6048507734051622776" onmouseenter="enter('-6048507734051622776');" onmouseout="out('-6048507734051622776');" style=""> 122             LOG.warn(&quot;-----------------&quot;);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123         }                                                                                                </span>
<span  style=""> 124                                                                                                          </span>
<span class="3272289589011229925" onmouseenter="enter('3272289589011229925');" onmouseout="out('3272289589011229925');" style=""> 125         SideSQLParser sideSQLParser = new SideSQLParser();                                               </span>
<span class="9221221341975786732" onmouseenter="enter('9221221341975786732');" onmouseout="out('9221221341975786732');" style=""> 126         sideSQLParser.setLocalTableCache(localTableCache);                                               </span>
<span class="6016193463712965966" onmouseenter="enter('6016193463712965966');" onmouseout="out('6016193463712965966');" style=""> 127         Queue&lt;Object&gt; exeQueue = sideSQLParser.getExeQueue(sql, sideTableMap.keySet(), scope);           </span>
<span class="1917635497637273504" onmouseenter="enter('1917635497637273504');" onmouseout="out('1917635497637273504');" style=""> 128         Object pollObj = null;                                                                           </span>
<span  style=""> 129                                                                                                          </span>
<span class="-5058340944145416275" onmouseenter="enter('-5058340944145416275');" onmouseout="out('-5058340944145416275');" style=""> 130         while ((pollObj = exeQueue.poll()) != null) {                                                    </span>
<span  style=""> 131                                                                                                          </span>
<span class="-2443216094467354180" onmouseenter="enter('-2443216094467354180');" onmouseout="out('-2443216094467354180');" style=""> 132             if (pollObj instanceof SqlNode) {                                                            </span>
<span class="-8817010307772649906" onmouseenter="enter('-8817010307772649906');" onmouseout="out('-8817010307772649906');" style=""> 133                 SqlNode pollSqlNode = (SqlNode) pollObj;                                                 </span>
<span  style=""> 134                                                                                                          </span>
<span  style=""> 135                                                                                                          </span>
<span class="-1675849540725983142" onmouseenter="enter('-1675849540725983142');" onmouseout="out('-1675849540725983142');" style=""> 136                 if (pollSqlNode.getKind() == INSERT) {                                                   </span>
<span class="4666335002906799727" onmouseenter="enter('4666335002906799727');" onmouseout="out('4666335002906799727');" style=""> 137                     FlinkSQLExec.sqlUpdate(tableEnv, pollSqlNode.toString());                            </span>
<span class="-4873093459421651994" onmouseenter="enter('-4873093459421651994');" onmouseout="out('-4873093459421651994');" style=""> 138                     if (LOG.isInfoEnabled()) {                                                           </span>
<span class="-5986232783970891998" onmouseenter="enter('-5986232783970891998');" onmouseout="out('-5986232783970891998');" style=""> 139                         LOG.info(&quot;----------real exec sql-----------\n{}&quot;, pollSqlNode.toString());      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140                     }                                                                                    </span>
<span  style=""> 141                                                                                                          </span>
<span class="-2457059581629029056" onmouseenter="enter('-2457059581629029056');" onmouseout="out('-2457059581629029056');" style=""> 142                 } else if (pollSqlNode.getKind() == AS) {                                                </span>
<span class="3037765200739894050" onmouseenter="enter('3037765200739894050');" onmouseout="out('3037765200739894050');" style=""> 143                     dealAsSourceTable(tableEnv, pollSqlNode, tableCache);                                </span>
<span  style=""> 144                                                                                                          </span>
<span class="4581342471671871622" onmouseenter="enter('4581342471671871622');" onmouseout="out('4581342471671871622');" style=""> 145                 } else if (pollSqlNode.getKind() == WITH_ITEM) {                                         </span>
<span class="9089825500288046356" onmouseenter="enter('9089825500288046356');" onmouseout="out('9089825500288046356');" style=""> 146                     SqlWithItem sqlWithItem = (SqlWithItem) pollSqlNode;                                 </span>
<span class="-7674640876687845363" onmouseenter="enter('-7674640876687845363');" onmouseout="out('-7674640876687845363');" style=""> 147                     String TableAlias = sqlWithItem.name.toString();                                     </span>
<span class="2573668668184904794" onmouseenter="enter('2573668668184904794');" onmouseout="out('2573668668184904794');" style=""> 148                     Table table = tableEnv.sqlQuery(sqlWithItem.query.toString());                       </span>
<span class="2341577843786962651" onmouseenter="enter('2341577843786962651');" onmouseout="out('2341577843786962651');" style=""> 149                     tableEnv.registerTable(TableAlias, table);                                           </span>
<span  style=""> 150                                                                                                          </span>
<span class="-5550860322814932769" onmouseenter="enter('-5550860322814932769');" onmouseout="out('-5550860322814932769');" style=""> 151                 } else if (pollSqlNode.getKind() == SELECT) {                                            </span>
<span class="-1344441018307209750" onmouseenter="enter('-1344441018307209750');" onmouseout="out('-1344441018307209750');" style=""><abbr title=" 152                     Preconditions.checkState(createView != null, &quot;select sql must included by create view&quot;);"> 152                     Preconditions.checkState(createView != null, &quot;select sql must included by create view🔵</abbr></span>
<span class="1694293925390283740" onmouseenter="enter('1694293925390283740');" onmouseout="out('1694293925390283740');" style=""> 153                     Table table = tableEnv.sqlQuery(pollObj.toString());                                 </span>
<span  style=""> 154                                                                                                          </span>
<span class="2239810942967083761" onmouseenter="enter('2239810942967083761');" onmouseout="out('2239810942967083761');" style=""> 155                     if (createView.getFieldsInfoStr() == null) {                                         </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 156                         tableEnv.registerTable(createView.getTableName(), table);                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 157                     } else {                                                                             </span>
<span class="6460464009712843539" onmouseenter="enter('6460464009712843539');" onmouseout="out('6460464009712843539');" style=""> 158                         if (checkFieldsInfo(createView, table)) {                                        </span>
<span class="-9109211084540213069" onmouseenter="enter('-9109211084540213069');" onmouseout="out('-9109211084540213069');" style=""> 159                             table = table.as(tmpFields);                                                 </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 160                             tableEnv.registerTable(createView.getTableName(), table);                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 161                         } else {                                                                         </span>
<span class="-4180003952862210397" onmouseenter="enter('-4180003952862210397');" onmouseout="out('-4180003952862210397');" style=""> 162                             throw new RuntimeException(&quot;Fields mismatch&quot;);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164                     }                                                                                    </span>
<span  style=""> 165                                                                                                          </span>
<span class="-5831701022468144749" onmouseenter="enter('-5831701022468144749');" onmouseout="out('-5831701022468144749');" style=""> 166                     localTableCache.put(createView.getTableName(), table);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167                 }                                                                                        </span>
<span  style=""> 168                                                                                                          </span>
<span class="735190908606907144" onmouseenter="enter('735190908606907144');" onmouseout="out('735190908606907144');" style=""> 169             } else if (pollObj instanceof JoinInfo) {                                                    </span>
<span class="-6196622619540139248" onmouseenter="enter('-6196622619540139248');" onmouseout="out('-6196622619540139248');" style=""> 170                 LOG.info(&quot;----------exec join info----------\n{}&quot;, pollObj.toString());                  </span>
<span class="-3518617829078174884" onmouseenter="enter('-3518617829078174884');" onmouseout="out('-3518617829078174884');" style=""> 171                 joinFun(pollObj, localTableCache, sideTableMap, tableEnv);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173         }                                                                                                </span>
<span  style=""> 174                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175     }                                                                                                    </span>
<span  style=""> 176                                                                                                          </span>
<span  style=""> 177                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 178     /**                                                                                                  </span>
<span class="-7226459799151937672" onmouseenter="enter('-7226459799151937672');" onmouseout="out('-7226459799151937672');" style=""> 179      * 解析出as查询的表和字段的关系                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 180      *                                                                                                   </span>
<span class="-4711911052088894915" onmouseenter="enter('-4711911052088894915');" onmouseout="out('-4711911052088894915');" style=""> 181      * @param asSqlNode                                                                                  </span>
<span class="-8172984871762282794" onmouseenter="enter('-8172984871762282794');" onmouseout="out('-8172984871762282794');" style=""> 182      * @param tableCache                                                                                 </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 183      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 184      */                                                                                                  </span>
<span class="1606768570861189432" onmouseenter="enter('1606768570861189432');" onmouseout="out('1606768570861189432');" style=""> 185     private FieldReplaceInfo parseAsQuery(SqlBasicCall asSqlNode, Map&lt;String, Table&gt; tableCache) {       </span>
<span class="-4950849472737015743" onmouseenter="enter('-4950849472737015743');" onmouseout="out('-4950849472737015743');" style=""> 186         SqlNode info = asSqlNode.getOperands()[0];                                                       </span>
<span class="-6049998703041327008" onmouseenter="enter('-6049998703041327008');" onmouseout="out('-6049998703041327008');" style=""> 187         SqlNode alias = asSqlNode.getOperands()[1];                                                      </span>
<span  style=""> 188                                                                                                          </span>
<span class="6169254144825097648" onmouseenter="enter('6169254144825097648');" onmouseout="out('6169254144825097648');" style=""> 189         SqlKind infoKind = info.getKind();                                                               </span>
<span class="-7038358418253063490" onmouseenter="enter('-7038358418253063490');" onmouseout="out('-7038358418253063490');" style=""> 190         if (infoKind != SELECT) {                                                                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 191             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192         }                                                                                                </span>
<span  style=""> 193                                                                                                          </span>
<span class="1448651332248375248" onmouseenter="enter('1448651332248375248');" onmouseout="out('1448651332248375248');" style=""> 194         List&lt;FieldInfo&gt; extractFieldList = TableUtils.parserSelectField((SqlSelect) info, tableCache);   </span>
<span  style=""> 195                                                                                                          </span>
<span class="-3840015462696951757" onmouseenter="enter('-3840015462696951757');" onmouseout="out('-3840015462696951757');" style=""> 196         HashBasedTable&lt;String, String, String&gt; mappingTable = HashBasedTable.create();                   </span>
<span class="-5476396715494077219" onmouseenter="enter('-5476396715494077219');" onmouseout="out('-5476396715494077219');" style=""> 197         for (FieldInfo fieldInfo : extractFieldList) {                                                   </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 198             String tableName = fieldInfo.getTable();                                                     </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 199             String fieldName = fieldInfo.getFieldName();                                                 </span>
<span class="4185539436596522295" onmouseenter="enter('4185539436596522295');" onmouseout="out('4185539436596522295');" style=""> 200             String mappingFieldName = ParseUtils.dealDuplicateFieldName(mappingTable, fieldName);        </span>
<span class="-7827879044056282695" onmouseenter="enter('-7827879044056282695');" onmouseout="out('-7827879044056282695');" style=""> 201             mappingTable.put(tableName, fieldName, mappingFieldName);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202         }                                                                                                </span>
<span  style=""> 203                                                                                                          </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 204         FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                           </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 205         replaceInfo.setMappingTable(mappingTable);                                                       </span>
<span class="9115675088981905484" onmouseenter="enter('9115675088981905484');" onmouseout="out('9115675088981905484');" style=""> 206         replaceInfo.setTargetTableName(alias.toString());                                                </span>
<span class="-6295883374697236710" onmouseenter="enter('-6295883374697236710');" onmouseout="out('-6295883374697236710');" style=""> 207         replaceInfo.setTargetTableAlias(alias.toString());                                               </span>
<span class="2754859294214862032" onmouseenter="enter('2754859294214862032');" onmouseout="out('2754859294214862032');" style=""> 208         return replaceInfo;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209     }                                                                                                    </span>
<span  style=""> 210                                                                                                          </span>
<span  style=""> 211                                                                                                          </span>
<span class="73834954090191073" onmouseenter="enter('73834954090191073');" onmouseout="out('73834954090191073');" style=""> 212     public AliasInfo parseASNode(SqlNode sqlNode) throws SqlParseException {                             </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 213         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="-2199822100243684238" onmouseenter="enter('-2199822100243684238');" onmouseout="out('-2199822100243684238');" style=""> 214         if (sqlKind != AS) {                                                                             </span>
<span class="1088430228081547460" onmouseenter="enter('1088430228081547460');" onmouseout="out('1088430228081547460');" style=""> 215             throw new RuntimeException(sqlNode + &quot; is not &#x27;as&#x27; operator&quot;);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216         }                                                                                                </span>
<span  style=""> 217                                                                                                          </span>
<span class="-7770788458619826788" onmouseenter="enter('-7770788458619826788');" onmouseout="out('-7770788458619826788');" style=""> 218         SqlNode info = ((SqlBasicCall) sqlNode).getOperands()[0];                                        </span>
<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style=""> 219         SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                                       </span>
<span  style=""> 220                                                                                                          </span>
<span class="-2458625767668584085" onmouseenter="enter('-2458625767668584085');" onmouseout="out('-2458625767668584085');" style=""> 221         AliasInfo aliasInfo = new AliasInfo();                                                           </span>
<span class="-5109084571101185803" onmouseenter="enter('-5109084571101185803');" onmouseout="out('-5109084571101185803');" style=""> 222         aliasInfo.setName(info.toString());                                                              </span>
<span class="-6584143955119724642" onmouseenter="enter('-6584143955119724642');" onmouseout="out('-6584143955119724642');" style=""> 223         aliasInfo.setAlias(alias.toString());                                                            </span>
<span  style=""> 224                                                                                                          </span>
<span class="-3107000398971930583" onmouseenter="enter('-3107000398971930583');" onmouseout="out('-3107000398971930583');" style=""> 225         return aliasInfo;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226     }                                                                                                    </span>
<span  style=""> 227                                                                                                          </span>
<span class="6012642327394790947" onmouseenter="enter('6012642327394790947');" onmouseout="out('6012642327394790947');" style=""> 228     public BaseRowTypeInfo buildOutRowTypeInfo(List&lt;FieldInfo&gt; sideJoinFieldInfo,                        </span>
<span class="244517366126553103" onmouseenter="enter('244517366126553103');" onmouseout="out('244517366126553103');" style=""> 229                                                HashBasedTable&lt;String, String, String&gt; mappingTable) {    </span>
<span class="-9126530720291690226" onmouseenter="enter('-9126530720291690226');" onmouseout="out('-9126530720291690226');" style=""> 230         // TypeInformation[] sideOutTypes = new TypeInformation[sideJoinFieldInfo.size()];               </span>
<span class="2784978011557375723" onmouseenter="enter('2784978011557375723');" onmouseout="out('2784978011557375723');" style=""> 231         LogicalType[] sideOutTypes = new LogicalType[sideJoinFieldInfo.size()];                          </span>
<span class="-637166731779412769" onmouseenter="enter('-637166731779412769');" onmouseout="out('-637166731779412769');" style=""> 232         String[] sideOutNames = new String[sideJoinFieldInfo.size()];                                    </span>
<span class="7438730024850909889" onmouseenter="enter('7438730024850909889');" onmouseout="out('7438730024850909889');" style=""> 233         for (int i = 0; i &lt; sideJoinFieldInfo.size(); i++) {                                             </span>
<span class="2207877773063469724" onmouseenter="enter('2207877773063469724');" onmouseout="out('2207877773063469724');" style=""> 234             FieldInfo fieldInfo = sideJoinFieldInfo.get(i);                                              </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 235             String tableName = fieldInfo.getTable();                                                     </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 236             String fieldName = fieldInfo.getFieldName();                                                 </span>
<span  style=""> 237                                                                                                          </span>
<span class="3640983111807923268" onmouseenter="enter('3640983111807923268');" onmouseout="out('3640983111807923268');" style=""> 238             String mappingFieldName = mappingTable.get(tableName, fieldName);                            </span>
<span class="-4165873345254348507" onmouseenter="enter('-4165873345254348507');" onmouseout="out('-4165873345254348507');" style=""><abbr title=" 239             Preconditions.checkNotNull(mappingFieldName, fieldInfo + &quot; not mapping any field! it may be frame bug&quot;);"> 239             Preconditions.checkNotNull(mappingFieldName, fieldInfo + &quot; not mapping any field! it may be f🔵</abbr></span>
<span  style=""> 240                                                                                                          </span>
<span class="-4639076863607040957" onmouseenter="enter('-4639076863607040957');" onmouseout="out('-4639076863607040957');" style=""> 241             sideOutTypes[i] = fieldInfo.getLogicalType();                                                </span>
<span class="6276485717663783154" onmouseenter="enter('6276485717663783154');" onmouseout="out('6276485717663783154');" style=""> 242             sideOutNames[i] = mappingFieldName;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243         }                                                                                                </span>
<span class="-8180554737552837485" onmouseenter="enter('-8180554737552837485');" onmouseout="out('-8180554737552837485');" style=""> 244         return new BaseRowTypeInfo(sideOutTypes, sideOutNames);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245     }                                                                                                    </span>
<span  style=""> 246                                                                                                          </span>
<span  style=""> 247                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 248     /**                                                                                                  </span>
<span class="-7122456494290950261" onmouseenter="enter('-7122456494290950261');" onmouseout="out('-7122456494290950261');" style=""> 249      * 对时间类型进行类型转换                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 250      *                                                                                                   </span>
<span class="-7981851073621455488" onmouseenter="enter('-7981851073621455488');" onmouseout="out('-7981851073621455488');" style=""> 251      * @param leftTypeInfo                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 252      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 253      */                                                                                                  </span>
<span class="109255438874014135" onmouseenter="enter('109255438874014135');" onmouseout="out('109255438874014135');" style=""> 254     private RowTypeInfo buildLeftTableOutType(RowTypeInfo leftTypeInfo) {                                </span>
<span class="5269317691380571116" onmouseenter="enter('5269317691380571116');" onmouseout="out('5269317691380571116');" style=""> 255         TypeInformation[] sideOutTypes = new TypeInformation[leftTypeInfo.getFieldNames().length];       </span>
<span class="357447233987634249" onmouseenter="enter('357447233987634249');" onmouseout="out('357447233987634249');" style=""> 256         TypeInformation&lt;?&gt;[] fieldTypes = leftTypeInfo.getFieldTypes();                                  </span>
<span class="-7313385440196867180" onmouseenter="enter('-7313385440196867180');" onmouseout="out('-7313385440196867180');" style=""> 257         for (int i = 0; i &lt; sideOutTypes.length; i++) {                                                  </span>
<span class="-314833607359598646" onmouseenter="enter('-314833607359598646');" onmouseout="out('-314833607359598646');" style=""> 258             sideOutTypes[i] = convertTimeAttributeType(fieldTypes[i]);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259         }                                                                                                </span>
<span class="-6446480870466684625" onmouseenter="enter('-6446480870466684625');" onmouseout="out('-6446480870466684625');" style=""> 260         RowTypeInfo rowTypeInfo = new RowTypeInfo(sideOutTypes, leftTypeInfo.getFieldNames());           </span>
<span class="6189116692514123920" onmouseenter="enter('6189116692514123920');" onmouseout="out('6189116692514123920');" style=""> 261         return rowTypeInfo;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262     }                                                                                                    </span>
<span  style=""> 263                                                                                                          </span>
<span class="2471506251995792847" onmouseenter="enter('2471506251995792847');" onmouseout="out('2471506251995792847');" style=""> 264     private TypeInformation convertTimeAttributeType(TypeInformation typeInformation) {                  </span>
<span class="2997926285576198837" onmouseenter="enter('2997926285576198837');" onmouseout="out('2997926285576198837');" style=""> 265         if (typeInformation instanceof TimeIndicatorTypeInfo) {                                          </span>
<span class="-4699013589387269243" onmouseenter="enter('-4699013589387269243');" onmouseout="out('-4699013589387269243');" style=""> 266             return TypeInformation.of(LocalDateTime.class);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267         }                                                                                                </span>
<span class="6871348106862514693" onmouseenter="enter('6871348106862514693');" onmouseout="out('6871348106862514693');" style=""> 268         return typeInformation;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269     }                                                                                                    </span>
<span  style=""> 270                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 271 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 272 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="6189116692514123920" onmouseenter="enter('6189116692514123920');" onmouseout="out('6189116692514123920');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 273         return rowTypeInfo;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 274     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 275                                                                                                          </span>
<span class="2471506251995792847" onmouseenter="enter('2471506251995792847');" onmouseout="out('2471506251995792847');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 276     private TypeInformation convertTimeAttributeType(TypeInformation typeInformation) {                  </span>
<span class="2997926285576198837" onmouseenter="enter('2997926285576198837');" onmouseout="out('2997926285576198837');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 277         if (typeInformation instanceof TimeIndicatorTypeInfo) {                                          </span>
<span class="-4699013589387269243" onmouseenter="enter('-4699013589387269243');" onmouseout="out('-4699013589387269243');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 278             return TypeInformation.of(LocalDateTime.class);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279         }                                                                                                </span>
<span class="6871348106862514693" onmouseenter="enter('6871348106862514693');" onmouseout="out('6871348106862514693');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280         return typeInformation;                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 281 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282                                                                                                          </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 283 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-6722855011181273565" onmouseenter="enter('-6722855011181273565');" onmouseout="out('-6722855011181273565');" style=""> 284     public void setLocalSqlPluginPath(String localSqlPluginPath) {                                       </span>
<span class="6258662942576926140" onmouseenter="enter('6258662942576926140');" onmouseout="out('6258662942576926140');" style=""> 285         this.localSqlPluginPath = localSqlPluginPath;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286     }                                                                                                    </span>
<span  style=""> 287                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 288 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6639781197811189198" onmouseenter="enter('6639781197811189198');" onmouseout="out('6639781197811189198');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 289     public void setPluginLoadMode(String pluginLoadMode) {                                               </span>
<span class="1051014760706894364" onmouseenter="enter('1051014760706894364');" onmouseout="out('1051014760706894364');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 290         this.pluginLoadMode = pluginLoadMode;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 291     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 292                                                                                                          </span>
<span class="2277905399441322839" onmouseenter="enter('2277905399441322839');" onmouseout="out('2277905399441322839');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 293     private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableName){"> 293     private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableNa🔵</abbr></span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 294 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-4699013589387269243" onmouseenter="enter('-4699013589387269243');" onmouseout="out('-4699013589387269243');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295             return TypeInformation.of(LocalDateTime.class);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 296         }                                                                                                </span>
<span class="6871348106862514693" onmouseenter="enter('6871348106862514693');" onmouseout="out('6871348106862514693');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297         return typeInformation;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 302                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304                                                                                                          </span>
<span class="-6722855011181273565" onmouseenter="enter('-6722855011181273565');" onmouseout="out('-6722855011181273565');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305     public void setLocalSqlPluginPath(String localSqlPluginPath) {                                       </span>
<span class="6258662942576926140" onmouseenter="enter('6258662942576926140');" onmouseout="out('6258662942576926140');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306         this.localSqlPluginPath = localSqlPluginPath;                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 307 =======                                                                                                  </span>
<span class="6507980841648709304" onmouseenter="enter('6507980841648709304');" onmouseout="out('6507980841648709304');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 308     private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableName) {"> 308     private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableNa🔵</abbr></span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 309 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-6301156236825066460" onmouseenter="enter('-6301156236825066460');" onmouseout="out('-6301156236825066460');" style=""> 310         Table table = localTableCache.get(tableAlias);                                                   </span>
<span class="1637251780061381079" onmouseenter="enter('1637251780061381079');" onmouseout="out('1637251780061381079');" style=""> 311         if (table == null) {                                                                             </span>
<span class="-5960895848666330323" onmouseenter="enter('-5960895848666330323');" onmouseout="out('-5960895848666330323');" style=""> 312             table = localTableCache.get(tableName);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 313         }                                                                                                </span>
<span  style=""> 314                                                                                                          </span>
<span class="1637251780061381079" onmouseenter="enter('1637251780061381079');" onmouseout="out('1637251780061381079');" style=""> 315         if (table == null) {                                                                             </span>
<span class="4627225224916806199" onmouseenter="enter('4627225224916806199');" onmouseout="out('4627225224916806199');" style=""> 316             throw new RuntimeException(&quot;not register table &quot; + tableAlias);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317         }                                                                                                </span>
<span  style=""> 318                                                                                                          </span>
<span class="-6017334383208509278" onmouseenter="enter('-6017334383208509278');" onmouseout="out('-6017334383208509278');" style=""> 319         return table;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320     }                                                                                                    </span>
<span  style=""> 321                                                                                                          </span>
<span  style=""> 322                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 323     /**                                                                                                  </span>
<span class="5196638318686351881" onmouseenter="enter('5196638318686351881');" onmouseout="out('5196638318686351881');" style=""><abbr title=" 324      * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., dimension table is the primary key definition"> 324      * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., d🔵</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 325      *                                                                                                   </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 326      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 327      */                                                                                                  </span>
<span class="4488554625343324946" onmouseenter="enter('4488554625343324946');" onmouseout="out('4488554625343324946');" style=""><abbr title=" 328     private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInfo sideTableInfo) {"> 328     private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInf🔵</abbr></span>
<span class="-6710736308674703771" onmouseenter="enter('-6710736308674703771');" onmouseout="out('-6710736308674703771');" style=""> 329         List&lt;String&gt; conditionFields = getConditionFields(conditionNode, sideTableAlias, sideTableInfo); </span>
<span class="8847075305465358712" onmouseenter="enter('8847075305465358712');" onmouseout="out('8847075305465358712');" style=""> 330         if (CollectionUtils.isEqualCollection(conditionFields, convertPrimaryAlias(sideTableInfo))) {    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 331             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 333         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334     }                                                                                                    </span>
<span  style=""> 335                                                                                                          </span>
<span class="572998504046101497" onmouseenter="enter('572998504046101497');" onmouseout="out('572998504046101497');" style=""> 336     private List&lt;String&gt; convertPrimaryAlias(AbstractSideTableInfo sideTableInfo) {                      </span>
<span class="-6700733268022775520" onmouseenter="enter('-6700733268022775520');" onmouseout="out('-6700733268022775520');" style=""> 337         List&lt;String&gt; res = Lists.newArrayList();                                                         </span>
<span class="-1517278133900331130" onmouseenter="enter('-1517278133900331130');" onmouseout="out('-1517278133900331130');" style=""> 338         sideTableInfo.getPrimaryKeys().forEach(field -&gt; {                                                </span>
<span class="2991641550935988694" onmouseenter="enter('2991641550935988694');" onmouseout="out('2991641550935988694');" style=""> 339             res.add(sideTableInfo.getPhysicalFields().getOrDefault(field, field));                       </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 340         });                                                                                              </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 341         return res;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342     }                                                                                                    </span>
<span  style=""> 343                                                                                                          </span>
<span class="6064840374032880755" onmouseenter="enter('6064840374032880755');" onmouseout="out('6064840374032880755');" style=""><abbr title=" 344     public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTableInfo sideTableInfo) {"> 344     public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTa🔵</abbr></span>
<span class="-5667062641477778387" onmouseenter="enter('-5667062641477778387');" onmouseout="out('-5667062641477778387');" style=""> 345         List&lt;SqlNode&gt; sqlNodeList = Lists.newArrayList();                                                </span>
<span class="5003747983397221043" onmouseenter="enter('5003747983397221043');" onmouseout="out('5003747983397221043');" style=""> 346         ParseUtils.parseAnd(conditionNode, sqlNodeList);                                                 </span>
<span class="331902561671078290" onmouseenter="enter('331902561671078290');" onmouseout="out('331902561671078290');" style=""> 347         List&lt;String&gt; conditionFields = Lists.newArrayList();                                             </span>
<span class="4227493740309250661" onmouseenter="enter('4227493740309250661');" onmouseout="out('4227493740309250661');" style=""> 348         for (SqlNode sqlNode : sqlNodeList) {                                                            </span>
<span class="-1235221313035004193" onmouseenter="enter('-1235221313035004193');" onmouseout="out('-1235221313035004193');" style=""> 349             if (!SqlKind.COMPARISON.contains(sqlNode.getKind())) {                                       </span>
<span class="4238811186041433324" onmouseenter="enter('4238811186041433324');" onmouseout="out('4238811186041433324');" style=""> 350                 throw new RuntimeException(&quot;not compare operator.&quot;);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351             }                                                                                            </span>
<span  style=""> 352                                                                                                          </span>
<span class="-8493256683164626428" onmouseenter="enter('-8493256683164626428');" onmouseout="out('-8493256683164626428');" style=""> 353             SqlIdentifier left = (SqlIdentifier) ((SqlBasicCall) sqlNode).getOperands()[0];              </span>
<span class="-2634508485734964862" onmouseenter="enter('-2634508485734964862');" onmouseout="out('-2634508485734964862');" style=""> 354             SqlIdentifier right = (SqlIdentifier) ((SqlBasicCall) sqlNode).getOperands()[1];             </span>
<span  style=""> 355                                                                                                          </span>
<span class="-2670749344655178863" onmouseenter="enter('-2670749344655178863');" onmouseout="out('-2670749344655178863');" style=""> 356             String leftTableName = left.getComponent(0).getSimple();                                     </span>
<span class="5188110590184041827" onmouseenter="enter('5188110590184041827');" onmouseout="out('5188110590184041827');" style=""> 357             String rightTableName = right.getComponent(0).getSimple();                                   </span>
<span  style=""> 358                                                                                                          </span>
<span class="8082853509369418918" onmouseenter="enter('8082853509369418918');" onmouseout="out('8082853509369418918');" style=""> 359             String tableCol = &quot;&quot;;                                                                        </span>
<span class="-1233782311271008501" onmouseenter="enter('-1233782311271008501');" onmouseout="out('-1233782311271008501');" style=""> 360             if (leftTableName.equalsIgnoreCase(specifyTableName)) {                                      </span>
<span class="4527748628163402760" onmouseenter="enter('4527748628163402760');" onmouseout="out('4527748628163402760');" style=""> 361                 tableCol = left.getComponent(1).getSimple();                                             </span>
<span class="-2773987473156284347" onmouseenter="enter('-2773987473156284347');" onmouseout="out('-2773987473156284347');" style=""> 362             } else if (rightTableName.equalsIgnoreCase(specifyTableName)) {                              </span>
<span class="4462633703217831544" onmouseenter="enter('4462633703217831544');" onmouseout="out('4462633703217831544');" style=""> 363                 tableCol = right.getComponent(1).getSimple();                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 364             } else {                                                                                     </span>
<span class="3783543445731730404" onmouseenter="enter('3783543445731730404');" onmouseout="out('3783543445731730404');" style=""><abbr title=" 365                 throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specifyTableName));"> 365                 throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specify🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366             }                                                                                            </span>
<span class="-2325401555704525047" onmouseenter="enter('-2325401555704525047');" onmouseout="out('-2325401555704525047');" style=""> 367             tableCol = sideTableInfo.getPhysicalFields().getOrDefault(tableCol, tableCol);               </span>
<span class="-4552234441929070616" onmouseenter="enter('-4552234441929070616');" onmouseout="out('-4552234441929070616');" style=""> 368             conditionFields.add(tableCol);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369         }                                                                                                </span>
<span  style=""> 370                                                                                                          </span>
<span class="4950082808497882460" onmouseenter="enter('4950082808497882460');" onmouseout="out('4950082808497882460');" style=""> 371         return conditionFields;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372     }                                                                                                    </span>
<span  style=""> 373                                                                                                          </span>
<span class="-8173208587282838964" onmouseenter="enter('-8173208587282838964');" onmouseout="out('-8173208587282838964');" style=""> 374     protected void dealAsSourceTable(StreamTableEnvironment tableEnv,                                    </span>
<span class="9126592535894268017" onmouseenter="enter('9126592535894268017');" onmouseout="out('9126592535894268017');" style=""> 375                                      SqlNode pollSqlNode,                                                </span>
<span class="-4636178628928660306" onmouseenter="enter('-4636178628928660306');" onmouseout="out('-4636178628928660306');" style=""> 376                                      Map&lt;String, Table&gt; tableCache) throws SqlParseException {           </span>
<span  style=""> 377                                                                                                          </span>
<span class="-7364020242551640527" onmouseenter="enter('-7364020242551640527');" onmouseout="out('-7364020242551640527');" style=""> 378         AliasInfo aliasInfo = parseASNode(pollSqlNode);                                                  </span>
<span class="2461088292100865778" onmouseenter="enter('2461088292100865778');" onmouseout="out('2461088292100865778');" style=""> 379         if (localTableCache.containsKey(aliasInfo.getName())) {                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 380             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 381         }                                                                                                </span>
<span  style=""> 382                                                                                                          </span>
<span class="-3390660419579622283" onmouseenter="enter('-3390660419579622283');" onmouseout="out('-3390660419579622283');" style=""> 383         Table table = tableEnv.sqlQuery(aliasInfo.getName());                                            </span>
<span class="5901087968051131557" onmouseenter="enter('5901087968051131557');" onmouseout="out('5901087968051131557');" style=""> 384         tableEnv.registerTable(aliasInfo.getAlias(), table);                                             </span>
<span class="1100939894023116874" onmouseenter="enter('1100939894023116874');" onmouseout="out('1100939894023116874');" style=""> 385         localTableCache.put(aliasInfo.getAlias(), table);                                                </span>
<span  style=""> 386                                                                                                          </span>
<span class="7353361537117728269" onmouseenter="enter('7353361537117728269');" onmouseout="out('7353361537117728269');" style=""> 387         LOG.info(&quot;Register Table {} by {}&quot;, aliasInfo.getAlias(), aliasInfo.getName());                  </span>
<span  style=""> 388                                                                                                          </span>
<span class="-8665165690117838262" onmouseenter="enter('-8665165690117838262');" onmouseout="out('-8665165690117838262');" style=""> 389         FieldReplaceInfo fieldReplaceInfo = parseAsQuery((SqlBasicCall) pollSqlNode, tableCache);        </span>
<span class="7661155268446817101" onmouseenter="enter('7661155268446817101');" onmouseout="out('7661155268446817101');" style=""> 390         if (fieldReplaceInfo == null) {                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 391             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392         }                                                                                                </span>
<span  style=""> 393                                                                                                          </span>
<span class="-6438671410831308886" onmouseenter="enter('-6438671410831308886');" onmouseout="out('-6438671410831308886');" style=""> 394         //as 的源表                                                                                         </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 395         Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                </span>
<span class="1897837925292711985" onmouseenter="enter('1897837925292711985');" onmouseout="out('1897837925292711985');" style=""> 396         SqlNode fromNode = ((SqlBasicCall) pollSqlNode).getOperands()[0];                                </span>
<span class="8218826531385538687" onmouseenter="enter('8218826531385538687');" onmouseout="out('8218826531385538687');" style=""> 397         TableUtils.getFromTableInfo(fromNode, fromTableNameSet);                                         </span>
<span  style=""> 398                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 399     }                                                                                                    </span>
<span  style=""> 400                                                                                                          </span>
<span class="-894097875121841059" onmouseenter="enter('-894097875121841059');" onmouseout="out('-894097875121841059');" style=""> 401     private void joinFun(Object pollObj,                                                                 </span>
<span class="6823594550750748067" onmouseenter="enter('6823594550750748067');" onmouseout="out('6823594550750748067');" style=""> 402                          Map&lt;String, Table&gt; localTableCache,                                             </span>
<span class="-876340320175790120" onmouseenter="enter('-876340320175790120');" onmouseout="out('-876340320175790120');" style=""> 403                          Map&lt;String, AbstractSideTableInfo&gt; sideTableMap,                                </span>
<span class="-6807648743793384568" onmouseenter="enter('-6807648743793384568');" onmouseout="out('-6807648743793384568');" style=""> 404                          StreamTableEnvironment tableEnv) throws Exception {                             </span>
<span class="-3106951960183426296" onmouseenter="enter('-3106951960183426296');" onmouseout="out('-3106951960183426296');" style=""> 405         JoinInfo joinInfo = (JoinInfo) pollObj;                                                          </span>
<span  style=""> 406                                                                                                          </span>
<span class="-4580559439294190862" onmouseenter="enter('-4580559439294190862');" onmouseout="out('-4580559439294190862');" style=""> 407         JoinScope joinScope = new JoinScope();                                                           </span>
<span class="-6383140859888654083" onmouseenter="enter('-6383140859888654083');" onmouseout="out('-6383140859888654083');" style=""> 408         JoinScope.ScopeChild leftScopeChild = new JoinScope.ScopeChild();                                </span>
<span class="-5401707331330951256" onmouseenter="enter('-5401707331330951256');" onmouseout="out('-5401707331330951256');" style=""> 409         leftScopeChild.setAlias(joinInfo.getLeftTableAlias());                                           </span>
<span class="5108424867732442426" onmouseenter="enter('5108424867732442426');" onmouseout="out('5108424867732442426');" style=""> 410         leftScopeChild.setTableName(joinInfo.getLeftTableName());                                        </span>
<span  style=""> 411                                                                                                          </span>
<span class="-2402361542513321069" onmouseenter="enter('-2402361542513321069');" onmouseout="out('-2402361542513321069');" style=""><abbr title=" 412         Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLeftTableName());"> 412         Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLe🔵</abbr></span>
<span  style=""> 413                                                                                                          </span>
<span class="-6003115091233455661" onmouseenter="enter('-6003115091233455661');" onmouseout="out('-6003115091233455661');" style=""><abbr title=" 414         RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getFieldTypes(), leftTable.getSchema().getFieldNames());"> 414         RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getFieldTypes(), leftTable.getSc🔵</abbr></span>
<span  style=""> 415                                                                                                          </span>
<span class="6844734750257063206" onmouseenter="enter('6844734750257063206');" onmouseout="out('6844734750257063206');" style=""> 416         int length = leftTable.getSchema().getFieldDataTypes().length;                                   </span>
<span class="-7291542410657351968" onmouseenter="enter('-7291542410657351968');" onmouseout="out('-7291542410657351968');" style=""> 417         LogicalType[] logicalTypes = new LogicalType[length];                                            </span>
<span class="-2303162855932529930" onmouseenter="enter('-2303162855932529930');" onmouseout="out('-2303162855932529930');" style=""> 418         for(int i=0; i&lt;length; i++){                                                                     </span>
<span class="1537154519277872520" onmouseenter="enter('1537154519277872520');" onmouseout="out('1537154519277872520');" style=""> 419             logicalTypes[i] = leftTable.getSchema().getFieldDataTypes()[i].getLogicalType();             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420         }                                                                                                </span>
<span  style=""> 421                                                                                                          </span>
<span class="6552727302564022327" onmouseenter="enter('6552727302564022327');" onmouseout="out('6552727302564022327');" style=""><abbr title=" 422         BaseRowTypeInfo leftBaseTypeInfo = new BaseRowTypeInfo(logicalTypes, leftTable.getSchema().getFieldNames());"> 422         BaseRowTypeInfo leftBaseTypeInfo = new BaseRowTypeInfo(logicalTypes, leftTable.getSchema().getFie🔵</abbr></span>
<span  style=""> 423                                                                                                          </span>
<span class="-5303860989220332569" onmouseenter="enter('-5303860989220332569');" onmouseout="out('-5303860989220332569');" style=""> 424         leftScopeChild.setRowTypeInfo(leftTypeInfo);                                                     </span>
<span class="-4838857475621068375" onmouseenter="enter('-4838857475621068375');" onmouseout="out('-4838857475621068375');" style=""> 425         leftScopeChild.setBaseRowTypeInfo(leftBaseTypeInfo);                                             </span>
<span  style=""> 426                                                                                                          </span>
<span class="3043795906382715340" onmouseenter="enter('3043795906382715340');" onmouseout="out('3043795906382715340');" style=""> 427         JoinScope.ScopeChild rightScopeChild = new JoinScope.ScopeChild();                               </span>
<span class="2585249270397691815" onmouseenter="enter('2585249270397691815');" onmouseout="out('2585249270397691815');" style=""> 428         rightScopeChild.setAlias(joinInfo.getRightTableAlias());                                         </span>
<span class="-5072747544386586876" onmouseenter="enter('-5072747544386586876');" onmouseout="out('-5072747544386586876');" style=""> 429         rightScopeChild.setTableName(joinInfo.getRightTableName());                                      </span>
<span class="-6382774479188932768" onmouseenter="enter('-6382774479188932768');" onmouseout="out('-6382774479188932768');" style=""> 430         AbstractSideTableInfo sideTableInfo = sideTableMap.get(joinInfo.getRightTableName());            </span>
<span class="-4894423646294599023" onmouseenter="enter('-4894423646294599023');" onmouseout="out('-4894423646294599023');" style=""> 431         if (sideTableInfo == null) {                                                                     </span>
<span class="-5396801098824602905" onmouseenter="enter('-5396801098824602905');" onmouseout="out('-5396801098824602905');" style=""> 432             sideTableInfo = sideTableMap.get(joinInfo.getRightTableAlias());                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 433         }                                                                                                </span>
<span  style=""> 434                                                                                                          </span>
<span class="-4894423646294599023" onmouseenter="enter('-4894423646294599023');" onmouseout="out('-4894423646294599023');" style=""> 435         if (sideTableInfo == null) {                                                                     </span>
<span class="450947362076537032" onmouseenter="enter('450947362076537032');" onmouseout="out('450947362076537032');" style=""> 436             throw new RuntimeException(&quot;can&#x27;t not find side table:&quot; + joinInfo.getRightTableName());     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437         }                                                                                                </span>
<span  style=""> 438                                                                                                          </span>
<span class="-1562873445908102884" onmouseenter="enter('-1562873445908102884');" onmouseout="out('-1562873445908102884');" style=""> 439         rightScopeChild.setRowTypeInfo(sideTableInfo.getRowTypeInfo());                                  </span>
<span class="76578225160811915" onmouseenter="enter('76578225160811915');" onmouseout="out('76578225160811915');" style=""> 440         rightScopeChild.setBaseRowTypeInfo(sideTableInfo.getBaseRowTypeInfo());                          </span>
<span  style=""> 441                                                                                                          </span>
<span class="-5776192160472100987" onmouseenter="enter('-5776192160472100987');" onmouseout="out('-5776192160472100987');" style=""> 442         joinScope.addScope(leftScopeChild);                                                              </span>
<span class="6805588345897841594" onmouseenter="enter('6805588345897841594');" onmouseout="out('6805588345897841594');" style=""> 443         joinScope.addScope(rightScopeChild);                                                             </span>
<span  style=""> 444                                                                                                          </span>
<span class="2226908158928528195" onmouseenter="enter('2226908158928528195');" onmouseout="out('2226908158928528195');" style=""> 445         HashBasedTable&lt;String, String, String&gt; mappingTable = ((JoinInfo) pollObj).getTableFieldRef();   </span>
<span  style=""> 446                                                                                                          </span>
<span class="-816440763270240777" onmouseenter="enter('-816440763270240777');" onmouseout="out('-816440763270240777');" style=""> 447         //获取两个表的所有字段                                                                                     </span>
<span class="-6198283029075022684" onmouseenter="enter('-6198283029075022684');" onmouseout="out('-6198283029075022684');" style=""><abbr title=" 448         List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), joinScope, true);"> 448         List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), join🔵</abbr></span>
<span class="5016458903510526292" onmouseenter="enter('5016458903510526292');" onmouseout="out('5016458903510526292');" style=""> 449         //通过join的查询字段信息过滤出需要的字段信息                                                                        </span>
<span class="5211893312708517501" onmouseenter="enter('5211893312708517501');" onmouseout="out('5211893312708517501');" style=""><abbr title=" 450         sideJoinFieldInfo.removeIf(tmpFieldInfo -&gt; mappingTable.get(tmpFieldInfo.getTable(), tmpFieldInfo.getFieldName()) == null);"> 450         sideJoinFieldInfo.removeIf(tmpFieldInfo -&gt; mappingTable.get(tmpFieldInfo.getTable(), tmpFieldInfo🔵</abbr></span>
<span  style=""> 451                                                                                                          </span>
<span class="-1467815726997680818" onmouseenter="enter('-1467815726997680818');" onmouseout="out('-1467815726997680818');" style=""> 452         String leftTableAlias = joinInfo.getLeftTableAlias();                                            </span>
<span class="-6434853421912213287" onmouseenter="enter('-6434853421912213287');" onmouseout="out('-6434853421912213287');" style=""> 453         Table targetTable = localTableCache.get(leftTableAlias);                                         </span>
<span class="7125781324026312556" onmouseenter="enter('7125781324026312556');" onmouseout="out('7125781324026312556');" style=""> 454         if (targetTable == null) {                                                                       </span>
<span class="8734197217231436839" onmouseenter="enter('8734197217231436839');" onmouseout="out('8734197217231436839');" style=""> 455             targetTable = localTableCache.get(joinInfo.getLeftTableName());                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 456         }                                                                                                </span>
<span  style=""> 457                                                                                                          </span>
<span class="-1157067725052643612" onmouseenter="enter('-1157067725052643612');" onmouseout="out('-1157067725052643612');" style=""><abbr title=" 458         RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getFieldTypes(), targetTable.getSchema().getFieldNames());"> 458         RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getFieldTypes(), targetTable.getSc🔵</abbr></span>
<span  style=""> 459                                                                                                          </span>
<span class="8331408572102109154" onmouseenter="enter('8331408572102109154');" onmouseout="out('8331408572102109154');" style=""> 460         DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; adaptStream = tableEnv.toRetractStream(targetTable, Row.class); </span>
<span  style=""> 461                                                                                                          </span>
<span class="-6082173173678345991" onmouseenter="enter('-6082173173678345991');" onmouseout="out('-6082173173678345991');" style=""> 462         //join side table before keyby ===&gt; Reducing the size of each dimension table cache of async     </span>
<span class="6301552848628110191" onmouseenter="enter('6301552848628110191');" onmouseout="out('6301552848628110191');" style=""> 463         if (sideTableInfo.isPartitionedJoin()) {                                                         </span>
<span class="-4638861421651181765" onmouseenter="enter('-4638861421651181765');" onmouseout="out('-4638861421651181765');" style=""><abbr title=" 464             List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTableAlias(), sideTableInfo);"> 464             List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTa🔵</abbr></span>
<span class="-1086375650130423707" onmouseenter="enter('-1086375650130423707');" onmouseout="out('-1086375650130423707');" style=""> 465             List&lt;String&gt; fieldNames = Arrays.asList(targetTable.getSchema().getFieldNames());            </span>
<span class="2517152886952033206" onmouseenter="enter('2517152886952033206');" onmouseout="out('2517152886952033206');" style=""> 466             int[] keyIndex = leftJoinColList.stream().mapToInt(fieldNames::indexOf).toArray();           </span>
<span class="-1034511431639552497" onmouseenter="enter('-1034511431639552497');" onmouseout="out('-1034511431639552497');" style=""><abbr title=" 467             adaptStream = adaptStream.keyBy(new TupleKeySelector(keyIndex, projectedTypeInfo(keyIndex, targetTable.getSchema())));"> 467             adaptStream = adaptStream.keyBy(new TupleKeySelector(keyIndex, projectedTypeInfo(keyIndex, ta🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 468         }                                                                                                </span>
<span  style=""> 469                                                                                                          </span>
<span class="8900898589811243168" onmouseenter="enter('8900898589811243168');" onmouseout="out('8900898589811243168');" style=""> 470         DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; dsOut = null;                                                   </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 471 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="3901580925108094660" onmouseenter="enter('3901580925108094660');" onmouseout="out('3901580925108094660');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 472         if(ECacheType.ALL.name().equalsIgnoreCase(sideTableInfo.getCacheType())){                        </span>
<span class="4800933198673881512" onmouseenter="enter('4800933198673881512');" onmouseout="out('4800933198673881512');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 473             dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo, pluginLoadMode);"> 473             dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), 🔵</abbr></span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 474         }else{                                                                                           </span>
<span class="7407295138386527483" onmouseenter="enter('7407295138386527483');" onmouseout="out('7407295138386527483');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 475             dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo, pluginLoadMode);"> 475             dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSq🔵</abbr></span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 476 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 477         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 478                                                                                                          </span>
<span class="8900898589811243168" onmouseenter="enter('8900898589811243168');" onmouseout="out('8900898589811243168');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 479         DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; dsOut = null;                                                   </span>
<span class="3901580925108094660" onmouseenter="enter('3901580925108094660');" onmouseout="out('3901580925108094660');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 480         if(ECacheType.ALL.name().equalsIgnoreCase(sideTableInfo.getCacheType())){                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 481 =======                                                                                                  </span>
<span class="9130962490964334732" onmouseenter="enter('9130962490964334732');" onmouseout="out('9130962490964334732');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 482         if (ECacheType.ALL.name().equalsIgnoreCase(sideTableInfo.getCacheType())) {                      </span>
<span class="7101184136852303035" onmouseenter="enter('7101184136852303035');" onmouseout="out('7101184136852303035');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 483             dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo);"> 483             dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), 🔵</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 484         } else {                                                                                         </span>
<span class="7683243294616380271" onmouseenter="enter('7683243294616380271');" onmouseout="out('7683243294616380271');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 485             dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo);"> 485             dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSq🔵</abbr></span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 486 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 487         }                                                                                                </span>
<span  style=""> 488                                                                                                          </span>
<span class="-7650178877830471821" onmouseenter="enter('-7650178877830471821');" onmouseout="out('-7650178877830471821');" style=""> 489         BaseRowTypeInfo sideOutTypeInfo = buildOutRowTypeInfo(sideJoinFieldInfo, mappingTable);          </span>
<span  style=""> 490                                                                                                          </span>
<span class="993314962060447081" onmouseenter="enter('993314962060447081');" onmouseout="out('993314962060447081');" style=""> 491         TupleTypeInfo tupleTypeInfo = new TupleTypeInfo(Types.BOOLEAN, sideOutTypeInfo);                 </span>
<span class="6600937869795732915" onmouseenter="enter('6600937869795732915');" onmouseout="out('6600937869795732915');" style=""> 492         dsOut.getTransformation().setOutputType(tupleTypeInfo);                                          </span>
<span  style=""> 493                                                                                                          </span>
<span class="4836712590888983064" onmouseenter="enter('4836712590888983064');" onmouseout="out('4836712590888983064');" style=""> 494         String targetTableName = joinInfo.getNewTableName();                                             </span>
<span class="-3094587764130774762" onmouseenter="enter('-3094587764130774762');" onmouseout="out('-3094587764130774762');" style=""> 495         String targetTableAlias = joinInfo.getNewTableAlias();                                           </span>
<span  style=""> 496                                                                                                          </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 497         FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                           </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 498         replaceInfo.setMappingTable(mappingTable);                                                       </span>
<span class="8710576405434192583" onmouseenter="enter('8710576405434192583');" onmouseout="out('8710576405434192583');" style=""> 499         replaceInfo.setTargetTableName(targetTableName);                                                 </span>
<span class="-6613112199475906839" onmouseenter="enter('-6613112199475906839');" onmouseout="out('-6613112199475906839');" style=""> 500         replaceInfo.setTargetTableAlias(targetTableAlias);                                               </span>
<span  style=""> 501                                                                                                          </span>
<span class="-7199180706663944207" onmouseenter="enter('-7199180706663944207');" onmouseout="out('-7199180706663944207');" style=""> 502         ObjectIdentifier objectIdentifier = ObjectIdentifier.of(                                         </span>
<span class="-8235548579753933527" onmouseenter="enter('-8235548579753933527');" onmouseout="out('-8235548579753933527');" style=""> 503                 EnvironmentSettings.DEFAULT_BUILTIN_CATALOG,                                             </span>
<span class="-4707782382614212141" onmouseenter="enter('-4707782382614212141');" onmouseout="out('-4707782382614212141');" style=""> 504                 EnvironmentSettings.DEFAULT_BUILTIN_DATABASE,                                            </span>
<span class="-5532274924697595213" onmouseenter="enter('-5532274924697595213');" onmouseout="out('-5532274924697595213');" style=""> 505                 targetTableName);                                                                        </span>
<span class="5891773481881515301" onmouseenter="enter('5891773481881515301');" onmouseout="out('5891773481881515301');" style=""><abbr title=" 506         boolean tableExists = tableEnv.getCatalog(EnvironmentSettings.DEFAULT_BUILTIN_CATALOG).get().tableExists(objectIdentifier.toObjectPath());"> 506         boolean tableExists = tableEnv.getCatalog(EnvironmentSettings.DEFAULT_BUILTIN_CATALOG).get().tabl🔵</abbr></span>
<span  style=""> 507                                                                                                          </span>
<span class="1897990848761003813" onmouseenter="enter('1897990848761003813');" onmouseout="out('1897990848761003813');" style=""> 508         if (!tableExists) {                                                                              </span>
<span class="-9057257427162955657" onmouseenter="enter('-9057257427162955657');" onmouseout="out('-9057257427162955657');" style=""> 509             Table joinTable = tableEnv.fromDataStream(dsOut);                                            </span>
<span class="7656863459817986298" onmouseenter="enter('7656863459817986298');" onmouseout="out('7656863459817986298');" style=""> 510             tableEnv.createTemporaryView(targetTableName, joinTable);                                    </span>
<span class="5569875846259576593" onmouseenter="enter('5569875846259576593');" onmouseout="out('5569875846259576593');" style=""> 511             localTableCache.put(joinInfo.getNewTableName(), joinTable);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 512         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 513     }                                                                                                    </span>
<span  style=""> 514                                                                                                          </span>
<span class="2503560481488678812" onmouseenter="enter('2503560481488678812');" onmouseout="out('2503560481488678812');" style=""> 515     private TypeInformation&lt;Row&gt; projectedTypeInfo(int[] fields, TableSchema schema) {                   </span>
<span class="-934325254904626531" onmouseenter="enter('-934325254904626531');" onmouseout="out('-934325254904626531');" style=""> 516         String[] fieldNames = schema.getFieldNames();                                                    </span>
<span class="4556717060829301814" onmouseenter="enter('4556717060829301814');" onmouseout="out('4556717060829301814');" style=""> 517         TypeInformation&lt;?&gt;[] fieldTypes = schema.getFieldTypes();                                        </span>
<span  style=""> 518                                                                                                          </span>
<span class="424178526470659793" onmouseenter="enter('424178526470659793');" onmouseout="out('424178526470659793');" style=""><abbr title=" 519         String[] projectedNames = Arrays.stream(fields).mapToObj(i -&gt; fieldNames[i]).toArray(String[]::new);"> 519         String[] projectedNames = Arrays.stream(fields).mapToObj(i -&gt; fieldNames[i]).toArray(String[]::ne🔵</abbr></span>
<span class="5411397013359382914" onmouseenter="enter('5411397013359382914');" onmouseout="out('5411397013359382914');" style=""><abbr title=" 520         TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(i -&gt; fieldTypes[i]).toArray(TypeInformation[]::new);"> 520         TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(i -&gt; fieldTypes[i]).toArray(Typ🔵</abbr></span>
<span class="-5627838059420262860" onmouseenter="enter('-5627838059420262860');" onmouseout="out('-5627838059420262860');" style=""> 521         return new RowTypeInfo(projectedTypes, projectedNames);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 522     }                                                                                                    </span>
<span  style=""> 523                                                                                                          </span>
<span  style=""> 524                                                                                                          </span>
<span class="-410103274617159114" onmouseenter="enter('-410103274617159114');" onmouseout="out('-410103274617159114');" style=""> 525     private boolean checkFieldsInfo(CreateTmpTableParser.SqlParserResult result, Table table) {          </span>
<span class="8925867441251499081" onmouseenter="enter('8925867441251499081');" onmouseout="out('8925867441251499081');" style=""> 526         List&lt;String&gt; fieldNames = new LinkedList&lt;&gt;();                                                    </span>
<span class="-5553816012496774052" onmouseenter="enter('-5553816012496774052');" onmouseout="out('-5553816012496774052');" style=""> 527         String fieldsInfo = result.getFieldsInfoStr();                                                   </span>
<span class="-5855731071361337066" onmouseenter="enter('-5855731071361337066');" onmouseout="out('-5855731071361337066');" style=""> 528         String[] fields = StringUtils.split(fieldsInfo, &quot;,&quot;);                                            </span>
<span class="8167763809890058258" onmouseenter="enter('8167763809890058258');" onmouseout="out('8167763809890058258');" style=""> 529         for (int i = 0; i &lt; fields.length; i++) {                                                        </span>
<span class="2947314498030065040" onmouseenter="enter('2947314498030065040');" onmouseout="out('2947314498030065040');" style=""> 530             String[] filed = fields[i].split(&quot;\\s&quot;);                                                     </span>
<span class="-270449140289704814" onmouseenter="enter('-270449140289704814');" onmouseout="out('-270449140289704814');" style=""> 531             if (filed.length &lt; 2 || fields.length != table.getSchema().getFieldCount()) {                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 532                 return false;                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 533             } else {                                                                                     </span>
<span class="-7518627407039835792" onmouseenter="enter('-7518627407039835792');" onmouseout="out('-7518627407039835792');" style=""> 534                 String[] filedNameArr = new String[filed.length - 1];                                    </span>
<span class="6064994574122217386" onmouseenter="enter('6064994574122217386');" onmouseout="out('6064994574122217386');" style=""> 535                 System.arraycopy(filed, 0, filedNameArr, 0, filed.length - 1);                           </span>
<span class="-3029457015937137256" onmouseenter="enter('-3029457015937137256');" onmouseout="out('-3029457015937137256');" style=""> 536                 String fieldName = String.join(&quot; &quot;, filedNameArr);                                       </span>
<span class="-8037943253867791720" onmouseenter="enter('-8037943253867791720');" onmouseout="out('-8037943253867791720');" style=""> 537                 fieldNames.add(fieldName);                                                               </span>
<span class="5681537301300222292" onmouseenter="enter('5681537301300222292');" onmouseout="out('5681537301300222292');" style=""> 538                 String fieldType = filed[filed.length - 1].trim();                                       </span>
<span class="-8511761590344571010" onmouseenter="enter('-8511761590344571010');" onmouseout="out('-8511761590344571010');" style=""> 539                 Class fieldClass = ClassUtil.stringConvertClass(fieldType);                              </span>
<span class="-351203522969775469" onmouseenter="enter('-351203522969775469');" onmouseout="out('-351203522969775469');" style=""> 540                 Class tableField = table.getSchema().getFieldType(i).get().getTypeClass();               </span>
<span class="-2055572975849334800" onmouseenter="enter('-2055572975849334800');" onmouseout="out('-2055572975849334800');" style=""> 541                 if (fieldClass == tableField) {                                                          </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 542                     continue;                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 543                 } else {                                                                                 </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 544                     return false;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 545                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 546             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 547         }                                                                                                </span>
<span class="-7181802501759976675" onmouseenter="enter('-7181802501759976675');" onmouseout="out('-7181802501759976675');" style=""> 548         tmpFields = String.join(&quot;,&quot;, fieldNames);                                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 549         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 550     }                                                                                                    </span>
<span  style=""> 551                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 552 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span  style="">  20                                                                                                          </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  21 package com.dtstack.flink.sql.side;                                                                      </span>
<span  style="">  22                                                                                                          </span>
<span class="8826438848011158297" onmouseenter="enter('8826438848011158297');" onmouseout="out('8826438848011158297');" style="">  23 import com.dtstack.flink.sql.enums.ECacheType;                                                           </span>
<span class="1760694872476698727" onmouseenter="enter('1760694872476698727');" onmouseout="out('1760694872476698727');" style="">  24 import com.dtstack.flink.sql.exec.FlinkSQLExec;                                                          </span>
<span class="2626775214998945029" onmouseenter="enter('2626775214998945029');" onmouseout="out('2626775214998945029');" style="">  25 import com.dtstack.flink.sql.parser.CreateTmpTableParser;                                                </span>
<span class="7697893187981436175" onmouseenter="enter('7697893187981436175');" onmouseout="out('7697893187981436175');" style="">  26 import com.dtstack.flink.sql.side.operator.SideAsyncOperator;                                            </span>
<span class="-7456990469468101750" onmouseenter="enter('-7456990469468101750');" onmouseout="out('-7456990469468101750');" style="">  27 import com.dtstack.flink.sql.side.operator.SideWithAllCacheOperator;                                     </span>
<span class="4874498590411064411" onmouseenter="enter('4874498590411064411');" onmouseout="out('4874498590411064411');" style="">  28 import com.dtstack.flink.sql.util.ClassUtil;                                                             </span>
<span class="-4585055968129153397" onmouseenter="enter('-4585055968129153397');" onmouseout="out('-4585055968129153397');" style="">  29 import com.dtstack.flink.sql.util.ParseUtils;                                                            </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  30 import com.dtstack.flink.sql.util.TableUtils;                                                            </span>
<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  31 import com.google.common.base.Preconditions;                                                             </span>
<span class="-5849322492369628764" onmouseenter="enter('-5849322492369628764');" onmouseout="out('-5849322492369628764');" style="">  32 import com.google.common.collect.HashBasedTable;                                                         </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  33 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  34 import com.google.common.collect.Maps;                                                                   </span>
<span class="6390139568718476113" onmouseenter="enter('6390139568718476113');" onmouseout="out('6390139568718476113');" style="">  35 import com.google.common.collect.Sets;                                                                   </span>
<span class="5169042772451251702" onmouseenter="enter('5169042772451251702');" onmouseout="out('5169042772451251702');" style="">  36 import org.apache.calcite.sql.*;                                                                         </span>
<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="">  37 import org.apache.calcite.sql.parser.SqlParseException;                                                  </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  38 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  39 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="-4869246525166490693" onmouseenter="enter('-4869246525166490693');" onmouseout="out('-4869246525166490693');" style="">  40 import org.apache.flink.api.common.typeinfo.TypeInformation;                                             </span>
<span class="-5176867084763361213" onmouseenter="enter('-5176867084763361213');" onmouseout="out('-5176867084763361213');" style="">  41 import org.apache.flink.api.common.typeinfo.Types;                                                       </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  42 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  43 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="-2654529550501634008" onmouseenter="enter('-2654529550501634008');" onmouseout="out('-2654529550501634008');" style="">  44 import org.apache.flink.api.java.typeutils.TupleTypeInfo;                                                </span>
<span class="329774846923224587" onmouseenter="enter('329774846923224587');" onmouseout="out('329774846923224587');" style="">  45 import org.apache.flink.streaming.api.datastream.DataStream;                                             </span>
<span class="7654739943616372616" onmouseenter="enter('7654739943616372616');" onmouseout="out('7654739943616372616');" style="">  46 import org.apache.flink.table.api.EnvironmentSettings;                                                   </span>
<span class="5165777186879784670" onmouseenter="enter('5165777186879784670');" onmouseout="out('5165777186879784670');" style="">  47 import org.apache.flink.table.api.Table;                                                                 </span>
<span class="-8888728238394280005" onmouseenter="enter('-8888728238394280005');" onmouseout="out('-8888728238394280005');" style="">  48 import org.apache.flink.table.api.TableSchema;                                                           </span>
<span class="776922417053783834" onmouseenter="enter('776922417053783834');" onmouseout="out('776922417053783834');" style="">  49 import org.apache.flink.table.api.java.StreamTableEnvironment;                                           </span>
<span class="-1569555401775623611" onmouseenter="enter('-1569555401775623611');" onmouseout="out('-1569555401775623611');" style="">  50 import org.apache.flink.table.runtime.typeutils.BaseRowTypeInfo;                                         </span>
<span class="-7056535177411590719" onmouseenter="enter('-7056535177411590719');" onmouseout="out('-7056535177411590719');" style="">  51 import org.apache.flink.table.types.logical.LogicalType;                                                 </span>
<span class="6625190898426831134" onmouseenter="enter('6625190898426831134');" onmouseout="out('6625190898426831134');" style="">  52 import org.apache.flink.table.catalog.ObjectIdentifier;                                                  </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="">  53 import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                           </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  54 import org.apache.flink.types.Row;                                                                       </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  55 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  56 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  57                                                                                                          </span>
<span class="-608398790767092657" onmouseenter="enter('-608398790767092657');" onmouseout="out('-608398790767092657');" style="">  58 import java.time.LocalDateTime;                                                                          </span>
<span class="196713859697444637" onmouseenter="enter('196713859697444637');" onmouseout="out('196713859697444637');" style="">  59 import java.util.*;                                                                                      </span>
<span  style="">  60                                                                                                          </span>
<span class="7147213704442467623" onmouseenter="enter('7147213704442467623');" onmouseout="out('7147213704442467623');" style="">  61 import static org.apache.calcite.sql.SqlKind.*;                                                          </span>
<span  style="">  62                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  63 /**                                                                                                      </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  64  * Reason:                                                                                               </span>
<span class="-6082749432478588798" onmouseenter="enter('-6082749432478588798');" onmouseout="out('-6082749432478588798');" style="">  65  * Date: 2018/7/24                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  66  * Company: www.dtstack.com                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  67  *                                                                                                       </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  68  * @author xuchao                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  69  */                                                                                                      </span>
<span  style="">  70                                                                                                          </span>
<span class="-5079038956292767116" onmouseenter="enter('-5079038956292767116');" onmouseout="out('-5079038956292767116');" style="">  71 public class SideSqlExec {                                                                               </span>
<span  style="">  72                                                                                                          </span>
<span class="-8991898280301588076" onmouseenter="enter('-8991898280301588076');" onmouseout="out('-8991898280301588076');" style="">  73     private static final Logger LOG = LoggerFactory.getLogger(SideSqlExec.class);                        </span>
<span  style="">  74                                                                                                          </span>
<span class="-6334022460956670337" onmouseenter="enter('-6334022460956670337');" onmouseout="out('-6334022460956670337');" style="">  75     private String localSqlPluginPath = null;                                                            </span>
<span  style="">  76                                                                                                          </span>
<span class="-863593709646632598" onmouseenter="enter('-863593709646632598');" onmouseout="out('-863593709646632598');" style="">  77     private String tmpFields = null;                                                                     </span>
<span  style="">  78                                                                                                          </span>
<span class="2496130613254560337" onmouseenter="enter('2496130613254560337');" onmouseout="out('2496130613254560337');" style="">  79     private String pluginLoadMode = null;                                                                </span>
<span  style="">  80                                                                                                          </span>
<span class="8878309237265342483" onmouseenter="enter('8878309237265342483');" onmouseout="out('8878309237265342483');" style="">  81     private SidePredicatesParser sidePredicatesParser = new SidePredicatesParser();                      </span>
<span  style="">  82                                                                                                          </span>
<span class="4175687380086503813" onmouseenter="enter('4175687380086503813');" onmouseout="out('4175687380086503813');" style="">  83     private Map&lt;String, Table&gt; localTableCache = Maps.newHashMap();                                      </span>
<span  style="">  84                                                                                                          </span>
<span class="5235405798143461797" onmouseenter="enter('5235405798143461797');" onmouseout="out('5235405798143461797');" style="">  85     public void exec(String sql,                                                                         </span>
<span class="-876340320175790120" onmouseenter="enter('-876340320175790120');" onmouseout="out('-876340320175790120');" style="">  86                      Map&lt;String, AbstractSideTableInfo&gt; sideTableMap,                                    </span>
<span class="4244108408582304218" onmouseenter="enter('4244108408582304218');" onmouseout="out('4244108408582304218');" style="">  87                      StreamTableEnvironment tableEnv,                                                    </span>
<span class="-1493383746124052329" onmouseenter="enter('-1493383746124052329');" onmouseout="out('-1493383746124052329');" style="">  88                      Map&lt;String, Table&gt; tableCache,                                                      </span>
<span class="-7862911349817835208" onmouseenter="enter('-7862911349817835208');" onmouseout="out('-7862911349817835208');" style="">  89                      CreateTmpTableParser.SqlParserResult createView,                                    </span>
<span class="2986641263782067303" onmouseenter="enter('2986641263782067303');" onmouseout="out('2986641263782067303');" style="">  90                      String scope) throws Exception {                                                    </span>
<span class="-6307578536739293325" onmouseenter="enter('-6307578536739293325');" onmouseout="out('-6307578536739293325');" style="">  91         localTableCache.putAll(tableCache);                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  92         try {                                                                                            </span>
<span class="-7778408363768085476" onmouseenter="enter('-7778408363768085476');" onmouseout="out('-7778408363768085476');" style="">  93             sidePredicatesParser.fillPredicatesForSideTable(sql, sideTableMap);                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="">  94         } catch (Exception e) {                                                                          </span>
<span class="-6535415982741029210" onmouseenter="enter('-6535415982741029210');" onmouseout="out('-6535415982741029210');" style="">  95             LOG.error(&quot;fill predicates for sideTable fail &quot;, e);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96         }                                                                                                </span>
<span  style="">  97                                                                                                          </span>
<span class="5869130575145188486" onmouseenter="enter('5869130575145188486');" onmouseout="out('5869130575145188486');" style="">  98         if(createView != null){                                                                          </span>
<span class="-5051922790285322929" onmouseenter="enter('-5051922790285322929');" onmouseout="out('-5051922790285322929');" style="">  99             LOG.warn(&quot;create view info\n&quot;);                                                              </span>
<span class="4994977519661454238" onmouseenter="enter('4994977519661454238');" onmouseout="out('4994977519661454238');" style=""> 100             LOG.warn(createView.getExecSql());                                                           </span>
<span class="-6048507734051622776" onmouseenter="enter('-6048507734051622776');" onmouseout="out('-6048507734051622776');" style=""> 101             LOG.warn(&quot;-----------------&quot;);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102         }                                                                                                </span>
<span  style=""> 103                                                                                                          </span>
<span class="3272289589011229925" onmouseenter="enter('3272289589011229925');" onmouseout="out('3272289589011229925');" style=""> 104         SideSQLParser sideSQLParser = new SideSQLParser();                                               </span>
<span class="9221221341975786732" onmouseenter="enter('9221221341975786732');" onmouseout="out('9221221341975786732');" style=""> 105         sideSQLParser.setLocalTableCache(localTableCache);                                               </span>
<span class="6016193463712965966" onmouseenter="enter('6016193463712965966');" onmouseout="out('6016193463712965966');" style=""> 106         Queue&lt;Object&gt; exeQueue = sideSQLParser.getExeQueue(sql, sideTableMap.keySet(), scope);           </span>
<span class="1917635497637273504" onmouseenter="enter('1917635497637273504');" onmouseout="out('1917635497637273504');" style=""> 107         Object pollObj = null;                                                                           </span>
<span  style=""> 108                                                                                                          </span>
<span class="6128441282435403378" onmouseenter="enter('6128441282435403378');" onmouseout="out('6128441282435403378');" style=""> 109         while((pollObj = exeQueue.poll()) != null){                                                      </span>
<span  style=""> 110                                                                                                          </span>
<span class="138624831707193108" onmouseenter="enter('138624831707193108');" onmouseout="out('138624831707193108');" style=""> 111             if(pollObj instanceof SqlNode){                                                              </span>
<span class="-8817010307772649906" onmouseenter="enter('-8817010307772649906');" onmouseout="out('-8817010307772649906');" style=""> 112                 SqlNode pollSqlNode = (SqlNode) pollObj;                                                 </span>
<span  style=""> 113                                                                                                          </span>
<span  style=""> 114                                                                                                          </span>
<span class="-2885719311179922220" onmouseenter="enter('-2885719311179922220');" onmouseout="out('-2885719311179922220');" style=""> 115                 if(pollSqlNode.getKind() == INSERT){                                                     </span>
<span class="4666335002906799727" onmouseenter="enter('4666335002906799727');" onmouseout="out('4666335002906799727');" style=""> 116                     FlinkSQLExec.sqlUpdate(tableEnv, pollSqlNode.toString());                            </span>
<span class="3766255850891299565" onmouseenter="enter('3766255850891299565');" onmouseout="out('3766255850891299565');" style=""> 117                     if(LOG.isInfoEnabled()){                                                             </span>
<span class="-5986232783970891998" onmouseenter="enter('-5986232783970891998');" onmouseout="out('-5986232783970891998');" style=""> 118                         LOG.info(&quot;----------real exec sql-----------\n{}&quot;, pollSqlNode.toString());      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119                     }                                                                                    </span>
<span  style=""> 120                                                                                                          </span>
<span class="4666687505712980858" onmouseenter="enter('4666687505712980858');" onmouseout="out('4666687505712980858');" style=""> 121                 }else if(pollSqlNode.getKind() == AS){                                                   </span>
<span class="3037765200739894050" onmouseenter="enter('3037765200739894050');" onmouseout="out('3037765200739894050');" style=""> 122                     dealAsSourceTable(tableEnv, pollSqlNode, tableCache);                                </span>
<span  style=""> 123                                                                                                          </span>
<span class="4581342471671871622" onmouseenter="enter('4581342471671871622');" onmouseout="out('4581342471671871622');" style=""> 124                 } else if (pollSqlNode.getKind() == WITH_ITEM) {                                         </span>
<span class="9089825500288046356" onmouseenter="enter('9089825500288046356');" onmouseout="out('9089825500288046356');" style=""> 125                     SqlWithItem sqlWithItem = (SqlWithItem) pollSqlNode;                                 </span>
<span class="-7674640876687845363" onmouseenter="enter('-7674640876687845363');" onmouseout="out('-7674640876687845363');" style=""> 126                     String TableAlias = sqlWithItem.name.toString();                                     </span>
<span class="2573668668184904794" onmouseenter="enter('2573668668184904794');" onmouseout="out('2573668668184904794');" style=""> 127                     Table table = tableEnv.sqlQuery(sqlWithItem.query.toString());                       </span>
<span class="2341577843786962651" onmouseenter="enter('2341577843786962651');" onmouseout="out('2341577843786962651');" style=""> 128                     tableEnv.registerTable(TableAlias, table);                                           </span>
<span  style=""> 129                                                                                                          </span>
<span class="-8892059869421071039" onmouseenter="enter('-8892059869421071039');" onmouseout="out('-8892059869421071039');" style=""> 130                 } else if (pollSqlNode.getKind() == SELECT){                                             </span>
<span class="-1344441018307209750" onmouseenter="enter('-1344441018307209750');" onmouseout="out('-1344441018307209750');" style=""><abbr title=" 131                     Preconditions.checkState(createView != null, &quot;select sql must included by create view&quot;);"> 131                     Preconditions.checkState(createView != null, &quot;select sql must included by create view🔵</abbr></span>
<span class="1694293925390283740" onmouseenter="enter('1694293925390283740');" onmouseout="out('1694293925390283740');" style=""> 132                     Table table = tableEnv.sqlQuery(pollObj.toString());                                 </span>
<span  style=""> 133                                                                                                          </span>
<span class="-5832165917407529739" onmouseenter="enter('-5832165917407529739');" onmouseout="out('-5832165917407529739');" style=""> 134                     if (createView.getFieldsInfoStr() == null){                                          </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 135                         tableEnv.registerTable(createView.getTableName(), table);                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 136                     } else {                                                                             </span>
<span class="5288384657559945705" onmouseenter="enter('5288384657559945705');" onmouseout="out('5288384657559945705');" style=""> 137                         if (checkFieldsInfo(createView, table)){                                         </span>
<span class="-9109211084540213069" onmouseenter="enter('-9109211084540213069');" onmouseout="out('-9109211084540213069');" style=""> 138                             table = table.as(tmpFields);                                                 </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 139                             tableEnv.registerTable(createView.getTableName(), table);                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 140                         } else {                                                                         </span>
<span class="-4180003952862210397" onmouseenter="enter('-4180003952862210397');" onmouseout="out('-4180003952862210397');" style=""> 141                             throw new RuntimeException(&quot;Fields mismatch&quot;);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143                     }                                                                                    </span>
<span  style=""> 144                                                                                                          </span>
<span class="-5831701022468144749" onmouseenter="enter('-5831701022468144749');" onmouseout="out('-5831701022468144749');" style=""> 145                     localTableCache.put(createView.getTableName(), table);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146                 }                                                                                        </span>
<span  style=""> 147                                                                                                          </span>
<span class="2267959141426380188" onmouseenter="enter('2267959141426380188');" onmouseout="out('2267959141426380188');" style=""> 148             }else if (pollObj instanceof JoinInfo){                                                      </span>
<span class="-6196622619540139248" onmouseenter="enter('-6196622619540139248');" onmouseout="out('-6196622619540139248');" style=""> 149                 LOG.info(&quot;----------exec join info----------\n{}&quot;, pollObj.toString());                  </span>
<span class="-3518617829078174884" onmouseenter="enter('-3518617829078174884');" onmouseout="out('-3518617829078174884');" style=""> 150                 joinFun(pollObj, localTableCache, sideTableMap, tableEnv);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152         }                                                                                                </span>
<span  style=""> 153                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154     }                                                                                                    </span>
<span  style=""> 155                                                                                                          </span>
<span  style=""> 156                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 157     /**                                                                                                  </span>
<span class="-7226459799151937672" onmouseenter="enter('-7226459799151937672');" onmouseout="out('-7226459799151937672');" style=""> 158      * 解析出as查询的表和字段的关系                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 159      *                                                                                                   </span>
<span class="-4711911052088894915" onmouseenter="enter('-4711911052088894915');" onmouseout="out('-4711911052088894915');" style=""> 160      * @param asSqlNode                                                                                  </span>
<span class="-8172984871762282794" onmouseenter="enter('-8172984871762282794');" onmouseout="out('-8172984871762282794');" style=""> 161      * @param tableCache                                                                                 </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 162      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 163      */                                                                                                  </span>
<span class="-8315666616430025383" onmouseenter="enter('-8315666616430025383');" onmouseout="out('-8315666616430025383');" style=""> 164     private FieldReplaceInfo parseAsQuery(SqlBasicCall asSqlNode, Map&lt;String, Table&gt; tableCache){        </span>
<span class="-4950849472737015743" onmouseenter="enter('-4950849472737015743');" onmouseout="out('-4950849472737015743');" style=""> 165         SqlNode info = asSqlNode.getOperands()[0];                                                       </span>
<span class="-6049998703041327008" onmouseenter="enter('-6049998703041327008');" onmouseout="out('-6049998703041327008');" style=""> 166         SqlNode alias = asSqlNode.getOperands()[1];                                                      </span>
<span  style=""> 167                                                                                                          </span>
<span class="6169254144825097648" onmouseenter="enter('6169254144825097648');" onmouseout="out('6169254144825097648');" style=""> 168         SqlKind infoKind = info.getKind();                                                               </span>
<span class="-8998816044463313680" onmouseenter="enter('-8998816044463313680');" onmouseout="out('-8998816044463313680');" style=""> 169         if(infoKind != SELECT){                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 170             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171         }                                                                                                </span>
<span  style=""> 172                                                                                                          </span>
<span class="1448651332248375248" onmouseenter="enter('1448651332248375248');" onmouseout="out('1448651332248375248');" style=""> 173         List&lt;FieldInfo&gt; extractFieldList = TableUtils.parserSelectField((SqlSelect) info, tableCache);   </span>
<span  style=""> 174                                                                                                          </span>
<span class="-3840015462696951757" onmouseenter="enter('-3840015462696951757');" onmouseout="out('-3840015462696951757');" style=""> 175         HashBasedTable&lt;String, String, String&gt; mappingTable = HashBasedTable.create();                   </span>
<span class="-5476396715494077219" onmouseenter="enter('-5476396715494077219');" onmouseout="out('-5476396715494077219');" style=""> 176         for (FieldInfo fieldInfo : extractFieldList) {                                                   </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 177             String tableName = fieldInfo.getTable();                                                     </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 178             String fieldName = fieldInfo.getFieldName();                                                 </span>
<span class="4185539436596522295" onmouseenter="enter('4185539436596522295');" onmouseout="out('4185539436596522295');" style=""> 179             String mappingFieldName = ParseUtils.dealDuplicateFieldName(mappingTable, fieldName);        </span>
<span class="-7827879044056282695" onmouseenter="enter('-7827879044056282695');" onmouseout="out('-7827879044056282695');" style=""> 180             mappingTable.put(tableName, fieldName, mappingFieldName);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181         }                                                                                                </span>
<span  style=""> 182                                                                                                          </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 183         FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                           </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 184         replaceInfo.setMappingTable(mappingTable);                                                       </span>
<span class="9115675088981905484" onmouseenter="enter('9115675088981905484');" onmouseout="out('9115675088981905484');" style=""> 185         replaceInfo.setTargetTableName(alias.toString());                                                </span>
<span class="-6295883374697236710" onmouseenter="enter('-6295883374697236710');" onmouseout="out('-6295883374697236710');" style=""> 186         replaceInfo.setTargetTableAlias(alias.toString());                                               </span>
<span class="2754859294214862032" onmouseenter="enter('2754859294214862032');" onmouseout="out('2754859294214862032');" style=""> 187         return replaceInfo;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188     }                                                                                                    </span>
<span  style=""> 189                                                                                                          </span>
<span  style=""> 190                                                                                                          </span>
<span class="73834954090191073" onmouseenter="enter('73834954090191073');" onmouseout="out('73834954090191073');" style=""> 191     public AliasInfo parseASNode(SqlNode sqlNode) throws SqlParseException {                             </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 192         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="3363188275491767702" onmouseenter="enter('3363188275491767702');" onmouseout="out('3363188275491767702');" style=""> 193         if(sqlKind != AS){                                                                               </span>
<span class="1088430228081547460" onmouseenter="enter('1088430228081547460');" onmouseout="out('1088430228081547460');" style=""> 194             throw new RuntimeException(sqlNode + &quot; is not &#x27;as&#x27; operator&quot;);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195         }                                                                                                </span>
<span  style=""> 196                                                                                                          </span>
<span class="-4085054753182131209" onmouseenter="enter('-4085054753182131209');" onmouseout="out('-4085054753182131209');" style=""> 197         SqlNode info = ((SqlBasicCall)sqlNode).getOperands()[0];                                         </span>
<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style=""> 198         SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                                       </span>
<span  style=""> 199                                                                                                          </span>
<span class="-2458625767668584085" onmouseenter="enter('-2458625767668584085');" onmouseout="out('-2458625767668584085');" style=""> 200         AliasInfo aliasInfo = new AliasInfo();                                                           </span>
<span class="-5109084571101185803" onmouseenter="enter('-5109084571101185803');" onmouseout="out('-5109084571101185803');" style=""> 201         aliasInfo.setName(info.toString());                                                              </span>
<span class="-6584143955119724642" onmouseenter="enter('-6584143955119724642');" onmouseout="out('-6584143955119724642');" style=""> 202         aliasInfo.setAlias(alias.toString());                                                            </span>
<span  style=""> 203                                                                                                          </span>
<span class="-3107000398971930583" onmouseenter="enter('-3107000398971930583');" onmouseout="out('-3107000398971930583');" style=""> 204         return aliasInfo;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 205     }                                                                                                    </span>
<span  style=""> 206                                                                                                          </span>
<span class="6012642327394790947" onmouseenter="enter('6012642327394790947');" onmouseout="out('6012642327394790947');" style=""> 207     public BaseRowTypeInfo buildOutRowTypeInfo(List&lt;FieldInfo&gt; sideJoinFieldInfo,                        </span>
<span class="244517366126553103" onmouseenter="enter('244517366126553103');" onmouseout="out('244517366126553103');" style=""> 208                                            HashBasedTable&lt;String, String, String&gt; mappingTable) {        </span>
<span class="-9126530720291690226" onmouseenter="enter('-9126530720291690226');" onmouseout="out('-9126530720291690226');" style=""> 209         // TypeInformation[] sideOutTypes = new TypeInformation[sideJoinFieldInfo.size()];               </span>
<span class="2784978011557375723" onmouseenter="enter('2784978011557375723');" onmouseout="out('2784978011557375723');" style=""> 210         LogicalType[] sideOutTypes = new LogicalType[sideJoinFieldInfo.size()];                          </span>
<span class="-637166731779412769" onmouseenter="enter('-637166731779412769');" onmouseout="out('-637166731779412769');" style=""> 211         String[] sideOutNames = new String[sideJoinFieldInfo.size()];                                    </span>
<span class="7438730024850909889" onmouseenter="enter('7438730024850909889');" onmouseout="out('7438730024850909889');" style=""> 212         for (int i = 0; i &lt; sideJoinFieldInfo.size(); i++) {                                             </span>
<span class="2207877773063469724" onmouseenter="enter('2207877773063469724');" onmouseout="out('2207877773063469724');" style=""> 213             FieldInfo fieldInfo = sideJoinFieldInfo.get(i);                                              </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 214             String tableName = fieldInfo.getTable();                                                     </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 215             String fieldName = fieldInfo.getFieldName();                                                 </span>
<span  style=""> 216                                                                                                          </span>
<span class="3640983111807923268" onmouseenter="enter('3640983111807923268');" onmouseout="out('3640983111807923268');" style=""> 217             String mappingFieldName = mappingTable.get(tableName, fieldName);                            </span>
<span class="-4165873345254348507" onmouseenter="enter('-4165873345254348507');" onmouseout="out('-4165873345254348507');" style=""><abbr title=" 218             Preconditions.checkNotNull(mappingFieldName, fieldInfo + &quot; not mapping any field! it may be frame bug&quot;);"> 218             Preconditions.checkNotNull(mappingFieldName, fieldInfo + &quot; not mapping any field! it may be f🔵</abbr></span>
<span  style=""> 219                                                                                                          </span>
<span class="-4639076863607040957" onmouseenter="enter('-4639076863607040957');" onmouseout="out('-4639076863607040957');" style=""> 220             sideOutTypes[i] = fieldInfo.getLogicalType();                                                </span>
<span class="6276485717663783154" onmouseenter="enter('6276485717663783154');" onmouseout="out('6276485717663783154');" style=""> 221             sideOutNames[i] = mappingFieldName;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222         }                                                                                                </span>
<span class="-8180554737552837485" onmouseenter="enter('-8180554737552837485');" onmouseout="out('-8180554737552837485');" style=""> 223         return new BaseRowTypeInfo(sideOutTypes, sideOutNames);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224     }                                                                                                    </span>
<span  style=""> 225                                                                                                          </span>
<span  style=""> 226                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 227     /**                                                                                                  </span>
<span class="-7122456494290950261" onmouseenter="enter('-7122456494290950261');" onmouseout="out('-7122456494290950261');" style=""> 228      * 对时间类型进行类型转换                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 229      *                                                                                                   </span>
<span class="-7981851073621455488" onmouseenter="enter('-7981851073621455488');" onmouseout="out('-7981851073621455488');" style=""> 230      * @param leftTypeInfo                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 231      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 232      */                                                                                                  </span>
<span class="109255438874014135" onmouseenter="enter('109255438874014135');" onmouseout="out('109255438874014135');" style=""> 233     private RowTypeInfo buildLeftTableOutType(RowTypeInfo leftTypeInfo) {                                </span>
<span class="5269317691380571116" onmouseenter="enter('5269317691380571116');" onmouseout="out('5269317691380571116');" style=""> 234         TypeInformation[] sideOutTypes = new TypeInformation[leftTypeInfo.getFieldNames().length];       </span>
<span class="357447233987634249" onmouseenter="enter('357447233987634249');" onmouseout="out('357447233987634249');" style=""> 235         TypeInformation&lt;?&gt;[] fieldTypes = leftTypeInfo.getFieldTypes();                                  </span>
<span class="-7313385440196867180" onmouseenter="enter('-7313385440196867180');" onmouseout="out('-7313385440196867180');" style=""> 236         for (int i = 0; i &lt; sideOutTypes.length; i++) {                                                  </span>
<span class="-314833607359598646" onmouseenter="enter('-314833607359598646');" onmouseout="out('-314833607359598646');" style=""> 237             sideOutTypes[i] = convertTimeAttributeType(fieldTypes[i]);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238         }                                                                                                </span>
<span class="-6446480870466684625" onmouseenter="enter('-6446480870466684625');" onmouseout="out('-6446480870466684625');" style=""> 239         RowTypeInfo rowTypeInfo = new RowTypeInfo(sideOutTypes, leftTypeInfo.getFieldNames());           </span>
<span class="6189116692514123920" onmouseenter="enter('6189116692514123920');" onmouseout="out('6189116692514123920');" style=""> 240         return rowTypeInfo;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241     }                                                                                                    </span>
<span  style=""> 242                                                                                                          </span>
<span class="2471506251995792847" onmouseenter="enter('2471506251995792847');" onmouseout="out('2471506251995792847');" style=""> 243     private TypeInformation convertTimeAttributeType(TypeInformation typeInformation) {                  </span>
<span class="2997926285576198837" onmouseenter="enter('2997926285576198837');" onmouseout="out('2997926285576198837');" style=""> 244         if (typeInformation instanceof TimeIndicatorTypeInfo) {                                          </span>
<span class="-4699013589387269243" onmouseenter="enter('-4699013589387269243');" onmouseout="out('-4699013589387269243');" style=""> 245             return TypeInformation.of(LocalDateTime.class);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246         }                                                                                                </span>
<span class="6871348106862514693" onmouseenter="enter('6871348106862514693');" onmouseout="out('6871348106862514693');" style=""> 247         return typeInformation;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248     }                                                                                                    </span>
<span  style=""> 249                                                                                                          </span>
<span class="-6722855011181273565" onmouseenter="enter('-6722855011181273565');" onmouseout="out('-6722855011181273565');" style=""> 250     public void setLocalSqlPluginPath(String localSqlPluginPath) {                                       </span>
<span class="6258662942576926140" onmouseenter="enter('6258662942576926140');" onmouseout="out('6258662942576926140');" style=""> 251         this.localSqlPluginPath = localSqlPluginPath;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252     }                                                                                                    </span>
<span  style=""> 253                                                                                                          </span>
<span class="6639781197811189198" onmouseenter="enter('6639781197811189198');" onmouseout="out('6639781197811189198');" style=""> 254     public void setPluginLoadMode(String pluginLoadMode) {                                               </span>
<span class="1051014760706894364" onmouseenter="enter('1051014760706894364');" onmouseout="out('1051014760706894364');" style=""> 255         this.pluginLoadMode = pluginLoadMode;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 256     }                                                                                                    </span>
<span  style=""> 257                                                                                                          </span>
<span class="2277905399441322839" onmouseenter="enter('2277905399441322839');" onmouseout="out('2277905399441322839');" style=""><abbr title=" 258     private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableName){"> 258     private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableNa🔵</abbr></span>
<span class="-6301156236825066460" onmouseenter="enter('-6301156236825066460');" onmouseout="out('-6301156236825066460');" style=""> 259         Table table = localTableCache.get(tableAlias);                                                   </span>
<span class="2042916935617835771" onmouseenter="enter('2042916935617835771');" onmouseout="out('2042916935617835771');" style=""> 260         if(table == null){                                                                               </span>
<span class="-5960895848666330323" onmouseenter="enter('-5960895848666330323');" onmouseout="out('-5960895848666330323');" style=""> 261             table = localTableCache.get(tableName);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262         }                                                                                                </span>
<span  style=""> 263                                                                                                          </span>
<span class="2042916935617835771" onmouseenter="enter('2042916935617835771');" onmouseout="out('2042916935617835771');" style=""> 264         if(table == null){                                                                               </span>
<span class="4627225224916806199" onmouseenter="enter('4627225224916806199');" onmouseout="out('4627225224916806199');" style=""> 265             throw new RuntimeException(&quot;not register table &quot; + tableAlias);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266         }                                                                                                </span>
<span  style=""> 267                                                                                                          </span>
<span class="-6017334383208509278" onmouseenter="enter('-6017334383208509278');" onmouseout="out('-6017334383208509278');" style=""> 268         return table;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269     }                                                                                                    </span>
<span  style=""> 270                                                                                                          </span>
<span  style=""> 271                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 272     /**                                                                                                  </span>
<span class="5196638318686351881" onmouseenter="enter('5196638318686351881');" onmouseout="out('5196638318686351881');" style=""><abbr title=" 273      * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., dimension table is the primary key definition"> 273      * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., d🔵</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 274      *                                                                                                   </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 275      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 276      */                                                                                                  </span>
<span class="4488554625343324946" onmouseenter="enter('4488554625343324946');" onmouseout="out('4488554625343324946');" style=""><abbr title=" 277     private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInfo sideTableInfo) {"> 277     private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInf🔵</abbr></span>
<span class="-6710736308674703771" onmouseenter="enter('-6710736308674703771');" onmouseout="out('-6710736308674703771');" style=""> 278         List&lt;String&gt; conditionFields = getConditionFields(conditionNode, sideTableAlias, sideTableInfo); </span>
<span class="-3924194481322428470" onmouseenter="enter('-3924194481322428470');" onmouseout="out('-3924194481322428470');" style=""> 279         if(CollectionUtils.isEqualCollection(conditionFields, convertPrimaryAlias(sideTableInfo))){      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 280             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 282         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283     }                                                                                                    </span>
<span  style=""> 284                                                                                                          </span>
<span class="572998504046101497" onmouseenter="enter('572998504046101497');" onmouseout="out('572998504046101497');" style=""> 285     private List&lt;String&gt; convertPrimaryAlias(AbstractSideTableInfo sideTableInfo) {                      </span>
<span class="-6700733268022775520" onmouseenter="enter('-6700733268022775520');" onmouseout="out('-6700733268022775520');" style=""> 286         List&lt;String&gt; res = Lists.newArrayList();                                                         </span>
<span class="-1517278133900331130" onmouseenter="enter('-1517278133900331130');" onmouseout="out('-1517278133900331130');" style=""> 287         sideTableInfo.getPrimaryKeys().forEach(field -&gt; {                                                </span>
<span class="2991641550935988694" onmouseenter="enter('2991641550935988694');" onmouseout="out('2991641550935988694');" style=""> 288             res.add(sideTableInfo.getPhysicalFields().getOrDefault(field, field));                       </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 289         });                                                                                              </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 290         return res;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291     }                                                                                                    </span>
<span  style=""> 292                                                                                                          </span>
<span class="-958139939083183834" onmouseenter="enter('-958139939083183834');" onmouseout="out('-958139939083183834');" style=""><abbr title=" 293     public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTableInfo sideTableInfo){"> 293     public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTa🔵</abbr></span>
<span class="-5667062641477778387" onmouseenter="enter('-5667062641477778387');" onmouseout="out('-5667062641477778387');" style=""> 294         List&lt;SqlNode&gt; sqlNodeList = Lists.newArrayList();                                                </span>
<span class="5003747983397221043" onmouseenter="enter('5003747983397221043');" onmouseout="out('5003747983397221043');" style=""> 295         ParseUtils.parseAnd(conditionNode, sqlNodeList);                                                 </span>
<span class="331902561671078290" onmouseenter="enter('331902561671078290');" onmouseout="out('331902561671078290');" style=""> 296         List&lt;String&gt; conditionFields = Lists.newArrayList();                                             </span>
<span class="-2336842894952786561" onmouseenter="enter('-2336842894952786561');" onmouseout="out('-2336842894952786561');" style=""> 297         for(SqlNode sqlNode : sqlNodeList){                                                              </span>
<span class="-1235221313035004193" onmouseenter="enter('-1235221313035004193');" onmouseout="out('-1235221313035004193');" style=""> 298             if (!SqlKind.COMPARISON.contains(sqlNode.getKind())) {                                       </span>
<span class="4238811186041433324" onmouseenter="enter('4238811186041433324');" onmouseout="out('4238811186041433324');" style=""> 299                 throw new RuntimeException(&quot;not compare operator.&quot;);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300             }                                                                                            </span>
<span  style=""> 301                                                                                                          </span>
<span class="-7359051973666627295" onmouseenter="enter('-7359051973666627295');" onmouseout="out('-7359051973666627295');" style=""> 302             SqlIdentifier left = (SqlIdentifier)((SqlBasicCall)sqlNode).getOperands()[0];                </span>
<span class="3465298874779506196" onmouseenter="enter('3465298874779506196');" onmouseout="out('3465298874779506196');" style=""> 303             SqlIdentifier right = (SqlIdentifier)((SqlBasicCall)sqlNode).getOperands()[1];               </span>
<span  style=""> 304                                                                                                          </span>
<span class="-2670749344655178863" onmouseenter="enter('-2670749344655178863');" onmouseout="out('-2670749344655178863');" style=""> 305             String leftTableName = left.getComponent(0).getSimple();                                     </span>
<span class="5188110590184041827" onmouseenter="enter('5188110590184041827');" onmouseout="out('5188110590184041827');" style=""> 306             String rightTableName = right.getComponent(0).getSimple();                                   </span>
<span  style=""> 307                                                                                                          </span>
<span class="8082853509369418918" onmouseenter="enter('8082853509369418918');" onmouseout="out('8082853509369418918');" style=""> 308             String tableCol = &quot;&quot;;                                                                        </span>
<span class="3869855333927982135" onmouseenter="enter('3869855333927982135');" onmouseout="out('3869855333927982135');" style=""> 309             if(leftTableName.equalsIgnoreCase(specifyTableName)){                                        </span>
<span class="4527748628163402760" onmouseenter="enter('4527748628163402760');" onmouseout="out('4527748628163402760');" style=""> 310                 tableCol = left.getComponent(1).getSimple();                                             </span>
<span class="5068195286258055415" onmouseenter="enter('5068195286258055415');" onmouseout="out('5068195286258055415');" style=""> 311             }else if(rightTableName.equalsIgnoreCase(specifyTableName)){                                 </span>
<span class="4462633703217831544" onmouseenter="enter('4462633703217831544');" onmouseout="out('4462633703217831544');" style=""> 312                 tableCol = right.getComponent(1).getSimple();                                            </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 313             }else{                                                                                       </span>
<span class="3783543445731730404" onmouseenter="enter('3783543445731730404');" onmouseout="out('3783543445731730404');" style=""><abbr title=" 314                 throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specifyTableName));"> 314                 throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specify🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315             }                                                                                            </span>
<span class="-2325401555704525047" onmouseenter="enter('-2325401555704525047');" onmouseout="out('-2325401555704525047');" style=""> 316             tableCol = sideTableInfo.getPhysicalFields().getOrDefault(tableCol, tableCol);               </span>
<span class="-4552234441929070616" onmouseenter="enter('-4552234441929070616');" onmouseout="out('-4552234441929070616');" style=""> 317             conditionFields.add(tableCol);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318         }                                                                                                </span>
<span  style=""> 319                                                                                                          </span>
<span class="4950082808497882460" onmouseenter="enter('4950082808497882460');" onmouseout="out('4950082808497882460');" style=""> 320         return conditionFields;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321     }                                                                                                    </span>
<span  style=""> 322                                                                                                          </span>
<span class="-8173208587282838964" onmouseenter="enter('-8173208587282838964');" onmouseout="out('-8173208587282838964');" style=""> 323     protected void dealAsSourceTable(StreamTableEnvironment tableEnv,                                    </span>
<span class="9126592535894268017" onmouseenter="enter('9126592535894268017');" onmouseout="out('9126592535894268017');" style=""> 324                                      SqlNode pollSqlNode,                                                </span>
<span class="-4636178628928660306" onmouseenter="enter('-4636178628928660306');" onmouseout="out('-4636178628928660306');" style=""> 325                                      Map&lt;String, Table&gt; tableCache) throws SqlParseException {           </span>
<span  style=""> 326                                                                                                          </span>
<span class="-7364020242551640527" onmouseenter="enter('-7364020242551640527');" onmouseout="out('-7364020242551640527');" style=""> 327         AliasInfo aliasInfo = parseASNode(pollSqlNode);                                                  </span>
<span class="2461088292100865778" onmouseenter="enter('2461088292100865778');" onmouseout="out('2461088292100865778');" style=""> 328         if (localTableCache.containsKey(aliasInfo.getName())) {                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 329             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330         }                                                                                                </span>
<span  style=""> 331                                                                                                          </span>
<span class="-3390660419579622283" onmouseenter="enter('-3390660419579622283');" onmouseout="out('-3390660419579622283');" style=""> 332         Table table = tableEnv.sqlQuery(aliasInfo.getName());                                            </span>
<span class="5901087968051131557" onmouseenter="enter('5901087968051131557');" onmouseout="out('5901087968051131557');" style=""> 333         tableEnv.registerTable(aliasInfo.getAlias(), table);                                             </span>
<span class="1100939894023116874" onmouseenter="enter('1100939894023116874');" onmouseout="out('1100939894023116874');" style=""> 334         localTableCache.put(aliasInfo.getAlias(), table);                                                </span>
<span  style=""> 335                                                                                                          </span>
<span class="7353361537117728269" onmouseenter="enter('7353361537117728269');" onmouseout="out('7353361537117728269');" style=""> 336         LOG.info(&quot;Register Table {} by {}&quot;, aliasInfo.getAlias(), aliasInfo.getName());                  </span>
<span  style=""> 337                                                                                                          </span>
<span class="-8665165690117838262" onmouseenter="enter('-8665165690117838262');" onmouseout="out('-8665165690117838262');" style=""> 338         FieldReplaceInfo fieldReplaceInfo = parseAsQuery((SqlBasicCall) pollSqlNode, tableCache);        </span>
<span class="-7633956211129533821" onmouseenter="enter('-7633956211129533821');" onmouseout="out('-7633956211129533821');" style=""> 339         if(fieldReplaceInfo == null){                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 340            return;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 341         }                                                                                                </span>
<span  style=""> 342                                                                                                          </span>
<span class="-6438671410831308886" onmouseenter="enter('-6438671410831308886');" onmouseout="out('-6438671410831308886');" style=""> 343         //as 的源表                                                                                         </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 344         Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                </span>
<span class="-1390965398492412473" onmouseenter="enter('-1390965398492412473');" onmouseout="out('-1390965398492412473');" style=""> 345         SqlNode fromNode = ((SqlBasicCall)pollSqlNode).getOperands()[0];                                 </span>
<span class="8218826531385538687" onmouseenter="enter('8218826531385538687');" onmouseout="out('8218826531385538687');" style=""> 346         TableUtils.getFromTableInfo(fromNode, fromTableNameSet);                                         </span>
<span  style=""> 347                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 348     }                                                                                                    </span>
<span  style=""> 349                                                                                                          </span>
<span class="-894097875121841059" onmouseenter="enter('-894097875121841059');" onmouseout="out('-894097875121841059');" style=""> 350     private void joinFun(Object pollObj,                                                                 </span>
<span class="6823594550750748067" onmouseenter="enter('6823594550750748067');" onmouseout="out('6823594550750748067');" style=""> 351                          Map&lt;String, Table&gt; localTableCache,                                             </span>
<span class="-876340320175790120" onmouseenter="enter('-876340320175790120');" onmouseout="out('-876340320175790120');" style=""> 352                          Map&lt;String, AbstractSideTableInfo&gt; sideTableMap,                                </span>
<span class="-1170693753985315194" onmouseenter="enter('-1170693753985315194');" onmouseout="out('-1170693753985315194');" style=""> 353                          StreamTableEnvironment tableEnv) throws Exception{                              </span>
<span class="-3106951960183426296" onmouseenter="enter('-3106951960183426296');" onmouseout="out('-3106951960183426296');" style=""> 354         JoinInfo joinInfo = (JoinInfo) pollObj;                                                          </span>
<span  style=""> 355                                                                                                          </span>
<span class="-4580559439294190862" onmouseenter="enter('-4580559439294190862');" onmouseout="out('-4580559439294190862');" style=""> 356         JoinScope joinScope = new JoinScope();                                                           </span>
<span class="-6383140859888654083" onmouseenter="enter('-6383140859888654083');" onmouseout="out('-6383140859888654083');" style=""> 357         JoinScope.ScopeChild leftScopeChild = new JoinScope.ScopeChild();                                </span>
<span class="-5401707331330951256" onmouseenter="enter('-5401707331330951256');" onmouseout="out('-5401707331330951256');" style=""> 358         leftScopeChild.setAlias(joinInfo.getLeftTableAlias());                                           </span>
<span class="5108424867732442426" onmouseenter="enter('5108424867732442426');" onmouseout="out('5108424867732442426');" style=""> 359         leftScopeChild.setTableName(joinInfo.getLeftTableName());                                        </span>
<span  style=""> 360                                                                                                          </span>
<span class="-2402361542513321069" onmouseenter="enter('-2402361542513321069');" onmouseout="out('-2402361542513321069');" style=""><abbr title=" 361         Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLeftTableName());"> 361         Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLe🔵</abbr></span>
<span  style=""> 362                                                                                                          </span>
<span class="-6003115091233455661" onmouseenter="enter('-6003115091233455661');" onmouseout="out('-6003115091233455661');" style=""><abbr title=" 363         RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getFieldTypes(), leftTable.getSchema().getFieldNames());"> 363         RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getFieldTypes(), leftTable.getSc🔵</abbr></span>
<span  style=""> 364                                                                                                          </span>
<span class="6844734750257063206" onmouseenter="enter('6844734750257063206');" onmouseout="out('6844734750257063206');" style=""> 365         int length = leftTable.getSchema().getFieldDataTypes().length;                                   </span>
<span class="-7291542410657351968" onmouseenter="enter('-7291542410657351968');" onmouseout="out('-7291542410657351968');" style=""> 366         LogicalType[] logicalTypes = new LogicalType[length];                                            </span>
<span class="-2303162855932529930" onmouseenter="enter('-2303162855932529930');" onmouseout="out('-2303162855932529930');" style=""> 367         for(int i=0; i&lt;length; i++){                                                                     </span>
<span class="1537154519277872520" onmouseenter="enter('1537154519277872520');" onmouseout="out('1537154519277872520');" style=""> 368             logicalTypes[i] = leftTable.getSchema().getFieldDataTypes()[i].getLogicalType();             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369         }                                                                                                </span>
<span  style=""> 370                                                                                                          </span>
<span class="6552727302564022327" onmouseenter="enter('6552727302564022327');" onmouseout="out('6552727302564022327');" style=""><abbr title=" 371         BaseRowTypeInfo leftBaseTypeInfo = new BaseRowTypeInfo(logicalTypes, leftTable.getSchema().getFieldNames());"> 371         BaseRowTypeInfo leftBaseTypeInfo = new BaseRowTypeInfo(logicalTypes, leftTable.getSchema().getFie🔵</abbr></span>
<span  style=""> 372                                                                                                          </span>
<span class="-5303860989220332569" onmouseenter="enter('-5303860989220332569');" onmouseout="out('-5303860989220332569');" style=""> 373         leftScopeChild.setRowTypeInfo(leftTypeInfo);                                                     </span>
<span class="-4838857475621068375" onmouseenter="enter('-4838857475621068375');" onmouseout="out('-4838857475621068375');" style=""> 374         leftScopeChild.setBaseRowTypeInfo(leftBaseTypeInfo);                                             </span>
<span  style=""> 375                                                                                                          </span>
<span class="3043795906382715340" onmouseenter="enter('3043795906382715340');" onmouseout="out('3043795906382715340');" style=""> 376         JoinScope.ScopeChild rightScopeChild = new JoinScope.ScopeChild();                               </span>
<span class="2585249270397691815" onmouseenter="enter('2585249270397691815');" onmouseout="out('2585249270397691815');" style=""> 377         rightScopeChild.setAlias(joinInfo.getRightTableAlias());                                         </span>
<span class="-5072747544386586876" onmouseenter="enter('-5072747544386586876');" onmouseout="out('-5072747544386586876');" style=""> 378         rightScopeChild.setTableName(joinInfo.getRightTableName());                                      </span>
<span class="-6382774479188932768" onmouseenter="enter('-6382774479188932768');" onmouseout="out('-6382774479188932768');" style=""> 379         AbstractSideTableInfo sideTableInfo = sideTableMap.get(joinInfo.getRightTableName());            </span>
<span class="-2759210686353099969" onmouseenter="enter('-2759210686353099969');" onmouseout="out('-2759210686353099969');" style=""> 380         if(sideTableInfo == null){                                                                       </span>
<span class="-5396801098824602905" onmouseenter="enter('-5396801098824602905');" onmouseout="out('-5396801098824602905');" style=""> 381             sideTableInfo = sideTableMap.get(joinInfo.getRightTableAlias());                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 382         }                                                                                                </span>
<span  style=""> 383                                                                                                          </span>
<span class="-2759210686353099969" onmouseenter="enter('-2759210686353099969');" onmouseout="out('-2759210686353099969');" style=""> 384         if(sideTableInfo == null){                                                                       </span>
<span class="450947362076537032" onmouseenter="enter('450947362076537032');" onmouseout="out('450947362076537032');" style=""> 385             throw new RuntimeException(&quot;can&#x27;t not find side table:&quot; + joinInfo.getRightTableName());     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 386         }                                                                                                </span>
<span  style=""> 387                                                                                                          </span>
<span class="-1562873445908102884" onmouseenter="enter('-1562873445908102884');" onmouseout="out('-1562873445908102884');" style=""> 388         rightScopeChild.setRowTypeInfo(sideTableInfo.getRowTypeInfo());                                  </span>
<span class="76578225160811915" onmouseenter="enter('76578225160811915');" onmouseout="out('76578225160811915');" style=""> 389         rightScopeChild.setBaseRowTypeInfo(sideTableInfo.getBaseRowTypeInfo());                          </span>
<span  style=""> 390                                                                                                          </span>
<span class="-5776192160472100987" onmouseenter="enter('-5776192160472100987');" onmouseout="out('-5776192160472100987');" style=""> 391         joinScope.addScope(leftScopeChild);                                                              </span>
<span class="6805588345897841594" onmouseenter="enter('6805588345897841594');" onmouseout="out('6805588345897841594');" style=""> 392         joinScope.addScope(rightScopeChild);                                                             </span>
<span  style=""> 393                                                                                                          </span>
<span class="2226908158928528195" onmouseenter="enter('2226908158928528195');" onmouseout="out('2226908158928528195');" style=""> 394         HashBasedTable&lt;String, String, String&gt; mappingTable = ((JoinInfo) pollObj).getTableFieldRef();   </span>
<span  style=""> 395                                                                                                          </span>
<span class="-816440763270240777" onmouseenter="enter('-816440763270240777');" onmouseout="out('-816440763270240777');" style=""> 396         //获取两个表的所有字段                                                                                     </span>
<span class="-6198283029075022684" onmouseenter="enter('-6198283029075022684');" onmouseout="out('-6198283029075022684');" style=""><abbr title=" 397         List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), joinScope, true);"> 397         List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), join🔵</abbr></span>
<span class="5016458903510526292" onmouseenter="enter('5016458903510526292');" onmouseout="out('5016458903510526292');" style=""> 398         //通过join的查询字段信息过滤出需要的字段信息                                                                        </span>
<span class="5211893312708517501" onmouseenter="enter('5211893312708517501');" onmouseout="out('5211893312708517501');" style=""><abbr title=" 399         sideJoinFieldInfo.removeIf(tmpFieldInfo -&gt; mappingTable.get(tmpFieldInfo.getTable(), tmpFieldInfo.getFieldName()) == null);"> 399         sideJoinFieldInfo.removeIf(tmpFieldInfo -&gt; mappingTable.get(tmpFieldInfo.getTable(), tmpFieldInfo🔵</abbr></span>
<span  style=""> 400                                                                                                          </span>
<span class="-1467815726997680818" onmouseenter="enter('-1467815726997680818');" onmouseout="out('-1467815726997680818');" style=""> 401         String leftTableAlias = joinInfo.getLeftTableAlias();                                            </span>
<span class="-6434853421912213287" onmouseenter="enter('-6434853421912213287');" onmouseout="out('-6434853421912213287');" style=""> 402         Table targetTable = localTableCache.get(leftTableAlias);                                         </span>
<span class="-6749372432358522016" onmouseenter="enter('-6749372432358522016');" onmouseout="out('-6749372432358522016');" style=""> 403         if(targetTable == null){                                                                         </span>
<span class="8734197217231436839" onmouseenter="enter('8734197217231436839');" onmouseout="out('8734197217231436839');" style=""> 404             targetTable = localTableCache.get(joinInfo.getLeftTableName());                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 405         }                                                                                                </span>
<span  style=""> 406                                                                                                          </span>
<span class="-1157067725052643612" onmouseenter="enter('-1157067725052643612');" onmouseout="out('-1157067725052643612');" style=""><abbr title=" 407         RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getFieldTypes(), targetTable.getSchema().getFieldNames());"> 407         RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getFieldTypes(), targetTable.getSc🔵</abbr></span>
<span  style=""> 408                                                                                                          </span>
<span class="8331408572102109154" onmouseenter="enter('8331408572102109154');" onmouseout="out('8331408572102109154');" style=""> 409         DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; adaptStream = tableEnv.toRetractStream(targetTable, Row.class); </span>
<span  style=""> 410                                                                                                          </span>
<span class="-6082173173678345991" onmouseenter="enter('-6082173173678345991');" onmouseout="out('-6082173173678345991');" style=""> 411         //join side table before keyby ===&gt; Reducing the size of each dimension table cache of async     </span>
<span class="6301552848628110191" onmouseenter="enter('6301552848628110191');" onmouseout="out('6301552848628110191');" style=""> 412         if (sideTableInfo.isPartitionedJoin()) {                                                         </span>
<span class="-4638861421651181765" onmouseenter="enter('-4638861421651181765');" onmouseout="out('-4638861421651181765');" style=""><abbr title=" 413             List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTableAlias(), sideTableInfo);"> 413             List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTa🔵</abbr></span>
<span class="-1086375650130423707" onmouseenter="enter('-1086375650130423707');" onmouseout="out('-1086375650130423707');" style=""> 414             List&lt;String&gt; fieldNames = Arrays.asList(targetTable.getSchema().getFieldNames());            </span>
<span class="2517152886952033206" onmouseenter="enter('2517152886952033206');" onmouseout="out('2517152886952033206');" style=""> 415             int[] keyIndex = leftJoinColList.stream().mapToInt(fieldNames::indexOf).toArray();           </span>
<span class="-1034511431639552497" onmouseenter="enter('-1034511431639552497');" onmouseout="out('-1034511431639552497');" style=""><abbr title=" 416             adaptStream = adaptStream.keyBy(new TupleKeySelector(keyIndex, projectedTypeInfo(keyIndex, targetTable.getSchema())));"> 416             adaptStream = adaptStream.keyBy(new TupleKeySelector(keyIndex, projectedTypeInfo(keyIndex, ta🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 417         }                                                                                                </span>
<span  style=""> 418                                                                                                          </span>
<span class="8900898589811243168" onmouseenter="enter('8900898589811243168');" onmouseout="out('8900898589811243168');" style=""> 419         DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; dsOut = null;                                                   </span>
<span class="3901580925108094660" onmouseenter="enter('3901580925108094660');" onmouseout="out('3901580925108094660');" style=""> 420         if(ECacheType.ALL.name().equalsIgnoreCase(sideTableInfo.getCacheType())){                        </span>
<span class="4800933198673881512" onmouseenter="enter('4800933198673881512');" onmouseout="out('4800933198673881512');" style=""><abbr title=" 421             dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo, pluginLoadMode);"> 421             dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), 🔵</abbr></span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 422         }else{                                                                                           </span>
<span class="7407295138386527483" onmouseenter="enter('7407295138386527483');" onmouseout="out('7407295138386527483');" style=""><abbr title=" 423             dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo, pluginLoadMode);"> 423             dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSq🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 424         }                                                                                                </span>
<span  style=""> 425                                                                                                          </span>
<span class="-7650178877830471821" onmouseenter="enter('-7650178877830471821');" onmouseout="out('-7650178877830471821');" style=""> 426         BaseRowTypeInfo sideOutTypeInfo = buildOutRowTypeInfo(sideJoinFieldInfo, mappingTable);          </span>
<span  style=""> 427                                                                                                          </span>
<span class="993314962060447081" onmouseenter="enter('993314962060447081');" onmouseout="out('993314962060447081');" style=""> 428         TupleTypeInfo tupleTypeInfo = new TupleTypeInfo(Types.BOOLEAN, sideOutTypeInfo);                 </span>
<span class="6600937869795732915" onmouseenter="enter('6600937869795732915');" onmouseout="out('6600937869795732915');" style=""> 429         dsOut.getTransformation().setOutputType(tupleTypeInfo);                                          </span>
<span  style=""> 430                                                                                                          </span>
<span class="4836712590888983064" onmouseenter="enter('4836712590888983064');" onmouseout="out('4836712590888983064');" style=""> 431         String targetTableName = joinInfo.getNewTableName();                                             </span>
<span class="-3094587764130774762" onmouseenter="enter('-3094587764130774762');" onmouseout="out('-3094587764130774762');" style=""> 432         String targetTableAlias = joinInfo.getNewTableAlias();                                           </span>
<span  style=""> 433                                                                                                          </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 434         FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                           </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 435         replaceInfo.setMappingTable(mappingTable);                                                       </span>
<span class="8710576405434192583" onmouseenter="enter('8710576405434192583');" onmouseout="out('8710576405434192583');" style=""> 436         replaceInfo.setTargetTableName(targetTableName);                                                 </span>
<span class="-6613112199475906839" onmouseenter="enter('-6613112199475906839');" onmouseout="out('-6613112199475906839');" style=""> 437         replaceInfo.setTargetTableAlias(targetTableAlias);                                               </span>
<span  style=""> 438                                                                                                          </span>
<span class="-7199180706663944207" onmouseenter="enter('-7199180706663944207');" onmouseout="out('-7199180706663944207');" style=""> 439         ObjectIdentifier objectIdentifier = ObjectIdentifier.of(                                         </span>
<span class="-8235548579753933527" onmouseenter="enter('-8235548579753933527');" onmouseout="out('-8235548579753933527');" style=""> 440                 EnvironmentSettings.DEFAULT_BUILTIN_CATALOG,                                             </span>
<span class="-4707782382614212141" onmouseenter="enter('-4707782382614212141');" onmouseout="out('-4707782382614212141');" style=""> 441                 EnvironmentSettings.DEFAULT_BUILTIN_DATABASE,                                            </span>
<span class="-5532274924697595213" onmouseenter="enter('-5532274924697595213');" onmouseout="out('-5532274924697595213');" style=""> 442                 targetTableName);                                                                        </span>
<span class="5891773481881515301" onmouseenter="enter('5891773481881515301');" onmouseout="out('5891773481881515301');" style=""><abbr title=" 443         boolean tableExists = tableEnv.getCatalog(EnvironmentSettings.DEFAULT_BUILTIN_CATALOG).get().tableExists(objectIdentifier.toObjectPath());"> 443         boolean tableExists = tableEnv.getCatalog(EnvironmentSettings.DEFAULT_BUILTIN_CATALOG).get().tabl🔵</abbr></span>
<span  style=""> 444                                                                                                          </span>
<span class="-3741652885152135341" onmouseenter="enter('-3741652885152135341');" onmouseout="out('-3741652885152135341');" style=""> 445         if (!tableExists){                                                                               </span>
<span class="-9057257427162955657" onmouseenter="enter('-9057257427162955657');" onmouseout="out('-9057257427162955657');" style=""> 446             Table joinTable = tableEnv.fromDataStream(dsOut);                                            </span>
<span class="7656863459817986298" onmouseenter="enter('7656863459817986298');" onmouseout="out('7656863459817986298');" style=""> 447             tableEnv.createTemporaryView(targetTableName, joinTable);                                    </span>
<span class="5569875846259576593" onmouseenter="enter('5569875846259576593');" onmouseout="out('5569875846259576593');" style=""> 448             localTableCache.put(joinInfo.getNewTableName(), joinTable);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 449         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 450     }                                                                                                    </span>
<span  style=""> 451                                                                                                          </span>
<span class="2503560481488678812" onmouseenter="enter('2503560481488678812');" onmouseout="out('2503560481488678812');" style=""> 452     private TypeInformation&lt;Row&gt; projectedTypeInfo(int[] fields, TableSchema schema) {                   </span>
<span class="-934325254904626531" onmouseenter="enter('-934325254904626531');" onmouseout="out('-934325254904626531');" style=""> 453         String[] fieldNames = schema.getFieldNames();                                                    </span>
<span class="4556717060829301814" onmouseenter="enter('4556717060829301814');" onmouseout="out('4556717060829301814');" style=""> 454         TypeInformation&lt;?&gt;[] fieldTypes = schema.getFieldTypes();                                        </span>
<span  style=""> 455                                                                                                          </span>
<span class="424178526470659793" onmouseenter="enter('424178526470659793');" onmouseout="out('424178526470659793');" style=""><abbr title=" 456         String[] projectedNames = Arrays.stream(fields).mapToObj(i -&gt; fieldNames[i]).toArray(String[]::new);"> 456         String[] projectedNames = Arrays.stream(fields).mapToObj(i -&gt; fieldNames[i]).toArray(String[]::ne🔵</abbr></span>
<span class="5411397013359382914" onmouseenter="enter('5411397013359382914');" onmouseout="out('5411397013359382914');" style=""><abbr title=" 457         TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(i -&gt; fieldTypes[i]).toArray(TypeInformation[]::new);"> 457         TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(i -&gt; fieldTypes[i]).toArray(Typ🔵</abbr></span>
<span class="-5627838059420262860" onmouseenter="enter('-5627838059420262860');" onmouseout="out('-5627838059420262860');" style=""> 458         return new RowTypeInfo(projectedTypes, projectedNames);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 459     }                                                                                                    </span>
<span  style=""> 460                                                                                                          </span>
<span  style=""> 461                                                                                                          </span>
<span class="-410103274617159114" onmouseenter="enter('-410103274617159114');" onmouseout="out('-410103274617159114');" style=""> 462     private boolean checkFieldsInfo(CreateTmpTableParser.SqlParserResult result, Table table) {          </span>
<span class="8925867441251499081" onmouseenter="enter('8925867441251499081');" onmouseout="out('8925867441251499081');" style=""> 463         List&lt;String&gt; fieldNames = new LinkedList&lt;&gt;();                                                    </span>
<span class="-5553816012496774052" onmouseenter="enter('-5553816012496774052');" onmouseout="out('-5553816012496774052');" style=""> 464         String fieldsInfo = result.getFieldsInfoStr();                                                   </span>
<span class="-5855731071361337066" onmouseenter="enter('-5855731071361337066');" onmouseout="out('-5855731071361337066');" style=""> 465         String[] fields = StringUtils.split(fieldsInfo, &quot;,&quot;);                                            </span>
<span class="8167763809890058258" onmouseenter="enter('8167763809890058258');" onmouseout="out('8167763809890058258');" style=""> 466         for (int i = 0; i &lt; fields.length; i++) {                                                        </span>
<span class="2947314498030065040" onmouseenter="enter('2947314498030065040');" onmouseout="out('2947314498030065040');" style=""> 467             String[] filed = fields[i].split(&quot;\\s&quot;);                                                     </span>
<span class="5889723123831816710" onmouseenter="enter('5889723123831816710');" onmouseout="out('5889723123831816710');" style=""> 468             if (filed.length &lt; 2 || fields.length != table.getSchema().getFieldCount()){                 </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 469                 return false;                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 470             } else {                                                                                     </span>
<span class="-7518627407039835792" onmouseenter="enter('-7518627407039835792');" onmouseout="out('-7518627407039835792');" style=""> 471                 String[] filedNameArr = new String[filed.length - 1];                                    </span>
<span class="6064994574122217386" onmouseenter="enter('6064994574122217386');" onmouseout="out('6064994574122217386');" style=""> 472                 System.arraycopy(filed, 0, filedNameArr, 0, filed.length - 1);                           </span>
<span class="-3029457015937137256" onmouseenter="enter('-3029457015937137256');" onmouseout="out('-3029457015937137256');" style=""> 473                 String fieldName = String.join(&quot; &quot;, filedNameArr);                                       </span>
<span class="-8037943253867791720" onmouseenter="enter('-8037943253867791720');" onmouseout="out('-8037943253867791720');" style=""> 474                 fieldNames.add(fieldName);                                                               </span>
<span class="516386479555957316" onmouseenter="enter('516386479555957316');" onmouseout="out('516386479555957316');" style=""> 475                 String fieldType = filed[filed.length - 1 ].trim();                                      </span>
<span class="-8511761590344571010" onmouseenter="enter('-8511761590344571010');" onmouseout="out('-8511761590344571010');" style=""> 476                 Class fieldClass = ClassUtil.stringConvertClass(fieldType);                              </span>
<span class="-351203522969775469" onmouseenter="enter('-351203522969775469');" onmouseout="out('-351203522969775469');" style=""> 477                 Class tableField = table.getSchema().getFieldType(i).get().getTypeClass();               </span>
<span class="9126336856345087988" onmouseenter="enter('9126336856345087988');" onmouseout="out('9126336856345087988');" style=""> 478                 if (fieldClass == tableField){                                                           </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 479                     continue;                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 480                 } else {                                                                                 </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 481                     return false;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 482                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 483             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 484         }                                                                                                </span>
<span class="-7181802501759976675" onmouseenter="enter('-7181802501759976675');" onmouseout="out('-7181802501759976675');" style=""> 485         tmpFields = String.join(&quot;,&quot;, fieldNames);                                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 486         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 487     }                                                                                                    </span>
<span  style=""> 488                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 489 }                                                                                                        </span>





























































</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  18 package com.dtstack.flink.sql.side;                                                                      </span>
<span  style="">  19                                                                                                          </span>
<span class="8826438848011158297" onmouseenter="enter('8826438848011158297');" onmouseout="out('8826438848011158297');" style="">  20 import com.dtstack.flink.sql.enums.ECacheType;                                                           </span>
<span class="1760694872476698727" onmouseenter="enter('1760694872476698727');" onmouseout="out('1760694872476698727');" style="">  21 import com.dtstack.flink.sql.exec.FlinkSQLExec;                                                          </span>
<span class="2626775214998945029" onmouseenter="enter('2626775214998945029');" onmouseout="out('2626775214998945029');" style="">  22 import com.dtstack.flink.sql.parser.CreateTmpTableParser;                                                </span>
<span class="7697893187981436175" onmouseenter="enter('7697893187981436175');" onmouseout="out('7697893187981436175');" style="">  23 import com.dtstack.flink.sql.side.operator.SideAsyncOperator;                                            </span>
<span class="-7456990469468101750" onmouseenter="enter('-7456990469468101750');" onmouseout="out('-7456990469468101750');" style="">  24 import com.dtstack.flink.sql.side.operator.SideWithAllCacheOperator;                                     </span>
<span class="4874498590411064411" onmouseenter="enter('4874498590411064411');" onmouseout="out('4874498590411064411');" style="">  25 import com.dtstack.flink.sql.util.ClassUtil;                                                             </span>
<span class="-4585055968129153397" onmouseenter="enter('-4585055968129153397');" onmouseout="out('-4585055968129153397');" style="">  26 import com.dtstack.flink.sql.util.ParseUtils;                                                            </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  27 import com.dtstack.flink.sql.util.TableUtils;                                                            </span>
<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  28 import com.google.common.base.Preconditions;                                                             </span>
<span class="-5849322492369628764" onmouseenter="enter('-5849322492369628764');" onmouseout="out('-5849322492369628764');" style="">  29 import com.google.common.collect.HashBasedTable;                                                         </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  30 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  31 import com.google.common.collect.Maps;                                                                   </span>
<span class="6390139568718476113" onmouseenter="enter('6390139568718476113');" onmouseout="out('6390139568718476113');" style="">  32 import com.google.common.collect.Sets;                                                                   </span>
<span class="-608398790767092657" onmouseenter="enter('-608398790767092657');" onmouseout="out('-608398790767092657');" style="">  33 import java.time.LocalDateTime;                                                                          </span>
<span class="196713859697444637" onmouseenter="enter('196713859697444637');" onmouseout="out('196713859697444637');" style="">  34 import java.util.*;                                                                                      </span>
<span class="5169042772451251702" onmouseenter="enter('5169042772451251702');" onmouseout="out('5169042772451251702');" style="">  35 import org.apache.calcite.sql.*;                                                                         </span>
<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="">  36 import org.apache.calcite.sql.parser.SqlParseException;                                                  </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  37 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  38 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="-4869246525166490693" onmouseenter="enter('-4869246525166490693');" onmouseout="out('-4869246525166490693');" style="">  39 import org.apache.flink.api.common.typeinfo.TypeInformation;                                             </span>
<span class="-5176867084763361213" onmouseenter="enter('-5176867084763361213');" onmouseout="out('-5176867084763361213');" style="">  40 import org.apache.flink.api.common.typeinfo.Types;                                                       </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  41 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  42 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="-2654529550501634008" onmouseenter="enter('-2654529550501634008');" onmouseout="out('-2654529550501634008');" style="">  43 import org.apache.flink.api.java.typeutils.TupleTypeInfo;                                                </span>
<span class="329774846923224587" onmouseenter="enter('329774846923224587');" onmouseout="out('329774846923224587');" style="">  44 import org.apache.flink.streaming.api.datastream.DataStream;                                             </span>
<span class="7654739943616372616" onmouseenter="enter('7654739943616372616');" onmouseout="out('7654739943616372616');" style="">  45 import org.apache.flink.table.api.EnvironmentSettings;                                                   </span>
<span class="5165777186879784670" onmouseenter="enter('5165777186879784670');" onmouseout="out('5165777186879784670');" style="">  46 import org.apache.flink.table.api.Table;                                                                 </span>
<span class="-8888728238394280005" onmouseenter="enter('-8888728238394280005');" onmouseout="out('-8888728238394280005');" style="">  47 import org.apache.flink.table.api.TableSchema;                                                           </span>
<span class="776922417053783834" onmouseenter="enter('776922417053783834');" onmouseout="out('776922417053783834');" style="">  48 import org.apache.flink.table.api.java.StreamTableEnvironment;                                           </span>
<span class="6625190898426831134" onmouseenter="enter('6625190898426831134');" onmouseout="out('6625190898426831134');" style="">  49 import org.apache.flink.table.catalog.ObjectIdentifier;                                                  </span>
<span class="-1569555401775623611" onmouseenter="enter('-1569555401775623611');" onmouseout="out('-1569555401775623611');" style="">  50 import org.apache.flink.table.runtime.typeutils.BaseRowTypeInfo;                                         </span>
<span class="-7056535177411590719" onmouseenter="enter('-7056535177411590719');" onmouseout="out('-7056535177411590719');" style="">  51 import org.apache.flink.table.types.logical.LogicalType;                                                 </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="">  52 import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                           </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  53 import org.apache.flink.types.Row;                                                                       </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  54 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  55 import org.slf4j.LoggerFactory;                                                                          </span>
<span class="7147213704442467623" onmouseenter="enter('7147213704442467623');" onmouseout="out('7147213704442467623');" style="">  56 import static org.apache.calcite.sql.SqlKind.*;                                                          </span>
<span  style="">  57                                                                                                          </span>
<span  style="">  58                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  59 /**                                                                                                      </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  60  * Reason:                                                                                               </span>
<span class="-6082749432478588798" onmouseenter="enter('-6082749432478588798');" onmouseout="out('-6082749432478588798');" style="">  61  * Date: 2018/7/24                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  62  * Company: www.dtstack.com                                                                              </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  63  * @author xuchao                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  64  */                                                                                                      </span>
<span class="-5079038956292767116" onmouseenter="enter('-5079038956292767116');" onmouseout="out('-5079038956292767116');" style="">  65 public class SideSqlExec {                                                                               </span>
<span class="-8991898280301588076" onmouseenter="enter('-8991898280301588076');" onmouseout="out('-8991898280301588076');" style="">  66     private static final Logger LOG = LoggerFactory.getLogger(SideSqlExec.class);                        </span>
<span  style="">  67                                                                                                          </span>
<span class="-6334022460956670337" onmouseenter="enter('-6334022460956670337');" onmouseout="out('-6334022460956670337');" style="">  68     private String localSqlPluginPath = null;                                                            </span>
<span  style="">  69                                                                                                          </span>
<span class="-863593709646632598" onmouseenter="enter('-863593709646632598');" onmouseout="out('-863593709646632598');" style="">  70     private String tmpFields = null;                                                                     </span>
<span  style="">  71                                                                                                          </span>
<span class="2496130613254560337" onmouseenter="enter('2496130613254560337');" onmouseout="out('2496130613254560337');" style="">  72     private String pluginLoadMode = null;                                                                </span>
<span  style="">  73                                                                                                          </span>
<span class="8878309237265342483" onmouseenter="enter('8878309237265342483');" onmouseout="out('8878309237265342483');" style="">  74     private SidePredicatesParser sidePredicatesParser = new SidePredicatesParser();                      </span>
<span  style="">  75                                                                                                          </span>
<span class="4175687380086503813" onmouseenter="enter('4175687380086503813');" onmouseout="out('4175687380086503813');" style="">  76     private Map&lt;String, Table&gt; localTableCache = Maps.newHashMap();                                      </span>
<span  style="">  77                                                                                                          </span>
<span class="-919934495260423939" onmouseenter="enter('-919934495260423939');" onmouseout="out('-919934495260423939');" style=""><abbr title="  78     public void exec(String sql, Map&lt;String, AbstractSideTableInfo&gt; sideTableMap, StreamTableEnvironment tableEnv, Map&lt;String, Table&gt; tableCache, CreateTmpTableParser.SqlParserResult createView, String scope) throws Exception {">  78     public void exec(String sql, Map&lt;String, AbstractSideTableInfo&gt; sideTableMap, StreamTableEnvironment 🔵</abbr></span>
<span class="-6307578536739293325" onmouseenter="enter('-6307578536739293325');" onmouseout="out('-6307578536739293325');" style="">  79         localTableCache.putAll(tableCache);                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  80         try {                                                                                            </span>
<span class="-7778408363768085476" onmouseenter="enter('-7778408363768085476');" onmouseout="out('-7778408363768085476');" style="">  81             sidePredicatesParser.fillPredicatesForSideTable(sql, sideTableMap);                          </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style="">  82         } catch (java.lang.Exception e) {                                                                </span>
<span class="-6535415982741029210" onmouseenter="enter('-6535415982741029210');" onmouseout="out('-6535415982741029210');" style="">  83             LOG.error(&quot;fill predicates for sideTable fail &quot;, e);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84         }                                                                                                </span>
<span class="-2666540822034943406" onmouseenter="enter('-2666540822034943406');" onmouseout="out('-2666540822034943406');" style="">  85         if (createView != null) {                                                                        </span>
<span class="-5051922790285322929" onmouseenter="enter('-5051922790285322929');" onmouseout="out('-5051922790285322929');" style="">  86             LOG.warn(&quot;create view info\n&quot;);                                                              </span>
<span class="4994977519661454238" onmouseenter="enter('4994977519661454238');" onmouseout="out('4994977519661454238');" style="">  87             LOG.warn(createView.getExecSql());                                                           </span>
<span class="-6048507734051622776" onmouseenter="enter('-6048507734051622776');" onmouseout="out('-6048507734051622776');" style="">  88             LOG.warn(&quot;-----------------&quot;);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  89         }                                                                                                </span>
<span class="3272289589011229925" onmouseenter="enter('3272289589011229925');" onmouseout="out('3272289589011229925');" style="">  90         SideSQLParser sideSQLParser = new SideSQLParser();                                               </span>
<span class="9221221341975786732" onmouseenter="enter('9221221341975786732');" onmouseout="out('9221221341975786732');" style="">  91         sideSQLParser.setLocalTableCache(localTableCache);                                               </span>
<span class="6016193463712965966" onmouseenter="enter('6016193463712965966');" onmouseout="out('6016193463712965966');" style="">  92         Queue&lt;Object&gt; exeQueue = sideSQLParser.getExeQueue(sql, sideTableMap.keySet(), scope);           </span>
<span class="1917635497637273504" onmouseenter="enter('1917635497637273504');" onmouseout="out('1917635497637273504');" style="">  93         Object pollObj = null;                                                                           </span>
<span class="-5058340944145416275" onmouseenter="enter('-5058340944145416275');" onmouseout="out('-5058340944145416275');" style="">  94         while ((pollObj = exeQueue.poll()) != null) {                                                    </span>
<span class="-2443216094467354180" onmouseenter="enter('-2443216094467354180');" onmouseout="out('-2443216094467354180');" style="">  95             if (pollObj instanceof SqlNode) {                                                            </span>
<span class="-7928777679656459385" onmouseenter="enter('-7928777679656459385');" onmouseout="out('-7928777679656459385');" style="">  96                 SqlNode pollSqlNode = ((SqlNode) (pollObj));                                             </span>
<span class="-1675849540725983142" onmouseenter="enter('-1675849540725983142');" onmouseout="out('-1675849540725983142');" style="">  97                 if (pollSqlNode.getKind() == INSERT) {                                                   </span>
<span class="4666335002906799727" onmouseenter="enter('4666335002906799727');" onmouseout="out('4666335002906799727');" style="">  98                     FlinkSQLExec.sqlUpdate(tableEnv, pollSqlNode.toString());                            </span>
<span class="-4873093459421651994" onmouseenter="enter('-4873093459421651994');" onmouseout="out('-4873093459421651994');" style="">  99                     if (LOG.isInfoEnabled()) {                                                           </span>
<span class="-5986232783970891998" onmouseenter="enter('-5986232783970891998');" onmouseout="out('-5986232783970891998');" style=""> 100                         LOG.info(&quot;----------real exec sql-----------\n{}&quot;, pollSqlNode.toString());      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101                     }                                                                                    </span>
<span class="-2457059581629029056" onmouseenter="enter('-2457059581629029056');" onmouseout="out('-2457059581629029056');" style=""> 102                 } else if (pollSqlNode.getKind() == AS) {                                                </span>
<span class="3037765200739894050" onmouseenter="enter('3037765200739894050');" onmouseout="out('3037765200739894050');" style=""> 103                     dealAsSourceTable(tableEnv, pollSqlNode, tableCache);                                </span>
<span class="4581342471671871622" onmouseenter="enter('4581342471671871622');" onmouseout="out('4581342471671871622');" style=""> 104                 } else if (pollSqlNode.getKind() == WITH_ITEM) {                                         </span>
<span class="-5883854330896154202" onmouseenter="enter('-5883854330896154202');" onmouseout="out('-5883854330896154202');" style=""> 105                     SqlWithItem sqlWithItem = ((SqlWithItem) (pollSqlNode));                             </span>
<span class="-7674640876687845363" onmouseenter="enter('-7674640876687845363');" onmouseout="out('-7674640876687845363');" style=""> 106                     String TableAlias = sqlWithItem.name.toString();                                     </span>
<span class="2573668668184904794" onmouseenter="enter('2573668668184904794');" onmouseout="out('2573668668184904794');" style=""> 107                     Table table = tableEnv.sqlQuery(sqlWithItem.query.toString());                       </span>
<span class="2341577843786962651" onmouseenter="enter('2341577843786962651');" onmouseout="out('2341577843786962651');" style=""> 108                     tableEnv.registerTable(TableAlias, table);                                           </span>
<span class="-5550860322814932769" onmouseenter="enter('-5550860322814932769');" onmouseout="out('-5550860322814932769');" style=""> 109                 } else if (pollSqlNode.getKind() == SELECT) {                                            </span>
<span class="-1344441018307209750" onmouseenter="enter('-1344441018307209750');" onmouseout="out('-1344441018307209750');" style=""><abbr title=" 110                     Preconditions.checkState(createView != null, &quot;select sql must included by create view&quot;);"> 110                     Preconditions.checkState(createView != null, &quot;select sql must included by create view🔵</abbr></span>
<span class="1694293925390283740" onmouseenter="enter('1694293925390283740');" onmouseout="out('1694293925390283740');" style=""> 111                     Table table = tableEnv.sqlQuery(pollObj.toString());                                 </span>
<span class="2239810942967083761" onmouseenter="enter('2239810942967083761');" onmouseout="out('2239810942967083761');" style=""> 112                     if (createView.getFieldsInfoStr() == null) {                                         </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 113                         tableEnv.registerTable(createView.getTableName(), table);                        </span>
<span class="4745325120447602784" onmouseenter="enter('4745325120447602784');" onmouseout="out('4745325120447602784');" style=""> 114                     } else if (checkFieldsInfo(createView, table)) {                                     </span>
<span class="-9109211084540213069" onmouseenter="enter('-9109211084540213069');" onmouseout="out('-9109211084540213069');" style=""> 115                         table = table.as(tmpFields);                                                     </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 116                         tableEnv.registerTable(createView.getTableName(), table);                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 117                     } else {                                                                             </span>
<span class="-4180003952862210397" onmouseenter="enter('-4180003952862210397');" onmouseout="out('-4180003952862210397');" style=""> 118                         throw new RuntimeException(&quot;Fields mismatch&quot;);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119                     }                                                                                    </span>
<span class="-5831701022468144749" onmouseenter="enter('-5831701022468144749');" onmouseout="out('-5831701022468144749');" style=""> 120                     localTableCache.put(createView.getTableName(), table);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121                 }                                                                                        </span>
<span class="735190908606907144" onmouseenter="enter('735190908606907144');" onmouseout="out('735190908606907144');" style=""> 122             } else if (pollObj instanceof JoinInfo) {                                                    </span>
<span class="-6196622619540139248" onmouseenter="enter('-6196622619540139248');" onmouseout="out('-6196622619540139248');" style=""> 123                 LOG.info(&quot;----------exec join info----------\n{}&quot;, pollObj.toString());                  </span>
<span class="-3518617829078174884" onmouseenter="enter('-3518617829078174884');" onmouseout="out('-3518617829078174884');" style=""> 124                 joinFun(pollObj, localTableCache, sideTableMap, tableEnv);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 125             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127     }                                                                                                    </span>
<span  style=""> 128                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 129     /**                                                                                                  </span>
<span class="-7226459799151937672" onmouseenter="enter('-7226459799151937672');" onmouseout="out('-7226459799151937672');" style=""> 130      * 解析出as查询的表和字段的关系                                                                                   </span>
<span class="-4711911052088894915" onmouseenter="enter('-4711911052088894915');" onmouseout="out('-4711911052088894915');" style=""> 131      * @param asSqlNode                                                                                  </span>
<span class="-8172984871762282794" onmouseenter="enter('-8172984871762282794');" onmouseout="out('-8172984871762282794');" style=""> 132      * @param tableCache                                                                                 </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 133      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 134      */                                                                                                  </span>
<span class="1606768570861189432" onmouseenter="enter('1606768570861189432');" onmouseout="out('1606768570861189432');" style=""> 135     private FieldReplaceInfo parseAsQuery(SqlBasicCall asSqlNode, Map&lt;String, Table&gt; tableCache) {       </span>
<span class="-4950849472737015743" onmouseenter="enter('-4950849472737015743');" onmouseout="out('-4950849472737015743');" style=""> 136         SqlNode info = asSqlNode.getOperands()[0];                                                       </span>
<span class="-6049998703041327008" onmouseenter="enter('-6049998703041327008');" onmouseout="out('-6049998703041327008');" style=""> 137         SqlNode alias = asSqlNode.getOperands()[1];                                                      </span>
<span class="6169254144825097648" onmouseenter="enter('6169254144825097648');" onmouseout="out('6169254144825097648');" style=""> 138         SqlKind infoKind = info.getKind();                                                               </span>
<span class="-7038358418253063490" onmouseenter="enter('-7038358418253063490');" onmouseout="out('-7038358418253063490');" style=""> 139         if (infoKind != SELECT) {                                                                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 140             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141         }                                                                                                </span>
<span class="-2978908867755751484" onmouseenter="enter('-2978908867755751484');" onmouseout="out('-2978908867755751484');" style=""><abbr title=" 142         List&lt;FieldInfo&gt; extractFieldList = TableUtils.parserSelectField(((SqlSelect) (info)), tableCache);"> 142         List&lt;FieldInfo&gt; extractFieldList = TableUtils.parserSelectField(((SqlSelect) (info)), tableCache)🔵</abbr></span>
<span class="-3840015462696951757" onmouseenter="enter('-3840015462696951757');" onmouseout="out('-3840015462696951757');" style=""> 143         HashBasedTable&lt;String, String, String&gt; mappingTable = HashBasedTable.create();                   </span>
<span class="-5476396715494077219" onmouseenter="enter('-5476396715494077219');" onmouseout="out('-5476396715494077219');" style=""> 144         for (FieldInfo fieldInfo : extractFieldList) {                                                   </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 145             String tableName = fieldInfo.getTable();                                                     </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 146             String fieldName = fieldInfo.getFieldName();                                                 </span>
<span class="4185539436596522295" onmouseenter="enter('4185539436596522295');" onmouseout="out('4185539436596522295');" style=""> 147             String mappingFieldName = ParseUtils.dealDuplicateFieldName(mappingTable, fieldName);        </span>
<span class="-7827879044056282695" onmouseenter="enter('-7827879044056282695');" onmouseout="out('-7827879044056282695');" style=""> 148             mappingTable.put(tableName, fieldName, mappingFieldName);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 149         }                                                                                                </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 150         FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                           </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 151         replaceInfo.setMappingTable(mappingTable);                                                       </span>
<span class="9115675088981905484" onmouseenter="enter('9115675088981905484');" onmouseout="out('9115675088981905484');" style=""> 152         replaceInfo.setTargetTableName(alias.toString());                                                </span>
<span class="-6295883374697236710" onmouseenter="enter('-6295883374697236710');" onmouseout="out('-6295883374697236710');" style=""> 153         replaceInfo.setTargetTableAlias(alias.toString());                                               </span>
<span class="2754859294214862032" onmouseenter="enter('2754859294214862032');" onmouseout="out('2754859294214862032');" style=""> 154         return replaceInfo;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155     }                                                                                                    </span>
<span  style=""> 156                                                                                                          </span>
<span class="73834954090191073" onmouseenter="enter('73834954090191073');" onmouseout="out('73834954090191073');" style=""> 157     public AliasInfo parseASNode(SqlNode sqlNode) throws SqlParseException {                             </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 158         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="-2199822100243684238" onmouseenter="enter('-2199822100243684238');" onmouseout="out('-2199822100243684238');" style=""> 159         if (sqlKind != AS) {                                                                             </span>
<span class="1088430228081547460" onmouseenter="enter('1088430228081547460');" onmouseout="out('1088430228081547460');" style=""> 160             throw new RuntimeException(sqlNode + &quot; is not &#x27;as&#x27; operator&quot;);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161         }                                                                                                </span>
<span class="-2581148716866963551" onmouseenter="enter('-2581148716866963551');" onmouseout="out('-2581148716866963551');" style=""> 162         SqlNode info = ((SqlBasicCall) (sqlNode)).getOperands()[0];                                      </span>
<span class="6674876786664753496" onmouseenter="enter('6674876786664753496');" onmouseout="out('6674876786664753496');" style=""> 163         SqlNode alias = ((SqlBasicCall) (sqlNode)).getOperands()[1];                                     </span>
<span class="-2458625767668584085" onmouseenter="enter('-2458625767668584085');" onmouseout="out('-2458625767668584085');" style=""> 164         AliasInfo aliasInfo = new AliasInfo();                                                           </span>
<span class="-5109084571101185803" onmouseenter="enter('-5109084571101185803');" onmouseout="out('-5109084571101185803');" style=""> 165         aliasInfo.setName(info.toString());                                                              </span>
<span class="-6584143955119724642" onmouseenter="enter('-6584143955119724642');" onmouseout="out('-6584143955119724642');" style=""> 166         aliasInfo.setAlias(alias.toString());                                                            </span>
<span class="-3107000398971930583" onmouseenter="enter('-3107000398971930583');" onmouseout="out('-3107000398971930583');" style=""> 167         return aliasInfo;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168     }                                                                                                    </span>
<span  style=""> 169                                                                                                          </span>
<span class="-657749638702697788" onmouseenter="enter('-657749638702697788');" onmouseout="out('-657749638702697788');" style=""><abbr title=" 170     public BaseRowTypeInfo buildOutRowTypeInfo(List&lt;FieldInfo&gt; sideJoinFieldInfo, HashBasedTable&lt;String, String, String&gt; mappingTable) {"> 170     public BaseRowTypeInfo buildOutRowTypeInfo(List&lt;FieldInfo&gt; sideJoinFieldInfo, HashBasedTable&lt;String, 🔵</abbr></span>
<span class="-9126530720291690226" onmouseenter="enter('-9126530720291690226');" onmouseout="out('-9126530720291690226');" style=""> 171         // TypeInformation[] sideOutTypes = new TypeInformation[sideJoinFieldInfo.size()];               </span>
<span class="2784978011557375723" onmouseenter="enter('2784978011557375723');" onmouseout="out('2784978011557375723');" style=""> 172         LogicalType[] sideOutTypes = new LogicalType[sideJoinFieldInfo.size()];                          </span>
<span class="-637166731779412769" onmouseenter="enter('-637166731779412769');" onmouseout="out('-637166731779412769');" style=""> 173         String[] sideOutNames = new String[sideJoinFieldInfo.size()];                                    </span>
<span class="7438730024850909889" onmouseenter="enter('7438730024850909889');" onmouseout="out('7438730024850909889');" style=""> 174         for (int i = 0; i &lt; sideJoinFieldInfo.size(); i++) {                                             </span>
<span class="2207877773063469724" onmouseenter="enter('2207877773063469724');" onmouseout="out('2207877773063469724');" style=""> 175             FieldInfo fieldInfo = sideJoinFieldInfo.get(i);                                              </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 176             String tableName = fieldInfo.getTable();                                                     </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 177             String fieldName = fieldInfo.getFieldName();                                                 </span>
<span class="3640983111807923268" onmouseenter="enter('3640983111807923268');" onmouseout="out('3640983111807923268');" style=""> 178             String mappingFieldName = mappingTable.get(tableName, fieldName);                            </span>
<span class="-4165873345254348507" onmouseenter="enter('-4165873345254348507');" onmouseout="out('-4165873345254348507');" style=""><abbr title=" 179             Preconditions.checkNotNull(mappingFieldName, fieldInfo + &quot; not mapping any field! it may be frame bug&quot;);"> 179             Preconditions.checkNotNull(mappingFieldName, fieldInfo + &quot; not mapping any field! it may be f🔵</abbr></span>
<span class="-4639076863607040957" onmouseenter="enter('-4639076863607040957');" onmouseout="out('-4639076863607040957');" style=""> 180             sideOutTypes[i] = fieldInfo.getLogicalType();                                                </span>
<span class="6276485717663783154" onmouseenter="enter('6276485717663783154');" onmouseout="out('6276485717663783154');" style=""> 181             sideOutNames[i] = mappingFieldName;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182         }                                                                                                </span>
<span class="-8180554737552837485" onmouseenter="enter('-8180554737552837485');" onmouseout="out('-8180554737552837485');" style=""> 183         return new BaseRowTypeInfo(sideOutTypes, sideOutNames);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184     }                                                                                                    </span>
<span  style=""> 185                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 186     /**                                                                                                  </span>
<span class="4027944609056411189" onmouseenter="enter('4027944609056411189');" onmouseout="out('4027944609056411189');" style=""> 187      *  对时间类型进行类型转换                                                                                      </span>
<span class="-7981851073621455488" onmouseenter="enter('-7981851073621455488');" onmouseout="out('-7981851073621455488');" style=""> 188      * @param leftTypeInfo                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 189      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 190      */                                                                                                  </span>
<span class="109255438874014135" onmouseenter="enter('109255438874014135');" onmouseout="out('109255438874014135');" style=""> 191     private RowTypeInfo buildLeftTableOutType(RowTypeInfo leftTypeInfo) {                                </span>
<span class="5269317691380571116" onmouseenter="enter('5269317691380571116');" onmouseout="out('5269317691380571116');" style=""> 192         TypeInformation[] sideOutTypes = new TypeInformation[leftTypeInfo.getFieldNames().length];       </span>
<span class="357447233987634249" onmouseenter="enter('357447233987634249');" onmouseout="out('357447233987634249');" style=""> 193         TypeInformation&lt;?&gt;[] fieldTypes = leftTypeInfo.getFieldTypes();                                  </span>
<span class="-7313385440196867180" onmouseenter="enter('-7313385440196867180');" onmouseout="out('-7313385440196867180');" style=""> 194         for (int i = 0; i &lt; sideOutTypes.length; i++) {                                                  </span>
<span class="-314833607359598646" onmouseenter="enter('-314833607359598646');" onmouseout="out('-314833607359598646');" style=""> 195             sideOutTypes[i] = convertTimeAttributeType(fieldTypes[i]);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196         }                                                                                                </span>
<span class="-6446480870466684625" onmouseenter="enter('-6446480870466684625');" onmouseout="out('-6446480870466684625');" style=""> 197         RowTypeInfo rowTypeInfo = new RowTypeInfo(sideOutTypes, leftTypeInfo.getFieldNames());           </span>
<span class="6189116692514123920" onmouseenter="enter('6189116692514123920');" onmouseout="out('6189116692514123920');" style=""> 198         return rowTypeInfo;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199     }                                                                                                    </span>
<span  style=""> 200                                                                                                          </span>
<span class="2471506251995792847" onmouseenter="enter('2471506251995792847');" onmouseout="out('2471506251995792847');" style=""> 201     private TypeInformation convertTimeAttributeType(TypeInformation typeInformation) {                  </span>
<span class="2997926285576198837" onmouseenter="enter('2997926285576198837');" onmouseout="out('2997926285576198837');" style=""> 202         if (typeInformation instanceof TimeIndicatorTypeInfo) {                                          </span>
<span class="-4699013589387269243" onmouseenter="enter('-4699013589387269243');" onmouseout="out('-4699013589387269243');" style=""> 203             return TypeInformation.of(LocalDateTime.class);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204         }                                                                                                </span>
<span class="6871348106862514693" onmouseenter="enter('6871348106862514693');" onmouseout="out('6871348106862514693');" style=""> 205         return typeInformation;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206     }                                                                                                    </span>
<span  style=""> 207                                                                                                          </span>
<span class="-6722855011181273565" onmouseenter="enter('-6722855011181273565');" onmouseout="out('-6722855011181273565');" style=""> 208     public void setLocalSqlPluginPath(String localSqlPluginPath) {                                       </span>
<span class="6258662942576926140" onmouseenter="enter('6258662942576926140');" onmouseout="out('6258662942576926140');" style=""> 209         this.localSqlPluginPath = localSqlPluginPath;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210     }                                                                                                    </span>
<span  style=""> 211                                                                                                          </span>
<span class="6639781197811189198" onmouseenter="enter('6639781197811189198');" onmouseout="out('6639781197811189198');" style=""> 212     public void setPluginLoadMode(String pluginLoadMode) {                                               </span>
<span class="1051014760706894364" onmouseenter="enter('1051014760706894364');" onmouseout="out('1051014760706894364');" style=""> 213         this.pluginLoadMode = pluginLoadMode;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214     }                                                                                                    </span>
<span  style=""> 215                                                                                                          </span>
<span class="2277905399441322839" onmouseenter="enter('2277905399441322839');" onmouseout="out('2277905399441322839');" style=""><abbr title=" 216     private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableName){"> 216     private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableNa🔵</abbr></span>
<span class="-6301156236825066460" onmouseenter="enter('-6301156236825066460');" onmouseout="out('-6301156236825066460');" style=""> 217         Table table = localTableCache.get(tableAlias);                                                   </span>
<span class="2042916935617835771" onmouseenter="enter('2042916935617835771');" onmouseout="out('2042916935617835771');" style=""> 218         if(table == null){                                                                               </span>
<span class="-5960895848666330323" onmouseenter="enter('-5960895848666330323');" onmouseout="out('-5960895848666330323');" style=""> 219             table = localTableCache.get(tableName);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220         }                                                                                                </span>
<span  style=""> 221                                                                                                          </span>
<span class="2042916935617835771" onmouseenter="enter('2042916935617835771');" onmouseout="out('2042916935617835771');" style=""> 222         if(table == null){                                                                               </span>
<span class="4627225224916806199" onmouseenter="enter('4627225224916806199');" onmouseout="out('4627225224916806199');" style=""> 223             throw new RuntimeException(&quot;not register table &quot; + tableAlias);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224         }                                                                                                </span>
<span  style=""> 225                                                                                                          </span>
<span class="-6017334383208509278" onmouseenter="enter('-6017334383208509278');" onmouseout="out('-6017334383208509278');" style=""> 226         return table;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227     }                                                                                                    </span>
<span  style=""> 228                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 229     /**                                                                                                  </span>
<span class="5196638318686351881" onmouseenter="enter('5196638318686351881');" onmouseout="out('5196638318686351881');" style=""><abbr title=" 230      * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., dimension table is the primary key definition"> 230      * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., d🔵</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 231      *                                                                                                   </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 232      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 233      */                                                                                                  </span>
<span class="4488554625343324946" onmouseenter="enter('4488554625343324946');" onmouseout="out('4488554625343324946');" style=""><abbr title=" 234     private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInfo sideTableInfo) {"> 234     private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInf🔵</abbr></span>
<span class="-6710736308674703771" onmouseenter="enter('-6710736308674703771');" onmouseout="out('-6710736308674703771');" style=""> 235         List&lt;String&gt; conditionFields = getConditionFields(conditionNode, sideTableAlias, sideTableInfo); </span>
<span class="8847075305465358712" onmouseenter="enter('8847075305465358712');" onmouseout="out('8847075305465358712');" style=""> 236         if (CollectionUtils.isEqualCollection(conditionFields, convertPrimaryAlias(sideTableInfo))) {    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 237             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 239         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240     }                                                                                                    </span>
<span  style=""> 241                                                                                                          </span>
<span class="572998504046101497" onmouseenter="enter('572998504046101497');" onmouseout="out('572998504046101497');" style=""> 242     private List&lt;String&gt; convertPrimaryAlias(AbstractSideTableInfo sideTableInfo) {                      </span>
<span class="-6700733268022775520" onmouseenter="enter('-6700733268022775520');" onmouseout="out('-6700733268022775520');" style=""> 243         List&lt;String&gt; res = Lists.newArrayList();                                                         </span>
<span class="-1517278133900331130" onmouseenter="enter('-1517278133900331130');" onmouseout="out('-1517278133900331130');" style=""> 244         sideTableInfo.getPrimaryKeys().forEach(field -&gt; {                                                </span>
<span class="2991641550935988694" onmouseenter="enter('2991641550935988694');" onmouseout="out('2991641550935988694');" style=""> 245             res.add(sideTableInfo.getPhysicalFields().getOrDefault(field, field));                       </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 246         });                                                                                              </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 247         return res;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248     }                                                                                                    </span>
<span  style=""> 249                                                                                                          </span>
<span class="6064840374032880755" onmouseenter="enter('6064840374032880755');" onmouseout="out('6064840374032880755');" style=""><abbr title=" 250     public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTableInfo sideTableInfo) {"> 250     public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTa🔵</abbr></span>
<span class="-5667062641477778387" onmouseenter="enter('-5667062641477778387');" onmouseout="out('-5667062641477778387');" style=""> 251         List&lt;SqlNode&gt; sqlNodeList = Lists.newArrayList();                                                </span>
<span class="5003747983397221043" onmouseenter="enter('5003747983397221043');" onmouseout="out('5003747983397221043');" style=""> 252         ParseUtils.parseAnd(conditionNode, sqlNodeList);                                                 </span>
<span class="331902561671078290" onmouseenter="enter('331902561671078290');" onmouseout="out('331902561671078290');" style=""> 253         List&lt;String&gt; conditionFields = Lists.newArrayList();                                             </span>
<span class="4227493740309250661" onmouseenter="enter('4227493740309250661');" onmouseout="out('4227493740309250661');" style=""> 254         for (SqlNode sqlNode : sqlNodeList) {                                                            </span>
<span class="-1235221313035004193" onmouseenter="enter('-1235221313035004193');" onmouseout="out('-1235221313035004193');" style=""> 255             if (!SqlKind.COMPARISON.contains(sqlNode.getKind())) {                                       </span>
<span class="4238811186041433324" onmouseenter="enter('4238811186041433324');" onmouseout="out('4238811186041433324');" style=""> 256                 throw new RuntimeException(&quot;not compare operator.&quot;);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257             }                                                                                            </span>
<span class="6270705694561767590" onmouseenter="enter('6270705694561767590');" onmouseout="out('6270705694561767590');" style=""> 258             SqlIdentifier left = ((SqlIdentifier) (((SqlBasicCall) (sqlNode)).getOperands()[0]));        </span>
<span class="4075214292407725883" onmouseenter="enter('4075214292407725883');" onmouseout="out('4075214292407725883');" style=""> 259             SqlIdentifier right = ((SqlIdentifier) (((SqlBasicCall) (sqlNode)).getOperands()[1]));       </span>
<span class="-2670749344655178863" onmouseenter="enter('-2670749344655178863');" onmouseout="out('-2670749344655178863');" style=""> 260             String leftTableName = left.getComponent(0).getSimple();                                     </span>
<span class="5188110590184041827" onmouseenter="enter('5188110590184041827');" onmouseout="out('5188110590184041827');" style=""> 261             String rightTableName = right.getComponent(0).getSimple();                                   </span>
<span class="8082853509369418918" onmouseenter="enter('8082853509369418918');" onmouseout="out('8082853509369418918');" style=""> 262             String tableCol = &quot;&quot;;                                                                        </span>
<span class="-1233782311271008501" onmouseenter="enter('-1233782311271008501');" onmouseout="out('-1233782311271008501');" style=""> 263             if (leftTableName.equalsIgnoreCase(specifyTableName)) {                                      </span>
<span class="4527748628163402760" onmouseenter="enter('4527748628163402760');" onmouseout="out('4527748628163402760');" style=""> 264                 tableCol = left.getComponent(1).getSimple();                                             </span>
<span class="-2773987473156284347" onmouseenter="enter('-2773987473156284347');" onmouseout="out('-2773987473156284347');" style=""> 265             } else if (rightTableName.equalsIgnoreCase(specifyTableName)) {                              </span>
<span class="4462633703217831544" onmouseenter="enter('4462633703217831544');" onmouseout="out('4462633703217831544');" style=""> 266                 tableCol = right.getComponent(1).getSimple();                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 267             } else {                                                                                     </span>
<span class="3783543445731730404" onmouseenter="enter('3783543445731730404');" onmouseout="out('3783543445731730404');" style=""><abbr title=" 268                 throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specifyTableName));"> 268                 throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specify🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269             }                                                                                            </span>
<span class="-2325401555704525047" onmouseenter="enter('-2325401555704525047');" onmouseout="out('-2325401555704525047');" style=""> 270             tableCol = sideTableInfo.getPhysicalFields().getOrDefault(tableCol, tableCol);               </span>
<span class="-4552234441929070616" onmouseenter="enter('-4552234441929070616');" onmouseout="out('-4552234441929070616');" style=""> 271             conditionFields.add(tableCol);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272         }                                                                                                </span>
<span class="4950082808497882460" onmouseenter="enter('4950082808497882460');" onmouseout="out('4950082808497882460');" style=""> 273         return conditionFields;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274     }                                                                                                    </span>
<span  style=""> 275                                                                                                          </span>
<span class="5919995367845636830" onmouseenter="enter('5919995367845636830');" onmouseout="out('5919995367845636830');" style=""><abbr title=" 276     protected void dealAsSourceTable(StreamTableEnvironment tableEnv, SqlNode pollSqlNode, Map&lt;String, Table&gt; tableCache) throws SqlParseException {"> 276     protected void dealAsSourceTable(StreamTableEnvironment tableEnv, SqlNode pollSqlNode, Map&lt;String, Ta🔵</abbr></span>
<span class="-7364020242551640527" onmouseenter="enter('-7364020242551640527');" onmouseout="out('-7364020242551640527');" style=""> 277         AliasInfo aliasInfo = parseASNode(pollSqlNode);                                                  </span>
<span class="2461088292100865778" onmouseenter="enter('2461088292100865778');" onmouseout="out('2461088292100865778');" style=""> 278         if (localTableCache.containsKey(aliasInfo.getName())) {                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 279             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280         }                                                                                                </span>
<span class="-3390660419579622283" onmouseenter="enter('-3390660419579622283');" onmouseout="out('-3390660419579622283');" style=""> 281         Table table = tableEnv.sqlQuery(aliasInfo.getName());                                            </span>
<span class="5901087968051131557" onmouseenter="enter('5901087968051131557');" onmouseout="out('5901087968051131557');" style=""> 282         tableEnv.registerTable(aliasInfo.getAlias(), table);                                             </span>
<span class="1100939894023116874" onmouseenter="enter('1100939894023116874');" onmouseout="out('1100939894023116874');" style=""> 283         localTableCache.put(aliasInfo.getAlias(), table);                                                </span>
<span class="7353361537117728269" onmouseenter="enter('7353361537117728269');" onmouseout="out('7353361537117728269');" style=""> 284         LOG.info(&quot;Register Table {} by {}&quot;, aliasInfo.getAlias(), aliasInfo.getName());                  </span>
<span class="9016797621408685274" onmouseenter="enter('9016797621408685274');" onmouseout="out('9016797621408685274');" style=""> 285         FieldReplaceInfo fieldReplaceInfo = parseAsQuery(((SqlBasicCall) (pollSqlNode)), tableCache);    </span>
<span class="7661155268446817101" onmouseenter="enter('7661155268446817101');" onmouseout="out('7661155268446817101');" style=""> 286         if (fieldReplaceInfo == null) {                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 287             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288         }                                                                                                </span>
<span class="5201289014257809146" onmouseenter="enter('5201289014257809146');" onmouseout="out('5201289014257809146');" style=""> 289         // as 的源表                                                                                        </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 290         Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                </span>
<span class="-6985284674886378091" onmouseenter="enter('-6985284674886378091');" onmouseout="out('-6985284674886378091');" style=""> 291         SqlNode fromNode = ((SqlBasicCall) (pollSqlNode)).getOperands()[0];                              </span>
<span class="8218826531385538687" onmouseenter="enter('8218826531385538687');" onmouseout="out('8218826531385538687');" style=""> 292         TableUtils.getFromTableInfo(fromNode, fromTableNameSet);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293     }                                                                                                    </span>
<span  style=""> 294                                                                                                          </span>
<span class="-2241580585491851593" onmouseenter="enter('-2241580585491851593');" onmouseout="out('-2241580585491851593');" style=""><abbr title=" 295     private void joinFun(Object pollObj, Map&lt;String, Table&gt; localTableCache, Map&lt;String, AbstractSideTableInfo&gt; sideTableMap, StreamTableEnvironment tableEnv) throws Exception {"> 295     private void joinFun(Object pollObj, Map&lt;String, Table&gt; localTableCache, Map&lt;String, AbstractSideTabl🔵</abbr></span>
<span class="2723345182979130952" onmouseenter="enter('2723345182979130952');" onmouseout="out('2723345182979130952');" style=""> 296         JoinInfo joinInfo = ((JoinInfo) (pollObj));                                                      </span>
<span class="-4580559439294190862" onmouseenter="enter('-4580559439294190862');" onmouseout="out('-4580559439294190862');" style=""> 297         JoinScope joinScope = new JoinScope();                                                           </span>
<span class="-6383140859888654083" onmouseenter="enter('-6383140859888654083');" onmouseout="out('-6383140859888654083');" style=""> 298         JoinScope.ScopeChild leftScopeChild = new JoinScope.ScopeChild();                                </span>
<span class="-5401707331330951256" onmouseenter="enter('-5401707331330951256');" onmouseout="out('-5401707331330951256');" style=""> 299         leftScopeChild.setAlias(joinInfo.getLeftTableAlias());                                           </span>
<span class="5108424867732442426" onmouseenter="enter('5108424867732442426');" onmouseout="out('5108424867732442426');" style=""> 300         leftScopeChild.setTableName(joinInfo.getLeftTableName());                                        </span>
<span class="-2402361542513321069" onmouseenter="enter('-2402361542513321069');" onmouseout="out('-2402361542513321069');" style=""><abbr title=" 301         Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLeftTableName());"> 301         Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLe🔵</abbr></span>
<span class="-6003115091233455661" onmouseenter="enter('-6003115091233455661');" onmouseout="out('-6003115091233455661');" style=""><abbr title=" 302         RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getFieldTypes(), leftTable.getSchema().getFieldNames());"> 302         RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getFieldTypes(), leftTable.getSc🔵</abbr></span>
<span class="6844734750257063206" onmouseenter="enter('6844734750257063206');" onmouseout="out('6844734750257063206');" style=""> 303         int length = leftTable.getSchema().getFieldDataTypes().length;                                   </span>
<span class="-7291542410657351968" onmouseenter="enter('-7291542410657351968');" onmouseout="out('-7291542410657351968');" style=""> 304         LogicalType[] logicalTypes = new LogicalType[length];                                            </span>
<span class="6908715651536326362" onmouseenter="enter('6908715651536326362');" onmouseout="out('6908715651536326362');" style=""> 305         for (int i = 0; i &lt; length; i++) {                                                               </span>
<span class="1537154519277872520" onmouseenter="enter('1537154519277872520');" onmouseout="out('1537154519277872520');" style=""> 306             logicalTypes[i] = leftTable.getSchema().getFieldDataTypes()[i].getLogicalType();             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307         }                                                                                                </span>
<span class="6552727302564022327" onmouseenter="enter('6552727302564022327');" onmouseout="out('6552727302564022327');" style=""><abbr title=" 308         BaseRowTypeInfo leftBaseTypeInfo = new BaseRowTypeInfo(logicalTypes, leftTable.getSchema().getFieldNames());"> 308         BaseRowTypeInfo leftBaseTypeInfo = new BaseRowTypeInfo(logicalTypes, leftTable.getSchema().getFie🔵</abbr></span>
<span class="-5303860989220332569" onmouseenter="enter('-5303860989220332569');" onmouseout="out('-5303860989220332569');" style=""> 309         leftScopeChild.setRowTypeInfo(leftTypeInfo);                                                     </span>
<span class="-4838857475621068375" onmouseenter="enter('-4838857475621068375');" onmouseout="out('-4838857475621068375');" style=""> 310         leftScopeChild.setBaseRowTypeInfo(leftBaseTypeInfo);                                             </span>
<span class="3043795906382715340" onmouseenter="enter('3043795906382715340');" onmouseout="out('3043795906382715340');" style=""> 311         JoinScope.ScopeChild rightScopeChild = new JoinScope.ScopeChild();                               </span>
<span class="2585249270397691815" onmouseenter="enter('2585249270397691815');" onmouseout="out('2585249270397691815');" style=""> 312         rightScopeChild.setAlias(joinInfo.getRightTableAlias());                                         </span>
<span class="-5072747544386586876" onmouseenter="enter('-5072747544386586876');" onmouseout="out('-5072747544386586876');" style=""> 313         rightScopeChild.setTableName(joinInfo.getRightTableName());                                      </span>
<span class="-6382774479188932768" onmouseenter="enter('-6382774479188932768');" onmouseout="out('-6382774479188932768');" style=""> 314         AbstractSideTableInfo sideTableInfo = sideTableMap.get(joinInfo.getRightTableName());            </span>
<span class="-4894423646294599023" onmouseenter="enter('-4894423646294599023');" onmouseout="out('-4894423646294599023');" style=""> 315         if (sideTableInfo == null) {                                                                     </span>
<span class="-5396801098824602905" onmouseenter="enter('-5396801098824602905');" onmouseout="out('-5396801098824602905');" style=""> 316             sideTableInfo = sideTableMap.get(joinInfo.getRightTableAlias());                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317         }                                                                                                </span>
<span class="-4894423646294599023" onmouseenter="enter('-4894423646294599023');" onmouseout="out('-4894423646294599023');" style=""> 318         if (sideTableInfo == null) {                                                                     </span>
<span class="450947362076537032" onmouseenter="enter('450947362076537032');" onmouseout="out('450947362076537032');" style=""> 319             throw new RuntimeException(&quot;can&#x27;t not find side table:&quot; + joinInfo.getRightTableName());     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320         }                                                                                                </span>
<span class="-1562873445908102884" onmouseenter="enter('-1562873445908102884');" onmouseout="out('-1562873445908102884');" style=""> 321         rightScopeChild.setRowTypeInfo(sideTableInfo.getRowTypeInfo());                                  </span>
<span class="76578225160811915" onmouseenter="enter('76578225160811915');" onmouseout="out('76578225160811915');" style=""> 322         rightScopeChild.setBaseRowTypeInfo(sideTableInfo.getBaseRowTypeInfo());                          </span>
<span class="-5776192160472100987" onmouseenter="enter('-5776192160472100987');" onmouseout="out('-5776192160472100987');" style=""> 323         joinScope.addScope(leftScopeChild);                                                              </span>
<span class="6805588345897841594" onmouseenter="enter('6805588345897841594');" onmouseout="out('6805588345897841594');" style=""> 324         joinScope.addScope(rightScopeChild);                                                             </span>
<span class="-119540861227224426" onmouseenter="enter('-119540861227224426');" onmouseout="out('-119540861227224426');" style=""> 325         HashBasedTable&lt;String, String, String&gt; mappingTable = ((JoinInfo) (pollObj)).getTableFieldRef(); </span>
<span class="-5693279157941758931" onmouseenter="enter('-5693279157941758931');" onmouseout="out('-5693279157941758931');" style=""> 326         // 获取两个表的所有字段                                                                                    </span>
<span class="-6198283029075022684" onmouseenter="enter('-6198283029075022684');" onmouseout="out('-6198283029075022684');" style=""><abbr title=" 327         List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), joinScope, true);"> 327         List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), join🔵</abbr></span>
<span class="-6461756025780522483" onmouseenter="enter('-6461756025780522483');" onmouseout="out('-6461756025780522483');" style=""> 328         // 通过join的查询字段信息过滤出需要的字段信息                                                                       </span>
<span class="483727955973627980" onmouseenter="enter('483727955973627980');" onmouseout="out('483727955973627980');" style=""><abbr title=" 329         sideJoinFieldInfo.removeIf(( tmpFieldInfo) -&gt; mappingTable.get(tmpFieldInfo.getTable(), tmpFieldInfo.getFieldName()) == null);"> 329         sideJoinFieldInfo.removeIf(( tmpFieldInfo) -&gt; mappingTable.get(tmpFieldInfo.getTable(), tmpFieldI🔵</abbr></span>
<span class="-1467815726997680818" onmouseenter="enter('-1467815726997680818');" onmouseout="out('-1467815726997680818');" style=""> 330         String leftTableAlias = joinInfo.getLeftTableAlias();                                            </span>
<span class="-6434853421912213287" onmouseenter="enter('-6434853421912213287');" onmouseout="out('-6434853421912213287');" style=""> 331         Table targetTable = localTableCache.get(leftTableAlias);                                         </span>
<span class="7125781324026312556" onmouseenter="enter('7125781324026312556');" onmouseout="out('7125781324026312556');" style=""> 332         if (targetTable == null) {                                                                       </span>
<span class="8734197217231436839" onmouseenter="enter('8734197217231436839');" onmouseout="out('8734197217231436839');" style=""> 333             targetTable = localTableCache.get(joinInfo.getLeftTableName());                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334         }                                                                                                </span>
<span class="-1157067725052643612" onmouseenter="enter('-1157067725052643612');" onmouseout="out('-1157067725052643612');" style=""><abbr title=" 335         RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getFieldTypes(), targetTable.getSchema().getFieldNames());"> 335         RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getFieldTypes(), targetTable.getSc🔵</abbr></span>
<span class="8331408572102109154" onmouseenter="enter('8331408572102109154');" onmouseout="out('8331408572102109154');" style=""> 336         DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; adaptStream = tableEnv.toRetractStream(targetTable, Row.class); </span>
<span class="-6082173173678345991" onmouseenter="enter('-6082173173678345991');" onmouseout="out('-6082173173678345991');" style=""> 337         //join side table before keyby ===&gt; Reducing the size of each dimension table cache of async     </span>
<span class="6301552848628110191" onmouseenter="enter('6301552848628110191');" onmouseout="out('6301552848628110191');" style=""> 338         if (sideTableInfo.isPartitionedJoin()) {                                                         </span>
<span class="-4638861421651181765" onmouseenter="enter('-4638861421651181765');" onmouseout="out('-4638861421651181765');" style=""><abbr title=" 339             List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTableAlias(), sideTableInfo);"> 339             List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTa🔵</abbr></span>
<span class="-1086375650130423707" onmouseenter="enter('-1086375650130423707');" onmouseout="out('-1086375650130423707');" style=""> 340             List&lt;String&gt; fieldNames = Arrays.asList(targetTable.getSchema().getFieldNames());            </span>
<span class="2517152886952033206" onmouseenter="enter('2517152886952033206');" onmouseout="out('2517152886952033206');" style=""> 341             int[] keyIndex = leftJoinColList.stream().mapToInt(fieldNames::indexOf).toArray();           </span>
<span class="-1034511431639552497" onmouseenter="enter('-1034511431639552497');" onmouseout="out('-1034511431639552497');" style=""><abbr title=" 342             adaptStream = adaptStream.keyBy(new TupleKeySelector(keyIndex, projectedTypeInfo(keyIndex, targetTable.getSchema())));"> 342             adaptStream = adaptStream.keyBy(new TupleKeySelector(keyIndex, projectedTypeInfo(keyIndex, ta🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 343         }                                                                                                </span>
<span class="8900898589811243168" onmouseenter="enter('8900898589811243168');" onmouseout="out('8900898589811243168');" style=""> 344         DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; dsOut = null;                                                   </span>
<span class="9130962490964334732" onmouseenter="enter('9130962490964334732');" onmouseout="out('9130962490964334732');" style=""> 345         if (ECacheType.ALL.name().equalsIgnoreCase(sideTableInfo.getCacheType())) {                      </span>
<span class="4800933198673881512" onmouseenter="enter('4800933198673881512');" onmouseout="out('4800933198673881512');" style=""><abbr title=" 346             dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo, pluginLoadMode);"> 346             dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), 🔵</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 347         } else {                                                                                         </span>
<span class="7407295138386527483" onmouseenter="enter('7407295138386527483');" onmouseout="out('7407295138386527483');" style=""><abbr title=" 348             dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo, pluginLoadMode);"> 348             dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSq🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349         }                                                                                                </span>
<span class="-7650178877830471821" onmouseenter="enter('-7650178877830471821');" onmouseout="out('-7650178877830471821');" style=""> 350         BaseRowTypeInfo sideOutTypeInfo = buildOutRowTypeInfo(sideJoinFieldInfo, mappingTable);          </span>
<span class="993314962060447081" onmouseenter="enter('993314962060447081');" onmouseout="out('993314962060447081');" style=""> 351         TupleTypeInfo tupleTypeInfo = new TupleTypeInfo(Types.BOOLEAN, sideOutTypeInfo);                 </span>
<span class="6600937869795732915" onmouseenter="enter('6600937869795732915');" onmouseout="out('6600937869795732915');" style=""> 352         dsOut.getTransformation().setOutputType(tupleTypeInfo);                                          </span>
<span class="4836712590888983064" onmouseenter="enter('4836712590888983064');" onmouseout="out('4836712590888983064');" style=""> 353         String targetTableName = joinInfo.getNewTableName();                                             </span>
<span class="-3094587764130774762" onmouseenter="enter('-3094587764130774762');" onmouseout="out('-3094587764130774762');" style=""> 354         String targetTableAlias = joinInfo.getNewTableAlias();                                           </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 355         FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                           </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 356         replaceInfo.setMappingTable(mappingTable);                                                       </span>
<span class="8710576405434192583" onmouseenter="enter('8710576405434192583');" onmouseout="out('8710576405434192583');" style=""> 357         replaceInfo.setTargetTableName(targetTableName);                                                 </span>
<span class="-6613112199475906839" onmouseenter="enter('-6613112199475906839');" onmouseout="out('-6613112199475906839');" style=""> 358         replaceInfo.setTargetTableAlias(targetTableAlias);                                               </span>
<span class="5015532225886683915" onmouseenter="enter('5015532225886683915');" onmouseout="out('5015532225886683915');" style=""><abbr title=" 359         ObjectIdentifier objectIdentifier = ObjectIdentifier.of(EnvironmentSettings.DEFAULT_BUILTIN_CATALOG, EnvironmentSettings.DEFAULT_BUILTIN_DATABASE, targetTableName);"> 359         ObjectIdentifier objectIdentifier = ObjectIdentifier.of(EnvironmentSettings.DEFAULT_BUILTIN_CATAL🔵</abbr></span>
<span class="5891773481881515301" onmouseenter="enter('5891773481881515301');" onmouseout="out('5891773481881515301');" style=""><abbr title=" 360         boolean tableExists = tableEnv.getCatalog(EnvironmentSettings.DEFAULT_BUILTIN_CATALOG).get().tableExists(objectIdentifier.toObjectPath());"> 360         boolean tableExists = tableEnv.getCatalog(EnvironmentSettings.DEFAULT_BUILTIN_CATALOG).get().tabl🔵</abbr></span>
<span class="1897990848761003813" onmouseenter="enter('1897990848761003813');" onmouseout="out('1897990848761003813');" style=""> 361         if (!tableExists) {                                                                              </span>
<span class="-9057257427162955657" onmouseenter="enter('-9057257427162955657');" onmouseout="out('-9057257427162955657');" style=""> 362             Table joinTable = tableEnv.fromDataStream(dsOut);                                            </span>
<span class="7656863459817986298" onmouseenter="enter('7656863459817986298');" onmouseout="out('7656863459817986298');" style=""> 363             tableEnv.createTemporaryView(targetTableName, joinTable);                                    </span>
<span class="5569875846259576593" onmouseenter="enter('5569875846259576593');" onmouseout="out('5569875846259576593');" style=""> 364             localTableCache.put(joinInfo.getNewTableName(), joinTable);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 365         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366     }                                                                                                    </span>
<span  style=""> 367                                                                                                          </span>
<span class="2503560481488678812" onmouseenter="enter('2503560481488678812');" onmouseout="out('2503560481488678812');" style=""> 368     private TypeInformation&lt;Row&gt; projectedTypeInfo(int[] fields, TableSchema schema) {                   </span>
<span class="-934325254904626531" onmouseenter="enter('-934325254904626531');" onmouseout="out('-934325254904626531');" style=""> 369         String[] fieldNames = schema.getFieldNames();                                                    </span>
<span class="4556717060829301814" onmouseenter="enter('4556717060829301814');" onmouseout="out('4556717060829301814');" style=""> 370         TypeInformation&lt;?&gt;[] fieldTypes = schema.getFieldTypes();                                        </span>
<span  style=""> 371                                                                                                          </span>
<span class="424178526470659793" onmouseenter="enter('424178526470659793');" onmouseout="out('424178526470659793');" style=""><abbr title=" 372         String[] projectedNames = Arrays.stream(fields).mapToObj(i -&gt; fieldNames[i]).toArray(String[]::new);"> 372         String[] projectedNames = Arrays.stream(fields).mapToObj(i -&gt; fieldNames[i]).toArray(String[]::ne🔵</abbr></span>
<span class="5411397013359382914" onmouseenter="enter('5411397013359382914');" onmouseout="out('5411397013359382914');" style=""><abbr title=" 373         TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(i -&gt; fieldTypes[i]).toArray(TypeInformation[]::new);"> 373         TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(i -&gt; fieldTypes[i]).toArray(Typ🔵</abbr></span>
<span class="-5627838059420262860" onmouseenter="enter('-5627838059420262860');" onmouseout="out('-5627838059420262860');" style=""> 374         return new RowTypeInfo(projectedTypes, projectedNames);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375     }                                                                                                    </span>
<span  style=""> 376                                                                                                          </span>
<span class="-410103274617159114" onmouseenter="enter('-410103274617159114');" onmouseout="out('-410103274617159114');" style=""> 377     private boolean checkFieldsInfo(CreateTmpTableParser.SqlParserResult result, Table table) {          </span>
<span class="8925867441251499081" onmouseenter="enter('8925867441251499081');" onmouseout="out('8925867441251499081');" style=""> 378         List&lt;String&gt; fieldNames = new LinkedList&lt;&gt;();                                                    </span>
<span class="-5553816012496774052" onmouseenter="enter('-5553816012496774052');" onmouseout="out('-5553816012496774052');" style=""> 379         String fieldsInfo = result.getFieldsInfoStr();                                                   </span>
<span class="-5855731071361337066" onmouseenter="enter('-5855731071361337066');" onmouseout="out('-5855731071361337066');" style=""> 380         String[] fields = StringUtils.split(fieldsInfo, &quot;,&quot;);                                            </span>
<span class="8167763809890058258" onmouseenter="enter('8167763809890058258');" onmouseout="out('8167763809890058258');" style=""> 381         for (int i = 0; i &lt; fields.length; i++) {                                                        </span>
<span class="2947314498030065040" onmouseenter="enter('2947314498030065040');" onmouseout="out('2947314498030065040');" style=""> 382             String[] filed = fields[i].split(&quot;\\s&quot;);                                                     </span>
<span class="5889723123831816710" onmouseenter="enter('5889723123831816710');" onmouseout="out('5889723123831816710');" style=""> 383             if (filed.length &lt; 2 || fields.length != table.getSchema().getFieldCount()){                 </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 384                 return false;                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 385             } else {                                                                                     </span>
<span class="-7518627407039835792" onmouseenter="enter('-7518627407039835792');" onmouseout="out('-7518627407039835792');" style=""> 386                 String[] filedNameArr = new String[filed.length - 1];                                    </span>
<span class="6064994574122217386" onmouseenter="enter('6064994574122217386');" onmouseout="out('6064994574122217386');" style=""> 387                 System.arraycopy(filed, 0, filedNameArr, 0, filed.length - 1);                           </span>
<span class="-3029457015937137256" onmouseenter="enter('-3029457015937137256');" onmouseout="out('-3029457015937137256');" style=""> 388                 String fieldName = String.join(&quot; &quot;, filedNameArr);                                       </span>
<span class="-8037943253867791720" onmouseenter="enter('-8037943253867791720');" onmouseout="out('-8037943253867791720');" style=""> 389                 fieldNames.add(fieldName);                                                               </span>
<span class="516386479555957316" onmouseenter="enter('516386479555957316');" onmouseout="out('516386479555957316');" style=""> 390                 String fieldType = filed[filed.length - 1 ].trim();                                      </span>
<span class="-8511761590344571010" onmouseenter="enter('-8511761590344571010');" onmouseout="out('-8511761590344571010');" style=""> 391                 Class fieldClass = ClassUtil.stringConvertClass(fieldType);                              </span>
<span class="-351203522969775469" onmouseenter="enter('-351203522969775469');" onmouseout="out('-351203522969775469');" style=""> 392                 Class tableField = table.getSchema().getFieldType(i).get().getTypeClass();               </span>
<span class="9126336856345087988" onmouseenter="enter('9126336856345087988');" onmouseout="out('9126336856345087988');" style=""> 393                 if (fieldClass == tableField){                                                           </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 394                     continue;                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 395                 } else {                                                                                 </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 396                     return false;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 397                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 398             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 399         }                                                                                                </span>
<span class="-7181802501759976675" onmouseenter="enter('-7181802501759976675');" onmouseout="out('-7181802501759976675');" style=""> 400         tmpFields = String.join(&quot;,&quot;, fieldNames);                                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 401         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403 }                                                                                                        </span>



















































































































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span  style="">  20                                                                                                                    </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  21  package com.dtstack.flink.sql.side;                                                                               </span>
<span  style="">  22                                                                                                                    </span>
<span class="-4869246525166490693" onmouseenter="enter('-4869246525166490693');" onmouseout="out('-4869246525166490693');" style="">  23  import org.apache.flink.api.common.typeinfo.TypeInformation;                                                      </span>
<span class="-5176867084763361213" onmouseenter="enter('-5176867084763361213');" onmouseout="out('-5176867084763361213');" style="">  24  import org.apache.flink.api.common.typeinfo.Types;                                                                </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  25  import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  26  import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                           </span>
<span class="-2654529550501634008" onmouseenter="enter('-2654529550501634008');" onmouseout="out('-2654529550501634008');" style="">  27  import org.apache.flink.api.java.typeutils.TupleTypeInfo;                                                         </span>
<span class="329774846923224587" onmouseenter="enter('329774846923224587');" onmouseout="out('329774846923224587');" style="">  28  import org.apache.flink.streaming.api.datastream.DataStream;                                                      </span>
<span class="7654739943616372616" onmouseenter="enter('7654739943616372616');" onmouseout="out('7654739943616372616');" style="">  29  import org.apache.flink.table.api.EnvironmentSettings;                                                            </span>
<span class="5165777186879784670" onmouseenter="enter('5165777186879784670');" onmouseout="out('5165777186879784670');" style="">  30  import org.apache.flink.table.api.Table;                                                                          </span>
<span class="-8888728238394280005" onmouseenter="enter('-8888728238394280005');" onmouseout="out('-8888728238394280005');" style="">  31  import org.apache.flink.table.api.TableSchema;                                                                    </span>
<span class="776922417053783834" onmouseenter="enter('776922417053783834');" onmouseout="out('776922417053783834');" style="">  32  import org.apache.flink.table.api.java.StreamTableEnvironment;                                                    </span>
<span class="785035026521613593" onmouseenter="enter('785035026521613593');" onmouseout="out('785035026521613593');" style="">  33  import org.apache.flink.table.api.java.internal.StreamTableEnvironmentImpl;                                       </span>
<span class="3778081928793243344" onmouseenter="enter('3778081928793243344');" onmouseout="out('3778081928793243344');" style="">  34  import org.apache.flink.table.catalog.CatalogManager;                                                             </span>
<span class="6625190898426831134" onmouseenter="enter('6625190898426831134');" onmouseout="out('6625190898426831134');" style="">  35  import org.apache.flink.table.catalog.ObjectIdentifier;                                                           </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="">  36  import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                                    </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  37  import org.apache.flink.types.Row;                                                                                </span>
<span  style="">  38                                                                                                                    </span>
<span class="8826438848011158297" onmouseenter="enter('8826438848011158297');" onmouseout="out('8826438848011158297');" style="">  39  import com.dtstack.flink.sql.enums.ECacheType;                                                                    </span>
<span class="1760694872476698727" onmouseenter="enter('1760694872476698727');" onmouseout="out('1760694872476698727');" style="">  40  import com.dtstack.flink.sql.exec.FlinkSQLExec;                                                                   </span>
<span class="2626775214998945029" onmouseenter="enter('2626775214998945029');" onmouseout="out('2626775214998945029');" style="">  41  import com.dtstack.flink.sql.parser.CreateTmpTableParser;                                                         </span>
<span class="7697893187981436175" onmouseenter="enter('7697893187981436175');" onmouseout="out('7697893187981436175');" style="">  42  import com.dtstack.flink.sql.side.operator.SideAsyncOperator;                                                     </span>
<span class="-7456990469468101750" onmouseenter="enter('-7456990469468101750');" onmouseout="out('-7456990469468101750');" style="">  43  import com.dtstack.flink.sql.side.operator.SideWithAllCacheOperator;                                              </span>
<span class="4874498590411064411" onmouseenter="enter('4874498590411064411');" onmouseout="out('4874498590411064411');" style="">  44  import com.dtstack.flink.sql.util.ClassUtil;                                                                      </span>
<span class="-4585055968129153397" onmouseenter="enter('-4585055968129153397');" onmouseout="out('-4585055968129153397');" style="">  45  import com.dtstack.flink.sql.util.ParseUtils;                                                                     </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  46  import com.dtstack.flink.sql.util.TableUtils;                                                                     </span>
<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  47  import com.google.common.base.Preconditions;                                                                      </span>
<span class="-5849322492369628764" onmouseenter="enter('-5849322492369628764');" onmouseout="out('-5849322492369628764');" style="">  48  import com.google.common.collect.HashBasedTable;                                                                  </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  49  import com.google.common.collect.Lists;                                                                           </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  50  import com.google.common.collect.Maps;                                                                            </span>
<span class="6390139568718476113" onmouseenter="enter('6390139568718476113');" onmouseout="out('6390139568718476113');" style="">  51  import com.google.common.collect.Sets;                                                                            </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  52  import org.apache.calcite.sql.SqlBasicCall;                                                                       </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  53  import org.apache.calcite.sql.SqlIdentifier;                                                                      </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  54  import org.apache.calcite.sql.SqlKind;                                                                            </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  55  import org.apache.calcite.sql.SqlNode;                                                                            </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  56  import org.apache.calcite.sql.SqlSelect;                                                                          </span>
<span class="9012576760183743580" onmouseenter="enter('9012576760183743580');" onmouseout="out('9012576760183743580');" style="">  57  import org.apache.calcite.sql.SqlWithItem;                                                                        </span>

<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="">  58  import org.apache.calcite.sql.parser.SqlParseException;                                                           </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  59  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  60  import org.apache.commons.lang3.StringUtils;                                                                      </span>















<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  61  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  62  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  63                                                                                                                    </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="">  64  import java.sql.Timestamp;                                                                                        </span>
<span class="-608398790767092657" onmouseenter="enter('-608398790767092657');" onmouseout="out('-608398790767092657');" style="">  65  import java.time.LocalDateTime;                                                                                   </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  66  import java.util.Arrays;                                                                                          </span>
<span class="2644117295780670879" onmouseenter="enter('2644117295780670879');" onmouseout="out('2644117295780670879');" style="">  67  import java.util.LinkedList;                                                                                      </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  68  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  69  import java.util.Map;                                                                                             </span>
<span class="-2789246819365843415" onmouseenter="enter('-2789246819365843415');" onmouseout="out('-2789246819365843415');" style="">  70  import java.util.Queue;                                                                                           </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  71  import java.util.Set;                                                                                             </span>

<span  style="">  72                                                                                                                    </span>
<span class="7147213704442467623" onmouseenter="enter('7147213704442467623');" onmouseout="out('7147213704442467623');" style="">  73  import static org.apache.calcite.sql.SqlKind.*;                                                                   </span>
<span  style="">  74                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  75  /**                                                                                                               </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  76   * Reason:                                                                                                        </span>
<span class="-6082749432478588798" onmouseenter="enter('-6082749432478588798');" onmouseout="out('-6082749432478588798');" style="">  77   * Date: 2018/7/24                                                                                                </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  78   * Company: www.dtstack.com                                                                                       </span>

<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  79   * @author xuchao                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  80   */                                                                                                               </span>
<span  style="">  81                                                                                                                    </span>
<span class="-5079038956292767116" onmouseenter="enter('-5079038956292767116');" onmouseout="out('-5079038956292767116');" style="">  82  public class SideSqlExec {                                                                                        </span>
<span  style="">  83                                                                                                                    </span>
<span class="-8991898280301588076" onmouseenter="enter('-8991898280301588076');" onmouseout="out('-8991898280301588076');" style="">  84      private static final Logger LOG = LoggerFactory.getLogger(SideSqlExec.class);                                 </span>
<span  style="">  85                                                                                                                    </span>
<span class="-6334022460956670337" onmouseenter="enter('-6334022460956670337');" onmouseout="out('-6334022460956670337');" style="">  86      private String localSqlPluginPath = null;                                                                     </span>
<span  style="">  87                                                                                                                    </span>
<span class="-863593709646632598" onmouseenter="enter('-863593709646632598');" onmouseout="out('-863593709646632598');" style="">  88      private String tmpFields = null;                                                                              </span>
<span  style="">  89                                                                                                                    </span>
<span class="2496130613254560337" onmouseenter="enter('2496130613254560337');" onmouseout="out('2496130613254560337');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  90 +    private String pluginLoadMode = null;                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  91 +                                                                                                                  </span>
<span class="8878309237265342483" onmouseenter="enter('8878309237265342483');" onmouseout="out('8878309237265342483');" style="">  92      private SidePredicatesParser sidePredicatesParser = new SidePredicatesParser();                               </span>
<span  style="">  93                                                                                                                    </span>
<span class="4175687380086503813" onmouseenter="enter('4175687380086503813');" onmouseout="out('4175687380086503813');" style="">  94      private Map&lt;String, Table&gt; localTableCache = Maps.newHashMap();                                               </span>
<span  style="">  95                                                                                                                    </span>
<span class="5235405798143461797" onmouseenter="enter('5235405798143461797');" onmouseout="out('5235405798143461797');" style="">  96      public void exec(String sql,                                                                                  </span>
<span class="-876340320175790120" onmouseenter="enter('-876340320175790120');" onmouseout="out('-876340320175790120');" style="">  97                       Map&lt;String, AbstractSideTableInfo&gt; sideTableMap,                                             </span>
<span class="4244108408582304218" onmouseenter="enter('4244108408582304218');" onmouseout="out('4244108408582304218');" style="">  98                       StreamTableEnvironment tableEnv,                                                             </span>
<span class="-1493383746124052329" onmouseenter="enter('-1493383746124052329');" onmouseout="out('-1493383746124052329');" style="">  99                       Map&lt;String, Table&gt; tableCache,                                                               </span>
<span class="-7862911349817835208" onmouseenter="enter('-7862911349817835208');" onmouseout="out('-7862911349817835208');" style=""> 100                       CreateTmpTableParser.SqlParserResult createView,                                             </span>
<span class="2986641263782067303" onmouseenter="enter('2986641263782067303');" onmouseout="out('2986641263782067303');" style=""> 101                       String scope) throws Exception {                                                             </span>
<span class="-7184346740499807144" onmouseenter="enter('-7184346740499807144');" onmouseout="out('-7184346740499807144');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 102 -        if(localSqlPluginPath == null){                                                                           </span>

<span class="4243357528698157424" onmouseenter="enter('4243357528698157424');" onmouseout="out('4243357528698157424');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 103 -            throw new RuntimeException(&quot;need to set localSqlPluginPath&quot;);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 104 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 105 -                                                                                                                  </span>
<span class="-6307578536739293325" onmouseenter="enter('-6307578536739293325');" onmouseout="out('-6307578536739293325');" style=""> 106          localTableCache.putAll(tableCache);                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 107          try {                                                                                                     </span>
<span class="-7778408363768085476" onmouseenter="enter('-7778408363768085476');" onmouseout="out('-7778408363768085476');" style=""> 108              sidePredicatesParser.fillPredicatesForSideTable(sql, sideTableMap);                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 109          } catch (Exception e) {                                                                                   </span>
<span class="-6535415982741029210" onmouseenter="enter('-6535415982741029210');" onmouseout="out('-6535415982741029210');" style=""> 110              LOG.error(&quot;fill predicates for sideTable fail &quot;, e);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111          }                                                                                                         </span>
<span  style=""> 112                                                                                                                    </span>
<span class="5869130575145188486" onmouseenter="enter('5869130575145188486');" onmouseout="out('5869130575145188486');" style=""> 113          if(createView != null){                                                                                   </span>

<span class="-5051922790285322929" onmouseenter="enter('-5051922790285322929');" onmouseout="out('-5051922790285322929');" style=""> 114              LOG.warn(&quot;create view info\n&quot;);                                                                       </span>
<span class="4994977519661454238" onmouseenter="enter('4994977519661454238');" onmouseout="out('4994977519661454238');" style=""> 115              LOG.warn(createView.getExecSql());                                                                    </span>
<span class="-6048507734051622776" onmouseenter="enter('-6048507734051622776');" onmouseout="out('-6048507734051622776');" style=""> 116              LOG.warn(&quot;-----------------&quot;);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117          }                                                                                                         </span>
<span  style=""> 118                                                                                                                    </span>
<span class="3272289589011229925" onmouseenter="enter('3272289589011229925');" onmouseout="out('3272289589011229925');" style=""> 119          SideSQLParser sideSQLParser = new SideSQLParser();                                                        </span>
<span class="9221221341975786732" onmouseenter="enter('9221221341975786732');" onmouseout="out('9221221341975786732');" style=""> 120          sideSQLParser.setLocalTableCache(localTableCache);                                                        </span>
<span class="6016193463712965966" onmouseenter="enter('6016193463712965966');" onmouseout="out('6016193463712965966');" style=""> 121          Queue&lt;Object&gt; exeQueue = sideSQLParser.getExeQueue(sql, sideTableMap.keySet(), scope);                    </span>
<span class="1917635497637273504" onmouseenter="enter('1917635497637273504');" onmouseout="out('1917635497637273504');" style=""> 122          Object pollObj = null;                                                                                    </span>
<span  style=""> 123                                                                                                                    </span>
<span class="6128441282435403378" onmouseenter="enter('6128441282435403378');" onmouseout="out('6128441282435403378');" style=""> 124          while((pollObj = exeQueue.poll()) != null){                                                               </span>
<span  style=""> 125                                                                                                                    </span>
<span class="138624831707193108" onmouseenter="enter('138624831707193108');" onmouseout="out('138624831707193108');" style=""> 126              if(pollObj instanceof SqlNode){                                                                       </span>



<span class="-8817010307772649906" onmouseenter="enter('-8817010307772649906');" onmouseout="out('-8817010307772649906');" style=""> 127                  SqlNode pollSqlNode = (SqlNode) pollObj;                                                          </span>
<span  style=""> 128                                                                                                                    </span>
<span  style=""> 129                                                                                                                    </span>
<span class="-2885719311179922220" onmouseenter="enter('-2885719311179922220');" onmouseout="out('-2885719311179922220');" style=""> 130                  if(pollSqlNode.getKind() == INSERT){                                                              </span>

<span class="4666335002906799727" onmouseenter="enter('4666335002906799727');" onmouseout="out('4666335002906799727');" style=""> 131                      FlinkSQLExec.sqlUpdate(tableEnv, pollSqlNode.toString());                                     </span>
<span class="3766255850891299565" onmouseenter="enter('3766255850891299565');" onmouseout="out('3766255850891299565');" style=""> 132                      if(LOG.isInfoEnabled()){                                                                      </span>

<span class="-5986232783970891998" onmouseenter="enter('-5986232783970891998');" onmouseout="out('-5986232783970891998');" style=""> 133                          LOG.info(&quot;----------real exec sql-----------\n{}&quot;, pollSqlNode.toString());               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134                      }                                                                                             </span>
<span  style=""> 135                                                                                                                    </span>
<span class="4666687505712980858" onmouseenter="enter('4666687505712980858');" onmouseout="out('4666687505712980858');" style=""> 136                  }else if(pollSqlNode.getKind() == AS){                                                            </span>

<span class="3037765200739894050" onmouseenter="enter('3037765200739894050');" onmouseout="out('3037765200739894050');" style=""> 137                      dealAsSourceTable(tableEnv, pollSqlNode, tableCache);                                         </span>
<span  style=""> 138                                                                                                                    </span>
<span class="4581342471671871622" onmouseenter="enter('4581342471671871622');" onmouseout="out('4581342471671871622');" style=""> 139                  } else if (pollSqlNode.getKind() == WITH_ITEM) {                                                  </span>
<span class="9089825500288046356" onmouseenter="enter('9089825500288046356');" onmouseout="out('9089825500288046356');" style=""> 140                      SqlWithItem sqlWithItem = (SqlWithItem) pollSqlNode;                                          </span>
<span class="-7674640876687845363" onmouseenter="enter('-7674640876687845363');" onmouseout="out('-7674640876687845363');" style=""> 141                      String TableAlias = sqlWithItem.name.toString();                                              </span>
<span class="2573668668184904794" onmouseenter="enter('2573668668184904794');" onmouseout="out('2573668668184904794');" style=""> 142                      Table table = tableEnv.sqlQuery(sqlWithItem.query.toString());                                </span>
<span class="2341577843786962651" onmouseenter="enter('2341577843786962651');" onmouseout="out('2341577843786962651');" style=""> 143                      tableEnv.registerTable(TableAlias, table);                                                    </span>
<span  style=""> 144                                                                                                                    </span>
<span class="-8892059869421071039" onmouseenter="enter('-8892059869421071039');" onmouseout="out('-8892059869421071039');" style=""> 145                  } else if (pollSqlNode.getKind() == SELECT){                                                      </span>

<span class="-1344441018307209750" onmouseenter="enter('-1344441018307209750');" onmouseout="out('-1344441018307209750');" style=""> 146                      Preconditions.checkState(createView != null, &quot;select sql must included by create view&quot;);      </span>
<span class="1694293925390283740" onmouseenter="enter('1694293925390283740');" onmouseout="out('1694293925390283740');" style=""> 147                      Table table = tableEnv.sqlQuery(pollObj.toString());                                          </span>
<span  style=""> 148                                                                                                                    </span>
<span class="-5832165917407529739" onmouseenter="enter('-5832165917407529739');" onmouseout="out('-5832165917407529739');" style=""> 149                      if (createView.getFieldsInfoStr() == null){                                                   </span>

<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 150                          tableEnv.registerTable(createView.getTableName(), table);                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 151                      } else {                                                                                      </span>
<span class="5288384657559945705" onmouseenter="enter('5288384657559945705');" onmouseout="out('5288384657559945705');" style=""> 152                          if (checkFieldsInfo(createView, table)){                                                  </span>

<span class="-9109211084540213069" onmouseenter="enter('-9109211084540213069');" onmouseout="out('-9109211084540213069');" style=""> 153                              table = table.as(tmpFields);                                                          </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 154                              tableEnv.registerTable(createView.getTableName(), table);                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 155                          } else {                                                                                  </span>
<span class="-4180003952862210397" onmouseenter="enter('-4180003952862210397');" onmouseout="out('-4180003952862210397');" style=""> 156                              throw new RuntimeException(&quot;Fields mismatch&quot;);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158                      }                                                                                             </span>
<span  style=""> 159                                                                                                                    </span>
<span class="-5831701022468144749" onmouseenter="enter('-5831701022468144749');" onmouseout="out('-5831701022468144749');" style=""> 160                      localTableCache.put(createView.getTableName(), table);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161                  }                                                                                                 </span>
<span  style=""> 162                                                                                                                    </span>
<span class="2267959141426380188" onmouseenter="enter('2267959141426380188');" onmouseout="out('2267959141426380188');" style=""> 163              }else if (pollObj instanceof JoinInfo){                                                               </span>

<span class="-6196622619540139248" onmouseenter="enter('-6196622619540139248');" onmouseout="out('-6196622619540139248');" style=""> 164                  LOG.info(&quot;----------exec join info----------\n{}&quot;, pollObj.toString());                           </span>
<span class="-3518617829078174884" onmouseenter="enter('-3518617829078174884');" onmouseout="out('-3518617829078174884');" style=""> 165                  joinFun(pollObj, localTableCache, sideTableMap, tableEnv);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167          }                                                                                                         </span>
<span  style=""> 168                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169      }                                                                                                             </span>
<span  style=""> 170                                                                                                                    </span>
<span  style=""> 171                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 172      /**                                                                                                           </span>
<span class="-7226459799151937672" onmouseenter="enter('-7226459799151937672');" onmouseout="out('-7226459799151937672');" style=""> 173       * 解析出as查询的表和字段的关系                                                                                            </span>

<span class="-4711911052088894915" onmouseenter="enter('-4711911052088894915');" onmouseout="out('-4711911052088894915');" style=""> 174       * @param asSqlNode                                                                                           </span>
<span class="-8172984871762282794" onmouseenter="enter('-8172984871762282794');" onmouseout="out('-8172984871762282794');" style=""> 175       * @param tableCache                                                                                          </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 176       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 177       */                                                                                                           </span>
<span class="-8315666616430025383" onmouseenter="enter('-8315666616430025383');" onmouseout="out('-8315666616430025383');" style=""> 178      private FieldReplaceInfo parseAsQuery(SqlBasicCall asSqlNode, Map&lt;String, Table&gt; tableCache){                 </span>

<span class="-4950849472737015743" onmouseenter="enter('-4950849472737015743');" onmouseout="out('-4950849472737015743');" style=""> 179          SqlNode info = asSqlNode.getOperands()[0];                                                                </span>
<span class="-6049998703041327008" onmouseenter="enter('-6049998703041327008');" onmouseout="out('-6049998703041327008');" style=""> 180          SqlNode alias = asSqlNode.getOperands()[1];                                                               </span>
<span  style=""> 181                                                                                                                    </span>
<span class="6169254144825097648" onmouseenter="enter('6169254144825097648');" onmouseout="out('6169254144825097648');" style=""> 182          SqlKind infoKind = info.getKind();                                                                        </span>
<span class="-8998816044463313680" onmouseenter="enter('-8998816044463313680');" onmouseout="out('-8998816044463313680');" style=""> 183          if(infoKind != SELECT){                                                                                   </span>

<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 184              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185          }                                                                                                         </span>
<span  style=""> 186                                                                                                                    </span>
<span class="1448651332248375248" onmouseenter="enter('1448651332248375248');" onmouseout="out('1448651332248375248');" style=""> 187          List&lt;FieldInfo&gt; extractFieldList = TableUtils.parserSelectField((SqlSelect) info, tableCache);            </span>
<span  style=""> 188                                                                                                                    </span>
<span class="-3840015462696951757" onmouseenter="enter('-3840015462696951757');" onmouseout="out('-3840015462696951757');" style=""> 189          HashBasedTable&lt;String, String, String&gt; mappingTable = HashBasedTable.create();                            </span>
<span class="-5476396715494077219" onmouseenter="enter('-5476396715494077219');" onmouseout="out('-5476396715494077219');" style=""> 190          for (FieldInfo fieldInfo : extractFieldList) {                                                            </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 191              String tableName = fieldInfo.getTable();                                                              </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 192              String fieldName = fieldInfo.getFieldName();                                                          </span>
<span class="4185539436596522295" onmouseenter="enter('4185539436596522295');" onmouseout="out('4185539436596522295');" style=""> 193              String mappingFieldName = ParseUtils.dealDuplicateFieldName(mappingTable, fieldName);                 </span>
<span class="-7827879044056282695" onmouseenter="enter('-7827879044056282695');" onmouseout="out('-7827879044056282695');" style=""> 194              mappingTable.put(tableName, fieldName, mappingFieldName);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195          }                                                                                                         </span>
<span  style=""> 196                                                                                                                    </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 197          FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                                    </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 198          replaceInfo.setMappingTable(mappingTable);                                                                </span>
<span class="9115675088981905484" onmouseenter="enter('9115675088981905484');" onmouseout="out('9115675088981905484');" style=""> 199          replaceInfo.setTargetTableName(alias.toString());                                                         </span>
<span class="-6295883374697236710" onmouseenter="enter('-6295883374697236710');" onmouseout="out('-6295883374697236710');" style=""> 200          replaceInfo.setTargetTableAlias(alias.toString());                                                        </span>
<span class="2754859294214862032" onmouseenter="enter('2754859294214862032');" onmouseout="out('2754859294214862032');" style=""> 201          return replaceInfo;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202      }                                                                                                             </span>
<span  style=""> 203                                                                                                                    </span>
<span  style=""> 204                                                                                                                    </span>
<span class="73834954090191073" onmouseenter="enter('73834954090191073');" onmouseout="out('73834954090191073');" style=""> 205      public AliasInfo parseASNode(SqlNode sqlNode) throws SqlParseException {                                      </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 206          SqlKind sqlKind = sqlNode.getKind();                                                                      </span>
<span class="3363188275491767702" onmouseenter="enter('3363188275491767702');" onmouseout="out('3363188275491767702');" style=""> 207          if(sqlKind != AS){                                                                                        </span>

<span class="1088430228081547460" onmouseenter="enter('1088430228081547460');" onmouseout="out('1088430228081547460');" style=""> 208              throw new RuntimeException(sqlNode + &quot; is not &#x27;as&#x27; operator&quot;);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209          }                                                                                                         </span>
<span  style=""> 210                                                                                                                    </span>
<span class="-4085054753182131209" onmouseenter="enter('-4085054753182131209');" onmouseout="out('-4085054753182131209');" style=""> 211          SqlNode info = ((SqlBasicCall)sqlNode).getOperands()[0];                                                  </span>

<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style=""> 212          SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                                                </span>
<span  style=""> 213                                                                                                                    </span>
<span class="-2458625767668584085" onmouseenter="enter('-2458625767668584085');" onmouseout="out('-2458625767668584085');" style=""> 214          AliasInfo aliasInfo = new AliasInfo();                                                                    </span>
<span class="-5109084571101185803" onmouseenter="enter('-5109084571101185803');" onmouseout="out('-5109084571101185803');" style=""> 215          aliasInfo.setName(info.toString());                                                                       </span>
<span class="-6584143955119724642" onmouseenter="enter('-6584143955119724642');" onmouseout="out('-6584143955119724642');" style=""> 216          aliasInfo.setAlias(alias.toString());                                                                     </span>
<span  style=""> 217                                                                                                                    </span>
<span class="-3107000398971930583" onmouseenter="enter('-3107000398971930583');" onmouseout="out('-3107000398971930583');" style=""> 218          return aliasInfo;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219      }                                                                                                             </span>
<span  style=""> 220                                                                                                                    </span>
<span class="4707165697759746048" onmouseenter="enter('4707165697759746048');" onmouseout="out('4707165697759746048');" style=""> 221      public RowTypeInfo buildOutRowTypeInfo(List&lt;FieldInfo&gt; sideJoinFieldInfo,                                     </span>
<span class="244517366126553103" onmouseenter="enter('244517366126553103');" onmouseout="out('244517366126553103');" style=""> 222                                             HashBasedTable&lt;String, String, String&gt; mappingTable) {                 </span>
<span class="-3566414926414695948" onmouseenter="enter('-3566414926414695948');" onmouseout="out('-3566414926414695948');" style=""> 223          TypeInformation[] sideOutTypes = new TypeInformation[sideJoinFieldInfo.size()];                           </span>




<span class="-637166731779412769" onmouseenter="enter('-637166731779412769');" onmouseout="out('-637166731779412769');" style=""> 224          String[] sideOutNames = new String[sideJoinFieldInfo.size()];                                             </span>
<span class="7438730024850909889" onmouseenter="enter('7438730024850909889');" onmouseout="out('7438730024850909889');" style=""> 225          for (int i = 0; i &lt; sideJoinFieldInfo.size(); i++) {                                                      </span>
<span class="2207877773063469724" onmouseenter="enter('2207877773063469724');" onmouseout="out('2207877773063469724');" style=""> 226              FieldInfo fieldInfo = sideJoinFieldInfo.get(i);                                                       </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 227              String tableName = fieldInfo.getTable();                                                              </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 228              String fieldName = fieldInfo.getFieldName();                                                          </span>
<span  style=""> 229                                                                                                                    </span>
<span class="3640983111807923268" onmouseenter="enter('3640983111807923268');" onmouseout="out('3640983111807923268');" style=""> 230              String mappingFieldName = mappingTable.get(tableName, fieldName);                                     </span>
<span class="-4165873345254348507" onmouseenter="enter('-4165873345254348507');" onmouseout="out('-4165873345254348507');" style=""><abbr title=" 231              Preconditions.checkNotNull(mappingFieldName, fieldInfo + &quot; not mapping any field! it may be frame bug&quot;);"> 231              Preconditions.checkNotNull(mappingFieldName, fieldInfo + &quot; not mapping any field! it may be frame bug&quot;🔵</abbr></span>
<span  style=""> 232                                                                                                                    </span>
<span class="4913645198555706594" onmouseenter="enter('4913645198555706594');" onmouseout="out('4913645198555706594');" style=""> 233              sideOutTypes[i] = fieldInfo.getTypeInformation();                                                     </span>

<span class="6276485717663783154" onmouseenter="enter('6276485717663783154');" onmouseout="out('6276485717663783154');" style=""> 234              sideOutNames[i] = mappingFieldName;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235          }                                                                                                         </span>
<span class="2691939759498133513" onmouseenter="enter('2691939759498133513');" onmouseout="out('2691939759498133513');" style=""> 236          return new RowTypeInfo(sideOutTypes, sideOutNames);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237      }                                                                                                             </span>
<span  style=""> 238                                                                                                                    </span>


<span  style=""> 239                                                                                                                    </span>
<span  style=""> 240                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 241      /**                                                                                                           </span>
<span class="4027944609056411189" onmouseenter="enter('4027944609056411189');" onmouseout="out('4027944609056411189');" style=""> 242       *  对时间类型进行类型转换                                                                                               </span>


<span class="-7981851073621455488" onmouseenter="enter('-7981851073621455488');" onmouseout="out('-7981851073621455488');" style=""> 243       * @param leftTypeInfo                                                                                        </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 244       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 245       */                                                                                                           </span>
<span class="109255438874014135" onmouseenter="enter('109255438874014135');" onmouseout="out('109255438874014135');" style=""> 246      private RowTypeInfo buildLeftTableOutType(RowTypeInfo leftTypeInfo) {                                         </span>
<span class="5269317691380571116" onmouseenter="enter('5269317691380571116');" onmouseout="out('5269317691380571116');" style=""> 247          TypeInformation[] sideOutTypes = new TypeInformation[leftTypeInfo.getFieldNames().length];                </span>
<span class="357447233987634249" onmouseenter="enter('357447233987634249');" onmouseout="out('357447233987634249');" style=""> 248          TypeInformation&lt;?&gt;[] fieldTypes = leftTypeInfo.getFieldTypes();                                           </span>
<span class="-7313385440196867180" onmouseenter="enter('-7313385440196867180');" onmouseout="out('-7313385440196867180');" style=""> 249          for (int i = 0; i &lt; sideOutTypes.length; i++) {                                                           </span>
<span class="-314833607359598646" onmouseenter="enter('-314833607359598646');" onmouseout="out('-314833607359598646');" style=""> 250              sideOutTypes[i] = convertTimeAttributeType(fieldTypes[i]);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251          }                                                                                                         </span>
<span class="-6446480870466684625" onmouseenter="enter('-6446480870466684625');" onmouseout="out('-6446480870466684625');" style=""> 252          RowTypeInfo rowTypeInfo = new RowTypeInfo(sideOutTypes, leftTypeInfo.getFieldNames());                    </span>
<span class="6189116692514123920" onmouseenter="enter('6189116692514123920');" onmouseout="out('6189116692514123920');" style=""> 253          return rowTypeInfo;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254      }                                                                                                             </span>
<span  style=""> 255                                                                                                                    </span>
<span class="2471506251995792847" onmouseenter="enter('2471506251995792847');" onmouseout="out('2471506251995792847');" style=""> 256      private TypeInformation convertTimeAttributeType(TypeInformation typeInformation) {                           </span>
<span class="2997926285576198837" onmouseenter="enter('2997926285576198837');" onmouseout="out('2997926285576198837');" style=""> 257          if (typeInformation instanceof TimeIndicatorTypeInfo) {                                                   </span>
<span class="-4699013589387269243" onmouseenter="enter('-4699013589387269243');" onmouseout="out('-4699013589387269243');" style=""> 258              return TypeInformation.of(LocalDateTime.class);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259          }                                                                                                         </span>
<span class="6871348106862514693" onmouseenter="enter('6871348106862514693');" onmouseout="out('6871348106862514693');" style=""> 260          return typeInformation;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261      }                                                                                                             </span>
<span  style=""> 262                                                                                                                    </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 263 -                                                                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 264 -                                                                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 265 -                                                                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 266 -                                                                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 267 -                                                                                                                  </span>
<span class="-6722855011181273565" onmouseenter="enter('-6722855011181273565');" onmouseout="out('-6722855011181273565');" style=""> 268      public void setLocalSqlPluginPath(String localSqlPluginPath) {                                                </span>
<span class="6258662942576926140" onmouseenter="enter('6258662942576926140');" onmouseout="out('6258662942576926140');" style=""> 269          this.localSqlPluginPath = localSqlPluginPath;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 270 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 271 +                                                                                                                  </span>
<span class="6639781197811189198" onmouseenter="enter('6639781197811189198');" onmouseout="out('6639781197811189198');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 272 +    public void setPluginLoadMode(String pluginLoadMode) {                                                        </span>
<span class="1051014760706894364" onmouseenter="enter('1051014760706894364');" onmouseout="out('1051014760706894364');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 273 +        this.pluginLoadMode = pluginLoadMode;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274      }                                                                                                             </span>
<span  style=""> 275                                                                                                                    </span>
<span class="2277905399441322839" onmouseenter="enter('2277905399441322839');" onmouseout="out('2277905399441322839');" style=""> 276      private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableName){     </span>

<span class="-6301156236825066460" onmouseenter="enter('-6301156236825066460');" onmouseout="out('-6301156236825066460');" style=""> 277          Table table = localTableCache.get(tableAlias);                                                            </span>
<span class="2042916935617835771" onmouseenter="enter('2042916935617835771');" onmouseout="out('2042916935617835771');" style=""> 278          if(table == null){                                                                                        </span>

<span class="-5960895848666330323" onmouseenter="enter('-5960895848666330323');" onmouseout="out('-5960895848666330323');" style=""> 279              table = localTableCache.get(tableName);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280          }                                                                                                         </span>
<span  style=""> 281                                                                                                                    </span>
<span class="2042916935617835771" onmouseenter="enter('2042916935617835771');" onmouseout="out('2042916935617835771');" style=""> 282          if(table == null){                                                                                        </span>

<span class="4627225224916806199" onmouseenter="enter('4627225224916806199');" onmouseout="out('4627225224916806199');" style=""> 283              throw new RuntimeException(&quot;not register table &quot; + tableAlias);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284          }                                                                                                         </span>
<span  style=""> 285                                                                                                                    </span>
<span class="-6017334383208509278" onmouseenter="enter('-6017334383208509278');" onmouseout="out('-6017334383208509278');" style=""> 286          return table;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287      }                                                                                                             </span>
<span  style=""> 288                                                                                                                    </span>
<span  style=""> 289                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 290      /**                                                                                                           </span>
<span class="5196638318686351881" onmouseenter="enter('5196638318686351881');" onmouseout="out('5196638318686351881');" style=""><abbr title=" 291       * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., dimension table is the primary key definition"> 291       * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., dimension 🔵</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 292       *                                                                                                            </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 293       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 294       */                                                                                                           </span>
<span class="4488554625343324946" onmouseenter="enter('4488554625343324946');" onmouseout="out('4488554625343324946');" style=""><abbr title=" 295      private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInfo sideTableInfo) {"> 295      private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInfo sideTab🔵</abbr></span>
<span class="-6710736308674703771" onmouseenter="enter('-6710736308674703771');" onmouseout="out('-6710736308674703771');" style=""> 296          List&lt;String&gt; conditionFields = getConditionFields(conditionNode, sideTableAlias, sideTableInfo);          </span>
<span class="-3924194481322428470" onmouseenter="enter('-3924194481322428470');" onmouseout="out('-3924194481322428470');" style=""> 297          if(CollectionUtils.isEqualCollection(conditionFields, convertPrimaryAlias(sideTableInfo))){               </span>

<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 298              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299          }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 300          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301      }                                                                                                             </span>
<span  style=""> 302                                                                                                                    </span>
<span class="572998504046101497" onmouseenter="enter('572998504046101497');" onmouseout="out('572998504046101497');" style=""> 303      private List&lt;String&gt; convertPrimaryAlias(AbstractSideTableInfo sideTableInfo) {                               </span>
<span class="-6700733268022775520" onmouseenter="enter('-6700733268022775520');" onmouseout="out('-6700733268022775520');" style=""> 304          List&lt;String&gt; res = Lists.newArrayList();                                                                  </span>
<span class="-1517278133900331130" onmouseenter="enter('-1517278133900331130');" onmouseout="out('-1517278133900331130');" style=""> 305          sideTableInfo.getPrimaryKeys().forEach(field -&gt; {                                                         </span>
<span class="2991641550935988694" onmouseenter="enter('2991641550935988694');" onmouseout="out('2991641550935988694');" style=""> 306              res.add(sideTableInfo.getPhysicalFields().getOrDefault(field, field));                                </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 307          });                                                                                                       </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 308          return res;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309      }                                                                                                             </span>
<span  style=""> 310                                                                                                                    </span>
<span class="-958139939083183834" onmouseenter="enter('-958139939083183834');" onmouseout="out('-958139939083183834');" style=""><abbr title=" 311      public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTableInfo sideTableInfo){"> 311      public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTableInfo s🔵</abbr></span>

<span class="-5667062641477778387" onmouseenter="enter('-5667062641477778387');" onmouseout="out('-5667062641477778387');" style=""> 312          List&lt;SqlNode&gt; sqlNodeList = Lists.newArrayList();                                                         </span>
<span class="5003747983397221043" onmouseenter="enter('5003747983397221043');" onmouseout="out('5003747983397221043');" style=""> 313          ParseUtils.parseAnd(conditionNode, sqlNodeList);                                                          </span>
<span class="331902561671078290" onmouseenter="enter('331902561671078290');" onmouseout="out('331902561671078290');" style=""> 314          List&lt;String&gt; conditionFields = Lists.newArrayList();                                                      </span>
<span class="-2336842894952786561" onmouseenter="enter('-2336842894952786561');" onmouseout="out('-2336842894952786561');" style=""> 315          for(SqlNode sqlNode : sqlNodeList){                                                                       </span>

<span class="-1235221313035004193" onmouseenter="enter('-1235221313035004193');" onmouseout="out('-1235221313035004193');" style=""> 316              if (!SqlKind.COMPARISON.contains(sqlNode.getKind())) {                                                </span>
<span class="4238811186041433324" onmouseenter="enter('4238811186041433324');" onmouseout="out('4238811186041433324');" style=""> 317                  throw new RuntimeException(&quot;not compare operator.&quot;);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318              }                                                                                                     </span>
<span  style=""> 319                                                                                                                    </span>
<span class="-7359051973666627295" onmouseenter="enter('-7359051973666627295');" onmouseout="out('-7359051973666627295');" style=""> 320              SqlIdentifier left = (SqlIdentifier)((SqlBasicCall)sqlNode).getOperands()[0];                         </span>
<span class="3465298874779506196" onmouseenter="enter('3465298874779506196');" onmouseout="out('3465298874779506196');" style=""> 321              SqlIdentifier right = (SqlIdentifier)((SqlBasicCall)sqlNode).getOperands()[1];                        </span>


<span  style=""> 322                                                                                                                    </span>
<span class="-2670749344655178863" onmouseenter="enter('-2670749344655178863');" onmouseout="out('-2670749344655178863');" style=""> 323              String leftTableName = left.getComponent(0).getSimple();                                              </span>
<span class="5188110590184041827" onmouseenter="enter('5188110590184041827');" onmouseout="out('5188110590184041827');" style=""> 324              String rightTableName = right.getComponent(0).getSimple();                                            </span>
<span  style=""> 325                                                                                                                    </span>
<span class="8082853509369418918" onmouseenter="enter('8082853509369418918');" onmouseout="out('8082853509369418918');" style=""> 326              String tableCol = &quot;&quot;;                                                                                 </span>
<span class="3869855333927982135" onmouseenter="enter('3869855333927982135');" onmouseout="out('3869855333927982135');" style=""> 327              if(leftTableName.equalsIgnoreCase(specifyTableName)){                                                 </span>

<span class="4527748628163402760" onmouseenter="enter('4527748628163402760');" onmouseout="out('4527748628163402760');" style=""> 328                  tableCol = left.getComponent(1).getSimple();                                                      </span>
<span class="5068195286258055415" onmouseenter="enter('5068195286258055415');" onmouseout="out('5068195286258055415');" style=""> 329              }else if(rightTableName.equalsIgnoreCase(specifyTableName)){                                          </span>

<span class="4462633703217831544" onmouseenter="enter('4462633703217831544');" onmouseout="out('4462633703217831544');" style=""> 330                  tableCol = right.getComponent(1).getSimple();                                                     </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 331              }else{                                                                                                </span>

<span class="3783543445731730404" onmouseenter="enter('3783543445731730404');" onmouseout="out('3783543445731730404');" style=""><abbr title=" 332                  throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specifyTableName));"> 332                  throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specifyTableName🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 333              }                                                                                                     </span>
<span class="-2325401555704525047" onmouseenter="enter('-2325401555704525047');" onmouseout="out('-2325401555704525047');" style=""> 334              tableCol = sideTableInfo.getPhysicalFields().getOrDefault(tableCol, tableCol);                        </span>
<span class="-4552234441929070616" onmouseenter="enter('-4552234441929070616');" onmouseout="out('-4552234441929070616');" style=""> 335              conditionFields.add(tableCol);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336          }                                                                                                         </span>
<span  style=""> 337                                                                                                                    </span>
<span class="4950082808497882460" onmouseenter="enter('4950082808497882460');" onmouseout="out('4950082808497882460');" style=""> 338          return conditionFields;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339      }                                                                                                             </span>
<span  style=""> 340                                                                                                                    </span>
<span class="-8173208587282838964" onmouseenter="enter('-8173208587282838964');" onmouseout="out('-8173208587282838964');" style=""> 341      protected void dealAsSourceTable(StreamTableEnvironment tableEnv,                                             </span>
<span class="9126592535894268017" onmouseenter="enter('9126592535894268017');" onmouseout="out('9126592535894268017');" style=""> 342                                       SqlNode pollSqlNode,                                                         </span>
<span class="-4636178628928660306" onmouseenter="enter('-4636178628928660306');" onmouseout="out('-4636178628928660306');" style=""> 343                                       Map&lt;String, Table&gt; tableCache) throws SqlParseException {                    </span>
<span  style=""> 344                                                                                                                    </span>
<span class="-7364020242551640527" onmouseenter="enter('-7364020242551640527');" onmouseout="out('-7364020242551640527');" style=""> 345          AliasInfo aliasInfo = parseASNode(pollSqlNode);                                                           </span>
<span class="2461088292100865778" onmouseenter="enter('2461088292100865778');" onmouseout="out('2461088292100865778');" style=""> 346          if (localTableCache.containsKey(aliasInfo.getName())) {                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 347              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 348          }                                                                                                         </span>
<span  style=""> 349                                                                                                                    </span>
<span class="-3390660419579622283" onmouseenter="enter('-3390660419579622283');" onmouseout="out('-3390660419579622283');" style=""> 350          Table table = tableEnv.sqlQuery(aliasInfo.getName());                                                     </span>
<span class="5901087968051131557" onmouseenter="enter('5901087968051131557');" onmouseout="out('5901087968051131557');" style=""> 351          tableEnv.registerTable(aliasInfo.getAlias(), table);                                                      </span>
<span class="1100939894023116874" onmouseenter="enter('1100939894023116874');" onmouseout="out('1100939894023116874');" style=""> 352          localTableCache.put(aliasInfo.getAlias(), table);                                                         </span>
<span  style=""> 353                                                                                                                    </span>
<span class="7353361537117728269" onmouseenter="enter('7353361537117728269');" onmouseout="out('7353361537117728269');" style=""> 354          LOG.info(&quot;Register Table {} by {}&quot;, aliasInfo.getAlias(), aliasInfo.getName());                           </span>
<span  style=""> 355                                                                                                                    </span>
<span class="-8665165690117838262" onmouseenter="enter('-8665165690117838262');" onmouseout="out('-8665165690117838262');" style=""> 356          FieldReplaceInfo fieldReplaceInfo = parseAsQuery((SqlBasicCall) pollSqlNode, tableCache);                 </span>
<span class="-7633956211129533821" onmouseenter="enter('-7633956211129533821');" onmouseout="out('-7633956211129533821');" style=""> 357          if(fieldReplaceInfo == null){                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 358             return;                                                                                                </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 359          }                                                                                                         </span>
<span  style=""> 360                                                                                                                    </span>
<span class="-6438671410831308886" onmouseenter="enter('-6438671410831308886');" onmouseout="out('-6438671410831308886');" style=""> 361          //as 的源表                                                                                                  </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 362          Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                         </span>
<span class="-1390965398492412473" onmouseenter="enter('-1390965398492412473');" onmouseout="out('-1390965398492412473');" style=""> 363          SqlNode fromNode = ((SqlBasicCall)pollSqlNode).getOperands()[0];                                          </span>

<span class="8218826531385538687" onmouseenter="enter('8218826531385538687');" onmouseout="out('8218826531385538687');" style=""> 364          TableUtils.getFromTableInfo(fromNode, fromTableNameSet);                                                  </span>
<span  style=""> 365                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366      }                                                                                                             </span>
<span  style=""> 367                                                                                                                    </span>
<span class="-894097875121841059" onmouseenter="enter('-894097875121841059');" onmouseout="out('-894097875121841059');" style=""> 368      private void joinFun(Object pollObj,                                                                          </span>
<span class="6823594550750748067" onmouseenter="enter('6823594550750748067');" onmouseout="out('6823594550750748067');" style=""> 369                           Map&lt;String, Table&gt; localTableCache,                                                      </span>
<span class="-876340320175790120" onmouseenter="enter('-876340320175790120');" onmouseout="out('-876340320175790120');" style=""> 370                           Map&lt;String, AbstractSideTableInfo&gt; sideTableMap,                                         </span>
<span class="-1170693753985315194" onmouseenter="enter('-1170693753985315194');" onmouseout="out('-1170693753985315194');" style=""> 371                           StreamTableEnvironment tableEnv) throws Exception{                                       </span>

<span class="-3106951960183426296" onmouseenter="enter('-3106951960183426296');" onmouseout="out('-3106951960183426296');" style=""> 372          JoinInfo joinInfo = (JoinInfo) pollObj;                                                                   </span>
<span  style=""> 373                                                                                                                    </span>
<span class="-4580559439294190862" onmouseenter="enter('-4580559439294190862');" onmouseout="out('-4580559439294190862');" style=""> 374          JoinScope joinScope = new JoinScope();                                                                    </span>
<span class="-6383140859888654083" onmouseenter="enter('-6383140859888654083');" onmouseout="out('-6383140859888654083');" style=""> 375          JoinScope.ScopeChild leftScopeChild = new JoinScope.ScopeChild();                                         </span>
<span class="-5401707331330951256" onmouseenter="enter('-5401707331330951256');" onmouseout="out('-5401707331330951256');" style=""> 376          leftScopeChild.setAlias(joinInfo.getLeftTableAlias());                                                    </span>
<span class="5108424867732442426" onmouseenter="enter('5108424867732442426');" onmouseout="out('5108424867732442426');" style=""> 377          leftScopeChild.setTableName(joinInfo.getLeftTableName());                                                 </span>
<span  style=""> 378                                                                                                                    </span>
<span class="-2402361542513321069" onmouseenter="enter('-2402361542513321069');" onmouseout="out('-2402361542513321069');" style=""><abbr title=" 379          Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLeftTableName());"> 379          Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLeftTableNa🔵</abbr></span>
<span  style=""> 380                                                                                                                    </span>
<span class="-6003115091233455661" onmouseenter="enter('-6003115091233455661');" onmouseout="out('-6003115091233455661');" style=""><abbr title=" 381          RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getFieldTypes(), leftTable.getSchema().getFieldNames());"> 381          RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getFieldTypes(), leftTable.getSchema().ge🔵</abbr></span>









<span class="-5303860989220332569" onmouseenter="enter('-5303860989220332569');" onmouseout="out('-5303860989220332569');" style=""> 382          leftScopeChild.setRowTypeInfo(leftTypeInfo);                                                              </span>

<span  style=""> 383                                                                                                                    </span>
<span class="3043795906382715340" onmouseenter="enter('3043795906382715340');" onmouseout="out('3043795906382715340');" style=""> 384          JoinScope.ScopeChild rightScopeChild = new JoinScope.ScopeChild();                                        </span>
<span class="2585249270397691815" onmouseenter="enter('2585249270397691815');" onmouseout="out('2585249270397691815');" style=""> 385          rightScopeChild.setAlias(joinInfo.getRightTableAlias());                                                  </span>
<span class="-5072747544386586876" onmouseenter="enter('-5072747544386586876');" onmouseout="out('-5072747544386586876');" style=""> 386          rightScopeChild.setTableName(joinInfo.getRightTableName());                                               </span>
<span class="-6382774479188932768" onmouseenter="enter('-6382774479188932768');" onmouseout="out('-6382774479188932768');" style=""> 387          AbstractSideTableInfo sideTableInfo = sideTableMap.get(joinInfo.getRightTableName());                     </span>
<span class="-2759210686353099969" onmouseenter="enter('-2759210686353099969');" onmouseout="out('-2759210686353099969');" style=""> 388          if(sideTableInfo == null){                                                                                </span>

<span class="-5396801098824602905" onmouseenter="enter('-5396801098824602905');" onmouseout="out('-5396801098824602905');" style=""> 389              sideTableInfo = sideTableMap.get(joinInfo.getRightTableAlias());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390          }                                                                                                         </span>
<span  style=""> 391                                                                                                                    </span>
<span class="-2759210686353099969" onmouseenter="enter('-2759210686353099969');" onmouseout="out('-2759210686353099969');" style=""> 392          if(sideTableInfo == null){                                                                                </span>

<span class="450947362076537032" onmouseenter="enter('450947362076537032');" onmouseout="out('450947362076537032');" style=""> 393              throw new RuntimeException(&quot;can&#x27;t not find side table:&quot; + joinInfo.getRightTableName());              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 394          }                                                                                                         </span>
<span  style=""> 395                                                                                                                    </span>
<span class="-1562873445908102884" onmouseenter="enter('-1562873445908102884');" onmouseout="out('-1562873445908102884');" style=""> 396          rightScopeChild.setRowTypeInfo(sideTableInfo.getRowTypeInfo());                                           </span>

<span  style=""> 397                                                                                                                    </span>
<span class="-5776192160472100987" onmouseenter="enter('-5776192160472100987');" onmouseout="out('-5776192160472100987');" style=""> 398          joinScope.addScope(leftScopeChild);                                                                       </span>
<span class="6805588345897841594" onmouseenter="enter('6805588345897841594');" onmouseout="out('6805588345897841594');" style=""> 399          joinScope.addScope(rightScopeChild);                                                                      </span>
<span  style=""> 400                                                                                                                    </span>
<span class="2226908158928528195" onmouseenter="enter('2226908158928528195');" onmouseout="out('2226908158928528195');" style=""> 401          HashBasedTable&lt;String, String, String&gt; mappingTable = ((JoinInfo) pollObj).getTableFieldRef();            </span>
<span  style=""> 402                                                                                                                    </span>
<span class="-816440763270240777" onmouseenter="enter('-816440763270240777');" onmouseout="out('-816440763270240777');" style=""> 403          //获取两个表的所有字段                                                                                              </span>
<span class="-6198283029075022684" onmouseenter="enter('-6198283029075022684');" onmouseout="out('-6198283029075022684');" style=""><abbr title=" 404          List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), joinScope, true);"> 404          List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), joinScope, tr🔵</abbr></span>
<span class="5016458903510526292" onmouseenter="enter('5016458903510526292');" onmouseout="out('5016458903510526292');" style=""> 405          //通过join的查询字段信息过滤出需要的字段信息                                                                                 </span>
<span class="5211893312708517501" onmouseenter="enter('5211893312708517501');" onmouseout="out('5211893312708517501');" style=""><abbr title=" 406          sideJoinFieldInfo.removeIf(tmpFieldInfo -&gt; mappingTable.get(tmpFieldInfo.getTable(), tmpFieldInfo.getFieldName()) == null);"> 406          sideJoinFieldInfo.removeIf(tmpFieldInfo -&gt; mappingTable.get(tmpFieldInfo.getTable(), tmpFieldInfo.getField🔵</abbr></span>
<span  style=""> 407                                                                                                                    </span>
<span class="-1467815726997680818" onmouseenter="enter('-1467815726997680818');" onmouseout="out('-1467815726997680818');" style=""> 408          String leftTableAlias = joinInfo.getLeftTableAlias();                                                     </span>
<span class="-6434853421912213287" onmouseenter="enter('-6434853421912213287');" onmouseout="out('-6434853421912213287');" style=""> 409          Table targetTable = localTableCache.get(leftTableAlias);                                                  </span>
<span class="-6749372432358522016" onmouseenter="enter('-6749372432358522016');" onmouseout="out('-6749372432358522016');" style=""> 410          if(targetTable == null){                                                                                  </span>

<span class="8734197217231436839" onmouseenter="enter('8734197217231436839');" onmouseout="out('8734197217231436839');" style=""> 411              targetTable = localTableCache.get(joinInfo.getLeftTableName());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412          }                                                                                                         </span>
<span  style=""> 413                                                                                                                    </span>
<span class="-1157067725052643612" onmouseenter="enter('-1157067725052643612');" onmouseout="out('-1157067725052643612');" style=""><abbr title=" 414          RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getFieldTypes(), targetTable.getSchema().getFieldNames());"> 414          RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getFieldTypes(), targetTable.getSchema().ge🔵</abbr></span>
<span  style=""> 415                                                                                                                    </span>
<span class="8331408572102109154" onmouseenter="enter('8331408572102109154');" onmouseout="out('8331408572102109154');" style=""> 416          DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; adaptStream = tableEnv.toRetractStream(targetTable, Row.class);          </span>
<span  style=""> 417                                                                                                                    </span>
<span class="-6082173173678345991" onmouseenter="enter('-6082173173678345991');" onmouseout="out('-6082173173678345991');" style=""> 418          //join side table before keyby ===&gt; Reducing the size of each dimension table cache of async              </span>
<span class="6301552848628110191" onmouseenter="enter('6301552848628110191');" onmouseout="out('6301552848628110191');" style=""> 419          if (sideTableInfo.isPartitionedJoin()) {                                                                  </span>
<span class="-4638861421651181765" onmouseenter="enter('-4638861421651181765');" onmouseout="out('-4638861421651181765');" style=""><abbr title=" 420              List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTableAlias(), sideTableInfo);"> 420              List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTableAlias(🔵</abbr></span>
<span class="-1086375650130423707" onmouseenter="enter('-1086375650130423707');" onmouseout="out('-1086375650130423707');" style=""> 421              List&lt;String&gt; fieldNames = Arrays.asList(targetTable.getSchema().getFieldNames());                     </span>
<span class="2517152886952033206" onmouseenter="enter('2517152886952033206');" onmouseout="out('2517152886952033206');" style=""> 422              int[] keyIndex = leftJoinColList.stream().mapToInt(fieldNames::indexOf).toArray();                    </span>
<span class="-1034511431639552497" onmouseenter="enter('-1034511431639552497');" onmouseout="out('-1034511431639552497');" style=""><abbr title=" 423              adaptStream = adaptStream.keyBy(new TupleKeySelector(keyIndex, projectedTypeInfo(keyIndex, targetTable.getSchema())));"> 423              adaptStream = adaptStream.keyBy(new TupleKeySelector(keyIndex, projectedTypeInfo(keyIndex, targetTable🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 424          }                                                                                                         </span>
<span  style=""> 425                                                                                                                    </span>
<span class="8900898589811243168" onmouseenter="enter('8900898589811243168');" onmouseout="out('8900898589811243168');" style=""> 426          DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; dsOut = null;                                                            </span>
<span class="3901580925108094660" onmouseenter="enter('3901580925108094660');" onmouseout="out('3901580925108094660');" style=""> 427          if(ECacheType.ALL.name().equalsIgnoreCase(sideTableInfo.getCacheType())){                                 </span>

<span class="7101184136852303035" onmouseenter="enter('7101184136852303035');" onmouseout="out('7101184136852303035');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 428 -            dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo);"> 428 -            dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlP🔵</abbr></span>
<span class="4800933198673881512" onmouseenter="enter('4800933198673881512');" onmouseout="out('4800933198673881512');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 429 +            dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo, pluginLoadMode);"> 429 +            dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlP🔵</abbr></span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 430          }else{                                                                                                    </span>

<span class="7683243294616380271" onmouseenter="enter('7683243294616380271');" onmouseout="out('7683243294616380271');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 431 -            dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo);"> 431 -            dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPa🔵</abbr></span>
<span class="7407295138386527483" onmouseenter="enter('7407295138386527483');" onmouseout="out('7407295138386527483');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 432 +            dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo, pluginLoadMode);"> 432 +            dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPa🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 433          }                                                                                                         </span>
<span  style=""> 434                                                                                                                    </span>
<span class="2474148199265091642" onmouseenter="enter('2474148199265091642');" onmouseout="out('2474148199265091642');" style=""> 435          RowTypeInfo sideOutTypeInfo = buildOutRowTypeInfo(sideJoinFieldInfo, mappingTable);                       </span>

<span  style=""> 436                                                                                                                    </span>
<span class="993314962060447081" onmouseenter="enter('993314962060447081');" onmouseout="out('993314962060447081');" style=""> 437          TupleTypeInfo tupleTypeInfo = new TupleTypeInfo(Types.BOOLEAN, sideOutTypeInfo);                          </span>
<span class="6600937869795732915" onmouseenter="enter('6600937869795732915');" onmouseout="out('6600937869795732915');" style=""> 438          dsOut.getTransformation().setOutputType(tupleTypeInfo);                                                   </span>
<span  style=""> 439                                                                                                                    </span>
<span class="4836712590888983064" onmouseenter="enter('4836712590888983064');" onmouseout="out('4836712590888983064');" style=""> 440          String targetTableName = joinInfo.getNewTableName();                                                      </span>
<span class="-3094587764130774762" onmouseenter="enter('-3094587764130774762');" onmouseout="out('-3094587764130774762');" style=""> 441          String targetTableAlias = joinInfo.getNewTableAlias();                                                    </span>
<span  style=""> 442                                                                                                                    </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 443          FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                                    </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 444          replaceInfo.setMappingTable(mappingTable);                                                                </span>
<span class="8710576405434192583" onmouseenter="enter('8710576405434192583');" onmouseout="out('8710576405434192583');" style=""> 445          replaceInfo.setTargetTableName(targetTableName);                                                          </span>
<span class="-6613112199475906839" onmouseenter="enter('-6613112199475906839');" onmouseout="out('-6613112199475906839');" style=""> 446          replaceInfo.setTargetTableAlias(targetTableAlias);                                                        </span>
<span  style=""> 447                                                                                                                    </span>
<span class="-7199180706663944207" onmouseenter="enter('-7199180706663944207');" onmouseout="out('-7199180706663944207');" style=""> 448          ObjectIdentifier objectIdentifier = ObjectIdentifier.of(                                                  </span>
<span class="-8235548579753933527" onmouseenter="enter('-8235548579753933527');" onmouseout="out('-8235548579753933527');" style=""> 449                  EnvironmentSettings.DEFAULT_BUILTIN_CATALOG,                                                      </span>
<span class="-4707782382614212141" onmouseenter="enter('-4707782382614212141');" onmouseout="out('-4707782382614212141');" style=""> 450                  EnvironmentSettings.DEFAULT_BUILTIN_DATABASE,                                                     </span>
<span class="-5532274924697595213" onmouseenter="enter('-5532274924697595213');" onmouseout="out('-5532274924697595213');" style=""> 451                  targetTableName);                                                                                 </span>
<span class="5891773481881515301" onmouseenter="enter('5891773481881515301');" onmouseout="out('5891773481881515301');" style=""><abbr title=" 452          boolean tableExists = tableEnv.getCatalog(EnvironmentSettings.DEFAULT_BUILTIN_CATALOG).get().tableExists(objectIdentifier.toObjectPath());"> 452          boolean tableExists = tableEnv.getCatalog(EnvironmentSettings.DEFAULT_BUILTIN_CATALOG).get().tableExists(o🔵</abbr></span>
<span  style=""> 453                                                                                                                    </span>
<span class="-3741652885152135341" onmouseenter="enter('-3741652885152135341');" onmouseout="out('-3741652885152135341');" style=""> 454          if (!tableExists){                                                                                        </span>

<span class="-9057257427162955657" onmouseenter="enter('-9057257427162955657');" onmouseout="out('-9057257427162955657');" style=""> 455              Table joinTable = tableEnv.fromDataStream(dsOut);                                                     </span>
<span class="7656863459817986298" onmouseenter="enter('7656863459817986298');" onmouseout="out('7656863459817986298');" style=""> 456              tableEnv.createTemporaryView(targetTableName, joinTable);                                             </span>
<span class="5569875846259576593" onmouseenter="enter('5569875846259576593');" onmouseout="out('5569875846259576593');" style=""> 457              localTableCache.put(joinInfo.getNewTableName(), joinTable);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 458          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 459      }                                                                                                             </span>
<span  style=""> 460                                                                                                                    </span>
<span class="2503560481488678812" onmouseenter="enter('2503560481488678812');" onmouseout="out('2503560481488678812');" style=""> 461      private TypeInformation&lt;Row&gt; projectedTypeInfo(int[] fields, TableSchema schema) {                            </span>
<span class="-934325254904626531" onmouseenter="enter('-934325254904626531');" onmouseout="out('-934325254904626531');" style=""> 462          String[] fieldNames = schema.getFieldNames();                                                             </span>
<span class="4556717060829301814" onmouseenter="enter('4556717060829301814');" onmouseout="out('4556717060829301814');" style=""> 463          TypeInformation&lt;?&gt;[] fieldTypes = schema.getFieldTypes();                                                 </span>
<span  style=""> 464                                                                                                                    </span>
<span class="424178526470659793" onmouseenter="enter('424178526470659793');" onmouseout="out('424178526470659793');" style=""> 465          String[] projectedNames = Arrays.stream(fields).mapToObj(i -&gt; fieldNames[i]).toArray(String[]::new);      </span>
<span class="5411397013359382914" onmouseenter="enter('5411397013359382914');" onmouseout="out('5411397013359382914');" style=""><abbr title=" 466          TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(i -&gt; fieldTypes[i]).toArray(TypeInformation[]::new);"> 466          TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(i -&gt; fieldTypes[i]).toArray(TypeInformat🔵</abbr></span>
<span class="-5627838059420262860" onmouseenter="enter('-5627838059420262860');" onmouseout="out('-5627838059420262860');" style=""> 467          return new RowTypeInfo(projectedTypes, projectedNames);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 468      }                                                                                                             </span>
<span  style=""> 469                                                                                                                    </span>
<span  style=""> 470                                                                                                                    </span>
<span class="-410103274617159114" onmouseenter="enter('-410103274617159114');" onmouseout="out('-410103274617159114');" style=""> 471      private boolean checkFieldsInfo(CreateTmpTableParser.SqlParserResult result, Table table) {                   </span>
<span class="8925867441251499081" onmouseenter="enter('8925867441251499081');" onmouseout="out('8925867441251499081');" style=""> 472          List&lt;String&gt; fieldNames = new LinkedList&lt;&gt;();                                                             </span>
<span class="-5553816012496774052" onmouseenter="enter('-5553816012496774052');" onmouseout="out('-5553816012496774052');" style=""> 473          String fieldsInfo = result.getFieldsInfoStr();                                                            </span>
<span class="-5855731071361337066" onmouseenter="enter('-5855731071361337066');" onmouseout="out('-5855731071361337066');" style=""> 474          String[] fields = StringUtils.split(fieldsInfo, &quot;,&quot;);                                                     </span>
<span class="8167763809890058258" onmouseenter="enter('8167763809890058258');" onmouseout="out('8167763809890058258');" style=""> 475          for (int i = 0; i &lt; fields.length; i++) {                                                                 </span>
<span class="2947314498030065040" onmouseenter="enter('2947314498030065040');" onmouseout="out('2947314498030065040');" style=""> 476              String[] filed = fields[i].split(&quot;\\s&quot;);                                                              </span>
<span class="5889723123831816710" onmouseenter="enter('5889723123831816710');" onmouseout="out('5889723123831816710');" style=""> 477              if (filed.length &lt; 2 || fields.length != table.getSchema().getFieldCount()){                          </span>

<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 478                  return false;                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 479              } else {                                                                                              </span>
<span class="-7518627407039835792" onmouseenter="enter('-7518627407039835792');" onmouseout="out('-7518627407039835792');" style=""> 480                  String[] filedNameArr = new String[filed.length - 1];                                             </span>
<span class="6064994574122217386" onmouseenter="enter('6064994574122217386');" onmouseout="out('6064994574122217386');" style=""> 481                  System.arraycopy(filed, 0, filedNameArr, 0, filed.length - 1);                                    </span>
<span class="-3029457015937137256" onmouseenter="enter('-3029457015937137256');" onmouseout="out('-3029457015937137256');" style=""> 482                  String fieldName = String.join(&quot; &quot;, filedNameArr);                                                </span>
<span class="-8037943253867791720" onmouseenter="enter('-8037943253867791720');" onmouseout="out('-8037943253867791720');" style=""> 483                  fieldNames.add(fieldName);                                                                        </span>
<span class="516386479555957316" onmouseenter="enter('516386479555957316');" onmouseout="out('516386479555957316');" style=""> 484                  String fieldType = filed[filed.length - 1 ].trim();                                               </span>

<span class="-8511761590344571010" onmouseenter="enter('-8511761590344571010');" onmouseout="out('-8511761590344571010');" style=""> 485                  Class fieldClass = ClassUtil.stringConvertClass(fieldType);                                       </span>
<span class="-351203522969775469" onmouseenter="enter('-351203522969775469');" onmouseout="out('-351203522969775469');" style=""> 486                  Class tableField = table.getSchema().getFieldType(i).get().getTypeClass();                        </span>
<span class="9126336856345087988" onmouseenter="enter('9126336856345087988');" onmouseout="out('9126336856345087988');" style=""> 487                  if (fieldClass == tableField){                                                                    </span>

<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 488                      continue;                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 489                  } else {                                                                                          </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 490                      return false;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 491                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 493          }                                                                                                         </span>
<span class="-7181802501759976675" onmouseenter="enter('-7181802501759976675');" onmouseout="out('-7181802501759976675');" style=""> 494          tmpFields = String.join(&quot;,&quot;, fieldNames);                                                                 </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 495          return true;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 496      }                                                                                                             </span>
<span  style=""> 497                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  20 -                                                                                                                  </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  21  package com.dtstack.flink.sql.side;                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  22 -                                                                                                                  </span>
<span class="-4869246525166490693" onmouseenter="enter('-4869246525166490693');" onmouseout="out('-4869246525166490693');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  23 -import org.apache.flink.api.common.typeinfo.TypeInformation;                                                      </span>
<span class="-5176867084763361213" onmouseenter="enter('-5176867084763361213');" onmouseout="out('-5176867084763361213');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  24 -import org.apache.flink.api.common.typeinfo.Types;                                                                </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  25 -import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  26 -import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                           </span>
<span class="-2654529550501634008" onmouseenter="enter('-2654529550501634008');" onmouseout="out('-2654529550501634008');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  27 -import org.apache.flink.api.java.typeutils.TupleTypeInfo;                                                         </span>
<span class="329774846923224587" onmouseenter="enter('329774846923224587');" onmouseout="out('329774846923224587');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  28 -import org.apache.flink.streaming.api.datastream.DataStream;                                                      </span>
<span class="7654739943616372616" onmouseenter="enter('7654739943616372616');" onmouseout="out('7654739943616372616');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  29 -import org.apache.flink.table.api.EnvironmentSettings;                                                            </span>
<span class="5165777186879784670" onmouseenter="enter('5165777186879784670');" onmouseout="out('5165777186879784670');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  30 -import org.apache.flink.table.api.Table;                                                                          </span>
<span class="-8888728238394280005" onmouseenter="enter('-8888728238394280005');" onmouseout="out('-8888728238394280005');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  31 -import org.apache.flink.table.api.TableSchema;                                                                    </span>
<span class="776922417053783834" onmouseenter="enter('776922417053783834');" onmouseout="out('776922417053783834');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  32 -import org.apache.flink.table.api.java.StreamTableEnvironment;                                                    </span>
<span class="785035026521613593" onmouseenter="enter('785035026521613593');" onmouseout="out('785035026521613593');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  33 -import org.apache.flink.table.api.java.internal.StreamTableEnvironmentImpl;                                       </span>
<span class="3778081928793243344" onmouseenter="enter('3778081928793243344');" onmouseout="out('3778081928793243344');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  34 -import org.apache.flink.table.catalog.CatalogManager;                                                             </span>
<span class="6625190898426831134" onmouseenter="enter('6625190898426831134');" onmouseout="out('6625190898426831134');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  35 -import org.apache.flink.table.catalog.ObjectIdentifier;                                                           </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  36 -import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                                    </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  37 -import org.apache.flink.types.Row;                                                                                </span>
<span  style="">  38                                                                                                                    </span>
<span class="8826438848011158297" onmouseenter="enter('8826438848011158297');" onmouseout="out('8826438848011158297');" style="">  39  import com.dtstack.flink.sql.enums.ECacheType;                                                                    </span>
<span class="1760694872476698727" onmouseenter="enter('1760694872476698727');" onmouseout="out('1760694872476698727');" style="">  40  import com.dtstack.flink.sql.exec.FlinkSQLExec;                                                                   </span>
<span class="2626775214998945029" onmouseenter="enter('2626775214998945029');" onmouseout="out('2626775214998945029');" style="">  41  import com.dtstack.flink.sql.parser.CreateTmpTableParser;                                                         </span>
<span class="7697893187981436175" onmouseenter="enter('7697893187981436175');" onmouseout="out('7697893187981436175');" style="">  42  import com.dtstack.flink.sql.side.operator.SideAsyncOperator;                                                     </span>
<span class="-7456990469468101750" onmouseenter="enter('-7456990469468101750');" onmouseout="out('-7456990469468101750');" style="">  43  import com.dtstack.flink.sql.side.operator.SideWithAllCacheOperator;                                              </span>
<span class="4874498590411064411" onmouseenter="enter('4874498590411064411');" onmouseout="out('4874498590411064411');" style="">  44  import com.dtstack.flink.sql.util.ClassUtil;                                                                      </span>
<span class="-4585055968129153397" onmouseenter="enter('-4585055968129153397');" onmouseout="out('-4585055968129153397');" style="">  45  import com.dtstack.flink.sql.util.ParseUtils;                                                                     </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  46  import com.dtstack.flink.sql.util.TableUtils;                                                                     </span>
<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  47  import com.google.common.base.Preconditions;                                                                      </span>
<span class="-5849322492369628764" onmouseenter="enter('-5849322492369628764');" onmouseout="out('-5849322492369628764');" style="">  48  import com.google.common.collect.HashBasedTable;                                                                  </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  49  import com.google.common.collect.Lists;                                                                           </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  50  import com.google.common.collect.Maps;                                                                            </span>
<span class="6390139568718476113" onmouseenter="enter('6390139568718476113');" onmouseout="out('6390139568718476113');" style="">  51  import com.google.common.collect.Sets;                                                                            </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  52 -import org.apache.calcite.sql.SqlBasicCall;                                                                       </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  53 -import org.apache.calcite.sql.SqlIdentifier;                                                                      </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  54 -import org.apache.calcite.sql.SqlKind;                                                                            </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  55 -import org.apache.calcite.sql.SqlNode;                                                                            </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  56 -import org.apache.calcite.sql.SqlSelect;                                                                          </span>
<span class="9012576760183743580" onmouseenter="enter('9012576760183743580');" onmouseout="out('9012576760183743580');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  57 -import org.apache.calcite.sql.SqlWithItem;                                                                        </span>
<span class="5169042772451251702" onmouseenter="enter('5169042772451251702');" onmouseout="out('5169042772451251702');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  58 +import org.apache.calcite.sql.*;                                                                                  </span>
<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="">  59  import org.apache.calcite.sql.parser.SqlParseException;                                                           </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  60  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  61  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="-4869246525166490693" onmouseenter="enter('-4869246525166490693');" onmouseout="out('-4869246525166490693');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  62 +import org.apache.flink.api.common.typeinfo.TypeInformation;                                                      </span>
<span class="-5176867084763361213" onmouseenter="enter('-5176867084763361213');" onmouseout="out('-5176867084763361213');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  63 +import org.apache.flink.api.common.typeinfo.Types;                                                                </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  64 +import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  65 +import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                           </span>
<span class="-2654529550501634008" onmouseenter="enter('-2654529550501634008');" onmouseout="out('-2654529550501634008');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +import org.apache.flink.api.java.typeutils.TupleTypeInfo;                                                         </span>
<span class="329774846923224587" onmouseenter="enter('329774846923224587');" onmouseout="out('329774846923224587');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  67 +import org.apache.flink.streaming.api.datastream.DataStream;                                                      </span>
<span class="7654739943616372616" onmouseenter="enter('7654739943616372616');" onmouseout="out('7654739943616372616');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  68 +import org.apache.flink.table.api.EnvironmentSettings;                                                            </span>
<span class="5165777186879784670" onmouseenter="enter('5165777186879784670');" onmouseout="out('5165777186879784670');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  69 +import org.apache.flink.table.api.Table;                                                                          </span>
<span class="-8888728238394280005" onmouseenter="enter('-8888728238394280005');" onmouseout="out('-8888728238394280005');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  70 +import org.apache.flink.table.api.TableSchema;                                                                    </span>
<span class="776922417053783834" onmouseenter="enter('776922417053783834');" onmouseout="out('776922417053783834');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  71 +import org.apache.flink.table.api.java.StreamTableEnvironment;                                                    </span>
<span class="-1569555401775623611" onmouseenter="enter('-1569555401775623611');" onmouseout="out('-1569555401775623611');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  72 +import org.apache.flink.table.runtime.typeutils.BaseRowTypeInfo;                                                  </span>
<span class="-7056535177411590719" onmouseenter="enter('-7056535177411590719');" onmouseout="out('-7056535177411590719');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  73 +import org.apache.flink.table.types.logical.LogicalType;                                                          </span>
<span class="6625190898426831134" onmouseenter="enter('6625190898426831134');" onmouseout="out('6625190898426831134');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  74 +import org.apache.flink.table.catalog.ObjectIdentifier;                                                           </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  75 +import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                                    </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  76 +import org.apache.flink.types.Row;                                                                                </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  77  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  78  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  79                                                                                                                    </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  80 -import java.sql.Timestamp;                                                                                        </span>
<span class="-608398790767092657" onmouseenter="enter('-608398790767092657');" onmouseout="out('-608398790767092657');" style="">  81  import java.time.LocalDateTime;                                                                                   </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  82 -import java.util.Arrays;                                                                                          </span>
<span class="2644117295780670879" onmouseenter="enter('2644117295780670879');" onmouseout="out('2644117295780670879');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  83 -import java.util.LinkedList;                                                                                      </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  84 -import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  85 -import java.util.Map;                                                                                             </span>
<span class="-2789246819365843415" onmouseenter="enter('-2789246819365843415');" onmouseout="out('-2789246819365843415');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  86 -import java.util.Queue;                                                                                           </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  87 -import java.util.Set;                                                                                             </span>
<span class="196713859697444637" onmouseenter="enter('196713859697444637');" onmouseout="out('196713859697444637');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  88 +import java.util.*;                                                                                               </span>
<span  style="">  89                                                                                                                    </span>
<span class="7147213704442467623" onmouseenter="enter('7147213704442467623');" onmouseout="out('7147213704442467623');" style="">  90  import static org.apache.calcite.sql.SqlKind.*;                                                                   </span>
<span  style="">  91                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  92  /**                                                                                                               </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  93   * Reason:                                                                                                        </span>
<span class="-6082749432478588798" onmouseenter="enter('-6082749432478588798');" onmouseout="out('-6082749432478588798');" style="">  94   * Date: 2018/7/24                                                                                                </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  95   * Company: www.dtstack.com                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  96 + *                                                                                                                </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  97   * @author xuchao                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  98   */                                                                                                               </span>
<span  style="">  99                                                                                                                    </span>
<span class="-5079038956292767116" onmouseenter="enter('-5079038956292767116');" onmouseout="out('-5079038956292767116');" style=""> 100  public class SideSqlExec {                                                                                        </span>
<span  style=""> 101                                                                                                                    </span>
<span class="-8991898280301588076" onmouseenter="enter('-8991898280301588076');" onmouseout="out('-8991898280301588076');" style=""> 102      private static final Logger LOG = LoggerFactory.getLogger(SideSqlExec.class);                                 </span>
<span  style=""> 103                                                                                                                    </span>
<span class="-6334022460956670337" onmouseenter="enter('-6334022460956670337');" onmouseout="out('-6334022460956670337');" style=""> 104      private String localSqlPluginPath = null;                                                                     </span>
<span  style=""> 105                                                                                                                    </span>
<span class="-863593709646632598" onmouseenter="enter('-863593709646632598');" onmouseout="out('-863593709646632598');" style=""> 106      private String tmpFields = null;                                                                              </span>
<span  style=""> 107                                                                                                                    </span>


<span class="8878309237265342483" onmouseenter="enter('8878309237265342483');" onmouseout="out('8878309237265342483');" style=""> 108      private SidePredicatesParser sidePredicatesParser = new SidePredicatesParser();                               </span>
<span  style=""> 109                                                                                                                    </span>
<span class="4175687380086503813" onmouseenter="enter('4175687380086503813');" onmouseout="out('4175687380086503813');" style=""> 110      private Map&lt;String, Table&gt; localTableCache = Maps.newHashMap();                                               </span>
<span  style=""> 111                                                                                                                    </span>
<span class="5235405798143461797" onmouseenter="enter('5235405798143461797');" onmouseout="out('5235405798143461797');" style=""> 112      public void exec(String sql,                                                                                  </span>
<span class="-876340320175790120" onmouseenter="enter('-876340320175790120');" onmouseout="out('-876340320175790120');" style=""> 113                       Map&lt;String, AbstractSideTableInfo&gt; sideTableMap,                                             </span>
<span class="4244108408582304218" onmouseenter="enter('4244108408582304218');" onmouseout="out('4244108408582304218');" style=""> 114                       StreamTableEnvironment tableEnv,                                                             </span>
<span class="-1493383746124052329" onmouseenter="enter('-1493383746124052329');" onmouseout="out('-1493383746124052329');" style=""> 115                       Map&lt;String, Table&gt; tableCache,                                                               </span>
<span class="-7862911349817835208" onmouseenter="enter('-7862911349817835208');" onmouseout="out('-7862911349817835208');" style=""> 116                       CreateTmpTableParser.SqlParserResult createView,                                             </span>
<span class="2986641263782067303" onmouseenter="enter('2986641263782067303');" onmouseout="out('2986641263782067303');" style=""> 117                       String scope) throws Exception {                                                             </span>
<span class="-7184346740499807144" onmouseenter="enter('-7184346740499807144');" onmouseout="out('-7184346740499807144');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 118 -        if(localSqlPluginPath == null){                                                                           </span>
<span class="-8459786232159972392" onmouseenter="enter('-8459786232159972392');" onmouseout="out('-8459786232159972392');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +        if (localSqlPluginPath == null) {                                                                         </span>
<span class="4243357528698157424" onmouseenter="enter('4243357528698157424');" onmouseout="out('4243357528698157424');" style=""> 120              throw new RuntimeException(&quot;need to set localSqlPluginPath&quot;);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121          }                                                                                                         </span>
<span  style=""> 122                                                                                                                    </span>
<span class="-6307578536739293325" onmouseenter="enter('-6307578536739293325');" onmouseout="out('-6307578536739293325');" style=""> 123          localTableCache.putAll(tableCache);                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 124          try {                                                                                                     </span>
<span class="-7778408363768085476" onmouseenter="enter('-7778408363768085476');" onmouseout="out('-7778408363768085476');" style=""> 125              sidePredicatesParser.fillPredicatesForSideTable(sql, sideTableMap);                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 126          } catch (Exception e) {                                                                                   </span>
<span class="-6535415982741029210" onmouseenter="enter('-6535415982741029210');" onmouseout="out('-6535415982741029210');" style=""> 127              LOG.error(&quot;fill predicates for sideTable fail &quot;, e);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128          }                                                                                                         </span>
<span  style=""> 129                                                                                                                    </span>
<span class="5869130575145188486" onmouseenter="enter('5869130575145188486');" onmouseout="out('5869130575145188486');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 130 -        if(createView != null){                                                                                   </span>
<span class="-2666540822034943406" onmouseenter="enter('-2666540822034943406');" onmouseout="out('-2666540822034943406');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 131 +        if (createView != null) {                                                                                 </span>
<span class="-5051922790285322929" onmouseenter="enter('-5051922790285322929');" onmouseout="out('-5051922790285322929');" style=""> 132              LOG.warn(&quot;create view info\n&quot;);                                                                       </span>
<span class="4994977519661454238" onmouseenter="enter('4994977519661454238');" onmouseout="out('4994977519661454238');" style=""> 133              LOG.warn(createView.getExecSql());                                                                    </span>
<span class="-6048507734051622776" onmouseenter="enter('-6048507734051622776');" onmouseout="out('-6048507734051622776');" style=""> 134              LOG.warn(&quot;-----------------&quot;);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135          }                                                                                                         </span>
<span  style=""> 136                                                                                                                    </span>
<span class="3272289589011229925" onmouseenter="enter('3272289589011229925');" onmouseout="out('3272289589011229925');" style=""> 137          SideSQLParser sideSQLParser = new SideSQLParser();                                                        </span>
<span class="9221221341975786732" onmouseenter="enter('9221221341975786732');" onmouseout="out('9221221341975786732');" style=""> 138          sideSQLParser.setLocalTableCache(localTableCache);                                                        </span>
<span class="6016193463712965966" onmouseenter="enter('6016193463712965966');" onmouseout="out('6016193463712965966');" style=""> 139          Queue&lt;Object&gt; exeQueue = sideSQLParser.getExeQueue(sql, sideTableMap.keySet(), scope);                    </span>
<span class="1917635497637273504" onmouseenter="enter('1917635497637273504');" onmouseout="out('1917635497637273504');" style=""> 140          Object pollObj = null;                                                                                    </span>
<span  style=""> 141                                                                                                                    </span>
<span class="6128441282435403378" onmouseenter="enter('6128441282435403378');" onmouseout="out('6128441282435403378');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 142 -        while((pollObj = exeQueue.poll()) != null){                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 143 -                                                                                                                  </span>
<span class="138624831707193108" onmouseenter="enter('138624831707193108');" onmouseout="out('138624831707193108');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 144 -            if(pollObj instanceof SqlNode){                                                                       </span>
<span class="-5058340944145416275" onmouseenter="enter('-5058340944145416275');" onmouseout="out('-5058340944145416275');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +        while ((pollObj = exeQueue.poll()) != null) {                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 146 +                                                                                                                  </span>
<span class="-2443216094467354180" onmouseenter="enter('-2443216094467354180');" onmouseout="out('-2443216094467354180');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 147 +            if (pollObj instanceof SqlNode) {                                                                     </span>
<span class="-8817010307772649906" onmouseenter="enter('-8817010307772649906');" onmouseout="out('-8817010307772649906');" style=""> 148                  SqlNode pollSqlNode = (SqlNode) pollObj;                                                          </span>
<span  style=""> 149                                                                                                                    </span>
<span  style=""> 150                                                                                                                    </span>
<span class="-2885719311179922220" onmouseenter="enter('-2885719311179922220');" onmouseout="out('-2885719311179922220');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 151 -                if(pollSqlNode.getKind() == INSERT){                                                              </span>
<span class="-1675849540725983142" onmouseenter="enter('-1675849540725983142');" onmouseout="out('-1675849540725983142');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +                if (pollSqlNode.getKind() == INSERT) {                                                            </span>
<span class="4666335002906799727" onmouseenter="enter('4666335002906799727');" onmouseout="out('4666335002906799727');" style=""> 153                      FlinkSQLExec.sqlUpdate(tableEnv, pollSqlNode.toString());                                     </span>
<span class="3766255850891299565" onmouseenter="enter('3766255850891299565');" onmouseout="out('3766255850891299565');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 154 -                    if(LOG.isInfoEnabled()){                                                                      </span>
<span class="-4873093459421651994" onmouseenter="enter('-4873093459421651994');" onmouseout="out('-4873093459421651994');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +                    if (LOG.isInfoEnabled()) {                                                                    </span>
<span class="-5986232783970891998" onmouseenter="enter('-5986232783970891998');" onmouseout="out('-5986232783970891998');" style=""> 156                          LOG.info(&quot;----------real exec sql-----------\n{}&quot;, pollSqlNode.toString());               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157                      }                                                                                             </span>
<span  style=""> 158                                                                                                                    </span>
<span class="4666687505712980858" onmouseenter="enter('4666687505712980858');" onmouseout="out('4666687505712980858');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 159 -                }else if(pollSqlNode.getKind() == AS){                                                            </span>
<span class="-2457059581629029056" onmouseenter="enter('-2457059581629029056');" onmouseout="out('-2457059581629029056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 160 +                } else if (pollSqlNode.getKind() == AS) {                                                         </span>
<span class="3037765200739894050" onmouseenter="enter('3037765200739894050');" onmouseout="out('3037765200739894050');" style=""> 161                      dealAsSourceTable(tableEnv, pollSqlNode, tableCache);                                         </span>
<span  style=""> 162                                                                                                                    </span>
<span class="4581342471671871622" onmouseenter="enter('4581342471671871622');" onmouseout="out('4581342471671871622');" style=""> 163                  } else if (pollSqlNode.getKind() == WITH_ITEM) {                                                  </span>
<span class="9089825500288046356" onmouseenter="enter('9089825500288046356');" onmouseout="out('9089825500288046356');" style=""> 164                      SqlWithItem sqlWithItem = (SqlWithItem) pollSqlNode;                                          </span>
<span class="-7674640876687845363" onmouseenter="enter('-7674640876687845363');" onmouseout="out('-7674640876687845363');" style=""> 165                      String TableAlias = sqlWithItem.name.toString();                                              </span>
<span class="2573668668184904794" onmouseenter="enter('2573668668184904794');" onmouseout="out('2573668668184904794');" style=""> 166                      Table table = tableEnv.sqlQuery(sqlWithItem.query.toString());                                </span>
<span class="2341577843786962651" onmouseenter="enter('2341577843786962651');" onmouseout="out('2341577843786962651');" style=""> 167                      tableEnv.registerTable(TableAlias, table);                                                    </span>
<span  style=""> 168                                                                                                                    </span>
<span class="-8892059869421071039" onmouseenter="enter('-8892059869421071039');" onmouseout="out('-8892059869421071039');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 169 -                } else if (pollSqlNode.getKind() == SELECT){                                                      </span>
<span class="-5550860322814932769" onmouseenter="enter('-5550860322814932769');" onmouseout="out('-5550860322814932769');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 170 +                } else if (pollSqlNode.getKind() == SELECT) {                                                     </span>
<span class="-1344441018307209750" onmouseenter="enter('-1344441018307209750');" onmouseout="out('-1344441018307209750');" style=""> 171                      Preconditions.checkState(createView != null, &quot;select sql must included by create view&quot;);      </span>
<span class="1694293925390283740" onmouseenter="enter('1694293925390283740');" onmouseout="out('1694293925390283740');" style=""> 172                      Table table = tableEnv.sqlQuery(pollObj.toString());                                          </span>
<span  style=""> 173                                                                                                                    </span>
<span class="-5832165917407529739" onmouseenter="enter('-5832165917407529739');" onmouseout="out('-5832165917407529739');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 174 -                    if (createView.getFieldsInfoStr() == null){                                                   </span>
<span class="2239810942967083761" onmouseenter="enter('2239810942967083761');" onmouseout="out('2239810942967083761');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +                    if (createView.getFieldsInfoStr() == null) {                                                  </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 176                          tableEnv.registerTable(createView.getTableName(), table);                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 177                      } else {                                                                                      </span>
<span class="5288384657559945705" onmouseenter="enter('5288384657559945705');" onmouseout="out('5288384657559945705');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 178 -                        if (checkFieldsInfo(createView, table)){                                                  </span>
<span class="6460464009712843539" onmouseenter="enter('6460464009712843539');" onmouseout="out('6460464009712843539');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 179 +                        if (checkFieldsInfo(createView, table)) {                                                 </span>
<span class="-9109211084540213069" onmouseenter="enter('-9109211084540213069');" onmouseout="out('-9109211084540213069');" style=""> 180                              table = table.as(tmpFields);                                                          </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 181                              tableEnv.registerTable(createView.getTableName(), table);                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 182                          } else {                                                                                  </span>
<span class="-4180003952862210397" onmouseenter="enter('-4180003952862210397');" onmouseout="out('-4180003952862210397');" style=""> 183                              throw new RuntimeException(&quot;Fields mismatch&quot;);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185                      }                                                                                             </span>
<span  style=""> 186                                                                                                                    </span>
<span class="-5831701022468144749" onmouseenter="enter('-5831701022468144749');" onmouseout="out('-5831701022468144749');" style=""> 187                      localTableCache.put(createView.getTableName(), table);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188                  }                                                                                                 </span>
<span  style=""> 189                                                                                                                    </span>
<span class="2267959141426380188" onmouseenter="enter('2267959141426380188');" onmouseout="out('2267959141426380188');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 190 -            }else if (pollObj instanceof JoinInfo){                                                               </span>
<span class="735190908606907144" onmouseenter="enter('735190908606907144');" onmouseout="out('735190908606907144');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 191 +            } else if (pollObj instanceof JoinInfo) {                                                             </span>
<span class="-6196622619540139248" onmouseenter="enter('-6196622619540139248');" onmouseout="out('-6196622619540139248');" style=""> 192                  LOG.info(&quot;----------exec join info----------\n{}&quot;, pollObj.toString());                           </span>
<span class="-3518617829078174884" onmouseenter="enter('-3518617829078174884');" onmouseout="out('-3518617829078174884');" style=""> 193                  joinFun(pollObj, localTableCache, sideTableMap, tableEnv);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195          }                                                                                                         </span>
<span  style=""> 196                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197      }                                                                                                             </span>
<span  style=""> 198                                                                                                                    </span>
<span  style=""> 199                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 200      /**                                                                                                           </span>
<span class="-7226459799151937672" onmouseenter="enter('-7226459799151937672');" onmouseout="out('-7226459799151937672');" style=""> 201       * 解析出as查询的表和字段的关系                                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 202 +     *                                                                                                            </span>
<span class="-4711911052088894915" onmouseenter="enter('-4711911052088894915');" onmouseout="out('-4711911052088894915');" style=""> 203       * @param asSqlNode                                                                                           </span>
<span class="-8172984871762282794" onmouseenter="enter('-8172984871762282794');" onmouseout="out('-8172984871762282794');" style=""> 204       * @param tableCache                                                                                          </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 205       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 206       */                                                                                                           </span>
<span class="-8315666616430025383" onmouseenter="enter('-8315666616430025383');" onmouseout="out('-8315666616430025383');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 207 -    private FieldReplaceInfo parseAsQuery(SqlBasicCall asSqlNode, Map&lt;String, Table&gt; tableCache){                 </span>
<span class="1606768570861189432" onmouseenter="enter('1606768570861189432');" onmouseout="out('1606768570861189432');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 208 +    private FieldReplaceInfo parseAsQuery(SqlBasicCall asSqlNode, Map&lt;String, Table&gt; tableCache) {                </span>
<span class="-4950849472737015743" onmouseenter="enter('-4950849472737015743');" onmouseout="out('-4950849472737015743');" style=""> 209          SqlNode info = asSqlNode.getOperands()[0];                                                                </span>
<span class="-6049998703041327008" onmouseenter="enter('-6049998703041327008');" onmouseout="out('-6049998703041327008');" style=""> 210          SqlNode alias = asSqlNode.getOperands()[1];                                                               </span>
<span  style=""> 211                                                                                                                    </span>
<span class="6169254144825097648" onmouseenter="enter('6169254144825097648');" onmouseout="out('6169254144825097648');" style=""> 212          SqlKind infoKind = info.getKind();                                                                        </span>
<span class="-8998816044463313680" onmouseenter="enter('-8998816044463313680');" onmouseout="out('-8998816044463313680');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 213 -        if(infoKind != SELECT){                                                                                   </span>
<span class="-7038358418253063490" onmouseenter="enter('-7038358418253063490');" onmouseout="out('-7038358418253063490');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 214 +        if (infoKind != SELECT) {                                                                                 </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 215              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216          }                                                                                                         </span>
<span  style=""> 217                                                                                                                    </span>
<span class="1448651332248375248" onmouseenter="enter('1448651332248375248');" onmouseout="out('1448651332248375248');" style=""> 218          List&lt;FieldInfo&gt; extractFieldList = TableUtils.parserSelectField((SqlSelect) info, tableCache);            </span>
<span  style=""> 219                                                                                                                    </span>
<span class="-3840015462696951757" onmouseenter="enter('-3840015462696951757');" onmouseout="out('-3840015462696951757');" style=""> 220          HashBasedTable&lt;String, String, String&gt; mappingTable = HashBasedTable.create();                            </span>
<span class="-5476396715494077219" onmouseenter="enter('-5476396715494077219');" onmouseout="out('-5476396715494077219');" style=""> 221          for (FieldInfo fieldInfo : extractFieldList) {                                                            </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 222              String tableName = fieldInfo.getTable();                                                              </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 223              String fieldName = fieldInfo.getFieldName();                                                          </span>
<span class="4185539436596522295" onmouseenter="enter('4185539436596522295');" onmouseout="out('4185539436596522295');" style=""> 224              String mappingFieldName = ParseUtils.dealDuplicateFieldName(mappingTable, fieldName);                 </span>
<span class="-7827879044056282695" onmouseenter="enter('-7827879044056282695');" onmouseout="out('-7827879044056282695');" style=""> 225              mappingTable.put(tableName, fieldName, mappingFieldName);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226          }                                                                                                         </span>
<span  style=""> 227                                                                                                                    </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 228          FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                                    </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 229          replaceInfo.setMappingTable(mappingTable);                                                                </span>
<span class="9115675088981905484" onmouseenter="enter('9115675088981905484');" onmouseout="out('9115675088981905484');" style=""> 230          replaceInfo.setTargetTableName(alias.toString());                                                         </span>
<span class="-6295883374697236710" onmouseenter="enter('-6295883374697236710');" onmouseout="out('-6295883374697236710');" style=""> 231          replaceInfo.setTargetTableAlias(alias.toString());                                                        </span>
<span class="2754859294214862032" onmouseenter="enter('2754859294214862032');" onmouseout="out('2754859294214862032');" style=""> 232          return replaceInfo;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233      }                                                                                                             </span>
<span  style=""> 234                                                                                                                    </span>
<span  style=""> 235                                                                                                                    </span>
<span class="73834954090191073" onmouseenter="enter('73834954090191073');" onmouseout="out('73834954090191073');" style=""> 236      public AliasInfo parseASNode(SqlNode sqlNode) throws SqlParseException {                                      </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 237          SqlKind sqlKind = sqlNode.getKind();                                                                      </span>
<span class="3363188275491767702" onmouseenter="enter('3363188275491767702');" onmouseout="out('3363188275491767702');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 238 -        if(sqlKind != AS){                                                                                        </span>
<span class="-2199822100243684238" onmouseenter="enter('-2199822100243684238');" onmouseout="out('-2199822100243684238');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 239 +        if (sqlKind != AS) {                                                                                      </span>
<span class="1088430228081547460" onmouseenter="enter('1088430228081547460');" onmouseout="out('1088430228081547460');" style=""> 240              throw new RuntimeException(sqlNode + &quot; is not &#x27;as&#x27; operator&quot;);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241          }                                                                                                         </span>
<span  style=""> 242                                                                                                                    </span>
<span class="-4085054753182131209" onmouseenter="enter('-4085054753182131209');" onmouseout="out('-4085054753182131209');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 243 -        SqlNode info = ((SqlBasicCall)sqlNode).getOperands()[0];                                                  </span>
<span class="-7770788458619826788" onmouseenter="enter('-7770788458619826788');" onmouseout="out('-7770788458619826788');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 244 +        SqlNode info = ((SqlBasicCall) sqlNode).getOperands()[0];                                                 </span>
<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style=""> 245          SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                                                </span>
<span  style=""> 246                                                                                                                    </span>
<span class="-2458625767668584085" onmouseenter="enter('-2458625767668584085');" onmouseout="out('-2458625767668584085');" style=""> 247          AliasInfo aliasInfo = new AliasInfo();                                                                    </span>
<span class="-5109084571101185803" onmouseenter="enter('-5109084571101185803');" onmouseout="out('-5109084571101185803');" style=""> 248          aliasInfo.setName(info.toString());                                                                       </span>
<span class="-6584143955119724642" onmouseenter="enter('-6584143955119724642');" onmouseout="out('-6584143955119724642');" style=""> 249          aliasInfo.setAlias(alias.toString());                                                                     </span>
<span  style=""> 250                                                                                                                    </span>
<span class="-3107000398971930583" onmouseenter="enter('-3107000398971930583');" onmouseout="out('-3107000398971930583');" style=""> 251          return aliasInfo;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252      }                                                                                                             </span>
<span  style=""> 253                                                                                                                    </span>
<span class="4707165697759746048" onmouseenter="enter('4707165697759746048');" onmouseout="out('4707165697759746048');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 254 -    public RowTypeInfo buildOutRowTypeInfo(List&lt;FieldInfo&gt; sideJoinFieldInfo,                                     </span>
<span class="244517366126553103" onmouseenter="enter('244517366126553103');" onmouseout="out('244517366126553103');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 255 -                                           HashBasedTable&lt;String, String, String&gt; mappingTable) {                 </span>
<span class="-3566414926414695948" onmouseenter="enter('-3566414926414695948');" onmouseout="out('-3566414926414695948');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 256 -        TypeInformation[] sideOutTypes = new TypeInformation[sideJoinFieldInfo.size()];                           </span>
<span class="6012642327394790947" onmouseenter="enter('6012642327394790947');" onmouseout="out('6012642327394790947');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 257 +    public BaseRowTypeInfo buildOutRowTypeInfo(List&lt;FieldInfo&gt; sideJoinFieldInfo,                                 </span>
<span class="244517366126553103" onmouseenter="enter('244517366126553103');" onmouseout="out('244517366126553103');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 258 +                                               HashBasedTable&lt;String, String, String&gt; mappingTable) {             </span>
<span class="-9126530720291690226" onmouseenter="enter('-9126530720291690226');" onmouseout="out('-9126530720291690226');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 259 +        // TypeInformation[] sideOutTypes = new TypeInformation[sideJoinFieldInfo.size()];                        </span>
<span class="2784978011557375723" onmouseenter="enter('2784978011557375723');" onmouseout="out('2784978011557375723');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 260 +        LogicalType[] sideOutTypes = new LogicalType[sideJoinFieldInfo.size()];                                   </span>
<span class="-637166731779412769" onmouseenter="enter('-637166731779412769');" onmouseout="out('-637166731779412769');" style=""> 261          String[] sideOutNames = new String[sideJoinFieldInfo.size()];                                             </span>
<span class="7438730024850909889" onmouseenter="enter('7438730024850909889');" onmouseout="out('7438730024850909889');" style=""> 262          for (int i = 0; i &lt; sideJoinFieldInfo.size(); i++) {                                                      </span>
<span class="2207877773063469724" onmouseenter="enter('2207877773063469724');" onmouseout="out('2207877773063469724');" style=""> 263              FieldInfo fieldInfo = sideJoinFieldInfo.get(i);                                                       </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 264              String tableName = fieldInfo.getTable();                                                              </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 265              String fieldName = fieldInfo.getFieldName();                                                          </span>
<span  style=""> 266                                                                                                                    </span>
<span class="3640983111807923268" onmouseenter="enter('3640983111807923268');" onmouseout="out('3640983111807923268');" style=""> 267              String mappingFieldName = mappingTable.get(tableName, fieldName);                                     </span>
<span class="-4165873345254348507" onmouseenter="enter('-4165873345254348507');" onmouseout="out('-4165873345254348507');" style=""><abbr title=" 268              Preconditions.checkNotNull(mappingFieldName, fieldInfo + &quot; not mapping any field! it may be frame bug&quot;);"> 268              Preconditions.checkNotNull(mappingFieldName, fieldInfo + &quot; not mapping any field! it may be frame bug&quot;🔵</abbr></span>
<span  style=""> 269                                                                                                                    </span>
<span class="4913645198555706594" onmouseenter="enter('4913645198555706594');" onmouseout="out('4913645198555706594');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 270 -            sideOutTypes[i] = fieldInfo.getTypeInformation();                                                     </span>
<span class="-4639076863607040957" onmouseenter="enter('-4639076863607040957');" onmouseout="out('-4639076863607040957');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 271 +            sideOutTypes[i] = fieldInfo.getLogicalType();                                                         </span>
<span class="6276485717663783154" onmouseenter="enter('6276485717663783154');" onmouseout="out('6276485717663783154');" style=""> 272              sideOutNames[i] = mappingFieldName;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273          }                                                                                                         </span>
<span class="2691939759498133513" onmouseenter="enter('2691939759498133513');" onmouseout="out('2691939759498133513');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 274 -        return new RowTypeInfo(sideOutTypes, sideOutNames);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 275 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 276 -                                                                                                                  </span>
<span class="-8180554737552837485" onmouseenter="enter('-8180554737552837485');" onmouseout="out('-8180554737552837485');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 277 +        return new BaseRowTypeInfo(sideOutTypes, sideOutNames);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 278 +    }                                                                                                             </span>
<span  style=""> 279                                                                                                                    </span>
<span  style=""> 280                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 281      /**                                                                                                           </span>
<span class="4027944609056411189" onmouseenter="enter('4027944609056411189');" onmouseout="out('4027944609056411189');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 282 -     *  对时间类型进行类型转换                                                                                               </span>
<span class="-7122456494290950261" onmouseenter="enter('-7122456494290950261');" onmouseout="out('-7122456494290950261');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 283 +     * 对时间类型进行类型转换                                                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 284 +     *                                                                                                            </span>
<span class="-7981851073621455488" onmouseenter="enter('-7981851073621455488');" onmouseout="out('-7981851073621455488');" style=""> 285       * @param leftTypeInfo                                                                                        </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 286       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 287       */                                                                                                           </span>
<span class="109255438874014135" onmouseenter="enter('109255438874014135');" onmouseout="out('109255438874014135');" style=""> 288      private RowTypeInfo buildLeftTableOutType(RowTypeInfo leftTypeInfo) {                                         </span>
<span class="5269317691380571116" onmouseenter="enter('5269317691380571116');" onmouseout="out('5269317691380571116');" style=""> 289          TypeInformation[] sideOutTypes = new TypeInformation[leftTypeInfo.getFieldNames().length];                </span>
<span class="357447233987634249" onmouseenter="enter('357447233987634249');" onmouseout="out('357447233987634249');" style=""> 290          TypeInformation&lt;?&gt;[] fieldTypes = leftTypeInfo.getFieldTypes();                                           </span>
<span class="-7313385440196867180" onmouseenter="enter('-7313385440196867180');" onmouseout="out('-7313385440196867180');" style=""> 291          for (int i = 0; i &lt; sideOutTypes.length; i++) {                                                           </span>
<span class="-314833607359598646" onmouseenter="enter('-314833607359598646');" onmouseout="out('-314833607359598646');" style=""> 292              sideOutTypes[i] = convertTimeAttributeType(fieldTypes[i]);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293          }                                                                                                         </span>
<span class="-6446480870466684625" onmouseenter="enter('-6446480870466684625');" onmouseout="out('-6446480870466684625');" style=""> 294          RowTypeInfo rowTypeInfo = new RowTypeInfo(sideOutTypes, leftTypeInfo.getFieldNames());                    </span>
<span class="6189116692514123920" onmouseenter="enter('6189116692514123920');" onmouseout="out('6189116692514123920');" style=""> 295          return rowTypeInfo;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296      }                                                                                                             </span>
<span  style=""> 297                                                                                                                    </span>
<span class="2471506251995792847" onmouseenter="enter('2471506251995792847');" onmouseout="out('2471506251995792847');" style=""> 298      private TypeInformation convertTimeAttributeType(TypeInformation typeInformation) {                           </span>
<span class="2997926285576198837" onmouseenter="enter('2997926285576198837');" onmouseout="out('2997926285576198837');" style=""> 299          if (typeInformation instanceof TimeIndicatorTypeInfo) {                                                   </span>
<span class="-4699013589387269243" onmouseenter="enter('-4699013589387269243');" onmouseout="out('-4699013589387269243');" style=""> 300              return TypeInformation.of(LocalDateTime.class);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301          }                                                                                                         </span>
<span class="6871348106862514693" onmouseenter="enter('6871348106862514693');" onmouseout="out('6871348106862514693');" style=""> 302          return typeInformation;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303      }                                                                                                             </span>
<span  style=""> 304                                                                                                                    </span>
<span  style=""> 305                                                                                                                    </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 306 -                                                                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 307 -                                                                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 308 -                                                                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 309 -                                                                                                                  </span>
<span class="-6722855011181273565" onmouseenter="enter('-6722855011181273565');" onmouseout="out('-6722855011181273565');" style=""> 310      public void setLocalSqlPluginPath(String localSqlPluginPath) {                                                </span>
<span class="6258662942576926140" onmouseenter="enter('6258662942576926140');" onmouseout="out('6258662942576926140');" style=""> 311          this.localSqlPluginPath = localSqlPluginPath;                                                             </span>




<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312      }                                                                                                             </span>
<span  style=""> 313                                                                                                                    </span>
<span class="2277905399441322839" onmouseenter="enter('2277905399441322839');" onmouseout="out('2277905399441322839');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 314 -    private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableName){     </span>
<span class="6507980841648709304" onmouseenter="enter('6507980841648709304');" onmouseout="out('6507980841648709304');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 315 +    private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableName) {    </span>
<span class="-6301156236825066460" onmouseenter="enter('-6301156236825066460');" onmouseout="out('-6301156236825066460');" style=""> 316          Table table = localTableCache.get(tableAlias);                                                            </span>
<span class="2042916935617835771" onmouseenter="enter('2042916935617835771');" onmouseout="out('2042916935617835771');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 317 -        if(table == null){                                                                                        </span>
<span class="1637251780061381079" onmouseenter="enter('1637251780061381079');" onmouseout="out('1637251780061381079');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 318 +        if (table == null) {                                                                                      </span>
<span class="-5960895848666330323" onmouseenter="enter('-5960895848666330323');" onmouseout="out('-5960895848666330323');" style=""> 319              table = localTableCache.get(tableName);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320          }                                                                                                         </span>
<span  style=""> 321                                                                                                                    </span>
<span class="2042916935617835771" onmouseenter="enter('2042916935617835771');" onmouseout="out('2042916935617835771');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 322 -        if(table == null){                                                                                        </span>
<span class="1637251780061381079" onmouseenter="enter('1637251780061381079');" onmouseout="out('1637251780061381079');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 323 +        if (table == null) {                                                                                      </span>
<span class="4627225224916806199" onmouseenter="enter('4627225224916806199');" onmouseout="out('4627225224916806199');" style=""> 324              throw new RuntimeException(&quot;not register table &quot; + tableAlias);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325          }                                                                                                         </span>
<span  style=""> 326                                                                                                                    </span>
<span class="-6017334383208509278" onmouseenter="enter('-6017334383208509278');" onmouseout="out('-6017334383208509278');" style=""> 327          return table;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328      }                                                                                                             </span>
<span  style=""> 329                                                                                                                    </span>
<span  style=""> 330                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 331      /**                                                                                                           </span>
<span class="5196638318686351881" onmouseenter="enter('5196638318686351881');" onmouseout="out('5196638318686351881');" style=""><abbr title=" 332       * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., dimension table is the primary key definition"> 332       * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., dimension 🔵</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 333       *                                                                                                            </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 334       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 335       */                                                                                                           </span>
<span class="4488554625343324946" onmouseenter="enter('4488554625343324946');" onmouseout="out('4488554625343324946');" style=""><abbr title=" 336      private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInfo sideTableInfo) {"> 336      private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInfo sideTab🔵</abbr></span>
<span class="-6710736308674703771" onmouseenter="enter('-6710736308674703771');" onmouseout="out('-6710736308674703771');" style=""> 337          List&lt;String&gt; conditionFields = getConditionFields(conditionNode, sideTableAlias, sideTableInfo);          </span>
<span class="-3924194481322428470" onmouseenter="enter('-3924194481322428470');" onmouseout="out('-3924194481322428470');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 338 -        if(CollectionUtils.isEqualCollection(conditionFields, convertPrimaryAlias(sideTableInfo))){               </span>
<span class="8847075305465358712" onmouseenter="enter('8847075305465358712');" onmouseout="out('8847075305465358712');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 339 +        if (CollectionUtils.isEqualCollection(conditionFields, convertPrimaryAlias(sideTableInfo))) {             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 340              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 341          }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 342          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 343      }                                                                                                             </span>
<span  style=""> 344                                                                                                                    </span>
<span class="572998504046101497" onmouseenter="enter('572998504046101497');" onmouseout="out('572998504046101497');" style=""> 345      private List&lt;String&gt; convertPrimaryAlias(AbstractSideTableInfo sideTableInfo) {                               </span>
<span class="-6700733268022775520" onmouseenter="enter('-6700733268022775520');" onmouseout="out('-6700733268022775520');" style=""> 346          List&lt;String&gt; res = Lists.newArrayList();                                                                  </span>
<span class="-1517278133900331130" onmouseenter="enter('-1517278133900331130');" onmouseout="out('-1517278133900331130');" style=""> 347          sideTableInfo.getPrimaryKeys().forEach(field -&gt; {                                                         </span>
<span class="2991641550935988694" onmouseenter="enter('2991641550935988694');" onmouseout="out('2991641550935988694');" style=""> 348              res.add(sideTableInfo.getPhysicalFields().getOrDefault(field, field));                                </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 349          });                                                                                                       </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 350          return res;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351      }                                                                                                             </span>
<span  style=""> 352                                                                                                                    </span>
<span class="-958139939083183834" onmouseenter="enter('-958139939083183834');" onmouseout="out('-958139939083183834');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 353 -    public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTableInfo sideTableInfo){"> 353 -    public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTableInfo s🔵</abbr></span>
<span class="6064840374032880755" onmouseenter="enter('6064840374032880755');" onmouseout="out('6064840374032880755');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 354 +    public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTableInfo sideTableInfo) {"> 354 +    public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTableInfo s🔵</abbr></span>
<span class="-5667062641477778387" onmouseenter="enter('-5667062641477778387');" onmouseout="out('-5667062641477778387');" style=""> 355          List&lt;SqlNode&gt; sqlNodeList = Lists.newArrayList();                                                         </span>
<span class="5003747983397221043" onmouseenter="enter('5003747983397221043');" onmouseout="out('5003747983397221043');" style=""> 356          ParseUtils.parseAnd(conditionNode, sqlNodeList);                                                          </span>
<span class="331902561671078290" onmouseenter="enter('331902561671078290');" onmouseout="out('331902561671078290');" style=""> 357          List&lt;String&gt; conditionFields = Lists.newArrayList();                                                      </span>
<span class="-2336842894952786561" onmouseenter="enter('-2336842894952786561');" onmouseout="out('-2336842894952786561');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 358 -        for(SqlNode sqlNode : sqlNodeList){                                                                       </span>
<span class="4227493740309250661" onmouseenter="enter('4227493740309250661');" onmouseout="out('4227493740309250661');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 359 +        for (SqlNode sqlNode : sqlNodeList) {                                                                     </span>
<span class="-1235221313035004193" onmouseenter="enter('-1235221313035004193');" onmouseout="out('-1235221313035004193');" style=""> 360              if (!SqlKind.COMPARISON.contains(sqlNode.getKind())) {                                                </span>
<span class="4238811186041433324" onmouseenter="enter('4238811186041433324');" onmouseout="out('4238811186041433324');" style=""> 361                  throw new RuntimeException(&quot;not compare operator.&quot;);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 362              }                                                                                                     </span>
<span  style=""> 363                                                                                                                    </span>
<span class="-7359051973666627295" onmouseenter="enter('-7359051973666627295');" onmouseout="out('-7359051973666627295');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 364 -            SqlIdentifier left = (SqlIdentifier)((SqlBasicCall)sqlNode).getOperands()[0];                         </span>
<span class="3465298874779506196" onmouseenter="enter('3465298874779506196');" onmouseout="out('3465298874779506196');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 365 -            SqlIdentifier right = (SqlIdentifier)((SqlBasicCall)sqlNode).getOperands()[1];                        </span>
<span class="-8493256683164626428" onmouseenter="enter('-8493256683164626428');" onmouseout="out('-8493256683164626428');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 366 +            SqlIdentifier left = (SqlIdentifier) ((SqlBasicCall) sqlNode).getOperands()[0];                       </span>
<span class="-2634508485734964862" onmouseenter="enter('-2634508485734964862');" onmouseout="out('-2634508485734964862');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 367 +            SqlIdentifier right = (SqlIdentifier) ((SqlBasicCall) sqlNode).getOperands()[1];                      </span>
<span  style=""> 368                                                                                                                    </span>
<span class="-2670749344655178863" onmouseenter="enter('-2670749344655178863');" onmouseout="out('-2670749344655178863');" style=""> 369              String leftTableName = left.getComponent(0).getSimple();                                              </span>
<span class="5188110590184041827" onmouseenter="enter('5188110590184041827');" onmouseout="out('5188110590184041827');" style=""> 370              String rightTableName = right.getComponent(0).getSimple();                                            </span>
<span  style=""> 371                                                                                                                    </span>
<span class="8082853509369418918" onmouseenter="enter('8082853509369418918');" onmouseout="out('8082853509369418918');" style=""> 372              String tableCol = &quot;&quot;;                                                                                 </span>
<span class="3869855333927982135" onmouseenter="enter('3869855333927982135');" onmouseout="out('3869855333927982135');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 373 -            if(leftTableName.equalsIgnoreCase(specifyTableName)){                                                 </span>
<span class="-1233782311271008501" onmouseenter="enter('-1233782311271008501');" onmouseout="out('-1233782311271008501');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 374 +            if (leftTableName.equalsIgnoreCase(specifyTableName)) {                                               </span>
<span class="4527748628163402760" onmouseenter="enter('4527748628163402760');" onmouseout="out('4527748628163402760');" style=""> 375                  tableCol = left.getComponent(1).getSimple();                                                      </span>
<span class="5068195286258055415" onmouseenter="enter('5068195286258055415');" onmouseout="out('5068195286258055415');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 376 -            }else if(rightTableName.equalsIgnoreCase(specifyTableName)){                                          </span>
<span class="-2773987473156284347" onmouseenter="enter('-2773987473156284347');" onmouseout="out('-2773987473156284347');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 377 +            } else if (rightTableName.equalsIgnoreCase(specifyTableName)) {                                       </span>
<span class="4462633703217831544" onmouseenter="enter('4462633703217831544');" onmouseout="out('4462633703217831544');" style=""> 378                  tableCol = right.getComponent(1).getSimple();                                                     </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 379 -            }else{                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 380 +            } else {                                                                                              </span>
<span class="3783543445731730404" onmouseenter="enter('3783543445731730404');" onmouseout="out('3783543445731730404');" style=""><abbr title=" 381                  throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specifyTableName));"> 381                  throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specifyTableName🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 382              }                                                                                                     </span>
<span class="-2325401555704525047" onmouseenter="enter('-2325401555704525047');" onmouseout="out('-2325401555704525047');" style=""> 383              tableCol = sideTableInfo.getPhysicalFields().getOrDefault(tableCol, tableCol);                        </span>
<span class="-4552234441929070616" onmouseenter="enter('-4552234441929070616');" onmouseout="out('-4552234441929070616');" style=""> 384              conditionFields.add(tableCol);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385          }                                                                                                         </span>
<span  style=""> 386                                                                                                                    </span>
<span class="4950082808497882460" onmouseenter="enter('4950082808497882460');" onmouseout="out('4950082808497882460');" style=""> 387          return conditionFields;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388      }                                                                                                             </span>
<span  style=""> 389                                                                                                                    </span>
<span class="-8173208587282838964" onmouseenter="enter('-8173208587282838964');" onmouseout="out('-8173208587282838964');" style=""> 390      protected void dealAsSourceTable(StreamTableEnvironment tableEnv,                                             </span>
<span class="9126592535894268017" onmouseenter="enter('9126592535894268017');" onmouseout="out('9126592535894268017');" style=""> 391                                       SqlNode pollSqlNode,                                                         </span>
<span class="-4636178628928660306" onmouseenter="enter('-4636178628928660306');" onmouseout="out('-4636178628928660306');" style=""> 392                                       Map&lt;String, Table&gt; tableCache) throws SqlParseException {                    </span>
<span  style=""> 393                                                                                                                    </span>
<span class="-7364020242551640527" onmouseenter="enter('-7364020242551640527');" onmouseout="out('-7364020242551640527');" style=""> 394          AliasInfo aliasInfo = parseASNode(pollSqlNode);                                                           </span>
<span class="2461088292100865778" onmouseenter="enter('2461088292100865778');" onmouseout="out('2461088292100865778');" style=""> 395          if (localTableCache.containsKey(aliasInfo.getName())) {                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 396              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 397          }                                                                                                         </span>
<span  style=""> 398                                                                                                                    </span>
<span class="-3390660419579622283" onmouseenter="enter('-3390660419579622283');" onmouseout="out('-3390660419579622283');" style=""> 399          Table table = tableEnv.sqlQuery(aliasInfo.getName());                                                     </span>
<span class="5901087968051131557" onmouseenter="enter('5901087968051131557');" onmouseout="out('5901087968051131557');" style=""> 400          tableEnv.registerTable(aliasInfo.getAlias(), table);                                                      </span>
<span class="1100939894023116874" onmouseenter="enter('1100939894023116874');" onmouseout="out('1100939894023116874');" style=""> 401          localTableCache.put(aliasInfo.getAlias(), table);                                                         </span>
<span  style=""> 402                                                                                                                    </span>
<span class="7353361537117728269" onmouseenter="enter('7353361537117728269');" onmouseout="out('7353361537117728269');" style=""> 403          LOG.info(&quot;Register Table {} by {}&quot;, aliasInfo.getAlias(), aliasInfo.getName());                           </span>
<span  style=""> 404                                                                                                                    </span>
<span class="-8665165690117838262" onmouseenter="enter('-8665165690117838262');" onmouseout="out('-8665165690117838262');" style=""> 405          FieldReplaceInfo fieldReplaceInfo = parseAsQuery((SqlBasicCall) pollSqlNode, tableCache);                 </span>
<span class="-7633956211129533821" onmouseenter="enter('-7633956211129533821');" onmouseout="out('-7633956211129533821');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 406 -        if(fieldReplaceInfo == null){                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 407 -           return;                                                                                                </span>
<span class="7661155268446817101" onmouseenter="enter('7661155268446817101');" onmouseout="out('7661155268446817101');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 408 +        if (fieldReplaceInfo == null) {                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 409 +            return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410          }                                                                                                         </span>
<span  style=""> 411                                                                                                                    </span>
<span class="-6438671410831308886" onmouseenter="enter('-6438671410831308886');" onmouseout="out('-6438671410831308886');" style=""> 412          //as 的源表                                                                                                  </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 413          Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                         </span>
<span class="-1390965398492412473" onmouseenter="enter('-1390965398492412473');" onmouseout="out('-1390965398492412473');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 414 -        SqlNode fromNode = ((SqlBasicCall)pollSqlNode).getOperands()[0];                                          </span>
<span class="1897837925292711985" onmouseenter="enter('1897837925292711985');" onmouseout="out('1897837925292711985');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 415 +        SqlNode fromNode = ((SqlBasicCall) pollSqlNode).getOperands()[0];                                         </span>
<span class="8218826531385538687" onmouseenter="enter('8218826531385538687');" onmouseout="out('8218826531385538687');" style=""> 416          TableUtils.getFromTableInfo(fromNode, fromTableNameSet);                                                  </span>
<span  style=""> 417                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 418      }                                                                                                             </span>
<span  style=""> 419                                                                                                                    </span>
<span class="-894097875121841059" onmouseenter="enter('-894097875121841059');" onmouseout="out('-894097875121841059');" style=""> 420      private void joinFun(Object pollObj,                                                                          </span>
<span class="6823594550750748067" onmouseenter="enter('6823594550750748067');" onmouseout="out('6823594550750748067');" style=""> 421                           Map&lt;String, Table&gt; localTableCache,                                                      </span>
<span class="-876340320175790120" onmouseenter="enter('-876340320175790120');" onmouseout="out('-876340320175790120');" style=""> 422                           Map&lt;String, AbstractSideTableInfo&gt; sideTableMap,                                         </span>
<span class="-1170693753985315194" onmouseenter="enter('-1170693753985315194');" onmouseout="out('-1170693753985315194');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 423 -                         StreamTableEnvironment tableEnv) throws Exception{                                       </span>
<span class="-6807648743793384568" onmouseenter="enter('-6807648743793384568');" onmouseout="out('-6807648743793384568');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 424 +                         StreamTableEnvironment tableEnv) throws Exception {                                      </span>
<span class="-3106951960183426296" onmouseenter="enter('-3106951960183426296');" onmouseout="out('-3106951960183426296');" style=""> 425          JoinInfo joinInfo = (JoinInfo) pollObj;                                                                   </span>
<span  style=""> 426                                                                                                                    </span>
<span class="-4580559439294190862" onmouseenter="enter('-4580559439294190862');" onmouseout="out('-4580559439294190862');" style=""> 427          JoinScope joinScope = new JoinScope();                                                                    </span>
<span class="-6383140859888654083" onmouseenter="enter('-6383140859888654083');" onmouseout="out('-6383140859888654083');" style=""> 428          JoinScope.ScopeChild leftScopeChild = new JoinScope.ScopeChild();                                         </span>
<span class="-5401707331330951256" onmouseenter="enter('-5401707331330951256');" onmouseout="out('-5401707331330951256');" style=""> 429          leftScopeChild.setAlias(joinInfo.getLeftTableAlias());                                                    </span>
<span class="5108424867732442426" onmouseenter="enter('5108424867732442426');" onmouseout="out('5108424867732442426');" style=""> 430          leftScopeChild.setTableName(joinInfo.getLeftTableName());                                                 </span>
<span  style=""> 431                                                                                                                    </span>
<span class="-2402361542513321069" onmouseenter="enter('-2402361542513321069');" onmouseout="out('-2402361542513321069');" style=""><abbr title=" 432          Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLeftTableName());"> 432          Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLeftTableNa🔵</abbr></span>
<span  style=""> 433                                                                                                                    </span>
<span class="-6003115091233455661" onmouseenter="enter('-6003115091233455661');" onmouseout="out('-6003115091233455661');" style=""><abbr title=" 434          RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getFieldTypes(), leftTable.getSchema().getFieldNames());"> 434          RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getFieldTypes(), leftTable.getSchema().ge🔵</abbr></span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 435 +                                                                                                                  </span>
<span class="6844734750257063206" onmouseenter="enter('6844734750257063206');" onmouseout="out('6844734750257063206');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 436 +        int length = leftTable.getSchema().getFieldDataTypes().length;                                            </span>
<span class="-7291542410657351968" onmouseenter="enter('-7291542410657351968');" onmouseout="out('-7291542410657351968');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 437 +        LogicalType[] logicalTypes = new LogicalType[length];                                                     </span>
<span class="-2303162855932529930" onmouseenter="enter('-2303162855932529930');" onmouseout="out('-2303162855932529930');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 438 +        for(int i=0; i&lt;length; i++){                                                                              </span>
<span class="1537154519277872520" onmouseenter="enter('1537154519277872520');" onmouseout="out('1537154519277872520');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 439 +            logicalTypes[i] = leftTable.getSchema().getFieldDataTypes()[i].getLogicalType();                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 440 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 441 +                                                                                                                  </span>
<span class="6552727302564022327" onmouseenter="enter('6552727302564022327');" onmouseout="out('6552727302564022327');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 442 +        BaseRowTypeInfo leftBaseTypeInfo = new BaseRowTypeInfo(logicalTypes, leftTable.getSchema().getFieldNames());"> 442 +        BaseRowTypeInfo leftBaseTypeInfo = new BaseRowTypeInfo(logicalTypes, leftTable.getSchema().getFieldNames()🔵</abbr></span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 443 +                                                                                                                  </span>
<span class="-5303860989220332569" onmouseenter="enter('-5303860989220332569');" onmouseout="out('-5303860989220332569');" style=""> 444          leftScopeChild.setRowTypeInfo(leftTypeInfo);                                                              </span>
<span class="-4838857475621068375" onmouseenter="enter('-4838857475621068375');" onmouseout="out('-4838857475621068375');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 445 +        leftScopeChild.setBaseRowTypeInfo(leftBaseTypeInfo);                                                      </span>
<span  style=""> 446                                                                                                                    </span>
<span class="3043795906382715340" onmouseenter="enter('3043795906382715340');" onmouseout="out('3043795906382715340');" style=""> 447          JoinScope.ScopeChild rightScopeChild = new JoinScope.ScopeChild();                                        </span>
<span class="2585249270397691815" onmouseenter="enter('2585249270397691815');" onmouseout="out('2585249270397691815');" style=""> 448          rightScopeChild.setAlias(joinInfo.getRightTableAlias());                                                  </span>
<span class="-5072747544386586876" onmouseenter="enter('-5072747544386586876');" onmouseout="out('-5072747544386586876');" style=""> 449          rightScopeChild.setTableName(joinInfo.getRightTableName());                                               </span>
<span class="-6382774479188932768" onmouseenter="enter('-6382774479188932768');" onmouseout="out('-6382774479188932768');" style=""> 450          AbstractSideTableInfo sideTableInfo = sideTableMap.get(joinInfo.getRightTableName());                     </span>
<span class="-2759210686353099969" onmouseenter="enter('-2759210686353099969');" onmouseout="out('-2759210686353099969');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 451 -        if(sideTableInfo == null){                                                                                </span>
<span class="-4894423646294599023" onmouseenter="enter('-4894423646294599023');" onmouseout="out('-4894423646294599023');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 452 +        if (sideTableInfo == null) {                                                                              </span>
<span class="-5396801098824602905" onmouseenter="enter('-5396801098824602905');" onmouseout="out('-5396801098824602905');" style=""> 453              sideTableInfo = sideTableMap.get(joinInfo.getRightTableAlias());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 454          }                                                                                                         </span>
<span  style=""> 455                                                                                                                    </span>
<span class="-2759210686353099969" onmouseenter="enter('-2759210686353099969');" onmouseout="out('-2759210686353099969');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 456 -        if(sideTableInfo == null){                                                                                </span>
<span class="-4894423646294599023" onmouseenter="enter('-4894423646294599023');" onmouseout="out('-4894423646294599023');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 457 +        if (sideTableInfo == null) {                                                                              </span>
<span class="450947362076537032" onmouseenter="enter('450947362076537032');" onmouseout="out('450947362076537032');" style=""> 458              throw new RuntimeException(&quot;can&#x27;t not find side table:&quot; + joinInfo.getRightTableName());              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 459          }                                                                                                         </span>
<span  style=""> 460                                                                                                                    </span>
<span class="-1562873445908102884" onmouseenter="enter('-1562873445908102884');" onmouseout="out('-1562873445908102884');" style=""> 461          rightScopeChild.setRowTypeInfo(sideTableInfo.getRowTypeInfo());                                           </span>
<span class="76578225160811915" onmouseenter="enter('76578225160811915');" onmouseout="out('76578225160811915');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 462 +        rightScopeChild.setBaseRowTypeInfo(sideTableInfo.getBaseRowTypeInfo());                                   </span>
<span  style=""> 463                                                                                                                    </span>
<span class="-5776192160472100987" onmouseenter="enter('-5776192160472100987');" onmouseout="out('-5776192160472100987');" style=""> 464          joinScope.addScope(leftScopeChild);                                                                       </span>
<span class="6805588345897841594" onmouseenter="enter('6805588345897841594');" onmouseout="out('6805588345897841594');" style=""> 465          joinScope.addScope(rightScopeChild);                                                                      </span>
<span  style=""> 466                                                                                                                    </span>
<span class="2226908158928528195" onmouseenter="enter('2226908158928528195');" onmouseout="out('2226908158928528195');" style=""> 467          HashBasedTable&lt;String, String, String&gt; mappingTable = ((JoinInfo) pollObj).getTableFieldRef();            </span>
<span  style=""> 468                                                                                                                    </span>
<span class="-816440763270240777" onmouseenter="enter('-816440763270240777');" onmouseout="out('-816440763270240777');" style=""> 469          //获取两个表的所有字段                                                                                              </span>
<span class="-6198283029075022684" onmouseenter="enter('-6198283029075022684');" onmouseout="out('-6198283029075022684');" style=""><abbr title=" 470          List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), joinScope, true);"> 470          List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), joinScope, tr🔵</abbr></span>
<span class="5016458903510526292" onmouseenter="enter('5016458903510526292');" onmouseout="out('5016458903510526292');" style=""> 471          //通过join的查询字段信息过滤出需要的字段信息                                                                                 </span>
<span class="5211893312708517501" onmouseenter="enter('5211893312708517501');" onmouseout="out('5211893312708517501');" style=""><abbr title=" 472          sideJoinFieldInfo.removeIf(tmpFieldInfo -&gt; mappingTable.get(tmpFieldInfo.getTable(), tmpFieldInfo.getFieldName()) == null);"> 472          sideJoinFieldInfo.removeIf(tmpFieldInfo -&gt; mappingTable.get(tmpFieldInfo.getTable(), tmpFieldInfo.getField🔵</abbr></span>
<span  style=""> 473                                                                                                                    </span>
<span class="-1467815726997680818" onmouseenter="enter('-1467815726997680818');" onmouseout="out('-1467815726997680818');" style=""> 474          String leftTableAlias = joinInfo.getLeftTableAlias();                                                     </span>
<span class="-6434853421912213287" onmouseenter="enter('-6434853421912213287');" onmouseout="out('-6434853421912213287');" style=""> 475          Table targetTable = localTableCache.get(leftTableAlias);                                                  </span>
<span class="-6749372432358522016" onmouseenter="enter('-6749372432358522016');" onmouseout="out('-6749372432358522016');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 476 -        if(targetTable == null){                                                                                  </span>
<span class="7125781324026312556" onmouseenter="enter('7125781324026312556');" onmouseout="out('7125781324026312556');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 477 +        if (targetTable == null) {                                                                                </span>
<span class="8734197217231436839" onmouseenter="enter('8734197217231436839');" onmouseout="out('8734197217231436839');" style=""> 478              targetTable = localTableCache.get(joinInfo.getLeftTableName());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 479          }                                                                                                         </span>
<span  style=""> 480                                                                                                                    </span>
<span class="-1157067725052643612" onmouseenter="enter('-1157067725052643612');" onmouseout="out('-1157067725052643612');" style=""><abbr title=" 481          RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getFieldTypes(), targetTable.getSchema().getFieldNames());"> 481          RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getFieldTypes(), targetTable.getSchema().ge🔵</abbr></span>
<span  style=""> 482                                                                                                                    </span>
<span class="8331408572102109154" onmouseenter="enter('8331408572102109154');" onmouseout="out('8331408572102109154');" style=""> 483          DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; adaptStream = tableEnv.toRetractStream(targetTable, Row.class);          </span>
<span  style=""> 484                                                                                                                    </span>
<span class="-6082173173678345991" onmouseenter="enter('-6082173173678345991');" onmouseout="out('-6082173173678345991');" style=""> 485          //join side table before keyby ===&gt; Reducing the size of each dimension table cache of async              </span>
<span class="6301552848628110191" onmouseenter="enter('6301552848628110191');" onmouseout="out('6301552848628110191');" style=""> 486          if (sideTableInfo.isPartitionedJoin()) {                                                                  </span>
<span class="-4638861421651181765" onmouseenter="enter('-4638861421651181765');" onmouseout="out('-4638861421651181765');" style=""><abbr title=" 487              List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTableAlias(), sideTableInfo);"> 487              List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTableAlias(🔵</abbr></span>
<span class="-1086375650130423707" onmouseenter="enter('-1086375650130423707');" onmouseout="out('-1086375650130423707');" style=""> 488              List&lt;String&gt; fieldNames = Arrays.asList(targetTable.getSchema().getFieldNames());                     </span>
<span class="2517152886952033206" onmouseenter="enter('2517152886952033206');" onmouseout="out('2517152886952033206');" style=""> 489              int[] keyIndex = leftJoinColList.stream().mapToInt(fieldNames::indexOf).toArray();                    </span>
<span class="-1034511431639552497" onmouseenter="enter('-1034511431639552497');" onmouseout="out('-1034511431639552497');" style=""><abbr title=" 490              adaptStream = adaptStream.keyBy(new TupleKeySelector(keyIndex, projectedTypeInfo(keyIndex, targetTable.getSchema())));"> 490              adaptStream = adaptStream.keyBy(new TupleKeySelector(keyIndex, projectedTypeInfo(keyIndex, targetTable🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 491          }                                                                                                         </span>
<span  style=""> 492                                                                                                                    </span>
<span class="8900898589811243168" onmouseenter="enter('8900898589811243168');" onmouseout="out('8900898589811243168');" style=""> 493          DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; dsOut = null;                                                            </span>
<span class="3901580925108094660" onmouseenter="enter('3901580925108094660');" onmouseout="out('3901580925108094660');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 494 -        if(ECacheType.ALL.name().equalsIgnoreCase(sideTableInfo.getCacheType())){                                 </span>
<span class="9130962490964334732" onmouseenter="enter('9130962490964334732');" onmouseout="out('9130962490964334732');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 495 +        if (ECacheType.ALL.name().equalsIgnoreCase(sideTableInfo.getCacheType())) {                               </span>
<span class="7101184136852303035" onmouseenter="enter('7101184136852303035');" onmouseout="out('7101184136852303035');" style=""><abbr title=" 496              dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo);"> 496              dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlP🔵</abbr></span>

<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 497 -        }else{                                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 498 +        } else {                                                                                                  </span>
<span class="7683243294616380271" onmouseenter="enter('7683243294616380271');" onmouseout="out('7683243294616380271');" style=""><abbr title=" 499              dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo);"> 499              dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPa🔵</abbr></span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 500          }                                                                                                         </span>
<span  style=""> 501                                                                                                                    </span>
<span class="2474148199265091642" onmouseenter="enter('2474148199265091642');" onmouseout="out('2474148199265091642');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 502 -        RowTypeInfo sideOutTypeInfo = buildOutRowTypeInfo(sideJoinFieldInfo, mappingTable);                       </span>
<span class="-7650178877830471821" onmouseenter="enter('-7650178877830471821');" onmouseout="out('-7650178877830471821');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 503 +        BaseRowTypeInfo sideOutTypeInfo = buildOutRowTypeInfo(sideJoinFieldInfo, mappingTable);                   </span>
<span  style=""> 504                                                                                                                    </span>
<span class="993314962060447081" onmouseenter="enter('993314962060447081');" onmouseout="out('993314962060447081');" style=""> 505          TupleTypeInfo tupleTypeInfo = new TupleTypeInfo(Types.BOOLEAN, sideOutTypeInfo);                          </span>
<span class="6600937869795732915" onmouseenter="enter('6600937869795732915');" onmouseout="out('6600937869795732915');" style=""> 506          dsOut.getTransformation().setOutputType(tupleTypeInfo);                                                   </span>
<span  style=""> 507                                                                                                                    </span>
<span class="4836712590888983064" onmouseenter="enter('4836712590888983064');" onmouseout="out('4836712590888983064');" style=""> 508          String targetTableName = joinInfo.getNewTableName();                                                      </span>
<span class="-3094587764130774762" onmouseenter="enter('-3094587764130774762');" onmouseout="out('-3094587764130774762');" style=""> 509          String targetTableAlias = joinInfo.getNewTableAlias();                                                    </span>
<span  style=""> 510                                                                                                                    </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 511          FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                                    </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 512          replaceInfo.setMappingTable(mappingTable);                                                                </span>
<span class="8710576405434192583" onmouseenter="enter('8710576405434192583');" onmouseout="out('8710576405434192583');" style=""> 513          replaceInfo.setTargetTableName(targetTableName);                                                          </span>
<span class="-6613112199475906839" onmouseenter="enter('-6613112199475906839');" onmouseout="out('-6613112199475906839');" style=""> 514          replaceInfo.setTargetTableAlias(targetTableAlias);                                                        </span>
<span  style=""> 515                                                                                                                    </span>
<span class="-7199180706663944207" onmouseenter="enter('-7199180706663944207');" onmouseout="out('-7199180706663944207');" style=""> 516          ObjectIdentifier objectIdentifier = ObjectIdentifier.of(                                                  </span>
<span class="-8235548579753933527" onmouseenter="enter('-8235548579753933527');" onmouseout="out('-8235548579753933527');" style=""> 517                  EnvironmentSettings.DEFAULT_BUILTIN_CATALOG,                                                      </span>
<span class="-4707782382614212141" onmouseenter="enter('-4707782382614212141');" onmouseout="out('-4707782382614212141');" style=""> 518                  EnvironmentSettings.DEFAULT_BUILTIN_DATABASE,                                                     </span>
<span class="-5532274924697595213" onmouseenter="enter('-5532274924697595213');" onmouseout="out('-5532274924697595213');" style=""> 519                  targetTableName);                                                                                 </span>
<span class="5891773481881515301" onmouseenter="enter('5891773481881515301');" onmouseout="out('5891773481881515301');" style=""><abbr title=" 520          boolean tableExists = tableEnv.getCatalog(EnvironmentSettings.DEFAULT_BUILTIN_CATALOG).get().tableExists(objectIdentifier.toObjectPath());"> 520          boolean tableExists = tableEnv.getCatalog(EnvironmentSettings.DEFAULT_BUILTIN_CATALOG).get().tableExists(o🔵</abbr></span>
<span  style=""> 521                                                                                                                    </span>
<span class="-3741652885152135341" onmouseenter="enter('-3741652885152135341');" onmouseout="out('-3741652885152135341');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 522 -        if (!tableExists){                                                                                        </span>
<span class="1897990848761003813" onmouseenter="enter('1897990848761003813');" onmouseout="out('1897990848761003813');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 523 +        if (!tableExists) {                                                                                       </span>
<span class="-9057257427162955657" onmouseenter="enter('-9057257427162955657');" onmouseout="out('-9057257427162955657');" style=""> 524              Table joinTable = tableEnv.fromDataStream(dsOut);                                                     </span>
<span class="7656863459817986298" onmouseenter="enter('7656863459817986298');" onmouseout="out('7656863459817986298');" style=""> 525              tableEnv.createTemporaryView(targetTableName, joinTable);                                             </span>
<span class="5569875846259576593" onmouseenter="enter('5569875846259576593');" onmouseout="out('5569875846259576593');" style=""> 526              localTableCache.put(joinInfo.getNewTableName(), joinTable);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 527          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 528      }                                                                                                             </span>
<span  style=""> 529                                                                                                                    </span>
<span class="2503560481488678812" onmouseenter="enter('2503560481488678812');" onmouseout="out('2503560481488678812');" style=""> 530      private TypeInformation&lt;Row&gt; projectedTypeInfo(int[] fields, TableSchema schema) {                            </span>
<span class="-934325254904626531" onmouseenter="enter('-934325254904626531');" onmouseout="out('-934325254904626531');" style=""> 531          String[] fieldNames = schema.getFieldNames();                                                             </span>
<span class="4556717060829301814" onmouseenter="enter('4556717060829301814');" onmouseout="out('4556717060829301814');" style=""> 532          TypeInformation&lt;?&gt;[] fieldTypes = schema.getFieldTypes();                                                 </span>
<span  style=""> 533                                                                                                                    </span>
<span class="424178526470659793" onmouseenter="enter('424178526470659793');" onmouseout="out('424178526470659793');" style=""> 534          String[] projectedNames = Arrays.stream(fields).mapToObj(i -&gt; fieldNames[i]).toArray(String[]::new);      </span>
<span class="5411397013359382914" onmouseenter="enter('5411397013359382914');" onmouseout="out('5411397013359382914');" style=""><abbr title=" 535          TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(i -&gt; fieldTypes[i]).toArray(TypeInformation[]::new);"> 535          TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(i -&gt; fieldTypes[i]).toArray(TypeInformat🔵</abbr></span>
<span class="-5627838059420262860" onmouseenter="enter('-5627838059420262860');" onmouseout="out('-5627838059420262860');" style=""> 536          return new RowTypeInfo(projectedTypes, projectedNames);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 537      }                                                                                                             </span>
<span  style=""> 538                                                                                                                    </span>
<span  style=""> 539                                                                                                                    </span>
<span class="-410103274617159114" onmouseenter="enter('-410103274617159114');" onmouseout="out('-410103274617159114');" style=""> 540      private boolean checkFieldsInfo(CreateTmpTableParser.SqlParserResult result, Table table) {                   </span>
<span class="8925867441251499081" onmouseenter="enter('8925867441251499081');" onmouseout="out('8925867441251499081');" style=""> 541          List&lt;String&gt; fieldNames = new LinkedList&lt;&gt;();                                                             </span>
<span class="-5553816012496774052" onmouseenter="enter('-5553816012496774052');" onmouseout="out('-5553816012496774052');" style=""> 542          String fieldsInfo = result.getFieldsInfoStr();                                                            </span>
<span class="-5855731071361337066" onmouseenter="enter('-5855731071361337066');" onmouseout="out('-5855731071361337066');" style=""> 543          String[] fields = StringUtils.split(fieldsInfo, &quot;,&quot;);                                                     </span>
<span class="8167763809890058258" onmouseenter="enter('8167763809890058258');" onmouseout="out('8167763809890058258');" style=""> 544          for (int i = 0; i &lt; fields.length; i++) {                                                                 </span>
<span class="2947314498030065040" onmouseenter="enter('2947314498030065040');" onmouseout="out('2947314498030065040');" style=""> 545              String[] filed = fields[i].split(&quot;\\s&quot;);                                                              </span>
<span class="5889723123831816710" onmouseenter="enter('5889723123831816710');" onmouseout="out('5889723123831816710');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 546 -            if (filed.length &lt; 2 || fields.length != table.getSchema().getFieldCount()){                          </span>
<span class="-270449140289704814" onmouseenter="enter('-270449140289704814');" onmouseout="out('-270449140289704814');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 547 +            if (filed.length &lt; 2 || fields.length != table.getSchema().getFieldCount()) {                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 548                  return false;                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 549              } else {                                                                                              </span>
<span class="-7518627407039835792" onmouseenter="enter('-7518627407039835792');" onmouseout="out('-7518627407039835792');" style=""> 550                  String[] filedNameArr = new String[filed.length - 1];                                             </span>
<span class="6064994574122217386" onmouseenter="enter('6064994574122217386');" onmouseout="out('6064994574122217386');" style=""> 551                  System.arraycopy(filed, 0, filedNameArr, 0, filed.length - 1);                                    </span>
<span class="-3029457015937137256" onmouseenter="enter('-3029457015937137256');" onmouseout="out('-3029457015937137256');" style=""> 552                  String fieldName = String.join(&quot; &quot;, filedNameArr);                                                </span>
<span class="-8037943253867791720" onmouseenter="enter('-8037943253867791720');" onmouseout="out('-8037943253867791720');" style=""> 553                  fieldNames.add(fieldName);                                                                        </span>
<span class="516386479555957316" onmouseenter="enter('516386479555957316');" onmouseout="out('516386479555957316');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 554 -                String fieldType = filed[filed.length - 1 ].trim();                                               </span>
<span class="5681537301300222292" onmouseenter="enter('5681537301300222292');" onmouseout="out('5681537301300222292');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 555 +                String fieldType = filed[filed.length - 1].trim();                                                </span>
<span class="-8511761590344571010" onmouseenter="enter('-8511761590344571010');" onmouseout="out('-8511761590344571010');" style=""> 556                  Class fieldClass = ClassUtil.stringConvertClass(fieldType);                                       </span>
<span class="-351203522969775469" onmouseenter="enter('-351203522969775469');" onmouseout="out('-351203522969775469');" style=""> 557                  Class tableField = table.getSchema().getFieldType(i).get().getTypeClass();                        </span>
<span class="9126336856345087988" onmouseenter="enter('9126336856345087988');" onmouseout="out('9126336856345087988');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 558 -                if (fieldClass == tableField){                                                                    </span>
<span class="-2055572975849334800" onmouseenter="enter('-2055572975849334800');" onmouseout="out('-2055572975849334800');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 559 +                if (fieldClass == tableField) {                                                                   </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 560                      continue;                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 561                  } else {                                                                                          </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 562                      return false;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 563                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 564              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 565          }                                                                                                         </span>
<span class="-7181802501759976675" onmouseenter="enter('-7181802501759976675');" onmouseout="out('-7181802501759976675');" style=""> 566          tmpFields = String.join(&quot;,&quot;, fieldNames);                                                                 </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 567          return true;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 568      }                                                                                                             </span>
<span  style=""> 569                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 570  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            