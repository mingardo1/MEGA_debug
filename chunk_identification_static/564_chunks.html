<!DOCTYPE html>
<html lang="en">
          <head>
            <meta charset="utf-8">
            <title>564 chunks</title>
                <style>
                    #top {
                        height: 48vh;
                        overflow-y: auto;
                    }
                    #bottom {
                        height: 48vh;
                        overflow-y: auto;
                    }
                </style>
          </head>
          <body>
            <pre>[[{&#x27;eq&#x27;: [{&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;/**\n&#x27;
                           &#x27; * Licensed to the Apache Software Foundation &#x27;
                           &#x27;(ASF) under one\n&#x27;
                           &#x27; * or more contributor license agreements.  See &#x27;
                           &#x27;the NOTICE file\n&#x27;
                           &#x27; * distributed with this work for additional &#x27;
                           &#x27;information\n&#x27;
                           &#x27; * regarding copyright ownership.  The ASF &#x27;
                           &#x27;licenses this file\n&#x27;
                           &#x27; * to you under the Apache License, Version 2.0 &#x27;
                           &#x27;(the\n&#x27;
                           &#x27; * &quot;License&quot;); you may not use this file except in &#x27;
                           &#x27;compliance\n&#x27;
                           &#x27; * with the License.  You may obtain a copy of the &#x27;
                           &#x27;License at\n&#x27;
                           &#x27; *\n&#x27;
                           &#x27; * http://www.apache.org/licenses/LICENSE-2.0\n&#x27;
                           &#x27; *\n&#x27;
                           &#x27; * Unless required by applicable law or agreed to &#x27;
                           &#x27;in writing, software\n&#x27;
                           &#x27; * distributed under the License is distributed on &#x27;
                           &#x27;an &quot;AS IS&quot; BASIS,\n&#x27;
                           &#x27; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, &#x27;
                           &#x27;either express or implied.\n&#x27;
                           &#x27; * See the License for the specific language &#x27;
                           &#x27;governing permissions and\n&#x27;
                           &#x27; * limitations under the License.\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;package com.dtstack.flink.sql.launcher;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.dtstack.flink.sql.enums.ClusterMode;\n&#x27;
                           &#x27;import com.dtstack.flink.sql.option.Options;\n&#x27;
                           &#x27;import com.dtstack.flink.sql.util.PluginUtil;\n&#x27;
                           &#x27;import com.esotericsoftware.minlog.Log;\n&#x27;
                           &#x27;import org.apache.commons.io.Charsets;\n&#x27;
                           &#x27;import org.apache.commons.lang.StringUtils;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.client.program.ClusterClient;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.client.program.MiniClusterClient;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.ConfigConstants;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.Configuration;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.GlobalConfiguration;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.JobManagerOptions;\n&#x27;
                           &#x27;import org.apache.flink.core.fs.FileSystem;\n&#x27;
                           &#x27;import org.apache.flink.runtime.akka.AkkaUtils;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.runtime.minicluster.MiniCluster;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.runtime.minicluster.MiniClusterConfiguration;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.runtime.util.LeaderConnectionInfo;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.yarn.AbstractYarnClusterDescriptor;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.yarn.YarnClusterDescriptor;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.api.records.ApplicationId;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.api.records.ApplicationReport;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.api.records.YarnApplicationState;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.client.api.YarnClient;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.conf.YarnConfiguration;\n&#x27;
                           &#x27;import org.apache.hadoop.yarn.util.StringHelper;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.net.InetSocketAddress;\n&#x27;
                           &#x27;import java.net.URLDecoder;\n&#x27;
                           &#x27;import java.util.EnumSet;\n&#x27;
                           &#x27;import java.util.HashSet;\n&#x27;
                           &#x27;import java.util.Iterator;\n&#x27;
                           &#x27;import java.util.List;\n&#x27;
                           &#x27;import java.util.Properties;\n&#x27;
                           &#x27;import java.util.Set;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * @author sishu.yss\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;public class ClusterClientFactory {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static ClusterClient &#x27;
                           &#x27;createClusterClient(Options launcherOptions) &#x27;
                           &#x27;throws Exception {\n&#x27;
                           &#x27;        String mode = launcherOptions.getMode();\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(mode.equals(ClusterMode.standalone.name())) {\n&#x27;
                           &#x27;            return &#x27;
                           &#x27;createStandaloneClient(launcherOptions);\n&#x27;
                           &#x27;        } else if &#x27;
                           &#x27;(mode.equals(ClusterMode.yarn.name())) {\n&#x27;
                           &#x27;            return &#x27;
                           &#x27;createYarnSessionClient(launcherOptions);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        throw new &#x27;
                           &#x27;IllegalArgumentException(&quot;Unsupported cluster &#x27;
                           &#x27;client type: &quot;);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static ClusterClient &#x27;
                           &#x27;createStandaloneClient(Options launcherOptions) &#x27;
                           &#x27;throws Exception {\n&#x27;
                           &#x27;        String flinkConfDir = &#x27;
                           &#x27;launcherOptions.getFlinkconf();\n&#x27;
                           &#x27;        Configuration config = &#x27;
                           &#x27;GlobalConfiguration.loadConfiguration(flinkConfDir);\n&#x27;
                           &#x27;        MiniClusterConfiguration.Builder &#x27;
                           &#x27;configBuilder = new &#x27;
                           &#x27;MiniClusterConfiguration.Builder();\n&#x27;
                           &#x27;        configBuilder.setConfiguration(config);\n&#x27;
                           &#x27;        MiniCluster miniCluster = new &#x27;
                           &#x27;MiniCluster(configBuilder.build());\n&#x27;
                           &#x27;        MiniClusterClient clusterClient = new &#x27;
                           &#x27;MiniClusterClient(config, miniCluster);\n&#x27;
                           &#x27;        LeaderConnectionInfo connectionInfo = &#x27;
                           &#x27;clusterClient.getClusterConnectionInfo();\n&#x27;
                           &#x27;        InetSocketAddress address = &#x27;
                           &#x27;AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress());\n&#x27;
                           &#x27;        &#x27;
                           &#x27;config.setString(JobManagerOptions.ADDRESS, &#x27;
                           &#x27;address.getAddress().getHostName());\n&#x27;
                           &#x27;        config.setInteger(JobManagerOptions.PORT, &#x27;
                           &#x27;address.getPort());\n&#x27;
                           &#x27;        clusterClient.setDetached(true);\n&#x27;
                           &#x27;        return clusterClient;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static ClusterClient &#x27;
                           &#x27;createYarnSessionClient(Options launcherOptions) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        String flinkConfDir = &#x27;
                           &#x27;StringUtils.isEmpty(launcherOptions.getFlinkconf()) &#x27;
                           &#x27;? &quot;&quot; : launcherOptions.getFlinkconf();\n&#x27;
                           &#x27;        Configuration config = &#x27;
                           &#x27;StringUtils.isEmpty(flinkConfDir) ? new &#x27;
                           &#x27;Configuration() : &#x27;
                           &#x27;GlobalConfiguration.loadConfiguration(flinkConfDir);\n&#x27;
                           &#x27;        String yarnConfDir = &#x27;
                           &#x27;launcherOptions.getYarnconf();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (StringUtils.isNotBlank(yarnConfDir)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            try {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;config.setString(ConfigConstants.PATH_HADOOP_CONFIG, &#x27;
                           &#x27;yarnConfDir);\n&#x27;
                           &#x27;                FileSystem.initialize(config, &#x27;
                           &#x27;null);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                YarnConfiguration yarnConf = &#x27;
                           &#x27;YarnConfLoader.getYarnConf(yarnConfDir);\n&#x27;
                           &#x27;                YarnClient yarnClient = &#x27;
                           &#x27;YarnClient.createYarnClient();\n&#x27;
                           &#x27;                yarnClient.init(yarnConf);\n&#x27;
                           &#x27;                yarnClient.start();\n&#x27;
                           &#x27;                ApplicationId applicationId = &#x27;
                           &#x27;null;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                String yarnSessionConf = &#x27;
                           &#x27;launcherOptions.getYarnSessionConf();\n&#x27;
                           &#x27;                yarnSessionConf = &#x27;
                           &#x27;URLDecoder.decode(yarnSessionConf, &#x27;
                           &#x27;Charsets.UTF_8.toString());\n&#x27;
                           &#x27;                Properties &#x27;
                           &#x27;yarnSessionConfProperties = &#x27;
                           &#x27;PluginUtil.jsonStrToObject(yarnSessionConf, &#x27;
                           &#x27;Properties.class);\n&#x27;
                           &#x27;                Object yid = &#x27;
                           &#x27;yarnSessionConfProperties.get(&quot;yid&quot;);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                if (null != yid) {\n&#x27;
                           &#x27;                    applicationId = &#x27;
                           &#x27;toApplicationId(yid.toString());\n&#x27;
                           &#x27;                } else {\n&#x27;
                           &#x27;                    applicationId = &#x27;
                           &#x27;getYarnClusterApplicationId(yarnClient);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                Log.info(&quot;applicationId={}&quot;, &#x27;
                           &#x27;applicationId.toString());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                if &#x27;
                           &#x27;(StringUtils.isEmpty(applicationId.toString())) {\n&#x27;
                           &#x27;                    throw new RuntimeException(&quot;No &#x27;
                           &#x27;flink session found on yarn cluster.&quot;);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                AbstractYarnClusterDescriptor &#x27;
                           &#x27;clusterDescriptor = new &#x27;
                           &#x27;YarnClusterDescriptor(config, yarnConf, &#x27;
                           &#x27;flinkConfDir, yarnClient, false);\n&#x27;
                           &#x27;                ClusterClient clusterClient = &#x27;
                           &#x27;clusterDescriptor.retrieve(applicationId);\n&#x27;
                           &#x27;                clusterClient.setDetached(true);\n&#x27;
                           &#x27;                return clusterClient;\n&#x27;
                           &#x27;            } catch (Exception e) {\n&#x27;
                           &#x27;                throw new RuntimeException(e);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }else{\n&#x27;
                           &#x27;            throw new RuntimeException(&quot;yarn mode &#x27;
                           &#x27;must set param of \&#x27;yarnconf\&#x27;!!!&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static ApplicationId &#x27;
                           &#x27;getYarnClusterApplicationId(YarnClient yarnClient) &#x27;
                           &#x27;throws Exception {\n&#x27;
                           &#x27;        ApplicationId applicationId = null;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Set&lt;String&gt; set = new HashSet&lt;&gt;();\n&#x27;
                           &#x27;        set.add(&quot;Apache Flink&quot;);\n&#x27;
                           &#x27;        EnumSet&lt;YarnApplicationState&gt; enumSet = &#x27;
                           &#x27;EnumSet.noneOf(YarnApplicationState.class);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;enumSet.add(YarnApplicationState.RUNNING);\n&#x27;
                           &#x27;        List&lt;ApplicationReport&gt; reportList = &#x27;
                           &#x27;yarnClient.getApplications(set, enumSet);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        int maxMemory = -1;\n&#x27;
                           &#x27;        int maxCores = -1;\n&#x27;
                           &#x27;        for (ApplicationReport report : &#x27;
                           &#x27;reportList) {\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(!report.getName().startsWith(&quot;Flink session&quot;)) {\n&#x27;
                           &#x27;                continue;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(!report.getYarnApplicationState().equals(YarnApplicationState.RUNNING)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                continue;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            int thisMemory = &#x27;
                           &#x27;report.getApplicationResourceUsageReport().getNeededResources().getMemory();\n&#x27;
                           &#x27;            int thisCores = &#x27;
                           &#x27;report.getApplicationResourceUsageReport().getNeededResources().getVirtualCores();\n&#x27;
                           &#x27;            if (thisMemory &gt; maxMemory || &#x27;
                           &#x27;thisMemory == maxMemory &amp;&amp; thisCores &gt; maxCores) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                maxMemory = thisMemory;\n&#x27;
                           &#x27;                maxCores = thisCores;\n&#x27;
                           &#x27;                applicationId = &#x27;
                           &#x27;report.getApplicationId();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(StringUtils.isEmpty(applicationId.toString())) {\n&#x27;
                           &#x27;            throw new RuntimeException(&quot;No flink &#x27;
                           &#x27;session found on yarn cluster.&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return applicationId;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static ApplicationId &#x27;
                           &#x27;toApplicationId(String appIdStr) {\n&#x27;
                           &#x27;        Iterator&lt;String&gt; it = &#x27;
                           &#x27;StringHelper._split(appIdStr).iterator();\n&#x27;
                           &#x27;        if (!&quot;application&quot;.equals(it.next())) {\n&#x27;
                           &#x27;            throw new &#x27;
                           &#x27;IllegalArgumentException(&quot;Invalid ApplicationId &#x27;
                           &#x27;prefix: &quot; + appIdStr + &quot;. The valid ApplicationId &#x27;
                           &#x27;should start with prefix &quot; + &quot;application&quot;);\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            try {\n&#x27;
                           &#x27;                return toApplicationId(it);\n&#x27;
                           &#x27;            } catch (NumberFormatException e) {\n&#x27;
                           &#x27;                throw new &#x27;
                           &#x27;IllegalArgumentException(&quot;Invalid AppAttemptId: &quot; &#x27;
                           &#x27;+ appIdStr, e);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static ApplicationId &#x27;
                           &#x27;toApplicationId(Iterator&lt;String&gt; it) throws &#x27;
                           &#x27;NumberFormatException {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;ApplicationId.newInstance(Long.parseLong(it.next()), &#x27;
                           &#x27;Integer.parseInt(it.next()));\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;/**\n&#x27;
                           &#x27; * Licensed to the Apache Software Foundation &#x27;
                           &#x27;(ASF) under one\n&#x27;
                           &#x27; * or more contributor license agreements.  See &#x27;
                           &#x27;the NOTICE file\n&#x27;
                           &#x27; * distributed with this work for additional &#x27;
                           &#x27;information\n&#x27;
                           &#x27; * regarding copyright ownership.  The ASF &#x27;
                           &#x27;licenses this file\n&#x27;
                           &#x27; * to you under the Apache License, Version 2.0 &#x27;
                           &#x27;(the\n&#x27;
                           &#x27; * &quot;License&quot;); you may not use this file except in &#x27;
                           &#x27;compliance\n&#x27;
                           &#x27; * with the License.  You may obtain a copy of the &#x27;
                           &#x27;License at\n&#x27;
                           &#x27; *\n&#x27;
                           &#x27; * http://www.apache.org/licenses/LICENSE-2.0\n&#x27;
                           &#x27; *\n&#x27;
                           &#x27; * Unless required by applicable law or agreed to &#x27;
                           &#x27;in writing, software\n&#x27;
                           &#x27; * distributed under the License is distributed on &#x27;
                           &#x27;an &quot;AS IS&quot; BASIS,\n&#x27;
                           &#x27; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, &#x27;
                           &#x27;either express or implied.\n&#x27;
                           &#x27; * See the License for the specific language &#x27;
                           &#x27;governing permissions and\n&#x27;
                           &#x27; * limitations under the License.\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;package com.dtstack.flink.sql.launcher;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.dtstack.flink.sql.enums.ClusterMode;\n&#x27;
                           &#x27;import com.dtstack.flink.sql.option.Options;\n&#x27;
                           &#x27;import com.dtstack.flink.sql.util.PluginUtil;\n&#x27;
                           &#x27;import com.esotericsoftware.minlog.Log;\n&#x27;
                           &#x27;import org.apache.commons.io.Charsets;\n&#x27;
                           &#x27;import org.apache.commons.lang.StringUtils;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.client.program.ClusterClient;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.client.program.MiniClusterClient;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.ConfigConstants;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.Configuration;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.GlobalConfiguration;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.JobManagerOptions;\n&#x27;
                           &#x27;import org.apache.flink.core.fs.FileSystem;\n&#x27;
                           &#x27;import org.apache.flink.runtime.akka.AkkaUtils;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.runtime.minicluster.MiniCluster;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.runtime.minicluster.MiniClusterConfiguration;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.runtime.util.LeaderConnectionInfo;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.yarn.AbstractYarnClusterDescriptor;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.yarn.YarnClusterDescriptor;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.api.records.ApplicationId;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.api.records.ApplicationReport;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.api.records.YarnApplicationState;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.client.api.YarnClient;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.conf.YarnConfiguration;\n&#x27;
                           &#x27;import org.apache.hadoop.yarn.util.StringHelper;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.net.InetSocketAddress;\n&#x27;
                           &#x27;import java.net.URLDecoder;\n&#x27;
                           &#x27;import java.util.EnumSet;\n&#x27;
                           &#x27;import java.util.HashSet;\n&#x27;
                           &#x27;import java.util.Iterator;\n&#x27;
                           &#x27;import java.util.List;\n&#x27;
                           &#x27;import java.util.Properties;\n&#x27;
                           &#x27;import java.util.Set;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * @author sishu.yss\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;public class ClusterClientFactory {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static ClusterClient &#x27;
                           &#x27;createClusterClient(Options launcherOptions) &#x27;
                           &#x27;throws Exception {\n&#x27;
                           &#x27;        String mode = launcherOptions.getMode();\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(mode.equals(ClusterMode.standalone.name())) {\n&#x27;
                           &#x27;            return &#x27;
                           &#x27;createStandaloneClient(launcherOptions);\n&#x27;
                           &#x27;        } else if &#x27;
                           &#x27;(mode.equals(ClusterMode.yarn.name())) {\n&#x27;
                           &#x27;            return &#x27;
                           &#x27;createYarnSessionClient(launcherOptions);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        throw new &#x27;
                           &#x27;IllegalArgumentException(&quot;Unsupported cluster &#x27;
                           &#x27;client type: &quot;);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static ClusterClient &#x27;
                           &#x27;createStandaloneClient(Options launcherOptions) &#x27;
                           &#x27;throws Exception {\n&#x27;
                           &#x27;        String flinkConfDir = &#x27;
                           &#x27;launcherOptions.getFlinkconf();\n&#x27;
                           &#x27;        Configuration config = &#x27;
                           &#x27;GlobalConfiguration.loadConfiguration(flinkConfDir);\n&#x27;
                           &#x27;        MiniClusterConfiguration.Builder &#x27;
                           &#x27;configBuilder = new &#x27;
                           &#x27;MiniClusterConfiguration.Builder();\n&#x27;
                           &#x27;        configBuilder.setConfiguration(config);\n&#x27;
                           &#x27;        MiniCluster miniCluster = new &#x27;
                           &#x27;MiniCluster(configBuilder.build());\n&#x27;
                           &#x27;        MiniClusterClient clusterClient = new &#x27;
                           &#x27;MiniClusterClient(config, miniCluster);\n&#x27;
                           &#x27;        LeaderConnectionInfo connectionInfo = &#x27;
                           &#x27;clusterClient.getClusterConnectionInfo();\n&#x27;
                           &#x27;        InetSocketAddress address = &#x27;
                           &#x27;AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress());\n&#x27;
                           &#x27;        &#x27;
                           &#x27;config.setString(JobManagerOptions.ADDRESS, &#x27;
                           &#x27;address.getAddress().getHostName());\n&#x27;
                           &#x27;        config.setInteger(JobManagerOptions.PORT, &#x27;
                           &#x27;address.getPort());\n&#x27;
                           &#x27;        clusterClient.setDetached(true);\n&#x27;
                           &#x27;        return clusterClient;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static ClusterClient &#x27;
                           &#x27;createYarnSessionClient(Options launcherOptions) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        String flinkConfDir = &#x27;
                           &#x27;StringUtils.isEmpty(launcherOptions.getFlinkconf()) &#x27;
                           &#x27;? &quot;&quot; : launcherOptions.getFlinkconf();\n&#x27;
                           &#x27;        Configuration config = &#x27;
                           &#x27;StringUtils.isEmpty(flinkConfDir) ? new &#x27;
                           &#x27;Configuration() : &#x27;
                           &#x27;GlobalConfiguration.loadConfiguration(flinkConfDir);\n&#x27;
                           &#x27;        String yarnConfDir = &#x27;
                           &#x27;launcherOptions.getYarnconf();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (StringUtils.isNotBlank(yarnConfDir)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            try {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;config.setString(ConfigConstants.PATH_HADOOP_CONFIG, &#x27;
                           &#x27;yarnConfDir);\n&#x27;
                           &#x27;                FileSystem.initialize(config, &#x27;
                           &#x27;null);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                YarnConfiguration yarnConf = &#x27;
                           &#x27;YarnConfLoader.getYarnConf(yarnConfDir);\n&#x27;
                           &#x27;                YarnClient yarnClient = &#x27;
                           &#x27;YarnClient.createYarnClient();\n&#x27;
                           &#x27;                yarnClient.init(yarnConf);\n&#x27;
                           &#x27;                yarnClient.start();\n&#x27;
                           &#x27;                ApplicationId applicationId = &#x27;
                           &#x27;null;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                String yarnSessionConf = &#x27;
                           &#x27;launcherOptions.getYarnSessionConf();\n&#x27;
                           &#x27;                yarnSessionConf = &#x27;
                           &#x27;URLDecoder.decode(yarnSessionConf, &#x27;
                           &#x27;Charsets.UTF_8.toString());\n&#x27;
                           &#x27;                Properties &#x27;
                           &#x27;yarnSessionConfProperties = &#x27;
                           &#x27;PluginUtil.jsonStrToObject(yarnSessionConf, &#x27;
                           &#x27;Properties.class);\n&#x27;
                           &#x27;                Object yid = &#x27;
                           &#x27;yarnSessionConfProperties.get(&quot;yid&quot;);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                if (null != yid) {\n&#x27;
                           &#x27;                    applicationId = &#x27;
                           &#x27;toApplicationId(yid.toString());\n&#x27;
                           &#x27;                } else {\n&#x27;
                           &#x27;                    applicationId = &#x27;
                           &#x27;getYarnClusterApplicationId(yarnClient);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                Log.info(&quot;applicationId={}&quot;, &#x27;
                           &#x27;applicationId.toString());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                if &#x27;
                           &#x27;(StringUtils.isEmpty(applicationId.toString())) {\n&#x27;
                           &#x27;                    throw new RuntimeException(&quot;No &#x27;
                           &#x27;flink session found on yarn cluster.&quot;);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                AbstractYarnClusterDescriptor &#x27;
                           &#x27;clusterDescriptor = new &#x27;
                           &#x27;YarnClusterDescriptor(config, yarnConf, &#x27;
                           &#x27;flinkConfDir, yarnClient, false);\n&#x27;
                           &#x27;                ClusterClient clusterClient = &#x27;
                           &#x27;clusterDescriptor.retrieve(applicationId);\n&#x27;
                           &#x27;                clusterClient.setDetached(true);\n&#x27;
                           &#x27;                return clusterClient;\n&#x27;
                           &#x27;            } catch (Exception e) {\n&#x27;
                           &#x27;                throw new RuntimeException(e);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }else{\n&#x27;
                           &#x27;            throw new RuntimeException(&quot;yarn mode &#x27;
                           &#x27;must set param of \&#x27;yarnconf\&#x27;!!!&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static ApplicationId &#x27;
                           &#x27;getYarnClusterApplicationId(YarnClient yarnClient) &#x27;
                           &#x27;throws Exception {\n&#x27;
                           &#x27;        ApplicationId applicationId = null;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Set&lt;String&gt; set = new HashSet&lt;&gt;();\n&#x27;
                           &#x27;        set.add(&quot;Apache Flink&quot;);\n&#x27;
                           &#x27;        EnumSet&lt;YarnApplicationState&gt; enumSet = &#x27;
                           &#x27;EnumSet.noneOf(YarnApplicationState.class);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;enumSet.add(YarnApplicationState.RUNNING);\n&#x27;
                           &#x27;        List&lt;ApplicationReport&gt; reportList = &#x27;
                           &#x27;yarnClient.getApplications(set, enumSet);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        int maxMemory = -1;\n&#x27;
                           &#x27;        int maxCores = -1;\n&#x27;
                           &#x27;        for (ApplicationReport report : &#x27;
                           &#x27;reportList) {\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(!report.getName().startsWith(&quot;Flink session&quot;)) {\n&#x27;
                           &#x27;                continue;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(!report.getYarnApplicationState().equals(YarnApplicationState.RUNNING)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                continue;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            int thisMemory = &#x27;
                           &#x27;report.getApplicationResourceUsageReport().getNeededResources().getMemory();\n&#x27;
                           &#x27;            int thisCores = &#x27;
                           &#x27;report.getApplicationResourceUsageReport().getNeededResources().getVirtualCores();\n&#x27;
                           &#x27;            if (thisMemory &gt; maxMemory || &#x27;
                           &#x27;thisMemory == maxMemory &amp;&amp; thisCores &gt; maxCores) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                maxMemory = thisMemory;\n&#x27;
                           &#x27;                maxCores = thisCores;\n&#x27;
                           &#x27;                applicationId = &#x27;
                           &#x27;report.getApplicationId();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(StringUtils.isEmpty(applicationId.toString())) {\n&#x27;
                           &#x27;            throw new RuntimeException(&quot;No flink &#x27;
                           &#x27;session found on yarn cluster.&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return applicationId;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static ApplicationId &#x27;
                           &#x27;toApplicationId(String appIdStr) {\n&#x27;
                           &#x27;        Iterator&lt;String&gt; it = &#x27;
                           &#x27;StringHelper._split(appIdStr).iterator();\n&#x27;
                           &#x27;        if (!&quot;application&quot;.equals(it.next())) {\n&#x27;
                           &#x27;            throw new &#x27;
                           &#x27;IllegalArgumentException(&quot;Invalid ApplicationId &#x27;
                           &#x27;prefix: &quot; + appIdStr + &quot;. The valid ApplicationId &#x27;
                           &#x27;should start with prefix &quot; + &quot;application&quot;);\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            try {\n&#x27;
                           &#x27;                return toApplicationId(it);\n&#x27;
                           &#x27;            } catch (NumberFormatException e) {\n&#x27;
                           &#x27;                throw new &#x27;
                           &#x27;IllegalArgumentException(&quot;Invalid AppAttemptId: &quot; &#x27;
                           &#x27;+ appIdStr, e);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static ApplicationId &#x27;
                           &#x27;toApplicationId(Iterator&lt;String&gt; it) throws &#x27;
                           &#x27;NumberFormatException {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;ApplicationId.newInstance(Long.parseLong(it.next()), &#x27;
                           &#x27;Integer.parseInt(it.next()));\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * Licensed to the Apache Software Foundation &#x27;
                           &#x27;(ASF) under one\n&#x27;
                           &#x27; * or more contributor license agreements.  See &#x27;
                           &#x27;the NOTICE file\n&#x27;
                           &#x27; * distributed with this work for additional &#x27;
                           &#x27;information\n&#x27;
                           &#x27; * regarding copyright ownership.  The ASF &#x27;
                           &#x27;licenses this file\n&#x27;
                           &#x27; * to you under the Apache License, Version 2.0 &#x27;
                           &#x27;(the\n&#x27;
                           &#x27; * &quot;License&quot;); you may not use this file except in &#x27;
                           &#x27;compliance\n&#x27;
                           &#x27; * with the License.  You may obtain a copy of the &#x27;
                           &#x27;License at\n&#x27;
                           &#x27; *\n&#x27;
                           &#x27; * http://www.apache.org/licenses/LICENSE-2.0\n&#x27;
                           &#x27; *\n&#x27;
                           &#x27; * Unless required by applicable law or agreed to &#x27;
                           &#x27;in writing, software\n&#x27;
                           &#x27; * distributed under the License is distributed on &#x27;
                           &#x27;an &quot;AS IS&quot; BASIS,\n&#x27;
                           &#x27; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, &#x27;
                           &#x27;either express or implied.\n&#x27;
                           &#x27; * See the License for the specific language &#x27;
                           &#x27;governing permissions and\n&#x27;
                           &#x27; * limitations under the License.\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;package com.dtstack.flink.sql.launcher;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.dtstack.flink.sql.enums.ClusterMode;\n&#x27;
                           &#x27;import com.dtstack.flink.sql.option.Options;\n&#x27;
                           &#x27;import com.dtstack.flink.sql.util.PluginUtil;\n&#x27;
                           &#x27;import com.esotericsoftware.minlog.Log;\n&#x27;
                           &#x27;import org.apache.commons.io.Charsets;\n&#x27;
                           &#x27;import org.apache.commons.lang.StringUtils;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.client.program.ClusterClient;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.client.program.MiniClusterClient;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.ConfigConstants;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.Configuration;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.GlobalConfiguration;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.JobManagerOptions;\n&#x27;
                           &#x27;import org.apache.flink.core.fs.FileSystem;\n&#x27;
                           &#x27;import org.apache.flink.runtime.akka.AkkaUtils;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.runtime.minicluster.MiniCluster;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.runtime.minicluster.MiniClusterConfiguration;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.runtime.util.LeaderConnectionInfo;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.yarn.AbstractYarnClusterDescriptor;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.yarn.YarnClusterDescriptor;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.api.records.ApplicationId;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.api.records.ApplicationReport;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.api.records.YarnApplicationState;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.client.api.YarnClient;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.conf.YarnConfiguration;\n&#x27;
                           &#x27;import org.apache.hadoop.yarn.util.StringHelper;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.net.InetSocketAddress;\n&#x27;
                           &#x27;import java.net.URLDecoder;\n&#x27;
                           &#x27;import java.util.EnumSet;\n&#x27;
                           &#x27;import java.util.HashSet;\n&#x27;
                           &#x27;import java.util.Iterator;\n&#x27;
                           &#x27;import java.util.List;\n&#x27;
                           &#x27;import java.util.Properties;\n&#x27;
                           &#x27;import java.util.Set;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * @author sishu.yss\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;public class ClusterClientFactory {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static ClusterClient &#x27;
                           &#x27;createClusterClient(Options launcherOptions) &#x27;
                           &#x27;throws Exception {\n&#x27;
                           &#x27;        String mode = launcherOptions.getMode();\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(mode.equals(ClusterMode.standalone.name())) {\n&#x27;
                           &#x27;            return &#x27;
                           &#x27;createStandaloneClient(launcherOptions);\n&#x27;
                           &#x27;        } else if &#x27;
                           &#x27;(mode.equals(ClusterMode.yarn.name())) {\n&#x27;
                           &#x27;            return &#x27;
                           &#x27;createYarnSessionClient(launcherOptions);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        throw new &#x27;
                           &#x27;IllegalArgumentException(&quot;Unsupported cluster &#x27;
                           &#x27;client type: &quot;);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static ClusterClient &#x27;
                           &#x27;createStandaloneClient(Options launcherOptions) &#x27;
                           &#x27;throws Exception {\n&#x27;
                           &#x27;        String flinkConfDir = &#x27;
                           &#x27;launcherOptions.getFlinkconf();\n&#x27;
                           &#x27;        Configuration config = &#x27;
                           &#x27;GlobalConfiguration.loadConfiguration(flinkConfDir);\n&#x27;
                           &#x27;        MiniClusterConfiguration.Builder &#x27;
                           &#x27;configBuilder = new &#x27;
                           &#x27;MiniClusterConfiguration.Builder();\n&#x27;
                           &#x27;        configBuilder.setConfiguration(config);\n&#x27;
                           &#x27;        MiniCluster miniCluster = new &#x27;
                           &#x27;MiniCluster(configBuilder.build());\n&#x27;
                           &#x27;        MiniClusterClient clusterClient = new &#x27;
                           &#x27;MiniClusterClient(config, miniCluster);\n&#x27;
                           &#x27;        LeaderConnectionInfo connectionInfo = &#x27;
                           &#x27;clusterClient.getClusterConnectionInfo();\n&#x27;
                           &#x27;        InetSocketAddress address = &#x27;
                           &#x27;AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress());\n&#x27;
                           &#x27;        &#x27;
                           &#x27;config.setString(JobManagerOptions.ADDRESS, &#x27;
                           &#x27;address.getAddress().getHostName());\n&#x27;
                           &#x27;        config.setInteger(JobManagerOptions.PORT, &#x27;
                           &#x27;address.getPort());\n&#x27;
                           &#x27;        clusterClient.setDetached(true);\n&#x27;
                           &#x27;        return clusterClient;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static ClusterClient &#x27;
                           &#x27;createYarnSessionClient(Options launcherOptions) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        String flinkConfDir = &#x27;
                           &#x27;StringUtils.isEmpty(launcherOptions.getFlinkconf()) &#x27;
                           &#x27;? &quot;&quot; : launcherOptions.getFlinkconf();\n&#x27;
                           &#x27;        Configuration config = &#x27;
                           &#x27;StringUtils.isEmpty(flinkConfDir) ? new &#x27;
                           &#x27;Configuration() : &#x27;
                           &#x27;GlobalConfiguration.loadConfiguration(flinkConfDir);\n&#x27;
                           &#x27;        String yarnConfDir = &#x27;
                           &#x27;launcherOptions.getYarnconf();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (StringUtils.isNotBlank(yarnConfDir)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            try {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;config.setString(ConfigConstants.PATH_HADOOP_CONFIG, &#x27;
                           &#x27;yarnConfDir);\n&#x27;
                           &#x27;                FileSystem.initialize(config, &#x27;
                           &#x27;null);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                YarnConfiguration yarnConf = &#x27;
                           &#x27;YarnConfLoader.getYarnConf(yarnConfDir);\n&#x27;
                           &#x27;                YarnClient yarnClient = &#x27;
                           &#x27;YarnClient.createYarnClient();\n&#x27;
                           &#x27;                yarnClient.init(yarnConf);\n&#x27;
                           &#x27;                yarnClient.start();\n&#x27;
                           &#x27;                ApplicationId applicationId = &#x27;
                           &#x27;null;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                String yarnSessionConf = &#x27;
                           &#x27;launcherOptions.getYarnSessionConf();\n&#x27;
                           &#x27;                yarnSessionConf = &#x27;
                           &#x27;URLDecoder.decode(yarnSessionConf, &#x27;
                           &#x27;Charsets.UTF_8.toString());\n&#x27;
                           &#x27;                Properties &#x27;
                           &#x27;yarnSessionConfProperties = &#x27;
                           &#x27;PluginUtil.jsonStrToObject(yarnSessionConf, &#x27;
                           &#x27;Properties.class);\n&#x27;
                           &#x27;                Object yid = &#x27;
                           &#x27;yarnSessionConfProperties.get(&quot;yid&quot;);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                if (null != yid) {\n&#x27;
                           &#x27;                    applicationId = &#x27;
                           &#x27;toApplicationId(yid.toString());\n&#x27;
                           &#x27;                } else {\n&#x27;
                           &#x27;                    applicationId = &#x27;
                           &#x27;getYarnClusterApplicationId(yarnClient);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                Log.info(&quot;applicationId={}&quot;, &#x27;
                           &#x27;applicationId.toString());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                if &#x27;
                           &#x27;(StringUtils.isEmpty(applicationId.toString())) {\n&#x27;
                           &#x27;                    throw new RuntimeException(&quot;No &#x27;
                           &#x27;flink session found on yarn cluster.&quot;);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                AbstractYarnClusterDescriptor &#x27;
                           &#x27;clusterDescriptor = new &#x27;
                           &#x27;YarnClusterDescriptor(config, yarnConf, &#x27;
                           &#x27;flinkConfDir, yarnClient, false);\n&#x27;
                           &#x27;                ClusterClient clusterClient = &#x27;
                           &#x27;clusterDescriptor.retrieve(applicationId);\n&#x27;
                           &#x27;                clusterClient.setDetached(true);\n&#x27;
                           &#x27;                return clusterClient;\n&#x27;
                           &#x27;            } catch (Exception e) {\n&#x27;
                           &#x27;                throw new RuntimeException(e);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }else{\n&#x27;
                           &#x27;            throw new RuntimeException(&quot;yarn mode &#x27;
                           &#x27;must set param of \&#x27;yarnconf\&#x27;!!!&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static ApplicationId &#x27;
                           &#x27;getYarnClusterApplicationId(YarnClient yarnClient) &#x27;
                           &#x27;throws Exception {\n&#x27;
                           &#x27;        ApplicationId applicationId = null;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Set&lt;String&gt; set = new HashSet&lt;&gt;();\n&#x27;
                           &#x27;        set.add(&quot;Apache Flink&quot;);\n&#x27;
                           &#x27;        EnumSet&lt;YarnApplicationState&gt; enumSet = &#x27;
                           &#x27;EnumSet.noneOf(YarnApplicationState.class);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;enumSet.add(YarnApplicationState.RUNNING);\n&#x27;
                           &#x27;        List&lt;ApplicationReport&gt; reportList = &#x27;
                           &#x27;yarnClient.getApplications(set, enumSet);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        int maxMemory = -1;\n&#x27;
                           &#x27;        int maxCores = -1;\n&#x27;
                           &#x27;        for (ApplicationReport report : &#x27;
                           &#x27;reportList) {\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(!report.getName().startsWith(&quot;Flink session&quot;)) {\n&#x27;
                           &#x27;                continue;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(!report.getYarnApplicationState().equals(YarnApplicationState.RUNNING)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                continue;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            int thisMemory = &#x27;
                           &#x27;report.getApplicationResourceUsageReport().getNeededResources().getMemory();\n&#x27;
                           &#x27;            int thisCores = &#x27;
                           &#x27;report.getApplicationResourceUsageReport().getNeededResources().getVirtualCores();\n&#x27;
                           &#x27;            if (thisMemory &gt; maxMemory || &#x27;
                           &#x27;thisMemory == maxMemory &amp;&amp; thisCores &gt; maxCores) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                maxMemory = thisMemory;\n&#x27;
                           &#x27;                maxCores = thisCores;\n&#x27;
                           &#x27;                applicationId = &#x27;
                           &#x27;report.getApplicationId();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(StringUtils.isEmpty(applicationId.toString())) {\n&#x27;
                           &#x27;            throw new RuntimeException(&quot;No flink &#x27;
                           &#x27;session found on yarn cluster.&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return applicationId;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static ApplicationId &#x27;
                           &#x27;toApplicationId(String appIdStr) {\n&#x27;
                           &#x27;        Iterator&lt;String&gt; it = &#x27;
                           &#x27;StringHelper._split(appIdStr).iterator();\n&#x27;
                           &#x27;        if (!&quot;application&quot;.equals(it.next())) {\n&#x27;
                           &#x27;            throw new &#x27;
                           &#x27;IllegalArgumentException(&quot;Invalid ApplicationId &#x27;
                           &#x27;prefix: &quot; + appIdStr + &quot;. The valid ApplicationId &#x27;
                           &#x27;should start with prefix &quot; + &quot;application&quot;);\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            try {\n&#x27;
                           &#x27;                return toApplicationId(it);\n&#x27;
                           &#x27;            } catch (NumberFormatException e) {\n&#x27;
                           &#x27;                throw new &#x27;
                           &#x27;IllegalArgumentException(&quot;Invalid AppAttemptId: &quot; &#x27;
                           &#x27;+ appIdStr, e);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static ApplicationId &#x27;
                           &#x27;toApplicationId(Iterator&lt;String&gt; it) throws &#x27;
                           &#x27;NumberFormatException {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;ApplicationId.newInstance(Long.parseLong(it.next()), &#x27;
                           &#x27;Integer.parseInt(it.next()));\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;}\n&#x27;}],
   &#x27;mergers&#x27;: {&#x27;spork&#x27;, &#x27;baseline&#x27;, &#x27;jfstmerge&#x27;}}],
 [{&#x27;eq&#x27;: [{&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;/**\n&#x27;
                           &#x27; * Licensed to the Apache Software Foundation &#x27;
                           &#x27;(ASF) under one\n&#x27;
                           &#x27; * or more contributor license agreements.  See &#x27;
                           &#x27;the NOTICE file\n&#x27;
                           &#x27; * distributed with this work for additional &#x27;
                           &#x27;information\n&#x27;
                           &#x27; * regarding copyright ownership.  The ASF &#x27;
                           &#x27;licenses this file\n&#x27;
                           &#x27; * to you under the Apache License, Version 2.0 &#x27;
                           &#x27;(the\n&#x27;
                           &#x27; * &quot;License&quot;); you may not use this file except in &#x27;
                           &#x27;compliance\n&#x27;
                           &#x27; * with the License.  You may obtain a copy of the &#x27;
                           &#x27;License at\n&#x27;
                           &#x27; *\n&#x27;
                           &#x27; * http://www.apache.org/licenses/LICENSE-2.0\n&#x27;
                           &#x27; *\n&#x27;
                           &#x27; * Unless required by applicable law or agreed to &#x27;
                           &#x27;in writing, software\n&#x27;
                           &#x27; * distributed under the License is distributed on &#x27;
                           &#x27;an &quot;AS IS&quot; BASIS,\n&#x27;
                           &#x27; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, &#x27;
                           &#x27;either express or implied.\n&#x27;
                           &#x27; * See the License for the specific language &#x27;
                           &#x27;governing permissions and\n&#x27;
                           &#x27; * limitations under the License.\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;package com.dtstack.flink.sql.launcher;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.dtstack.flink.sql.enums.ClusterMode;\n&#x27;
                           &#x27;import com.dtstack.flink.sql.option.Options;\n&#x27;
                           &#x27;import com.dtstack.flink.sql.util.PluginUtil;\n&#x27;
                           &#x27;import com.esotericsoftware.minlog.Log;\n&#x27;
                           &#x27;import org.apache.commons.io.Charsets;\n&#x27;
                           &#x27;import org.apache.commons.lang.StringUtils;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.client.program.ClusterClient;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.client.program.MiniClusterClient;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.ConfigConstants;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.Configuration;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.GlobalConfiguration;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.JobManagerOptions;\n&#x27;
                           &#x27;import org.apache.flink.core.fs.FileSystem;\n&#x27;
                           &#x27;import org.apache.flink.runtime.akka.AkkaUtils;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.runtime.minicluster.MiniCluster;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.runtime.minicluster.MiniClusterConfiguration;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.runtime.util.LeaderConnectionInfo;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.yarn.AbstractYarnClusterDescriptor;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.yarn.YarnClusterDescriptor;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.api.records.ApplicationId;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.api.records.ApplicationReport;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.api.records.YarnApplicationState;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.client.api.YarnClient;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.conf.YarnConfiguration;\n&#x27;
                           &#x27;import org.apache.hadoop.yarn.util.StringHelper;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.net.InetSocketAddress;\n&#x27;
                           &#x27;import java.net.URLDecoder;\n&#x27;
                           &#x27;import java.util.EnumSet;\n&#x27;
                           &#x27;import java.util.HashSet;\n&#x27;
                           &#x27;import java.util.Iterator;\n&#x27;
                           &#x27;import java.util.List;\n&#x27;
                           &#x27;import java.util.Properties;\n&#x27;
                           &#x27;import java.util.Set;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * @author sishu.yss\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;public class ClusterClientFactory {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static ClusterClient &#x27;
                           &#x27;createClusterClient(Options launcherOptions) &#x27;
                           &#x27;throws Exception {\n&#x27;
                           &#x27;        String mode = launcherOptions.getMode();\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(mode.equals(ClusterMode.standalone.name())) {\n&#x27;
                           &#x27;            return &#x27;
                           &#x27;createStandaloneClient(launcherOptions);\n&#x27;
                           &#x27;        } else if &#x27;
                           &#x27;(mode.equals(ClusterMode.yarn.name())) {\n&#x27;
                           &#x27;            return &#x27;
                           &#x27;createYarnSessionClient(launcherOptions);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        throw new &#x27;
                           &#x27;IllegalArgumentException(&quot;Unsupported cluster &#x27;
                           &#x27;client type: &quot;);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static ClusterClient &#x27;
                           &#x27;createStandaloneClient(Options launcherOptions) &#x27;
                           &#x27;throws Exception {\n&#x27;
                           &#x27;        String flinkConfDir = &#x27;
                           &#x27;launcherOptions.getFlinkconf();\n&#x27;
                           &#x27;        Configuration config = &#x27;
                           &#x27;GlobalConfiguration.loadConfiguration(flinkConfDir);\n&#x27;
                           &#x27;        MiniClusterConfiguration.Builder &#x27;
                           &#x27;configBuilder = new &#x27;
                           &#x27;MiniClusterConfiguration.Builder();\n&#x27;
                           &#x27;        configBuilder.setConfiguration(config);\n&#x27;
                           &#x27;        MiniCluster miniCluster = new &#x27;
                           &#x27;MiniCluster(configBuilder.build());\n&#x27;
                           &#x27;        MiniClusterClient clusterClient = new &#x27;
                           &#x27;MiniClusterClient(config, miniCluster);\n&#x27;
                           &#x27;        LeaderConnectionInfo connectionInfo = &#x27;
                           &#x27;clusterClient.getClusterConnectionInfo();\n&#x27;
                           &#x27;        InetSocketAddress address = &#x27;
                           &#x27;AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress());\n&#x27;
                           &#x27;        &#x27;
                           &#x27;config.setString(JobManagerOptions.ADDRESS, &#x27;
                           &#x27;address.getAddress().getHostName());\n&#x27;
                           &#x27;        config.setInteger(JobManagerOptions.PORT, &#x27;
                           &#x27;address.getPort());\n&#x27;
                           &#x27;        clusterClient.setDetached(true);\n&#x27;
                           &#x27;        return clusterClient;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static ClusterClient &#x27;
                           &#x27;createYarnSessionClient(Options launcherOptions) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        String flinkConfDir = &#x27;
                           &#x27;StringUtils.isEmpty(launcherOptions.getFlinkconf()) &#x27;
                           &#x27;? &quot;&quot; : launcherOptions.getFlinkconf();\n&#x27;
                           &#x27;        Configuration config = &#x27;
                           &#x27;StringUtils.isEmpty(flinkConfDir) ? new &#x27;
                           &#x27;Configuration() : &#x27;
                           &#x27;GlobalConfiguration.loadConfiguration(flinkConfDir);\n&#x27;
                           &#x27;        String yarnConfDir = &#x27;
                           &#x27;launcherOptions.getYarnconf();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (StringUtils.isNotBlank(yarnConfDir)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            try {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;config.setString(ConfigConstants.PATH_HADOOP_CONFIG, &#x27;
                           &#x27;yarnConfDir);\n&#x27;
                           &#x27;                FileSystem.initialize(config, &#x27;
                           &#x27;null);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                YarnConfiguration yarnConf = &#x27;
                           &#x27;YarnConfLoader.getYarnConf(yarnConfDir);\n&#x27;
                           &#x27;                YarnClient yarnClient = &#x27;
                           &#x27;YarnClient.createYarnClient();\n&#x27;
                           &#x27;                yarnClient.init(yarnConf);\n&#x27;
                           &#x27;                yarnClient.start();\n&#x27;
                           &#x27;                ApplicationId applicationId = &#x27;
                           &#x27;null;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                String yarnSessionConf = &#x27;
                           &#x27;launcherOptions.getYarnSessionConf();\n&#x27;
                           &#x27;                yarnSessionConf = &#x27;
                           &#x27;URLDecoder.decode(yarnSessionConf, &#x27;
                           &#x27;Charsets.UTF_8.toString());\n&#x27;
                           &#x27;                Properties &#x27;
                           &#x27;yarnSessionConfProperties = &#x27;
                           &#x27;PluginUtil.jsonStrToObject(yarnSessionConf, &#x27;
                           &#x27;Properties.class);\n&#x27;
                           &#x27;                Object yid = &#x27;
                           &#x27;yarnSessionConfProperties.get(&quot;yid&quot;);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                if (null != yid) {\n&#x27;
                           &#x27;                    applicationId = &#x27;
                           &#x27;toApplicationId(yid.toString());\n&#x27;
                           &#x27;                } else {\n&#x27;
                           &#x27;                    applicationId = &#x27;
                           &#x27;getYarnClusterApplicationId(yarnClient);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                Log.info(&quot;applicationId={}&quot;, &#x27;
                           &#x27;applicationId.toString());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                if &#x27;
                           &#x27;(StringUtils.isEmpty(applicationId.toString())) {\n&#x27;
                           &#x27;                    throw new RuntimeException(&quot;No &#x27;
                           &#x27;flink session found on yarn cluster.&quot;);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                AbstractYarnClusterDescriptor &#x27;
                           &#x27;clusterDescriptor = new &#x27;
                           &#x27;YarnClusterDescriptor(config, yarnConf, &#x27;
                           &#x27;flinkConfDir, yarnClient, false);\n&#x27;
                           &#x27;                ClusterClient clusterClient = &#x27;
                           &#x27;clusterDescriptor.retrieve(applicationId);\n&#x27;
                           &#x27;                clusterClient.setDetached(true);\n&#x27;
                           &#x27;                return clusterClient;\n&#x27;
                           &#x27;            } catch (Exception e) {\n&#x27;
                           &#x27;                throw new RuntimeException(e);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }else{\n&#x27;
                           &#x27;            throw new RuntimeException(&quot;yarn mode &#x27;
                           &#x27;must set param of \&#x27;yarnconf\&#x27;!!!&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static ApplicationId &#x27;
                           &#x27;getYarnClusterApplicationId(YarnClient yarnClient) &#x27;
                           &#x27;throws Exception {\n&#x27;
                           &#x27;        ApplicationId applicationId = null;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Set&lt;String&gt; set = new HashSet&lt;&gt;();\n&#x27;
                           &#x27;        set.add(&quot;Apache Flink&quot;);\n&#x27;
                           &#x27;        EnumSet&lt;YarnApplicationState&gt; enumSet = &#x27;
                           &#x27;EnumSet.noneOf(YarnApplicationState.class);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;enumSet.add(YarnApplicationState.RUNNING);\n&#x27;
                           &#x27;        List&lt;ApplicationReport&gt; reportList = &#x27;
                           &#x27;yarnClient.getApplications(set, enumSet);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        int maxMemory = -1;\n&#x27;
                           &#x27;        int maxCores = -1;\n&#x27;
                           &#x27;        for (ApplicationReport report : &#x27;
                           &#x27;reportList) {\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(!report.getName().startsWith(&quot;Flink session&quot;)) {\n&#x27;
                           &#x27;                continue;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(!report.getYarnApplicationState().equals(YarnApplicationState.RUNNING)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                continue;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            int thisMemory = &#x27;
                           &#x27;report.getApplicationResourceUsageReport().getNeededResources().getMemory();\n&#x27;
                           &#x27;            int thisCores = &#x27;
                           &#x27;report.getApplicationResourceUsageReport().getNeededResources().getVirtualCores();\n&#x27;
                           &#x27;            if (thisMemory &gt; maxMemory || &#x27;
                           &#x27;thisMemory == maxMemory &amp;&amp; thisCores &gt; maxCores) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                maxMemory = thisMemory;\n&#x27;
                           &#x27;                maxCores = thisCores;\n&#x27;
                           &#x27;                applicationId = &#x27;
                           &#x27;report.getApplicationId();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(StringUtils.isEmpty(applicationId.toString())) {\n&#x27;
                           &#x27;            throw new RuntimeException(&quot;No flink &#x27;
                           &#x27;session found on yarn cluster.&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return applicationId;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static ApplicationId &#x27;
                           &#x27;toApplicationId(String appIdStr) {\n&#x27;
                           &#x27;        Iterator&lt;String&gt; it = &#x27;
                           &#x27;StringHelper._split(appIdStr).iterator();\n&#x27;
                           &#x27;        if (!&quot;application&quot;.equals(it.next())) {\n&#x27;
                           &#x27;            throw new &#x27;
                           &#x27;IllegalArgumentException(&quot;Invalid ApplicationId &#x27;
                           &#x27;prefix: &quot; + appIdStr + &quot;. The valid ApplicationId &#x27;
                           &#x27;should start with prefix &quot; + &quot;application&quot;);\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            try {\n&#x27;
                           &#x27;                return toApplicationId(it);\n&#x27;
                           &#x27;            } catch (NumberFormatException e) {\n&#x27;
                           &#x27;                throw new &#x27;
                           &#x27;IllegalArgumentException(&quot;Invalid AppAttemptId: &quot; &#x27;
                           &#x27;+ appIdStr, e);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static ApplicationId &#x27;
                           &#x27;toApplicationId(Iterator&lt;String&gt; it) throws &#x27;
                           &#x27;NumberFormatException {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;ApplicationId.newInstance(Long.parseLong(it.next()), &#x27;
                           &#x27;Integer.parseInt(it.next()));\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;/**\n&#x27;
                           &#x27; * Licensed to the Apache Software Foundation &#x27;
                           &#x27;(ASF) under one\n&#x27;
                           &#x27; * or more contributor license agreements.  See &#x27;
                           &#x27;the NOTICE file\n&#x27;
                           &#x27; * distributed with this work for additional &#x27;
                           &#x27;information\n&#x27;
                           &#x27; * regarding copyright ownership.  The ASF &#x27;
                           &#x27;licenses this file\n&#x27;
                           &#x27; * to you under the Apache License, Version 2.0 &#x27;
                           &#x27;(the\n&#x27;
                           &#x27; * &quot;License&quot;); you may not use this file except in &#x27;
                           &#x27;compliance\n&#x27;
                           &#x27; * with the License.  You may obtain a copy of the &#x27;
                           &#x27;License at\n&#x27;
                           &#x27; *\n&#x27;
                           &#x27; * http://www.apache.org/licenses/LICENSE-2.0\n&#x27;
                           &#x27; *\n&#x27;
                           &#x27; * Unless required by applicable law or agreed to &#x27;
                           &#x27;in writing, software\n&#x27;
                           &#x27; * distributed under the License is distributed on &#x27;
                           &#x27;an &quot;AS IS&quot; BASIS,\n&#x27;
                           &#x27; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, &#x27;
                           &#x27;either express or implied.\n&#x27;
                           &#x27; * See the License for the specific language &#x27;
                           &#x27;governing permissions and\n&#x27;
                           &#x27; * limitations under the License.\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;package com.dtstack.flink.sql.launcher;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.dtstack.flink.sql.enums.ClusterMode;\n&#x27;
                           &#x27;import com.dtstack.flink.sql.option.Options;\n&#x27;
                           &#x27;import com.dtstack.flink.sql.util.PluginUtil;\n&#x27;
                           &#x27;import com.esotericsoftware.minlog.Log;\n&#x27;
                           &#x27;import org.apache.commons.io.Charsets;\n&#x27;
                           &#x27;import org.apache.commons.lang.StringUtils;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.client.program.ClusterClient;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.client.program.MiniClusterClient;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.ConfigConstants;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.Configuration;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.GlobalConfiguration;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.JobManagerOptions;\n&#x27;
                           &#x27;import org.apache.flink.core.fs.FileSystem;\n&#x27;
                           &#x27;import org.apache.flink.runtime.akka.AkkaUtils;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.runtime.minicluster.MiniCluster;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.runtime.minicluster.MiniClusterConfiguration;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.runtime.util.LeaderConnectionInfo;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.yarn.AbstractYarnClusterDescriptor;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.yarn.YarnClusterDescriptor;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.api.records.ApplicationId;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.api.records.ApplicationReport;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.api.records.YarnApplicationState;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.client.api.YarnClient;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.conf.YarnConfiguration;\n&#x27;
                           &#x27;import org.apache.hadoop.yarn.util.StringHelper;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.net.InetSocketAddress;\n&#x27;
                           &#x27;import java.net.URLDecoder;\n&#x27;
                           &#x27;import java.util.EnumSet;\n&#x27;
                           &#x27;import java.util.HashSet;\n&#x27;
                           &#x27;import java.util.Iterator;\n&#x27;
                           &#x27;import java.util.List;\n&#x27;
                           &#x27;import java.util.Properties;\n&#x27;
                           &#x27;import java.util.Set;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * @author sishu.yss\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;public class ClusterClientFactory {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static ClusterClient &#x27;
                           &#x27;createClusterClient(Options launcherOptions) &#x27;
                           &#x27;throws Exception {\n&#x27;
                           &#x27;        String mode = launcherOptions.getMode();\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(mode.equals(ClusterMode.standalone.name())) {\n&#x27;
                           &#x27;            return &#x27;
                           &#x27;createStandaloneClient(launcherOptions);\n&#x27;
                           &#x27;        } else if &#x27;
                           &#x27;(mode.equals(ClusterMode.yarn.name())) {\n&#x27;
                           &#x27;            return &#x27;
                           &#x27;createYarnSessionClient(launcherOptions);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        throw new &#x27;
                           &#x27;IllegalArgumentException(&quot;Unsupported cluster &#x27;
                           &#x27;client type: &quot;);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static ClusterClient &#x27;
                           &#x27;createStandaloneClient(Options launcherOptions) &#x27;
                           &#x27;throws Exception {\n&#x27;
                           &#x27;        String flinkConfDir = &#x27;
                           &#x27;launcherOptions.getFlinkconf();\n&#x27;
                           &#x27;        Configuration config = &#x27;
                           &#x27;GlobalConfiguration.loadConfiguration(flinkConfDir);\n&#x27;
                           &#x27;        MiniClusterConfiguration.Builder &#x27;
                           &#x27;configBuilder = new &#x27;
                           &#x27;MiniClusterConfiguration.Builder();\n&#x27;
                           &#x27;        configBuilder.setConfiguration(config);\n&#x27;
                           &#x27;        MiniCluster miniCluster = new &#x27;
                           &#x27;MiniCluster(configBuilder.build());\n&#x27;
                           &#x27;        MiniClusterClient clusterClient = new &#x27;
                           &#x27;MiniClusterClient(config, miniCluster);\n&#x27;
                           &#x27;        LeaderConnectionInfo connectionInfo = &#x27;
                           &#x27;clusterClient.getClusterConnectionInfo();\n&#x27;
                           &#x27;        InetSocketAddress address = &#x27;
                           &#x27;AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress());\n&#x27;
                           &#x27;        &#x27;
                           &#x27;config.setString(JobManagerOptions.ADDRESS, &#x27;
                           &#x27;address.getAddress().getHostName());\n&#x27;
                           &#x27;        config.setInteger(JobManagerOptions.PORT, &#x27;
                           &#x27;address.getPort());\n&#x27;
                           &#x27;        clusterClient.setDetached(true);\n&#x27;
                           &#x27;        return clusterClient;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static ClusterClient &#x27;
                           &#x27;createYarnSessionClient(Options launcherOptions) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        String flinkConfDir = &#x27;
                           &#x27;StringUtils.isEmpty(launcherOptions.getFlinkconf()) &#x27;
                           &#x27;? &quot;&quot; : launcherOptions.getFlinkconf();\n&#x27;
                           &#x27;        Configuration config = &#x27;
                           &#x27;StringUtils.isEmpty(flinkConfDir) ? new &#x27;
                           &#x27;Configuration() : &#x27;
                           &#x27;GlobalConfiguration.loadConfiguration(flinkConfDir);\n&#x27;
                           &#x27;        String yarnConfDir = &#x27;
                           &#x27;launcherOptions.getYarnconf();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (StringUtils.isNotBlank(yarnConfDir)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            try {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;config.setString(ConfigConstants.PATH_HADOOP_CONFIG, &#x27;
                           &#x27;yarnConfDir);\n&#x27;
                           &#x27;                FileSystem.initialize(config, &#x27;
                           &#x27;null);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                YarnConfiguration yarnConf = &#x27;
                           &#x27;YarnConfLoader.getYarnConf(yarnConfDir);\n&#x27;
                           &#x27;                YarnClient yarnClient = &#x27;
                           &#x27;YarnClient.createYarnClient();\n&#x27;
                           &#x27;                yarnClient.init(yarnConf);\n&#x27;
                           &#x27;                yarnClient.start();\n&#x27;
                           &#x27;                ApplicationId applicationId = &#x27;
                           &#x27;null;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                String yarnSessionConf = &#x27;
                           &#x27;launcherOptions.getYarnSessionConf();\n&#x27;
                           &#x27;                yarnSessionConf = &#x27;
                           &#x27;URLDecoder.decode(yarnSessionConf, &#x27;
                           &#x27;Charsets.UTF_8.toString());\n&#x27;
                           &#x27;                Properties &#x27;
                           &#x27;yarnSessionConfProperties = &#x27;
                           &#x27;PluginUtil.jsonStrToObject(yarnSessionConf, &#x27;
                           &#x27;Properties.class);\n&#x27;
                           &#x27;                Object yid = &#x27;
                           &#x27;yarnSessionConfProperties.get(&quot;yid&quot;);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                if (null != yid) {\n&#x27;
                           &#x27;                    applicationId = &#x27;
                           &#x27;toApplicationId(yid.toString());\n&#x27;
                           &#x27;                } else {\n&#x27;
                           &#x27;                    applicationId = &#x27;
                           &#x27;getYarnClusterApplicationId(yarnClient);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                Log.info(&quot;applicationId={}&quot;, &#x27;
                           &#x27;applicationId.toString());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                if &#x27;
                           &#x27;(StringUtils.isEmpty(applicationId.toString())) {\n&#x27;
                           &#x27;                    throw new RuntimeException(&quot;No &#x27;
                           &#x27;flink session found on yarn cluster.&quot;);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                AbstractYarnClusterDescriptor &#x27;
                           &#x27;clusterDescriptor = new &#x27;
                           &#x27;YarnClusterDescriptor(config, yarnConf, &#x27;
                           &#x27;flinkConfDir, yarnClient, false);\n&#x27;
                           &#x27;                ClusterClient clusterClient = &#x27;
                           &#x27;clusterDescriptor.retrieve(applicationId);\n&#x27;
                           &#x27;                clusterClient.setDetached(true);\n&#x27;
                           &#x27;                return clusterClient;\n&#x27;
                           &#x27;            } catch (Exception e) {\n&#x27;
                           &#x27;                throw new RuntimeException(e);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }else{\n&#x27;
                           &#x27;            throw new RuntimeException(&quot;yarn mode &#x27;
                           &#x27;must set param of \&#x27;yarnconf\&#x27;!!!&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static ApplicationId &#x27;
                           &#x27;getYarnClusterApplicationId(YarnClient yarnClient) &#x27;
                           &#x27;throws Exception {\n&#x27;
                           &#x27;        ApplicationId applicationId = null;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Set&lt;String&gt; set = new HashSet&lt;&gt;();\n&#x27;
                           &#x27;        set.add(&quot;Apache Flink&quot;);\n&#x27;
                           &#x27;        EnumSet&lt;YarnApplicationState&gt; enumSet = &#x27;
                           &#x27;EnumSet.noneOf(YarnApplicationState.class);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;enumSet.add(YarnApplicationState.RUNNING);\n&#x27;
                           &#x27;        List&lt;ApplicationReport&gt; reportList = &#x27;
                           &#x27;yarnClient.getApplications(set, enumSet);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        int maxMemory = -1;\n&#x27;
                           &#x27;        int maxCores = -1;\n&#x27;
                           &#x27;        for (ApplicationReport report : &#x27;
                           &#x27;reportList) {\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(!report.getName().startsWith(&quot;Flink session&quot;)) {\n&#x27;
                           &#x27;                continue;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(!report.getYarnApplicationState().equals(YarnApplicationState.RUNNING)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                continue;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            int thisMemory = &#x27;
                           &#x27;report.getApplicationResourceUsageReport().getNeededResources().getMemory();\n&#x27;
                           &#x27;            int thisCores = &#x27;
                           &#x27;report.getApplicationResourceUsageReport().getNeededResources().getVirtualCores();\n&#x27;
                           &#x27;            if (thisMemory &gt; maxMemory || &#x27;
                           &#x27;thisMemory == maxMemory &amp;&amp; thisCores &gt; maxCores) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                maxMemory = thisMemory;\n&#x27;
                           &#x27;                maxCores = thisCores;\n&#x27;
                           &#x27;                applicationId = &#x27;
                           &#x27;report.getApplicationId();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(StringUtils.isEmpty(applicationId.toString())) {\n&#x27;
                           &#x27;            throw new RuntimeException(&quot;No flink &#x27;
                           &#x27;session found on yarn cluster.&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return applicationId;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static ApplicationId &#x27;
                           &#x27;toApplicationId(String appIdStr) {\n&#x27;
                           &#x27;        Iterator&lt;String&gt; it = &#x27;
                           &#x27;StringHelper._split(appIdStr).iterator();\n&#x27;
                           &#x27;        if (!&quot;application&quot;.equals(it.next())) {\n&#x27;
                           &#x27;            throw new &#x27;
                           &#x27;IllegalArgumentException(&quot;Invalid ApplicationId &#x27;
                           &#x27;prefix: &quot; + appIdStr + &quot;. The valid ApplicationId &#x27;
                           &#x27;should start with prefix &quot; + &quot;application&quot;);\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            try {\n&#x27;
                           &#x27;                return toApplicationId(it);\n&#x27;
                           &#x27;            } catch (NumberFormatException e) {\n&#x27;
                           &#x27;                throw new &#x27;
                           &#x27;IllegalArgumentException(&quot;Invalid AppAttemptId: &quot; &#x27;
                           &#x27;+ appIdStr, e);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static ApplicationId &#x27;
                           &#x27;toApplicationId(Iterator&lt;String&gt; it) throws &#x27;
                           &#x27;NumberFormatException {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;ApplicationId.newInstance(Long.parseLong(it.next()), &#x27;
                           &#x27;Integer.parseInt(it.next()));\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * Licensed to the Apache Software Foundation &#x27;
                           &#x27;(ASF) under one\n&#x27;
                           &#x27; * or more contributor license agreements.  See &#x27;
                           &#x27;the NOTICE file\n&#x27;
                           &#x27; * distributed with this work for additional &#x27;
                           &#x27;information\n&#x27;
                           &#x27; * regarding copyright ownership.  The ASF &#x27;
                           &#x27;licenses this file\n&#x27;
                           &#x27; * to you under the Apache License, Version 2.0 &#x27;
                           &#x27;(the\n&#x27;
                           &#x27; * &quot;License&quot;); you may not use this file except in &#x27;
                           &#x27;compliance\n&#x27;
                           &#x27; * with the License.  You may obtain a copy of the &#x27;
                           &#x27;License at\n&#x27;
                           &#x27; *\n&#x27;
                           &#x27; * http://www.apache.org/licenses/LICENSE-2.0\n&#x27;
                           &#x27; *\n&#x27;
                           &#x27; * Unless required by applicable law or agreed to &#x27;
                           &#x27;in writing, software\n&#x27;
                           &#x27; * distributed under the License is distributed on &#x27;
                           &#x27;an &quot;AS IS&quot; BASIS,\n&#x27;
                           &#x27; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, &#x27;
                           &#x27;either express or implied.\n&#x27;
                           &#x27; * See the License for the specific language &#x27;
                           &#x27;governing permissions and\n&#x27;
                           &#x27; * limitations under the License.\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;package com.dtstack.flink.sql.launcher;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.dtstack.flink.sql.enums.ClusterMode;\n&#x27;
                           &#x27;import com.dtstack.flink.sql.option.Options;\n&#x27;
                           &#x27;import com.dtstack.flink.sql.util.PluginUtil;\n&#x27;
                           &#x27;import com.esotericsoftware.minlog.Log;\n&#x27;
                           &#x27;import org.apache.commons.io.Charsets;\n&#x27;
                           &#x27;import org.apache.commons.lang.StringUtils;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.client.program.ClusterClient;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.client.program.MiniClusterClient;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.ConfigConstants;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.Configuration;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.GlobalConfiguration;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.configuration.JobManagerOptions;\n&#x27;
                           &#x27;import org.apache.flink.core.fs.FileSystem;\n&#x27;
                           &#x27;import org.apache.flink.runtime.akka.AkkaUtils;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.runtime.minicluster.MiniCluster;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.runtime.minicluster.MiniClusterConfiguration;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.runtime.util.LeaderConnectionInfo;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.yarn.AbstractYarnClusterDescriptor;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.flink.yarn.YarnClusterDescriptor;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.api.records.ApplicationId;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.api.records.ApplicationReport;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.api.records.YarnApplicationState;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.client.api.YarnClient;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.hadoop.yarn.conf.YarnConfiguration;\n&#x27;
                           &#x27;import org.apache.hadoop.yarn.util.StringHelper;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.net.InetSocketAddress;\n&#x27;
                           &#x27;import java.net.URLDecoder;\n&#x27;
                           &#x27;import java.util.EnumSet;\n&#x27;
                           &#x27;import java.util.HashSet;\n&#x27;
                           &#x27;import java.util.Iterator;\n&#x27;
                           &#x27;import java.util.List;\n&#x27;
                           &#x27;import java.util.Properties;\n&#x27;
                           &#x27;import java.util.Set;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * @author sishu.yss\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;public class ClusterClientFactory {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static ClusterClient &#x27;
                           &#x27;createClusterClient(Options launcherOptions) &#x27;
                           &#x27;throws Exception {\n&#x27;
                           &#x27;        String mode = launcherOptions.getMode();\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(mode.equals(ClusterMode.standalone.name())) {\n&#x27;
                           &#x27;            return &#x27;
                           &#x27;createStandaloneClient(launcherOptions);\n&#x27;
                           &#x27;        } else if &#x27;
                           &#x27;(mode.equals(ClusterMode.yarn.name())) {\n&#x27;
                           &#x27;            return &#x27;
                           &#x27;createYarnSessionClient(launcherOptions);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        throw new &#x27;
                           &#x27;IllegalArgumentException(&quot;Unsupported cluster &#x27;
                           &#x27;client type: &quot;);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static ClusterClient &#x27;
                           &#x27;createStandaloneClient(Options launcherOptions) &#x27;
                           &#x27;throws Exception {\n&#x27;
                           &#x27;        String flinkConfDir = &#x27;
                           &#x27;launcherOptions.getFlinkconf();\n&#x27;
                           &#x27;        Configuration config = &#x27;
                           &#x27;GlobalConfiguration.loadConfiguration(flinkConfDir);\n&#x27;
                           &#x27;        MiniClusterConfiguration.Builder &#x27;
                           &#x27;configBuilder = new &#x27;
                           &#x27;MiniClusterConfiguration.Builder();\n&#x27;
                           &#x27;        configBuilder.setConfiguration(config);\n&#x27;
                           &#x27;        MiniCluster miniCluster = new &#x27;
                           &#x27;MiniCluster(configBuilder.build());\n&#x27;
                           &#x27;        MiniClusterClient clusterClient = new &#x27;
                           &#x27;MiniClusterClient(config, miniCluster);\n&#x27;
                           &#x27;        LeaderConnectionInfo connectionInfo = &#x27;
                           &#x27;clusterClient.getClusterConnectionInfo();\n&#x27;
                           &#x27;        InetSocketAddress address = &#x27;
                           &#x27;AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress());\n&#x27;
                           &#x27;        &#x27;
                           &#x27;config.setString(JobManagerOptions.ADDRESS, &#x27;
                           &#x27;address.getAddress().getHostName());\n&#x27;
                           &#x27;        config.setInteger(JobManagerOptions.PORT, &#x27;
                           &#x27;address.getPort());\n&#x27;
                           &#x27;        clusterClient.setDetached(true);\n&#x27;
                           &#x27;        return clusterClient;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public static ClusterClient &#x27;
                           &#x27;createYarnSessionClient(Options launcherOptions) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        String flinkConfDir = &#x27;
                           &#x27;StringUtils.isEmpty(launcherOptions.getFlinkconf()) &#x27;
                           &#x27;? &quot;&quot; : launcherOptions.getFlinkconf();\n&#x27;
                           &#x27;        Configuration config = &#x27;
                           &#x27;StringUtils.isEmpty(flinkConfDir) ? new &#x27;
                           &#x27;Configuration() : &#x27;
                           &#x27;GlobalConfiguration.loadConfiguration(flinkConfDir);\n&#x27;
                           &#x27;        String yarnConfDir = &#x27;
                           &#x27;launcherOptions.getYarnconf();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (StringUtils.isNotBlank(yarnConfDir)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            try {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;config.setString(ConfigConstants.PATH_HADOOP_CONFIG, &#x27;
                           &#x27;yarnConfDir);\n&#x27;
                           &#x27;                FileSystem.initialize(config, &#x27;
                           &#x27;null);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                YarnConfiguration yarnConf = &#x27;
                           &#x27;YarnConfLoader.getYarnConf(yarnConfDir);\n&#x27;
                           &#x27;                YarnClient yarnClient = &#x27;
                           &#x27;YarnClient.createYarnClient();\n&#x27;
                           &#x27;                yarnClient.init(yarnConf);\n&#x27;
                           &#x27;                yarnClient.start();\n&#x27;
                           &#x27;                ApplicationId applicationId = &#x27;
                           &#x27;null;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                String yarnSessionConf = &#x27;
                           &#x27;launcherOptions.getYarnSessionConf();\n&#x27;
                           &#x27;                yarnSessionConf = &#x27;
                           &#x27;URLDecoder.decode(yarnSessionConf, &#x27;
                           &#x27;Charsets.UTF_8.toString());\n&#x27;
                           &#x27;                Properties &#x27;
                           &#x27;yarnSessionConfProperties = &#x27;
                           &#x27;PluginUtil.jsonStrToObject(yarnSessionConf, &#x27;
                           &#x27;Properties.class);\n&#x27;
                           &#x27;                Object yid = &#x27;
                           &#x27;yarnSessionConfProperties.get(&quot;yid&quot;);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                if (null != yid) {\n&#x27;
                           &#x27;                    applicationId = &#x27;
                           &#x27;toApplicationId(yid.toString());\n&#x27;
                           &#x27;                } else {\n&#x27;
                           &#x27;                    applicationId = &#x27;
                           &#x27;getYarnClusterApplicationId(yarnClient);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                Log.info(&quot;applicationId={}&quot;, &#x27;
                           &#x27;applicationId.toString());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                if &#x27;
                           &#x27;(StringUtils.isEmpty(applicationId.toString())) {\n&#x27;
                           &#x27;                    throw new RuntimeException(&quot;No &#x27;
                           &#x27;flink session found on yarn cluster.&quot;);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;                AbstractYarnClusterDescriptor &#x27;
                           &#x27;clusterDescriptor = new &#x27;
                           &#x27;YarnClusterDescriptor(config, yarnConf, &#x27;
                           &#x27;flinkConfDir, yarnClient, false);\n&#x27;
                           &#x27;                ClusterClient clusterClient = &#x27;
                           &#x27;clusterDescriptor.retrieve(applicationId);\n&#x27;
                           &#x27;                clusterClient.setDetached(true);\n&#x27;
                           &#x27;                return clusterClient;\n&#x27;
                           &#x27;            } catch (Exception e) {\n&#x27;
                           &#x27;                throw new RuntimeException(e);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }else{\n&#x27;
                           &#x27;            throw new RuntimeException(&quot;yarn mode &#x27;
                           &#x27;must set param of \&#x27;yarnconf\&#x27;!!!&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static ApplicationId &#x27;
                           &#x27;getYarnClusterApplicationId(YarnClient yarnClient) &#x27;
                           &#x27;throws Exception {\n&#x27;
                           &#x27;        ApplicationId applicationId = null;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Set&lt;String&gt; set = new HashSet&lt;&gt;();\n&#x27;
                           &#x27;        set.add(&quot;Apache Flink&quot;);\n&#x27;
                           &#x27;        EnumSet&lt;YarnApplicationState&gt; enumSet = &#x27;
                           &#x27;EnumSet.noneOf(YarnApplicationState.class);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;enumSet.add(YarnApplicationState.RUNNING);\n&#x27;
                           &#x27;        List&lt;ApplicationReport&gt; reportList = &#x27;
                           &#x27;yarnClient.getApplications(set, enumSet);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        int maxMemory = -1;\n&#x27;
                           &#x27;        int maxCores = -1;\n&#x27;
                           &#x27;        for (ApplicationReport report : &#x27;
                           &#x27;reportList) {\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(!report.getName().startsWith(&quot;Flink session&quot;)) {\n&#x27;
                           &#x27;                continue;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            if &#x27;
                           &#x27;(!report.getYarnApplicationState().equals(YarnApplicationState.RUNNING)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                continue;\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            int thisMemory = &#x27;
                           &#x27;report.getApplicationResourceUsageReport().getNeededResources().getMemory();\n&#x27;
                           &#x27;            int thisCores = &#x27;
                           &#x27;report.getApplicationResourceUsageReport().getNeededResources().getVirtualCores();\n&#x27;
                           &#x27;            if (thisMemory &gt; maxMemory || &#x27;
                           &#x27;thisMemory == maxMemory &amp;&amp; thisCores &gt; maxCores) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                maxMemory = thisMemory;\n&#x27;
                           &#x27;                maxCores = thisCores;\n&#x27;
                           &#x27;                applicationId = &#x27;
                           &#x27;report.getApplicationId();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(StringUtils.isEmpty(applicationId.toString())) {\n&#x27;
                           &#x27;            throw new RuntimeException(&quot;No flink &#x27;
                           &#x27;session found on yarn cluster.&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return applicationId;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static ApplicationId &#x27;
                           &#x27;toApplicationId(String appIdStr) {\n&#x27;
                           &#x27;        Iterator&lt;String&gt; it = &#x27;
                           &#x27;StringHelper._split(appIdStr).iterator();\n&#x27;
                           &#x27;        if (!&quot;application&quot;.equals(it.next())) {\n&#x27;
                           &#x27;            throw new &#x27;
                           &#x27;IllegalArgumentException(&quot;Invalid ApplicationId &#x27;
                           &#x27;prefix: &quot; + appIdStr + &quot;. The valid ApplicationId &#x27;
                           &#x27;should start with prefix &quot; + &quot;application&quot;);\n&#x27;
                           &#x27;        } else {\n&#x27;
                           &#x27;            try {\n&#x27;
                           &#x27;                return toApplicationId(it);\n&#x27;
                           &#x27;            } catch (NumberFormatException e) {\n&#x27;
                           &#x27;                throw new &#x27;
                           &#x27;IllegalArgumentException(&quot;Invalid AppAttemptId: &quot; &#x27;
                           &#x27;+ appIdStr, e);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static ApplicationId &#x27;
                           &#x27;toApplicationId(Iterator&lt;String&gt; it) throws &#x27;
                           &#x27;NumberFormatException {\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;ApplicationId.newInstance(Long.parseLong(it.next()), &#x27;
                           &#x27;Integer.parseInt(it.next()));\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;}\n&#x27;}],
   &#x27;mergers&#x27;: {&#x27;spork&#x27;, &#x27;baseline&#x27;, &#x27;jfstmerge&#x27;}}]]</pre>
          </body>
        </html>
        