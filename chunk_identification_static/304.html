<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>304</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    304
                    <a href="303.html">prev</a>
                    <a href="305.html">next</a>
                    <a href="304_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    BroadleafCommerce/BroadleafCommerce_cd7cff12a798c3a68943ad44552e25fb0f98f8d1_core/broadleaf-profile/src/main/java/org/broadleafcommerce/profile/core/service/CustomerServiceImpl.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;cd7cff12a798c3a68943ad44552e25fb0f98f8d1:core/broadleaf-profile/src/main/java/org/broadleafcommerce/profile/core/service/CustomerServiceImpl.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;cd7cff12a798c3a68943ad44552e25fb0f98f8d1^1:core/broadleaf-profile/src/main/java/org/broadleafcommerce/profile/core/service/CustomerServiceImpl.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;cd7cff12a798c3a68943ad44552e25fb0f98f8d1^2:core/broadleaf-profile/src/main/java/org/broadleafcommerce/profile/core/service/CustomerServiceImpl.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;556ac57d12139326e76b29db4638956d93283fb1:core/broadleaf-profile/src/main/java/org/broadleafcommerce/profile/core/service/CustomerServiceImpl.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [b], [b], [bsj], [bs]], subset: [[b], [b], [b], [bsj], [bs]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="195929208389810495" onmouseenter="enter('195929208389810495');" onmouseout="out('195929208389810495');" style="">   3  * BroadleafCommerce Profile                                                                             </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="5673174586140185880" onmouseenter="enter('5673174586140185880');" onmouseout="out('5673174586140185880');" style="">  18 package org.broadleafcommerce.profile.core.service;                                                      </span>
<span  style="">  19                                                                                                          </span>
<span class="-4900305655545834342" onmouseenter="enter('-4900305655545834342');" onmouseout="out('-4900305655545834342');" style="">  20 import org.apache.commons.collections4.CollectionUtils;                                                  </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  21 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  22 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  23 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  24 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="9149575778472736151" onmouseenter="enter('9149575778472736151');" onmouseout="out('9149575778472736151');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  25 import org.broadleafcommerce.common.email.service.EmailService;                                          </span>
<span class="-6139442722863763787" onmouseenter="enter('-6139442722863763787');" onmouseout="out('-6139442722863763787');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  26 import org.broadleafcommerce.common.email.service.info.EmailInfo;                                        </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  27 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="8150446407418055690" onmouseenter="enter('8150446407418055690');" onmouseout="out('8150446407418055690');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 import org.broadleafcommerce.common.id.service.IdGenerationService;                                      </span>
<span class="-6657505372111281463" onmouseenter="enter('-6657505372111281463');" onmouseout="out('-6657505372111281463');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 import org.broadleafcommerce.profile.core.dto.CustomerRuleHolder;                                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  31 =======                                                                                                  </span>
<span class="6519729880675887369" onmouseenter="enter('6519729880675887369');" onmouseout="out('6519729880675887369');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  32 import org.broadleafcommerce.common.event.BroadleafApplicationEventPublisher;                            </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  33 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="8150446407418055690" onmouseenter="enter('8150446407418055690');" onmouseout="out('8150446407418055690');" style="">  34 import org.broadleafcommerce.common.id.service.IdGenerationService;                                      </span>
<span class="8527520771739085493" onmouseenter="enter('8527520771739085493');" onmouseout="out('8527520771739085493');" style="">  35 import org.broadleafcommerce.common.rule.MvelHelper;                                                     </span>
<span class="-2635683203763841416" onmouseenter="enter('-2635683203763841416');" onmouseout="out('-2635683203763841416');" style="">  36 import org.broadleafcommerce.common.security.util.PasswordChange;                                        </span>
<span class="5972522294326904672" onmouseenter="enter('5972522294326904672');" onmouseout="out('5972522294326904672');" style="">  37 import org.broadleafcommerce.common.security.util.PasswordReset;                                         </span>
<span class="6413981270350028954" onmouseenter="enter('6413981270350028954');" onmouseout="out('6413981270350028954');" style="">  38 import org.broadleafcommerce.common.security.util.PasswordUtils;                                         </span>
<span class="-3956591208111981988" onmouseenter="enter('-3956591208111981988');" onmouseout="out('-3956591208111981988');" style="">  39 import org.broadleafcommerce.common.service.GenericResponse;                                             </span>
<span class="1373992879208813777" onmouseenter="enter('1373992879208813777');" onmouseout="out('1373992879208813777');" style="">  40 import org.broadleafcommerce.common.time.SystemTime;                                                     </span>
<span class="-3347161074136237116" onmouseenter="enter('-3347161074136237116');" onmouseout="out('-3347161074136237116');" style="">  41 import org.broadleafcommerce.common.util.StringUtil;                                                     </span>
<span class="5107697851223623564" onmouseenter="enter('5107697851223623564');" onmouseout="out('5107697851223623564');" style="">  42 import org.broadleafcommerce.common.util.TransactionUtils;                                               </span>
<span class="5198631096841786518" onmouseenter="enter('5198631096841786518');" onmouseout="out('5198631096841786518');" style="">  43 import org.broadleafcommerce.profile.core.dao.CustomerDao;                                               </span>
<span class="6035498420134781098" onmouseenter="enter('6035498420134781098');" onmouseout="out('6035498420134781098');" style="">  44 import org.broadleafcommerce.profile.core.dao.CustomerForgotPasswordSecurityTokenDao;                    </span>
<span class="-2668610663458012770" onmouseenter="enter('-2668610663458012770');" onmouseout="out('-2668610663458012770');" style="">  45 import org.broadleafcommerce.profile.core.dao.RoleDao;                                                   </span>
<span class="-6242194486783230477" onmouseenter="enter('-6242194486783230477');" onmouseout="out('-6242194486783230477');" style="">  46 import org.broadleafcommerce.profile.core.domain.Customer;                                               </span>
<span class="7682914685467852548" onmouseenter="enter('7682914685467852548');" onmouseout="out('7682914685467852548');" style="">  47 import org.broadleafcommerce.profile.core.domain.CustomerForgotPasswordSecurityToken;                    </span>
<span class="-7325905376371760879" onmouseenter="enter('-7325905376371760879');" onmouseout="out('-7325905376371760879');" style="">  48 import org.broadleafcommerce.profile.core.domain.CustomerForgotPasswordSecurityTokenImpl;                </span>
<span class="-7795206435247364271" onmouseenter="enter('-7795206435247364271');" onmouseout="out('-7795206435247364271');" style="">  49 import org.broadleafcommerce.profile.core.domain.CustomerRole;                                           </span>
<span class="5359715183603948959" onmouseenter="enter('5359715183603948959');" onmouseout="out('5359715183603948959');" style="">  50 import org.broadleafcommerce.profile.core.domain.CustomerRoleImpl;                                       </span>
<span class="6271275544652071055" onmouseenter="enter('6271275544652071055');" onmouseout="out('6271275544652071055');" style="">  51 import org.broadleafcommerce.profile.core.domain.Role;                                                   </span>
<span class="-6657505372111281463" onmouseenter="enter('-6657505372111281463');" onmouseout="out('-6657505372111281463');" style="">  52 import org.broadleafcommerce.profile.core.dto.CustomerRuleHolder;                                        </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  53 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  54 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="5359715183603948959" onmouseenter="enter('5359715183603948959');" onmouseout="out('5359715183603948959');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55 import org.broadleafcommerce.profile.core.domain.CustomerRoleImpl;                                       </span>
<span class="6271275544652071055" onmouseenter="enter('6271275544652071055');" onmouseout="out('6271275544652071055');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56 import org.broadleafcommerce.profile.core.domain.Role;                                                   </span>
<span class="1248060424968705063" onmouseenter="enter('1248060424968705063');" onmouseout="out('1248060424968705063');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57 import org.broadleafcommerce.profile.core.service.handler.PasswordUpdatedHandler;                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  58 =======                                                                                                  </span>
<span class="-8181433875826880332" onmouseenter="enter('-8181433875826880332');" onmouseout="out('-8181433875826880332');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  59 import org.broadleafcommerce.profile.core.event.ForgotPasswordEvent;                                     </span>
<span class="7578912361223650489" onmouseenter="enter('7578912361223650489');" onmouseout="out('7578912361223650489');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  60 import org.broadleafcommerce.profile.core.event.ForgotUsernameEvent;                                     </span>
<span class="-1223355443293629135" onmouseenter="enter('-1223355443293629135');" onmouseout="out('-1223355443293629135');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  61 import org.broadleafcommerce.profile.core.event.RegisterCustomerEvent;                                   </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  62 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="1248060424968705063" onmouseenter="enter('1248060424968705063');" onmouseout="out('1248060424968705063');" style="">  63 import org.broadleafcommerce.profile.core.service.handler.PasswordUpdatedHandler;                        </span>
<span class="-6753305615342929581" onmouseenter="enter('-6753305615342929581');" onmouseout="out('-6753305615342929581');" style="">  64 import org.broadleafcommerce.profile.core.service.listener.PostRegistrationObserver;                     </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  65 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="2075826732928208126" onmouseenter="enter('2075826732928208126');" onmouseout="out('2075826732928208126');" style="">  66 import org.springframework.security.crypto.password.PasswordEncoder;                                     </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  67 import org.springframework.stereotype.Service;                                                           </span>
<span class="4419089678332371422" onmouseenter="enter('4419089678332371422');" onmouseout="out('4419089678332371422');" style="">  68 import org.springframework.transaction.annotation.Transactional;                                         </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  69 import java.util.ArrayList;                                                                              </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="">  70 import java.util.Date;                                                                                   </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  71 import java.util.HashMap;                                                                                </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  72 import java.util.Iterator;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  73 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  74 import java.util.Map;                                                                                    </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  75 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76                                                                                                          </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  77 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78 import java.util.Date;                                                                                   </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79 import java.util.HashMap;                                                                                </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80 import java.util.Iterator;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82 import java.util.Map;                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83                                                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  84 =======                                                                                                  </span>
<span class="-1842700952879713169" onmouseenter="enter('-1842700952879713169');" onmouseout="out('-1842700952879713169');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  85 import javax.annotation.PostConstruct;                                                                   </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  86 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  87 import javax.annotation.Resource;                                                                        </span>
<span  style="">  88                                                                                                          </span>
<span class="-3189571605039255438" onmouseenter="enter('-3189571605039255438');" onmouseout="out('-3189571605039255438');" style="">  89 @Service(&quot;blCustomerService&quot;)                                                                            </span>
<span class="-4315786798209752789" onmouseenter="enter('-4315786798209752789');" onmouseout="out('-4315786798209752789');" style="">  90 public class CustomerServiceImpl implements CustomerService {                                            </span>
<span class="-9223083925427668638" onmouseenter="enter('-9223083925427668638');" onmouseout="out('-9223083925427668638');" style="">  91     private static final Log LOG = LogFactory.getLog(CustomerServiceImpl.class);                         </span>
<span class="-8423658991079621305" onmouseenter="enter('-8423658991079621305');" onmouseout="out('-8423658991079621305');" style="">  92     private static final int PASSWORD_LENGTH = 16;                                                       </span>
<span  style="">  93                                                                                                          </span>
<span class="5554564923016007608" onmouseenter="enter('5554564923016007608');" onmouseout="out('5554564923016007608');" style="">  94     @Autowired                                                                                           </span>
<span class="-7224044524343370301" onmouseenter="enter('-7224044524343370301');" onmouseout="out('-7224044524343370301');" style="">  95     @Qualifier(&quot;blApplicationEventPublisher&quot;)                                                            </span>
<span class="-5629661248749562711" onmouseenter="enter('-5629661248749562711');" onmouseout="out('-5629661248749562711');" style="">  96     protected BroadleafApplicationEventPublisher eventPublisher;                                         </span>
<span  style="">  97                                                                                                          </span>
<span class="-3028644688219155238" onmouseenter="enter('-3028644688219155238');" onmouseout="out('-3028644688219155238');" style="">  98     @Resource(name=&quot;blCustomerDao&quot;)                                                                      </span>
<span class="8692367904333193309" onmouseenter="enter('8692367904333193309');" onmouseout="out('8692367904333193309');" style="">  99     protected CustomerDao customerDao;                                                                   </span>
<span  style=""> 100                                                                                                          </span>
<span class="3094900987137494064" onmouseenter="enter('3094900987137494064');" onmouseout="out('3094900987137494064');" style=""> 101     @Resource(name = &quot;blIdGenerationService&quot;)                                                            </span>
<span class="-7221277934130422196" onmouseenter="enter('-7221277934130422196');" onmouseout="out('-7221277934130422196');" style=""> 102     protected IdGenerationService idGenerationService;                                                   </span>
<span  style=""> 103                                                                                                          </span>
<span class="2365488678467894280" onmouseenter="enter('2365488678467894280');" onmouseout="out('2365488678467894280');" style=""> 104     @Resource(name = &quot;blCustomerForgotPasswordSecurityTokenDao&quot;)                                         </span>
<span class="4716726216132170190" onmouseenter="enter('4716726216132170190');" onmouseout="out('4716726216132170190');" style=""> 105     protected CustomerForgotPasswordSecurityTokenDao customerForgotPasswordSecurityTokenDao;             </span>
<span  style=""> 106                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 107     /**                                                                                                  </span>
<span class="6298544191369985956" onmouseenter="enter('6298544191369985956');" onmouseout="out('6298544191369985956');" style=""><abbr title=" 108      * &lt;p&gt;This is simply a placeholder to be used by {@link #setupPasswordEncoder()} to determine if we&#x27;re using the"> 108      * &lt;p&gt;This is simply a placeholder to be used by {@link #setupPasswordEncoder()} to determine if we&#x27;rðŸ”µ</abbr></span>
<span class="897245791379814301" onmouseenter="enter('897245791379814301');" onmouseout="out('897245791379814301');" style=""><abbr title=" 109      * new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.authentication.encoding.PasswordEncoder PasswordEncoder}"> 109      * new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.authentication.eðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 110      */                                                                                                  </span>
<span class="3863006184976437823" onmouseenter="enter('3863006184976437823');" onmouseout="out('3863006184976437823');" style=""> 111     @Resource(name = &quot;blPasswordEncoder&quot;)                                                                </span>
<span class="-2329929589298188398" onmouseenter="enter('-2329929589298188398');" onmouseout="out('-2329929589298188398');" style=""> 112     protected PasswordEncoder passwordEncoderBean;                                                       </span>
<span  style=""> 113                                                                                                          </span>
<span class="-5757933253912539407" onmouseenter="enter('-5757933253912539407');" onmouseout="out('-5757933253912539407');" style=""> 114     @Resource(name = &quot;blRoleDao&quot;)                                                                        </span>
<span class="-2955407415487117626" onmouseenter="enter('-2955407415487117626');" onmouseout="out('-2955407415487117626');" style=""> 115     protected RoleDao roleDao;                                                                           </span>
<span  style=""> 116                                                                                                          </span>
<span class="453353925889912084" onmouseenter="enter('453353925889912084');" onmouseout="out('453353925889912084');" style=""> 117     protected int tokenExpiredMinutes = 30;                                                              </span>
<span class="-1133336695006357373" onmouseenter="enter('-1133336695006357373');" onmouseout="out('-1133336695006357373');" style=""> 118     protected int passwordTokenLength = 20;                                                              </span>
<span  style=""> 119                                                                                                          </span>
<span class="-2653602182005192069" onmouseenter="enter('-2653602182005192069');" onmouseout="out('-2653602182005192069');" style=""><abbr title=" 120     protected final List&lt;PostRegistrationObserver&gt; postRegisterListeners = new ArrayList&lt;PostRegistrationObserver&gt;();"> 120     protected final List&lt;PostRegistrationObserver&gt; postRegisterListeners = new ArrayList&lt;PostRegistrationðŸ”µ</abbr></span>
<span class="6843669015915819090" onmouseenter="enter('6843669015915819090');" onmouseout="out('6843669015915819090');" style=""><abbr title=" 121     protected List&lt;PasswordUpdatedHandler&gt; passwordResetHandlers = new ArrayList&lt;PasswordUpdatedHandler&gt;();"> 121     protected List&lt;PasswordUpdatedHandler&gt; passwordResetHandlers = new ArrayList&lt;PasswordUpdatedHandler&gt;(ðŸ”µ</abbr></span>
<span class="-6685798853959138604" onmouseenter="enter('-6685798853959138604');" onmouseout="out('-6685798853959138604');" style=""><abbr title=" 122     protected List&lt;PasswordUpdatedHandler&gt; passwordChangedHandlers = new ArrayList&lt;PasswordUpdatedHandler&gt;();"> 122     protected List&lt;PasswordUpdatedHandler&gt; passwordChangedHandlers = new ArrayList&lt;PasswordUpdatedHandlerðŸ”µ</abbr></span>
<span  style=""> 123                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 124     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 125     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="8291295402928429592" onmouseenter="enter('8291295402928429592');" onmouseout="out('8291295402928429592');" style=""> 126     public Customer saveCustomer(Customer customer) {                                                    </span>
<span class="-4698478172885390647" onmouseenter="enter('-4698478172885390647');" onmouseout="out('-4698478172885390647');" style=""> 127         return saveCustomer(customer, customer.isRegistered());                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128     }                                                                                                    </span>
<span  style=""> 129                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 130     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 131     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="201381677109704887" onmouseenter="enter('201381677109704887');" onmouseout="out('201381677109704887');" style=""> 132     public Customer saveCustomer(Customer customer, boolean register) {                                  </span>
<span class="6726515726770360071" onmouseenter="enter('6726515726770360071');" onmouseout="out('6726515726770360071');" style=""> 133         if (register &amp;&amp; !customer.isRegistered()) {                                                      </span>
<span class="2527359489469298483" onmouseenter="enter('2527359489469298483');" onmouseout="out('2527359489469298483');" style=""> 134             customer.setRegistered(true);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135         }                                                                                                </span>
<span  style=""> 136                                                                                                          </span>
<span class="-2753421557322414072" onmouseenter="enter('-2753421557322414072');" onmouseout="out('-2753421557322414072');" style=""> 137         if (customer.getUnencodedPassword() != null) {                                                   </span>
<span class="-8026123664621306465" onmouseenter="enter('-8026123664621306465');" onmouseout="out('-8026123664621306465');" style=""> 138             customer.setPassword(encodePassword(customer.getUnencodedPassword()));                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139         }                                                                                                </span>
<span  style=""> 140                                                                                                          </span>
<span class="-1576073390989032571" onmouseenter="enter('-1576073390989032571');" onmouseout="out('-1576073390989032571');" style=""> 141         // let&#x27;s make sure they entered a new challenge answer (we will populate                         </span>
<span class="-2819530999572063421" onmouseenter="enter('-2819530999572063421');" onmouseout="out('-2819530999572063421');" style=""> 142         // the password field with hashed values so check that they have changed                         </span>
<span class="-9126181688236016532" onmouseenter="enter('-9126181688236016532');" onmouseout="out('-9126181688236016532');" style=""> 143         // id                                                                                            </span>
<span class="-8509665365452883594" onmouseenter="enter('-8509665365452883594');" onmouseout="out('-8509665365452883594');" style=""><abbr title=" 144         if (customer.getUnencodedChallengeAnswer() != null &amp;&amp; !customer.getUnencodedChallengeAnswer().equals(customer.getChallengeAnswer())) {"> 144         if (customer.getUnencodedChallengeAnswer() != null &amp;&amp; !customer.getUnencodedChallengeAnswer().equðŸ”µ</abbr></span>
<span class="1806155368440017187" onmouseenter="enter('1806155368440017187');" onmouseout="out('1806155368440017187');" style=""> 145             customer.setChallengeAnswer(encodePassword(customer.getUnencodedChallengeAnswer()));         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146         }                                                                                                </span>
<span class="3406416334930679557" onmouseenter="enter('3406416334930679557');" onmouseout="out('3406416334930679557');" style=""> 147         return customerDao.save(customer);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148     }                                                                                                    </span>
<span  style=""> 149                                                                                                          </span>
<span class="-137997900411835717" onmouseenter="enter('-137997900411835717');" onmouseout="out('-137997900411835717');" style=""> 150     protected String generateSecurePassword() {                                                          </span>
<span class="-4377176751133654653" onmouseenter="enter('-4377176751133654653');" onmouseout="out('-4377176751133654653');" style=""> 151         return PasswordUtils.generateSecurePassword(PASSWORD_LENGTH);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152     }                                                                                                    </span>
<span  style=""> 153                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 154     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 155     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="3910349330927871049" onmouseenter="enter('3910349330927871049');" onmouseout="out('3910349330927871049');" style=""> 156     public Customer registerCustomer(Customer customer, String password, String passwordConfirm) {       </span>
<span class="2527359489469298483" onmouseenter="enter('2527359489469298483');" onmouseout="out('2527359489469298483');" style=""> 157         customer.setRegistered(true);                                                                    </span>
<span  style=""> 158                                                                                                          </span>
<span class="-5009800104120858890" onmouseenter="enter('-5009800104120858890');" onmouseout="out('-5009800104120858890');" style=""> 159         // When unencodedPassword is set the save() will encode it                                       </span>
<span class="5360015832768603745" onmouseenter="enter('5360015832768603745');" onmouseout="out('5360015832768603745');" style=""> 160         if (customer.getId() == null) {                                                                  </span>
<span class="-5488615021987588883" onmouseenter="enter('-5488615021987588883');" onmouseout="out('-5488615021987588883');" style=""> 161             customer.setId(findNextCustomerId());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162         }                                                                                                </span>
<span class="5101903206908082309" onmouseenter="enter('5101903206908082309');" onmouseout="out('5101903206908082309');" style=""> 163         customer.setUnencodedPassword(password);                                                         </span>
<span class="-1307190252670550775" onmouseenter="enter('-1307190252670550775');" onmouseout="out('-1307190252670550775');" style=""> 164         Customer retCustomer = saveCustomer(customer);                                                   </span>
<span class="-7993851139681656451" onmouseenter="enter('-7993851139681656451');" onmouseout="out('-7993851139681656451');" style=""> 165         createRegisteredCustomerRoles(retCustomer);                                                      </span>
<span  style=""> 166                                                                                                          </span>
<span class="-3489922120474106740" onmouseenter="enter('-3489922120474106740');" onmouseout="out('-3489922120474106740');" style=""> 167         eventPublisher.publishEvent(new RegisterCustomerEvent(this, retCustomer.getId()));               </span>
<span class="-3623043072901839896" onmouseenter="enter('-3623043072901839896');" onmouseout="out('-3623043072901839896');" style=""> 168         notifyPostRegisterListeners(retCustomer);                                                        </span>
<span  style=""> 169                                                                                                          </span>
<span class="-6683456484294032112" onmouseenter="enter('-6683456484294032112');" onmouseout="out('-6683456484294032112');" style=""> 170         return retCustomer;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171     }                                                                                                    </span>
<span  style=""> 172                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 173     @Override                                                                                            </span>
<span class="-8989473089684210869" onmouseenter="enter('-8989473089684210869');" onmouseout="out('-8989473089684210869');" style=""> 174     public void createRegisteredCustomerRoles(Customer customer) {                                       </span>
<span class="-967668152739756369" onmouseenter="enter('-967668152739756369');" onmouseout="out('-967668152739756369');" style=""> 175         Role role = roleDao.readRoleByName(&quot;ROLE_USER&quot;);                                                 </span>
<span class="-7484208420944991016" onmouseenter="enter('-7484208420944991016');" onmouseout="out('-7484208420944991016');" style=""> 176         CustomerRole customerRole = new CustomerRoleImpl();                                              </span>
<span class="-3544050209899951111" onmouseenter="enter('-3544050209899951111');" onmouseout="out('-3544050209899951111');" style=""> 177         customerRole.setRole(role);                                                                      </span>
<span class="-4836769794727897713" onmouseenter="enter('-4836769794727897713');" onmouseout="out('-4836769794727897713');" style=""> 178         customerRole.setCustomer(customer);                                                              </span>
<span class="2561970876173710740" onmouseenter="enter('2561970876173710740');" onmouseout="out('2561970876173710740');" style=""> 179         roleDao.addRoleToCustomer(customerRole);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180     }                                                                                                    </span>
<span  style=""> 181                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 182     @Override                                                                                            </span>
<span class="-8289498668946854999" onmouseenter="enter('-8289498668946854999');" onmouseout="out('-8289498668946854999');" style=""> 183     public Customer readCustomerByEmail(String emailAddress) {                                           </span>
<span class="6996298339377860417" onmouseenter="enter('6996298339377860417');" onmouseout="out('6996298339377860417');" style=""> 184         return customerDao.readCustomerByEmail(emailAddress);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185     }                                                                                                    </span>
<span  style=""> 186                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 187     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 188     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="2373324961324130685" onmouseenter="enter('2373324961324130685');" onmouseout="out('2373324961324130685');" style=""> 189     public Customer changePassword(PasswordChange passwordChange) {                                      </span>
<span class="-5344336587939476831" onmouseenter="enter('-5344336587939476831');" onmouseout="out('-5344336587939476831');" style=""> 190         Customer customer = readCustomerByUsername(passwordChange.getUsername());                        </span>
<span class="3635027652328433999" onmouseenter="enter('3635027652328433999');" onmouseout="out('3635027652328433999');" style=""> 191         customer.setUnencodedPassword(passwordChange.getNewPassword());                                  </span>
<span class="9175276796642533968" onmouseenter="enter('9175276796642533968');" onmouseout="out('9175276796642533968');" style=""> 192         customer.setPasswordChangeRequired(passwordChange.getPasswordChangeRequired());                  </span>
<span class="5791162324212808512" onmouseenter="enter('5791162324212808512');" onmouseout="out('5791162324212808512');" style=""> 193         customer = saveCustomer(customer);                                                               </span>
<span  style=""> 194                                                                                                          </span>
<span class="1758176125617219344" onmouseenter="enter('1758176125617219344');" onmouseout="out('1758176125617219344');" style=""> 195         for (PasswordUpdatedHandler handler : passwordChangedHandlers) {                                 </span>
<span class="-390754915565928691" onmouseenter="enter('-390754915565928691');" onmouseout="out('-390754915565928691');" style=""> 196             handler.passwordChanged(passwordChange, customer, passwordChange.getNewPassword());          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197         }                                                                                                </span>
<span  style=""> 198                                                                                                          </span>
<span class="-3853204766136593997" onmouseenter="enter('-3853204766136593997');" onmouseout="out('-3853204766136593997');" style=""> 199         return customer;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200     }                                                                                                    </span>
<span  style=""> 201                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 202     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 203     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="-8338050129523775592" onmouseenter="enter('-8338050129523775592');" onmouseout="out('-8338050129523775592');" style=""> 204     public Customer resetPassword(PasswordReset passwordReset) {                                         </span>
<span class="6805273026067147007" onmouseenter="enter('6805273026067147007');" onmouseout="out('6805273026067147007');" style=""> 205         Customer customer = readCustomerByUsername(passwordReset.getUsername());                         </span>
<span class="-122847483108952780" onmouseenter="enter('-122847483108952780');" onmouseout="out('-122847483108952780');" style=""> 206         String newPassword = PasswordUtils.generateSecurePassword(passwordReset.getPasswordLength());    </span>
<span class="-62325817623586886" onmouseenter="enter('-62325817623586886');" onmouseout="out('-62325817623586886');" style=""> 207         customer.setUnencodedPassword(newPassword);                                                      </span>
<span class="6853349384480559800" onmouseenter="enter('6853349384480559800');" onmouseout="out('6853349384480559800');" style=""> 208         customer.setPasswordChangeRequired(passwordReset.getPasswordChangeRequired());                   </span>
<span class="5791162324212808512" onmouseenter="enter('5791162324212808512');" onmouseout="out('5791162324212808512');" style=""> 209         customer = saveCustomer(customer);                                                               </span>
<span  style=""> 210                                                                                                          </span>
<span class="265370277489880531" onmouseenter="enter('265370277489880531');" onmouseout="out('265370277489880531');" style=""> 211         for (PasswordUpdatedHandler handler : passwordResetHandlers) {                                   </span>
<span class="8731392908076423696" onmouseenter="enter('8731392908076423696');" onmouseout="out('8731392908076423696');" style=""> 212             handler.passwordChanged(passwordReset, customer, newPassword);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213         }                                                                                                </span>
<span  style=""> 214                                                                                                          </span>
<span class="-3853204766136593997" onmouseenter="enter('-3853204766136593997');" onmouseout="out('-3853204766136593997');" style=""> 215         return customer;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216     }                                                                                                    </span>
<span  style=""> 217                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 218     @Override                                                                                            </span>
<span class="-2286441478570387081" onmouseenter="enter('-2286441478570387081');" onmouseout="out('-2286441478570387081');" style=""> 219     public void addPostRegisterListener(PostRegistrationObserver postRegisterListeners) {                </span>
<span class="2003689350872197572" onmouseenter="enter('2003689350872197572');" onmouseout="out('2003689350872197572');" style=""> 220         this.postRegisterListeners.add(postRegisterListeners);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221     }                                                                                                    </span>
<span  style=""> 222                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 223     @Override                                                                                            </span>
<span class="-1507687767132611253" onmouseenter="enter('-1507687767132611253');" onmouseout="out('-1507687767132611253');" style=""> 224     public void removePostRegisterListener(PostRegistrationObserver postRegisterListeners) {             </span>
<span class="8851186764245103017" onmouseenter="enter('8851186764245103017');" onmouseout="out('8851186764245103017');" style=""> 225         if (this.postRegisterListeners.contains(postRegisterListeners)) {                                </span>
<span class="7168411145839318905" onmouseenter="enter('7168411145839318905');" onmouseout="out('7168411145839318905');" style=""> 226             this.postRegisterListeners.remove(postRegisterListeners);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228     }                                                                                                    </span>
<span  style=""> 229                                                                                                          </span>
<span class="3762831862655692775" onmouseenter="enter('3762831862655692775');" onmouseout="out('3762831862655692775');" style=""> 230     protected void notifyPostRegisterListeners(Customer customer) {                                      </span>
<span class="-5517241395960310234" onmouseenter="enter('-5517241395960310234');" onmouseout="out('-5517241395960310234');" style=""><abbr title=" 231         for (Iterator&lt;PostRegistrationObserver&gt; iter = postRegisterListeners.iterator(); iter.hasNext(); ) {"> 231         for (Iterator&lt;PostRegistrationObserver&gt; iter = postRegisterListeners.iterator(); iter.hasNext(); ðŸ”µ</abbr></span>
<span class="6852498861939683938" onmouseenter="enter('6852498861939683938');" onmouseout="out('6852498861939683938');" style=""> 232             PostRegistrationObserver listener = iter.next();                                             </span>
<span class="2537062439441145073" onmouseenter="enter('2537062439441145073');" onmouseout="out('2537062439441145073');" style=""> 233             listener.processRegistrationEvent(customer);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235     }                                                                                                    </span>
<span  style=""> 236                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 237     @Override                                                                                            </span>
<span class="-6715127601332863552" onmouseenter="enter('-6715127601332863552');" onmouseout="out('-6715127601332863552');" style=""> 238     public Customer createCustomer() {                                                                   </span>
<span class="1533232953867480113" onmouseenter="enter('1533232953867480113');" onmouseout="out('1533232953867480113');" style=""> 239         return createCustomerFromId(null);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240     }                                                                                                    </span>
<span  style=""> 241                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 242     @Override                                                                                            </span>
<span class="-3260175922123749747" onmouseenter="enter('-3260175922123749747');" onmouseout="out('-3260175922123749747');" style=""> 243     public Customer createCustomerFromId(Long customerId) {                                              </span>
<span class="4846947630103792555" onmouseenter="enter('4846947630103792555');" onmouseout="out('4846947630103792555');" style=""> 244         Customer customer = customerId != null ? readCustomerById(customerId) : null;                    </span>
<span class="-1371412200964570990" onmouseenter="enter('-1371412200964570990');" onmouseout="out('-1371412200964570990');" style=""> 245         if (customer == null) {                                                                          </span>
<span class="7584512027447697158" onmouseenter="enter('7584512027447697158');" onmouseout="out('7584512027447697158');" style=""> 246             customer = customerDao.create();                                                             </span>
<span class="-8452861246579893242" onmouseenter="enter('-8452861246579893242');" onmouseout="out('-8452861246579893242');" style=""> 247             if (customerId != null) {                                                                    </span>
<span class="1431826176080351208" onmouseenter="enter('1431826176080351208');" onmouseout="out('1431826176080351208');" style=""> 248                 customer.setId(customerId);                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 249             } else {                                                                                     </span>
<span class="-5488615021987588883" onmouseenter="enter('-5488615021987588883');" onmouseout="out('-5488615021987588883');" style=""> 250                 customer.setId(findNextCustomerId());                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252         }                                                                                                </span>
<span class="-3853204766136593997" onmouseenter="enter('-3853204766136593997');" onmouseout="out('-3853204766136593997');" style=""> 253         return customer;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254     }                                                                                                    </span>
<span  style=""> 255                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 256     @Override                                                                                            </span>
<span class="4598906423026393934" onmouseenter="enter('4598906423026393934');" onmouseout="out('4598906423026393934');" style=""> 257     public Long findNextCustomerId() {                                                                   </span>
<span class="-8819565094085247576" onmouseenter="enter('-8819565094085247576');" onmouseout="out('-8819565094085247576');" style=""> 258         return idGenerationService.findNextId(Customer.class.getCanonicalName());                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259     }                                                                                                    </span>
<span  style=""> 260                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 261     @Override                                                                                            </span>
<span class="-6999511709583967120" onmouseenter="enter('-6999511709583967120');" onmouseout="out('-6999511709583967120');" style=""> 262     public Customer createNewCustomer() {                                                                </span>
<span class="1533232953867480113" onmouseenter="enter('1533232953867480113');" onmouseout="out('1533232953867480113');" style=""> 263         return createCustomerFromId(null);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264     }                                                                                                    </span>
<span  style=""> 265                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 266     @Override                                                                                            </span>
<span class="7417643297497909843" onmouseenter="enter('7417643297497909843');" onmouseout="out('7417643297497909843');" style=""> 267     public void deleteCustomer(Customer customer) {                                                      </span>
<span class="-3138548839038622796" onmouseenter="enter('-3138548839038622796');" onmouseout="out('-3138548839038622796');" style=""> 268         roleDao.removeCustomerRolesByCustomerId(customer.getId());                                       </span>
<span class="-3819399187793284937" onmouseenter="enter('-3819399187793284937');" onmouseout="out('-3819399187793284937');" style=""> 269         customerDao.delete(customer);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 270     }                                                                                                    </span>
<span  style=""> 271                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 272     @Override                                                                                            </span>
<span class="-5885291655878307572" onmouseenter="enter('-5885291655878307572');" onmouseout="out('-5885291655878307572');" style=""> 273     public Customer readCustomerByUsername(String username) {                                            </span>
<span class="589313108944980188" onmouseenter="enter('589313108944980188');" onmouseout="out('589313108944980188');" style=""> 274         return customerDao.readCustomerByUsername(username);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275     }                                                                                                    </span>
<span  style=""> 276                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 277     @Override                                                                                            </span>
<span class="847254476985500634" onmouseenter="enter('847254476985500634');" onmouseout="out('847254476985500634');" style=""> 278     public Customer readCustomerByUsername(String username, Boolean cacheable) {                         </span>
<span class="482041631891506127" onmouseenter="enter('482041631891506127');" onmouseout="out('482041631891506127');" style=""> 279         return customerDao.readCustomerByUsername(username, cacheable);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280     }                                                                                                    </span>
<span  style=""> 281                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 282     @Override                                                                                            </span>
<span class="-4374586036231570864" onmouseenter="enter('-4374586036231570864');" onmouseout="out('-4374586036231570864');" style=""> 283     public Customer readCustomerById(Long id) {                                                          </span>
<span class="-5062162633750648527" onmouseenter="enter('-5062162633750648527');" onmouseout="out('-5062162633750648527');" style=""> 284         return customerDao.readCustomerById(id);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285     }                                                                                                    </span>
<span  style=""> 286                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 287     @Override                                                                                            </span>
<span class="6825989998352983316" onmouseenter="enter('6825989998352983316');" onmouseout="out('6825989998352983316');" style=""> 288     public Customer readCustomerByExternalId(String userExternalId) {                                    </span>
<span class="5025115365525563343" onmouseenter="enter('5025115365525563343');" onmouseout="out('5025115365525563343');" style=""> 289         return customerDao.readCustomerByExternalId(userExternalId);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290     }                                                                                                    </span>
<span  style=""> 291                                                                                                          </span>
<span class="-8304645560568857694" onmouseenter="enter('-8304645560568857694');" onmouseout="out('-8304645560568857694');" style=""> 292     public void setCustomerDao(CustomerDao customerDao) {                                                </span>
<span class="-1477678724397974795" onmouseenter="enter('-1477678724397974795');" onmouseout="out('-1477678724397974795');" style=""> 293         this.customerDao = customerDao;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294     }                                                                                                    </span>
<span  style=""> 295                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 296     @Override                                                                                            </span>
<span class="-280180772892908532" onmouseenter="enter('-280180772892908532');" onmouseout="out('-280180772892908532');" style=""> 297     public String encodePassword(String rawPassword) {                                                   </span>
<span class="-3121342566836529697" onmouseenter="enter('-3121342566836529697');" onmouseout="out('-3121342566836529697');" style=""> 298         return passwordEncoderBean.encode(rawPassword);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299     }                                                                                                    </span>
<span  style=""> 300                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 301     @Override                                                                                            </span>
<span class="160568672931299235" onmouseenter="enter('160568672931299235');" onmouseout="out('160568672931299235');" style=""> 302     public boolean isPasswordValid(String rawPassword, String encodedPassword) {                         </span>
<span class="5053852377821437125" onmouseenter="enter('5053852377821437125');" onmouseout="out('5053852377821437125');" style=""> 303         return passwordEncoderBean.matches(rawPassword, encodedPassword);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304     }                                                                                                    </span>
<span  style=""> 305                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 306     @Override                                                                                            </span>
<span class="8805988825869661234" onmouseenter="enter('8805988825869661234');" onmouseout="out('8805988825869661234');" style=""> 307     public boolean customerPassesCustomerRule(Customer customer, CustomerRuleHolder customerRuleHolder) {</span>
<span class="-5898565890799276609" onmouseenter="enter('-5898565890799276609');" onmouseout="out('-5898565890799276609');" style=""> 308         String customerRule = customerRuleHolder.getCustomerRule();                                      </span>
<span class="201656563419603782" onmouseenter="enter('201656563419603782');" onmouseout="out('201656563419603782');" style=""> 309         Map&lt;String, Object&gt; ruleParams = buildCustomerRuleParams(customer);                              </span>
<span class="-7214228236632333169" onmouseenter="enter('-7214228236632333169');" onmouseout="out('-7214228236632333169');" style=""> 310         return customerRule == null || MvelHelper.evaluateRule(customerRule, ruleParams);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311     }                                                                                                    </span>
<span  style=""> 312                                                                                                          </span>
<span class="-6781673542839603116" onmouseenter="enter('-6781673542839603116');" onmouseout="out('-6781673542839603116');" style=""> 313     protected Map&lt;String, Object&gt; buildCustomerRuleParams(Customer customer) {                           </span>
<span class="-460782809524910092" onmouseenter="enter('-460782809524910092');" onmouseout="out('-460782809524910092');" style=""> 314         HashMap&lt;String, Object&gt; vars = new HashMap&lt;&gt;();                                                  </span>
<span class="8047728915418269458" onmouseenter="enter('8047728915418269458');" onmouseout="out('8047728915418269458');" style=""> 315         vars.put(&quot;customer&quot;, customer);                                                                  </span>
<span class="3198457421051297297" onmouseenter="enter('3198457421051297297');" onmouseout="out('3198457421051297297');" style=""> 316         return vars;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317     }                                                                                                    </span>
<span  style=""> 318                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 319     @Override                                                                                            </span>
<span class="-3888321916193976828" onmouseenter="enter('-3888321916193976828');" onmouseout="out('-3888321916193976828');" style=""> 320     public List&lt;PasswordUpdatedHandler&gt; getPasswordResetHandlers() {                                     </span>
<span class="6051450225877623454" onmouseenter="enter('6051450225877623454');" onmouseout="out('6051450225877623454');" style=""> 321         return passwordResetHandlers;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322     }                                                                                                    </span>
<span  style=""> 323                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 324     @Override                                                                                            </span>
<span class="-8491421284615626461" onmouseenter="enter('-8491421284615626461');" onmouseout="out('-8491421284615626461');" style=""> 325     public void setPasswordResetHandlers(List&lt;PasswordUpdatedHandler&gt; passwordResetHandlers) {           </span>
<span class="-414209021704348335" onmouseenter="enter('-414209021704348335');" onmouseout="out('-414209021704348335');" style=""> 326         this.passwordResetHandlers = passwordResetHandlers;                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327     }                                                                                                    </span>
<span  style=""> 328                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 329     @Override                                                                                            </span>
<span class="6470870522961056065" onmouseenter="enter('6470870522961056065');" onmouseout="out('6470870522961056065');" style=""> 330     public List&lt;PasswordUpdatedHandler&gt; getPasswordChangedHandlers() {                                   </span>
<span class="-3664837019724564997" onmouseenter="enter('-3664837019724564997');" onmouseout="out('-3664837019724564997');" style=""> 331         return passwordChangedHandlers;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332     }                                                                                                    </span>
<span  style=""> 333                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 334     @Override                                                                                            </span>
<span class="-2683520533006850846" onmouseenter="enter('-2683520533006850846');" onmouseout="out('-2683520533006850846');" style=""> 335     public void setPasswordChangedHandlers(List&lt;PasswordUpdatedHandler&gt; passwordChangedHandlers) {       </span>
<span class="3676994793125858903" onmouseenter="enter('3676994793125858903');" onmouseout="out('3676994793125858903');" style=""> 336         this.passwordChangedHandlers = passwordChangedHandlers;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337     }                                                                                                    </span>
<span  style=""> 338                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 339     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 340     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="-5238259893338926366" onmouseenter="enter('-5238259893338926366');" onmouseout="out('-5238259893338926366');" style=""> 341     public GenericResponse sendForgotUsernameNotification(String emailAddress) {                         </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 342         GenericResponse response = new GenericResponse();                                                </span>
<span class="-6073063203294335299" onmouseenter="enter('-6073063203294335299');" onmouseout="out('-6073063203294335299');" style=""> 343         List&lt;Customer&gt; customers = null;                                                                 </span>
<span class="-8702812354445074278" onmouseenter="enter('-8702812354445074278');" onmouseout="out('-8702812354445074278');" style=""> 344         if (emailAddress != null) {                                                                      </span>
<span class="6147069966980396471" onmouseenter="enter('6147069966980396471');" onmouseout="out('6147069966980396471');" style=""> 345             customers = customerDao.readCustomersByEmail(emailAddress);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 346         }                                                                                                </span>
<span  style=""> 347                                                                                                          </span>
<span class="-6772255019077760087" onmouseenter="enter('-6772255019077760087');" onmouseout="out('-6772255019077760087');" style=""> 348         if (CollectionUtils.isEmpty(customers)) {                                                        </span>
<span class="7242450034468345273" onmouseenter="enter('7242450034468345273');" onmouseout="out('7242450034468345273');" style=""> 349             response.addErrorCode(&quot;notFound&quot;);                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 350         } else {                                                                                         </span>
<span class="-2763458366902467863" onmouseenter="enter('-2763458366902467863');" onmouseout="out('-2763458366902467863');" style=""> 351             List&lt;String&gt; activeUsernames = new ArrayList&lt;String&gt;();                                      </span>
<span class="-5523479913680151900" onmouseenter="enter('-5523479913680151900');" onmouseout="out('-5523479913680151900');" style=""> 352             for (Customer customer : customers) {                                                        </span>
<span class="6036228608782108118" onmouseenter="enter('6036228608782108118');" onmouseout="out('6036228608782108118');" style=""> 353                 if (!customer.isDeactivated()) {                                                         </span>
<span class="-342072533744095855" onmouseenter="enter('-342072533744095855');" onmouseout="out('-342072533744095855');" style=""> 354                     activeUsernames.add(customer.getUsername());                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 355                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356             }                                                                                            </span>
<span  style=""> 357                                                                                                          </span>
<span class="7800996103103911618" onmouseenter="enter('7800996103103911618');" onmouseout="out('7800996103103911618');" style=""> 358             if (activeUsernames.size() &gt; 0) {                                                            </span>
<span class="4008741571181358527" onmouseenter="enter('4008741571181358527');" onmouseout="out('4008741571181358527');" style=""><abbr title=" 359                 eventPublisher.publishEvent(new ForgotUsernameEvent(this, emailAddress, activeUsernames));"> 359                 eventPublisher.publishEvent(new ForgotUsernameEvent(this, emailAddress, activeUsernames))ðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 360             } else {                                                                                     </span>
<span class="3603576439991328525" onmouseenter="enter('3603576439991328525');" onmouseout="out('3603576439991328525');" style=""> 361                 // send inactive username found email.                                                   </span>
<span class="5510537362121156528" onmouseenter="enter('5510537362121156528');" onmouseout="out('5510537362121156528');" style=""> 362                 response.addErrorCode(&quot;inactiveUser&quot;);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364         }                                                                                                </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 365         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366     }                                                                                                    </span>
<span  style=""> 367                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 368     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 369     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="3120849722145808131" onmouseenter="enter('3120849722145808131');" onmouseout="out('3120849722145808131');" style=""> 370     public GenericResponse sendForgotPasswordNotification(String username, String resetPasswordUrl) {    </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 371         GenericResponse response = new GenericResponse();                                                </span>
<span class="6921810928241781426" onmouseenter="enter('6921810928241781426');" onmouseout="out('6921810928241781426');" style=""> 372         Customer customer = null;                                                                        </span>
<span  style=""> 373                                                                                                          </span>
<span class="-8284276918575957483" onmouseenter="enter('-8284276918575957483');" onmouseout="out('-8284276918575957483');" style=""> 374         if (username != null) {                                                                          </span>
<span class="-104711026898859267" onmouseenter="enter('-104711026898859267');" onmouseout="out('-104711026898859267');" style=""> 375             customer = customerDao.readCustomerByUsername(username);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376         }                                                                                                </span>
<span  style=""> 377                                                                                                          </span>
<span class="-3681439263985626916" onmouseenter="enter('-3681439263985626916');" onmouseout="out('-3681439263985626916');" style=""> 378         checkCustomer(customer, response);                                                               </span>
<span  style=""> 379                                                                                                          </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 380         if (!response.getHasErrors()) {                                                                  </span>
<span class="-8225007983262534214" onmouseenter="enter('-8225007983262534214');" onmouseout="out('-8225007983262534214');" style=""> 381             String token = PasswordUtils.generateSecurePassword(getPasswordTokenLength());               </span>
<span class="5927756983469236234" onmouseenter="enter('5927756983469236234');" onmouseout="out('5927756983469236234');" style=""> 382             token = token.toLowerCase();                                                                 </span>
<span  style=""> 383                                                                                                          </span>
<span class="3663219121994932306" onmouseenter="enter('3663219121994932306');" onmouseout="out('3663219121994932306');" style=""> 384             CustomerForgotPasswordSecurityToken fpst = new CustomerForgotPasswordSecurityTokenImpl();    </span>
<span class="-6310870443046136255" onmouseenter="enter('-6310870443046136255');" onmouseout="out('-6310870443046136255');" style=""> 385             fpst.setCustomerId(customer.getId());                                                        </span>
<span class="-1250878182907610155" onmouseenter="enter('-1250878182907610155');" onmouseout="out('-1250878182907610155');" style=""> 386             fpst.setToken(encodePassword(token));                                                        </span>
<span class="118078353989050088" onmouseenter="enter('118078353989050088');" onmouseout="out('118078353989050088');" style=""> 387             fpst.setCreateDate(SystemTime.asDate());                                                     </span>
<span class="6850446059209105577" onmouseenter="enter('6850446059209105577');" onmouseout="out('6850446059209105577');" style=""> 388             customerForgotPasswordSecurityTokenDao.saveToken(fpst);                                      </span>
<span  style=""> 389                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 390 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="8884608966566249698" onmouseenter="enter('8884608966566249698');" onmouseout="out('8884608966566249698');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 391             HashMap&lt;String, Object&gt; vars = new HashMap&lt;String, Object&gt;();                                </span>
<span class="-7576751007074497786" onmouseenter="enter('-7576751007074497786');" onmouseout="out('-7576751007074497786');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 392             vars.put(&quot;token&quot;, token);                                                                    </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 393 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 394         }                                                                                                </span>
<span class="3431775854604648548" onmouseenter="enter('3431775854604648548');" onmouseout="out('3431775854604648548');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 395         return salt;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 396     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 397                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 398     /**                                                                                                  </span>
<span class="-3501183731792941420" onmouseenter="enter('-3501183731792941420');" onmouseout="out('-3501183731792941420');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 399      * Delegates to either the new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.authentication.encoding.PasswordEncoder PasswordEncoder}."> 399      * Delegates to either the new {@link PasswordEncoder} or the deprecated {@link org.springframework.sðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 400      *                                                                                                   </span>
<span class="-6973500330076487399" onmouseenter="enter('-6973500330076487399');" onmouseout="out('-6973500330076487399');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 401      * @param rawPassword the unencoded password                                                         </span>
<span class="-5399617810406361465" onmouseenter="enter('-5399617810406361465');" onmouseout="out('-5399617810406361465');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 402      * @param salt        the optional salt                                                              </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 403      * @return                                                                                           </span>
<span class="3447978539938514357" onmouseenter="enter('3447978539938514357');" onmouseout="out('3447978539938514357');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 404      * @deprecated the new {@link org.springframework.security.crypto.password.PasswordEncoder PasswordEncoder} handles salting internally, this will be removed in 4.2"> 404      * @deprecated the new {@link org.springframework.security.crypto.password.PasswordEncoder PasswordEnðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 405      */                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 406     @Deprecated                                                                                          </span>
<span class="-5592137063291194297" onmouseenter="enter('-5592137063291194297');" onmouseout="out('-5592137063291194297');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 407     protected String encodePass(String rawPassword, Object salt) {                                       </span>
<span class="-7232422938046234962" onmouseenter="enter('-7232422938046234962');" onmouseout="out('-7232422938046234962');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 408         if (usingDeprecatedPasswordEncoder()) {                                                          </span>
<span class="5931714538865276294" onmouseenter="enter('5931714538865276294');" onmouseout="out('5931714538865276294');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 409             return passwordEncoder.encodePassword(rawPassword, salt);                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 410         } else {                                                                                         </span>
<span class="-7923712831729422017" onmouseenter="enter('-7923712831729422017');" onmouseout="out('-7923712831729422017');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 411             return encodePassword(rawPassword);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 412         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 413     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 414                                                                                                          </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 415     @Deprecated                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 416     @Override                                                                                            </span>
<span class="-2464018960647785128" onmouseenter="enter('-2464018960647785128');" onmouseout="out('-2464018960647785128');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 417     public String encodePassword(String rawPassword, Customer customer) {                                </span>
<span class="5068564850157074346" onmouseenter="enter('5068564850157074346');" onmouseout="out('5068564850157074346');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 418         return encodePass(rawPassword, getSalt(customer, rawPassword));                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 419     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 420                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 421     @Override                                                                                            </span>
<span class="-280180772892908532" onmouseenter="enter('-280180772892908532');" onmouseout="out('-280180772892908532');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 422     public String encodePassword(String rawPassword) {                                                   </span>
<span class="-8081074490464189240" onmouseenter="enter('-8081074490464189240');" onmouseout="out('-8081074490464189240');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 423         return passwordEncoderNew.encode(rawPassword);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 424     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 425                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 426     /**                                                                                                  </span>
<span class="-3501183731792941420" onmouseenter="enter('-3501183731792941420');" onmouseout="out('-3501183731792941420');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 427      * Delegates to either the new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.authentication.encoding.PasswordEncoder PasswordEncoder}."> 427      * Delegates to either the new {@link PasswordEncoder} or the deprecated {@link org.springframework.sðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 428      *                                                                                                   </span>
<span class="8775114664172586259" onmouseenter="enter('8775114664172586259');" onmouseout="out('8775114664172586259');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 429      * @param rawPassword     the unencoded password                                                     </span>
<span class="-1452544259905793680" onmouseenter="enter('-1452544259905793680');" onmouseout="out('-1452544259905793680');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 430      * @param encodedPassword the encoded password to compare rawPassword against                        </span>
<span class="1972573824148461217" onmouseenter="enter('1972573824148461217');" onmouseout="out('1972573824148461217');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 431      * @param salt            the optional salt                                                          </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 432      * @return                                                                                           </span>
<span class="3447978539938514357" onmouseenter="enter('3447978539938514357');" onmouseout="out('3447978539938514357');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 433      * @deprecated the new {@link org.springframework.security.crypto.password.PasswordEncoder PasswordEncoder} handles salting internally, this will be removed in 4.2"> 433      * @deprecated the new {@link org.springframework.security.crypto.password.PasswordEncoder PasswordEnðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 434      */                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 435     @Deprecated                                                                                          </span>
<span class="-5399582875183324381" onmouseenter="enter('-5399582875183324381');" onmouseout="out('-5399582875183324381');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 436     protected boolean isPassValid(String rawPassword, String encodedPassword, Object salt) {             </span>
<span class="-7232422938046234962" onmouseenter="enter('-7232422938046234962');" onmouseout="out('-7232422938046234962');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 437         if (usingDeprecatedPasswordEncoder()) {                                                          </span>
<span class="-6959686797048566137" onmouseenter="enter('-6959686797048566137');" onmouseout="out('-6959686797048566137');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 438             return passwordEncoder.isPasswordValid(encodedPassword, rawPassword, salt);                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 439         } else {                                                                                         </span>
<span class="-3664185127944007144" onmouseenter="enter('-3664185127944007144');" onmouseout="out('-3664185127944007144');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 440             return isPasswordValid(rawPassword, encodedPassword);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 441         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 442     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 443                                                                                                          </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 444     @Deprecated                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 445     @Override                                                                                            </span>
<span class="75379594801568475" onmouseenter="enter('75379594801568475');" onmouseout="out('75379594801568475');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 446     public boolean isPasswordValid(String rawPassword, String encodedPassword, Customer customer) {      </span>
<span class="5055494700324745600" onmouseenter="enter('5055494700324745600');" onmouseout="out('5055494700324745600');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 447         return isPassValid(rawPassword, encodedPassword, getSalt(customer, rawPassword));                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 448     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 449                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 450     @Override                                                                                            </span>
<span class="160568672931299235" onmouseenter="enter('160568672931299235');" onmouseout="out('160568672931299235');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 451     public boolean isPasswordValid(String rawPassword, String encodedPassword) {                         </span>
<span class="-3105924845719344527" onmouseenter="enter('-3105924845719344527');" onmouseout="out('-3105924845719344527');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 452         return passwordEncoderNew.matches(rawPassword, encodedPassword);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 453     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 454                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 455     @Override                                                                                            </span>
<span class="8805988825869661234" onmouseenter="enter('8805988825869661234');" onmouseout="out('8805988825869661234');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 456     public boolean customerPassesCustomerRule(Customer customer, CustomerRuleHolder customerRuleHolder) {</span>
<span class="-5898565890799276609" onmouseenter="enter('-5898565890799276609');" onmouseout="out('-5898565890799276609');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 457         String customerRule = customerRuleHolder.getCustomerRule();                                      </span>
<span class="201656563419603782" onmouseenter="enter('201656563419603782');" onmouseout="out('201656563419603782');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 458         Map&lt;String, Object&gt; ruleParams = buildCustomerRuleParams(customer);                              </span>
<span class="-7214228236632333169" onmouseenter="enter('-7214228236632333169');" onmouseout="out('-7214228236632333169');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 459         return customerRule == null || MvelHelper.evaluateRule(customerRule, ruleParams);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 460     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 461                                                                                                          </span>
<span class="-6781673542839603116" onmouseenter="enter('-6781673542839603116');" onmouseout="out('-6781673542839603116');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 462     protected Map&lt;String, Object&gt; buildCustomerRuleParams(Customer customer) {                           </span>
<span class="-460782809524910092" onmouseenter="enter('-460782809524910092');" onmouseout="out('-460782809524910092');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 463         HashMap&lt;String, Object&gt; vars = new HashMap&lt;&gt;();                                                  </span>
<span class="8047728915418269458" onmouseenter="enter('8047728915418269458');" onmouseout="out('8047728915418269458');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 464         vars.put(&quot;customer&quot;, customer);                                                                  </span>
<span class="3198457421051297297" onmouseenter="enter('3198457421051297297');" onmouseout="out('3198457421051297297');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 465         return vars;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 466     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 467                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 468     @Override                                                                                            </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 469     @Deprecated                                                                                          </span>
<span class="5378385800373988521" onmouseenter="enter('5378385800373988521');" onmouseout="out('5378385800373988521');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 470     public String getSalt() {                                                                            </span>
<span class="3431775854604648548" onmouseenter="enter('3431775854604648548');" onmouseout="out('3431775854604648548');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 471         return salt;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 472     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 473                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 474     @Override                                                                                            </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 475     @Deprecated                                                                                          </span>
<span class="-4361425533599957857" onmouseenter="enter('-4361425533599957857');" onmouseout="out('-4361425533599957857');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 476     public void setSalt(String salt) {                                                                   </span>
<span class="-4513734365927734086" onmouseenter="enter('-4513734365927734086');" onmouseout="out('-4513734365927734086');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 477         this.salt = salt;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 478     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 479                                                                                                          </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 480     @Deprecated                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 481     @Override                                                                                            </span>
<span class="-7604283301279549906" onmouseenter="enter('-7604283301279549906');" onmouseout="out('-7604283301279549906');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 482     public SaltSource getSaltSource() {                                                                  </span>
<span class="-904082433474924859" onmouseenter="enter('-904082433474924859');" onmouseout="out('-904082433474924859');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 483         return saltSource;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 484     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 485                                                                                                          </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 486     @Deprecated                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 487     @Override                                                                                            </span>
<span class="4344683956985852323" onmouseenter="enter('4344683956985852323');" onmouseout="out('4344683956985852323');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 488     public void setSaltSource(SaltSource saltSource) {                                                   </span>
<span class="-2983665589785658662" onmouseenter="enter('-2983665589785658662');" onmouseout="out('-2983665589785658662');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 489         this.saltSource = saltSource;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 490     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 491                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 492     @Override                                                                                            </span>
<span class="-3888321916193976828" onmouseenter="enter('-3888321916193976828');" onmouseout="out('-3888321916193976828');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 493     public List&lt;PasswordUpdatedHandler&gt; getPasswordResetHandlers() {                                     </span>
<span class="6051450225877623454" onmouseenter="enter('6051450225877623454');" onmouseout="out('6051450225877623454');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 494         return passwordResetHandlers;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 495     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 496                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 497     @Override                                                                                            </span>
<span class="-8491421284615626461" onmouseenter="enter('-8491421284615626461');" onmouseout="out('-8491421284615626461');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 498     public void setPasswordResetHandlers(List&lt;PasswordUpdatedHandler&gt; passwordResetHandlers) {           </span>
<span class="-414209021704348335" onmouseenter="enter('-414209021704348335');" onmouseout="out('-414209021704348335');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 499         this.passwordResetHandlers = passwordResetHandlers;                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 500     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 501                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 502     @Override                                                                                            </span>
<span class="6470870522961056065" onmouseenter="enter('6470870522961056065');" onmouseout="out('6470870522961056065');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 503     public List&lt;PasswordUpdatedHandler&gt; getPasswordChangedHandlers() {                                   </span>
<span class="-3664837019724564997" onmouseenter="enter('-3664837019724564997');" onmouseout="out('-3664837019724564997');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 504         return passwordChangedHandlers;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 505     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 506                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 507     @Override                                                                                            </span>
<span class="-2683520533006850846" onmouseenter="enter('-2683520533006850846');" onmouseout="out('-2683520533006850846');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 508     public void setPasswordChangedHandlers(List&lt;PasswordUpdatedHandler&gt; passwordChangedHandlers) {       </span>
<span class="3676994793125858903" onmouseenter="enter('3676994793125858903');" onmouseout="out('3676994793125858903');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 509         this.passwordChangedHandlers = passwordChangedHandlers;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 510     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 511                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 512     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 513     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="-5238259893338926366" onmouseenter="enter('-5238259893338926366');" onmouseout="out('-5238259893338926366');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 514     public GenericResponse sendForgotUsernameNotification(String emailAddress) {                         </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 515         GenericResponse response = new GenericResponse();                                                </span>
<span class="-6073063203294335299" onmouseenter="enter('-6073063203294335299');" onmouseout="out('-6073063203294335299');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 516         List&lt;Customer&gt; customers = null;                                                                 </span>
<span class="-8702812354445074278" onmouseenter="enter('-8702812354445074278');" onmouseout="out('-8702812354445074278');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 517         if (emailAddress != null) {                                                                      </span>
<span class="6147069966980396471" onmouseenter="enter('6147069966980396471');" onmouseout="out('6147069966980396471');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 518             customers = customerDao.readCustomersByEmail(emailAddress);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 519         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 520                                                                                                          </span>
<span class="-6772255019077760087" onmouseenter="enter('-6772255019077760087');" onmouseout="out('-6772255019077760087');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 521         if (CollectionUtils.isEmpty(customers)) {                                                        </span>
<span class="7242450034468345273" onmouseenter="enter('7242450034468345273');" onmouseout="out('7242450034468345273');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 522             response.addErrorCode(&quot;notFound&quot;);                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 523         } else {                                                                                         </span>
<span class="-2763458366902467863" onmouseenter="enter('-2763458366902467863');" onmouseout="out('-2763458366902467863');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 524             List&lt;String&gt; activeUsernames = new ArrayList&lt;String&gt;();                                      </span>
<span class="-5523479913680151900" onmouseenter="enter('-5523479913680151900');" onmouseout="out('-5523479913680151900');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 525             for (Customer customer : customers) {                                                        </span>
<span class="6036228608782108118" onmouseenter="enter('6036228608782108118');" onmouseout="out('6036228608782108118');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 526                 if (!customer.isDeactivated()) {                                                         </span>
<span class="-342072533744095855" onmouseenter="enter('-342072533744095855');" onmouseout="out('-342072533744095855');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 527                     activeUsernames.add(customer.getUsername());                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 528                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 529             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 530                                                                                                          </span>
<span class="7800996103103911618" onmouseenter="enter('7800996103103911618');" onmouseout="out('7800996103103911618');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 531             if (activeUsernames.size() &gt; 0) {                                                            </span>
<span class="8884608966566249698" onmouseenter="enter('8884608966566249698');" onmouseout="out('8884608966566249698');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 532                 HashMap&lt;String, Object&gt; vars = new HashMap&lt;String, Object&gt;();                            </span>
<span class="4818637068787553246" onmouseenter="enter('4818637068787553246');" onmouseout="out('4818637068787553246');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 533                 vars.put(&quot;userNames&quot;, activeUsernames);                                                  </span>
<span class="315134285136713426" onmouseenter="enter('315134285136713426');" onmouseout="out('315134285136713426');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 534                 sendEmail(emailAddress, getForgotUsernameEmailInfo(), vars);                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 535             } else {                                                                                     </span>
<span class="3603576439991328525" onmouseenter="enter('3603576439991328525');" onmouseout="out('3603576439991328525');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 536                 // send inactive username found email.                                                   </span>
<span class="5510537362121156528" onmouseenter="enter('5510537362121156528');" onmouseout="out('5510537362121156528');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 537                 response.addErrorCode(&quot;inactiveUser&quot;);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 538             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 539         }                                                                                                </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 540         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 541     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 542                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 543     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 544     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="3120849722145808131" onmouseenter="enter('3120849722145808131');" onmouseout="out('3120849722145808131');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 545     public GenericResponse sendForgotPasswordNotification(String username, String resetPasswordUrl) {    </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 546         GenericResponse response = new GenericResponse();                                                </span>
<span class="6921810928241781426" onmouseenter="enter('6921810928241781426');" onmouseout="out('6921810928241781426');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 547         Customer customer = null;                                                                        </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 548                                                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 549 =======                                                                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 550 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="7676904455881888218" onmouseenter="enter('7676904455881888218');" onmouseout="out('7676904455881888218');" style=""> 551             if (!StringUtils.isEmpty(resetPasswordUrl)) {                                                </span>
<span class="-504875606182491340" onmouseenter="enter('-504875606182491340');" onmouseout="out('-504875606182491340');" style=""> 552                 if (resetPasswordUrl.contains(&quot;?&quot;)) {                                                    </span>
<span class="4689815450255607142" onmouseenter="enter('4689815450255607142');" onmouseout="out('4689815450255607142');" style=""> 553                     resetPasswordUrl = resetPasswordUrl+&quot;&amp;token=&quot;+token;                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 554                 } else {                                                                                 </span>
<span class="6497934083360311601" onmouseenter="enter('6497934083360311601');" onmouseout="out('6497934083360311601');" style=""> 555                     resetPasswordUrl = resetPasswordUrl+&quot;?token=&quot;+token;                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 556                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 557             }                                                                                            </span>
<span  style=""> 558                                                                                                          </span>
<span class="-8393391692837051437" onmouseenter="enter('-8393391692837051437');" onmouseout="out('-8393391692837051437');" style=""><abbr title=" 559             eventPublisher.publishEvent(new ForgotPasswordEvent(this, customer.getId(), token, resetPasswordUrl));"> 559             eventPublisher.publishEvent(new ForgotPasswordEvent(this, customer.getId(), token, resetPasswðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 560         }                                                                                                </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 561         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 562     }                                                                                                    </span>
<span  style=""> 563                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 564     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 565     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="-6820057886432852816" onmouseenter="enter('-6820057886432852816');" onmouseout="out('-6820057886432852816');" style=""><abbr title=" 566     public GenericResponse sendForcedPasswordChangeNotification(String username, String resetPasswordUrl) {"> 566     public GenericResponse sendForcedPasswordChangeNotification(String username, String resetPasswordUrl)ðŸ”µ</abbr></span>
<span class="-12493669403857096" onmouseenter="enter('-12493669403857096');" onmouseout="out('-12493669403857096');" style=""> 567         return sendForgotPasswordNotification(username, resetPasswordUrl);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 568     }                                                                                                    </span>
<span  style=""> 569                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 570     @Override                                                                                            </span>
<span class="-7547112806897146214" onmouseenter="enter('-7547112806897146214');" onmouseout="out('-7547112806897146214');" style=""> 571     public GenericResponse checkPasswordResetToken(String token, Customer customer) {                    </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 572         GenericResponse response = new GenericResponse();                                                </span>
<span class="913599117713435265" onmouseenter="enter('913599117713435265');" onmouseout="out('913599117713435265');" style=""> 573         checkPasswordResetToken(token, customer, response);                                              </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 574         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 575     }                                                                                                    </span>
<span  style=""> 576                                                                                                          </span>
<span class="1872423782765914316" onmouseenter="enter('1872423782765914316');" onmouseout="out('1872423782765914316');" style=""><abbr title=" 577     protected CustomerForgotPasswordSecurityToken checkPasswordResetToken(String token, Customer customer, GenericResponse response) {"> 577     protected CustomerForgotPasswordSecurityToken checkPasswordResetToken(String token, Customer customerðŸ”µ</abbr></span>
<span class="-4169390037463393090" onmouseenter="enter('-4169390037463393090');" onmouseout="out('-4169390037463393090');" style=""> 578         if (StringUtils.isBlank(token)) {                                                                </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style=""> 579             response.addErrorCode(&quot;invalidToken&quot;);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 580         }                                                                                                </span>
<span  style=""> 581                                                                                                          </span>
<span class="5092673057151141969" onmouseenter="enter('5092673057151141969');" onmouseout="out('5092673057151141969');" style=""> 582         String rawToken = token;                                                                         </span>
<span  style=""> 583                                                                                                          </span>
<span class="-7243325982712524701" onmouseenter="enter('-7243325982712524701');" onmouseout="out('-7243325982712524701');" style=""> 584         CustomerForgotPasswordSecurityToken fpst = null;                                                 </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 585         if (!response.getHasErrors()) {                                                                  </span>
<span class="-1371412200964570990" onmouseenter="enter('-1371412200964570990');" onmouseout="out('-1371412200964570990');" style=""> 586             if (customer == null) {                                                                      </span>
<span class="5265761721143258453" onmouseenter="enter('5265761721143258453');" onmouseout="out('5265761721143258453');" style=""> 587                 fpst = customerForgotPasswordSecurityTokenDao.readToken(encodePassword(token));          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 588             } else {                                                                                     </span>
<span class="-2708743959084825308" onmouseenter="enter('-2708743959084825308');" onmouseout="out('-2708743959084825308');" style=""><abbr title=" 589                 List&lt;CustomerForgotPasswordSecurityToken&gt; fpstoks = customerForgotPasswordSecurityTokenDao.readUnusedTokensByCustomerId(customer.getId());"> 589                 List&lt;CustomerForgotPasswordSecurityToken&gt; fpstoks = customerForgotPasswordSecurityTokenDaðŸ”µ</abbr></span>
<span class="6715544567105364437" onmouseenter="enter('6715544567105364437');" onmouseout="out('6715544567105364437');" style=""> 590                 for (CustomerForgotPasswordSecurityToken fpstok : fpstoks) {                             </span>
<span class="-2377519018742151157" onmouseenter="enter('-2377519018742151157');" onmouseout="out('-2377519018742151157');" style=""> 591                     if (isPasswordValid(rawToken, fpstok.getToken())) {                                  </span>
<span class="-8696697531199533964" onmouseenter="enter('-8696697531199533964');" onmouseout="out('-8696697531199533964');" style=""> 592                         fpst = fpstok;                                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 593                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 594                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 595                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 596             }                                                                                            </span>
<span class="-1673544419969423705" onmouseenter="enter('-1673544419969423705');" onmouseout="out('-1673544419969423705');" style=""> 597             if (fpst == null) {                                                                          </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style=""> 598                 response.addErrorCode(&quot;invalidToken&quot;);                                                   </span>
<span class="-1851754756462568438" onmouseenter="enter('-1851754756462568438');" onmouseout="out('-1851754756462568438');" style=""> 599             } else if (fpst.isTokenUsedFlag()) {                                                         </span>
<span class="-4571187449058469389" onmouseenter="enter('-4571187449058469389');" onmouseout="out('-4571187449058469389');" style=""> 600                 response.addErrorCode(&quot;tokenUsed&quot;);                                                      </span>
<span class="1126518180689710158" onmouseenter="enter('1126518180689710158');" onmouseout="out('1126518180689710158');" style=""> 601             } else if (isTokenExpired(fpst)) {                                                           </span>
<span class="1324239895302259913" onmouseenter="enter('1324239895302259913');" onmouseout="out('1324239895302259913');" style=""> 602                 response.addErrorCode(&quot;tokenExpired&quot;);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 603             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 604         }                                                                                                </span>
<span class="-4960476697639333031" onmouseenter="enter('-4960476697639333031');" onmouseout="out('-4960476697639333031');" style=""> 605         return fpst;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 606     }                                                                                                    </span>
<span  style=""> 607                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 608     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 609     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="-1553234826628367049" onmouseenter="enter('-1553234826628367049');" onmouseout="out('-1553234826628367049');" style=""><abbr title=" 610     public GenericResponse resetPasswordUsingToken(String username, String token, String password, String confirmPassword) {"> 610     public GenericResponse resetPasswordUsingToken(String username, String token, String password, StringðŸ”µ</abbr></span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 611         GenericResponse response = new GenericResponse();                                                </span>
<span class="6921810928241781426" onmouseenter="enter('6921810928241781426');" onmouseout="out('6921810928241781426');" style=""> 612         Customer customer = null;                                                                        </span>
<span class="-8284276918575957483" onmouseenter="enter('-8284276918575957483');" onmouseout="out('-8284276918575957483');" style=""> 613         if (username != null) {                                                                          </span>
<span class="-104711026898859267" onmouseenter="enter('-104711026898859267');" onmouseout="out('-104711026898859267');" style=""> 614             customer = customerDao.readCustomerByUsername(username);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 615         }                                                                                                </span>
<span class="-3681439263985626916" onmouseenter="enter('-3681439263985626916');" onmouseout="out('-3681439263985626916');" style=""> 616         checkCustomer(customer, response);                                                               </span>
<span class="-3971600249312835278" onmouseenter="enter('-3971600249312835278');" onmouseout="out('-3971600249312835278');" style=""> 617         checkPassword(password, confirmPassword, response);                                              </span>
<span class="2411779224658140401" onmouseenter="enter('2411779224658140401');" onmouseout="out('2411779224658140401');" style=""> 618         CustomerForgotPasswordSecurityToken fpst = checkPasswordResetToken(token, customer, response);   </span>
<span  style=""> 619                                                                                                          </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 620         if (!response.getHasErrors()) {                                                                  </span>
<span class="485270787578743194" onmouseenter="enter('485270787578743194');" onmouseout="out('485270787578743194');" style=""> 621             if (!customer.getId().equals(fpst.getCustomerId())) {                                        </span>
<span class="-5994256316510103080" onmouseenter="enter('-5994256316510103080');" onmouseout="out('-5994256316510103080');" style=""> 622                 if (LOG.isWarnEnabled()) {                                                               </span>
<span class="-3030254613251423793" onmouseenter="enter('-3030254613251423793');" onmouseout="out('-3030254613251423793');" style=""><abbr title=" 623                     LOG.warn(&quot;Password reset attempt tried with mismatched customer and token &quot; + customer.getId() + &quot;, &quot; + StringUtil.sanitize(token));"> 623                     LOG.warn(&quot;Password reset attempt tried with mismatched customer and token &quot; + customeðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 624                 }                                                                                        </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style=""> 625                 response.addErrorCode(&quot;invalidToken&quot;);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 626             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 627         }                                                                                                </span>
<span  style=""> 628                                                                                                          </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 629         if (!response.getHasErrors()) {                                                                  </span>
<span class="5101903206908082309" onmouseenter="enter('5101903206908082309');" onmouseout="out('5101903206908082309');" style=""> 630             customer.setUnencodedPassword(password);                                                     </span>
<span class="6606672839011797247" onmouseenter="enter('6606672839011797247');" onmouseout="out('6606672839011797247');" style=""> 631             customer.setPasswordChangeRequired(false);                                                   </span>
<span class="3384492063942947657" onmouseenter="enter('3384492063942947657');" onmouseout="out('3384492063942947657');" style=""> 632             saveCustomer(customer);                                                                      </span>
<span class="-7517227353230604805" onmouseenter="enter('-7517227353230604805');" onmouseout="out('-7517227353230604805');" style=""> 633             invalidateAllTokensForCustomer(customer);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 634         }                                                                                                </span>
<span  style=""> 635                                                                                                          </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 636         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 637     }                                                                                                    </span>
<span  style=""> 638                                                                                                          </span>
<span class="2450635656385893269" onmouseenter="enter('2450635656385893269');" onmouseout="out('2450635656385893269');" style=""> 639     protected void invalidateAllTokensForCustomer(Customer customer) {                                   </span>
<span class="500146367959601607" onmouseenter="enter('500146367959601607');" onmouseout="out('500146367959601607');" style=""><abbr title=" 640         List&lt;CustomerForgotPasswordSecurityToken&gt; tokens = customerForgotPasswordSecurityTokenDao.readUnusedTokensByCustomerId(customer.getId());"> 640         List&lt;CustomerForgotPasswordSecurityToken&gt; tokens = customerForgotPasswordSecurityTokenDao.readUnuðŸ”µ</abbr></span>
<span class="34403017169246064" onmouseenter="enter('34403017169246064');" onmouseout="out('34403017169246064');" style=""> 641         for (CustomerForgotPasswordSecurityToken token : tokens) {                                       </span>
<span class="-3707452475519083600" onmouseenter="enter('-3707452475519083600');" onmouseout="out('-3707452475519083600');" style=""> 642             token.setTokenUsedFlag(true);                                                                </span>
<span class="-8670185777060395996" onmouseenter="enter('-8670185777060395996');" onmouseout="out('-8670185777060395996');" style=""> 643             customerForgotPasswordSecurityTokenDao.saveToken(token);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 644         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 645     }                                                                                                    </span>
<span  style=""> 646                                                                                                          </span>
<span class="3178004875725558699" onmouseenter="enter('3178004875725558699');" onmouseout="out('3178004875725558699');" style=""> 647     protected void checkCustomer(Customer customer, GenericResponse response) {                          </span>
<span class="-1371412200964570990" onmouseenter="enter('-1371412200964570990');" onmouseout="out('-1371412200964570990');" style=""> 648         if (customer == null) {                                                                          </span>
<span class="-397249380987924174" onmouseenter="enter('-397249380987924174');" onmouseout="out('-397249380987924174');" style=""> 649             response.addErrorCode(&quot;invalidCustomer&quot;);                                                    </span>
<span class="-1786182981140386352" onmouseenter="enter('-1786182981140386352');" onmouseout="out('-1786182981140386352');" style=""> 650         } else if (StringUtils.isBlank(customer.getEmailAddress())) {                                    </span>
<span class="3641519375839212970" onmouseenter="enter('3641519375839212970');" onmouseout="out('3641519375839212970');" style=""> 651             response.addErrorCode(&quot;emailNotFound&quot;);                                                      </span>
<span class="4935674502595460128" onmouseenter="enter('4935674502595460128');" onmouseout="out('4935674502595460128');" style=""> 652         } else if (customer.isDeactivated()) {                                                           </span>
<span class="5510537362121156528" onmouseenter="enter('5510537362121156528');" onmouseout="out('5510537362121156528');" style=""> 653             response.addErrorCode(&quot;inactiveUser&quot;);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 654         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 655     }                                                                                                    </span>
<span  style=""> 656                                                                                                          </span>
<span class="-3281949438797137351" onmouseenter="enter('-3281949438797137351');" onmouseout="out('-3281949438797137351');" style=""> 657     protected void checkPassword(String password, String confirmPassword, GenericResponse response) {    </span>
<span class="2256032458684464296" onmouseenter="enter('2256032458684464296');" onmouseout="out('2256032458684464296');" style=""> 658         if (StringUtils.isBlank(password) || StringUtils.isBlank(confirmPassword)) {                     </span>
<span class="5492480053199382271" onmouseenter="enter('5492480053199382271');" onmouseout="out('5492480053199382271');" style=""> 659             response.addErrorCode(&quot;invalidPassword&quot;);                                                    </span>
<span class="5837283644501577917" onmouseenter="enter('5837283644501577917');" onmouseout="out('5837283644501577917');" style=""> 660         } else if (!password.equals(confirmPassword)) {                                                  </span>
<span class="-5929993345093092025" onmouseenter="enter('-5929993345093092025');" onmouseout="out('-5929993345093092025');" style=""> 661             response.addErrorCode(&quot;passwordMismatch&quot;);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 662         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 663     }                                                                                                    </span>
<span  style=""> 664                                                                                                          </span>
<span class="2301745374477860963" onmouseenter="enter('2301745374477860963');" onmouseout="out('2301745374477860963');" style=""> 665     protected boolean isTokenExpired(CustomerForgotPasswordSecurityToken fpst) {                         </span>
<span class="7457175319484101734" onmouseenter="enter('7457175319484101734');" onmouseout="out('7457175319484101734');" style=""> 666         Date now = SystemTime.asDate();                                                                  </span>
<span class="4814679658448270347" onmouseenter="enter('4814679658448270347');" onmouseout="out('4814679658448270347');" style=""> 667         long currentTimeInMillis = now.getTime();                                                        </span>
<span class="2086457980523585614" onmouseenter="enter('2086457980523585614');" onmouseout="out('2086457980523585614');" style=""> 668         long tokenSaveTimeInMillis = fpst.getCreateDate().getTime();                                     </span>
<span class="6156534052742928347" onmouseenter="enter('6156534052742928347');" onmouseout="out('6156534052742928347');" style=""> 669         long minutesSinceSave = (currentTimeInMillis - tokenSaveTimeInMillis) / 60000;                   </span>
<span class="4808087245976426488" onmouseenter="enter('4808087245976426488');" onmouseout="out('4808087245976426488');" style=""> 670         return minutesSinceSave &gt; tokenExpiredMinutes;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 671     }                                                                                                    </span>
<span  style=""> 672                                                                                                          </span>
<span class="-7890820258027638542" onmouseenter="enter('-7890820258027638542');" onmouseout="out('-7890820258027638542');" style=""> 673     public int getTokenExpiredMinutes() {                                                                </span>
<span class="-8144525086468905422" onmouseenter="enter('-8144525086468905422');" onmouseout="out('-8144525086468905422');" style=""> 674         return tokenExpiredMinutes;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 675     }                                                                                                    </span>
<span  style=""> 676                                                                                                          </span>
<span class="-4089110355878340459" onmouseenter="enter('-4089110355878340459');" onmouseout="out('-4089110355878340459');" style=""> 677     public void setTokenExpiredMinutes(int tokenExpiredMinutes) {                                        </span>
<span class="-6197938813064605922" onmouseenter="enter('-6197938813064605922');" onmouseout="out('-6197938813064605922');" style=""> 678         this.tokenExpiredMinutes = tokenExpiredMinutes;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 679     }                                                                                                    </span>
<span  style=""> 680                                                                                                          </span>
<span class="-2211298406731211675" onmouseenter="enter('-2211298406731211675');" onmouseout="out('-2211298406731211675');" style=""> 681     public int getPasswordTokenLength() {                                                                </span>
<span class="-9052975427749106201" onmouseenter="enter('-9052975427749106201');" onmouseout="out('-9052975427749106201');" style=""> 682         return passwordTokenLength;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 683     }                                                                                                    </span>
<span  style=""> 684                                                                                                          </span>
<span class="4968817442646533856" onmouseenter="enter('4968817442646533856');" onmouseout="out('4968817442646533856');" style=""> 685     public void setPasswordTokenLength(int passwordTokenLength) {                                        </span>
<span class="-6372163195142109946" onmouseenter="enter('-6372163195142109946');" onmouseout="out('-6372163195142109946');" style=""> 686         this.passwordTokenLength = passwordTokenLength;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 687     }                                                                                                    </span>
<span  style=""> 688                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 689 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 690                                                                                                          </span>
<span class="-2426619698179732460" onmouseenter="enter('-2426619698179732460');" onmouseout="out('-2426619698179732460');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 691     public EmailInfo getForgotPasswordEmailInfo() {                                                      </span>
<span class="8553850930406344086" onmouseenter="enter('8553850930406344086');" onmouseout="out('8553850930406344086');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 692         return forgotPasswordEmailInfo;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 693     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 694                                                                                                          </span>
<span class="-5968004809391300230" onmouseenter="enter('-5968004809391300230');" onmouseout="out('-5968004809391300230');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 695     public void setForgotPasswordEmailInfo(EmailInfo forgotPasswordEmailInfo) {                          </span>
<span class="3510418398145123936" onmouseenter="enter('3510418398145123936');" onmouseout="out('3510418398145123936');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 696         this.forgotPasswordEmailInfo = forgotPasswordEmailInfo;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 697     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 698                                                                                                          </span>
<span class="7679605086459105581" onmouseenter="enter('7679605086459105581');" onmouseout="out('7679605086459105581');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 699     public EmailInfo getForgotUsernameEmailInfo() {                                                      </span>
<span class="-8928803675058205054" onmouseenter="enter('-8928803675058205054');" onmouseout="out('-8928803675058205054');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 700         return forgotUsernameEmailInfo;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 701     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 702                                                                                                          </span>
<span class="7097836574720204185" onmouseenter="enter('7097836574720204185');" onmouseout="out('7097836574720204185');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 703     public void setForgotUsernameEmailInfo(EmailInfo forgotUsernameEmailInfo) {                          </span>
<span class="-6675027655322416901" onmouseenter="enter('-6675027655322416901');" onmouseout="out('-6675027655322416901');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 704         this.forgotUsernameEmailInfo = forgotUsernameEmailInfo;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 705     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 706                                                                                                          </span>
<span class="5133340881216779756" onmouseenter="enter('5133340881216779756');" onmouseout="out('5133340881216779756');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 707     public EmailInfo getRegistrationEmailInfo() {                                                        </span>
<span class="-8178127994446042174" onmouseenter="enter('-8178127994446042174');" onmouseout="out('-8178127994446042174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 708         return registrationEmailInfo;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 709     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 710                                                                                                          </span>
<span class="-1271447752357505583" onmouseenter="enter('-1271447752357505583');" onmouseout="out('-1271447752357505583');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 711     public void setRegistrationEmailInfo(EmailInfo registrationEmailInfo) {                              </span>
<span class="-6232198529948124277" onmouseenter="enter('-6232198529948124277');" onmouseout="out('-6232198529948124277');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 712         this.registrationEmailInfo = registrationEmailInfo;                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 713     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 714                                                                                                          </span>
<span class="5129663219504237585" onmouseenter="enter('5129663219504237585');" onmouseout="out('5129663219504237585');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 715     public EmailInfo getChangePasswordEmailInfo() {                                                      </span>
<span class="-1635559517766867718" onmouseenter="enter('-1635559517766867718');" onmouseout="out('-1635559517766867718');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 716         return changePasswordEmailInfo;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 717     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 718                                                                                                          </span>
<span class="9037922117099126087" onmouseenter="enter('9037922117099126087');" onmouseout="out('9037922117099126087');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 719     public void setChangePasswordEmailInfo(EmailInfo changePasswordEmailInfo) {                          </span>
<span class="-7914138197132411471" onmouseenter="enter('-7914138197132411471');" onmouseout="out('-7914138197132411471');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 720         this.changePasswordEmailInfo = changePasswordEmailInfo;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 721     }                                                                                                    </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 722 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 723             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 724         }                                                                                                </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 725         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 726     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 727                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 728     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 729     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="3120849722145808131" onmouseenter="enter('3120849722145808131');" onmouseout="out('3120849722145808131');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 730     public GenericResponse sendForgotPasswordNotification(String username, String resetPasswordUrl) {    </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 731         GenericResponse response = new GenericResponse();                                                </span>
<span class="6921810928241781426" onmouseenter="enter('6921810928241781426');" onmouseout="out('6921810928241781426');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 732         Customer customer = null;                                                                        </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 733                                                                                                          </span>
<span class="-8284276918575957483" onmouseenter="enter('-8284276918575957483');" onmouseout="out('-8284276918575957483');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 734         if (username != null) {                                                                          </span>
<span class="-104711026898859267" onmouseenter="enter('-104711026898859267');" onmouseout="out('-104711026898859267');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 735             customer = customerDao.readCustomerByUsername(username);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 736         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 737                                                                                                          </span>
<span class="-3681439263985626916" onmouseenter="enter('-3681439263985626916');" onmouseout="out('-3681439263985626916');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 738         checkCustomer(customer, response);                                                               </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 739                                                                                                          </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 740         if (!response.getHasErrors()) {                                                                  </span>
<span class="-8225007983262534214" onmouseenter="enter('-8225007983262534214');" onmouseout="out('-8225007983262534214');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 741             String token = PasswordUtils.generateSecurePassword(getPasswordTokenLength());               </span>
<span class="5927756983469236234" onmouseenter="enter('5927756983469236234');" onmouseout="out('5927756983469236234');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 742             token = token.toLowerCase();                                                                 </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 743                                                                                                          </span>
<span class="-2882068698546261553" onmouseenter="enter('-2882068698546261553');" onmouseout="out('-2882068698546261553');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 744             Object salt = getSalt(customer, token);                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 745                                                                                                          </span>
<span class="6651571153976219369" onmouseenter="enter('6651571153976219369');" onmouseout="out('6651571153976219369');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 746             String saltString = null;                                                                    </span>
<span class="-2806376417463223295" onmouseenter="enter('-2806376417463223295');" onmouseout="out('-2806376417463223295');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 747             if (salt != null) {                                                                          </span>
<span class="3371007872827291513" onmouseenter="enter('3371007872827291513');" onmouseout="out('3371007872827291513');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 748                 saltString = Hex.encodeHexString(salt.toString().getBytes());                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 749             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 750                                                                                                          </span>
<span class="3663219121994932306" onmouseenter="enter('3663219121994932306');" onmouseout="out('3663219121994932306');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 751             CustomerForgotPasswordSecurityToken fpst = new CustomerForgotPasswordSecurityTokenImpl();    </span>
<span class="-6310870443046136255" onmouseenter="enter('-6310870443046136255');" onmouseout="out('-6310870443046136255');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 752             fpst.setCustomerId(customer.getId());                                                        </span>
<span class="-6468715476522634243" onmouseenter="enter('-6468715476522634243');" onmouseout="out('-6468715476522634243');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 753             fpst.setToken(encodePass(token, saltString));                                                </span>
<span class="118078353989050088" onmouseenter="enter('118078353989050088');" onmouseout="out('118078353989050088');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 754             fpst.setCreateDate(SystemTime.asDate());                                                     </span>
<span class="6850446059209105577" onmouseenter="enter('6850446059209105577');" onmouseout="out('6850446059209105577');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 755             customerForgotPasswordSecurityTokenDao.saveToken(fpst);                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 756                                                                                                          </span>
<span class="-6985897272839950635" onmouseenter="enter('-6985897272839950635');" onmouseout="out('-6985897272839950635');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 757             if (usingDeprecatedPasswordEncoder() &amp;&amp; saltString != null) {                                </span>
<span class="2358421753202301133" onmouseenter="enter('2358421753202301133');" onmouseout="out('2358421753202301133');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 758                 token = token + &#x27;-&#x27; + saltString;                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 759             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 760                                                                                                          </span>
<span class="8884608966566249698" onmouseenter="enter('8884608966566249698');" onmouseout="out('8884608966566249698');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 761             HashMap&lt;String, Object&gt; vars = new HashMap&lt;String, Object&gt;();                                </span>
<span class="-7576751007074497786" onmouseenter="enter('-7576751007074497786');" onmouseout="out('-7576751007074497786');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 762             vars.put(&quot;token&quot;, token);                                                                    </span>
<span class="7676904455881888218" onmouseenter="enter('7676904455881888218');" onmouseout="out('7676904455881888218');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 763             if (!StringUtils.isEmpty(resetPasswordUrl)) {                                                </span>
<span class="-504875606182491340" onmouseenter="enter('-504875606182491340');" onmouseout="out('-504875606182491340');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 764                 if (resetPasswordUrl.contains(&quot;?&quot;)) {                                                    </span>
<span class="-909834401001506984" onmouseenter="enter('-909834401001506984');" onmouseout="out('-909834401001506984');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 765                     resetPasswordUrl = resetPasswordUrl + &quot;&amp;token=&quot; + token;                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 766                 } else {                                                                                 </span>
<span class="-4209124057383847446" onmouseenter="enter('-4209124057383847446');" onmouseout="out('-4209124057383847446');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 767                     resetPasswordUrl = resetPasswordUrl + &quot;?token=&quot; + token;                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 768                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 769             }                                                                                            </span>
<span class="3935125112670028800" onmouseenter="enter('3935125112670028800');" onmouseout="out('3935125112670028800');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 770             vars.put(&quot;resetPasswordUrl&quot;, resetPasswordUrl);                                              </span>
<span class="543740076975682961" onmouseenter="enter('543740076975682961');" onmouseout="out('543740076975682961');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 771             sendEmail(customer.getEmailAddress(), getForgotPasswordEmailInfo(), vars);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 772         }                                                                                                </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 773         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 774     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 775                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 776     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 777     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="-6820057886432852816" onmouseenter="enter('-6820057886432852816');" onmouseout="out('-6820057886432852816');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 778     public GenericResponse sendForcedPasswordChangeNotification(String username, String resetPasswordUrl) {"> 778     public GenericResponse sendForcedPasswordChangeNotification(String username, String resetPasswordUrl)ðŸ”µ</abbr></span>
<span class="-12493669403857096" onmouseenter="enter('-12493669403857096');" onmouseout="out('-12493669403857096');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 779         return sendForgotPasswordNotification(username, resetPasswordUrl);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 780     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 781                                                                                                          </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 782     @Deprecated                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 783     @Override                                                                                            </span>
<span class="2764175161613765865" onmouseenter="enter('2764175161613765865');" onmouseout="out('2764175161613765865');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 784     public GenericResponse checkPasswordResetToken(String token) {                                       </span>
<span class="-3461464951845163420" onmouseenter="enter('-3461464951845163420');" onmouseout="out('-3461464951845163420');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 785         if (!usingDeprecatedPasswordEncoder()) {                                                         </span>
<span class="2139035906527134472" onmouseenter="enter('2139035906527134472');" onmouseout="out('2139035906527134472');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 786             // We cannot proceed without a Customer when using the new PasswordEncoder                   </span>
<span class="-4521424860882993154" onmouseenter="enter('-4521424860882993154');" onmouseout="out('-4521424860882993154');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 787             throw new NoSuchBeanDefinitionException(&quot;This method requires the deprecated PasswordEncoder bean&quot;);"> 787             throw new NoSuchBeanDefinitionException(&quot;This method requires the deprecated PasswordEncoder ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 788         }                                                                                                </span>
<span class="-1076466763561679841" onmouseenter="enter('-1076466763561679841');" onmouseout="out('-1076466763561679841');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 789         return checkPasswordResetToken(token, null);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 790     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 791                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 792     @Override                                                                                            </span>
<span class="-7547112806897146214" onmouseenter="enter('-7547112806897146214');" onmouseout="out('-7547112806897146214');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 793     public GenericResponse checkPasswordResetToken(String token, Customer customer) {                    </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 794         GenericResponse response = new GenericResponse();                                                </span>
<span class="913599117713435265" onmouseenter="enter('913599117713435265');" onmouseout="out('913599117713435265');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 795         checkPasswordResetToken(token, customer, response);                                              </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 796         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 797     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 798                                                                                                          </span>
<span class="1872423782765914316" onmouseenter="enter('1872423782765914316');" onmouseout="out('1872423782765914316');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 799     protected CustomerForgotPasswordSecurityToken checkPasswordResetToken(String token, Customer customer, GenericResponse response) {"> 799     protected CustomerForgotPasswordSecurityToken checkPasswordResetToken(String token, Customer customerðŸ”µ</abbr></span>
<span class="-4169390037463393090" onmouseenter="enter('-4169390037463393090');" onmouseout="out('-4169390037463393090');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 800         if (StringUtils.isBlank(token)) {                                                                </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 801             response.addErrorCode(&quot;invalidToken&quot;);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 802         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 803                                                                                                          </span>
<span class="5092673057151141969" onmouseenter="enter('5092673057151141969');" onmouseout="out('5092673057151141969');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 804         String rawToken = token;                                                                         </span>
<span class="-7872205866412670367" onmouseenter="enter('-7872205866412670367');" onmouseout="out('-7872205866412670367');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 805         String salt = null;                                                                              </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 806                                                                                                          </span>
<span class="-7232422938046234962" onmouseenter="enter('-7232422938046234962');" onmouseout="out('-7232422938046234962');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 807         if (usingDeprecatedPasswordEncoder()) {                                                          </span>
<span class="-4628277419489838427" onmouseenter="enter('-4628277419489838427');" onmouseout="out('-4628277419489838427');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 808             String[] tokens = token.split(&quot;-&quot;);                                                          </span>
<span class="6618708100432165316" onmouseenter="enter('6618708100432165316');" onmouseout="out('6618708100432165316');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 809             if (tokens.length &gt; 2) {                                                                     </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 810                 response.addErrorCode(&quot;invalidToken&quot;);                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 811             } else {                                                                                     </span>
<span class="-1712320800281837997" onmouseenter="enter('-1712320800281837997');" onmouseout="out('-1712320800281837997');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 812                 rawToken = tokens[0].toLowerCase();                                                      </span>
<span class="8621647064958774156" onmouseenter="enter('8621647064958774156');" onmouseout="out('8621647064958774156');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 813                 if (tokens.length == 2) {                                                                </span>
<span class="-3949611153912752305" onmouseenter="enter('-3949611153912752305');" onmouseout="out('-3949611153912752305');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 814                     salt = tokens[1];                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 815                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 816             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 817         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 818                                                                                                          </span>
<span class="-7243325982712524701" onmouseenter="enter('-7243325982712524701');" onmouseout="out('-7243325982712524701');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 819         CustomerForgotPasswordSecurityToken fpst = null;                                                 </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 820         if (!response.getHasErrors()) {                                                                  </span>
<span class="-1371412200964570990" onmouseenter="enter('-1371412200964570990');" onmouseout="out('-1371412200964570990');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 821             if (customer == null) {                                                                      </span>
<span class="-3461464951845163420" onmouseenter="enter('-3461464951845163420');" onmouseout="out('-3461464951845163420');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 822                 if (!usingDeprecatedPasswordEncoder()) {                                                 </span>
<span class="21180584812199314" onmouseenter="enter('21180584812199314');" onmouseout="out('21180584812199314');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 823                     // customer can only be null when supporting use of the legacy PasswordEncoder       </span>
<span class="-397249380987924174" onmouseenter="enter('-397249380987924174');" onmouseout="out('-397249380987924174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 824                     response.addErrorCode(&quot;invalidCustomer&quot;);                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 825                 } else {                                                                                 </span>
<span class="-1624865284260185189" onmouseenter="enter('-1624865284260185189');" onmouseout="out('-1624865284260185189');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 826                     fpst = customerForgotPasswordSecurityTokenDao.readToken(passwordEncoder.encodePassword(rawToken, salt));"> 826                     fpst = customerForgotPasswordSecurityTokenDao.readToken(passwordEncoder.encodePassworðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 827                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 828             } else {                                                                                     </span>
<span class="-2708743959084825308" onmouseenter="enter('-2708743959084825308');" onmouseout="out('-2708743959084825308');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 829                 List&lt;CustomerForgotPasswordSecurityToken&gt; fpstoks = customerForgotPasswordSecurityTokenDao.readUnusedTokensByCustomerId(customer.getId());"> 829                 List&lt;CustomerForgotPasswordSecurityToken&gt; fpstoks = customerForgotPasswordSecurityTokenDaðŸ”µ</abbr></span>
<span class="6715544567105364437" onmouseenter="enter('6715544567105364437');" onmouseout="out('6715544567105364437');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 830                 for (CustomerForgotPasswordSecurityToken fpstok : fpstoks) {                             </span>
<span class="-6038701959731803866" onmouseenter="enter('-6038701959731803866');" onmouseout="out('-6038701959731803866');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 831                     if (isPassValid(rawToken, fpstok.getToken(), salt)) {                                </span>
<span class="-8696697531199533964" onmouseenter="enter('-8696697531199533964');" onmouseout="out('-8696697531199533964');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 832                         fpst = fpstok;                                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 833                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 834                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 835                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 836             }                                                                                            </span>
<span class="-1673544419969423705" onmouseenter="enter('-1673544419969423705');" onmouseout="out('-1673544419969423705');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 837             if (fpst == null) {                                                                          </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 838                 response.addErrorCode(&quot;invalidToken&quot;);                                                   </span>
<span class="-1851754756462568438" onmouseenter="enter('-1851754756462568438');" onmouseout="out('-1851754756462568438');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 839             } else if (fpst.isTokenUsedFlag()) {                                                         </span>
<span class="-4571187449058469389" onmouseenter="enter('-4571187449058469389');" onmouseout="out('-4571187449058469389');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 840                 response.addErrorCode(&quot;tokenUsed&quot;);                                                      </span>
<span class="1126518180689710158" onmouseenter="enter('1126518180689710158');" onmouseout="out('1126518180689710158');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 841             } else if (isTokenExpired(fpst)) {                                                           </span>
<span class="1324239895302259913" onmouseenter="enter('1324239895302259913');" onmouseout="out('1324239895302259913');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 842                 response.addErrorCode(&quot;tokenExpired&quot;);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 843             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 844         }                                                                                                </span>
<span class="-4960476697639333031" onmouseenter="enter('-4960476697639333031');" onmouseout="out('-4960476697639333031');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 845         return fpst;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 846     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 847                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 848     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 849     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="-1553234826628367049" onmouseenter="enter('-1553234826628367049');" onmouseout="out('-1553234826628367049');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 850     public GenericResponse resetPasswordUsingToken(String username, String token, String password, String confirmPassword) {"> 850     public GenericResponse resetPasswordUsingToken(String username, String token, String password, StringðŸ”µ</abbr></span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 851         GenericResponse response = new GenericResponse();                                                </span>
<span class="6921810928241781426" onmouseenter="enter('6921810928241781426');" onmouseout="out('6921810928241781426');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 852         Customer customer = null;                                                                        </span>
<span class="-8284276918575957483" onmouseenter="enter('-8284276918575957483');" onmouseout="out('-8284276918575957483');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 853         if (username != null) {                                                                          </span>
<span class="-104711026898859267" onmouseenter="enter('-104711026898859267');" onmouseout="out('-104711026898859267');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 854             customer = customerDao.readCustomerByUsername(username);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 855         }                                                                                                </span>
<span class="-3681439263985626916" onmouseenter="enter('-3681439263985626916');" onmouseout="out('-3681439263985626916');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 856         checkCustomer(customer, response);                                                               </span>
<span class="-3971600249312835278" onmouseenter="enter('-3971600249312835278');" onmouseout="out('-3971600249312835278');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 857         checkPassword(password, confirmPassword, response);                                              </span>
<span class="2411779224658140401" onmouseenter="enter('2411779224658140401');" onmouseout="out('2411779224658140401');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 858         CustomerForgotPasswordSecurityToken fpst = checkPasswordResetToken(token, customer, response);   </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 859                                                                                                          </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 860         if (!response.getHasErrors()) {                                                                  </span>
<span class="485270787578743194" onmouseenter="enter('485270787578743194');" onmouseout="out('485270787578743194');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 861             if (!customer.getId().equals(fpst.getCustomerId())) {                                        </span>
<span class="-5994256316510103080" onmouseenter="enter('-5994256316510103080');" onmouseout="out('-5994256316510103080');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 862                 if (LOG.isWarnEnabled()) {                                                               </span>
<span class="-3030254613251423793" onmouseenter="enter('-3030254613251423793');" onmouseout="out('-3030254613251423793');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 863                     LOG.warn(&quot;Password reset attempt tried with mismatched customer and token &quot; + customer.getId() + &quot;, &quot; + StringUtil.sanitize(token));"> 863                     LOG.warn(&quot;Password reset attempt tried with mismatched customer and token &quot; + customeðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 864                 }                                                                                        </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 865                 response.addErrorCode(&quot;invalidToken&quot;);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 866             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 867         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 868                                                                                                          </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 869         if (!response.getHasErrors()) {                                                                  </span>
<span class="5101903206908082309" onmouseenter="enter('5101903206908082309');" onmouseout="out('5101903206908082309');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 870             customer.setUnencodedPassword(password);                                                     </span>
<span class="6606672839011797247" onmouseenter="enter('6606672839011797247');" onmouseout="out('6606672839011797247');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 871             customer.setPasswordChangeRequired(false);                                                   </span>
<span class="3384492063942947657" onmouseenter="enter('3384492063942947657');" onmouseout="out('3384492063942947657');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 872             saveCustomer(customer);                                                                      </span>
<span class="-7517227353230604805" onmouseenter="enter('-7517227353230604805');" onmouseout="out('-7517227353230604805');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 873             invalidateAllTokensForCustomer(customer);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 874         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 875                                                                                                          </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 876         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 877     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 878                                                                                                          </span>
<span class="2450635656385893269" onmouseenter="enter('2450635656385893269');" onmouseout="out('2450635656385893269');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 879     protected void invalidateAllTokensForCustomer(Customer customer) {                                   </span>
<span class="500146367959601607" onmouseenter="enter('500146367959601607');" onmouseout="out('500146367959601607');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 880         List&lt;CustomerForgotPasswordSecurityToken&gt; tokens = customerForgotPasswordSecurityTokenDao.readUnusedTokensByCustomerId(customer.getId());"> 880         List&lt;CustomerForgotPasswordSecurityToken&gt; tokens = customerForgotPasswordSecurityTokenDao.readUnuðŸ”µ</abbr></span>
<span class="34403017169246064" onmouseenter="enter('34403017169246064');" onmouseout="out('34403017169246064');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 881         for (CustomerForgotPasswordSecurityToken token : tokens) {                                       </span>
<span class="-3707452475519083600" onmouseenter="enter('-3707452475519083600');" onmouseout="out('-3707452475519083600');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 882             token.setTokenUsedFlag(true);                                                                </span>
<span class="-8670185777060395996" onmouseenter="enter('-8670185777060395996');" onmouseout="out('-8670185777060395996');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 883             customerForgotPasswordSecurityTokenDao.saveToken(token);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 884         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 885     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 886                                                                                                          </span>
<span class="3178004875725558699" onmouseenter="enter('3178004875725558699');" onmouseout="out('3178004875725558699');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 887     protected void checkCustomer(Customer customer, GenericResponse response) {                          </span>
<span class="-1371412200964570990" onmouseenter="enter('-1371412200964570990');" onmouseout="out('-1371412200964570990');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 888         if (customer == null) {                                                                          </span>
<span class="-397249380987924174" onmouseenter="enter('-397249380987924174');" onmouseout="out('-397249380987924174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 889             response.addErrorCode(&quot;invalidCustomer&quot;);                                                    </span>
<span class="-1786182981140386352" onmouseenter="enter('-1786182981140386352');" onmouseout="out('-1786182981140386352');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 890         } else if (StringUtils.isBlank(customer.getEmailAddress())) {                                    </span>
<span class="3641519375839212970" onmouseenter="enter('3641519375839212970');" onmouseout="out('3641519375839212970');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 891             response.addErrorCode(&quot;emailNotFound&quot;);                                                      </span>
<span class="4935674502595460128" onmouseenter="enter('4935674502595460128');" onmouseout="out('4935674502595460128');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 892         } else if (customer.isDeactivated()) {                                                           </span>
<span class="5510537362121156528" onmouseenter="enter('5510537362121156528');" onmouseout="out('5510537362121156528');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 893             response.addErrorCode(&quot;inactiveUser&quot;);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 894         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 895     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 896                                                                                                          </span>
<span class="-3281949438797137351" onmouseenter="enter('-3281949438797137351');" onmouseout="out('-3281949438797137351');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 897     protected void checkPassword(String password, String confirmPassword, GenericResponse response) {    </span>
<span class="2256032458684464296" onmouseenter="enter('2256032458684464296');" onmouseout="out('2256032458684464296');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 898         if (StringUtils.isBlank(password) || StringUtils.isBlank(confirmPassword)) {                     </span>
<span class="5492480053199382271" onmouseenter="enter('5492480053199382271');" onmouseout="out('5492480053199382271');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 899             response.addErrorCode(&quot;invalidPassword&quot;);                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 900 =======                                                                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 901 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span  style=""> 902                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 903     @Override                                                                                            </span>
<span class="2659754888592981645" onmouseenter="enter('2659754888592981645');" onmouseout="out('2659754888592981645');" style=""> 904     public List&lt;Customer&gt; readBatchCustomers(int start, int pageSize) {                                  </span>
<span class="-8143894692030732868" onmouseenter="enter('-8143894692030732868');" onmouseout="out('-8143894692030732868');" style=""> 905         return customerDao.readBatchCustomers(start, pageSize);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 906     }                                                                                                    </span>
<span  style=""> 907                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 908     @Override                                                                                            </span>
<span class="4634920297968325108" onmouseenter="enter('4634920297968325108');" onmouseout="out('4634920297968325108');" style=""> 909     public Long readNumberOfCustomers() {                                                                </span>
<span class="93124683563030725" onmouseenter="enter('93124683563030725');" onmouseout="out('93124683563030725');" style=""> 910         return customerDao.readNumberOfCustomers();                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 911     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 912 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="195929208389810495" onmouseenter="enter('195929208389810495');" onmouseout="out('195929208389810495');" style="">   3  * BroadleafCommerce Profile                                                                             </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="5673174586140185880" onmouseenter="enter('5673174586140185880');" onmouseout="out('5673174586140185880');" style="">  18 package org.broadleafcommerce.profile.core.service;                                                      </span>
<span  style="">  19                                                                                                          </span>
<span class="-4900305655545834342" onmouseenter="enter('-4900305655545834342');" onmouseout="out('-4900305655545834342');" style="">  20 import org.apache.commons.collections4.CollectionUtils;                                                  </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  21 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  22 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  23 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="6519729880675887369" onmouseenter="enter('6519729880675887369');" onmouseout="out('6519729880675887369');" style="">  24 import org.broadleafcommerce.common.event.BroadleafApplicationEventPublisher;                            </span>
<span class="8150446407418055690" onmouseenter="enter('8150446407418055690');" onmouseout="out('8150446407418055690');" style="">  25 import org.broadleafcommerce.common.id.service.IdGenerationService;                                      </span>
<span class="8527520771739085493" onmouseenter="enter('8527520771739085493');" onmouseout="out('8527520771739085493');" style="">  26 import org.broadleafcommerce.common.rule.MvelHelper;                                                     </span>
<span class="-2635683203763841416" onmouseenter="enter('-2635683203763841416');" onmouseout="out('-2635683203763841416');" style="">  27 import org.broadleafcommerce.common.security.util.PasswordChange;                                        </span>
<span class="5972522294326904672" onmouseenter="enter('5972522294326904672');" onmouseout="out('5972522294326904672');" style="">  28 import org.broadleafcommerce.common.security.util.PasswordReset;                                         </span>
<span class="6413981270350028954" onmouseenter="enter('6413981270350028954');" onmouseout="out('6413981270350028954');" style="">  29 import org.broadleafcommerce.common.security.util.PasswordUtils;                                         </span>
<span class="-3956591208111981988" onmouseenter="enter('-3956591208111981988');" onmouseout="out('-3956591208111981988');" style="">  30 import org.broadleafcommerce.common.service.GenericResponse;                                             </span>
<span class="1373992879208813777" onmouseenter="enter('1373992879208813777');" onmouseout="out('1373992879208813777');" style="">  31 import org.broadleafcommerce.common.time.SystemTime;                                                     </span>
<span class="-3347161074136237116" onmouseenter="enter('-3347161074136237116');" onmouseout="out('-3347161074136237116');" style="">  32 import org.broadleafcommerce.common.util.StringUtil;                                                     </span>
<span class="5107697851223623564" onmouseenter="enter('5107697851223623564');" onmouseout="out('5107697851223623564');" style="">  33 import org.broadleafcommerce.common.util.TransactionUtils;                                               </span>
<span class="5198631096841786518" onmouseenter="enter('5198631096841786518');" onmouseout="out('5198631096841786518');" style="">  34 import org.broadleafcommerce.profile.core.dao.CustomerDao;                                               </span>
<span class="6035498420134781098" onmouseenter="enter('6035498420134781098');" onmouseout="out('6035498420134781098');" style="">  35 import org.broadleafcommerce.profile.core.dao.CustomerForgotPasswordSecurityTokenDao;                    </span>
<span class="-2668610663458012770" onmouseenter="enter('-2668610663458012770');" onmouseout="out('-2668610663458012770');" style="">  36 import org.broadleafcommerce.profile.core.dao.RoleDao;                                                   </span>
<span class="-6242194486783230477" onmouseenter="enter('-6242194486783230477');" onmouseout="out('-6242194486783230477');" style="">  37 import org.broadleafcommerce.profile.core.domain.Customer;                                               </span>
<span class="7682914685467852548" onmouseenter="enter('7682914685467852548');" onmouseout="out('7682914685467852548');" style="">  38 import org.broadleafcommerce.profile.core.domain.CustomerForgotPasswordSecurityToken;                    </span>
<span class="-7325905376371760879" onmouseenter="enter('-7325905376371760879');" onmouseout="out('-7325905376371760879');" style="">  39 import org.broadleafcommerce.profile.core.domain.CustomerForgotPasswordSecurityTokenImpl;                </span>
<span class="-7795206435247364271" onmouseenter="enter('-7795206435247364271');" onmouseout="out('-7795206435247364271');" style="">  40 import org.broadleafcommerce.profile.core.domain.CustomerRole;                                           </span>
<span class="5359715183603948959" onmouseenter="enter('5359715183603948959');" onmouseout="out('5359715183603948959');" style="">  41 import org.broadleafcommerce.profile.core.domain.CustomerRoleImpl;                                       </span>
<span class="6271275544652071055" onmouseenter="enter('6271275544652071055');" onmouseout="out('6271275544652071055');" style="">  42 import org.broadleafcommerce.profile.core.domain.Role;                                                   </span>
<span class="-6657505372111281463" onmouseenter="enter('-6657505372111281463');" onmouseout="out('-6657505372111281463');" style="">  43 import org.broadleafcommerce.profile.core.dto.CustomerRuleHolder;                                        </span>
<span class="-8181433875826880332" onmouseenter="enter('-8181433875826880332');" onmouseout="out('-8181433875826880332');" style="">  44 import org.broadleafcommerce.profile.core.event.ForgotPasswordEvent;                                     </span>
<span class="7578912361223650489" onmouseenter="enter('7578912361223650489');" onmouseout="out('7578912361223650489');" style="">  45 import org.broadleafcommerce.profile.core.event.ForgotUsernameEvent;                                     </span>
<span class="-1223355443293629135" onmouseenter="enter('-1223355443293629135');" onmouseout="out('-1223355443293629135');" style="">  46 import org.broadleafcommerce.profile.core.event.RegisterCustomerEvent;                                   </span>
<span class="1248060424968705063" onmouseenter="enter('1248060424968705063');" onmouseout="out('1248060424968705063');" style="">  47 import org.broadleafcommerce.profile.core.service.handler.PasswordUpdatedHandler;                        </span>
<span class="-6753305615342929581" onmouseenter="enter('-6753305615342929581');" onmouseout="out('-6753305615342929581');" style="">  48 import org.broadleafcommerce.profile.core.service.listener.PostRegistrationObserver;                     </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  49 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="2075826732928208126" onmouseenter="enter('2075826732928208126');" onmouseout="out('2075826732928208126');" style="">  50 import org.springframework.security.crypto.password.PasswordEncoder;                                     </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  51 import org.springframework.stereotype.Service;                                                           </span>
<span class="4419089678332371422" onmouseenter="enter('4419089678332371422');" onmouseout="out('4419089678332371422');" style="">  52 import org.springframework.transaction.annotation.Transactional;                                         </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  53 import java.util.ArrayList;                                                                              </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="">  54 import java.util.Date;                                                                                   </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  55 import java.util.HashMap;                                                                                </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  56 import java.util.Iterator;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  57 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  58 import java.util.Map;                                                                                    </span>
<span  style="">  59                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  60 import javax.annotation.Resource;                                                                        </span>
<span  style="">  61                                                                                                          </span>
<span class="-3189571605039255438" onmouseenter="enter('-3189571605039255438');" onmouseout="out('-3189571605039255438');" style="">  62 @Service(&quot;blCustomerService&quot;)                                                                            </span>
<span class="-4315786798209752789" onmouseenter="enter('-4315786798209752789');" onmouseout="out('-4315786798209752789');" style="">  63 public class CustomerServiceImpl implements CustomerService {                                            </span>
<span class="-9223083925427668638" onmouseenter="enter('-9223083925427668638');" onmouseout="out('-9223083925427668638');" style="">  64     private static final Log LOG = LogFactory.getLog(CustomerServiceImpl.class);                         </span>
<span class="-8423658991079621305" onmouseenter="enter('-8423658991079621305');" onmouseout="out('-8423658991079621305');" style="">  65     private static final int PASSWORD_LENGTH = 16;                                                       </span>
<span  style="">  66                                                                                                          </span>
<span class="5554564923016007608" onmouseenter="enter('5554564923016007608');" onmouseout="out('5554564923016007608');" style="">  67     @Autowired                                                                                           </span>
<span class="-7224044524343370301" onmouseenter="enter('-7224044524343370301');" onmouseout="out('-7224044524343370301');" style="">  68     @Qualifier(&quot;blApplicationEventPublisher&quot;)                                                            </span>
<span class="-5629661248749562711" onmouseenter="enter('-5629661248749562711');" onmouseout="out('-5629661248749562711');" style="">  69     protected BroadleafApplicationEventPublisher eventPublisher;                                         </span>
<span  style="">  70                                                                                                          </span>
<span class="-4901656528466650106" onmouseenter="enter('-4901656528466650106');" onmouseout="out('-4901656528466650106');" style="">  71     @Resource(name = &quot;blCustomerDao&quot;)                                                                    </span>
<span class="8692367904333193309" onmouseenter="enter('8692367904333193309');" onmouseout="out('8692367904333193309');" style="">  72     protected CustomerDao customerDao;                                                                   </span>
<span  style="">  73                                                                                                          </span>
<span class="3094900987137494064" onmouseenter="enter('3094900987137494064');" onmouseout="out('3094900987137494064');" style="">  74     @Resource(name = &quot;blIdGenerationService&quot;)                                                            </span>
<span class="-7221277934130422196" onmouseenter="enter('-7221277934130422196');" onmouseout="out('-7221277934130422196');" style="">  75     protected IdGenerationService idGenerationService;                                                   </span>
<span  style="">  76                                                                                                          </span>
<span class="2365488678467894280" onmouseenter="enter('2365488678467894280');" onmouseout="out('2365488678467894280');" style="">  77     @Resource(name = &quot;blCustomerForgotPasswordSecurityTokenDao&quot;)                                         </span>
<span class="4716726216132170190" onmouseenter="enter('4716726216132170190');" onmouseout="out('4716726216132170190');" style="">  78     protected CustomerForgotPasswordSecurityTokenDao customerForgotPasswordSecurityTokenDao;             </span>
<span  style="">  79                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  80     /**                                                                                                  </span>
<span class="6298544191369985956" onmouseenter="enter('6298544191369985956');" onmouseout="out('6298544191369985956');" style=""><abbr title="  81      * &lt;p&gt;This is simply a placeholder to be used by {@link #setupPasswordEncoder()} to determine if we&#x27;re using the">  81      * &lt;p&gt;This is simply a placeholder to be used by {@link #setupPasswordEncoder()} to determine if we&#x27;rðŸ”µ</abbr></span>
<span class="897245791379814301" onmouseenter="enter('897245791379814301');" onmouseout="out('897245791379814301');" style=""><abbr title="  82      * new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.authentication.encoding.PasswordEncoder PasswordEncoder}">  82      * new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.authentication.eðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  83      */                                                                                                  </span>
<span class="3863006184976437823" onmouseenter="enter('3863006184976437823');" onmouseout="out('3863006184976437823');" style="">  84     @Resource(name = &quot;blPasswordEncoder&quot;)                                                                </span>
<span class="-2329929589298188398" onmouseenter="enter('-2329929589298188398');" onmouseout="out('-2329929589298188398');" style="">  85     protected PasswordEncoder passwordEncoderBean;                                                       </span>
<span  style="">  86                                                                                                          </span>
<span class="-5757933253912539407" onmouseenter="enter('-5757933253912539407');" onmouseout="out('-5757933253912539407');" style="">  87     @Resource(name = &quot;blRoleDao&quot;)                                                                        </span>
<span class="-2955407415487117626" onmouseenter="enter('-2955407415487117626');" onmouseout="out('-2955407415487117626');" style="">  88     protected RoleDao roleDao;                                                                           </span>
<span  style="">  89                                                                                                          </span>
<span class="453353925889912084" onmouseenter="enter('453353925889912084');" onmouseout="out('453353925889912084');" style="">  90     protected int tokenExpiredMinutes = 30;                                                              </span>
<span class="-1133336695006357373" onmouseenter="enter('-1133336695006357373');" onmouseout="out('-1133336695006357373');" style="">  91     protected int passwordTokenLength = 20;                                                              </span>
<span  style="">  92                                                                                                          </span>
<span class="-2653602182005192069" onmouseenter="enter('-2653602182005192069');" onmouseout="out('-2653602182005192069');" style=""><abbr title="  93     protected final List&lt;PostRegistrationObserver&gt; postRegisterListeners = new ArrayList&lt;PostRegistrationObserver&gt;();">  93     protected final List&lt;PostRegistrationObserver&gt; postRegisterListeners = new ArrayList&lt;PostRegistrationðŸ”µ</abbr></span>
<span class="6843669015915819090" onmouseenter="enter('6843669015915819090');" onmouseout="out('6843669015915819090');" style=""><abbr title="  94     protected List&lt;PasswordUpdatedHandler&gt; passwordResetHandlers = new ArrayList&lt;PasswordUpdatedHandler&gt;();">  94     protected List&lt;PasswordUpdatedHandler&gt; passwordResetHandlers = new ArrayList&lt;PasswordUpdatedHandler&gt;(ðŸ”µ</abbr></span>
<span class="-6685798853959138604" onmouseenter="enter('-6685798853959138604');" onmouseout="out('-6685798853959138604');" style=""><abbr title="  95     protected List&lt;PasswordUpdatedHandler&gt; passwordChangedHandlers = new ArrayList&lt;PasswordUpdatedHandler&gt;();">  95     protected List&lt;PasswordUpdatedHandler&gt; passwordChangedHandlers = new ArrayList&lt;PasswordUpdatedHandlerðŸ”µ</abbr></span>
<span  style="">  96                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  97     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style="">  98     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="8291295402928429592" onmouseenter="enter('8291295402928429592');" onmouseout="out('8291295402928429592');" style="">  99     public Customer saveCustomer(Customer customer) {                                                    </span>
<span class="-4698478172885390647" onmouseenter="enter('-4698478172885390647');" onmouseout="out('-4698478172885390647');" style=""> 100         return saveCustomer(customer, customer.isRegistered());                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101     }                                                                                                    </span>
<span  style=""> 102                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 103     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 104     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="201381677109704887" onmouseenter="enter('201381677109704887');" onmouseout="out('201381677109704887');" style=""> 105     public Customer saveCustomer(Customer customer, boolean register) {                                  </span>
<span class="6726515726770360071" onmouseenter="enter('6726515726770360071');" onmouseout="out('6726515726770360071');" style=""> 106         if (register &amp;&amp; !customer.isRegistered()) {                                                      </span>
<span class="2527359489469298483" onmouseenter="enter('2527359489469298483');" onmouseout="out('2527359489469298483');" style=""> 107             customer.setRegistered(true);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108         }                                                                                                </span>
<span  style=""> 109                                                                                                          </span>
<span class="-2753421557322414072" onmouseenter="enter('-2753421557322414072');" onmouseout="out('-2753421557322414072');" style=""> 110         if (customer.getUnencodedPassword() != null) {                                                   </span>
<span class="-8026123664621306465" onmouseenter="enter('-8026123664621306465');" onmouseout="out('-8026123664621306465');" style=""> 111             customer.setPassword(encodePassword(customer.getUnencodedPassword()));                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112         }                                                                                                </span>
<span  style=""> 113                                                                                                          </span>
<span class="-1576073390989032571" onmouseenter="enter('-1576073390989032571');" onmouseout="out('-1576073390989032571');" style=""> 114         // let&#x27;s make sure they entered a new challenge answer (we will populate                         </span>
<span class="-2819530999572063421" onmouseenter="enter('-2819530999572063421');" onmouseout="out('-2819530999572063421');" style=""> 115         // the password field with hashed values so check that they have changed                         </span>
<span class="-9126181688236016532" onmouseenter="enter('-9126181688236016532');" onmouseout="out('-9126181688236016532');" style=""> 116         // id                                                                                            </span>
<span class="-8509665365452883594" onmouseenter="enter('-8509665365452883594');" onmouseout="out('-8509665365452883594');" style=""><abbr title=" 117         if (customer.getUnencodedChallengeAnswer() != null &amp;&amp; !customer.getUnencodedChallengeAnswer().equals(customer.getChallengeAnswer())) {"> 117         if (customer.getUnencodedChallengeAnswer() != null &amp;&amp; !customer.getUnencodedChallengeAnswer().equðŸ”µ</abbr></span>
<span class="1806155368440017187" onmouseenter="enter('1806155368440017187');" onmouseout="out('1806155368440017187');" style=""> 118             customer.setChallengeAnswer(encodePassword(customer.getUnencodedChallengeAnswer()));         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119         }                                                                                                </span>
<span class="3406416334930679557" onmouseenter="enter('3406416334930679557');" onmouseout="out('3406416334930679557');" style=""> 120         return customerDao.save(customer);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121     }                                                                                                    </span>
<span  style=""> 122                                                                                                          </span>
<span class="-137997900411835717" onmouseenter="enter('-137997900411835717');" onmouseout="out('-137997900411835717');" style=""> 123     protected String generateSecurePassword() {                                                          </span>
<span class="-4377176751133654653" onmouseenter="enter('-4377176751133654653');" onmouseout="out('-4377176751133654653');" style=""> 124         return PasswordUtils.generateSecurePassword(PASSWORD_LENGTH);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 125     }                                                                                                    </span>
<span  style=""> 126                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 127     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 128     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="3910349330927871049" onmouseenter="enter('3910349330927871049');" onmouseout="out('3910349330927871049');" style=""> 129     public Customer registerCustomer(Customer customer, String password, String passwordConfirm) {       </span>
<span class="2527359489469298483" onmouseenter="enter('2527359489469298483');" onmouseout="out('2527359489469298483');" style=""> 130         customer.setRegistered(true);                                                                    </span>
<span  style=""> 131                                                                                                          </span>
<span class="-5009800104120858890" onmouseenter="enter('-5009800104120858890');" onmouseout="out('-5009800104120858890');" style=""> 132         // When unencodedPassword is set the save() will encode it                                       </span>
<span class="5360015832768603745" onmouseenter="enter('5360015832768603745');" onmouseout="out('5360015832768603745');" style=""> 133         if (customer.getId() == null) {                                                                  </span>
<span class="-5488615021987588883" onmouseenter="enter('-5488615021987588883');" onmouseout="out('-5488615021987588883');" style=""> 134             customer.setId(findNextCustomerId());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135         }                                                                                                </span>
<span class="5101903206908082309" onmouseenter="enter('5101903206908082309');" onmouseout="out('5101903206908082309');" style=""> 136         customer.setUnencodedPassword(password);                                                         </span>
<span class="-1307190252670550775" onmouseenter="enter('-1307190252670550775');" onmouseout="out('-1307190252670550775');" style=""> 137         Customer retCustomer = saveCustomer(customer);                                                   </span>
<span class="-7993851139681656451" onmouseenter="enter('-7993851139681656451');" onmouseout="out('-7993851139681656451');" style=""> 138         createRegisteredCustomerRoles(retCustomer);                                                      </span>
<span  style=""> 139                                                                                                          </span>
<span class="-3489922120474106740" onmouseenter="enter('-3489922120474106740');" onmouseout="out('-3489922120474106740');" style=""> 140         eventPublisher.publishEvent(new RegisterCustomerEvent(this, retCustomer.getId()));               </span>
<span class="-3623043072901839896" onmouseenter="enter('-3623043072901839896');" onmouseout="out('-3623043072901839896');" style=""> 141         notifyPostRegisterListeners(retCustomer);                                                        </span>
<span  style=""> 142                                                                                                          </span>
<span class="-6683456484294032112" onmouseenter="enter('-6683456484294032112');" onmouseout="out('-6683456484294032112');" style=""> 143         return retCustomer;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144     }                                                                                                    </span>
<span  style=""> 145                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 146     @Override                                                                                            </span>
<span class="-8989473089684210869" onmouseenter="enter('-8989473089684210869');" onmouseout="out('-8989473089684210869');" style=""> 147     public void createRegisteredCustomerRoles(Customer customer) {                                       </span>
<span class="-967668152739756369" onmouseenter="enter('-967668152739756369');" onmouseout="out('-967668152739756369');" style=""> 148         Role role = roleDao.readRoleByName(&quot;ROLE_USER&quot;);                                                 </span>
<span class="-7484208420944991016" onmouseenter="enter('-7484208420944991016');" onmouseout="out('-7484208420944991016');" style=""> 149         CustomerRole customerRole = new CustomerRoleImpl();                                              </span>
<span class="-3544050209899951111" onmouseenter="enter('-3544050209899951111');" onmouseout="out('-3544050209899951111');" style=""> 150         customerRole.setRole(role);                                                                      </span>
<span class="-4836769794727897713" onmouseenter="enter('-4836769794727897713');" onmouseout="out('-4836769794727897713');" style=""> 151         customerRole.setCustomer(customer);                                                              </span>
<span class="2561970876173710740" onmouseenter="enter('2561970876173710740');" onmouseout="out('2561970876173710740');" style=""> 152         roleDao.addRoleToCustomer(customerRole);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 153     }                                                                                                    </span>
<span  style=""> 154                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 155     @Override                                                                                            </span>
<span class="-8289498668946854999" onmouseenter="enter('-8289498668946854999');" onmouseout="out('-8289498668946854999');" style=""> 156     public Customer readCustomerByEmail(String emailAddress) {                                           </span>
<span class="6996298339377860417" onmouseenter="enter('6996298339377860417');" onmouseout="out('6996298339377860417');" style=""> 157         return customerDao.readCustomerByEmail(emailAddress);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158     }                                                                                                    </span>
<span  style=""> 159                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 160     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 161     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="2373324961324130685" onmouseenter="enter('2373324961324130685');" onmouseout="out('2373324961324130685');" style=""> 162     public Customer changePassword(PasswordChange passwordChange) {                                      </span>
<span class="-5344336587939476831" onmouseenter="enter('-5344336587939476831');" onmouseout="out('-5344336587939476831');" style=""> 163         Customer customer = readCustomerByUsername(passwordChange.getUsername());                        </span>
<span class="3635027652328433999" onmouseenter="enter('3635027652328433999');" onmouseout="out('3635027652328433999');" style=""> 164         customer.setUnencodedPassword(passwordChange.getNewPassword());                                  </span>
<span class="9175276796642533968" onmouseenter="enter('9175276796642533968');" onmouseout="out('9175276796642533968');" style=""> 165         customer.setPasswordChangeRequired(passwordChange.getPasswordChangeRequired());                  </span>
<span class="5791162324212808512" onmouseenter="enter('5791162324212808512');" onmouseout="out('5791162324212808512');" style=""> 166         customer = saveCustomer(customer);                                                               </span>
<span  style=""> 167                                                                                                          </span>
<span class="1758176125617219344" onmouseenter="enter('1758176125617219344');" onmouseout="out('1758176125617219344');" style=""> 168         for (PasswordUpdatedHandler handler : passwordChangedHandlers) {                                 </span>
<span class="-390754915565928691" onmouseenter="enter('-390754915565928691');" onmouseout="out('-390754915565928691');" style=""> 169             handler.passwordChanged(passwordChange, customer, passwordChange.getNewPassword());          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170         }                                                                                                </span>
<span  style=""> 171                                                                                                          </span>
<span class="-3853204766136593997" onmouseenter="enter('-3853204766136593997');" onmouseout="out('-3853204766136593997');" style=""> 172         return customer;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173     }                                                                                                    </span>
<span  style=""> 174                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 175     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 176     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="-8338050129523775592" onmouseenter="enter('-8338050129523775592');" onmouseout="out('-8338050129523775592');" style=""> 177     public Customer resetPassword(PasswordReset passwordReset) {                                         </span>
<span class="6805273026067147007" onmouseenter="enter('6805273026067147007');" onmouseout="out('6805273026067147007');" style=""> 178         Customer customer = readCustomerByUsername(passwordReset.getUsername());                         </span>
<span class="-122847483108952780" onmouseenter="enter('-122847483108952780');" onmouseout="out('-122847483108952780');" style=""> 179         String newPassword = PasswordUtils.generateSecurePassword(passwordReset.getPasswordLength());    </span>
<span class="-62325817623586886" onmouseenter="enter('-62325817623586886');" onmouseout="out('-62325817623586886');" style=""> 180         customer.setUnencodedPassword(newPassword);                                                      </span>
<span class="6853349384480559800" onmouseenter="enter('6853349384480559800');" onmouseout="out('6853349384480559800');" style=""> 181         customer.setPasswordChangeRequired(passwordReset.getPasswordChangeRequired());                   </span>
<span class="5791162324212808512" onmouseenter="enter('5791162324212808512');" onmouseout="out('5791162324212808512');" style=""> 182         customer = saveCustomer(customer);                                                               </span>
<span  style=""> 183                                                                                                          </span>
<span class="265370277489880531" onmouseenter="enter('265370277489880531');" onmouseout="out('265370277489880531');" style=""> 184         for (PasswordUpdatedHandler handler : passwordResetHandlers) {                                   </span>
<span class="8731392908076423696" onmouseenter="enter('8731392908076423696');" onmouseout="out('8731392908076423696');" style=""> 185             handler.passwordChanged(passwordReset, customer, newPassword);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186         }                                                                                                </span>
<span  style=""> 187                                                                                                          </span>
<span class="-3853204766136593997" onmouseenter="enter('-3853204766136593997');" onmouseout="out('-3853204766136593997');" style=""> 188         return customer;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189     }                                                                                                    </span>
<span  style=""> 190                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 191     @Override                                                                                            </span>
<span class="-2286441478570387081" onmouseenter="enter('-2286441478570387081');" onmouseout="out('-2286441478570387081');" style=""> 192     public void addPostRegisterListener(PostRegistrationObserver postRegisterListeners) {                </span>
<span class="2003689350872197572" onmouseenter="enter('2003689350872197572');" onmouseout="out('2003689350872197572');" style=""> 193         this.postRegisterListeners.add(postRegisterListeners);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194     }                                                                                                    </span>
<span  style=""> 195                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 196     @Override                                                                                            </span>
<span class="-1507687767132611253" onmouseenter="enter('-1507687767132611253');" onmouseout="out('-1507687767132611253');" style=""> 197     public void removePostRegisterListener(PostRegistrationObserver postRegisterListeners) {             </span>
<span class="8851186764245103017" onmouseenter="enter('8851186764245103017');" onmouseout="out('8851186764245103017');" style=""> 198         if (this.postRegisterListeners.contains(postRegisterListeners)) {                                </span>
<span class="7168411145839318905" onmouseenter="enter('7168411145839318905');" onmouseout="out('7168411145839318905');" style=""> 199             this.postRegisterListeners.remove(postRegisterListeners);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201     }                                                                                                    </span>
<span  style=""> 202                                                                                                          </span>
<span class="3762831862655692775" onmouseenter="enter('3762831862655692775');" onmouseout="out('3762831862655692775');" style=""> 203     protected void notifyPostRegisterListeners(Customer customer) {                                      </span>
<span class="-5517241395960310234" onmouseenter="enter('-5517241395960310234');" onmouseout="out('-5517241395960310234');" style=""><abbr title=" 204         for (Iterator&lt;PostRegistrationObserver&gt; iter = postRegisterListeners.iterator(); iter.hasNext(); ) {"> 204         for (Iterator&lt;PostRegistrationObserver&gt; iter = postRegisterListeners.iterator(); iter.hasNext(); ðŸ”µ</abbr></span>
<span class="6852498861939683938" onmouseenter="enter('6852498861939683938');" onmouseout="out('6852498861939683938');" style=""> 205             PostRegistrationObserver listener = iter.next();                                             </span>
<span class="2537062439441145073" onmouseenter="enter('2537062439441145073');" onmouseout="out('2537062439441145073');" style=""> 206             listener.processRegistrationEvent(customer);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208     }                                                                                                    </span>
<span  style=""> 209                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 210     @Override                                                                                            </span>
<span class="-6715127601332863552" onmouseenter="enter('-6715127601332863552');" onmouseout="out('-6715127601332863552');" style=""> 211     public Customer createCustomer() {                                                                   </span>
<span class="1533232953867480113" onmouseenter="enter('1533232953867480113');" onmouseout="out('1533232953867480113');" style=""> 212         return createCustomerFromId(null);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213     }                                                                                                    </span>
<span  style=""> 214                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 215     @Override                                                                                            </span>
<span class="-3260175922123749747" onmouseenter="enter('-3260175922123749747');" onmouseout="out('-3260175922123749747');" style=""> 216     public Customer createCustomerFromId(Long customerId) {                                              </span>
<span class="4846947630103792555" onmouseenter="enter('4846947630103792555');" onmouseout="out('4846947630103792555');" style=""> 217         Customer customer = customerId != null ? readCustomerById(customerId) : null;                    </span>
<span class="-1371412200964570990" onmouseenter="enter('-1371412200964570990');" onmouseout="out('-1371412200964570990');" style=""> 218         if (customer == null) {                                                                          </span>
<span class="7584512027447697158" onmouseenter="enter('7584512027447697158');" onmouseout="out('7584512027447697158');" style=""> 219             customer = customerDao.create();                                                             </span>
<span class="-8452861246579893242" onmouseenter="enter('-8452861246579893242');" onmouseout="out('-8452861246579893242');" style=""> 220             if (customerId != null) {                                                                    </span>
<span class="1431826176080351208" onmouseenter="enter('1431826176080351208');" onmouseout="out('1431826176080351208');" style=""> 221                 customer.setId(customerId);                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 222             } else {                                                                                     </span>
<span class="-5488615021987588883" onmouseenter="enter('-5488615021987588883');" onmouseout="out('-5488615021987588883');" style=""> 223                 customer.setId(findNextCustomerId());                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225         }                                                                                                </span>
<span class="-3853204766136593997" onmouseenter="enter('-3853204766136593997');" onmouseout="out('-3853204766136593997');" style=""> 226         return customer;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227     }                                                                                                    </span>
<span  style=""> 228                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 229     @Override                                                                                            </span>
<span class="4598906423026393934" onmouseenter="enter('4598906423026393934');" onmouseout="out('4598906423026393934');" style=""> 230     public Long findNextCustomerId() {                                                                   </span>
<span class="-8819565094085247576" onmouseenter="enter('-8819565094085247576');" onmouseout="out('-8819565094085247576');" style=""> 231         return idGenerationService.findNextId(Customer.class.getCanonicalName());                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232     }                                                                                                    </span>
<span  style=""> 233                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 234     @Override                                                                                            </span>
<span class="-6999511709583967120" onmouseenter="enter('-6999511709583967120');" onmouseout="out('-6999511709583967120');" style=""> 235     public Customer createNewCustomer() {                                                                </span>
<span class="1533232953867480113" onmouseenter="enter('1533232953867480113');" onmouseout="out('1533232953867480113');" style=""> 236         return createCustomerFromId(null);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237     }                                                                                                    </span>
<span  style=""> 238                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 239     @Override                                                                                            </span>
<span class="7417643297497909843" onmouseenter="enter('7417643297497909843');" onmouseout="out('7417643297497909843');" style=""> 240     public void deleteCustomer(Customer customer) {                                                      </span>
<span class="-3138548839038622796" onmouseenter="enter('-3138548839038622796');" onmouseout="out('-3138548839038622796');" style=""> 241         roleDao.removeCustomerRolesByCustomerId(customer.getId());                                       </span>
<span class="-3819399187793284937" onmouseenter="enter('-3819399187793284937');" onmouseout="out('-3819399187793284937');" style=""> 242         customerDao.delete(customer);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243     }                                                                                                    </span>
<span  style=""> 244                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 245     @Override                                                                                            </span>
<span class="-5885291655878307572" onmouseenter="enter('-5885291655878307572');" onmouseout="out('-5885291655878307572');" style=""> 246     public Customer readCustomerByUsername(String username) {                                            </span>
<span class="589313108944980188" onmouseenter="enter('589313108944980188');" onmouseout="out('589313108944980188');" style=""> 247         return customerDao.readCustomerByUsername(username);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248     }                                                                                                    </span>
<span  style=""> 249                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 250     @Override                                                                                            </span>
<span class="847254476985500634" onmouseenter="enter('847254476985500634');" onmouseout="out('847254476985500634');" style=""> 251     public Customer readCustomerByUsername(String username, Boolean cacheable) {                         </span>
<span class="482041631891506127" onmouseenter="enter('482041631891506127');" onmouseout="out('482041631891506127');" style=""> 252         return customerDao.readCustomerByUsername(username, cacheable);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253     }                                                                                                    </span>
<span  style=""> 254                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 255     @Override                                                                                            </span>
<span class="-4374586036231570864" onmouseenter="enter('-4374586036231570864');" onmouseout="out('-4374586036231570864');" style=""> 256     public Customer readCustomerById(Long id) {                                                          </span>
<span class="-5062162633750648527" onmouseenter="enter('-5062162633750648527');" onmouseout="out('-5062162633750648527');" style=""> 257         return customerDao.readCustomerById(id);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258     }                                                                                                    </span>
<span  style=""> 259                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 260     @Override                                                                                            </span>
<span class="6825989998352983316" onmouseenter="enter('6825989998352983316');" onmouseout="out('6825989998352983316');" style=""> 261     public Customer readCustomerByExternalId(String userExternalId) {                                    </span>
<span class="5025115365525563343" onmouseenter="enter('5025115365525563343');" onmouseout="out('5025115365525563343');" style=""> 262             return customerDao.readCustomerByExternalId(userExternalId);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263     }                                                                                                    </span>
<span  style=""> 264                                                                                                          </span>
<span class="-8304645560568857694" onmouseenter="enter('-8304645560568857694');" onmouseout="out('-8304645560568857694');" style=""> 265     public void setCustomerDao(CustomerDao customerDao) {                                                </span>
<span class="-1477678724397974795" onmouseenter="enter('-1477678724397974795');" onmouseout="out('-1477678724397974795');" style=""> 266         this.customerDao = customerDao;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267     }                                                                                                    </span>
<span  style=""> 268                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 269     @Override                                                                                            </span>
<span class="-280180772892908532" onmouseenter="enter('-280180772892908532');" onmouseout="out('-280180772892908532');" style=""> 270     public String encodePassword(String rawPassword) {                                                   </span>
<span class="-3121342566836529697" onmouseenter="enter('-3121342566836529697');" onmouseout="out('-3121342566836529697');" style=""> 271         return passwordEncoderBean.encode(rawPassword);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272     }                                                                                                    </span>
<span  style=""> 273                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 274     @Override                                                                                            </span>
<span class="160568672931299235" onmouseenter="enter('160568672931299235');" onmouseout="out('160568672931299235');" style=""> 275     public boolean isPasswordValid(String rawPassword, String encodedPassword) {                         </span>
<span class="5053852377821437125" onmouseenter="enter('5053852377821437125');" onmouseout="out('5053852377821437125');" style=""> 276         return passwordEncoderBean.matches(rawPassword, encodedPassword);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277     }                                                                                                    </span>
<span  style=""> 278                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 279     @Override                                                                                            </span>
<span class="8805988825869661234" onmouseenter="enter('8805988825869661234');" onmouseout="out('8805988825869661234');" style=""> 280     public boolean customerPassesCustomerRule(Customer customer, CustomerRuleHolder customerRuleHolder) {</span>
<span class="-5898565890799276609" onmouseenter="enter('-5898565890799276609');" onmouseout="out('-5898565890799276609');" style=""> 281         String customerRule = customerRuleHolder.getCustomerRule();                                      </span>
<span class="201656563419603782" onmouseenter="enter('201656563419603782');" onmouseout="out('201656563419603782');" style=""> 282         Map&lt;String, Object&gt; ruleParams = buildCustomerRuleParams(customer);                              </span>
<span class="-7214228236632333169" onmouseenter="enter('-7214228236632333169');" onmouseout="out('-7214228236632333169');" style=""> 283         return customerRule == null || MvelHelper.evaluateRule(customerRule, ruleParams);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284     }                                                                                                    </span>
<span  style=""> 285                                                                                                          </span>
<span class="-6781673542839603116" onmouseenter="enter('-6781673542839603116');" onmouseout="out('-6781673542839603116');" style=""> 286     protected Map&lt;String, Object&gt; buildCustomerRuleParams(Customer customer) {                           </span>
<span class="-460782809524910092" onmouseenter="enter('-460782809524910092');" onmouseout="out('-460782809524910092');" style=""> 287         HashMap&lt;String, Object&gt; vars = new HashMap&lt;&gt;();                                                  </span>
<span class="8047728915418269458" onmouseenter="enter('8047728915418269458');" onmouseout="out('8047728915418269458');" style=""> 288         vars.put(&quot;customer&quot;, customer);                                                                  </span>
<span class="3198457421051297297" onmouseenter="enter('3198457421051297297');" onmouseout="out('3198457421051297297');" style=""> 289         return vars;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290     }                                                                                                    </span>
<span  style=""> 291                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 292     @Override                                                                                            </span>
<span class="-3888321916193976828" onmouseenter="enter('-3888321916193976828');" onmouseout="out('-3888321916193976828');" style=""> 293     public List&lt;PasswordUpdatedHandler&gt; getPasswordResetHandlers() {                                     </span>
<span class="6051450225877623454" onmouseenter="enter('6051450225877623454');" onmouseout="out('6051450225877623454');" style=""> 294         return passwordResetHandlers;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295     }                                                                                                    </span>
<span  style=""> 296                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 297     @Override                                                                                            </span>
<span class="-8491421284615626461" onmouseenter="enter('-8491421284615626461');" onmouseout="out('-8491421284615626461');" style=""> 298     public void setPasswordResetHandlers(List&lt;PasswordUpdatedHandler&gt; passwordResetHandlers) {           </span>
<span class="-414209021704348335" onmouseenter="enter('-414209021704348335');" onmouseout="out('-414209021704348335');" style=""> 299         this.passwordResetHandlers = passwordResetHandlers;                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300     }                                                                                                    </span>
<span  style=""> 301                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 302     @Override                                                                                            </span>
<span class="6470870522961056065" onmouseenter="enter('6470870522961056065');" onmouseout="out('6470870522961056065');" style=""> 303     public List&lt;PasswordUpdatedHandler&gt; getPasswordChangedHandlers() {                                   </span>
<span class="-3664837019724564997" onmouseenter="enter('-3664837019724564997');" onmouseout="out('-3664837019724564997');" style=""> 304         return passwordChangedHandlers;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 305     }                                                                                                    </span>
<span  style=""> 306                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 307     @Override                                                                                            </span>
<span class="-2683520533006850846" onmouseenter="enter('-2683520533006850846');" onmouseout="out('-2683520533006850846');" style=""> 308     public void setPasswordChangedHandlers(List&lt;PasswordUpdatedHandler&gt; passwordChangedHandlers) {       </span>
<span class="3676994793125858903" onmouseenter="enter('3676994793125858903');" onmouseout="out('3676994793125858903');" style=""> 309         this.passwordChangedHandlers = passwordChangedHandlers;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 310     }                                                                                                    </span>
<span  style=""> 311                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 312     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 313     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="-5238259893338926366" onmouseenter="enter('-5238259893338926366');" onmouseout="out('-5238259893338926366');" style=""> 314     public GenericResponse sendForgotUsernameNotification(String emailAddress) {                         </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 315         GenericResponse response = new GenericResponse();                                                </span>
<span class="-6073063203294335299" onmouseenter="enter('-6073063203294335299');" onmouseout="out('-6073063203294335299');" style=""> 316         List&lt;Customer&gt; customers = null;                                                                 </span>
<span class="-8702812354445074278" onmouseenter="enter('-8702812354445074278');" onmouseout="out('-8702812354445074278');" style=""> 317         if (emailAddress != null) {                                                                      </span>
<span class="6147069966980396471" onmouseenter="enter('6147069966980396471');" onmouseout="out('6147069966980396471');" style=""> 318             customers = customerDao.readCustomersByEmail(emailAddress);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319         }                                                                                                </span>
<span  style=""> 320                                                                                                          </span>
<span class="-6772255019077760087" onmouseenter="enter('-6772255019077760087');" onmouseout="out('-6772255019077760087');" style=""> 321         if (CollectionUtils.isEmpty(customers)) {                                                        </span>
<span class="7242450034468345273" onmouseenter="enter('7242450034468345273');" onmouseout="out('7242450034468345273');" style=""> 322             response.addErrorCode(&quot;notFound&quot;);                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 323         } else {                                                                                         </span>
<span class="-2763458366902467863" onmouseenter="enter('-2763458366902467863');" onmouseout="out('-2763458366902467863');" style=""> 324             List&lt;String&gt; activeUsernames = new ArrayList&lt;String&gt;();                                      </span>
<span class="-5523479913680151900" onmouseenter="enter('-5523479913680151900');" onmouseout="out('-5523479913680151900');" style=""> 325             for (Customer customer : customers) {                                                        </span>
<span class="6036228608782108118" onmouseenter="enter('6036228608782108118');" onmouseout="out('6036228608782108118');" style=""> 326                 if (!customer.isDeactivated()) {                                                         </span>
<span class="-342072533744095855" onmouseenter="enter('-342072533744095855');" onmouseout="out('-342072533744095855');" style=""> 327                     activeUsernames.add(customer.getUsername());                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 329             }                                                                                            </span>
<span  style=""> 330                                                                                                          </span>
<span class="7800996103103911618" onmouseenter="enter('7800996103103911618');" onmouseout="out('7800996103103911618');" style=""> 331             if (activeUsernames.size() &gt; 0) {                                                            </span>
<span class="4008741571181358527" onmouseenter="enter('4008741571181358527');" onmouseout="out('4008741571181358527');" style=""><abbr title=" 332                 eventPublisher.publishEvent(new ForgotUsernameEvent(this, emailAddress, activeUsernames));"> 332                 eventPublisher.publishEvent(new ForgotUsernameEvent(this, emailAddress, activeUsernames))ðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 333             } else {                                                                                     </span>
<span class="3603576439991328525" onmouseenter="enter('3603576439991328525');" onmouseout="out('3603576439991328525');" style=""> 334                 // send inactive username found email.                                                   </span>
<span class="5510537362121156528" onmouseenter="enter('5510537362121156528');" onmouseout="out('5510537362121156528');" style=""> 335                 response.addErrorCode(&quot;inactiveUser&quot;);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337         }                                                                                                </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 338         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339     }                                                                                                    </span>
<span  style=""> 340                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 341     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 342     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="3120849722145808131" onmouseenter="enter('3120849722145808131');" onmouseout="out('3120849722145808131');" style=""> 343     public GenericResponse sendForgotPasswordNotification(String username, String resetPasswordUrl) {    </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 344         GenericResponse response = new GenericResponse();                                                </span>
<span class="6921810928241781426" onmouseenter="enter('6921810928241781426');" onmouseout="out('6921810928241781426');" style=""> 345         Customer customer = null;                                                                        </span>
<span  style=""> 346                                                                                                          </span>
<span class="-8284276918575957483" onmouseenter="enter('-8284276918575957483');" onmouseout="out('-8284276918575957483');" style=""> 347         if (username != null) {                                                                          </span>
<span class="-104711026898859267" onmouseenter="enter('-104711026898859267');" onmouseout="out('-104711026898859267');" style=""> 348             customer = customerDao.readCustomerByUsername(username);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349         }                                                                                                </span>
<span  style=""> 350                                                                                                          </span>
<span class="-3681439263985626916" onmouseenter="enter('-3681439263985626916');" onmouseout="out('-3681439263985626916');" style=""> 351         checkCustomer(customer, response);                                                               </span>
<span  style=""> 352                                                                                                          </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 353         if (!response.getHasErrors()) {                                                                  </span>
<span class="-8225007983262534214" onmouseenter="enter('-8225007983262534214');" onmouseout="out('-8225007983262534214');" style=""> 354             String token = PasswordUtils.generateSecurePassword(getPasswordTokenLength());               </span>
<span class="5927756983469236234" onmouseenter="enter('5927756983469236234');" onmouseout="out('5927756983469236234');" style=""> 355             token = token.toLowerCase();                                                                 </span>
<span  style=""> 356                                                                                                          </span>
<span class="3663219121994932306" onmouseenter="enter('3663219121994932306');" onmouseout="out('3663219121994932306');" style=""> 357             CustomerForgotPasswordSecurityToken fpst = new CustomerForgotPasswordSecurityTokenImpl();    </span>
<span class="-6310870443046136255" onmouseenter="enter('-6310870443046136255');" onmouseout="out('-6310870443046136255');" style=""> 358             fpst.setCustomerId(customer.getId());                                                        </span>
<span class="-1250878182907610155" onmouseenter="enter('-1250878182907610155');" onmouseout="out('-1250878182907610155');" style=""> 359             fpst.setToken(encodePassword(token));                                                        </span>
<span class="118078353989050088" onmouseenter="enter('118078353989050088');" onmouseout="out('118078353989050088');" style=""> 360             fpst.setCreateDate(SystemTime.asDate());                                                     </span>
<span class="6850446059209105577" onmouseenter="enter('6850446059209105577');" onmouseout="out('6850446059209105577');" style=""> 361             customerForgotPasswordSecurityTokenDao.saveToken(fpst);                                      </span>
<span  style=""> 362                                                                                                          </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 363 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="8884608966566249698" onmouseenter="enter('8884608966566249698');" onmouseout="out('8884608966566249698');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 364             HashMap&lt;String, Object&gt; vars = new HashMap&lt;String, Object&gt;();                                </span>
<span class="-7576751007074497786" onmouseenter="enter('-7576751007074497786');" onmouseout="out('-7576751007074497786');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 365             vars.put(&quot;token&quot;, token);                                                                    </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 366 ||||||| BASE                                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 367                                                                                                          </span>
<span class="3663219121994932306" onmouseenter="enter('3663219121994932306');" onmouseout="out('3663219121994932306');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 368             CustomerForgotPasswordSecurityToken fpst = new CustomerForgotPasswordSecurityTokenImpl();    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 369 =======                                                                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 370 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="7676904455881888218" onmouseenter="enter('7676904455881888218');" onmouseout="out('7676904455881888218');" style=""> 371             if (!StringUtils.isEmpty(resetPasswordUrl)) {                                                </span>
<span class="-504875606182491340" onmouseenter="enter('-504875606182491340');" onmouseout="out('-504875606182491340');" style=""> 372                 if (resetPasswordUrl.contains(&quot;?&quot;)) {                                                    </span>
<span class="-909834401001506984" onmouseenter="enter('-909834401001506984');" onmouseout="out('-909834401001506984');" style=""> 373                     resetPasswordUrl = resetPasswordUrl + &quot;&amp;token=&quot; + token;                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 374                 } else {                                                                                 </span>
<span class="-4209124057383847446" onmouseenter="enter('-4209124057383847446');" onmouseout="out('-4209124057383847446');" style=""> 375                     resetPasswordUrl = resetPasswordUrl + &quot;?token=&quot; + token;                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 377             }                                                                                            </span>
<span  style=""> 378                                                                                                          </span>
<span class="-8393391692837051437" onmouseenter="enter('-8393391692837051437');" onmouseout="out('-8393391692837051437');" style=""><abbr title=" 379             eventPublisher.publishEvent(new ForgotPasswordEvent(this, customer.getId(), token, resetPasswordUrl));"> 379             eventPublisher.publishEvent(new ForgotPasswordEvent(this, customer.getId(), token, resetPasswðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 380         }                                                                                                </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 381         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 382     }                                                                                                    </span>
<span  style=""> 383                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 384     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 385     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="-6820057886432852816" onmouseenter="enter('-6820057886432852816');" onmouseout="out('-6820057886432852816');" style=""><abbr title=" 386     public GenericResponse sendForcedPasswordChangeNotification(String username, String resetPasswordUrl) {"> 386     public GenericResponse sendForcedPasswordChangeNotification(String username, String resetPasswordUrl)ðŸ”µ</abbr></span>
<span class="-12493669403857096" onmouseenter="enter('-12493669403857096');" onmouseout="out('-12493669403857096');" style=""> 387         return sendForgotPasswordNotification(username, resetPasswordUrl);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388     }                                                                                                    </span>
<span  style=""> 389                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 390     @Override                                                                                            </span>
<span class="-7547112806897146214" onmouseenter="enter('-7547112806897146214');" onmouseout="out('-7547112806897146214');" style=""> 391     public GenericResponse checkPasswordResetToken(String token, Customer customer) {                    </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 392         GenericResponse response = new GenericResponse();                                                </span>
<span class="913599117713435265" onmouseenter="enter('913599117713435265');" onmouseout="out('913599117713435265');" style=""> 393         checkPasswordResetToken(token, customer, response);                                              </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 394         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 395     }                                                                                                    </span>
<span  style=""> 396                                                                                                          </span>
<span class="1872423782765914316" onmouseenter="enter('1872423782765914316');" onmouseout="out('1872423782765914316');" style=""><abbr title=" 397     protected CustomerForgotPasswordSecurityToken checkPasswordResetToken(String token, Customer customer, GenericResponse response) {"> 397     protected CustomerForgotPasswordSecurityToken checkPasswordResetToken(String token, Customer customerðŸ”µ</abbr></span>
<span class="-4169390037463393090" onmouseenter="enter('-4169390037463393090');" onmouseout="out('-4169390037463393090');" style=""> 398         if (StringUtils.isBlank(token)) {                                                                </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style=""> 399             response.addErrorCode(&quot;invalidToken&quot;);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 400         }                                                                                                </span>
<span  style=""> 401                                                                                                          </span>
<span class="5092673057151141969" onmouseenter="enter('5092673057151141969');" onmouseout="out('5092673057151141969');" style=""> 402         String rawToken = token;                                                                         </span>
<span  style=""> 403                                                                                                          </span>
<span class="-7243325982712524701" onmouseenter="enter('-7243325982712524701');" onmouseout="out('-7243325982712524701');" style=""> 404         CustomerForgotPasswordSecurityToken fpst = null;                                                 </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 405         if (!response.getHasErrors()) {                                                                  </span>
<span class="-1371412200964570990" onmouseenter="enter('-1371412200964570990');" onmouseout="out('-1371412200964570990');" style=""> 406             if (customer == null) {                                                                      </span>
<span class="5265761721143258453" onmouseenter="enter('5265761721143258453');" onmouseout="out('5265761721143258453');" style=""> 407                 fpst = customerForgotPasswordSecurityTokenDao.readToken(encodePassword(token));          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 408             } else {                                                                                     </span>
<span class="-2708743959084825308" onmouseenter="enter('-2708743959084825308');" onmouseout="out('-2708743959084825308');" style=""><abbr title=" 409                 List&lt;CustomerForgotPasswordSecurityToken&gt; fpstoks = customerForgotPasswordSecurityTokenDao.readUnusedTokensByCustomerId(customer.getId());"> 409                 List&lt;CustomerForgotPasswordSecurityToken&gt; fpstoks = customerForgotPasswordSecurityTokenDaðŸ”µ</abbr></span>
<span class="6715544567105364437" onmouseenter="enter('6715544567105364437');" onmouseout="out('6715544567105364437');" style=""> 410                 for (CustomerForgotPasswordSecurityToken fpstok : fpstoks) {                             </span>
<span class="-2377519018742151157" onmouseenter="enter('-2377519018742151157');" onmouseout="out('-2377519018742151157');" style=""> 411                     if (isPasswordValid(rawToken, fpstok.getToken())) {                                  </span>
<span class="-8696697531199533964" onmouseenter="enter('-8696697531199533964');" onmouseout="out('-8696697531199533964');" style=""> 412                         fpst = fpstok;                                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 413                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 414                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 416             }                                                                                            </span>
<span class="-1673544419969423705" onmouseenter="enter('-1673544419969423705');" onmouseout="out('-1673544419969423705');" style=""> 417             if (fpst == null) {                                                                          </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style=""> 418                 response.addErrorCode(&quot;invalidToken&quot;);                                                   </span>
<span class="-1851754756462568438" onmouseenter="enter('-1851754756462568438');" onmouseout="out('-1851754756462568438');" style=""> 419             } else if (fpst.isTokenUsedFlag()) {                                                         </span>
<span class="-4571187449058469389" onmouseenter="enter('-4571187449058469389');" onmouseout="out('-4571187449058469389');" style=""> 420                 response.addErrorCode(&quot;tokenUsed&quot;);                                                      </span>
<span class="1126518180689710158" onmouseenter="enter('1126518180689710158');" onmouseout="out('1126518180689710158');" style=""> 421             } else if (isTokenExpired(fpst)) {                                                           </span>
<span class="1324239895302259913" onmouseenter="enter('1324239895302259913');" onmouseout="out('1324239895302259913');" style=""> 422                 response.addErrorCode(&quot;tokenExpired&quot;);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 423             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 424         }                                                                                                </span>
<span class="-4960476697639333031" onmouseenter="enter('-4960476697639333031');" onmouseout="out('-4960476697639333031');" style=""> 425         return fpst;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 426     }                                                                                                    </span>
<span  style=""> 427                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 428     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 429     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="-1553234826628367049" onmouseenter="enter('-1553234826628367049');" onmouseout="out('-1553234826628367049');" style=""><abbr title=" 430     public GenericResponse resetPasswordUsingToken(String username, String token, String password, String confirmPassword) {"> 430     public GenericResponse resetPasswordUsingToken(String username, String token, String password, StringðŸ”µ</abbr></span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 431         GenericResponse response = new GenericResponse();                                                </span>
<span class="6921810928241781426" onmouseenter="enter('6921810928241781426');" onmouseout="out('6921810928241781426');" style=""> 432         Customer customer = null;                                                                        </span>
<span class="-8284276918575957483" onmouseenter="enter('-8284276918575957483');" onmouseout="out('-8284276918575957483');" style=""> 433         if (username != null) {                                                                          </span>
<span class="-104711026898859267" onmouseenter="enter('-104711026898859267');" onmouseout="out('-104711026898859267');" style=""> 434             customer = customerDao.readCustomerByUsername(username);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 435         }                                                                                                </span>
<span class="-3681439263985626916" onmouseenter="enter('-3681439263985626916');" onmouseout="out('-3681439263985626916');" style=""> 436         checkCustomer(customer, response);                                                               </span>
<span class="-3971600249312835278" onmouseenter="enter('-3971600249312835278');" onmouseout="out('-3971600249312835278');" style=""> 437         checkPassword(password, confirmPassword, response);                                              </span>
<span class="2411779224658140401" onmouseenter="enter('2411779224658140401');" onmouseout="out('2411779224658140401');" style=""> 438         CustomerForgotPasswordSecurityToken fpst = checkPasswordResetToken(token, customer, response);   </span>
<span  style=""> 439                                                                                                          </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 440         if (!response.getHasErrors()) {                                                                  </span>
<span class="485270787578743194" onmouseenter="enter('485270787578743194');" onmouseout="out('485270787578743194');" style=""> 441             if (!customer.getId().equals(fpst.getCustomerId())) {                                        </span>
<span class="-5994256316510103080" onmouseenter="enter('-5994256316510103080');" onmouseout="out('-5994256316510103080');" style=""> 442                 if (LOG.isWarnEnabled()) {                                                               </span>
<span class="-3030254613251423793" onmouseenter="enter('-3030254613251423793');" onmouseout="out('-3030254613251423793');" style=""><abbr title=" 443                     LOG.warn(&quot;Password reset attempt tried with mismatched customer and token &quot; + customer.getId() + &quot;, &quot; + StringUtil.sanitize(token));"> 443                     LOG.warn(&quot;Password reset attempt tried with mismatched customer and token &quot; + customeðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444                 }                                                                                        </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style=""> 445                 response.addErrorCode(&quot;invalidToken&quot;);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 446             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 447         }                                                                                                </span>
<span  style=""> 448                                                                                                          </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 449         if (!response.getHasErrors()) {                                                                  </span>
<span class="5101903206908082309" onmouseenter="enter('5101903206908082309');" onmouseout="out('5101903206908082309');" style=""> 450             customer.setUnencodedPassword(password);                                                     </span>
<span class="6606672839011797247" onmouseenter="enter('6606672839011797247');" onmouseout="out('6606672839011797247');" style=""> 451             customer.setPasswordChangeRequired(false);                                                   </span>
<span class="3384492063942947657" onmouseenter="enter('3384492063942947657');" onmouseout="out('3384492063942947657');" style=""> 452             saveCustomer(customer);                                                                      </span>
<span class="-7517227353230604805" onmouseenter="enter('-7517227353230604805');" onmouseout="out('-7517227353230604805');" style=""> 453             invalidateAllTokensForCustomer(customer);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 454         }                                                                                                </span>
<span  style=""> 455                                                                                                          </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 456         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 457     }                                                                                                    </span>
<span  style=""> 458                                                                                                          </span>
<span class="2450635656385893269" onmouseenter="enter('2450635656385893269');" onmouseout="out('2450635656385893269');" style=""> 459     protected void invalidateAllTokensForCustomer(Customer customer) {                                   </span>
<span class="500146367959601607" onmouseenter="enter('500146367959601607');" onmouseout="out('500146367959601607');" style=""><abbr title=" 460         List&lt;CustomerForgotPasswordSecurityToken&gt; tokens = customerForgotPasswordSecurityTokenDao.readUnusedTokensByCustomerId(customer.getId());"> 460         List&lt;CustomerForgotPasswordSecurityToken&gt; tokens = customerForgotPasswordSecurityTokenDao.readUnuðŸ”µ</abbr></span>
<span class="34403017169246064" onmouseenter="enter('34403017169246064');" onmouseout="out('34403017169246064');" style=""> 461         for (CustomerForgotPasswordSecurityToken token : tokens) {                                       </span>
<span class="-3707452475519083600" onmouseenter="enter('-3707452475519083600');" onmouseout="out('-3707452475519083600');" style=""> 462             token.setTokenUsedFlag(true);                                                                </span>
<span class="-8670185777060395996" onmouseenter="enter('-8670185777060395996');" onmouseout="out('-8670185777060395996');" style=""> 463             customerForgotPasswordSecurityTokenDao.saveToken(token);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 464         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 465     }                                                                                                    </span>
<span  style=""> 466                                                                                                          </span>
<span class="3178004875725558699" onmouseenter="enter('3178004875725558699');" onmouseout="out('3178004875725558699');" style=""> 467     protected void checkCustomer(Customer customer, GenericResponse response) {                          </span>
<span class="-1371412200964570990" onmouseenter="enter('-1371412200964570990');" onmouseout="out('-1371412200964570990');" style=""> 468         if (customer == null) {                                                                          </span>
<span class="-397249380987924174" onmouseenter="enter('-397249380987924174');" onmouseout="out('-397249380987924174');" style=""> 469             response.addErrorCode(&quot;invalidCustomer&quot;);                                                    </span>
<span class="-1786182981140386352" onmouseenter="enter('-1786182981140386352');" onmouseout="out('-1786182981140386352');" style=""> 470         } else if (StringUtils.isBlank(customer.getEmailAddress())) {                                    </span>
<span class="3641519375839212970" onmouseenter="enter('3641519375839212970');" onmouseout="out('3641519375839212970');" style=""> 471             response.addErrorCode(&quot;emailNotFound&quot;);                                                      </span>
<span class="4935674502595460128" onmouseenter="enter('4935674502595460128');" onmouseout="out('4935674502595460128');" style=""> 472         } else if (customer.isDeactivated()) {                                                           </span>
<span class="5510537362121156528" onmouseenter="enter('5510537362121156528');" onmouseout="out('5510537362121156528');" style=""> 473             response.addErrorCode(&quot;inactiveUser&quot;);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 474         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475     }                                                                                                    </span>
<span  style=""> 476                                                                                                          </span>
<span class="-3281949438797137351" onmouseenter="enter('-3281949438797137351');" onmouseout="out('-3281949438797137351');" style=""> 477     protected void checkPassword(String password, String confirmPassword, GenericResponse response) {    </span>
<span class="2256032458684464296" onmouseenter="enter('2256032458684464296');" onmouseout="out('2256032458684464296');" style=""> 478         if (StringUtils.isBlank(password) || StringUtils.isBlank(confirmPassword)) {                     </span>
<span class="5492480053199382271" onmouseenter="enter('5492480053199382271');" onmouseout="out('5492480053199382271');" style=""> 479             response.addErrorCode(&quot;invalidPassword&quot;);                                                    </span>
<span class="5837283644501577917" onmouseenter="enter('5837283644501577917');" onmouseout="out('5837283644501577917');" style=""> 480         } else if (!password.equals(confirmPassword)) {                                                  </span>
<span class="-5929993345093092025" onmouseenter="enter('-5929993345093092025');" onmouseout="out('-5929993345093092025');" style=""> 481             response.addErrorCode(&quot;passwordMismatch&quot;);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 482         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 483     }                                                                                                    </span>
<span  style=""> 484                                                                                                          </span>
<span class="2301745374477860963" onmouseenter="enter('2301745374477860963');" onmouseout="out('2301745374477860963');" style=""> 485     protected boolean isTokenExpired(CustomerForgotPasswordSecurityToken fpst) {                         </span>
<span class="7457175319484101734" onmouseenter="enter('7457175319484101734');" onmouseout="out('7457175319484101734');" style=""> 486         Date now = SystemTime.asDate();                                                                  </span>
<span class="4814679658448270347" onmouseenter="enter('4814679658448270347');" onmouseout="out('4814679658448270347');" style=""> 487         long currentTimeInMillis = now.getTime();                                                        </span>
<span class="2086457980523585614" onmouseenter="enter('2086457980523585614');" onmouseout="out('2086457980523585614');" style=""> 488         long tokenSaveTimeInMillis = fpst.getCreateDate().getTime();                                     </span>
<span class="6156534052742928347" onmouseenter="enter('6156534052742928347');" onmouseout="out('6156534052742928347');" style=""> 489         long minutesSinceSave = (currentTimeInMillis - tokenSaveTimeInMillis) / 60000;                   </span>
<span class="4808087245976426488" onmouseenter="enter('4808087245976426488');" onmouseout="out('4808087245976426488');" style=""> 490         return minutesSinceSave &gt; tokenExpiredMinutes;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 491     }                                                                                                    </span>
<span  style=""> 492                                                                                                          </span>
<span class="-7890820258027638542" onmouseenter="enter('-7890820258027638542');" onmouseout="out('-7890820258027638542');" style=""> 493     public int getTokenExpiredMinutes() {                                                                </span>
<span class="-8144525086468905422" onmouseenter="enter('-8144525086468905422');" onmouseout="out('-8144525086468905422');" style=""> 494         return tokenExpiredMinutes;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 495     }                                                                                                    </span>
<span  style=""> 496                                                                                                          </span>
<span class="-4089110355878340459" onmouseenter="enter('-4089110355878340459');" onmouseout="out('-4089110355878340459');" style=""> 497     public void setTokenExpiredMinutes(int tokenExpiredMinutes) {                                        </span>
<span class="-6197938813064605922" onmouseenter="enter('-6197938813064605922');" onmouseout="out('-6197938813064605922');" style=""> 498         this.tokenExpiredMinutes = tokenExpiredMinutes;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499     }                                                                                                    </span>
<span  style=""> 500                                                                                                          </span>
<span class="-2211298406731211675" onmouseenter="enter('-2211298406731211675');" onmouseout="out('-2211298406731211675');" style=""> 501     public int getPasswordTokenLength() {                                                                </span>
<span class="-9052975427749106201" onmouseenter="enter('-9052975427749106201');" onmouseout="out('-9052975427749106201');" style=""> 502         return passwordTokenLength;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 503     }                                                                                                    </span>
<span  style=""> 504                                                                                                          </span>
<span class="4968817442646533856" onmouseenter="enter('4968817442646533856');" onmouseout="out('4968817442646533856');" style=""> 505     public void setPasswordTokenLength(int passwordTokenLength) {                                        </span>
<span class="-6372163195142109946" onmouseenter="enter('-6372163195142109946');" onmouseout="out('-6372163195142109946');" style=""> 506         this.passwordTokenLength = passwordTokenLength;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 507     }                                                                                                    </span>
<span  style=""> 508                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 509     @Override                                                                                            </span>
<span class="2659754888592981645" onmouseenter="enter('2659754888592981645');" onmouseout="out('2659754888592981645');" style=""> 510     public List&lt;Customer&gt; readBatchCustomers(int start, int pageSize) {                                  </span>
<span class="-8143894692030732868" onmouseenter="enter('-8143894692030732868');" onmouseout="out('-8143894692030732868');" style=""> 511         return customerDao.readBatchCustomers(start, pageSize);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 512     }                                                                                                    </span>
<span  style=""> 513                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 514     @Override                                                                                            </span>
<span class="4634920297968325108" onmouseenter="enter('4634920297968325108');" onmouseout="out('4634920297968325108');" style=""> 515     public Long readNumberOfCustomers() {                                                                </span>
<span class="93124683563030725" onmouseenter="enter('93124683563030725');" onmouseout="out('93124683563030725');" style=""> 516         return customerDao.readNumberOfCustomers();                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 517     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 518 }                                                                                                        </span>








































































































































































































































































































































































































</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="195929208389810495" onmouseenter="enter('195929208389810495');" onmouseout="out('195929208389810495');" style="">   3  * BroadleafCommerce Profile                                                                             </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="5673174586140185880" onmouseenter="enter('5673174586140185880');" onmouseout="out('5673174586140185880');" style="">  18 package org.broadleafcommerce.profile.core.service;                                                      </span>
<span  style="">  19                                                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  20 import java.util.ArrayList;                                                                              </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="">  21 import java.util.Date;                                                                                   </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  22 import java.util.HashMap;                                                                                </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  23 import java.util.Iterator;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  24 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  25 import java.util.Map;                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  26 import javax.annotation.Resource;                                                                        </span>
<span class="-4900305655545834342" onmouseenter="enter('-4900305655545834342');" onmouseout="out('-4900305655545834342');" style="">  27 import org.apache.commons.collections4.CollectionUtils;                                                  </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  28 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  29 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  30 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="6519729880675887369" onmouseenter="enter('6519729880675887369');" onmouseout="out('6519729880675887369');" style="">  31 import org.broadleafcommerce.common.event.BroadleafApplicationEventPublisher;                            </span>
<span class="8150446407418055690" onmouseenter="enter('8150446407418055690');" onmouseout="out('8150446407418055690');" style="">  32 import org.broadleafcommerce.common.id.service.IdGenerationService;                                      </span>
<span class="8527520771739085493" onmouseenter="enter('8527520771739085493');" onmouseout="out('8527520771739085493');" style="">  33 import org.broadleafcommerce.common.rule.MvelHelper;                                                     </span>
<span class="-2635683203763841416" onmouseenter="enter('-2635683203763841416');" onmouseout="out('-2635683203763841416');" style="">  34 import org.broadleafcommerce.common.security.util.PasswordChange;                                        </span>
<span class="5972522294326904672" onmouseenter="enter('5972522294326904672');" onmouseout="out('5972522294326904672');" style="">  35 import org.broadleafcommerce.common.security.util.PasswordReset;                                         </span>
<span class="6413981270350028954" onmouseenter="enter('6413981270350028954');" onmouseout="out('6413981270350028954');" style="">  36 import org.broadleafcommerce.common.security.util.PasswordUtils;                                         </span>
<span class="-3956591208111981988" onmouseenter="enter('-3956591208111981988');" onmouseout="out('-3956591208111981988');" style="">  37 import org.broadleafcommerce.common.service.GenericResponse;                                             </span>
<span class="1373992879208813777" onmouseenter="enter('1373992879208813777');" onmouseout="out('1373992879208813777');" style="">  38 import org.broadleafcommerce.common.time.SystemTime;                                                     </span>
<span class="-3347161074136237116" onmouseenter="enter('-3347161074136237116');" onmouseout="out('-3347161074136237116');" style="">  39 import org.broadleafcommerce.common.util.StringUtil;                                                     </span>
<span class="5107697851223623564" onmouseenter="enter('5107697851223623564');" onmouseout="out('5107697851223623564');" style="">  40 import org.broadleafcommerce.common.util.TransactionUtils;                                               </span>
<span class="5198631096841786518" onmouseenter="enter('5198631096841786518');" onmouseout="out('5198631096841786518');" style="">  41 import org.broadleafcommerce.profile.core.dao.CustomerDao;                                               </span>
<span class="6035498420134781098" onmouseenter="enter('6035498420134781098');" onmouseout="out('6035498420134781098');" style="">  42 import org.broadleafcommerce.profile.core.dao.CustomerForgotPasswordSecurityTokenDao;                    </span>
<span class="-2668610663458012770" onmouseenter="enter('-2668610663458012770');" onmouseout="out('-2668610663458012770');" style="">  43 import org.broadleafcommerce.profile.core.dao.RoleDao;                                                   </span>
<span class="-6242194486783230477" onmouseenter="enter('-6242194486783230477');" onmouseout="out('-6242194486783230477');" style="">  44 import org.broadleafcommerce.profile.core.domain.Customer;                                               </span>
<span class="7682914685467852548" onmouseenter="enter('7682914685467852548');" onmouseout="out('7682914685467852548');" style="">  45 import org.broadleafcommerce.profile.core.domain.CustomerForgotPasswordSecurityToken;                    </span>
<span class="-7325905376371760879" onmouseenter="enter('-7325905376371760879');" onmouseout="out('-7325905376371760879');" style="">  46 import org.broadleafcommerce.profile.core.domain.CustomerForgotPasswordSecurityTokenImpl;                </span>
<span class="-7795206435247364271" onmouseenter="enter('-7795206435247364271');" onmouseout="out('-7795206435247364271');" style="">  47 import org.broadleafcommerce.profile.core.domain.CustomerRole;                                           </span>
<span class="5359715183603948959" onmouseenter="enter('5359715183603948959');" onmouseout="out('5359715183603948959');" style="">  48 import org.broadleafcommerce.profile.core.domain.CustomerRoleImpl;                                       </span>
<span class="6271275544652071055" onmouseenter="enter('6271275544652071055');" onmouseout="out('6271275544652071055');" style="">  49 import org.broadleafcommerce.profile.core.domain.Role;                                                   </span>
<span class="-6657505372111281463" onmouseenter="enter('-6657505372111281463');" onmouseout="out('-6657505372111281463');" style="">  50 import org.broadleafcommerce.profile.core.dto.CustomerRuleHolder;                                        </span>
<span class="-8181433875826880332" onmouseenter="enter('-8181433875826880332');" onmouseout="out('-8181433875826880332');" style="">  51 import org.broadleafcommerce.profile.core.event.ForgotPasswordEvent;                                     </span>
<span class="7578912361223650489" onmouseenter="enter('7578912361223650489');" onmouseout="out('7578912361223650489');" style="">  52 import org.broadleafcommerce.profile.core.event.ForgotUsernameEvent;                                     </span>
<span class="-1223355443293629135" onmouseenter="enter('-1223355443293629135');" onmouseout="out('-1223355443293629135');" style="">  53 import org.broadleafcommerce.profile.core.event.RegisterCustomerEvent;                                   </span>
<span class="1248060424968705063" onmouseenter="enter('1248060424968705063');" onmouseout="out('1248060424968705063');" style="">  54 import org.broadleafcommerce.profile.core.service.handler.PasswordUpdatedHandler;                        </span>
<span class="-6753305615342929581" onmouseenter="enter('-6753305615342929581');" onmouseout="out('-6753305615342929581');" style="">  55 import org.broadleafcommerce.profile.core.service.listener.PostRegistrationObserver;                     </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  56 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="2075826732928208126" onmouseenter="enter('2075826732928208126');" onmouseout="out('2075826732928208126');" style="">  57 import org.springframework.security.crypto.password.PasswordEncoder;                                     </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  58 import org.springframework.stereotype.Service;                                                           </span>
<span class="4419089678332371422" onmouseenter="enter('4419089678332371422');" onmouseout="out('4419089678332371422');" style="">  59 import org.springframework.transaction.annotation.Transactional;                                         </span>
<span  style="">  60                                                                                                          </span>
<span  style="">  61                                                                                                          </span>
<span class="-3189571605039255438" onmouseenter="enter('-3189571605039255438');" onmouseout="out('-3189571605039255438');" style="">  62 @Service(&quot;blCustomerService&quot;)                                                                            </span>
<span class="-4315786798209752789" onmouseenter="enter('-4315786798209752789');" onmouseout="out('-4315786798209752789');" style="">  63 public class CustomerServiceImpl implements CustomerService {                                            </span>
<span class="-9223083925427668638" onmouseenter="enter('-9223083925427668638');" onmouseout="out('-9223083925427668638');" style="">  64     private static final Log LOG = LogFactory.getLog(CustomerServiceImpl.class);                         </span>
<span class="-8423658991079621305" onmouseenter="enter('-8423658991079621305');" onmouseout="out('-8423658991079621305');" style="">  65     private static final int PASSWORD_LENGTH = 16;                                                       </span>
<span  style="">  66                                                                                                          </span>
<span class="5554564923016007608" onmouseenter="enter('5554564923016007608');" onmouseout="out('5554564923016007608');" style="">  67     @Autowired                                                                                           </span>
<span class="-7224044524343370301" onmouseenter="enter('-7224044524343370301');" onmouseout="out('-7224044524343370301');" style="">  68     @Qualifier(&quot;blApplicationEventPublisher&quot;)                                                            </span>
<span class="-5629661248749562711" onmouseenter="enter('-5629661248749562711');" onmouseout="out('-5629661248749562711');" style="">  69     protected BroadleafApplicationEventPublisher eventPublisher;                                         </span>
<span  style="">  70                                                                                                          </span>
<span class="-3028644688219155238" onmouseenter="enter('-3028644688219155238');" onmouseout="out('-3028644688219155238');" style="">  71     @Resource(name=&quot;blCustomerDao&quot;)                                                                      </span>
<span class="8692367904333193309" onmouseenter="enter('8692367904333193309');" onmouseout="out('8692367904333193309');" style="">  72     protected CustomerDao customerDao;                                                                   </span>
<span  style="">  73                                                                                                          </span>
<span class="3094900987137494064" onmouseenter="enter('3094900987137494064');" onmouseout="out('3094900987137494064');" style="">  74     @Resource(name = &quot;blIdGenerationService&quot;)                                                            </span>
<span class="-7221277934130422196" onmouseenter="enter('-7221277934130422196');" onmouseout="out('-7221277934130422196');" style="">  75     protected IdGenerationService idGenerationService;                                                   </span>
<span  style="">  76                                                                                                          </span>
<span class="2365488678467894280" onmouseenter="enter('2365488678467894280');" onmouseout="out('2365488678467894280');" style="">  77     @Resource(name = &quot;blCustomerForgotPasswordSecurityTokenDao&quot;)                                         </span>
<span class="4716726216132170190" onmouseenter="enter('4716726216132170190');" onmouseout="out('4716726216132170190');" style="">  78     protected CustomerForgotPasswordSecurityTokenDao customerForgotPasswordSecurityTokenDao;             </span>
<span  style="">  79                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  80     /**                                                                                                  </span>
<span class="6298544191369985956" onmouseenter="enter('6298544191369985956');" onmouseout="out('6298544191369985956');" style=""><abbr title="  81      * &lt;p&gt;This is simply a placeholder to be used by {@link #setupPasswordEncoder()} to determine if we&#x27;re using the">  81      * &lt;p&gt;This is simply a placeholder to be used by {@link #setupPasswordEncoder()} to determine if we&#x27;rðŸ”µ</abbr></span>
<span class="897245791379814301" onmouseenter="enter('897245791379814301');" onmouseout="out('897245791379814301');" style=""><abbr title="  82      * new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.authentication.encoding.PasswordEncoder PasswordEncoder}">  82      * new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.authentication.eðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  83      */                                                                                                  </span>
<span class="3863006184976437823" onmouseenter="enter('3863006184976437823');" onmouseout="out('3863006184976437823');" style="">  84     @Resource(name = &quot;blPasswordEncoder&quot;)                                                                </span>
<span class="-2329929589298188398" onmouseenter="enter('-2329929589298188398');" onmouseout="out('-2329929589298188398');" style="">  85     protected PasswordEncoder passwordEncoderBean;                                                       </span>
<span  style="">  86                                                                                                          </span>
<span class="-5757933253912539407" onmouseenter="enter('-5757933253912539407');" onmouseout="out('-5757933253912539407');" style="">  87     @Resource(name = &quot;blRoleDao&quot;)                                                                        </span>
<span class="-2955407415487117626" onmouseenter="enter('-2955407415487117626');" onmouseout="out('-2955407415487117626');" style="">  88     protected RoleDao roleDao;                                                                           </span>
<span  style="">  89                                                                                                          </span>
<span class="453353925889912084" onmouseenter="enter('453353925889912084');" onmouseout="out('453353925889912084');" style="">  90     protected int tokenExpiredMinutes = 30;                                                              </span>
<span class="-1133336695006357373" onmouseenter="enter('-1133336695006357373');" onmouseout="out('-1133336695006357373');" style="">  91     protected int passwordTokenLength = 20;                                                              </span>
<span  style="">  92                                                                                                          </span>
<span class="-2653602182005192069" onmouseenter="enter('-2653602182005192069');" onmouseout="out('-2653602182005192069');" style=""><abbr title="  93     protected final List&lt;PostRegistrationObserver&gt; postRegisterListeners = new ArrayList&lt;PostRegistrationObserver&gt;();">  93     protected final List&lt;PostRegistrationObserver&gt; postRegisterListeners = new ArrayList&lt;PostRegistrationðŸ”µ</abbr></span>
<span class="6843669015915819090" onmouseenter="enter('6843669015915819090');" onmouseout="out('6843669015915819090');" style=""><abbr title="  94     protected List&lt;PasswordUpdatedHandler&gt; passwordResetHandlers = new ArrayList&lt;PasswordUpdatedHandler&gt;();">  94     protected List&lt;PasswordUpdatedHandler&gt; passwordResetHandlers = new ArrayList&lt;PasswordUpdatedHandler&gt;(ðŸ”µ</abbr></span>
<span class="-6685798853959138604" onmouseenter="enter('-6685798853959138604');" onmouseout="out('-6685798853959138604');" style=""><abbr title="  95     protected List&lt;PasswordUpdatedHandler&gt; passwordChangedHandlers = new ArrayList&lt;PasswordUpdatedHandler&gt;();">  95     protected List&lt;PasswordUpdatedHandler&gt; passwordChangedHandlers = new ArrayList&lt;PasswordUpdatedHandlerðŸ”µ</abbr></span>
<span  style="">  96                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  97     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style="">  98     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="8291295402928429592" onmouseenter="enter('8291295402928429592');" onmouseout="out('8291295402928429592');" style="">  99     public Customer saveCustomer(Customer customer) {                                                    </span>
<span class="-4698478172885390647" onmouseenter="enter('-4698478172885390647');" onmouseout="out('-4698478172885390647');" style=""> 100         return saveCustomer(customer, customer.isRegistered());                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101     }                                                                                                    </span>
<span  style=""> 102                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 103     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 104     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="201381677109704887" onmouseenter="enter('201381677109704887');" onmouseout="out('201381677109704887');" style=""> 105     public Customer saveCustomer(Customer customer, boolean register) {                                  </span>
<span class="6726515726770360071" onmouseenter="enter('6726515726770360071');" onmouseout="out('6726515726770360071');" style=""> 106         if (register &amp;&amp; !customer.isRegistered()) {                                                      </span>
<span class="2527359489469298483" onmouseenter="enter('2527359489469298483');" onmouseout="out('2527359489469298483');" style=""> 107             customer.setRegistered(true);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108         }                                                                                                </span>
<span  style=""> 109                                                                                                          </span>
<span class="-2753421557322414072" onmouseenter="enter('-2753421557322414072');" onmouseout="out('-2753421557322414072');" style=""> 110         if (customer.getUnencodedPassword() != null) {                                                   </span>
<span class="-8026123664621306465" onmouseenter="enter('-8026123664621306465');" onmouseout="out('-8026123664621306465');" style=""> 111             customer.setPassword(encodePassword(customer.getUnencodedPassword()));                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112         }                                                                                                </span>
<span  style=""> 113                                                                                                          </span>
<span class="-1576073390989032571" onmouseenter="enter('-1576073390989032571');" onmouseout="out('-1576073390989032571');" style=""> 114         // let&#x27;s make sure they entered a new challenge answer (we will populate                         </span>
<span class="-2819530999572063421" onmouseenter="enter('-2819530999572063421');" onmouseout="out('-2819530999572063421');" style=""> 115         // the password field with hashed values so check that they have changed                         </span>
<span class="-9126181688236016532" onmouseenter="enter('-9126181688236016532');" onmouseout="out('-9126181688236016532');" style=""> 116         // id                                                                                            </span>
<span class="-8509665365452883594" onmouseenter="enter('-8509665365452883594');" onmouseout="out('-8509665365452883594');" style=""><abbr title=" 117         if (customer.getUnencodedChallengeAnswer() != null &amp;&amp; !customer.getUnencodedChallengeAnswer().equals(customer.getChallengeAnswer())) {"> 117         if (customer.getUnencodedChallengeAnswer() != null &amp;&amp; !customer.getUnencodedChallengeAnswer().equðŸ”µ</abbr></span>
<span class="1806155368440017187" onmouseenter="enter('1806155368440017187');" onmouseout="out('1806155368440017187');" style=""> 118             customer.setChallengeAnswer(encodePassword(customer.getUnencodedChallengeAnswer()));         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119         }                                                                                                </span>
<span class="3406416334930679557" onmouseenter="enter('3406416334930679557');" onmouseout="out('3406416334930679557');" style=""> 120         return customerDao.save(customer);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121     }                                                                                                    </span>
<span  style=""> 122                                                                                                          </span>
<span class="-137997900411835717" onmouseenter="enter('-137997900411835717');" onmouseout="out('-137997900411835717');" style=""> 123     protected String generateSecurePassword() {                                                          </span>
<span class="-4377176751133654653" onmouseenter="enter('-4377176751133654653');" onmouseout="out('-4377176751133654653');" style=""> 124         return PasswordUtils.generateSecurePassword(PASSWORD_LENGTH);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 125     }                                                                                                    </span>
<span  style=""> 126                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 127     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 128     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="3910349330927871049" onmouseenter="enter('3910349330927871049');" onmouseout="out('3910349330927871049');" style=""> 129     public Customer registerCustomer(Customer customer, String password, String passwordConfirm) {       </span>
<span class="2527359489469298483" onmouseenter="enter('2527359489469298483');" onmouseout="out('2527359489469298483');" style=""> 130         customer.setRegistered(true);                                                                    </span>
<span  style=""> 131                                                                                                          </span>
<span class="-5009800104120858890" onmouseenter="enter('-5009800104120858890');" onmouseout="out('-5009800104120858890');" style=""> 132         // When unencodedPassword is set the save() will encode it                                       </span>
<span class="5360015832768603745" onmouseenter="enter('5360015832768603745');" onmouseout="out('5360015832768603745');" style=""> 133         if (customer.getId() == null) {                                                                  </span>
<span class="-5488615021987588883" onmouseenter="enter('-5488615021987588883');" onmouseout="out('-5488615021987588883');" style=""> 134             customer.setId(findNextCustomerId());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135         }                                                                                                </span>
<span class="5101903206908082309" onmouseenter="enter('5101903206908082309');" onmouseout="out('5101903206908082309');" style=""> 136         customer.setUnencodedPassword(password);                                                         </span>
<span class="-1307190252670550775" onmouseenter="enter('-1307190252670550775');" onmouseout="out('-1307190252670550775');" style=""> 137         Customer retCustomer = saveCustomer(customer);                                                   </span>
<span class="-7993851139681656451" onmouseenter="enter('-7993851139681656451');" onmouseout="out('-7993851139681656451');" style=""> 138         createRegisteredCustomerRoles(retCustomer);                                                      </span>
<span  style=""> 139                                                                                                          </span>
<span class="-3489922120474106740" onmouseenter="enter('-3489922120474106740');" onmouseout="out('-3489922120474106740');" style=""> 140         eventPublisher.publishEvent(new RegisterCustomerEvent(this, retCustomer.getId()));               </span>
<span class="-3623043072901839896" onmouseenter="enter('-3623043072901839896');" onmouseout="out('-3623043072901839896');" style=""> 141         notifyPostRegisterListeners(retCustomer);                                                        </span>
<span  style=""> 142                                                                                                          </span>
<span class="-6683456484294032112" onmouseenter="enter('-6683456484294032112');" onmouseout="out('-6683456484294032112');" style=""> 143         return retCustomer;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144     }                                                                                                    </span>
<span  style=""> 145                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 146     @Override                                                                                            </span>
<span class="-8989473089684210869" onmouseenter="enter('-8989473089684210869');" onmouseout="out('-8989473089684210869');" style=""> 147     public void createRegisteredCustomerRoles(Customer customer) {                                       </span>
<span class="-967668152739756369" onmouseenter="enter('-967668152739756369');" onmouseout="out('-967668152739756369');" style=""> 148         Role role = roleDao.readRoleByName(&quot;ROLE_USER&quot;);                                                 </span>
<span class="-7484208420944991016" onmouseenter="enter('-7484208420944991016');" onmouseout="out('-7484208420944991016');" style=""> 149         CustomerRole customerRole = new CustomerRoleImpl();                                              </span>
<span class="-3544050209899951111" onmouseenter="enter('-3544050209899951111');" onmouseout="out('-3544050209899951111');" style=""> 150         customerRole.setRole(role);                                                                      </span>
<span class="-4836769794727897713" onmouseenter="enter('-4836769794727897713');" onmouseout="out('-4836769794727897713');" style=""> 151         customerRole.setCustomer(customer);                                                              </span>
<span class="2561970876173710740" onmouseenter="enter('2561970876173710740');" onmouseout="out('2561970876173710740');" style=""> 152         roleDao.addRoleToCustomer(customerRole);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 153     }                                                                                                    </span>
<span  style=""> 154                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 155     @Override                                                                                            </span>
<span class="-8289498668946854999" onmouseenter="enter('-8289498668946854999');" onmouseout="out('-8289498668946854999');" style=""> 156     public Customer readCustomerByEmail(String emailAddress) {                                           </span>
<span class="6996298339377860417" onmouseenter="enter('6996298339377860417');" onmouseout="out('6996298339377860417');" style=""> 157         return customerDao.readCustomerByEmail(emailAddress);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158     }                                                                                                    </span>
<span  style=""> 159                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 160     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 161     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="2373324961324130685" onmouseenter="enter('2373324961324130685');" onmouseout="out('2373324961324130685');" style=""> 162     public Customer changePassword(PasswordChange passwordChange) {                                      </span>
<span class="-5344336587939476831" onmouseenter="enter('-5344336587939476831');" onmouseout="out('-5344336587939476831');" style=""> 163         Customer customer = readCustomerByUsername(passwordChange.getUsername());                        </span>
<span class="3635027652328433999" onmouseenter="enter('3635027652328433999');" onmouseout="out('3635027652328433999');" style=""> 164         customer.setUnencodedPassword(passwordChange.getNewPassword());                                  </span>
<span class="9175276796642533968" onmouseenter="enter('9175276796642533968');" onmouseout="out('9175276796642533968');" style=""> 165         customer.setPasswordChangeRequired(passwordChange.getPasswordChangeRequired());                  </span>
<span class="5791162324212808512" onmouseenter="enter('5791162324212808512');" onmouseout="out('5791162324212808512');" style=""> 166         customer = saveCustomer(customer);                                                               </span>
<span  style=""> 167                                                                                                          </span>
<span class="1758176125617219344" onmouseenter="enter('1758176125617219344');" onmouseout="out('1758176125617219344');" style=""> 168         for (PasswordUpdatedHandler handler : passwordChangedHandlers) {                                 </span>
<span class="-390754915565928691" onmouseenter="enter('-390754915565928691');" onmouseout="out('-390754915565928691');" style=""> 169             handler.passwordChanged(passwordChange, customer, passwordChange.getNewPassword());          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170         }                                                                                                </span>
<span  style=""> 171                                                                                                          </span>
<span class="-3853204766136593997" onmouseenter="enter('-3853204766136593997');" onmouseout="out('-3853204766136593997');" style=""> 172         return customer;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173     }                                                                                                    </span>
<span  style=""> 174                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 175     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 176     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="-8338050129523775592" onmouseenter="enter('-8338050129523775592');" onmouseout="out('-8338050129523775592');" style=""> 177     public Customer resetPassword(PasswordReset passwordReset) {                                         </span>
<span class="6805273026067147007" onmouseenter="enter('6805273026067147007');" onmouseout="out('6805273026067147007');" style=""> 178         Customer customer = readCustomerByUsername(passwordReset.getUsername());                         </span>
<span class="-122847483108952780" onmouseenter="enter('-122847483108952780');" onmouseout="out('-122847483108952780');" style=""> 179         String newPassword = PasswordUtils.generateSecurePassword(passwordReset.getPasswordLength());    </span>
<span class="-62325817623586886" onmouseenter="enter('-62325817623586886');" onmouseout="out('-62325817623586886');" style=""> 180         customer.setUnencodedPassword(newPassword);                                                      </span>
<span class="6853349384480559800" onmouseenter="enter('6853349384480559800');" onmouseout="out('6853349384480559800');" style=""> 181         customer.setPasswordChangeRequired(passwordReset.getPasswordChangeRequired());                   </span>
<span class="5791162324212808512" onmouseenter="enter('5791162324212808512');" onmouseout="out('5791162324212808512');" style=""> 182         customer = saveCustomer(customer);                                                               </span>
<span  style=""> 183                                                                                                          </span>
<span class="265370277489880531" onmouseenter="enter('265370277489880531');" onmouseout="out('265370277489880531');" style=""> 184         for (PasswordUpdatedHandler handler : passwordResetHandlers) {                                   </span>
<span class="8731392908076423696" onmouseenter="enter('8731392908076423696');" onmouseout="out('8731392908076423696');" style=""> 185             handler.passwordChanged(passwordReset, customer, newPassword);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186         }                                                                                                </span>
<span  style=""> 187                                                                                                          </span>
<span class="-3853204766136593997" onmouseenter="enter('-3853204766136593997');" onmouseout="out('-3853204766136593997');" style=""> 188         return customer;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189     }                                                                                                    </span>
<span  style=""> 190                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 191     @Override                                                                                            </span>
<span class="-2286441478570387081" onmouseenter="enter('-2286441478570387081');" onmouseout="out('-2286441478570387081');" style=""> 192     public void addPostRegisterListener(PostRegistrationObserver postRegisterListeners) {                </span>
<span class="2003689350872197572" onmouseenter="enter('2003689350872197572');" onmouseout="out('2003689350872197572');" style=""> 193         this.postRegisterListeners.add(postRegisterListeners);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194     }                                                                                                    </span>
<span  style=""> 195                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 196     @Override                                                                                            </span>
<span class="-1507687767132611253" onmouseenter="enter('-1507687767132611253');" onmouseout="out('-1507687767132611253');" style=""> 197     public void removePostRegisterListener(PostRegistrationObserver postRegisterListeners) {             </span>
<span class="8851186764245103017" onmouseenter="enter('8851186764245103017');" onmouseout="out('8851186764245103017');" style=""> 198         if (this.postRegisterListeners.contains(postRegisterListeners)) {                                </span>
<span class="7168411145839318905" onmouseenter="enter('7168411145839318905');" onmouseout="out('7168411145839318905');" style=""> 199             this.postRegisterListeners.remove(postRegisterListeners);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201     }                                                                                                    </span>
<span  style=""> 202                                                                                                          </span>
<span class="3762831862655692775" onmouseenter="enter('3762831862655692775');" onmouseout="out('3762831862655692775');" style=""> 203     protected void notifyPostRegisterListeners(Customer customer) {                                      </span>
<span class="-5517241395960310234" onmouseenter="enter('-5517241395960310234');" onmouseout="out('-5517241395960310234');" style=""><abbr title=" 204         for (Iterator&lt;PostRegistrationObserver&gt; iter = postRegisterListeners.iterator(); iter.hasNext(); ) {"> 204         for (Iterator&lt;PostRegistrationObserver&gt; iter = postRegisterListeners.iterator(); iter.hasNext(); ðŸ”µ</abbr></span>
<span class="6852498861939683938" onmouseenter="enter('6852498861939683938');" onmouseout="out('6852498861939683938');" style=""> 205             PostRegistrationObserver listener = iter.next();                                             </span>
<span class="2537062439441145073" onmouseenter="enter('2537062439441145073');" onmouseout="out('2537062439441145073');" style=""> 206             listener.processRegistrationEvent(customer);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208     }                                                                                                    </span>
<span  style=""> 209                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 210     @Override                                                                                            </span>
<span class="-6715127601332863552" onmouseenter="enter('-6715127601332863552');" onmouseout="out('-6715127601332863552');" style=""> 211     public Customer createCustomer() {                                                                   </span>
<span class="1533232953867480113" onmouseenter="enter('1533232953867480113');" onmouseout="out('1533232953867480113');" style=""> 212         return createCustomerFromId(null);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213     }                                                                                                    </span>
<span  style=""> 214                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 215     @Override                                                                                            </span>
<span class="-3260175922123749747" onmouseenter="enter('-3260175922123749747');" onmouseout="out('-3260175922123749747');" style=""> 216     public Customer createCustomerFromId(Long customerId) {                                              </span>
<span class="4846947630103792555" onmouseenter="enter('4846947630103792555');" onmouseout="out('4846947630103792555');" style=""> 217         Customer customer = customerId != null ? readCustomerById(customerId) : null;                    </span>
<span class="-1371412200964570990" onmouseenter="enter('-1371412200964570990');" onmouseout="out('-1371412200964570990');" style=""> 218         if (customer == null) {                                                                          </span>
<span class="7584512027447697158" onmouseenter="enter('7584512027447697158');" onmouseout="out('7584512027447697158');" style=""> 219             customer = customerDao.create();                                                             </span>
<span class="-8452861246579893242" onmouseenter="enter('-8452861246579893242');" onmouseout="out('-8452861246579893242');" style=""> 220             if (customerId != null) {                                                                    </span>
<span class="1431826176080351208" onmouseenter="enter('1431826176080351208');" onmouseout="out('1431826176080351208');" style=""> 221                 customer.setId(customerId);                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 222             } else {                                                                                     </span>
<span class="-5488615021987588883" onmouseenter="enter('-5488615021987588883');" onmouseout="out('-5488615021987588883');" style=""> 223                 customer.setId(findNextCustomerId());                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225         }                                                                                                </span>
<span class="-3853204766136593997" onmouseenter="enter('-3853204766136593997');" onmouseout="out('-3853204766136593997');" style=""> 226         return customer;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227     }                                                                                                    </span>
<span  style=""> 228                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 229     @Override                                                                                            </span>
<span class="4598906423026393934" onmouseenter="enter('4598906423026393934');" onmouseout="out('4598906423026393934');" style=""> 230     public Long findNextCustomerId() {                                                                   </span>
<span class="-8819565094085247576" onmouseenter="enter('-8819565094085247576');" onmouseout="out('-8819565094085247576');" style=""> 231         return idGenerationService.findNextId(Customer.class.getCanonicalName());                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232     }                                                                                                    </span>
<span  style=""> 233                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 234     @Override                                                                                            </span>
<span class="-6999511709583967120" onmouseenter="enter('-6999511709583967120');" onmouseout="out('-6999511709583967120');" style=""> 235     public Customer createNewCustomer() {                                                                </span>
<span class="1533232953867480113" onmouseenter="enter('1533232953867480113');" onmouseout="out('1533232953867480113');" style=""> 236         return createCustomerFromId(null);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237     }                                                                                                    </span>
<span  style=""> 238                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 239     @Override                                                                                            </span>
<span class="7417643297497909843" onmouseenter="enter('7417643297497909843');" onmouseout="out('7417643297497909843');" style=""> 240     public void deleteCustomer(Customer customer) {                                                      </span>
<span class="-3138548839038622796" onmouseenter="enter('-3138548839038622796');" onmouseout="out('-3138548839038622796');" style=""> 241         roleDao.removeCustomerRolesByCustomerId(customer.getId());                                       </span>
<span class="-3819399187793284937" onmouseenter="enter('-3819399187793284937');" onmouseout="out('-3819399187793284937');" style=""> 242         customerDao.delete(customer);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243     }                                                                                                    </span>
<span  style=""> 244                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 245     @Override                                                                                            </span>
<span class="-5885291655878307572" onmouseenter="enter('-5885291655878307572');" onmouseout="out('-5885291655878307572');" style=""> 246     public Customer readCustomerByUsername(String username) {                                            </span>
<span class="589313108944980188" onmouseenter="enter('589313108944980188');" onmouseout="out('589313108944980188');" style=""> 247         return customerDao.readCustomerByUsername(username);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248     }                                                                                                    </span>
<span  style=""> 249                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 250     @Override                                                                                            </span>
<span class="847254476985500634" onmouseenter="enter('847254476985500634');" onmouseout="out('847254476985500634');" style=""> 251     public Customer readCustomerByUsername(String username, Boolean cacheable) {                         </span>
<span class="482041631891506127" onmouseenter="enter('482041631891506127');" onmouseout="out('482041631891506127');" style=""> 252         return customerDao.readCustomerByUsername(username, cacheable);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253     }                                                                                                    </span>
<span  style=""> 254                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 255     @Override                                                                                            </span>
<span class="-4374586036231570864" onmouseenter="enter('-4374586036231570864');" onmouseout="out('-4374586036231570864');" style=""> 256     public Customer readCustomerById(Long id) {                                                          </span>
<span class="-5062162633750648527" onmouseenter="enter('-5062162633750648527');" onmouseout="out('-5062162633750648527');" style=""> 257         return customerDao.readCustomerById(id);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258     }                                                                                                    </span>
<span  style=""> 259                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 260     @Override                                                                                            </span>
<span class="6825989998352983316" onmouseenter="enter('6825989998352983316');" onmouseout="out('6825989998352983316');" style=""> 261     public Customer readCustomerByExternalId(String userExternalId) {                                    </span>
<span class="5025115365525563343" onmouseenter="enter('5025115365525563343');" onmouseout="out('5025115365525563343');" style=""> 262         return customerDao.readCustomerByExternalId(userExternalId);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263     }                                                                                                    </span>
<span  style=""> 264                                                                                                          </span>
<span class="-8304645560568857694" onmouseenter="enter('-8304645560568857694');" onmouseout="out('-8304645560568857694');" style=""> 265     public void setCustomerDao(CustomerDao customerDao) {                                                </span>
<span class="-1477678724397974795" onmouseenter="enter('-1477678724397974795');" onmouseout="out('-1477678724397974795');" style=""> 266         this.customerDao = customerDao;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267     }                                                                                                    </span>
<span  style=""> 268                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 269     @Override                                                                                            </span>
<span class="-280180772892908532" onmouseenter="enter('-280180772892908532');" onmouseout="out('-280180772892908532');" style=""> 270     public String encodePassword(String rawPassword) {                                                   </span>
<span class="-3121342566836529697" onmouseenter="enter('-3121342566836529697');" onmouseout="out('-3121342566836529697');" style=""> 271         return passwordEncoderBean.encode(rawPassword);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272     }                                                                                                    </span>
<span  style=""> 273                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 274     @Override                                                                                            </span>
<span class="160568672931299235" onmouseenter="enter('160568672931299235');" onmouseout="out('160568672931299235');" style=""> 275     public boolean isPasswordValid(String rawPassword, String encodedPassword) {                         </span>
<span class="5053852377821437125" onmouseenter="enter('5053852377821437125');" onmouseout="out('5053852377821437125');" style=""> 276         return passwordEncoderBean.matches(rawPassword, encodedPassword);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277     }                                                                                                    </span>
<span  style=""> 278                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 279     @Override                                                                                            </span>
<span class="8805988825869661234" onmouseenter="enter('8805988825869661234');" onmouseout="out('8805988825869661234');" style=""> 280     public boolean customerPassesCustomerRule(Customer customer, CustomerRuleHolder customerRuleHolder) {</span>
<span class="-5898565890799276609" onmouseenter="enter('-5898565890799276609');" onmouseout="out('-5898565890799276609');" style=""> 281         String customerRule = customerRuleHolder.getCustomerRule();                                      </span>
<span class="201656563419603782" onmouseenter="enter('201656563419603782');" onmouseout="out('201656563419603782');" style=""> 282         Map&lt;String, Object&gt; ruleParams = buildCustomerRuleParams(customer);                              </span>
<span class="-7214228236632333169" onmouseenter="enter('-7214228236632333169');" onmouseout="out('-7214228236632333169');" style=""> 283         return customerRule == null || MvelHelper.evaluateRule(customerRule, ruleParams);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284     }                                                                                                    </span>
<span  style=""> 285                                                                                                          </span>
<span class="-6781673542839603116" onmouseenter="enter('-6781673542839603116');" onmouseout="out('-6781673542839603116');" style=""> 286     protected Map&lt;String, Object&gt; buildCustomerRuleParams(Customer customer) {                           </span>
<span class="-460782809524910092" onmouseenter="enter('-460782809524910092');" onmouseout="out('-460782809524910092');" style=""> 287         HashMap&lt;String, Object&gt; vars = new HashMap&lt;&gt;();                                                  </span>
<span class="8047728915418269458" onmouseenter="enter('8047728915418269458');" onmouseout="out('8047728915418269458');" style=""> 288         vars.put(&quot;customer&quot;, customer);                                                                  </span>
<span class="3198457421051297297" onmouseenter="enter('3198457421051297297');" onmouseout="out('3198457421051297297');" style=""> 289         return vars;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290     }                                                                                                    </span>
<span  style=""> 291                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 292     @Override                                                                                            </span>
<span class="-3888321916193976828" onmouseenter="enter('-3888321916193976828');" onmouseout="out('-3888321916193976828');" style=""> 293     public List&lt;PasswordUpdatedHandler&gt; getPasswordResetHandlers() {                                     </span>
<span class="6051450225877623454" onmouseenter="enter('6051450225877623454');" onmouseout="out('6051450225877623454');" style=""> 294         return passwordResetHandlers;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295     }                                                                                                    </span>
<span  style=""> 296                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 297     @Override                                                                                            </span>
<span class="-8491421284615626461" onmouseenter="enter('-8491421284615626461');" onmouseout="out('-8491421284615626461');" style=""> 298     public void setPasswordResetHandlers(List&lt;PasswordUpdatedHandler&gt; passwordResetHandlers) {           </span>
<span class="-414209021704348335" onmouseenter="enter('-414209021704348335');" onmouseout="out('-414209021704348335');" style=""> 299         this.passwordResetHandlers = passwordResetHandlers;                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300     }                                                                                                    </span>
<span  style=""> 301                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 302     @Override                                                                                            </span>
<span class="6470870522961056065" onmouseenter="enter('6470870522961056065');" onmouseout="out('6470870522961056065');" style=""> 303     public List&lt;PasswordUpdatedHandler&gt; getPasswordChangedHandlers() {                                   </span>
<span class="-3664837019724564997" onmouseenter="enter('-3664837019724564997');" onmouseout="out('-3664837019724564997');" style=""> 304         return passwordChangedHandlers;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 305     }                                                                                                    </span>
<span  style=""> 306                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 307     @Override                                                                                            </span>
<span class="-2683520533006850846" onmouseenter="enter('-2683520533006850846');" onmouseout="out('-2683520533006850846');" style=""> 308     public void setPasswordChangedHandlers(List&lt;PasswordUpdatedHandler&gt; passwordChangedHandlers) {       </span>
<span class="3676994793125858903" onmouseenter="enter('3676994793125858903');" onmouseout="out('3676994793125858903');" style=""> 309         this.passwordChangedHandlers = passwordChangedHandlers;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 310     }                                                                                                    </span>
<span  style=""> 311                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 312     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 313     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="-5238259893338926366" onmouseenter="enter('-5238259893338926366');" onmouseout="out('-5238259893338926366');" style=""> 314     public GenericResponse sendForgotUsernameNotification(String emailAddress) {                         </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 315         GenericResponse response = new GenericResponse();                                                </span>
<span class="-6073063203294335299" onmouseenter="enter('-6073063203294335299');" onmouseout="out('-6073063203294335299');" style=""> 316         List&lt;Customer&gt; customers = null;                                                                 </span>
<span class="-8702812354445074278" onmouseenter="enter('-8702812354445074278');" onmouseout="out('-8702812354445074278');" style=""> 317         if (emailAddress != null) {                                                                      </span>
<span class="6147069966980396471" onmouseenter="enter('6147069966980396471');" onmouseout="out('6147069966980396471');" style=""> 318             customers = customerDao.readCustomersByEmail(emailAddress);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319         }                                                                                                </span>
<span  style=""> 320                                                                                                          </span>
<span class="-6772255019077760087" onmouseenter="enter('-6772255019077760087');" onmouseout="out('-6772255019077760087');" style=""> 321         if (CollectionUtils.isEmpty(customers)) {                                                        </span>
<span class="7242450034468345273" onmouseenter="enter('7242450034468345273');" onmouseout="out('7242450034468345273');" style=""> 322             response.addErrorCode(&quot;notFound&quot;);                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 323         } else {                                                                                         </span>
<span class="-2763458366902467863" onmouseenter="enter('-2763458366902467863');" onmouseout="out('-2763458366902467863');" style=""> 324             List&lt;String&gt; activeUsernames = new ArrayList&lt;String&gt;();                                      </span>
<span class="-5523479913680151900" onmouseenter="enter('-5523479913680151900');" onmouseout="out('-5523479913680151900');" style=""> 325             for (Customer customer : customers) {                                                        </span>
<span class="6036228608782108118" onmouseenter="enter('6036228608782108118');" onmouseout="out('6036228608782108118');" style=""> 326                 if (!customer.isDeactivated()) {                                                         </span>
<span class="-342072533744095855" onmouseenter="enter('-342072533744095855');" onmouseout="out('-342072533744095855');" style=""> 327                     activeUsernames.add(customer.getUsername());                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 329             }                                                                                            </span>
<span  style=""> 330                                                                                                          </span>
<span class="7800996103103911618" onmouseenter="enter('7800996103103911618');" onmouseout="out('7800996103103911618');" style=""> 331             if (activeUsernames.size() &gt; 0) {                                                            </span>
<span class="4008741571181358527" onmouseenter="enter('4008741571181358527');" onmouseout="out('4008741571181358527');" style=""><abbr title=" 332                 eventPublisher.publishEvent(new ForgotUsernameEvent(this, emailAddress, activeUsernames));"> 332                 eventPublisher.publishEvent(new ForgotUsernameEvent(this, emailAddress, activeUsernames))ðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 333             } else {                                                                                     </span>
<span class="3603576439991328525" onmouseenter="enter('3603576439991328525');" onmouseout="out('3603576439991328525');" style=""> 334                 // send inactive username found email.                                                   </span>
<span class="5510537362121156528" onmouseenter="enter('5510537362121156528');" onmouseout="out('5510537362121156528');" style=""> 335                 response.addErrorCode(&quot;inactiveUser&quot;);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337         }                                                                                                </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 338         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339     }                                                                                                    </span>
<span  style=""> 340                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 341     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 342     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="3120849722145808131" onmouseenter="enter('3120849722145808131');" onmouseout="out('3120849722145808131');" style=""> 343     public GenericResponse sendForgotPasswordNotification(String username, String resetPasswordUrl) {    </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 344         GenericResponse response = new GenericResponse();                                                </span>
<span class="6921810928241781426" onmouseenter="enter('6921810928241781426');" onmouseout="out('6921810928241781426');" style=""> 345         Customer customer = null;                                                                        </span>
<span  style=""> 346                                                                                                          </span>
<span class="-8284276918575957483" onmouseenter="enter('-8284276918575957483');" onmouseout="out('-8284276918575957483');" style=""> 347         if (username != null) {                                                                          </span>
<span class="-104711026898859267" onmouseenter="enter('-104711026898859267');" onmouseout="out('-104711026898859267');" style=""> 348             customer = customerDao.readCustomerByUsername(username);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349         }                                                                                                </span>
<span  style=""> 350                                                                                                          </span>
<span class="-3681439263985626916" onmouseenter="enter('-3681439263985626916');" onmouseout="out('-3681439263985626916');" style=""> 351         checkCustomer(customer, response);                                                               </span>
<span  style=""> 352                                                                                                          </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 353         if (!response.getHasErrors()) {                                                                  </span>
<span class="-8225007983262534214" onmouseenter="enter('-8225007983262534214');" onmouseout="out('-8225007983262534214');" style=""> 354             String token = PasswordUtils.generateSecurePassword(getPasswordTokenLength());               </span>
<span class="5927756983469236234" onmouseenter="enter('5927756983469236234');" onmouseout="out('5927756983469236234');" style=""> 355             token = token.toLowerCase();                                                                 </span>
<span  style=""> 356                                                                                                          </span>
<span class="3663219121994932306" onmouseenter="enter('3663219121994932306');" onmouseout="out('3663219121994932306');" style=""> 357             CustomerForgotPasswordSecurityToken fpst = new CustomerForgotPasswordSecurityTokenImpl();    </span>
<span class="-6310870443046136255" onmouseenter="enter('-6310870443046136255');" onmouseout="out('-6310870443046136255');" style=""> 358             fpst.setCustomerId(customer.getId());                                                        </span>
<span class="-1250878182907610155" onmouseenter="enter('-1250878182907610155');" onmouseout="out('-1250878182907610155');" style=""> 359             fpst.setToken(encodePassword(token));                                                        </span>
<span class="118078353989050088" onmouseenter="enter('118078353989050088');" onmouseout="out('118078353989050088');" style=""> 360             fpst.setCreateDate(SystemTime.asDate());                                                     </span>
<span class="6850446059209105577" onmouseenter="enter('6850446059209105577');" onmouseout="out('6850446059209105577');" style=""> 361             customerForgotPasswordSecurityTokenDao.saveToken(fpst);                                      </span>
<span  style=""> 362                                                                                                          </span>
<span  style=""> 363                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 364 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="8884608966566249698" onmouseenter="enter('8884608966566249698');" onmouseout="out('8884608966566249698');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 365             HashMap&lt;String, Object&gt; vars = new HashMap&lt;String, Object&gt;();                                </span>
<span class="-7576751007074497786" onmouseenter="enter('-7576751007074497786');" onmouseout="out('-7576751007074497786');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 366             vars.put(&quot;token&quot;, token);                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 367                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 368 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 369 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 369 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 370 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 371                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 372                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 373 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="7676904455881888218" onmouseenter="enter('7676904455881888218');" onmouseout="out('7676904455881888218');" style=""> 374             if (!StringUtils.isEmpty(resetPasswordUrl)) {                                                </span>
<span class="-504875606182491340" onmouseenter="enter('-504875606182491340');" onmouseout="out('-504875606182491340');" style=""> 375                 if (resetPasswordUrl.contains(&quot;?&quot;)) {                                                    </span>
<span class="4689815450255607142" onmouseenter="enter('4689815450255607142');" onmouseout="out('4689815450255607142');" style=""> 376                     resetPasswordUrl = resetPasswordUrl+&quot;&amp;token=&quot;+token;                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 377                 } else {                                                                                 </span>
<span class="6497934083360311601" onmouseenter="enter('6497934083360311601');" onmouseout="out('6497934083360311601');" style=""> 378                     resetPasswordUrl = resetPasswordUrl+&quot;?token=&quot;+token;                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 380             }                                                                                            </span>
<span  style=""> 381                                                                                                          </span>
<span class="-8393391692837051437" onmouseenter="enter('-8393391692837051437');" onmouseout="out('-8393391692837051437');" style=""><abbr title=" 382             eventPublisher.publishEvent(new ForgotPasswordEvent(this, customer.getId(), token, resetPasswordUrl));"> 382             eventPublisher.publishEvent(new ForgotPasswordEvent(this, customer.getId(), token, resetPasswðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 383         }                                                                                                </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 384         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385     }                                                                                                    </span>
<span  style=""> 386                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 387     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 388     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="-6820057886432852816" onmouseenter="enter('-6820057886432852816');" onmouseout="out('-6820057886432852816');" style=""><abbr title=" 389     public GenericResponse sendForcedPasswordChangeNotification(String username, String resetPasswordUrl) {"> 389     public GenericResponse sendForcedPasswordChangeNotification(String username, String resetPasswordUrl)ðŸ”µ</abbr></span>
<span class="-12493669403857096" onmouseenter="enter('-12493669403857096');" onmouseout="out('-12493669403857096');" style=""> 390         return sendForgotPasswordNotification(username, resetPasswordUrl);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 391     }                                                                                                    </span>
<span  style=""> 392                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 393     @Override                                                                                            </span>
<span class="-7547112806897146214" onmouseenter="enter('-7547112806897146214');" onmouseout="out('-7547112806897146214');" style=""> 394     public GenericResponse checkPasswordResetToken(String token, Customer customer) {                    </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 395         GenericResponse response = new GenericResponse();                                                </span>
<span class="913599117713435265" onmouseenter="enter('913599117713435265');" onmouseout="out('913599117713435265');" style=""> 396         checkPasswordResetToken(token, customer, response);                                              </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 397         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 398     }                                                                                                    </span>
<span  style=""> 399                                                                                                          </span>
<span class="1872423782765914316" onmouseenter="enter('1872423782765914316');" onmouseout="out('1872423782765914316');" style=""><abbr title=" 400     protected CustomerForgotPasswordSecurityToken checkPasswordResetToken(String token, Customer customer, GenericResponse response) {"> 400     protected CustomerForgotPasswordSecurityToken checkPasswordResetToken(String token, Customer customerðŸ”µ</abbr></span>
<span class="-4169390037463393090" onmouseenter="enter('-4169390037463393090');" onmouseout="out('-4169390037463393090');" style=""> 401         if (StringUtils.isBlank(token)) {                                                                </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style=""> 402             response.addErrorCode(&quot;invalidToken&quot;);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403         }                                                                                                </span>
<span  style=""> 404                                                                                                          </span>
<span class="5092673057151141969" onmouseenter="enter('5092673057151141969');" onmouseout="out('5092673057151141969');" style=""> 405         String rawToken = token;                                                                         </span>
<span  style=""> 406                                                                                                          </span>
<span class="-7243325982712524701" onmouseenter="enter('-7243325982712524701');" onmouseout="out('-7243325982712524701');" style=""> 407         CustomerForgotPasswordSecurityToken fpst = null;                                                 </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 408         if (!response.getHasErrors()) {                                                                  </span>
<span class="-1371412200964570990" onmouseenter="enter('-1371412200964570990');" onmouseout="out('-1371412200964570990');" style=""> 409             if (customer == null) {                                                                      </span>
<span class="5265761721143258453" onmouseenter="enter('5265761721143258453');" onmouseout="out('5265761721143258453');" style=""> 410                 fpst = customerForgotPasswordSecurityTokenDao.readToken(encodePassword(token));          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 411             } else {                                                                                     </span>
<span class="-2708743959084825308" onmouseenter="enter('-2708743959084825308');" onmouseout="out('-2708743959084825308');" style=""><abbr title=" 412                 List&lt;CustomerForgotPasswordSecurityToken&gt; fpstoks = customerForgotPasswordSecurityTokenDao.readUnusedTokensByCustomerId(customer.getId());"> 412                 List&lt;CustomerForgotPasswordSecurityToken&gt; fpstoks = customerForgotPasswordSecurityTokenDaðŸ”µ</abbr></span>
<span class="6715544567105364437" onmouseenter="enter('6715544567105364437');" onmouseout="out('6715544567105364437');" style=""> 413                 for (CustomerForgotPasswordSecurityToken fpstok : fpstoks) {                             </span>
<span class="-2377519018742151157" onmouseenter="enter('-2377519018742151157');" onmouseout="out('-2377519018742151157');" style=""> 414                     if (isPasswordValid(rawToken, fpstok.getToken())) {                                  </span>
<span class="-8696697531199533964" onmouseenter="enter('-8696697531199533964');" onmouseout="out('-8696697531199533964');" style=""> 415                         fpst = fpstok;                                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 416                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 417                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 418                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 419             }                                                                                            </span>
<span class="-1673544419969423705" onmouseenter="enter('-1673544419969423705');" onmouseout="out('-1673544419969423705');" style=""> 420             if (fpst == null) {                                                                          </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style=""> 421                 response.addErrorCode(&quot;invalidToken&quot;);                                                   </span>
<span class="-1851754756462568438" onmouseenter="enter('-1851754756462568438');" onmouseout="out('-1851754756462568438');" style=""> 422             } else if (fpst.isTokenUsedFlag()) {                                                         </span>
<span class="-4571187449058469389" onmouseenter="enter('-4571187449058469389');" onmouseout="out('-4571187449058469389');" style=""> 423                 response.addErrorCode(&quot;tokenUsed&quot;);                                                      </span>
<span class="1126518180689710158" onmouseenter="enter('1126518180689710158');" onmouseout="out('1126518180689710158');" style=""> 424             } else if (isTokenExpired(fpst)) {                                                           </span>
<span class="1324239895302259913" onmouseenter="enter('1324239895302259913');" onmouseout="out('1324239895302259913');" style=""> 425                 response.addErrorCode(&quot;tokenExpired&quot;);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 426             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 427         }                                                                                                </span>
<span class="-4960476697639333031" onmouseenter="enter('-4960476697639333031');" onmouseout="out('-4960476697639333031');" style=""> 428         return fpst;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 429     }                                                                                                    </span>
<span  style=""> 430                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 431     @Override                                                                                            </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 432     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                         </span>
<span class="-1553234826628367049" onmouseenter="enter('-1553234826628367049');" onmouseout="out('-1553234826628367049');" style=""><abbr title=" 433     public GenericResponse resetPasswordUsingToken(String username, String token, String password, String confirmPassword) {"> 433     public GenericResponse resetPasswordUsingToken(String username, String token, String password, StringðŸ”µ</abbr></span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 434         GenericResponse response = new GenericResponse();                                                </span>
<span class="6921810928241781426" onmouseenter="enter('6921810928241781426');" onmouseout="out('6921810928241781426');" style=""> 435         Customer customer = null;                                                                        </span>
<span class="-8284276918575957483" onmouseenter="enter('-8284276918575957483');" onmouseout="out('-8284276918575957483');" style=""> 436         if (username != null) {                                                                          </span>
<span class="-104711026898859267" onmouseenter="enter('-104711026898859267');" onmouseout="out('-104711026898859267');" style=""> 437             customer = customerDao.readCustomerByUsername(username);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 438         }                                                                                                </span>
<span class="-3681439263985626916" onmouseenter="enter('-3681439263985626916');" onmouseout="out('-3681439263985626916');" style=""> 439         checkCustomer(customer, response);                                                               </span>
<span class="-3971600249312835278" onmouseenter="enter('-3971600249312835278');" onmouseout="out('-3971600249312835278');" style=""> 440         checkPassword(password, confirmPassword, response);                                              </span>
<span class="2411779224658140401" onmouseenter="enter('2411779224658140401');" onmouseout="out('2411779224658140401');" style=""> 441         CustomerForgotPasswordSecurityToken fpst = checkPasswordResetToken(token, customer, response);   </span>
<span  style=""> 442                                                                                                          </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 443         if (!response.getHasErrors()) {                                                                  </span>
<span class="485270787578743194" onmouseenter="enter('485270787578743194');" onmouseout="out('485270787578743194');" style=""> 444             if (!customer.getId().equals(fpst.getCustomerId())) {                                        </span>
<span class="-5994256316510103080" onmouseenter="enter('-5994256316510103080');" onmouseout="out('-5994256316510103080');" style=""> 445                 if (LOG.isWarnEnabled()) {                                                               </span>
<span class="-3030254613251423793" onmouseenter="enter('-3030254613251423793');" onmouseout="out('-3030254613251423793');" style=""><abbr title=" 446                     LOG.warn(&quot;Password reset attempt tried with mismatched customer and token &quot; + customer.getId() + &quot;, &quot; + StringUtil.sanitize(token));"> 446                     LOG.warn(&quot;Password reset attempt tried with mismatched customer and token &quot; + customeðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 447                 }                                                                                        </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style=""> 448                 response.addErrorCode(&quot;invalidToken&quot;);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 449             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 450         }                                                                                                </span>
<span  style=""> 451                                                                                                          </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 452         if (!response.getHasErrors()) {                                                                  </span>
<span class="5101903206908082309" onmouseenter="enter('5101903206908082309');" onmouseout="out('5101903206908082309');" style=""> 453             customer.setUnencodedPassword(password);                                                     </span>
<span class="6606672839011797247" onmouseenter="enter('6606672839011797247');" onmouseout="out('6606672839011797247');" style=""> 454             customer.setPasswordChangeRequired(false);                                                   </span>
<span class="3384492063942947657" onmouseenter="enter('3384492063942947657');" onmouseout="out('3384492063942947657');" style=""> 455             saveCustomer(customer);                                                                      </span>
<span class="-7517227353230604805" onmouseenter="enter('-7517227353230604805');" onmouseout="out('-7517227353230604805');" style=""> 456             invalidateAllTokensForCustomer(customer);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 457         }                                                                                                </span>
<span  style=""> 458                                                                                                          </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 459         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 460     }                                                                                                    </span>
<span  style=""> 461                                                                                                          </span>
<span class="2450635656385893269" onmouseenter="enter('2450635656385893269');" onmouseout="out('2450635656385893269');" style=""> 462     protected void invalidateAllTokensForCustomer(Customer customer) {                                   </span>
<span class="500146367959601607" onmouseenter="enter('500146367959601607');" onmouseout="out('500146367959601607');" style=""><abbr title=" 463         List&lt;CustomerForgotPasswordSecurityToken&gt; tokens = customerForgotPasswordSecurityTokenDao.readUnusedTokensByCustomerId(customer.getId());"> 463         List&lt;CustomerForgotPasswordSecurityToken&gt; tokens = customerForgotPasswordSecurityTokenDao.readUnuðŸ”µ</abbr></span>
<span class="34403017169246064" onmouseenter="enter('34403017169246064');" onmouseout="out('34403017169246064');" style=""> 464         for (CustomerForgotPasswordSecurityToken token : tokens) {                                       </span>
<span class="-3707452475519083600" onmouseenter="enter('-3707452475519083600');" onmouseout="out('-3707452475519083600');" style=""> 465             token.setTokenUsedFlag(true);                                                                </span>
<span class="-8670185777060395996" onmouseenter="enter('-8670185777060395996');" onmouseout="out('-8670185777060395996');" style=""> 466             customerForgotPasswordSecurityTokenDao.saveToken(token);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 467         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 468     }                                                                                                    </span>
<span  style=""> 469                                                                                                          </span>
<span class="3178004875725558699" onmouseenter="enter('3178004875725558699');" onmouseout="out('3178004875725558699');" style=""> 470     protected void checkCustomer(Customer customer, GenericResponse response) {                          </span>
<span class="-1371412200964570990" onmouseenter="enter('-1371412200964570990');" onmouseout="out('-1371412200964570990');" style=""> 471         if (customer == null) {                                                                          </span>
<span class="-397249380987924174" onmouseenter="enter('-397249380987924174');" onmouseout="out('-397249380987924174');" style=""> 472             response.addErrorCode(&quot;invalidCustomer&quot;);                                                    </span>
<span class="-1786182981140386352" onmouseenter="enter('-1786182981140386352');" onmouseout="out('-1786182981140386352');" style=""> 473         } else if (StringUtils.isBlank(customer.getEmailAddress())) {                                    </span>
<span class="3641519375839212970" onmouseenter="enter('3641519375839212970');" onmouseout="out('3641519375839212970');" style=""> 474             response.addErrorCode(&quot;emailNotFound&quot;);                                                      </span>
<span class="4935674502595460128" onmouseenter="enter('4935674502595460128');" onmouseout="out('4935674502595460128');" style=""> 475         } else if (customer.isDeactivated()) {                                                           </span>
<span class="5510537362121156528" onmouseenter="enter('5510537362121156528');" onmouseout="out('5510537362121156528');" style=""> 476             response.addErrorCode(&quot;inactiveUser&quot;);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 477         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 478     }                                                                                                    </span>
<span  style=""> 479                                                                                                          </span>
<span class="-3281949438797137351" onmouseenter="enter('-3281949438797137351');" onmouseout="out('-3281949438797137351');" style=""> 480     protected void checkPassword(String password, String confirmPassword, GenericResponse response) {    </span>
<span class="2256032458684464296" onmouseenter="enter('2256032458684464296');" onmouseout="out('2256032458684464296');" style=""> 481         if (StringUtils.isBlank(password) || StringUtils.isBlank(confirmPassword)) {                     </span>
<span class="5492480053199382271" onmouseenter="enter('5492480053199382271');" onmouseout="out('5492480053199382271');" style=""> 482             response.addErrorCode(&quot;invalidPassword&quot;);                                                    </span>
<span class="5837283644501577917" onmouseenter="enter('5837283644501577917');" onmouseout="out('5837283644501577917');" style=""> 483         } else if (!password.equals(confirmPassword)) {                                                  </span>
<span class="-5929993345093092025" onmouseenter="enter('-5929993345093092025');" onmouseout="out('-5929993345093092025');" style=""> 484             response.addErrorCode(&quot;passwordMismatch&quot;);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 486     }                                                                                                    </span>
<span  style=""> 487                                                                                                          </span>
<span class="2301745374477860963" onmouseenter="enter('2301745374477860963');" onmouseout="out('2301745374477860963');" style=""> 488     protected boolean isTokenExpired(CustomerForgotPasswordSecurityToken fpst) {                         </span>
<span class="7457175319484101734" onmouseenter="enter('7457175319484101734');" onmouseout="out('7457175319484101734');" style=""> 489         Date now = SystemTime.asDate();                                                                  </span>
<span class="4814679658448270347" onmouseenter="enter('4814679658448270347');" onmouseout="out('4814679658448270347');" style=""> 490         long currentTimeInMillis = now.getTime();                                                        </span>
<span class="2086457980523585614" onmouseenter="enter('2086457980523585614');" onmouseout="out('2086457980523585614');" style=""> 491         long tokenSaveTimeInMillis = fpst.getCreateDate().getTime();                                     </span>
<span class="6156534052742928347" onmouseenter="enter('6156534052742928347');" onmouseout="out('6156534052742928347');" style=""> 492         long minutesSinceSave = (currentTimeInMillis - tokenSaveTimeInMillis) / 60000;                   </span>
<span class="4808087245976426488" onmouseenter="enter('4808087245976426488');" onmouseout="out('4808087245976426488');" style=""> 493         return minutesSinceSave &gt; tokenExpiredMinutes;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494     }                                                                                                    </span>
<span  style=""> 495                                                                                                          </span>
<span class="-7890820258027638542" onmouseenter="enter('-7890820258027638542');" onmouseout="out('-7890820258027638542');" style=""> 496     public int getTokenExpiredMinutes() {                                                                </span>
<span class="-8144525086468905422" onmouseenter="enter('-8144525086468905422');" onmouseout="out('-8144525086468905422');" style=""> 497         return tokenExpiredMinutes;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498     }                                                                                                    </span>
<span  style=""> 499                                                                                                          </span>
<span class="-4089110355878340459" onmouseenter="enter('-4089110355878340459');" onmouseout="out('-4089110355878340459');" style=""> 500     public void setTokenExpiredMinutes(int tokenExpiredMinutes) {                                        </span>
<span class="-6197938813064605922" onmouseenter="enter('-6197938813064605922');" onmouseout="out('-6197938813064605922');" style=""> 501         this.tokenExpiredMinutes = tokenExpiredMinutes;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 502     }                                                                                                    </span>
<span  style=""> 503                                                                                                          </span>
<span class="-2211298406731211675" onmouseenter="enter('-2211298406731211675');" onmouseout="out('-2211298406731211675');" style=""> 504     public int getPasswordTokenLength() {                                                                </span>
<span class="-9052975427749106201" onmouseenter="enter('-9052975427749106201');" onmouseout="out('-9052975427749106201');" style=""> 505         return passwordTokenLength;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 506     }                                                                                                    </span>
<span  style=""> 507                                                                                                          </span>
<span class="4968817442646533856" onmouseenter="enter('4968817442646533856');" onmouseout="out('4968817442646533856');" style=""> 508     public void setPasswordTokenLength(int passwordTokenLength) {                                        </span>
<span class="-6372163195142109946" onmouseenter="enter('-6372163195142109946');" onmouseout="out('-6372163195142109946');" style=""> 509         this.passwordTokenLength = passwordTokenLength;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 510     }                                                                                                    </span>
<span  style=""> 511                                                                                                          </span>
<span  style=""> 512                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 513 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 514                                                                                                          </span>
<span class="-2426619698179732460" onmouseenter="enter('-2426619698179732460');" onmouseout="out('-2426619698179732460');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 515     public EmailInfo getForgotPasswordEmailInfo() {                                                      </span>
<span class="8553850930406344086" onmouseenter="enter('8553850930406344086');" onmouseout="out('8553850930406344086');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 516         return forgotPasswordEmailInfo;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 517     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 518                                                                                                          </span>
<span class="-5968004809391300230" onmouseenter="enter('-5968004809391300230');" onmouseout="out('-5968004809391300230');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 519     public void setForgotPasswordEmailInfo(EmailInfo forgotPasswordEmailInfo) {                          </span>
<span class="3510418398145123936" onmouseenter="enter('3510418398145123936');" onmouseout="out('3510418398145123936');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 520         this.forgotPasswordEmailInfo = forgotPasswordEmailInfo;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 521     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 522                                                                                                          </span>
<span class="7679605086459105581" onmouseenter="enter('7679605086459105581');" onmouseout="out('7679605086459105581');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 523     public EmailInfo getForgotUsernameEmailInfo() {                                                      </span>
<span class="-8928803675058205054" onmouseenter="enter('-8928803675058205054');" onmouseout="out('-8928803675058205054');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 524         return forgotUsernameEmailInfo;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 525     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 526                                                                                                          </span>
<span class="7097836574720204185" onmouseenter="enter('7097836574720204185');" onmouseout="out('7097836574720204185');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 527     public void setForgotUsernameEmailInfo(EmailInfo forgotUsernameEmailInfo) {                          </span>
<span class="-6675027655322416901" onmouseenter="enter('-6675027655322416901');" onmouseout="out('-6675027655322416901');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 528         this.forgotUsernameEmailInfo = forgotUsernameEmailInfo;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 529     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 530                                                                                                          </span>
<span class="5133340881216779756" onmouseenter="enter('5133340881216779756');" onmouseout="out('5133340881216779756');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 531     public EmailInfo getRegistrationEmailInfo() {                                                        </span>
<span class="-8178127994446042174" onmouseenter="enter('-8178127994446042174');" onmouseout="out('-8178127994446042174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 532         return registrationEmailInfo;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 533     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 534                                                                                                          </span>
<span class="-1271447752357505583" onmouseenter="enter('-1271447752357505583');" onmouseout="out('-1271447752357505583');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 535     public void setRegistrationEmailInfo(EmailInfo registrationEmailInfo) {                              </span>
<span class="-6232198529948124277" onmouseenter="enter('-6232198529948124277');" onmouseout="out('-6232198529948124277');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 536         this.registrationEmailInfo = registrationEmailInfo;                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 537     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 538                                                                                                          </span>
<span class="5129663219504237585" onmouseenter="enter('5129663219504237585');" onmouseout="out('5129663219504237585');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 539     public EmailInfo getChangePasswordEmailInfo() {                                                      </span>
<span class="-1635559517766867718" onmouseenter="enter('-1635559517766867718');" onmouseout="out('-1635559517766867718');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 540         return changePasswordEmailInfo;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 541     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 542                                                                                                          </span>
<span class="9037922117099126087" onmouseenter="enter('9037922117099126087');" onmouseout="out('9037922117099126087');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 543     public void setChangePasswordEmailInfo(EmailInfo changePasswordEmailInfo) {                          </span>
<span class="-7914138197132411471" onmouseenter="enter('-7914138197132411471');" onmouseout="out('-7914138197132411471');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 544         this.changePasswordEmailInfo = changePasswordEmailInfo;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 545     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 546                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 547 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 548 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 548 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 549 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 550                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 551                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 552 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span  style=""> 553                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 554     @Override                                                                                            </span>
<span class="2659754888592981645" onmouseenter="enter('2659754888592981645');" onmouseout="out('2659754888592981645');" style=""> 555     public List&lt;Customer&gt; readBatchCustomers(int start, int pageSize) {                                  </span>
<span class="-8143894692030732868" onmouseenter="enter('-8143894692030732868');" onmouseout="out('-8143894692030732868');" style=""> 556         return customerDao.readBatchCustomers(start, pageSize);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 557     }                                                                                                    </span>
<span  style=""> 558                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 559     @Override                                                                                            </span>
<span class="4634920297968325108" onmouseenter="enter('4634920297968325108');" onmouseout="out('4634920297968325108');" style=""> 560     public Long readNumberOfCustomers() {                                                                </span>
<span class="93124683563030725" onmouseenter="enter('93124683563030725');" onmouseout="out('93124683563030725');" style=""> 561         return customerDao.readNumberOfCustomers();                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 562     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 563 }                                                                                                        </span>



























































































































































































































































































































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="195929208389810495" onmouseenter="enter('195929208389810495');" onmouseout="out('195929208389810495');" style="">   3   * BroadleafCommerce Profile                                                                                      </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="5673174586140185880" onmouseenter="enter('5673174586140185880');" onmouseout="out('5673174586140185880');" style="">  18  package org.broadleafcommerce.profile.core.service;                                                               </span>
<span  style="">  19                                                                                                                    </span>
<span class="-3515056221608725115" onmouseenter="enter('-3515056221608725115');" onmouseout="out('-3515056221608725115');" style="">  20  import org.apache.commons.codec.binary.Hex;                                                                       </span>
<span class="-4900305655545834342" onmouseenter="enter('-4900305655545834342');" onmouseout="out('-4900305655545834342');" style="">  21  import org.apache.commons.collections4.CollectionUtils;                                                           </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  22  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  23  import org.apache.commons.logging.Log;                                                                            </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  24  import org.apache.commons.logging.LogFactory;                                                                     </span>

<span class="8150446407418055690" onmouseenter="enter('8150446407418055690');" onmouseout="out('8150446407418055690');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  25 -import org.broadleafcommerce.common.id.service.IdGenerationService;                                               </span>
<span class="-6657505372111281463" onmouseenter="enter('-6657505372111281463');" onmouseout="out('-6657505372111281463');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  26 -import org.broadleafcommerce.profile.core.dto.CustomerRuleHolder;                                                 </span>
<span class="9149575778472736151" onmouseenter="enter('9149575778472736151');" onmouseout="out('9149575778472736151');" style="">  27  import org.broadleafcommerce.common.email.service.EmailService;                                                   </span>
<span class="-6139442722863763787" onmouseenter="enter('-6139442722863763787');" onmouseout="out('-6139442722863763787');" style="">  28  import org.broadleafcommerce.common.email.service.info.EmailInfo;                                                 </span>
<span class="8150446407418055690" onmouseenter="enter('8150446407418055690');" onmouseout="out('8150446407418055690');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  29 +import org.broadleafcommerce.common.id.service.IdGenerationService;                                               </span>
<span class="8527520771739085493" onmouseenter="enter('8527520771739085493');" onmouseout="out('8527520771739085493');" style="">  30  import org.broadleafcommerce.common.rule.MvelHelper;                                                              </span>
<span class="-2635683203763841416" onmouseenter="enter('-2635683203763841416');" onmouseout="out('-2635683203763841416');" style="">  31  import org.broadleafcommerce.common.security.util.PasswordChange;                                                 </span>
<span class="5972522294326904672" onmouseenter="enter('5972522294326904672');" onmouseout="out('5972522294326904672');" style="">  32  import org.broadleafcommerce.common.security.util.PasswordReset;                                                  </span>
<span class="6413981270350028954" onmouseenter="enter('6413981270350028954');" onmouseout="out('6413981270350028954');" style="">  33  import org.broadleafcommerce.common.security.util.PasswordUtils;                                                  </span>
<span class="-3956591208111981988" onmouseenter="enter('-3956591208111981988');" onmouseout="out('-3956591208111981988');" style="">  34  import org.broadleafcommerce.common.service.GenericResponse;                                                      </span>
<span class="1373992879208813777" onmouseenter="enter('1373992879208813777');" onmouseout="out('1373992879208813777');" style="">  35  import org.broadleafcommerce.common.time.SystemTime;                                                              </span>
<span class="-3347161074136237116" onmouseenter="enter('-3347161074136237116');" onmouseout="out('-3347161074136237116');" style="">  36  import org.broadleafcommerce.common.util.StringUtil;                                                              </span>
<span class="5107697851223623564" onmouseenter="enter('5107697851223623564');" onmouseout="out('5107697851223623564');" style="">  37  import org.broadleafcommerce.common.util.TransactionUtils;                                                        </span>
<span class="5198631096841786518" onmouseenter="enter('5198631096841786518');" onmouseout="out('5198631096841786518');" style="">  38  import org.broadleafcommerce.profile.core.dao.CustomerDao;                                                        </span>
<span class="6035498420134781098" onmouseenter="enter('6035498420134781098');" onmouseout="out('6035498420134781098');" style="">  39  import org.broadleafcommerce.profile.core.dao.CustomerForgotPasswordSecurityTokenDao;                             </span>
<span class="-2668610663458012770" onmouseenter="enter('-2668610663458012770');" onmouseout="out('-2668610663458012770');" style="">  40  import org.broadleafcommerce.profile.core.dao.RoleDao;                                                            </span>
<span class="-6242194486783230477" onmouseenter="enter('-6242194486783230477');" onmouseout="out('-6242194486783230477');" style="">  41  import org.broadleafcommerce.profile.core.domain.Customer;                                                        </span>
<span class="7682914685467852548" onmouseenter="enter('7682914685467852548');" onmouseout="out('7682914685467852548');" style="">  42  import org.broadleafcommerce.profile.core.domain.CustomerForgotPasswordSecurityToken;                             </span>
<span class="-7325905376371760879" onmouseenter="enter('-7325905376371760879');" onmouseout="out('-7325905376371760879');" style="">  43  import org.broadleafcommerce.profile.core.domain.CustomerForgotPasswordSecurityTokenImpl;                         </span>
<span class="-7795206435247364271" onmouseenter="enter('-7795206435247364271');" onmouseout="out('-7795206435247364271');" style="">  44  import org.broadleafcommerce.profile.core.domain.CustomerRole;                                                    </span>
<span class="5359715183603948959" onmouseenter="enter('5359715183603948959');" onmouseout="out('5359715183603948959');" style="">  45  import org.broadleafcommerce.profile.core.domain.CustomerRoleImpl;                                                </span>
<span class="6271275544652071055" onmouseenter="enter('6271275544652071055');" onmouseout="out('6271275544652071055');" style="">  46  import org.broadleafcommerce.profile.core.domain.Role;                                                            </span>
<span class="-6657505372111281463" onmouseenter="enter('-6657505372111281463');" onmouseout="out('-6657505372111281463');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  47 +import org.broadleafcommerce.profile.core.dto.CustomerRuleHolder;                                                 </span>



<span class="1248060424968705063" onmouseenter="enter('1248060424968705063');" onmouseout="out('1248060424968705063');" style="">  48  import org.broadleafcommerce.profile.core.service.handler.PasswordUpdatedHandler;                                 </span>
<span class="-6753305615342929581" onmouseenter="enter('-6753305615342929581');" onmouseout="out('-6753305615342929581');" style="">  49  import org.broadleafcommerce.profile.core.service.listener.PostRegistrationObserver;                              </span>
<span class="4412650647810815777" onmouseenter="enter('4412650647810815777');" onmouseout="out('4412650647810815777');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  50 -import org.springframework.beans.factory.NoSuchBeanDefinitionException;                                           </span>
<span class="-6148326362900055524" onmouseenter="enter('-6148326362900055524');" onmouseout="out('-6148326362900055524');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  51 -import org.springframework.beans.factory.annotation.Autowired;                                                    </span>
<span class="-4664978283136443479" onmouseenter="enter('-4664978283136443479');" onmouseout="out('-4664978283136443479');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  52 -import org.springframework.beans.factory.annotation.Qualifier;                                                    </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  53  import org.springframework.beans.factory.annotation.Value;                                                        </span>
<span class="443255988526129671" onmouseenter="enter('443255988526129671');" onmouseout="out('443255988526129671');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  54 -import org.springframework.security.authentication.dao.SaltSource;                                                </span>
<span class="6507752321844884693" onmouseenter="enter('6507752321844884693');" onmouseout="out('6507752321844884693');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  55 -import org.springframework.security.core.GrantedAuthority;                                                        </span>
<span class="2075826732928208126" onmouseenter="enter('2075826732928208126');" onmouseout="out('2075826732928208126');" style="">  56  import org.springframework.security.crypto.password.PasswordEncoder;                                              </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  57  import org.springframework.stereotype.Service;                                                                    </span>
<span class="4419089678332371422" onmouseenter="enter('4419089678332371422');" onmouseout="out('4419089678332371422');" style="">  58  import org.springframework.transaction.annotation.Transactional;                                                  </span>
<span  style="">  59                                                                                                                    </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  60  import java.util.ArrayList;                                                                                       </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="">  61  import java.util.Date;                                                                                            </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  62  import java.util.HashMap;                                                                                         </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  63  import java.util.Iterator;                                                                                        </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  64  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  65  import java.util.Map;                                                                                             </span>
<span  style="">  66                                                                                                                    </span>
<span class="-1842700952879713169" onmouseenter="enter('-1842700952879713169');" onmouseout="out('-1842700952879713169');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  67 -import javax.annotation.PostConstruct;                                                                            </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  68  import javax.annotation.Resource;                                                                                 </span>
<span  style="">  69                                                                                                                    </span>
<span class="-3189571605039255438" onmouseenter="enter('-3189571605039255438');" onmouseout="out('-3189571605039255438');" style="">  70  @Service(&quot;blCustomerService&quot;)                                                                                     </span>
<span class="-4315786798209752789" onmouseenter="enter('-4315786798209752789');" onmouseout="out('-4315786798209752789');" style="">  71  public class CustomerServiceImpl implements CustomerService {                                                     </span>
<span class="-9223083925427668638" onmouseenter="enter('-9223083925427668638');" onmouseout="out('-9223083925427668638');" style="">  72      private static final Log LOG = LogFactory.getLog(CustomerServiceImpl.class);                                  </span>
<span class="-8423658991079621305" onmouseenter="enter('-8423658991079621305');" onmouseout="out('-8423658991079621305');" style="">  73      private static final int PASSWORD_LENGTH = 16;                                                                </span>
<span  style="">  74                                                                                                                    </span>
<span class="-4901656528466650106" onmouseenter="enter('-4901656528466650106');" onmouseout="out('-4901656528466650106');" style="">  75      @Resource(name = &quot;blCustomerDao&quot;)                                                                             </span>





<span class="8692367904333193309" onmouseenter="enter('8692367904333193309');" onmouseout="out('8692367904333193309');" style="">  76      protected CustomerDao customerDao;                                                                            </span>
<span  style="">  77                                                                                                                    </span>
<span class="3094900987137494064" onmouseenter="enter('3094900987137494064');" onmouseout="out('3094900987137494064');" style="">  78      @Resource(name = &quot;blIdGenerationService&quot;)                                                                     </span>
<span class="-7221277934130422196" onmouseenter="enter('-7221277934130422196');" onmouseout="out('-7221277934130422196');" style="">  79      protected IdGenerationService idGenerationService;                                                            </span>
<span  style="">  80                                                                                                                    </span>
<span class="2365488678467894280" onmouseenter="enter('2365488678467894280');" onmouseout="out('2365488678467894280');" style="">  81      @Resource(name = &quot;blCustomerForgotPasswordSecurityTokenDao&quot;)                                                  </span>
<span class="4716726216132170190" onmouseenter="enter('4716726216132170190');" onmouseout="out('4716726216132170190');" style="">  82      protected CustomerForgotPasswordSecurityTokenDao customerForgotPasswordSecurityTokenDao;                      </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  83 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  84 -    /**                                                                                                           </span>
<span class="-9011162707134809495" onmouseenter="enter('-9011162707134809495');" onmouseout="out('-9011162707134809495');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  85 -     * &lt;p&gt;Set by {@link #setupPasswordEncoder()} if the blPasswordEncoder bean provided is the deprecated version.</span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  86 -     *                                                                                                            </span>
<span class="2452173250496209218" onmouseenter="enter('2452173250496209218');" onmouseout="out('2452173250496209218');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  87 -     * @deprecated Spring Security has deprecated this encoder interface, this will be removed in 4.2             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  88 -     */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  89 -    @Deprecated                                                                                                   </span>
<span class="7564109825156072680" onmouseenter="enter('7564109825156072680');" onmouseout="out('7564109825156072680');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  90 -    protected org.springframework.security.authentication.encoding.PasswordEncoder passwordEncoder;               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  91 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  92 -    /**                                                                                                           </span>
<span class="-5116861287321393394" onmouseenter="enter('-5116861287321393394');" onmouseout="out('-5116861287321393394');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  93 -     * &lt;p&gt;Set by {@link #setupPasswordEncoder()} if the blPasswordEncoder bean provided is the new version.       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  94 -     */                                                                                                           </span>
<span class="1701368210273381595" onmouseenter="enter('1701368210273381595');" onmouseout="out('1701368210273381595');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  95 -    protected PasswordEncoder passwordEncoderNew;                                                                 </span>
<span  style="">  96                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  97      /**                                                                                                           </span>
<span class="6298544191369985956" onmouseenter="enter('6298544191369985956');" onmouseout="out('6298544191369985956');" style=""><abbr title="  98       * &lt;p&gt;This is simply a placeholder to be used by {@link #setupPasswordEncoder()} to determine if we&#x27;re using the">  98       * &lt;p&gt;This is simply a placeholder to be used by {@link #setupPasswordEncoder()} to determine if we&#x27;re using tðŸ”µ</abbr></span>
<span class="897245791379814301" onmouseenter="enter('897245791379814301');" onmouseout="out('897245791379814301');" style=""><abbr title="  99       * new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.authentication.encoding.PasswordEncoder PasswordEncoder}">  99       * new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.authentication.encoding.PðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 100       */                                                                                                           </span>
<span class="3863006184976437823" onmouseenter="enter('3863006184976437823');" onmouseout="out('3863006184976437823');" style=""> 101      @Resource(name = &quot;blPasswordEncoder&quot;)                                                                         </span>
<span class="6445807734700841407" onmouseenter="enter('6445807734700841407');" onmouseout="out('6445807734700841407');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 102 -    protected Object passwordEncoderBean;                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 103 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 104 -    /**                                                                                                           </span>
<span class="3279032571910866698" onmouseenter="enter('3279032571910866698');" onmouseout="out('3279032571910866698');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 105 -     * Optional password salt to be used with the passwordEncoder                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 106 -     *                                                                                                            </span>
<span class="-4822778269765077069" onmouseenter="enter('-4822778269765077069');" onmouseout="out('-4822778269765077069');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 107 -     * @deprecated utilize {@link #saltSource} instead so that it can be shared between this class as well as Spring&#x27;s"> 107 -     * @deprecated utilize {@link #saltSource} instead so that it can be shared between this class as well as SpriðŸ”µ</abbr></span>
<span class="-486494548782010565" onmouseenter="enter('-486494548782010565');" onmouseout="out('-486494548782010565');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 108 -     * authentication manager, this will be removed in 4.2                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 109 -     */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 110 -    @Deprecated                                                                                                   </span>
<span class="8995389235954487612" onmouseenter="enter('8995389235954487612');" onmouseout="out('8995389235954487612');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 111 -    protected String salt;                                                                                        </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 112 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 113 -    /**                                                                                                           </span>
<span class="7160577035329884491" onmouseenter="enter('7160577035329884491');" onmouseout="out('7160577035329884491');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 114 -     * Use a Salt Source ONLY if there&#x27;s one configured                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 115 -     *                                                                                                            </span>
<span class="-6749030359408285657" onmouseenter="enter('-6749030359408285657');" onmouseout="out('-6749030359408285657');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 116 -     * @deprecated the new {@link PasswordEncoder} handles salting internally, this will be removed in 4.2        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 117 -     */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 118 -    @Deprecated                                                                                                   </span>
<span class="2602789178515286342" onmouseenter="enter('2602789178515286342');" onmouseout="out('2602789178515286342');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 119 -    @Autowired(required = false)                                                                                  </span>
<span class="6407227478596567604" onmouseenter="enter('6407227478596567604');" onmouseout="out('6407227478596567604');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 120 -    @Qualifier(&quot;blSaltSource&quot;)                                                                                    </span>
<span class="-1458682478412193164" onmouseenter="enter('-1458682478412193164');" onmouseout="out('-1458682478412193164');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 121 -    protected SaltSource saltSource;                                                                              </span>
<span class="-2329929589298188398" onmouseenter="enter('-2329929589298188398');" onmouseout="out('-2329929589298188398');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +    protected PasswordEncoder passwordEncoderBean;                                                                </span>
<span  style=""> 123                                                                                                                    </span>
<span class="-5757933253912539407" onmouseenter="enter('-5757933253912539407');" onmouseout="out('-5757933253912539407');" style=""> 124      @Resource(name = &quot;blRoleDao&quot;)                                                                                 </span>
<span class="-2955407415487117626" onmouseenter="enter('-2955407415487117626');" onmouseout="out('-2955407415487117626');" style=""> 125      protected RoleDao roleDao;                                                                                    </span>
<span  style=""> 126                                                                                                                    </span>
<span class="7766343972197163364" onmouseenter="enter('7766343972197163364');" onmouseout="out('7766343972197163364');" style=""> 127      @Resource(name = &quot;blEmailService&quot;)                                                                            </span>
<span class="3549223300613749719" onmouseenter="enter('3549223300613749719');" onmouseout="out('3549223300613749719');" style=""> 128      protected EmailService emailService;                                                                          </span>
<span  style=""> 129                                                                                                                    </span>
<span class="2383771680597084829" onmouseenter="enter('2383771680597084829');" onmouseout="out('2383771680597084829');" style=""> 130      @Resource(name = &quot;blForgotPasswordEmailInfo&quot;)                                                                 </span>
<span class="-4862815721611251327" onmouseenter="enter('-4862815721611251327');" onmouseout="out('-4862815721611251327');" style=""> 131      protected EmailInfo forgotPasswordEmailInfo;                                                                  </span>
<span  style=""> 132                                                                                                                    </span>
<span class="-2019571563348114086" onmouseenter="enter('-2019571563348114086');" onmouseout="out('-2019571563348114086');" style=""> 133      @Resource(name = &quot;blForgotUsernameEmailInfo&quot;)                                                                 </span>
<span class="6306671580077013135" onmouseenter="enter('6306671580077013135');" onmouseout="out('6306671580077013135');" style=""> 134      protected EmailInfo forgotUsernameEmailInfo;                                                                  </span>
<span  style=""> 135                                                                                                                    </span>
<span class="-6401075622864476952" onmouseenter="enter('-6401075622864476952');" onmouseout="out('-6401075622864476952');" style=""> 136      @Resource(name = &quot;blRegistrationEmailInfo&quot;)                                                                   </span>
<span class="6263649015051340635" onmouseenter="enter('6263649015051340635');" onmouseout="out('6263649015051340635');" style=""> 137      protected EmailInfo registrationEmailInfo;                                                                    </span>
<span  style=""> 138                                                                                                                    </span>
<span class="-7074496001236985830" onmouseenter="enter('-7074496001236985830');" onmouseout="out('-7074496001236985830');" style=""> 139      @Resource(name = &quot;blChangePasswordEmailInfo&quot;)                                                                 </span>
<span class="-8238195063141687171" onmouseenter="enter('-8238195063141687171');" onmouseout="out('-8238195063141687171');" style=""> 140      protected EmailInfo changePasswordEmailInfo;                                                                  </span>
<span  style=""> 141                                                                                                                    </span>
<span class="453353925889912084" onmouseenter="enter('453353925889912084');" onmouseout="out('453353925889912084');" style=""> 142      protected int tokenExpiredMinutes = 30;                                                                       </span>
<span class="-1133336695006357373" onmouseenter="enter('-1133336695006357373');" onmouseout="out('-1133336695006357373');" style=""> 143      protected int passwordTokenLength = 20;                                                                       </span>
<span  style=""> 144                                                                                                                    </span>
<span class="-2653602182005192069" onmouseenter="enter('-2653602182005192069');" onmouseout="out('-2653602182005192069');" style=""><abbr title=" 145      protected final List&lt;PostRegistrationObserver&gt; postRegisterListeners = new ArrayList&lt;PostRegistrationObserver&gt;();"> 145      protected final List&lt;PostRegistrationObserver&gt; postRegisterListeners = new ArrayList&lt;PostRegistrationObserver&gt;ðŸ”µ</abbr></span>
<span class="6843669015915819090" onmouseenter="enter('6843669015915819090');" onmouseout="out('6843669015915819090');" style=""> 146      protected List&lt;PasswordUpdatedHandler&gt; passwordResetHandlers = new ArrayList&lt;PasswordUpdatedHandler&gt;();       </span>
<span class="-6685798853959138604" onmouseenter="enter('-6685798853959138604');" onmouseout="out('-6685798853959138604');" style=""> 147      protected List&lt;PasswordUpdatedHandler&gt; passwordChangedHandlers = new ArrayList&lt;PasswordUpdatedHandler&gt;();     </span>
<span  style=""> 148                                                                                                                    </span>
<span class="4044368105913417302" onmouseenter="enter('4044368105913417302');" onmouseout="out('4044368105913417302');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 149 -    //will be externalId field weaved to Customer entity or not                                                   </span>
<span class="-1791486485879189479" onmouseenter="enter('-1791486485879189479');" onmouseout="out('-1791486485879189479');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 150 -    @Value(&quot;${enable.weave.customer.externalId:false}&quot;)                                                           </span>
<span class="-1142421587851154233" onmouseenter="enter('-1142421587851154233');" onmouseout="out('-1142421587851154233');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 151 -    protected boolean enableCustomerExternalId = false;                                                           </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 152 -                                                                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 153 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 154 -    /**                                                                                                           </span>
<span class="-4407931552763383858" onmouseenter="enter('-4407931552763383858');" onmouseout="out('-4407931552763383858');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 155 -     * &lt;p&gt;Sets either {@link #passwordEncoder} or {@link #passwordEncoderNew} based on the type of {@link #passwordEncoderBean}"> 155 -     * &lt;p&gt;Sets either {@link #passwordEncoder} or {@link #passwordEncoderNew} based on the type of {@link #passworðŸ”µ</abbr></span>
<span class="-1649014883369305760" onmouseenter="enter('-1649014883369305760');" onmouseout="out('-1649014883369305760');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 156 -     * in order to provide bean configuration backwards compatibility with the deprecated {@link org.springframework.security.authentication.encoding.PasswordEncoder PasswordEncoder} bean."> 156 -     * in order to provide bean configuration backwards compatibility with the deprecated {@link org.springframewoðŸ”µ</abbr></span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 157 -     * &lt;p&gt;                                                                                                        </span>
<span class="2916517283478994056" onmouseenter="enter('2916517283478994056');" onmouseout="out('2916517283478994056');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 158 -     * &lt;p&gt;{@link #passwordEncoderBean} is set by the bean defined as &quot;blPasswordEncoder&quot; and can be changed with {@link #setPasswordEncoder(Object)}."> 158 -     * &lt;p&gt;{@link #passwordEncoderBean} is set by the bean defined as &quot;blPasswordEncoder&quot; and can be changed with {ðŸ”µ</abbr></span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 159 -     * &lt;p&gt;                                                                                                        </span>
<span class="5394505181252316608" onmouseenter="enter('5394505181252316608');" onmouseout="out('5394505181252316608');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 160 -     * &lt;p&gt;This class will utilize either the new or deprecated PasswordEncoder type depending on which is not null."> 160 -     * &lt;p&gt;This class will utilize either the new or deprecated PasswordEncoder type depending on which is not nullðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 161 -     *                                                                                                            </span>
<span class="6775226299117941025" onmouseenter="enter('6775226299117941025');" onmouseout="out('6775226299117941025');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 162 -     * @throws NoSuchBeanDefinitionException if {@link #passwordEncoderBean} is null or not an instance of either PasswordEncoder"> 162 -     * @throws NoSuchBeanDefinitionException if {@link #passwordEncoderBean} is null or not an instance of either ðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 163 -     */                                                                                                           </span>
<span class="-5680397040643859011" onmouseenter="enter('-5680397040643859011');" onmouseout="out('-5680397040643859011');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 164 -    @PostConstruct                                                                                                </span>
<span class="-9033819671974505465" onmouseenter="enter('-9033819671974505465');" onmouseout="out('-9033819671974505465');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 165 -    protected void setupPasswordEncoder() {                                                                       </span>
<span class="5660332138432044988" onmouseenter="enter('5660332138432044988');" onmouseout="out('5660332138432044988');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 166 -        passwordEncoderNew = null;                                                                                </span>
<span class="-655330175315724162" onmouseenter="enter('-655330175315724162');" onmouseout="out('-655330175315724162');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 167 -        passwordEncoder = null;                                                                                   </span>
<span class="-5456593704911205290" onmouseenter="enter('-5456593704911205290');" onmouseout="out('-5456593704911205290');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 168 -        if (passwordEncoderBean instanceof PasswordEncoder) {                                                     </span>
<span class="-3528230463178033621" onmouseenter="enter('-3528230463178033621');" onmouseout="out('-3528230463178033621');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 169 -            passwordEncoderNew = (PasswordEncoder) passwordEncoderBean;                                           </span>
<span class="4365730940590148824" onmouseenter="enter('4365730940590148824');" onmouseout="out('4365730940590148824');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 170 -        } else if (passwordEncoderBean instanceof org.springframework.security.authentication.encoding.PasswordEncoder) {"> 170 -        } else if (passwordEncoderBean instanceof org.springframework.security.authentication.encoding.PasswordEncðŸ”µ</abbr></span>
<span class="5435318175073096814" onmouseenter="enter('5435318175073096814');" onmouseout="out('5435318175073096814');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 171 -            passwordEncoder = (org.springframework.security.authentication.encoding.PasswordEncoder) passwordEncoderBean;"> 171 -            passwordEncoder = (org.springframework.security.authentication.encoding.PasswordEncoder) passwordEncodðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 172 -        } else {                                                                                                  </span>
<span class="-302697915557926133" onmouseenter="enter('-302697915557926133');" onmouseout="out('-302697915557926133');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 173 -            throw new NoSuchBeanDefinitionException(&quot;No PasswordEncoder bean is defined&quot;);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 174 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 175 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 176 -                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 177      @Override                                                                                                     </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 178      @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                                  </span>
<span class="8291295402928429592" onmouseenter="enter('8291295402928429592');" onmouseout="out('8291295402928429592');" style=""> 179      public Customer saveCustomer(Customer customer) {                                                             </span>
<span class="-4698478172885390647" onmouseenter="enter('-4698478172885390647');" onmouseout="out('-4698478172885390647');" style=""> 180          return saveCustomer(customer, customer.isRegistered());                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181      }                                                                                                             </span>
<span  style=""> 182                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 183      @Override                                                                                                     </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 184      @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                                  </span>
<span class="201381677109704887" onmouseenter="enter('201381677109704887');" onmouseout="out('201381677109704887');" style=""> 185      public Customer saveCustomer(Customer customer, boolean register) {                                           </span>
<span class="6726515726770360071" onmouseenter="enter('6726515726770360071');" onmouseout="out('6726515726770360071');" style=""> 186          if (register &amp;&amp; !customer.isRegistered()) {                                                               </span>
<span class="2527359489469298483" onmouseenter="enter('2527359489469298483');" onmouseout="out('2527359489469298483');" style=""> 187              customer.setRegistered(true);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188          }                                                                                                         </span>
<span  style=""> 189                                                                                                                    </span>
<span class="-2753421557322414072" onmouseenter="enter('-2753421557322414072');" onmouseout="out('-2753421557322414072');" style=""> 190          if (customer.getUnencodedPassword() != null) {                                                            </span>
<span class="7206521027030929296" onmouseenter="enter('7206521027030929296');" onmouseout="out('7206521027030929296');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 191 -            customer.setPassword(encodePassword(customer.getUnencodedPassword(), customer));                      </span>
<span class="-8026123664621306465" onmouseenter="enter('-8026123664621306465');" onmouseout="out('-8026123664621306465');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 192 +            customer.setPassword(encodePassword(customer.getUnencodedPassword()));                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193          }                                                                                                         </span>
<span  style=""> 194                                                                                                                    </span>
<span class="-1576073390989032571" onmouseenter="enter('-1576073390989032571');" onmouseout="out('-1576073390989032571');" style=""> 195          // let&#x27;s make sure they entered a new challenge answer (we will populate                                  </span>
<span class="-2819530999572063421" onmouseenter="enter('-2819530999572063421');" onmouseout="out('-2819530999572063421');" style=""> 196          // the password field with hashed values so check that they have changed                                  </span>
<span class="-9126181688236016532" onmouseenter="enter('-9126181688236016532');" onmouseout="out('-9126181688236016532');" style=""> 197          // id                                                                                                     </span>
<span class="-8509665365452883594" onmouseenter="enter('-8509665365452883594');" onmouseout="out('-8509665365452883594');" style=""><abbr title=" 198          if (customer.getUnencodedChallengeAnswer() != null &amp;&amp; !customer.getUnencodedChallengeAnswer().equals(customer.getChallengeAnswer())) {"> 198          if (customer.getUnencodedChallengeAnswer() != null &amp;&amp; !customer.getUnencodedChallengeAnswer().equals(custoðŸ”µ</abbr></span>
<span class="-4759540663853101916" onmouseenter="enter('-4759540663853101916');" onmouseout="out('-4759540663853101916');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 199 -            customer.setChallengeAnswer(encodePassword(customer.getUnencodedChallengeAnswer(), customer));        </span>
<span class="1806155368440017187" onmouseenter="enter('1806155368440017187');" onmouseout="out('1806155368440017187');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 200 +            customer.setChallengeAnswer(encodePassword(customer.getUnencodedChallengeAnswer()));                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201          }                                                                                                         </span>
<span class="3406416334930679557" onmouseenter="enter('3406416334930679557');" onmouseout="out('3406416334930679557');" style=""> 202          return customerDao.save(customer);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203      }                                                                                                             </span>
<span  style=""> 204                                                                                                                    </span>
<span class="-137997900411835717" onmouseenter="enter('-137997900411835717');" onmouseout="out('-137997900411835717');" style=""> 205      protected String generateSecurePassword() {                                                                   </span>
<span class="-4377176751133654653" onmouseenter="enter('-4377176751133654653');" onmouseout="out('-4377176751133654653');" style=""> 206          return PasswordUtils.generateSecurePassword(PASSWORD_LENGTH);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207      }                                                                                                             </span>
<span  style=""> 208                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 209      @Override                                                                                                     </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 210      @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                                  </span>
<span class="3910349330927871049" onmouseenter="enter('3910349330927871049');" onmouseout="out('3910349330927871049');" style=""> 211      public Customer registerCustomer(Customer customer, String password, String passwordConfirm) {                </span>
<span class="2527359489469298483" onmouseenter="enter('2527359489469298483');" onmouseout="out('2527359489469298483');" style=""> 212          customer.setRegistered(true);                                                                             </span>
<span  style=""> 213                                                                                                                    </span>
<span class="-5009800104120858890" onmouseenter="enter('-5009800104120858890');" onmouseout="out('-5009800104120858890');" style=""> 214          // When unencodedPassword is set the save() will encode it                                                </span>
<span class="5360015832768603745" onmouseenter="enter('5360015832768603745');" onmouseout="out('5360015832768603745');" style=""> 215          if (customer.getId() == null) {                                                                           </span>
<span class="-5488615021987588883" onmouseenter="enter('-5488615021987588883');" onmouseout="out('-5488615021987588883');" style=""> 216              customer.setId(findNextCustomerId());                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217          }                                                                                                         </span>
<span class="5101903206908082309" onmouseenter="enter('5101903206908082309');" onmouseout="out('5101903206908082309');" style=""> 218          customer.setUnencodedPassword(password);                                                                  </span>
<span class="-1307190252670550775" onmouseenter="enter('-1307190252670550775');" onmouseout="out('-1307190252670550775');" style=""> 219          Customer retCustomer = saveCustomer(customer);                                                            </span>
<span class="-7993851139681656451" onmouseenter="enter('-7993851139681656451');" onmouseout="out('-7993851139681656451');" style=""> 220          createRegisteredCustomerRoles(retCustomer);                                                               </span>
<span  style=""> 221                                                                                                                    </span>
<span class="8884608966566249698" onmouseenter="enter('8884608966566249698');" onmouseout="out('8884608966566249698');" style=""> 222          HashMap&lt;String, Object&gt; vars = new HashMap&lt;String, Object&gt;();                                             </span>
<span class="927525200984107152" onmouseenter="enter('927525200984107152');" onmouseout="out('927525200984107152');" style=""> 223          vars.put(&quot;customer&quot;, retCustomer);                                                                        </span>
<span  style=""> 224                                                                                                                    </span>
<span class="1359701208755121342" onmouseenter="enter('1359701208755121342');" onmouseout="out('1359701208755121342');" style=""> 225          sendEmail(customer.getEmailAddress(), getRegistrationEmailInfo(), vars);                                  </span>

<span class="-3623043072901839896" onmouseenter="enter('-3623043072901839896');" onmouseout="out('-3623043072901839896');" style=""> 226          notifyPostRegisterListeners(retCustomer);                                                                 </span>

<span class="-6683456484294032112" onmouseenter="enter('-6683456484294032112');" onmouseout="out('-6683456484294032112');" style=""> 227          return retCustomer;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228      }                                                                                                             </span>
<span  style=""> 229                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 230      @Override                                                                                                     </span>
<span class="-8989473089684210869" onmouseenter="enter('-8989473089684210869');" onmouseout="out('-8989473089684210869');" style=""> 231      public void createRegisteredCustomerRoles(Customer customer) {                                                </span>
<span class="-967668152739756369" onmouseenter="enter('-967668152739756369');" onmouseout="out('-967668152739756369');" style=""> 232          Role role = roleDao.readRoleByName(&quot;ROLE_USER&quot;);                                                          </span>
<span class="-7484208420944991016" onmouseenter="enter('-7484208420944991016');" onmouseout="out('-7484208420944991016');" style=""> 233          CustomerRole customerRole = new CustomerRoleImpl();                                                       </span>
<span class="-3544050209899951111" onmouseenter="enter('-3544050209899951111');" onmouseout="out('-3544050209899951111');" style=""> 234          customerRole.setRole(role);                                                                               </span>
<span class="-4836769794727897713" onmouseenter="enter('-4836769794727897713');" onmouseout="out('-4836769794727897713');" style=""> 235          customerRole.setCustomer(customer);                                                                       </span>
<span class="2561970876173710740" onmouseenter="enter('2561970876173710740');" onmouseout="out('2561970876173710740');" style=""> 236          roleDao.addRoleToCustomer(customerRole);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237      }                                                                                                             </span>
<span  style=""> 238                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 239      @Override                                                                                                     </span>
<span class="-8289498668946854999" onmouseenter="enter('-8289498668946854999');" onmouseout="out('-8289498668946854999');" style=""> 240      public Customer readCustomerByEmail(String emailAddress) {                                                    </span>
<span class="6996298339377860417" onmouseenter="enter('6996298339377860417');" onmouseout="out('6996298339377860417');" style=""> 241          return customerDao.readCustomerByEmail(emailAddress);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242      }                                                                                                             </span>
<span  style=""> 243                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 244      @Override                                                                                                     </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 245      @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                                  </span>
<span class="2373324961324130685" onmouseenter="enter('2373324961324130685');" onmouseout="out('2373324961324130685');" style=""> 246      public Customer changePassword(PasswordChange passwordChange) {                                               </span>
<span class="-5344336587939476831" onmouseenter="enter('-5344336587939476831');" onmouseout="out('-5344336587939476831');" style=""> 247          Customer customer = readCustomerByUsername(passwordChange.getUsername());                                 </span>
<span class="3635027652328433999" onmouseenter="enter('3635027652328433999');" onmouseout="out('3635027652328433999');" style=""> 248          customer.setUnencodedPassword(passwordChange.getNewPassword());                                           </span>
<span class="9175276796642533968" onmouseenter="enter('9175276796642533968');" onmouseout="out('9175276796642533968');" style=""> 249          customer.setPasswordChangeRequired(passwordChange.getPasswordChangeRequired());                           </span>
<span class="5791162324212808512" onmouseenter="enter('5791162324212808512');" onmouseout="out('5791162324212808512');" style=""> 250          customer = saveCustomer(customer);                                                                        </span>
<span  style=""> 251                                                                                                                    </span>
<span class="1758176125617219344" onmouseenter="enter('1758176125617219344');" onmouseout="out('1758176125617219344');" style=""> 252          for (PasswordUpdatedHandler handler : passwordChangedHandlers) {                                          </span>
<span class="-390754915565928691" onmouseenter="enter('-390754915565928691');" onmouseout="out('-390754915565928691');" style=""> 253              handler.passwordChanged(passwordChange, customer, passwordChange.getNewPassword());                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254          }                                                                                                         </span>
<span  style=""> 255                                                                                                                    </span>
<span class="-3853204766136593997" onmouseenter="enter('-3853204766136593997');" onmouseout="out('-3853204766136593997');" style=""> 256          return customer;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257      }                                                                                                             </span>
<span  style=""> 258                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 259      @Override                                                                                                     </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 260      @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                                  </span>
<span class="-8338050129523775592" onmouseenter="enter('-8338050129523775592');" onmouseout="out('-8338050129523775592');" style=""> 261      public Customer resetPassword(PasswordReset passwordReset) {                                                  </span>
<span class="6805273026067147007" onmouseenter="enter('6805273026067147007');" onmouseout="out('6805273026067147007');" style=""> 262          Customer customer = readCustomerByUsername(passwordReset.getUsername());                                  </span>
<span class="-122847483108952780" onmouseenter="enter('-122847483108952780');" onmouseout="out('-122847483108952780');" style=""> 263          String newPassword = PasswordUtils.generateSecurePassword(passwordReset.getPasswordLength());             </span>
<span class="-62325817623586886" onmouseenter="enter('-62325817623586886');" onmouseout="out('-62325817623586886');" style=""> 264          customer.setUnencodedPassword(newPassword);                                                               </span>
<span class="6853349384480559800" onmouseenter="enter('6853349384480559800');" onmouseout="out('6853349384480559800');" style=""> 265          customer.setPasswordChangeRequired(passwordReset.getPasswordChangeRequired());                            </span>
<span class="5791162324212808512" onmouseenter="enter('5791162324212808512');" onmouseout="out('5791162324212808512');" style=""> 266          customer = saveCustomer(customer);                                                                        </span>
<span  style=""> 267                                                                                                                    </span>
<span class="265370277489880531" onmouseenter="enter('265370277489880531');" onmouseout="out('265370277489880531');" style=""> 268          for (PasswordUpdatedHandler handler : passwordResetHandlers) {                                            </span>
<span class="8731392908076423696" onmouseenter="enter('8731392908076423696');" onmouseout="out('8731392908076423696');" style=""> 269              handler.passwordChanged(passwordReset, customer, newPassword);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 270          }                                                                                                         </span>
<span  style=""> 271                                                                                                                    </span>
<span class="-3853204766136593997" onmouseenter="enter('-3853204766136593997');" onmouseout="out('-3853204766136593997');" style=""> 272          return customer;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273      }                                                                                                             </span>
<span  style=""> 274                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 275      @Override                                                                                                     </span>
<span class="-2286441478570387081" onmouseenter="enter('-2286441478570387081');" onmouseout="out('-2286441478570387081');" style=""> 276      public void addPostRegisterListener(PostRegistrationObserver postRegisterListeners) {                         </span>
<span class="2003689350872197572" onmouseenter="enter('2003689350872197572');" onmouseout="out('2003689350872197572');" style=""> 277          this.postRegisterListeners.add(postRegisterListeners);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278      }                                                                                                             </span>
<span  style=""> 279                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 280      @Override                                                                                                     </span>
<span class="-1507687767132611253" onmouseenter="enter('-1507687767132611253');" onmouseout="out('-1507687767132611253');" style=""> 281      public void removePostRegisterListener(PostRegistrationObserver postRegisterListeners) {                      </span>
<span class="8851186764245103017" onmouseenter="enter('8851186764245103017');" onmouseout="out('8851186764245103017');" style=""> 282          if (this.postRegisterListeners.contains(postRegisterListeners)) {                                         </span>
<span class="7168411145839318905" onmouseenter="enter('7168411145839318905');" onmouseout="out('7168411145839318905');" style=""> 283              this.postRegisterListeners.remove(postRegisterListeners);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285      }                                                                                                             </span>
<span  style=""> 286                                                                                                                    </span>
<span class="3762831862655692775" onmouseenter="enter('3762831862655692775');" onmouseout="out('3762831862655692775');" style=""> 287      protected void notifyPostRegisterListeners(Customer customer) {                                               </span>
<span class="-5517241395960310234" onmouseenter="enter('-5517241395960310234');" onmouseout="out('-5517241395960310234');" style=""> 288          for (Iterator&lt;PostRegistrationObserver&gt; iter = postRegisterListeners.iterator(); iter.hasNext(); ) {      </span>
<span class="6852498861939683938" onmouseenter="enter('6852498861939683938');" onmouseout="out('6852498861939683938');" style=""> 289              PostRegistrationObserver listener = iter.next();                                                      </span>
<span class="2537062439441145073" onmouseenter="enter('2537062439441145073');" onmouseout="out('2537062439441145073');" style=""> 290              listener.processRegistrationEvent(customer);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292      }                                                                                                             </span>
<span  style=""> 293                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 294      @Override                                                                                                     </span>
<span class="-6715127601332863552" onmouseenter="enter('-6715127601332863552');" onmouseout="out('-6715127601332863552');" style=""> 295      public Customer createCustomer() {                                                                            </span>
<span class="1533232953867480113" onmouseenter="enter('1533232953867480113');" onmouseout="out('1533232953867480113');" style=""> 296          return createCustomerFromId(null);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297      }                                                                                                             </span>
<span  style=""> 298                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 299      @Override                                                                                                     </span>
<span class="-3260175922123749747" onmouseenter="enter('-3260175922123749747');" onmouseout="out('-3260175922123749747');" style=""> 300      public Customer createCustomerFromId(Long customerId) {                                                       </span>
<span class="4846947630103792555" onmouseenter="enter('4846947630103792555');" onmouseout="out('4846947630103792555');" style=""> 301          Customer customer = customerId != null ? readCustomerById(customerId) : null;                             </span>
<span class="-1371412200964570990" onmouseenter="enter('-1371412200964570990');" onmouseout="out('-1371412200964570990');" style=""> 302          if (customer == null) {                                                                                   </span>
<span class="7584512027447697158" onmouseenter="enter('7584512027447697158');" onmouseout="out('7584512027447697158');" style=""> 303              customer = customerDao.create();                                                                      </span>
<span class="-8452861246579893242" onmouseenter="enter('-8452861246579893242');" onmouseout="out('-8452861246579893242');" style=""> 304              if (customerId != null) {                                                                             </span>
<span class="1431826176080351208" onmouseenter="enter('1431826176080351208');" onmouseout="out('1431826176080351208');" style=""> 305                  customer.setId(customerId);                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 306              } else {                                                                                              </span>
<span class="-5488615021987588883" onmouseenter="enter('-5488615021987588883');" onmouseout="out('-5488615021987588883');" style=""> 307                  customer.setId(findNextCustomerId());                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309          }                                                                                                         </span>
<span class="-3853204766136593997" onmouseenter="enter('-3853204766136593997');" onmouseout="out('-3853204766136593997');" style=""> 310          return customer;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311      }                                                                                                             </span>
<span  style=""> 312                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 313      @Override                                                                                                     </span>
<span class="4598906423026393934" onmouseenter="enter('4598906423026393934');" onmouseout="out('4598906423026393934');" style=""> 314      public Long findNextCustomerId() {                                                                            </span>
<span class="-8819565094085247576" onmouseenter="enter('-8819565094085247576');" onmouseout="out('-8819565094085247576');" style=""> 315          return idGenerationService.findNextId(Customer.class.getCanonicalName());                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316      }                                                                                                             </span>
<span  style=""> 317                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 318      @Override                                                                                                     </span>
<span class="-6999511709583967120" onmouseenter="enter('-6999511709583967120');" onmouseout="out('-6999511709583967120');" style=""> 319      public Customer createNewCustomer() {                                                                         </span>
<span class="1533232953867480113" onmouseenter="enter('1533232953867480113');" onmouseout="out('1533232953867480113');" style=""> 320          return createCustomerFromId(null);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321      }                                                                                                             </span>
<span  style=""> 322                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 323      @Override                                                                                                     </span>
<span class="7417643297497909843" onmouseenter="enter('7417643297497909843');" onmouseout="out('7417643297497909843');" style=""> 324      public void deleteCustomer(Customer customer) {                                                               </span>
<span class="-3138548839038622796" onmouseenter="enter('-3138548839038622796');" onmouseout="out('-3138548839038622796');" style=""> 325          roleDao.removeCustomerRolesByCustomerId(customer.getId());                                                </span>
<span class="-3819399187793284937" onmouseenter="enter('-3819399187793284937');" onmouseout="out('-3819399187793284937');" style=""> 326          customerDao.delete(customer);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327      }                                                                                                             </span>
<span  style=""> 328                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 329      @Override                                                                                                     </span>
<span class="-5885291655878307572" onmouseenter="enter('-5885291655878307572');" onmouseout="out('-5885291655878307572');" style=""> 330      public Customer readCustomerByUsername(String username) {                                                     </span>
<span class="589313108944980188" onmouseenter="enter('589313108944980188');" onmouseout="out('589313108944980188');" style=""> 331          return customerDao.readCustomerByUsername(username);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332      }                                                                                                             </span>
<span  style=""> 333                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 334      @Override                                                                                                     </span>
<span class="847254476985500634" onmouseenter="enter('847254476985500634');" onmouseout="out('847254476985500634');" style=""> 335      public Customer readCustomerByUsername(String username, Boolean cacheable) {                                  </span>
<span class="482041631891506127" onmouseenter="enter('482041631891506127');" onmouseout="out('482041631891506127');" style=""> 336          return customerDao.readCustomerByUsername(username, cacheable);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337      }                                                                                                             </span>
<span  style=""> 338                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 339      @Override                                                                                                     </span>
<span class="-4374586036231570864" onmouseenter="enter('-4374586036231570864');" onmouseout="out('-4374586036231570864');" style=""> 340      public Customer readCustomerById(Long id) {                                                                   </span>
<span class="-5062162633750648527" onmouseenter="enter('-5062162633750648527');" onmouseout="out('-5062162633750648527');" style=""> 341          return customerDao.readCustomerById(id);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342      }                                                                                                             </span>
<span  style=""> 343                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 344      @Override                                                                                                     </span>
<span class="6825989998352983316" onmouseenter="enter('6825989998352983316');" onmouseout="out('6825989998352983316');" style=""> 345      public Customer readCustomerByExternalId(String userExternalId) {                                             </span>
<span class="-3340978842460957300" onmouseenter="enter('-3340978842460957300');" onmouseout="out('-3340978842460957300');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 346 -        if (enableCustomerExternalId) {                                                                           </span>
<span class="5025115365525563343" onmouseenter="enter('5025115365525563343');" onmouseout="out('5025115365525563343');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 347 -            return customerDao.readCustomerByExternalId(userExternalId);                                          </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 348 -        }else{                                                                                                    </span>
<span class="7148337299926873627" onmouseenter="enter('7148337299926873627');" onmouseout="out('7148337299926873627');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 349 -            LOG.error(&quot;attempt to find customer by externalId while property enable.weave.customer.externalId is false. Import module is responsible for weaving externalId field to customer&quot;);"> 349 -            LOG.error(&quot;attempt to find customer by externalId while property enable.weave.customer.externalId is fðŸ”µ</abbr></span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 350 -            return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 351 -        }                                                                                                         </span>
<span class="5025115365525563343" onmouseenter="enter('5025115365525563343');" onmouseout="out('5025115365525563343');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 352 +        return customerDao.readCustomerByExternalId(userExternalId);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353      }                                                                                                             </span>
<span  style=""> 354                                                                                                                    </span>
<span class="-8304645560568857694" onmouseenter="enter('-8304645560568857694');" onmouseout="out('-8304645560568857694');" style=""> 355      public void setCustomerDao(CustomerDao customerDao) {                                                         </span>
<span class="-1477678724397974795" onmouseenter="enter('-1477678724397974795');" onmouseout="out('-1477678724397974795');" style=""> 356          this.customerDao = customerDao;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357      }                                                                                                             </span>
<span  style=""> 358                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 359 -    /**                                                                                                           </span>
<span class="5030104489111136142" onmouseenter="enter('5030104489111136142');" onmouseout="out('5030104489111136142');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 360 -     * &lt;p&gt;Set the passwordEncoder to be used by this class.                                                       </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 361 -     * &lt;p&gt;                                                                                                        </span>
<span class="-5531556154513737333" onmouseenter="enter('-5531556154513737333');" onmouseout="out('-5531556154513737333');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 362 -     * &lt;p&gt;This method will indirectly set one of the two PasswordEncoder member variables, depending on its type  </span>
<span class="2131779599869858629" onmouseenter="enter('2131779599869858629');" onmouseout="out('2131779599869858629');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 363 -     * by calling {@link #setupPasswordEncoder()}                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 364 -     *                                                                                                            </span>
<span class="5471445359553795451" onmouseenter="enter('5471445359553795451');" onmouseout="out('5471445359553795451');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 365 -     * @param passwordEncoder Either Spring Security&#x27;s new {@link PasswordEncoder}, or the deprecated {@link org.springframework.security.authentication.encoding.PasswordEncoder PasswordEncoder}"> 365 -     * @param passwordEncoder Either Spring Security&#x27;s new {@link PasswordEncoder}, or the deprecated {@link org.sðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 366 -     */                                                                                                           </span>
<span class="5510978142694982881" onmouseenter="enter('5510978142694982881');" onmouseout="out('5510978142694982881');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 367 -    public void setPasswordEncoder(Object passwordEncoder) {                                                      </span>
<span class="-1060974872196977525" onmouseenter="enter('-1060974872196977525');" onmouseout="out('-1060974872196977525');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 368 -        this.passwordEncoderBean = passwordEncoder;                                                               </span>
<span class="7284584147086462796" onmouseenter="enter('7284584147086462796');" onmouseout="out('7284584147086462796');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 369 -        setupPasswordEncoder();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 370 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 371 -                                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 372 -    @Deprecated                                                                                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 373 -    @Override                                                                                                     </span>
<span class="-1320715505240530691" onmouseenter="enter('-1320715505240530691');" onmouseout="out('-1320715505240530691');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 374 -    public Object getSalt(Customer customer) {                                                                    </span>
<span class="7310613093023919346" onmouseenter="enter('7310613093023919346');" onmouseout="out('7310613093023919346');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 375 -        return getSalt(customer, &quot;&quot;);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 376 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 377 -                                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 378 -    @Deprecated                                                                                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 379 -    @Override                                                                                                     </span>
<span class="-1353881738494162545" onmouseenter="enter('-1353881738494162545');" onmouseout="out('-1353881738494162545');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 380 -    public Object getSalt(Customer customer, String unencodedPassword) {                                          </span>
<span class="-7916743778127639214" onmouseenter="enter('-7916743778127639214');" onmouseout="out('-7916743778127639214');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 381 -        Object salt = null;                                                                                       </span>
<span class="-476224562332695723" onmouseenter="enter('-476224562332695723');" onmouseout="out('-476224562332695723');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 382 -        if (saltSource != null &amp;&amp; customer != null) {                                                             </span>
<span class="-5717209493067542388" onmouseenter="enter('-5717209493067542388');" onmouseout="out('-5717209493067542388');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 383 -            salt = saltSource.getSalt(new CustomerUserDetails(customer.getId(), customer.getUsername(), unencodedPassword, new ArrayList&lt;GrantedAuthority&gt;()));"> 383 -            salt = saltSource.getSalt(new CustomerUserDetails(customer.getId(), customer.getUsername(), unencodedPðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 384 -        }                                                                                                         </span>
<span class="3431775854604648548" onmouseenter="enter('3431775854604648548');" onmouseout="out('3431775854604648548');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 385 -        return salt;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 386 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 387 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 388 -    /**                                                                                                           </span>
<span class="-3501183731792941420" onmouseenter="enter('-3501183731792941420');" onmouseout="out('-3501183731792941420');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 389 -     * Delegates to either the new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.authentication.encoding.PasswordEncoder PasswordEncoder}."> 389 -     * Delegates to either the new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.aðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 390 -     *                                                                                                            </span>
<span class="-6973500330076487399" onmouseenter="enter('-6973500330076487399');" onmouseout="out('-6973500330076487399');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 391 -     * @param rawPassword the unencoded password                                                                  </span>
<span class="-5399617810406361465" onmouseenter="enter('-5399617810406361465');" onmouseout="out('-5399617810406361465');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 392 -     * @param salt        the optional salt                                                                       </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 393 -     * @return                                                                                                    </span>
<span class="3447978539938514357" onmouseenter="enter('3447978539938514357');" onmouseout="out('3447978539938514357');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 394 -     * @deprecated the new {@link org.springframework.security.crypto.password.PasswordEncoder PasswordEncoder} handles salting internally, this will be removed in 4.2"> 394 -     * @deprecated the new {@link org.springframework.security.crypto.password.PasswordEncoder PasswordEncoder} haðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 395 -     */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 396 -    @Deprecated                                                                                                   </span>
<span class="-5592137063291194297" onmouseenter="enter('-5592137063291194297');" onmouseout="out('-5592137063291194297');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 397 -    protected String encodePass(String rawPassword, Object salt) {                                                </span>
<span class="-7232422938046234962" onmouseenter="enter('-7232422938046234962');" onmouseout="out('-7232422938046234962');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 398 -        if (usingDeprecatedPasswordEncoder()) {                                                                   </span>
<span class="5931714538865276294" onmouseenter="enter('5931714538865276294');" onmouseout="out('5931714538865276294');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 399 -            return passwordEncoder.encodePassword(rawPassword, salt);                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 400 -        } else {                                                                                                  </span>
<span class="-7923712831729422017" onmouseenter="enter('-7923712831729422017');" onmouseout="out('-7923712831729422017');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 401 -            return encodePassword(rawPassword);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 402 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 403 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 404 -                                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 405 -    @Deprecated                                                                                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 406 -    @Override                                                                                                     </span>
<span class="-2464018960647785128" onmouseenter="enter('-2464018960647785128');" onmouseout="out('-2464018960647785128');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 407 -    public String encodePassword(String rawPassword, Customer customer) {                                         </span>
<span class="5068564850157074346" onmouseenter="enter('5068564850157074346');" onmouseout="out('5068564850157074346');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 408 -        return encodePass(rawPassword, getSalt(customer, rawPassword));                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 409 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 410 -                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 411      @Override                                                                                                     </span>
<span class="-280180772892908532" onmouseenter="enter('-280180772892908532');" onmouseout="out('-280180772892908532');" style=""> 412      public String encodePassword(String rawPassword) {                                                            </span>
<span class="-8081074490464189240" onmouseenter="enter('-8081074490464189240');" onmouseout="out('-8081074490464189240');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 413 -        return passwordEncoderNew.encode(rawPassword);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 414 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 415 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 416 -    /**                                                                                                           </span>
<span class="-3501183731792941420" onmouseenter="enter('-3501183731792941420');" onmouseout="out('-3501183731792941420');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 417 -     * Delegates to either the new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.authentication.encoding.PasswordEncoder PasswordEncoder}."> 417 -     * Delegates to either the new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.aðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 418 -     *                                                                                                            </span>
<span class="8775114664172586259" onmouseenter="enter('8775114664172586259');" onmouseout="out('8775114664172586259');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 419 -     * @param rawPassword     the unencoded password                                                              </span>
<span class="-1452544259905793680" onmouseenter="enter('-1452544259905793680');" onmouseout="out('-1452544259905793680');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 420 -     * @param encodedPassword the encoded password to compare rawPassword against                                 </span>
<span class="1972573824148461217" onmouseenter="enter('1972573824148461217');" onmouseout="out('1972573824148461217');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 421 -     * @param salt            the optional salt                                                                   </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 422 -     * @return                                                                                                    </span>
<span class="3447978539938514357" onmouseenter="enter('3447978539938514357');" onmouseout="out('3447978539938514357');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 423 -     * @deprecated the new {@link org.springframework.security.crypto.password.PasswordEncoder PasswordEncoder} handles salting internally, this will be removed in 4.2"> 423 -     * @deprecated the new {@link org.springframework.security.crypto.password.PasswordEncoder PasswordEncoder} haðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 424 -     */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 425 -    @Deprecated                                                                                                   </span>
<span class="-5399582875183324381" onmouseenter="enter('-5399582875183324381');" onmouseout="out('-5399582875183324381');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 426 -    protected boolean isPassValid(String rawPassword, String encodedPassword, Object salt) {                      </span>
<span class="-7232422938046234962" onmouseenter="enter('-7232422938046234962');" onmouseout="out('-7232422938046234962');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 427 -        if (usingDeprecatedPasswordEncoder()) {                                                                   </span>
<span class="-6959686797048566137" onmouseenter="enter('-6959686797048566137');" onmouseout="out('-6959686797048566137');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 428 -            return passwordEncoder.isPasswordValid(encodedPassword, rawPassword, salt);                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 429 -        } else {                                                                                                  </span>
<span class="-3664185127944007144" onmouseenter="enter('-3664185127944007144');" onmouseout="out('-3664185127944007144');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 430 -            return isPasswordValid(rawPassword, encodedPassword);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 431 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 432 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 433 -                                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 434 -    @Deprecated                                                                                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 435 -    @Override                                                                                                     </span>
<span class="75379594801568475" onmouseenter="enter('75379594801568475');" onmouseout="out('75379594801568475');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 436 -    public boolean isPasswordValid(String rawPassword, String encodedPassword, Customer customer) {               </span>
<span class="5055494700324745600" onmouseenter="enter('5055494700324745600');" onmouseout="out('5055494700324745600');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 437 -        return isPassValid(rawPassword, encodedPassword, getSalt(customer, rawPassword));                         </span>
<span class="-3121342566836529697" onmouseenter="enter('-3121342566836529697');" onmouseout="out('-3121342566836529697');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 438 +        return passwordEncoderBean.encode(rawPassword);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 439      }                                                                                                             </span>
<span  style=""> 440                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 441      @Override                                                                                                     </span>
<span class="160568672931299235" onmouseenter="enter('160568672931299235');" onmouseout="out('160568672931299235');" style=""> 442      public boolean isPasswordValid(String rawPassword, String encodedPassword) {                                  </span>
<span class="-3105924845719344527" onmouseenter="enter('-3105924845719344527');" onmouseout="out('-3105924845719344527');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 443 -        return passwordEncoderNew.matches(rawPassword, encodedPassword);                                          </span>
<span class="5053852377821437125" onmouseenter="enter('5053852377821437125');" onmouseout="out('5053852377821437125');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 444 +        return passwordEncoderBean.matches(rawPassword, encodedPassword);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 445      }                                                                                                             </span>
<span  style=""> 446                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 447      @Override                                                                                                     </span>
<span class="8805988825869661234" onmouseenter="enter('8805988825869661234');" onmouseout="out('8805988825869661234');" style=""> 448      public boolean customerPassesCustomerRule(Customer customer, CustomerRuleHolder customerRuleHolder) {         </span>
<span class="-5898565890799276609" onmouseenter="enter('-5898565890799276609');" onmouseout="out('-5898565890799276609');" style=""> 449          String customerRule = customerRuleHolder.getCustomerRule();                                               </span>
<span class="201656563419603782" onmouseenter="enter('201656563419603782');" onmouseout="out('201656563419603782');" style=""> 450          Map&lt;String, Object&gt; ruleParams = buildCustomerRuleParams(customer);                                       </span>
<span class="-7214228236632333169" onmouseenter="enter('-7214228236632333169');" onmouseout="out('-7214228236632333169');" style=""> 451          return customerRule == null || MvelHelper.evaluateRule(customerRule, ruleParams);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 452      }                                                                                                             </span>
<span  style=""> 453                                                                                                                    </span>
<span class="-6781673542839603116" onmouseenter="enter('-6781673542839603116');" onmouseout="out('-6781673542839603116');" style=""> 454      protected Map&lt;String, Object&gt; buildCustomerRuleParams(Customer customer) {                                    </span>
<span class="-460782809524910092" onmouseenter="enter('-460782809524910092');" onmouseout="out('-460782809524910092');" style=""> 455          HashMap&lt;String, Object&gt; vars = new HashMap&lt;&gt;();                                                           </span>
<span class="8047728915418269458" onmouseenter="enter('8047728915418269458');" onmouseout="out('8047728915418269458');" style=""> 456          vars.put(&quot;customer&quot;, customer);                                                                           </span>
<span class="3198457421051297297" onmouseenter="enter('3198457421051297297');" onmouseout="out('3198457421051297297');" style=""> 457          return vars;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 458 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 459 -                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 460 -    @Override                                                                                                     </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 461 -    @Deprecated                                                                                                   </span>
<span class="5378385800373988521" onmouseenter="enter('5378385800373988521');" onmouseout="out('5378385800373988521');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 462 -    public String getSalt() {                                                                                     </span>
<span class="3431775854604648548" onmouseenter="enter('3431775854604648548');" onmouseout="out('3431775854604648548');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 463 -        return salt;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 464 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 465 -                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 466 -    @Override                                                                                                     </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 467 -    @Deprecated                                                                                                   </span>
<span class="-4361425533599957857" onmouseenter="enter('-4361425533599957857');" onmouseout="out('-4361425533599957857');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 468 -    public void setSalt(String salt) {                                                                            </span>
<span class="-4513734365927734086" onmouseenter="enter('-4513734365927734086');" onmouseout="out('-4513734365927734086');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 469 -        this.salt = salt;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 470 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 471 -                                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 472 -    @Deprecated                                                                                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 473 -    @Override                                                                                                     </span>
<span class="-7604283301279549906" onmouseenter="enter('-7604283301279549906');" onmouseout="out('-7604283301279549906');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 474 -    public SaltSource getSaltSource() {                                                                           </span>
<span class="-904082433474924859" onmouseenter="enter('-904082433474924859');" onmouseout="out('-904082433474924859');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 475 -        return saltSource;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 476 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 477 -                                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 478 -    @Deprecated                                                                                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 479 -    @Override                                                                                                     </span>
<span class="4344683956985852323" onmouseenter="enter('4344683956985852323');" onmouseout="out('4344683956985852323');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 480 -    public void setSaltSource(SaltSource saltSource) {                                                            </span>
<span class="-2983665589785658662" onmouseenter="enter('-2983665589785658662');" onmouseout="out('-2983665589785658662');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 481 -        this.saltSource = saltSource;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 482      }                                                                                                             </span>
<span  style=""> 483                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 484      @Override                                                                                                     </span>
<span class="-3888321916193976828" onmouseenter="enter('-3888321916193976828');" onmouseout="out('-3888321916193976828');" style=""> 485      public List&lt;PasswordUpdatedHandler&gt; getPasswordResetHandlers() {                                              </span>
<span class="6051450225877623454" onmouseenter="enter('6051450225877623454');" onmouseout="out('6051450225877623454');" style=""> 486          return passwordResetHandlers;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 487      }                                                                                                             </span>
<span  style=""> 488                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 489      @Override                                                                                                     </span>
<span class="-8491421284615626461" onmouseenter="enter('-8491421284615626461');" onmouseout="out('-8491421284615626461');" style=""> 490      public void setPasswordResetHandlers(List&lt;PasswordUpdatedHandler&gt; passwordResetHandlers) {                    </span>
<span class="-414209021704348335" onmouseenter="enter('-414209021704348335');" onmouseout="out('-414209021704348335');" style=""> 491          this.passwordResetHandlers = passwordResetHandlers;                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492      }                                                                                                             </span>
<span  style=""> 493                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 494      @Override                                                                                                     </span>
<span class="6470870522961056065" onmouseenter="enter('6470870522961056065');" onmouseout="out('6470870522961056065');" style=""> 495      public List&lt;PasswordUpdatedHandler&gt; getPasswordChangedHandlers() {                                            </span>
<span class="-3664837019724564997" onmouseenter="enter('-3664837019724564997');" onmouseout="out('-3664837019724564997');" style=""> 496          return passwordChangedHandlers;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 497      }                                                                                                             </span>
<span  style=""> 498                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 499      @Override                                                                                                     </span>
<span class="-2683520533006850846" onmouseenter="enter('-2683520533006850846');" onmouseout="out('-2683520533006850846');" style=""> 500      public void setPasswordChangedHandlers(List&lt;PasswordUpdatedHandler&gt; passwordChangedHandlers) {                </span>
<span class="3676994793125858903" onmouseenter="enter('3676994793125858903');" onmouseout="out('3676994793125858903');" style=""> 501          this.passwordChangedHandlers = passwordChangedHandlers;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 502      }                                                                                                             </span>
<span  style=""> 503                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 504      @Override                                                                                                     </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 505      @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                                  </span>
<span class="-5238259893338926366" onmouseenter="enter('-5238259893338926366');" onmouseout="out('-5238259893338926366');" style=""> 506      public GenericResponse sendForgotUsernameNotification(String emailAddress) {                                  </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 507          GenericResponse response = new GenericResponse();                                                         </span>
<span class="-6073063203294335299" onmouseenter="enter('-6073063203294335299');" onmouseout="out('-6073063203294335299');" style=""> 508          List&lt;Customer&gt; customers = null;                                                                          </span>
<span class="-8702812354445074278" onmouseenter="enter('-8702812354445074278');" onmouseout="out('-8702812354445074278');" style=""> 509          if (emailAddress != null) {                                                                               </span>
<span class="6147069966980396471" onmouseenter="enter('6147069966980396471');" onmouseout="out('6147069966980396471');" style=""> 510              customers = customerDao.readCustomersByEmail(emailAddress);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 511          }                                                                                                         </span>
<span  style=""> 512                                                                                                                    </span>
<span class="-6772255019077760087" onmouseenter="enter('-6772255019077760087');" onmouseout="out('-6772255019077760087');" style=""> 513          if (CollectionUtils.isEmpty(customers)) {                                                                 </span>
<span class="7242450034468345273" onmouseenter="enter('7242450034468345273');" onmouseout="out('7242450034468345273');" style=""> 514              response.addErrorCode(&quot;notFound&quot;);                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 515          } else {                                                                                                  </span>
<span class="-2763458366902467863" onmouseenter="enter('-2763458366902467863');" onmouseout="out('-2763458366902467863');" style=""> 516              List&lt;String&gt; activeUsernames = new ArrayList&lt;String&gt;();                                               </span>
<span class="-5523479913680151900" onmouseenter="enter('-5523479913680151900');" onmouseout="out('-5523479913680151900');" style=""> 517              for (Customer customer : customers) {                                                                 </span>
<span class="6036228608782108118" onmouseenter="enter('6036228608782108118');" onmouseout="out('6036228608782108118');" style=""> 518                  if (!customer.isDeactivated()) {                                                                  </span>
<span class="-342072533744095855" onmouseenter="enter('-342072533744095855');" onmouseout="out('-342072533744095855');" style=""> 519                      activeUsernames.add(customer.getUsername());                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 520                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 521              }                                                                                                     </span>
<span  style=""> 522                                                                                                                    </span>
<span class="7800996103103911618" onmouseenter="enter('7800996103103911618');" onmouseout="out('7800996103103911618');" style=""> 523              if (activeUsernames.size() &gt; 0) {                                                                     </span>
<span class="8884608966566249698" onmouseenter="enter('8884608966566249698');" onmouseout="out('8884608966566249698');" style=""> 524                  HashMap&lt;String, Object&gt; vars = new HashMap&lt;String, Object&gt;();                                     </span>
<span class="4818637068787553246" onmouseenter="enter('4818637068787553246');" onmouseout="out('4818637068787553246');" style=""> 525                  vars.put(&quot;userNames&quot;, activeUsernames);                                                           </span>
<span class="315134285136713426" onmouseenter="enter('315134285136713426');" onmouseout="out('315134285136713426');" style=""> 526                  sendEmail(emailAddress, getForgotUsernameEmailInfo(), vars);                                      </span>

<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 527              } else {                                                                                              </span>
<span class="3603576439991328525" onmouseenter="enter('3603576439991328525');" onmouseout="out('3603576439991328525');" style=""> 528                  // send inactive username found email.                                                            </span>
<span class="5510537362121156528" onmouseenter="enter('5510537362121156528');" onmouseout="out('5510537362121156528');" style=""> 529                  response.addErrorCode(&quot;inactiveUser&quot;);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 530              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 531          }                                                                                                         </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 532          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 533      }                                                                                                             </span>
<span  style=""> 534                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 535      @Override                                                                                                     </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 536      @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                                  </span>
<span class="3120849722145808131" onmouseenter="enter('3120849722145808131');" onmouseout="out('3120849722145808131');" style=""> 537      public GenericResponse sendForgotPasswordNotification(String username, String resetPasswordUrl) {             </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 538          GenericResponse response = new GenericResponse();                                                         </span>
<span class="6921810928241781426" onmouseenter="enter('6921810928241781426');" onmouseout="out('6921810928241781426');" style=""> 539          Customer customer = null;                                                                                 </span>
<span  style=""> 540                                                                                                                    </span>
<span class="-8284276918575957483" onmouseenter="enter('-8284276918575957483');" onmouseout="out('-8284276918575957483');" style=""> 541          if (username != null) {                                                                                   </span>
<span class="-104711026898859267" onmouseenter="enter('-104711026898859267');" onmouseout="out('-104711026898859267');" style=""> 542              customer = customerDao.readCustomerByUsername(username);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 543          }                                                                                                         </span>
<span  style=""> 544                                                                                                                    </span>
<span class="-3681439263985626916" onmouseenter="enter('-3681439263985626916');" onmouseout="out('-3681439263985626916');" style=""> 545          checkCustomer(customer, response);                                                                        </span>
<span  style=""> 546                                                                                                                    </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 547          if (!response.getHasErrors()) {                                                                           </span>
<span class="-8225007983262534214" onmouseenter="enter('-8225007983262534214');" onmouseout="out('-8225007983262534214');" style=""> 548              String token = PasswordUtils.generateSecurePassword(getPasswordTokenLength());                        </span>
<span class="5927756983469236234" onmouseenter="enter('5927756983469236234');" onmouseout="out('5927756983469236234');" style=""> 549              token = token.toLowerCase();                                                                          </span>
<span  style=""> 550                                                                                                                    </span>
<span class="-2882068698546261553" onmouseenter="enter('-2882068698546261553');" onmouseout="out('-2882068698546261553');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 551 -            Object salt = getSalt(customer, token);                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 552 -                                                                                                                  </span>
<span class="6651571153976219369" onmouseenter="enter('6651571153976219369');" onmouseout="out('6651571153976219369');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 553 -            String saltString = null;                                                                             </span>
<span class="-2806376417463223295" onmouseenter="enter('-2806376417463223295');" onmouseout="out('-2806376417463223295');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 554 -            if (salt != null) {                                                                                   </span>
<span class="3371007872827291513" onmouseenter="enter('3371007872827291513');" onmouseout="out('3371007872827291513');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 555 -                saltString = Hex.encodeHexString(salt.toString().getBytes());                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 556 -            }                                                                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 557 -                                                                                                                  </span>
<span class="3663219121994932306" onmouseenter="enter('3663219121994932306');" onmouseout="out('3663219121994932306');" style=""> 558              CustomerForgotPasswordSecurityToken fpst = new CustomerForgotPasswordSecurityTokenImpl();             </span>
<span class="-6310870443046136255" onmouseenter="enter('-6310870443046136255');" onmouseout="out('-6310870443046136255');" style=""> 559              fpst.setCustomerId(customer.getId());                                                                 </span>
<span class="-6468715476522634243" onmouseenter="enter('-6468715476522634243');" onmouseout="out('-6468715476522634243');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 560 -            fpst.setToken(encodePass(token, saltString));                                                         </span>
<span class="-1250878182907610155" onmouseenter="enter('-1250878182907610155');" onmouseout="out('-1250878182907610155');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 561 +            fpst.setToken(encodePassword(token));                                                                 </span>
<span class="118078353989050088" onmouseenter="enter('118078353989050088');" onmouseout="out('118078353989050088');" style=""> 562              fpst.setCreateDate(SystemTime.asDate());                                                              </span>
<span class="6850446059209105577" onmouseenter="enter('6850446059209105577');" onmouseout="out('6850446059209105577');" style=""> 563              customerForgotPasswordSecurityTokenDao.saveToken(fpst);                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 564 -                                                                                                                  </span>
<span class="-6985897272839950635" onmouseenter="enter('-6985897272839950635');" onmouseout="out('-6985897272839950635');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 565 -            if (usingDeprecatedPasswordEncoder() &amp;&amp; saltString != null) {                                         </span>
<span class="2358421753202301133" onmouseenter="enter('2358421753202301133');" onmouseout="out('2358421753202301133');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 566 -                token = token + &#x27;-&#x27; + saltString;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 567 -            }                                                                                                     </span>
<span  style=""> 568                                                                                                                    </span>
<span class="8884608966566249698" onmouseenter="enter('8884608966566249698');" onmouseout="out('8884608966566249698');" style=""> 569              HashMap&lt;String, Object&gt; vars = new HashMap&lt;String, Object&gt;();                                         </span>
<span class="-7576751007074497786" onmouseenter="enter('-7576751007074497786');" onmouseout="out('-7576751007074497786');" style=""> 570              vars.put(&quot;token&quot;, token);                                                                             </span>
<span class="7676904455881888218" onmouseenter="enter('7676904455881888218');" onmouseout="out('7676904455881888218');" style=""> 571              if (!StringUtils.isEmpty(resetPasswordUrl)) {                                                         </span>
<span class="-504875606182491340" onmouseenter="enter('-504875606182491340');" onmouseout="out('-504875606182491340');" style=""> 572                  if (resetPasswordUrl.contains(&quot;?&quot;)) {                                                             </span>
<span class="-909834401001506984" onmouseenter="enter('-909834401001506984');" onmouseout="out('-909834401001506984');" style=""> 573                      resetPasswordUrl = resetPasswordUrl + &quot;&amp;token=&quot; + token;                                      </span>

<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 574                  } else {                                                                                          </span>
<span class="-4209124057383847446" onmouseenter="enter('-4209124057383847446');" onmouseout="out('-4209124057383847446');" style=""> 575                      resetPasswordUrl = resetPasswordUrl + &quot;?token=&quot; + token;                                      </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 576                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 577              }                                                                                                     </span>
<span class="3935125112670028800" onmouseenter="enter('3935125112670028800');" onmouseout="out('3935125112670028800');" style=""> 578              vars.put(&quot;resetPasswordUrl&quot;, resetPasswordUrl);                                                       </span>
<span class="543740076975682961" onmouseenter="enter('543740076975682961');" onmouseout="out('543740076975682961');" style=""> 579              sendEmail(customer.getEmailAddress(), getForgotPasswordEmailInfo(), vars);                            </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 580          }                                                                                                         </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 581          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 582      }                                                                                                             </span>
<span  style=""> 583                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 584      @Override                                                                                                     </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 585      @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                                  </span>
<span class="-6820057886432852816" onmouseenter="enter('-6820057886432852816');" onmouseout="out('-6820057886432852816');" style=""> 586      public GenericResponse sendForcedPasswordChangeNotification(String username, String resetPasswordUrl) {       </span>
<span class="-12493669403857096" onmouseenter="enter('-12493669403857096');" onmouseout="out('-12493669403857096');" style=""> 587          return sendForgotPasswordNotification(username, resetPasswordUrl);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 588      }                                                                                                             </span>
<span  style=""> 589                                                                                                                    </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 590 -    @Deprecated                                                                                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 591 -    @Override                                                                                                     </span>
<span class="2764175161613765865" onmouseenter="enter('2764175161613765865');" onmouseout="out('2764175161613765865');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 592 -    public GenericResponse checkPasswordResetToken(String token) {                                                </span>
<span class="-3461464951845163420" onmouseenter="enter('-3461464951845163420');" onmouseout="out('-3461464951845163420');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 593 -        if (!usingDeprecatedPasswordEncoder()) {                                                                  </span>
<span class="2139035906527134472" onmouseenter="enter('2139035906527134472');" onmouseout="out('2139035906527134472');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 594 -            // We cannot proceed without a Customer when using the new PasswordEncoder                            </span>
<span class="-4521424860882993154" onmouseenter="enter('-4521424860882993154');" onmouseout="out('-4521424860882993154');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 595 -            throw new NoSuchBeanDefinitionException(&quot;This method requires the deprecated PasswordEncoder bean&quot;);  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 596 -        }                                                                                                         </span>
<span class="-1076466763561679841" onmouseenter="enter('-1076466763561679841');" onmouseout="out('-1076466763561679841');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 597 -        return checkPasswordResetToken(token, null);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 598 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 599 -                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 600      @Override                                                                                                     </span>
<span class="-7547112806897146214" onmouseenter="enter('-7547112806897146214');" onmouseout="out('-7547112806897146214');" style=""> 601      public GenericResponse checkPasswordResetToken(String token, Customer customer) {                             </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 602          GenericResponse response = new GenericResponse();                                                         </span>
<span class="913599117713435265" onmouseenter="enter('913599117713435265');" onmouseout="out('913599117713435265');" style=""> 603          checkPasswordResetToken(token, customer, response);                                                       </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 604          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 605      }                                                                                                             </span>
<span  style=""> 606                                                                                                                    </span>
<span class="1872423782765914316" onmouseenter="enter('1872423782765914316');" onmouseout="out('1872423782765914316');" style=""><abbr title=" 607      protected CustomerForgotPasswordSecurityToken checkPasswordResetToken(String token, Customer customer, GenericResponse response) {"> 607      protected CustomerForgotPasswordSecurityToken checkPasswordResetToken(String token, Customer customer, GenericðŸ”µ</abbr></span>
<span class="-4169390037463393090" onmouseenter="enter('-4169390037463393090');" onmouseout="out('-4169390037463393090');" style=""> 608          if (StringUtils.isBlank(token)) {                                                                         </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style=""> 609              response.addErrorCode(&quot;invalidToken&quot;);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 610          }                                                                                                         </span>
<span  style=""> 611                                                                                                                    </span>
<span class="5092673057151141969" onmouseenter="enter('5092673057151141969');" onmouseout="out('5092673057151141969');" style=""> 612          String rawToken = token;                                                                                  </span>
<span class="-7872205866412670367" onmouseenter="enter('-7872205866412670367');" onmouseout="out('-7872205866412670367');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 613 -        String salt = null;                                                                                       </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 614 -                                                                                                                  </span>
<span class="-7232422938046234962" onmouseenter="enter('-7232422938046234962');" onmouseout="out('-7232422938046234962');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 615 -        if (usingDeprecatedPasswordEncoder()) {                                                                   </span>
<span class="-4628277419489838427" onmouseenter="enter('-4628277419489838427');" onmouseout="out('-4628277419489838427');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 616 -            String[] tokens = token.split(&quot;-&quot;);                                                                   </span>
<span class="6618708100432165316" onmouseenter="enter('6618708100432165316');" onmouseout="out('6618708100432165316');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 617 -            if (tokens.length &gt; 2) {                                                                              </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 618 -                response.addErrorCode(&quot;invalidToken&quot;);                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 619 -            } else {                                                                                              </span>
<span class="-1712320800281837997" onmouseenter="enter('-1712320800281837997');" onmouseout="out('-1712320800281837997');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 620 -                rawToken = tokens[0].toLowerCase();                                                               </span>
<span class="8621647064958774156" onmouseenter="enter('8621647064958774156');" onmouseout="out('8621647064958774156');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 621 -                if (tokens.length == 2) {                                                                         </span>
<span class="-3949611153912752305" onmouseenter="enter('-3949611153912752305');" onmouseout="out('-3949611153912752305');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 622 -                    salt = tokens[1];                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 623 -                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 624 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 625 -        }                                                                                                         </span>
<span  style=""> 626                                                                                                                    </span>
<span class="-7243325982712524701" onmouseenter="enter('-7243325982712524701');" onmouseout="out('-7243325982712524701');" style=""> 627          CustomerForgotPasswordSecurityToken fpst = null;                                                          </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 628          if (!response.getHasErrors()) {                                                                           </span>
<span class="-1371412200964570990" onmouseenter="enter('-1371412200964570990');" onmouseout="out('-1371412200964570990');" style=""> 629              if (customer == null) {                                                                               </span>
<span class="-3461464951845163420" onmouseenter="enter('-3461464951845163420');" onmouseout="out('-3461464951845163420');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 630 -                if (!usingDeprecatedPasswordEncoder()) {                                                          </span>
<span class="21180584812199314" onmouseenter="enter('21180584812199314');" onmouseout="out('21180584812199314');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 631 -                    // customer can only be null when supporting use of the legacy PasswordEncoder                </span>
<span class="-397249380987924174" onmouseenter="enter('-397249380987924174');" onmouseout="out('-397249380987924174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 632 -                    response.addErrorCode(&quot;invalidCustomer&quot;);                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 633 -                } else {                                                                                          </span>
<span class="-1624865284260185189" onmouseenter="enter('-1624865284260185189');" onmouseout="out('-1624865284260185189');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 634 -                    fpst = customerForgotPasswordSecurityTokenDao.readToken(passwordEncoder.encodePassword(rawToken, salt));"> 634 -                    fpst = customerForgotPasswordSecurityTokenDao.readToken(passwordEncoder.encodePassword(rawTokeðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 635 -                }                                                                                                 </span>
<span class="5265761721143258453" onmouseenter="enter('5265761721143258453');" onmouseout="out('5265761721143258453');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 636 +                fpst = customerForgotPasswordSecurityTokenDao.readToken(encodePassword(token));                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 637              } else {                                                                                              </span>
<span class="-2708743959084825308" onmouseenter="enter('-2708743959084825308');" onmouseout="out('-2708743959084825308');" style=""><abbr title=" 638                  List&lt;CustomerForgotPasswordSecurityToken&gt; fpstoks = customerForgotPasswordSecurityTokenDao.readUnusedTokensByCustomerId(customer.getId());"> 638                  List&lt;CustomerForgotPasswordSecurityToken&gt; fpstoks = customerForgotPasswordSecurityTokenDao.readUnuðŸ”µ</abbr></span>
<span class="6715544567105364437" onmouseenter="enter('6715544567105364437');" onmouseout="out('6715544567105364437');" style=""> 639                  for (CustomerForgotPasswordSecurityToken fpstok : fpstoks) {                                      </span>
<span class="-6038701959731803866" onmouseenter="enter('-6038701959731803866');" onmouseout="out('-6038701959731803866');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 640 -                    if (isPassValid(rawToken, fpstok.getToken(), salt)) {                                         </span>
<span class="-2377519018742151157" onmouseenter="enter('-2377519018742151157');" onmouseout="out('-2377519018742151157');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 641 +                    if (isPasswordValid(rawToken, fpstok.getToken())) {                                           </span>
<span class="-8696697531199533964" onmouseenter="enter('-8696697531199533964');" onmouseout="out('-8696697531199533964');" style=""> 642                          fpst = fpstok;                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 643                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 644                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 645                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 646              }                                                                                                     </span>
<span class="-1673544419969423705" onmouseenter="enter('-1673544419969423705');" onmouseout="out('-1673544419969423705');" style=""> 647              if (fpst == null) {                                                                                   </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style=""> 648                  response.addErrorCode(&quot;invalidToken&quot;);                                                            </span>
<span class="-1851754756462568438" onmouseenter="enter('-1851754756462568438');" onmouseout="out('-1851754756462568438');" style=""> 649              } else if (fpst.isTokenUsedFlag()) {                                                                  </span>
<span class="-4571187449058469389" onmouseenter="enter('-4571187449058469389');" onmouseout="out('-4571187449058469389');" style=""> 650                  response.addErrorCode(&quot;tokenUsed&quot;);                                                               </span>
<span class="1126518180689710158" onmouseenter="enter('1126518180689710158');" onmouseout="out('1126518180689710158');" style=""> 651              } else if (isTokenExpired(fpst)) {                                                                    </span>
<span class="1324239895302259913" onmouseenter="enter('1324239895302259913');" onmouseout="out('1324239895302259913');" style=""> 652                  response.addErrorCode(&quot;tokenExpired&quot;);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 653              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 654          }                                                                                                         </span>
<span class="-4960476697639333031" onmouseenter="enter('-4960476697639333031');" onmouseout="out('-4960476697639333031');" style=""> 655          return fpst;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 656      }                                                                                                             </span>
<span  style=""> 657                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 658      @Override                                                                                                     </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 659      @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                                  </span>
<span class="-1553234826628367049" onmouseenter="enter('-1553234826628367049');" onmouseout="out('-1553234826628367049');" style=""><abbr title=" 660      public GenericResponse resetPasswordUsingToken(String username, String token, String password, String confirmPassword) {"> 660      public GenericResponse resetPasswordUsingToken(String username, String token, String password, String confirmPðŸ”µ</abbr></span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 661          GenericResponse response = new GenericResponse();                                                         </span>
<span class="6921810928241781426" onmouseenter="enter('6921810928241781426');" onmouseout="out('6921810928241781426');" style=""> 662          Customer customer = null;                                                                                 </span>
<span class="-8284276918575957483" onmouseenter="enter('-8284276918575957483');" onmouseout="out('-8284276918575957483');" style=""> 663          if (username != null) {                                                                                   </span>
<span class="-104711026898859267" onmouseenter="enter('-104711026898859267');" onmouseout="out('-104711026898859267');" style=""> 664              customer = customerDao.readCustomerByUsername(username);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 665          }                                                                                                         </span>
<span class="-3681439263985626916" onmouseenter="enter('-3681439263985626916');" onmouseout="out('-3681439263985626916');" style=""> 666          checkCustomer(customer, response);                                                                        </span>
<span class="-3971600249312835278" onmouseenter="enter('-3971600249312835278');" onmouseout="out('-3971600249312835278');" style=""> 667          checkPassword(password, confirmPassword, response);                                                       </span>
<span class="2411779224658140401" onmouseenter="enter('2411779224658140401');" onmouseout="out('2411779224658140401');" style=""> 668          CustomerForgotPasswordSecurityToken fpst = checkPasswordResetToken(token, customer, response);            </span>
<span  style=""> 669                                                                                                                    </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 670          if (!response.getHasErrors()) {                                                                           </span>
<span class="485270787578743194" onmouseenter="enter('485270787578743194');" onmouseout="out('485270787578743194');" style=""> 671              if (!customer.getId().equals(fpst.getCustomerId())) {                                                 </span>
<span class="-5994256316510103080" onmouseenter="enter('-5994256316510103080');" onmouseout="out('-5994256316510103080');" style=""> 672                  if (LOG.isWarnEnabled()) {                                                                        </span>
<span class="-3030254613251423793" onmouseenter="enter('-3030254613251423793');" onmouseout="out('-3030254613251423793');" style=""><abbr title=" 673                      LOG.warn(&quot;Password reset attempt tried with mismatched customer and token &quot; + customer.getId() + &quot;, &quot; + StringUtil.sanitize(token));"> 673                      LOG.warn(&quot;Password reset attempt tried with mismatched customer and token &quot; + customer.getId()ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 674                  }                                                                                                 </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style=""> 675                  response.addErrorCode(&quot;invalidToken&quot;);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 676              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 677          }                                                                                                         </span>
<span  style=""> 678                                                                                                                    </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 679          if (!response.getHasErrors()) {                                                                           </span>
<span class="5101903206908082309" onmouseenter="enter('5101903206908082309');" onmouseout="out('5101903206908082309');" style=""> 680              customer.setUnencodedPassword(password);                                                              </span>
<span class="6606672839011797247" onmouseenter="enter('6606672839011797247');" onmouseout="out('6606672839011797247');" style=""> 681              customer.setPasswordChangeRequired(false);                                                            </span>
<span class="3384492063942947657" onmouseenter="enter('3384492063942947657');" onmouseout="out('3384492063942947657');" style=""> 682              saveCustomer(customer);                                                                               </span>
<span class="-7517227353230604805" onmouseenter="enter('-7517227353230604805');" onmouseout="out('-7517227353230604805');" style=""> 683              invalidateAllTokensForCustomer(customer);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 684          }                                                                                                         </span>
<span  style=""> 685                                                                                                                    </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 686          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 687      }                                                                                                             </span>
<span  style=""> 688                                                                                                                    </span>
<span class="2450635656385893269" onmouseenter="enter('2450635656385893269');" onmouseout="out('2450635656385893269');" style=""> 689      protected void invalidateAllTokensForCustomer(Customer customer) {                                            </span>
<span class="500146367959601607" onmouseenter="enter('500146367959601607');" onmouseout="out('500146367959601607');" style=""><abbr title=" 690          List&lt;CustomerForgotPasswordSecurityToken&gt; tokens = customerForgotPasswordSecurityTokenDao.readUnusedTokensByCustomerId(customer.getId());"> 690          List&lt;CustomerForgotPasswordSecurityToken&gt; tokens = customerForgotPasswordSecurityTokenDao.readUnusedTokensðŸ”µ</abbr></span>
<span class="34403017169246064" onmouseenter="enter('34403017169246064');" onmouseout="out('34403017169246064');" style=""> 691          for (CustomerForgotPasswordSecurityToken token : tokens) {                                                </span>
<span class="-3707452475519083600" onmouseenter="enter('-3707452475519083600');" onmouseout="out('-3707452475519083600');" style=""> 692              token.setTokenUsedFlag(true);                                                                         </span>
<span class="-8670185777060395996" onmouseenter="enter('-8670185777060395996');" onmouseout="out('-8670185777060395996');" style=""> 693              customerForgotPasswordSecurityTokenDao.saveToken(token);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 694          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 695      }                                                                                                             </span>
<span  style=""> 696                                                                                                                    </span>
<span class="3178004875725558699" onmouseenter="enter('3178004875725558699');" onmouseout="out('3178004875725558699');" style=""> 697      protected void checkCustomer(Customer customer, GenericResponse response) {                                   </span>
<span class="-1371412200964570990" onmouseenter="enter('-1371412200964570990');" onmouseout="out('-1371412200964570990');" style=""> 698          if (customer == null) {                                                                                   </span>
<span class="-397249380987924174" onmouseenter="enter('-397249380987924174');" onmouseout="out('-397249380987924174');" style=""> 699              response.addErrorCode(&quot;invalidCustomer&quot;);                                                             </span>
<span class="-1786182981140386352" onmouseenter="enter('-1786182981140386352');" onmouseout="out('-1786182981140386352');" style=""> 700          } else if (StringUtils.isBlank(customer.getEmailAddress())) {                                             </span>
<span class="3641519375839212970" onmouseenter="enter('3641519375839212970');" onmouseout="out('3641519375839212970');" style=""> 701              response.addErrorCode(&quot;emailNotFound&quot;);                                                               </span>
<span class="4935674502595460128" onmouseenter="enter('4935674502595460128');" onmouseout="out('4935674502595460128');" style=""> 702          } else if (customer.isDeactivated()) {                                                                    </span>
<span class="5510537362121156528" onmouseenter="enter('5510537362121156528');" onmouseout="out('5510537362121156528');" style=""> 703              response.addErrorCode(&quot;inactiveUser&quot;);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 704          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 705      }                                                                                                             </span>
<span  style=""> 706                                                                                                                    </span>
<span class="-3281949438797137351" onmouseenter="enter('-3281949438797137351');" onmouseout="out('-3281949438797137351');" style=""> 707      protected void checkPassword(String password, String confirmPassword, GenericResponse response) {             </span>
<span class="2256032458684464296" onmouseenter="enter('2256032458684464296');" onmouseout="out('2256032458684464296');" style=""> 708          if (StringUtils.isBlank(password) || StringUtils.isBlank(confirmPassword)) {                              </span>
<span class="5492480053199382271" onmouseenter="enter('5492480053199382271');" onmouseout="out('5492480053199382271');" style=""> 709              response.addErrorCode(&quot;invalidPassword&quot;);                                                             </span>
<span class="5837283644501577917" onmouseenter="enter('5837283644501577917');" onmouseout="out('5837283644501577917');" style=""> 710          } else if (!password.equals(confirmPassword)) {                                                           </span>
<span class="-5929993345093092025" onmouseenter="enter('-5929993345093092025');" onmouseout="out('-5929993345093092025');" style=""> 711              response.addErrorCode(&quot;passwordMismatch&quot;);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 712          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 713      }                                                                                                             </span>
<span  style=""> 714                                                                                                                    </span>
<span class="2301745374477860963" onmouseenter="enter('2301745374477860963');" onmouseout="out('2301745374477860963');" style=""> 715      protected boolean isTokenExpired(CustomerForgotPasswordSecurityToken fpst) {                                  </span>
<span class="7457175319484101734" onmouseenter="enter('7457175319484101734');" onmouseout="out('7457175319484101734');" style=""> 716          Date now = SystemTime.asDate();                                                                           </span>
<span class="4814679658448270347" onmouseenter="enter('4814679658448270347');" onmouseout="out('4814679658448270347');" style=""> 717          long currentTimeInMillis = now.getTime();                                                                 </span>
<span class="2086457980523585614" onmouseenter="enter('2086457980523585614');" onmouseout="out('2086457980523585614');" style=""> 718          long tokenSaveTimeInMillis = fpst.getCreateDate().getTime();                                              </span>
<span class="6156534052742928347" onmouseenter="enter('6156534052742928347');" onmouseout="out('6156534052742928347');" style=""> 719          long minutesSinceSave = (currentTimeInMillis - tokenSaveTimeInMillis) / 60000;                            </span>
<span class="4808087245976426488" onmouseenter="enter('4808087245976426488');" onmouseout="out('4808087245976426488');" style=""> 720          return minutesSinceSave &gt; tokenExpiredMinutes;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 721      }                                                                                                             </span>
<span  style=""> 722                                                                                                                    </span>
<span class="-1783595916375579475" onmouseenter="enter('-1783595916375579475');" onmouseout="out('-1783595916375579475');" style=""> 723      protected void sendEmail(String emailAddress, EmailInfo emailInfo, Map&lt;String, Object&gt; props) {               </span>
<span class="6622041900045107950" onmouseenter="enter('6622041900045107950');" onmouseout="out('6622041900045107950');" style=""> 724          emailService.sendTemplateEmail(emailAddress, emailInfo, props);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 725      }                                                                                                             </span>
<span  style=""> 726                                                                                                                    </span>
<span class="-7890820258027638542" onmouseenter="enter('-7890820258027638542');" onmouseout="out('-7890820258027638542');" style=""> 727      public int getTokenExpiredMinutes() {                                                                         </span>
<span class="-8144525086468905422" onmouseenter="enter('-8144525086468905422');" onmouseout="out('-8144525086468905422');" style=""> 728          return tokenExpiredMinutes;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 729      }                                                                                                             </span>
<span  style=""> 730                                                                                                                    </span>
<span class="-4089110355878340459" onmouseenter="enter('-4089110355878340459');" onmouseout="out('-4089110355878340459');" style=""> 731      public void setTokenExpiredMinutes(int tokenExpiredMinutes) {                                                 </span>
<span class="-6197938813064605922" onmouseenter="enter('-6197938813064605922');" onmouseout="out('-6197938813064605922');" style=""> 732          this.tokenExpiredMinutes = tokenExpiredMinutes;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 733      }                                                                                                             </span>
<span  style=""> 734                                                                                                                    </span>
<span class="-2211298406731211675" onmouseenter="enter('-2211298406731211675');" onmouseout="out('-2211298406731211675');" style=""> 735      public int getPasswordTokenLength() {                                                                         </span>
<span class="-9052975427749106201" onmouseenter="enter('-9052975427749106201');" onmouseout="out('-9052975427749106201');" style=""> 736          return passwordTokenLength;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 737      }                                                                                                             </span>
<span  style=""> 738                                                                                                                    </span>
<span class="4968817442646533856" onmouseenter="enter('4968817442646533856');" onmouseout="out('4968817442646533856');" style=""> 739      public void setPasswordTokenLength(int passwordTokenLength) {                                                 </span>
<span class="-6372163195142109946" onmouseenter="enter('-6372163195142109946');" onmouseout="out('-6372163195142109946');" style=""> 740          this.passwordTokenLength = passwordTokenLength;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 741      }                                                                                                             </span>
<span  style=""> 742                                                                                                                    </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 743 +                                                                                                                  </span>
<span class="-2426619698179732460" onmouseenter="enter('-2426619698179732460');" onmouseout="out('-2426619698179732460');" style=""> 744      public EmailInfo getForgotPasswordEmailInfo() {                                                               </span>
<span class="8553850930406344086" onmouseenter="enter('8553850930406344086');" onmouseout="out('8553850930406344086');" style=""> 745          return forgotPasswordEmailInfo;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 746      }                                                                                                             </span>
<span  style=""> 747                                                                                                                    </span>
<span class="-5968004809391300230" onmouseenter="enter('-5968004809391300230');" onmouseout="out('-5968004809391300230');" style=""> 748      public void setForgotPasswordEmailInfo(EmailInfo forgotPasswordEmailInfo) {                                   </span>
<span class="3510418398145123936" onmouseenter="enter('3510418398145123936');" onmouseout="out('3510418398145123936');" style=""> 749          this.forgotPasswordEmailInfo = forgotPasswordEmailInfo;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 750      }                                                                                                             </span>
<span  style=""> 751                                                                                                                    </span>
<span class="7679605086459105581" onmouseenter="enter('7679605086459105581');" onmouseout="out('7679605086459105581');" style=""> 752      public EmailInfo getForgotUsernameEmailInfo() {                                                               </span>
<span class="-8928803675058205054" onmouseenter="enter('-8928803675058205054');" onmouseout="out('-8928803675058205054');" style=""> 753          return forgotUsernameEmailInfo;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 754      }                                                                                                             </span>
<span  style=""> 755                                                                                                                    </span>
<span class="7097836574720204185" onmouseenter="enter('7097836574720204185');" onmouseout="out('7097836574720204185');" style=""> 756      public void setForgotUsernameEmailInfo(EmailInfo forgotUsernameEmailInfo) {                                   </span>
<span class="-6675027655322416901" onmouseenter="enter('-6675027655322416901');" onmouseout="out('-6675027655322416901');" style=""> 757          this.forgotUsernameEmailInfo = forgotUsernameEmailInfo;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 758      }                                                                                                             </span>
<span  style=""> 759                                                                                                                    </span>
<span class="5133340881216779756" onmouseenter="enter('5133340881216779756');" onmouseout="out('5133340881216779756');" style=""> 760      public EmailInfo getRegistrationEmailInfo() {                                                                 </span>
<span class="-8178127994446042174" onmouseenter="enter('-8178127994446042174');" onmouseout="out('-8178127994446042174');" style=""> 761          return registrationEmailInfo;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 762      }                                                                                                             </span>
<span  style=""> 763                                                                                                                    </span>
<span class="-1271447752357505583" onmouseenter="enter('-1271447752357505583');" onmouseout="out('-1271447752357505583');" style=""> 764      public void setRegistrationEmailInfo(EmailInfo registrationEmailInfo) {                                       </span>
<span class="-6232198529948124277" onmouseenter="enter('-6232198529948124277');" onmouseout="out('-6232198529948124277');" style=""> 765          this.registrationEmailInfo = registrationEmailInfo;                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 766      }                                                                                                             </span>
<span  style=""> 767                                                                                                                    </span>
<span class="5129663219504237585" onmouseenter="enter('5129663219504237585');" onmouseout="out('5129663219504237585');" style=""> 768      public EmailInfo getChangePasswordEmailInfo() {                                                               </span>
<span class="-1635559517766867718" onmouseenter="enter('-1635559517766867718');" onmouseout="out('-1635559517766867718');" style=""> 769          return changePasswordEmailInfo;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 770      }                                                                                                             </span>
<span  style=""> 771                                                                                                                    </span>
<span class="9037922117099126087" onmouseenter="enter('9037922117099126087');" onmouseout="out('9037922117099126087');" style=""> 772      public void setChangePasswordEmailInfo(EmailInfo changePasswordEmailInfo) {                                   </span>
<span class="-7914138197132411471" onmouseenter="enter('-7914138197132411471');" onmouseout="out('-7914138197132411471');" style=""> 773          this.changePasswordEmailInfo = changePasswordEmailInfo;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 774      }                                                                                                             </span>
<span  style=""> 775                                                                                                                    </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 776 -    @Deprecated                                                                                                   </span>
<span class="-6689514394619645734" onmouseenter="enter('-6689514394619645734');" onmouseout="out('-6689514394619645734');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 777 -    protected boolean usingDeprecatedPasswordEncoder() {                                                          </span>
<span class="-493259449393847495" onmouseenter="enter('-493259449393847495');" onmouseout="out('-493259449393847495');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 778 -        return passwordEncoder != null;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 779 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 780 -                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 781      @Override                                                                                                     </span>
<span class="2659754888592981645" onmouseenter="enter('2659754888592981645');" onmouseout="out('2659754888592981645');" style=""> 782      public List&lt;Customer&gt; readBatchCustomers(int start, int pageSize) {                                           </span>
<span class="-8143894692030732868" onmouseenter="enter('-8143894692030732868');" onmouseout="out('-8143894692030732868');" style=""> 783          return customerDao.readBatchCustomers(start, pageSize);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 784      }                                                                                                             </span>
<span  style=""> 785                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 786      @Override                                                                                                     </span>
<span class="4634920297968325108" onmouseenter="enter('4634920297968325108');" onmouseout="out('4634920297968325108');" style=""> 787      public Long readNumberOfCustomers() {                                                                         </span>
<span class="93124683563030725" onmouseenter="enter('93124683563030725');" onmouseout="out('93124683563030725');" style=""> 788          return customerDao.readNumberOfCustomers();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 789      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 790  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="195929208389810495" onmouseenter="enter('195929208389810495');" onmouseout="out('195929208389810495');" style="">   3   * BroadleafCommerce Profile                                                                                      </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="5673174586140185880" onmouseenter="enter('5673174586140185880');" onmouseout="out('5673174586140185880');" style="">  18  package org.broadleafcommerce.profile.core.service;                                                               </span>
<span  style="">  19                                                                                                                    </span>
<span class="-3515056221608725115" onmouseenter="enter('-3515056221608725115');" onmouseout="out('-3515056221608725115');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  20 -import org.apache.commons.codec.binary.Hex;                                                                       </span>
<span class="-4900305655545834342" onmouseenter="enter('-4900305655545834342');" onmouseout="out('-4900305655545834342');" style="">  21  import org.apache.commons.collections4.CollectionUtils;                                                           </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  22  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  23  import org.apache.commons.logging.Log;                                                                            </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  24  import org.apache.commons.logging.LogFactory;                                                                     </span>
<span class="6519729880675887369" onmouseenter="enter('6519729880675887369');" onmouseout="out('6519729880675887369');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  25 +import org.broadleafcommerce.common.event.BroadleafApplicationEventPublisher;                                     </span>
<span class="8150446407418055690" onmouseenter="enter('8150446407418055690');" onmouseout="out('8150446407418055690');" style="">  26  import org.broadleafcommerce.common.id.service.IdGenerationService;                                               </span>
<span class="-6657505372111281463" onmouseenter="enter('-6657505372111281463');" onmouseout="out('-6657505372111281463');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  27 -import org.broadleafcommerce.profile.core.dto.CustomerRuleHolder;                                                 </span>
<span class="9149575778472736151" onmouseenter="enter('9149575778472736151');" onmouseout="out('9149575778472736151');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  28 -import org.broadleafcommerce.common.email.service.EmailService;                                                   </span>
<span class="-6139442722863763787" onmouseenter="enter('-6139442722863763787');" onmouseout="out('-6139442722863763787');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  29 -import org.broadleafcommerce.common.email.service.info.EmailInfo;                                                 </span>

<span class="8527520771739085493" onmouseenter="enter('8527520771739085493');" onmouseout="out('8527520771739085493');" style="">  30  import org.broadleafcommerce.common.rule.MvelHelper;                                                              </span>
<span class="-2635683203763841416" onmouseenter="enter('-2635683203763841416');" onmouseout="out('-2635683203763841416');" style="">  31  import org.broadleafcommerce.common.security.util.PasswordChange;                                                 </span>
<span class="5972522294326904672" onmouseenter="enter('5972522294326904672');" onmouseout="out('5972522294326904672');" style="">  32  import org.broadleafcommerce.common.security.util.PasswordReset;                                                  </span>
<span class="6413981270350028954" onmouseenter="enter('6413981270350028954');" onmouseout="out('6413981270350028954');" style="">  33  import org.broadleafcommerce.common.security.util.PasswordUtils;                                                  </span>
<span class="-3956591208111981988" onmouseenter="enter('-3956591208111981988');" onmouseout="out('-3956591208111981988');" style="">  34  import org.broadleafcommerce.common.service.GenericResponse;                                                      </span>
<span class="1373992879208813777" onmouseenter="enter('1373992879208813777');" onmouseout="out('1373992879208813777');" style="">  35  import org.broadleafcommerce.common.time.SystemTime;                                                              </span>
<span class="-3347161074136237116" onmouseenter="enter('-3347161074136237116');" onmouseout="out('-3347161074136237116');" style="">  36  import org.broadleafcommerce.common.util.StringUtil;                                                              </span>
<span class="5107697851223623564" onmouseenter="enter('5107697851223623564');" onmouseout="out('5107697851223623564');" style="">  37  import org.broadleafcommerce.common.util.TransactionUtils;                                                        </span>
<span class="5198631096841786518" onmouseenter="enter('5198631096841786518');" onmouseout="out('5198631096841786518');" style="">  38  import org.broadleafcommerce.profile.core.dao.CustomerDao;                                                        </span>
<span class="6035498420134781098" onmouseenter="enter('6035498420134781098');" onmouseout="out('6035498420134781098');" style="">  39  import org.broadleafcommerce.profile.core.dao.CustomerForgotPasswordSecurityTokenDao;                             </span>
<span class="-2668610663458012770" onmouseenter="enter('-2668610663458012770');" onmouseout="out('-2668610663458012770');" style="">  40  import org.broadleafcommerce.profile.core.dao.RoleDao;                                                            </span>
<span class="-6242194486783230477" onmouseenter="enter('-6242194486783230477');" onmouseout="out('-6242194486783230477');" style="">  41  import org.broadleafcommerce.profile.core.domain.Customer;                                                        </span>
<span class="7682914685467852548" onmouseenter="enter('7682914685467852548');" onmouseout="out('7682914685467852548');" style="">  42  import org.broadleafcommerce.profile.core.domain.CustomerForgotPasswordSecurityToken;                             </span>
<span class="-7325905376371760879" onmouseenter="enter('-7325905376371760879');" onmouseout="out('-7325905376371760879');" style="">  43  import org.broadleafcommerce.profile.core.domain.CustomerForgotPasswordSecurityTokenImpl;                         </span>
<span class="-7795206435247364271" onmouseenter="enter('-7795206435247364271');" onmouseout="out('-7795206435247364271');" style="">  44  import org.broadleafcommerce.profile.core.domain.CustomerRole;                                                    </span>
<span class="5359715183603948959" onmouseenter="enter('5359715183603948959');" onmouseout="out('5359715183603948959');" style="">  45  import org.broadleafcommerce.profile.core.domain.CustomerRoleImpl;                                                </span>
<span class="6271275544652071055" onmouseenter="enter('6271275544652071055');" onmouseout="out('6271275544652071055');" style="">  46  import org.broadleafcommerce.profile.core.domain.Role;                                                            </span>
<span class="-6657505372111281463" onmouseenter="enter('-6657505372111281463');" onmouseout="out('-6657505372111281463');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  47 +import org.broadleafcommerce.profile.core.dto.CustomerRuleHolder;                                                 </span>
<span class="-8181433875826880332" onmouseenter="enter('-8181433875826880332');" onmouseout="out('-8181433875826880332');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  48 +import org.broadleafcommerce.profile.core.event.ForgotPasswordEvent;                                              </span>
<span class="7578912361223650489" onmouseenter="enter('7578912361223650489');" onmouseout="out('7578912361223650489');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  49 +import org.broadleafcommerce.profile.core.event.ForgotUsernameEvent;                                              </span>
<span class="-1223355443293629135" onmouseenter="enter('-1223355443293629135');" onmouseout="out('-1223355443293629135');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  50 +import org.broadleafcommerce.profile.core.event.RegisterCustomerEvent;                                            </span>
<span class="1248060424968705063" onmouseenter="enter('1248060424968705063');" onmouseout="out('1248060424968705063');" style="">  51  import org.broadleafcommerce.profile.core.service.handler.PasswordUpdatedHandler;                                 </span>
<span class="-6753305615342929581" onmouseenter="enter('-6753305615342929581');" onmouseout="out('-6753305615342929581');" style="">  52  import org.broadleafcommerce.profile.core.service.listener.PostRegistrationObserver;                              </span>
<span class="4412650647810815777" onmouseenter="enter('4412650647810815777');" onmouseout="out('4412650647810815777');" style="">  53  import org.springframework.beans.factory.NoSuchBeanDefinitionException;                                           </span>
<span class="-6148326362900055524" onmouseenter="enter('-6148326362900055524');" onmouseout="out('-6148326362900055524');" style="">  54  import org.springframework.beans.factory.annotation.Autowired;                                                    </span>
<span class="-4664978283136443479" onmouseenter="enter('-4664978283136443479');" onmouseout="out('-4664978283136443479');" style="">  55  import org.springframework.beans.factory.annotation.Qualifier;                                                    </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  56  import org.springframework.beans.factory.annotation.Value;                                                        </span>
<span class="443255988526129671" onmouseenter="enter('443255988526129671');" onmouseout="out('443255988526129671');" style="">  57  import org.springframework.security.authentication.dao.SaltSource;                                                </span>
<span class="6507752321844884693" onmouseenter="enter('6507752321844884693');" onmouseout="out('6507752321844884693');" style="">  58  import org.springframework.security.core.GrantedAuthority;                                                        </span>
<span class="2075826732928208126" onmouseenter="enter('2075826732928208126');" onmouseout="out('2075826732928208126');" style="">  59  import org.springframework.security.crypto.password.PasswordEncoder;                                              </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  60  import org.springframework.stereotype.Service;                                                                    </span>
<span class="4419089678332371422" onmouseenter="enter('4419089678332371422');" onmouseout="out('4419089678332371422');" style="">  61  import org.springframework.transaction.annotation.Transactional;                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  62 -                                                                                                                  </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  63  import java.util.ArrayList;                                                                                       </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="">  64  import java.util.Date;                                                                                            </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  65  import java.util.HashMap;                                                                                         </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  66  import java.util.Iterator;                                                                                        </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  67  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  68  import java.util.Map;                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  69 -                                                                                                                  </span>
<span class="-1842700952879713169" onmouseenter="enter('-1842700952879713169');" onmouseout="out('-1842700952879713169');" style="">  70  import javax.annotation.PostConstruct;                                                                            </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  71  import javax.annotation.Resource;                                                                                 </span>
<span  style="">  72                                                                                                                    </span>
<span class="-3189571605039255438" onmouseenter="enter('-3189571605039255438');" onmouseout="out('-3189571605039255438');" style="">  73  @Service(&quot;blCustomerService&quot;)                                                                                     </span>
<span class="-4315786798209752789" onmouseenter="enter('-4315786798209752789');" onmouseout="out('-4315786798209752789');" style="">  74  public class CustomerServiceImpl implements CustomerService {                                                     </span>
<span class="-9223083925427668638" onmouseenter="enter('-9223083925427668638');" onmouseout="out('-9223083925427668638');" style="">  75      private static final Log LOG = LogFactory.getLog(CustomerServiceImpl.class);                                  </span>
<span class="-8423658991079621305" onmouseenter="enter('-8423658991079621305');" onmouseout="out('-8423658991079621305');" style="">  76      private static final int PASSWORD_LENGTH = 16;                                                                </span>
<span  style="">  77                                                                                                                    </span>
<span class="-4901656528466650106" onmouseenter="enter('-4901656528466650106');" onmouseout="out('-4901656528466650106');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  78 -    @Resource(name = &quot;blCustomerDao&quot;)                                                                             </span>
<span class="5554564923016007608" onmouseenter="enter('5554564923016007608');" onmouseout="out('5554564923016007608');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  79 +    @Autowired                                                                                                    </span>
<span class="-7224044524343370301" onmouseenter="enter('-7224044524343370301');" onmouseout="out('-7224044524343370301');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  80 +    @Qualifier(&quot;blApplicationEventPublisher&quot;)                                                                     </span>
<span class="-5629661248749562711" onmouseenter="enter('-5629661248749562711');" onmouseout="out('-5629661248749562711');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  81 +    protected BroadleafApplicationEventPublisher eventPublisher;                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  82 +                                                                                                                  </span>
<span class="-3028644688219155238" onmouseenter="enter('-3028644688219155238');" onmouseout="out('-3028644688219155238');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  83 +    @Resource(name=&quot;blCustomerDao&quot;)                                                                               </span>
<span class="8692367904333193309" onmouseenter="enter('8692367904333193309');" onmouseout="out('8692367904333193309');" style="">  84      protected CustomerDao customerDao;                                                                            </span>
<span  style="">  85                                                                                                                    </span>
<span class="3094900987137494064" onmouseenter="enter('3094900987137494064');" onmouseout="out('3094900987137494064');" style="">  86      @Resource(name = &quot;blIdGenerationService&quot;)                                                                     </span>
<span class="-7221277934130422196" onmouseenter="enter('-7221277934130422196');" onmouseout="out('-7221277934130422196');" style="">  87      protected IdGenerationService idGenerationService;                                                            </span>
<span  style="">  88                                                                                                                    </span>
<span class="2365488678467894280" onmouseenter="enter('2365488678467894280');" onmouseout="out('2365488678467894280');" style="">  89      @Resource(name = &quot;blCustomerForgotPasswordSecurityTokenDao&quot;)                                                  </span>
<span class="4716726216132170190" onmouseenter="enter('4716726216132170190');" onmouseout="out('4716726216132170190');" style="">  90      protected CustomerForgotPasswordSecurityTokenDao customerForgotPasswordSecurityTokenDao;                      </span>
<span  style="">  91                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  92      /**                                                                                                           </span>
<span class="-9011162707134809495" onmouseenter="enter('-9011162707134809495');" onmouseout="out('-9011162707134809495');" style="">  93       * &lt;p&gt;Set by {@link #setupPasswordEncoder()} if the blPasswordEncoder bean provided is the deprecated version.</span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  94       *                                                                                                            </span>
<span class="2452173250496209218" onmouseenter="enter('2452173250496209218');" onmouseout="out('2452173250496209218');" style="">  95       * @deprecated Spring Security has deprecated this encoder interface, this will be removed in 4.2             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  96       */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="">  97      @Deprecated                                                                                                   </span>
<span class="7564109825156072680" onmouseenter="enter('7564109825156072680');" onmouseout="out('7564109825156072680');" style="">  98      protected org.springframework.security.authentication.encoding.PasswordEncoder passwordEncoder;               </span>
<span  style="">  99                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 100      /**                                                                                                           </span>
<span class="-5116861287321393394" onmouseenter="enter('-5116861287321393394');" onmouseout="out('-5116861287321393394');" style=""> 101       * &lt;p&gt;Set by {@link #setupPasswordEncoder()} if the blPasswordEncoder bean provided is the new version.       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 102       */                                                                                                           </span>
<span class="1701368210273381595" onmouseenter="enter('1701368210273381595');" onmouseout="out('1701368210273381595');" style=""> 103      protected PasswordEncoder passwordEncoderNew;                                                                 </span>
<span  style=""> 104                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 105      /**                                                                                                           </span>
<span class="6298544191369985956" onmouseenter="enter('6298544191369985956');" onmouseout="out('6298544191369985956');" style=""><abbr title=" 106       * &lt;p&gt;This is simply a placeholder to be used by {@link #setupPasswordEncoder()} to determine if we&#x27;re using the"> 106       * &lt;p&gt;This is simply a placeholder to be used by {@link #setupPasswordEncoder()} to determine if we&#x27;re using tðŸ”µ</abbr></span>
<span class="897245791379814301" onmouseenter="enter('897245791379814301');" onmouseout="out('897245791379814301');" style=""><abbr title=" 107       * new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.authentication.encoding.PasswordEncoder PasswordEncoder}"> 107       * new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.authentication.encoding.PðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 108       */                                                                                                           </span>
<span class="3863006184976437823" onmouseenter="enter('3863006184976437823');" onmouseout="out('3863006184976437823');" style=""> 109      @Resource(name = &quot;blPasswordEncoder&quot;)                                                                         </span>
<span class="6445807734700841407" onmouseenter="enter('6445807734700841407');" onmouseout="out('6445807734700841407');" style=""> 110      protected Object passwordEncoderBean;                                                                         </span>
<span  style=""> 111                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 112      /**                                                                                                           </span>
<span class="3279032571910866698" onmouseenter="enter('3279032571910866698');" onmouseout="out('3279032571910866698');" style=""> 113       * Optional password salt to be used with the passwordEncoder                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 114       *                                                                                                            </span>
<span class="-4822778269765077069" onmouseenter="enter('-4822778269765077069');" onmouseout="out('-4822778269765077069');" style=""><abbr title=" 115       * @deprecated utilize {@link #saltSource} instead so that it can be shared between this class as well as Spring&#x27;s"> 115       * @deprecated utilize {@link #saltSource} instead so that it can be shared between this class as well as SpriðŸ”µ</abbr></span>
<span class="-486494548782010565" onmouseenter="enter('-486494548782010565');" onmouseout="out('-486494548782010565');" style=""> 116       * authentication manager, this will be removed in 4.2                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 117       */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 118      @Deprecated                                                                                                   </span>
<span class="8995389235954487612" onmouseenter="enter('8995389235954487612');" onmouseout="out('8995389235954487612');" style=""> 119      protected String salt;                                                                                        </span>
<span  style=""> 120                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 121      /**                                                                                                           </span>
<span class="7160577035329884491" onmouseenter="enter('7160577035329884491');" onmouseout="out('7160577035329884491');" style=""> 122       * Use a Salt Source ONLY if there&#x27;s one configured                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 123       *                                                                                                            </span>
<span class="-6749030359408285657" onmouseenter="enter('-6749030359408285657');" onmouseout="out('-6749030359408285657');" style=""> 124       * @deprecated the new {@link PasswordEncoder} handles salting internally, this will be removed in 4.2        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 125       */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 126      @Deprecated                                                                                                   </span>
<span class="2602789178515286342" onmouseenter="enter('2602789178515286342');" onmouseout="out('2602789178515286342');" style=""> 127      @Autowired(required = false)                                                                                  </span>
<span class="6407227478596567604" onmouseenter="enter('6407227478596567604');" onmouseout="out('6407227478596567604');" style=""> 128      @Qualifier(&quot;blSaltSource&quot;)                                                                                    </span>
<span class="-1458682478412193164" onmouseenter="enter('-1458682478412193164');" onmouseout="out('-1458682478412193164');" style=""> 129      protected SaltSource saltSource;                                                                              </span>

<span  style=""> 130                                                                                                                    </span>
<span class="-5757933253912539407" onmouseenter="enter('-5757933253912539407');" onmouseout="out('-5757933253912539407');" style=""> 131      @Resource(name = &quot;blRoleDao&quot;)                                                                                 </span>
<span class="-2955407415487117626" onmouseenter="enter('-2955407415487117626');" onmouseout="out('-2955407415487117626');" style=""> 132      protected RoleDao roleDao;                                                                                    </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 133 -                                                                                                                  </span>
<span class="7766343972197163364" onmouseenter="enter('7766343972197163364');" onmouseout="out('7766343972197163364');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 134 -    @Resource(name = &quot;blEmailService&quot;)                                                                            </span>
<span class="3549223300613749719" onmouseenter="enter('3549223300613749719');" onmouseout="out('3549223300613749719');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 135 -    protected EmailService emailService;                                                                          </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 136 -                                                                                                                  </span>
<span class="2383771680597084829" onmouseenter="enter('2383771680597084829');" onmouseout="out('2383771680597084829');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 137 -    @Resource(name = &quot;blForgotPasswordEmailInfo&quot;)                                                                 </span>
<span class="-4862815721611251327" onmouseenter="enter('-4862815721611251327');" onmouseout="out('-4862815721611251327');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 138 -    protected EmailInfo forgotPasswordEmailInfo;                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 139 -                                                                                                                  </span>
<span class="-2019571563348114086" onmouseenter="enter('-2019571563348114086');" onmouseout="out('-2019571563348114086');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 140 -    @Resource(name = &quot;blForgotUsernameEmailInfo&quot;)                                                                 </span>
<span class="6306671580077013135" onmouseenter="enter('6306671580077013135');" onmouseout="out('6306671580077013135');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 141 -    protected EmailInfo forgotUsernameEmailInfo;                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 142 -                                                                                                                  </span>
<span class="-6401075622864476952" onmouseenter="enter('-6401075622864476952');" onmouseout="out('-6401075622864476952');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 143 -    @Resource(name = &quot;blRegistrationEmailInfo&quot;)                                                                   </span>
<span class="6263649015051340635" onmouseenter="enter('6263649015051340635');" onmouseout="out('6263649015051340635');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 144 -    protected EmailInfo registrationEmailInfo;                                                                    </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 145 -                                                                                                                  </span>
<span class="-7074496001236985830" onmouseenter="enter('-7074496001236985830');" onmouseout="out('-7074496001236985830');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 146 -    @Resource(name = &quot;blChangePasswordEmailInfo&quot;)                                                                 </span>
<span class="-8238195063141687171" onmouseenter="enter('-8238195063141687171');" onmouseout="out('-8238195063141687171');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 147 -    protected EmailInfo changePasswordEmailInfo;                                                                  </span>
<span  style=""> 148                                                                                                                    </span>
<span class="453353925889912084" onmouseenter="enter('453353925889912084');" onmouseout="out('453353925889912084');" style=""> 149      protected int tokenExpiredMinutes = 30;                                                                       </span>
<span class="-1133336695006357373" onmouseenter="enter('-1133336695006357373');" onmouseout="out('-1133336695006357373');" style=""> 150      protected int passwordTokenLength = 20;                                                                       </span>
<span  style=""> 151                                                                                                                    </span>
<span class="-2653602182005192069" onmouseenter="enter('-2653602182005192069');" onmouseout="out('-2653602182005192069');" style=""><abbr title=" 152      protected final List&lt;PostRegistrationObserver&gt; postRegisterListeners = new ArrayList&lt;PostRegistrationObserver&gt;();"> 152      protected final List&lt;PostRegistrationObserver&gt; postRegisterListeners = new ArrayList&lt;PostRegistrationObserver&gt;ðŸ”µ</abbr></span>
<span class="6843669015915819090" onmouseenter="enter('6843669015915819090');" onmouseout="out('6843669015915819090');" style=""> 153      protected List&lt;PasswordUpdatedHandler&gt; passwordResetHandlers = new ArrayList&lt;PasswordUpdatedHandler&gt;();       </span>
<span class="-6685798853959138604" onmouseenter="enter('-6685798853959138604');" onmouseout="out('-6685798853959138604');" style=""> 154      protected List&lt;PasswordUpdatedHandler&gt; passwordChangedHandlers = new ArrayList&lt;PasswordUpdatedHandler&gt;();     </span>
<span  style=""> 155                                                                                                                    </span>
<span class="4044368105913417302" onmouseenter="enter('4044368105913417302');" onmouseout="out('4044368105913417302');" style=""> 156      //will be externalId field weaved to Customer entity or not                                                   </span>
<span class="-1791486485879189479" onmouseenter="enter('-1791486485879189479');" onmouseout="out('-1791486485879189479');" style=""> 157      @Value(&quot;${enable.weave.customer.externalId:false}&quot;)                                                           </span>
<span class="-1142421587851154233" onmouseenter="enter('-1142421587851154233');" onmouseout="out('-1142421587851154233');" style=""> 158      protected boolean enableCustomerExternalId = false;                                                           </span>
<span  style=""> 159                                                                                                                    </span>
<span  style=""> 160                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 161      /**                                                                                                           </span>
<span class="-4407931552763383858" onmouseenter="enter('-4407931552763383858');" onmouseout="out('-4407931552763383858');" style=""><abbr title=" 162       * &lt;p&gt;Sets either {@link #passwordEncoder} or {@link #passwordEncoderNew} based on the type of {@link #passwordEncoderBean}"> 162       * &lt;p&gt;Sets either {@link #passwordEncoder} or {@link #passwordEncoderNew} based on the type of {@link #passworðŸ”µ</abbr></span>
<span class="-1649014883369305760" onmouseenter="enter('-1649014883369305760');" onmouseout="out('-1649014883369305760');" style=""><abbr title=" 163       * in order to provide bean configuration backwards compatibility with the deprecated {@link org.springframework.security.authentication.encoding.PasswordEncoder PasswordEncoder} bean."> 163       * in order to provide bean configuration backwards compatibility with the deprecated {@link org.springframewoðŸ”µ</abbr></span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 164       * &lt;p&gt;                                                                                                        </span>
<span class="2916517283478994056" onmouseenter="enter('2916517283478994056');" onmouseout="out('2916517283478994056');" style=""><abbr title=" 165       * &lt;p&gt;{@link #passwordEncoderBean} is set by the bean defined as &quot;blPasswordEncoder&quot; and can be changed with {@link #setPasswordEncoder(Object)}."> 165       * &lt;p&gt;{@link #passwordEncoderBean} is set by the bean defined as &quot;blPasswordEncoder&quot; and can be changed with {ðŸ”µ</abbr></span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 166       * &lt;p&gt;                                                                                                        </span>
<span class="5394505181252316608" onmouseenter="enter('5394505181252316608');" onmouseout="out('5394505181252316608');" style=""><abbr title=" 167       * &lt;p&gt;This class will utilize either the new or deprecated PasswordEncoder type depending on which is not null."> 167       * &lt;p&gt;This class will utilize either the new or deprecated PasswordEncoder type depending on which is not nullðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 168       *                                                                                                            </span>
<span class="6775226299117941025" onmouseenter="enter('6775226299117941025');" onmouseout="out('6775226299117941025');" style=""><abbr title=" 169       * @throws NoSuchBeanDefinitionException if {@link #passwordEncoderBean} is null or not an instance of either PasswordEncoder"> 169       * @throws NoSuchBeanDefinitionException if {@link #passwordEncoderBean} is null or not an instance of either ðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 170       */                                                                                                           </span>
<span class="-5680397040643859011" onmouseenter="enter('-5680397040643859011');" onmouseout="out('-5680397040643859011');" style=""> 171      @PostConstruct                                                                                                </span>
<span class="-9033819671974505465" onmouseenter="enter('-9033819671974505465');" onmouseout="out('-9033819671974505465');" style=""> 172      protected void setupPasswordEncoder() {                                                                       </span>
<span class="5660332138432044988" onmouseenter="enter('5660332138432044988');" onmouseout="out('5660332138432044988');" style=""> 173          passwordEncoderNew = null;                                                                                </span>
<span class="-655330175315724162" onmouseenter="enter('-655330175315724162');" onmouseout="out('-655330175315724162');" style=""> 174          passwordEncoder = null;                                                                                   </span>
<span class="-5456593704911205290" onmouseenter="enter('-5456593704911205290');" onmouseout="out('-5456593704911205290');" style=""> 175          if (passwordEncoderBean instanceof PasswordEncoder) {                                                     </span>
<span class="-3528230463178033621" onmouseenter="enter('-3528230463178033621');" onmouseout="out('-3528230463178033621');" style=""> 176              passwordEncoderNew = (PasswordEncoder) passwordEncoderBean;                                           </span>
<span class="4365730940590148824" onmouseenter="enter('4365730940590148824');" onmouseout="out('4365730940590148824');" style=""><abbr title=" 177          } else if (passwordEncoderBean instanceof org.springframework.security.authentication.encoding.PasswordEncoder) {"> 177          } else if (passwordEncoderBean instanceof org.springframework.security.authentication.encoding.PasswordEncðŸ”µ</abbr></span>
<span class="5435318175073096814" onmouseenter="enter('5435318175073096814');" onmouseout="out('5435318175073096814');" style=""><abbr title=" 178              passwordEncoder = (org.springframework.security.authentication.encoding.PasswordEncoder) passwordEncoderBean;"> 178              passwordEncoder = (org.springframework.security.authentication.encoding.PasswordEncoder) passwordEncodðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 179          } else {                                                                                                  </span>
<span class="-302697915557926133" onmouseenter="enter('-302697915557926133');" onmouseout="out('-302697915557926133');" style=""> 180              throw new NoSuchBeanDefinitionException(&quot;No PasswordEncoder bean is defined&quot;);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182      }                                                                                                             </span>
<span  style=""> 183                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 184      @Override                                                                                                     </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 185      @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                                  </span>
<span class="8291295402928429592" onmouseenter="enter('8291295402928429592');" onmouseout="out('8291295402928429592');" style=""> 186      public Customer saveCustomer(Customer customer) {                                                             </span>
<span class="-4698478172885390647" onmouseenter="enter('-4698478172885390647');" onmouseout="out('-4698478172885390647');" style=""> 187          return saveCustomer(customer, customer.isRegistered());                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188      }                                                                                                             </span>
<span  style=""> 189                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 190      @Override                                                                                                     </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 191      @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                                  </span>
<span class="201381677109704887" onmouseenter="enter('201381677109704887');" onmouseout="out('201381677109704887');" style=""> 192      public Customer saveCustomer(Customer customer, boolean register) {                                           </span>
<span class="6726515726770360071" onmouseenter="enter('6726515726770360071');" onmouseout="out('6726515726770360071');" style=""> 193          if (register &amp;&amp; !customer.isRegistered()) {                                                               </span>
<span class="2527359489469298483" onmouseenter="enter('2527359489469298483');" onmouseout="out('2527359489469298483');" style=""> 194              customer.setRegistered(true);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195          }                                                                                                         </span>
<span  style=""> 196                                                                                                                    </span>
<span class="-2753421557322414072" onmouseenter="enter('-2753421557322414072');" onmouseout="out('-2753421557322414072');" style=""> 197          if (customer.getUnencodedPassword() != null) {                                                            </span>
<span class="7206521027030929296" onmouseenter="enter('7206521027030929296');" onmouseout="out('7206521027030929296');" style=""> 198              customer.setPassword(encodePassword(customer.getUnencodedPassword(), customer));                      </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199          }                                                                                                         </span>
<span  style=""> 200                                                                                                                    </span>
<span class="-1576073390989032571" onmouseenter="enter('-1576073390989032571');" onmouseout="out('-1576073390989032571');" style=""> 201          // let&#x27;s make sure they entered a new challenge answer (we will populate                                  </span>
<span class="-2819530999572063421" onmouseenter="enter('-2819530999572063421');" onmouseout="out('-2819530999572063421');" style=""> 202          // the password field with hashed values so check that they have changed                                  </span>
<span class="-9126181688236016532" onmouseenter="enter('-9126181688236016532');" onmouseout="out('-9126181688236016532');" style=""> 203          // id                                                                                                     </span>
<span class="-8509665365452883594" onmouseenter="enter('-8509665365452883594');" onmouseout="out('-8509665365452883594');" style=""><abbr title=" 204          if (customer.getUnencodedChallengeAnswer() != null &amp;&amp; !customer.getUnencodedChallengeAnswer().equals(customer.getChallengeAnswer())) {"> 204          if (customer.getUnencodedChallengeAnswer() != null &amp;&amp; !customer.getUnencodedChallengeAnswer().equals(custoðŸ”µ</abbr></span>
<span class="-4759540663853101916" onmouseenter="enter('-4759540663853101916');" onmouseout="out('-4759540663853101916');" style=""> 205              customer.setChallengeAnswer(encodePassword(customer.getUnencodedChallengeAnswer(), customer));        </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206          }                                                                                                         </span>
<span class="3406416334930679557" onmouseenter="enter('3406416334930679557');" onmouseout="out('3406416334930679557');" style=""> 207          return customerDao.save(customer);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208      }                                                                                                             </span>
<span  style=""> 209                                                                                                                    </span>
<span class="-137997900411835717" onmouseenter="enter('-137997900411835717');" onmouseout="out('-137997900411835717');" style=""> 210      protected String generateSecurePassword() {                                                                   </span>
<span class="-4377176751133654653" onmouseenter="enter('-4377176751133654653');" onmouseout="out('-4377176751133654653');" style=""> 211          return PasswordUtils.generateSecurePassword(PASSWORD_LENGTH);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212      }                                                                                                             </span>
<span  style=""> 213                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 214      @Override                                                                                                     </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 215      @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                                  </span>
<span class="3910349330927871049" onmouseenter="enter('3910349330927871049');" onmouseout="out('3910349330927871049');" style=""> 216      public Customer registerCustomer(Customer customer, String password, String passwordConfirm) {                </span>
<span class="2527359489469298483" onmouseenter="enter('2527359489469298483');" onmouseout="out('2527359489469298483');" style=""> 217          customer.setRegistered(true);                                                                             </span>
<span  style=""> 218                                                                                                                    </span>
<span class="-5009800104120858890" onmouseenter="enter('-5009800104120858890');" onmouseout="out('-5009800104120858890');" style=""> 219          // When unencodedPassword is set the save() will encode it                                                </span>
<span class="5360015832768603745" onmouseenter="enter('5360015832768603745');" onmouseout="out('5360015832768603745');" style=""> 220          if (customer.getId() == null) {                                                                           </span>
<span class="-5488615021987588883" onmouseenter="enter('-5488615021987588883');" onmouseout="out('-5488615021987588883');" style=""> 221              customer.setId(findNextCustomerId());                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222          }                                                                                                         </span>
<span class="5101903206908082309" onmouseenter="enter('5101903206908082309');" onmouseout="out('5101903206908082309');" style=""> 223          customer.setUnencodedPassword(password);                                                                  </span>
<span class="-1307190252670550775" onmouseenter="enter('-1307190252670550775');" onmouseout="out('-1307190252670550775');" style=""> 224          Customer retCustomer = saveCustomer(customer);                                                            </span>
<span class="-7993851139681656451" onmouseenter="enter('-7993851139681656451');" onmouseout="out('-7993851139681656451');" style=""> 225          createRegisteredCustomerRoles(retCustomer);                                                               </span>
<span  style=""> 226                                                                                                                    </span>
<span class="8884608966566249698" onmouseenter="enter('8884608966566249698');" onmouseout="out('8884608966566249698');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 227 -        HashMap&lt;String, Object&gt; vars = new HashMap&lt;String, Object&gt;();                                             </span>
<span class="927525200984107152" onmouseenter="enter('927525200984107152');" onmouseout="out('927525200984107152');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 228 -        vars.put(&quot;customer&quot;, retCustomer);                                                                        </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 229 -                                                                                                                  </span>
<span class="1359701208755121342" onmouseenter="enter('1359701208755121342');" onmouseout="out('1359701208755121342');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 230 -        sendEmail(customer.getEmailAddress(), getRegistrationEmailInfo(), vars);                                  </span>
<span class="-3489922120474106740" onmouseenter="enter('-3489922120474106740');" onmouseout="out('-3489922120474106740');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 231 +        eventPublisher.publishEvent(new RegisterCustomerEvent(this, retCustomer.getId()));                        </span>
<span class="-3623043072901839896" onmouseenter="enter('-3623043072901839896');" onmouseout="out('-3623043072901839896');" style=""> 232          notifyPostRegisterListeners(retCustomer);                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 233 +                                                                                                                  </span>
<span class="-6683456484294032112" onmouseenter="enter('-6683456484294032112');" onmouseout="out('-6683456484294032112');" style=""> 234          return retCustomer;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235      }                                                                                                             </span>
<span  style=""> 236                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 237      @Override                                                                                                     </span>
<span class="-8989473089684210869" onmouseenter="enter('-8989473089684210869');" onmouseout="out('-8989473089684210869');" style=""> 238      public void createRegisteredCustomerRoles(Customer customer) {                                                </span>
<span class="-967668152739756369" onmouseenter="enter('-967668152739756369');" onmouseout="out('-967668152739756369');" style=""> 239          Role role = roleDao.readRoleByName(&quot;ROLE_USER&quot;);                                                          </span>
<span class="-7484208420944991016" onmouseenter="enter('-7484208420944991016');" onmouseout="out('-7484208420944991016');" style=""> 240          CustomerRole customerRole = new CustomerRoleImpl();                                                       </span>
<span class="-3544050209899951111" onmouseenter="enter('-3544050209899951111');" onmouseout="out('-3544050209899951111');" style=""> 241          customerRole.setRole(role);                                                                               </span>
<span class="-4836769794727897713" onmouseenter="enter('-4836769794727897713');" onmouseout="out('-4836769794727897713');" style=""> 242          customerRole.setCustomer(customer);                                                                       </span>
<span class="2561970876173710740" onmouseenter="enter('2561970876173710740');" onmouseout="out('2561970876173710740');" style=""> 243          roleDao.addRoleToCustomer(customerRole);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244      }                                                                                                             </span>
<span  style=""> 245                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 246      @Override                                                                                                     </span>
<span class="-8289498668946854999" onmouseenter="enter('-8289498668946854999');" onmouseout="out('-8289498668946854999');" style=""> 247      public Customer readCustomerByEmail(String emailAddress) {                                                    </span>
<span class="6996298339377860417" onmouseenter="enter('6996298339377860417');" onmouseout="out('6996298339377860417');" style=""> 248          return customerDao.readCustomerByEmail(emailAddress);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249      }                                                                                                             </span>
<span  style=""> 250                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 251      @Override                                                                                                     </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 252      @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                                  </span>
<span class="2373324961324130685" onmouseenter="enter('2373324961324130685');" onmouseout="out('2373324961324130685');" style=""> 253      public Customer changePassword(PasswordChange passwordChange) {                                               </span>
<span class="-5344336587939476831" onmouseenter="enter('-5344336587939476831');" onmouseout="out('-5344336587939476831');" style=""> 254          Customer customer = readCustomerByUsername(passwordChange.getUsername());                                 </span>
<span class="3635027652328433999" onmouseenter="enter('3635027652328433999');" onmouseout="out('3635027652328433999');" style=""> 255          customer.setUnencodedPassword(passwordChange.getNewPassword());                                           </span>
<span class="9175276796642533968" onmouseenter="enter('9175276796642533968');" onmouseout="out('9175276796642533968');" style=""> 256          customer.setPasswordChangeRequired(passwordChange.getPasswordChangeRequired());                           </span>
<span class="5791162324212808512" onmouseenter="enter('5791162324212808512');" onmouseout="out('5791162324212808512');" style=""> 257          customer = saveCustomer(customer);                                                                        </span>
<span  style=""> 258                                                                                                                    </span>
<span class="1758176125617219344" onmouseenter="enter('1758176125617219344');" onmouseout="out('1758176125617219344');" style=""> 259          for (PasswordUpdatedHandler handler : passwordChangedHandlers) {                                          </span>
<span class="-390754915565928691" onmouseenter="enter('-390754915565928691');" onmouseout="out('-390754915565928691');" style=""> 260              handler.passwordChanged(passwordChange, customer, passwordChange.getNewPassword());                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261          }                                                                                                         </span>
<span  style=""> 262                                                                                                                    </span>
<span class="-3853204766136593997" onmouseenter="enter('-3853204766136593997');" onmouseout="out('-3853204766136593997');" style=""> 263          return customer;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264      }                                                                                                             </span>
<span  style=""> 265                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 266      @Override                                                                                                     </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 267      @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                                  </span>
<span class="-8338050129523775592" onmouseenter="enter('-8338050129523775592');" onmouseout="out('-8338050129523775592');" style=""> 268      public Customer resetPassword(PasswordReset passwordReset) {                                                  </span>
<span class="6805273026067147007" onmouseenter="enter('6805273026067147007');" onmouseout="out('6805273026067147007');" style=""> 269          Customer customer = readCustomerByUsername(passwordReset.getUsername());                                  </span>
<span class="-122847483108952780" onmouseenter="enter('-122847483108952780');" onmouseout="out('-122847483108952780');" style=""> 270          String newPassword = PasswordUtils.generateSecurePassword(passwordReset.getPasswordLength());             </span>
<span class="-62325817623586886" onmouseenter="enter('-62325817623586886');" onmouseout="out('-62325817623586886');" style=""> 271          customer.setUnencodedPassword(newPassword);                                                               </span>
<span class="6853349384480559800" onmouseenter="enter('6853349384480559800');" onmouseout="out('6853349384480559800');" style=""> 272          customer.setPasswordChangeRequired(passwordReset.getPasswordChangeRequired());                            </span>
<span class="5791162324212808512" onmouseenter="enter('5791162324212808512');" onmouseout="out('5791162324212808512');" style=""> 273          customer = saveCustomer(customer);                                                                        </span>
<span  style=""> 274                                                                                                                    </span>
<span class="265370277489880531" onmouseenter="enter('265370277489880531');" onmouseout="out('265370277489880531');" style=""> 275          for (PasswordUpdatedHandler handler : passwordResetHandlers) {                                            </span>
<span class="8731392908076423696" onmouseenter="enter('8731392908076423696');" onmouseout="out('8731392908076423696');" style=""> 276              handler.passwordChanged(passwordReset, customer, newPassword);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277          }                                                                                                         </span>
<span  style=""> 278                                                                                                                    </span>
<span class="-3853204766136593997" onmouseenter="enter('-3853204766136593997');" onmouseout="out('-3853204766136593997');" style=""> 279          return customer;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280      }                                                                                                             </span>
<span  style=""> 281                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 282      @Override                                                                                                     </span>
<span class="-2286441478570387081" onmouseenter="enter('-2286441478570387081');" onmouseout="out('-2286441478570387081');" style=""> 283      public void addPostRegisterListener(PostRegistrationObserver postRegisterListeners) {                         </span>
<span class="2003689350872197572" onmouseenter="enter('2003689350872197572');" onmouseout="out('2003689350872197572');" style=""> 284          this.postRegisterListeners.add(postRegisterListeners);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285      }                                                                                                             </span>
<span  style=""> 286                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 287      @Override                                                                                                     </span>
<span class="-1507687767132611253" onmouseenter="enter('-1507687767132611253');" onmouseout="out('-1507687767132611253');" style=""> 288      public void removePostRegisterListener(PostRegistrationObserver postRegisterListeners) {                      </span>
<span class="8851186764245103017" onmouseenter="enter('8851186764245103017');" onmouseout="out('8851186764245103017');" style=""> 289          if (this.postRegisterListeners.contains(postRegisterListeners)) {                                         </span>
<span class="7168411145839318905" onmouseenter="enter('7168411145839318905');" onmouseout="out('7168411145839318905');" style=""> 290              this.postRegisterListeners.remove(postRegisterListeners);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292      }                                                                                                             </span>
<span  style=""> 293                                                                                                                    </span>
<span class="3762831862655692775" onmouseenter="enter('3762831862655692775');" onmouseout="out('3762831862655692775');" style=""> 294      protected void notifyPostRegisterListeners(Customer customer) {                                               </span>
<span class="-5517241395960310234" onmouseenter="enter('-5517241395960310234');" onmouseout="out('-5517241395960310234');" style=""> 295          for (Iterator&lt;PostRegistrationObserver&gt; iter = postRegisterListeners.iterator(); iter.hasNext(); ) {      </span>
<span class="6852498861939683938" onmouseenter="enter('6852498861939683938');" onmouseout="out('6852498861939683938');" style=""> 296              PostRegistrationObserver listener = iter.next();                                                      </span>
<span class="2537062439441145073" onmouseenter="enter('2537062439441145073');" onmouseout="out('2537062439441145073');" style=""> 297              listener.processRegistrationEvent(customer);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299      }                                                                                                             </span>
<span  style=""> 300                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 301      @Override                                                                                                     </span>
<span class="-6715127601332863552" onmouseenter="enter('-6715127601332863552');" onmouseout="out('-6715127601332863552');" style=""> 302      public Customer createCustomer() {                                                                            </span>
<span class="1533232953867480113" onmouseenter="enter('1533232953867480113');" onmouseout="out('1533232953867480113');" style=""> 303          return createCustomerFromId(null);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304      }                                                                                                             </span>
<span  style=""> 305                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 306      @Override                                                                                                     </span>
<span class="-3260175922123749747" onmouseenter="enter('-3260175922123749747');" onmouseout="out('-3260175922123749747');" style=""> 307      public Customer createCustomerFromId(Long customerId) {                                                       </span>
<span class="4846947630103792555" onmouseenter="enter('4846947630103792555');" onmouseout="out('4846947630103792555');" style=""> 308          Customer customer = customerId != null ? readCustomerById(customerId) : null;                             </span>
<span class="-1371412200964570990" onmouseenter="enter('-1371412200964570990');" onmouseout="out('-1371412200964570990');" style=""> 309          if (customer == null) {                                                                                   </span>
<span class="7584512027447697158" onmouseenter="enter('7584512027447697158');" onmouseout="out('7584512027447697158');" style=""> 310              customer = customerDao.create();                                                                      </span>
<span class="-8452861246579893242" onmouseenter="enter('-8452861246579893242');" onmouseout="out('-8452861246579893242');" style=""> 311              if (customerId != null) {                                                                             </span>
<span class="1431826176080351208" onmouseenter="enter('1431826176080351208');" onmouseout="out('1431826176080351208');" style=""> 312                  customer.setId(customerId);                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 313              } else {                                                                                              </span>
<span class="-5488615021987588883" onmouseenter="enter('-5488615021987588883');" onmouseout="out('-5488615021987588883');" style=""> 314                  customer.setId(findNextCustomerId());                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316          }                                                                                                         </span>
<span class="-3853204766136593997" onmouseenter="enter('-3853204766136593997');" onmouseout="out('-3853204766136593997');" style=""> 317          return customer;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318      }                                                                                                             </span>
<span  style=""> 319                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 320      @Override                                                                                                     </span>
<span class="4598906423026393934" onmouseenter="enter('4598906423026393934');" onmouseout="out('4598906423026393934');" style=""> 321      public Long findNextCustomerId() {                                                                            </span>
<span class="-8819565094085247576" onmouseenter="enter('-8819565094085247576');" onmouseout="out('-8819565094085247576');" style=""> 322          return idGenerationService.findNextId(Customer.class.getCanonicalName());                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323      }                                                                                                             </span>
<span  style=""> 324                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 325      @Override                                                                                                     </span>
<span class="-6999511709583967120" onmouseenter="enter('-6999511709583967120');" onmouseout="out('-6999511709583967120');" style=""> 326      public Customer createNewCustomer() {                                                                         </span>
<span class="1533232953867480113" onmouseenter="enter('1533232953867480113');" onmouseout="out('1533232953867480113');" style=""> 327          return createCustomerFromId(null);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328      }                                                                                                             </span>
<span  style=""> 329                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 330      @Override                                                                                                     </span>
<span class="7417643297497909843" onmouseenter="enter('7417643297497909843');" onmouseout="out('7417643297497909843');" style=""> 331      public void deleteCustomer(Customer customer) {                                                               </span>
<span class="-3138548839038622796" onmouseenter="enter('-3138548839038622796');" onmouseout="out('-3138548839038622796');" style=""> 332          roleDao.removeCustomerRolesByCustomerId(customer.getId());                                                </span>
<span class="-3819399187793284937" onmouseenter="enter('-3819399187793284937');" onmouseout="out('-3819399187793284937');" style=""> 333          customerDao.delete(customer);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334      }                                                                                                             </span>
<span  style=""> 335                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 336      @Override                                                                                                     </span>
<span class="-5885291655878307572" onmouseenter="enter('-5885291655878307572');" onmouseout="out('-5885291655878307572');" style=""> 337      public Customer readCustomerByUsername(String username) {                                                     </span>
<span class="589313108944980188" onmouseenter="enter('589313108944980188');" onmouseout="out('589313108944980188');" style=""> 338          return customerDao.readCustomerByUsername(username);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339      }                                                                                                             </span>
<span  style=""> 340                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 341      @Override                                                                                                     </span>
<span class="847254476985500634" onmouseenter="enter('847254476985500634');" onmouseout="out('847254476985500634');" style=""> 342      public Customer readCustomerByUsername(String username, Boolean cacheable) {                                  </span>
<span class="482041631891506127" onmouseenter="enter('482041631891506127');" onmouseout="out('482041631891506127');" style=""> 343          return customerDao.readCustomerByUsername(username, cacheable);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 344      }                                                                                                             </span>
<span  style=""> 345                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 346      @Override                                                                                                     </span>
<span class="-4374586036231570864" onmouseenter="enter('-4374586036231570864');" onmouseout="out('-4374586036231570864');" style=""> 347      public Customer readCustomerById(Long id) {                                                                   </span>
<span class="-5062162633750648527" onmouseenter="enter('-5062162633750648527');" onmouseout="out('-5062162633750648527');" style=""> 348          return customerDao.readCustomerById(id);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349      }                                                                                                             </span>
<span  style=""> 350                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 351      @Override                                                                                                     </span>
<span class="6825989998352983316" onmouseenter="enter('6825989998352983316');" onmouseout="out('6825989998352983316');" style=""> 352      public Customer readCustomerByExternalId(String userExternalId) {                                             </span>
<span class="-3340978842460957300" onmouseenter="enter('-3340978842460957300');" onmouseout="out('-3340978842460957300');" style=""> 353          if (enableCustomerExternalId) {                                                                           </span>
<span class="5025115365525563343" onmouseenter="enter('5025115365525563343');" onmouseout="out('5025115365525563343');" style=""> 354              return customerDao.readCustomerByExternalId(userExternalId);                                          </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 355          }else{                                                                                                    </span>
<span class="7148337299926873627" onmouseenter="enter('7148337299926873627');" onmouseout="out('7148337299926873627');" style=""><abbr title=" 356              LOG.error(&quot;attempt to find customer by externalId while property enable.weave.customer.externalId is false. Import module is responsible for weaving externalId field to customer&quot;);"> 356              LOG.error(&quot;attempt to find customer by externalId while property enable.weave.customer.externalId is fðŸ”µ</abbr></span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 357              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358          }                                                                                                         </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 359      }                                                                                                             </span>
<span  style=""> 360                                                                                                                    </span>
<span class="-8304645560568857694" onmouseenter="enter('-8304645560568857694');" onmouseout="out('-8304645560568857694');" style=""> 361      public void setCustomerDao(CustomerDao customerDao) {                                                         </span>
<span class="-1477678724397974795" onmouseenter="enter('-1477678724397974795');" onmouseout="out('-1477678724397974795');" style=""> 362          this.customerDao = customerDao;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363      }                                                                                                             </span>
<span  style=""> 364                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 365      /**                                                                                                           </span>
<span class="5030104489111136142" onmouseenter="enter('5030104489111136142');" onmouseout="out('5030104489111136142');" style=""> 366       * &lt;p&gt;Set the passwordEncoder to be used by this class.                                                       </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 367       * &lt;p&gt;                                                                                                        </span>
<span class="-5531556154513737333" onmouseenter="enter('-5531556154513737333');" onmouseout="out('-5531556154513737333');" style=""> 368       * &lt;p&gt;This method will indirectly set one of the two PasswordEncoder member variables, depending on its type  </span>
<span class="2131779599869858629" onmouseenter="enter('2131779599869858629');" onmouseout="out('2131779599869858629');" style=""> 369       * by calling {@link #setupPasswordEncoder()}                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 370       *                                                                                                            </span>
<span class="5471445359553795451" onmouseenter="enter('5471445359553795451');" onmouseout="out('5471445359553795451');" style=""><abbr title=" 371       * @param passwordEncoder Either Spring Security&#x27;s new {@link PasswordEncoder}, or the deprecated {@link org.springframework.security.authentication.encoding.PasswordEncoder PasswordEncoder}"> 371       * @param passwordEncoder Either Spring Security&#x27;s new {@link PasswordEncoder}, or the deprecated {@link org.sðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 372       */                                                                                                           </span>
<span class="5510978142694982881" onmouseenter="enter('5510978142694982881');" onmouseout="out('5510978142694982881');" style=""> 373      public void setPasswordEncoder(Object passwordEncoder) {                                                      </span>
<span class="-1060974872196977525" onmouseenter="enter('-1060974872196977525');" onmouseout="out('-1060974872196977525');" style=""> 374          this.passwordEncoderBean = passwordEncoder;                                                               </span>
<span class="7284584147086462796" onmouseenter="enter('7284584147086462796');" onmouseout="out('7284584147086462796');" style=""> 375          setupPasswordEncoder();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376      }                                                                                                             </span>
<span  style=""> 377                                                                                                                    </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 378      @Deprecated                                                                                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 379      @Override                                                                                                     </span>
<span class="-1320715505240530691" onmouseenter="enter('-1320715505240530691');" onmouseout="out('-1320715505240530691');" style=""> 380      public Object getSalt(Customer customer) {                                                                    </span>
<span class="7310613093023919346" onmouseenter="enter('7310613093023919346');" onmouseout="out('7310613093023919346');" style=""> 381          return getSalt(customer, &quot;&quot;);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 382      }                                                                                                             </span>
<span  style=""> 383                                                                                                                    </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 384      @Deprecated                                                                                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 385      @Override                                                                                                     </span>
<span class="-1353881738494162545" onmouseenter="enter('-1353881738494162545');" onmouseout="out('-1353881738494162545');" style=""> 386      public Object getSalt(Customer customer, String unencodedPassword) {                                          </span>
<span class="-7916743778127639214" onmouseenter="enter('-7916743778127639214');" onmouseout="out('-7916743778127639214');" style=""> 387          Object salt = null;                                                                                       </span>
<span class="-476224562332695723" onmouseenter="enter('-476224562332695723');" onmouseout="out('-476224562332695723');" style=""> 388          if (saltSource != null &amp;&amp; customer != null) {                                                             </span>
<span class="-5717209493067542388" onmouseenter="enter('-5717209493067542388');" onmouseout="out('-5717209493067542388');" style=""><abbr title=" 389              salt = saltSource.getSalt(new CustomerUserDetails(customer.getId(), customer.getUsername(), unencodedPassword, new ArrayList&lt;GrantedAuthority&gt;()));"> 389              salt = saltSource.getSalt(new CustomerUserDetails(customer.getId(), customer.getUsername(), unencodedPðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390          }                                                                                                         </span>
<span class="3431775854604648548" onmouseenter="enter('3431775854604648548');" onmouseout="out('3431775854604648548');" style=""> 391          return salt;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392      }                                                                                                             </span>
<span  style=""> 393                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 394      /**                                                                                                           </span>
<span class="-3501183731792941420" onmouseenter="enter('-3501183731792941420');" onmouseout="out('-3501183731792941420');" style=""><abbr title=" 395       * Delegates to either the new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.authentication.encoding.PasswordEncoder PasswordEncoder}."> 395       * Delegates to either the new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.aðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 396       *                                                                                                            </span>
<span class="-6973500330076487399" onmouseenter="enter('-6973500330076487399');" onmouseout="out('-6973500330076487399');" style=""> 397       * @param rawPassword the unencoded password                                                                  </span>
<span class="-5399617810406361465" onmouseenter="enter('-5399617810406361465');" onmouseout="out('-5399617810406361465');" style=""> 398       * @param salt        the optional salt                                                                       </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 399       * @return                                                                                                    </span>
<span class="3447978539938514357" onmouseenter="enter('3447978539938514357');" onmouseout="out('3447978539938514357');" style=""><abbr title=" 400       * @deprecated the new {@link org.springframework.security.crypto.password.PasswordEncoder PasswordEncoder} handles salting internally, this will be removed in 4.2"> 400       * @deprecated the new {@link org.springframework.security.crypto.password.PasswordEncoder PasswordEncoder} haðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 401       */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 402      @Deprecated                                                                                                   </span>
<span class="-5592137063291194297" onmouseenter="enter('-5592137063291194297');" onmouseout="out('-5592137063291194297');" style=""> 403      protected String encodePass(String rawPassword, Object salt) {                                                </span>
<span class="-7232422938046234962" onmouseenter="enter('-7232422938046234962');" onmouseout="out('-7232422938046234962');" style=""> 404          if (usingDeprecatedPasswordEncoder()) {                                                                   </span>
<span class="5931714538865276294" onmouseenter="enter('5931714538865276294');" onmouseout="out('5931714538865276294');" style=""> 405              return passwordEncoder.encodePassword(rawPassword, salt);                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 406          } else {                                                                                                  </span>
<span class="-7923712831729422017" onmouseenter="enter('-7923712831729422017');" onmouseout="out('-7923712831729422017');" style=""> 407              return encodePassword(rawPassword);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 408          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 409      }                                                                                                             </span>
<span  style=""> 410                                                                                                                    </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 411      @Deprecated                                                                                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 412      @Override                                                                                                     </span>
<span class="-2464018960647785128" onmouseenter="enter('-2464018960647785128');" onmouseout="out('-2464018960647785128');" style=""> 413      public String encodePassword(String rawPassword, Customer customer) {                                         </span>
<span class="5068564850157074346" onmouseenter="enter('5068564850157074346');" onmouseout="out('5068564850157074346');" style=""> 414          return encodePass(rawPassword, getSalt(customer, rawPassword));                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415      }                                                                                                             </span>
<span  style=""> 416                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 417      @Override                                                                                                     </span>
<span class="-280180772892908532" onmouseenter="enter('-280180772892908532');" onmouseout="out('-280180772892908532');" style=""> 418      public String encodePassword(String rawPassword) {                                                            </span>
<span class="-8081074490464189240" onmouseenter="enter('-8081074490464189240');" onmouseout="out('-8081074490464189240');" style=""> 419          return passwordEncoderNew.encode(rawPassword);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420      }                                                                                                             </span>
<span  style=""> 421                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 422      /**                                                                                                           </span>
<span class="-3501183731792941420" onmouseenter="enter('-3501183731792941420');" onmouseout="out('-3501183731792941420');" style=""><abbr title=" 423       * Delegates to either the new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.authentication.encoding.PasswordEncoder PasswordEncoder}."> 423       * Delegates to either the new {@link PasswordEncoder} or the deprecated {@link org.springframework.security.aðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 424       *                                                                                                            </span>
<span class="8775114664172586259" onmouseenter="enter('8775114664172586259');" onmouseout="out('8775114664172586259');" style=""> 425       * @param rawPassword     the unencoded password                                                              </span>
<span class="-1452544259905793680" onmouseenter="enter('-1452544259905793680');" onmouseout="out('-1452544259905793680');" style=""> 426       * @param encodedPassword the encoded password to compare rawPassword against                                 </span>
<span class="1972573824148461217" onmouseenter="enter('1972573824148461217');" onmouseout="out('1972573824148461217');" style=""> 427       * @param salt            the optional salt                                                                   </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 428       * @return                                                                                                    </span>
<span class="3447978539938514357" onmouseenter="enter('3447978539938514357');" onmouseout="out('3447978539938514357');" style=""><abbr title=" 429       * @deprecated the new {@link org.springframework.security.crypto.password.PasswordEncoder PasswordEncoder} handles salting internally, this will be removed in 4.2"> 429       * @deprecated the new {@link org.springframework.security.crypto.password.PasswordEncoder PasswordEncoder} haðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 430       */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 431      @Deprecated                                                                                                   </span>
<span class="-5399582875183324381" onmouseenter="enter('-5399582875183324381');" onmouseout="out('-5399582875183324381');" style=""> 432      protected boolean isPassValid(String rawPassword, String encodedPassword, Object salt) {                      </span>
<span class="-7232422938046234962" onmouseenter="enter('-7232422938046234962');" onmouseout="out('-7232422938046234962');" style=""> 433          if (usingDeprecatedPasswordEncoder()) {                                                                   </span>
<span class="-6959686797048566137" onmouseenter="enter('-6959686797048566137');" onmouseout="out('-6959686797048566137');" style=""> 434              return passwordEncoder.isPasswordValid(encodedPassword, rawPassword, salt);                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 435          } else {                                                                                                  </span>
<span class="-3664185127944007144" onmouseenter="enter('-3664185127944007144');" onmouseout="out('-3664185127944007144');" style=""> 436              return isPasswordValid(rawPassword, encodedPassword);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 438      }                                                                                                             </span>
<span  style=""> 439                                                                                                                    </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 440      @Deprecated                                                                                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 441      @Override                                                                                                     </span>
<span class="75379594801568475" onmouseenter="enter('75379594801568475');" onmouseout="out('75379594801568475');" style=""> 442      public boolean isPasswordValid(String rawPassword, String encodedPassword, Customer customer) {               </span>
<span class="5055494700324745600" onmouseenter="enter('5055494700324745600');" onmouseout="out('5055494700324745600');" style=""> 443          return isPassValid(rawPassword, encodedPassword, getSalt(customer, rawPassword));                         </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444      }                                                                                                             </span>
<span  style=""> 445                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 446      @Override                                                                                                     </span>
<span class="160568672931299235" onmouseenter="enter('160568672931299235');" onmouseout="out('160568672931299235');" style=""> 447      public boolean isPasswordValid(String rawPassword, String encodedPassword) {                                  </span>
<span class="-3105924845719344527" onmouseenter="enter('-3105924845719344527');" onmouseout="out('-3105924845719344527');" style=""> 448          return passwordEncoderNew.matches(rawPassword, encodedPassword);                                          </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 449      }                                                                                                             </span>
<span  style=""> 450                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 451      @Override                                                                                                     </span>
<span class="8805988825869661234" onmouseenter="enter('8805988825869661234');" onmouseout="out('8805988825869661234');" style=""> 452      public boolean customerPassesCustomerRule(Customer customer, CustomerRuleHolder customerRuleHolder) {         </span>
<span class="-5898565890799276609" onmouseenter="enter('-5898565890799276609');" onmouseout="out('-5898565890799276609');" style=""> 453          String customerRule = customerRuleHolder.getCustomerRule();                                               </span>
<span class="201656563419603782" onmouseenter="enter('201656563419603782');" onmouseout="out('201656563419603782');" style=""> 454          Map&lt;String, Object&gt; ruleParams = buildCustomerRuleParams(customer);                                       </span>
<span class="-7214228236632333169" onmouseenter="enter('-7214228236632333169');" onmouseout="out('-7214228236632333169');" style=""> 455          return customerRule == null || MvelHelper.evaluateRule(customerRule, ruleParams);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 456      }                                                                                                             </span>
<span  style=""> 457                                                                                                                    </span>
<span class="-6781673542839603116" onmouseenter="enter('-6781673542839603116');" onmouseout="out('-6781673542839603116');" style=""> 458      protected Map&lt;String, Object&gt; buildCustomerRuleParams(Customer customer) {                                    </span>
<span class="-460782809524910092" onmouseenter="enter('-460782809524910092');" onmouseout="out('-460782809524910092');" style=""> 459          HashMap&lt;String, Object&gt; vars = new HashMap&lt;&gt;();                                                           </span>
<span class="8047728915418269458" onmouseenter="enter('8047728915418269458');" onmouseout="out('8047728915418269458');" style=""> 460          vars.put(&quot;customer&quot;, customer);                                                                           </span>
<span class="3198457421051297297" onmouseenter="enter('3198457421051297297');" onmouseout="out('3198457421051297297');" style=""> 461          return vars;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 462      }                                                                                                             </span>
<span  style=""> 463                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 464      @Override                                                                                                     </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 465      @Deprecated                                                                                                   </span>
<span class="5378385800373988521" onmouseenter="enter('5378385800373988521');" onmouseout="out('5378385800373988521');" style=""> 466      public String getSalt() {                                                                                     </span>
<span class="3431775854604648548" onmouseenter="enter('3431775854604648548');" onmouseout="out('3431775854604648548');" style=""> 467          return salt;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 468      }                                                                                                             </span>
<span  style=""> 469                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 470      @Override                                                                                                     </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 471      @Deprecated                                                                                                   </span>
<span class="-4361425533599957857" onmouseenter="enter('-4361425533599957857');" onmouseout="out('-4361425533599957857');" style=""> 472      public void setSalt(String salt) {                                                                            </span>
<span class="-4513734365927734086" onmouseenter="enter('-4513734365927734086');" onmouseout="out('-4513734365927734086');" style=""> 473          this.salt = salt;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 474      }                                                                                                             </span>
<span  style=""> 475                                                                                                                    </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 476      @Deprecated                                                                                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 477      @Override                                                                                                     </span>
<span class="-7604283301279549906" onmouseenter="enter('-7604283301279549906');" onmouseout="out('-7604283301279549906');" style=""> 478      public SaltSource getSaltSource() {                                                                           </span>
<span class="-904082433474924859" onmouseenter="enter('-904082433474924859');" onmouseout="out('-904082433474924859');" style=""> 479          return saltSource;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 480      }                                                                                                             </span>
<span  style=""> 481                                                                                                                    </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 482      @Deprecated                                                                                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 483      @Override                                                                                                     </span>
<span class="4344683956985852323" onmouseenter="enter('4344683956985852323');" onmouseout="out('4344683956985852323');" style=""> 484      public void setSaltSource(SaltSource saltSource) {                                                            </span>
<span class="-2983665589785658662" onmouseenter="enter('-2983665589785658662');" onmouseout="out('-2983665589785658662');" style=""> 485          this.saltSource = saltSource;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 486      }                                                                                                             </span>
<span  style=""> 487                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 488      @Override                                                                                                     </span>
<span class="-3888321916193976828" onmouseenter="enter('-3888321916193976828');" onmouseout="out('-3888321916193976828');" style=""> 489      public List&lt;PasswordUpdatedHandler&gt; getPasswordResetHandlers() {                                              </span>
<span class="6051450225877623454" onmouseenter="enter('6051450225877623454');" onmouseout="out('6051450225877623454');" style=""> 490          return passwordResetHandlers;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 491      }                                                                                                             </span>
<span  style=""> 492                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 493      @Override                                                                                                     </span>
<span class="-8491421284615626461" onmouseenter="enter('-8491421284615626461');" onmouseout="out('-8491421284615626461');" style=""> 494      public void setPasswordResetHandlers(List&lt;PasswordUpdatedHandler&gt; passwordResetHandlers) {                    </span>
<span class="-414209021704348335" onmouseenter="enter('-414209021704348335');" onmouseout="out('-414209021704348335');" style=""> 495          this.passwordResetHandlers = passwordResetHandlers;                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 496      }                                                                                                             </span>
<span  style=""> 497                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 498      @Override                                                                                                     </span>
<span class="6470870522961056065" onmouseenter="enter('6470870522961056065');" onmouseout="out('6470870522961056065');" style=""> 499      public List&lt;PasswordUpdatedHandler&gt; getPasswordChangedHandlers() {                                            </span>
<span class="-3664837019724564997" onmouseenter="enter('-3664837019724564997');" onmouseout="out('-3664837019724564997');" style=""> 500          return passwordChangedHandlers;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 501      }                                                                                                             </span>
<span  style=""> 502                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 503      @Override                                                                                                     </span>
<span class="-2683520533006850846" onmouseenter="enter('-2683520533006850846');" onmouseout="out('-2683520533006850846');" style=""> 504      public void setPasswordChangedHandlers(List&lt;PasswordUpdatedHandler&gt; passwordChangedHandlers) {                </span>
<span class="3676994793125858903" onmouseenter="enter('3676994793125858903');" onmouseout="out('3676994793125858903');" style=""> 505          this.passwordChangedHandlers = passwordChangedHandlers;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 506      }                                                                                                             </span>
<span  style=""> 507                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 508      @Override                                                                                                     </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 509      @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                                  </span>
<span class="-5238259893338926366" onmouseenter="enter('-5238259893338926366');" onmouseout="out('-5238259893338926366');" style=""> 510      public GenericResponse sendForgotUsernameNotification(String emailAddress) {                                  </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 511          GenericResponse response = new GenericResponse();                                                         </span>
<span class="-6073063203294335299" onmouseenter="enter('-6073063203294335299');" onmouseout="out('-6073063203294335299');" style=""> 512          List&lt;Customer&gt; customers = null;                                                                          </span>
<span class="-8702812354445074278" onmouseenter="enter('-8702812354445074278');" onmouseout="out('-8702812354445074278');" style=""> 513          if (emailAddress != null) {                                                                               </span>
<span class="6147069966980396471" onmouseenter="enter('6147069966980396471');" onmouseout="out('6147069966980396471');" style=""> 514              customers = customerDao.readCustomersByEmail(emailAddress);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 515          }                                                                                                         </span>
<span  style=""> 516                                                                                                                    </span>
<span class="-6772255019077760087" onmouseenter="enter('-6772255019077760087');" onmouseout="out('-6772255019077760087');" style=""> 517          if (CollectionUtils.isEmpty(customers)) {                                                                 </span>
<span class="7242450034468345273" onmouseenter="enter('7242450034468345273');" onmouseout="out('7242450034468345273');" style=""> 518              response.addErrorCode(&quot;notFound&quot;);                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 519          } else {                                                                                                  </span>
<span class="-2763458366902467863" onmouseenter="enter('-2763458366902467863');" onmouseout="out('-2763458366902467863');" style=""> 520              List&lt;String&gt; activeUsernames = new ArrayList&lt;String&gt;();                                               </span>
<span class="-5523479913680151900" onmouseenter="enter('-5523479913680151900');" onmouseout="out('-5523479913680151900');" style=""> 521              for (Customer customer : customers) {                                                                 </span>
<span class="6036228608782108118" onmouseenter="enter('6036228608782108118');" onmouseout="out('6036228608782108118');" style=""> 522                  if (!customer.isDeactivated()) {                                                                  </span>
<span class="-342072533744095855" onmouseenter="enter('-342072533744095855');" onmouseout="out('-342072533744095855');" style=""> 523                      activeUsernames.add(customer.getUsername());                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 524                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 525              }                                                                                                     </span>
<span  style=""> 526                                                                                                                    </span>
<span class="7800996103103911618" onmouseenter="enter('7800996103103911618');" onmouseout="out('7800996103103911618');" style=""> 527              if (activeUsernames.size() &gt; 0) {                                                                     </span>
<span class="8884608966566249698" onmouseenter="enter('8884608966566249698');" onmouseout="out('8884608966566249698');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 528 -                HashMap&lt;String, Object&gt; vars = new HashMap&lt;String, Object&gt;();                                     </span>
<span class="4818637068787553246" onmouseenter="enter('4818637068787553246');" onmouseout="out('4818637068787553246');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 529 -                vars.put(&quot;userNames&quot;, activeUsernames);                                                           </span>
<span class="315134285136713426" onmouseenter="enter('315134285136713426');" onmouseout="out('315134285136713426');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 530 -                sendEmail(emailAddress, getForgotUsernameEmailInfo(), vars);                                      </span>
<span class="4008741571181358527" onmouseenter="enter('4008741571181358527');" onmouseout="out('4008741571181358527');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 531 +                eventPublisher.publishEvent(new ForgotUsernameEvent(this, emailAddress, activeUsernames));        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 532              } else {                                                                                              </span>
<span class="3603576439991328525" onmouseenter="enter('3603576439991328525');" onmouseout="out('3603576439991328525');" style=""> 533                  // send inactive username found email.                                                            </span>
<span class="5510537362121156528" onmouseenter="enter('5510537362121156528');" onmouseout="out('5510537362121156528');" style=""> 534                  response.addErrorCode(&quot;inactiveUser&quot;);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 535              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 536          }                                                                                                         </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 537          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 538      }                                                                                                             </span>
<span  style=""> 539                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 540      @Override                                                                                                     </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 541      @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                                  </span>
<span class="3120849722145808131" onmouseenter="enter('3120849722145808131');" onmouseout="out('3120849722145808131');" style=""> 542      public GenericResponse sendForgotPasswordNotification(String username, String resetPasswordUrl) {             </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 543          GenericResponse response = new GenericResponse();                                                         </span>
<span class="6921810928241781426" onmouseenter="enter('6921810928241781426');" onmouseout="out('6921810928241781426');" style=""> 544          Customer customer = null;                                                                                 </span>
<span  style=""> 545                                                                                                                    </span>
<span class="-8284276918575957483" onmouseenter="enter('-8284276918575957483');" onmouseout="out('-8284276918575957483');" style=""> 546          if (username != null) {                                                                                   </span>
<span class="-104711026898859267" onmouseenter="enter('-104711026898859267');" onmouseout="out('-104711026898859267');" style=""> 547              customer = customerDao.readCustomerByUsername(username);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 548          }                                                                                                         </span>
<span  style=""> 549                                                                                                                    </span>
<span class="-3681439263985626916" onmouseenter="enter('-3681439263985626916');" onmouseout="out('-3681439263985626916');" style=""> 550          checkCustomer(customer, response);                                                                        </span>
<span  style=""> 551                                                                                                                    </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 552          if (!response.getHasErrors()) {                                                                           </span>
<span class="-8225007983262534214" onmouseenter="enter('-8225007983262534214');" onmouseout="out('-8225007983262534214');" style=""> 553              String token = PasswordUtils.generateSecurePassword(getPasswordTokenLength());                        </span>
<span class="5927756983469236234" onmouseenter="enter('5927756983469236234');" onmouseout="out('5927756983469236234');" style=""> 554              token = token.toLowerCase();                                                                          </span>
<span  style=""> 555                                                                                                                    </span>
<span class="-2882068698546261553" onmouseenter="enter('-2882068698546261553');" onmouseout="out('-2882068698546261553');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 556 -            Object salt = getSalt(customer, token);                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 557 -                                                                                                                  </span>
<span class="6651571153976219369" onmouseenter="enter('6651571153976219369');" onmouseout="out('6651571153976219369');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 558 -            String saltString = null;                                                                             </span>
<span class="-2806376417463223295" onmouseenter="enter('-2806376417463223295');" onmouseout="out('-2806376417463223295');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 559 -            if (salt != null) {                                                                                   </span>
<span class="3371007872827291513" onmouseenter="enter('3371007872827291513');" onmouseout="out('3371007872827291513');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 560 -                saltString = Hex.encodeHexString(salt.toString().getBytes());                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 561 -            }                                                                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 562 -                                                                                                                  </span>
<span class="3663219121994932306" onmouseenter="enter('3663219121994932306');" onmouseout="out('3663219121994932306');" style=""> 563              CustomerForgotPasswordSecurityToken fpst = new CustomerForgotPasswordSecurityTokenImpl();             </span>
<span class="-6310870443046136255" onmouseenter="enter('-6310870443046136255');" onmouseout="out('-6310870443046136255');" style=""> 564              fpst.setCustomerId(customer.getId());                                                                 </span>
<span class="-6468715476522634243" onmouseenter="enter('-6468715476522634243');" onmouseout="out('-6468715476522634243');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 565 -            fpst.setToken(encodePass(token, saltString));                                                         </span>
<span class="-1250878182907610155" onmouseenter="enter('-1250878182907610155');" onmouseout="out('-1250878182907610155');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 566 +            fpst.setToken(encodePassword(token));                                                                 </span>
<span class="118078353989050088" onmouseenter="enter('118078353989050088');" onmouseout="out('118078353989050088');" style=""> 567              fpst.setCreateDate(SystemTime.asDate());                                                              </span>
<span class="6850446059209105577" onmouseenter="enter('6850446059209105577');" onmouseout="out('6850446059209105577');" style=""> 568              customerForgotPasswordSecurityTokenDao.saveToken(fpst);                                               </span>
<span  style=""> 569                                                                                                                    </span>
<span class="-6985897272839950635" onmouseenter="enter('-6985897272839950635');" onmouseout="out('-6985897272839950635');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 570 -            if (usingDeprecatedPasswordEncoder() &amp;&amp; saltString != null) {                                         </span>
<span class="2358421753202301133" onmouseenter="enter('2358421753202301133');" onmouseout="out('2358421753202301133');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 571 -                token = token + &#x27;-&#x27; + saltString;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 572 -            }                                                                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 573 -                                                                                                                  </span>
<span class="8884608966566249698" onmouseenter="enter('8884608966566249698');" onmouseout="out('8884608966566249698');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 574 -            HashMap&lt;String, Object&gt; vars = new HashMap&lt;String, Object&gt;();                                         </span>
<span class="-7576751007074497786" onmouseenter="enter('-7576751007074497786');" onmouseout="out('-7576751007074497786');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 575 -            vars.put(&quot;token&quot;, token);                                                                             </span>
<span class="7676904455881888218" onmouseenter="enter('7676904455881888218');" onmouseout="out('7676904455881888218');" style=""> 576              if (!StringUtils.isEmpty(resetPasswordUrl)) {                                                         </span>
<span class="-504875606182491340" onmouseenter="enter('-504875606182491340');" onmouseout="out('-504875606182491340');" style=""> 577                  if (resetPasswordUrl.contains(&quot;?&quot;)) {                                                             </span>
<span class="-909834401001506984" onmouseenter="enter('-909834401001506984');" onmouseout="out('-909834401001506984');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 578 -                    resetPasswordUrl = resetPasswordUrl + &quot;&amp;token=&quot; + token;                                      </span>
<span class="4689815450255607142" onmouseenter="enter('4689815450255607142');" onmouseout="out('4689815450255607142');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 579 +                    resetPasswordUrl = resetPasswordUrl+&quot;&amp;token=&quot;+token;                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 580                  } else {                                                                                          </span>
<span class="-4209124057383847446" onmouseenter="enter('-4209124057383847446');" onmouseout="out('-4209124057383847446');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 581 -                    resetPasswordUrl = resetPasswordUrl + &quot;?token=&quot; + token;                                      </span>
<span class="6497934083360311601" onmouseenter="enter('6497934083360311601');" onmouseout="out('6497934083360311601');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 582 +                    resetPasswordUrl = resetPasswordUrl+&quot;?token=&quot;+token;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 583                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 584              }                                                                                                     </span>
<span class="3935125112670028800" onmouseenter="enter('3935125112670028800');" onmouseout="out('3935125112670028800');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 585 -            vars.put(&quot;resetPasswordUrl&quot;, resetPasswordUrl);                                                       </span>
<span class="543740076975682961" onmouseenter="enter('543740076975682961');" onmouseout="out('543740076975682961');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 586 -            sendEmail(customer.getEmailAddress(), getForgotPasswordEmailInfo(), vars);                            </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 587 +                                                                                                                  </span>
<span class="-8393391692837051437" onmouseenter="enter('-8393391692837051437');" onmouseout="out('-8393391692837051437');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 588 +            eventPublisher.publishEvent(new ForgotPasswordEvent(this, customer.getId(), token, resetPasswordUrl));</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 589          }                                                                                                         </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 590          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 591      }                                                                                                             </span>
<span  style=""> 592                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 593      @Override                                                                                                     </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 594      @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                                  </span>
<span class="-6820057886432852816" onmouseenter="enter('-6820057886432852816');" onmouseout="out('-6820057886432852816');" style=""> 595      public GenericResponse sendForcedPasswordChangeNotification(String username, String resetPasswordUrl) {       </span>
<span class="-12493669403857096" onmouseenter="enter('-12493669403857096');" onmouseout="out('-12493669403857096');" style=""> 596          return sendForgotPasswordNotification(username, resetPasswordUrl);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 597      }                                                                                                             </span>
<span  style=""> 598                                                                                                                    </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 599      @Deprecated                                                                                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 600      @Override                                                                                                     </span>
<span class="2764175161613765865" onmouseenter="enter('2764175161613765865');" onmouseout="out('2764175161613765865');" style=""> 601      public GenericResponse checkPasswordResetToken(String token) {                                                </span>
<span class="-3461464951845163420" onmouseenter="enter('-3461464951845163420');" onmouseout="out('-3461464951845163420');" style=""> 602          if (!usingDeprecatedPasswordEncoder()) {                                                                  </span>
<span class="2139035906527134472" onmouseenter="enter('2139035906527134472');" onmouseout="out('2139035906527134472');" style=""> 603              // We cannot proceed without a Customer when using the new PasswordEncoder                            </span>
<span class="-4521424860882993154" onmouseenter="enter('-4521424860882993154');" onmouseout="out('-4521424860882993154');" style=""> 604              throw new NoSuchBeanDefinitionException(&quot;This method requires the deprecated PasswordEncoder bean&quot;);  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 605          }                                                                                                         </span>
<span class="-1076466763561679841" onmouseenter="enter('-1076466763561679841');" onmouseout="out('-1076466763561679841');" style=""> 606          return checkPasswordResetToken(token, null);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 607      }                                                                                                             </span>
<span  style=""> 608                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 609      @Override                                                                                                     </span>
<span class="-7547112806897146214" onmouseenter="enter('-7547112806897146214');" onmouseout="out('-7547112806897146214');" style=""> 610      public GenericResponse checkPasswordResetToken(String token, Customer customer) {                             </span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 611          GenericResponse response = new GenericResponse();                                                         </span>
<span class="913599117713435265" onmouseenter="enter('913599117713435265');" onmouseout="out('913599117713435265');" style=""> 612          checkPasswordResetToken(token, customer, response);                                                       </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 613          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 614      }                                                                                                             </span>
<span  style=""> 615                                                                                                                    </span>
<span class="1872423782765914316" onmouseenter="enter('1872423782765914316');" onmouseout="out('1872423782765914316');" style=""><abbr title=" 616      protected CustomerForgotPasswordSecurityToken checkPasswordResetToken(String token, Customer customer, GenericResponse response) {"> 616      protected CustomerForgotPasswordSecurityToken checkPasswordResetToken(String token, Customer customer, GenericðŸ”µ</abbr></span>
<span class="-4169390037463393090" onmouseenter="enter('-4169390037463393090');" onmouseout="out('-4169390037463393090');" style=""> 617          if (StringUtils.isBlank(token)) {                                                                         </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style=""> 618              response.addErrorCode(&quot;invalidToken&quot;);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 619          }                                                                                                         </span>
<span  style=""> 620                                                                                                                    </span>
<span class="5092673057151141969" onmouseenter="enter('5092673057151141969');" onmouseout="out('5092673057151141969');" style=""> 621          String rawToken = token;                                                                                  </span>
<span class="-7872205866412670367" onmouseenter="enter('-7872205866412670367');" onmouseout="out('-7872205866412670367');" style=""> 622          String salt = null;                                                                                       </span>
<span  style=""> 623                                                                                                                    </span>
<span class="-7232422938046234962" onmouseenter="enter('-7232422938046234962');" onmouseout="out('-7232422938046234962');" style=""> 624          if (usingDeprecatedPasswordEncoder()) {                                                                   </span>
<span class="-4628277419489838427" onmouseenter="enter('-4628277419489838427');" onmouseout="out('-4628277419489838427');" style=""> 625              String[] tokens = token.split(&quot;-&quot;);                                                                   </span>
<span class="6618708100432165316" onmouseenter="enter('6618708100432165316');" onmouseout="out('6618708100432165316');" style=""> 626              if (tokens.length &gt; 2) {                                                                              </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style=""> 627                  response.addErrorCode(&quot;invalidToken&quot;);                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 628              } else {                                                                                              </span>
<span class="-1712320800281837997" onmouseenter="enter('-1712320800281837997');" onmouseout="out('-1712320800281837997');" style=""> 629                  rawToken = tokens[0].toLowerCase();                                                               </span>
<span class="8621647064958774156" onmouseenter="enter('8621647064958774156');" onmouseout="out('8621647064958774156');" style=""> 630                  if (tokens.length == 2) {                                                                         </span>
<span class="-3949611153912752305" onmouseenter="enter('-3949611153912752305');" onmouseout="out('-3949611153912752305');" style=""> 631                      salt = tokens[1];                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 632                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 633              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 634          }                                                                                                         </span>
<span  style=""> 635                                                                                                                    </span>
<span class="-7243325982712524701" onmouseenter="enter('-7243325982712524701');" onmouseout="out('-7243325982712524701');" style=""> 636          CustomerForgotPasswordSecurityToken fpst = null;                                                          </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 637          if (!response.getHasErrors()) {                                                                           </span>
<span class="-1371412200964570990" onmouseenter="enter('-1371412200964570990');" onmouseout="out('-1371412200964570990');" style=""> 638              if (customer == null) {                                                                               </span>
<span class="-3461464951845163420" onmouseenter="enter('-3461464951845163420');" onmouseout="out('-3461464951845163420');" style=""> 639                  if (!usingDeprecatedPasswordEncoder()) {                                                          </span>
<span class="21180584812199314" onmouseenter="enter('21180584812199314');" onmouseout="out('21180584812199314');" style=""> 640                      // customer can only be null when supporting use of the legacy PasswordEncoder                </span>
<span class="-397249380987924174" onmouseenter="enter('-397249380987924174');" onmouseout="out('-397249380987924174');" style=""> 641                      response.addErrorCode(&quot;invalidCustomer&quot;);                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 642                  } else {                                                                                          </span>
<span class="-1624865284260185189" onmouseenter="enter('-1624865284260185189');" onmouseout="out('-1624865284260185189');" style=""><abbr title=" 643                      fpst = customerForgotPasswordSecurityTokenDao.readToken(passwordEncoder.encodePassword(rawToken, salt));"> 643                      fpst = customerForgotPasswordSecurityTokenDao.readToken(passwordEncoder.encodePassword(rawTokeðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 644                  }                                                                                                 </span>

<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 645              } else {                                                                                              </span>
<span class="-2708743959084825308" onmouseenter="enter('-2708743959084825308');" onmouseout="out('-2708743959084825308');" style=""><abbr title=" 646                  List&lt;CustomerForgotPasswordSecurityToken&gt; fpstoks = customerForgotPasswordSecurityTokenDao.readUnusedTokensByCustomerId(customer.getId());"> 646                  List&lt;CustomerForgotPasswordSecurityToken&gt; fpstoks = customerForgotPasswordSecurityTokenDao.readUnuðŸ”µ</abbr></span>
<span class="6715544567105364437" onmouseenter="enter('6715544567105364437');" onmouseout="out('6715544567105364437');" style=""> 647                  for (CustomerForgotPasswordSecurityToken fpstok : fpstoks) {                                      </span>
<span class="-6038701959731803866" onmouseenter="enter('-6038701959731803866');" onmouseout="out('-6038701959731803866');" style=""> 648                      if (isPassValid(rawToken, fpstok.getToken(), salt)) {                                         </span>

<span class="-8696697531199533964" onmouseenter="enter('-8696697531199533964');" onmouseout="out('-8696697531199533964');" style=""> 649                          fpst = fpstok;                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 650                          break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 651                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 652                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 653              }                                                                                                     </span>
<span class="-1673544419969423705" onmouseenter="enter('-1673544419969423705');" onmouseout="out('-1673544419969423705');" style=""> 654              if (fpst == null) {                                                                                   </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style=""> 655                  response.addErrorCode(&quot;invalidToken&quot;);                                                            </span>
<span class="-1851754756462568438" onmouseenter="enter('-1851754756462568438');" onmouseout="out('-1851754756462568438');" style=""> 656              } else if (fpst.isTokenUsedFlag()) {                                                                  </span>
<span class="-4571187449058469389" onmouseenter="enter('-4571187449058469389');" onmouseout="out('-4571187449058469389');" style=""> 657                  response.addErrorCode(&quot;tokenUsed&quot;);                                                               </span>
<span class="1126518180689710158" onmouseenter="enter('1126518180689710158');" onmouseout="out('1126518180689710158');" style=""> 658              } else if (isTokenExpired(fpst)) {                                                                    </span>
<span class="1324239895302259913" onmouseenter="enter('1324239895302259913');" onmouseout="out('1324239895302259913');" style=""> 659                  response.addErrorCode(&quot;tokenExpired&quot;);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 660              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 661          }                                                                                                         </span>
<span class="-4960476697639333031" onmouseenter="enter('-4960476697639333031');" onmouseout="out('-4960476697639333031');" style=""> 662          return fpst;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 663      }                                                                                                             </span>
<span  style=""> 664                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 665      @Override                                                                                                     </span>
<span class="-8733280825621909829" onmouseenter="enter('-8733280825621909829');" onmouseout="out('-8733280825621909829');" style=""> 666      @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)                                                  </span>
<span class="-1553234826628367049" onmouseenter="enter('-1553234826628367049');" onmouseout="out('-1553234826628367049');" style=""><abbr title=" 667      public GenericResponse resetPasswordUsingToken(String username, String token, String password, String confirmPassword) {"> 667      public GenericResponse resetPasswordUsingToken(String username, String token, String password, String confirmPðŸ”µ</abbr></span>
<span class="-3323142898826342497" onmouseenter="enter('-3323142898826342497');" onmouseout="out('-3323142898826342497');" style=""> 668          GenericResponse response = new GenericResponse();                                                         </span>
<span class="6921810928241781426" onmouseenter="enter('6921810928241781426');" onmouseout="out('6921810928241781426');" style=""> 669          Customer customer = null;                                                                                 </span>
<span class="-8284276918575957483" onmouseenter="enter('-8284276918575957483');" onmouseout="out('-8284276918575957483');" style=""> 670          if (username != null) {                                                                                   </span>
<span class="-104711026898859267" onmouseenter="enter('-104711026898859267');" onmouseout="out('-104711026898859267');" style=""> 671              customer = customerDao.readCustomerByUsername(username);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 672          }                                                                                                         </span>
<span class="-3681439263985626916" onmouseenter="enter('-3681439263985626916');" onmouseout="out('-3681439263985626916');" style=""> 673          checkCustomer(customer, response);                                                                        </span>
<span class="-3971600249312835278" onmouseenter="enter('-3971600249312835278');" onmouseout="out('-3971600249312835278');" style=""> 674          checkPassword(password, confirmPassword, response);                                                       </span>
<span class="2411779224658140401" onmouseenter="enter('2411779224658140401');" onmouseout="out('2411779224658140401');" style=""> 675          CustomerForgotPasswordSecurityToken fpst = checkPasswordResetToken(token, customer, response);            </span>
<span  style=""> 676                                                                                                                    </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 677          if (!response.getHasErrors()) {                                                                           </span>
<span class="485270787578743194" onmouseenter="enter('485270787578743194');" onmouseout="out('485270787578743194');" style=""> 678              if (!customer.getId().equals(fpst.getCustomerId())) {                                                 </span>
<span class="-5994256316510103080" onmouseenter="enter('-5994256316510103080');" onmouseout="out('-5994256316510103080');" style=""> 679                  if (LOG.isWarnEnabled()) {                                                                        </span>
<span class="-3030254613251423793" onmouseenter="enter('-3030254613251423793');" onmouseout="out('-3030254613251423793');" style=""><abbr title=" 680                      LOG.warn(&quot;Password reset attempt tried with mismatched customer and token &quot; + customer.getId() + &quot;, &quot; + StringUtil.sanitize(token));"> 680                      LOG.warn(&quot;Password reset attempt tried with mismatched customer and token &quot; + customer.getId()ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 681                  }                                                                                                 </span>
<span class="-5065394993479210526" onmouseenter="enter('-5065394993479210526');" onmouseout="out('-5065394993479210526');" style=""> 682                  response.addErrorCode(&quot;invalidToken&quot;);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 683              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 684          }                                                                                                         </span>
<span  style=""> 685                                                                                                                    </span>
<span class="6662915930169218498" onmouseenter="enter('6662915930169218498');" onmouseout="out('6662915930169218498');" style=""> 686          if (!response.getHasErrors()) {                                                                           </span>
<span class="5101903206908082309" onmouseenter="enter('5101903206908082309');" onmouseout="out('5101903206908082309');" style=""> 687              customer.setUnencodedPassword(password);                                                              </span>
<span class="6606672839011797247" onmouseenter="enter('6606672839011797247');" onmouseout="out('6606672839011797247');" style=""> 688              customer.setPasswordChangeRequired(false);                                                            </span>
<span class="3384492063942947657" onmouseenter="enter('3384492063942947657');" onmouseout="out('3384492063942947657');" style=""> 689              saveCustomer(customer);                                                                               </span>
<span class="-7517227353230604805" onmouseenter="enter('-7517227353230604805');" onmouseout="out('-7517227353230604805');" style=""> 690              invalidateAllTokensForCustomer(customer);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 691          }                                                                                                         </span>
<span  style=""> 692                                                                                                                    </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 693          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 694      }                                                                                                             </span>
<span  style=""> 695                                                                                                                    </span>
<span class="2450635656385893269" onmouseenter="enter('2450635656385893269');" onmouseout="out('2450635656385893269');" style=""> 696      protected void invalidateAllTokensForCustomer(Customer customer) {                                            </span>
<span class="500146367959601607" onmouseenter="enter('500146367959601607');" onmouseout="out('500146367959601607');" style=""><abbr title=" 697          List&lt;CustomerForgotPasswordSecurityToken&gt; tokens = customerForgotPasswordSecurityTokenDao.readUnusedTokensByCustomerId(customer.getId());"> 697          List&lt;CustomerForgotPasswordSecurityToken&gt; tokens = customerForgotPasswordSecurityTokenDao.readUnusedTokensðŸ”µ</abbr></span>
<span class="34403017169246064" onmouseenter="enter('34403017169246064');" onmouseout="out('34403017169246064');" style=""> 698          for (CustomerForgotPasswordSecurityToken token : tokens) {                                                </span>
<span class="-3707452475519083600" onmouseenter="enter('-3707452475519083600');" onmouseout="out('-3707452475519083600');" style=""> 699              token.setTokenUsedFlag(true);                                                                         </span>
<span class="-8670185777060395996" onmouseenter="enter('-8670185777060395996');" onmouseout="out('-8670185777060395996');" style=""> 700              customerForgotPasswordSecurityTokenDao.saveToken(token);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 701          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 702      }                                                                                                             </span>
<span  style=""> 703                                                                                                                    </span>
<span class="3178004875725558699" onmouseenter="enter('3178004875725558699');" onmouseout="out('3178004875725558699');" style=""> 704      protected void checkCustomer(Customer customer, GenericResponse response) {                                   </span>
<span class="-1371412200964570990" onmouseenter="enter('-1371412200964570990');" onmouseout="out('-1371412200964570990');" style=""> 705          if (customer == null) {                                                                                   </span>
<span class="-397249380987924174" onmouseenter="enter('-397249380987924174');" onmouseout="out('-397249380987924174');" style=""> 706              response.addErrorCode(&quot;invalidCustomer&quot;);                                                             </span>
<span class="-1786182981140386352" onmouseenter="enter('-1786182981140386352');" onmouseout="out('-1786182981140386352');" style=""> 707          } else if (StringUtils.isBlank(customer.getEmailAddress())) {                                             </span>
<span class="3641519375839212970" onmouseenter="enter('3641519375839212970');" onmouseout="out('3641519375839212970');" style=""> 708              response.addErrorCode(&quot;emailNotFound&quot;);                                                               </span>
<span class="4935674502595460128" onmouseenter="enter('4935674502595460128');" onmouseout="out('4935674502595460128');" style=""> 709          } else if (customer.isDeactivated()) {                                                                    </span>
<span class="5510537362121156528" onmouseenter="enter('5510537362121156528');" onmouseout="out('5510537362121156528');" style=""> 710              response.addErrorCode(&quot;inactiveUser&quot;);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 711          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 712      }                                                                                                             </span>
<span  style=""> 713                                                                                                                    </span>
<span class="-3281949438797137351" onmouseenter="enter('-3281949438797137351');" onmouseout="out('-3281949438797137351');" style=""> 714      protected void checkPassword(String password, String confirmPassword, GenericResponse response) {             </span>
<span class="2256032458684464296" onmouseenter="enter('2256032458684464296');" onmouseout="out('2256032458684464296');" style=""> 715          if (StringUtils.isBlank(password) || StringUtils.isBlank(confirmPassword)) {                              </span>
<span class="5492480053199382271" onmouseenter="enter('5492480053199382271');" onmouseout="out('5492480053199382271');" style=""> 716              response.addErrorCode(&quot;invalidPassword&quot;);                                                             </span>
<span class="5837283644501577917" onmouseenter="enter('5837283644501577917');" onmouseout="out('5837283644501577917');" style=""> 717          } else if (!password.equals(confirmPassword)) {                                                           </span>
<span class="-5929993345093092025" onmouseenter="enter('-5929993345093092025');" onmouseout="out('-5929993345093092025');" style=""> 718              response.addErrorCode(&quot;passwordMismatch&quot;);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 719          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 720      }                                                                                                             </span>
<span  style=""> 721                                                                                                                    </span>
<span class="2301745374477860963" onmouseenter="enter('2301745374477860963');" onmouseout="out('2301745374477860963');" style=""> 722      protected boolean isTokenExpired(CustomerForgotPasswordSecurityToken fpst) {                                  </span>
<span class="7457175319484101734" onmouseenter="enter('7457175319484101734');" onmouseout="out('7457175319484101734');" style=""> 723          Date now = SystemTime.asDate();                                                                           </span>
<span class="4814679658448270347" onmouseenter="enter('4814679658448270347');" onmouseout="out('4814679658448270347');" style=""> 724          long currentTimeInMillis = now.getTime();                                                                 </span>
<span class="2086457980523585614" onmouseenter="enter('2086457980523585614');" onmouseout="out('2086457980523585614');" style=""> 725          long tokenSaveTimeInMillis = fpst.getCreateDate().getTime();                                              </span>
<span class="6156534052742928347" onmouseenter="enter('6156534052742928347');" onmouseout="out('6156534052742928347');" style=""> 726          long minutesSinceSave = (currentTimeInMillis - tokenSaveTimeInMillis) / 60000;                            </span>
<span class="4808087245976426488" onmouseenter="enter('4808087245976426488');" onmouseout="out('4808087245976426488');" style=""> 727          return minutesSinceSave &gt; tokenExpiredMinutes;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 728      }                                                                                                             </span>
<span  style=""> 729                                                                                                                    </span>
<span class="-1783595916375579475" onmouseenter="enter('-1783595916375579475');" onmouseout="out('-1783595916375579475');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 730 -    protected void sendEmail(String emailAddress, EmailInfo emailInfo, Map&lt;String, Object&gt; props) {               </span>
<span class="6622041900045107950" onmouseenter="enter('6622041900045107950');" onmouseout="out('6622041900045107950');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 731 -        emailService.sendTemplateEmail(emailAddress, emailInfo, props);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 732 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 733 -                                                                                                                  </span>
<span class="-7890820258027638542" onmouseenter="enter('-7890820258027638542');" onmouseout="out('-7890820258027638542');" style=""> 734      public int getTokenExpiredMinutes() {                                                                         </span>
<span class="-8144525086468905422" onmouseenter="enter('-8144525086468905422');" onmouseout="out('-8144525086468905422');" style=""> 735          return tokenExpiredMinutes;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 736      }                                                                                                             </span>
<span  style=""> 737                                                                                                                    </span>
<span class="-4089110355878340459" onmouseenter="enter('-4089110355878340459');" onmouseout="out('-4089110355878340459');" style=""> 738      public void setTokenExpiredMinutes(int tokenExpiredMinutes) {                                                 </span>
<span class="-6197938813064605922" onmouseenter="enter('-6197938813064605922');" onmouseout="out('-6197938813064605922');" style=""> 739          this.tokenExpiredMinutes = tokenExpiredMinutes;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 740      }                                                                                                             </span>
<span  style=""> 741                                                                                                                    </span>
<span class="-2211298406731211675" onmouseenter="enter('-2211298406731211675');" onmouseout="out('-2211298406731211675');" style=""> 742      public int getPasswordTokenLength() {                                                                         </span>
<span class="-9052975427749106201" onmouseenter="enter('-9052975427749106201');" onmouseout="out('-9052975427749106201');" style=""> 743          return passwordTokenLength;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 744      }                                                                                                             </span>
<span  style=""> 745                                                                                                                    </span>
<span class="4968817442646533856" onmouseenter="enter('4968817442646533856');" onmouseout="out('4968817442646533856');" style=""> 746      public void setPasswordTokenLength(int passwordTokenLength) {                                                 </span>
<span class="-6372163195142109946" onmouseenter="enter('-6372163195142109946');" onmouseout="out('-6372163195142109946');" style=""> 747          this.passwordTokenLength = passwordTokenLength;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 748      }                                                                                                             </span>
<span  style=""> 749                                                                                                                    </span>

<span class="-2426619698179732460" onmouseenter="enter('-2426619698179732460');" onmouseout="out('-2426619698179732460');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 750 -    public EmailInfo getForgotPasswordEmailInfo() {                                                               </span>
<span class="8553850930406344086" onmouseenter="enter('8553850930406344086');" onmouseout="out('8553850930406344086');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 751 -        return forgotPasswordEmailInfo;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 752 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 753 -                                                                                                                  </span>
<span class="-5968004809391300230" onmouseenter="enter('-5968004809391300230');" onmouseout="out('-5968004809391300230');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 754 -    public void setForgotPasswordEmailInfo(EmailInfo forgotPasswordEmailInfo) {                                   </span>
<span class="3510418398145123936" onmouseenter="enter('3510418398145123936');" onmouseout="out('3510418398145123936');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 755 -        this.forgotPasswordEmailInfo = forgotPasswordEmailInfo;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 756 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 757 -                                                                                                                  </span>
<span class="7679605086459105581" onmouseenter="enter('7679605086459105581');" onmouseout="out('7679605086459105581');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 758 -    public EmailInfo getForgotUsernameEmailInfo() {                                                               </span>
<span class="-8928803675058205054" onmouseenter="enter('-8928803675058205054');" onmouseout="out('-8928803675058205054');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 759 -        return forgotUsernameEmailInfo;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 760 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 761 -                                                                                                                  </span>
<span class="7097836574720204185" onmouseenter="enter('7097836574720204185');" onmouseout="out('7097836574720204185');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 762 -    public void setForgotUsernameEmailInfo(EmailInfo forgotUsernameEmailInfo) {                                   </span>
<span class="-6675027655322416901" onmouseenter="enter('-6675027655322416901');" onmouseout="out('-6675027655322416901');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 763 -        this.forgotUsernameEmailInfo = forgotUsernameEmailInfo;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 764 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 765 -                                                                                                                  </span>
<span class="5133340881216779756" onmouseenter="enter('5133340881216779756');" onmouseout="out('5133340881216779756');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 766 -    public EmailInfo getRegistrationEmailInfo() {                                                                 </span>
<span class="-8178127994446042174" onmouseenter="enter('-8178127994446042174');" onmouseout="out('-8178127994446042174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 767 -        return registrationEmailInfo;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 768 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 769 -                                                                                                                  </span>
<span class="-1271447752357505583" onmouseenter="enter('-1271447752357505583');" onmouseout="out('-1271447752357505583');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 770 -    public void setRegistrationEmailInfo(EmailInfo registrationEmailInfo) {                                       </span>
<span class="-6232198529948124277" onmouseenter="enter('-6232198529948124277');" onmouseout="out('-6232198529948124277');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 771 -        this.registrationEmailInfo = registrationEmailInfo;                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 772 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 773 -                                                                                                                  </span>
<span class="5129663219504237585" onmouseenter="enter('5129663219504237585');" onmouseout="out('5129663219504237585');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 774 -    public EmailInfo getChangePasswordEmailInfo() {                                                               </span>
<span class="-1635559517766867718" onmouseenter="enter('-1635559517766867718');" onmouseout="out('-1635559517766867718');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 775 -        return changePasswordEmailInfo;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 776 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 777 -                                                                                                                  </span>
<span class="9037922117099126087" onmouseenter="enter('9037922117099126087');" onmouseout="out('9037922117099126087');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 778 -    public void setChangePasswordEmailInfo(EmailInfo changePasswordEmailInfo) {                                   </span>
<span class="-7914138197132411471" onmouseenter="enter('-7914138197132411471');" onmouseout="out('-7914138197132411471');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 779 -        this.changePasswordEmailInfo = changePasswordEmailInfo;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 780 -    }                                                                                                             </span>
<span  style=""> 781                                                                                                                    </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style=""> 782      @Deprecated                                                                                                   </span>
<span class="-6689514394619645734" onmouseenter="enter('-6689514394619645734');" onmouseout="out('-6689514394619645734');" style=""> 783      protected boolean usingDeprecatedPasswordEncoder() {                                                          </span>
<span class="-493259449393847495" onmouseenter="enter('-493259449393847495');" onmouseout="out('-493259449393847495');" style=""> 784          return passwordEncoder != null;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 785      }                                                                                                             </span>
<span  style=""> 786                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 787      @Override                                                                                                     </span>
<span class="2659754888592981645" onmouseenter="enter('2659754888592981645');" onmouseout="out('2659754888592981645');" style=""> 788      public List&lt;Customer&gt; readBatchCustomers(int start, int pageSize) {                                           </span>
<span class="-8143894692030732868" onmouseenter="enter('-8143894692030732868');" onmouseout="out('-8143894692030732868');" style=""> 789          return customerDao.readBatchCustomers(start, pageSize);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 790      }                                                                                                             </span>
<span  style=""> 791                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 792      @Override                                                                                                     </span>
<span class="4634920297968325108" onmouseenter="enter('4634920297968325108');" onmouseout="out('4634920297968325108');" style=""> 793      public Long readNumberOfCustomers() {                                                                         </span>
<span class="93124683563030725" onmouseenter="enter('93124683563030725');" onmouseout="out('93124683563030725');" style=""> 794          return customerDao.readNumberOfCustomers();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 795      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 796  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            