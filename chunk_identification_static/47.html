<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>47</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    47
                    <a href="46.html">prev</a>
                    <a href="48.html">next</a>
                    <a href="47_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    AriaLyy/Aria_ec1b504309d78f4ff275a5e6a6f08a5e0022f44b_Aria/src/main/java/com/arialyy/aria/core/download/FtpDownloadTarget.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;ec1b504309d78f4ff275a5e6a6f08a5e0022f44b:Aria/src/main/java/com/arialyy/aria/core/download/FtpDownloadTarget.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;ec1b504309d78f4ff275a5e6a6f08a5e0022f44b^1:Aria/src/main/java/com/arialyy/aria/core/download/FtpDownloadTarget.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;ec1b504309d78f4ff275a5e6a6f08a5e0022f44b^2:Aria/src/main/java/com/arialyy/aria/core/download/FtpDownloadTarget.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;cd587dd212fe20c8c7e9d44c6b009614eae38bef:Aria/src/main/java/com/arialyy/aria/core/download/FtpDownloadTarget.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bs], [j], [j]], subset: [[sbj], [j]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package com.arialyy.aria.core.download;
  17 
  18 import android.support.annotation.NonNull;
  19 import android.text.TextUtils;
  20 import com.arialyy.aria.core.inf.AbsTaskEntity;
  21 import com.arialyy.aria.util.ALog;
  22 import com.arialyy.aria.util.CommonUtil;
  23 import java.io.File;
  24 
  25 /**
  26  * Created by lyy on 2016/12/5.
  27  * https://github.com/AriaLyy/Aria
  28  */
  29 public class FtpDownloadTarget extends DownloadTarget {
  30   private final String TAG = &quot;FtpDownloadTarget&quot;;
  31 
  32   FtpDownloadTarget(DownloadEntity entity, String targetName, boolean refreshInfo) {
  33     super(entity, targetName, refreshInfo);
  34     init(refreshInfo);
  35   }
  36 
  37   FtpDownloadTarget(String url, String targetName) {
  38     this(url, targetName, false);
  39   }
  40 
  41   FtpDownloadTarget(DownloadEntity entity, String targetName, boolean refreshInfo) {
  42     super(entity, targetName);
  43     init(refreshInfo);
  44   }
  45 
  46   FtpDownloadTarget(String url, String targetName, boolean refreshInfo) {
  47     super(url, targetName);
  48     init(refreshInfo);
  49   }
  50 
  51   private void init(boolean refreshInfo) {
  52 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
  53 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55     int lastIndex = url.lastIndexOf(&quot;/&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56     mTaskEntity.serverIp = serverIp;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57     mTaskEntity.port = port;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58     mEntity.setFileName(url.substring(lastIndex + 1, url.length()));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59     mTaskEntity.refreshInfo = refreshInfo;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62   /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63    * 设置文件保存文件夹路径</span>
  64 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  65     String[] pp = url.split(&quot;/&quot;)[2].split(&quot;:&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  66     this.serverIp = pp[0];</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  67     this.port = Integer.parseInt(pp[1]);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  68     mTaskEntity.requestType = AbsTaskEntity.D_FTP;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  69     remotePath = url.substring(url.indexOf(pp[1]) + pp[1].length(), url.length());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  70     if (TextUtils.isEmpty(remotePath)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  71       throw new NullPointerException(&quot;ftp服务器地址不能为null&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  72     }</span>
  73 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
  74     int lastIndex = url.lastIndexOf(&quot;/&quot;);
  75     mEntity.setFileName(url.substring(lastIndex + 1, url.length()));
  76     mTaskEntity.urlEntity = CommonUtil.getFtpUrlInfo(url);
  77     mTaskEntity.refreshInfo = refreshInfo;
  78     mTaskEntity.requestType = AbsTaskEntity.FTP;
  79   }
  80 
  81   /**
  82    * 设置文件保存文件夹路径
  83    * 关于文件名：
  84    * 1、如果保存路径是该文件的保存路径，如：/mnt/sdcard/file.zip，则使用路径中的文件名file.zip
  85    * 2、如果保存路径是文件夹路径，如：/mnt/sdcard/，则使用FTP服务器该文件的文件名
  86    *
  87    * @param downloadPath 路径必须为文件路径，不能为文件夹路径
  88    */
  89   @Override public FtpDownloadTarget setDownloadPath(@NonNull String downloadPath) {
  90     if (TextUtils.isEmpty(downloadPath)) {
  91       throw new IllegalArgumentException(&quot;文件保持路径不能为null&quot;);
  92     }
  93     File file = new File(downloadPath);
  94     if (file.isDirectory()) {
  95       downloadPath += mEntity.getFileName();
  96     }
  97     if (!downloadPath.equals(mEntity.getDownloadPath())) {
  98       File oldFile = new File(mEntity.getDownloadPath());
  99       File newFile = new File(downloadPath);
 100       if (TextUtils.isEmpty(mEntity.getDownloadPath()) || oldFile.renameTo(newFile)) {
 101         mEntity.setDownloadPath(downloadPath);
 102         mEntity.setFileName(newFile.getName());
 103         mTaskEntity.key = downloadPath;
 104         mEntity.update();
 105         mTaskEntity.update();
 106         CommonUtil.renameDownloadConfig(oldFile.getName(), newFile.getName());
 107       }
 108     }
 109     return this;
 110   }
 111 
 112   /**
 113    * 设置字符编码
 114    */
 115   public FtpDownloadTarget charSet(String charSet) {
 116     if (TextUtils.isEmpty(charSet)) return this;
 117     mTaskEntity.charSet = charSet;
 118     return this;
 119   }
 120 
 121   /**
 122    * ftp 用户登录信息
 123    *
 124    * @param userName ftp用户名
 125    * @param password ftp用户密码
 126    */
 127   public FtpDownloadTarget login(String userName, String password) {
 128     return login(userName, password, null);
 129   }
 130 
 131   /**
 132    * ftp 用户登录信息
 133    *
 134    * @param userName ftp用户名
 135    * @param password ftp用户密码
 136    * @param account ftp账号
 137    */
 138   public FtpDownloadTarget login(String userName, String password, String account) {
 139     if (TextUtils.isEmpty(userName)) {
 140       ALog.e(TAG, &quot;用户名不能为null&quot;);
 141       return this;
 142     } else if (TextUtils.isEmpty(password)) {
 143       ALog.e(TAG, &quot;密码不能为null&quot;);
 144       return this;
 145     }
 146     mTaskEntity.urlEntity.needLogin = true;
 147     mTaskEntity.urlEntity.user = userName;
 148     mTaskEntity.urlEntity.password = password;
 149     mTaskEntity.urlEntity.account = account;
 150     return this;
 151   }
 152 }</pre></td>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package com.arialyy.aria.core.download;
  17 
  18 import android.support.annotation.NonNull;
  19 import android.text.TextUtils;
  20 import com.arialyy.aria.core.inf.AbsTaskEntity;
  21 import com.arialyy.aria.util.ALog;
  22 import com.arialyy.aria.util.CommonUtil;
  23 import java.io.File;
  24 
  25 /**
  26  * Created by lyy on 2016/12/5.
  27  * https://github.com/AriaLyy/Aria
  28  */
  29 public class FtpDownloadTarget extends DownloadTarget {
  30   private final String TAG = &quot;FtpDownloadTarget&quot;;
  31 
  32   FtpDownloadTarget(String url, String targetName) {
  33     this(url, targetName, false);
  34   }
  35 
  36   FtpDownloadTarget(DownloadEntity entity, String targetName, boolean refreshInfo) {
  37 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  38     super(entity, targetName, refreshInfo);</span>
  39 ||||||| BASE
  40 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  41     super(entity, targetName);</span>
  42 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
  43     init(refreshInfo);
  44   }
  45 
  46   FtpDownloadTarget(String url, String targetName, boolean refreshInfo) {
  47     super(url, targetName);
  48     init(refreshInfo);
  49   }
  50 
  51   private void init(boolean refreshInfo) {
  52 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53     int lastIndex = url.lastIndexOf(&quot;/&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54     mEntity.setFileName(url.substring(lastIndex + 1, url.length()));</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55     mTaskEntity.urlEntity = CommonUtil.getFtpUrlInfo(url);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56     mTaskEntity.refreshInfo = refreshInfo;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57     mTaskEntity.requestType = AbsTaskEntity.FTP;</span>
  58 ||||||| BASE
  59 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  60     String[] pp = url.split(&quot;/&quot;)[2].split(&quot;:&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  61     this.serverIp = pp[0];</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  62     this.port = Integer.parseInt(pp[1]);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  63     mTaskEntity.requestType = AbsTaskEntity.D_FTP;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  64     remotePath = url.substring(url.indexOf(pp[1]) + pp[1].length(), url.length());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  65     if (TextUtils.isEmpty(remotePath)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  66       throw new NullPointerException(&quot;ftp服务器地址不能为null&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  67     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  68     int lastIndex = url.lastIndexOf(&quot;/&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  69     mTaskEntity.serverIp = serverIp;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  70     mTaskEntity.port = port;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  71     mEntity.setFileName(url.substring(lastIndex + 1, url.length()));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  72     mTaskEntity.refreshInfo = refreshInfo;</span>
  73 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
  74   }
  75 
  76   /**
  77    * 设置文件保存文件夹路径
  78    * 关于文件名：
  79    * 1、如果保存路径是该文件的保存路径，如：/mnt/sdcard/file.zip，则使用路径中的文件名file.zip
  80    * 2、如果保存路径是文件夹路径，如：/mnt/sdcard/，则使用FTP服务器该文件的文件名
  81    *
  82    * @param downloadPath 路径必须为文件路径，不能为文件夹路径
  83    */
  84   @Override public FtpDownloadTarget setDownloadPath(@NonNull String downloadPath) {
  85     if (TextUtils.isEmpty(downloadPath)) {
  86       throw new IllegalArgumentException(&quot;文件保持路径不能为null&quot;);
  87     }
  88     File file = new File(downloadPath);
  89     if (file.isDirectory()) {
  90       downloadPath += mEntity.getFileName();
  91     }
  92     if (!downloadPath.equals(mEntity.getDownloadPath())) {
  93       File oldFile = new File(mEntity.getDownloadPath());
  94       File newFile = new File(downloadPath);
  95       if (TextUtils.isEmpty(mEntity.getDownloadPath()) || oldFile.renameTo(newFile)) {
  96         mEntity.setDownloadPath(downloadPath);
  97         mEntity.setFileName(newFile.getName());
  98         mTaskEntity.key = downloadPath;
  99         mEntity.update();
 100         mTaskEntity.update();
 101         CommonUtil.renameDownloadConfig(oldFile.getName(), newFile.getName());
 102       }
 103     }
 104     return this;
 105   }
 106 
 107   /**
 108    * 设置字符编码
 109    */
 110   public FtpDownloadTarget charSet(String charSet) {
 111     if (TextUtils.isEmpty(charSet)) return this;
 112     mTaskEntity.charSet = charSet;
 113     return this;
 114   }
 115 
 116   /**
 117    * ftp 用户登录信息
 118    *
 119    * @param userName ftp用户名
 120    * @param password ftp用户密码
 121    */
 122   public FtpDownloadTarget login(String userName, String password) {
 123     return login(userName, password, null);
 124   }
 125 
 126   /**
 127    * ftp 用户登录信息
 128    *
 129    * @param userName ftp用户名
 130    * @param password ftp用户密码
 131    * @param account ftp账号
 132    */
 133   public FtpDownloadTarget login(String userName, String password, String account) {
 134     if (TextUtils.isEmpty(userName)) {
 135       ALog.e(TAG, &quot;用户名不能为null&quot;);
 136       return this;
 137     } else if (TextUtils.isEmpty(password)) {
 138       ALog.e(TAG, &quot;密码不能为null&quot;);
 139       return this;
 140     }
 141     mTaskEntity.urlEntity.needLogin = true;
 142     mTaskEntity.urlEntity.user = userName;
 143     mTaskEntity.urlEntity.password = password;
 144     mTaskEntity.urlEntity.account = account;
 145     return this;
 146   }
 147 }
 
 
 
 </pre></td>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package com.arialyy.aria.core.download;
  17 
  18 import android.support.annotation.NonNull;
  19 import android.text.TextUtils;
  20 import com.arialyy.aria.core.inf.AbsTaskEntity;
  21 import com.arialyy.aria.util.ALog;
  22 import com.arialyy.aria.util.CommonUtil;
  23 import java.io.File;
  24 
  25 /**
  26  * Created by lyy on 2016/12/5.
  27  * https://github.com/AriaLyy/Aria
  28  */
  29 public class FtpDownloadTarget extends DownloadTarget {
  30   private final String TAG = &quot;FtpDownloadTarget&quot;;
  31 
  32   FtpDownloadTarget(DownloadEntity entity, String targetName, boolean refreshInfo) {
  33     super(entity, targetName, refreshInfo);
  34     init(refreshInfo);
  35   }
  36 
  37   FtpDownloadTarget(String url, String targetName) {
  38     this(url, targetName, false);
  39   }
  40 
  41   FtpDownloadTarget(DownloadEntity entity, String targetName, boolean refreshInfo) {
  42     super(entity, targetName);
  43     init(refreshInfo);
  44   }
  45 
  46   FtpDownloadTarget(String url, String targetName, boolean refreshInfo) {
  47     super(url, targetName);
  48     init(refreshInfo);
  49   }
  50 
  51   private void init(boolean refreshInfo) {
  52 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
  53 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  54 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">  54 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
  55 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  56 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  57     String[] pp = url.split(&quot;/&quot;)[2].split(&quot;:&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  58     this.serverIp = pp[0];</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  59     this.port = Integer.parseInt(pp[1]);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  60     mTaskEntity.requestType = AbsTaskEntity.D_FTP;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  61     remotePath = url.substring(url.indexOf(pp[1]) + pp[1].length(), url.length());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  62     if (TextUtils.isEmpty(remotePath)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  63       throw new NullPointerException(&quot;ftp服务器地址不能为null&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  64     }</span>
  65 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
  66     int lastIndex = url.lastIndexOf(&quot;/&quot;);
  67     mEntity.setFileName(url.substring(lastIndex + 1, url.length()));
  68     mTaskEntity.urlEntity = CommonUtil.getFtpUrlInfo(url);
  69     mTaskEntity.refreshInfo = refreshInfo;
  70     mTaskEntity.requestType = AbsTaskEntity.FTP;
  71   }
  72 
  73   /**
  74    * 设置文件保存文件夹路径
  75    * 关于文件名：
  76    * 1、如果保存路径是该文件的保存路径，如：/mnt/sdcard/file.zip，则使用路径中的文件名file.zip
  77    * 2、如果保存路径是文件夹路径，如：/mnt/sdcard/，则使用FTP服务器该文件的文件名
  78    *
  79    * @param downloadPath 路径必须为文件路径，不能为文件夹路径
  80    */
  81   @Override public FtpDownloadTarget setDownloadPath(@NonNull String downloadPath) {
  82     if (TextUtils.isEmpty(downloadPath)) {
  83       throw new IllegalArgumentException(&quot;文件保持路径不能为null&quot;);
  84     }
  85     File file = new File(downloadPath);
  86     if (file.isDirectory()) {
  87       downloadPath += mEntity.getFileName();
  88     }
  89     if (!downloadPath.equals(mEntity.getDownloadPath())) {
  90       File oldFile = new File(mEntity.getDownloadPath());
  91       File newFile = new File(downloadPath);
  92       if (TextUtils.isEmpty(mEntity.getDownloadPath()) || oldFile.renameTo(newFile)) {
  93         mEntity.setDownloadPath(downloadPath);
  94         mEntity.setFileName(newFile.getName());
  95         mTaskEntity.key = downloadPath;
  96         mEntity.update();
  97         mTaskEntity.update();
  98         CommonUtil.renameDownloadConfig(oldFile.getName(), newFile.getName());
  99       }
 100     }
 101     return this;
 102   }
 103 
 104   /**
 105    * 设置字符编码
 106    */
 107   public FtpDownloadTarget charSet(String charSet) {
 108     if (TextUtils.isEmpty(charSet)) return this;
 109     mTaskEntity.charSet = charSet;
 110     return this;
 111   }
 112 
 113   /**
 114    * ftp 用户登录信息
 115    *
 116    * @param userName ftp用户名
 117    * @param password ftp用户密码
 118    */
 119   public FtpDownloadTarget login(String userName, String password) {
 120     return login(userName, password, null);
 121   }
 122 
 123   /**
 124    * ftp 用户登录信息
 125    *
 126    * @param userName ftp用户名
 127    * @param password ftp用户密码
 128    * @param account ftp账号
 129    */
 130   public FtpDownloadTarget login(String userName, String password, String account) {
 131     if (TextUtils.isEmpty(userName)) {
 132       ALog.e(TAG, &quot;用户名不能为null&quot;);
 133       return this;
 134     } else if (TextUtils.isEmpty(password)) {
 135       ALog.e(TAG, &quot;密码不能为null&quot;);
 136       return this;
 137     }
 138     mTaskEntity.urlEntity.needLogin = true;
 139     mTaskEntity.urlEntity.user = userName;
 140     mTaskEntity.urlEntity.password = password;
 141     mTaskEntity.urlEntity.account = account;
 142     return this;
 143   }
 144 }
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  /*
   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3   *
   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5   * you may not use this file except in compliance with the License.
   6   * You may obtain a copy of the License at
   7   *
   8   *      http://www.apache.org/licenses/LICENSE-2.0
   9   *
  10   * Unless required by applicable law or agreed to in writing, software
  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13   * See the License for the specific language governing permissions and
  14   * limitations under the License.
  15   */
  16  package com.arialyy.aria.core.download;
  17  
  18  import android.support.annotation.NonNull;
  19  import android.text.TextUtils;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  20 -import android.util.Log;</span>
  21  import com.arialyy.aria.core.inf.AbsTaskEntity;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  22 +import com.arialyy.aria.util.ALog;</span>
  23  import com.arialyy.aria.util.CommonUtil;
  24  import java.io.File;
  25  
  26  /**
  27   * Created by lyy on 2016/12/5.
  28   * https://github.com/AriaLyy/Aria
  29   */
  30  public class FtpDownloadTarget extends DownloadTarget {
  31    private final String TAG = &quot;FtpDownloadTarget&quot;;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  32 -  private String serverIp, remotePath;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  33 -  private int port;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  34 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  35 +  FtpDownloadTarget(DownloadEntity entity, String targetName, boolean refreshInfo) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  36 +    super(entity, targetName, refreshInfo);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  37 +    init(refreshInfo);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  38 +  }</span>
  39  
  40    FtpDownloadTarget(String url, String targetName) {
  41      this(url, targetName, false);
  42    }
  43  





  44    FtpDownloadTarget(String url, String targetName, boolean refreshInfo) {
  45      super(url, targetName);




<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  46 -    String[] pp = url.split(&quot;/&quot;)[2].split(&quot;:&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  47 -    this.serverIp = pp[0];</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  48 -    this.port = Integer.parseInt(pp[1]);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  49 +    init(refreshInfo);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  50 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  51 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  52 +  private void init(boolean refreshInfo) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  53 +    int lastIndex = url.lastIndexOf(&quot;/&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  54 +    mEntity.setFileName(url.substring(lastIndex + 1, url.length()));</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  55 +    mTaskEntity.urlEntity = CommonUtil.getFtpUrlInfo(url);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  56 +    mTaskEntity.refreshInfo = refreshInfo;</span>
  57      mTaskEntity.requestType = AbsTaskEntity.FTP;

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  58 -    remotePath = url.substring(url.indexOf(pp[1]) + pp[1].length(), url.length());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  59 -    if (TextUtils.isEmpty(remotePath)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  60 -      throw new NullPointerException(&quot;ftp服务器地址不能为null&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  61 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  62 -    int lastIndex = url.lastIndexOf(&quot;/&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  63 -    mTaskEntity.serverIp = serverIp;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  64 -    mTaskEntity.port = port;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  65 -    mEntity.setFileName(url.substring(lastIndex + 1, url.length()));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  66 -    mTaskEntity.refreshInfo = refreshInfo;</span>
  67    }
  68  
  69    /**
  70     * 设置文件保存文件夹路径
  71     * 关于文件名：
  72     * 1、如果保存路径是该文件的保存路径，如：/mnt/sdcard/file.zip，则使用路径中的文件名file.zip
  73     * 2、如果保存路径是文件夹路径，如：/mnt/sdcard/，则使用FTP服务器该文件的文件名
  74     *
  75     * @param downloadPath 路径必须为文件路径，不能为文件夹路径
  76     */
  77    @Override public FtpDownloadTarget setDownloadPath(@NonNull String downloadPath) {
  78      if (TextUtils.isEmpty(downloadPath)) {
  79        throw new IllegalArgumentException(&quot;文件保持路径不能为null&quot;);
  80      }
  81      File file = new File(downloadPath);
  82      if (file.isDirectory()) {
  83        downloadPath += mEntity.getFileName();
  84      }
  85      if (!downloadPath.equals(mEntity.getDownloadPath())) {
  86        File oldFile = new File(mEntity.getDownloadPath());
  87        File newFile = new File(downloadPath);
  88        if (TextUtils.isEmpty(mEntity.getDownloadPath()) || oldFile.renameTo(newFile)) {
  89          mEntity.setDownloadPath(downloadPath);
  90          mEntity.setFileName(newFile.getName());
  91          mTaskEntity.key = downloadPath;
  92          mEntity.update();
  93          mTaskEntity.update();
  94          CommonUtil.renameDownloadConfig(oldFile.getName(), newFile.getName());
  95        }
  96      }
  97      return this;
  98    }
  99  
 100    /**
 101     * 设置字符编码
 102     */
 103    public FtpDownloadTarget charSet(String charSet) {
 104      if (TextUtils.isEmpty(charSet)) return this;
 105      mTaskEntity.charSet = charSet;
 106      return this;
 107    }
 108  
 109    /**
 110     * ftp 用户登录信息
 111     *
 112     * @param userName ftp用户名
 113     * @param password ftp用户密码
 114     */
 115    public FtpDownloadTarget login(String userName, String password) {
 116      return login(userName, password, null);
 117    }
 118  
 119    /**
 120     * ftp 用户登录信息
 121     *
 122     * @param userName ftp用户名
 123     * @param password ftp用户密码
 124     * @param account ftp账号
 125     */
 126    public FtpDownloadTarget login(String userName, String password, String account) {
 127      if (TextUtils.isEmpty(userName)) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 128 -      Log.e(TAG, &quot;用户名不能为null&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 129 +      ALog.e(TAG, &quot;用户名不能为null&quot;);</span>
 130        return this;
 131      } else if (TextUtils.isEmpty(password)) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 132 -      Log.e(TAG, &quot;密码不能为null&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 133 +      ALog.e(TAG, &quot;密码不能为null&quot;);</span>
 134        return this;
 135      }
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 136 -    mTaskEntity.userName = userName;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 137 -    mTaskEntity.userPw = password;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 138 -    mTaskEntity.account = account;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 139 +    mTaskEntity.urlEntity.needLogin = true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 140 +    mTaskEntity.urlEntity.user = userName;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 141 +    mTaskEntity.urlEntity.password = password;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +    mTaskEntity.urlEntity.account = account;</span>
 143      return this;
 144    }
 145  }</pre></td>
                            <td><pre>   1  /*
   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3   *
   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5   * you may not use this file except in compliance with the License.
   6   * You may obtain a copy of the License at
   7   *
   8   *      http://www.apache.org/licenses/LICENSE-2.0
   9   *
  10   * Unless required by applicable law or agreed to in writing, software
  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13   * See the License for the specific language governing permissions and
  14   * limitations under the License.
  15   */
  16  package com.arialyy.aria.core.download;
  17  
  18  import android.support.annotation.NonNull;
  19  import android.text.TextUtils;
  20  import android.util.Log;
  21  import com.arialyy.aria.core.inf.AbsTaskEntity;

  22  import com.arialyy.aria.util.CommonUtil;
  23  import java.io.File;
  24  
  25  /**
  26   * Created by lyy on 2016/12/5.
  27   * https://github.com/AriaLyy/Aria
  28   */
  29  public class FtpDownloadTarget extends DownloadTarget {
  30    private final String TAG = &quot;FtpDownloadTarget&quot;;
  31    private String serverIp, remotePath;
  32    private int port;





  33  
  34    FtpDownloadTarget(String url, String targetName) {
  35      this(url, targetName, false);
  36    }
  37  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  38 +  FtpDownloadTarget(DownloadEntity entity, String targetName, boolean refreshInfo) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  39 +    super(entity, targetName);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  40 +    init(refreshInfo);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  41 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  42 +</span>
  43    FtpDownloadTarget(String url, String targetName, boolean refreshInfo) {
  44      super(url, targetName);
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  45 +    init(refreshInfo);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  46 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  47 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  48 +  private void init(boolean refreshInfo) {</span>
  49      String[] pp = url.split(&quot;/&quot;)[2].split(&quot;:&quot;);
  50      this.serverIp = pp[0];
  51      this.port = Integer.parseInt(pp[1]);








<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  52 -    mTaskEntity.requestType = AbsTaskEntity.FTP;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  53 +    mTaskEntity.requestType = AbsTaskEntity.D_FTP;</span>
  54      remotePath = url.substring(url.indexOf(pp[1]) + pp[1].length(), url.length());
  55      if (TextUtils.isEmpty(remotePath)) {
  56        throw new NullPointerException(&quot;ftp服务器地址不能为null&quot;);
  57      }
  58      int lastIndex = url.lastIndexOf(&quot;/&quot;);
  59      mTaskEntity.serverIp = serverIp;
  60      mTaskEntity.port = port;
  61      mEntity.setFileName(url.substring(lastIndex + 1, url.length()));
  62      mTaskEntity.refreshInfo = refreshInfo;
  63    }
  64  
  65    /**
  66     * 设置文件保存文件夹路径
  67     * 关于文件名：
  68     * 1、如果保存路径是该文件的保存路径，如：/mnt/sdcard/file.zip，则使用路径中的文件名file.zip
  69     * 2、如果保存路径是文件夹路径，如：/mnt/sdcard/，则使用FTP服务器该文件的文件名
  70     *
  71     * @param downloadPath 路径必须为文件路径，不能为文件夹路径
  72     */
  73    @Override public FtpDownloadTarget setDownloadPath(@NonNull String downloadPath) {
  74      if (TextUtils.isEmpty(downloadPath)) {
  75        throw new IllegalArgumentException(&quot;文件保持路径不能为null&quot;);
  76      }
  77      File file = new File(downloadPath);
  78      if (file.isDirectory()) {
  79        downloadPath += mEntity.getFileName();
  80      }
  81      if (!downloadPath.equals(mEntity.getDownloadPath())) {
  82        File oldFile = new File(mEntity.getDownloadPath());
  83        File newFile = new File(downloadPath);
  84        if (TextUtils.isEmpty(mEntity.getDownloadPath()) || oldFile.renameTo(newFile)) {
  85          mEntity.setDownloadPath(downloadPath);
  86          mEntity.setFileName(newFile.getName());
  87          mTaskEntity.key = downloadPath;
  88          mEntity.update();
  89          mTaskEntity.update();
  90          CommonUtil.renameDownloadConfig(oldFile.getName(), newFile.getName());
  91        }
  92      }
  93      return this;
  94    }
  95  
  96    /**
  97     * 设置字符编码
  98     */
  99    public FtpDownloadTarget charSet(String charSet) {
 100      if (TextUtils.isEmpty(charSet)) return this;
 101      mTaskEntity.charSet = charSet;
 102      return this;
 103    }
 104  
 105    /**
 106     * ftp 用户登录信息
 107     *
 108     * @param userName ftp用户名
 109     * @param password ftp用户密码
 110     */
 111    public FtpDownloadTarget login(String userName, String password) {
 112      return login(userName, password, null);
 113    }
 114  
 115    /**
 116     * ftp 用户登录信息
 117     *
 118     * @param userName ftp用户名
 119     * @param password ftp用户密码
 120     * @param account ftp账号
 121     */
 122    public FtpDownloadTarget login(String userName, String password, String account) {
 123      if (TextUtils.isEmpty(userName)) {
 124        Log.e(TAG, &quot;用户名不能为null&quot;);

 125        return this;
 126      } else if (TextUtils.isEmpty(password)) {
 127        Log.e(TAG, &quot;密码不能为null&quot;);

 128        return this;
 129      }
 130      mTaskEntity.userName = userName;
 131      mTaskEntity.userPw = password;
 132      mTaskEntity.account = account;




 133      return this;
 134    }
 135  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            