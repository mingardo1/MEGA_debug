<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>593</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    593
                    <a href="592.html">prev</a>
                    <a href="594.html">next</a>
                    <a href="593_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_b43aec0679d705647015fd4416ad6dc326ea7890_core/src/main/java/com/dtstack/flink/sql/side/JoinNodeDealer.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;b43aec0679d705647015fd4416ad6dc326ea7890:core/src/main/java/com/dtstack/flink/sql/side/JoinNodeDealer.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;b43aec0679d705647015fd4416ad6dc326ea7890^1:core/src/main/java/com/dtstack/flink/sql/side/JoinNodeDealer.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;b43aec0679d705647015fd4416ad6dc326ea7890^2:core/src/main/java/com/dtstack/flink/sql/side/JoinNodeDealer.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;6159bb9bb9904f950c489b50fb7dcbe399c3d327:core/src/main/java/com/dtstack/flink/sql/side/JoinNodeDealer.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [j], [s]], subset: [[bs], [j]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  20 package com.dtstack.flink.sql.side;                                                                      </span>
<span  style="">  21                                                                                                          </span>
<span class="-283888887417937620" onmouseenter="enter('-283888887417937620');" onmouseout="out('-283888887417937620');" style="">  22 import com.dtstack.flink.sql.parser.FlinkPlanner;                                                        </span>
<span class="-4585055968129153397" onmouseenter="enter('-4585055968129153397');" onmouseout="out('-4585055968129153397');" style="">  23 import com.dtstack.flink.sql.util.ParseUtils;                                                            </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  24 import com.dtstack.flink.sql.util.TableUtils;                                                            </span>
<span class="-1945462796058520247" onmouseenter="enter('-1945462796058520247');" onmouseout="out('-1945462796058520247');" style="">  25 import com.esotericsoftware.minlog.Log;                                                                  </span>
<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  26 import com.google.common.base.Preconditions;                                                             </span>
<span class="1793459060364841943" onmouseenter="enter('1793459060364841943');" onmouseout="out('1793459060364841943');" style="">  27 import com.google.common.collect.*;                                                                      </span>
<span class="8584998077480306668" onmouseenter="enter('8584998077480306668');" onmouseout="out('8584998077480306668');" style="">  28 import org.apache.calcite.sql.JoinType;                                                                  </span>
<span class="-6347312057640942811" onmouseenter="enter('-6347312057640942811');" onmouseout="out('-6347312057640942811');" style="">  29 import org.apache.calcite.sql.SqlAsOperator;                                                             </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  30 import org.apache.calcite.sql.SqlBasicCall;                                                              </span>
<span class="5864552825243215550" onmouseenter="enter('5864552825243215550');" onmouseout="out('5864552825243215550');" style="">  31 import org.apache.calcite.sql.SqlBinaryOperator;                                                         </span>
<span class="166699767162158130" onmouseenter="enter('166699767162158130');" onmouseout="out('166699767162158130');" style="">  32 import org.apache.calcite.sql.SqlDataTypeSpec;                                                           </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  33 import org.apache.calcite.sql.SqlIdentifier;                                                             </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  34 import org.apache.calcite.sql.SqlJoin;                                                                   </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  35 import org.apache.calcite.sql.SqlKind;                                                                   </span>
<span class="8852969977988754364" onmouseenter="enter('8852969977988754364');" onmouseout="out('8852969977988754364');" style="">  36 import org.apache.calcite.sql.SqlLiteral;                                                                </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  37 import org.apache.calcite.sql.SqlNode;                                                                   </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  38 import org.apache.calcite.sql.SqlNodeList;                                                               </span>
<span class="2919518510870551176" onmouseenter="enter('2919518510870551176');" onmouseout="out('2919518510870551176');" style="">  39 import org.apache.calcite.sql.SqlOperator;                                                               </span>
<span class="7522331514027736252" onmouseenter="enter('7522331514027736252');" onmouseout="out('7522331514027736252');" style="">  40 import org.apache.calcite.sql.fun.SqlCase;                                                               </span>
<span class="5604125466397600003" onmouseenter="enter('5604125466397600003');" onmouseout="out('5604125466397600003');" style="">  41 import org.apache.calcite.sql.fun.SqlStdOperatorTable;                                                   </span>
<span class="-8475519504744506507" onmouseenter="enter('-8475519504744506507');" onmouseout="out('-8475519504744506507');" style="">  42 import org.apache.calcite.sql.parser.SqlParserPos;                                                       </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  43 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  44 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  45 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="-3548577539000853351" onmouseenter="enter('-3548577539000853351');" onmouseout="out('-3548577539000853351');" style="">  46 import org.apache.flink.table.calcite.FlinkPlannerImpl;                                                  </span>
<span  style="">  47                                                                                                          </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  48 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  49 import java.util.Map;                                                                                    </span>
<span class="-2789246819365843415" onmouseenter="enter('-2789246819365843415');" onmouseout="out('-2789246819365843415');" style="">  50 import java.util.Queue;                                                                                  </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  51 import java.util.Set;                                                                                    </span>
<span  style="">  52                                                                                                          </span>
<span class="7147213704442467623" onmouseenter="enter('7147213704442467623');" onmouseout="out('7147213704442467623');" style="">  53 import static org.apache.calcite.sql.SqlKind.*;                                                          </span>
<span  style="">  54                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  55 /**                                                                                                      </span>
<span class="-4563013574845795077" onmouseenter="enter('-4563013574845795077');" onmouseout="out('-4563013574845795077');" style="">  56  * 处理join 节点                                                                                             </span>
<span class="8838344550496049683" onmouseenter="enter('8838344550496049683');" onmouseout="out('8838344550496049683');" style="">  57  * 1:如果包含维表节点替换为临时查询                                                                                     </span>
<span class="-7758652626234959796" onmouseenter="enter('-7758652626234959796');" onmouseout="out('-7758652626234959796');" style="">  58  * Date: 2020/2/27                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  59  * Company: www.dtstack.com                                                                              </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  60  * @author xuchao                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  61  */                                                                                                      </span>
<span  style="">  62                                                                                                          </span>
<span class="-8466270758182619990" onmouseenter="enter('-8466270758182619990');" onmouseout="out('-8466270758182619990');" style="">  63 public class JoinNodeDealer {                                                                            </span>
<span  style="">  64                                                                                                          </span>
<span class="8212789117715876957" onmouseenter="enter('8212789117715876957');" onmouseout="out('8212789117715876957');" style="">  65     //用来构建临时的中间查询                                                                                        </span>
<span class="7730461828310962384" onmouseenter="enter('7730461828310962384');" onmouseout="out('7730461828310962384');" style="">  66     private static final String SELECT_TEMP_SQL = &quot;select %s from %s %s&quot;;                                </span>
<span  style="">  67                                                                                                          </span>
<span class="-2249026806703256771" onmouseenter="enter('-2249026806703256771');" onmouseout="out('-2249026806703256771');" style="">  68     private SideSQLParser sideSQLParser;                                                                 </span>
<span  style="">  69                                                                                                          </span>
<span class="-3616611273672037444" onmouseenter="enter('-3616611273672037444');" onmouseout="out('-3616611273672037444');" style="">  70     public JoinNodeDealer(SideSQLParser sideSQLParser){                                                  </span>
<span class="1661690928916125634" onmouseenter="enter('1661690928916125634');" onmouseout="out('1661690928916125634');" style="">  71         this.sideSQLParser = sideSQLParser;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  72     }                                                                                                    </span>
<span  style="">  73                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  74     /**                                                                                                  </span>
<span class="5343191871470402950" onmouseenter="enter('5343191871470402950');" onmouseout="out('5343191871470402950');" style="">  75      * 解析 join 操作                                                                                        </span>
<span class="-2995351136134268537" onmouseenter="enter('-2995351136134268537');" onmouseout="out('-2995351136134268537');" style="">  76      * @param joinNode                                                                                   </span>
<span class="4073180356368850460" onmouseenter="enter('4073180356368850460');" onmouseout="out('4073180356368850460');" style="">  77      * @param sideTableSet 标明哪些表名是维表                                                                     </span>
<span class="-1350333652466574225" onmouseenter="enter('-1350333652466574225');" onmouseout="out('-1350333652466574225');" style="">  78      * @param queueInfo sql执行队列                                                                          </span>
<span class="-789269741895746259" onmouseenter="enter('-789269741895746259');" onmouseout="out('-789269741895746259');" style="">  79      * @param parentWhere join 关联的最上层的where 节点                                                           </span>
<span class="2915402449338812450" onmouseenter="enter('2915402449338812450');" onmouseout="out('2915402449338812450');" style="">  80      * @param parentSelectList join 关联的最上层的select 节点                                                     </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style="">  81      * @param joinFieldSet                                                                               </span>
<span class="6609942655811766869" onmouseenter="enter('6609942655811766869');" onmouseout="out('6609942655811766869');" style="">  82      * @param tableRef 存储构建临时表查询后源表和新表之间的关联关系                                                            </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="">  83      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  84      */                                                                                                  </span>
<span class="-2679967316725886886" onmouseenter="enter('-2679967316725886886');" onmouseout="out('-2679967316725886886');" style="">  85     public JoinInfo dealJoinNode(SqlJoin joinNode,                                                       </span>
<span class="-1952250395521254109" onmouseenter="enter('-1952250395521254109');" onmouseout="out('-1952250395521254109');" style="">  86                                  Set&lt;String&gt; sideTableSet,                                               </span>
<span class="405358965608327863" onmouseenter="enter('405358965608327863');" onmouseout="out('405358965608327863');" style="">  87                                  Queue&lt;Object&gt; queueInfo,                                                </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style="">  88                                  SqlNode parentWhere,                                                    </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style="">  89                                  SqlNodeList parentSelectList,                                           </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style="">  90                                  SqlNodeList parentGroupByList,                                          </span>
<span class="221219844685559650" onmouseenter="enter('221219844685559650');" onmouseout="out('221219844685559650');" style="">  91                                  Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,                               </span>
<span class="8208018358691263022" onmouseenter="enter('8208018358691263022');" onmouseout="out('8208018358691263022');" style="">  92                                  Map&lt;String, String&gt; tableRef,                                           </span>
<span class="-1320024569211882427" onmouseenter="enter('-1320024569211882427');" onmouseout="out('-1320024569211882427');" style="">  93                                  Map&lt;String, String&gt; fieldRef) {                                         </span>
<span  style="">  94                                                                                                          </span>
<span class="338082450955407251" onmouseenter="enter('338082450955407251');" onmouseout="out('338082450955407251');" style="">  95         SqlNode leftNode = joinNode.getLeft();                                                           </span>
<span class="6077141851454171925" onmouseenter="enter('6077141851454171925');" onmouseout="out('6077141851454171925');" style="">  96         SqlNode rightNode = joinNode.getRight();                                                         </span>
<span class="3771731584459985741" onmouseenter="enter('3771731584459985741');" onmouseout="out('3771731584459985741');" style="">  97         JoinType joinType = joinNode.getJoinType();                                                      </span>
<span  style="">  98                                                                                                          </span>
<span class="1132914906015926398" onmouseenter="enter('1132914906015926398');" onmouseout="out('1132914906015926398');" style="">  99         String leftTbName = &quot;&quot;;                                                                          </span>
<span class="4210951459006369780" onmouseenter="enter('4210951459006369780');" onmouseout="out('4210951459006369780');" style=""> 100         String leftTbAlias = &quot;&quot;;                                                                         </span>
<span class="8685549357368222156" onmouseenter="enter('8685549357368222156');" onmouseout="out('8685549357368222156');" style=""> 101         String rightTableName = &quot;&quot;;                                                                      </span>
<span class="-3462848723088515190" onmouseenter="enter('-3462848723088515190');" onmouseout="out('-3462848723088515190');" style=""> 102         String rightTableAlias = &quot;&quot;;                                                                     </span>
<span  style=""> 103                                                                                                          </span>
<span class="8157205433740328150" onmouseenter="enter('8157205433740328150');" onmouseout="out('8157205433740328150');" style=""> 104         //抽取join中的的条件                                                                                    </span>
<span class="-2983428553847994428" onmouseenter="enter('-2983428553847994428');" onmouseout="out('-2983428553847994428');" style=""> 105         extractJoinField(joinNode.getCondition(), joinFieldSet);                                         </span>
<span  style=""> 106                                                                                                          </span>
<span class="4311991652949423903" onmouseenter="enter('4311991652949423903');" onmouseout="out('4311991652949423903');" style=""> 107         if (leftNode.getKind() == JOIN) {                                                                </span>
<span class="8741114231031705604" onmouseenter="enter('8741114231031705604');" onmouseout="out('8741114231031705604');" style=""> 108             //处理连续join                                                                                   </span>
<span class="-1001268496906659006" onmouseenter="enter('-1001268496906659006');" onmouseout="out('-1001268496906659006');" style=""> 109             dealNestJoin(joinNode, sideTableSet,                                                         </span>
<span class="5383893876318256511" onmouseenter="enter('5383893876318256511');" onmouseout="out('5383893876318256511');" style=""><abbr title=" 110                     queueInfo, parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, fieldRef);"> 110                     queueInfo, parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, 🔵</abbr></span>
<span class="-2038895670102717129" onmouseenter="enter('-2038895670102717129');" onmouseout="out('-2038895670102717129');" style=""> 111             leftNode = joinNode.getLeft();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112         }                                                                                                </span>
<span  style=""> 113                                                                                                          </span>
<span class="4487076072297445468" onmouseenter="enter('4487076072297445468');" onmouseout="out('4487076072297445468');" style=""> 114         if (leftNode.getKind() == AS) {                                                                  </span>
<span class="939384655387303650" onmouseenter="enter('939384655387303650');" onmouseout="out('939384655387303650');" style=""><abbr title=" 115             AliasInfo aliasInfo = (AliasInfo) sideSQLParser.parseSql(leftNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 115             AliasInfo aliasInfo = (AliasInfo) sideSQLParser.parseSql(leftNode, sideTableSet, queueInfo, p🔵</abbr></span>
<span class="-6271284546665811801" onmouseenter="enter('-6271284546665811801');" onmouseout="out('-6271284546665811801');" style=""> 116             leftTbName = aliasInfo.getName();                                                            </span>
<span class="1754889631815621614" onmouseenter="enter('1754889631815621614');" onmouseout="out('1754889631815621614');" style=""> 117             leftTbAlias = aliasInfo.getAlias();                                                          </span>
<span class="-5692986469808836880" onmouseenter="enter('-5692986469808836880');" onmouseout="out('-5692986469808836880');" style=""> 118         } else if(leftNode.getKind() == IDENTIFIER){                                                     </span>
<span class="-2801204236324253727" onmouseenter="enter('-2801204236324253727');" onmouseout="out('-2801204236324253727');" style=""> 119             leftTbName = leftNode.toString();                                                            </span>
<span class="-1155513509208265617" onmouseenter="enter('-1155513509208265617');" onmouseout="out('-1155513509208265617');" style=""> 120             leftTbAlias = leftTbName;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121         }                                                                                                </span>
<span  style=""> 122                                                                                                          </span>
<span class="818500193985431170" onmouseenter="enter('818500193985431170');" onmouseout="out('818500193985431170');" style=""> 123         boolean leftIsSide = checkIsSideTable(leftTbName, sideTableSet);                                 </span>
<span class="3539880077969659090" onmouseenter="enter('3539880077969659090');" onmouseout="out('3539880077969659090');" style=""> 124         Preconditions.checkState(!leftIsSide, &quot;side-table must be at the right of join operator&quot;);       </span>
<span  style=""> 125                                                                                                          </span>
<span class="-1213513570275508110" onmouseenter="enter('-1213513570275508110');" onmouseout="out('-1213513570275508110');" style=""><abbr title=" 126         Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 126         Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo🔵</abbr></span>
<span class="-8717968456481913232" onmouseenter="enter('-8717968456481913232');" onmouseout="out('-8717968456481913232');" style=""> 127         rightTableName = rightTableNameAndAlias.f0;                                                      </span>
<span class="6344722288957274241" onmouseenter="enter('6344722288957274241');" onmouseout="out('6344722288957274241');" style=""> 128         rightTableAlias = rightTableNameAndAlias.f1;                                                     </span>
<span  style=""> 129                                                                                                          </span>
<span class="-2376755127467584795" onmouseenter="enter('-2376755127467584795');" onmouseout="out('-2376755127467584795');" style=""> 130         boolean rightIsSide = checkIsSideTable(rightTableName, sideTableSet);                            </span>
<span class="-8791016550933072203" onmouseenter="enter('-8791016550933072203');" onmouseout="out('-8791016550933072203');" style=""> 131         if(rightIsSide &amp;&amp; joinType == JoinType.RIGHT){                                                   </span>
<span class="-8772090804951491249" onmouseenter="enter('-8772090804951491249');" onmouseout="out('-8772090804951491249');" style=""><abbr title=" 132             throw new RuntimeException(&quot;side join not support join type of right[current support inner join and left join]&quot;);"> 132             throw new RuntimeException(&quot;side join not support join type of right[current support inner jo🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133         }                                                                                                </span>
<span  style=""> 134                                                                                                          </span>
<span class="-6467047856281920672" onmouseenter="enter('-6467047856281920672');" onmouseout="out('-6467047856281920672');" style=""> 135         JoinInfo tableInfo = new JoinInfo();                                                             </span>
<span class="-3449973379283837894" onmouseenter="enter('-3449973379283837894');" onmouseout="out('-3449973379283837894');" style=""> 136         tableInfo.setLeftTableName(leftTbName);                                                          </span>
<span class="3986639763024215846" onmouseenter="enter('3986639763024215846');" onmouseout="out('3986639763024215846');" style=""> 137         tableInfo.setRightTableName(rightTableName);                                                     </span>
<span  style=""> 138                                                                                                          </span>
<span class="-4276195101487104801" onmouseenter="enter('-4276195101487104801');" onmouseout="out('-4276195101487104801');" style=""> 139         leftTbAlias = StringUtils.isEmpty(leftTbAlias) ? leftTbName : leftTbAlias;                       </span>
<span class="3265584439264898224" onmouseenter="enter('3265584439264898224');" onmouseout="out('3265584439264898224');" style=""> 140         rightTableAlias = StringUtils.isEmpty(rightTableAlias) ? rightTableName : rightTableAlias;       </span>
<span  style=""> 141                                                                                                          </span>
<span class="846009662730869635" onmouseenter="enter('846009662730869635');" onmouseout="out('846009662730869635');" style=""> 142         tableInfo.setLeftTableAlias(leftTbAlias);                                                        </span>
<span class="4941698031257863857" onmouseenter="enter('4941698031257863857');" onmouseout="out('4941698031257863857');" style=""> 143         tableInfo.setRightTableAlias(rightTableAlias);                                                   </span>
<span class="-8645871838585664663" onmouseenter="enter('-8645871838585664663');" onmouseout="out('-8645871838585664663');" style=""> 144         tableInfo.setRightIsSideTable(rightIsSide);                                                      </span>
<span class="-1781974587467511895" onmouseenter="enter('-1781974587467511895');" onmouseout="out('-1781974587467511895');" style=""> 145         tableInfo.setLeftNode(leftNode);                                                                 </span>
<span class="-1730362975620128104" onmouseenter="enter('-1730362975620128104');" onmouseout="out('-1730362975620128104');" style=""> 146         tableInfo.setRightNode(rightNode);                                                               </span>
<span class="-6237310238590034687" onmouseenter="enter('-6237310238590034687');" onmouseout="out('-6237310238590034687');" style=""> 147         tableInfo.setJoinType(joinType);                                                                 </span>
<span class="-2724794810040782007" onmouseenter="enter('-2724794810040782007');" onmouseout="out('-2724794810040782007');" style=""> 148         tableInfo.setCondition(joinNode.getCondition());                                                 </span>
<span class="-6697941901007642600" onmouseenter="enter('-6697941901007642600');" onmouseout="out('-6697941901007642600');" style=""> 149         TableUtils.replaceJoinFieldRefTableName(joinNode.getCondition(), fieldRef);                      </span>
<span  style=""> 150                                                                                                          </span>
<span class="930681598926066970" onmouseenter="enter('930681598926066970');" onmouseout="out('930681598926066970');" style=""> 151         //extract 需要查询的字段信息                                                                              </span>
<span class="-1288427379447515770" onmouseenter="enter('-1288427379447515770');" onmouseout="out('-1288427379447515770');" style=""> 152         if(rightIsSide){                                                                                 </span>
<span class="4601009674852512506" onmouseenter="enter('4601009674852512506');" onmouseout="out('4601009674852512506');" style=""><abbr title=" 153             extractJoinNeedSelectField(leftNode, rightNode, parentWhere, parentSelectList, parentGroupByList, tableRef, joinFieldSet, fieldRef, tableInfo);"> 153             extractJoinNeedSelectField(leftNode, rightNode, parentWhere, parentSelectList, parentGroupByL🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154         }                                                                                                </span>
<span  style=""> 155                                                                                                          </span>
<span class="-8175769203069982871" onmouseenter="enter('-8175769203069982871');" onmouseout="out('-8175769203069982871');" style=""> 156         if(tableInfo.getLeftNode().getKind() != AS){                                                     </span>
<span class="-8283803146393095059" onmouseenter="enter('-8283803146393095059');" onmouseout="out('-8283803146393095059');" style=""> 157             return tableInfo;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158         }                                                                                                </span>
<span  style=""> 159                                                                                                          </span>
<span class="-7263872454890537563" onmouseenter="enter('-7263872454890537563');" onmouseout="out('-7263872454890537563');" style=""> 160         SqlKind asNodeFirstKind = ((SqlBasicCall)tableInfo.getLeftNode()).operands[0].getKind();         </span>
<span class="7769837734339006055" onmouseenter="enter('7769837734339006055');" onmouseout="out('7769837734339006055');" style=""> 161         if(asNodeFirstKind == SELECT){                                                                   </span>
<span class="-6186943853001324725" onmouseenter="enter('-6186943853001324725');" onmouseout="out('-6186943853001324725');" style=""> 162             queueInfo.offer(tableInfo.getLeftNode());                                                    </span>
<span class="5571842213520048771" onmouseenter="enter('5571842213520048771');" onmouseout="out('5571842213520048771');" style=""> 163             tableInfo.setLeftNode(((SqlBasicCall)tableInfo.getLeftNode()).operands[1]);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164         }                                                                                                </span>
<span  style=""> 165                                                                                                          </span>
<span class="-8283803146393095059" onmouseenter="enter('-8283803146393095059');" onmouseout="out('-8283803146393095059');" style=""> 166         return tableInfo;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167     }                                                                                                    </span>
<span  style=""> 168                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 169     /**                                                                                                  </span>
<span class="-6526994496424246980" onmouseenter="enter('-6526994496424246980');" onmouseout="out('-6526994496424246980');" style=""> 170      * 获取join 之后需要查询的字段信息                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 171      */                                                                                                  </span>
<span class="-8070342088850551474" onmouseenter="enter('-8070342088850551474');" onmouseout="out('-8070342088850551474');" style=""> 172     public void extractJoinNeedSelectField(SqlNode leftNode,                                             </span>
<span class="-4990225969144065515" onmouseenter="enter('-4990225969144065515');" onmouseout="out('-4990225969144065515');" style=""> 173                                            SqlNode rightNode,                                            </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style=""> 174                                            SqlNode parentWhere,                                          </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style=""> 175                                            SqlNodeList parentSelectList,                                 </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style=""> 176                                            SqlNodeList parentGroupByList,                                </span>
<span class="8208018358691263022" onmouseenter="enter('8208018358691263022');" onmouseout="out('8208018358691263022');" style=""> 177                                            Map&lt;String, String&gt; tableRef,                                 </span>
<span class="221219844685559650" onmouseenter="enter('221219844685559650');" onmouseout="out('221219844685559650');" style=""> 178                                            Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,                     </span>
<span class="5387904462551126599" onmouseenter="enter('5387904462551126599');" onmouseout="out('5387904462551126599');" style=""> 179                                            Map&lt;String, String&gt; fieldRef,                                 </span>
<span class="-1803976646211983141" onmouseenter="enter('-1803976646211983141');" onmouseout="out('-1803976646211983141');" style=""> 180                                            JoinInfo tableInfo){                                          </span>
<span  style=""> 181                                                                                                          </span>
<span class="-1711591104588450781" onmouseenter="enter('-1711591104588450781');" onmouseout="out('-1711591104588450781');" style=""><abbr title=" 182         Set&lt;String&gt; extractSelectField = extractField(leftNode, parentWhere, parentSelectList, parentGroupByList, tableRef, joinFieldSet);"> 182         Set&lt;String&gt; extractSelectField = extractField(leftNode, parentWhere, parentSelectList, parentGrou🔵</abbr></span>
<span class="5798543527687218027" onmouseenter="enter('5798543527687218027');" onmouseout="out('5798543527687218027');" style=""><abbr title=" 183         Set&lt;String&gt; rightExtractSelectField = extractField(rightNode, parentWhere, parentSelectList, parentGroupByList, tableRef, joinFieldSet);"> 183         Set&lt;String&gt; rightExtractSelectField = extractField(rightNode, parentWhere, parentSelectList, pare🔵</abbr></span>
<span  style=""> 184                                                                                                          </span>
<span class="3213038720352519337" onmouseenter="enter('3213038720352519337');" onmouseout="out('3213038720352519337');" style=""> 185         //重命名right 中和 left 重名的                                                                           </span>
<span class="7303277877915218137" onmouseenter="enter('7303277877915218137');" onmouseout="out('7303277877915218137');" style=""> 186         Map&lt;String, String&gt; leftTbSelectField = Maps.newHashMap();                                       </span>
<span class="-7917371932647768145" onmouseenter="enter('-7917371932647768145');" onmouseout="out('-7917371932647768145');" style=""> 187         Map&lt;String, String&gt; rightTbSelectField = Maps.newHashMap();                                      </span>
<span class="2809964139008068690" onmouseenter="enter('2809964139008068690');" onmouseout="out('2809964139008068690');" style=""> 188         String newTableName = tableInfo.getNewTableAlias();                                              </span>
<span  style=""> 189                                                                                                          </span>
<span class="3316391227079094306" onmouseenter="enter('3316391227079094306');" onmouseout="out('3316391227079094306');" style=""> 190         for(String tmpField : extractSelectField){                                                       </span>
<span class="-5672380782575278344" onmouseenter="enter('-5672380782575278344');" onmouseout="out('-5672380782575278344');" style=""> 191             String[] tmpFieldSplit = StringUtils.split(tmpField, &#x27;.&#x27;);                                   </span>
<span class="2836986565168806948" onmouseenter="enter('2836986565168806948');" onmouseout="out('2836986565168806948');" style=""> 192             leftTbSelectField.put(tmpFieldSplit[1], tmpFieldSplit[1]);                                   </span>
<span class="-5202931256248051147" onmouseenter="enter('-5202931256248051147');" onmouseout="out('-5202931256248051147');" style=""> 193             fieldRef.put(tmpField, TableUtils.buildTableField(newTableName, tmpFieldSplit[1]));          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194         }                                                                                                </span>
<span  style=""> 195                                                                                                          </span>
<span class="-9009930827099038696" onmouseenter="enter('-9009930827099038696');" onmouseout="out('-9009930827099038696');" style=""> 196         for(String tmpField : rightExtractSelectField){                                                  </span>
<span class="-5672380782575278344" onmouseenter="enter('-5672380782575278344');" onmouseout="out('-5672380782575278344');" style=""> 197             String[] tmpFieldSplit = StringUtils.split(tmpField, &#x27;.&#x27;);                                   </span>
<span class="7608141435657997055" onmouseenter="enter('7608141435657997055');" onmouseout="out('7608141435657997055');" style=""> 198             String originalFieldName = tmpFieldSplit[1];                                                 </span>
<span class="-6734440225783578199" onmouseenter="enter('-6734440225783578199');" onmouseout="out('-6734440225783578199');" style=""> 199             String targetFieldName = originalFieldName;                                                  </span>
<span class="-3298038078208796781" onmouseenter="enter('-3298038078208796781');" onmouseout="out('-3298038078208796781');" style=""> 200             if(leftTbSelectField.containsKey(originalFieldName)){                                        </span>
<span class="-1055151855410778283" onmouseenter="enter('-1055151855410778283');" onmouseout="out('-1055151855410778283');" style=""><abbr title=" 201                 targetFieldName = ParseUtils.dealDuplicateFieldName(leftTbSelectField, originalFieldName);"> 201                 targetFieldName = ParseUtils.dealDuplicateFieldName(leftTbSelectField, originalFieldName)🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202             }                                                                                            </span>
<span  style=""> 203                                                                                                          </span>
<span class="5677834067945950920" onmouseenter="enter('5677834067945950920');" onmouseout="out('5677834067945950920');" style=""> 204             rightTbSelectField.put(originalFieldName, targetFieldName);                                  </span>
<span class="1614475174789103856" onmouseenter="enter('1614475174789103856');" onmouseout="out('1614475174789103856');" style=""> 205             fieldRef.put(tmpField, TableUtils.buildTableField(newTableName, targetFieldName));           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206         }                                                                                                </span>
<span  style=""> 207                                                                                                          </span>
<span class="6039372522735153165" onmouseenter="enter('6039372522735153165');" onmouseout="out('6039372522735153165');" style=""> 208         tableInfo.setLeftSelectFieldInfo(leftTbSelectField);                                             </span>
<span class="-3036936727497955518" onmouseenter="enter('-3036936727497955518');" onmouseout="out('-3036936727497955518');" style=""> 209         tableInfo.setRightSelectFieldInfo(rightTbSelectField);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210     }                                                                                                    </span>
<span  style=""> 211                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 212     /**                                                                                                  </span>
<span class="6570650330648921499" onmouseenter="enter('6570650330648921499');" onmouseout="out('6570650330648921499');" style=""> 213      * 指定的节点关联到的 select 中的字段和 where中的字段                                                                  </span>
<span class="3061148848694484073" onmouseenter="enter('3061148848694484073');" onmouseout="out('3061148848694484073');" style=""> 214      * @param sqlNode                                                                                    </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 215      * @param parentWhere                                                                                </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style=""> 216      * @param parentSelectList                                                                           </span>
<span class="3557443413892532302" onmouseenter="enter('3557443413892532302');" onmouseout="out('3557443413892532302');" style=""> 217      * @param parentGroupByList                                                                          </span>
<span class="744467540294235613" onmouseenter="enter('744467540294235613');" onmouseout="out('744467540294235613');" style=""> 218      * @param tableRef                                                                                   </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style=""> 219      * @param joinFieldSet                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 220      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 221      */                                                                                                  </span>
<span class="-4373311553166434161" onmouseenter="enter('-4373311553166434161');" onmouseout="out('-4373311553166434161');" style=""> 222     public Set&lt;String&gt; extractField(SqlNode sqlNode,                                                     </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style=""> 223                                     SqlNode parentWhere,                                                 </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style=""> 224                                     SqlNodeList parentSelectList,                                        </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style=""> 225                                     SqlNodeList parentGroupByList,                                       </span>
<span class="8208018358691263022" onmouseenter="enter('8208018358691263022');" onmouseout="out('8208018358691263022');" style=""> 226                                     Map&lt;String, String&gt; tableRef,                                        </span>
<span class="7220891666826410078" onmouseenter="enter('7220891666826410078');" onmouseout="out('7220891666826410078');" style=""> 227                                     Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet){                           </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 228         Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                </span>
<span class="3720467049200805808" onmouseenter="enter('3720467049200805808');" onmouseout="out('3720467049200805808');" style=""> 229         TableUtils.getFromTableInfo(sqlNode, fromTableNameSet);                                          </span>
<span class="-6851932415303644529" onmouseenter="enter('-6851932415303644529');" onmouseout="out('-6851932415303644529');" style=""> 230         Set&lt;String&gt; extractCondition = Sets.newHashSet();                                                </span>
<span  style=""> 231                                                                                                          </span>
<span class="2214715548245711526" onmouseenter="enter('2214715548245711526');" onmouseout="out('2214715548245711526');" style=""> 232         extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere, extractCondition);           </span>
<span class="5747231761832639727" onmouseenter="enter('5747231761832639727');" onmouseout="out('5747231761832639727');" style=""><abbr title=" 233         Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tableRef);"> 233         Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tableRef🔵</abbr></span>
<span class="4281414700536968132" onmouseenter="enter('4281414700536968132');" onmouseout="out('4281414700536968132');" style=""><abbr title=" 234         Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableNameSet, tableRef);"> 234         Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableN🔵</abbr></span>
<span  style=""> 235                                                                                                          </span>
<span class="6344960557144626200" onmouseenter="enter('6344960557144626200');" onmouseout="out('6344960557144626200');" style=""><abbr title=" 236         Set&lt;String&gt; extractGroupByField = extractFieldFromGroupByList(parentGroupByList, fromTableNameSet, tableRef);"> 236         Set&lt;String&gt; extractGroupByField = extractFieldFromGroupByList(parentGroupByList, fromTableNameSet🔵</abbr></span>
<span  style=""> 237                                                                                                          </span>
<span class="7218037707336831410" onmouseenter="enter('7218037707336831410');" onmouseout="out('7218037707336831410');" style=""> 238         extractSelectField.addAll(extractCondition);                                                     </span>
<span class="4128012888485840534" onmouseenter="enter('4128012888485840534');" onmouseout="out('4128012888485840534');" style=""> 239         extractSelectField.addAll(fieldFromJoinCondition);                                               </span>
<span class="-8364010074861767596" onmouseenter="enter('-8364010074861767596');" onmouseout="out('-8364010074861767596');" style=""> 240         extractSelectField.addAll(extractGroupByField);                                                  </span>
<span  style=""> 241                                                                                                          </span>
<span class="6206897609633081926" onmouseenter="enter('6206897609633081926');" onmouseout="out('6206897609633081926');" style=""> 242         return extractSelectField;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243     }                                                                                                    </span>
<span  style=""> 244                                                                                                          </span>
<span  style=""> 245                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 246     /**                                                                                                  </span>
<span class="-2227309623247049332" onmouseenter="enter('-2227309623247049332');" onmouseout="out('-2227309623247049332');" style=""> 247      * 处理多层join                                                                                          </span>
<span class="-9032432844766422471" onmouseenter="enter('-9032432844766422471');" onmouseout="out('-9032432844766422471');" style=""> 248      * 判断左节点是否需要创建临时查询                                                                                   </span>
<span class="-3743716848325689638" onmouseenter="enter('-3743716848325689638');" onmouseout="out('-3743716848325689638');" style=""> 249      * （1）右节点是维表                                                                                         </span>
<span class="6062511326648248663" onmouseenter="enter('6062511326648248663');" onmouseout="out('6062511326648248663');" style=""> 250      * （2）左节点不是 as 节点                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 251      */                                                                                                  </span>
<span class="-8823647435533406854" onmouseenter="enter('-8823647435533406854');" onmouseout="out('-8823647435533406854');" style=""> 252     private JoinInfo dealNestJoin(SqlJoin joinNode,                                                      </span>
<span class="-1952250395521254109" onmouseenter="enter('-1952250395521254109');" onmouseout="out('-1952250395521254109');" style=""> 253                                   Set&lt;String&gt; sideTableSet,                                              </span>
<span class="405358965608327863" onmouseenter="enter('405358965608327863');" onmouseout="out('405358965608327863');" style=""> 254                                   Queue&lt;Object&gt; queueInfo,                                               </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style=""> 255                                   SqlNode parentWhere,                                                   </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style=""> 256                                   SqlNodeList parentSelectList,                                          </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style=""> 257                                   SqlNodeList parentGroupByList,                                         </span>
<span class="221219844685559650" onmouseenter="enter('221219844685559650');" onmouseout="out('221219844685559650');" style=""> 258                                   Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,                              </span>
<span class="8208018358691263022" onmouseenter="enter('8208018358691263022');" onmouseout="out('8208018358691263022');" style=""> 259                                   Map&lt;String, String&gt; tableRef,                                          </span>
<span class="4274367877110602869" onmouseenter="enter('4274367877110602869');" onmouseout="out('4274367877110602869');" style=""> 260                                   Map&lt;String, String&gt; fieldRef){                                         </span>
<span  style=""> 261                                                                                                          </span>
<span class="-5609072442761450329" onmouseenter="enter('-5609072442761450329');" onmouseout="out('-5609072442761450329');" style=""> 262         SqlJoin leftJoinNode = (SqlJoin) joinNode.getLeft();                                             </span>
<span class="-1304982916123509336" onmouseenter="enter('-1304982916123509336');" onmouseout="out('-1304982916123509336');" style=""> 263         SqlNode parentRightJoinNode = joinNode.getRight();                                               </span>
<span class="3581810211864331265" onmouseenter="enter('3581810211864331265');" onmouseout="out('3581810211864331265');" style=""> 264         SqlNode rightNode = leftJoinNode.getRight();                                                     </span>
<span class="-1213513570275508110" onmouseenter="enter('-1213513570275508110');" onmouseout="out('-1213513570275508110');" style=""><abbr title=" 265         Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 265         Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo🔵</abbr></span>
<span class="7880211710586462336" onmouseenter="enter('7880211710586462336');" onmouseout="out('7880211710586462336');" style=""><abbr title=" 266         Tuple2&lt;String, String&gt; parentRightJoinInfo = parseRightNode(parentRightJoinNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 266         Tuple2&lt;String, String&gt; parentRightJoinInfo = parseRightNode(parentRightJoinNode, sideTableSet, qu🔵</abbr></span>
<span class="-5913516627524533061" onmouseenter="enter('-5913516627524533061');" onmouseout="out('-5913516627524533061');" style=""> 267         boolean parentRightIsSide = checkIsSideTable(parentRightJoinInfo.f0, sideTableSet);              </span>
<span  style=""> 268                                                                                                          </span>
<span class="3375986139512671503" onmouseenter="enter('3375986139512671503');" onmouseout="out('3375986139512671503');" style=""><abbr title=" 269         JoinInfo joinInfo = dealJoinNode(leftJoinNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, fieldRef);"> 269         JoinInfo joinInfo = dealJoinNode(leftJoinNode, sideTableSet, queueInfo, parentWhere, parentSelect🔵</abbr></span>
<span  style=""> 270                                                                                                          </span>
<span class="-8707963241001902314" onmouseenter="enter('-8707963241001902314');" onmouseout="out('-8707963241001902314');" style=""> 271         String rightTableName = rightTableNameAndAlias.f0;                                               </span>
<span class="-2376755127467584795" onmouseenter="enter('-2376755127467584795');" onmouseout="out('-2376755127467584795');" style=""> 272         boolean rightIsSide = checkIsSideTable(rightTableName, sideTableSet);                            </span>
<span class="-1905801896855583684" onmouseenter="enter('-1905801896855583684');" onmouseout="out('-1905801896855583684');" style=""> 273         SqlBasicCall buildAs = TableUtils.buildAsNodeByJoinInfo(joinInfo, null, null);                   </span>
<span  style=""> 274                                                                                                          </span>
<span class="-1288427379447515770" onmouseenter="enter('-1288427379447515770');" onmouseout="out('-1288427379447515770');" style=""> 275         if(rightIsSide){                                                                                 </span>
<span class="-1341811977371241920" onmouseenter="enter('-1341811977371241920');" onmouseout="out('-1341811977371241920');" style=""><abbr title=" 276             addSideInfoToExeQueue(queueInfo, joinInfo, joinNode, parentSelectList, parentGroupByList, parentWhere, tableRef);"> 276             addSideInfoToExeQueue(queueInfo, joinInfo, joinNode, parentSelectList, parentGroupByList, par🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277         }                                                                                                </span>
<span  style=""> 278                                                                                                          </span>
<span class="-4926661402208797605" onmouseenter="enter('-4926661402208797605');" onmouseout="out('-4926661402208797605');" style=""> 279         SqlNode newLeftNode = joinNode.getLeft();                                                        </span>
<span  style=""> 280                                                                                                          </span>
<span class="669597408116519005" onmouseenter="enter('669597408116519005');" onmouseout="out('669597408116519005');" style=""> 281         if(newLeftNode.getKind() != AS &amp;&amp; parentRightIsSide){                                            </span>
<span  style=""> 282                                                                                                          </span>
<span class="-7949998902589886822" onmouseenter="enter('-7949998902589886822');" onmouseout="out('-7949998902589886822');" style=""> 283             String leftTbAlias = buildAs.getOperands()[1].toString();                                    </span>
<span class="-647616919686055479" onmouseenter="enter('-647616919686055479');" onmouseout="out('-647616919686055479');" style=""> 284             extractTemporaryQuery(newLeftNode, leftTbAlias, (SqlBasicCall) parentWhere,                  </span>
<span class="-4123256814652138053" onmouseenter="enter('-4123256814652138053');" onmouseout="out('-4123256814652138053');" style=""> 285                     parentSelectList, queueInfo, joinFieldSet, tableRef, fieldRef);                      </span>
<span  style=""> 286                                                                                                          </span>
<span class="3808835679994269685" onmouseenter="enter('3808835679994269685');" onmouseout="out('3808835679994269685');" style=""> 287             //替换leftNode 为新的查询                                                                           </span>
<span class="-9132777540839355627" onmouseenter="enter('-9132777540839355627');" onmouseout="out('-9132777540839355627');" style=""> 288             joinNode.setLeft(buildAs);                                                                   </span>
<span class="-2381095167123449114" onmouseenter="enter('-2381095167123449114');" onmouseout="out('-2381095167123449114');" style=""><abbr title=" 289             replaceSelectAndWhereField(buildAs, leftJoinNode, tableRef, parentSelectList, parentGroupByList, parentWhere);"> 289             replaceSelectAndWhereField(buildAs, leftJoinNode, tableRef, parentSelectList, parentGroupByLi🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290         }                                                                                                </span>
<span  style=""> 291                                                                                                          </span>
<span class="8714866254863163325" onmouseenter="enter('8714866254863163325');" onmouseout="out('8714866254863163325');" style=""> 292         return joinInfo;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293     }                                                                                                    </span>
<span  style=""> 294                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 295     /**                                                                                                  </span>
<span class="4951286882385365012" onmouseenter="enter('4951286882385365012');" onmouseout="out('4951286882385365012');" style=""> 296      * 右边表是维表需要重新构建左表的临时查询                                                                               </span>
<span class="-8208655787748224971" onmouseenter="enter('-8208655787748224971');" onmouseout="out('-8208655787748224971');" style=""> 297      * 并将joinInfo 添加到执行队列里面                                                                              </span>
<span class="3894561521416724418" onmouseenter="enter('3894561521416724418');" onmouseout="out('3894561521416724418');" style=""> 298      * @param queueInfo                                                                                  </span>
<span class="-6040909485639107572" onmouseenter="enter('-6040909485639107572');" onmouseout="out('-6040909485639107572');" style=""> 299      * @param joinInfo                                                                                   </span>
<span class="-2995351136134268537" onmouseenter="enter('-2995351136134268537');" onmouseout="out('-2995351136134268537');" style=""> 300      * @param joinNode                                                                                   </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style=""> 301      * @param parentSelectList                                                                           </span>
<span class="3557443413892532302" onmouseenter="enter('3557443413892532302');" onmouseout="out('3557443413892532302');" style=""> 302      * @param parentGroupByList                                                                          </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 303      * @param parentWhere                                                                                </span>
<span class="744467540294235613" onmouseenter="enter('744467540294235613');" onmouseout="out('744467540294235613');" style=""> 304      * @param tableRef                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 305      */                                                                                                  </span>
<span class="3979713406384282644" onmouseenter="enter('3979713406384282644');" onmouseout="out('3979713406384282644');" style=""> 306     public void addSideInfoToExeQueue(Queue&lt;Object&gt; queueInfo,                                           </span>
<span class="7516859044924889091" onmouseenter="enter('7516859044924889091');" onmouseout="out('7516859044924889091');" style=""> 307                                       JoinInfo joinInfo,                                                 </span>
<span class="1981177442384846922" onmouseenter="enter('1981177442384846922');" onmouseout="out('1981177442384846922');" style=""> 308                                       SqlJoin joinNode,                                                  </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style=""> 309                                       SqlNodeList parentSelectList,                                      </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style=""> 310                                       SqlNodeList parentGroupByList,                                     </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style=""> 311                                       SqlNode parentWhere,                                               </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style=""> 312                                       Map&lt;String, String&gt; tableRef){                                     </span>
<span class="-6478373311886746675" onmouseenter="enter('-6478373311886746675');" onmouseout="out('-6478373311886746675');" style=""> 313         //只处理维表                                                                                          </span>
<span class="-3203763040208890217" onmouseenter="enter('-3203763040208890217');" onmouseout="out('-3203763040208890217');" style=""> 314         if(!joinInfo.isRightIsSideTable()){                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 315             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316         }                                                                                                </span>
<span  style=""> 317                                                                                                          </span>
<span class="-1905801896855583684" onmouseenter="enter('-1905801896855583684');" onmouseout="out('-1905801896855583684');" style=""> 318         SqlBasicCall buildAs = TableUtils.buildAsNodeByJoinInfo(joinInfo, null, null);                   </span>
<span class="-2672508263360943403" onmouseenter="enter('-2672508263360943403');" onmouseout="out('-2672508263360943403');" style=""> 319         SqlNode leftJoinNode = joinNode.getLeft();                                                       </span>
<span class="6641920780390342492" onmouseenter="enter('6641920780390342492');" onmouseout="out('6641920780390342492');" style=""> 320         queueInfo.offer(joinInfo);                                                                       </span>
<span class="5508401011707832352" onmouseenter="enter('5508401011707832352');" onmouseout="out('5508401011707832352');" style=""> 321         //替换左表为新的表名称                                                                                     </span>
<span class="-9132777540839355627" onmouseenter="enter('-9132777540839355627');" onmouseout="out('-9132777540839355627');" style=""> 322         joinNode.setLeft(buildAs);                                                                       </span>
<span  style=""> 323                                                                                                          </span>
<span class="-2381095167123449114" onmouseenter="enter('-2381095167123449114');" onmouseout="out('-2381095167123449114');" style=""><abbr title=" 324         replaceSelectAndWhereField(buildAs, leftJoinNode, tableRef, parentSelectList, parentGroupByList, parentWhere);"> 324         replaceSelectAndWhereField(buildAs, leftJoinNode, tableRef, parentSelectList, parentGroupByList, 🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325     }                                                                                                    </span>
<span  style=""> 326                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 327     /**                                                                                                  </span>
<span class="2664257413645127477" onmouseenter="enter('2664257413645127477');" onmouseout="out('2664257413645127477');" style=""> 328      * 替换指定的查询和条件节点中的字段为新的字段                                                                             </span>
<span class="-5192515893397779968" onmouseenter="enter('-5192515893397779968');" onmouseout="out('-5192515893397779968');" style=""> 329      * @param buildAs                                                                                    </span>
<span class="8761373734140075238" onmouseenter="enter('8761373734140075238');" onmouseout="out('8761373734140075238');" style=""> 330      * @param leftJoinNode                                                                               </span>
<span class="744467540294235613" onmouseenter="enter('744467540294235613');" onmouseout="out('744467540294235613');" style=""> 331      * @param tableRef                                                                                   </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style=""> 332      * @param parentSelectList                                                                           </span>
<span class="3557443413892532302" onmouseenter="enter('3557443413892532302');" onmouseout="out('3557443413892532302');" style=""> 333      * @param parentGroupByList                                                                          </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 334      * @param parentWhere                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 335      */                                                                                                  </span>
<span class="-8851224148732895615" onmouseenter="enter('-8851224148732895615');" onmouseout="out('-8851224148732895615');" style=""> 336     public void replaceSelectAndWhereField(SqlBasicCall buildAs,                                         </span>
<span class="-7569254098639694631" onmouseenter="enter('-7569254098639694631');" onmouseout="out('-7569254098639694631');" style=""> 337                    SqlNode leftJoinNode,                                                                 </span>
<span class="8208018358691263022" onmouseenter="enter('8208018358691263022');" onmouseout="out('8208018358691263022');" style=""> 338                    Map&lt;String, String&gt; tableRef,                                                         </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style=""> 339                    SqlNodeList parentSelectList,                                                         </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style=""> 340                    SqlNodeList parentGroupByList,                                                        </span>
<span class="3000848303760980313" onmouseenter="enter('3000848303760980313');" onmouseout="out('3000848303760980313');" style=""> 341                    SqlNode parentWhere){                                                                 </span>
<span  style=""> 342                                                                                                          </span>
<span class="-1197906562874334747" onmouseenter="enter('-1197906562874334747');" onmouseout="out('-1197906562874334747');" style=""> 343         String newLeftTableName = buildAs.getOperands()[1].toString();                                   </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 344         Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                </span>
<span class="6977570025516648131" onmouseenter="enter('6977570025516648131');" onmouseout="out('6977570025516648131');" style=""> 345         TableUtils.getFromTableInfo(leftJoinNode, fromTableNameSet);                                     </span>
<span  style=""> 346                                                                                                          </span>
<span class="-4128731698405516984" onmouseenter="enter('-4128731698405516984');" onmouseout="out('-4128731698405516984');" style=""> 347         for(String tbTmp : fromTableNameSet){                                                            </span>
<span class="6564874017116360040" onmouseenter="enter('6564874017116360040');" onmouseout="out('6564874017116360040');" style=""> 348             tableRef.put(tbTmp, newLeftTableName);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349         }                                                                                                </span>
<span  style=""> 350                                                                                                          </span>
<span class="-3833992755798848111" onmouseenter="enter('-3833992755798848111');" onmouseout="out('-3833992755798848111');" style=""> 351         //替换select field 中的对应字段                                                                          </span>
<span class="5558486769410159556" onmouseenter="enter('5558486769410159556');" onmouseout="out('5558486769410159556');" style=""> 352         HashBiMap&lt;String, String&gt; fieldReplaceRef = HashBiMap.create();                                  </span>
<span class="5699421896693743778" onmouseenter="enter('5699421896693743778');" onmouseout="out('5699421896693743778');" style=""> 353         for(SqlNode sqlNode : parentSelectList.getList()){                                               </span>
<span class="-7140235961109122639" onmouseenter="enter('-7140235961109122639');" onmouseout="out('-7140235961109122639');" style=""> 354             for(String tbTmp : fromTableNameSet) {                                                       </span>
<span class="-581523387212695221" onmouseenter="enter('-581523387212695221');" onmouseout="out('-581523387212695221');" style=""> 355                 TableUtils.replaceSelectFieldTable(sqlNode, tbTmp, newLeftTableName, fieldReplaceRef);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357         }                                                                                                </span>
<span  style=""> 358                                                                                                          </span>
<span class="-8944541773972050035" onmouseenter="enter('-8944541773972050035');" onmouseout="out('-8944541773972050035');" style=""> 359         //TODO 应该根据上面的查询字段的关联关系来替换                                                                       </span>
<span class="1927000767768311618" onmouseenter="enter('1927000767768311618');" onmouseout="out('1927000767768311618');" style=""> 360         //替换where 中的条件相关                                                                                 </span>
<span class="-4128731698405516984" onmouseenter="enter('-4128731698405516984');" onmouseout="out('-4128731698405516984');" style=""> 361         for(String tbTmp : fromTableNameSet){                                                            </span>
<span class="5165818510692281294" onmouseenter="enter('5165818510692281294');" onmouseout="out('5165818510692281294');" style=""> 362             TableUtils.replaceWhereCondition(parentWhere, tbTmp, newLeftTableName, fieldReplaceRef);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363         }                                                                                                </span>
<span  style=""> 364                                                                                                          </span>
<span class="6193699176503696110" onmouseenter="enter('6193699176503696110');" onmouseout="out('6193699176503696110');" style=""> 365         if(parentGroupByList != null){                                                                   </span>
<span class="8082263099560409349" onmouseenter="enter('8082263099560409349');" onmouseout="out('8082263099560409349');" style=""> 366             for(SqlNode sqlNode : parentGroupByList.getList()){                                          </span>
<span class="-7140235961109122639" onmouseenter="enter('-7140235961109122639');" onmouseout="out('-7140235961109122639');" style=""> 367                 for(String tbTmp : fromTableNameSet) {                                                   </span>
<span class="-581523387212695221" onmouseenter="enter('-581523387212695221');" onmouseout="out('-581523387212695221');" style=""><abbr title=" 368                     TableUtils.replaceSelectFieldTable(sqlNode, tbTmp, newLeftTableName, fieldReplaceRef);"> 368                     TableUtils.replaceSelectFieldTable(sqlNode, tbTmp, newLeftTableName, fieldReplaceRef)🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 370             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371         }                                                                                                </span>
<span  style=""> 372                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373     }                                                                                                    </span>
<span  style=""> 374                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 375     /**                                                                                                  </span>
<span class="-9161506910855772732" onmouseenter="enter('-9161506910855772732');" onmouseout="out('-9161506910855772732');" style=""> 376      * 抽取出中间查询表                                                                                          </span>
<span class="384197096128287152" onmouseenter="enter('384197096128287152');" onmouseout="out('384197096128287152');" style=""> 377      * @param node                                                                                       </span>
<span class="3992250397465727176" onmouseenter="enter('3992250397465727176');" onmouseout="out('3992250397465727176');" style=""> 378      * @param tableAlias                                                                                 </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 379      * @param parentWhere                                                                                </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style=""> 380      * @param parentSelectList                                                                           </span>
<span class="3894561521416724418" onmouseenter="enter('3894561521416724418');" onmouseout="out('3894561521416724418');" style=""> 381      * @param queueInfo                                                                                  </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style=""> 382      * @param joinFieldSet                                                                               </span>
<span class="744467540294235613" onmouseenter="enter('744467540294235613');" onmouseout="out('744467540294235613');" style=""> 383      * @param tableRef                                                                                   </span>
<span class="6064073244373316048" onmouseenter="enter('6064073244373316048');" onmouseout="out('6064073244373316048');" style=""> 384      * @return 源自段和新生成字段之间的映射关系                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 385      */                                                                                                  </span>
<span class="-6236609755307512773" onmouseenter="enter('-6236609755307512773');" onmouseout="out('-6236609755307512773');" style=""> 386     private void extractTemporaryQuery(SqlNode node, String tableAlias,                                  </span>
<span class="1711245815305911921" onmouseenter="enter('1711245815305911921');" onmouseout="out('1711245815305911921');" style=""> 387                                        SqlBasicCall parentWhere,                                         </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style=""> 388                                        SqlNodeList parentSelectList,                                     </span>
<span class="405358965608327863" onmouseenter="enter('405358965608327863');" onmouseout="out('405358965608327863');" style=""> 389                                        Queue&lt;Object&gt; queueInfo,                                          </span>
<span class="221219844685559650" onmouseenter="enter('221219844685559650');" onmouseout="out('221219844685559650');" style=""> 390                                        Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,                         </span>
<span class="8208018358691263022" onmouseenter="enter('8208018358691263022');" onmouseout="out('8208018358691263022');" style=""> 391                                        Map&lt;String, String&gt; tableRef,                                     </span>
<span class="4274367877110602869" onmouseenter="enter('4274367877110602869');" onmouseout="out('4274367877110602869');" style=""> 392                                        Map&lt;String, String&gt; fieldRef){                                    </span>
<span class="-1891643383856272179" onmouseenter="enter('-1891643383856272179');" onmouseout="out('-1891643383856272179');" style=""> 393         try{                                                                                             </span>
<span class="-8973252823595593319" onmouseenter="enter('-8973252823595593319');" onmouseout="out('-8973252823595593319');" style=""> 394             //父一级的where 条件中如果只和临时查询相关的条件都截取进来                                                            </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 395             Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                            </span>
<span class="-1162190359921159801" onmouseenter="enter('-1162190359921159801');" onmouseout="out('-1162190359921159801');" style=""> 396             List&lt;SqlBasicCall&gt; extractCondition = Lists.newArrayList();                                  </span>
<span  style=""> 397                                                                                                          </span>
<span class="8110456237367799034" onmouseenter="enter('8110456237367799034');" onmouseout="out('8110456237367799034');" style=""> 398             TableUtils.getFromTableInfo(node, fromTableNameSet);                                         </span>
<span class="6022466615463989785" onmouseenter="enter('6022466615463989785');" onmouseout="out('6022466615463989785');" style=""> 399             checkAndRemoveWhereCondition(fromTableNameSet, parentWhere, extractCondition);               </span>
<span  style=""> 400                                                                                                          </span>
<span class="8695778948204515419" onmouseenter="enter('8695778948204515419');" onmouseout="out('8695778948204515419');" style=""> 401             if(node.getKind() == JOIN){                                                                  </span>
<span class="-6199554136531935919" onmouseenter="enter('-6199554136531935919');" onmouseout="out('-6199554136531935919');" style=""> 402                 checkAndReplaceJoinCondition(((SqlJoin)node).getCondition(), tableRef);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403             }                                                                                            </span>
<span  style=""> 404                                                                                                          </span>
<span class="5747231761832639727" onmouseenter="enter('5747231761832639727');" onmouseout="out('5747231761832639727');" style=""><abbr title=" 405             Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tableRef);"> 405             Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tabl🔵</abbr></span>
<span class="4281414700536968132" onmouseenter="enter('4281414700536968132');" onmouseout="out('4281414700536968132');" style=""><abbr title=" 406             Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableNameSet, tableRef);"> 406             Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTa🔵</abbr></span>
<span class="-718326697477564125" onmouseenter="enter('-718326697477564125');" onmouseout="out('-718326697477564125');" style=""> 407             Set&lt;String&gt; newFields = buildSelectNode(extractSelectField, fieldFromJoinCondition);         </span>
<span class="9076146696470564191" onmouseenter="enter('9076146696470564191');" onmouseout="out('9076146696470564191');" style=""> 408             String extractSelectFieldStr = StringUtils.join(newFields, &#x27;,&#x27;);                             </span>
<span  style=""> 409                                                                                                          </span>
<span class="4157544700609283076" onmouseenter="enter('4157544700609283076');" onmouseout="out('4157544700609283076');" style=""> 410             Map&lt;String, String&gt; oldRefNewField = buildTmpTableFieldRefOriField(newFields, tableAlias);   </span>
<span class="-9040628512379918841" onmouseenter="enter('-9040628512379918841');" onmouseout="out('-9040628512379918841');" style=""> 411             fieldRef.putAll(oldRefNewField);                                                             </span>
<span  style=""> 412                                                                                                          </span>
<span class="-3122368802496797506" onmouseenter="enter('-3122368802496797506');" onmouseout="out('-3122368802496797506');" style=""> 413             String extractConditionStr = buildCondition(extractCondition);                               </span>
<span  style=""> 414                                                                                                          </span>
<span class="6190023554533569746" onmouseenter="enter('6190023554533569746');" onmouseout="out('6190023554533569746');" style=""> 415             String tmpSelectSql = String.format(SELECT_TEMP_SQL,                                         </span>
<span class="3430988890108370699" onmouseenter="enter('3430988890108370699');" onmouseout="out('3430988890108370699');" style=""> 416                     extractSelectFieldStr,                                                               </span>
<span class="-1169517675965244531" onmouseenter="enter('-1169517675965244531');" onmouseout="out('-1169517675965244531');" style=""> 417                     node.toString(),                                                                     </span>
<span class="4099345839703116685" onmouseenter="enter('4099345839703116685');" onmouseout="out('4099345839703116685');" style=""> 418                     extractConditionStr);                                                                </span>
<span  style=""> 419                                                                                                          </span>
<span class="-1075958635284917181" onmouseenter="enter('-1075958635284917181');" onmouseout="out('-1075958635284917181');" style=""> 420             FlinkPlannerImpl flinkPlanner = FlinkPlanner.getFlinkPlanner();                              </span>
<span class="7395930912815097284" onmouseenter="enter('7395930912815097284');" onmouseout="out('7395930912815097284');" style=""> 421             SqlNode sqlNode = flinkPlanner.parse(tmpSelectSql);                                          </span>
<span  style=""> 422                                                                                                          </span>
<span class="-2735890898778643076" onmouseenter="enter('-2735890898778643076');" onmouseout="out('-2735890898778643076');" style=""> 423             SqlBasicCall sqlBasicCall = buildAsSqlNode(tableAlias, sqlNode);                             </span>
<span class="2417854506040223841" onmouseenter="enter('2417854506040223841');" onmouseout="out('2417854506040223841');" style=""> 424             queueInfo.offer(sqlBasicCall);                                                               </span>
<span  style=""> 425                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 426 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="3036777158467770620" onmouseenter="enter('3036777158467770620');" onmouseout="out('3036777158467770620');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 427             //替换select中的表结构                                                                              </span>
<span class="5558486769410159556" onmouseenter="enter('5558486769410159556');" onmouseout="out('5558486769410159556');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 428             HashBiMap&lt;String, String&gt; fieldReplaceRef = HashBiMap.create();                              </span>
<span class="6403576620687993648" onmouseenter="enter('6403576620687993648');" onmouseout="out('6403576620687993648');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 429             for(SqlNode tmpSelect : parentSelectList.getList()){                                         </span>
<span class="-7140235961109122639" onmouseenter="enter('-7140235961109122639');" onmouseout="out('-7140235961109122639');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 430                 for(String tbTmp : fromTableNameSet) {                                                   </span>
<span class="-2362265056324339707" onmouseenter="enter('-2362265056324339707');" onmouseout="out('-2362265056324339707');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 431                     TableUtils.replaceSelectFieldTable(tmpSelect, tbTmp, tableAlias, fieldReplaceRef);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 432                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 433             }                                                                                            </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 434                                                                                                          </span>
<span class="1927000767768311618" onmouseenter="enter('1927000767768311618');" onmouseout="out('1927000767768311618');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 435             //替换where 中的条件相关                                                                             </span>
<span class="-4128731698405516984" onmouseenter="enter('-4128731698405516984');" onmouseout="out('-4128731698405516984');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 436             for(String tbTmp : fromTableNameSet){                                                        </span>
<span class="859671676632511130" onmouseenter="enter('859671676632511130');" onmouseout="out('859671676632511130');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 437                 TableUtils.replaceWhereCondition(parentWhere, tbTmp, tableAlias, fieldReplaceRef);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 438             }                                                                                            </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 439                                                                                                          </span>
<span class="-4128731698405516984" onmouseenter="enter('-4128731698405516984');" onmouseout="out('-4128731698405516984');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 440             for(String tbTmp : fromTableNameSet){                                                        </span>
<span class="-6060557126611161603" onmouseenter="enter('-6060557126611161603');" onmouseout="out('-6060557126611161603');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 441                 tableRef.put(tbTmp, tableAlias);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 442             }                                                                                            </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 443                                                                                                          </span>
<span class="3487269535061511064" onmouseenter="enter('3487269535061511064');" onmouseout="out('3487269535061511064');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 444             System.out.println(&quot;-------build temporary query-----------&quot;);                               </span>
<span class="-8101867096626384734" onmouseenter="enter('-8101867096626384734');" onmouseout="out('-8101867096626384734');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 445             System.out.println(tmpSelectSql);                                                            </span>
<span class="-4281832807373115174" onmouseenter="enter('-4281832807373115174');" onmouseout="out('-4281832807373115174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 446             System.out.println(&quot;---------------------------------------&quot;);                               </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 447                                                                                                          </span>
<span class="-1580407524319062305" onmouseenter="enter('-1580407524319062305');" onmouseout="out('-1580407524319062305');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 448         }catch (Exception e){                                                                            </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 449             e.printStackTrace();                                                                         </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 450 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-8101867096626384734" onmouseenter="enter('-8101867096626384734');" onmouseout="out('-8101867096626384734');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 451             System.out.println(tmpSelectSql);                                                            </span>
<span class="-4281832807373115174" onmouseenter="enter('-4281832807373115174');" onmouseout="out('-4281832807373115174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 452             System.out.println(&quot;---------------------------------------&quot;);                               </span>
<span class="-1580407524319062305" onmouseenter="enter('-1580407524319062305');" onmouseout="out('-1580407524319062305');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 453         }catch (Exception e){                                                                            </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 454             e.printStackTrace();                                                                         </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 455             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 456         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 457     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 458                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 459     /**                                                                                                  </span>
<span class="-4499840608975407423" onmouseenter="enter('-4499840608975407423');" onmouseout="out('-4499840608975407423');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 460      * 抽取上层需用使用到的字段                                                                                      </span>
<span class="9099401058466039467" onmouseenter="enter('9099401058466039467');" onmouseout="out('9099401058466039467');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 461      * 由于where字段已经抽取到上一层了所以不用查询出来                                                                        </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 462      * @param parentSelectList                                                                           </span>
<span class="-6365101737408851156" onmouseenter="enter('-6365101737408851156');" onmouseout="out('-6365101737408851156');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 463      * @param fromTableNameSet                                                                           </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 464      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 465      */                                                                                                  </span>
<span class="-1410253319795430175" onmouseenter="enter('-1410253319795430175');" onmouseout="out('-1410253319795430175');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 466     private Set&lt;String&gt; extractSelectFields(SqlNodeList parentSelectList,                                </span>
<span class="8604782440088857459" onmouseenter="enter('8604782440088857459');" onmouseout="out('8604782440088857459');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 467                                             Set&lt;String&gt; fromTableNameSet,                                </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 468                                             Map&lt;String, String&gt; tableRef){                               </span>
<span class="-4673362671275703253" onmouseenter="enter('-4673362671275703253');" onmouseout="out('-4673362671275703253');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 469         Set&lt;String&gt; extractFieldList = Sets.newHashSet();                                                </span>
<span class="-7414180011567654896" onmouseenter="enter('-7414180011567654896');" onmouseout="out('-7414180011567654896');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 470         for(SqlNode selectNode : parentSelectList.getList()){                                            </span>
<span class="1095915068729564148" onmouseenter="enter('1095915068729564148');" onmouseout="out('1095915068729564148');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 471             extractSelectField(selectNode, extractFieldList, fromTableNameSet, tableRef);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 472         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 473                                                                                                          </span>
<span class="-1685101767459189568" onmouseenter="enter('-1685101767459189568');" onmouseout="out('-1685101767459189568');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 474         return extractFieldList;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 475     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 476                                                                                                          </span>
<span class="-3843180343280265019" onmouseenter="enter('-3843180343280265019');" onmouseout="out('-3843180343280265019');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 477     private Set&lt;String&gt; extractSelectFieldFromJoinCondition(Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet, Set&lt;String&gt; fromTableNameSet){"> 477     private Set&lt;String&gt; extractSelectFieldFromJoinCondition(Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet, Set🔵</abbr></span>
<span class="-4673362671275703253" onmouseenter="enter('-4673362671275703253');" onmouseout="out('-4673362671275703253');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 478         Set&lt;String&gt; extractFieldList = Sets.newHashSet();                                                </span>
<span class="8833203050470988767" onmouseenter="enter('8833203050470988767');" onmouseout="out('8833203050470988767');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 479         for(Tuple2&lt;String, String&gt; field : joinFieldSet){                                                </span>
<span class="-9037397631967971194" onmouseenter="enter('-9037397631967971194');" onmouseout="out('-9037397631967971194');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 480             if(fromTableNameSet.contains(field.f0)){                                                     </span>
<span class="-4436761311933817361" onmouseenter="enter('-4436761311933817361');" onmouseout="out('-4436761311933817361');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 481                 extractFieldList.add(field.f0 + &quot;.&quot; + field.f1);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 482             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 483         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 484                                                                                                          </span>
<span class="-1685101767459189568" onmouseenter="enter('-1685101767459189568');" onmouseout="out('-1685101767459189568');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 485         return extractFieldList;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 486     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 487                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 488     /**                                                                                                  </span>
<span class="-672438967754228662" onmouseenter="enter('-672438967754228662');" onmouseout="out('-672438967754228662');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 489      * 从join的条件中获取字段信息                                                                                   </span>
<span class="-4160812560585701802" onmouseenter="enter('-4160812560585701802');" onmouseout="out('-4160812560585701802');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 490      * @param condition                                                                                  </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 491      * @param joinFieldSet                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 492      */                                                                                                  </span>
<span class="1552352851009209412" onmouseenter="enter('1552352851009209412');" onmouseout="out('1552352851009209412');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 493     private void extractJoinField(SqlNode condition, Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet){          </span>
<span class="5418896256960850645" onmouseenter="enter('5418896256960850645');" onmouseout="out('5418896256960850645');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 494         SqlKind joinKind = condition.getKind();                                                          </span>
<span class="6904180996725590590" onmouseenter="enter('6904180996725590590');" onmouseout="out('6904180996725590590');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 495         if( joinKind == AND || joinKind == EQUALS ){                                                     </span>
<span class="5740954560868172997" onmouseenter="enter('5740954560868172997');" onmouseout="out('5740954560868172997');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 496             extractJoinField(((SqlBasicCall)condition).operands[0], joinFieldSet);                       </span>
<span class="-450517509397156355" onmouseenter="enter('-450517509397156355');" onmouseout="out('-450517509397156355');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 497             extractJoinField(((SqlBasicCall)condition).operands[1], joinFieldSet);                       </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 498         }else{                                                                                           </span>
<span class="3421902236901684905" onmouseenter="enter('3421902236901684905');" onmouseout="out('3421902236901684905');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 499             Preconditions.checkState(((SqlIdentifier)condition).names.size() == 2, &quot;join condition must be format table.field&quot;);"> 499             Preconditions.checkState(((SqlIdentifier)condition).names.size() == 2, &quot;join condition must b🔵</abbr></span>
<span class="6389924414477169388" onmouseenter="enter('6389924414477169388');" onmouseout="out('6389924414477169388');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 500             Tuple2&lt;String, String&gt; tuple2 = Tuple2.of(((SqlIdentifier)condition).names.get(0), ((SqlIdentifier)condition).names.get(1));"> 500             Tuple2&lt;String, String&gt; tuple2 = Tuple2.of(((SqlIdentifier)condition).names.get(0), ((SqlIdent🔵</abbr></span>
<span class="-8031023747394340843" onmouseenter="enter('-8031023747394340843');" onmouseout="out('-8031023747394340843');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 501             joinFieldSet.add(tuple2);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 502         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 503     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 504                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 505                                                                                                          </span>
<span class="-6450965667049352633" onmouseenter="enter('-6450965667049352633');" onmouseout="out('-6450965667049352633');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 506     private void extractSelectField(SqlNode selectNode,                                                  </span>
<span class="4215167182352113360" onmouseenter="enter('4215167182352113360');" onmouseout="out('4215167182352113360');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 507                                     Set&lt;String&gt; extractFieldSet,                                         </span>
<span class="8604782440088857459" onmouseenter="enter('8604782440088857459');" onmouseout="out('8604782440088857459');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 508                                     Set&lt;String&gt; fromTableNameSet,                                        </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 509                                     Map&lt;String, String&gt; tableRef){                                       </span>
<span class="8103739576060170768" onmouseenter="enter('8103739576060170768');" onmouseout="out('8103739576060170768');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 510         if (selectNode.getKind() == AS) {                                                                </span>
<span class="1510889832473438632" onmouseenter="enter('1510889832473438632');" onmouseout="out('1510889832473438632');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 511             SqlNode leftNode = ((SqlBasicCall) selectNode).getOperands()[0];                             </span>
<span class="-3569930423065034136" onmouseenter="enter('-3569930423065034136');" onmouseout="out('-3569930423065034136');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 512             extractSelectField(leftNode, extractFieldSet, fromTableNameSet, tableRef);                   </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 513                                                                                                          </span>
<span class="-8354265102451448120" onmouseenter="enter('-8354265102451448120');" onmouseout="out('-8354265102451448120');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 514         }else if(selectNode.getKind() == IDENTIFIER) {                                                   </span>
<span class="-3732912994311321816" onmouseenter="enter('-3732912994311321816');" onmouseout="out('-3732912994311321816');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 515             SqlIdentifier sqlIdentifier = (SqlIdentifier) selectNode;                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 516                                                                                                          </span>
<span class="2651178788475624428" onmouseenter="enter('2651178788475624428');" onmouseout="out('2651178788475624428');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 517             if(sqlIdentifier.names.size() == 1){                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 518                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 519             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 520                                                                                                          </span>
<span class="3965609827388612088" onmouseenter="enter('3965609827388612088');" onmouseout="out('3965609827388612088');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 521             String tableName = sqlIdentifier.names.get(0);                                               </span>
<span class="5468885380070811563" onmouseenter="enter('5468885380070811563');" onmouseout="out('5468885380070811563');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 522             //TODO                                                                                       </span>
<span class="3096268752058072981" onmouseenter="enter('3096268752058072981');" onmouseout="out('3096268752058072981');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 523             if(fromTableNameSet.contains(tableName)){                                                    </span>
<span class="-4452600673359758385" onmouseenter="enter('-4452600673359758385');" onmouseout="out('-4452600673359758385');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 524                 extractFieldSet.add(sqlIdentifier.toString());                                           </span>
<span class="1142707085951947184" onmouseenter="enter('1142707085951947184');" onmouseout="out('1142707085951947184');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 525             } else if(fromTableNameSet.contains(tableRef.get(tableName))){                               </span>
<span class="5574286290036421401" onmouseenter="enter('5574286290036421401');" onmouseout="out('5574286290036421401');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 526                 //TODO extractFieldSet.add(sqlIdentifier.setName(0, tableRef.get(tableName)).toString());</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 527             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 528                                                                                                          </span>
<span class="7025405726449532045" onmouseenter="enter('7025405726449532045');" onmouseout="out('7025405726449532045');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 529         }else if(  AGGREGATE.contains(selectNode.getKind())                                              </span>
<span class="-6933542481251357306" onmouseenter="enter('-6933542481251357306');" onmouseout="out('-6933542481251357306');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 530                 || AVG_AGG_FUNCTIONS.contains(selectNode.getKind())                                      </span>
<span class="-2120439329066417772" onmouseenter="enter('-2120439329066417772');" onmouseout="out('-2120439329066417772');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 531                 || COMPARISON.contains(selectNode.getKind())                                             </span>
<span class="6729191807379931332" onmouseenter="enter('6729191807379931332');" onmouseout="out('6729191807379931332');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 532                 || selectNode.getKind() == OTHER_FUNCTION                                                </span>
<span class="-790540336783787818" onmouseenter="enter('-790540336783787818');" onmouseout="out('-790540336783787818');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 533                 || selectNode.getKind() == DIVIDE                                                        </span>
<span class="8042439450870069301" onmouseenter="enter('8042439450870069301');" onmouseout="out('8042439450870069301');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 534                 || selectNode.getKind() == CAST                                                          </span>
<span class="8131430949670321542" onmouseenter="enter('8131430949670321542');" onmouseout="out('8131430949670321542');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 535                 || selectNode.getKind() == TRIM                                                          </span>
<span class="7539044465271514325" onmouseenter="enter('7539044465271514325');" onmouseout="out('7539044465271514325');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 536                 || selectNode.getKind() == TIMES                                                         </span>
<span class="5017875227939513377" onmouseenter="enter('5017875227939513377');" onmouseout="out('5017875227939513377');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 537                 || selectNode.getKind() == PLUS                                                          </span>
<span class="-8896687143784188803" onmouseenter="enter('-8896687143784188803');" onmouseout="out('-8896687143784188803');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 538                 || selectNode.getKind() == NOT_IN                                                        </span>
<span class="-1863732027976694038" onmouseenter="enter('-1863732027976694038');" onmouseout="out('-1863732027976694038');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 539                 || selectNode.getKind() == OR                                                            </span>
<span class="6505261652610820896" onmouseenter="enter('6505261652610820896');" onmouseout="out('6505261652610820896');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 540                 || selectNode.getKind() == AND                                                           </span>
<span class="8098904506676885196" onmouseenter="enter('8098904506676885196');" onmouseout="out('8098904506676885196');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 541                 || selectNode.getKind() == MINUS                                                         </span>
<span class="-157153081163608557" onmouseenter="enter('-157153081163608557');" onmouseout="out('-157153081163608557');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 542                 || selectNode.getKind() == TUMBLE                                                        </span>
<span class="-2839638964097736537" onmouseenter="enter('-2839638964097736537');" onmouseout="out('-2839638964097736537');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 543                 || selectNode.getKind() == TUMBLE_START                                                  </span>
<span class="6482577849437391011" onmouseenter="enter('6482577849437391011');" onmouseout="out('6482577849437391011');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 544                 || selectNode.getKind() == TUMBLE_END                                                    </span>
<span class="6880276476651207951" onmouseenter="enter('6880276476651207951');" onmouseout="out('6880276476651207951');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 545                 || selectNode.getKind() == SESSION                                                       </span>
<span class="-5893490809135961202" onmouseenter="enter('-5893490809135961202');" onmouseout="out('-5893490809135961202');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 546                 || selectNode.getKind() == SESSION_START                                                 </span>
<span class="-1646114820326763405" onmouseenter="enter('-1646114820326763405');" onmouseout="out('-1646114820326763405');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 547                 || selectNode.getKind() == SESSION_END                                                   </span>
<span class="268793040563115559" onmouseenter="enter('268793040563115559');" onmouseout="out('268793040563115559');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 548                 || selectNode.getKind() == HOP                                                           </span>
<span class="5104117061177388693" onmouseenter="enter('5104117061177388693');" onmouseout="out('5104117061177388693');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 549                 || selectNode.getKind() == HOP_START                                                     </span>
<span class="8235260830665848207" onmouseenter="enter('8235260830665848207');" onmouseout="out('8235260830665848207');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 550                 || selectNode.getKind() == HOP_END                                                       </span>
<span class="-3943236427179035086" onmouseenter="enter('-3943236427179035086');" onmouseout="out('-3943236427179035086');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 551                 || selectNode.getKind() == BETWEEN                                                       </span>
<span class="-4981553052649867721" onmouseenter="enter('-4981553052649867721');" onmouseout="out('-4981553052649867721');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 552                 || selectNode.getKind() == IS_NULL                                                       </span>
<span class="2062318608323297657" onmouseenter="enter('2062318608323297657');" onmouseout="out('2062318608323297657');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 553                 || selectNode.getKind() == IS_NOT_NULL                                                   </span>
<span class="-5717204280699012051" onmouseenter="enter('-5717204280699012051');" onmouseout="out('-5717204280699012051');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 554                 || selectNode.getKind() == CONTAINS                                                      </span>
<span class="-4225388998654687854" onmouseenter="enter('-4225388998654687854');" onmouseout="out('-4225388998654687854');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 555                 || selectNode.getKind() == TIMESTAMP_ADD                                                 </span>
<span class="-1992782825152874013" onmouseenter="enter('-1992782825152874013');" onmouseout="out('-1992782825152874013');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 556                 || selectNode.getKind() == TIMESTAMP_DIFF                                                </span>
<span class="-1380076266281630813" onmouseenter="enter('-1380076266281630813');" onmouseout="out('-1380076266281630813');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 557                 || selectNode.getKind() == LIKE                                                          </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 558                                                                                                          </span>
<span class="1769062068492699725" onmouseenter="enter('1769062068492699725');" onmouseout="out('1769062068492699725');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 559         ){                                                                                               </span>
<span class="7946305415555164516" onmouseenter="enter('7946305415555164516');" onmouseout="out('7946305415555164516');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 560             SqlBasicCall sqlBasicCall = (SqlBasicCall) selectNode;                                       </span>
<span class="-6221234471722277998" onmouseenter="enter('-6221234471722277998');" onmouseout="out('-6221234471722277998');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 561             for(int i=0; i&lt;sqlBasicCall.getOperands().length; i++){                                      </span>
<span class="-6831609595517394087" onmouseenter="enter('-6831609595517394087');" onmouseout="out('-6831609595517394087');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 562                 SqlNode sqlNode = sqlBasicCall.getOperands()[i];                                         </span>
<span class="92437031510630357" onmouseenter="enter('92437031510630357');" onmouseout="out('92437031510630357');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 563                 if(sqlNode instanceof SqlLiteral){                                                       </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 564                     continue;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 565                 }                                                                                        </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 566                                                                                                          </span>
<span class="-7655129146813432779" onmouseenter="enter('-7655129146813432779');" onmouseout="out('-7655129146813432779');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 567                 if(sqlNode instanceof SqlDataTypeSpec){                                                  </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 568                     continue;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 569                 }                                                                                        </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 570                                                                                                          </span>
<span class="30158307191940159" onmouseenter="enter('30158307191940159');" onmouseout="out('30158307191940159');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 571                 extractSelectField(sqlNode, extractFieldSet, fromTableNameSet, tableRef);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 572             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 573                                                                                                          </span>
<span class="2155507952934750451" onmouseenter="enter('2155507952934750451');" onmouseout="out('2155507952934750451');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 574         }else if(selectNode.getKind() == CASE){                                                          </span>
<span class="-6113591358780745482" onmouseenter="enter('-6113591358780745482');" onmouseout="out('-6113591358780745482');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 575             System.out.println(&quot;selectNode&quot;);                                                            </span>
<span class="-1390336112814264886" onmouseenter="enter('-1390336112814264886');" onmouseout="out('-1390336112814264886');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 576             SqlCase sqlCase = (SqlCase) selectNode;                                                      </span>
<span class="-3655271460728510010" onmouseenter="enter('-3655271460728510010');" onmouseout="out('-3655271460728510010');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 577             SqlNodeList whenOperands = sqlCase.getWhenOperands();                                        </span>
<span class="8318973293639639494" onmouseenter="enter('8318973293639639494');" onmouseout="out('8318973293639639494');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 578             SqlNodeList thenOperands = sqlCase.getThenOperands();                                        </span>
<span class="3014895614462197568" onmouseenter="enter('3014895614462197568');" onmouseout="out('3014895614462197568');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 579             SqlNode elseNode = sqlCase.getElseOperand();                                                 </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 580                                                                                                          </span>
<span class="6346785150356032184" onmouseenter="enter('6346785150356032184');" onmouseout="out('6346785150356032184');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 581             for(int i=0; i&lt;whenOperands.size(); i++){                                                    </span>
<span class="1734344807386881213" onmouseenter="enter('1734344807386881213');" onmouseout="out('1734344807386881213');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 582                 SqlNode oneOperand = whenOperands.get(i);                                                </span>
<span class="1407654974389323920" onmouseenter="enter('1407654974389323920');" onmouseout="out('1407654974389323920');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 583                 extractSelectField(oneOperand, extractFieldSet, fromTableNameSet, tableRef);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 584             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 585                                                                                                          </span>
<span class="-8902171898794493922" onmouseenter="enter('-8902171898794493922');" onmouseout="out('-8902171898794493922');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 586             for(int i=0; i&lt;thenOperands.size(); i++){                                                    </span>
<span class="-3989978989358262134" onmouseenter="enter('-3989978989358262134');" onmouseout="out('-3989978989358262134');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 587                 SqlNode oneOperand = thenOperands.get(i);                                                </span>
<span class="1407654974389323920" onmouseenter="enter('1407654974389323920');" onmouseout="out('1407654974389323920');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 588                 extractSelectField(oneOperand, extractFieldSet, fromTableNameSet, tableRef);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 589             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 590                                                                                                          </span>
<span class="-1225911656205055173" onmouseenter="enter('-1225911656205055173');" onmouseout="out('-1225911656205055173');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 591             extractSelectField(elseNode, extractFieldSet, fromTableNameSet, tableRef);                   </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 592         }else {                                                                                          </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 593             //do nothing                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 594         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 595     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 596                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 597                                                                                                          </span>
<span class="-1906922116491244459" onmouseenter="enter('-1906922116491244459');" onmouseout="out('-1906922116491244459');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 598     private Tuple2&lt;String, String&gt; parseRightNode(SqlNode sqlNode, Set&lt;String&gt; sideTableSet, Queue&lt;Object&gt; queueInfo,"> 598     private Tuple2&lt;String, String&gt; parseRightNode(SqlNode sqlNode, Set&lt;String&gt; sideTableSet, Queue&lt;Object🔵</abbr></span>
<span class="-5149999535499369188" onmouseenter="enter('-5149999535499369188');" onmouseout="out('-5149999535499369188');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 599                                                   SqlNode parentWhere, SqlNodeList selectList) {         </span>
<span class="-7809629950828083535" onmouseenter="enter('-7809629950828083535');" onmouseout="out('-7809629950828083535');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 600         Tuple2&lt;String, String&gt; tabName = new Tuple2&lt;&gt;(&quot;&quot;, &quot;&quot;);                                           </span>
<span class="7570038518439211250" onmouseenter="enter('7570038518439211250');" onmouseout="out('7570038518439211250');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 601         if(sqlNode.getKind() == IDENTIFIER){                                                             </span>
<span class="-7735158387636601028" onmouseenter="enter('-7735158387636601028');" onmouseout="out('-7735158387636601028');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 602             tabName.f0 = sqlNode.toString();                                                             </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 603         }else{                                                                                           </span>
<span class="5760084663094791409" onmouseenter="enter('5760084663094791409');" onmouseout="out('5760084663094791409');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 604             AliasInfo aliasInfo = (AliasInfo)sideSQLParser.parseSql(sqlNode, sideTableSet, queueInfo, parentWhere, selectList);"> 604             AliasInfo aliasInfo = (AliasInfo)sideSQLParser.parseSql(sqlNode, sideTableSet, queueInfo, par🔵</abbr></span>
<span class="-7052196639543907068" onmouseenter="enter('-7052196639543907068');" onmouseout="out('-7052196639543907068');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 605             tabName.f0 = aliasInfo.getName();                                                            </span>
<span class="-2307032070137542057" onmouseenter="enter('-2307032070137542057');" onmouseout="out('-2307032070137542057');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 606             tabName.f1 = aliasInfo.getAlias();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 607         }                                                                                                </span>
<span class="-6789109484485831180" onmouseenter="enter('-6789109484485831180');" onmouseout="out('-6789109484485831180');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 608         return tabName;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 609     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 610                                                                                                          </span>
<span class="1768499303484569694" onmouseenter="enter('1768499303484569694');" onmouseout="out('1768499303484569694');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 611     private Tuple2&lt;String, String&gt; parseLeftNode(SqlNode sqlNode){                                       </span>
<span class="-7809629950828083535" onmouseenter="enter('-7809629950828083535');" onmouseout="out('-7809629950828083535');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 612         Tuple2&lt;String, String&gt; tabName = new Tuple2&lt;&gt;(&quot;&quot;, &quot;&quot;);                                           </span>
<span class="7570038518439211250" onmouseenter="enter('7570038518439211250');" onmouseout="out('7570038518439211250');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 613         if(sqlNode.getKind() == IDENTIFIER){                                                             </span>
<span class="-7735158387636601028" onmouseenter="enter('-7735158387636601028');" onmouseout="out('-7735158387636601028');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 614             tabName.f0 = sqlNode.toString();                                                             </span>
<span class="-6648818000206782174" onmouseenter="enter('-6648818000206782174');" onmouseout="out('-6648818000206782174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 615             tabName.f1 = sqlNode.toString();                                                             </span>
<span class="7640894634328871584" onmouseenter="enter('7640894634328871584');" onmouseout="out('7640894634328871584');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 616         }else if (sqlNode.getKind() == AS){                                                              </span>
<span class="-4085054753182131209" onmouseenter="enter('-4085054753182131209');" onmouseout="out('-4085054753182131209');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 617             SqlNode info = ((SqlBasicCall)sqlNode).getOperands()[0];                                     </span>
<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 618             SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                                   </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 619                                                                                                          </span>
<span class="6350181014025417708" onmouseenter="enter('6350181014025417708');" onmouseout="out('6350181014025417708');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 620             tabName.f0 = info.toString();                                                                </span>
<span class="-6499418961284910074" onmouseenter="enter('-6499418961284910074');" onmouseout="out('-6499418961284910074');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 621             tabName.f1 = alias.toString();                                                               </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 622         }else {                                                                                          </span>
<span class="-4528765899368294479" onmouseenter="enter('-4528765899368294479');" onmouseout="out('-4528765899368294479');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 623             throw new RuntimeException(&quot;&quot;);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 624         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 625                                                                                                          </span>
<span class="-6789109484485831180" onmouseenter="enter('-6789109484485831180');" onmouseout="out('-6789109484485831180');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 626         return tabName;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 627     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 628                                                                                                          </span>
<span class="2221421009159751305" onmouseenter="enter('2221421009159751305');" onmouseout="out('2221421009159751305');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 629     public String buildCondition(List&lt;SqlBasicCall&gt; conditionList){                                      </span>
<span class="-4757924659479519527" onmouseenter="enter('-4757924659479519527');" onmouseout="out('-4757924659479519527');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 630         if(CollectionUtils.isEmpty(conditionList)){                                                      </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 631             return &quot;&quot;;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 632         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 633                                                                                                          </span>
<span class="-8689756052096276488" onmouseenter="enter('-8689756052096276488');" onmouseout="out('-8689756052096276488');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 634         return &quot; where &quot; + StringUtils.join(conditionList, &quot; AND &quot;);                                     </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 635 =======                                                                                                  </span>
<span class="3812477662204349545" onmouseenter="enter('3812477662204349545');" onmouseout="out('3812477662204349545');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 636             Log.info(&quot;-------build temporary query-----------\n{}&quot;, tmpSelectSql);                       </span>
<span class="3847699124612806472" onmouseenter="enter('3847699124612806472');" onmouseout="out('3847699124612806472');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 637             Log.info(&quot;---------------------------------------&quot;);                                         </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 638         } catch (Exception e) {                                                                          </span>
<span class="-9144524576168127827" onmouseenter="enter('-9144524576168127827');" onmouseout="out('-9144524576168127827');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 639             Log.error(&quot;&quot;, e);                                                                            </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 640 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 641             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 642         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 643     }                                                                                                    </span>
<span  style=""> 644                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 645     /**                                                                                                  </span>
<span class="-4499840608975407423" onmouseenter="enter('-4499840608975407423');" onmouseout="out('-4499840608975407423');" style=""> 646      * 抽取上层需用使用到的字段                                                                                      </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style=""> 647      * @param parentSelectList                                                                           </span>
<span class="-6365101737408851156" onmouseenter="enter('-6365101737408851156');" onmouseout="out('-6365101737408851156');" style=""> 648      * @param fromTableNameSet                                                                           </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 649      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 650      */                                                                                                  </span>
<span class="-1410253319795430175" onmouseenter="enter('-1410253319795430175');" onmouseout="out('-1410253319795430175');" style=""> 651     private Set&lt;String&gt; extractSelectFields(SqlNodeList parentSelectList,                                </span>
<span class="8604782440088857459" onmouseenter="enter('8604782440088857459');" onmouseout="out('8604782440088857459');" style=""> 652                                             Set&lt;String&gt; fromTableNameSet,                                </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style=""> 653                                             Map&lt;String, String&gt; tableRef){                               </span>
<span class="-4673362671275703253" onmouseenter="enter('-4673362671275703253');" onmouseout="out('-4673362671275703253');" style=""> 654         Set&lt;String&gt; extractFieldList = Sets.newHashSet();                                                </span>
<span class="-7414180011567654896" onmouseenter="enter('-7414180011567654896');" onmouseout="out('-7414180011567654896');" style=""> 655         for(SqlNode selectNode : parentSelectList.getList()){                                            </span>
<span class="1095915068729564148" onmouseenter="enter('1095915068729564148');" onmouseout="out('1095915068729564148');" style=""> 656             extractSelectField(selectNode, extractFieldList, fromTableNameSet, tableRef);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 657         }                                                                                                </span>
<span  style=""> 658                                                                                                          </span>
<span class="-1685101767459189568" onmouseenter="enter('-1685101767459189568');" onmouseout="out('-1685101767459189568');" style=""> 659         return extractFieldList;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 660     }                                                                                                    </span>
<span  style=""> 661                                                                                                          </span>
<span class="-3136237770377012352" onmouseenter="enter('-3136237770377012352');" onmouseout="out('-3136237770377012352');" style=""> 662     private Set&lt;String&gt; extractSelectFieldFromJoinCondition(Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,    </span>
<span class="8604782440088857459" onmouseenter="enter('8604782440088857459');" onmouseout="out('8604782440088857459');" style=""> 663                                                             Set&lt;String&gt; fromTableNameSet,                </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style=""> 664                                                             Map&lt;String, String&gt; tableRef){               </span>
<span class="-4673362671275703253" onmouseenter="enter('-4673362671275703253');" onmouseout="out('-4673362671275703253');" style=""> 665         Set&lt;String&gt; extractFieldList = Sets.newHashSet();                                                </span>
<span class="8833203050470988767" onmouseenter="enter('8833203050470988767');" onmouseout="out('8833203050470988767');" style=""> 666         for(Tuple2&lt;String, String&gt; field : joinFieldSet){                                                </span>
<span class="-9037397631967971194" onmouseenter="enter('-9037397631967971194');" onmouseout="out('-9037397631967971194');" style=""> 667             if(fromTableNameSet.contains(field.f0)){                                                     </span>
<span class="-4436761311933817361" onmouseenter="enter('-4436761311933817361');" onmouseout="out('-4436761311933817361');" style=""> 668                 extractFieldList.add(field.f0 + &quot;.&quot; + field.f1);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 669             }                                                                                            </span>
<span  style=""> 670                                                                                                          </span>
<span class="2270060537250938832" onmouseenter="enter('2270060537250938832');" onmouseout="out('2270060537250938832');" style=""> 671             if(tableRef.containsKey(field.f0)){                                                          </span>
<span class="-6432265866814515577" onmouseenter="enter('-6432265866814515577');" onmouseout="out('-6432265866814515577');" style=""> 672                 if(fromTableNameSet.contains(tableRef.get(field.f0))){                                   </span>
<span class="-616240499130861538" onmouseenter="enter('-616240499130861538');" onmouseout="out('-616240499130861538');" style=""> 673                     extractFieldList.add(tableRef.get(field.f0) + &quot;.&quot; + field.f1);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 674                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 675             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 676         }                                                                                                </span>
<span  style=""> 677                                                                                                          </span>
<span class="-1685101767459189568" onmouseenter="enter('-1685101767459189568');" onmouseout="out('-1685101767459189568');" style=""> 678         return extractFieldList;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 679     }                                                                                                    </span>
<span  style=""> 680                                                                                                          </span>
<span class="-6744450936821609200" onmouseenter="enter('-6744450936821609200');" onmouseout="out('-6744450936821609200');" style=""> 681     private Set&lt;String&gt; extractFieldFromGroupByList(SqlNodeList parentGroupByList,                       </span>
<span class="8604782440088857459" onmouseenter="enter('8604782440088857459');" onmouseout="out('8604782440088857459');" style=""> 682                                                     Set&lt;String&gt; fromTableNameSet,                        </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style=""> 683                                                     Map&lt;String, String&gt; tableRef){                       </span>
<span  style=""> 684                                                                                                          </span>
<span class="-1817314657182986777" onmouseenter="enter('-1817314657182986777');" onmouseout="out('-1817314657182986777');" style=""> 685         if(parentGroupByList == null){                                                                   </span>
<span class="7586937643893917515" onmouseenter="enter('7586937643893917515');" onmouseout="out('7586937643893917515');" style=""> 686             return Sets.newHashSet();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 687         }                                                                                                </span>
<span  style=""> 688                                                                                                          </span>
<span class="-4673362671275703253" onmouseenter="enter('-4673362671275703253');" onmouseout="out('-4673362671275703253');" style=""> 689         Set&lt;String&gt; extractFieldList = Sets.newHashSet();                                                </span>
<span class="7263955957768279526" onmouseenter="enter('7263955957768279526');" onmouseout="out('7263955957768279526');" style=""> 690         for(SqlNode selectNode : parentGroupByList.getList()){                                           </span>
<span class="1095915068729564148" onmouseenter="enter('1095915068729564148');" onmouseout="out('1095915068729564148');" style=""> 691             extractSelectField(selectNode, extractFieldList, fromTableNameSet, tableRef);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 692         }                                                                                                </span>
<span  style=""> 693                                                                                                          </span>
<span class="-1685101767459189568" onmouseenter="enter('-1685101767459189568');" onmouseout="out('-1685101767459189568');" style=""> 694         return extractFieldList;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 695     }                                                                                                    </span>
<span  style=""> 696                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 697     /**                                                                                                  </span>
<span class="-672438967754228662" onmouseenter="enter('-672438967754228662');" onmouseout="out('-672438967754228662');" style=""> 698      * 从join的条件中获取字段信息                                                                                   </span>
<span class="-4160812560585701802" onmouseenter="enter('-4160812560585701802');" onmouseout="out('-4160812560585701802');" style=""> 699      * @param condition                                                                                  </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style=""> 700      * @param joinFieldSet                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 701      */                                                                                                  </span>
<span class="1552352851009209412" onmouseenter="enter('1552352851009209412');" onmouseout="out('1552352851009209412');" style=""> 702     private void extractJoinField(SqlNode condition, Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet){          </span>
<span class="5716706160133851170" onmouseenter="enter('5716706160133851170');" onmouseout="out('5716706160133851170');" style=""> 703         if (null == condition || condition.getKind() == LITERAL) {                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 704             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 705         }                                                                                                </span>
<span  style=""> 706                                                                                                          </span>
<span class="5418896256960850645" onmouseenter="enter('5418896256960850645');" onmouseout="out('5418896256960850645');" style=""> 707         SqlKind joinKind = condition.getKind();                                                          </span>
<span class="6904180996725590590" onmouseenter="enter('6904180996725590590');" onmouseout="out('6904180996725590590');" style=""> 708         if( joinKind == AND || joinKind == EQUALS ){                                                     </span>
<span class="5740954560868172997" onmouseenter="enter('5740954560868172997');" onmouseout="out('5740954560868172997');" style=""> 709             extractJoinField(((SqlBasicCall)condition).operands[0], joinFieldSet);                       </span>
<span class="-450517509397156355" onmouseenter="enter('-450517509397156355');" onmouseout="out('-450517509397156355');" style=""> 710             extractJoinField(((SqlBasicCall)condition).operands[1], joinFieldSet);                       </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 711         }else{                                                                                           </span>
<span class="3421902236901684905" onmouseenter="enter('3421902236901684905');" onmouseout="out('3421902236901684905');" style=""><abbr title=" 712             Preconditions.checkState(((SqlIdentifier)condition).names.size() == 2, &quot;join condition must be format table.field&quot;);"> 712             Preconditions.checkState(((SqlIdentifier)condition).names.size() == 2, &quot;join condition must b🔵</abbr></span>
<span class="6389924414477169388" onmouseenter="enter('6389924414477169388');" onmouseout="out('6389924414477169388');" style=""><abbr title=" 713             Tuple2&lt;String, String&gt; tuple2 = Tuple2.of(((SqlIdentifier)condition).names.get(0), ((SqlIdentifier)condition).names.get(1));"> 713             Tuple2&lt;String, String&gt; tuple2 = Tuple2.of(((SqlIdentifier)condition).names.get(0), ((SqlIdent🔵</abbr></span>
<span class="-8031023747394340843" onmouseenter="enter('-8031023747394340843');" onmouseout="out('-8031023747394340843');" style=""> 714             joinFieldSet.add(tuple2);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 715         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 716     }                                                                                                    </span>
<span  style=""> 717                                                                                                          </span>
<span  style=""> 718                                                                                                          </span>
<span class="-6450965667049352633" onmouseenter="enter('-6450965667049352633');" onmouseout="out('-6450965667049352633');" style=""> 719     private void extractSelectField(SqlNode selectNode,                                                  </span>
<span class="4215167182352113360" onmouseenter="enter('4215167182352113360');" onmouseout="out('4215167182352113360');" style=""> 720                                     Set&lt;String&gt; extractFieldSet,                                         </span>
<span class="8604782440088857459" onmouseenter="enter('8604782440088857459');" onmouseout="out('8604782440088857459');" style=""> 721                                     Set&lt;String&gt; fromTableNameSet,                                        </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style=""> 722                                     Map&lt;String, String&gt; tableRef){                                       </span>
<span class="8103739576060170768" onmouseenter="enter('8103739576060170768');" onmouseout="out('8103739576060170768');" style=""> 723         if (selectNode.getKind() == AS) {                                                                </span>
<span class="1510889832473438632" onmouseenter="enter('1510889832473438632');" onmouseout="out('1510889832473438632');" style=""> 724             SqlNode leftNode = ((SqlBasicCall) selectNode).getOperands()[0];                             </span>
<span class="-3569930423065034136" onmouseenter="enter('-3569930423065034136');" onmouseout="out('-3569930423065034136');" style=""> 725             extractSelectField(leftNode, extractFieldSet, fromTableNameSet, tableRef);                   </span>
<span  style=""> 726                                                                                                          </span>
<span class="-8354265102451448120" onmouseenter="enter('-8354265102451448120');" onmouseout="out('-8354265102451448120');" style=""> 727         }else if(selectNode.getKind() == IDENTIFIER) {                                                   </span>
<span class="-3732912994311321816" onmouseenter="enter('-3732912994311321816');" onmouseout="out('-3732912994311321816');" style=""> 728             SqlIdentifier sqlIdentifier = (SqlIdentifier) selectNode;                                    </span>
<span  style=""> 729                                                                                                          </span>
<span class="2651178788475624428" onmouseenter="enter('2651178788475624428');" onmouseout="out('2651178788475624428');" style=""> 730             if(sqlIdentifier.names.size() == 1){                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 731                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 732             }                                                                                            </span>
<span  style=""> 733                                                                                                          </span>
<span class="3965609827388612088" onmouseenter="enter('3965609827388612088');" onmouseout="out('3965609827388612088');" style=""> 734             String tableName = sqlIdentifier.names.get(0);                                               </span>
<span class="5468885380070811563" onmouseenter="enter('5468885380070811563');" onmouseout="out('5468885380070811563');" style=""> 735             //TODO                                                                                       </span>
<span class="3096268752058072981" onmouseenter="enter('3096268752058072981');" onmouseout="out('3096268752058072981');" style=""> 736             if(fromTableNameSet.contains(tableName)){                                                    </span>
<span class="-4452600673359758385" onmouseenter="enter('-4452600673359758385');" onmouseout="out('-4452600673359758385');" style=""> 737                 extractFieldSet.add(sqlIdentifier.toString());                                           </span>
<span class="1142707085951947184" onmouseenter="enter('1142707085951947184');" onmouseout="out('1142707085951947184');" style=""> 738             } else if(fromTableNameSet.contains(tableRef.get(tableName))){                               </span>
<span class="5574286290036421401" onmouseenter="enter('5574286290036421401');" onmouseout="out('5574286290036421401');" style=""> 739                 //TODO extractFieldSet.add(sqlIdentifier.setName(0, tableRef.get(tableName)).toString());</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 740             }                                                                                            </span>
<span  style=""> 741                                                                                                          </span>
<span class="7025405726449532045" onmouseenter="enter('7025405726449532045');" onmouseout="out('7025405726449532045');" style=""> 742         }else if(  AGGREGATE.contains(selectNode.getKind())                                              </span>
<span class="-6933542481251357306" onmouseenter="enter('-6933542481251357306');" onmouseout="out('-6933542481251357306');" style=""> 743                 || AVG_AGG_FUNCTIONS.contains(selectNode.getKind())                                      </span>
<span class="-2120439329066417772" onmouseenter="enter('-2120439329066417772');" onmouseout="out('-2120439329066417772');" style=""> 744                 || COMPARISON.contains(selectNode.getKind())                                             </span>
<span class="6729191807379931332" onmouseenter="enter('6729191807379931332');" onmouseout="out('6729191807379931332');" style=""> 745                 || selectNode.getKind() == OTHER_FUNCTION                                                </span>
<span class="-790540336783787818" onmouseenter="enter('-790540336783787818');" onmouseout="out('-790540336783787818');" style=""> 746                 || selectNode.getKind() == DIVIDE                                                        </span>
<span class="8042439450870069301" onmouseenter="enter('8042439450870069301');" onmouseout="out('8042439450870069301');" style=""> 747                 || selectNode.getKind() == CAST                                                          </span>
<span class="8131430949670321542" onmouseenter="enter('8131430949670321542');" onmouseout="out('8131430949670321542');" style=""> 748                 || selectNode.getKind() == TRIM                                                          </span>
<span class="7539044465271514325" onmouseenter="enter('7539044465271514325');" onmouseout="out('7539044465271514325');" style=""> 749                 || selectNode.getKind() == TIMES                                                         </span>
<span class="5017875227939513377" onmouseenter="enter('5017875227939513377');" onmouseout="out('5017875227939513377');" style=""> 750                 || selectNode.getKind() == PLUS                                                          </span>
<span class="-8896687143784188803" onmouseenter="enter('-8896687143784188803');" onmouseout="out('-8896687143784188803');" style=""> 751                 || selectNode.getKind() == NOT_IN                                                        </span>
<span class="-1863732027976694038" onmouseenter="enter('-1863732027976694038');" onmouseout="out('-1863732027976694038');" style=""> 752                 || selectNode.getKind() == OR                                                            </span>
<span class="6505261652610820896" onmouseenter="enter('6505261652610820896');" onmouseout="out('6505261652610820896');" style=""> 753                 || selectNode.getKind() == AND                                                           </span>
<span class="8098904506676885196" onmouseenter="enter('8098904506676885196');" onmouseout="out('8098904506676885196');" style=""> 754                 || selectNode.getKind() == MINUS                                                         </span>
<span class="-157153081163608557" onmouseenter="enter('-157153081163608557');" onmouseout="out('-157153081163608557');" style=""> 755                 || selectNode.getKind() == TUMBLE                                                        </span>
<span class="-2839638964097736537" onmouseenter="enter('-2839638964097736537');" onmouseout="out('-2839638964097736537');" style=""> 756                 || selectNode.getKind() == TUMBLE_START                                                  </span>
<span class="6482577849437391011" onmouseenter="enter('6482577849437391011');" onmouseout="out('6482577849437391011');" style=""> 757                 || selectNode.getKind() == TUMBLE_END                                                    </span>
<span class="6880276476651207951" onmouseenter="enter('6880276476651207951');" onmouseout="out('6880276476651207951');" style=""> 758                 || selectNode.getKind() == SESSION                                                       </span>
<span class="-5893490809135961202" onmouseenter="enter('-5893490809135961202');" onmouseout="out('-5893490809135961202');" style=""> 759                 || selectNode.getKind() == SESSION_START                                                 </span>
<span class="-1646114820326763405" onmouseenter="enter('-1646114820326763405');" onmouseout="out('-1646114820326763405');" style=""> 760                 || selectNode.getKind() == SESSION_END                                                   </span>
<span class="268793040563115559" onmouseenter="enter('268793040563115559');" onmouseout="out('268793040563115559');" style=""> 761                 || selectNode.getKind() == HOP                                                           </span>
<span class="5104117061177388693" onmouseenter="enter('5104117061177388693');" onmouseout="out('5104117061177388693');" style=""> 762                 || selectNode.getKind() == HOP_START                                                     </span>
<span class="8235260830665848207" onmouseenter="enter('8235260830665848207');" onmouseout="out('8235260830665848207');" style=""> 763                 || selectNode.getKind() == HOP_END                                                       </span>
<span class="-3943236427179035086" onmouseenter="enter('-3943236427179035086');" onmouseout="out('-3943236427179035086');" style=""> 764                 || selectNode.getKind() == BETWEEN                                                       </span>
<span class="-4981553052649867721" onmouseenter="enter('-4981553052649867721');" onmouseout="out('-4981553052649867721');" style=""> 765                 || selectNode.getKind() == IS_NULL                                                       </span>
<span class="2062318608323297657" onmouseenter="enter('2062318608323297657');" onmouseout="out('2062318608323297657');" style=""> 766                 || selectNode.getKind() == IS_NOT_NULL                                                   </span>
<span class="-5717204280699012051" onmouseenter="enter('-5717204280699012051');" onmouseout="out('-5717204280699012051');" style=""> 767                 || selectNode.getKind() == CONTAINS                                                      </span>
<span class="-4225388998654687854" onmouseenter="enter('-4225388998654687854');" onmouseout="out('-4225388998654687854');" style=""> 768                 || selectNode.getKind() == TIMESTAMP_ADD                                                 </span>
<span class="-1992782825152874013" onmouseenter="enter('-1992782825152874013');" onmouseout="out('-1992782825152874013');" style=""> 769                 || selectNode.getKind() == TIMESTAMP_DIFF                                                </span>
<span class="-1380076266281630813" onmouseenter="enter('-1380076266281630813');" onmouseout="out('-1380076266281630813');" style=""> 770                 || selectNode.getKind() == LIKE                                                          </span>
<span  style=""> 771                                                                                                          </span>
<span class="1769062068492699725" onmouseenter="enter('1769062068492699725');" onmouseout="out('1769062068492699725');" style=""> 772         ){                                                                                               </span>
<span class="7946305415555164516" onmouseenter="enter('7946305415555164516');" onmouseout="out('7946305415555164516');" style=""> 773             SqlBasicCall sqlBasicCall = (SqlBasicCall) selectNode;                                       </span>
<span class="-6221234471722277998" onmouseenter="enter('-6221234471722277998');" onmouseout="out('-6221234471722277998');" style=""> 774             for(int i=0; i&lt;sqlBasicCall.getOperands().length; i++){                                      </span>
<span class="-6831609595517394087" onmouseenter="enter('-6831609595517394087');" onmouseout="out('-6831609595517394087');" style=""> 775                 SqlNode sqlNode = sqlBasicCall.getOperands()[i];                                         </span>
<span class="92437031510630357" onmouseenter="enter('92437031510630357');" onmouseout="out('92437031510630357');" style=""> 776                 if(sqlNode instanceof SqlLiteral){                                                       </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 777                     continue;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 778                 }                                                                                        </span>
<span  style=""> 779                                                                                                          </span>
<span class="-7655129146813432779" onmouseenter="enter('-7655129146813432779');" onmouseout="out('-7655129146813432779');" style=""> 780                 if(sqlNode instanceof SqlDataTypeSpec){                                                  </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 781                     continue;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 782                 }                                                                                        </span>
<span  style=""> 783                                                                                                          </span>
<span class="30158307191940159" onmouseenter="enter('30158307191940159');" onmouseout="out('30158307191940159');" style=""> 784                 extractSelectField(sqlNode, extractFieldSet, fromTableNameSet, tableRef);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 785             }                                                                                            </span>
<span  style=""> 786                                                                                                          </span>
<span class="2155507952934750451" onmouseenter="enter('2155507952934750451');" onmouseout="out('2155507952934750451');" style=""> 787         }else if(selectNode.getKind() == CASE){                                                          </span>
<span class="-1390336112814264886" onmouseenter="enter('-1390336112814264886');" onmouseout="out('-1390336112814264886');" style=""> 788             SqlCase sqlCase = (SqlCase) selectNode;                                                      </span>
<span class="-3655271460728510010" onmouseenter="enter('-3655271460728510010');" onmouseout="out('-3655271460728510010');" style=""> 789             SqlNodeList whenOperands = sqlCase.getWhenOperands();                                        </span>
<span class="8318973293639639494" onmouseenter="enter('8318973293639639494');" onmouseout="out('8318973293639639494');" style=""> 790             SqlNodeList thenOperands = sqlCase.getThenOperands();                                        </span>
<span class="3014895614462197568" onmouseenter="enter('3014895614462197568');" onmouseout="out('3014895614462197568');" style=""> 791             SqlNode elseNode = sqlCase.getElseOperand();                                                 </span>
<span  style=""> 792                                                                                                          </span>
<span class="6346785150356032184" onmouseenter="enter('6346785150356032184');" onmouseout="out('6346785150356032184');" style=""> 793             for(int i=0; i&lt;whenOperands.size(); i++){                                                    </span>
<span class="1734344807386881213" onmouseenter="enter('1734344807386881213');" onmouseout="out('1734344807386881213');" style=""> 794                 SqlNode oneOperand = whenOperands.get(i);                                                </span>
<span class="1407654974389323920" onmouseenter="enter('1407654974389323920');" onmouseout="out('1407654974389323920');" style=""> 795                 extractSelectField(oneOperand, extractFieldSet, fromTableNameSet, tableRef);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 796             }                                                                                            </span>
<span  style=""> 797                                                                                                          </span>
<span class="-8902171898794493922" onmouseenter="enter('-8902171898794493922');" onmouseout="out('-8902171898794493922');" style=""> 798             for(int i=0; i&lt;thenOperands.size(); i++){                                                    </span>
<span class="-3989978989358262134" onmouseenter="enter('-3989978989358262134');" onmouseout="out('-3989978989358262134');" style=""> 799                 SqlNode oneOperand = thenOperands.get(i);                                                </span>
<span class="1407654974389323920" onmouseenter="enter('1407654974389323920');" onmouseout="out('1407654974389323920');" style=""> 800                 extractSelectField(oneOperand, extractFieldSet, fromTableNameSet, tableRef);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 801             }                                                                                            </span>
<span  style=""> 802                                                                                                          </span>
<span class="-1225911656205055173" onmouseenter="enter('-1225911656205055173');" onmouseout="out('-1225911656205055173');" style=""> 803             extractSelectField(elseNode, extractFieldSet, fromTableNameSet, tableRef);                   </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 804         }else {                                                                                          </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 805             //do nothing                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 806         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 807     }                                                                                                    </span>
<span  style=""> 808                                                                                                          </span>
<span  style=""> 809                                                                                                          </span>
<span class="-1906922116491244459" onmouseenter="enter('-1906922116491244459');" onmouseout="out('-1906922116491244459');" style=""><abbr title=" 810     private Tuple2&lt;String, String&gt; parseRightNode(SqlNode sqlNode, Set&lt;String&gt; sideTableSet, Queue&lt;Object&gt; queueInfo,"> 810     private Tuple2&lt;String, String&gt; parseRightNode(SqlNode sqlNode, Set&lt;String&gt; sideTableSet, Queue&lt;Object🔵</abbr></span>
<span class="-1049021514946482534" onmouseenter="enter('-1049021514946482534');" onmouseout="out('-1049021514946482534');" style=""><abbr title=" 811                                                   SqlNode parentWhere, SqlNodeList selectList, SqlNodeList parentGroupByList) {"> 811                                                   SqlNode parentWhere, SqlNodeList selectList, SqlNodeLis🔵</abbr></span>
<span class="-7809629950828083535" onmouseenter="enter('-7809629950828083535');" onmouseout="out('-7809629950828083535');" style=""> 812         Tuple2&lt;String, String&gt; tabName = new Tuple2&lt;&gt;(&quot;&quot;, &quot;&quot;);                                           </span>
<span class="7570038518439211250" onmouseenter="enter('7570038518439211250');" onmouseout="out('7570038518439211250');" style=""> 813         if(sqlNode.getKind() == IDENTIFIER){                                                             </span>
<span class="-7735158387636601028" onmouseenter="enter('-7735158387636601028');" onmouseout="out('-7735158387636601028');" style=""> 814             tabName.f0 = sqlNode.toString();                                                             </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 815         }else{                                                                                           </span>
<span class="7364690097624267595" onmouseenter="enter('7364690097624267595');" onmouseout="out('7364690097624267595');" style=""><abbr title=" 816             AliasInfo aliasInfo = (AliasInfo)sideSQLParser.parseSql(sqlNode, sideTableSet, queueInfo, parentWhere, selectList, parentGroupByList);"> 816             AliasInfo aliasInfo = (AliasInfo)sideSQLParser.parseSql(sqlNode, sideTableSet, queueInfo, par🔵</abbr></span>
<span class="-7052196639543907068" onmouseenter="enter('-7052196639543907068');" onmouseout="out('-7052196639543907068');" style=""> 817             tabName.f0 = aliasInfo.getName();                                                            </span>
<span class="-2307032070137542057" onmouseenter="enter('-2307032070137542057');" onmouseout="out('-2307032070137542057');" style=""> 818             tabName.f1 = aliasInfo.getAlias();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 819         }                                                                                                </span>
<span class="-6789109484485831180" onmouseenter="enter('-6789109484485831180');" onmouseout="out('-6789109484485831180');" style=""> 820         return tabName;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 821     }                                                                                                    </span>
<span  style=""> 822                                                                                                          </span>
<span class="1768499303484569694" onmouseenter="enter('1768499303484569694');" onmouseout="out('1768499303484569694');" style=""> 823     private Tuple2&lt;String, String&gt; parseLeftNode(SqlNode sqlNode){                                       </span>
<span class="-7809629950828083535" onmouseenter="enter('-7809629950828083535');" onmouseout="out('-7809629950828083535');" style=""> 824         Tuple2&lt;String, String&gt; tabName = new Tuple2&lt;&gt;(&quot;&quot;, &quot;&quot;);                                           </span>
<span class="7570038518439211250" onmouseenter="enter('7570038518439211250');" onmouseout="out('7570038518439211250');" style=""> 825         if(sqlNode.getKind() == IDENTIFIER){                                                             </span>
<span class="-7735158387636601028" onmouseenter="enter('-7735158387636601028');" onmouseout="out('-7735158387636601028');" style=""> 826             tabName.f0 = sqlNode.toString();                                                             </span>
<span class="-6648818000206782174" onmouseenter="enter('-6648818000206782174');" onmouseout="out('-6648818000206782174');" style=""> 827             tabName.f1 = sqlNode.toString();                                                             </span>
<span class="7640894634328871584" onmouseenter="enter('7640894634328871584');" onmouseout="out('7640894634328871584');" style=""> 828         }else if (sqlNode.getKind() == AS){                                                              </span>
<span class="-4085054753182131209" onmouseenter="enter('-4085054753182131209');" onmouseout="out('-4085054753182131209');" style=""> 829             SqlNode info = ((SqlBasicCall)sqlNode).getOperands()[0];                                     </span>
<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style=""> 830             SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                                   </span>
<span  style=""> 831                                                                                                          </span>
<span class="6350181014025417708" onmouseenter="enter('6350181014025417708');" onmouseout="out('6350181014025417708');" style=""> 832             tabName.f0 = info.toString();                                                                </span>
<span class="-6499418961284910074" onmouseenter="enter('-6499418961284910074');" onmouseout="out('-6499418961284910074');" style=""> 833             tabName.f1 = alias.toString();                                                               </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 834         }else {                                                                                          </span>
<span class="-4528765899368294479" onmouseenter="enter('-4528765899368294479');" onmouseout="out('-4528765899368294479');" style=""> 835             throw new RuntimeException(&quot;&quot;);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 836         }                                                                                                </span>
<span  style=""> 837                                                                                                          </span>
<span class="-6789109484485831180" onmouseenter="enter('-6789109484485831180');" onmouseout="out('-6789109484485831180');" style=""> 838         return tabName;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 839     }                                                                                                    </span>
<span  style=""> 840                                                                                                          </span>
<span class="2221421009159751305" onmouseenter="enter('2221421009159751305');" onmouseout="out('2221421009159751305');" style=""> 841     public String buildCondition(List&lt;SqlBasicCall&gt; conditionList){                                      </span>
<span class="-4757924659479519527" onmouseenter="enter('-4757924659479519527');" onmouseout="out('-4757924659479519527');" style=""> 842         if(CollectionUtils.isEmpty(conditionList)){                                                      </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 843             return &quot;&quot;;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 844         }                                                                                                </span>
<span  style=""> 845                                                                                                          </span>
<span class="-8689756052096276488" onmouseenter="enter('-8689756052096276488');" onmouseout="out('-8689756052096276488');" style=""> 846         return &quot; where &quot; + StringUtils.join(conditionList, &quot; AND &quot;);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 847     }                                                                                                    </span>
<span  style=""> 848                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 849     /**                                                                                                  </span>
<span class="5006751944576812925" onmouseenter="enter('5006751944576812925');" onmouseout="out('5006751944576812925');" style=""> 850      * 构建抽取表的查询字段信息                                                                                      </span>
<span class="6846485922393067420" onmouseenter="enter('6846485922393067420');" onmouseout="out('6846485922393067420');" style=""> 851      * 包括去除重复字段，名称相同的取别名                                                                                 </span>
<span class="5143638493602795740" onmouseenter="enter('5143638493602795740');" onmouseout="out('5143638493602795740');" style=""> 852      * @param extractSelectField                                                                         </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style=""> 853      * @param joinFieldSet                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 854      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 855      */                                                                                                  </span>
<span class="3285722409292673394" onmouseenter="enter('3285722409292673394');" onmouseout="out('3285722409292673394');" style=""> 856     public Set&lt;String&gt; buildSelectNode(Set&lt;String&gt; extractSelectField, Set&lt;String&gt; joinFieldSet){        </span>
<span class="2785520985351844766" onmouseenter="enter('2785520985351844766');" onmouseout="out('2785520985351844766');" style=""> 857         if(CollectionUtils.isEmpty(extractSelectField)){                                                 </span>
<span class="5868864582051651172" onmouseenter="enter('5868864582051651172');" onmouseout="out('5868864582051651172');" style=""> 858             throw new RuntimeException(&quot;no field is used&quot;);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 859         }                                                                                                </span>
<span  style=""> 860                                                                                                          </span>
<span class="5899553187345814636" onmouseenter="enter('5899553187345814636');" onmouseout="out('5899553187345814636');" style=""> 861         Sets.SetView&lt;String&gt; view = Sets.union(extractSelectField, joinFieldSet);                        </span>
<span class="797241606485232847" onmouseenter="enter('797241606485232847');" onmouseout="out('797241606485232847');" style=""> 862         Set&lt;String&gt; newFieldSet = Sets.newHashSet();                                                     </span>
<span class="2745035293344511362" onmouseenter="enter('2745035293344511362');" onmouseout="out('2745035293344511362');" style=""> 863         //为相同的列取别名                                                                                       </span>
<span class="8688032100713956589" onmouseenter="enter('8688032100713956589');" onmouseout="out('8688032100713956589');" style=""> 864         HashBiMap&lt;String, String&gt; refFieldMap = HashBiMap.create();                                      </span>
<span class="1329112150316943640" onmouseenter="enter('1329112150316943640');" onmouseout="out('1329112150316943640');" style=""> 865         for(String field : view){                                                                        </span>
<span class="-1968894175389259310" onmouseenter="enter('-1968894175389259310');" onmouseout="out('-1968894175389259310');" style=""> 866             String[] fieldInfo = StringUtils.split(field, &#x27;.&#x27;);                                          </span>
<span class="-8742203946899533370" onmouseenter="enter('-8742203946899533370');" onmouseout="out('-8742203946899533370');" style=""> 867             String aliasName = fieldInfo[1];                                                             </span>
<span class="5196316369925853718" onmouseenter="enter('5196316369925853718');" onmouseout="out('5196316369925853718');" style=""> 868             StringBuilder stringBuilder = new StringBuilder();                                           </span>
<span class="7892052963016733083" onmouseenter="enter('7892052963016733083');" onmouseout="out('7892052963016733083');" style=""> 869             stringBuilder.append(field);                                                                 </span>
<span class="4929718891791635894" onmouseenter="enter('4929718891791635894');" onmouseout="out('4929718891791635894');" style=""> 870             if(refFieldMap.inverse().get(aliasName) != null){                                            </span>
<span class="3911751569834415230" onmouseenter="enter('3911751569834415230');" onmouseout="out('3911751569834415230');" style=""> 871                 aliasName = ParseUtils.dealDuplicateFieldName(refFieldMap, aliasName);                   </span>
<span class="-7772471183494378441" onmouseenter="enter('-7772471183494378441');" onmouseout="out('-7772471183494378441');" style=""> 872                 stringBuilder.append(&quot; as &quot;)                                                             </span>
<span class="-6698804491367054275" onmouseenter="enter('-6698804491367054275');" onmouseout="out('-6698804491367054275');" style=""> 873                         .append(aliasName);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 874             }                                                                                            </span>
<span  style=""> 875                                                                                                          </span>
<span class="3161846128983396458" onmouseenter="enter('3161846128983396458');" onmouseout="out('3161846128983396458');" style=""> 876             refFieldMap.put(field, aliasName);                                                           </span>
<span  style=""> 877                                                                                                          </span>
<span class="1307446912208510489" onmouseenter="enter('1307446912208510489');" onmouseout="out('1307446912208510489');" style=""> 878             newFieldSet.add(stringBuilder.toString());                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 879         }                                                                                                </span>
<span  style=""> 880                                                                                                          </span>
<span class="-4429217721906814107" onmouseenter="enter('-4429217721906814107');" onmouseout="out('-4429217721906814107');" style=""> 881         return newFieldSet;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 882     }                                                                                                    </span>
<span  style=""> 883                                                                                                          </span>
<span class="4243587240101238542" onmouseenter="enter('4243587240101238542');" onmouseout="out('4243587240101238542');" style=""> 884     private boolean checkIsSideTable(String tableName, Set&lt;String&gt; sideTableList){                       </span>
<span class="7734723301291741274" onmouseenter="enter('7734723301291741274');" onmouseout="out('7734723301291741274');" style=""> 885         if(sideTableList.contains(tableName)){                                                           </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 886             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 887         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 888         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 889     }                                                                                                    </span>
<span  style=""> 890                                                                                                          </span>
<span class="-8109971872323514495" onmouseenter="enter('-8109971872323514495');" onmouseout="out('-8109971872323514495');" style=""> 891     private SqlBasicCall buildAsSqlNode(String internalTableName, SqlNode newSource) {                   </span>
<span class="2981236818393294037" onmouseenter="enter('2981236818393294037');" onmouseout="out('2981236818393294037');" style=""> 892         SqlOperator operator = new SqlAsOperator();                                                      </span>
<span class="-1667801166019875282" onmouseenter="enter('-1667801166019875282');" onmouseout="out('-1667801166019875282');" style=""> 893         SqlParserPos sqlParserPos = new SqlParserPos(0, 0);                                              </span>
<span class="8198536898736028280" onmouseenter="enter('8198536898736028280');" onmouseout="out('8198536898736028280');" style=""> 894         SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(internalTableName, null, sqlParserPos);     </span>
<span class="-7310412248425019303" onmouseenter="enter('-7310412248425019303');" onmouseout="out('-7310412248425019303');" style=""> 895         SqlNode[] sqlNodes = new SqlNode[2];                                                             </span>
<span class="2025970151619105195" onmouseenter="enter('2025970151619105195');" onmouseout="out('2025970151619105195');" style=""> 896         sqlNodes[0] = newSource;                                                                         </span>
<span class="-4093556188235461327" onmouseenter="enter('-4093556188235461327');" onmouseout="out('-4093556188235461327');" style=""> 897         sqlNodes[1] = sqlIdentifierAlias;                                                                </span>
<span class="-1928364106966605511" onmouseenter="enter('-1928364106966605511');" onmouseout="out('-1928364106966605511');" style=""> 898         return new SqlBasicCall(operator, sqlNodes, sqlParserPos);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 899     }                                                                                                    </span>
<span  style=""> 900                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 901     /**                                                                                                  </span>
<span class="-7510152128791177313" onmouseenter="enter('-7510152128791177313');" onmouseout="out('-7510152128791177313');" style=""> 902      * 获取where中和指定表有关联的字段                                                                                </span>
<span class="-6365101737408851156" onmouseenter="enter('-6365101737408851156');" onmouseout="out('-6365101737408851156');" style=""> 903      * @param fromTableNameSet                                                                           </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 904      * @param parentWhere                                                                                </span>
<span class="-2506765310601959421" onmouseenter="enter('-2506765310601959421');" onmouseout="out('-2506765310601959421');" style=""> 905      * @param extractCondition                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 906      */                                                                                                  </span>
<span class="1461432174075439627" onmouseenter="enter('1461432174075439627');" onmouseout="out('1461432174075439627');" style=""><abbr title=" 907     private void extractWhereCondition(Set&lt;String&gt; fromTableNameSet, SqlBasicCall parentWhere, Set&lt;String&gt; extractCondition){"> 907     private void extractWhereCondition(Set&lt;String&gt; fromTableNameSet, SqlBasicCall parentWhere, Set&lt;String🔵</abbr></span>
<span  style=""> 908                                                                                                          </span>
<span class="-7344361739038630250" onmouseenter="enter('-7344361739038630250');" onmouseout="out('-7344361739038630250');" style=""> 909         if(parentWhere == null){                                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 910             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 911         }                                                                                                </span>
<span  style=""> 912                                                                                                          </span>
<span class="7198030462908925381" onmouseenter="enter('7198030462908925381');" onmouseout="out('7198030462908925381');" style=""> 913         SqlKind kind = parentWhere.getKind();                                                            </span>
<span class="-1872623569752802183" onmouseenter="enter('-1872623569752802183');" onmouseout="out('-1872623569752802183');" style=""> 914         if(kind == AND){                                                                                 </span>
<span class="-4193978700874903441" onmouseenter="enter('-4193978700874903441');" onmouseout="out('-4193978700874903441');" style=""><abbr title=" 915             extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[0], extractCondition);"> 915             extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[0], extractC🔵</abbr></span>
<span class="8237513597398016508" onmouseenter="enter('8237513597398016508');" onmouseout="out('8237513597398016508');" style=""><abbr title=" 916             extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[1], extractCondition);"> 916             extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[1], extractC🔵</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 917         } else {                                                                                         </span>
<span  style=""> 918                                                                                                          </span>
<span class="6559819810856557747" onmouseenter="enter('6559819810856557747');" onmouseout="out('6559819810856557747');" style=""> 919             Set&lt;String&gt; fieldInfos = Sets.newHashSet();                                                  </span>
<span class="-8171369927933096656" onmouseenter="enter('-8171369927933096656');" onmouseout="out('-8171369927933096656');" style=""> 920             TableUtils.getConditionRefTable(parentWhere, fieldInfos);                                    </span>
<span class="-4461527983639478234" onmouseenter="enter('-4461527983639478234');" onmouseout="out('-4461527983639478234');" style=""> 921             fieldInfos.forEach(fieldInfo -&gt; {                                                            </span>
<span class="4976250547552714974" onmouseenter="enter('4976250547552714974');" onmouseout="out('4976250547552714974');" style=""> 922                 String[] splitInfo = StringUtils.split(fieldInfo, &quot;.&quot;);                                  </span>
<span class="-9163656437830109655" onmouseenter="enter('-9163656437830109655');" onmouseout="out('-9163656437830109655');" style=""> 923                 if(splitInfo.length == 2 &amp;&amp; fromTableNameSet.contains(splitInfo[0])){                    </span>
<span class="7162103078043141858" onmouseenter="enter('7162103078043141858');" onmouseout="out('7162103078043141858');" style=""> 924                     extractCondition.add(fieldInfo);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 925                 }                                                                                        </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 926             });                                                                                          </span>
<span  style=""> 927                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 928         }                                                                                                </span>
<span  style=""> 929                                                                                                          </span>
<span  style=""> 930                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 931     }                                                                                                    </span>
<span  style=""> 932                                                                                                          </span>
<span  style=""> 933                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 934     /**                                                                                                  </span>
<span class="-74598125528384596" onmouseenter="enter('-74598125528384596');" onmouseout="out('-74598125528384596');" style=""> 935      * 检查关联的where 条件中的判断是否可以下移到新构建的子查询                                                                   </span>
<span class="-6365101737408851156" onmouseenter="enter('-6365101737408851156');" onmouseout="out('-6365101737408851156');" style=""> 936      * @param fromTableNameSet                                                                           </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 937      * @param parentWhere                                                                                </span>
<span class="-2506765310601959421" onmouseenter="enter('-2506765310601959421');" onmouseout="out('-2506765310601959421');" style=""> 938      * @param extractCondition                                                                           </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 939      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 940      */                                                                                                  </span>
<span class="-3374362155096196822" onmouseenter="enter('-3374362155096196822');" onmouseout="out('-3374362155096196822');" style=""> 941     private boolean checkAndRemoveWhereCondition(Set&lt;String&gt; fromTableNameSet,                           </span>
<span class="1711245815305911921" onmouseenter="enter('1711245815305911921');" onmouseout="out('1711245815305911921');" style=""> 942                                                  SqlBasicCall parentWhere,                               </span>
<span class="-6744704019370069554" onmouseenter="enter('-6744704019370069554');" onmouseout="out('-6744704019370069554');" style=""> 943                                                  List&lt;SqlBasicCall&gt; extractCondition){                   </span>
<span class="-7344361739038630250" onmouseenter="enter('-7344361739038630250');" onmouseout="out('-7344361739038630250');" style=""> 944         if(parentWhere == null){                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 945             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 946         }                                                                                                </span>
<span  style=""> 947                                                                                                          </span>
<span class="7198030462908925381" onmouseenter="enter('7198030462908925381');" onmouseout="out('7198030462908925381');" style=""> 948         SqlKind kind = parentWhere.getKind();                                                            </span>
<span class="-1872623569752802183" onmouseenter="enter('-1872623569752802183');" onmouseout="out('-1872623569752802183');" style=""> 949         if(kind == AND){                                                                                 </span>
<span class="-8510136866484254033" onmouseenter="enter('-8510136866484254033');" onmouseout="out('-8510136866484254033');" style=""><abbr title=" 950             boolean removeLeft = checkAndRemoveWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[0], extractCondition);"> 950             boolean removeLeft = checkAndRemoveWhereCondition(fromTableNameSet, (SqlBasicCall) parentWher🔵</abbr></span>
<span class="-2929912762198310557" onmouseenter="enter('-2929912762198310557');" onmouseout="out('-2929912762198310557');" style=""><abbr title=" 951             boolean removeRight = checkAndRemoveWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[1], extractCondition);"> 951             boolean removeRight = checkAndRemoveWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhe🔵</abbr></span>
<span class="891835357289668161" onmouseenter="enter('891835357289668161');" onmouseout="out('891835357289668161');" style=""> 952             //DO remove                                                                                  </span>
<span class="1439443091018833301" onmouseenter="enter('1439443091018833301');" onmouseout="out('1439443091018833301');" style=""> 953             if(removeLeft){                                                                              </span>
<span class="5619021625980792664" onmouseenter="enter('5619021625980792664');" onmouseout="out('5619021625980792664');" style=""> 954                 extractCondition.add(removeWhereConditionNode(parentWhere, 0));                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 955             }                                                                                            </span>
<span  style=""> 956                                                                                                          </span>
<span class="6778546312639684033" onmouseenter="enter('6778546312639684033');" onmouseout="out('6778546312639684033');" style=""> 957             if(removeRight){                                                                             </span>
<span class="-3233327769126268813" onmouseenter="enter('-3233327769126268813');" onmouseout="out('-3233327769126268813');" style=""> 958                 extractCondition.add(removeWhereConditionNode(parentWhere, 1));                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 959             }                                                                                            </span>
<span  style=""> 960                                                                                                          </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 961             return false;                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 962         } else {                                                                                         </span>
<span class="-5890893362753249434" onmouseenter="enter('-5890893362753249434');" onmouseout="out('-5890893362753249434');" style=""> 963             //条件表达式，如果该条件关联的表都是指定的表则移除                                                                   </span>
<span class="6559819810856557747" onmouseenter="enter('6559819810856557747');" onmouseout="out('6559819810856557747');" style=""> 964             Set&lt;String&gt; fieldInfos = Sets.newHashSet();                                                  </span>
<span class="-8171369927933096656" onmouseenter="enter('-8171369927933096656');" onmouseout="out('-8171369927933096656');" style=""> 965             TableUtils.getConditionRefTable(parentWhere, fieldInfos);                                    </span>
<span class="2827886728692945898" onmouseenter="enter('2827886728692945898');" onmouseout="out('2827886728692945898');" style=""> 966             Set&lt;String&gt; conditionRefTableNameSet = Sets.newHashSet();                                    </span>
<span  style=""> 967                                                                                                          </span>
<span class="-4461527983639478234" onmouseenter="enter('-4461527983639478234');" onmouseout="out('-4461527983639478234');" style=""> 968             fieldInfos.forEach(fieldInfo -&gt; {                                                            </span>
<span class="4976250547552714974" onmouseenter="enter('4976250547552714974');" onmouseout="out('4976250547552714974');" style=""> 969                 String[] splitInfo = StringUtils.split(fieldInfo, &quot;.&quot;);                                  </span>
<span class="-504061461178926812" onmouseenter="enter('-504061461178926812');" onmouseout="out('-504061461178926812');" style=""> 970                 if(splitInfo.length == 2){                                                               </span>
<span class="-1599449602125672029" onmouseenter="enter('-1599449602125672029');" onmouseout="out('-1599449602125672029');" style=""> 971                     conditionRefTableNameSet.add(splitInfo[0]);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 972                 }                                                                                        </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 973             });                                                                                          </span>
<span  style=""> 974                                                                                                          </span>
<span  style=""> 975                                                                                                          </span>
<span class="1299203886922461523" onmouseenter="enter('1299203886922461523');" onmouseout="out('1299203886922461523');" style=""> 976             if(fromTableNameSet.containsAll(conditionRefTableNameSet)){                                  </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 977                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 978             }                                                                                            </span>
<span  style=""> 979                                                                                                          </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 980             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 981         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 982     }                                                                                                    </span>
<span  style=""> 983                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 984     /**                                                                                                  </span>
<span class="967733528902221289" onmouseenter="enter('967733528902221289');" onmouseout="out('967733528902221289');" style=""> 985      * 抽取where 条件中指定的条件                                                                                  </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 986      * @param parentWhere                                                                                </span>
<span class="-460759719067432320" onmouseenter="enter('-460759719067432320');" onmouseout="out('-460759719067432320');" style=""> 987      * @param index                                                                                      </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 988      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 989      */                                                                                                  </span>
<span class="-8004122385362241836" onmouseenter="enter('-8004122385362241836');" onmouseout="out('-8004122385362241836');" style=""> 990     public SqlBasicCall removeWhereConditionNode(SqlBasicCall parentWhere, int index){                   </span>
<span class="2911889278610374450" onmouseenter="enter('2911889278610374450');" onmouseout="out('2911889278610374450');" style=""> 991         SqlBasicCall oldCondition = (SqlBasicCall) parentWhere.getOperands()[index];                     </span>
<span class="3156064786234930120" onmouseenter="enter('3156064786234930120');" onmouseout="out('3156064786234930120');" style=""> 992         parentWhere.setOperand(index, buildEmptyCondition());                                            </span>
<span class="-6343538087515378636" onmouseenter="enter('-6343538087515378636');" onmouseout="out('-6343538087515378636');" style=""> 993         return oldCondition;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 994     }                                                                                                    </span>
<span  style=""> 995                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 996     /**                                                                                                  </span>
<span class="-6739953174199833520" onmouseenter="enter('-6739953174199833520');" onmouseout="out('-6739953174199833520');" style=""> 997      * 构建 1=1的 where 条件                                                                                  </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 998      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 999      */                                                                                                  </span>
<span class="-4073514796854358980" onmouseenter="enter('-4073514796854358980');" onmouseout="out('-4073514796854358980');" style="">1000     public SqlBasicCall buildEmptyCondition(){                                                           </span>
<span class="7737073508893451149" onmouseenter="enter('7737073508893451149');" onmouseout="out('7737073508893451149');" style="">1001         SqlBinaryOperator equalsOperators = SqlStdOperatorTable.EQUALS;                                  </span>
<span class="-6629769419150459383" onmouseenter="enter('-6629769419150459383');" onmouseout="out('-6629769419150459383');" style="">1002         SqlNode[] operands = new SqlNode[2];                                                             </span>
<span class="7829210030518325331" onmouseenter="enter('7829210030518325331');" onmouseout="out('7829210030518325331');" style="">1003         operands[0] = SqlLiteral.createExactNumeric(&quot;1&quot;, SqlParserPos.ZERO);                             </span>
<span class="8653141241037221613" onmouseenter="enter('8653141241037221613');" onmouseout="out('8653141241037221613');" style="">1004         operands[1] = SqlLiteral.createExactNumeric(&quot;1&quot;, SqlParserPos.ZERO);                             </span>
<span  style="">1005                                                                                                          </span>
<span class="-886608164186614965" onmouseenter="enter('-886608164186614965');" onmouseout="out('-886608164186614965');" style="">1006         return new SqlBasicCall(equalsOperators, operands, SqlParserPos.ZERO);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1007     }                                                                                                    </span>
<span  style="">1008                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1009     /**                                                                                                  </span>
<span class="6566659164166093473" onmouseenter="enter('6566659164166093473');" onmouseout="out('6566659164166093473');" style="">1010      * 替换join 条件中的表名称                                                                                    </span>
<span class="384197096128287152" onmouseenter="enter('384197096128287152');" onmouseout="out('384197096128287152');" style="">1011      * @param node                                                                                       </span>
<span class="1832696003310156507" onmouseenter="enter('1832696003310156507');" onmouseout="out('1832696003310156507');" style="">1012      * @param tableMap 表名的关联关系                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1013      */                                                                                                  </span>
<span class="8926761967375059586" onmouseenter="enter('8926761967375059586');" onmouseout="out('8926761967375059586');" style="">1014     private SqlIdentifier checkAndReplaceJoinCondition(SqlNode node, Map&lt;String, String&gt; tableMap){      </span>
<span  style="">1015                                                                                                          </span>
<span class="-4460996797142447051" onmouseenter="enter('-4460996797142447051');" onmouseout="out('-4460996797142447051');" style="">1016         SqlKind joinKind = node.getKind();                                                               </span>
<span class="6904180996725590590" onmouseenter="enter('6904180996725590590');" onmouseout="out('6904180996725590590');" style="">1017         if( joinKind == AND || joinKind == EQUALS ){                                                     </span>
<span class="-5502960919920628784" onmouseenter="enter('-5502960919920628784');" onmouseout="out('-5502960919920628784');" style=""><abbr title="1018             SqlIdentifier leftNode = checkAndReplaceJoinCondition(((SqlBasicCall)node).operands[0], tableMap);">1018             SqlIdentifier leftNode = checkAndReplaceJoinCondition(((SqlBasicCall)node).operands[0], table🔵</abbr></span>
<span class="-1134508213250580541" onmouseenter="enter('-1134508213250580541');" onmouseout="out('-1134508213250580541');" style=""><abbr title="1019             SqlIdentifier rightNode = checkAndReplaceJoinCondition(((SqlBasicCall)node).operands[1], tableMap);">1019             SqlIdentifier rightNode = checkAndReplaceJoinCondition(((SqlBasicCall)node).operands[1], tabl🔵</abbr></span>
<span  style="">1020                                                                                                          </span>
<span class="1261032046064330806" onmouseenter="enter('1261032046064330806');" onmouseout="out('1261032046064330806');" style="">1021             if(leftNode != null){                                                                        </span>
<span class="7925883472313959466" onmouseenter="enter('7925883472313959466');" onmouseout="out('7925883472313959466');" style="">1022                 ((SqlBasicCall)node).setOperand(0, leftNode);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1023             }                                                                                            </span>
<span  style="">1024                                                                                                          </span>
<span class="-5287428749677694788" onmouseenter="enter('-5287428749677694788');" onmouseout="out('-5287428749677694788');" style="">1025             if(rightNode != null){                                                                       </span>
<span class="-6758558001428237557" onmouseenter="enter('-6758558001428237557');" onmouseout="out('-6758558001428237557');" style="">1026                 ((SqlBasicCall)node).setOperand(1, leftNode);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1027             }                                                                                            </span>
<span  style="">1028                                                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1029             return null;                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1030         } else {                                                                                         </span>
<span class="2603254540286226339" onmouseenter="enter('2603254540286226339');" onmouseout="out('2603254540286226339');" style="">1031             //replace table                                                                              </span>
<span class="-7283729608735687376" onmouseenter="enter('-7283729608735687376');" onmouseout="out('-7283729608735687376');" style=""><abbr title="1032             Preconditions.checkState(((SqlIdentifier)node).names.size() == 2, &quot;join condition must be format table.field&quot;);">1032             Preconditions.checkState(((SqlIdentifier)node).names.size() == 2, &quot;join condition must be for🔵</abbr></span>
<span class="5830077366186139259" onmouseenter="enter('5830077366186139259');" onmouseout="out('5830077366186139259');" style="">1033             String tbName = ((SqlIdentifier) node).names.get(0);                                         </span>
<span class="807909526670811479" onmouseenter="enter('807909526670811479');" onmouseout="out('807909526670811479');" style="">1034             if(tableMap.containsKey(tbName)){                                                            </span>
<span class="-5261902895497527633" onmouseenter="enter('-5261902895497527633');" onmouseout="out('-5261902895497527633');" style="">1035                 tbName = tableMap.get(tbName);                                                           </span>
<span class="6671350446806430567" onmouseenter="enter('6671350446806430567');" onmouseout="out('6671350446806430567');" style="">1036                 return ((SqlIdentifier) node).setName(0, tbName);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1037             }                                                                                            </span>
<span  style="">1038                                                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1039             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1040         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1041     }                                                                                                    </span>
<span  style="">1042                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1043     /**                                                                                                  </span>
<span class="-582093827946699422" onmouseenter="enter('-582093827946699422');" onmouseout="out('-582093827946699422');" style="">1044      * 解析出临时中间表的属性列和源表之间的关系                                                                              </span>
<span class="-1738998936074699450" onmouseenter="enter('-1738998936074699450');" onmouseout="out('-1738998936074699450');" style="">1045      * @param fieldSet                                                                                   </span>
<span class="-1251790622416547945" onmouseenter="enter('-1251790622416547945');" onmouseout="out('-1251790622416547945');" style="">1046      * @param newTableAliasName                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1047      */                                                                                                  </span>
<span class="-8784345461796351735" onmouseenter="enter('-8784345461796351735');" onmouseout="out('-8784345461796351735');" style=""><abbr title="1048     public Map&lt;String, String&gt; buildTmpTableFieldRefOriField(Set&lt;String&gt; fieldSet, String newTableAliasName){">1048     public Map&lt;String, String&gt; buildTmpTableFieldRefOriField(Set&lt;String&gt; fieldSet, String newTableAliasNa🔵</abbr></span>
<span class="-5385725062618077806" onmouseenter="enter('-5385725062618077806');" onmouseout="out('-5385725062618077806');" style="">1049         Map&lt;String, String&gt; refInfo = Maps.newConcurrentMap();                                           </span>
<span class="2568903137449276094" onmouseenter="enter('2568903137449276094');" onmouseout="out('2568903137449276094');" style="">1050         for(String field : fieldSet){                                                                    </span>
<span class="-7222334792573134755" onmouseenter="enter('-7222334792573134755');" onmouseout="out('-7222334792573134755');" style="">1051             String[] fields = StringUtils.splitByWholeSeparator(field, &quot;as&quot;);                            </span>
<span class="2626056789923691030" onmouseenter="enter('2626056789923691030');" onmouseout="out('2626056789923691030');" style="">1052             String oldKey = field;                                                                       </span>
<span class="-5195760423326791334" onmouseenter="enter('-5195760423326791334');" onmouseout="out('-5195760423326791334');" style="">1053             String[] oldFieldInfo = StringUtils.splitByWholeSeparator(fields[0], &quot;.&quot;);                   </span>
<span class="7999505930284522125" onmouseenter="enter('7999505930284522125');" onmouseout="out('7999505930284522125');" style="">1054             String oldFieldName = oldFieldInfo.length == 2 ? oldFieldInfo[1] : oldFieldInfo[0];          </span>
<span class="-6597088482986838827" onmouseenter="enter('-6597088482986838827');" onmouseout="out('-6597088482986838827');" style="">1055             String newKey = fields.length == 2 ? newTableAliasName + &quot;.&quot; + fields[1] :                   </span>
<span class="-4119680836077812037" onmouseenter="enter('-4119680836077812037');" onmouseout="out('-4119680836077812037');" style="">1056                     newTableAliasName + &quot;.&quot; + oldFieldName;                                              </span>
<span class="-3733750508357987129" onmouseenter="enter('-3733750508357987129');" onmouseout="out('-3733750508357987129');" style="">1057             refInfo.put(oldKey, newKey);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1058         }                                                                                                </span>
<span  style="">1059                                                                                                          </span>
<span class="8147181196901690092" onmouseenter="enter('8147181196901690092');" onmouseout="out('8147181196901690092');" style="">1060         return refInfo;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1061     }                                                                                                    </span>
<span  style="">1062                                                                                                          </span>
<span  style="">1063                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1064 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  20 package com.dtstack.flink.sql.side;                                                                      </span>
<span  style="">  21                                                                                                          </span>
<span class="-283888887417937620" onmouseenter="enter('-283888887417937620');" onmouseout="out('-283888887417937620');" style="">  22 import com.dtstack.flink.sql.parser.FlinkPlanner;                                                        </span>
<span class="-4585055968129153397" onmouseenter="enter('-4585055968129153397');" onmouseout="out('-4585055968129153397');" style="">  23 import com.dtstack.flink.sql.util.ParseUtils;                                                            </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  24 import com.dtstack.flink.sql.util.TableUtils;                                                            </span>
<span class="-1945462796058520247" onmouseenter="enter('-1945462796058520247');" onmouseout="out('-1945462796058520247');" style="">  25 import com.esotericsoftware.minlog.Log;                                                                  </span>
<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  26 import com.google.common.base.Preconditions;                                                             </span>
<span class="1793459060364841943" onmouseenter="enter('1793459060364841943');" onmouseout="out('1793459060364841943');" style="">  27 import com.google.common.collect.*;                                                                      </span>
<span class="8584998077480306668" onmouseenter="enter('8584998077480306668');" onmouseout="out('8584998077480306668');" style="">  28 import org.apache.calcite.sql.JoinType;                                                                  </span>
<span class="-6347312057640942811" onmouseenter="enter('-6347312057640942811');" onmouseout="out('-6347312057640942811');" style="">  29 import org.apache.calcite.sql.SqlAsOperator;                                                             </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  30 import org.apache.calcite.sql.SqlBasicCall;                                                              </span>
<span class="5864552825243215550" onmouseenter="enter('5864552825243215550');" onmouseout="out('5864552825243215550');" style="">  31 import org.apache.calcite.sql.SqlBinaryOperator;                                                         </span>
<span class="166699767162158130" onmouseenter="enter('166699767162158130');" onmouseout="out('166699767162158130');" style="">  32 import org.apache.calcite.sql.SqlDataTypeSpec;                                                           </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  33 import org.apache.calcite.sql.SqlIdentifier;                                                             </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  34 import org.apache.calcite.sql.SqlJoin;                                                                   </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  35 import org.apache.calcite.sql.SqlKind;                                                                   </span>
<span class="8852969977988754364" onmouseenter="enter('8852969977988754364');" onmouseout="out('8852969977988754364');" style="">  36 import org.apache.calcite.sql.SqlLiteral;                                                                </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  37 import org.apache.calcite.sql.SqlNode;                                                                   </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  38 import org.apache.calcite.sql.SqlNodeList;                                                               </span>
<span class="2919518510870551176" onmouseenter="enter('2919518510870551176');" onmouseout="out('2919518510870551176');" style="">  39 import org.apache.calcite.sql.SqlOperator;                                                               </span>
<span class="7522331514027736252" onmouseenter="enter('7522331514027736252');" onmouseout="out('7522331514027736252');" style="">  40 import org.apache.calcite.sql.fun.SqlCase;                                                               </span>
<span class="5604125466397600003" onmouseenter="enter('5604125466397600003');" onmouseout="out('5604125466397600003');" style="">  41 import org.apache.calcite.sql.fun.SqlStdOperatorTable;                                                   </span>
<span class="-8475519504744506507" onmouseenter="enter('-8475519504744506507');" onmouseout="out('-8475519504744506507');" style="">  42 import org.apache.calcite.sql.parser.SqlParserPos;                                                       </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  43 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  44 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  45 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="-3548577539000853351" onmouseenter="enter('-3548577539000853351');" onmouseout="out('-3548577539000853351');" style="">  46 import org.apache.flink.table.calcite.FlinkPlannerImpl;                                                  </span>
<span  style="">  47                                                                                                          </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  48 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  49 import java.util.Map;                                                                                    </span>
<span class="-2789246819365843415" onmouseenter="enter('-2789246819365843415');" onmouseout="out('-2789246819365843415');" style="">  50 import java.util.Queue;                                                                                  </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  51 import java.util.Set;                                                                                    </span>
<span  style="">  52                                                                                                          </span>
<span class="7147213704442467623" onmouseenter="enter('7147213704442467623');" onmouseout="out('7147213704442467623');" style="">  53 import static org.apache.calcite.sql.SqlKind.*;                                                          </span>
<span  style="">  54                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  55 /**                                                                                                      </span>
<span class="-4563013574845795077" onmouseenter="enter('-4563013574845795077');" onmouseout="out('-4563013574845795077');" style="">  56  * 处理join 节点                                                                                             </span>
<span class="8838344550496049683" onmouseenter="enter('8838344550496049683');" onmouseout="out('8838344550496049683');" style="">  57  * 1:如果包含维表节点替换为临时查询                                                                                     </span>
<span class="-7758652626234959796" onmouseenter="enter('-7758652626234959796');" onmouseout="out('-7758652626234959796');" style="">  58  * Date: 2020/2/27                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  59  * Company: www.dtstack.com                                                                              </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  60  * @author xuchao                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  61  */                                                                                                      </span>
<span  style="">  62                                                                                                          </span>
<span class="-8466270758182619990" onmouseenter="enter('-8466270758182619990');" onmouseout="out('-8466270758182619990');" style="">  63 public class JoinNodeDealer {                                                                            </span>
<span  style="">  64                                                                                                          </span>
<span class="8212789117715876957" onmouseenter="enter('8212789117715876957');" onmouseout="out('8212789117715876957');" style="">  65     //用来构建临时的中间查询                                                                                        </span>
<span class="7730461828310962384" onmouseenter="enter('7730461828310962384');" onmouseout="out('7730461828310962384');" style="">  66     private static final String SELECT_TEMP_SQL = &quot;select %s from %s %s&quot;;                                </span>
<span  style="">  67                                                                                                          </span>
<span class="-2249026806703256771" onmouseenter="enter('-2249026806703256771');" onmouseout="out('-2249026806703256771');" style="">  68     private SideSQLParser sideSQLParser;                                                                 </span>
<span  style="">  69                                                                                                          </span>
<span class="-3616611273672037444" onmouseenter="enter('-3616611273672037444');" onmouseout="out('-3616611273672037444');" style="">  70     public JoinNodeDealer(SideSQLParser sideSQLParser){                                                  </span>
<span class="1661690928916125634" onmouseenter="enter('1661690928916125634');" onmouseout="out('1661690928916125634');" style="">  71         this.sideSQLParser = sideSQLParser;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  72     }                                                                                                    </span>
<span  style="">  73                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  74     /**                                                                                                  </span>
<span class="5343191871470402950" onmouseenter="enter('5343191871470402950');" onmouseout="out('5343191871470402950');" style="">  75      * 解析 join 操作                                                                                        </span>
<span class="-2995351136134268537" onmouseenter="enter('-2995351136134268537');" onmouseout="out('-2995351136134268537');" style="">  76      * @param joinNode                                                                                   </span>
<span class="4073180356368850460" onmouseenter="enter('4073180356368850460');" onmouseout="out('4073180356368850460');" style="">  77      * @param sideTableSet 标明哪些表名是维表                                                                     </span>
<span class="-1350333652466574225" onmouseenter="enter('-1350333652466574225');" onmouseout="out('-1350333652466574225');" style="">  78      * @param queueInfo sql执行队列                                                                          </span>
<span class="-789269741895746259" onmouseenter="enter('-789269741895746259');" onmouseout="out('-789269741895746259');" style="">  79      * @param parentWhere join 关联的最上层的where 节点                                                           </span>
<span class="2915402449338812450" onmouseenter="enter('2915402449338812450');" onmouseout="out('2915402449338812450');" style="">  80      * @param parentSelectList join 关联的最上层的select 节点                                                     </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style="">  81      * @param joinFieldSet                                                                               </span>
<span class="6609942655811766869" onmouseenter="enter('6609942655811766869');" onmouseout="out('6609942655811766869');" style="">  82      * @param tableRef 存储构建临时表查询后源表和新表之间的关联关系                                                            </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="">  83      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  84      */                                                                                                  </span>
<span class="-2679967316725886886" onmouseenter="enter('-2679967316725886886');" onmouseout="out('-2679967316725886886');" style="">  85     public JoinInfo dealJoinNode(SqlJoin joinNode,                                                       </span>
<span class="-1952250395521254109" onmouseenter="enter('-1952250395521254109');" onmouseout="out('-1952250395521254109');" style="">  86                                  Set&lt;String&gt; sideTableSet,                                               </span>
<span class="405358965608327863" onmouseenter="enter('405358965608327863');" onmouseout="out('405358965608327863');" style="">  87                                  Queue&lt;Object&gt; queueInfo,                                                </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style="">  88                                  SqlNode parentWhere,                                                    </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style="">  89                                  SqlNodeList parentSelectList,                                           </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style="">  90                                  SqlNodeList parentGroupByList,                                          </span>
<span class="221219844685559650" onmouseenter="enter('221219844685559650');" onmouseout="out('221219844685559650');" style="">  91                                  Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,                               </span>
<span class="8208018358691263022" onmouseenter="enter('8208018358691263022');" onmouseout="out('8208018358691263022');" style="">  92                                  Map&lt;String, String&gt; tableRef,                                           </span>
<span class="-1320024569211882427" onmouseenter="enter('-1320024569211882427');" onmouseout="out('-1320024569211882427');" style="">  93                                  Map&lt;String, String&gt; fieldRef) {                                         </span>
<span  style="">  94                                                                                                          </span>
<span class="338082450955407251" onmouseenter="enter('338082450955407251');" onmouseout="out('338082450955407251');" style="">  95         SqlNode leftNode = joinNode.getLeft();                                                           </span>
<span class="6077141851454171925" onmouseenter="enter('6077141851454171925');" onmouseout="out('6077141851454171925');" style="">  96         SqlNode rightNode = joinNode.getRight();                                                         </span>
<span class="3771731584459985741" onmouseenter="enter('3771731584459985741');" onmouseout="out('3771731584459985741');" style="">  97         JoinType joinType = joinNode.getJoinType();                                                      </span>
<span  style="">  98                                                                                                          </span>
<span class="1132914906015926398" onmouseenter="enter('1132914906015926398');" onmouseout="out('1132914906015926398');" style="">  99         String leftTbName = &quot;&quot;;                                                                          </span>
<span class="4210951459006369780" onmouseenter="enter('4210951459006369780');" onmouseout="out('4210951459006369780');" style=""> 100         String leftTbAlias = &quot;&quot;;                                                                         </span>
<span class="8685549357368222156" onmouseenter="enter('8685549357368222156');" onmouseout="out('8685549357368222156');" style=""> 101         String rightTableName = &quot;&quot;;                                                                      </span>
<span class="-3462848723088515190" onmouseenter="enter('-3462848723088515190');" onmouseout="out('-3462848723088515190');" style=""> 102         String rightTableAlias = &quot;&quot;;                                                                     </span>
<span  style=""> 103                                                                                                          </span>
<span class="8157205433740328150" onmouseenter="enter('8157205433740328150');" onmouseout="out('8157205433740328150');" style=""> 104         //抽取join中的的条件                                                                                    </span>
<span class="-2983428553847994428" onmouseenter="enter('-2983428553847994428');" onmouseout="out('-2983428553847994428');" style=""> 105         extractJoinField(joinNode.getCondition(), joinFieldSet);                                         </span>
<span  style=""> 106                                                                                                          </span>
<span class="4311991652949423903" onmouseenter="enter('4311991652949423903');" onmouseout="out('4311991652949423903');" style=""> 107         if (leftNode.getKind() == JOIN) {                                                                </span>
<span class="8741114231031705604" onmouseenter="enter('8741114231031705604');" onmouseout="out('8741114231031705604');" style=""> 108             //处理连续join                                                                                   </span>
<span class="-1001268496906659006" onmouseenter="enter('-1001268496906659006');" onmouseout="out('-1001268496906659006');" style=""> 109             dealNestJoin(joinNode, sideTableSet,                                                         </span>
<span class="5383893876318256511" onmouseenter="enter('5383893876318256511');" onmouseout="out('5383893876318256511');" style=""><abbr title=" 110                     queueInfo, parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, fieldRef);"> 110                     queueInfo, parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, 🔵</abbr></span>
<span class="-2038895670102717129" onmouseenter="enter('-2038895670102717129');" onmouseout="out('-2038895670102717129');" style=""> 111             leftNode = joinNode.getLeft();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112         }                                                                                                </span>
<span  style=""> 113                                                                                                          </span>
<span class="4487076072297445468" onmouseenter="enter('4487076072297445468');" onmouseout="out('4487076072297445468');" style=""> 114         if (leftNode.getKind() == AS) {                                                                  </span>
<span class="939384655387303650" onmouseenter="enter('939384655387303650');" onmouseout="out('939384655387303650');" style=""><abbr title=" 115             AliasInfo aliasInfo = (AliasInfo) sideSQLParser.parseSql(leftNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 115             AliasInfo aliasInfo = (AliasInfo) sideSQLParser.parseSql(leftNode, sideTableSet, queueInfo, p🔵</abbr></span>
<span class="-6271284546665811801" onmouseenter="enter('-6271284546665811801');" onmouseout="out('-6271284546665811801');" style=""> 116             leftTbName = aliasInfo.getName();                                                            </span>
<span class="1754889631815621614" onmouseenter="enter('1754889631815621614');" onmouseout="out('1754889631815621614');" style=""> 117             leftTbAlias = aliasInfo.getAlias();                                                          </span>
<span class="-5692986469808836880" onmouseenter="enter('-5692986469808836880');" onmouseout="out('-5692986469808836880');" style=""> 118         } else if(leftNode.getKind() == IDENTIFIER){                                                     </span>
<span class="-2801204236324253727" onmouseenter="enter('-2801204236324253727');" onmouseout="out('-2801204236324253727');" style=""> 119             leftTbName = leftNode.toString();                                                            </span>
<span class="-1155513509208265617" onmouseenter="enter('-1155513509208265617');" onmouseout="out('-1155513509208265617');" style=""> 120             leftTbAlias = leftTbName;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121         }                                                                                                </span>
<span  style=""> 122                                                                                                          </span>
<span class="818500193985431170" onmouseenter="enter('818500193985431170');" onmouseout="out('818500193985431170');" style=""> 123         boolean leftIsSide = checkIsSideTable(leftTbName, sideTableSet);                                 </span>
<span class="3539880077969659090" onmouseenter="enter('3539880077969659090');" onmouseout="out('3539880077969659090');" style=""> 124         Preconditions.checkState(!leftIsSide, &quot;side-table must be at the right of join operator&quot;);       </span>
<span  style=""> 125                                                                                                          </span>
<span class="-1213513570275508110" onmouseenter="enter('-1213513570275508110');" onmouseout="out('-1213513570275508110');" style=""><abbr title=" 126         Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 126         Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo🔵</abbr></span>
<span class="-8717968456481913232" onmouseenter="enter('-8717968456481913232');" onmouseout="out('-8717968456481913232');" style=""> 127         rightTableName = rightTableNameAndAlias.f0;                                                      </span>
<span class="6344722288957274241" onmouseenter="enter('6344722288957274241');" onmouseout="out('6344722288957274241');" style=""> 128         rightTableAlias = rightTableNameAndAlias.f1;                                                     </span>
<span  style=""> 129                                                                                                          </span>
<span class="-2376755127467584795" onmouseenter="enter('-2376755127467584795');" onmouseout="out('-2376755127467584795');" style=""> 130         boolean rightIsSide = checkIsSideTable(rightTableName, sideTableSet);                            </span>
<span class="-8791016550933072203" onmouseenter="enter('-8791016550933072203');" onmouseout="out('-8791016550933072203');" style=""> 131         if(rightIsSide &amp;&amp; joinType == JoinType.RIGHT){                                                   </span>
<span class="-8772090804951491249" onmouseenter="enter('-8772090804951491249');" onmouseout="out('-8772090804951491249');" style=""><abbr title=" 132             throw new RuntimeException(&quot;side join not support join type of right[current support inner join and left join]&quot;);"> 132             throw new RuntimeException(&quot;side join not support join type of right[current support inner jo🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133         }                                                                                                </span>
<span  style=""> 134                                                                                                          </span>
<span class="-6467047856281920672" onmouseenter="enter('-6467047856281920672');" onmouseout="out('-6467047856281920672');" style=""> 135         JoinInfo tableInfo = new JoinInfo();                                                             </span>
<span class="-3449973379283837894" onmouseenter="enter('-3449973379283837894');" onmouseout="out('-3449973379283837894');" style=""> 136         tableInfo.setLeftTableName(leftTbName);                                                          </span>
<span class="3986639763024215846" onmouseenter="enter('3986639763024215846');" onmouseout="out('3986639763024215846');" style=""> 137         tableInfo.setRightTableName(rightTableName);                                                     </span>
<span  style=""> 138                                                                                                          </span>
<span class="-4276195101487104801" onmouseenter="enter('-4276195101487104801');" onmouseout="out('-4276195101487104801');" style=""> 139         leftTbAlias = StringUtils.isEmpty(leftTbAlias) ? leftTbName : leftTbAlias;                       </span>
<span class="3265584439264898224" onmouseenter="enter('3265584439264898224');" onmouseout="out('3265584439264898224');" style=""> 140         rightTableAlias = StringUtils.isEmpty(rightTableAlias) ? rightTableName : rightTableAlias;       </span>
<span  style=""> 141                                                                                                          </span>
<span class="846009662730869635" onmouseenter="enter('846009662730869635');" onmouseout="out('846009662730869635');" style=""> 142         tableInfo.setLeftTableAlias(leftTbAlias);                                                        </span>
<span class="4941698031257863857" onmouseenter="enter('4941698031257863857');" onmouseout="out('4941698031257863857');" style=""> 143         tableInfo.setRightTableAlias(rightTableAlias);                                                   </span>
<span class="-8645871838585664663" onmouseenter="enter('-8645871838585664663');" onmouseout="out('-8645871838585664663');" style=""> 144         tableInfo.setRightIsSideTable(rightIsSide);                                                      </span>
<span class="-1781974587467511895" onmouseenter="enter('-1781974587467511895');" onmouseout="out('-1781974587467511895');" style=""> 145         tableInfo.setLeftNode(leftNode);                                                                 </span>
<span class="-1730362975620128104" onmouseenter="enter('-1730362975620128104');" onmouseout="out('-1730362975620128104');" style=""> 146         tableInfo.setRightNode(rightNode);                                                               </span>
<span class="-6237310238590034687" onmouseenter="enter('-6237310238590034687');" onmouseout="out('-6237310238590034687');" style=""> 147         tableInfo.setJoinType(joinType);                                                                 </span>
<span class="-2724794810040782007" onmouseenter="enter('-2724794810040782007');" onmouseout="out('-2724794810040782007');" style=""> 148         tableInfo.setCondition(joinNode.getCondition());                                                 </span>
<span class="-6697941901007642600" onmouseenter="enter('-6697941901007642600');" onmouseout="out('-6697941901007642600');" style=""> 149         TableUtils.replaceJoinFieldRefTableName(joinNode.getCondition(), fieldRef);                      </span>
<span  style=""> 150                                                                                                          </span>
<span class="930681598926066970" onmouseenter="enter('930681598926066970');" onmouseout="out('930681598926066970');" style=""> 151         //extract 需要查询的字段信息                                                                              </span>
<span class="-1288427379447515770" onmouseenter="enter('-1288427379447515770');" onmouseout="out('-1288427379447515770');" style=""> 152         if(rightIsSide){                                                                                 </span>
<span class="4601009674852512506" onmouseenter="enter('4601009674852512506');" onmouseout="out('4601009674852512506');" style=""><abbr title=" 153             extractJoinNeedSelectField(leftNode, rightNode, parentWhere, parentSelectList, parentGroupByList, tableRef, joinFieldSet, fieldRef, tableInfo);"> 153             extractJoinNeedSelectField(leftNode, rightNode, parentWhere, parentSelectList, parentGroupByL🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154         }                                                                                                </span>
<span  style=""> 155                                                                                                          </span>
<span class="-8175769203069982871" onmouseenter="enter('-8175769203069982871');" onmouseout="out('-8175769203069982871');" style=""> 156         if(tableInfo.getLeftNode().getKind() != AS){                                                     </span>
<span class="-8283803146393095059" onmouseenter="enter('-8283803146393095059');" onmouseout="out('-8283803146393095059');" style=""> 157             return tableInfo;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158         }                                                                                                </span>
<span  style=""> 159                                                                                                          </span>
<span class="-7263872454890537563" onmouseenter="enter('-7263872454890537563');" onmouseout="out('-7263872454890537563');" style=""> 160         SqlKind asNodeFirstKind = ((SqlBasicCall)tableInfo.getLeftNode()).operands[0].getKind();         </span>
<span class="7769837734339006055" onmouseenter="enter('7769837734339006055');" onmouseout="out('7769837734339006055');" style=""> 161         if(asNodeFirstKind == SELECT){                                                                   </span>
<span class="-6186943853001324725" onmouseenter="enter('-6186943853001324725');" onmouseout="out('-6186943853001324725');" style=""> 162             queueInfo.offer(tableInfo.getLeftNode());                                                    </span>
<span class="5571842213520048771" onmouseenter="enter('5571842213520048771');" onmouseout="out('5571842213520048771');" style=""> 163             tableInfo.setLeftNode(((SqlBasicCall)tableInfo.getLeftNode()).operands[1]);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164         }                                                                                                </span>
<span  style=""> 165                                                                                                          </span>
<span class="-8283803146393095059" onmouseenter="enter('-8283803146393095059');" onmouseout="out('-8283803146393095059');" style=""> 166         return tableInfo;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167     }                                                                                                    </span>
<span  style=""> 168                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 169     /**                                                                                                  </span>
<span class="-6526994496424246980" onmouseenter="enter('-6526994496424246980');" onmouseout="out('-6526994496424246980');" style=""> 170      * 获取join 之后需要查询的字段信息                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 171      */                                                                                                  </span>
<span class="-8070342088850551474" onmouseenter="enter('-8070342088850551474');" onmouseout="out('-8070342088850551474');" style=""> 172     public void extractJoinNeedSelectField(SqlNode leftNode,                                             </span>
<span class="-4990225969144065515" onmouseenter="enter('-4990225969144065515');" onmouseout="out('-4990225969144065515');" style=""> 173                                            SqlNode rightNode,                                            </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style=""> 174                                            SqlNode parentWhere,                                          </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style=""> 175                                            SqlNodeList parentSelectList,                                 </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style=""> 176                                            SqlNodeList parentGroupByList,                                </span>
<span class="8208018358691263022" onmouseenter="enter('8208018358691263022');" onmouseout="out('8208018358691263022');" style=""> 177                                            Map&lt;String, String&gt; tableRef,                                 </span>
<span class="221219844685559650" onmouseenter="enter('221219844685559650');" onmouseout="out('221219844685559650');" style=""> 178                                            Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,                     </span>
<span class="5387904462551126599" onmouseenter="enter('5387904462551126599');" onmouseout="out('5387904462551126599');" style=""> 179                                            Map&lt;String, String&gt; fieldRef,                                 </span>
<span class="-1803976646211983141" onmouseenter="enter('-1803976646211983141');" onmouseout="out('-1803976646211983141');" style=""> 180                                            JoinInfo tableInfo){                                          </span>
<span  style=""> 181                                                                                                          </span>
<span class="-1711591104588450781" onmouseenter="enter('-1711591104588450781');" onmouseout="out('-1711591104588450781');" style=""><abbr title=" 182         Set&lt;String&gt; extractSelectField = extractField(leftNode, parentWhere, parentSelectList, parentGroupByList, tableRef, joinFieldSet);"> 182         Set&lt;String&gt; extractSelectField = extractField(leftNode, parentWhere, parentSelectList, parentGrou🔵</abbr></span>
<span class="5798543527687218027" onmouseenter="enter('5798543527687218027');" onmouseout="out('5798543527687218027');" style=""><abbr title=" 183         Set&lt;String&gt; rightExtractSelectField = extractField(rightNode, parentWhere, parentSelectList, parentGroupByList, tableRef, joinFieldSet);"> 183         Set&lt;String&gt; rightExtractSelectField = extractField(rightNode, parentWhere, parentSelectList, pare🔵</abbr></span>
<span  style=""> 184                                                                                                          </span>
<span class="3213038720352519337" onmouseenter="enter('3213038720352519337');" onmouseout="out('3213038720352519337');" style=""> 185         //重命名right 中和 left 重名的                                                                           </span>
<span class="7303277877915218137" onmouseenter="enter('7303277877915218137');" onmouseout="out('7303277877915218137');" style=""> 186         Map&lt;String, String&gt; leftTbSelectField = Maps.newHashMap();                                       </span>
<span class="-7917371932647768145" onmouseenter="enter('-7917371932647768145');" onmouseout="out('-7917371932647768145');" style=""> 187         Map&lt;String, String&gt; rightTbSelectField = Maps.newHashMap();                                      </span>
<span class="2809964139008068690" onmouseenter="enter('2809964139008068690');" onmouseout="out('2809964139008068690');" style=""> 188         String newTableName = tableInfo.getNewTableAlias();                                              </span>
<span  style=""> 189                                                                                                          </span>
<span class="3316391227079094306" onmouseenter="enter('3316391227079094306');" onmouseout="out('3316391227079094306');" style=""> 190         for(String tmpField : extractSelectField){                                                       </span>
<span class="-5672380782575278344" onmouseenter="enter('-5672380782575278344');" onmouseout="out('-5672380782575278344');" style=""> 191             String[] tmpFieldSplit = StringUtils.split(tmpField, &#x27;.&#x27;);                                   </span>
<span class="2836986565168806948" onmouseenter="enter('2836986565168806948');" onmouseout="out('2836986565168806948');" style=""> 192             leftTbSelectField.put(tmpFieldSplit[1], tmpFieldSplit[1]);                                   </span>
<span class="-5202931256248051147" onmouseenter="enter('-5202931256248051147');" onmouseout="out('-5202931256248051147');" style=""> 193             fieldRef.put(tmpField, TableUtils.buildTableField(newTableName, tmpFieldSplit[1]));          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194         }                                                                                                </span>
<span  style=""> 195                                                                                                          </span>
<span class="-9009930827099038696" onmouseenter="enter('-9009930827099038696');" onmouseout="out('-9009930827099038696');" style=""> 196         for(String tmpField : rightExtractSelectField){                                                  </span>
<span class="-5672380782575278344" onmouseenter="enter('-5672380782575278344');" onmouseout="out('-5672380782575278344');" style=""> 197             String[] tmpFieldSplit = StringUtils.split(tmpField, &#x27;.&#x27;);                                   </span>
<span class="7608141435657997055" onmouseenter="enter('7608141435657997055');" onmouseout="out('7608141435657997055');" style=""> 198             String originalFieldName = tmpFieldSplit[1];                                                 </span>
<span class="-6734440225783578199" onmouseenter="enter('-6734440225783578199');" onmouseout="out('-6734440225783578199');" style=""> 199             String targetFieldName = originalFieldName;                                                  </span>
<span class="-3298038078208796781" onmouseenter="enter('-3298038078208796781');" onmouseout="out('-3298038078208796781');" style=""> 200             if(leftTbSelectField.containsKey(originalFieldName)){                                        </span>
<span class="-1055151855410778283" onmouseenter="enter('-1055151855410778283');" onmouseout="out('-1055151855410778283');" style=""><abbr title=" 201                 targetFieldName = ParseUtils.dealDuplicateFieldName(leftTbSelectField, originalFieldName);"> 201                 targetFieldName = ParseUtils.dealDuplicateFieldName(leftTbSelectField, originalFieldName)🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202             }                                                                                            </span>
<span  style=""> 203                                                                                                          </span>
<span class="5677834067945950920" onmouseenter="enter('5677834067945950920');" onmouseout="out('5677834067945950920');" style=""> 204             rightTbSelectField.put(originalFieldName, targetFieldName);                                  </span>
<span class="1614475174789103856" onmouseenter="enter('1614475174789103856');" onmouseout="out('1614475174789103856');" style=""> 205             fieldRef.put(tmpField, TableUtils.buildTableField(newTableName, targetFieldName));           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206         }                                                                                                </span>
<span  style=""> 207                                                                                                          </span>
<span class="6039372522735153165" onmouseenter="enter('6039372522735153165');" onmouseout="out('6039372522735153165');" style=""> 208         tableInfo.setLeftSelectFieldInfo(leftTbSelectField);                                             </span>
<span class="-3036936727497955518" onmouseenter="enter('-3036936727497955518');" onmouseout="out('-3036936727497955518');" style=""> 209         tableInfo.setRightSelectFieldInfo(rightTbSelectField);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210     }                                                                                                    </span>
<span  style=""> 211                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 212     /**                                                                                                  </span>
<span class="6570650330648921499" onmouseenter="enter('6570650330648921499');" onmouseout="out('6570650330648921499');" style=""> 213      * 指定的节点关联到的 select 中的字段和 where中的字段                                                                  </span>
<span class="3061148848694484073" onmouseenter="enter('3061148848694484073');" onmouseout="out('3061148848694484073');" style=""> 214      * @param sqlNode                                                                                    </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 215      * @param parentWhere                                                                                </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style=""> 216      * @param parentSelectList                                                                           </span>
<span class="3557443413892532302" onmouseenter="enter('3557443413892532302');" onmouseout="out('3557443413892532302');" style=""> 217      * @param parentGroupByList                                                                          </span>
<span class="744467540294235613" onmouseenter="enter('744467540294235613');" onmouseout="out('744467540294235613');" style=""> 218      * @param tableRef                                                                                   </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style=""> 219      * @param joinFieldSet                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 220      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 221      */                                                                                                  </span>
<span class="-4373311553166434161" onmouseenter="enter('-4373311553166434161');" onmouseout="out('-4373311553166434161');" style=""> 222     public Set&lt;String&gt; extractField(SqlNode sqlNode,                                                     </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style=""> 223                                     SqlNode parentWhere,                                                 </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style=""> 224                                     SqlNodeList parentSelectList,                                        </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style=""> 225                                     SqlNodeList parentGroupByList,                                       </span>
<span class="8208018358691263022" onmouseenter="enter('8208018358691263022');" onmouseout="out('8208018358691263022');" style=""> 226                                     Map&lt;String, String&gt; tableRef,                                        </span>
<span class="7220891666826410078" onmouseenter="enter('7220891666826410078');" onmouseout="out('7220891666826410078');" style=""> 227                                     Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet){                           </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 228         Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                </span>
<span class="3720467049200805808" onmouseenter="enter('3720467049200805808');" onmouseout="out('3720467049200805808');" style=""> 229         TableUtils.getFromTableInfo(sqlNode, fromTableNameSet);                                          </span>
<span class="-6851932415303644529" onmouseenter="enter('-6851932415303644529');" onmouseout="out('-6851932415303644529');" style=""> 230         Set&lt;String&gt; extractCondition = Sets.newHashSet();                                                </span>
<span  style=""> 231                                                                                                          </span>
<span class="2214715548245711526" onmouseenter="enter('2214715548245711526');" onmouseout="out('2214715548245711526');" style=""> 232         extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere, extractCondition);           </span>
<span class="5747231761832639727" onmouseenter="enter('5747231761832639727');" onmouseout="out('5747231761832639727');" style=""><abbr title=" 233         Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tableRef);"> 233         Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tableRef🔵</abbr></span>
<span class="4281414700536968132" onmouseenter="enter('4281414700536968132');" onmouseout="out('4281414700536968132');" style=""><abbr title=" 234         Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableNameSet, tableRef);"> 234         Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableN🔵</abbr></span>
<span  style=""> 235                                                                                                          </span>
<span class="6344960557144626200" onmouseenter="enter('6344960557144626200');" onmouseout="out('6344960557144626200');" style=""><abbr title=" 236         Set&lt;String&gt; extractGroupByField = extractFieldFromGroupByList(parentGroupByList, fromTableNameSet, tableRef);"> 236         Set&lt;String&gt; extractGroupByField = extractFieldFromGroupByList(parentGroupByList, fromTableNameSet🔵</abbr></span>
<span  style=""> 237                                                                                                          </span>
<span class="7218037707336831410" onmouseenter="enter('7218037707336831410');" onmouseout="out('7218037707336831410');" style=""> 238         extractSelectField.addAll(extractCondition);                                                     </span>
<span class="4128012888485840534" onmouseenter="enter('4128012888485840534');" onmouseout="out('4128012888485840534');" style=""> 239         extractSelectField.addAll(fieldFromJoinCondition);                                               </span>
<span class="-8364010074861767596" onmouseenter="enter('-8364010074861767596');" onmouseout="out('-8364010074861767596');" style=""> 240         extractSelectField.addAll(extractGroupByField);                                                  </span>
<span  style=""> 241                                                                                                          </span>
<span class="6206897609633081926" onmouseenter="enter('6206897609633081926');" onmouseout="out('6206897609633081926');" style=""> 242         return extractSelectField;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243     }                                                                                                    </span>
<span  style=""> 244                                                                                                          </span>
<span  style=""> 245                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 246     /**                                                                                                  </span>
<span class="-2227309623247049332" onmouseenter="enter('-2227309623247049332');" onmouseout="out('-2227309623247049332');" style=""> 247      * 处理多层join                                                                                          </span>
<span class="-9032432844766422471" onmouseenter="enter('-9032432844766422471');" onmouseout="out('-9032432844766422471');" style=""> 248      * 判断左节点是否需要创建临时查询                                                                                   </span>
<span class="-3743716848325689638" onmouseenter="enter('-3743716848325689638');" onmouseout="out('-3743716848325689638');" style=""> 249      * （1）右节点是维表                                                                                         </span>
<span class="6062511326648248663" onmouseenter="enter('6062511326648248663');" onmouseout="out('6062511326648248663');" style=""> 250      * （2）左节点不是 as 节点                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 251      */                                                                                                  </span>
<span class="-8823647435533406854" onmouseenter="enter('-8823647435533406854');" onmouseout="out('-8823647435533406854');" style=""> 252     private JoinInfo dealNestJoin(SqlJoin joinNode,                                                      </span>
<span class="-1952250395521254109" onmouseenter="enter('-1952250395521254109');" onmouseout="out('-1952250395521254109');" style=""> 253                                   Set&lt;String&gt; sideTableSet,                                              </span>
<span class="405358965608327863" onmouseenter="enter('405358965608327863');" onmouseout="out('405358965608327863');" style=""> 254                                   Queue&lt;Object&gt; queueInfo,                                               </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style=""> 255                                   SqlNode parentWhere,                                                   </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style=""> 256                                   SqlNodeList parentSelectList,                                          </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style=""> 257                                   SqlNodeList parentGroupByList,                                         </span>
<span class="221219844685559650" onmouseenter="enter('221219844685559650');" onmouseout="out('221219844685559650');" style=""> 258                                   Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,                              </span>
<span class="8208018358691263022" onmouseenter="enter('8208018358691263022');" onmouseout="out('8208018358691263022');" style=""> 259                                   Map&lt;String, String&gt; tableRef,                                          </span>
<span class="4274367877110602869" onmouseenter="enter('4274367877110602869');" onmouseout="out('4274367877110602869');" style=""> 260                                   Map&lt;String, String&gt; fieldRef){                                         </span>
<span  style=""> 261                                                                                                          </span>
<span class="-5609072442761450329" onmouseenter="enter('-5609072442761450329');" onmouseout="out('-5609072442761450329');" style=""> 262         SqlJoin leftJoinNode = (SqlJoin) joinNode.getLeft();                                             </span>
<span class="-1304982916123509336" onmouseenter="enter('-1304982916123509336');" onmouseout="out('-1304982916123509336');" style=""> 263         SqlNode parentRightJoinNode = joinNode.getRight();                                               </span>
<span class="3581810211864331265" onmouseenter="enter('3581810211864331265');" onmouseout="out('3581810211864331265');" style=""> 264         SqlNode rightNode = leftJoinNode.getRight();                                                     </span>
<span class="-1213513570275508110" onmouseenter="enter('-1213513570275508110');" onmouseout="out('-1213513570275508110');" style=""><abbr title=" 265         Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 265         Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo🔵</abbr></span>
<span class="7880211710586462336" onmouseenter="enter('7880211710586462336');" onmouseout="out('7880211710586462336');" style=""><abbr title=" 266         Tuple2&lt;String, String&gt; parentRightJoinInfo = parseRightNode(parentRightJoinNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 266         Tuple2&lt;String, String&gt; parentRightJoinInfo = parseRightNode(parentRightJoinNode, sideTableSet, qu🔵</abbr></span>
<span class="-5913516627524533061" onmouseenter="enter('-5913516627524533061');" onmouseout="out('-5913516627524533061');" style=""> 267         boolean parentRightIsSide = checkIsSideTable(parentRightJoinInfo.f0, sideTableSet);              </span>
<span  style=""> 268                                                                                                          </span>
<span class="3375986139512671503" onmouseenter="enter('3375986139512671503');" onmouseout="out('3375986139512671503');" style=""><abbr title=" 269         JoinInfo joinInfo = dealJoinNode(leftJoinNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, fieldRef);"> 269         JoinInfo joinInfo = dealJoinNode(leftJoinNode, sideTableSet, queueInfo, parentWhere, parentSelect🔵</abbr></span>
<span  style=""> 270                                                                                                          </span>
<span class="-8707963241001902314" onmouseenter="enter('-8707963241001902314');" onmouseout="out('-8707963241001902314');" style=""> 271         String rightTableName = rightTableNameAndAlias.f0;                                               </span>
<span class="-2376755127467584795" onmouseenter="enter('-2376755127467584795');" onmouseout="out('-2376755127467584795');" style=""> 272         boolean rightIsSide = checkIsSideTable(rightTableName, sideTableSet);                            </span>
<span class="-1905801896855583684" onmouseenter="enter('-1905801896855583684');" onmouseout="out('-1905801896855583684');" style=""> 273         SqlBasicCall buildAs = TableUtils.buildAsNodeByJoinInfo(joinInfo, null, null);                   </span>
<span  style=""> 274                                                                                                          </span>
<span class="-1288427379447515770" onmouseenter="enter('-1288427379447515770');" onmouseout="out('-1288427379447515770');" style=""> 275         if(rightIsSide){                                                                                 </span>
<span class="-1341811977371241920" onmouseenter="enter('-1341811977371241920');" onmouseout="out('-1341811977371241920');" style=""><abbr title=" 276             addSideInfoToExeQueue(queueInfo, joinInfo, joinNode, parentSelectList, parentGroupByList, parentWhere, tableRef);"> 276             addSideInfoToExeQueue(queueInfo, joinInfo, joinNode, parentSelectList, parentGroupByList, par🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277         }                                                                                                </span>
<span  style=""> 278                                                                                                          </span>
<span class="-4926661402208797605" onmouseenter="enter('-4926661402208797605');" onmouseout="out('-4926661402208797605');" style=""> 279         SqlNode newLeftNode = joinNode.getLeft();                                                        </span>
<span  style=""> 280                                                                                                          </span>
<span class="669597408116519005" onmouseenter="enter('669597408116519005');" onmouseout="out('669597408116519005');" style=""> 281         if(newLeftNode.getKind() != AS &amp;&amp; parentRightIsSide){                                            </span>
<span  style=""> 282                                                                                                          </span>
<span class="-7949998902589886822" onmouseenter="enter('-7949998902589886822');" onmouseout="out('-7949998902589886822');" style=""> 283             String leftTbAlias = buildAs.getOperands()[1].toString();                                    </span>
<span class="-647616919686055479" onmouseenter="enter('-647616919686055479');" onmouseout="out('-647616919686055479');" style=""> 284             extractTemporaryQuery(newLeftNode, leftTbAlias, (SqlBasicCall) parentWhere,                  </span>
<span class="-4123256814652138053" onmouseenter="enter('-4123256814652138053');" onmouseout="out('-4123256814652138053');" style=""> 285                     parentSelectList, queueInfo, joinFieldSet, tableRef, fieldRef);                      </span>
<span  style=""> 286                                                                                                          </span>
<span class="3808835679994269685" onmouseenter="enter('3808835679994269685');" onmouseout="out('3808835679994269685');" style=""> 287             //替换leftNode 为新的查询                                                                           </span>
<span class="-9132777540839355627" onmouseenter="enter('-9132777540839355627');" onmouseout="out('-9132777540839355627');" style=""> 288             joinNode.setLeft(buildAs);                                                                   </span>
<span class="-2381095167123449114" onmouseenter="enter('-2381095167123449114');" onmouseout="out('-2381095167123449114');" style=""><abbr title=" 289             replaceSelectAndWhereField(buildAs, leftJoinNode, tableRef, parentSelectList, parentGroupByList, parentWhere);"> 289             replaceSelectAndWhereField(buildAs, leftJoinNode, tableRef, parentSelectList, parentGroupByLi🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290         }                                                                                                </span>
<span  style=""> 291                                                                                                          </span>
<span class="8714866254863163325" onmouseenter="enter('8714866254863163325');" onmouseout="out('8714866254863163325');" style=""> 292         return joinInfo;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293     }                                                                                                    </span>
<span  style=""> 294                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 295     /**                                                                                                  </span>
<span class="4951286882385365012" onmouseenter="enter('4951286882385365012');" onmouseout="out('4951286882385365012');" style=""> 296      * 右边表是维表需要重新构建左表的临时查询                                                                               </span>
<span class="-8208655787748224971" onmouseenter="enter('-8208655787748224971');" onmouseout="out('-8208655787748224971');" style=""> 297      * 并将joinInfo 添加到执行队列里面                                                                              </span>
<span class="3894561521416724418" onmouseenter="enter('3894561521416724418');" onmouseout="out('3894561521416724418');" style=""> 298      * @param queueInfo                                                                                  </span>
<span class="-6040909485639107572" onmouseenter="enter('-6040909485639107572');" onmouseout="out('-6040909485639107572');" style=""> 299      * @param joinInfo                                                                                   </span>
<span class="-2995351136134268537" onmouseenter="enter('-2995351136134268537');" onmouseout="out('-2995351136134268537');" style=""> 300      * @param joinNode                                                                                   </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style=""> 301      * @param parentSelectList                                                                           </span>
<span class="3557443413892532302" onmouseenter="enter('3557443413892532302');" onmouseout="out('3557443413892532302');" style=""> 302      * @param parentGroupByList                                                                          </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 303      * @param parentWhere                                                                                </span>
<span class="744467540294235613" onmouseenter="enter('744467540294235613');" onmouseout="out('744467540294235613');" style=""> 304      * @param tableRef                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 305      */                                                                                                  </span>
<span class="3979713406384282644" onmouseenter="enter('3979713406384282644');" onmouseout="out('3979713406384282644');" style=""> 306     public void addSideInfoToExeQueue(Queue&lt;Object&gt; queueInfo,                                           </span>
<span class="7516859044924889091" onmouseenter="enter('7516859044924889091');" onmouseout="out('7516859044924889091');" style=""> 307                                       JoinInfo joinInfo,                                                 </span>
<span class="1981177442384846922" onmouseenter="enter('1981177442384846922');" onmouseout="out('1981177442384846922');" style=""> 308                                       SqlJoin joinNode,                                                  </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style=""> 309                                       SqlNodeList parentSelectList,                                      </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style=""> 310                                       SqlNodeList parentGroupByList,                                     </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style=""> 311                                       SqlNode parentWhere,                                               </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style=""> 312                                       Map&lt;String, String&gt; tableRef){                                     </span>
<span class="-6478373311886746675" onmouseenter="enter('-6478373311886746675');" onmouseout="out('-6478373311886746675');" style=""> 313         //只处理维表                                                                                          </span>
<span class="-3203763040208890217" onmouseenter="enter('-3203763040208890217');" onmouseout="out('-3203763040208890217');" style=""> 314         if(!joinInfo.isRightIsSideTable()){                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 315             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316         }                                                                                                </span>
<span  style=""> 317                                                                                                          </span>
<span class="-1905801896855583684" onmouseenter="enter('-1905801896855583684');" onmouseout="out('-1905801896855583684');" style=""> 318         SqlBasicCall buildAs = TableUtils.buildAsNodeByJoinInfo(joinInfo, null, null);                   </span>
<span class="-2672508263360943403" onmouseenter="enter('-2672508263360943403');" onmouseout="out('-2672508263360943403');" style=""> 319         SqlNode leftJoinNode = joinNode.getLeft();                                                       </span>
<span class="6641920780390342492" onmouseenter="enter('6641920780390342492');" onmouseout="out('6641920780390342492');" style=""> 320         queueInfo.offer(joinInfo);                                                                       </span>
<span class="5508401011707832352" onmouseenter="enter('5508401011707832352');" onmouseout="out('5508401011707832352');" style=""> 321         //替换左表为新的表名称                                                                                     </span>
<span class="-9132777540839355627" onmouseenter="enter('-9132777540839355627');" onmouseout="out('-9132777540839355627');" style=""> 322         joinNode.setLeft(buildAs);                                                                       </span>
<span  style=""> 323                                                                                                          </span>
<span class="-2381095167123449114" onmouseenter="enter('-2381095167123449114');" onmouseout="out('-2381095167123449114');" style=""><abbr title=" 324         replaceSelectAndWhereField(buildAs, leftJoinNode, tableRef, parentSelectList, parentGroupByList, parentWhere);"> 324         replaceSelectAndWhereField(buildAs, leftJoinNode, tableRef, parentSelectList, parentGroupByList, 🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325     }                                                                                                    </span>
<span  style=""> 326                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 327     /**                                                                                                  </span>
<span class="2664257413645127477" onmouseenter="enter('2664257413645127477');" onmouseout="out('2664257413645127477');" style=""> 328      * 替换指定的查询和条件节点中的字段为新的字段                                                                             </span>
<span class="-5192515893397779968" onmouseenter="enter('-5192515893397779968');" onmouseout="out('-5192515893397779968');" style=""> 329      * @param buildAs                                                                                    </span>
<span class="8761373734140075238" onmouseenter="enter('8761373734140075238');" onmouseout="out('8761373734140075238');" style=""> 330      * @param leftJoinNode                                                                               </span>
<span class="744467540294235613" onmouseenter="enter('744467540294235613');" onmouseout="out('744467540294235613');" style=""> 331      * @param tableRef                                                                                   </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style=""> 332      * @param parentSelectList                                                                           </span>
<span class="3557443413892532302" onmouseenter="enter('3557443413892532302');" onmouseout="out('3557443413892532302');" style=""> 333      * @param parentGroupByList                                                                          </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 334      * @param parentWhere                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 335      */                                                                                                  </span>
<span class="-8851224148732895615" onmouseenter="enter('-8851224148732895615');" onmouseout="out('-8851224148732895615');" style=""> 336     public void replaceSelectAndWhereField(SqlBasicCall buildAs,                                         </span>
<span class="-7569254098639694631" onmouseenter="enter('-7569254098639694631');" onmouseout="out('-7569254098639694631');" style=""> 337                    SqlNode leftJoinNode,                                                                 </span>
<span class="8208018358691263022" onmouseenter="enter('8208018358691263022');" onmouseout="out('8208018358691263022');" style=""> 338                    Map&lt;String, String&gt; tableRef,                                                         </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style=""> 339                    SqlNodeList parentSelectList,                                                         </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style=""> 340                    SqlNodeList parentGroupByList,                                                        </span>
<span class="3000848303760980313" onmouseenter="enter('3000848303760980313');" onmouseout="out('3000848303760980313');" style=""> 341                    SqlNode parentWhere){                                                                 </span>
<span  style=""> 342                                                                                                          </span>
<span class="-1197906562874334747" onmouseenter="enter('-1197906562874334747');" onmouseout="out('-1197906562874334747');" style=""> 343         String newLeftTableName = buildAs.getOperands()[1].toString();                                   </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 344         Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                </span>
<span class="6977570025516648131" onmouseenter="enter('6977570025516648131');" onmouseout="out('6977570025516648131');" style=""> 345         TableUtils.getFromTableInfo(leftJoinNode, fromTableNameSet);                                     </span>
<span  style=""> 346                                                                                                          </span>
<span class="-4128731698405516984" onmouseenter="enter('-4128731698405516984');" onmouseout="out('-4128731698405516984');" style=""> 347         for(String tbTmp : fromTableNameSet){                                                            </span>
<span class="6564874017116360040" onmouseenter="enter('6564874017116360040');" onmouseout="out('6564874017116360040');" style=""> 348             tableRef.put(tbTmp, newLeftTableName);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349         }                                                                                                </span>
<span  style=""> 350                                                                                                          </span>
<span class="-3833992755798848111" onmouseenter="enter('-3833992755798848111');" onmouseout="out('-3833992755798848111');" style=""> 351         //替换select field 中的对应字段                                                                          </span>
<span class="5558486769410159556" onmouseenter="enter('5558486769410159556');" onmouseout="out('5558486769410159556');" style=""> 352         HashBiMap&lt;String, String&gt; fieldReplaceRef = HashBiMap.create();                                  </span>
<span class="5699421896693743778" onmouseenter="enter('5699421896693743778');" onmouseout="out('5699421896693743778');" style=""> 353         for(SqlNode sqlNode : parentSelectList.getList()){                                               </span>
<span class="-7140235961109122639" onmouseenter="enter('-7140235961109122639');" onmouseout="out('-7140235961109122639');" style=""> 354             for(String tbTmp : fromTableNameSet) {                                                       </span>
<span class="-581523387212695221" onmouseenter="enter('-581523387212695221');" onmouseout="out('-581523387212695221');" style=""> 355                 TableUtils.replaceSelectFieldTable(sqlNode, tbTmp, newLeftTableName, fieldReplaceRef);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357         }                                                                                                </span>
<span  style=""> 358                                                                                                          </span>
<span class="-8944541773972050035" onmouseenter="enter('-8944541773972050035');" onmouseout="out('-8944541773972050035');" style=""> 359         //TODO 应该根据上面的查询字段的关联关系来替换                                                                       </span>
<span class="1927000767768311618" onmouseenter="enter('1927000767768311618');" onmouseout="out('1927000767768311618');" style=""> 360         //替换where 中的条件相关                                                                                 </span>
<span class="-4128731698405516984" onmouseenter="enter('-4128731698405516984');" onmouseout="out('-4128731698405516984');" style=""> 361         for(String tbTmp : fromTableNameSet){                                                            </span>
<span class="5165818510692281294" onmouseenter="enter('5165818510692281294');" onmouseout="out('5165818510692281294');" style=""> 362             TableUtils.replaceWhereCondition(parentWhere, tbTmp, newLeftTableName, fieldReplaceRef);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363         }                                                                                                </span>
<span  style=""> 364                                                                                                          </span>
<span class="6193699176503696110" onmouseenter="enter('6193699176503696110');" onmouseout="out('6193699176503696110');" style=""> 365         if(parentGroupByList != null){                                                                   </span>
<span class="8082263099560409349" onmouseenter="enter('8082263099560409349');" onmouseout="out('8082263099560409349');" style=""> 366             for(SqlNode sqlNode : parentGroupByList.getList()){                                          </span>
<span class="-7140235961109122639" onmouseenter="enter('-7140235961109122639');" onmouseout="out('-7140235961109122639');" style=""> 367                 for(String tbTmp : fromTableNameSet) {                                                   </span>
<span class="-581523387212695221" onmouseenter="enter('-581523387212695221');" onmouseout="out('-581523387212695221');" style=""><abbr title=" 368                     TableUtils.replaceSelectFieldTable(sqlNode, tbTmp, newLeftTableName, fieldReplaceRef);"> 368                     TableUtils.replaceSelectFieldTable(sqlNode, tbTmp, newLeftTableName, fieldReplaceRef)🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 370             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371         }                                                                                                </span>
<span  style=""> 372                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373     }                                                                                                    </span>
<span  style=""> 374                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 375     /**                                                                                                  </span>
<span class="-9161506910855772732" onmouseenter="enter('-9161506910855772732');" onmouseout="out('-9161506910855772732');" style=""> 376      * 抽取出中间查询表                                                                                          </span>
<span class="384197096128287152" onmouseenter="enter('384197096128287152');" onmouseout="out('384197096128287152');" style=""> 377      * @param node                                                                                       </span>
<span class="3992250397465727176" onmouseenter="enter('3992250397465727176');" onmouseout="out('3992250397465727176');" style=""> 378      * @param tableAlias                                                                                 </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 379      * @param parentWhere                                                                                </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style=""> 380      * @param parentSelectList                                                                           </span>
<span class="3894561521416724418" onmouseenter="enter('3894561521416724418');" onmouseout="out('3894561521416724418');" style=""> 381      * @param queueInfo                                                                                  </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style=""> 382      * @param joinFieldSet                                                                               </span>
<span class="744467540294235613" onmouseenter="enter('744467540294235613');" onmouseout="out('744467540294235613');" style=""> 383      * @param tableRef                                                                                   </span>
<span class="6064073244373316048" onmouseenter="enter('6064073244373316048');" onmouseout="out('6064073244373316048');" style=""> 384      * @return 源自段和新生成字段之间的映射关系                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 385      */                                                                                                  </span>
<span class="-6236609755307512773" onmouseenter="enter('-6236609755307512773');" onmouseout="out('-6236609755307512773');" style=""> 386     private void extractTemporaryQuery(SqlNode node, String tableAlias,                                  </span>
<span class="1711245815305911921" onmouseenter="enter('1711245815305911921');" onmouseout="out('1711245815305911921');" style=""> 387                                        SqlBasicCall parentWhere,                                         </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style=""> 388                                        SqlNodeList parentSelectList,                                     </span>
<span class="405358965608327863" onmouseenter="enter('405358965608327863');" onmouseout="out('405358965608327863');" style=""> 389                                        Queue&lt;Object&gt; queueInfo,                                          </span>
<span class="221219844685559650" onmouseenter="enter('221219844685559650');" onmouseout="out('221219844685559650');" style=""> 390                                        Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,                         </span>
<span class="8208018358691263022" onmouseenter="enter('8208018358691263022');" onmouseout="out('8208018358691263022');" style=""> 391                                        Map&lt;String, String&gt; tableRef,                                     </span>
<span class="4274367877110602869" onmouseenter="enter('4274367877110602869');" onmouseout="out('4274367877110602869');" style=""> 392                                        Map&lt;String, String&gt; fieldRef){                                    </span>
<span class="-1891643383856272179" onmouseenter="enter('-1891643383856272179');" onmouseout="out('-1891643383856272179');" style=""> 393         try{                                                                                             </span>
<span class="-8973252823595593319" onmouseenter="enter('-8973252823595593319');" onmouseout="out('-8973252823595593319');" style=""> 394             //父一级的where 条件中如果只和临时查询相关的条件都截取进来                                                            </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 395             Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                            </span>
<span class="-1162190359921159801" onmouseenter="enter('-1162190359921159801');" onmouseout="out('-1162190359921159801');" style=""> 396             List&lt;SqlBasicCall&gt; extractCondition = Lists.newArrayList();                                  </span>
<span  style=""> 397                                                                                                          </span>
<span class="8110456237367799034" onmouseenter="enter('8110456237367799034');" onmouseout="out('8110456237367799034');" style=""> 398             TableUtils.getFromTableInfo(node, fromTableNameSet);                                         </span>
<span class="6022466615463989785" onmouseenter="enter('6022466615463989785');" onmouseout="out('6022466615463989785');" style=""> 399             checkAndRemoveWhereCondition(fromTableNameSet, parentWhere, extractCondition);               </span>
<span  style=""> 400                                                                                                          </span>
<span class="8695778948204515419" onmouseenter="enter('8695778948204515419');" onmouseout="out('8695778948204515419');" style=""> 401             if(node.getKind() == JOIN){                                                                  </span>
<span class="-6199554136531935919" onmouseenter="enter('-6199554136531935919');" onmouseout="out('-6199554136531935919');" style=""> 402                 checkAndReplaceJoinCondition(((SqlJoin)node).getCondition(), tableRef);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403             }                                                                                            </span>
<span  style=""> 404                                                                                                          </span>
<span class="5747231761832639727" onmouseenter="enter('5747231761832639727');" onmouseout="out('5747231761832639727');" style=""><abbr title=" 405             Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tableRef);"> 405             Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tabl🔵</abbr></span>
<span class="4281414700536968132" onmouseenter="enter('4281414700536968132');" onmouseout="out('4281414700536968132');" style=""><abbr title=" 406             Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableNameSet, tableRef);"> 406             Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTa🔵</abbr></span>
<span class="-718326697477564125" onmouseenter="enter('-718326697477564125');" onmouseout="out('-718326697477564125');" style=""> 407             Set&lt;String&gt; newFields = buildSelectNode(extractSelectField, fieldFromJoinCondition);         </span>
<span class="9076146696470564191" onmouseenter="enter('9076146696470564191');" onmouseout="out('9076146696470564191');" style=""> 408             String extractSelectFieldStr = StringUtils.join(newFields, &#x27;,&#x27;);                             </span>
<span  style=""> 409                                                                                                          </span>
<span class="4157544700609283076" onmouseenter="enter('4157544700609283076');" onmouseout="out('4157544700609283076');" style=""> 410             Map&lt;String, String&gt; oldRefNewField = buildTmpTableFieldRefOriField(newFields, tableAlias);   </span>
<span class="-9040628512379918841" onmouseenter="enter('-9040628512379918841');" onmouseout="out('-9040628512379918841');" style=""> 411             fieldRef.putAll(oldRefNewField);                                                             </span>
<span  style=""> 412                                                                                                          </span>
<span class="-3122368802496797506" onmouseenter="enter('-3122368802496797506');" onmouseout="out('-3122368802496797506');" style=""> 413             String extractConditionStr = buildCondition(extractCondition);                               </span>
<span  style=""> 414                                                                                                          </span>
<span class="6190023554533569746" onmouseenter="enter('6190023554533569746');" onmouseout="out('6190023554533569746');" style=""> 415             String tmpSelectSql = String.format(SELECT_TEMP_SQL,                                         </span>
<span class="3430988890108370699" onmouseenter="enter('3430988890108370699');" onmouseout="out('3430988890108370699');" style=""> 416                     extractSelectFieldStr,                                                               </span>
<span class="-1169517675965244531" onmouseenter="enter('-1169517675965244531');" onmouseout="out('-1169517675965244531');" style=""> 417                     node.toString(),                                                                     </span>
<span class="4099345839703116685" onmouseenter="enter('4099345839703116685');" onmouseout="out('4099345839703116685');" style=""> 418                     extractConditionStr);                                                                </span>
<span  style=""> 419                                                                                                          </span>
<span class="-1075958635284917181" onmouseenter="enter('-1075958635284917181');" onmouseout="out('-1075958635284917181');" style=""> 420             FlinkPlannerImpl flinkPlanner = FlinkPlanner.getFlinkPlanner();                              </span>
<span class="7395930912815097284" onmouseenter="enter('7395930912815097284');" onmouseout="out('7395930912815097284');" style=""> 421             SqlNode sqlNode = flinkPlanner.parse(tmpSelectSql);                                          </span>
<span  style=""> 422                                                                                                          </span>
<span class="-2735890898778643076" onmouseenter="enter('-2735890898778643076');" onmouseout="out('-2735890898778643076');" style=""> 423             SqlBasicCall sqlBasicCall = buildAsSqlNode(tableAlias, sqlNode);                             </span>
<span class="2417854506040223841" onmouseenter="enter('2417854506040223841');" onmouseout="out('2417854506040223841');" style=""> 424             queueInfo.offer(sqlBasicCall);                                                               </span>
<span  style=""> 425                                                                                                          </span>
<span class="3036777158467770620" onmouseenter="enter('3036777158467770620');" onmouseout="out('3036777158467770620');" style=""> 426             //替换select中的表结构                                                                              </span>
<span class="5558486769410159556" onmouseenter="enter('5558486769410159556');" onmouseout="out('5558486769410159556');" style=""> 427             HashBiMap&lt;String, String&gt; fieldReplaceRef = HashBiMap.create();                              </span>
<span class="6403576620687993648" onmouseenter="enter('6403576620687993648');" onmouseout="out('6403576620687993648');" style=""> 428             for(SqlNode tmpSelect : parentSelectList.getList()){                                         </span>
<span class="-7140235961109122639" onmouseenter="enter('-7140235961109122639');" onmouseout="out('-7140235961109122639');" style=""> 429                 for(String tbTmp : fromTableNameSet) {                                                   </span>
<span class="-2362265056324339707" onmouseenter="enter('-2362265056324339707');" onmouseout="out('-2362265056324339707');" style=""> 430                     TableUtils.replaceSelectFieldTable(tmpSelect, tbTmp, tableAlias, fieldReplaceRef);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 431                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 432             }                                                                                            </span>
<span  style=""> 433                                                                                                          </span>
<span class="1927000767768311618" onmouseenter="enter('1927000767768311618');" onmouseout="out('1927000767768311618');" style=""> 434             //替换where 中的条件相关                                                                             </span>
<span class="-4128731698405516984" onmouseenter="enter('-4128731698405516984');" onmouseout="out('-4128731698405516984');" style=""> 435             for(String tbTmp : fromTableNameSet){                                                        </span>
<span class="859671676632511130" onmouseenter="enter('859671676632511130');" onmouseout="out('859671676632511130');" style=""> 436                 TableUtils.replaceWhereCondition(parentWhere, tbTmp, tableAlias, fieldReplaceRef);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437             }                                                                                            </span>
<span  style=""> 438                                                                                                          </span>
<span class="-4128731698405516984" onmouseenter="enter('-4128731698405516984');" onmouseout="out('-4128731698405516984');" style=""> 439             for(String tbTmp : fromTableNameSet){                                                        </span>
<span class="-6060557126611161603" onmouseenter="enter('-6060557126611161603');" onmouseout="out('-6060557126611161603');" style=""> 440                 tableRef.put(tbTmp, tableAlias);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 441             }                                                                                            </span>
<span  style=""> 442                                                                                                          </span>
<span class="3487269535061511064" onmouseenter="enter('3487269535061511064');" onmouseout="out('3487269535061511064');" style=""> 443             System.out.println(&quot;-------build temporary query-----------&quot;);                               </span>
<span class="-8101867096626384734" onmouseenter="enter('-8101867096626384734');" onmouseout="out('-8101867096626384734');" style=""> 444             System.out.println(tmpSelectSql);                                                            </span>
<span class="-4281832807373115174" onmouseenter="enter('-4281832807373115174');" onmouseout="out('-4281832807373115174');" style=""> 445             System.out.println(&quot;---------------------------------------&quot;);                               </span>
<span  style=""> 446                                                                                                          </span>
<span class="-1580407524319062305" onmouseenter="enter('-1580407524319062305');" onmouseout="out('-1580407524319062305');" style=""> 447         }catch (Exception e){                                                                            </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 448             e.printStackTrace();                                                                         </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 449             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 450         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451     }                                                                                                    </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 452 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 453 ||||||| BASE                                                                                             </span>
<span class="-2402394227701825991" onmouseenter="enter('-2402394227701825991');" onmouseout="out('-2402394227701825991');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 454 private void extractTemporaryQuery(SqlNode node, String tableAlias, SqlBasicCall parentWhere,            </span>
<span class="1575560997126003034" onmouseenter="enter('1575560997126003034');" onmouseout="out('1575560997126003034');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 455                                        SqlNodeList parentSelectList, Queue&lt;Object&gt; queueInfo,            </span>
<span class="221219844685559650" onmouseenter="enter('221219844685559650');" onmouseout="out('221219844685559650');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 456                                        Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,                         </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 457                                        Map&lt;String, String&gt; tableRef){                                    </span>
<span class="-1891643383856272179" onmouseenter="enter('-1891643383856272179');" onmouseout="out('-1891643383856272179');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 458         try{                                                                                             </span>
<span class="-8973252823595593319" onmouseenter="enter('-8973252823595593319');" onmouseout="out('-8973252823595593319');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 459             //父一级的where 条件中如果只和临时查询相关的条件都截取进来                                                            </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 460             Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                            </span>
<span class="-1162190359921159801" onmouseenter="enter('-1162190359921159801');" onmouseout="out('-1162190359921159801');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 461             List&lt;SqlBasicCall&gt; extractCondition = Lists.newArrayList();                                  </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 462                                                                                                          </span>
<span class="8110456237367799034" onmouseenter="enter('8110456237367799034');" onmouseout="out('8110456237367799034');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 463             TableUtils.getFromTableInfo(node, fromTableNameSet);                                         </span>
<span class="6022466615463989785" onmouseenter="enter('6022466615463989785');" onmouseout="out('6022466615463989785');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 464             checkAndRemoveWhereCondition(fromTableNameSet, parentWhere, extractCondition);               </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 465                                                                                                          </span>
<span class="8695778948204515419" onmouseenter="enter('8695778948204515419');" onmouseout="out('8695778948204515419');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 466             if(node.getKind() == JOIN){                                                                  </span>
<span class="-6199554136531935919" onmouseenter="enter('-6199554136531935919');" onmouseout="out('-6199554136531935919');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 467                 checkAndReplaceJoinCondition(((SqlJoin)node).getCondition(), tableRef);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 468             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 469                                                                                                          </span>
<span class="5747231761832639727" onmouseenter="enter('5747231761832639727');" onmouseout="out('5747231761832639727');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 470             Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tableRef);"> 470             Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tabl🔵</abbr></span>
<span class="1865200144735135853" onmouseenter="enter('1865200144735135853');" onmouseout="out('1865200144735135853');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 471             Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableNameSet);"> 471             Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTa🔵</abbr></span>
<span class="-3053698166334827106" onmouseenter="enter('-3053698166334827106');" onmouseout="out('-3053698166334827106');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 472             String extractSelectFieldStr = buildSelectNode(extractSelectField, fieldFromJoinCondition);  </span>
<span class="-3122368802496797506" onmouseenter="enter('-3122368802496797506');" onmouseout="out('-3122368802496797506');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 473             String extractConditionStr = buildCondition(extractCondition);                               </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 474                                                                                                          </span>
<span class="6190023554533569746" onmouseenter="enter('6190023554533569746');" onmouseout="out('6190023554533569746');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 475             String tmpSelectSql = String.format(SELECT_TEMP_SQL,                                         </span>
<span class="3430988890108370699" onmouseenter="enter('3430988890108370699');" onmouseout="out('3430988890108370699');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 476                     extractSelectFieldStr,                                                               </span>
<span class="-1169517675965244531" onmouseenter="enter('-1169517675965244531');" onmouseout="out('-1169517675965244531');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 477                     node.toString(),                                                                     </span>
<span class="4099345839703116685" onmouseenter="enter('4099345839703116685');" onmouseout="out('4099345839703116685');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 478                     extractConditionStr);                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 479                                                                                                          </span>
<span class="-3319042643252387519" onmouseenter="enter('-3319042643252387519');" onmouseout="out('-3319042643252387519');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 480             SqlParser sqlParser = SqlParser.create(tmpSelectSql, CalciteConfig.MYSQL_LEX_CONFIG);        </span>
<span class="-1853454348884693240" onmouseenter="enter('-1853454348884693240');" onmouseout="out('-1853454348884693240');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 481             SqlNode sqlNode = sqlParser.parseStmt();                                                     </span>
<span class="-2735890898778643076" onmouseenter="enter('-2735890898778643076');" onmouseout="out('-2735890898778643076');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 482             SqlBasicCall sqlBasicCall = buildAsSqlNode(tableAlias, sqlNode);                             </span>
<span class="2417854506040223841" onmouseenter="enter('2417854506040223841');" onmouseout="out('2417854506040223841');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 483             queueInfo.offer(sqlBasicCall);                                                               </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 484                                                                                                          </span>
<span class="3487269535061511064" onmouseenter="enter('3487269535061511064');" onmouseout="out('3487269535061511064');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 485             System.out.println(&quot;-------build temporary query-----------&quot;);                               </span>
<span class="-8101867096626384734" onmouseenter="enter('-8101867096626384734');" onmouseout="out('-8101867096626384734');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 486             System.out.println(tmpSelectSql);                                                            </span>
<span class="-4281832807373115174" onmouseenter="enter('-4281832807373115174');" onmouseout="out('-4281832807373115174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 487             System.out.println(&quot;---------------------------------------&quot;);                               </span>
<span class="-1580407524319062305" onmouseenter="enter('-1580407524319062305');" onmouseout="out('-1580407524319062305');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 488         }catch (Exception e){                                                                            </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 489             e.printStackTrace();                                                                         </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 490             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 491         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 492     }                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 493 =======                                                                                                  </span>
<span class="-2402394227701825991" onmouseenter="enter('-2402394227701825991');" onmouseout="out('-2402394227701825991');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 494 private void extractTemporaryQuery(SqlNode node, String tableAlias, SqlBasicCall parentWhere,            </span>
<span class="1575560997126003034" onmouseenter="enter('1575560997126003034');" onmouseout="out('1575560997126003034');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 495                                        SqlNodeList parentSelectList, Queue&lt;Object&gt; queueInfo,            </span>
<span class="221219844685559650" onmouseenter="enter('221219844685559650');" onmouseout="out('221219844685559650');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 496                                        Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,                         </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 497                                        Map&lt;String, String&gt; tableRef){                                    </span>
<span class="-1891643383856272179" onmouseenter="enter('-1891643383856272179');" onmouseout="out('-1891643383856272179');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 498         try{                                                                                             </span>
<span class="-8973252823595593319" onmouseenter="enter('-8973252823595593319');" onmouseout="out('-8973252823595593319');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 499             //父一级的where 条件中如果只和临时查询相关的条件都截取进来                                                            </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 500             Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                            </span>
<span class="-1162190359921159801" onmouseenter="enter('-1162190359921159801');" onmouseout="out('-1162190359921159801');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 501             List&lt;SqlBasicCall&gt; extractCondition = Lists.newArrayList();                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 502                                                                                                          </span>
<span class="8110456237367799034" onmouseenter="enter('8110456237367799034');" onmouseout="out('8110456237367799034');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 503             TableUtils.getFromTableInfo(node, fromTableNameSet);                                         </span>
<span class="6022466615463989785" onmouseenter="enter('6022466615463989785');" onmouseout="out('6022466615463989785');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 504             checkAndRemoveWhereCondition(fromTableNameSet, parentWhere, extractCondition);               </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 505                                                                                                          </span>
<span class="8695778948204515419" onmouseenter="enter('8695778948204515419');" onmouseout="out('8695778948204515419');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 506             if(node.getKind() == JOIN){                                                                  </span>
<span class="-6199554136531935919" onmouseenter="enter('-6199554136531935919');" onmouseout="out('-6199554136531935919');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 507                 checkAndReplaceJoinCondition(((SqlJoin)node).getCondition(), tableRef);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 508             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 509                                                                                                          </span>
<span class="5747231761832639727" onmouseenter="enter('5747231761832639727');" onmouseout="out('5747231761832639727');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 510             Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tableRef);"> 510             Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tabl🔵</abbr></span>
<span class="1865200144735135853" onmouseenter="enter('1865200144735135853');" onmouseout="out('1865200144735135853');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 511             Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableNameSet);"> 511             Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTa🔵</abbr></span>
<span class="-3053698166334827106" onmouseenter="enter('-3053698166334827106');" onmouseout="out('-3053698166334827106');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 512             String extractSelectFieldStr = buildSelectNode(extractSelectField, fieldFromJoinCondition);  </span>
<span class="-3122368802496797506" onmouseenter="enter('-3122368802496797506');" onmouseout="out('-3122368802496797506');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 513             String extractConditionStr = buildCondition(extractCondition);                               </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 514                                                                                                          </span>
<span class="6190023554533569746" onmouseenter="enter('6190023554533569746');" onmouseout="out('6190023554533569746');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 515             String tmpSelectSql = String.format(SELECT_TEMP_SQL,                                         </span>
<span class="3430988890108370699" onmouseenter="enter('3430988890108370699');" onmouseout="out('3430988890108370699');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516                     extractSelectFieldStr,                                                               </span>
<span class="-1169517675965244531" onmouseenter="enter('-1169517675965244531');" onmouseout="out('-1169517675965244531');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 517                     node.toString(),                                                                     </span>
<span class="4099345839703116685" onmouseenter="enter('4099345839703116685');" onmouseout="out('4099345839703116685');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518                     extractConditionStr);                                                                </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 519                                                                                                          </span>
<span class="-3319042643252387519" onmouseenter="enter('-3319042643252387519');" onmouseout="out('-3319042643252387519');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 520             SqlParser sqlParser = SqlParser.create(tmpSelectSql, CalciteConfig.MYSQL_LEX_CONFIG);        </span>
<span class="-1853454348884693240" onmouseenter="enter('-1853454348884693240');" onmouseout="out('-1853454348884693240');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 521             SqlNode sqlNode = sqlParser.parseStmt();                                                     </span>
<span class="-2735890898778643076" onmouseenter="enter('-2735890898778643076');" onmouseout="out('-2735890898778643076');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 522             SqlBasicCall sqlBasicCall = buildAsSqlNode(tableAlias, sqlNode);                             </span>
<span class="2417854506040223841" onmouseenter="enter('2417854506040223841');" onmouseout="out('2417854506040223841');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 523             queueInfo.offer(sqlBasicCall);                                                               </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 524                                                                                                          </span>
<span class="3812477662204349545" onmouseenter="enter('3812477662204349545');" onmouseout="out('3812477662204349545');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 525             Log.info(&quot;-------build temporary query-----------\n{}&quot;, tmpSelectSql);                       </span>
<span class="3847699124612806472" onmouseenter="enter('3847699124612806472');" onmouseout="out('3847699124612806472');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 526             Log.info(&quot;---------------------------------------&quot;);                                         </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 527         } catch (Exception e) {                                                                          </span>
<span class="-9144524576168127827" onmouseenter="enter('-9144524576168127827');" onmouseout="out('-9144524576168127827');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 528             Log.error(&quot;&quot;, e);                                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 529             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 530         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 531     }                                                                                                    </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 532 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style=""> 533                                                                                                          </span>
<span  style=""> 534                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 535     /**                                                                                                  </span>
<span class="-4499840608975407423" onmouseenter="enter('-4499840608975407423');" onmouseout="out('-4499840608975407423');" style=""> 536      * 抽取上层需用使用到的字段                                                                                      </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style=""> 537      * @param parentSelectList                                                                           </span>
<span class="-6365101737408851156" onmouseenter="enter('-6365101737408851156');" onmouseout="out('-6365101737408851156');" style=""> 538      * @param fromTableNameSet                                                                           </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 539      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 540      */                                                                                                  </span>
<span class="-1410253319795430175" onmouseenter="enter('-1410253319795430175');" onmouseout="out('-1410253319795430175');" style=""> 541     private Set&lt;String&gt; extractSelectFields(SqlNodeList parentSelectList,                                </span>
<span class="8604782440088857459" onmouseenter="enter('8604782440088857459');" onmouseout="out('8604782440088857459');" style=""> 542                                             Set&lt;String&gt; fromTableNameSet,                                </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style=""> 543                                             Map&lt;String, String&gt; tableRef){                               </span>
<span class="-4673362671275703253" onmouseenter="enter('-4673362671275703253');" onmouseout="out('-4673362671275703253');" style=""> 544         Set&lt;String&gt; extractFieldList = Sets.newHashSet();                                                </span>
<span class="-7414180011567654896" onmouseenter="enter('-7414180011567654896');" onmouseout="out('-7414180011567654896');" style=""> 545         for(SqlNode selectNode : parentSelectList.getList()){                                            </span>
<span class="1095915068729564148" onmouseenter="enter('1095915068729564148');" onmouseout="out('1095915068729564148');" style=""> 546             extractSelectField(selectNode, extractFieldList, fromTableNameSet, tableRef);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 547         }                                                                                                </span>
<span  style=""> 548                                                                                                          </span>
<span class="-1685101767459189568" onmouseenter="enter('-1685101767459189568');" onmouseout="out('-1685101767459189568');" style=""> 549         return extractFieldList;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 550     }                                                                                                    </span>
<span  style=""> 551                                                                                                          </span>
<span class="-3136237770377012352" onmouseenter="enter('-3136237770377012352');" onmouseout="out('-3136237770377012352');" style=""> 552     private Set&lt;String&gt; extractSelectFieldFromJoinCondition(Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,    </span>
<span class="8604782440088857459" onmouseenter="enter('8604782440088857459');" onmouseout="out('8604782440088857459');" style=""> 553                                                             Set&lt;String&gt; fromTableNameSet,                </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style=""> 554                                                             Map&lt;String, String&gt; tableRef){               </span>
<span class="-4673362671275703253" onmouseenter="enter('-4673362671275703253');" onmouseout="out('-4673362671275703253');" style=""> 555         Set&lt;String&gt; extractFieldList = Sets.newHashSet();                                                </span>
<span class="8833203050470988767" onmouseenter="enter('8833203050470988767');" onmouseout="out('8833203050470988767');" style=""> 556         for(Tuple2&lt;String, String&gt; field : joinFieldSet){                                                </span>
<span class="-9037397631967971194" onmouseenter="enter('-9037397631967971194');" onmouseout="out('-9037397631967971194');" style=""> 557             if(fromTableNameSet.contains(field.f0)){                                                     </span>
<span class="-4436761311933817361" onmouseenter="enter('-4436761311933817361');" onmouseout="out('-4436761311933817361');" style=""> 558                 extractFieldList.add(field.f0 + &quot;.&quot; + field.f1);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 559             }                                                                                            </span>
<span  style=""> 560                                                                                                          </span>
<span class="2270060537250938832" onmouseenter="enter('2270060537250938832');" onmouseout="out('2270060537250938832');" style=""> 561             if(tableRef.containsKey(field.f0)){                                                          </span>
<span class="-6432265866814515577" onmouseenter="enter('-6432265866814515577');" onmouseout="out('-6432265866814515577');" style=""> 562                 if(fromTableNameSet.contains(tableRef.get(field.f0))){                                   </span>
<span class="-616240499130861538" onmouseenter="enter('-616240499130861538');" onmouseout="out('-616240499130861538');" style=""> 563                     extractFieldList.add(tableRef.get(field.f0) + &quot;.&quot; + field.f1);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 564                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 565             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 566         }                                                                                                </span>
<span  style=""> 567                                                                                                          </span>
<span class="-1685101767459189568" onmouseenter="enter('-1685101767459189568');" onmouseout="out('-1685101767459189568');" style=""> 568         return extractFieldList;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 569     }                                                                                                    </span>
<span  style=""> 570                                                                                                          </span>
<span class="-6744450936821609200" onmouseenter="enter('-6744450936821609200');" onmouseout="out('-6744450936821609200');" style=""> 571     private Set&lt;String&gt; extractFieldFromGroupByList(SqlNodeList parentGroupByList,                       </span>
<span class="8604782440088857459" onmouseenter="enter('8604782440088857459');" onmouseout="out('8604782440088857459');" style=""> 572                                                     Set&lt;String&gt; fromTableNameSet,                        </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style=""> 573                                                     Map&lt;String, String&gt; tableRef){                       </span>
<span  style=""> 574                                                                                                          </span>
<span class="-1817314657182986777" onmouseenter="enter('-1817314657182986777');" onmouseout="out('-1817314657182986777');" style=""> 575         if(parentGroupByList == null){                                                                   </span>
<span class="7586937643893917515" onmouseenter="enter('7586937643893917515');" onmouseout="out('7586937643893917515');" style=""> 576             return Sets.newHashSet();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 577         }                                                                                                </span>
<span  style=""> 578                                                                                                          </span>
<span class="-4673362671275703253" onmouseenter="enter('-4673362671275703253');" onmouseout="out('-4673362671275703253');" style=""> 579         Set&lt;String&gt; extractFieldList = Sets.newHashSet();                                                </span>
<span class="7263955957768279526" onmouseenter="enter('7263955957768279526');" onmouseout="out('7263955957768279526');" style=""> 580         for(SqlNode selectNode : parentGroupByList.getList()){                                           </span>
<span class="1095915068729564148" onmouseenter="enter('1095915068729564148');" onmouseout="out('1095915068729564148');" style=""> 581             extractSelectField(selectNode, extractFieldList, fromTableNameSet, tableRef);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 582         }                                                                                                </span>
<span  style=""> 583                                                                                                          </span>
<span class="-1685101767459189568" onmouseenter="enter('-1685101767459189568');" onmouseout="out('-1685101767459189568');" style=""> 584         return extractFieldList;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 585     }                                                                                                    </span>
<span  style=""> 586                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 587     /**                                                                                                  </span>
<span class="-672438967754228662" onmouseenter="enter('-672438967754228662');" onmouseout="out('-672438967754228662');" style=""> 588      * 从join的条件中获取字段信息                                                                                   </span>
<span class="-4160812560585701802" onmouseenter="enter('-4160812560585701802');" onmouseout="out('-4160812560585701802');" style=""> 589      * @param condition                                                                                  </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style=""> 590      * @param joinFieldSet                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 591      */                                                                                                  </span>
<span class="1552352851009209412" onmouseenter="enter('1552352851009209412');" onmouseout="out('1552352851009209412');" style=""> 592     private void extractJoinField(SqlNode condition, Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet){          </span>
<span class="5716706160133851170" onmouseenter="enter('5716706160133851170');" onmouseout="out('5716706160133851170');" style=""> 593         if (null == condition || condition.getKind() == LITERAL) {                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 594             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 595         }                                                                                                </span>
<span  style=""> 596                                                                                                          </span>
<span class="5418896256960850645" onmouseenter="enter('5418896256960850645');" onmouseout="out('5418896256960850645');" style=""> 597         SqlKind joinKind = condition.getKind();                                                          </span>
<span class="6904180996725590590" onmouseenter="enter('6904180996725590590');" onmouseout="out('6904180996725590590');" style=""> 598         if( joinKind == AND || joinKind == EQUALS ){                                                     </span>
<span class="5740954560868172997" onmouseenter="enter('5740954560868172997');" onmouseout="out('5740954560868172997');" style=""> 599             extractJoinField(((SqlBasicCall)condition).operands[0], joinFieldSet);                       </span>
<span class="-450517509397156355" onmouseenter="enter('-450517509397156355');" onmouseout="out('-450517509397156355');" style=""> 600             extractJoinField(((SqlBasicCall)condition).operands[1], joinFieldSet);                       </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 601         }else{                                                                                           </span>
<span class="3421902236901684905" onmouseenter="enter('3421902236901684905');" onmouseout="out('3421902236901684905');" style=""><abbr title=" 602             Preconditions.checkState(((SqlIdentifier)condition).names.size() == 2, &quot;join condition must be format table.field&quot;);"> 602             Preconditions.checkState(((SqlIdentifier)condition).names.size() == 2, &quot;join condition must b🔵</abbr></span>
<span class="6389924414477169388" onmouseenter="enter('6389924414477169388');" onmouseout="out('6389924414477169388');" style=""><abbr title=" 603             Tuple2&lt;String, String&gt; tuple2 = Tuple2.of(((SqlIdentifier)condition).names.get(0), ((SqlIdentifier)condition).names.get(1));"> 603             Tuple2&lt;String, String&gt; tuple2 = Tuple2.of(((SqlIdentifier)condition).names.get(0), ((SqlIdent🔵</abbr></span>
<span class="-8031023747394340843" onmouseenter="enter('-8031023747394340843');" onmouseout="out('-8031023747394340843');" style=""> 604             joinFieldSet.add(tuple2);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 605         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 606     }                                                                                                    </span>
<span  style=""> 607                                                                                                          </span>
<span  style=""> 608                                                                                                          </span>
<span class="-6450965667049352633" onmouseenter="enter('-6450965667049352633');" onmouseout="out('-6450965667049352633');" style=""> 609     private void extractSelectField(SqlNode selectNode,                                                  </span>
<span class="4215167182352113360" onmouseenter="enter('4215167182352113360');" onmouseout="out('4215167182352113360');" style=""> 610                                     Set&lt;String&gt; extractFieldSet,                                         </span>
<span class="8604782440088857459" onmouseenter="enter('8604782440088857459');" onmouseout="out('8604782440088857459');" style=""> 611                                     Set&lt;String&gt; fromTableNameSet,                                        </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style=""> 612                                     Map&lt;String, String&gt; tableRef){                                       </span>
<span class="8103739576060170768" onmouseenter="enter('8103739576060170768');" onmouseout="out('8103739576060170768');" style=""> 613         if (selectNode.getKind() == AS) {                                                                </span>
<span class="1510889832473438632" onmouseenter="enter('1510889832473438632');" onmouseout="out('1510889832473438632');" style=""> 614             SqlNode leftNode = ((SqlBasicCall) selectNode).getOperands()[0];                             </span>
<span class="-3569930423065034136" onmouseenter="enter('-3569930423065034136');" onmouseout="out('-3569930423065034136');" style=""> 615             extractSelectField(leftNode, extractFieldSet, fromTableNameSet, tableRef);                   </span>
<span  style=""> 616                                                                                                          </span>
<span class="-8354265102451448120" onmouseenter="enter('-8354265102451448120');" onmouseout="out('-8354265102451448120');" style=""> 617         }else if(selectNode.getKind() == IDENTIFIER) {                                                   </span>
<span class="-3732912994311321816" onmouseenter="enter('-3732912994311321816');" onmouseout="out('-3732912994311321816');" style=""> 618             SqlIdentifier sqlIdentifier = (SqlIdentifier) selectNode;                                    </span>
<span  style=""> 619                                                                                                          </span>
<span class="2651178788475624428" onmouseenter="enter('2651178788475624428');" onmouseout="out('2651178788475624428');" style=""> 620             if(sqlIdentifier.names.size() == 1){                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 621                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 622             }                                                                                            </span>
<span  style=""> 623                                                                                                          </span>
<span class="3965609827388612088" onmouseenter="enter('3965609827388612088');" onmouseout="out('3965609827388612088');" style=""> 624             String tableName = sqlIdentifier.names.get(0);                                               </span>
<span class="5468885380070811563" onmouseenter="enter('5468885380070811563');" onmouseout="out('5468885380070811563');" style=""> 625             //TODO                                                                                       </span>
<span class="3096268752058072981" onmouseenter="enter('3096268752058072981');" onmouseout="out('3096268752058072981');" style=""> 626             if(fromTableNameSet.contains(tableName)){                                                    </span>
<span class="-4452600673359758385" onmouseenter="enter('-4452600673359758385');" onmouseout="out('-4452600673359758385');" style=""> 627                 extractFieldSet.add(sqlIdentifier.toString());                                           </span>
<span class="1142707085951947184" onmouseenter="enter('1142707085951947184');" onmouseout="out('1142707085951947184');" style=""> 628             } else if(fromTableNameSet.contains(tableRef.get(tableName))){                               </span>
<span class="5574286290036421401" onmouseenter="enter('5574286290036421401');" onmouseout="out('5574286290036421401');" style=""> 629                 //TODO extractFieldSet.add(sqlIdentifier.setName(0, tableRef.get(tableName)).toString());</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 630             }                                                                                            </span>
<span  style=""> 631                                                                                                          </span>
<span class="7025405726449532045" onmouseenter="enter('7025405726449532045');" onmouseout="out('7025405726449532045');" style=""> 632         }else if(  AGGREGATE.contains(selectNode.getKind())                                              </span>
<span class="-6933542481251357306" onmouseenter="enter('-6933542481251357306');" onmouseout="out('-6933542481251357306');" style=""> 633                 || AVG_AGG_FUNCTIONS.contains(selectNode.getKind())                                      </span>
<span class="-2120439329066417772" onmouseenter="enter('-2120439329066417772');" onmouseout="out('-2120439329066417772');" style=""> 634                 || COMPARISON.contains(selectNode.getKind())                                             </span>
<span class="6729191807379931332" onmouseenter="enter('6729191807379931332');" onmouseout="out('6729191807379931332');" style=""> 635                 || selectNode.getKind() == OTHER_FUNCTION                                                </span>
<span class="-790540336783787818" onmouseenter="enter('-790540336783787818');" onmouseout="out('-790540336783787818');" style=""> 636                 || selectNode.getKind() == DIVIDE                                                        </span>
<span class="8042439450870069301" onmouseenter="enter('8042439450870069301');" onmouseout="out('8042439450870069301');" style=""> 637                 || selectNode.getKind() == CAST                                                          </span>
<span class="8131430949670321542" onmouseenter="enter('8131430949670321542');" onmouseout="out('8131430949670321542');" style=""> 638                 || selectNode.getKind() == TRIM                                                          </span>
<span class="7539044465271514325" onmouseenter="enter('7539044465271514325');" onmouseout="out('7539044465271514325');" style=""> 639                 || selectNode.getKind() == TIMES                                                         </span>
<span class="5017875227939513377" onmouseenter="enter('5017875227939513377');" onmouseout="out('5017875227939513377');" style=""> 640                 || selectNode.getKind() == PLUS                                                          </span>
<span class="-8896687143784188803" onmouseenter="enter('-8896687143784188803');" onmouseout="out('-8896687143784188803');" style=""> 641                 || selectNode.getKind() == NOT_IN                                                        </span>
<span class="-1863732027976694038" onmouseenter="enter('-1863732027976694038');" onmouseout="out('-1863732027976694038');" style=""> 642                 || selectNode.getKind() == OR                                                            </span>
<span class="6505261652610820896" onmouseenter="enter('6505261652610820896');" onmouseout="out('6505261652610820896');" style=""> 643                 || selectNode.getKind() == AND                                                           </span>
<span class="8098904506676885196" onmouseenter="enter('8098904506676885196');" onmouseout="out('8098904506676885196');" style=""> 644                 || selectNode.getKind() == MINUS                                                         </span>
<span class="-157153081163608557" onmouseenter="enter('-157153081163608557');" onmouseout="out('-157153081163608557');" style=""> 645                 || selectNode.getKind() == TUMBLE                                                        </span>
<span class="-2839638964097736537" onmouseenter="enter('-2839638964097736537');" onmouseout="out('-2839638964097736537');" style=""> 646                 || selectNode.getKind() == TUMBLE_START                                                  </span>
<span class="6482577849437391011" onmouseenter="enter('6482577849437391011');" onmouseout="out('6482577849437391011');" style=""> 647                 || selectNode.getKind() == TUMBLE_END                                                    </span>
<span class="6880276476651207951" onmouseenter="enter('6880276476651207951');" onmouseout="out('6880276476651207951');" style=""> 648                 || selectNode.getKind() == SESSION                                                       </span>
<span class="-5893490809135961202" onmouseenter="enter('-5893490809135961202');" onmouseout="out('-5893490809135961202');" style=""> 649                 || selectNode.getKind() == SESSION_START                                                 </span>
<span class="-1646114820326763405" onmouseenter="enter('-1646114820326763405');" onmouseout="out('-1646114820326763405');" style=""> 650                 || selectNode.getKind() == SESSION_END                                                   </span>
<span class="268793040563115559" onmouseenter="enter('268793040563115559');" onmouseout="out('268793040563115559');" style=""> 651                 || selectNode.getKind() == HOP                                                           </span>
<span class="5104117061177388693" onmouseenter="enter('5104117061177388693');" onmouseout="out('5104117061177388693');" style=""> 652                 || selectNode.getKind() == HOP_START                                                     </span>
<span class="8235260830665848207" onmouseenter="enter('8235260830665848207');" onmouseout="out('8235260830665848207');" style=""> 653                 || selectNode.getKind() == HOP_END                                                       </span>
<span class="-3943236427179035086" onmouseenter="enter('-3943236427179035086');" onmouseout="out('-3943236427179035086');" style=""> 654                 || selectNode.getKind() == BETWEEN                                                       </span>
<span class="-4981553052649867721" onmouseenter="enter('-4981553052649867721');" onmouseout="out('-4981553052649867721');" style=""> 655                 || selectNode.getKind() == IS_NULL                                                       </span>
<span class="2062318608323297657" onmouseenter="enter('2062318608323297657');" onmouseout="out('2062318608323297657');" style=""> 656                 || selectNode.getKind() == IS_NOT_NULL                                                   </span>
<span class="-5717204280699012051" onmouseenter="enter('-5717204280699012051');" onmouseout="out('-5717204280699012051');" style=""> 657                 || selectNode.getKind() == CONTAINS                                                      </span>
<span class="-4225388998654687854" onmouseenter="enter('-4225388998654687854');" onmouseout="out('-4225388998654687854');" style=""> 658                 || selectNode.getKind() == TIMESTAMP_ADD                                                 </span>
<span class="-1992782825152874013" onmouseenter="enter('-1992782825152874013');" onmouseout="out('-1992782825152874013');" style=""> 659                 || selectNode.getKind() == TIMESTAMP_DIFF                                                </span>
<span class="-1380076266281630813" onmouseenter="enter('-1380076266281630813');" onmouseout="out('-1380076266281630813');" style=""> 660                 || selectNode.getKind() == LIKE                                                          </span>
<span  style=""> 661                                                                                                          </span>
<span class="1769062068492699725" onmouseenter="enter('1769062068492699725');" onmouseout="out('1769062068492699725');" style=""> 662         ){                                                                                               </span>
<span class="7946305415555164516" onmouseenter="enter('7946305415555164516');" onmouseout="out('7946305415555164516');" style=""> 663             SqlBasicCall sqlBasicCall = (SqlBasicCall) selectNode;                                       </span>
<span class="-6221234471722277998" onmouseenter="enter('-6221234471722277998');" onmouseout="out('-6221234471722277998');" style=""> 664             for(int i=0; i&lt;sqlBasicCall.getOperands().length; i++){                                      </span>
<span class="-6831609595517394087" onmouseenter="enter('-6831609595517394087');" onmouseout="out('-6831609595517394087');" style=""> 665                 SqlNode sqlNode = sqlBasicCall.getOperands()[i];                                         </span>
<span class="92437031510630357" onmouseenter="enter('92437031510630357');" onmouseout="out('92437031510630357');" style=""> 666                 if(sqlNode instanceof SqlLiteral){                                                       </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 667                     continue;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 668                 }                                                                                        </span>
<span  style=""> 669                                                                                                          </span>
<span class="-7655129146813432779" onmouseenter="enter('-7655129146813432779');" onmouseout="out('-7655129146813432779');" style=""> 670                 if(sqlNode instanceof SqlDataTypeSpec){                                                  </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 671                     continue;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 672                 }                                                                                        </span>
<span  style=""> 673                                                                                                          </span>
<span class="30158307191940159" onmouseenter="enter('30158307191940159');" onmouseout="out('30158307191940159');" style=""> 674                 extractSelectField(sqlNode, extractFieldSet, fromTableNameSet, tableRef);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 675             }                                                                                            </span>
<span  style=""> 676                                                                                                          </span>
<span class="2155507952934750451" onmouseenter="enter('2155507952934750451');" onmouseout="out('2155507952934750451');" style=""> 677         }else if(selectNode.getKind() == CASE){                                                          </span>
<span class="-1390336112814264886" onmouseenter="enter('-1390336112814264886');" onmouseout="out('-1390336112814264886');" style=""> 678             SqlCase sqlCase = (SqlCase) selectNode;                                                      </span>
<span class="-3655271460728510010" onmouseenter="enter('-3655271460728510010');" onmouseout="out('-3655271460728510010');" style=""> 679             SqlNodeList whenOperands = sqlCase.getWhenOperands();                                        </span>
<span class="8318973293639639494" onmouseenter="enter('8318973293639639494');" onmouseout="out('8318973293639639494');" style=""> 680             SqlNodeList thenOperands = sqlCase.getThenOperands();                                        </span>
<span class="3014895614462197568" onmouseenter="enter('3014895614462197568');" onmouseout="out('3014895614462197568');" style=""> 681             SqlNode elseNode = sqlCase.getElseOperand();                                                 </span>
<span  style=""> 682                                                                                                          </span>
<span class="6346785150356032184" onmouseenter="enter('6346785150356032184');" onmouseout="out('6346785150356032184');" style=""> 683             for(int i=0; i&lt;whenOperands.size(); i++){                                                    </span>
<span class="1734344807386881213" onmouseenter="enter('1734344807386881213');" onmouseout="out('1734344807386881213');" style=""> 684                 SqlNode oneOperand = whenOperands.get(i);                                                </span>
<span class="1407654974389323920" onmouseenter="enter('1407654974389323920');" onmouseout="out('1407654974389323920');" style=""> 685                 extractSelectField(oneOperand, extractFieldSet, fromTableNameSet, tableRef);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 686             }                                                                                            </span>
<span  style=""> 687                                                                                                          </span>
<span class="-8902171898794493922" onmouseenter="enter('-8902171898794493922');" onmouseout="out('-8902171898794493922');" style=""> 688             for(int i=0; i&lt;thenOperands.size(); i++){                                                    </span>
<span class="-3989978989358262134" onmouseenter="enter('-3989978989358262134');" onmouseout="out('-3989978989358262134');" style=""> 689                 SqlNode oneOperand = thenOperands.get(i);                                                </span>
<span class="1407654974389323920" onmouseenter="enter('1407654974389323920');" onmouseout="out('1407654974389323920');" style=""> 690                 extractSelectField(oneOperand, extractFieldSet, fromTableNameSet, tableRef);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 691             }                                                                                            </span>
<span  style=""> 692                                                                                                          </span>
<span class="-1225911656205055173" onmouseenter="enter('-1225911656205055173');" onmouseout="out('-1225911656205055173');" style=""> 693             extractSelectField(elseNode, extractFieldSet, fromTableNameSet, tableRef);                   </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 694         }else {                                                                                          </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 695             //do nothing                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 696         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 697     }                                                                                                    </span>
<span  style=""> 698                                                                                                          </span>
<span  style=""> 699                                                                                                          </span>
<span class="-1906922116491244459" onmouseenter="enter('-1906922116491244459');" onmouseout="out('-1906922116491244459');" style=""><abbr title=" 700     private Tuple2&lt;String, String&gt; parseRightNode(SqlNode sqlNode, Set&lt;String&gt; sideTableSet, Queue&lt;Object&gt; queueInfo,"> 700     private Tuple2&lt;String, String&gt; parseRightNode(SqlNode sqlNode, Set&lt;String&gt; sideTableSet, Queue&lt;Object🔵</abbr></span>
<span class="-1049021514946482534" onmouseenter="enter('-1049021514946482534');" onmouseout="out('-1049021514946482534');" style=""><abbr title=" 701                                                   SqlNode parentWhere, SqlNodeList selectList, SqlNodeList parentGroupByList) {"> 701                                                   SqlNode parentWhere, SqlNodeList selectList, SqlNodeLis🔵</abbr></span>
<span class="-7809629950828083535" onmouseenter="enter('-7809629950828083535');" onmouseout="out('-7809629950828083535');" style=""> 702         Tuple2&lt;String, String&gt; tabName = new Tuple2&lt;&gt;(&quot;&quot;, &quot;&quot;);                                           </span>
<span class="7570038518439211250" onmouseenter="enter('7570038518439211250');" onmouseout="out('7570038518439211250');" style=""> 703         if(sqlNode.getKind() == IDENTIFIER){                                                             </span>
<span class="-7735158387636601028" onmouseenter="enter('-7735158387636601028');" onmouseout="out('-7735158387636601028');" style=""> 704             tabName.f0 = sqlNode.toString();                                                             </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 705         }else{                                                                                           </span>
<span class="7364690097624267595" onmouseenter="enter('7364690097624267595');" onmouseout="out('7364690097624267595');" style=""><abbr title=" 706             AliasInfo aliasInfo = (AliasInfo)sideSQLParser.parseSql(sqlNode, sideTableSet, queueInfo, parentWhere, selectList, parentGroupByList);"> 706             AliasInfo aliasInfo = (AliasInfo)sideSQLParser.parseSql(sqlNode, sideTableSet, queueInfo, par🔵</abbr></span>
<span class="-7052196639543907068" onmouseenter="enter('-7052196639543907068');" onmouseout="out('-7052196639543907068');" style=""> 707             tabName.f0 = aliasInfo.getName();                                                            </span>
<span class="-2307032070137542057" onmouseenter="enter('-2307032070137542057');" onmouseout="out('-2307032070137542057');" style=""> 708             tabName.f1 = aliasInfo.getAlias();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 709         }                                                                                                </span>
<span class="-6789109484485831180" onmouseenter="enter('-6789109484485831180');" onmouseout="out('-6789109484485831180');" style=""> 710         return tabName;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 711     }                                                                                                    </span>
<span  style=""> 712                                                                                                          </span>
<span class="1768499303484569694" onmouseenter="enter('1768499303484569694');" onmouseout="out('1768499303484569694');" style=""> 713     private Tuple2&lt;String, String&gt; parseLeftNode(SqlNode sqlNode){                                       </span>
<span class="-7809629950828083535" onmouseenter="enter('-7809629950828083535');" onmouseout="out('-7809629950828083535');" style=""> 714         Tuple2&lt;String, String&gt; tabName = new Tuple2&lt;&gt;(&quot;&quot;, &quot;&quot;);                                           </span>
<span class="7570038518439211250" onmouseenter="enter('7570038518439211250');" onmouseout="out('7570038518439211250');" style=""> 715         if(sqlNode.getKind() == IDENTIFIER){                                                             </span>
<span class="-7735158387636601028" onmouseenter="enter('-7735158387636601028');" onmouseout="out('-7735158387636601028');" style=""> 716             tabName.f0 = sqlNode.toString();                                                             </span>
<span class="-6648818000206782174" onmouseenter="enter('-6648818000206782174');" onmouseout="out('-6648818000206782174');" style=""> 717             tabName.f1 = sqlNode.toString();                                                             </span>
<span class="7640894634328871584" onmouseenter="enter('7640894634328871584');" onmouseout="out('7640894634328871584');" style=""> 718         }else if (sqlNode.getKind() == AS){                                                              </span>
<span class="-4085054753182131209" onmouseenter="enter('-4085054753182131209');" onmouseout="out('-4085054753182131209');" style=""> 719             SqlNode info = ((SqlBasicCall)sqlNode).getOperands()[0];                                     </span>
<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style=""> 720             SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                                   </span>
<span  style=""> 721                                                                                                          </span>
<span class="6350181014025417708" onmouseenter="enter('6350181014025417708');" onmouseout="out('6350181014025417708');" style=""> 722             tabName.f0 = info.toString();                                                                </span>
<span class="-6499418961284910074" onmouseenter="enter('-6499418961284910074');" onmouseout="out('-6499418961284910074');" style=""> 723             tabName.f1 = alias.toString();                                                               </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 724         }else {                                                                                          </span>
<span class="-4528765899368294479" onmouseenter="enter('-4528765899368294479');" onmouseout="out('-4528765899368294479');" style=""> 725             throw new RuntimeException(&quot;&quot;);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 726         }                                                                                                </span>
<span  style=""> 727                                                                                                          </span>
<span class="-6789109484485831180" onmouseenter="enter('-6789109484485831180');" onmouseout="out('-6789109484485831180');" style=""> 728         return tabName;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 729     }                                                                                                    </span>
<span  style=""> 730                                                                                                          </span>
<span class="2221421009159751305" onmouseenter="enter('2221421009159751305');" onmouseout="out('2221421009159751305');" style=""> 731     public String buildCondition(List&lt;SqlBasicCall&gt; conditionList){                                      </span>
<span class="-4757924659479519527" onmouseenter="enter('-4757924659479519527');" onmouseout="out('-4757924659479519527');" style=""> 732         if(CollectionUtils.isEmpty(conditionList)){                                                      </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 733             return &quot;&quot;;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 734         }                                                                                                </span>
<span  style=""> 735                                                                                                          </span>
<span class="-8689756052096276488" onmouseenter="enter('-8689756052096276488');" onmouseout="out('-8689756052096276488');" style=""> 736         return &quot; where &quot; + StringUtils.join(conditionList, &quot; AND &quot;);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 737     }                                                                                                    </span>
<span  style=""> 738                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 739     /**                                                                                                  </span>
<span class="5006751944576812925" onmouseenter="enter('5006751944576812925');" onmouseout="out('5006751944576812925');" style=""> 740      * 构建抽取表的查询字段信息                                                                                      </span>
<span class="6846485922393067420" onmouseenter="enter('6846485922393067420');" onmouseout="out('6846485922393067420');" style=""> 741      * 包括去除重复字段，名称相同的取别名                                                                                 </span>
<span class="5143638493602795740" onmouseenter="enter('5143638493602795740');" onmouseout="out('5143638493602795740');" style=""> 742      * @param extractSelectField                                                                         </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style=""> 743      * @param joinFieldSet                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 744      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 745      */                                                                                                  </span>
<span class="3285722409292673394" onmouseenter="enter('3285722409292673394');" onmouseout="out('3285722409292673394');" style=""> 746     public Set&lt;String&gt; buildSelectNode(Set&lt;String&gt; extractSelectField, Set&lt;String&gt; joinFieldSet){        </span>
<span class="2785520985351844766" onmouseenter="enter('2785520985351844766');" onmouseout="out('2785520985351844766');" style=""> 747         if(CollectionUtils.isEmpty(extractSelectField)){                                                 </span>
<span class="5868864582051651172" onmouseenter="enter('5868864582051651172');" onmouseout="out('5868864582051651172');" style=""> 748             throw new RuntimeException(&quot;no field is used&quot;);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 749         }                                                                                                </span>
<span  style=""> 750                                                                                                          </span>
<span class="5899553187345814636" onmouseenter="enter('5899553187345814636');" onmouseout="out('5899553187345814636');" style=""> 751         Sets.SetView&lt;String&gt; view = Sets.union(extractSelectField, joinFieldSet);                        </span>
<span class="797241606485232847" onmouseenter="enter('797241606485232847');" onmouseout="out('797241606485232847');" style=""> 752         Set&lt;String&gt; newFieldSet = Sets.newHashSet();                                                     </span>
<span class="2745035293344511362" onmouseenter="enter('2745035293344511362');" onmouseout="out('2745035293344511362');" style=""> 753         //为相同的列取别名                                                                                       </span>
<span class="8688032100713956589" onmouseenter="enter('8688032100713956589');" onmouseout="out('8688032100713956589');" style=""> 754         HashBiMap&lt;String, String&gt; refFieldMap = HashBiMap.create();                                      </span>
<span class="1329112150316943640" onmouseenter="enter('1329112150316943640');" onmouseout="out('1329112150316943640');" style=""> 755         for(String field : view){                                                                        </span>
<span class="-1968894175389259310" onmouseenter="enter('-1968894175389259310');" onmouseout="out('-1968894175389259310');" style=""> 756             String[] fieldInfo = StringUtils.split(field, &#x27;.&#x27;);                                          </span>
<span class="-8742203946899533370" onmouseenter="enter('-8742203946899533370');" onmouseout="out('-8742203946899533370');" style=""> 757             String aliasName = fieldInfo[1];                                                             </span>
<span class="5196316369925853718" onmouseenter="enter('5196316369925853718');" onmouseout="out('5196316369925853718');" style=""> 758             StringBuilder stringBuilder = new StringBuilder();                                           </span>
<span class="7892052963016733083" onmouseenter="enter('7892052963016733083');" onmouseout="out('7892052963016733083');" style=""> 759             stringBuilder.append(field);                                                                 </span>
<span class="4929718891791635894" onmouseenter="enter('4929718891791635894');" onmouseout="out('4929718891791635894');" style=""> 760             if(refFieldMap.inverse().get(aliasName) != null){                                            </span>
<span class="3911751569834415230" onmouseenter="enter('3911751569834415230');" onmouseout="out('3911751569834415230');" style=""> 761                 aliasName = ParseUtils.dealDuplicateFieldName(refFieldMap, aliasName);                   </span>
<span class="-7772471183494378441" onmouseenter="enter('-7772471183494378441');" onmouseout="out('-7772471183494378441');" style=""> 762                 stringBuilder.append(&quot; as &quot;)                                                             </span>
<span class="-6698804491367054275" onmouseenter="enter('-6698804491367054275');" onmouseout="out('-6698804491367054275');" style=""> 763                         .append(aliasName);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 764             }                                                                                            </span>
<span  style=""> 765                                                                                                          </span>
<span class="3161846128983396458" onmouseenter="enter('3161846128983396458');" onmouseout="out('3161846128983396458');" style=""> 766             refFieldMap.put(field, aliasName);                                                           </span>
<span  style=""> 767                                                                                                          </span>
<span class="1307446912208510489" onmouseenter="enter('1307446912208510489');" onmouseout="out('1307446912208510489');" style=""> 768             newFieldSet.add(stringBuilder.toString());                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 769         }                                                                                                </span>
<span  style=""> 770                                                                                                          </span>
<span class="-4429217721906814107" onmouseenter="enter('-4429217721906814107');" onmouseout="out('-4429217721906814107');" style=""> 771         return newFieldSet;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 772     }                                                                                                    </span>
<span  style=""> 773                                                                                                          </span>
<span class="4243587240101238542" onmouseenter="enter('4243587240101238542');" onmouseout="out('4243587240101238542');" style=""> 774     private boolean checkIsSideTable(String tableName, Set&lt;String&gt; sideTableList){                       </span>
<span class="7734723301291741274" onmouseenter="enter('7734723301291741274');" onmouseout="out('7734723301291741274');" style=""> 775         if(sideTableList.contains(tableName)){                                                           </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 776             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 777         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 778         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 779     }                                                                                                    </span>
<span  style=""> 780                                                                                                          </span>
<span class="-8109971872323514495" onmouseenter="enter('-8109971872323514495');" onmouseout="out('-8109971872323514495');" style=""> 781     private SqlBasicCall buildAsSqlNode(String internalTableName, SqlNode newSource) {                   </span>
<span class="2981236818393294037" onmouseenter="enter('2981236818393294037');" onmouseout="out('2981236818393294037');" style=""> 782         SqlOperator operator = new SqlAsOperator();                                                      </span>
<span class="-1667801166019875282" onmouseenter="enter('-1667801166019875282');" onmouseout="out('-1667801166019875282');" style=""> 783         SqlParserPos sqlParserPos = new SqlParserPos(0, 0);                                              </span>
<span class="8198536898736028280" onmouseenter="enter('8198536898736028280');" onmouseout="out('8198536898736028280');" style=""> 784         SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(internalTableName, null, sqlParserPos);     </span>
<span class="-7310412248425019303" onmouseenter="enter('-7310412248425019303');" onmouseout="out('-7310412248425019303');" style=""> 785         SqlNode[] sqlNodes = new SqlNode[2];                                                             </span>
<span class="2025970151619105195" onmouseenter="enter('2025970151619105195');" onmouseout="out('2025970151619105195');" style=""> 786         sqlNodes[0] = newSource;                                                                         </span>
<span class="-4093556188235461327" onmouseenter="enter('-4093556188235461327');" onmouseout="out('-4093556188235461327');" style=""> 787         sqlNodes[1] = sqlIdentifierAlias;                                                                </span>
<span class="-1928364106966605511" onmouseenter="enter('-1928364106966605511');" onmouseout="out('-1928364106966605511');" style=""> 788         return new SqlBasicCall(operator, sqlNodes, sqlParserPos);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 789     }                                                                                                    </span>
<span  style=""> 790                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 791     /**                                                                                                  </span>
<span class="-7510152128791177313" onmouseenter="enter('-7510152128791177313');" onmouseout="out('-7510152128791177313');" style=""> 792      * 获取where中和指定表有关联的字段                                                                                </span>
<span class="-6365101737408851156" onmouseenter="enter('-6365101737408851156');" onmouseout="out('-6365101737408851156');" style=""> 793      * @param fromTableNameSet                                                                           </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 794      * @param parentWhere                                                                                </span>
<span class="-2506765310601959421" onmouseenter="enter('-2506765310601959421');" onmouseout="out('-2506765310601959421');" style=""> 795      * @param extractCondition                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 796      */                                                                                                  </span>
<span class="1461432174075439627" onmouseenter="enter('1461432174075439627');" onmouseout="out('1461432174075439627');" style=""><abbr title=" 797     private void extractWhereCondition(Set&lt;String&gt; fromTableNameSet, SqlBasicCall parentWhere, Set&lt;String&gt; extractCondition){"> 797     private void extractWhereCondition(Set&lt;String&gt; fromTableNameSet, SqlBasicCall parentWhere, Set&lt;String🔵</abbr></span>
<span  style=""> 798                                                                                                          </span>
<span class="-7344361739038630250" onmouseenter="enter('-7344361739038630250');" onmouseout="out('-7344361739038630250');" style=""> 799         if(parentWhere == null){                                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 800             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 801         }                                                                                                </span>
<span  style=""> 802                                                                                                          </span>
<span class="7198030462908925381" onmouseenter="enter('7198030462908925381');" onmouseout="out('7198030462908925381');" style=""> 803         SqlKind kind = parentWhere.getKind();                                                            </span>
<span class="-1872623569752802183" onmouseenter="enter('-1872623569752802183');" onmouseout="out('-1872623569752802183');" style=""> 804         if(kind == AND){                                                                                 </span>
<span class="-4193978700874903441" onmouseenter="enter('-4193978700874903441');" onmouseout="out('-4193978700874903441');" style=""><abbr title=" 805             extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[0], extractCondition);"> 805             extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[0], extractC🔵</abbr></span>
<span class="8237513597398016508" onmouseenter="enter('8237513597398016508');" onmouseout="out('8237513597398016508');" style=""><abbr title=" 806             extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[1], extractCondition);"> 806             extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[1], extractC🔵</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 807         } else {                                                                                         </span>
<span  style=""> 808                                                                                                          </span>
<span class="6559819810856557747" onmouseenter="enter('6559819810856557747');" onmouseout="out('6559819810856557747');" style=""> 809             Set&lt;String&gt; fieldInfos = Sets.newHashSet();                                                  </span>
<span class="-8171369927933096656" onmouseenter="enter('-8171369927933096656');" onmouseout="out('-8171369927933096656');" style=""> 810             TableUtils.getConditionRefTable(parentWhere, fieldInfos);                                    </span>
<span class="-4461527983639478234" onmouseenter="enter('-4461527983639478234');" onmouseout="out('-4461527983639478234');" style=""> 811             fieldInfos.forEach(fieldInfo -&gt; {                                                            </span>
<span class="4976250547552714974" onmouseenter="enter('4976250547552714974');" onmouseout="out('4976250547552714974');" style=""> 812                 String[] splitInfo = StringUtils.split(fieldInfo, &quot;.&quot;);                                  </span>
<span class="-9163656437830109655" onmouseenter="enter('-9163656437830109655');" onmouseout="out('-9163656437830109655');" style=""> 813                 if(splitInfo.length == 2 &amp;&amp; fromTableNameSet.contains(splitInfo[0])){                    </span>
<span class="7162103078043141858" onmouseenter="enter('7162103078043141858');" onmouseout="out('7162103078043141858');" style=""> 814                     extractCondition.add(fieldInfo);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 815                 }                                                                                        </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 816             });                                                                                          </span>
<span  style=""> 817                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 818         }                                                                                                </span>
<span  style=""> 819                                                                                                          </span>
<span  style=""> 820                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 821     }                                                                                                    </span>
<span  style=""> 822                                                                                                          </span>
<span  style=""> 823                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 824     /**                                                                                                  </span>
<span class="-74598125528384596" onmouseenter="enter('-74598125528384596');" onmouseout="out('-74598125528384596');" style=""> 825      * 检查关联的where 条件中的判断是否可以下移到新构建的子查询                                                                   </span>
<span class="-6365101737408851156" onmouseenter="enter('-6365101737408851156');" onmouseout="out('-6365101737408851156');" style=""> 826      * @param fromTableNameSet                                                                           </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 827      * @param parentWhere                                                                                </span>
<span class="-2506765310601959421" onmouseenter="enter('-2506765310601959421');" onmouseout="out('-2506765310601959421');" style=""> 828      * @param extractCondition                                                                           </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 829      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 830      */                                                                                                  </span>
<span class="-3374362155096196822" onmouseenter="enter('-3374362155096196822');" onmouseout="out('-3374362155096196822');" style=""> 831     private boolean checkAndRemoveWhereCondition(Set&lt;String&gt; fromTableNameSet,                           </span>
<span class="1711245815305911921" onmouseenter="enter('1711245815305911921');" onmouseout="out('1711245815305911921');" style=""> 832                                                  SqlBasicCall parentWhere,                               </span>
<span class="-6744704019370069554" onmouseenter="enter('-6744704019370069554');" onmouseout="out('-6744704019370069554');" style=""> 833                                                  List&lt;SqlBasicCall&gt; extractCondition){                   </span>
<span class="-7344361739038630250" onmouseenter="enter('-7344361739038630250');" onmouseout="out('-7344361739038630250');" style=""> 834         if(parentWhere == null){                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 835             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 836         }                                                                                                </span>
<span  style=""> 837                                                                                                          </span>
<span class="7198030462908925381" onmouseenter="enter('7198030462908925381');" onmouseout="out('7198030462908925381');" style=""> 838         SqlKind kind = parentWhere.getKind();                                                            </span>
<span class="-1872623569752802183" onmouseenter="enter('-1872623569752802183');" onmouseout="out('-1872623569752802183');" style=""> 839         if(kind == AND){                                                                                 </span>
<span class="-8510136866484254033" onmouseenter="enter('-8510136866484254033');" onmouseout="out('-8510136866484254033');" style=""><abbr title=" 840             boolean removeLeft = checkAndRemoveWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[0], extractCondition);"> 840             boolean removeLeft = checkAndRemoveWhereCondition(fromTableNameSet, (SqlBasicCall) parentWher🔵</abbr></span>
<span class="-2929912762198310557" onmouseenter="enter('-2929912762198310557');" onmouseout="out('-2929912762198310557');" style=""><abbr title=" 841             boolean removeRight = checkAndRemoveWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[1], extractCondition);"> 841             boolean removeRight = checkAndRemoveWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhe🔵</abbr></span>
<span class="891835357289668161" onmouseenter="enter('891835357289668161');" onmouseout="out('891835357289668161');" style=""> 842             //DO remove                                                                                  </span>
<span class="1439443091018833301" onmouseenter="enter('1439443091018833301');" onmouseout="out('1439443091018833301');" style=""> 843             if(removeLeft){                                                                              </span>
<span class="5619021625980792664" onmouseenter="enter('5619021625980792664');" onmouseout="out('5619021625980792664');" style=""> 844                 extractCondition.add(removeWhereConditionNode(parentWhere, 0));                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 845             }                                                                                            </span>
<span  style=""> 846                                                                                                          </span>
<span class="6778546312639684033" onmouseenter="enter('6778546312639684033');" onmouseout="out('6778546312639684033');" style=""> 847             if(removeRight){                                                                             </span>
<span class="-3233327769126268813" onmouseenter="enter('-3233327769126268813');" onmouseout="out('-3233327769126268813');" style=""> 848                 extractCondition.add(removeWhereConditionNode(parentWhere, 1));                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 849             }                                                                                            </span>
<span  style=""> 850                                                                                                          </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 851             return false;                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 852         } else {                                                                                         </span>
<span class="-5890893362753249434" onmouseenter="enter('-5890893362753249434');" onmouseout="out('-5890893362753249434');" style=""> 853             //条件表达式，如果该条件关联的表都是指定的表则移除                                                                   </span>
<span class="6559819810856557747" onmouseenter="enter('6559819810856557747');" onmouseout="out('6559819810856557747');" style=""> 854             Set&lt;String&gt; fieldInfos = Sets.newHashSet();                                                  </span>
<span class="-8171369927933096656" onmouseenter="enter('-8171369927933096656');" onmouseout="out('-8171369927933096656');" style=""> 855             TableUtils.getConditionRefTable(parentWhere, fieldInfos);                                    </span>
<span class="2827886728692945898" onmouseenter="enter('2827886728692945898');" onmouseout="out('2827886728692945898');" style=""> 856             Set&lt;String&gt; conditionRefTableNameSet = Sets.newHashSet();                                    </span>
<span  style=""> 857                                                                                                          </span>
<span class="-4461527983639478234" onmouseenter="enter('-4461527983639478234');" onmouseout="out('-4461527983639478234');" style=""> 858             fieldInfos.forEach(fieldInfo -&gt; {                                                            </span>
<span class="4976250547552714974" onmouseenter="enter('4976250547552714974');" onmouseout="out('4976250547552714974');" style=""> 859                 String[] splitInfo = StringUtils.split(fieldInfo, &quot;.&quot;);                                  </span>
<span class="-504061461178926812" onmouseenter="enter('-504061461178926812');" onmouseout="out('-504061461178926812');" style=""> 860                 if(splitInfo.length == 2){                                                               </span>
<span class="-1599449602125672029" onmouseenter="enter('-1599449602125672029');" onmouseout="out('-1599449602125672029');" style=""> 861                     conditionRefTableNameSet.add(splitInfo[0]);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 862                 }                                                                                        </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 863             });                                                                                          </span>
<span  style=""> 864                                                                                                          </span>
<span  style=""> 865                                                                                                          </span>
<span class="1299203886922461523" onmouseenter="enter('1299203886922461523');" onmouseout="out('1299203886922461523');" style=""> 866             if(fromTableNameSet.containsAll(conditionRefTableNameSet)){                                  </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 867                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 868             }                                                                                            </span>
<span  style=""> 869                                                                                                          </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 870             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 871         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 872     }                                                                                                    </span>
<span  style=""> 873                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 874     /**                                                                                                  </span>
<span class="967733528902221289" onmouseenter="enter('967733528902221289');" onmouseout="out('967733528902221289');" style=""> 875      * 抽取where 条件中指定的条件                                                                                  </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 876      * @param parentWhere                                                                                </span>
<span class="-460759719067432320" onmouseenter="enter('-460759719067432320');" onmouseout="out('-460759719067432320');" style=""> 877      * @param index                                                                                      </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 878      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 879      */                                                                                                  </span>
<span class="-8004122385362241836" onmouseenter="enter('-8004122385362241836');" onmouseout="out('-8004122385362241836');" style=""> 880     public SqlBasicCall removeWhereConditionNode(SqlBasicCall parentWhere, int index){                   </span>
<span class="2911889278610374450" onmouseenter="enter('2911889278610374450');" onmouseout="out('2911889278610374450');" style=""> 881         SqlBasicCall oldCondition = (SqlBasicCall) parentWhere.getOperands()[index];                     </span>
<span class="3156064786234930120" onmouseenter="enter('3156064786234930120');" onmouseout="out('3156064786234930120');" style=""> 882         parentWhere.setOperand(index, buildEmptyCondition());                                            </span>
<span class="-6343538087515378636" onmouseenter="enter('-6343538087515378636');" onmouseout="out('-6343538087515378636');" style=""> 883         return oldCondition;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 884     }                                                                                                    </span>
<span  style=""> 885                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 886     /**                                                                                                  </span>
<span class="-6739953174199833520" onmouseenter="enter('-6739953174199833520');" onmouseout="out('-6739953174199833520');" style=""> 887      * 构建 1=1的 where 条件                                                                                  </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 888      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 889      */                                                                                                  </span>
<span class="-4073514796854358980" onmouseenter="enter('-4073514796854358980');" onmouseout="out('-4073514796854358980');" style=""> 890     public SqlBasicCall buildEmptyCondition(){                                                           </span>
<span class="7737073508893451149" onmouseenter="enter('7737073508893451149');" onmouseout="out('7737073508893451149');" style=""> 891         SqlBinaryOperator equalsOperators = SqlStdOperatorTable.EQUALS;                                  </span>
<span class="-6629769419150459383" onmouseenter="enter('-6629769419150459383');" onmouseout="out('-6629769419150459383');" style=""> 892         SqlNode[] operands = new SqlNode[2];                                                             </span>
<span class="7829210030518325331" onmouseenter="enter('7829210030518325331');" onmouseout="out('7829210030518325331');" style=""> 893         operands[0] = SqlLiteral.createExactNumeric(&quot;1&quot;, SqlParserPos.ZERO);                             </span>
<span class="8653141241037221613" onmouseenter="enter('8653141241037221613');" onmouseout="out('8653141241037221613');" style=""> 894         operands[1] = SqlLiteral.createExactNumeric(&quot;1&quot;, SqlParserPos.ZERO);                             </span>
<span  style=""> 895                                                                                                          </span>
<span class="-886608164186614965" onmouseenter="enter('-886608164186614965');" onmouseout="out('-886608164186614965');" style=""> 896         return new SqlBasicCall(equalsOperators, operands, SqlParserPos.ZERO);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 897     }                                                                                                    </span>
<span  style=""> 898                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 899     /**                                                                                                  </span>
<span class="6566659164166093473" onmouseenter="enter('6566659164166093473');" onmouseout="out('6566659164166093473');" style=""> 900      * 替换join 条件中的表名称                                                                                    </span>
<span class="384197096128287152" onmouseenter="enter('384197096128287152');" onmouseout="out('384197096128287152');" style=""> 901      * @param node                                                                                       </span>
<span class="1832696003310156507" onmouseenter="enter('1832696003310156507');" onmouseout="out('1832696003310156507');" style=""> 902      * @param tableMap 表名的关联关系                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 903      */                                                                                                  </span>
<span class="8926761967375059586" onmouseenter="enter('8926761967375059586');" onmouseout="out('8926761967375059586');" style=""> 904     private SqlIdentifier checkAndReplaceJoinCondition(SqlNode node, Map&lt;String, String&gt; tableMap){      </span>
<span  style=""> 905                                                                                                          </span>
<span class="-4460996797142447051" onmouseenter="enter('-4460996797142447051');" onmouseout="out('-4460996797142447051');" style=""> 906         SqlKind joinKind = node.getKind();                                                               </span>
<span class="6904180996725590590" onmouseenter="enter('6904180996725590590');" onmouseout="out('6904180996725590590');" style=""> 907         if( joinKind == AND || joinKind == EQUALS ){                                                     </span>
<span class="-5502960919920628784" onmouseenter="enter('-5502960919920628784');" onmouseout="out('-5502960919920628784');" style=""><abbr title=" 908             SqlIdentifier leftNode = checkAndReplaceJoinCondition(((SqlBasicCall)node).operands[0], tableMap);"> 908             SqlIdentifier leftNode = checkAndReplaceJoinCondition(((SqlBasicCall)node).operands[0], table🔵</abbr></span>
<span class="-1134508213250580541" onmouseenter="enter('-1134508213250580541');" onmouseout="out('-1134508213250580541');" style=""><abbr title=" 909             SqlIdentifier rightNode = checkAndReplaceJoinCondition(((SqlBasicCall)node).operands[1], tableMap);"> 909             SqlIdentifier rightNode = checkAndReplaceJoinCondition(((SqlBasicCall)node).operands[1], tabl🔵</abbr></span>
<span  style=""> 910                                                                                                          </span>
<span class="1261032046064330806" onmouseenter="enter('1261032046064330806');" onmouseout="out('1261032046064330806');" style=""> 911             if(leftNode != null){                                                                        </span>
<span class="7925883472313959466" onmouseenter="enter('7925883472313959466');" onmouseout="out('7925883472313959466');" style=""> 912                 ((SqlBasicCall)node).setOperand(0, leftNode);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 913             }                                                                                            </span>
<span  style=""> 914                                                                                                          </span>
<span class="-5287428749677694788" onmouseenter="enter('-5287428749677694788');" onmouseout="out('-5287428749677694788');" style=""> 915             if(rightNode != null){                                                                       </span>
<span class="-6758558001428237557" onmouseenter="enter('-6758558001428237557');" onmouseout="out('-6758558001428237557');" style=""> 916                 ((SqlBasicCall)node).setOperand(1, leftNode);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 917             }                                                                                            </span>
<span  style=""> 918                                                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 919             return null;                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 920         } else {                                                                                         </span>
<span class="2603254540286226339" onmouseenter="enter('2603254540286226339');" onmouseout="out('2603254540286226339');" style=""> 921             //replace table                                                                              </span>
<span class="-7283729608735687376" onmouseenter="enter('-7283729608735687376');" onmouseout="out('-7283729608735687376');" style=""><abbr title=" 922             Preconditions.checkState(((SqlIdentifier)node).names.size() == 2, &quot;join condition must be format table.field&quot;);"> 922             Preconditions.checkState(((SqlIdentifier)node).names.size() == 2, &quot;join condition must be for🔵</abbr></span>
<span class="5830077366186139259" onmouseenter="enter('5830077366186139259');" onmouseout="out('5830077366186139259');" style=""> 923             String tbName = ((SqlIdentifier) node).names.get(0);                                         </span>
<span class="807909526670811479" onmouseenter="enter('807909526670811479');" onmouseout="out('807909526670811479');" style=""> 924             if(tableMap.containsKey(tbName)){                                                            </span>
<span class="-5261902895497527633" onmouseenter="enter('-5261902895497527633');" onmouseout="out('-5261902895497527633');" style=""> 925                 tbName = tableMap.get(tbName);                                                           </span>
<span class="6671350446806430567" onmouseenter="enter('6671350446806430567');" onmouseout="out('6671350446806430567');" style=""> 926                 return ((SqlIdentifier) node).setName(0, tbName);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 927             }                                                                                            </span>
<span  style=""> 928                                                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 929             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 930         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 931     }                                                                                                    </span>
<span  style=""> 932                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 933     /**                                                                                                  </span>
<span class="-582093827946699422" onmouseenter="enter('-582093827946699422');" onmouseout="out('-582093827946699422');" style=""> 934      * 解析出临时中间表的属性列和源表之间的关系                                                                              </span>
<span class="-1738998936074699450" onmouseenter="enter('-1738998936074699450');" onmouseout="out('-1738998936074699450');" style=""> 935      * @param fieldSet                                                                                   </span>
<span class="-1251790622416547945" onmouseenter="enter('-1251790622416547945');" onmouseout="out('-1251790622416547945');" style=""> 936      * @param newTableAliasName                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 937      */                                                                                                  </span>
<span class="-8784345461796351735" onmouseenter="enter('-8784345461796351735');" onmouseout="out('-8784345461796351735');" style=""><abbr title=" 938     public Map&lt;String, String&gt; buildTmpTableFieldRefOriField(Set&lt;String&gt; fieldSet, String newTableAliasName){"> 938     public Map&lt;String, String&gt; buildTmpTableFieldRefOriField(Set&lt;String&gt; fieldSet, String newTableAliasNa🔵</abbr></span>
<span class="-5385725062618077806" onmouseenter="enter('-5385725062618077806');" onmouseout="out('-5385725062618077806');" style=""> 939         Map&lt;String, String&gt; refInfo = Maps.newConcurrentMap();                                           </span>
<span class="2568903137449276094" onmouseenter="enter('2568903137449276094');" onmouseout="out('2568903137449276094');" style=""> 940         for(String field : fieldSet){                                                                    </span>
<span class="-7222334792573134755" onmouseenter="enter('-7222334792573134755');" onmouseout="out('-7222334792573134755');" style=""> 941             String[] fields = StringUtils.splitByWholeSeparator(field, &quot;as&quot;);                            </span>
<span class="2626056789923691030" onmouseenter="enter('2626056789923691030');" onmouseout="out('2626056789923691030');" style=""> 942             String oldKey = field;                                                                       </span>
<span class="-5195760423326791334" onmouseenter="enter('-5195760423326791334');" onmouseout="out('-5195760423326791334');" style=""> 943             String[] oldFieldInfo = StringUtils.splitByWholeSeparator(fields[0], &quot;.&quot;);                   </span>
<span class="7999505930284522125" onmouseenter="enter('7999505930284522125');" onmouseout="out('7999505930284522125');" style=""> 944             String oldFieldName = oldFieldInfo.length == 2 ? oldFieldInfo[1] : oldFieldInfo[0];          </span>
<span class="-6597088482986838827" onmouseenter="enter('-6597088482986838827');" onmouseout="out('-6597088482986838827');" style=""> 945             String newKey = fields.length == 2 ? newTableAliasName + &quot;.&quot; + fields[1] :                   </span>
<span class="-4119680836077812037" onmouseenter="enter('-4119680836077812037');" onmouseout="out('-4119680836077812037');" style=""> 946                     newTableAliasName + &quot;.&quot; + oldFieldName;                                              </span>
<span class="-3733750508357987129" onmouseenter="enter('-3733750508357987129');" onmouseout="out('-3733750508357987129');" style=""> 947             refInfo.put(oldKey, newKey);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 948         }                                                                                                </span>
<span  style=""> 949                                                                                                          </span>
<span class="8147181196901690092" onmouseenter="enter('8147181196901690092');" onmouseout="out('8147181196901690092');" style=""> 950         return refInfo;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 951     }                                                                                                    </span>
<span  style=""> 952                                                                                                          </span>
<span  style=""> 953                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 954 }                                                                                                        </span>












































































































</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  18 package com.dtstack.flink.sql.side;                                                                      </span>
<span  style="">  19                                                                                                          </span>
<span class="-283888887417937620" onmouseenter="enter('-283888887417937620');" onmouseout="out('-283888887417937620');" style="">  20 import com.dtstack.flink.sql.parser.FlinkPlanner;                                                        </span>
<span class="-4585055968129153397" onmouseenter="enter('-4585055968129153397');" onmouseout="out('-4585055968129153397');" style="">  21 import com.dtstack.flink.sql.util.ParseUtils;                                                            </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  22 import com.dtstack.flink.sql.util.TableUtils;                                                            </span>
<span class="-1945462796058520247" onmouseenter="enter('-1945462796058520247');" onmouseout="out('-1945462796058520247');" style="">  23 import com.esotericsoftware.minlog.Log;                                                                  </span>
<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  24 import com.google.common.base.Preconditions;                                                             </span>
<span class="1793459060364841943" onmouseenter="enter('1793459060364841943');" onmouseout="out('1793459060364841943');" style="">  25 import com.google.common.collect.*;                                                                      </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  26 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  27 import java.util.Map;                                                                                    </span>
<span class="-2789246819365843415" onmouseenter="enter('-2789246819365843415');" onmouseout="out('-2789246819365843415');" style="">  28 import java.util.Queue;                                                                                  </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  29 import java.util.Set;                                                                                    </span>
<span class="8584998077480306668" onmouseenter="enter('8584998077480306668');" onmouseout="out('8584998077480306668');" style="">  30 import org.apache.calcite.sql.JoinType;                                                                  </span>
<span class="-6347312057640942811" onmouseenter="enter('-6347312057640942811');" onmouseout="out('-6347312057640942811');" style="">  31 import org.apache.calcite.sql.SqlAsOperator;                                                             </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  32 import org.apache.calcite.sql.SqlBasicCall;                                                              </span>
<span class="5864552825243215550" onmouseenter="enter('5864552825243215550');" onmouseout="out('5864552825243215550');" style="">  33 import org.apache.calcite.sql.SqlBinaryOperator;                                                         </span>
<span class="166699767162158130" onmouseenter="enter('166699767162158130');" onmouseout="out('166699767162158130');" style="">  34 import org.apache.calcite.sql.SqlDataTypeSpec;                                                           </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  35 import org.apache.calcite.sql.SqlIdentifier;                                                             </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  36 import org.apache.calcite.sql.SqlJoin;                                                                   </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  37 import org.apache.calcite.sql.SqlKind;                                                                   </span>
<span class="8852969977988754364" onmouseenter="enter('8852969977988754364');" onmouseout="out('8852969977988754364');" style="">  38 import org.apache.calcite.sql.SqlLiteral;                                                                </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  39 import org.apache.calcite.sql.SqlNode;                                                                   </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  40 import org.apache.calcite.sql.SqlNodeList;                                                               </span>
<span class="2919518510870551176" onmouseenter="enter('2919518510870551176');" onmouseout="out('2919518510870551176');" style="">  41 import org.apache.calcite.sql.SqlOperator;                                                               </span>
<span class="7522331514027736252" onmouseenter="enter('7522331514027736252');" onmouseout="out('7522331514027736252');" style="">  42 import org.apache.calcite.sql.fun.SqlCase;                                                               </span>
<span class="5604125466397600003" onmouseenter="enter('5604125466397600003');" onmouseout="out('5604125466397600003');" style="">  43 import org.apache.calcite.sql.fun.SqlStdOperatorTable;                                                   </span>
<span class="-8475519504744506507" onmouseenter="enter('-8475519504744506507');" onmouseout="out('-8475519504744506507');" style="">  44 import org.apache.calcite.sql.parser.SqlParserPos;                                                       </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  45 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  46 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  47 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="-3548577539000853351" onmouseenter="enter('-3548577539000853351');" onmouseout="out('-3548577539000853351');" style="">  48 import org.apache.flink.table.calcite.FlinkPlannerImpl;                                                  </span>
<span class="7147213704442467623" onmouseenter="enter('7147213704442467623');" onmouseout="out('7147213704442467623');" style="">  49 import static org.apache.calcite.sql.SqlKind.*;                                                          </span>
<span  style="">  50                                                                                                          </span>
<span  style="">  51                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  52 /**                                                                                                      </span>
<span class="-4563013574845795077" onmouseenter="enter('-4563013574845795077');" onmouseout="out('-4563013574845795077');" style="">  53  * 处理join 节点                                                                                             </span>
<span class="8838344550496049683" onmouseenter="enter('8838344550496049683');" onmouseout="out('8838344550496049683');" style="">  54  * 1:如果包含维表节点替换为临时查询                                                                                     </span>
<span class="-7758652626234959796" onmouseenter="enter('-7758652626234959796');" onmouseout="out('-7758652626234959796');" style="">  55  * Date: 2020/2/27                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  56  * Company: www.dtstack.com                                                                              </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  57  * @author xuchao                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  58  */                                                                                                      </span>
<span class="-8466270758182619990" onmouseenter="enter('-8466270758182619990');" onmouseout="out('-8466270758182619990');" style="">  59 public class JoinNodeDealer {                                                                            </span>
<span class="8212789117715876957" onmouseenter="enter('8212789117715876957');" onmouseout="out('8212789117715876957');" style="">  60     //用来构建临时的中间查询                                                                                        </span>
<span class="8212789117715876957" onmouseenter="enter('8212789117715876957');" onmouseout="out('8212789117715876957');" style="">  61     //用来构建临时的中间查询                                                                                        </span>
<span class="7730461828310962384" onmouseenter="enter('7730461828310962384');" onmouseout="out('7730461828310962384');" style="">  62     private static final String SELECT_TEMP_SQL = &quot;select %s from %s %s&quot;;                                </span>
<span  style="">  63                                                                                                          </span>
<span class="-2249026806703256771" onmouseenter="enter('-2249026806703256771');" onmouseout="out('-2249026806703256771');" style="">  64     private SideSQLParser sideSQLParser;                                                                 </span>
<span  style="">  65                                                                                                          </span>
<span class="-5685721022216923679" onmouseenter="enter('-5685721022216923679');" onmouseout="out('-5685721022216923679');" style="">  66     public JoinNodeDealer(SideSQLParser sideSQLParser) {                                                 </span>
<span class="1661690928916125634" onmouseenter="enter('1661690928916125634');" onmouseout="out('1661690928916125634');" style="">  67         this.sideSQLParser = sideSQLParser;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  68     }                                                                                                    </span>
<span  style="">  69                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  70     /**                                                                                                  </span>
<span class="5343191871470402950" onmouseenter="enter('5343191871470402950');" onmouseout="out('5343191871470402950');" style="">  71      * 解析 join 操作                                                                                        </span>
<span class="-2995351136134268537" onmouseenter="enter('-2995351136134268537');" onmouseout="out('-2995351136134268537');" style="">  72      * @param joinNode                                                                                   </span>
<span class="4073180356368850460" onmouseenter="enter('4073180356368850460');" onmouseout="out('4073180356368850460');" style="">  73      * @param sideTableSet 标明哪些表名是维表                                                                     </span>
<span class="3894561521416724418" onmouseenter="enter('3894561521416724418');" onmouseout="out('3894561521416724418');" style="">  74      * @param queueInfo                                                                                  </span>
<span class="-789269741895746259" onmouseenter="enter('-789269741895746259');" onmouseout="out('-789269741895746259');" style="">  75      * @param parentWhere join 关联的最上层的where 节点                                                           </span>
<span class="2915402449338812450" onmouseenter="enter('2915402449338812450');" onmouseout="out('2915402449338812450');" style="">  76      * @param parentSelectList join 关联的最上层的select 节点                                                     </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style="">  77      * @param joinFieldSet                                                                               </span>
<span class="6609942655811766869" onmouseenter="enter('6609942655811766869');" onmouseout="out('6609942655811766869');" style="">  78      * @param tableRef 存储构建临时表查询后源表和新表之间的关联关系                                                            </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="">  79      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  80      */                                                                                                  </span>
<span class="4445930941664835349" onmouseenter="enter('4445930941664835349');" onmouseout="out('4445930941664835349');" style=""><abbr title="  81     public JoinInfo dealJoinNode(SqlJoin joinNode, Set&lt;String&gt; sideTableSet, Queue&lt;Object&gt; queueInfo, SqlNode parentWhere, SqlNodeList parentSelectList, SqlNodeList parentGroupByList, Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet, Map&lt;String, String&gt; tableRef, Map&lt;String, String&gt; fieldRef) {">  81     public JoinInfo dealJoinNode(SqlJoin joinNode, Set&lt;String&gt; sideTableSet, Queue&lt;Object&gt; queueInfo, Sql🔵</abbr></span>
<span class="338082450955407251" onmouseenter="enter('338082450955407251');" onmouseout="out('338082450955407251');" style="">  82         SqlNode leftNode = joinNode.getLeft();                                                           </span>
<span class="6077141851454171925" onmouseenter="enter('6077141851454171925');" onmouseout="out('6077141851454171925');" style="">  83         SqlNode rightNode = joinNode.getRight();                                                         </span>
<span class="3771731584459985741" onmouseenter="enter('3771731584459985741');" onmouseout="out('3771731584459985741');" style="">  84         JoinType joinType = joinNode.getJoinType();                                                      </span>
<span class="1132914906015926398" onmouseenter="enter('1132914906015926398');" onmouseout="out('1132914906015926398');" style="">  85         String leftTbName = &quot;&quot;;                                                                          </span>
<span class="4210951459006369780" onmouseenter="enter('4210951459006369780');" onmouseout="out('4210951459006369780');" style="">  86         String leftTbAlias = &quot;&quot;;                                                                         </span>
<span class="8685549357368222156" onmouseenter="enter('8685549357368222156');" onmouseout="out('8685549357368222156');" style="">  87         String rightTableName = &quot;&quot;;                                                                      </span>
<span class="-3462848723088515190" onmouseenter="enter('-3462848723088515190');" onmouseout="out('-3462848723088515190');" style="">  88         String rightTableAlias = &quot;&quot;;                                                                     </span>
<span class="8157205433740328150" onmouseenter="enter('8157205433740328150');" onmouseout="out('8157205433740328150');" style="">  89         //抽取join中的的条件                                                                                    </span>
<span class="-2983428553847994428" onmouseenter="enter('-2983428553847994428');" onmouseout="out('-2983428553847994428');" style="">  90         extractJoinField(joinNode.getCondition(), joinFieldSet);                                         </span>
<span class="4311991652949423903" onmouseenter="enter('4311991652949423903');" onmouseout="out('4311991652949423903');" style="">  91         if (leftNode.getKind() == JOIN) {                                                                </span>
<span class="8741114231031705604" onmouseenter="enter('8741114231031705604');" onmouseout="out('8741114231031705604');" style="">  92             //处理连续join                                                                                   </span>
<span class="-4056174065334837690" onmouseenter="enter('-4056174065334837690');" onmouseout="out('-4056174065334837690');" style=""><abbr title="  93             dealNestJoin(joinNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, fieldRef);">  93             dealNestJoin(joinNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByL🔵</abbr></span>
<span class="-2038895670102717129" onmouseenter="enter('-2038895670102717129');" onmouseout="out('-2038895670102717129');" style="">  94             leftNode = joinNode.getLeft();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  95         }                                                                                                </span>
<span class="4487076072297445468" onmouseenter="enter('4487076072297445468');" onmouseout="out('4487076072297445468');" style="">  96         if (leftNode.getKind() == AS) {                                                                  </span>
<span class="8751074970453676502" onmouseenter="enter('8751074970453676502');" onmouseout="out('8751074970453676502');" style=""><abbr title="  97             AliasInfo aliasInfo = ((AliasInfo) (sideSQLParser.parseSql(leftNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList)));">  97             AliasInfo aliasInfo = ((AliasInfo) (sideSQLParser.parseSql(leftNode, sideTableSet, queueInfo,🔵</abbr></span>
<span class="-6271284546665811801" onmouseenter="enter('-6271284546665811801');" onmouseout="out('-6271284546665811801');" style="">  98             leftTbName = aliasInfo.getName();                                                            </span>
<span class="1754889631815621614" onmouseenter="enter('1754889631815621614');" onmouseout="out('1754889631815621614');" style="">  99             leftTbAlias = aliasInfo.getAlias();                                                          </span>
<span class="585029544233492066" onmouseenter="enter('585029544233492066');" onmouseout="out('585029544233492066');" style=""> 100         } else if (leftNode.getKind() == IDENTIFIER) {                                                   </span>
<span class="-2801204236324253727" onmouseenter="enter('-2801204236324253727');" onmouseout="out('-2801204236324253727');" style=""> 101             leftTbName = leftNode.toString();                                                            </span>
<span class="-1155513509208265617" onmouseenter="enter('-1155513509208265617');" onmouseout="out('-1155513509208265617');" style=""> 102             leftTbAlias = leftTbName;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103         }                                                                                                </span>
<span class="818500193985431170" onmouseenter="enter('818500193985431170');" onmouseout="out('818500193985431170');" style=""> 104         boolean leftIsSide = checkIsSideTable(leftTbName, sideTableSet);                                 </span>
<span class="3539880077969659090" onmouseenter="enter('3539880077969659090');" onmouseout="out('3539880077969659090');" style=""> 105         Preconditions.checkState(!leftIsSide, &quot;side-table must be at the right of join operator&quot;);       </span>
<span class="-1213513570275508110" onmouseenter="enter('-1213513570275508110');" onmouseout="out('-1213513570275508110');" style=""><abbr title=" 106         Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 106         Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo🔵</abbr></span>
<span class="-8717968456481913232" onmouseenter="enter('-8717968456481913232');" onmouseout="out('-8717968456481913232');" style=""> 107         rightTableName = rightTableNameAndAlias.f0;                                                      </span>
<span class="6344722288957274241" onmouseenter="enter('6344722288957274241');" onmouseout="out('6344722288957274241');" style=""> 108         rightTableAlias = rightTableNameAndAlias.f1;                                                     </span>
<span class="-2376755127467584795" onmouseenter="enter('-2376755127467584795');" onmouseout="out('-2376755127467584795');" style=""> 109         boolean rightIsSide = checkIsSideTable(rightTableName, sideTableSet);                            </span>
<span class="6187421419384184367" onmouseenter="enter('6187421419384184367');" onmouseout="out('6187421419384184367');" style=""> 110         if (rightIsSide &amp;&amp; (joinType == JoinType.RIGHT)) {                                               </span>
<span class="-8772090804951491249" onmouseenter="enter('-8772090804951491249');" onmouseout="out('-8772090804951491249');" style=""><abbr title=" 111             throw new RuntimeException(&quot;side join not support join type of right[current support inner join and left join]&quot;);"> 111             throw new RuntimeException(&quot;side join not support join type of right[current support inner jo🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112         }                                                                                                </span>
<span class="-6467047856281920672" onmouseenter="enter('-6467047856281920672');" onmouseout="out('-6467047856281920672');" style=""> 113         JoinInfo tableInfo = new JoinInfo();                                                             </span>
<span class="-3449973379283837894" onmouseenter="enter('-3449973379283837894');" onmouseout="out('-3449973379283837894');" style=""> 114         tableInfo.setLeftTableName(leftTbName);                                                          </span>
<span class="3986639763024215846" onmouseenter="enter('3986639763024215846');" onmouseout="out('3986639763024215846');" style=""> 115         tableInfo.setRightTableName(rightTableName);                                                     </span>
<span class="-7539521890985506540" onmouseenter="enter('-7539521890985506540');" onmouseout="out('-7539521890985506540');" style=""> 116         leftTbAlias = (StringUtils.isEmpty(leftTbAlias)) ? leftTbName : leftTbAlias;                     </span>
<span class="-7802871215196990932" onmouseenter="enter('-7802871215196990932');" onmouseout="out('-7802871215196990932');" style=""> 117         rightTableAlias = (StringUtils.isEmpty(rightTableAlias)) ? rightTableName : rightTableAlias;     </span>
<span class="846009662730869635" onmouseenter="enter('846009662730869635');" onmouseout="out('846009662730869635');" style=""> 118         tableInfo.setLeftTableAlias(leftTbAlias);                                                        </span>
<span class="4941698031257863857" onmouseenter="enter('4941698031257863857');" onmouseout="out('4941698031257863857');" style=""> 119         tableInfo.setRightTableAlias(rightTableAlias);                                                   </span>
<span class="-8645871838585664663" onmouseenter="enter('-8645871838585664663');" onmouseout="out('-8645871838585664663');" style=""> 120         tableInfo.setRightIsSideTable(rightIsSide);                                                      </span>
<span class="-1781974587467511895" onmouseenter="enter('-1781974587467511895');" onmouseout="out('-1781974587467511895');" style=""> 121         tableInfo.setLeftNode(leftNode);                                                                 </span>
<span class="-1730362975620128104" onmouseenter="enter('-1730362975620128104');" onmouseout="out('-1730362975620128104');" style=""> 122         tableInfo.setRightNode(rightNode);                                                               </span>
<span class="-6237310238590034687" onmouseenter="enter('-6237310238590034687');" onmouseout="out('-6237310238590034687');" style=""> 123         tableInfo.setJoinType(joinType);                                                                 </span>
<span class="-2724794810040782007" onmouseenter="enter('-2724794810040782007');" onmouseout="out('-2724794810040782007');" style=""> 124         tableInfo.setCondition(joinNode.getCondition());                                                 </span>
<span class="-6697941901007642600" onmouseenter="enter('-6697941901007642600');" onmouseout="out('-6697941901007642600');" style=""> 125         TableUtils.replaceJoinFieldRefTableName(joinNode.getCondition(), fieldRef);                      </span>
<span class="930681598926066970" onmouseenter="enter('930681598926066970');" onmouseout="out('930681598926066970');" style=""> 126         //extract 需要查询的字段信息                                                                              </span>
<span class="-5472632053620761059" onmouseenter="enter('-5472632053620761059');" onmouseout="out('-5472632053620761059');" style=""> 127         if (rightIsSide) {                                                                               </span>
<span class="4601009674852512506" onmouseenter="enter('4601009674852512506');" onmouseout="out('4601009674852512506');" style=""><abbr title=" 128             extractJoinNeedSelectField(leftNode, rightNode, parentWhere, parentSelectList, parentGroupByList, tableRef, joinFieldSet, fieldRef, tableInfo);"> 128             extractJoinNeedSelectField(leftNode, rightNode, parentWhere, parentSelectList, parentGroupByL🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 129         }                                                                                                </span>
<span class="-4931010238324656105" onmouseenter="enter('-4931010238324656105');" onmouseout="out('-4931010238324656105');" style=""> 130         if (tableInfo.getLeftNode().getKind() != AS) {                                                   </span>
<span class="-8283803146393095059" onmouseenter="enter('-8283803146393095059');" onmouseout="out('-8283803146393095059');" style=""> 131             return tableInfo;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132         }                                                                                                </span>
<span class="-274539703716878925" onmouseenter="enter('-274539703716878925');" onmouseout="out('-274539703716878925');" style=""> 133         SqlKind asNodeFirstKind = ((SqlBasicCall) (tableInfo.getLeftNode())).operands[0].getKind();      </span>
<span class="-21417070943013250" onmouseenter="enter('-21417070943013250');" onmouseout="out('-21417070943013250');" style=""> 134         if (asNodeFirstKind == SELECT) {                                                                 </span>
<span class="-6186943853001324725" onmouseenter="enter('-6186943853001324725');" onmouseout="out('-6186943853001324725');" style=""> 135             queueInfo.offer(tableInfo.getLeftNode());                                                    </span>
<span class="-2980886585066561388" onmouseenter="enter('-2980886585066561388');" onmouseout="out('-2980886585066561388');" style=""> 136             tableInfo.setLeftNode(((SqlBasicCall) (tableInfo.getLeftNode())).operands[1]);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137         }                                                                                                </span>
<span class="-8283803146393095059" onmouseenter="enter('-8283803146393095059');" onmouseout="out('-8283803146393095059');" style=""> 138         return tableInfo;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139     }                                                                                                    </span>
<span  style=""> 140                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 141     /**                                                                                                  </span>
<span class="-6526994496424246980" onmouseenter="enter('-6526994496424246980');" onmouseout="out('-6526994496424246980');" style=""> 142      * 获取join 之后需要查询的字段信息                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 143      */                                                                                                  </span>
<span class="-7128865978204525953" onmouseenter="enter('-7128865978204525953');" onmouseout="out('-7128865978204525953');" style=""><abbr title=" 144     public void extractJoinNeedSelectField(SqlNode leftNode, SqlNode rightNode, SqlNode parentWhere, SqlNodeList parentSelectList, SqlNodeList parentGroupByList, Map&lt;String, String&gt; tableRef, Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet, Map&lt;String, String&gt; fieldRef, JoinInfo tableInfo) {"> 144     public void extractJoinNeedSelectField(SqlNode leftNode, SqlNode rightNode, SqlNode parentWhere, SqlN🔵</abbr></span>
<span class="-1711591104588450781" onmouseenter="enter('-1711591104588450781');" onmouseout="out('-1711591104588450781');" style=""><abbr title=" 145         Set&lt;String&gt; extractSelectField = extractField(leftNode, parentWhere, parentSelectList, parentGroupByList, tableRef, joinFieldSet);"> 145         Set&lt;String&gt; extractSelectField = extractField(leftNode, parentWhere, parentSelectList, parentGrou🔵</abbr></span>
<span class="5798543527687218027" onmouseenter="enter('5798543527687218027');" onmouseout="out('5798543527687218027');" style=""><abbr title=" 146         Set&lt;String&gt; rightExtractSelectField = extractField(rightNode, parentWhere, parentSelectList, parentGroupByList, tableRef, joinFieldSet);"> 146         Set&lt;String&gt; rightExtractSelectField = extractField(rightNode, parentWhere, parentSelectList, pare🔵</abbr></span>
<span class="-401222402210116934" onmouseenter="enter('-401222402210116934');" onmouseout="out('-401222402210116934');" style=""> 147         // 重命名right 中和 left 重名的                                                                          </span>
<span class="7303277877915218137" onmouseenter="enter('7303277877915218137');" onmouseout="out('7303277877915218137');" style=""> 148         Map&lt;String, String&gt; leftTbSelectField = Maps.newHashMap();                                       </span>
<span class="-7917371932647768145" onmouseenter="enter('-7917371932647768145');" onmouseout="out('-7917371932647768145');" style=""> 149         Map&lt;String, String&gt; rightTbSelectField = Maps.newHashMap();                                      </span>
<span class="2809964139008068690" onmouseenter="enter('2809964139008068690');" onmouseout="out('2809964139008068690');" style=""> 150         String newTableName = tableInfo.getNewTableAlias();                                              </span>
<span class="-8576896688182910639" onmouseenter="enter('-8576896688182910639');" onmouseout="out('-8576896688182910639');" style=""> 151         for (String tmpField : extractSelectField) {                                                     </span>
<span class="-5672380782575278344" onmouseenter="enter('-5672380782575278344');" onmouseout="out('-5672380782575278344');" style=""> 152             String[] tmpFieldSplit = StringUtils.split(tmpField, &#x27;.&#x27;);                                   </span>
<span class="2836986565168806948" onmouseenter="enter('2836986565168806948');" onmouseout="out('2836986565168806948');" style=""> 153             leftTbSelectField.put(tmpFieldSplit[1], tmpFieldSplit[1]);                                   </span>
<span class="-5202931256248051147" onmouseenter="enter('-5202931256248051147');" onmouseout="out('-5202931256248051147');" style=""> 154             fieldRef.put(tmpField, TableUtils.buildTableField(newTableName, tmpFieldSplit[1]));          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155         }                                                                                                </span>
<span class="2960208767422202819" onmouseenter="enter('2960208767422202819');" onmouseout="out('2960208767422202819');" style=""> 156         for (String tmpField : rightExtractSelectField) {                                                </span>
<span class="-5672380782575278344" onmouseenter="enter('-5672380782575278344');" onmouseout="out('-5672380782575278344');" style=""> 157             String[] tmpFieldSplit = StringUtils.split(tmpField, &#x27;.&#x27;);                                   </span>
<span class="7608141435657997055" onmouseenter="enter('7608141435657997055');" onmouseout="out('7608141435657997055');" style=""> 158             String originalFieldName = tmpFieldSplit[1];                                                 </span>
<span class="-6734440225783578199" onmouseenter="enter('-6734440225783578199');" onmouseout="out('-6734440225783578199');" style=""> 159             String targetFieldName = originalFieldName;                                                  </span>
<span class="7674534154602015296" onmouseenter="enter('7674534154602015296');" onmouseout="out('7674534154602015296');" style=""> 160             if (leftTbSelectField.containsKey(originalFieldName)) {                                      </span>
<span class="-1055151855410778283" onmouseenter="enter('-1055151855410778283');" onmouseout="out('-1055151855410778283');" style=""><abbr title=" 161                 targetFieldName = ParseUtils.dealDuplicateFieldName(leftTbSelectField, originalFieldName);"> 161                 targetFieldName = ParseUtils.dealDuplicateFieldName(leftTbSelectField, originalFieldName)🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162             }                                                                                            </span>
<span class="5677834067945950920" onmouseenter="enter('5677834067945950920');" onmouseout="out('5677834067945950920');" style=""> 163             rightTbSelectField.put(originalFieldName, targetFieldName);                                  </span>
<span class="1614475174789103856" onmouseenter="enter('1614475174789103856');" onmouseout="out('1614475174789103856');" style=""> 164             fieldRef.put(tmpField, TableUtils.buildTableField(newTableName, targetFieldName));           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165         }                                                                                                </span>
<span class="6039372522735153165" onmouseenter="enter('6039372522735153165');" onmouseout="out('6039372522735153165');" style=""> 166         tableInfo.setLeftSelectFieldInfo(leftTbSelectField);                                             </span>
<span class="-3036936727497955518" onmouseenter="enter('-3036936727497955518');" onmouseout="out('-3036936727497955518');" style=""> 167         tableInfo.setRightSelectFieldInfo(rightTbSelectField);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168     }                                                                                                    </span>
<span  style=""> 169                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 170     /**                                                                                                  </span>
<span class="6570650330648921499" onmouseenter="enter('6570650330648921499');" onmouseout="out('6570650330648921499');" style=""> 171      * 指定的节点关联到的 select 中的字段和 where中的字段                                                                  </span>
<span class="3061148848694484073" onmouseenter="enter('3061148848694484073');" onmouseout="out('3061148848694484073');" style=""> 172      * @param sqlNode                                                                                    </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 173      * @param parentWhere                                                                                </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style=""> 174      * @param parentSelectList                                                                           </span>
<span class="3557443413892532302" onmouseenter="enter('3557443413892532302');" onmouseout="out('3557443413892532302');" style=""> 175      * @param parentGroupByList                                                                          </span>
<span class="744467540294235613" onmouseenter="enter('744467540294235613');" onmouseout="out('744467540294235613');" style=""> 176      * @param tableRef                                                                                   </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style=""> 177      * @param joinFieldSet                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 178      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 179      */                                                                                                  </span>
<span class="-5599521794701372640" onmouseenter="enter('-5599521794701372640');" onmouseout="out('-5599521794701372640');" style=""><abbr title=" 180     public Set&lt;String&gt; extractField(SqlNode sqlNode, SqlNode parentWhere, SqlNodeList parentSelectList, SqlNodeList parentGroupByList, Map&lt;String, String&gt; tableRef, Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet) {"> 180     public Set&lt;String&gt; extractField(SqlNode sqlNode, SqlNode parentWhere, SqlNodeList parentSelectList, S🔵</abbr></span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 181         Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                </span>
<span class="3720467049200805808" onmouseenter="enter('3720467049200805808');" onmouseout="out('3720467049200805808');" style=""> 182         TableUtils.getFromTableInfo(sqlNode, fromTableNameSet);                                          </span>
<span class="-6851932415303644529" onmouseenter="enter('-6851932415303644529');" onmouseout="out('-6851932415303644529');" style=""> 183         Set&lt;String&gt; extractCondition = Sets.newHashSet();                                                </span>
<span class="8897652884378692665" onmouseenter="enter('8897652884378692665');" onmouseout="out('8897652884378692665');" style=""> 184         extractWhereCondition(fromTableNameSet, ((SqlBasicCall) (parentWhere)), extractCondition);       </span>
<span class="5747231761832639727" onmouseenter="enter('5747231761832639727');" onmouseout="out('5747231761832639727');" style=""><abbr title=" 185         Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tableRef);"> 185         Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tableRef🔵</abbr></span>
<span class="4281414700536968132" onmouseenter="enter('4281414700536968132');" onmouseout="out('4281414700536968132');" style=""><abbr title=" 186         Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableNameSet, tableRef);"> 186         Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableN🔵</abbr></span>
<span class="6344960557144626200" onmouseenter="enter('6344960557144626200');" onmouseout="out('6344960557144626200');" style=""><abbr title=" 187         Set&lt;String&gt; extractGroupByField = extractFieldFromGroupByList(parentGroupByList, fromTableNameSet, tableRef);"> 187         Set&lt;String&gt; extractGroupByField = extractFieldFromGroupByList(parentGroupByList, fromTableNameSet🔵</abbr></span>
<span class="7218037707336831410" onmouseenter="enter('7218037707336831410');" onmouseout="out('7218037707336831410');" style=""> 188         extractSelectField.addAll(extractCondition);                                                     </span>
<span class="4128012888485840534" onmouseenter="enter('4128012888485840534');" onmouseout="out('4128012888485840534');" style=""> 189         extractSelectField.addAll(fieldFromJoinCondition);                                               </span>
<span class="-8364010074861767596" onmouseenter="enter('-8364010074861767596');" onmouseout="out('-8364010074861767596');" style=""> 190         extractSelectField.addAll(extractGroupByField);                                                  </span>
<span class="6206897609633081926" onmouseenter="enter('6206897609633081926');" onmouseout="out('6206897609633081926');" style=""> 191         return extractSelectField;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192     }                                                                                                    </span>
<span  style=""> 193                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 194     /**                                                                                                  </span>
<span class="-2227309623247049332" onmouseenter="enter('-2227309623247049332');" onmouseout="out('-2227309623247049332');" style=""> 195      * 处理多层join                                                                                          </span>
<span class="-9032432844766422471" onmouseenter="enter('-9032432844766422471');" onmouseout="out('-9032432844766422471');" style=""> 196      * 判断左节点是否需要创建临时查询                                                                                   </span>
<span class="-3743716848325689638" onmouseenter="enter('-3743716848325689638');" onmouseout="out('-3743716848325689638');" style=""> 197      * （1）右节点是维表                                                                                         </span>
<span class="6062511326648248663" onmouseenter="enter('6062511326648248663');" onmouseout="out('6062511326648248663');" style=""> 198      * （2）左节点不是 as 节点                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 199      */                                                                                                  </span>
<span class="5384431983120296725" onmouseenter="enter('5384431983120296725');" onmouseout="out('5384431983120296725');" style=""><abbr title=" 200     private JoinInfo dealNestJoin(SqlJoin joinNode, Set&lt;String&gt; sideTableSet, Queue&lt;Object&gt; queueInfo, SqlNode parentWhere, SqlNodeList parentSelectList, SqlNodeList parentGroupByList, Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet, Map&lt;String, String&gt; tableRef, Map&lt;String, String&gt; fieldRef) {"> 200     private JoinInfo dealNestJoin(SqlJoin joinNode, Set&lt;String&gt; sideTableSet, Queue&lt;Object&gt; queueInfo, Sq🔵</abbr></span>
<span class="-6764205736371805660" onmouseenter="enter('-6764205736371805660');" onmouseout="out('-6764205736371805660');" style=""> 201         SqlJoin leftJoinNode = ((SqlJoin) (joinNode.getLeft()));                                         </span>
<span class="-1304982916123509336" onmouseenter="enter('-1304982916123509336');" onmouseout="out('-1304982916123509336');" style=""> 202         SqlNode parentRightJoinNode = joinNode.getRight();                                               </span>
<span class="3581810211864331265" onmouseenter="enter('3581810211864331265');" onmouseout="out('3581810211864331265');" style=""> 203         SqlNode rightNode = leftJoinNode.getRight();                                                     </span>
<span class="-1213513570275508110" onmouseenter="enter('-1213513570275508110');" onmouseout="out('-1213513570275508110');" style=""><abbr title=" 204         Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 204         Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo🔵</abbr></span>
<span class="7880211710586462336" onmouseenter="enter('7880211710586462336');" onmouseout="out('7880211710586462336');" style=""><abbr title=" 205         Tuple2&lt;String, String&gt; parentRightJoinInfo = parseRightNode(parentRightJoinNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 205         Tuple2&lt;String, String&gt; parentRightJoinInfo = parseRightNode(parentRightJoinNode, sideTableSet, qu🔵</abbr></span>
<span class="-5913516627524533061" onmouseenter="enter('-5913516627524533061');" onmouseout="out('-5913516627524533061');" style=""> 206         boolean parentRightIsSide = checkIsSideTable(parentRightJoinInfo.f0, sideTableSet);              </span>
<span class="3375986139512671503" onmouseenter="enter('3375986139512671503');" onmouseout="out('3375986139512671503');" style=""><abbr title=" 207         JoinInfo joinInfo = dealJoinNode(leftJoinNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, fieldRef);"> 207         JoinInfo joinInfo = dealJoinNode(leftJoinNode, sideTableSet, queueInfo, parentWhere, parentSelect🔵</abbr></span>
<span class="-8707963241001902314" onmouseenter="enter('-8707963241001902314');" onmouseout="out('-8707963241001902314');" style=""> 208         String rightTableName = rightTableNameAndAlias.f0;                                               </span>
<span class="-2376755127467584795" onmouseenter="enter('-2376755127467584795');" onmouseout="out('-2376755127467584795');" style=""> 209         boolean rightIsSide = checkIsSideTable(rightTableName, sideTableSet);                            </span>
<span class="-1905801896855583684" onmouseenter="enter('-1905801896855583684');" onmouseout="out('-1905801896855583684');" style=""> 210         SqlBasicCall buildAs = TableUtils.buildAsNodeByJoinInfo(joinInfo, null, null);                   </span>
<span class="-5472632053620761059" onmouseenter="enter('-5472632053620761059');" onmouseout="out('-5472632053620761059');" style=""> 211         if (rightIsSide) {                                                                               </span>
<span class="-1341811977371241920" onmouseenter="enter('-1341811977371241920');" onmouseout="out('-1341811977371241920');" style=""><abbr title=" 212             addSideInfoToExeQueue(queueInfo, joinInfo, joinNode, parentSelectList, parentGroupByList, parentWhere, tableRef);"> 212             addSideInfoToExeQueue(queueInfo, joinInfo, joinNode, parentSelectList, parentGroupByList, par🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213         }                                                                                                </span>
<span class="-4926661402208797605" onmouseenter="enter('-4926661402208797605');" onmouseout="out('-4926661402208797605');" style=""> 214         SqlNode newLeftNode = joinNode.getLeft();                                                        </span>
<span class="5458498463126962279" onmouseenter="enter('5458498463126962279');" onmouseout="out('5458498463126962279');" style=""> 215         if ((newLeftNode.getKind() != AS) &amp;&amp; parentRightIsSide) {                                        </span>
<span class="-7949998902589886822" onmouseenter="enter('-7949998902589886822');" onmouseout="out('-7949998902589886822');" style=""> 216             String leftTbAlias = buildAs.getOperands()[1].toString();                                    </span>
<span class="-3395228835669309370" onmouseenter="enter('-3395228835669309370');" onmouseout="out('-3395228835669309370');" style=""><abbr title=" 217             extractTemporaryQuery(newLeftNode, leftTbAlias, ((SqlBasicCall) (parentWhere)), parentSelectList, queueInfo, joinFieldSet, tableRef, fieldRef);"> 217             extractTemporaryQuery(newLeftNode, leftTbAlias, ((SqlBasicCall) (parentWhere)), parentSelectL🔵</abbr></span>
<span class="-989980209919659858" onmouseenter="enter('-989980209919659858');" onmouseout="out('-989980209919659858');" style=""> 218             // 替换leftNode 为新的查询                                                                          </span>
<span class="-9132777540839355627" onmouseenter="enter('-9132777540839355627');" onmouseout="out('-9132777540839355627');" style=""> 219             joinNode.setLeft(buildAs);                                                                   </span>
<span class="-2381095167123449114" onmouseenter="enter('-2381095167123449114');" onmouseout="out('-2381095167123449114');" style=""><abbr title=" 220             replaceSelectAndWhereField(buildAs, leftJoinNode, tableRef, parentSelectList, parentGroupByList, parentWhere);"> 220             replaceSelectAndWhereField(buildAs, leftJoinNode, tableRef, parentSelectList, parentGroupByLi🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221         }                                                                                                </span>
<span class="8714866254863163325" onmouseenter="enter('8714866254863163325');" onmouseout="out('8714866254863163325');" style=""> 222         return joinInfo;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223     }                                                                                                    </span>
<span  style=""> 224                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 225     /**                                                                                                  </span>
<span class="4951286882385365012" onmouseenter="enter('4951286882385365012');" onmouseout="out('4951286882385365012');" style=""> 226      * 右边表是维表需要重新构建左表的临时查询                                                                               </span>
<span class="-8208655787748224971" onmouseenter="enter('-8208655787748224971');" onmouseout="out('-8208655787748224971');" style=""> 227      * 并将joinInfo 添加到执行队列里面                                                                              </span>
<span class="3894561521416724418" onmouseenter="enter('3894561521416724418');" onmouseout="out('3894561521416724418');" style=""> 228      * @param queueInfo                                                                                  </span>
<span class="-6040909485639107572" onmouseenter="enter('-6040909485639107572');" onmouseout="out('-6040909485639107572');" style=""> 229      * @param joinInfo                                                                                   </span>
<span class="-2995351136134268537" onmouseenter="enter('-2995351136134268537');" onmouseout="out('-2995351136134268537');" style=""> 230      * @param joinNode                                                                                   </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style=""> 231      * @param parentSelectList                                                                           </span>
<span class="3557443413892532302" onmouseenter="enter('3557443413892532302');" onmouseout="out('3557443413892532302');" style=""> 232      * @param parentGroupByList                                                                          </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 233      * @param parentWhere                                                                                </span>
<span class="744467540294235613" onmouseenter="enter('744467540294235613');" onmouseout="out('744467540294235613');" style=""> 234      * @param tableRef                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 235      */                                                                                                  </span>
<span class="30356094354116233" onmouseenter="enter('30356094354116233');" onmouseout="out('30356094354116233');" style=""><abbr title=" 236     public void addSideInfoToExeQueue(Queue&lt;Object&gt; queueInfo, JoinInfo joinInfo, SqlJoin joinNode, SqlNodeList parentSelectList, SqlNodeList parentGroupByList, SqlNode parentWhere, Map&lt;String, String&gt; tableRef) {"> 236     public void addSideInfoToExeQueue(Queue&lt;Object&gt; queueInfo, JoinInfo joinInfo, SqlJoin joinNode, SqlNo🔵</abbr></span>
<span class="-6478373311886746675" onmouseenter="enter('-6478373311886746675');" onmouseout="out('-6478373311886746675');" style=""> 237         //只处理维表                                                                                          </span>
<span class="-8470519095621989422" onmouseenter="enter('-8470519095621989422');" onmouseout="out('-8470519095621989422');" style=""> 238         if (!joinInfo.isRightIsSideTable()) {                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 239             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240         }                                                                                                </span>
<span class="-1905801896855583684" onmouseenter="enter('-1905801896855583684');" onmouseout="out('-1905801896855583684');" style=""> 241         SqlBasicCall buildAs = TableUtils.buildAsNodeByJoinInfo(joinInfo, null, null);                   </span>
<span class="-2672508263360943403" onmouseenter="enter('-2672508263360943403');" onmouseout="out('-2672508263360943403');" style=""> 242         SqlNode leftJoinNode = joinNode.getLeft();                                                       </span>
<span class="6641920780390342492" onmouseenter="enter('6641920780390342492');" onmouseout="out('6641920780390342492');" style=""> 243         queueInfo.offer(joinInfo);                                                                       </span>
<span class="-1649946882727486138" onmouseenter="enter('-1649946882727486138');" onmouseout="out('-1649946882727486138');" style=""> 244         // 替换左表为新的表名称                                                                                    </span>
<span class="-9132777540839355627" onmouseenter="enter('-9132777540839355627');" onmouseout="out('-9132777540839355627');" style=""> 245         joinNode.setLeft(buildAs);                                                                       </span>
<span class="-2381095167123449114" onmouseenter="enter('-2381095167123449114');" onmouseout="out('-2381095167123449114');" style=""><abbr title=" 246         replaceSelectAndWhereField(buildAs, leftJoinNode, tableRef, parentSelectList, parentGroupByList, parentWhere);"> 246         replaceSelectAndWhereField(buildAs, leftJoinNode, tableRef, parentSelectList, parentGroupByList, 🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247     }                                                                                                    </span>
<span  style=""> 248                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 249     /**                                                                                                  </span>
<span class="2664257413645127477" onmouseenter="enter('2664257413645127477');" onmouseout="out('2664257413645127477');" style=""> 250      * 替换指定的查询和条件节点中的字段为新的字段                                                                             </span>
<span class="-5192515893397779968" onmouseenter="enter('-5192515893397779968');" onmouseout="out('-5192515893397779968');" style=""> 251      * @param buildAs                                                                                    </span>
<span class="8761373734140075238" onmouseenter="enter('8761373734140075238');" onmouseout="out('8761373734140075238');" style=""> 252      * @param leftJoinNode                                                                               </span>
<span class="744467540294235613" onmouseenter="enter('744467540294235613');" onmouseout="out('744467540294235613');" style=""> 253      * @param tableRef                                                                                   </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style=""> 254      * @param parentSelectList                                                                           </span>
<span class="3557443413892532302" onmouseenter="enter('3557443413892532302');" onmouseout="out('3557443413892532302');" style=""> 255      * @param parentGroupByList                                                                          </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 256      * @param parentWhere                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 257      */                                                                                                  </span>
<span class="-7676170128081324449" onmouseenter="enter('-7676170128081324449');" onmouseout="out('-7676170128081324449');" style=""><abbr title=" 258     public void replaceSelectAndWhereField(SqlBasicCall buildAs, SqlNode leftJoinNode, Map&lt;String, String&gt; tableRef, SqlNodeList parentSelectList, SqlNodeList parentGroupByList, SqlNode parentWhere) {"> 258     public void replaceSelectAndWhereField(SqlBasicCall buildAs, SqlNode leftJoinNode, Map&lt;String, String🔵</abbr></span>
<span class="-1197906562874334747" onmouseenter="enter('-1197906562874334747');" onmouseout="out('-1197906562874334747');" style=""> 259         String newLeftTableName = buildAs.getOperands()[1].toString();                                   </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 260         Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                </span>
<span class="6977570025516648131" onmouseenter="enter('6977570025516648131');" onmouseout="out('6977570025516648131');" style=""> 261         TableUtils.getFromTableInfo(leftJoinNode, fromTableNameSet);                                     </span>
<span class="1450243350725845907" onmouseenter="enter('1450243350725845907');" onmouseout="out('1450243350725845907');" style=""> 262         for (String tbTmp : fromTableNameSet) {                                                          </span>
<span class="6564874017116360040" onmouseenter="enter('6564874017116360040');" onmouseout="out('6564874017116360040');" style=""> 263             tableRef.put(tbTmp, newLeftTableName);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264         }                                                                                                </span>
<span class="-7672107352592465049" onmouseenter="enter('-7672107352592465049');" onmouseout="out('-7672107352592465049');" style=""> 265         // 替换select field 中的对应字段                                                                         </span>
<span class="5558486769410159556" onmouseenter="enter('5558486769410159556');" onmouseout="out('5558486769410159556');" style=""> 266         HashBiMap&lt;String, String&gt; fieldReplaceRef = HashBiMap.create();                                  </span>
<span class="-1107201590594387961" onmouseenter="enter('-1107201590594387961');" onmouseout="out('-1107201590594387961');" style=""> 267         for (SqlNode sqlNode : parentSelectList.getList()) {                                             </span>
<span class="1450243350725845907" onmouseenter="enter('1450243350725845907');" onmouseout="out('1450243350725845907');" style=""> 268             for (String tbTmp : fromTableNameSet) {                                                      </span>
<span class="-581523387212695221" onmouseenter="enter('-581523387212695221');" onmouseout="out('-581523387212695221');" style=""> 269                 TableUtils.replaceSelectFieldTable(sqlNode, tbTmp, newLeftTableName, fieldReplaceRef);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 270             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 271         }                                                                                                </span>
<span class="-8944541773972050035" onmouseenter="enter('-8944541773972050035');" onmouseout="out('-8944541773972050035');" style=""> 272         //TODO 应该根据上面的查询字段的关联关系来替换                                                                       </span>
<span class="1927000767768311618" onmouseenter="enter('1927000767768311618');" onmouseout="out('1927000767768311618');" style=""> 273         //替换where 中的条件相关                                                                                 </span>
<span class="1450243350725845907" onmouseenter="enter('1450243350725845907');" onmouseout="out('1450243350725845907');" style=""> 274         for (String tbTmp : fromTableNameSet) {                                                          </span>
<span class="5165818510692281294" onmouseenter="enter('5165818510692281294');" onmouseout="out('5165818510692281294');" style=""> 275             TableUtils.replaceWhereCondition(parentWhere, tbTmp, newLeftTableName, fieldReplaceRef);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276         }                                                                                                </span>
<span class="-5898792325167343472" onmouseenter="enter('-5898792325167343472');" onmouseout="out('-5898792325167343472');" style=""> 277         if (parentGroupByList != null) {                                                                 </span>
<span class="4766581612124204356" onmouseenter="enter('4766581612124204356');" onmouseout="out('4766581612124204356');" style=""> 278             for (SqlNode sqlNode : parentGroupByList.getList()) {                                        </span>
<span class="1450243350725845907" onmouseenter="enter('1450243350725845907');" onmouseout="out('1450243350725845907');" style=""> 279                 for (String tbTmp : fromTableNameSet) {                                                  </span>
<span class="-581523387212695221" onmouseenter="enter('-581523387212695221');" onmouseout="out('-581523387212695221');" style=""><abbr title=" 280                     TableUtils.replaceSelectFieldTable(sqlNode, tbTmp, newLeftTableName, fieldReplaceRef);"> 280                     TableUtils.replaceSelectFieldTable(sqlNode, tbTmp, newLeftTableName, fieldReplaceRef)🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284     }                                                                                                    </span>
<span  style=""> 285                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 286     /**                                                                                                  </span>
<span class="-9161506910855772732" onmouseenter="enter('-9161506910855772732');" onmouseout="out('-9161506910855772732');" style=""> 287      * 抽取出中间查询表                                                                                          </span>
<span class="384197096128287152" onmouseenter="enter('384197096128287152');" onmouseout="out('384197096128287152');" style=""> 288      * @param node                                                                                       </span>
<span class="3992250397465727176" onmouseenter="enter('3992250397465727176');" onmouseout="out('3992250397465727176');" style=""> 289      * @param tableAlias                                                                                 </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 290      * @param parentWhere                                                                                </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style=""> 291      * @param parentSelectList                                                                           </span>
<span class="3894561521416724418" onmouseenter="enter('3894561521416724418');" onmouseout="out('3894561521416724418');" style=""> 292      * @param queueInfo                                                                                  </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style=""> 293      * @param joinFieldSet                                                                               </span>
<span class="744467540294235613" onmouseenter="enter('744467540294235613');" onmouseout="out('744467540294235613');" style=""> 294      * @param tableRef                                                                                   </span>
<span class="6064073244373316048" onmouseenter="enter('6064073244373316048');" onmouseout="out('6064073244373316048');" style=""> 295      * @return 源自段和新生成字段之间的映射关系                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 296      */                                                                                                  </span>
<span class="2324416853637151306" onmouseenter="enter('2324416853637151306');" onmouseout="out('2324416853637151306');" style=""><abbr title=" 297     private void extractTemporaryQuery(SqlNode node, String tableAlias, SqlBasicCall parentWhere, SqlNodeList parentSelectList, Queue&lt;Object&gt; queueInfo, Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet, Map&lt;String, String&gt; tableRef, Map&lt;String, String&gt; fieldRef) {"> 297     private void extractTemporaryQuery(SqlNode node, String tableAlias, SqlBasicCall parentWhere, SqlNode🔵</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 298         try {                                                                                            </span>
<span class="-8973252823595593319" onmouseenter="enter('-8973252823595593319');" onmouseout="out('-8973252823595593319');" style=""> 299             //父一级的where 条件中如果只和临时查询相关的条件都截取进来                                                            </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 300             Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                            </span>
<span class="-1162190359921159801" onmouseenter="enter('-1162190359921159801');" onmouseout="out('-1162190359921159801');" style=""> 301             List&lt;SqlBasicCall&gt; extractCondition = Lists.newArrayList();                                  </span>
<span  style=""> 302                                                                                                          </span>
<span class="8110456237367799034" onmouseenter="enter('8110456237367799034');" onmouseout="out('8110456237367799034');" style=""> 303             TableUtils.getFromTableInfo(node, fromTableNameSet);                                         </span>
<span class="6022466615463989785" onmouseenter="enter('6022466615463989785');" onmouseout="out('6022466615463989785');" style=""> 304             checkAndRemoveWhereCondition(fromTableNameSet, parentWhere, extractCondition);               </span>
<span  style=""> 305                                                                                                          </span>
<span class="8695778948204515419" onmouseenter="enter('8695778948204515419');" onmouseout="out('8695778948204515419');" style=""> 306             if(node.getKind() == JOIN){                                                                  </span>
<span class="-6199554136531935919" onmouseenter="enter('-6199554136531935919');" onmouseout="out('-6199554136531935919');" style=""> 307                 checkAndReplaceJoinCondition(((SqlJoin)node).getCondition(), tableRef);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308             }                                                                                            </span>
<span  style=""> 309                                                                                                          </span>
<span class="5747231761832639727" onmouseenter="enter('5747231761832639727');" onmouseout="out('5747231761832639727');" style=""><abbr title=" 310             Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tableRef);"> 310             Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tabl🔵</abbr></span>
<span class="4281414700536968132" onmouseenter="enter('4281414700536968132');" onmouseout="out('4281414700536968132');" style=""><abbr title=" 311             Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableNameSet, tableRef);"> 311             Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTa🔵</abbr></span>
<span class="-718326697477564125" onmouseenter="enter('-718326697477564125');" onmouseout="out('-718326697477564125');" style=""> 312             Set&lt;String&gt; newFields = buildSelectNode(extractSelectField, fieldFromJoinCondition);         </span>
<span class="9076146696470564191" onmouseenter="enter('9076146696470564191');" onmouseout="out('9076146696470564191');" style=""> 313             String extractSelectFieldStr = StringUtils.join(newFields, &#x27;,&#x27;);                             </span>
<span  style=""> 314                                                                                                          </span>
<span class="4157544700609283076" onmouseenter="enter('4157544700609283076');" onmouseout="out('4157544700609283076');" style=""> 315             Map&lt;String, String&gt; oldRefNewField = buildTmpTableFieldRefOriField(newFields, tableAlias);   </span>
<span class="-9040628512379918841" onmouseenter="enter('-9040628512379918841');" onmouseout="out('-9040628512379918841');" style=""> 316             fieldRef.putAll(oldRefNewField);                                                             </span>
<span  style=""> 317                                                                                                          </span>
<span class="-3122368802496797506" onmouseenter="enter('-3122368802496797506');" onmouseout="out('-3122368802496797506');" style=""> 318             String extractConditionStr = buildCondition(extractCondition);                               </span>
<span  style=""> 319                                                                                                          </span>
<span class="6190023554533569746" onmouseenter="enter('6190023554533569746');" onmouseout="out('6190023554533569746');" style=""> 320             String tmpSelectSql = String.format(SELECT_TEMP_SQL,                                         </span>
<span class="3430988890108370699" onmouseenter="enter('3430988890108370699');" onmouseout="out('3430988890108370699');" style=""> 321                     extractSelectFieldStr,                                                               </span>
<span class="-1169517675965244531" onmouseenter="enter('-1169517675965244531');" onmouseout="out('-1169517675965244531');" style=""> 322                     node.toString(),                                                                     </span>
<span class="4099345839703116685" onmouseenter="enter('4099345839703116685');" onmouseout="out('4099345839703116685');" style=""> 323                     extractConditionStr);                                                                </span>
<span  style=""> 324                                                                                                          </span>
<span class="-1075958635284917181" onmouseenter="enter('-1075958635284917181');" onmouseout="out('-1075958635284917181');" style=""> 325             FlinkPlannerImpl flinkPlanner = FlinkPlanner.getFlinkPlanner();                              </span>
<span class="7395930912815097284" onmouseenter="enter('7395930912815097284');" onmouseout="out('7395930912815097284');" style=""> 326             SqlNode sqlNode = flinkPlanner.parse(tmpSelectSql);                                          </span>
<span  style=""> 327                                                                                                          </span>
<span class="-2735890898778643076" onmouseenter="enter('-2735890898778643076');" onmouseout="out('-2735890898778643076');" style=""> 328             SqlBasicCall sqlBasicCall = buildAsSqlNode(tableAlias, sqlNode);                             </span>
<span class="2417854506040223841" onmouseenter="enter('2417854506040223841');" onmouseout="out('2417854506040223841');" style=""> 329             queueInfo.offer(sqlBasicCall);                                                               </span>
<span  style=""> 330                                                                                                          </span>
<span  style=""> 331                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 332 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="3036777158467770620" onmouseenter="enter('3036777158467770620');" onmouseout="out('3036777158467770620');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 333             //替换select中的表结构                                                                              </span>
<span class="5558486769410159556" onmouseenter="enter('5558486769410159556');" onmouseout="out('5558486769410159556');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 334             HashBiMap&lt;String, String&gt; fieldReplaceRef = HashBiMap.create();                              </span>
<span class="6403576620687993648" onmouseenter="enter('6403576620687993648');" onmouseout="out('6403576620687993648');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 335             for(SqlNode tmpSelect : parentSelectList.getList()){                                         </span>
<span class="-7140235961109122639" onmouseenter="enter('-7140235961109122639');" onmouseout="out('-7140235961109122639');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 336                 for(String tbTmp : fromTableNameSet) {                                                   </span>
<span class="-2362265056324339707" onmouseenter="enter('-2362265056324339707');" onmouseout="out('-2362265056324339707');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 337                     TableUtils.replaceSelectFieldTable(tmpSelect, tbTmp, tableAlias, fieldReplaceRef);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 338                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 339             }                                                                                            </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 340                                                                                                          </span>
<span class="1927000767768311618" onmouseenter="enter('1927000767768311618');" onmouseout="out('1927000767768311618');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 341             //替换where 中的条件相关                                                                             </span>
<span class="-4128731698405516984" onmouseenter="enter('-4128731698405516984');" onmouseout="out('-4128731698405516984');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 342             for(String tbTmp : fromTableNameSet){                                                        </span>
<span class="859671676632511130" onmouseenter="enter('859671676632511130');" onmouseout="out('859671676632511130');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 343                 TableUtils.replaceWhereCondition(parentWhere, tbTmp, tableAlias, fieldReplaceRef);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 344             }                                                                                            </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 345                                                                                                          </span>
<span class="-4128731698405516984" onmouseenter="enter('-4128731698405516984');" onmouseout="out('-4128731698405516984');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 346             for(String tbTmp : fromTableNameSet){                                                        </span>
<span class="-6060557126611161603" onmouseenter="enter('-6060557126611161603');" onmouseout="out('-6060557126611161603');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 347                 tableRef.put(tbTmp, tableAlias);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 348             }                                                                                            </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 349                                                                                                          </span>
<span class="3487269535061511064" onmouseenter="enter('3487269535061511064');" onmouseout="out('3487269535061511064');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 350             System.out.println(&quot;-------build temporary query-----------&quot;);                               </span>
<span class="-8101867096626384734" onmouseenter="enter('-8101867096626384734');" onmouseout="out('-8101867096626384734');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 351             System.out.println(tmpSelectSql);                                                            </span>
<span class="-4281832807373115174" onmouseenter="enter('-4281832807373115174');" onmouseout="out('-4281832807373115174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 352             System.out.println(&quot;---------------------------------------&quot;);                               </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 353                                                                                                          </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 354                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 355 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 356 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 356 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 357 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 358                                                                                                          </span>
<span class="3812477662204349545" onmouseenter="enter('3812477662204349545');" onmouseout="out('3812477662204349545');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 359             Log.info(&quot;-------build temporary query-----------\n{}&quot;, tmpSelectSql);                       </span>
<span class="3847699124612806472" onmouseenter="enter('3847699124612806472');" onmouseout="out('3847699124612806472');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 360             Log.info(&quot;---------------------------------------&quot;);                                         </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 361                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 362 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 363         } catch (java.lang.Exception e) {                                                                </span>
<span class="-9144524576168127827" onmouseenter="enter('-9144524576168127827');" onmouseout="out('-9144524576168127827');" style=""> 364             Log.error(&quot;&quot;, e);                                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 365             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367     }                                                                                                    </span>
<span  style=""> 368                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 369     /**                                                                                                  </span>
<span class="-4499840608975407423" onmouseenter="enter('-4499840608975407423');" onmouseout="out('-4499840608975407423');" style=""> 370      * 抽取上层需用使用到的字段                                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 371      *                                                                                                   </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style=""> 372      * @param parentSelectList                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 373      *                                                                                                   </span>
<span class="-6365101737408851156" onmouseenter="enter('-6365101737408851156');" onmouseout="out('-6365101737408851156');" style=""> 374      * @param fromTableNameSet                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 375      *                                                                                                   </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 376      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 377      */                                                                                                  </span>
<span class="-3425965855403526987" onmouseenter="enter('-3425965855403526987');" onmouseout="out('-3425965855403526987');" style=""><abbr title=" 378     private Set&lt;String&gt; extractSelectFields(SqlNodeList parentSelectList, Set&lt;String&gt; fromTableNameSet, Map&lt;String, String&gt; tableRef) {"> 378     private Set&lt;String&gt; extractSelectFields(SqlNodeList parentSelectList, Set&lt;String&gt; fromTableNameSet, M🔵</abbr></span>
<span class="-4673362671275703253" onmouseenter="enter('-4673362671275703253');" onmouseout="out('-4673362671275703253');" style=""> 379         Set&lt;String&gt; extractFieldList = Sets.newHashSet();                                                </span>
<span class="7219499864387394696" onmouseenter="enter('7219499864387394696');" onmouseout="out('7219499864387394696');" style=""> 380         for (SqlNode selectNode : parentSelectList.getList()) {                                          </span>
<span class="1095915068729564148" onmouseenter="enter('1095915068729564148');" onmouseout="out('1095915068729564148');" style=""> 381             extractSelectField(selectNode, extractFieldList, fromTableNameSet, tableRef);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 382         }                                                                                                </span>
<span class="-1685101767459189568" onmouseenter="enter('-1685101767459189568');" onmouseout="out('-1685101767459189568');" style=""> 383         return extractFieldList;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 384     }                                                                                                    </span>
<span  style=""> 385                                                                                                          </span>
<span class="-2791630427790959656" onmouseenter="enter('-2791630427790959656');" onmouseout="out('-2791630427790959656');" style=""><abbr title=" 386     private Set&lt;String&gt; extractSelectFieldFromJoinCondition(Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet, Set&lt;String&gt; fromTableNameSet, Map&lt;String, String&gt; tableRef) {"> 386     private Set&lt;String&gt; extractSelectFieldFromJoinCondition(Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet, Set🔵</abbr></span>
<span class="-4673362671275703253" onmouseenter="enter('-4673362671275703253');" onmouseout="out('-4673362671275703253');" style=""> 387         Set&lt;String&gt; extractFieldList = Sets.newHashSet();                                                </span>
<span class="55080719289696902" onmouseenter="enter('55080719289696902');" onmouseout="out('55080719289696902');" style=""> 388         for (Tuple2&lt;String, String&gt; field : joinFieldSet) {                                              </span>
<span class="-2768304005307367393" onmouseenter="enter('-2768304005307367393');" onmouseout="out('-2768304005307367393');" style=""> 389             if (fromTableNameSet.contains(field.f0)) {                                                   </span>
<span class="6098219275152631302" onmouseenter="enter('6098219275152631302');" onmouseout="out('6098219275152631302');" style=""> 390                 extractFieldList.add((field.f0 + &quot;.&quot;) + field.f1);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 391             }                                                                                            </span>
<span class="718418822325285101" onmouseenter="enter('718418822325285101');" onmouseout="out('718418822325285101');" style=""> 392             if (tableRef.containsKey(field.f0)) {                                                        </span>
<span class="-2271917681162941899" onmouseenter="enter('-2271917681162941899');" onmouseout="out('-2271917681162941899');" style=""> 393                 if (fromTableNameSet.contains(tableRef.get(field.f0))) {                                 </span>
<span class="6533672845245766270" onmouseenter="enter('6533672845245766270');" onmouseout="out('6533672845245766270');" style=""> 394                     extractFieldList.add((tableRef.get(field.f0) + &quot;.&quot;) + field.f1);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 395                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 396             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 397         }                                                                                                </span>
<span class="-1685101767459189568" onmouseenter="enter('-1685101767459189568');" onmouseout="out('-1685101767459189568');" style=""> 398         return extractFieldList;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 399     }                                                                                                    </span>
<span  style=""> 400                                                                                                          </span>
<span class="-6744450936821609200" onmouseenter="enter('-6744450936821609200');" onmouseout="out('-6744450936821609200');" style=""> 401     private Set&lt;String&gt; extractFieldFromGroupByList(SqlNodeList parentGroupByList,                       </span>
<span class="8604782440088857459" onmouseenter="enter('8604782440088857459');" onmouseout="out('8604782440088857459');" style=""> 402                                                     Set&lt;String&gt; fromTableNameSet,                        </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style=""> 403                                                     Map&lt;String, String&gt; tableRef){                       </span>
<span  style=""> 404                                                                                                          </span>
<span class="-1817314657182986777" onmouseenter="enter('-1817314657182986777');" onmouseout="out('-1817314657182986777');" style=""> 405         if(parentGroupByList == null){                                                                   </span>
<span class="7586937643893917515" onmouseenter="enter('7586937643893917515');" onmouseout="out('7586937643893917515');" style=""> 406             return Sets.newHashSet();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 407         }                                                                                                </span>
<span  style=""> 408                                                                                                          </span>
<span class="-4673362671275703253" onmouseenter="enter('-4673362671275703253');" onmouseout="out('-4673362671275703253');" style=""> 409         Set&lt;String&gt; extractFieldList = Sets.newHashSet();                                                </span>
<span class="7263955957768279526" onmouseenter="enter('7263955957768279526');" onmouseout="out('7263955957768279526');" style=""> 410         for(SqlNode selectNode : parentGroupByList.getList()){                                           </span>
<span class="1095915068729564148" onmouseenter="enter('1095915068729564148');" onmouseout="out('1095915068729564148');" style=""> 411             extractSelectField(selectNode, extractFieldList, fromTableNameSet, tableRef);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412         }                                                                                                </span>
<span  style=""> 413                                                                                                          </span>
<span class="-1685101767459189568" onmouseenter="enter('-1685101767459189568');" onmouseout="out('-1685101767459189568');" style=""> 414         return extractFieldList;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415     }                                                                                                    </span>
<span  style=""> 416                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 417     /**                                                                                                  </span>
<span class="-672438967754228662" onmouseenter="enter('-672438967754228662');" onmouseout="out('-672438967754228662');" style=""> 418      * 从join的条件中获取字段信息                                                                                   </span>
<span class="-4160812560585701802" onmouseenter="enter('-4160812560585701802');" onmouseout="out('-4160812560585701802');" style=""> 419      * @param condition                                                                                  </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style=""> 420      * @param joinFieldSet                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 421      */                                                                                                  </span>
<span class="5922196101266734725" onmouseenter="enter('5922196101266734725');" onmouseout="out('5922196101266734725');" style=""> 422     private void extractJoinField(SqlNode condition, Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet) {         </span>
<span class="-7935154367853009577" onmouseenter="enter('-7935154367853009577');" onmouseout="out('-7935154367853009577');" style=""> 423         if ((null == condition) || (condition.getKind() == LITERAL)) {                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 424             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 425         }                                                                                                </span>
<span class="5418896256960850645" onmouseenter="enter('5418896256960850645');" onmouseout="out('5418896256960850645');" style=""> 426         SqlKind joinKind = condition.getKind();                                                          </span>
<span class="-9142843625833231302" onmouseenter="enter('-9142843625833231302');" onmouseout="out('-9142843625833231302');" style=""> 427         if ((joinKind == AND) || (joinKind == EQUALS)) {                                                 </span>
<span class="-6499458714372573045" onmouseenter="enter('-6499458714372573045');" onmouseout="out('-6499458714372573045');" style=""> 428             extractJoinField(((SqlBasicCall) (condition)).operands[0], joinFieldSet);                    </span>
<span class="-3142125381204798212" onmouseenter="enter('-3142125381204798212');" onmouseout="out('-3142125381204798212');" style=""> 429             extractJoinField(((SqlBasicCall) (condition)).operands[1], joinFieldSet);                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 430         } else {                                                                                         </span>
<span class="-1463690357038754030" onmouseenter="enter('-1463690357038754030');" onmouseout="out('-1463690357038754030');" style=""><abbr title=" 431             Preconditions.checkState(((SqlIdentifier) (condition)).names.size() == 2, &quot;join condition must be format table.field&quot;);"> 431             Preconditions.checkState(((SqlIdentifier) (condition)).names.size() == 2, &quot;join condition mus🔵</abbr></span>
<span class="-1452911314035704133" onmouseenter="enter('-1452911314035704133');" onmouseout="out('-1452911314035704133');" style=""><abbr title=" 432             Tuple2&lt;String, String&gt; tuple2 = Tuple2.of(((SqlIdentifier) (condition)).names.get(0), ((SqlIdentifier) (condition)).names.get(1));"> 432             Tuple2&lt;String, String&gt; tuple2 = Tuple2.of(((SqlIdentifier) (condition)).names.get(0), ((SqlId🔵</abbr></span>
<span class="-8031023747394340843" onmouseenter="enter('-8031023747394340843');" onmouseout="out('-8031023747394340843');" style=""> 433             joinFieldSet.add(tuple2);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 434         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 435     }                                                                                                    </span>
<span  style=""> 436                                                                                                          </span>
<span class="-5097055456416926192" onmouseenter="enter('-5097055456416926192');" onmouseout="out('-5097055456416926192');" style=""><abbr title=" 437     private void extractSelectField(SqlNode selectNode, Set&lt;String&gt; extractFieldSet, Set&lt;String&gt; fromTableNameSet, Map&lt;String, String&gt; tableRef) {"> 437     private void extractSelectField(SqlNode selectNode, Set&lt;String&gt; extractFieldSet, Set&lt;String&gt; fromTabl🔵</abbr></span>
<span class="8103739576060170768" onmouseenter="enter('8103739576060170768');" onmouseout="out('8103739576060170768');" style=""> 438         if (selectNode.getKind() == AS) {                                                                </span>
<span class="-1537807880727101561" onmouseenter="enter('-1537807880727101561');" onmouseout="out('-1537807880727101561');" style=""> 439             SqlNode leftNode = ((SqlBasicCall) (selectNode)).getOperands()[0];                           </span>
<span class="-3569930423065034136" onmouseenter="enter('-3569930423065034136');" onmouseout="out('-3569930423065034136');" style=""> 440             extractSelectField(leftNode, extractFieldSet, fromTableNameSet, tableRef);                   </span>
<span class="-2484573391774826594" onmouseenter="enter('-2484573391774826594');" onmouseout="out('-2484573391774826594');" style=""> 441         } else if (selectNode.getKind() == IDENTIFIER) {                                                 </span>
<span class="-501065438478932756" onmouseenter="enter('-501065438478932756');" onmouseout="out('-501065438478932756');" style=""> 442             SqlIdentifier sqlIdentifier = ((SqlIdentifier) (selectNode));                                </span>
<span class="5334275776993480413" onmouseenter="enter('5334275776993480413');" onmouseout="out('5334275776993480413');" style=""> 443             if (sqlIdentifier.names.size() == 1) {                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 444                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 445             }                                                                                            </span>
<span class="3965609827388612088" onmouseenter="enter('3965609827388612088');" onmouseout="out('3965609827388612088');" style=""> 446             String tableName = sqlIdentifier.names.get(0);                                               </span>
<span class="8792343062212034006" onmouseenter="enter('8792343062212034006');" onmouseout="out('8792343062212034006');" style=""> 447             // TODO                                                                                      </span>
<span class="5517971561423530104" onmouseenter="enter('5517971561423530104');" onmouseout="out('5517971561423530104');" style=""> 448             if (fromTableNameSet.contains(tableName)) {                                                  </span>
<span class="-4452600673359758385" onmouseenter="enter('-4452600673359758385');" onmouseout="out('-4452600673359758385');" style=""> 449                 extractFieldSet.add(sqlIdentifier.toString());                                           </span>
<span class="-7622185377235779989" onmouseenter="enter('-7622185377235779989');" onmouseout="out('-7622185377235779989');" style=""> 450             } else if (fromTableNameSet.contains(tableRef.get(tableName))) {                             </span>
<span class="1027718302146580884" onmouseenter="enter('1027718302146580884');" onmouseout="out('1027718302146580884');" style=""><abbr title=" 451                 // TODO extractFieldSet.add(sqlIdentifier.setName(0, tableRef.get(tableName)).toString());"> 451                 // TODO extractFieldSet.add(sqlIdentifier.setName(0, tableRef.get(tableName)).toString())🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 452             }                                                                                            </span>
<span class="3850271869904858512" onmouseenter="enter('3850271869904858512');" onmouseout="out('3850271869904858512');" style=""><abbr title=" 453         } else if ((((((((((((((((((((((((((((AGGREGATE.contains(selectNode.getKind()) || AVG_AGG_FUNCTIONS.contains(selectNode.getKind())) || COMPARISON.contains(selectNode.getKind())) || (selectNode.getKind() == OTHER_FUNCTION)) || (selectNode.getKind() == DIVIDE)) || (selectNode.getKind() == CAST)) || (selectNode.getKind() == TRIM)) || (selectNode.getKind() == TIMES)) || (selectNode.getKind() == PLUS)) || (selectNode.getKind() == NOT_IN)) || (selectNode.getKind() == OR)) || (selectNode.getKind() == AND)) || (selectNode.getKind() == MINUS)) || (selectNode.getKind() == TUMBLE)) || (selectNode.getKind() == TUMBLE_START)) || (selectNode.getKind() == TUMBLE_END)) || (selectNode.getKind() == SESSION)) || (selectNode.getKind() == SESSION_START)) || (selectNode.getKind() == SESSION_END)) || (selectNode.getKind() == HOP)) || (selectNode.getKind() == HOP_START)) || (selectNode.getKind() == HOP_END)) || (selectNode.getKind() == BETWEEN)) || (selectNode.getKind() == IS_NULL)) || (selectNode.getKind() == IS_NOT_NULL)) || (selectNode.getKind() == CONTAINS)) || (selectNode.getKind() == TIMESTAMP_ADD)) || (selectNode.getKind() == TIMESTAMP_DIFF)) || (selectNode.getKind() == LIKE)) {"> 453         } else if ((((((((((((((((((((((((((((AGGREGATE.contains(selectNode.getKind()) || AVG_AGG_FUNCTIO🔵</abbr></span>
<span class="1789264784310876595" onmouseenter="enter('1789264784310876595');" onmouseout="out('1789264784310876595');" style=""> 454             SqlBasicCall sqlBasicCall = ((SqlBasicCall) (selectNode));                                   </span>
<span class="-6461841638065859246" onmouseenter="enter('-6461841638065859246');" onmouseout="out('-6461841638065859246');" style=""> 455             for (int i = 0; i &lt; sqlBasicCall.getOperands().length; i++) {                                </span>
<span class="-6831609595517394087" onmouseenter="enter('-6831609595517394087');" onmouseout="out('-6831609595517394087');" style=""> 456                 SqlNode sqlNode = sqlBasicCall.getOperands()[i];                                         </span>
<span class="-4657964142739574978" onmouseenter="enter('-4657964142739574978');" onmouseout="out('-4657964142739574978');" style=""> 457                 if (sqlNode instanceof SqlLiteral) {                                                     </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 458                     continue;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 459                 }                                                                                        </span>
<span class="-4675155589595463501" onmouseenter="enter('-4675155589595463501');" onmouseout="out('-4675155589595463501');" style=""> 460                 if (sqlNode instanceof SqlDataTypeSpec) {                                                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 461                     continue;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 462                 }                                                                                        </span>
<span class="30158307191940159" onmouseenter="enter('30158307191940159');" onmouseout="out('30158307191940159');" style=""> 463                 extractSelectField(sqlNode, extractFieldSet, fromTableNameSet, tableRef);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 464             }                                                                                            </span>
<span class="6753725982943564752" onmouseenter="enter('6753725982943564752');" onmouseout="out('6753725982943564752');" style=""> 465         } else if (selectNode.getKind() == CASE) {                                                       </span>
<span class="-2316908184247217277" onmouseenter="enter('-2316908184247217277');" onmouseout="out('-2316908184247217277');" style=""> 466             SqlCase sqlCase = ((SqlCase) (selectNode));                                                  </span>
<span class="-3655271460728510010" onmouseenter="enter('-3655271460728510010');" onmouseout="out('-3655271460728510010');" style=""> 467             SqlNodeList whenOperands = sqlCase.getWhenOperands();                                        </span>
<span class="8318973293639639494" onmouseenter="enter('8318973293639639494');" onmouseout="out('8318973293639639494');" style=""> 468             SqlNodeList thenOperands = sqlCase.getThenOperands();                                        </span>
<span class="3014895614462197568" onmouseenter="enter('3014895614462197568');" onmouseout="out('3014895614462197568');" style=""> 469             SqlNode elseNode = sqlCase.getElseOperand();                                                 </span>
<span class="5804242455667685406" onmouseenter="enter('5804242455667685406');" onmouseout="out('5804242455667685406');" style=""> 470             for (int i = 0; i &lt; whenOperands.size(); i++) {                                              </span>
<span class="1734344807386881213" onmouseenter="enter('1734344807386881213');" onmouseout="out('1734344807386881213');" style=""> 471                 SqlNode oneOperand = whenOperands.get(i);                                                </span>
<span class="1407654974389323920" onmouseenter="enter('1407654974389323920');" onmouseout="out('1407654974389323920');" style=""> 472                 extractSelectField(oneOperand, extractFieldSet, fromTableNameSet, tableRef);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 473             }                                                                                            </span>
<span class="-7770933914215809062" onmouseenter="enter('-7770933914215809062');" onmouseout="out('-7770933914215809062');" style=""> 474             for (int i = 0; i &lt; thenOperands.size(); i++) {                                              </span>
<span class="-3989978989358262134" onmouseenter="enter('-3989978989358262134');" onmouseout="out('-3989978989358262134');" style=""> 475                 SqlNode oneOperand = thenOperands.get(i);                                                </span>
<span class="1407654974389323920" onmouseenter="enter('1407654974389323920');" onmouseout="out('1407654974389323920');" style=""> 476                 extractSelectField(oneOperand, extractFieldSet, fromTableNameSet, tableRef);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 477             }                                                                                            </span>
<span class="-1225911656205055173" onmouseenter="enter('-1225911656205055173');" onmouseout="out('-1225911656205055173');" style=""> 478             extractSelectField(elseNode, extractFieldSet, fromTableNameSet, tableRef);                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 479         } else {                                                                                         </span>
<span class="-6802310387761368139" onmouseenter="enter('-6802310387761368139');" onmouseout="out('-6802310387761368139');" style=""> 480             // do nothing                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 481         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 482     }                                                                                                    </span>
<span  style=""> 483                                                                                                          </span>
<span class="-4726182248391037649" onmouseenter="enter('-4726182248391037649');" onmouseout="out('-4726182248391037649');" style=""><abbr title=" 484     private Tuple2&lt;String, String&gt; parseRightNode(SqlNode sqlNode, Set&lt;String&gt; sideTableSet, Queue&lt;Object&gt; queueInfo, SqlNode parentWhere, SqlNodeList selectList, SqlNodeList parentGroupByList) {"> 484     private Tuple2&lt;String, String&gt; parseRightNode(SqlNode sqlNode, Set&lt;String&gt; sideTableSet, Queue&lt;Object🔵</abbr></span>
<span class="-7809629950828083535" onmouseenter="enter('-7809629950828083535');" onmouseout="out('-7809629950828083535');" style=""> 485         Tuple2&lt;String, String&gt; tabName = new Tuple2&lt;&gt;(&quot;&quot;, &quot;&quot;);                                           </span>
<span class="-8871371884329332565" onmouseenter="enter('-8871371884329332565');" onmouseout="out('-8871371884329332565');" style=""> 486         if (sqlNode.getKind() == IDENTIFIER) {                                                           </span>
<span class="-7735158387636601028" onmouseenter="enter('-7735158387636601028');" onmouseout="out('-7735158387636601028');" style=""> 487             tabName.f0 = sqlNode.toString();                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 488         } else {                                                                                         </span>
<span class="-1934360299828656646" onmouseenter="enter('-1934360299828656646');" onmouseout="out('-1934360299828656646');" style=""><abbr title=" 489             AliasInfo aliasInfo = ((AliasInfo) (sideSQLParser.parseSql(sqlNode, sideTableSet, queueInfo, parentWhere, selectList, parentGroupByList)));"> 489             AliasInfo aliasInfo = ((AliasInfo) (sideSQLParser.parseSql(sqlNode, sideTableSet, queueInfo, 🔵</abbr></span>
<span class="-7052196639543907068" onmouseenter="enter('-7052196639543907068');" onmouseout="out('-7052196639543907068');" style=""> 490             tabName.f0 = aliasInfo.getName();                                                            </span>
<span class="-2307032070137542057" onmouseenter="enter('-2307032070137542057');" onmouseout="out('-2307032070137542057');" style=""> 491             tabName.f1 = aliasInfo.getAlias();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492         }                                                                                                </span>
<span class="-6789109484485831180" onmouseenter="enter('-6789109484485831180');" onmouseout="out('-6789109484485831180');" style=""> 493         return tabName;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494     }                                                                                                    </span>
<span  style=""> 495                                                                                                          </span>
<span class="1768499303484569694" onmouseenter="enter('1768499303484569694');" onmouseout="out('1768499303484569694');" style=""> 496     private Tuple2&lt;String, String&gt; parseLeftNode(SqlNode sqlNode){                                       </span>
<span class="-7809629950828083535" onmouseenter="enter('-7809629950828083535');" onmouseout="out('-7809629950828083535');" style=""> 497         Tuple2&lt;String, String&gt; tabName = new Tuple2&lt;&gt;(&quot;&quot;, &quot;&quot;);                                           </span>
<span class="7570038518439211250" onmouseenter="enter('7570038518439211250');" onmouseout="out('7570038518439211250');" style=""> 498         if(sqlNode.getKind() == IDENTIFIER){                                                             </span>
<span class="-7735158387636601028" onmouseenter="enter('-7735158387636601028');" onmouseout="out('-7735158387636601028');" style=""> 499             tabName.f0 = sqlNode.toString();                                                             </span>
<span class="-6648818000206782174" onmouseenter="enter('-6648818000206782174');" onmouseout="out('-6648818000206782174');" style=""> 500             tabName.f1 = sqlNode.toString();                                                             </span>
<span class="7640894634328871584" onmouseenter="enter('7640894634328871584');" onmouseout="out('7640894634328871584');" style=""> 501         }else if (sqlNode.getKind() == AS){                                                              </span>
<span class="-4085054753182131209" onmouseenter="enter('-4085054753182131209');" onmouseout="out('-4085054753182131209');" style=""> 502             SqlNode info = ((SqlBasicCall)sqlNode).getOperands()[0];                                     </span>
<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style=""> 503             SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                                   </span>
<span  style=""> 504                                                                                                          </span>
<span class="6350181014025417708" onmouseenter="enter('6350181014025417708');" onmouseout="out('6350181014025417708');" style=""> 505             tabName.f0 = info.toString();                                                                </span>
<span class="-6499418961284910074" onmouseenter="enter('-6499418961284910074');" onmouseout="out('-6499418961284910074');" style=""> 506             tabName.f1 = alias.toString();                                                               </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 507         }else {                                                                                          </span>
<span class="-4528765899368294479" onmouseenter="enter('-4528765899368294479');" onmouseout="out('-4528765899368294479');" style=""> 508             throw new RuntimeException(&quot;&quot;);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 509         }                                                                                                </span>
<span  style=""> 510                                                                                                          </span>
<span class="-6789109484485831180" onmouseenter="enter('-6789109484485831180');" onmouseout="out('-6789109484485831180');" style=""> 511         return tabName;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 512     }                                                                                                    </span>
<span  style=""> 513                                                                                                          </span>
<span class="2221421009159751305" onmouseenter="enter('2221421009159751305');" onmouseout="out('2221421009159751305');" style=""> 514     public String buildCondition(List&lt;SqlBasicCall&gt; conditionList){                                      </span>
<span class="-4757924659479519527" onmouseenter="enter('-4757924659479519527');" onmouseout="out('-4757924659479519527');" style=""> 515         if(CollectionUtils.isEmpty(conditionList)){                                                      </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 516             return &quot;&quot;;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 517         }                                                                                                </span>
<span  style=""> 518                                                                                                          </span>
<span class="-8689756052096276488" onmouseenter="enter('-8689756052096276488');" onmouseout="out('-8689756052096276488');" style=""> 519         return &quot; where &quot; + StringUtils.join(conditionList, &quot; AND &quot;);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 520     }                                                                                                    </span>
<span  style=""> 521                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 522     /**                                                                                                  </span>
<span class="5006751944576812925" onmouseenter="enter('5006751944576812925');" onmouseout="out('5006751944576812925');" style=""> 523      * 构建抽取表的查询字段信息                                                                                      </span>
<span class="6846485922393067420" onmouseenter="enter('6846485922393067420');" onmouseout="out('6846485922393067420');" style=""> 524      * 包括去除重复字段，名称相同的取别名                                                                                 </span>
<span class="5143638493602795740" onmouseenter="enter('5143638493602795740');" onmouseout="out('5143638493602795740');" style=""> 525      * @param extractSelectField                                                                         </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style=""> 526      * @param joinFieldSet                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 527      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 528      */                                                                                                  </span>
<span class="-1598075909835527288" onmouseenter="enter('-1598075909835527288');" onmouseout="out('-1598075909835527288');" style=""> 529     public Set&lt;String&gt; buildSelectNode(Set&lt;String&gt; extractSelectField, Set&lt;String&gt; joinFieldSet) {       </span>
<span class="-7011479297295972095" onmouseenter="enter('-7011479297295972095');" onmouseout="out('-7011479297295972095');" style=""> 530         if (CollectionUtils.isEmpty(extractSelectField)) {                                               </span>
<span class="5868864582051651172" onmouseenter="enter('5868864582051651172');" onmouseout="out('5868864582051651172');" style=""> 531             throw new RuntimeException(&quot;no field is used&quot;);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 532         }                                                                                                </span>
<span class="5899553187345814636" onmouseenter="enter('5899553187345814636');" onmouseout="out('5899553187345814636');" style=""> 533         Sets.SetView&lt;String&gt; view = Sets.union(extractSelectField, joinFieldSet);                        </span>
<span class="797241606485232847" onmouseenter="enter('797241606485232847');" onmouseout="out('797241606485232847');" style=""> 534         Set&lt;String&gt; newFieldSet = Sets.newHashSet();                                                     </span>
<span class="-5300242693865658390" onmouseenter="enter('-5300242693865658390');" onmouseout="out('-5300242693865658390');" style=""> 535         // 为相同的列取别名                                                                                      </span>
<span class="8688032100713956589" onmouseenter="enter('8688032100713956589');" onmouseout="out('8688032100713956589');" style=""> 536         HashBiMap&lt;String, String&gt; refFieldMap = HashBiMap.create();                                      </span>
<span class="-5372021809536384331" onmouseenter="enter('-5372021809536384331');" onmouseout="out('-5372021809536384331');" style=""> 537         for (String field : view) {                                                                      </span>
<span class="-1968894175389259310" onmouseenter="enter('-1968894175389259310');" onmouseout="out('-1968894175389259310');" style=""> 538             String[] fieldInfo = StringUtils.split(field, &#x27;.&#x27;);                                          </span>
<span class="-8742203946899533370" onmouseenter="enter('-8742203946899533370');" onmouseout="out('-8742203946899533370');" style=""> 539             String aliasName = fieldInfo[1];                                                             </span>
<span class="5196316369925853718" onmouseenter="enter('5196316369925853718');" onmouseout="out('5196316369925853718');" style=""> 540             StringBuilder stringBuilder = new StringBuilder();                                           </span>
<span class="7892052963016733083" onmouseenter="enter('7892052963016733083');" onmouseout="out('7892052963016733083');" style=""> 541             stringBuilder.append(field);                                                                 </span>
<span class="1928235614932096831" onmouseenter="enter('1928235614932096831');" onmouseout="out('1928235614932096831');" style=""> 542             if (refFieldMap.inverse().get(aliasName) != null) {                                          </span>
<span class="3911751569834415230" onmouseenter="enter('3911751569834415230');" onmouseout="out('3911751569834415230');" style=""> 543                 aliasName = ParseUtils.dealDuplicateFieldName(refFieldMap, aliasName);                   </span>
<span class="2589539870079279834" onmouseenter="enter('2589539870079279834');" onmouseout="out('2589539870079279834');" style=""> 544                 stringBuilder.append(&quot; as &quot;).append(aliasName);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 545             }                                                                                            </span>
<span class="3161846128983396458" onmouseenter="enter('3161846128983396458');" onmouseout="out('3161846128983396458');" style=""> 546             refFieldMap.put(field, aliasName);                                                           </span>
<span class="1307446912208510489" onmouseenter="enter('1307446912208510489');" onmouseout="out('1307446912208510489');" style=""> 547             newFieldSet.add(stringBuilder.toString());                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 548         }                                                                                                </span>
<span class="-4429217721906814107" onmouseenter="enter('-4429217721906814107');" onmouseout="out('-4429217721906814107');" style=""> 549         return newFieldSet;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 550     }                                                                                                    </span>
<span  style=""> 551                                                                                                          </span>
<span class="4243587240101238542" onmouseenter="enter('4243587240101238542');" onmouseout="out('4243587240101238542');" style=""> 552     private boolean checkIsSideTable(String tableName, Set&lt;String&gt; sideTableList){                       </span>
<span class="7734723301291741274" onmouseenter="enter('7734723301291741274');" onmouseout="out('7734723301291741274');" style=""> 553         if(sideTableList.contains(tableName)){                                                           </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 554             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 555         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 556         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 557     }                                                                                                    </span>
<span  style=""> 558                                                                                                          </span>
<span class="-8109971872323514495" onmouseenter="enter('-8109971872323514495');" onmouseout="out('-8109971872323514495');" style=""> 559     private SqlBasicCall buildAsSqlNode(String internalTableName, SqlNode newSource) {                   </span>
<span class="2981236818393294037" onmouseenter="enter('2981236818393294037');" onmouseout="out('2981236818393294037');" style=""> 560         SqlOperator operator = new SqlAsOperator();                                                      </span>
<span class="-1667801166019875282" onmouseenter="enter('-1667801166019875282');" onmouseout="out('-1667801166019875282');" style=""> 561         SqlParserPos sqlParserPos = new SqlParserPos(0, 0);                                              </span>
<span class="8198536898736028280" onmouseenter="enter('8198536898736028280');" onmouseout="out('8198536898736028280');" style=""> 562         SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(internalTableName, null, sqlParserPos);     </span>
<span class="-7310412248425019303" onmouseenter="enter('-7310412248425019303');" onmouseout="out('-7310412248425019303');" style=""> 563         SqlNode[] sqlNodes = new SqlNode[2];                                                             </span>
<span class="2025970151619105195" onmouseenter="enter('2025970151619105195');" onmouseout="out('2025970151619105195');" style=""> 564         sqlNodes[0] = newSource;                                                                         </span>
<span class="-4093556188235461327" onmouseenter="enter('-4093556188235461327');" onmouseout="out('-4093556188235461327');" style=""> 565         sqlNodes[1] = sqlIdentifierAlias;                                                                </span>
<span class="-1928364106966605511" onmouseenter="enter('-1928364106966605511');" onmouseout="out('-1928364106966605511');" style=""> 566         return new SqlBasicCall(operator, sqlNodes, sqlParserPos);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 567     }                                                                                                    </span>
<span  style=""> 568                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 569     /**                                                                                                  </span>
<span class="-7510152128791177313" onmouseenter="enter('-7510152128791177313');" onmouseout="out('-7510152128791177313');" style=""> 570      * 获取where中和指定表有关联的字段                                                                                </span>
<span class="-6365101737408851156" onmouseenter="enter('-6365101737408851156');" onmouseout="out('-6365101737408851156');" style=""> 571      * @param fromTableNameSet                                                                           </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 572      * @param parentWhere                                                                                </span>
<span class="-2506765310601959421" onmouseenter="enter('-2506765310601959421');" onmouseout="out('-2506765310601959421');" style=""> 573      * @param extractCondition                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 574      */                                                                                                  </span>
<span class="1461432174075439627" onmouseenter="enter('1461432174075439627');" onmouseout="out('1461432174075439627');" style=""><abbr title=" 575     private void extractWhereCondition(Set&lt;String&gt; fromTableNameSet, SqlBasicCall parentWhere, Set&lt;String&gt; extractCondition){"> 575     private void extractWhereCondition(Set&lt;String&gt; fromTableNameSet, SqlBasicCall parentWhere, Set&lt;String🔵</abbr></span>
<span  style=""> 576                                                                                                          </span>
<span class="-7344361739038630250" onmouseenter="enter('-7344361739038630250');" onmouseout="out('-7344361739038630250');" style=""> 577         if(parentWhere == null){                                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 578             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 579         }                                                                                                </span>
<span  style=""> 580                                                                                                          </span>
<span class="7198030462908925381" onmouseenter="enter('7198030462908925381');" onmouseout="out('7198030462908925381');" style=""> 581         SqlKind kind = parentWhere.getKind();                                                            </span>
<span class="-1872623569752802183" onmouseenter="enter('-1872623569752802183');" onmouseout="out('-1872623569752802183');" style=""> 582         if(kind == AND){                                                                                 </span>
<span class="-4193978700874903441" onmouseenter="enter('-4193978700874903441');" onmouseout="out('-4193978700874903441');" style=""><abbr title=" 583             extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[0], extractCondition);"> 583             extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[0], extractC🔵</abbr></span>
<span class="8237513597398016508" onmouseenter="enter('8237513597398016508');" onmouseout="out('8237513597398016508');" style=""><abbr title=" 584             extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[1], extractCondition);"> 584             extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[1], extractC🔵</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 585         } else {                                                                                         </span>
<span  style=""> 586                                                                                                          </span>
<span class="6559819810856557747" onmouseenter="enter('6559819810856557747');" onmouseout="out('6559819810856557747');" style=""> 587             Set&lt;String&gt; fieldInfos = Sets.newHashSet();                                                  </span>
<span class="-8171369927933096656" onmouseenter="enter('-8171369927933096656');" onmouseout="out('-8171369927933096656');" style=""> 588             TableUtils.getConditionRefTable(parentWhere, fieldInfos);                                    </span>
<span class="-4461527983639478234" onmouseenter="enter('-4461527983639478234');" onmouseout="out('-4461527983639478234');" style=""> 589             fieldInfos.forEach(fieldInfo -&gt; {                                                            </span>
<span class="4976250547552714974" onmouseenter="enter('4976250547552714974');" onmouseout="out('4976250547552714974');" style=""> 590                 String[] splitInfo = StringUtils.split(fieldInfo, &quot;.&quot;);                                  </span>
<span class="-9163656437830109655" onmouseenter="enter('-9163656437830109655');" onmouseout="out('-9163656437830109655');" style=""> 591                 if(splitInfo.length == 2 &amp;&amp; fromTableNameSet.contains(splitInfo[0])){                    </span>
<span class="7162103078043141858" onmouseenter="enter('7162103078043141858');" onmouseout="out('7162103078043141858');" style=""> 592                     extractCondition.add(fieldInfo);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 593                 }                                                                                        </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 594             });                                                                                          </span>
<span  style=""> 595                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 596         }                                                                                                </span>
<span  style=""> 597                                                                                                          </span>
<span  style=""> 598                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 599     }                                                                                                    </span>
<span  style=""> 600                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 601     /**                                                                                                  </span>
<span class="-74598125528384596" onmouseenter="enter('-74598125528384596');" onmouseout="out('-74598125528384596');" style=""> 602      * 检查关联的where 条件中的判断是否可以下移到新构建的子查询                                                                   </span>
<span class="-6365101737408851156" onmouseenter="enter('-6365101737408851156');" onmouseout="out('-6365101737408851156');" style=""> 603      * @param fromTableNameSet                                                                           </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 604      * @param parentWhere                                                                                </span>
<span class="-2506765310601959421" onmouseenter="enter('-2506765310601959421');" onmouseout="out('-2506765310601959421');" style=""> 605      * @param extractCondition                                                                           </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 606      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 607      */                                                                                                  </span>
<span class="6635312442318966962" onmouseenter="enter('6635312442318966962');" onmouseout="out('6635312442318966962');" style=""><abbr title=" 608     private boolean checkAndRemoveWhereCondition(Set&lt;String&gt; fromTableNameSet, SqlBasicCall parentWhere, List&lt;SqlBasicCall&gt; extractCondition) {"> 608     private boolean checkAndRemoveWhereCondition(Set&lt;String&gt; fromTableNameSet, SqlBasicCall parentWhere, 🔵</abbr></span>
<span class="-1403628267492113152" onmouseenter="enter('-1403628267492113152');" onmouseout="out('-1403628267492113152');" style=""> 609         if (parentWhere == null) {                                                                       </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 610             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 611         }                                                                                                </span>
<span class="7198030462908925381" onmouseenter="enter('7198030462908925381');" onmouseout="out('7198030462908925381');" style=""> 612         SqlKind kind = parentWhere.getKind();                                                            </span>
<span class="6696031952137180535" onmouseenter="enter('6696031952137180535');" onmouseout="out('6696031952137180535');" style=""> 613         if (kind == AND) {                                                                               </span>
<span class="5647510006577576784" onmouseenter="enter('5647510006577576784');" onmouseout="out('5647510006577576784');" style=""><abbr title=" 614             boolean removeLeft = checkAndRemoveWhereCondition(fromTableNameSet, ((SqlBasicCall) (parentWhere.getOperands()[0])), extractCondition);"> 614             boolean removeLeft = checkAndRemoveWhereCondition(fromTableNameSet, ((SqlBasicCall) (parentWh🔵</abbr></span>
<span class="-7899642393759288122" onmouseenter="enter('-7899642393759288122');" onmouseout="out('-7899642393759288122');" style=""><abbr title=" 615             boolean removeRight = checkAndRemoveWhereCondition(fromTableNameSet, ((SqlBasicCall) (parentWhere.getOperands()[1])), extractCondition);"> 615             boolean removeRight = checkAndRemoveWhereCondition(fromTableNameSet, ((SqlBasicCall) (parentW🔵</abbr></span>
<span class="-6050076837005966597" onmouseenter="enter('-6050076837005966597');" onmouseout="out('-6050076837005966597');" style=""> 616             // DO remove                                                                                 </span>
<span class="-6643186241285891075" onmouseenter="enter('-6643186241285891075');" onmouseout="out('-6643186241285891075');" style=""> 617             if (removeLeft) {                                                                            </span>
<span class="5619021625980792664" onmouseenter="enter('5619021625980792664');" onmouseout="out('5619021625980792664');" style=""> 618                 extractCondition.add(removeWhereConditionNode(parentWhere, 0));                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 619             }                                                                                            </span>
<span class="-4118333578800298375" onmouseenter="enter('-4118333578800298375');" onmouseout="out('-4118333578800298375');" style=""> 620             if (removeRight) {                                                                           </span>
<span class="-3233327769126268813" onmouseenter="enter('-3233327769126268813');" onmouseout="out('-3233327769126268813');" style=""> 621                 extractCondition.add(removeWhereConditionNode(parentWhere, 1));                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 622             }                                                                                            </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 623             return false;                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 624         } else {                                                                                         </span>
<span class="4824334365779021613" onmouseenter="enter('4824334365779021613');" onmouseout="out('4824334365779021613');" style=""> 625             // 条件表达式，如果该条件关联的表都是指定的表则移除                                                                  </span>
<span class="6559819810856557747" onmouseenter="enter('6559819810856557747');" onmouseout="out('6559819810856557747');" style=""> 626             Set&lt;String&gt; fieldInfos = Sets.newHashSet();                                                  </span>
<span class="-8171369927933096656" onmouseenter="enter('-8171369927933096656');" onmouseout="out('-8171369927933096656');" style=""> 627             TableUtils.getConditionRefTable(parentWhere, fieldInfos);                                    </span>
<span class="2827886728692945898" onmouseenter="enter('2827886728692945898');" onmouseout="out('2827886728692945898');" style=""> 628             Set&lt;String&gt; conditionRefTableNameSet = Sets.newHashSet();                                    </span>
<span class="-2050084179869927435" onmouseenter="enter('-2050084179869927435');" onmouseout="out('-2050084179869927435');" style=""> 629             fieldInfos.forEach(( fieldInfo) -&gt; {                                                         </span>
<span class="4976250547552714974" onmouseenter="enter('4976250547552714974');" onmouseout="out('4976250547552714974');" style=""> 630                 String[] splitInfo = StringUtils.split(fieldInfo, &quot;.&quot;);                                  </span>
<span class="7852641687551006291" onmouseenter="enter('7852641687551006291');" onmouseout="out('7852641687551006291');" style=""> 631                 if (splitInfo.length == 2) {                                                             </span>
<span class="-1599449602125672029" onmouseenter="enter('-1599449602125672029');" onmouseout="out('-1599449602125672029');" style=""> 632                     conditionRefTableNameSet.add(splitInfo[0]);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 633                 }                                                                                        </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 634             });                                                                                          </span>
<span class="-8315683668948259049" onmouseenter="enter('-8315683668948259049');" onmouseout="out('-8315683668948259049');" style=""> 635             if (fromTableNameSet.containsAll(conditionRefTableNameSet)) {                                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 636                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 637             }                                                                                            </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 638             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 639         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 640     }                                                                                                    </span>
<span  style=""> 641                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 642     /**                                                                                                  </span>
<span class="967733528902221289" onmouseenter="enter('967733528902221289');" onmouseout="out('967733528902221289');" style=""> 643      * 抽取where 条件中指定的条件                                                                                  </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 644      * @param parentWhere                                                                                </span>
<span class="-460759719067432320" onmouseenter="enter('-460759719067432320');" onmouseout="out('-460759719067432320');" style=""> 645      * @param index                                                                                      </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 646      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 647      */                                                                                                  </span>
<span class="-8004122385362241836" onmouseenter="enter('-8004122385362241836');" onmouseout="out('-8004122385362241836');" style=""> 648     public SqlBasicCall removeWhereConditionNode(SqlBasicCall parentWhere, int index){                   </span>
<span class="2911889278610374450" onmouseenter="enter('2911889278610374450');" onmouseout="out('2911889278610374450');" style=""> 649         SqlBasicCall oldCondition = (SqlBasicCall) parentWhere.getOperands()[index];                     </span>
<span class="3156064786234930120" onmouseenter="enter('3156064786234930120');" onmouseout="out('3156064786234930120');" style=""> 650         parentWhere.setOperand(index, buildEmptyCondition());                                            </span>
<span class="-6343538087515378636" onmouseenter="enter('-6343538087515378636');" onmouseout="out('-6343538087515378636');" style=""> 651         return oldCondition;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 652     }                                                                                                    </span>
<span  style=""> 653                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 654     /**                                                                                                  </span>
<span class="-6739953174199833520" onmouseenter="enter('-6739953174199833520');" onmouseout="out('-6739953174199833520');" style=""> 655      * 构建 1=1的 where 条件                                                                                  </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 656      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 657      */                                                                                                  </span>
<span class="-4073514796854358980" onmouseenter="enter('-4073514796854358980');" onmouseout="out('-4073514796854358980');" style=""> 658     public SqlBasicCall buildEmptyCondition(){                                                           </span>
<span class="7737073508893451149" onmouseenter="enter('7737073508893451149');" onmouseout="out('7737073508893451149');" style=""> 659         SqlBinaryOperator equalsOperators = SqlStdOperatorTable.EQUALS;                                  </span>
<span class="-6629769419150459383" onmouseenter="enter('-6629769419150459383');" onmouseout="out('-6629769419150459383');" style=""> 660         SqlNode[] operands = new SqlNode[2];                                                             </span>
<span class="7829210030518325331" onmouseenter="enter('7829210030518325331');" onmouseout="out('7829210030518325331');" style=""> 661         operands[0] = SqlLiteral.createExactNumeric(&quot;1&quot;, SqlParserPos.ZERO);                             </span>
<span class="8653141241037221613" onmouseenter="enter('8653141241037221613');" onmouseout="out('8653141241037221613');" style=""> 662         operands[1] = SqlLiteral.createExactNumeric(&quot;1&quot;, SqlParserPos.ZERO);                             </span>
<span  style=""> 663                                                                                                          </span>
<span class="-886608164186614965" onmouseenter="enter('-886608164186614965');" onmouseout="out('-886608164186614965');" style=""> 664         return new SqlBasicCall(equalsOperators, operands, SqlParserPos.ZERO);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 665     }                                                                                                    </span>
<span  style=""> 666                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 667     /**                                                                                                  </span>
<span class="6566659164166093473" onmouseenter="enter('6566659164166093473');" onmouseout="out('6566659164166093473');" style=""> 668      * 替换join 条件中的表名称                                                                                    </span>
<span class="384197096128287152" onmouseenter="enter('384197096128287152');" onmouseout="out('384197096128287152');" style=""> 669      * @param node                                                                                       </span>
<span class="1832696003310156507" onmouseenter="enter('1832696003310156507');" onmouseout="out('1832696003310156507');" style=""> 670      * @param tableMap 表名的关联关系                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 671      */                                                                                                  </span>
<span class="8926761967375059586" onmouseenter="enter('8926761967375059586');" onmouseout="out('8926761967375059586');" style=""> 672     private SqlIdentifier checkAndReplaceJoinCondition(SqlNode node, Map&lt;String, String&gt; tableMap){      </span>
<span  style=""> 673                                                                                                          </span>
<span class="-4460996797142447051" onmouseenter="enter('-4460996797142447051');" onmouseout="out('-4460996797142447051');" style=""> 674         SqlKind joinKind = node.getKind();                                                               </span>
<span class="6904180996725590590" onmouseenter="enter('6904180996725590590');" onmouseout="out('6904180996725590590');" style=""> 675         if( joinKind == AND || joinKind == EQUALS ){                                                     </span>
<span class="-5502960919920628784" onmouseenter="enter('-5502960919920628784');" onmouseout="out('-5502960919920628784');" style=""><abbr title=" 676             SqlIdentifier leftNode = checkAndReplaceJoinCondition(((SqlBasicCall)node).operands[0], tableMap);"> 676             SqlIdentifier leftNode = checkAndReplaceJoinCondition(((SqlBasicCall)node).operands[0], table🔵</abbr></span>
<span class="-1134508213250580541" onmouseenter="enter('-1134508213250580541');" onmouseout="out('-1134508213250580541');" style=""><abbr title=" 677             SqlIdentifier rightNode = checkAndReplaceJoinCondition(((SqlBasicCall)node).operands[1], tableMap);"> 677             SqlIdentifier rightNode = checkAndReplaceJoinCondition(((SqlBasicCall)node).operands[1], tabl🔵</abbr></span>
<span  style=""> 678                                                                                                          </span>
<span class="1261032046064330806" onmouseenter="enter('1261032046064330806');" onmouseout="out('1261032046064330806');" style=""> 679             if(leftNode != null){                                                                        </span>
<span class="7925883472313959466" onmouseenter="enter('7925883472313959466');" onmouseout="out('7925883472313959466');" style=""> 680                 ((SqlBasicCall)node).setOperand(0, leftNode);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 681             }                                                                                            </span>
<span  style=""> 682                                                                                                          </span>
<span class="-5287428749677694788" onmouseenter="enter('-5287428749677694788');" onmouseout="out('-5287428749677694788');" style=""> 683             if(rightNode != null){                                                                       </span>
<span class="-6758558001428237557" onmouseenter="enter('-6758558001428237557');" onmouseout="out('-6758558001428237557');" style=""> 684                 ((SqlBasicCall)node).setOperand(1, leftNode);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 685             }                                                                                            </span>
<span  style=""> 686                                                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 687             return null;                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 688         } else {                                                                                         </span>
<span class="2603254540286226339" onmouseenter="enter('2603254540286226339');" onmouseout="out('2603254540286226339');" style=""> 689             //replace table                                                                              </span>
<span class="-7283729608735687376" onmouseenter="enter('-7283729608735687376');" onmouseout="out('-7283729608735687376');" style=""><abbr title=" 690             Preconditions.checkState(((SqlIdentifier)node).names.size() == 2, &quot;join condition must be format table.field&quot;);"> 690             Preconditions.checkState(((SqlIdentifier)node).names.size() == 2, &quot;join condition must be for🔵</abbr></span>
<span class="5830077366186139259" onmouseenter="enter('5830077366186139259');" onmouseout="out('5830077366186139259');" style=""> 691             String tbName = ((SqlIdentifier) node).names.get(0);                                         </span>
<span class="807909526670811479" onmouseenter="enter('807909526670811479');" onmouseout="out('807909526670811479');" style=""> 692             if(tableMap.containsKey(tbName)){                                                            </span>
<span class="-5261902895497527633" onmouseenter="enter('-5261902895497527633');" onmouseout="out('-5261902895497527633');" style=""> 693                 tbName = tableMap.get(tbName);                                                           </span>
<span class="6671350446806430567" onmouseenter="enter('6671350446806430567');" onmouseout="out('6671350446806430567');" style=""> 694                 return ((SqlIdentifier) node).setName(0, tbName);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 695             }                                                                                            </span>
<span  style=""> 696                                                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 697             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 698         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 699     }                                                                                                    </span>
<span  style=""> 700                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 701     /**                                                                                                  </span>
<span class="-582093827946699422" onmouseenter="enter('-582093827946699422');" onmouseout="out('-582093827946699422');" style=""> 702      * 解析出临时中间表的属性列和源表之间的关系                                                                              </span>
<span class="-1738998936074699450" onmouseenter="enter('-1738998936074699450');" onmouseout="out('-1738998936074699450');" style=""> 703      * @param fieldSet                                                                                   </span>
<span class="-1251790622416547945" onmouseenter="enter('-1251790622416547945');" onmouseout="out('-1251790622416547945');" style=""> 704      * @param newTableAliasName                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 705      */                                                                                                  </span>
<span class="-8784345461796351735" onmouseenter="enter('-8784345461796351735');" onmouseout="out('-8784345461796351735');" style=""><abbr title=" 706     public Map&lt;String, String&gt; buildTmpTableFieldRefOriField(Set&lt;String&gt; fieldSet, String newTableAliasName){"> 706     public Map&lt;String, String&gt; buildTmpTableFieldRefOriField(Set&lt;String&gt; fieldSet, String newTableAliasNa🔵</abbr></span>
<span class="-5385725062618077806" onmouseenter="enter('-5385725062618077806');" onmouseout="out('-5385725062618077806');" style=""> 707         Map&lt;String, String&gt; refInfo = Maps.newConcurrentMap();                                           </span>
<span class="2568903137449276094" onmouseenter="enter('2568903137449276094');" onmouseout="out('2568903137449276094');" style=""> 708         for(String field : fieldSet){                                                                    </span>
<span class="-7222334792573134755" onmouseenter="enter('-7222334792573134755');" onmouseout="out('-7222334792573134755');" style=""> 709             String[] fields = StringUtils.splitByWholeSeparator(field, &quot;as&quot;);                            </span>
<span class="2626056789923691030" onmouseenter="enter('2626056789923691030');" onmouseout="out('2626056789923691030');" style=""> 710             String oldKey = field;                                                                       </span>
<span class="-5195760423326791334" onmouseenter="enter('-5195760423326791334');" onmouseout="out('-5195760423326791334');" style=""> 711             String[] oldFieldInfo = StringUtils.splitByWholeSeparator(fields[0], &quot;.&quot;);                   </span>
<span class="7999505930284522125" onmouseenter="enter('7999505930284522125');" onmouseout="out('7999505930284522125');" style=""> 712             String oldFieldName = oldFieldInfo.length == 2 ? oldFieldInfo[1] : oldFieldInfo[0];          </span>
<span class="-6597088482986838827" onmouseenter="enter('-6597088482986838827');" onmouseout="out('-6597088482986838827');" style=""> 713             String newKey = fields.length == 2 ? newTableAliasName + &quot;.&quot; + fields[1] :                   </span>
<span class="-4119680836077812037" onmouseenter="enter('-4119680836077812037');" onmouseout="out('-4119680836077812037');" style=""> 714                     newTableAliasName + &quot;.&quot; + oldFieldName;                                              </span>
<span class="-3733750508357987129" onmouseenter="enter('-3733750508357987129');" onmouseout="out('-3733750508357987129');" style=""> 715             refInfo.put(oldKey, newKey);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 716         }                                                                                                </span>
<span  style=""> 717                                                                                                          </span>
<span class="8147181196901690092" onmouseenter="enter('8147181196901690092');" onmouseout="out('8147181196901690092');" style=""> 718         return refInfo;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 719     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 720 }                                                                                                        </span>






















































































































































































































































































































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  20  package com.dtstack.flink.sql.side;                                                                               </span>
<span  style="">  21                                                                                                                    </span>
<span class="8446286977962994340" onmouseenter="enter('8446286977962994340');" onmouseout="out('8446286977962994340');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  22 -import com.dtstack.flink.sql.config.CalciteConfig;                                                                </span>
<span class="-283888887417937620" onmouseenter="enter('-283888887417937620');" onmouseout="out('-283888887417937620');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  23 +import com.dtstack.flink.sql.parser.FlinkPlanner;                                                                 </span>
<span class="-4585055968129153397" onmouseenter="enter('-4585055968129153397');" onmouseout="out('-4585055968129153397');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  24 +import com.dtstack.flink.sql.util.ParseUtils;                                                                     </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  25  import com.dtstack.flink.sql.util.TableUtils;                                                                     </span>

<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  26  import com.google.common.base.Preconditions;                                                                      </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  27 -import com.google.common.collect.Lists;                                                                           </span>
<span class="6390139568718476113" onmouseenter="enter('6390139568718476113');" onmouseout="out('6390139568718476113');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  28 -import com.google.common.collect.Sets;                                                                            </span>
<span class="1793459060364841943" onmouseenter="enter('1793459060364841943');" onmouseout="out('1793459060364841943');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  29 +import com.google.common.collect.*;                                                                               </span>
<span class="8584998077480306668" onmouseenter="enter('8584998077480306668');" onmouseout="out('8584998077480306668');" style="">  30  import org.apache.calcite.sql.JoinType;                                                                           </span>
<span class="-6347312057640942811" onmouseenter="enter('-6347312057640942811');" onmouseout="out('-6347312057640942811');" style="">  31  import org.apache.calcite.sql.SqlAsOperator;                                                                      </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  32  import org.apache.calcite.sql.SqlBasicCall;                                                                       </span>
<span class="5864552825243215550" onmouseenter="enter('5864552825243215550');" onmouseout="out('5864552825243215550');" style="">  33  import org.apache.calcite.sql.SqlBinaryOperator;                                                                  </span>
<span class="166699767162158130" onmouseenter="enter('166699767162158130');" onmouseout="out('166699767162158130');" style="">  34  import org.apache.calcite.sql.SqlDataTypeSpec;                                                                    </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  35  import org.apache.calcite.sql.SqlIdentifier;                                                                      </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  36  import org.apache.calcite.sql.SqlJoin;                                                                            </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  37  import org.apache.calcite.sql.SqlKind;                                                                            </span>
<span class="8852969977988754364" onmouseenter="enter('8852969977988754364');" onmouseout="out('8852969977988754364');" style="">  38  import org.apache.calcite.sql.SqlLiteral;                                                                         </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  39  import org.apache.calcite.sql.SqlNode;                                                                            </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  40  import org.apache.calcite.sql.SqlNodeList;                                                                        </span>
<span class="2919518510870551176" onmouseenter="enter('2919518510870551176');" onmouseout="out('2919518510870551176');" style="">  41  import org.apache.calcite.sql.SqlOperator;                                                                        </span>
<span class="7522331514027736252" onmouseenter="enter('7522331514027736252');" onmouseout="out('7522331514027736252');" style="">  42  import org.apache.calcite.sql.fun.SqlCase;                                                                        </span>
<span class="5604125466397600003" onmouseenter="enter('5604125466397600003');" onmouseout="out('5604125466397600003');" style="">  43  import org.apache.calcite.sql.fun.SqlStdOperatorTable;                                                            </span>
<span class="1277226550340008522" onmouseenter="enter('1277226550340008522');" onmouseout="out('1277226550340008522');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  44 -import org.apache.calcite.sql.parser.SqlParser;                                                                   </span>
<span class="-8475519504744506507" onmouseenter="enter('-8475519504744506507');" onmouseout="out('-8475519504744506507');" style="">  45  import org.apache.calcite.sql.parser.SqlParserPos;                                                                </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  46  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  47  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  48  import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="-3548577539000853351" onmouseenter="enter('-3548577539000853351');" onmouseout="out('-3548577539000853351');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  49 +import org.apache.flink.table.calcite.FlinkPlannerImpl;                                                           </span>
<span  style="">  50                                                                                                                    </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  51  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  52  import java.util.Map;                                                                                             </span>
<span class="-2789246819365843415" onmouseenter="enter('-2789246819365843415');" onmouseout="out('-2789246819365843415');" style="">  53  import java.util.Queue;                                                                                           </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  54  import java.util.Set;                                                                                             </span>
<span  style="">  55                                                                                                                    </span>
<span class="7147213704442467623" onmouseenter="enter('7147213704442467623');" onmouseout="out('7147213704442467623');" style="">  56  import static org.apache.calcite.sql.SqlKind.*;                                                                   </span>
<span  style="">  57                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  58  /**                                                                                                               </span>
<span class="-4563013574845795077" onmouseenter="enter('-4563013574845795077');" onmouseout="out('-4563013574845795077');" style="">  59   * 处理join 节点                                                                                                      </span>
<span class="8838344550496049683" onmouseenter="enter('8838344550496049683');" onmouseout="out('8838344550496049683');" style="">  60   * 1:如果包含维表节点替换为临时查询                                                                                              </span>
<span class="-7758652626234959796" onmouseenter="enter('-7758652626234959796');" onmouseout="out('-7758652626234959796');" style="">  61   * Date: 2020/2/27                                                                                                </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  62   * Company: www.dtstack.com                                                                                       </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  63   * @author xuchao                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  64   */                                                                                                               </span>
<span  style="">  65                                                                                                                    </span>
<span class="-8466270758182619990" onmouseenter="enter('-8466270758182619990');" onmouseout="out('-8466270758182619990');" style="">  66  public class JoinNodeDealer {                                                                                     </span>
<span  style="">  67                                                                                                                    </span>
<span class="8212789117715876957" onmouseenter="enter('8212789117715876957');" onmouseout="out('8212789117715876957');" style="">  68      //用来构建临时的中间查询                                                                                                 </span>
<span class="7730461828310962384" onmouseenter="enter('7730461828310962384');" onmouseout="out('7730461828310962384');" style="">  69      private static final String SELECT_TEMP_SQL = &quot;select %s from %s %s&quot;;                                         </span>
<span  style="">  70                                                                                                                    </span>
<span class="-2249026806703256771" onmouseenter="enter('-2249026806703256771');" onmouseout="out('-2249026806703256771');" style="">  71      private SideSQLParser sideSQLParser;                                                                          </span>
<span  style="">  72                                                                                                                    </span>
<span class="-3616611273672037444" onmouseenter="enter('-3616611273672037444');" onmouseout="out('-3616611273672037444');" style="">  73      public JoinNodeDealer(SideSQLParser sideSQLParser){                                                           </span>
<span class="1661690928916125634" onmouseenter="enter('1661690928916125634');" onmouseout="out('1661690928916125634');" style="">  74          this.sideSQLParser = sideSQLParser;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  75      }                                                                                                             </span>
<span  style="">  76                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  77      /**                                                                                                           </span>
<span class="5343191871470402950" onmouseenter="enter('5343191871470402950');" onmouseout="out('5343191871470402950');" style="">  78       * 解析 join 操作                                                                                                 </span>
<span class="-2995351136134268537" onmouseenter="enter('-2995351136134268537');" onmouseout="out('-2995351136134268537');" style="">  79       * @param joinNode                                                                                            </span>
<span class="4073180356368850460" onmouseenter="enter('4073180356368850460');" onmouseout="out('4073180356368850460');" style="">  80       * @param sideTableSet 标明哪些表名是维表                                                                              </span>
<span class="3894561521416724418" onmouseenter="enter('3894561521416724418');" onmouseout="out('3894561521416724418');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  81 -     * @param queueInfo                                                                                           </span>
<span class="-1350333652466574225" onmouseenter="enter('-1350333652466574225');" onmouseout="out('-1350333652466574225');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  82 +     * @param queueInfo sql执行队列                                                                                   </span>
<span class="-789269741895746259" onmouseenter="enter('-789269741895746259');" onmouseout="out('-789269741895746259');" style="">  83       * @param parentWhere join 关联的最上层的where 节点                                                                    </span>
<span class="2915402449338812450" onmouseenter="enter('2915402449338812450');" onmouseout="out('2915402449338812450');" style="">  84       * @param parentSelectList join 关联的最上层的select 节点                                                              </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style="">  85       * @param joinFieldSet                                                                                        </span>
<span class="6609942655811766869" onmouseenter="enter('6609942655811766869');" onmouseout="out('6609942655811766869');" style="">  86       * @param tableRef 存储构建临时表查询后源表和新表之间的关联关系                                                                     </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="">  87       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  88       */                                                                                                           </span>
<span class="-5731275987813345912" onmouseenter="enter('-5731275987813345912');" onmouseout="out('-5731275987813345912');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  89 -    public JoinInfo dealJoinNode(SqlJoin joinNode, Set&lt;String&gt; sideTableSet,                                      </span>
<span class="1807555890431133112" onmouseenter="enter('1807555890431133112');" onmouseout="out('1807555890431133112');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  90 -                                 Queue&lt;Object&gt; queueInfo, SqlNode parentWhere,                                    </span>
<span class="-5840403863552999042" onmouseenter="enter('-5840403863552999042');" onmouseout="out('-5840403863552999042');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  91 -                                 SqlNodeList parentSelectList, Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,          </span>
<span class="-2463002192605516314" onmouseenter="enter('-2463002192605516314');" onmouseout="out('-2463002192605516314');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  92 -                                 Map&lt;String, String&gt; tableRef) {                                                  </span>
<span class="-2679967316725886886" onmouseenter="enter('-2679967316725886886');" onmouseout="out('-2679967316725886886');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  93 +    public JoinInfo dealJoinNode(SqlJoin joinNode,                                                                </span>
<span class="-1952250395521254109" onmouseenter="enter('-1952250395521254109');" onmouseout="out('-1952250395521254109');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  94 +                                 Set&lt;String&gt; sideTableSet,                                                        </span>
<span class="405358965608327863" onmouseenter="enter('405358965608327863');" onmouseout="out('405358965608327863');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  95 +                                 Queue&lt;Object&gt; queueInfo,                                                         </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  96 +                                 SqlNode parentWhere,                                                             </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +                                 SqlNodeList parentSelectList,                                                    </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +                                 SqlNodeList parentGroupByList,                                                   </span>
<span class="221219844685559650" onmouseenter="enter('221219844685559650');" onmouseout="out('221219844685559650');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +                                 Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,                                        </span>
<span class="8208018358691263022" onmouseenter="enter('8208018358691263022');" onmouseout="out('8208018358691263022');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +                                 Map&lt;String, String&gt; tableRef,                                                    </span>
<span class="-1320024569211882427" onmouseenter="enter('-1320024569211882427');" onmouseout="out('-1320024569211882427');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +                                 Map&lt;String, String&gt; fieldRef) {                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +                                                                                                                  </span>
<span class="338082450955407251" onmouseenter="enter('338082450955407251');" onmouseout="out('338082450955407251');" style=""> 103          SqlNode leftNode = joinNode.getLeft();                                                                    </span>
<span class="6077141851454171925" onmouseenter="enter('6077141851454171925');" onmouseout="out('6077141851454171925');" style=""> 104          SqlNode rightNode = joinNode.getRight();                                                                  </span>
<span class="3771731584459985741" onmouseenter="enter('3771731584459985741');" onmouseout="out('3771731584459985741');" style=""> 105          JoinType joinType = joinNode.getJoinType();                                                               </span>
<span  style=""> 106                                                                                                                    </span>
<span class="1132914906015926398" onmouseenter="enter('1132914906015926398');" onmouseout="out('1132914906015926398');" style=""> 107          String leftTbName = &quot;&quot;;                                                                                   </span>
<span class="4210951459006369780" onmouseenter="enter('4210951459006369780');" onmouseout="out('4210951459006369780');" style=""> 108          String leftTbAlias = &quot;&quot;;                                                                                  </span>
<span class="8685549357368222156" onmouseenter="enter('8685549357368222156');" onmouseout="out('8685549357368222156');" style=""> 109          String rightTableName = &quot;&quot;;                                                                               </span>
<span class="-3462848723088515190" onmouseenter="enter('-3462848723088515190');" onmouseout="out('-3462848723088515190');" style=""> 110          String rightTableAlias = &quot;&quot;;                                                                              </span>
<span class="-4143915273411371171" onmouseenter="enter('-4143915273411371171');" onmouseout="out('-4143915273411371171');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 111 -        boolean leftTbisTmp = false;                                                                              </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 112 -                                                                                                                  </span>
<span class="7073425685774818270" onmouseenter="enter('7073425685774818270');" onmouseout="out('7073425685774818270');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 113 -        //如果是连续join 判断是否已经处理过添加到执行队列                                                                              </span>
<span class="8324695814441059424" onmouseenter="enter('8324695814441059424');" onmouseout="out('8324695814441059424');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 114 -        Boolean needBuildTemp = false;                                                                            </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 115 +                                                                                                                  </span>
<span class="8157205433740328150" onmouseenter="enter('8157205433740328150');" onmouseout="out('8157205433740328150');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 116 +        //抽取join中的的条件                                                                                             </span>
<span class="-2983428553847994428" onmouseenter="enter('-2983428553847994428');" onmouseout="out('-2983428553847994428');" style=""> 117          extractJoinField(joinNode.getCondition(), joinFieldSet);                                                  </span>
<span  style=""> 118                                                                                                                    </span>
<span class="-8190917917216144958" onmouseenter="enter('-8190917917216144958');" onmouseout="out('-8190917917216144958');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 119 -        if(leftNode.getKind() == IDENTIFIER){                                                                     </span>
<span class="-2801204236324253727" onmouseenter="enter('-2801204236324253727');" onmouseout="out('-2801204236324253727');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 120 -            leftTbName = leftNode.toString();                                                                     </span>
<span class="-847686074292457428" onmouseenter="enter('-847686074292457428');" onmouseout="out('-847686074292457428');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 121 -        } else if (leftNode.getKind() == JOIN) {                                                                  </span>
<span class="4311991652949423903" onmouseenter="enter('4311991652949423903');" onmouseout="out('4311991652949423903');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +        if (leftNode.getKind() == JOIN) {                                                                         </span>
<span class="8741114231031705604" onmouseenter="enter('8741114231031705604');" onmouseout="out('8741114231031705604');" style=""> 123              //处理连续join                                                                                            </span>
<span class="6606026518317197924" onmouseenter="enter('6606026518317197924');" onmouseout="out('6606026518317197924');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 124 -            Tuple2&lt;Boolean, JoinInfo&gt; nestJoinResult = dealNestJoin((SqlJoin) leftNode, sideTableSet,             </span>
<span class="-4863766665985465641" onmouseenter="enter('-4863766665985465641');" onmouseout="out('-4863766665985465641');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 125 -                    queueInfo, parentWhere, parentSelectList, joinFieldSet, tableRef);                            </span>
<span class="-4345603281757420960" onmouseenter="enter('-4345603281757420960');" onmouseout="out('-4345603281757420960');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 126 -            needBuildTemp = nestJoinResult.f0;                                                                    </span>
<span class="-4078843663520504191" onmouseenter="enter('-4078843663520504191');" onmouseout="out('-4078843663520504191');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 127 -            SqlBasicCall buildAs = TableUtils.buildAsNodeByJoinInfo(nestJoinResult.f1, null, null);               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 128 -                                                                                                                  </span>
<span class="4505810106746455844" onmouseenter="enter('4505810106746455844');" onmouseout="out('4505810106746455844');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 129 -            if(needBuildTemp){                                                                                    </span>
<span class="1462068966621678218" onmouseenter="enter('1462068966621678218');" onmouseout="out('1462068966621678218');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 130 -                //记录表之间的关联关系                                                                                      </span>
<span class="-1197906562874334747" onmouseenter="enter('-1197906562874334747');" onmouseout="out('-1197906562874334747');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 131 -                String newLeftTableName = buildAs.getOperands()[1].toString();                                    </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 132 -                Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                 </span>
<span class="-116846282284894788" onmouseenter="enter('-116846282284894788');" onmouseout="out('-116846282284894788');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 133 -                TableUtils.getFromTableInfo(joinNode.getLeft(), fromTableNameSet);                                </span>
<span class="-4128731698405516984" onmouseenter="enter('-4128731698405516984');" onmouseout="out('-4128731698405516984');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 134 -                for(String tbTmp : fromTableNameSet){                                                             </span>
<span class="6564874017116360040" onmouseenter="enter('6564874017116360040');" onmouseout="out('6564874017116360040');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 135 -                    tableRef.put(tbTmp, newLeftTableName);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 136 -                }                                                                                                 </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 137 -                                                                                                                  </span>
<span class="3808835679994269685" onmouseenter="enter('3808835679994269685');" onmouseout="out('3808835679994269685');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 138 -                //替换leftNode 为新的查询                                                                                </span>
<span class="-9132777540839355627" onmouseenter="enter('-9132777540839355627');" onmouseout="out('-9132777540839355627');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 139 -                joinNode.setLeft(buildAs);                                                                        </span>
<span class="8717129290340056603" onmouseenter="enter('8717129290340056603');" onmouseout="out('8717129290340056603');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 140 -                leftNode = buildAs;                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 141 -                                                                                                                  </span>
<span class="-3833992755798848111" onmouseenter="enter('-3833992755798848111');" onmouseout="out('-3833992755798848111');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 142 -                //替换select field 中的对应字段                                                                           </span>
<span class="5699421896693743778" onmouseenter="enter('5699421896693743778');" onmouseout="out('5699421896693743778');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 143 -                for(SqlNode sqlNode : parentSelectList.getList()){                                                </span>
<span class="-7140235961109122639" onmouseenter="enter('-7140235961109122639');" onmouseout="out('-7140235961109122639');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 144 -                    for(String tbTmp : fromTableNameSet) {                                                        </span>
<span class="3202552329014652746" onmouseenter="enter('3202552329014652746');" onmouseout="out('3202552329014652746');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 145 -                        TableUtils.replaceSelectFieldTable(sqlNode, tbTmp, newLeftTableName);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 146 -                    }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 147 -                }                                                                                                 </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 148 -                                                                                                                  </span>
<span class="1927000767768311618" onmouseenter="enter('1927000767768311618');" onmouseout="out('1927000767768311618');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 149 -                //替换where 中的条件相关                                                                                  </span>
<span class="-4128731698405516984" onmouseenter="enter('-4128731698405516984');" onmouseout="out('-4128731698405516984');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 150 -                for(String tbTmp : fromTableNameSet){                                                             </span>
<span class="7276408045907024058" onmouseenter="enter('7276408045907024058');" onmouseout="out('7276408045907024058');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 151 -                    TableUtils.replaceWhereCondition(parentWhere, tbTmp, newLeftTableName);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 152 -                }                                                                                                 </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 153 -                                                                                                                  </span>
<span class="-8162375655295544578" onmouseenter="enter('-8162375655295544578');" onmouseout="out('-8162375655295544578');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 154 -                leftTbisTmp = true;                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 155 -                                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 156 -            }                                                                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 157 -                                                                                                                  </span>
<span class="-1826234939037413890" onmouseenter="enter('-1826234939037413890');" onmouseout="out('-1826234939037413890');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 158 -            leftTbName = buildAs.getOperands()[0].toString();                                                     </span>
<span class="-3318844277430288469" onmouseenter="enter('-3318844277430288469');" onmouseout="out('-3318844277430288469');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 159 -            leftTbAlias = buildAs.getOperands()[1].toString();                                                    </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 160 -                                                                                                                  </span>
<span class="426156474579357333" onmouseenter="enter('426156474579357333');" onmouseout="out('426156474579357333');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 161 -        } else if (leftNode.getKind() == AS) {                                                                    </span>
<span class="5799841308726390194" onmouseenter="enter('5799841308726390194');" onmouseout="out('5799841308726390194');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 162 -            AliasInfo aliasInfo = (AliasInfo) sideSQLParser.parseSql(leftNode, sideTableSet, queueInfo, parentWhere, parentSelectList);"> 162 -            AliasInfo aliasInfo = (AliasInfo) sideSQLParser.parseSql(leftNode, sideTableSet, queueInfo, parentWher🔵</abbr></span>
<span class="-1001268496906659006" onmouseenter="enter('-1001268496906659006');" onmouseout="out('-1001268496906659006');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 163 +            dealNestJoin(joinNode, sideTableSet,                                                                  </span>
<span class="5383893876318256511" onmouseenter="enter('5383893876318256511');" onmouseout="out('5383893876318256511');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 164 +                    queueInfo, parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, fieldRef);"> 164 +                    queueInfo, parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, fieldRef)🔵</abbr></span>
<span class="-2038895670102717129" onmouseenter="enter('-2038895670102717129');" onmouseout="out('-2038895670102717129');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 165 +            leftNode = joinNode.getLeft();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 166 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 167 +                                                                                                                  </span>
<span class="4487076072297445468" onmouseenter="enter('4487076072297445468');" onmouseout="out('4487076072297445468');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 168 +        if (leftNode.getKind() == AS) {                                                                           </span>
<span class="939384655387303650" onmouseenter="enter('939384655387303650');" onmouseout="out('939384655387303650');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 169 +            AliasInfo aliasInfo = (AliasInfo) sideSQLParser.parseSql(leftNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 169 +            AliasInfo aliasInfo = (AliasInfo) sideSQLParser.parseSql(leftNode, sideTableSet, queueInfo, parentWher🔵</abbr></span>
<span class="-6271284546665811801" onmouseenter="enter('-6271284546665811801');" onmouseout="out('-6271284546665811801');" style=""> 170              leftTbName = aliasInfo.getName();                                                                     </span>
<span class="1754889631815621614" onmouseenter="enter('1754889631815621614');" onmouseout="out('1754889631815621614');" style=""> 171              leftTbAlias = aliasInfo.getAlias();                                                                   </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 172 -                                                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 173 -        } else {                                                                                                  </span>
<span class="1657329483008774131" onmouseenter="enter('1657329483008774131');" onmouseout="out('1657329483008774131');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 174 -            throw new RuntimeException(String.format(&quot;---not deal node with type %s&quot;, leftNode.getKind().toString()));"> 174 -            throw new RuntimeException(String.format(&quot;---not deal node with type %s&quot;, leftNode.getKind().toString(🔵</abbr></span>
<span class="-5692986469808836880" onmouseenter="enter('-5692986469808836880');" onmouseout="out('-5692986469808836880');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +        } else if(leftNode.getKind() == IDENTIFIER){                                                              </span>
<span class="-2801204236324253727" onmouseenter="enter('-2801204236324253727');" onmouseout="out('-2801204236324253727');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +            leftTbName = leftNode.toString();                                                                     </span>
<span class="-1155513509208265617" onmouseenter="enter('-1155513509208265617');" onmouseout="out('-1155513509208265617');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +            leftTbAlias = leftTbName;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178          }                                                                                                         </span>
<span  style=""> 179                                                                                                                    </span>
<span class="818500193985431170" onmouseenter="enter('818500193985431170');" onmouseout="out('818500193985431170');" style=""> 180          boolean leftIsSide = checkIsSideTable(leftTbName, sideTableSet);                                          </span>
<span class="3539880077969659090" onmouseenter="enter('3539880077969659090');" onmouseout="out('3539880077969659090');" style=""> 181          Preconditions.checkState(!leftIsSide, &quot;side-table must be at the right of join operator&quot;);                </span>
<span  style=""> 182                                                                                                                    </span>
<span class="427940538474757132" onmouseenter="enter('427940538474757132');" onmouseout="out('427940538474757132');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 183 -        Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo, parentWhere, parentSelectList);"> 183 -        Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo, parentW🔵</abbr></span>
<span class="-1213513570275508110" onmouseenter="enter('-1213513570275508110');" onmouseout="out('-1213513570275508110');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 184 +        Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 184 +        Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo, parentW🔵</abbr></span>
<span class="-8717968456481913232" onmouseenter="enter('-8717968456481913232');" onmouseout="out('-8717968456481913232');" style=""> 185          rightTableName = rightTableNameAndAlias.f0;                                                               </span>
<span class="6344722288957274241" onmouseenter="enter('6344722288957274241');" onmouseout="out('6344722288957274241');" style=""> 186          rightTableAlias = rightTableNameAndAlias.f1;                                                              </span>
<span  style=""> 187                                                                                                                    </span>
<span class="-2376755127467584795" onmouseenter="enter('-2376755127467584795');" onmouseout="out('-2376755127467584795');" style=""> 188          boolean rightIsSide = checkIsSideTable(rightTableName, sideTableSet);                                     </span>
<span class="-8791016550933072203" onmouseenter="enter('-8791016550933072203');" onmouseout="out('-8791016550933072203');" style=""> 189          if(rightIsSide &amp;&amp; joinType == JoinType.RIGHT){                                                            </span>
<span class="-8772090804951491249" onmouseenter="enter('-8772090804951491249');" onmouseout="out('-8772090804951491249');" style=""><abbr title=" 190              throw new RuntimeException(&quot;side join not support join type of right[current support inner join and left join]&quot;);"> 190              throw new RuntimeException(&quot;side join not support join type of right[current support inner join and le🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191          }                                                                                                         </span>
<span  style=""> 192                                                                                                                    </span>
<span class="-2392606951301675835" onmouseenter="enter('-2392606951301675835');" onmouseout="out('-2392606951301675835');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 193 -        if(leftNode.getKind() == JOIN &amp;&amp; rightIsSide){                                                            </span>
<span class="4785989307570935099" onmouseenter="enter('4785989307570935099');" onmouseout="out('4785989307570935099');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 194 -            needBuildTemp = true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 195 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 196 -                                                                                                                  </span>
<span class="-6467047856281920672" onmouseenter="enter('-6467047856281920672');" onmouseout="out('-6467047856281920672');" style=""> 197          JoinInfo tableInfo = new JoinInfo();                                                                      </span>
<span class="-3449973379283837894" onmouseenter="enter('-3449973379283837894');" onmouseout="out('-3449973379283837894');" style=""> 198          tableInfo.setLeftTableName(leftTbName);                                                                   </span>
<span class="3986639763024215846" onmouseenter="enter('3986639763024215846');" onmouseout="out('3986639763024215846');" style=""> 199          tableInfo.setRightTableName(rightTableName);                                                              </span>
<span class="540222178236061469" onmouseenter="enter('540222178236061469');" onmouseout="out('540222178236061469');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 200 -        if (StringUtils.isEmpty(leftTbAlias)){                                                                    </span>
<span class="-527247937252364560" onmouseenter="enter('-527247937252364560');" onmouseout="out('-527247937252364560');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 201 -            tableInfo.setLeftTableAlias(leftTbName);                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 202 -        } else {                                                                                                  </span>
<span class="846009662730869635" onmouseenter="enter('846009662730869635');" onmouseout="out('846009662730869635');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 203 -            tableInfo.setLeftTableAlias(leftTbAlias);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 204 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 205 -                                                                                                                  </span>
<span class="5288249263560060903" onmouseenter="enter('5288249263560060903');" onmouseout="out('5288249263560060903');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 206 -        if (StringUtils.isEmpty(rightTableAlias)){                                                                </span>
<span class="3932788331193283947" onmouseenter="enter('3932788331193283947');" onmouseout="out('3932788331193283947');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 207 -            tableInfo.setRightTableAlias(rightTableName);                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 208 -        } else {                                                                                                  </span>
<span class="4941698031257863857" onmouseenter="enter('4941698031257863857');" onmouseout="out('4941698031257863857');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 209 -            tableInfo.setRightTableAlias(rightTableAlias);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 210 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 211 -                                                                                                                  </span>
<span class="-7094988609046840890" onmouseenter="enter('-7094988609046840890');" onmouseout="out('-7094988609046840890');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 212 -        TableUtils.replaceJoinFieldRefTableName(joinNode.getCondition(), tableRef);                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 213 -                                                                                                                  </span>
<span class="-3100717890116607547" onmouseenter="enter('-3100717890116607547');" onmouseout="out('-3100717890116607547');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 214 -        tableInfo.setLeftIsTmpTable(leftTbisTmp);                                                                 </span>
<span class="-1392507044041313284" onmouseenter="enter('-1392507044041313284');" onmouseout="out('-1392507044041313284');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 215 -        tableInfo.setLeftIsSideTable(leftIsSide);                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 216 +                                                                                                                  </span>
<span class="-4276195101487104801" onmouseenter="enter('-4276195101487104801');" onmouseout="out('-4276195101487104801');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 217 +        leftTbAlias = StringUtils.isEmpty(leftTbAlias) ? leftTbName : leftTbAlias;                                </span>
<span class="3265584439264898224" onmouseenter="enter('3265584439264898224');" onmouseout="out('3265584439264898224');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 218 +        rightTableAlias = StringUtils.isEmpty(rightTableAlias) ? rightTableName : rightTableAlias;                </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 219 +                                                                                                                  </span>
<span class="846009662730869635" onmouseenter="enter('846009662730869635');" onmouseout="out('846009662730869635');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 220 +        tableInfo.setLeftTableAlias(leftTbAlias);                                                                 </span>
<span class="4941698031257863857" onmouseenter="enter('4941698031257863857');" onmouseout="out('4941698031257863857');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +        tableInfo.setRightTableAlias(rightTableAlias);                                                            </span>
<span class="-8645871838585664663" onmouseenter="enter('-8645871838585664663');" onmouseout="out('-8645871838585664663');" style=""> 222          tableInfo.setRightIsSideTable(rightIsSide);                                                               </span>
<span class="-1781974587467511895" onmouseenter="enter('-1781974587467511895');" onmouseout="out('-1781974587467511895');" style=""> 223          tableInfo.setLeftNode(leftNode);                                                                          </span>
<span class="-1730362975620128104" onmouseenter="enter('-1730362975620128104');" onmouseout="out('-1730362975620128104');" style=""> 224          tableInfo.setRightNode(rightNode);                                                                        </span>
<span class="-6237310238590034687" onmouseenter="enter('-6237310238590034687');" onmouseout="out('-6237310238590034687');" style=""> 225          tableInfo.setJoinType(joinType);                                                                          </span>
<span class="-2724794810040782007" onmouseenter="enter('-2724794810040782007');" onmouseout="out('-2724794810040782007');" style=""> 226          tableInfo.setCondition(joinNode.getCondition());                                                          </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 227 -                                                                                                                  </span>
<span class="6825487195953888301" onmouseenter="enter('6825487195953888301');" onmouseout="out('6825487195953888301');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 228 -        if(tableInfo.getLeftNode().getKind() != AS &amp;&amp; needBuildTemp){                                             </span>
<span class="-7852697520698251485" onmouseenter="enter('-7852697520698251485');" onmouseout="out('-7852697520698251485');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 229 -            extractTemporaryQuery(tableInfo.getLeftNode(), tableInfo.getLeftTableAlias(), (SqlBasicCall) parentWhere,"> 229 -            extractTemporaryQuery(tableInfo.getLeftNode(), tableInfo.getLeftTableAlias(), (SqlBasicCall) parentWhe🔵</abbr></span>
<span class="-3080723565429428298" onmouseenter="enter('-3080723565429428298');" onmouseout="out('-3080723565429428298');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 230 -                    parentSelectList, queueInfo, joinFieldSet, tableRef);                                         </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 231 -        }else {                                                                                                   </span>
<span class="-7263872454890537563" onmouseenter="enter('-7263872454890537563');" onmouseout="out('-7263872454890537563');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 232 -            SqlKind asNodeFirstKind = ((SqlBasicCall)tableInfo.getLeftNode()).operands[0].getKind();              </span>
<span class="7769837734339006055" onmouseenter="enter('7769837734339006055');" onmouseout="out('7769837734339006055');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 233 -            if(asNodeFirstKind == SELECT){                                                                        </span>
<span class="-6186943853001324725" onmouseenter="enter('-6186943853001324725');" onmouseout="out('-6186943853001324725');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 234 -                queueInfo.offer(tableInfo.getLeftNode());                                                         </span>
<span class="5571842213520048771" onmouseenter="enter('5571842213520048771');" onmouseout="out('5571842213520048771');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 235 -                tableInfo.setLeftNode(((SqlBasicCall)tableInfo.getLeftNode()).operands[1]);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 236 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 237 -        }                                                                                                         </span>
<span class="-6697941901007642600" onmouseenter="enter('-6697941901007642600');" onmouseout="out('-6697941901007642600');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 238 +        TableUtils.replaceJoinFieldRefTableName(joinNode.getCondition(), fieldRef);                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 239 +                                                                                                                  </span>
<span class="930681598926066970" onmouseenter="enter('930681598926066970');" onmouseout="out('930681598926066970');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 240 +        //extract 需要查询的字段信息                                                                                       </span>
<span class="-1288427379447515770" onmouseenter="enter('-1288427379447515770');" onmouseout="out('-1288427379447515770');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +        if(rightIsSide){                                                                                          </span>
<span class="4601009674852512506" onmouseenter="enter('4601009674852512506');" onmouseout="out('4601009674852512506');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 242 +            extractJoinNeedSelectField(leftNode, rightNode, parentWhere, parentSelectList, parentGroupByList, tableRef, joinFieldSet, fieldRef, tableInfo);"> 242 +            extractJoinNeedSelectField(leftNode, rightNode, parentWhere, parentSelectList, parentGroupByList, tabl🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 243 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 244 +                                                                                                                  </span>
<span class="-8175769203069982871" onmouseenter="enter('-8175769203069982871');" onmouseout="out('-8175769203069982871');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 245 +        if(tableInfo.getLeftNode().getKind() != AS){                                                              </span>
<span class="-8283803146393095059" onmouseenter="enter('-8283803146393095059');" onmouseout="out('-8283803146393095059');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 246 +            return tableInfo;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 247 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 248 +                                                                                                                  </span>
<span class="-7263872454890537563" onmouseenter="enter('-7263872454890537563');" onmouseout="out('-7263872454890537563');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 249 +        SqlKind asNodeFirstKind = ((SqlBasicCall)tableInfo.getLeftNode()).operands[0].getKind();                  </span>
<span class="7769837734339006055" onmouseenter="enter('7769837734339006055');" onmouseout="out('7769837734339006055');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 250 +        if(asNodeFirstKind == SELECT){                                                                            </span>
<span class="-6186943853001324725" onmouseenter="enter('-6186943853001324725');" onmouseout="out('-6186943853001324725');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +            queueInfo.offer(tableInfo.getLeftNode());                                                             </span>
<span class="5571842213520048771" onmouseenter="enter('5571842213520048771');" onmouseout="out('5571842213520048771');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +            tableInfo.setLeftNode(((SqlBasicCall)tableInfo.getLeftNode()).operands[1]);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 253 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 254 +                                                                                                                  </span>
<span class="-8283803146393095059" onmouseenter="enter('-8283803146393095059');" onmouseout="out('-8283803146393095059');" style=""> 255          return tableInfo;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 256      }                                                                                                             </span>
<span  style=""> 257                                                                                                                    </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 258 -                                                                                                                  </span>
<span class="3705413154731575184" onmouseenter="enter('3705413154731575184');" onmouseout="out('3705413154731575184');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 259 -    //处理多层join                                                                                                    </span>
<span class="7145754590042272725" onmouseenter="enter('7145754590042272725');" onmouseout="out('7145754590042272725');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 260 -    private Tuple2&lt;Boolean, JoinInfo&gt; dealNestJoin(SqlJoin joinNode, Set&lt;String&gt; sideTableSet,                    </span>
<span class="1807555890431133112" onmouseenter="enter('1807555890431133112');" onmouseout="out('1807555890431133112');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 261 -                                                   Queue&lt;Object&gt; queueInfo, SqlNode parentWhere,                  </span>
<span class="3251661684197536657" onmouseenter="enter('3251661684197536657');" onmouseout="out('3251661684197536657');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 262 -                                                   SqlNodeList selectList, Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,"> 262 -                                                   SqlNodeList selectList, Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSe🔵</abbr></span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 263 -                                                   Map&lt;String, String&gt; tableRef){                                 </span>
<span class="6077141851454171925" onmouseenter="enter('6077141851454171925');" onmouseout="out('6077141851454171925');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 264 -        SqlNode rightNode = joinNode.getRight();                                                                  </span>
<span class="-2339536868971306375" onmouseenter="enter('-2339536868971306375');" onmouseout="out('-2339536868971306375');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 265 -        Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo, parentWhere, selectList);"> 265 -        Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo, parentW🔵</abbr></span>
<span class="-5352267233850389316" onmouseenter="enter('-5352267233850389316');" onmouseout="out('-5352267233850389316');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 266 -        JoinInfo joinInfo = dealJoinNode(joinNode, sideTableSet, queueInfo, parentWhere, selectList, joinFieldSet, tableRef);"> 266 -        JoinInfo joinInfo = dealJoinNode(joinNode, sideTableSet, queueInfo, parentWhere, selectList, joinFieldSet,🔵</abbr></span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 267 +    /**                                                                                                           </span>
<span class="-6526994496424246980" onmouseenter="enter('-6526994496424246980');" onmouseout="out('-6526994496424246980');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 268 +     * 获取join 之后需要查询的字段信息                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 269 +     */                                                                                                           </span>
<span class="-8070342088850551474" onmouseenter="enter('-8070342088850551474');" onmouseout="out('-8070342088850551474');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 270 +    public void extractJoinNeedSelectField(SqlNode leftNode,                                                      </span>
<span class="-4990225969144065515" onmouseenter="enter('-4990225969144065515');" onmouseout="out('-4990225969144065515');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 271 +                                           SqlNode rightNode,                                                     </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 272 +                                           SqlNode parentWhere,                                                   </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 273 +                                           SqlNodeList parentSelectList,                                          </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 274 +                                           SqlNodeList parentGroupByList,                                         </span>
<span class="8208018358691263022" onmouseenter="enter('8208018358691263022');" onmouseout="out('8208018358691263022');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 275 +                                           Map&lt;String, String&gt; tableRef,                                          </span>
<span class="221219844685559650" onmouseenter="enter('221219844685559650');" onmouseout="out('221219844685559650');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 276 +                                           Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,                              </span>
<span class="5387904462551126599" onmouseenter="enter('5387904462551126599');" onmouseout="out('5387904462551126599');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 277 +                                           Map&lt;String, String&gt; fieldRef,                                          </span>
<span class="-1803976646211983141" onmouseenter="enter('-1803976646211983141');" onmouseout="out('-1803976646211983141');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 278 +                                           JoinInfo tableInfo){                                                   </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 279 +                                                                                                                  </span>
<span class="-1711591104588450781" onmouseenter="enter('-1711591104588450781');" onmouseout="out('-1711591104588450781');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 280 +        Set&lt;String&gt; extractSelectField = extractField(leftNode, parentWhere, parentSelectList, parentGroupByList, tableRef, joinFieldSet);"> 280 +        Set&lt;String&gt; extractSelectField = extractField(leftNode, parentWhere, parentSelectList, parentGroupByList, 🔵</abbr></span>
<span class="5798543527687218027" onmouseenter="enter('5798543527687218027');" onmouseout="out('5798543527687218027');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 281 +        Set&lt;String&gt; rightExtractSelectField = extractField(rightNode, parentWhere, parentSelectList, parentGroupByList, tableRef, joinFieldSet);"> 281 +        Set&lt;String&gt; rightExtractSelectField = extractField(rightNode, parentWhere, parentSelectList, parentGroupBy🔵</abbr></span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 282 +                                                                                                                  </span>
<span class="3213038720352519337" onmouseenter="enter('3213038720352519337');" onmouseout="out('3213038720352519337');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 283 +        //重命名right 中和 left 重名的                                                                                    </span>
<span class="7303277877915218137" onmouseenter="enter('7303277877915218137');" onmouseout="out('7303277877915218137');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 284 +        Map&lt;String, String&gt; leftTbSelectField = Maps.newHashMap();                                                </span>
<span class="-7917371932647768145" onmouseenter="enter('-7917371932647768145');" onmouseout="out('-7917371932647768145');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 285 +        Map&lt;String, String&gt; rightTbSelectField = Maps.newHashMap();                                               </span>
<span class="2809964139008068690" onmouseenter="enter('2809964139008068690');" onmouseout="out('2809964139008068690');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 286 +        String newTableName = tableInfo.getNewTableAlias();                                                       </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 287 +                                                                                                                  </span>
<span class="3316391227079094306" onmouseenter="enter('3316391227079094306');" onmouseout="out('3316391227079094306');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 288 +        for(String tmpField : extractSelectField){                                                                </span>
<span class="-5672380782575278344" onmouseenter="enter('-5672380782575278344');" onmouseout="out('-5672380782575278344');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 289 +            String[] tmpFieldSplit = StringUtils.split(tmpField, &#x27;.&#x27;);                                            </span>
<span class="2836986565168806948" onmouseenter="enter('2836986565168806948');" onmouseout="out('2836986565168806948');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 290 +            leftTbSelectField.put(tmpFieldSplit[1], tmpFieldSplit[1]);                                            </span>
<span class="-5202931256248051147" onmouseenter="enter('-5202931256248051147');" onmouseout="out('-5202931256248051147');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 291 +            fieldRef.put(tmpField, TableUtils.buildTableField(newTableName, tmpFieldSplit[1]));                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 292 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 293 +                                                                                                                  </span>
<span class="-9009930827099038696" onmouseenter="enter('-9009930827099038696');" onmouseout="out('-9009930827099038696');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 294 +        for(String tmpField : rightExtractSelectField){                                                           </span>
<span class="-5672380782575278344" onmouseenter="enter('-5672380782575278344');" onmouseout="out('-5672380782575278344');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 295 +            String[] tmpFieldSplit = StringUtils.split(tmpField, &#x27;.&#x27;);                                            </span>
<span class="7608141435657997055" onmouseenter="enter('7608141435657997055');" onmouseout="out('7608141435657997055');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 296 +            String originalFieldName = tmpFieldSplit[1];                                                          </span>
<span class="-6734440225783578199" onmouseenter="enter('-6734440225783578199');" onmouseout="out('-6734440225783578199');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 297 +            String targetFieldName = originalFieldName;                                                           </span>
<span class="-3298038078208796781" onmouseenter="enter('-3298038078208796781');" onmouseout="out('-3298038078208796781');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 298 +            if(leftTbSelectField.containsKey(originalFieldName)){                                                 </span>
<span class="-1055151855410778283" onmouseenter="enter('-1055151855410778283');" onmouseout="out('-1055151855410778283');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 299 +                targetFieldName = ParseUtils.dealDuplicateFieldName(leftTbSelectField, originalFieldName);        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 300 +            }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 301 +                                                                                                                  </span>
<span class="5677834067945950920" onmouseenter="enter('5677834067945950920');" onmouseout="out('5677834067945950920');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 302 +            rightTbSelectField.put(originalFieldName, targetFieldName);                                           </span>
<span class="1614475174789103856" onmouseenter="enter('1614475174789103856');" onmouseout="out('1614475174789103856');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 303 +            fieldRef.put(tmpField, TableUtils.buildTableField(newTableName, targetFieldName));                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 304 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 305 +                                                                                                                  </span>
<span class="6039372522735153165" onmouseenter="enter('6039372522735153165');" onmouseout="out('6039372522735153165');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 306 +        tableInfo.setLeftSelectFieldInfo(leftTbSelectField);                                                      </span>
<span class="-3036936727497955518" onmouseenter="enter('-3036936727497955518');" onmouseout="out('-3036936727497955518');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 307 +        tableInfo.setRightSelectFieldInfo(rightTbSelectField);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 308 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 309 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 310 +    /**                                                                                                           </span>
<span class="6570650330648921499" onmouseenter="enter('6570650330648921499');" onmouseout="out('6570650330648921499');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 311 +     * 指定的节点关联到的 select 中的字段和 where中的字段                                                                           </span>
<span class="3061148848694484073" onmouseenter="enter('3061148848694484073');" onmouseout="out('3061148848694484073');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 312 +     * @param sqlNode                                                                                             </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 313 +     * @param parentWhere                                                                                         </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 314 +     * @param parentSelectList                                                                                    </span>
<span class="3557443413892532302" onmouseenter="enter('3557443413892532302');" onmouseout="out('3557443413892532302');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 315 +     * @param parentGroupByList                                                                                   </span>
<span class="744467540294235613" onmouseenter="enter('744467540294235613');" onmouseout="out('744467540294235613');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 316 +     * @param tableRef                                                                                            </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 317 +     * @param joinFieldSet                                                                                        </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 318 +     * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 319 +     */                                                                                                           </span>
<span class="-4373311553166434161" onmouseenter="enter('-4373311553166434161');" onmouseout="out('-4373311553166434161');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 320 +    public Set&lt;String&gt; extractField(SqlNode sqlNode,                                                              </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 321 +                                    SqlNode parentWhere,                                                          </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 322 +                                    SqlNodeList parentSelectList,                                                 </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 323 +                                    SqlNodeList parentGroupByList,                                                </span>
<span class="8208018358691263022" onmouseenter="enter('8208018358691263022');" onmouseout="out('8208018358691263022');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 324 +                                    Map&lt;String, String&gt; tableRef,                                                 </span>
<span class="7220891666826410078" onmouseenter="enter('7220891666826410078');" onmouseout="out('7220891666826410078');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 325 +                                    Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet){                                    </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 326 +        Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                         </span>
<span class="3720467049200805808" onmouseenter="enter('3720467049200805808');" onmouseout="out('3720467049200805808');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 327 +        TableUtils.getFromTableInfo(sqlNode, fromTableNameSet);                                                   </span>
<span class="-6851932415303644529" onmouseenter="enter('-6851932415303644529');" onmouseout="out('-6851932415303644529');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 328 +        Set&lt;String&gt; extractCondition = Sets.newHashSet();                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 329 +                                                                                                                  </span>
<span class="2214715548245711526" onmouseenter="enter('2214715548245711526');" onmouseout="out('2214715548245711526');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 330 +        extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere, extractCondition);                    </span>
<span class="5747231761832639727" onmouseenter="enter('5747231761832639727');" onmouseout="out('5747231761832639727');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 331 +        Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tableRef);       </span>
<span class="4281414700536968132" onmouseenter="enter('4281414700536968132');" onmouseout="out('4281414700536968132');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 332 +        Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableNameSet, tableRef);"> 332 +        Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableNameSet, t🔵</abbr></span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 333 +                                                                                                                  </span>
<span class="6344960557144626200" onmouseenter="enter('6344960557144626200');" onmouseout="out('6344960557144626200');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 334 +        Set&lt;String&gt; extractGroupByField = extractFieldFromGroupByList(parentGroupByList, fromTableNameSet, tableRef);"> 334 +        Set&lt;String&gt; extractGroupByField = extractFieldFromGroupByList(parentGroupByList, fromTableNameSet, tableRe🔵</abbr></span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 335 +                                                                                                                  </span>
<span class="7218037707336831410" onmouseenter="enter('7218037707336831410');" onmouseout="out('7218037707336831410');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 336 +        extractSelectField.addAll(extractCondition);                                                              </span>
<span class="4128012888485840534" onmouseenter="enter('4128012888485840534');" onmouseout="out('4128012888485840534');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 337 +        extractSelectField.addAll(fieldFromJoinCondition);                                                        </span>
<span class="-8364010074861767596" onmouseenter="enter('-8364010074861767596');" onmouseout="out('-8364010074861767596');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 338 +        extractSelectField.addAll(extractGroupByField);                                                           </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 339 +                                                                                                                  </span>
<span class="6206897609633081926" onmouseenter="enter('6206897609633081926');" onmouseout="out('6206897609633081926');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 340 +        return extractSelectField;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 341 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 342 +                                                                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 343 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 344 +    /**                                                                                                           </span>
<span class="-2227309623247049332" onmouseenter="enter('-2227309623247049332');" onmouseout="out('-2227309623247049332');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 345 +     * 处理多层join                                                                                                   </span>
<span class="-9032432844766422471" onmouseenter="enter('-9032432844766422471');" onmouseout="out('-9032432844766422471');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 346 +     * 判断左节点是否需要创建临时查询                                                                                            </span>
<span class="-3743716848325689638" onmouseenter="enter('-3743716848325689638');" onmouseout="out('-3743716848325689638');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 347 +     * （1）右节点是维表                                                                                                  </span>
<span class="6062511326648248663" onmouseenter="enter('6062511326648248663');" onmouseout="out('6062511326648248663');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 348 +     * （2）左节点不是 as 节点                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 349 +     */                                                                                                           </span>
<span class="-8823647435533406854" onmouseenter="enter('-8823647435533406854');" onmouseout="out('-8823647435533406854');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 350 +    private JoinInfo dealNestJoin(SqlJoin joinNode,                                                               </span>
<span class="-1952250395521254109" onmouseenter="enter('-1952250395521254109');" onmouseout="out('-1952250395521254109');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 351 +                                  Set&lt;String&gt; sideTableSet,                                                       </span>
<span class="405358965608327863" onmouseenter="enter('405358965608327863');" onmouseout="out('405358965608327863');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 352 +                                  Queue&lt;Object&gt; queueInfo,                                                        </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 353 +                                  SqlNode parentWhere,                                                            </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 354 +                                  SqlNodeList parentSelectList,                                                   </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 355 +                                  SqlNodeList parentGroupByList,                                                  </span>
<span class="221219844685559650" onmouseenter="enter('221219844685559650');" onmouseout="out('221219844685559650');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 356 +                                  Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,                                       </span>
<span class="8208018358691263022" onmouseenter="enter('8208018358691263022');" onmouseout="out('8208018358691263022');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 357 +                                  Map&lt;String, String&gt; tableRef,                                                   </span>
<span class="4274367877110602869" onmouseenter="enter('4274367877110602869');" onmouseout="out('4274367877110602869');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 358 +                                  Map&lt;String, String&gt; fieldRef){                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 359 +                                                                                                                  </span>
<span class="-5609072442761450329" onmouseenter="enter('-5609072442761450329');" onmouseout="out('-5609072442761450329');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 360 +        SqlJoin leftJoinNode = (SqlJoin) joinNode.getLeft();                                                      </span>
<span class="-1304982916123509336" onmouseenter="enter('-1304982916123509336');" onmouseout="out('-1304982916123509336');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 361 +        SqlNode parentRightJoinNode = joinNode.getRight();                                                        </span>
<span class="3581810211864331265" onmouseenter="enter('3581810211864331265');" onmouseout="out('3581810211864331265');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 362 +        SqlNode rightNode = leftJoinNode.getRight();                                                              </span>
<span class="-1213513570275508110" onmouseenter="enter('-1213513570275508110');" onmouseout="out('-1213513570275508110');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 363 +        Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 363 +        Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo, parentW🔵</abbr></span>
<span class="7880211710586462336" onmouseenter="enter('7880211710586462336');" onmouseout="out('7880211710586462336');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 364 +        Tuple2&lt;String, String&gt; parentRightJoinInfo = parseRightNode(parentRightJoinNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 364 +        Tuple2&lt;String, String&gt; parentRightJoinInfo = parseRightNode(parentRightJoinNode, sideTableSet, queueInfo, 🔵</abbr></span>
<span class="-5913516627524533061" onmouseenter="enter('-5913516627524533061');" onmouseout="out('-5913516627524533061');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 365 +        boolean parentRightIsSide = checkIsSideTable(parentRightJoinInfo.f0, sideTableSet);                       </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 366 +                                                                                                                  </span>
<span class="3375986139512671503" onmouseenter="enter('3375986139512671503');" onmouseout="out('3375986139512671503');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 367 +        JoinInfo joinInfo = dealJoinNode(leftJoinNode, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, fieldRef);"> 367 +        JoinInfo joinInfo = dealJoinNode(leftJoinNode, sideTableSet, queueInfo, parentWhere, parentSelectList, par🔵</abbr></span>
<span  style=""> 368                                                                                                                    </span>
<span class="-8707963241001902314" onmouseenter="enter('-8707963241001902314');" onmouseout="out('-8707963241001902314');" style=""> 369          String rightTableName = rightTableNameAndAlias.f0;                                                        </span>
<span class="-2376755127467584795" onmouseenter="enter('-2376755127467584795');" onmouseout="out('-2376755127467584795');" style=""> 370          boolean rightIsSide = checkIsSideTable(rightTableName, sideTableSet);                                     </span>
<span class="7285211506162862473" onmouseenter="enter('7285211506162862473');" onmouseout="out('7285211506162862473');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 371 -        boolean needBuildTemp = false;                                                                            </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 372 -                                                                                                                  </span>
<span class="5223306001790343975" onmouseenter="enter('5223306001790343975');" onmouseout="out('5223306001790343975');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 373 -        if(!rightIsSide){                                                                                         </span>
<span class="5962855083848081317" onmouseenter="enter('5962855083848081317');" onmouseout="out('5962855083848081317');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 374 -            //右表不是维表的情况                                                                                           </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 375 -        }else{                                                                                                    </span>
<span class="-5450817922678052440" onmouseenter="enter('-5450817922678052440');" onmouseout="out('-5450817922678052440');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 376 -            //右边表是维表需要重新构建左表的临时查询                                                                                 </span>
<span class="6641920780390342492" onmouseenter="enter('6641920780390342492');" onmouseout="out('6641920780390342492');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 377 -            queueInfo.offer(joinInfo);                                                                            </span>
<span class="4785989307570935099" onmouseenter="enter('4785989307570935099');" onmouseout="out('4785989307570935099');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 378 -            needBuildTemp = true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 379 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 380 -                                                                                                                  </span>
<span class="-1327758925293399828" onmouseenter="enter('-1327758925293399828');" onmouseout="out('-1327758925293399828');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 381 -        //return Tuple2.of(needBuildTemp, TableUtils.buildAsNodeByJoinInfo(joinInfo, null, null));                </span>
<span class="6585696372112746518" onmouseenter="enter('6585696372112746518');" onmouseout="out('6585696372112746518');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 382 -        return Tuple2.of(needBuildTemp, joinInfo);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 383 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 384 -                                                                                                                  </span>
<span class="-2402394227701825991" onmouseenter="enter('-2402394227701825991');" onmouseout="out('-2402394227701825991');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 385 -    private void extractTemporaryQuery(SqlNode node, String tableAlias, SqlBasicCall parentWhere,                 </span>
<span class="1575560997126003034" onmouseenter="enter('1575560997126003034');" onmouseout="out('1575560997126003034');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 386 -                                       SqlNodeList parentSelectList, Queue&lt;Object&gt; queueInfo,                     </span>
<span class="-1905801896855583684" onmouseenter="enter('-1905801896855583684');" onmouseout="out('-1905801896855583684');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 387 +        SqlBasicCall buildAs = TableUtils.buildAsNodeByJoinInfo(joinInfo, null, null);                            </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 388 +                                                                                                                  </span>
<span class="-1288427379447515770" onmouseenter="enter('-1288427379447515770');" onmouseout="out('-1288427379447515770');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 389 +        if(rightIsSide){                                                                                          </span>
<span class="-1341811977371241920" onmouseenter="enter('-1341811977371241920');" onmouseout="out('-1341811977371241920');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 390 +            addSideInfoToExeQueue(queueInfo, joinInfo, joinNode, parentSelectList, parentGroupByList, parentWhere, tableRef);"> 390 +            addSideInfoToExeQueue(queueInfo, joinInfo, joinNode, parentSelectList, parentGroupByList, parentWhere,🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 391 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 392 +                                                                                                                  </span>
<span class="-4926661402208797605" onmouseenter="enter('-4926661402208797605');" onmouseout="out('-4926661402208797605');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 393 +        SqlNode newLeftNode = joinNode.getLeft();                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 394 +                                                                                                                  </span>
<span class="669597408116519005" onmouseenter="enter('669597408116519005');" onmouseout="out('669597408116519005');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 395 +        if(newLeftNode.getKind() != AS &amp;&amp; parentRightIsSide){                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 396 +                                                                                                                  </span>
<span class="-7949998902589886822" onmouseenter="enter('-7949998902589886822');" onmouseout="out('-7949998902589886822');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 397 +            String leftTbAlias = buildAs.getOperands()[1].toString();                                             </span>
<span class="-647616919686055479" onmouseenter="enter('-647616919686055479');" onmouseout="out('-647616919686055479');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 398 +            extractTemporaryQuery(newLeftNode, leftTbAlias, (SqlBasicCall) parentWhere,                           </span>
<span class="-4123256814652138053" onmouseenter="enter('-4123256814652138053');" onmouseout="out('-4123256814652138053');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 399 +                    parentSelectList, queueInfo, joinFieldSet, tableRef, fieldRef);                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 400 +                                                                                                                  </span>
<span class="3808835679994269685" onmouseenter="enter('3808835679994269685');" onmouseout="out('3808835679994269685');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 401 +            //替换leftNode 为新的查询                                                                                    </span>
<span class="-9132777540839355627" onmouseenter="enter('-9132777540839355627');" onmouseout="out('-9132777540839355627');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 402 +            joinNode.setLeft(buildAs);                                                                            </span>
<span class="-2381095167123449114" onmouseenter="enter('-2381095167123449114');" onmouseout="out('-2381095167123449114');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 403 +            replaceSelectAndWhereField(buildAs, leftJoinNode, tableRef, parentSelectList, parentGroupByList, parentWhere);"> 403 +            replaceSelectAndWhereField(buildAs, leftJoinNode, tableRef, parentSelectList, parentGroupByList, paren🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 404 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 405 +                                                                                                                  </span>
<span class="8714866254863163325" onmouseenter="enter('8714866254863163325');" onmouseout="out('8714866254863163325');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 406 +        return joinInfo;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 407 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 408 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 409 +    /**                                                                                                           </span>
<span class="4951286882385365012" onmouseenter="enter('4951286882385365012');" onmouseout="out('4951286882385365012');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 410 +     * 右边表是维表需要重新构建左表的临时查询                                                                                        </span>
<span class="-8208655787748224971" onmouseenter="enter('-8208655787748224971');" onmouseout="out('-8208655787748224971');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 411 +     * 并将joinInfo 添加到执行队列里面                                                                                       </span>
<span class="3894561521416724418" onmouseenter="enter('3894561521416724418');" onmouseout="out('3894561521416724418');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 412 +     * @param queueInfo                                                                                           </span>
<span class="-6040909485639107572" onmouseenter="enter('-6040909485639107572');" onmouseout="out('-6040909485639107572');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 413 +     * @param joinInfo                                                                                            </span>
<span class="-2995351136134268537" onmouseenter="enter('-2995351136134268537');" onmouseout="out('-2995351136134268537');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 414 +     * @param joinNode                                                                                            </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 415 +     * @param parentSelectList                                                                                    </span>
<span class="3557443413892532302" onmouseenter="enter('3557443413892532302');" onmouseout="out('3557443413892532302');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 416 +     * @param parentGroupByList                                                                                   </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 417 +     * @param parentWhere                                                                                         </span>
<span class="744467540294235613" onmouseenter="enter('744467540294235613');" onmouseout="out('744467540294235613');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 418 +     * @param tableRef                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 419 +     */                                                                                                           </span>
<span class="3979713406384282644" onmouseenter="enter('3979713406384282644');" onmouseout="out('3979713406384282644');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 420 +    public void addSideInfoToExeQueue(Queue&lt;Object&gt; queueInfo,                                                    </span>
<span class="7516859044924889091" onmouseenter="enter('7516859044924889091');" onmouseout="out('7516859044924889091');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 421 +                                      JoinInfo joinInfo,                                                          </span>
<span class="1981177442384846922" onmouseenter="enter('1981177442384846922');" onmouseout="out('1981177442384846922');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 422 +                                      SqlJoin joinNode,                                                           </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 423 +                                      SqlNodeList parentSelectList,                                               </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 424 +                                      SqlNodeList parentGroupByList,                                              </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 425 +                                      SqlNode parentWhere,                                                        </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 426 +                                      Map&lt;String, String&gt; tableRef){                                              </span>
<span class="-6478373311886746675" onmouseenter="enter('-6478373311886746675');" onmouseout="out('-6478373311886746675');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 427 +        //只处理维表                                                                                                   </span>
<span class="-3203763040208890217" onmouseenter="enter('-3203763040208890217');" onmouseout="out('-3203763040208890217');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 428 +        if(!joinInfo.isRightIsSideTable()){                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 429 +            return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 430 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 431 +                                                                                                                  </span>
<span class="-1905801896855583684" onmouseenter="enter('-1905801896855583684');" onmouseout="out('-1905801896855583684');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 432 +        SqlBasicCall buildAs = TableUtils.buildAsNodeByJoinInfo(joinInfo, null, null);                            </span>
<span class="-2672508263360943403" onmouseenter="enter('-2672508263360943403');" onmouseout="out('-2672508263360943403');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 433 +        SqlNode leftJoinNode = joinNode.getLeft();                                                                </span>
<span class="6641920780390342492" onmouseenter="enter('6641920780390342492');" onmouseout="out('6641920780390342492');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 434 +        queueInfo.offer(joinInfo);                                                                                </span>
<span class="5508401011707832352" onmouseenter="enter('5508401011707832352');" onmouseout="out('5508401011707832352');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 435 +        //替换左表为新的表名称                                                                                              </span>
<span class="-9132777540839355627" onmouseenter="enter('-9132777540839355627');" onmouseout="out('-9132777540839355627');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 436 +        joinNode.setLeft(buildAs);                                                                                </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 437 +                                                                                                                  </span>
<span class="-2381095167123449114" onmouseenter="enter('-2381095167123449114');" onmouseout="out('-2381095167123449114');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 438 +        replaceSelectAndWhereField(buildAs, leftJoinNode, tableRef, parentSelectList, parentGroupByList, parentWhere);"> 438 +        replaceSelectAndWhereField(buildAs, leftJoinNode, tableRef, parentSelectList, parentGroupByList, parentWhe🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 439 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 440 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 441 +    /**                                                                                                           </span>
<span class="2664257413645127477" onmouseenter="enter('2664257413645127477');" onmouseout="out('2664257413645127477');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 442 +     * 替换指定的查询和条件节点中的字段为新的字段                                                                                      </span>
<span class="-5192515893397779968" onmouseenter="enter('-5192515893397779968');" onmouseout="out('-5192515893397779968');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 443 +     * @param buildAs                                                                                             </span>
<span class="8761373734140075238" onmouseenter="enter('8761373734140075238');" onmouseout="out('8761373734140075238');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 444 +     * @param leftJoinNode                                                                                        </span>
<span class="744467540294235613" onmouseenter="enter('744467540294235613');" onmouseout="out('744467540294235613');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 445 +     * @param tableRef                                                                                            </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 446 +     * @param parentSelectList                                                                                    </span>
<span class="3557443413892532302" onmouseenter="enter('3557443413892532302');" onmouseout="out('3557443413892532302');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 447 +     * @param parentGroupByList                                                                                   </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 448 +     * @param parentWhere                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 449 +     */                                                                                                           </span>
<span class="-8851224148732895615" onmouseenter="enter('-8851224148732895615');" onmouseout="out('-8851224148732895615');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 450 +    public void replaceSelectAndWhereField(SqlBasicCall buildAs,                                                  </span>
<span class="-7569254098639694631" onmouseenter="enter('-7569254098639694631');" onmouseout="out('-7569254098639694631');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 451 +                   SqlNode leftJoinNode,                                                                          </span>
<span class="8208018358691263022" onmouseenter="enter('8208018358691263022');" onmouseout="out('8208018358691263022');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 452 +                   Map&lt;String, String&gt; tableRef,                                                                  </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 453 +                   SqlNodeList parentSelectList,                                                                  </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 454 +                   SqlNodeList parentGroupByList,                                                                 </span>
<span class="3000848303760980313" onmouseenter="enter('3000848303760980313');" onmouseout="out('3000848303760980313');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 455 +                   SqlNode parentWhere){                                                                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 456 +                                                                                                                  </span>
<span class="-1197906562874334747" onmouseenter="enter('-1197906562874334747');" onmouseout="out('-1197906562874334747');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 457 +        String newLeftTableName = buildAs.getOperands()[1].toString();                                            </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 458 +        Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                         </span>
<span class="6977570025516648131" onmouseenter="enter('6977570025516648131');" onmouseout="out('6977570025516648131');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 459 +        TableUtils.getFromTableInfo(leftJoinNode, fromTableNameSet);                                              </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 460 +                                                                                                                  </span>
<span class="-4128731698405516984" onmouseenter="enter('-4128731698405516984');" onmouseout="out('-4128731698405516984');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 461 +        for(String tbTmp : fromTableNameSet){                                                                     </span>
<span class="6564874017116360040" onmouseenter="enter('6564874017116360040');" onmouseout="out('6564874017116360040');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 462 +            tableRef.put(tbTmp, newLeftTableName);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 463 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 464 +                                                                                                                  </span>
<span class="-3833992755798848111" onmouseenter="enter('-3833992755798848111');" onmouseout="out('-3833992755798848111');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 465 +        //替换select field 中的对应字段                                                                                   </span>
<span class="5558486769410159556" onmouseenter="enter('5558486769410159556');" onmouseout="out('5558486769410159556');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 466 +        HashBiMap&lt;String, String&gt; fieldReplaceRef = HashBiMap.create();                                           </span>
<span class="5699421896693743778" onmouseenter="enter('5699421896693743778');" onmouseout="out('5699421896693743778');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 467 +        for(SqlNode sqlNode : parentSelectList.getList()){                                                        </span>
<span class="-7140235961109122639" onmouseenter="enter('-7140235961109122639');" onmouseout="out('-7140235961109122639');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 468 +            for(String tbTmp : fromTableNameSet) {                                                                </span>
<span class="-581523387212695221" onmouseenter="enter('-581523387212695221');" onmouseout="out('-581523387212695221');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 469 +                TableUtils.replaceSelectFieldTable(sqlNode, tbTmp, newLeftTableName, fieldReplaceRef);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 470 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 471 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 472 +                                                                                                                  </span>
<span class="-8944541773972050035" onmouseenter="enter('-8944541773972050035');" onmouseout="out('-8944541773972050035');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 473 +        //TODO 应该根据上面的查询字段的关联关系来替换                                                                                </span>
<span class="1927000767768311618" onmouseenter="enter('1927000767768311618');" onmouseout="out('1927000767768311618');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 474 +        //替换where 中的条件相关                                                                                          </span>
<span class="-4128731698405516984" onmouseenter="enter('-4128731698405516984');" onmouseout="out('-4128731698405516984');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 475 +        for(String tbTmp : fromTableNameSet){                                                                     </span>
<span class="5165818510692281294" onmouseenter="enter('5165818510692281294');" onmouseout="out('5165818510692281294');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 476 +            TableUtils.replaceWhereCondition(parentWhere, tbTmp, newLeftTableName, fieldReplaceRef);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 477 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 478 +                                                                                                                  </span>
<span class="6193699176503696110" onmouseenter="enter('6193699176503696110');" onmouseout="out('6193699176503696110');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 479 +        if(parentGroupByList != null){                                                                            </span>
<span class="8082263099560409349" onmouseenter="enter('8082263099560409349');" onmouseout="out('8082263099560409349');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 480 +            for(SqlNode sqlNode : parentGroupByList.getList()){                                                   </span>
<span class="-7140235961109122639" onmouseenter="enter('-7140235961109122639');" onmouseout="out('-7140235961109122639');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 481 +                for(String tbTmp : fromTableNameSet) {                                                            </span>
<span class="-581523387212695221" onmouseenter="enter('-581523387212695221');" onmouseout="out('-581523387212695221');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 482 +                    TableUtils.replaceSelectFieldTable(sqlNode, tbTmp, newLeftTableName, fieldReplaceRef);        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 483 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 484 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 485 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 486 +                                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 487 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 488 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 489 +    /**                                                                                                           </span>
<span class="-9161506910855772732" onmouseenter="enter('-9161506910855772732');" onmouseout="out('-9161506910855772732');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 490 +     * 抽取出中间查询表                                                                                                   </span>
<span class="384197096128287152" onmouseenter="enter('384197096128287152');" onmouseout="out('384197096128287152');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 491 +     * @param node                                                                                                </span>
<span class="3992250397465727176" onmouseenter="enter('3992250397465727176');" onmouseout="out('3992250397465727176');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 492 +     * @param tableAlias                                                                                          </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 493 +     * @param parentWhere                                                                                         </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 494 +     * @param parentSelectList                                                                                    </span>
<span class="3894561521416724418" onmouseenter="enter('3894561521416724418');" onmouseout="out('3894561521416724418');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 495 +     * @param queueInfo                                                                                           </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 496 +     * @param joinFieldSet                                                                                        </span>
<span class="744467540294235613" onmouseenter="enter('744467540294235613');" onmouseout="out('744467540294235613');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 497 +     * @param tableRef                                                                                            </span>
<span class="6064073244373316048" onmouseenter="enter('6064073244373316048');" onmouseout="out('6064073244373316048');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 498 +     * @return 源自段和新生成字段之间的映射关系                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 499 +     */                                                                                                           </span>
<span class="-6236609755307512773" onmouseenter="enter('-6236609755307512773');" onmouseout="out('-6236609755307512773');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 500 +    private void extractTemporaryQuery(SqlNode node, String tableAlias,                                           </span>
<span class="1711245815305911921" onmouseenter="enter('1711245815305911921');" onmouseout="out('1711245815305911921');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 501 +                                       SqlBasicCall parentWhere,                                                  </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 502 +                                       SqlNodeList parentSelectList,                                              </span>
<span class="405358965608327863" onmouseenter="enter('405358965608327863');" onmouseout="out('405358965608327863');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 503 +                                       Queue&lt;Object&gt; queueInfo,                                                   </span>
<span class="221219844685559650" onmouseenter="enter('221219844685559650');" onmouseout="out('221219844685559650');" style=""> 504                                         Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,                                  </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 505 -                                       Map&lt;String, String&gt; tableRef){                                             </span>
<span class="8208018358691263022" onmouseenter="enter('8208018358691263022');" onmouseout="out('8208018358691263022');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 506 +                                       Map&lt;String, String&gt; tableRef,                                              </span>
<span class="4274367877110602869" onmouseenter="enter('4274367877110602869');" onmouseout="out('4274367877110602869');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 507 +                                       Map&lt;String, String&gt; fieldRef){                                             </span>
<span class="-1891643383856272179" onmouseenter="enter('-1891643383856272179');" onmouseout="out('-1891643383856272179');" style=""> 508          try{                                                                                                      </span>
<span class="-8973252823595593319" onmouseenter="enter('-8973252823595593319');" onmouseout="out('-8973252823595593319');" style=""> 509              //父一级的where 条件中如果只和临时查询相关的条件都截取进来                                                                     </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 510              Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                     </span>
<span class="-1162190359921159801" onmouseenter="enter('-1162190359921159801');" onmouseout="out('-1162190359921159801');" style=""> 511              List&lt;SqlBasicCall&gt; extractCondition = Lists.newArrayList();                                           </span>
<span  style=""> 512                                                                                                                    </span>
<span class="8110456237367799034" onmouseenter="enter('8110456237367799034');" onmouseout="out('8110456237367799034');" style=""> 513              TableUtils.getFromTableInfo(node, fromTableNameSet);                                                  </span>
<span class="6022466615463989785" onmouseenter="enter('6022466615463989785');" onmouseout="out('6022466615463989785');" style=""> 514              checkAndRemoveWhereCondition(fromTableNameSet, parentWhere, extractCondition);                        </span>
<span  style=""> 515                                                                                                                    </span>
<span class="8695778948204515419" onmouseenter="enter('8695778948204515419');" onmouseout="out('8695778948204515419');" style=""> 516              if(node.getKind() == JOIN){                                                                           </span>
<span class="-6199554136531935919" onmouseenter="enter('-6199554136531935919');" onmouseout="out('-6199554136531935919');" style=""> 517                  checkAndReplaceJoinCondition(((SqlJoin)node).getCondition(), tableRef);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 518              }                                                                                                     </span>
<span  style=""> 519                                                                                                                    </span>
<span class="5747231761832639727" onmouseenter="enter('5747231761832639727');" onmouseout="out('5747231761832639727');" style=""> 520              Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tableRef);   </span>
<span class="1865200144735135853" onmouseenter="enter('1865200144735135853');" onmouseout="out('1865200144735135853');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 521 -            Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableNameSet);"> 521 -            Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableNameSe🔵</abbr></span>
<span class="-3053698166334827106" onmouseenter="enter('-3053698166334827106');" onmouseout="out('-3053698166334827106');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 522 -            String extractSelectFieldStr = buildSelectNode(extractSelectField, fieldFromJoinCondition);           </span>
<span class="4281414700536968132" onmouseenter="enter('4281414700536968132');" onmouseout="out('4281414700536968132');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 523 +            Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableNameSet, tableRef);"> 523 +            Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableNameSe🔵</abbr></span>
<span class="-718326697477564125" onmouseenter="enter('-718326697477564125');" onmouseout="out('-718326697477564125');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 524 +            Set&lt;String&gt; newFields = buildSelectNode(extractSelectField, fieldFromJoinCondition);                  </span>
<span class="9076146696470564191" onmouseenter="enter('9076146696470564191');" onmouseout="out('9076146696470564191');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 525 +            String extractSelectFieldStr = StringUtils.join(newFields, &#x27;,&#x27;);                                      </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 526 +                                                                                                                  </span>
<span class="4157544700609283076" onmouseenter="enter('4157544700609283076');" onmouseout="out('4157544700609283076');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 527 +            Map&lt;String, String&gt; oldRefNewField = buildTmpTableFieldRefOriField(newFields, tableAlias);            </span>
<span class="-9040628512379918841" onmouseenter="enter('-9040628512379918841');" onmouseout="out('-9040628512379918841');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 528 +            fieldRef.putAll(oldRefNewField);                                                                      </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 529 +                                                                                                                  </span>
<span class="-3122368802496797506" onmouseenter="enter('-3122368802496797506');" onmouseout="out('-3122368802496797506');" style=""> 530              String extractConditionStr = buildCondition(extractCondition);                                        </span>
<span  style=""> 531                                                                                                                    </span>
<span class="6190023554533569746" onmouseenter="enter('6190023554533569746');" onmouseout="out('6190023554533569746');" style=""> 532              String tmpSelectSql = String.format(SELECT_TEMP_SQL,                                                  </span>
<span class="3430988890108370699" onmouseenter="enter('3430988890108370699');" onmouseout="out('3430988890108370699');" style=""> 533                      extractSelectFieldStr,                                                                        </span>
<span class="-1169517675965244531" onmouseenter="enter('-1169517675965244531');" onmouseout="out('-1169517675965244531');" style=""> 534                      node.toString(),                                                                              </span>
<span class="4099345839703116685" onmouseenter="enter('4099345839703116685');" onmouseout="out('4099345839703116685');" style=""> 535                      extractConditionStr);                                                                         </span>
<span  style=""> 536                                                                                                                    </span>
<span class="-3319042643252387519" onmouseenter="enter('-3319042643252387519');" onmouseout="out('-3319042643252387519');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 537 -            SqlParser sqlParser = SqlParser.create(tmpSelectSql, CalciteConfig.MYSQL_LEX_CONFIG);                 </span>
<span class="-1853454348884693240" onmouseenter="enter('-1853454348884693240');" onmouseout="out('-1853454348884693240');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 538 -            SqlNode sqlNode = sqlParser.parseStmt();                                                              </span>
<span class="-1075958635284917181" onmouseenter="enter('-1075958635284917181');" onmouseout="out('-1075958635284917181');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 539 +            FlinkPlannerImpl flinkPlanner = FlinkPlanner.getFlinkPlanner();                                       </span>
<span class="7395930912815097284" onmouseenter="enter('7395930912815097284');" onmouseout="out('7395930912815097284');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 540 +            SqlNode sqlNode = flinkPlanner.parse(tmpSelectSql);                                                   </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 541 +                                                                                                                  </span>
<span class="-2735890898778643076" onmouseenter="enter('-2735890898778643076');" onmouseout="out('-2735890898778643076');" style=""> 542              SqlBasicCall sqlBasicCall = buildAsSqlNode(tableAlias, sqlNode);                                      </span>
<span class="2417854506040223841" onmouseenter="enter('2417854506040223841');" onmouseout="out('2417854506040223841');" style=""> 543              queueInfo.offer(sqlBasicCall);                                                                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 544 +                                                                                                                  </span>
<span class="3036777158467770620" onmouseenter="enter('3036777158467770620');" onmouseout="out('3036777158467770620');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 545 +            //替换select中的表结构                                                                                       </span>
<span class="5558486769410159556" onmouseenter="enter('5558486769410159556');" onmouseout="out('5558486769410159556');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 546 +            HashBiMap&lt;String, String&gt; fieldReplaceRef = HashBiMap.create();                                       </span>
<span class="6403576620687993648" onmouseenter="enter('6403576620687993648');" onmouseout="out('6403576620687993648');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 547 +            for(SqlNode tmpSelect : parentSelectList.getList()){                                                  </span>
<span class="-7140235961109122639" onmouseenter="enter('-7140235961109122639');" onmouseout="out('-7140235961109122639');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 548 +                for(String tbTmp : fromTableNameSet) {                                                            </span>
<span class="-2362265056324339707" onmouseenter="enter('-2362265056324339707');" onmouseout="out('-2362265056324339707');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 549 +                    TableUtils.replaceSelectFieldTable(tmpSelect, tbTmp, tableAlias, fieldReplaceRef);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 550 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 551 +            }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 552 +                                                                                                                  </span>
<span class="1927000767768311618" onmouseenter="enter('1927000767768311618');" onmouseout="out('1927000767768311618');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 553 +            //替换where 中的条件相关                                                                                      </span>
<span class="-4128731698405516984" onmouseenter="enter('-4128731698405516984');" onmouseout="out('-4128731698405516984');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 554 +            for(String tbTmp : fromTableNameSet){                                                                 </span>
<span class="859671676632511130" onmouseenter="enter('859671676632511130');" onmouseout="out('859671676632511130');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 555 +                TableUtils.replaceWhereCondition(parentWhere, tbTmp, tableAlias, fieldReplaceRef);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 556 +            }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 557 +                                                                                                                  </span>
<span class="-4128731698405516984" onmouseenter="enter('-4128731698405516984');" onmouseout="out('-4128731698405516984');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 558 +            for(String tbTmp : fromTableNameSet){                                                                 </span>
<span class="-6060557126611161603" onmouseenter="enter('-6060557126611161603');" onmouseout="out('-6060557126611161603');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 559 +                tableRef.put(tbTmp, tableAlias);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 560 +            }                                                                                                     </span>
<span  style=""> 561                                                                                                                    </span>
<span class="3487269535061511064" onmouseenter="enter('3487269535061511064');" onmouseout="out('3487269535061511064');" style=""> 562              System.out.println(&quot;-------build temporary query-----------&quot;);                                        </span>
<span class="-8101867096626384734" onmouseenter="enter('-8101867096626384734');" onmouseout="out('-8101867096626384734');" style=""> 563              System.out.println(tmpSelectSql);                                                                     </span>
<span class="-4281832807373115174" onmouseenter="enter('-4281832807373115174');" onmouseout="out('-4281832807373115174');" style=""> 564              System.out.println(&quot;---------------------------------------&quot;);                                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 565 +                                                                                                                  </span>
<span class="-1580407524319062305" onmouseenter="enter('-1580407524319062305');" onmouseout="out('-1580407524319062305');" style=""> 566          }catch (Exception e){                                                                                     </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 567              e.printStackTrace();                                                                                  </span>




<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 568              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 569          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 570      }                                                                                                             </span>
<span  style=""> 571                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 572      /**                                                                                                           </span>
<span class="-4499840608975407423" onmouseenter="enter('-4499840608975407423');" onmouseout="out('-4499840608975407423');" style=""> 573       * 抽取上层需用使用到的字段                                                                                               </span>
<span class="9099401058466039467" onmouseenter="enter('9099401058466039467');" onmouseout="out('9099401058466039467');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 574 -     * 由于where字段已经抽取到上一层了所以不用查询出来                                                                                 </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style=""> 575       * @param parentSelectList                                                                                    </span>
<span class="-6365101737408851156" onmouseenter="enter('-6365101737408851156');" onmouseout="out('-6365101737408851156');" style=""> 576       * @param fromTableNameSet                                                                                    </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 577       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 578       */                                                                                                           </span>
<span class="-1410253319795430175" onmouseenter="enter('-1410253319795430175');" onmouseout="out('-1410253319795430175');" style=""> 579      private Set&lt;String&gt; extractSelectFields(SqlNodeList parentSelectList,                                         </span>
<span class="8604782440088857459" onmouseenter="enter('8604782440088857459');" onmouseout="out('8604782440088857459');" style=""> 580                                              Set&lt;String&gt; fromTableNameSet,                                         </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style=""> 581                                              Map&lt;String, String&gt; tableRef){                                        </span>
<span class="-4673362671275703253" onmouseenter="enter('-4673362671275703253');" onmouseout="out('-4673362671275703253');" style=""> 582          Set&lt;String&gt; extractFieldList = Sets.newHashSet();                                                         </span>
<span class="-7414180011567654896" onmouseenter="enter('-7414180011567654896');" onmouseout="out('-7414180011567654896');" style=""> 583          for(SqlNode selectNode : parentSelectList.getList()){                                                     </span>
<span class="1095915068729564148" onmouseenter="enter('1095915068729564148');" onmouseout="out('1095915068729564148');" style=""> 584              extractSelectField(selectNode, extractFieldList, fromTableNameSet, tableRef);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 585          }                                                                                                         </span>
<span  style=""> 586                                                                                                                    </span>
<span class="-1685101767459189568" onmouseenter="enter('-1685101767459189568');" onmouseout="out('-1685101767459189568');" style=""> 587          return extractFieldList;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 588      }                                                                                                             </span>
<span  style=""> 589                                                                                                                    </span>
<span class="-3843180343280265019" onmouseenter="enter('-3843180343280265019');" onmouseout="out('-3843180343280265019');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 590 -    private Set&lt;String&gt; extractSelectFieldFromJoinCondition(Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet, Set&lt;String&gt; fromTableNameSet){"> 590 -    private Set&lt;String&gt; extractSelectFieldFromJoinCondition(Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet, Set&lt;String&gt; 🔵</abbr></span>
<span class="-3136237770377012352" onmouseenter="enter('-3136237770377012352');" onmouseout="out('-3136237770377012352');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 591 +    private Set&lt;String&gt; extractSelectFieldFromJoinCondition(Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,             </span>
<span class="8604782440088857459" onmouseenter="enter('8604782440088857459');" onmouseout="out('8604782440088857459');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 592 +                                                            Set&lt;String&gt; fromTableNameSet,                         </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 593 +                                                            Map&lt;String, String&gt; tableRef){                        </span>
<span class="-4673362671275703253" onmouseenter="enter('-4673362671275703253');" onmouseout="out('-4673362671275703253');" style=""> 594          Set&lt;String&gt; extractFieldList = Sets.newHashSet();                                                         </span>
<span class="8833203050470988767" onmouseenter="enter('8833203050470988767');" onmouseout="out('8833203050470988767');" style=""> 595          for(Tuple2&lt;String, String&gt; field : joinFieldSet){                                                         </span>
<span class="-9037397631967971194" onmouseenter="enter('-9037397631967971194');" onmouseout="out('-9037397631967971194');" style=""> 596              if(fromTableNameSet.contains(field.f0)){                                                              </span>
<span class="-4436761311933817361" onmouseenter="enter('-4436761311933817361');" onmouseout="out('-4436761311933817361');" style=""> 597                  extractFieldList.add(field.f0 + &quot;.&quot; + field.f1);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 598              }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 599 +                                                                                                                  </span>
<span class="2270060537250938832" onmouseenter="enter('2270060537250938832');" onmouseout="out('2270060537250938832');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 600 +            if(tableRef.containsKey(field.f0)){                                                                   </span>
<span class="-6432265866814515577" onmouseenter="enter('-6432265866814515577');" onmouseout="out('-6432265866814515577');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 601 +                if(fromTableNameSet.contains(tableRef.get(field.f0))){                                            </span>
<span class="-616240499130861538" onmouseenter="enter('-616240499130861538');" onmouseout="out('-616240499130861538');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 602 +                    extractFieldList.add(tableRef.get(field.f0) + &quot;.&quot; + field.f1);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 603 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 604 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 605 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 606 +                                                                                                                  </span>
<span class="-1685101767459189568" onmouseenter="enter('-1685101767459189568');" onmouseout="out('-1685101767459189568');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 607 +        return extractFieldList;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 608 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 609 +                                                                                                                  </span>
<span class="-6744450936821609200" onmouseenter="enter('-6744450936821609200');" onmouseout="out('-6744450936821609200');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 610 +    private Set&lt;String&gt; extractFieldFromGroupByList(SqlNodeList parentGroupByList,                                </span>
<span class="8604782440088857459" onmouseenter="enter('8604782440088857459');" onmouseout="out('8604782440088857459');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 611 +                                                    Set&lt;String&gt; fromTableNameSet,                                 </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 612 +                                                    Map&lt;String, String&gt; tableRef){                                </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 613 +                                                                                                                  </span>
<span class="-1817314657182986777" onmouseenter="enter('-1817314657182986777');" onmouseout="out('-1817314657182986777');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 614 +        if(parentGroupByList == null){                                                                            </span>
<span class="7586937643893917515" onmouseenter="enter('7586937643893917515');" onmouseout="out('7586937643893917515');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 615 +            return Sets.newHashSet();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 616 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 617 +                                                                                                                  </span>
<span class="-4673362671275703253" onmouseenter="enter('-4673362671275703253');" onmouseout="out('-4673362671275703253');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 618 +        Set&lt;String&gt; extractFieldList = Sets.newHashSet();                                                         </span>
<span class="7263955957768279526" onmouseenter="enter('7263955957768279526');" onmouseout="out('7263955957768279526');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 619 +        for(SqlNode selectNode : parentGroupByList.getList()){                                                    </span>
<span class="1095915068729564148" onmouseenter="enter('1095915068729564148');" onmouseout="out('1095915068729564148');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 620 +            extractSelectField(selectNode, extractFieldList, fromTableNameSet, tableRef);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 621          }                                                                                                         </span>
<span  style=""> 622                                                                                                                    </span>
<span class="-1685101767459189568" onmouseenter="enter('-1685101767459189568');" onmouseout="out('-1685101767459189568');" style=""> 623          return extractFieldList;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 624      }                                                                                                             </span>
<span  style=""> 625                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 626      /**                                                                                                           </span>
<span class="-672438967754228662" onmouseenter="enter('-672438967754228662');" onmouseout="out('-672438967754228662');" style=""> 627       * 从join的条件中获取字段信息                                                                                            </span>
<span class="-4160812560585701802" onmouseenter="enter('-4160812560585701802');" onmouseout="out('-4160812560585701802');" style=""> 628       * @param condition                                                                                           </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style=""> 629       * @param joinFieldSet                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 630       */                                                                                                           </span>
<span class="1552352851009209412" onmouseenter="enter('1552352851009209412');" onmouseout="out('1552352851009209412');" style=""> 631      private void extractJoinField(SqlNode condition, Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet){                   </span>
<span class="5716706160133851170" onmouseenter="enter('5716706160133851170');" onmouseout="out('5716706160133851170');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 632 +        if (null == condition || condition.getKind() == LITERAL) {                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 633 +            return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 634 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 635 +                                                                                                                  </span>
<span class="5418896256960850645" onmouseenter="enter('5418896256960850645');" onmouseout="out('5418896256960850645');" style=""> 636          SqlKind joinKind = condition.getKind();                                                                   </span>
<span class="6904180996725590590" onmouseenter="enter('6904180996725590590');" onmouseout="out('6904180996725590590');" style=""> 637          if( joinKind == AND || joinKind == EQUALS ){                                                              </span>
<span class="5740954560868172997" onmouseenter="enter('5740954560868172997');" onmouseout="out('5740954560868172997');" style=""> 638              extractJoinField(((SqlBasicCall)condition).operands[0], joinFieldSet);                                </span>
<span class="-450517509397156355" onmouseenter="enter('-450517509397156355');" onmouseout="out('-450517509397156355');" style=""> 639              extractJoinField(((SqlBasicCall)condition).operands[1], joinFieldSet);                                </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 640          }else{                                                                                                    </span>
<span class="3421902236901684905" onmouseenter="enter('3421902236901684905');" onmouseout="out('3421902236901684905');" style=""><abbr title=" 641              Preconditions.checkState(((SqlIdentifier)condition).names.size() == 2, &quot;join condition must be format table.field&quot;);"> 641              Preconditions.checkState(((SqlIdentifier)condition).names.size() == 2, &quot;join condition must be format 🔵</abbr></span>
<span class="6389924414477169388" onmouseenter="enter('6389924414477169388');" onmouseout="out('6389924414477169388');" style=""><abbr title=" 642              Tuple2&lt;String, String&gt; tuple2 = Tuple2.of(((SqlIdentifier)condition).names.get(0), ((SqlIdentifier)condition).names.get(1));"> 642              Tuple2&lt;String, String&gt; tuple2 = Tuple2.of(((SqlIdentifier)condition).names.get(0), ((SqlIdentifier)con🔵</abbr></span>
<span class="-8031023747394340843" onmouseenter="enter('-8031023747394340843');" onmouseout="out('-8031023747394340843');" style=""> 643              joinFieldSet.add(tuple2);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 644          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 645      }                                                                                                             </span>
<span  style=""> 646                                                                                                                    </span>
<span  style=""> 647                                                                                                                    </span>
<span class="-6450965667049352633" onmouseenter="enter('-6450965667049352633');" onmouseout="out('-6450965667049352633');" style=""> 648      private void extractSelectField(SqlNode selectNode,                                                           </span>
<span class="4215167182352113360" onmouseenter="enter('4215167182352113360');" onmouseout="out('4215167182352113360');" style=""> 649                                      Set&lt;String&gt; extractFieldSet,                                                  </span>
<span class="8604782440088857459" onmouseenter="enter('8604782440088857459');" onmouseout="out('8604782440088857459');" style=""> 650                                      Set&lt;String&gt; fromTableNameSet,                                                 </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style=""> 651                                      Map&lt;String, String&gt; tableRef){                                                </span>
<span class="8103739576060170768" onmouseenter="enter('8103739576060170768');" onmouseout="out('8103739576060170768');" style=""> 652          if (selectNode.getKind() == AS) {                                                                         </span>
<span class="1510889832473438632" onmouseenter="enter('1510889832473438632');" onmouseout="out('1510889832473438632');" style=""> 653              SqlNode leftNode = ((SqlBasicCall) selectNode).getOperands()[0];                                      </span>
<span class="-3569930423065034136" onmouseenter="enter('-3569930423065034136');" onmouseout="out('-3569930423065034136');" style=""> 654              extractSelectField(leftNode, extractFieldSet, fromTableNameSet, tableRef);                            </span>
<span  style=""> 655                                                                                                                    </span>
<span class="-8354265102451448120" onmouseenter="enter('-8354265102451448120');" onmouseout="out('-8354265102451448120');" style=""> 656          }else if(selectNode.getKind() == IDENTIFIER) {                                                            </span>
<span class="-3732912994311321816" onmouseenter="enter('-3732912994311321816');" onmouseout="out('-3732912994311321816');" style=""> 657              SqlIdentifier sqlIdentifier = (SqlIdentifier) selectNode;                                             </span>
<span  style=""> 658                                                                                                                    </span>
<span class="2651178788475624428" onmouseenter="enter('2651178788475624428');" onmouseout="out('2651178788475624428');" style=""> 659              if(sqlIdentifier.names.size() == 1){                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 660                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 661              }                                                                                                     </span>
<span  style=""> 662                                                                                                                    </span>
<span class="3965609827388612088" onmouseenter="enter('3965609827388612088');" onmouseout="out('3965609827388612088');" style=""> 663              String tableName = sqlIdentifier.names.get(0);                                                        </span>
<span class="5468885380070811563" onmouseenter="enter('5468885380070811563');" onmouseout="out('5468885380070811563');" style=""> 664              //TODO                                                                                                </span>
<span class="3096268752058072981" onmouseenter="enter('3096268752058072981');" onmouseout="out('3096268752058072981');" style=""> 665              if(fromTableNameSet.contains(tableName)){                                                             </span>
<span class="-4452600673359758385" onmouseenter="enter('-4452600673359758385');" onmouseout="out('-4452600673359758385');" style=""> 666                  extractFieldSet.add(sqlIdentifier.toString());                                                    </span>
<span class="1142707085951947184" onmouseenter="enter('1142707085951947184');" onmouseout="out('1142707085951947184');" style=""> 667              } else if(fromTableNameSet.contains(tableRef.get(tableName))){                                        </span>
<span class="5574286290036421401" onmouseenter="enter('5574286290036421401');" onmouseout="out('5574286290036421401');" style=""> 668                  //TODO extractFieldSet.add(sqlIdentifier.setName(0, tableRef.get(tableName)).toString());         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 669              }                                                                                                     </span>
<span  style=""> 670                                                                                                                    </span>
<span class="7025405726449532045" onmouseenter="enter('7025405726449532045');" onmouseout="out('7025405726449532045');" style=""> 671          }else if(  AGGREGATE.contains(selectNode.getKind())                                                       </span>
<span class="-6933542481251357306" onmouseenter="enter('-6933542481251357306');" onmouseout="out('-6933542481251357306');" style=""> 672                  || AVG_AGG_FUNCTIONS.contains(selectNode.getKind())                                               </span>
<span class="-2120439329066417772" onmouseenter="enter('-2120439329066417772');" onmouseout="out('-2120439329066417772');" style=""> 673                  || COMPARISON.contains(selectNode.getKind())                                                      </span>
<span class="6729191807379931332" onmouseenter="enter('6729191807379931332');" onmouseout="out('6729191807379931332');" style=""> 674                  || selectNode.getKind() == OTHER_FUNCTION                                                         </span>
<span class="-790540336783787818" onmouseenter="enter('-790540336783787818');" onmouseout="out('-790540336783787818');" style=""> 675                  || selectNode.getKind() == DIVIDE                                                                 </span>
<span class="8042439450870069301" onmouseenter="enter('8042439450870069301');" onmouseout="out('8042439450870069301');" style=""> 676                  || selectNode.getKind() == CAST                                                                   </span>
<span class="8131430949670321542" onmouseenter="enter('8131430949670321542');" onmouseout="out('8131430949670321542');" style=""> 677                  || selectNode.getKind() == TRIM                                                                   </span>
<span class="7539044465271514325" onmouseenter="enter('7539044465271514325');" onmouseout="out('7539044465271514325');" style=""> 678                  || selectNode.getKind() == TIMES                                                                  </span>
<span class="5017875227939513377" onmouseenter="enter('5017875227939513377');" onmouseout="out('5017875227939513377');" style=""> 679                  || selectNode.getKind() == PLUS                                                                   </span>
<span class="-8896687143784188803" onmouseenter="enter('-8896687143784188803');" onmouseout="out('-8896687143784188803');" style=""> 680                  || selectNode.getKind() == NOT_IN                                                                 </span>
<span class="-1863732027976694038" onmouseenter="enter('-1863732027976694038');" onmouseout="out('-1863732027976694038');" style=""> 681                  || selectNode.getKind() == OR                                                                     </span>
<span class="6505261652610820896" onmouseenter="enter('6505261652610820896');" onmouseout="out('6505261652610820896');" style=""> 682                  || selectNode.getKind() == AND                                                                    </span>
<span class="8098904506676885196" onmouseenter="enter('8098904506676885196');" onmouseout="out('8098904506676885196');" style=""> 683                  || selectNode.getKind() == MINUS                                                                  </span>
<span class="-157153081163608557" onmouseenter="enter('-157153081163608557');" onmouseout="out('-157153081163608557');" style=""> 684                  || selectNode.getKind() == TUMBLE                                                                 </span>
<span class="-2839638964097736537" onmouseenter="enter('-2839638964097736537');" onmouseout="out('-2839638964097736537');" style=""> 685                  || selectNode.getKind() == TUMBLE_START                                                           </span>
<span class="6482577849437391011" onmouseenter="enter('6482577849437391011');" onmouseout="out('6482577849437391011');" style=""> 686                  || selectNode.getKind() == TUMBLE_END                                                             </span>
<span class="6880276476651207951" onmouseenter="enter('6880276476651207951');" onmouseout="out('6880276476651207951');" style=""> 687                  || selectNode.getKind() == SESSION                                                                </span>
<span class="-5893490809135961202" onmouseenter="enter('-5893490809135961202');" onmouseout="out('-5893490809135961202');" style=""> 688                  || selectNode.getKind() == SESSION_START                                                          </span>
<span class="-1646114820326763405" onmouseenter="enter('-1646114820326763405');" onmouseout="out('-1646114820326763405');" style=""> 689                  || selectNode.getKind() == SESSION_END                                                            </span>
<span class="268793040563115559" onmouseenter="enter('268793040563115559');" onmouseout="out('268793040563115559');" style=""> 690                  || selectNode.getKind() == HOP                                                                    </span>
<span class="5104117061177388693" onmouseenter="enter('5104117061177388693');" onmouseout="out('5104117061177388693');" style=""> 691                  || selectNode.getKind() == HOP_START                                                              </span>
<span class="8235260830665848207" onmouseenter="enter('8235260830665848207');" onmouseout="out('8235260830665848207');" style=""> 692                  || selectNode.getKind() == HOP_END                                                                </span>
<span class="-3943236427179035086" onmouseenter="enter('-3943236427179035086');" onmouseout="out('-3943236427179035086');" style=""> 693                  || selectNode.getKind() == BETWEEN                                                                </span>
<span class="-4981553052649867721" onmouseenter="enter('-4981553052649867721');" onmouseout="out('-4981553052649867721');" style=""> 694                  || selectNode.getKind() == IS_NULL                                                                </span>
<span class="2062318608323297657" onmouseenter="enter('2062318608323297657');" onmouseout="out('2062318608323297657');" style=""> 695                  || selectNode.getKind() == IS_NOT_NULL                                                            </span>
<span class="-5717204280699012051" onmouseenter="enter('-5717204280699012051');" onmouseout="out('-5717204280699012051');" style=""> 696                  || selectNode.getKind() == CONTAINS                                                               </span>
<span class="-4225388998654687854" onmouseenter="enter('-4225388998654687854');" onmouseout="out('-4225388998654687854');" style=""> 697                  || selectNode.getKind() == TIMESTAMP_ADD                                                          </span>
<span class="-1992782825152874013" onmouseenter="enter('-1992782825152874013');" onmouseout="out('-1992782825152874013');" style=""> 698                  || selectNode.getKind() == TIMESTAMP_DIFF                                                         </span>
<span class="-1380076266281630813" onmouseenter="enter('-1380076266281630813');" onmouseout="out('-1380076266281630813');" style=""> 699                  || selectNode.getKind() == LIKE                                                                   </span>
<span  style=""> 700                                                                                                                    </span>
<span class="1769062068492699725" onmouseenter="enter('1769062068492699725');" onmouseout="out('1769062068492699725');" style=""> 701          ){                                                                                                        </span>
<span class="7946305415555164516" onmouseenter="enter('7946305415555164516');" onmouseout="out('7946305415555164516');" style=""> 702              SqlBasicCall sqlBasicCall = (SqlBasicCall) selectNode;                                                </span>
<span class="-6221234471722277998" onmouseenter="enter('-6221234471722277998');" onmouseout="out('-6221234471722277998');" style=""> 703              for(int i=0; i&lt;sqlBasicCall.getOperands().length; i++){                                               </span>
<span class="-6831609595517394087" onmouseenter="enter('-6831609595517394087');" onmouseout="out('-6831609595517394087');" style=""> 704                  SqlNode sqlNode = sqlBasicCall.getOperands()[i];                                                  </span>
<span class="92437031510630357" onmouseenter="enter('92437031510630357');" onmouseout="out('92437031510630357');" style=""> 705                  if(sqlNode instanceof SqlLiteral){                                                                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 706                      continue;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 707                  }                                                                                                 </span>
<span  style=""> 708                                                                                                                    </span>
<span class="-7655129146813432779" onmouseenter="enter('-7655129146813432779');" onmouseout="out('-7655129146813432779');" style=""> 709                  if(sqlNode instanceof SqlDataTypeSpec){                                                           </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 710                      continue;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 711                  }                                                                                                 </span>
<span  style=""> 712                                                                                                                    </span>
<span class="30158307191940159" onmouseenter="enter('30158307191940159');" onmouseout="out('30158307191940159');" style=""> 713                  extractSelectField(sqlNode, extractFieldSet, fromTableNameSet, tableRef);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 714              }                                                                                                     </span>
<span  style=""> 715                                                                                                                    </span>
<span class="2155507952934750451" onmouseenter="enter('2155507952934750451');" onmouseout="out('2155507952934750451');" style=""> 716          }else if(selectNode.getKind() == CASE){                                                                   </span>
<span class="-6113591358780745482" onmouseenter="enter('-6113591358780745482');" onmouseout="out('-6113591358780745482');" style=""> 717              System.out.println(&quot;selectNode&quot;);                                                                     </span>
<span class="-1390336112814264886" onmouseenter="enter('-1390336112814264886');" onmouseout="out('-1390336112814264886');" style=""> 718              SqlCase sqlCase = (SqlCase) selectNode;                                                               </span>
<span class="-3655271460728510010" onmouseenter="enter('-3655271460728510010');" onmouseout="out('-3655271460728510010');" style=""> 719              SqlNodeList whenOperands = sqlCase.getWhenOperands();                                                 </span>
<span class="8318973293639639494" onmouseenter="enter('8318973293639639494');" onmouseout="out('8318973293639639494');" style=""> 720              SqlNodeList thenOperands = sqlCase.getThenOperands();                                                 </span>
<span class="3014895614462197568" onmouseenter="enter('3014895614462197568');" onmouseout="out('3014895614462197568');" style=""> 721              SqlNode elseNode = sqlCase.getElseOperand();                                                          </span>
<span  style=""> 722                                                                                                                    </span>
<span class="6346785150356032184" onmouseenter="enter('6346785150356032184');" onmouseout="out('6346785150356032184');" style=""> 723              for(int i=0; i&lt;whenOperands.size(); i++){                                                             </span>
<span class="1734344807386881213" onmouseenter="enter('1734344807386881213');" onmouseout="out('1734344807386881213');" style=""> 724                  SqlNode oneOperand = whenOperands.get(i);                                                         </span>
<span class="1407654974389323920" onmouseenter="enter('1407654974389323920');" onmouseout="out('1407654974389323920');" style=""> 725                  extractSelectField(oneOperand, extractFieldSet, fromTableNameSet, tableRef);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 726              }                                                                                                     </span>
<span  style=""> 727                                                                                                                    </span>
<span class="-8902171898794493922" onmouseenter="enter('-8902171898794493922');" onmouseout="out('-8902171898794493922');" style=""> 728              for(int i=0; i&lt;thenOperands.size(); i++){                                                             </span>
<span class="-3989978989358262134" onmouseenter="enter('-3989978989358262134');" onmouseout="out('-3989978989358262134');" style=""> 729                  SqlNode oneOperand = thenOperands.get(i);                                                         </span>
<span class="1407654974389323920" onmouseenter="enter('1407654974389323920');" onmouseout="out('1407654974389323920');" style=""> 730                  extractSelectField(oneOperand, extractFieldSet, fromTableNameSet, tableRef);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 731              }                                                                                                     </span>
<span  style=""> 732                                                                                                                    </span>
<span class="-1225911656205055173" onmouseenter="enter('-1225911656205055173');" onmouseout="out('-1225911656205055173');" style=""> 733              extractSelectField(elseNode, extractFieldSet, fromTableNameSet, tableRef);                            </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 734          }else {                                                                                                   </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 735              //do nothing                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 736          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 737      }                                                                                                             </span>
<span  style=""> 738                                                                                                                    </span>
<span  style=""> 739                                                                                                                    </span>
<span class="-1906922116491244459" onmouseenter="enter('-1906922116491244459');" onmouseout="out('-1906922116491244459');" style=""><abbr title=" 740      private Tuple2&lt;String, String&gt; parseRightNode(SqlNode sqlNode, Set&lt;String&gt; sideTableSet, Queue&lt;Object&gt; queueInfo,"> 740      private Tuple2&lt;String, String&gt; parseRightNode(SqlNode sqlNode, Set&lt;String&gt; sideTableSet, Queue&lt;Object&gt; queueIn🔵</abbr></span>
<span class="-5149999535499369188" onmouseenter="enter('-5149999535499369188');" onmouseout="out('-5149999535499369188');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 741 -                                                  SqlNode parentWhere, SqlNodeList selectList) {                  </span>
<span class="-1049021514946482534" onmouseenter="enter('-1049021514946482534');" onmouseout="out('-1049021514946482534');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 742 +                                                  SqlNode parentWhere, SqlNodeList selectList, SqlNodeList parentGroupByList) {"> 742 +                                                  SqlNode parentWhere, SqlNodeList selectList, SqlNodeList parentG🔵</abbr></span>
<span class="-7809629950828083535" onmouseenter="enter('-7809629950828083535');" onmouseout="out('-7809629950828083535');" style=""> 743          Tuple2&lt;String, String&gt; tabName = new Tuple2&lt;&gt;(&quot;&quot;, &quot;&quot;);                                                    </span>
<span class="7570038518439211250" onmouseenter="enter('7570038518439211250');" onmouseout="out('7570038518439211250');" style=""> 744          if(sqlNode.getKind() == IDENTIFIER){                                                                      </span>
<span class="-7735158387636601028" onmouseenter="enter('-7735158387636601028');" onmouseout="out('-7735158387636601028');" style=""> 745              tabName.f0 = sqlNode.toString();                                                                      </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 746          }else{                                                                                                    </span>
<span class="5760084663094791409" onmouseenter="enter('5760084663094791409');" onmouseout="out('5760084663094791409');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 747 -            AliasInfo aliasInfo = (AliasInfo)sideSQLParser.parseSql(sqlNode, sideTableSet, queueInfo, parentWhere, selectList);"> 747 -            AliasInfo aliasInfo = (AliasInfo)sideSQLParser.parseSql(sqlNode, sideTableSet, queueInfo, parentWhere,🔵</abbr></span>
<span class="7364690097624267595" onmouseenter="enter('7364690097624267595');" onmouseout="out('7364690097624267595');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 748 +            AliasInfo aliasInfo = (AliasInfo)sideSQLParser.parseSql(sqlNode, sideTableSet, queueInfo, parentWhere, selectList, parentGroupByList);"> 748 +            AliasInfo aliasInfo = (AliasInfo)sideSQLParser.parseSql(sqlNode, sideTableSet, queueInfo, parentWhere,🔵</abbr></span>
<span class="-7052196639543907068" onmouseenter="enter('-7052196639543907068');" onmouseout="out('-7052196639543907068');" style=""> 749              tabName.f0 = aliasInfo.getName();                                                                     </span>
<span class="-2307032070137542057" onmouseenter="enter('-2307032070137542057');" onmouseout="out('-2307032070137542057');" style=""> 750              tabName.f1 = aliasInfo.getAlias();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 751          }                                                                                                         </span>
<span class="-6789109484485831180" onmouseenter="enter('-6789109484485831180');" onmouseout="out('-6789109484485831180');" style=""> 752          return tabName;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 753      }                                                                                                             </span>
<span  style=""> 754                                                                                                                    </span>
<span class="1768499303484569694" onmouseenter="enter('1768499303484569694');" onmouseout="out('1768499303484569694');" style=""> 755      private Tuple2&lt;String, String&gt; parseLeftNode(SqlNode sqlNode){                                                </span>
<span class="-7809629950828083535" onmouseenter="enter('-7809629950828083535');" onmouseout="out('-7809629950828083535');" style=""> 756          Tuple2&lt;String, String&gt; tabName = new Tuple2&lt;&gt;(&quot;&quot;, &quot;&quot;);                                                    </span>
<span class="7570038518439211250" onmouseenter="enter('7570038518439211250');" onmouseout="out('7570038518439211250');" style=""> 757          if(sqlNode.getKind() == IDENTIFIER){                                                                      </span>
<span class="-7735158387636601028" onmouseenter="enter('-7735158387636601028');" onmouseout="out('-7735158387636601028');" style=""> 758              tabName.f0 = sqlNode.toString();                                                                      </span>
<span class="-6648818000206782174" onmouseenter="enter('-6648818000206782174');" onmouseout="out('-6648818000206782174');" style=""> 759              tabName.f1 = sqlNode.toString();                                                                      </span>
<span class="7640894634328871584" onmouseenter="enter('7640894634328871584');" onmouseout="out('7640894634328871584');" style=""> 760          }else if (sqlNode.getKind() == AS){                                                                       </span>
<span class="-4085054753182131209" onmouseenter="enter('-4085054753182131209');" onmouseout="out('-4085054753182131209');" style=""> 761              SqlNode info = ((SqlBasicCall)sqlNode).getOperands()[0];                                              </span>
<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style=""> 762              SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                                            </span>
<span  style=""> 763                                                                                                                    </span>
<span class="6350181014025417708" onmouseenter="enter('6350181014025417708');" onmouseout="out('6350181014025417708');" style=""> 764              tabName.f0 = info.toString();                                                                         </span>
<span class="-6499418961284910074" onmouseenter="enter('-6499418961284910074');" onmouseout="out('-6499418961284910074');" style=""> 765              tabName.f1 = alias.toString();                                                                        </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 766          }else {                                                                                                   </span>
<span class="-4528765899368294479" onmouseenter="enter('-4528765899368294479');" onmouseout="out('-4528765899368294479');" style=""> 767              throw new RuntimeException(&quot;&quot;);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 768          }                                                                                                         </span>
<span  style=""> 769                                                                                                                    </span>
<span class="-6789109484485831180" onmouseenter="enter('-6789109484485831180');" onmouseout="out('-6789109484485831180');" style=""> 770          return tabName;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 771      }                                                                                                             </span>
<span  style=""> 772                                                                                                                    </span>
<span class="2221421009159751305" onmouseenter="enter('2221421009159751305');" onmouseout="out('2221421009159751305');" style=""> 773      public String buildCondition(List&lt;SqlBasicCall&gt; conditionList){                                               </span>
<span class="-4757924659479519527" onmouseenter="enter('-4757924659479519527');" onmouseout="out('-4757924659479519527');" style=""> 774          if(CollectionUtils.isEmpty(conditionList)){                                                               </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 775              return &quot;&quot;;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 776          }                                                                                                         </span>
<span  style=""> 777                                                                                                                    </span>
<span class="-8689756052096276488" onmouseenter="enter('-8689756052096276488');" onmouseout="out('-8689756052096276488');" style=""> 778          return &quot; where &quot; + StringUtils.join(conditionList, &quot; AND &quot;);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 779      }                                                                                                             </span>
<span  style=""> 780                                                                                                                    </span>
<span class="5697770358925248547" onmouseenter="enter('5697770358925248547');" onmouseout="out('5697770358925248547');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 781 -    public String buildSelectNode(Set&lt;String&gt; extractSelectField, Set&lt;String&gt; joinFieldSet){                      </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 782 +    /**                                                                                                           </span>
<span class="5006751944576812925" onmouseenter="enter('5006751944576812925');" onmouseout="out('5006751944576812925');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 783 +     * 构建抽取表的查询字段信息                                                                                               </span>
<span class="6846485922393067420" onmouseenter="enter('6846485922393067420');" onmouseout="out('6846485922393067420');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 784 +     * 包括去除重复字段，名称相同的取别名                                                                                          </span>
<span class="5143638493602795740" onmouseenter="enter('5143638493602795740');" onmouseout="out('5143638493602795740');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 785 +     * @param extractSelectField                                                                                  </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 786 +     * @param joinFieldSet                                                                                        </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 787 +     * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 788 +     */                                                                                                           </span>
<span class="3285722409292673394" onmouseenter="enter('3285722409292673394');" onmouseout="out('3285722409292673394');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 789 +    public Set&lt;String&gt; buildSelectNode(Set&lt;String&gt; extractSelectField, Set&lt;String&gt; joinFieldSet){                 </span>
<span class="2785520985351844766" onmouseenter="enter('2785520985351844766');" onmouseout="out('2785520985351844766');" style=""> 790          if(CollectionUtils.isEmpty(extractSelectField)){                                                          </span>
<span class="5868864582051651172" onmouseenter="enter('5868864582051651172');" onmouseout="out('5868864582051651172');" style=""> 791              throw new RuntimeException(&quot;no field is used&quot;);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 792          }                                                                                                         </span>
<span  style=""> 793                                                                                                                    </span>
<span class="6553440588068575808" onmouseenter="enter('6553440588068575808');" onmouseout="out('6553440588068575808');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 794 -        Sets.SetView view = Sets.union(extractSelectField, joinFieldSet);                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 795 -                                                                                                                  </span>
<span class="-551741438203083334" onmouseenter="enter('-551741438203083334');" onmouseout="out('-551741438203083334');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 796 -        return StringUtils.join(view, &quot;,&quot;);                                                                       </span>
<span class="5899553187345814636" onmouseenter="enter('5899553187345814636');" onmouseout="out('5899553187345814636');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 797 +        Sets.SetView&lt;String&gt; view = Sets.union(extractSelectField, joinFieldSet);                                 </span>
<span class="797241606485232847" onmouseenter="enter('797241606485232847');" onmouseout="out('797241606485232847');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 798 +        Set&lt;String&gt; newFieldSet = Sets.newHashSet();                                                              </span>
<span class="2745035293344511362" onmouseenter="enter('2745035293344511362');" onmouseout="out('2745035293344511362');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 799 +        //为相同的列取别名                                                                                                </span>
<span class="8688032100713956589" onmouseenter="enter('8688032100713956589');" onmouseout="out('8688032100713956589');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 800 +        HashBiMap&lt;String, String&gt; refFieldMap = HashBiMap.create();                                               </span>
<span class="1329112150316943640" onmouseenter="enter('1329112150316943640');" onmouseout="out('1329112150316943640');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 801 +        for(String field : view){                                                                                 </span>
<span class="-1968894175389259310" onmouseenter="enter('-1968894175389259310');" onmouseout="out('-1968894175389259310');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 802 +            String[] fieldInfo = StringUtils.split(field, &#x27;.&#x27;);                                                   </span>
<span class="-8742203946899533370" onmouseenter="enter('-8742203946899533370');" onmouseout="out('-8742203946899533370');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 803 +            String aliasName = fieldInfo[1];                                                                      </span>
<span class="5196316369925853718" onmouseenter="enter('5196316369925853718');" onmouseout="out('5196316369925853718');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 804 +            StringBuilder stringBuilder = new StringBuilder();                                                    </span>
<span class="7892052963016733083" onmouseenter="enter('7892052963016733083');" onmouseout="out('7892052963016733083');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 805 +            stringBuilder.append(field);                                                                          </span>
<span class="4929718891791635894" onmouseenter="enter('4929718891791635894');" onmouseout="out('4929718891791635894');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 806 +            if(refFieldMap.inverse().get(aliasName) != null){                                                     </span>
<span class="3911751569834415230" onmouseenter="enter('3911751569834415230');" onmouseout="out('3911751569834415230');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 807 +                aliasName = ParseUtils.dealDuplicateFieldName(refFieldMap, aliasName);                            </span>
<span class="-7772471183494378441" onmouseenter="enter('-7772471183494378441');" onmouseout="out('-7772471183494378441');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 808 +                stringBuilder.append(&quot; as &quot;)                                                                      </span>
<span class="-6698804491367054275" onmouseenter="enter('-6698804491367054275');" onmouseout="out('-6698804491367054275');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 809 +                        .append(aliasName);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 810 +            }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 811 +                                                                                                                  </span>
<span class="3161846128983396458" onmouseenter="enter('3161846128983396458');" onmouseout="out('3161846128983396458');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 812 +            refFieldMap.put(field, aliasName);                                                                    </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 813 +                                                                                                                  </span>
<span class="1307446912208510489" onmouseenter="enter('1307446912208510489');" onmouseout="out('1307446912208510489');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 814 +            newFieldSet.add(stringBuilder.toString());                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 815 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 816 +                                                                                                                  </span>
<span class="-4429217721906814107" onmouseenter="enter('-4429217721906814107');" onmouseout="out('-4429217721906814107');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 817 +        return newFieldSet;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 818      }                                                                                                             </span>
<span  style=""> 819                                                                                                                    </span>
<span class="4243587240101238542" onmouseenter="enter('4243587240101238542');" onmouseout="out('4243587240101238542');" style=""> 820      private boolean checkIsSideTable(String tableName, Set&lt;String&gt; sideTableList){                                </span>
<span class="7734723301291741274" onmouseenter="enter('7734723301291741274');" onmouseout="out('7734723301291741274');" style=""> 821          if(sideTableList.contains(tableName)){                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 822              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 823          }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 824          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 825      }                                                                                                             </span>
<span  style=""> 826                                                                                                                    </span>
<span class="-8109971872323514495" onmouseenter="enter('-8109971872323514495');" onmouseout="out('-8109971872323514495');" style=""> 827      private SqlBasicCall buildAsSqlNode(String internalTableName, SqlNode newSource) {                            </span>
<span class="2981236818393294037" onmouseenter="enter('2981236818393294037');" onmouseout="out('2981236818393294037');" style=""> 828          SqlOperator operator = new SqlAsOperator();                                                               </span>
<span class="-1667801166019875282" onmouseenter="enter('-1667801166019875282');" onmouseout="out('-1667801166019875282');" style=""> 829          SqlParserPos sqlParserPos = new SqlParserPos(0, 0);                                                       </span>
<span class="8198536898736028280" onmouseenter="enter('8198536898736028280');" onmouseout="out('8198536898736028280');" style=""> 830          SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(internalTableName, null, sqlParserPos);              </span>
<span class="-7310412248425019303" onmouseenter="enter('-7310412248425019303');" onmouseout="out('-7310412248425019303');" style=""> 831          SqlNode[] sqlNodes = new SqlNode[2];                                                                      </span>
<span class="2025970151619105195" onmouseenter="enter('2025970151619105195');" onmouseout="out('2025970151619105195');" style=""> 832          sqlNodes[0] = newSource;                                                                                  </span>
<span class="-4093556188235461327" onmouseenter="enter('-4093556188235461327');" onmouseout="out('-4093556188235461327');" style=""> 833          sqlNodes[1] = sqlIdentifierAlias;                                                                         </span>
<span class="-1928364106966605511" onmouseenter="enter('-1928364106966605511');" onmouseout="out('-1928364106966605511');" style=""> 834          return new SqlBasicCall(operator, sqlNodes, sqlParserPos);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 835      }                                                                                                             </span>
<span  style=""> 836                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 837 +    /**                                                                                                           </span>
<span class="-7510152128791177313" onmouseenter="enter('-7510152128791177313');" onmouseout="out('-7510152128791177313');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 838 +     * 获取where中和指定表有关联的字段                                                                                         </span>
<span class="-6365101737408851156" onmouseenter="enter('-6365101737408851156');" onmouseout="out('-6365101737408851156');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 839 +     * @param fromTableNameSet                                                                                    </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 840 +     * @param parentWhere                                                                                         </span>
<span class="-2506765310601959421" onmouseenter="enter('-2506765310601959421');" onmouseout="out('-2506765310601959421');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 841 +     * @param extractCondition                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 842 +     */                                                                                                           </span>
<span class="1461432174075439627" onmouseenter="enter('1461432174075439627');" onmouseout="out('1461432174075439627');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 843 +    private void extractWhereCondition(Set&lt;String&gt; fromTableNameSet, SqlBasicCall parentWhere, Set&lt;String&gt; extractCondition){"> 843 +    private void extractWhereCondition(Set&lt;String&gt; fromTableNameSet, SqlBasicCall parentWhere, Set&lt;String&gt; extract🔵</abbr></span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 844 +                                                                                                                  </span>
<span class="-7344361739038630250" onmouseenter="enter('-7344361739038630250');" onmouseout="out('-7344361739038630250');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 845 +        if(parentWhere == null){                                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 846 +            return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 847 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 848 +                                                                                                                  </span>
<span class="7198030462908925381" onmouseenter="enter('7198030462908925381');" onmouseout="out('7198030462908925381');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 849 +        SqlKind kind = parentWhere.getKind();                                                                     </span>
<span class="-1872623569752802183" onmouseenter="enter('-1872623569752802183');" onmouseout="out('-1872623569752802183');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 850 +        if(kind == AND){                                                                                          </span>
<span class="-4193978700874903441" onmouseenter="enter('-4193978700874903441');" onmouseout="out('-4193978700874903441');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 851 +            extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[0], extractCondition);"> 851 +            extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[0], extractCondition)🔵</abbr></span>
<span class="8237513597398016508" onmouseenter="enter('8237513597398016508');" onmouseout="out('8237513597398016508');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 852 +            extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[1], extractCondition);"> 852 +            extractWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[1], extractCondition)🔵</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 853 +        } else {                                                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 854 +                                                                                                                  </span>
<span class="6559819810856557747" onmouseenter="enter('6559819810856557747');" onmouseout="out('6559819810856557747');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 855 +            Set&lt;String&gt; fieldInfos = Sets.newHashSet();                                                           </span>
<span class="-8171369927933096656" onmouseenter="enter('-8171369927933096656');" onmouseout="out('-8171369927933096656');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 856 +            TableUtils.getConditionRefTable(parentWhere, fieldInfos);                                             </span>
<span class="-4461527983639478234" onmouseenter="enter('-4461527983639478234');" onmouseout="out('-4461527983639478234');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 857 +            fieldInfos.forEach(fieldInfo -&gt; {                                                                     </span>
<span class="4976250547552714974" onmouseenter="enter('4976250547552714974');" onmouseout="out('4976250547552714974');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 858 +                String[] splitInfo = StringUtils.split(fieldInfo, &quot;.&quot;);                                           </span>
<span class="-9163656437830109655" onmouseenter="enter('-9163656437830109655');" onmouseout="out('-9163656437830109655');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 859 +                if(splitInfo.length == 2 &amp;&amp; fromTableNameSet.contains(splitInfo[0])){                             </span>
<span class="7162103078043141858" onmouseenter="enter('7162103078043141858');" onmouseout="out('7162103078043141858');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 860 +                    extractCondition.add(fieldInfo);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 861 +                }                                                                                                 </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 862 +            });                                                                                                   </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 863 +                                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 864 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 865 +                                                                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 866 +                                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 867 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 868 +                                                                                                                  </span>
<span  style=""> 869                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 870      /**                                                                                                           </span>
<span class="-74598125528384596" onmouseenter="enter('-74598125528384596');" onmouseout="out('-74598125528384596');" style=""> 871       * 检查关联的where 条件中的判断是否可以下移到新构建的子查询                                                                            </span>
<span class="-6365101737408851156" onmouseenter="enter('-6365101737408851156');" onmouseout="out('-6365101737408851156');" style=""> 872       * @param fromTableNameSet                                                                                    </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 873       * @param parentWhere                                                                                         </span>
<span class="-2506765310601959421" onmouseenter="enter('-2506765310601959421');" onmouseout="out('-2506765310601959421');" style=""> 874       * @param extractCondition                                                                                    </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 875       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 876       */                                                                                                           </span>
<span class="-3374362155096196822" onmouseenter="enter('-3374362155096196822');" onmouseout="out('-3374362155096196822');" style=""> 877      private boolean checkAndRemoveWhereCondition(Set&lt;String&gt; fromTableNameSet,                                    </span>
<span class="1711245815305911921" onmouseenter="enter('1711245815305911921');" onmouseout="out('1711245815305911921');" style=""> 878                                                   SqlBasicCall parentWhere,                                        </span>
<span class="-6744704019370069554" onmouseenter="enter('-6744704019370069554');" onmouseout="out('-6744704019370069554');" style=""> 879                                                   List&lt;SqlBasicCall&gt; extractCondition){                            </span>
<span class="-7344361739038630250" onmouseenter="enter('-7344361739038630250');" onmouseout="out('-7344361739038630250');" style=""> 880          if(parentWhere == null){                                                                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 881              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 882          }                                                                                                         </span>
<span  style=""> 883                                                                                                                    </span>
<span class="7198030462908925381" onmouseenter="enter('7198030462908925381');" onmouseout="out('7198030462908925381');" style=""> 884          SqlKind kind = parentWhere.getKind();                                                                     </span>
<span class="-1872623569752802183" onmouseenter="enter('-1872623569752802183');" onmouseout="out('-1872623569752802183');" style=""> 885          if(kind == AND){                                                                                          </span>
<span class="-8510136866484254033" onmouseenter="enter('-8510136866484254033');" onmouseout="out('-8510136866484254033');" style=""><abbr title=" 886              boolean removeLeft = checkAndRemoveWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[0], extractCondition);"> 886              boolean removeLeft = checkAndRemoveWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOper🔵</abbr></span>
<span class="-2929912762198310557" onmouseenter="enter('-2929912762198310557');" onmouseout="out('-2929912762198310557');" style=""><abbr title=" 887              boolean removeRight = checkAndRemoveWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[1], extractCondition);"> 887              boolean removeRight = checkAndRemoveWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOpe🔵</abbr></span>
<span class="891835357289668161" onmouseenter="enter('891835357289668161');" onmouseout="out('891835357289668161');" style=""> 888              //DO remove                                                                                           </span>
<span class="1439443091018833301" onmouseenter="enter('1439443091018833301');" onmouseout="out('1439443091018833301');" style=""> 889              if(removeLeft){                                                                                       </span>
<span class="5619021625980792664" onmouseenter="enter('5619021625980792664');" onmouseout="out('5619021625980792664');" style=""> 890                  extractCondition.add(removeWhereConditionNode(parentWhere, 0));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 891              }                                                                                                     </span>
<span  style=""> 892                                                                                                                    </span>
<span class="6778546312639684033" onmouseenter="enter('6778546312639684033');" onmouseout="out('6778546312639684033');" style=""> 893              if(removeRight){                                                                                      </span>
<span class="-3233327769126268813" onmouseenter="enter('-3233327769126268813');" onmouseout="out('-3233327769126268813');" style=""> 894                  extractCondition.add(removeWhereConditionNode(parentWhere, 1));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 895              }                                                                                                     </span>
<span  style=""> 896                                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 897              return false;                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 898          } else {                                                                                                  </span>
<span class="-5890893362753249434" onmouseenter="enter('-5890893362753249434');" onmouseout="out('-5890893362753249434');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 899 +            //条件表达式，如果该条件关联的表都是指定的表则移除                                                                            </span>
<span class="6559819810856557747" onmouseenter="enter('6559819810856557747');" onmouseout="out('6559819810856557747');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 900 +            Set&lt;String&gt; fieldInfos = Sets.newHashSet();                                                           </span>
<span class="-8171369927933096656" onmouseenter="enter('-8171369927933096656');" onmouseout="out('-8171369927933096656');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 901 +            TableUtils.getConditionRefTable(parentWhere, fieldInfos);                                             </span>
<span class="2827886728692945898" onmouseenter="enter('2827886728692945898');" onmouseout="out('2827886728692945898');" style=""> 902              Set&lt;String&gt; conditionRefTableNameSet = Sets.newHashSet();                                             </span>
<span class="-8585593551708223309" onmouseenter="enter('-8585593551708223309');" onmouseout="out('-8585593551708223309');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 903 -            TableUtils.getConditionRefTable(parentWhere, conditionRefTableNameSet);                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 904 +                                                                                                                  </span>
<span class="-4461527983639478234" onmouseenter="enter('-4461527983639478234');" onmouseout="out('-4461527983639478234');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 905 +            fieldInfos.forEach(fieldInfo -&gt; {                                                                     </span>
<span class="4976250547552714974" onmouseenter="enter('4976250547552714974');" onmouseout="out('4976250547552714974');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 906 +                String[] splitInfo = StringUtils.split(fieldInfo, &quot;.&quot;);                                           </span>
<span class="-504061461178926812" onmouseenter="enter('-504061461178926812');" onmouseout="out('-504061461178926812');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 907 +                if(splitInfo.length == 2){                                                                        </span>
<span class="-1599449602125672029" onmouseenter="enter('-1599449602125672029');" onmouseout="out('-1599449602125672029');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 908 +                    conditionRefTableNameSet.add(splitInfo[0]);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 909 +                }                                                                                                 </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 910 +            });                                                                                                   </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 911 +                                                                                                                  </span>
<span  style=""> 912                                                                                                                    </span>
<span class="1299203886922461523" onmouseenter="enter('1299203886922461523');" onmouseout="out('1299203886922461523');" style=""> 913              if(fromTableNameSet.containsAll(conditionRefTableNameSet)){                                           </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 914                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 915              }                                                                                                     </span>
<span  style=""> 916                                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 917              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 918          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 919      }                                                                                                             </span>
<span  style=""> 920                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 921      /**                                                                                                           </span>
<span class="967733528902221289" onmouseenter="enter('967733528902221289');" onmouseout="out('967733528902221289');" style=""> 922       * 抽取where 条件中指定的条件                                                                                           </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 923       * @param parentWhere                                                                                         </span>
<span class="-460759719067432320" onmouseenter="enter('-460759719067432320');" onmouseout="out('-460759719067432320');" style=""> 924       * @param index                                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 925       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 926       */                                                                                                           </span>
<span class="-8004122385362241836" onmouseenter="enter('-8004122385362241836');" onmouseout="out('-8004122385362241836');" style=""> 927      public SqlBasicCall removeWhereConditionNode(SqlBasicCall parentWhere, int index){                            </span>
<span class="2911889278610374450" onmouseenter="enter('2911889278610374450');" onmouseout="out('2911889278610374450');" style=""> 928          SqlBasicCall oldCondition = (SqlBasicCall) parentWhere.getOperands()[index];                              </span>
<span class="3156064786234930120" onmouseenter="enter('3156064786234930120');" onmouseout="out('3156064786234930120');" style=""> 929          parentWhere.setOperand(index, buildEmptyCondition());                                                     </span>
<span class="-6343538087515378636" onmouseenter="enter('-6343538087515378636');" onmouseout="out('-6343538087515378636');" style=""> 930          return oldCondition;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 931      }                                                                                                             </span>
<span  style=""> 932                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 933      /**                                                                                                           </span>
<span class="-6739953174199833520" onmouseenter="enter('-6739953174199833520');" onmouseout="out('-6739953174199833520');" style=""> 934       * 构建 1=1的 where 条件                                                                                           </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 935       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 936       */                                                                                                           </span>
<span class="-4073514796854358980" onmouseenter="enter('-4073514796854358980');" onmouseout="out('-4073514796854358980');" style=""> 937      public SqlBasicCall buildEmptyCondition(){                                                                    </span>
<span class="7737073508893451149" onmouseenter="enter('7737073508893451149');" onmouseout="out('7737073508893451149');" style=""> 938          SqlBinaryOperator equalsOperators = SqlStdOperatorTable.EQUALS;                                           </span>
<span class="-6629769419150459383" onmouseenter="enter('-6629769419150459383');" onmouseout="out('-6629769419150459383');" style=""> 939          SqlNode[] operands = new SqlNode[2];                                                                      </span>
<span class="7829210030518325331" onmouseenter="enter('7829210030518325331');" onmouseout="out('7829210030518325331');" style=""> 940          operands[0] = SqlLiteral.createExactNumeric(&quot;1&quot;, SqlParserPos.ZERO);                                      </span>
<span class="8653141241037221613" onmouseenter="enter('8653141241037221613');" onmouseout="out('8653141241037221613');" style=""> 941          operands[1] = SqlLiteral.createExactNumeric(&quot;1&quot;, SqlParserPos.ZERO);                                      </span>
<span  style=""> 942                                                                                                                    </span>
<span class="-886608164186614965" onmouseenter="enter('-886608164186614965');" onmouseout="out('-886608164186614965');" style=""> 943          return new SqlBasicCall(equalsOperators, operands, SqlParserPos.ZERO);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 944      }                                                                                                             </span>
<span  style=""> 945                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 946      /**                                                                                                           </span>
<span class="6566659164166093473" onmouseenter="enter('6566659164166093473');" onmouseout="out('6566659164166093473');" style=""> 947       * 替换join 条件中的表名称                                                                                             </span>
<span class="384197096128287152" onmouseenter="enter('384197096128287152');" onmouseout="out('384197096128287152');" style=""> 948       * @param node                                                                                                </span>
<span class="1832696003310156507" onmouseenter="enter('1832696003310156507');" onmouseout="out('1832696003310156507');" style=""> 949       * @param tableMap 表名的关联关系                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 950       */                                                                                                           </span>
<span class="8926761967375059586" onmouseenter="enter('8926761967375059586');" onmouseout="out('8926761967375059586');" style=""> 951      private SqlIdentifier checkAndReplaceJoinCondition(SqlNode node, Map&lt;String, String&gt; tableMap){               </span>
<span  style=""> 952                                                                                                                    </span>
<span class="-4460996797142447051" onmouseenter="enter('-4460996797142447051');" onmouseout="out('-4460996797142447051');" style=""> 953          SqlKind joinKind = node.getKind();                                                                        </span>
<span class="6904180996725590590" onmouseenter="enter('6904180996725590590');" onmouseout="out('6904180996725590590');" style=""> 954          if( joinKind == AND || joinKind == EQUALS ){                                                              </span>
<span class="-5502960919920628784" onmouseenter="enter('-5502960919920628784');" onmouseout="out('-5502960919920628784');" style=""> 955              SqlIdentifier leftNode = checkAndReplaceJoinCondition(((SqlBasicCall)node).operands[0], tableMap);    </span>
<span class="-1134508213250580541" onmouseenter="enter('-1134508213250580541');" onmouseout="out('-1134508213250580541');" style=""> 956              SqlIdentifier rightNode = checkAndReplaceJoinCondition(((SqlBasicCall)node).operands[1], tableMap);   </span>
<span  style=""> 957                                                                                                                    </span>
<span class="1261032046064330806" onmouseenter="enter('1261032046064330806');" onmouseout="out('1261032046064330806');" style=""> 958              if(leftNode != null){                                                                                 </span>
<span class="7925883472313959466" onmouseenter="enter('7925883472313959466');" onmouseout="out('7925883472313959466');" style=""> 959                  ((SqlBasicCall)node).setOperand(0, leftNode);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 960              }                                                                                                     </span>
<span  style=""> 961                                                                                                                    </span>
<span class="-5287428749677694788" onmouseenter="enter('-5287428749677694788');" onmouseout="out('-5287428749677694788');" style=""> 962              if(rightNode != null){                                                                                </span>
<span class="-6758558001428237557" onmouseenter="enter('-6758558001428237557');" onmouseout="out('-6758558001428237557');" style=""> 963                  ((SqlBasicCall)node).setOperand(1, leftNode);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 964              }                                                                                                     </span>
<span  style=""> 965                                                                                                                    </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 966              return null;                                                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 967          } else {                                                                                                  </span>
<span class="2603254540286226339" onmouseenter="enter('2603254540286226339');" onmouseout="out('2603254540286226339');" style=""> 968              //replace table                                                                                       </span>
<span class="-7283729608735687376" onmouseenter="enter('-7283729608735687376');" onmouseout="out('-7283729608735687376');" style=""><abbr title=" 969              Preconditions.checkState(((SqlIdentifier)node).names.size() == 2, &quot;join condition must be format table.field&quot;);"> 969              Preconditions.checkState(((SqlIdentifier)node).names.size() == 2, &quot;join condition must be format table🔵</abbr></span>
<span class="5830077366186139259" onmouseenter="enter('5830077366186139259');" onmouseout="out('5830077366186139259');" style=""> 970              String tbName = ((SqlIdentifier) node).names.get(0);                                                  </span>
<span class="807909526670811479" onmouseenter="enter('807909526670811479');" onmouseout="out('807909526670811479');" style=""> 971              if(tableMap.containsKey(tbName)){                                                                     </span>
<span class="-5261902895497527633" onmouseenter="enter('-5261902895497527633');" onmouseout="out('-5261902895497527633');" style=""> 972                  tbName = tableMap.get(tbName);                                                                    </span>
<span class="6671350446806430567" onmouseenter="enter('6671350446806430567');" onmouseout="out('6671350446806430567');" style=""> 973                  return ((SqlIdentifier) node).setName(0, tbName);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 974              }                                                                                                     </span>
<span  style=""> 975                                                                                                                    </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 976              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 977          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 978      }                                                                                                             </span>
<span  style=""> 979                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 980 +    /**                                                                                                           </span>
<span class="-582093827946699422" onmouseenter="enter('-582093827946699422');" onmouseout="out('-582093827946699422');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 981 +     * 解析出临时中间表的属性列和源表之间的关系                                                                                       </span>
<span class="-1738998936074699450" onmouseenter="enter('-1738998936074699450');" onmouseout="out('-1738998936074699450');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 982 +     * @param fieldSet                                                                                            </span>
<span class="-1251790622416547945" onmouseenter="enter('-1251790622416547945');" onmouseout="out('-1251790622416547945');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 983 +     * @param newTableAliasName                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 984 +     */                                                                                                           </span>
<span class="-8784345461796351735" onmouseenter="enter('-8784345461796351735');" onmouseout="out('-8784345461796351735');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 985 +    public Map&lt;String, String&gt; buildTmpTableFieldRefOriField(Set&lt;String&gt; fieldSet, String newTableAliasName){     </span>
<span class="-5385725062618077806" onmouseenter="enter('-5385725062618077806');" onmouseout="out('-5385725062618077806');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 986 +        Map&lt;String, String&gt; refInfo = Maps.newConcurrentMap();                                                    </span>
<span class="2568903137449276094" onmouseenter="enter('2568903137449276094');" onmouseout="out('2568903137449276094');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 987 +        for(String field : fieldSet){                                                                             </span>
<span class="-7222334792573134755" onmouseenter="enter('-7222334792573134755');" onmouseout="out('-7222334792573134755');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 988 +            String[] fields = StringUtils.splitByWholeSeparator(field, &quot;as&quot;);                                     </span>
<span class="2626056789923691030" onmouseenter="enter('2626056789923691030');" onmouseout="out('2626056789923691030');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 989 +            String oldKey = field;                                                                                </span>
<span class="-5195760423326791334" onmouseenter="enter('-5195760423326791334');" onmouseout="out('-5195760423326791334');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 990 +            String[] oldFieldInfo = StringUtils.splitByWholeSeparator(fields[0], &quot;.&quot;);                            </span>
<span class="7999505930284522125" onmouseenter="enter('7999505930284522125');" onmouseout="out('7999505930284522125');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 991 +            String oldFieldName = oldFieldInfo.length == 2 ? oldFieldInfo[1] : oldFieldInfo[0];                   </span>
<span class="-6597088482986838827" onmouseenter="enter('-6597088482986838827');" onmouseout="out('-6597088482986838827');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 992 +            String newKey = fields.length == 2 ? newTableAliasName + &quot;.&quot; + fields[1] :                            </span>
<span class="-4119680836077812037" onmouseenter="enter('-4119680836077812037');" onmouseout="out('-4119680836077812037');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 993 +                    newTableAliasName + &quot;.&quot; + oldFieldName;                                                       </span>
<span class="-3733750508357987129" onmouseenter="enter('-3733750508357987129');" onmouseout="out('-3733750508357987129');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 994 +            refInfo.put(oldKey, newKey);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 995 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 996 +                                                                                                                  </span>
<span class="8147181196901690092" onmouseenter="enter('8147181196901690092');" onmouseout="out('8147181196901690092');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 997 +        return refInfo;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 998 +    }                                                                                                             </span>
<span  style=""> 999                                                                                                                    </span>
<span  style="">1000                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1001  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  20  package com.dtstack.flink.sql.side;                                                                               </span>
<span  style="">  21                                                                                                                    </span>
<span class="8446286977962994340" onmouseenter="enter('8446286977962994340');" onmouseout="out('8446286977962994340');" style="">  22  import com.dtstack.flink.sql.config.CalciteConfig;                                                                </span>


<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  23  import com.dtstack.flink.sql.util.TableUtils;                                                                     </span>
<span class="-1945462796058520247" onmouseenter="enter('-1945462796058520247');" onmouseout="out('-1945462796058520247');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  24 +import com.esotericsoftware.minlog.Log;                                                                           </span>
<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  25  import com.google.common.base.Preconditions;                                                                      </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  26  import com.google.common.collect.Lists;                                                                           </span>
<span class="6390139568718476113" onmouseenter="enter('6390139568718476113');" onmouseout="out('6390139568718476113');" style="">  27  import com.google.common.collect.Sets;                                                                            </span>

<span class="8584998077480306668" onmouseenter="enter('8584998077480306668');" onmouseout="out('8584998077480306668');" style="">  28  import org.apache.calcite.sql.JoinType;                                                                           </span>
<span class="-6347312057640942811" onmouseenter="enter('-6347312057640942811');" onmouseout="out('-6347312057640942811');" style="">  29  import org.apache.calcite.sql.SqlAsOperator;                                                                      </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  30  import org.apache.calcite.sql.SqlBasicCall;                                                                       </span>
<span class="5864552825243215550" onmouseenter="enter('5864552825243215550');" onmouseout="out('5864552825243215550');" style="">  31  import org.apache.calcite.sql.SqlBinaryOperator;                                                                  </span>
<span class="166699767162158130" onmouseenter="enter('166699767162158130');" onmouseout="out('166699767162158130');" style="">  32  import org.apache.calcite.sql.SqlDataTypeSpec;                                                                    </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  33  import org.apache.calcite.sql.SqlIdentifier;                                                                      </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  34  import org.apache.calcite.sql.SqlJoin;                                                                            </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  35  import org.apache.calcite.sql.SqlKind;                                                                            </span>
<span class="8852969977988754364" onmouseenter="enter('8852969977988754364');" onmouseout="out('8852969977988754364');" style="">  36  import org.apache.calcite.sql.SqlLiteral;                                                                         </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  37  import org.apache.calcite.sql.SqlNode;                                                                            </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  38  import org.apache.calcite.sql.SqlNodeList;                                                                        </span>
<span class="2919518510870551176" onmouseenter="enter('2919518510870551176');" onmouseout="out('2919518510870551176');" style="">  39  import org.apache.calcite.sql.SqlOperator;                                                                        </span>
<span class="7522331514027736252" onmouseenter="enter('7522331514027736252');" onmouseout="out('7522331514027736252');" style="">  40  import org.apache.calcite.sql.fun.SqlCase;                                                                        </span>
<span class="5604125466397600003" onmouseenter="enter('5604125466397600003');" onmouseout="out('5604125466397600003');" style="">  41  import org.apache.calcite.sql.fun.SqlStdOperatorTable;                                                            </span>
<span class="1277226550340008522" onmouseenter="enter('1277226550340008522');" onmouseout="out('1277226550340008522');" style="">  42  import org.apache.calcite.sql.parser.SqlParser;                                                                   </span>
<span class="-8475519504744506507" onmouseenter="enter('-8475519504744506507');" onmouseout="out('-8475519504744506507');" style="">  43  import org.apache.calcite.sql.parser.SqlParserPos;                                                                </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  44  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  45  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  46  import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>

<span  style="">  47                                                                                                                    </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  48  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  49  import java.util.Map;                                                                                             </span>
<span class="-2789246819365843415" onmouseenter="enter('-2789246819365843415');" onmouseout="out('-2789246819365843415');" style="">  50  import java.util.Queue;                                                                                           </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  51  import java.util.Set;                                                                                             </span>
<span  style="">  52                                                                                                                    </span>
<span class="7147213704442467623" onmouseenter="enter('7147213704442467623');" onmouseout="out('7147213704442467623');" style="">  53  import static org.apache.calcite.sql.SqlKind.*;                                                                   </span>
<span  style="">  54                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  55  /**                                                                                                               </span>
<span class="-4563013574845795077" onmouseenter="enter('-4563013574845795077');" onmouseout="out('-4563013574845795077');" style="">  56   * 处理join 节点                                                                                                      </span>
<span class="8838344550496049683" onmouseenter="enter('8838344550496049683');" onmouseout="out('8838344550496049683');" style="">  57   * 1:如果包含维表节点替换为临时查询                                                                                              </span>
<span class="-7758652626234959796" onmouseenter="enter('-7758652626234959796');" onmouseout="out('-7758652626234959796');" style="">  58   * Date: 2020/2/27                                                                                                </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  59   * Company: www.dtstack.com                                                                                       </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  60   * @author xuchao                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  61   */                                                                                                               </span>
<span  style="">  62                                                                                                                    </span>
<span class="-8466270758182619990" onmouseenter="enter('-8466270758182619990');" onmouseout="out('-8466270758182619990');" style="">  63  public class JoinNodeDealer {                                                                                     </span>
<span  style="">  64                                                                                                                    </span>
<span class="8212789117715876957" onmouseenter="enter('8212789117715876957');" onmouseout="out('8212789117715876957');" style="">  65      //用来构建临时的中间查询                                                                                                 </span>
<span class="7730461828310962384" onmouseenter="enter('7730461828310962384');" onmouseout="out('7730461828310962384');" style="">  66      private static final String SELECT_TEMP_SQL = &quot;select %s from %s %s&quot;;                                         </span>
<span  style="">  67                                                                                                                    </span>
<span class="-2249026806703256771" onmouseenter="enter('-2249026806703256771');" onmouseout="out('-2249026806703256771');" style="">  68      private SideSQLParser sideSQLParser;                                                                          </span>
<span  style="">  69                                                                                                                    </span>
<span class="-3616611273672037444" onmouseenter="enter('-3616611273672037444');" onmouseout="out('-3616611273672037444');" style="">  70      public JoinNodeDealer(SideSQLParser sideSQLParser){                                                           </span>
<span class="1661690928916125634" onmouseenter="enter('1661690928916125634');" onmouseout="out('1661690928916125634');" style="">  71          this.sideSQLParser = sideSQLParser;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  72      }                                                                                                             </span>
<span  style="">  73                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  74      /**                                                                                                           </span>
<span class="5343191871470402950" onmouseenter="enter('5343191871470402950');" onmouseout="out('5343191871470402950');" style="">  75       * 解析 join 操作                                                                                                 </span>
<span class="-2995351136134268537" onmouseenter="enter('-2995351136134268537');" onmouseout="out('-2995351136134268537');" style="">  76       * @param joinNode                                                                                            </span>
<span class="4073180356368850460" onmouseenter="enter('4073180356368850460');" onmouseout="out('4073180356368850460');" style="">  77       * @param sideTableSet 标明哪些表名是维表                                                                              </span>
<span class="3894561521416724418" onmouseenter="enter('3894561521416724418');" onmouseout="out('3894561521416724418');" style="">  78       * @param queueInfo                                                                                           </span>

<span class="-789269741895746259" onmouseenter="enter('-789269741895746259');" onmouseout="out('-789269741895746259');" style="">  79       * @param parentWhere join 关联的最上层的where 节点                                                                    </span>
<span class="2915402449338812450" onmouseenter="enter('2915402449338812450');" onmouseout="out('2915402449338812450');" style="">  80       * @param parentSelectList join 关联的最上层的select 节点                                                              </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style="">  81       * @param joinFieldSet                                                                                        </span>
<span class="6609942655811766869" onmouseenter="enter('6609942655811766869');" onmouseout="out('6609942655811766869');" style="">  82       * @param tableRef 存储构建临时表查询后源表和新表之间的关联关系                                                                     </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="">  83       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  84       */                                                                                                           </span>
<span class="-5731275987813345912" onmouseenter="enter('-5731275987813345912');" onmouseout="out('-5731275987813345912');" style="">  85      public JoinInfo dealJoinNode(SqlJoin joinNode, Set&lt;String&gt; sideTableSet,                                      </span>
<span class="1807555890431133112" onmouseenter="enter('1807555890431133112');" onmouseout="out('1807555890431133112');" style="">  86                                   Queue&lt;Object&gt; queueInfo, SqlNode parentWhere,                                    </span>
<span class="-5840403863552999042" onmouseenter="enter('-5840403863552999042');" onmouseout="out('-5840403863552999042');" style="">  87                                   SqlNodeList parentSelectList, Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,          </span>
<span class="-2463002192605516314" onmouseenter="enter('-2463002192605516314');" onmouseout="out('-2463002192605516314');" style="">  88                                   Map&lt;String, String&gt; tableRef) {                                                  </span>










<span class="338082450955407251" onmouseenter="enter('338082450955407251');" onmouseout="out('338082450955407251');" style="">  89          SqlNode leftNode = joinNode.getLeft();                                                                    </span>
<span class="6077141851454171925" onmouseenter="enter('6077141851454171925');" onmouseout="out('6077141851454171925');" style="">  90          SqlNode rightNode = joinNode.getRight();                                                                  </span>
<span class="3771731584459985741" onmouseenter="enter('3771731584459985741');" onmouseout="out('3771731584459985741');" style="">  91          JoinType joinType = joinNode.getJoinType();                                                               </span>
<span  style="">  92                                                                                                                    </span>
<span class="1132914906015926398" onmouseenter="enter('1132914906015926398');" onmouseout="out('1132914906015926398');" style="">  93          String leftTbName = &quot;&quot;;                                                                                   </span>
<span class="4210951459006369780" onmouseenter="enter('4210951459006369780');" onmouseout="out('4210951459006369780');" style="">  94          String leftTbAlias = &quot;&quot;;                                                                                  </span>
<span class="8685549357368222156" onmouseenter="enter('8685549357368222156');" onmouseout="out('8685549357368222156');" style="">  95          String rightTableName = &quot;&quot;;                                                                               </span>
<span class="-3462848723088515190" onmouseenter="enter('-3462848723088515190');" onmouseout="out('-3462848723088515190');" style="">  96          String rightTableAlias = &quot;&quot;;                                                                              </span>
<span class="-4143915273411371171" onmouseenter="enter('-4143915273411371171');" onmouseout="out('-4143915273411371171');" style="">  97          boolean leftTbisTmp = false;                                                                              </span>
<span  style="">  98                                                                                                                    </span>
<span class="7073425685774818270" onmouseenter="enter('7073425685774818270');" onmouseout="out('7073425685774818270');" style="">  99          //如果是连续join 判断是否已经处理过添加到执行队列                                                                              </span>
<span class="8324695814441059424" onmouseenter="enter('8324695814441059424');" onmouseout="out('8324695814441059424');" style=""> 100          Boolean needBuildTemp = false;                                                                            </span>


<span class="-2983428553847994428" onmouseenter="enter('-2983428553847994428');" onmouseout="out('-2983428553847994428');" style=""> 101          extractJoinField(joinNode.getCondition(), joinFieldSet);                                                  </span>
<span  style=""> 102                                                                                                                    </span>
<span class="-8190917917216144958" onmouseenter="enter('-8190917917216144958');" onmouseout="out('-8190917917216144958');" style=""> 103          if(leftNode.getKind() == IDENTIFIER){                                                                     </span>
<span class="-2801204236324253727" onmouseenter="enter('-2801204236324253727');" onmouseout="out('-2801204236324253727');" style=""> 104              leftTbName = leftNode.toString();                                                                     </span>
<span class="-847686074292457428" onmouseenter="enter('-847686074292457428');" onmouseout="out('-847686074292457428');" style=""> 105          } else if (leftNode.getKind() == JOIN) {                                                                  </span>

<span class="8741114231031705604" onmouseenter="enter('8741114231031705604');" onmouseout="out('8741114231031705604');" style=""> 106              //处理连续join                                                                                            </span>
<span class="6606026518317197924" onmouseenter="enter('6606026518317197924');" onmouseout="out('6606026518317197924');" style=""> 107              Tuple2&lt;Boolean, JoinInfo&gt; nestJoinResult = dealNestJoin((SqlJoin) leftNode, sideTableSet,             </span>
<span class="-4863766665985465641" onmouseenter="enter('-4863766665985465641');" onmouseout="out('-4863766665985465641');" style=""> 108                      queueInfo, parentWhere, parentSelectList, joinFieldSet, tableRef);                            </span>
<span class="-4345603281757420960" onmouseenter="enter('-4345603281757420960');" onmouseout="out('-4345603281757420960');" style=""> 109              needBuildTemp = nestJoinResult.f0;                                                                    </span>
<span class="-4078843663520504191" onmouseenter="enter('-4078843663520504191');" onmouseout="out('-4078843663520504191');" style=""> 110              SqlBasicCall buildAs = TableUtils.buildAsNodeByJoinInfo(nestJoinResult.f1, null, null);               </span>
<span  style=""> 111                                                                                                                    </span>
<span class="4505810106746455844" onmouseenter="enter('4505810106746455844');" onmouseout="out('4505810106746455844');" style=""> 112              if(needBuildTemp){                                                                                    </span>
<span class="1462068966621678218" onmouseenter="enter('1462068966621678218');" onmouseout="out('1462068966621678218');" style=""> 113                  //记录表之间的关联关系                                                                                      </span>
<span class="-1197906562874334747" onmouseenter="enter('-1197906562874334747');" onmouseout="out('-1197906562874334747');" style=""> 114                  String newLeftTableName = buildAs.getOperands()[1].toString();                                    </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 115                  Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                 </span>
<span class="-116846282284894788" onmouseenter="enter('-116846282284894788');" onmouseout="out('-116846282284894788');" style=""> 116                  TableUtils.getFromTableInfo(joinNode.getLeft(), fromTableNameSet);                                </span>
<span class="-4128731698405516984" onmouseenter="enter('-4128731698405516984');" onmouseout="out('-4128731698405516984');" style=""> 117                  for(String tbTmp : fromTableNameSet){                                                             </span>
<span class="6564874017116360040" onmouseenter="enter('6564874017116360040');" onmouseout="out('6564874017116360040');" style=""> 118                      tableRef.put(tbTmp, newLeftTableName);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119                  }                                                                                                 </span>
<span  style=""> 120                                                                                                                    </span>
<span class="3808835679994269685" onmouseenter="enter('3808835679994269685');" onmouseout="out('3808835679994269685');" style=""> 121                  //替换leftNode 为新的查询                                                                                </span>
<span class="-9132777540839355627" onmouseenter="enter('-9132777540839355627');" onmouseout="out('-9132777540839355627');" style=""> 122                  joinNode.setLeft(buildAs);                                                                        </span>
<span class="8717129290340056603" onmouseenter="enter('8717129290340056603');" onmouseout="out('8717129290340056603');" style=""> 123                  leftNode = buildAs;                                                                               </span>
<span  style=""> 124                                                                                                                    </span>
<span class="-3833992755798848111" onmouseenter="enter('-3833992755798848111');" onmouseout="out('-3833992755798848111');" style=""> 125                  //替换select field 中的对应字段                                                                           </span>
<span class="5699421896693743778" onmouseenter="enter('5699421896693743778');" onmouseout="out('5699421896693743778');" style=""> 126                  for(SqlNode sqlNode : parentSelectList.getList()){                                                </span>
<span class="-7140235961109122639" onmouseenter="enter('-7140235961109122639');" onmouseout="out('-7140235961109122639');" style=""> 127                      for(String tbTmp : fromTableNameSet) {                                                        </span>
<span class="3202552329014652746" onmouseenter="enter('3202552329014652746');" onmouseout="out('3202552329014652746');" style=""> 128                          TableUtils.replaceSelectFieldTable(sqlNode, tbTmp, newLeftTableName);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 129                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 130                  }                                                                                                 </span>
<span  style=""> 131                                                                                                                    </span>
<span class="1927000767768311618" onmouseenter="enter('1927000767768311618');" onmouseout="out('1927000767768311618');" style=""> 132                  //替换where 中的条件相关                                                                                  </span>
<span class="-4128731698405516984" onmouseenter="enter('-4128731698405516984');" onmouseout="out('-4128731698405516984');" style=""> 133                  for(String tbTmp : fromTableNameSet){                                                             </span>
<span class="7276408045907024058" onmouseenter="enter('7276408045907024058');" onmouseout="out('7276408045907024058');" style=""> 134                      TableUtils.replaceWhereCondition(parentWhere, tbTmp, newLeftTableName);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135                  }                                                                                                 </span>
<span  style=""> 136                                                                                                                    </span>
<span class="-8162375655295544578" onmouseenter="enter('-8162375655295544578');" onmouseout="out('-8162375655295544578');" style=""> 137                  leftTbisTmp = true;                                                                               </span>
<span  style=""> 138                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139              }                                                                                                     </span>
<span  style=""> 140                                                                                                                    </span>
<span class="-1826234939037413890" onmouseenter="enter('-1826234939037413890');" onmouseout="out('-1826234939037413890');" style=""> 141              leftTbName = buildAs.getOperands()[0].toString();                                                     </span>
<span class="-3318844277430288469" onmouseenter="enter('-3318844277430288469');" onmouseout="out('-3318844277430288469');" style=""> 142              leftTbAlias = buildAs.getOperands()[1].toString();                                                    </span>
<span  style=""> 143                                                                                                                    </span>
<span class="426156474579357333" onmouseenter="enter('426156474579357333');" onmouseout="out('426156474579357333');" style=""> 144          } else if (leftNode.getKind() == AS) {                                                                    </span>
<span class="5799841308726390194" onmouseenter="enter('5799841308726390194');" onmouseout="out('5799841308726390194');" style=""><abbr title=" 145              AliasInfo aliasInfo = (AliasInfo) sideSQLParser.parseSql(leftNode, sideTableSet, queueInfo, parentWhere, parentSelectList);"> 145              AliasInfo aliasInfo = (AliasInfo) sideSQLParser.parseSql(leftNode, sideTableSet, queueInfo, parentWher🔵</abbr></span>







<span class="-6271284546665811801" onmouseenter="enter('-6271284546665811801');" onmouseout="out('-6271284546665811801');" style=""> 146              leftTbName = aliasInfo.getName();                                                                     </span>
<span class="1754889631815621614" onmouseenter="enter('1754889631815621614');" onmouseout="out('1754889631815621614');" style=""> 147              leftTbAlias = aliasInfo.getAlias();                                                                   </span>
<span  style=""> 148                                                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 149          } else {                                                                                                  </span>
<span class="1657329483008774131" onmouseenter="enter('1657329483008774131');" onmouseout="out('1657329483008774131');" style=""><abbr title=" 150              throw new RuntimeException(String.format(&quot;---not deal node with type %s&quot;, leftNode.getKind().toString()));"> 150              throw new RuntimeException(String.format(&quot;---not deal node with type %s&quot;, leftNode.getKind().toString(🔵</abbr></span>



<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151          }                                                                                                         </span>
<span  style=""> 152                                                                                                                    </span>
<span class="818500193985431170" onmouseenter="enter('818500193985431170');" onmouseout="out('818500193985431170');" style=""> 153          boolean leftIsSide = checkIsSideTable(leftTbName, sideTableSet);                                          </span>
<span class="3539880077969659090" onmouseenter="enter('3539880077969659090');" onmouseout="out('3539880077969659090');" style=""> 154          Preconditions.checkState(!leftIsSide, &quot;side-table must be at the right of join operator&quot;);                </span>
<span  style=""> 155                                                                                                                    </span>
<span class="427940538474757132" onmouseenter="enter('427940538474757132');" onmouseout="out('427940538474757132');" style=""><abbr title=" 156          Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo, parentWhere, parentSelectList);"> 156          Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo, parentW🔵</abbr></span>

<span class="-8717968456481913232" onmouseenter="enter('-8717968456481913232');" onmouseout="out('-8717968456481913232');" style=""> 157          rightTableName = rightTableNameAndAlias.f0;                                                               </span>
<span class="6344722288957274241" onmouseenter="enter('6344722288957274241');" onmouseout="out('6344722288957274241');" style=""> 158          rightTableAlias = rightTableNameAndAlias.f1;                                                              </span>
<span  style=""> 159                                                                                                                    </span>
<span class="-2376755127467584795" onmouseenter="enter('-2376755127467584795');" onmouseout="out('-2376755127467584795');" style=""> 160          boolean rightIsSide = checkIsSideTable(rightTableName, sideTableSet);                                     </span>
<span class="-8791016550933072203" onmouseenter="enter('-8791016550933072203');" onmouseout="out('-8791016550933072203');" style=""> 161          if(rightIsSide &amp;&amp; joinType == JoinType.RIGHT){                                                            </span>
<span class="-8772090804951491249" onmouseenter="enter('-8772090804951491249');" onmouseout="out('-8772090804951491249');" style=""><abbr title=" 162              throw new RuntimeException(&quot;side join not support join type of right[current support inner join and left join]&quot;);"> 162              throw new RuntimeException(&quot;side join not support join type of right[current support inner join and le🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163          }                                                                                                         </span>
<span  style=""> 164                                                                                                                    </span>
<span class="-2392606951301675835" onmouseenter="enter('-2392606951301675835');" onmouseout="out('-2392606951301675835');" style=""> 165          if(leftNode.getKind() == JOIN &amp;&amp; rightIsSide){                                                            </span>
<span class="4785989307570935099" onmouseenter="enter('4785989307570935099');" onmouseout="out('4785989307570935099');" style=""> 166              needBuildTemp = true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167          }                                                                                                         </span>
<span  style=""> 168                                                                                                                    </span>
<span class="-6467047856281920672" onmouseenter="enter('-6467047856281920672');" onmouseout="out('-6467047856281920672');" style=""> 169          JoinInfo tableInfo = new JoinInfo();                                                                      </span>
<span class="-3449973379283837894" onmouseenter="enter('-3449973379283837894');" onmouseout="out('-3449973379283837894');" style=""> 170          tableInfo.setLeftTableName(leftTbName);                                                                   </span>
<span class="3986639763024215846" onmouseenter="enter('3986639763024215846');" onmouseout="out('3986639763024215846');" style=""> 171          tableInfo.setRightTableName(rightTableName);                                                              </span>
<span class="540222178236061469" onmouseenter="enter('540222178236061469');" onmouseout="out('540222178236061469');" style=""> 172          if (StringUtils.isEmpty(leftTbAlias)){                                                                    </span>
<span class="-527247937252364560" onmouseenter="enter('-527247937252364560');" onmouseout="out('-527247937252364560');" style=""> 173              tableInfo.setLeftTableAlias(leftTbName);                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 174          } else {                                                                                                  </span>
<span class="846009662730869635" onmouseenter="enter('846009662730869635');" onmouseout="out('846009662730869635');" style=""> 175              tableInfo.setLeftTableAlias(leftTbAlias);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176          }                                                                                                         </span>
<span  style=""> 177                                                                                                                    </span>
<span class="5288249263560060903" onmouseenter="enter('5288249263560060903');" onmouseout="out('5288249263560060903');" style=""> 178          if (StringUtils.isEmpty(rightTableAlias)){                                                                </span>
<span class="3932788331193283947" onmouseenter="enter('3932788331193283947');" onmouseout="out('3932788331193283947');" style=""> 179              tableInfo.setRightTableAlias(rightTableName);                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 180          } else {                                                                                                  </span>
<span class="4941698031257863857" onmouseenter="enter('4941698031257863857');" onmouseout="out('4941698031257863857');" style=""> 181              tableInfo.setRightTableAlias(rightTableAlias);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182          }                                                                                                         </span>
<span  style=""> 183                                                                                                                    </span>
<span class="-7094988609046840890" onmouseenter="enter('-7094988609046840890');" onmouseout="out('-7094988609046840890');" style=""> 184          TableUtils.replaceJoinFieldRefTableName(joinNode.getCondition(), tableRef);                               </span>
<span  style=""> 185                                                                                                                    </span>
<span class="-3100717890116607547" onmouseenter="enter('-3100717890116607547');" onmouseout="out('-3100717890116607547');" style=""> 186          tableInfo.setLeftIsTmpTable(leftTbisTmp);                                                                 </span>
<span class="-1392507044041313284" onmouseenter="enter('-1392507044041313284');" onmouseout="out('-1392507044041313284');" style=""> 187          tableInfo.setLeftIsSideTable(leftIsSide);                                                                 </span>






<span class="-8645871838585664663" onmouseenter="enter('-8645871838585664663');" onmouseout="out('-8645871838585664663');" style=""> 188          tableInfo.setRightIsSideTable(rightIsSide);                                                               </span>
<span class="-1781974587467511895" onmouseenter="enter('-1781974587467511895');" onmouseout="out('-1781974587467511895');" style=""> 189          tableInfo.setLeftNode(leftNode);                                                                          </span>
<span class="-1730362975620128104" onmouseenter="enter('-1730362975620128104');" onmouseout="out('-1730362975620128104');" style=""> 190          tableInfo.setRightNode(rightNode);                                                                        </span>
<span class="-6237310238590034687" onmouseenter="enter('-6237310238590034687');" onmouseout="out('-6237310238590034687');" style=""> 191          tableInfo.setJoinType(joinType);                                                                          </span>
<span class="-2724794810040782007" onmouseenter="enter('-2724794810040782007');" onmouseout="out('-2724794810040782007');" style=""> 192          tableInfo.setCondition(joinNode.getCondition());                                                          </span>
<span  style=""> 193                                                                                                                    </span>
<span class="6825487195953888301" onmouseenter="enter('6825487195953888301');" onmouseout="out('6825487195953888301');" style=""> 194          if(tableInfo.getLeftNode().getKind() != AS &amp;&amp; needBuildTemp){                                             </span>
<span class="-7852697520698251485" onmouseenter="enter('-7852697520698251485');" onmouseout="out('-7852697520698251485');" style=""><abbr title=" 195              extractTemporaryQuery(tableInfo.getLeftNode(), tableInfo.getLeftTableAlias(), (SqlBasicCall) parentWhere,"> 195              extractTemporaryQuery(tableInfo.getLeftNode(), tableInfo.getLeftTableAlias(), (SqlBasicCall) parentWhe🔵</abbr></span>
<span class="-3080723565429428298" onmouseenter="enter('-3080723565429428298');" onmouseout="out('-3080723565429428298');" style=""> 196                      parentSelectList, queueInfo, joinFieldSet, tableRef);                                         </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 197          }else {                                                                                                   </span>
<span class="-7263872454890537563" onmouseenter="enter('-7263872454890537563');" onmouseout="out('-7263872454890537563');" style=""> 198              SqlKind asNodeFirstKind = ((SqlBasicCall)tableInfo.getLeftNode()).operands[0].getKind();              </span>
<span class="7769837734339006055" onmouseenter="enter('7769837734339006055');" onmouseout="out('7769837734339006055');" style=""> 199              if(asNodeFirstKind == SELECT){                                                                        </span>
<span class="-6186943853001324725" onmouseenter="enter('-6186943853001324725');" onmouseout="out('-6186943853001324725');" style=""> 200                  queueInfo.offer(tableInfo.getLeftNode());                                                         </span>
<span class="5571842213520048771" onmouseenter="enter('5571842213520048771');" onmouseout="out('5571842213520048771');" style=""> 201                  tableInfo.setLeftNode(((SqlBasicCall)tableInfo.getLeftNode()).operands[1]);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203          }                                                                                                         </span>

















<span class="-8283803146393095059" onmouseenter="enter('-8283803146393095059');" onmouseout="out('-8283803146393095059');" style=""> 204          return tableInfo;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 205      }                                                                                                             </span>
<span  style=""> 206                                                                                                                    </span>
<span  style=""> 207                                                                                                                    </span>
<span class="3705413154731575184" onmouseenter="enter('3705413154731575184');" onmouseout="out('3705413154731575184');" style=""> 208      //处理多层join                                                                                                    </span>
<span class="7145754590042272725" onmouseenter="enter('7145754590042272725');" onmouseout="out('7145754590042272725');" style=""> 209      private Tuple2&lt;Boolean, JoinInfo&gt; dealNestJoin(SqlJoin joinNode, Set&lt;String&gt; sideTableSet,                    </span>
<span class="1807555890431133112" onmouseenter="enter('1807555890431133112');" onmouseout="out('1807555890431133112');" style=""> 210                                                     Queue&lt;Object&gt; queueInfo, SqlNode parentWhere,                  </span>
<span class="3251661684197536657" onmouseenter="enter('3251661684197536657');" onmouseout="out('3251661684197536657');" style=""><abbr title=" 211                                                     SqlNodeList selectList, Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,"> 211                                                     SqlNodeList selectList, Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSe🔵</abbr></span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style=""> 212                                                     Map&lt;String, String&gt; tableRef){                                 </span>
<span class="6077141851454171925" onmouseenter="enter('6077141851454171925');" onmouseout="out('6077141851454171925');" style=""> 213          SqlNode rightNode = joinNode.getRight();                                                                  </span>
<span class="-2339536868971306375" onmouseenter="enter('-2339536868971306375');" onmouseout="out('-2339536868971306375');" style=""><abbr title=" 214          Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo, parentWhere, selectList);"> 214          Tuple2&lt;String, String&gt; rightTableNameAndAlias = parseRightNode(rightNode, sideTableSet, queueInfo, parentW🔵</abbr></span>
<span class="-5352267233850389316" onmouseenter="enter('-5352267233850389316');" onmouseout="out('-5352267233850389316');" style=""><abbr title=" 215          JoinInfo joinInfo = dealJoinNode(joinNode, sideTableSet, queueInfo, parentWhere, selectList, joinFieldSet, tableRef);"> 215          JoinInfo joinInfo = dealJoinNode(joinNode, sideTableSet, queueInfo, parentWhere, selectList, joinFieldSet,🔵</abbr></span>





































































































<span  style=""> 216                                                                                                                    </span>
<span class="-8707963241001902314" onmouseenter="enter('-8707963241001902314');" onmouseout="out('-8707963241001902314');" style=""> 217          String rightTableName = rightTableNameAndAlias.f0;                                                        </span>
<span class="-2376755127467584795" onmouseenter="enter('-2376755127467584795');" onmouseout="out('-2376755127467584795');" style=""> 218          boolean rightIsSide = checkIsSideTable(rightTableName, sideTableSet);                                     </span>
<span class="7285211506162862473" onmouseenter="enter('7285211506162862473');" onmouseout="out('7285211506162862473');" style=""> 219          boolean needBuildTemp = false;                                                                            </span>
<span  style=""> 220                                                                                                                    </span>
<span class="5223306001790343975" onmouseenter="enter('5223306001790343975');" onmouseout="out('5223306001790343975');" style=""> 221          if(!rightIsSide){                                                                                         </span>
<span class="5962855083848081317" onmouseenter="enter('5962855083848081317');" onmouseout="out('5962855083848081317');" style=""> 222              //右表不是维表的情况                                                                                           </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 223          }else{                                                                                                    </span>
<span class="-5450817922678052440" onmouseenter="enter('-5450817922678052440');" onmouseout="out('-5450817922678052440');" style=""> 224              //右边表是维表需要重新构建左表的临时查询                                                                                 </span>
<span class="6641920780390342492" onmouseenter="enter('6641920780390342492');" onmouseout="out('6641920780390342492');" style=""> 225              queueInfo.offer(joinInfo);                                                                            </span>
<span class="4785989307570935099" onmouseenter="enter('4785989307570935099');" onmouseout="out('4785989307570935099');" style=""> 226              needBuildTemp = true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227          }                                                                                                         </span>
<span  style=""> 228                                                                                                                    </span>
<span class="-1327758925293399828" onmouseenter="enter('-1327758925293399828');" onmouseout="out('-1327758925293399828');" style=""> 229          //return Tuple2.of(needBuildTemp, TableUtils.buildAsNodeByJoinInfo(joinInfo, null, null));                </span>
<span class="6585696372112746518" onmouseenter="enter('6585696372112746518');" onmouseout="out('6585696372112746518');" style=""> 230          return Tuple2.of(needBuildTemp, joinInfo);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231      }                                                                                                             </span>
<span  style=""> 232                                                                                                                    </span>
<span class="-2402394227701825991" onmouseenter="enter('-2402394227701825991');" onmouseout="out('-2402394227701825991');" style=""> 233      private void extractTemporaryQuery(SqlNode node, String tableAlias, SqlBasicCall parentWhere,                 </span>
<span class="1575560997126003034" onmouseenter="enter('1575560997126003034');" onmouseout="out('1575560997126003034');" style=""> 234                                         SqlNodeList parentSelectList, Queue&lt;Object&gt; queueInfo,                     </span>





















































































































<span class="221219844685559650" onmouseenter="enter('221219844685559650');" onmouseout="out('221219844685559650');" style=""> 235                                         Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet,                                  </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style=""> 236                                         Map&lt;String, String&gt; tableRef){                                             </span>


<span class="-1891643383856272179" onmouseenter="enter('-1891643383856272179');" onmouseout="out('-1891643383856272179');" style=""> 237          try{                                                                                                      </span>
<span class="-8973252823595593319" onmouseenter="enter('-8973252823595593319');" onmouseout="out('-8973252823595593319');" style=""> 238              //父一级的where 条件中如果只和临时查询相关的条件都截取进来                                                                     </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 239              Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                     </span>
<span class="-1162190359921159801" onmouseenter="enter('-1162190359921159801');" onmouseout="out('-1162190359921159801');" style=""> 240              List&lt;SqlBasicCall&gt; extractCondition = Lists.newArrayList();                                           </span>
<span  style=""> 241                                                                                                                    </span>
<span class="8110456237367799034" onmouseenter="enter('8110456237367799034');" onmouseout="out('8110456237367799034');" style=""> 242              TableUtils.getFromTableInfo(node, fromTableNameSet);                                                  </span>
<span class="6022466615463989785" onmouseenter="enter('6022466615463989785');" onmouseout="out('6022466615463989785');" style=""> 243              checkAndRemoveWhereCondition(fromTableNameSet, parentWhere, extractCondition);                        </span>
<span  style=""> 244                                                                                                                    </span>
<span class="8695778948204515419" onmouseenter="enter('8695778948204515419');" onmouseout="out('8695778948204515419');" style=""> 245              if(node.getKind() == JOIN){                                                                           </span>
<span class="-6199554136531935919" onmouseenter="enter('-6199554136531935919');" onmouseout="out('-6199554136531935919');" style=""> 246                  checkAndReplaceJoinCondition(((SqlJoin)node).getCondition(), tableRef);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247              }                                                                                                     </span>
<span  style=""> 248                                                                                                                    </span>
<span class="5747231761832639727" onmouseenter="enter('5747231761832639727');" onmouseout="out('5747231761832639727');" style=""> 249              Set&lt;String&gt; extractSelectField = extractSelectFields(parentSelectList, fromTableNameSet, tableRef);   </span>
<span class="1865200144735135853" onmouseenter="enter('1865200144735135853');" onmouseout="out('1865200144735135853');" style=""><abbr title=" 250              Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableNameSet);"> 250              Set&lt;String&gt; fieldFromJoinCondition = extractSelectFieldFromJoinCondition(joinFieldSet, fromTableNameSe🔵</abbr></span>
<span class="-3053698166334827106" onmouseenter="enter('-3053698166334827106');" onmouseout="out('-3053698166334827106');" style=""> 251              String extractSelectFieldStr = buildSelectNode(extractSelectField, fieldFromJoinCondition);           </span>







<span class="-3122368802496797506" onmouseenter="enter('-3122368802496797506');" onmouseout="out('-3122368802496797506');" style=""> 252              String extractConditionStr = buildCondition(extractCondition);                                        </span>
<span  style=""> 253                                                                                                                    </span>
<span class="6190023554533569746" onmouseenter="enter('6190023554533569746');" onmouseout="out('6190023554533569746');" style=""> 254              String tmpSelectSql = String.format(SELECT_TEMP_SQL,                                                  </span>
<span class="3430988890108370699" onmouseenter="enter('3430988890108370699');" onmouseout="out('3430988890108370699');" style=""> 255                      extractSelectFieldStr,                                                                        </span>
<span class="-1169517675965244531" onmouseenter="enter('-1169517675965244531');" onmouseout="out('-1169517675965244531');" style=""> 256                      node.toString(),                                                                              </span>
<span class="4099345839703116685" onmouseenter="enter('4099345839703116685');" onmouseout="out('4099345839703116685');" style=""> 257                      extractConditionStr);                                                                         </span>
<span  style=""> 258                                                                                                                    </span>
<span class="-3319042643252387519" onmouseenter="enter('-3319042643252387519');" onmouseout="out('-3319042643252387519');" style=""> 259              SqlParser sqlParser = SqlParser.create(tmpSelectSql, CalciteConfig.MYSQL_LEX_CONFIG);                 </span>
<span class="-1853454348884693240" onmouseenter="enter('-1853454348884693240');" onmouseout="out('-1853454348884693240');" style=""> 260              SqlNode sqlNode = sqlParser.parseStmt();                                                              </span>



<span class="-2735890898778643076" onmouseenter="enter('-2735890898778643076');" onmouseout="out('-2735890898778643076');" style=""> 261              SqlBasicCall sqlBasicCall = buildAsSqlNode(tableAlias, sqlNode);                                      </span>
<span class="2417854506040223841" onmouseenter="enter('2417854506040223841');" onmouseout="out('2417854506040223841');" style=""> 262              queueInfo.offer(sqlBasicCall);                                                                        </span>

















<span  style=""> 263                                                                                                                    </span>
<span class="3487269535061511064" onmouseenter="enter('3487269535061511064');" onmouseout="out('3487269535061511064');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 264 -            System.out.println(&quot;-------build temporary query-----------&quot;);                                        </span>
<span class="-8101867096626384734" onmouseenter="enter('-8101867096626384734');" onmouseout="out('-8101867096626384734');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 265 -            System.out.println(tmpSelectSql);                                                                     </span>
<span class="-4281832807373115174" onmouseenter="enter('-4281832807373115174');" onmouseout="out('-4281832807373115174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 266 -            System.out.println(&quot;---------------------------------------&quot;);                                        </span>

<span class="-1580407524319062305" onmouseenter="enter('-1580407524319062305');" onmouseout="out('-1580407524319062305');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 267 -        }catch (Exception e){                                                                                     </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 268 -            e.printStackTrace();                                                                                  </span>
<span class="3812477662204349545" onmouseenter="enter('3812477662204349545');" onmouseout="out('3812477662204349545');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 269 +            Log.info(&quot;-------build temporary query-----------\n{}&quot;, tmpSelectSql);                                </span>
<span class="3847699124612806472" onmouseenter="enter('3847699124612806472');" onmouseout="out('3847699124612806472');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 270 +            Log.info(&quot;---------------------------------------&quot;);                                                  </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 271 +        } catch (Exception e) {                                                                                   </span>
<span class="-9144524576168127827" onmouseenter="enter('-9144524576168127827');" onmouseout="out('-9144524576168127827');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 272 +            Log.error(&quot;&quot;, e);                                                                                     </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 273              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275      }                                                                                                             </span>
<span  style=""> 276                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 277      /**                                                                                                           </span>
<span class="-4499840608975407423" onmouseenter="enter('-4499840608975407423');" onmouseout="out('-4499840608975407423');" style=""> 278       * 抽取上层需用使用到的字段                                                                                               </span>
<span class="9099401058466039467" onmouseenter="enter('9099401058466039467');" onmouseout="out('9099401058466039467');" style=""> 279       * 由于where字段已经抽取到上一层了所以不用查询出来                                                                                 </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style=""> 280       * @param parentSelectList                                                                                    </span>
<span class="-6365101737408851156" onmouseenter="enter('-6365101737408851156');" onmouseout="out('-6365101737408851156');" style=""> 281       * @param fromTableNameSet                                                                                    </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 282       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 283       */                                                                                                           </span>
<span class="-1410253319795430175" onmouseenter="enter('-1410253319795430175');" onmouseout="out('-1410253319795430175');" style=""> 284      private Set&lt;String&gt; extractSelectFields(SqlNodeList parentSelectList,                                         </span>
<span class="8604782440088857459" onmouseenter="enter('8604782440088857459');" onmouseout="out('8604782440088857459');" style=""> 285                                              Set&lt;String&gt; fromTableNameSet,                                         </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style=""> 286                                              Map&lt;String, String&gt; tableRef){                                        </span>
<span class="-4673362671275703253" onmouseenter="enter('-4673362671275703253');" onmouseout="out('-4673362671275703253');" style=""> 287          Set&lt;String&gt; extractFieldList = Sets.newHashSet();                                                         </span>
<span class="-7414180011567654896" onmouseenter="enter('-7414180011567654896');" onmouseout="out('-7414180011567654896');" style=""> 288          for(SqlNode selectNode : parentSelectList.getList()){                                                     </span>
<span class="1095915068729564148" onmouseenter="enter('1095915068729564148');" onmouseout="out('1095915068729564148');" style=""> 289              extractSelectField(selectNode, extractFieldList, fromTableNameSet, tableRef);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290          }                                                                                                         </span>
<span  style=""> 291                                                                                                                    </span>
<span class="-1685101767459189568" onmouseenter="enter('-1685101767459189568');" onmouseout="out('-1685101767459189568');" style=""> 292          return extractFieldList;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293      }                                                                                                             </span>
<span  style=""> 294                                                                                                                    </span>
<span class="-3843180343280265019" onmouseenter="enter('-3843180343280265019');" onmouseout="out('-3843180343280265019');" style=""><abbr title=" 295      private Set&lt;String&gt; extractSelectFieldFromJoinCondition(Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet, Set&lt;String&gt; fromTableNameSet){"> 295      private Set&lt;String&gt; extractSelectFieldFromJoinCondition(Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet, Set&lt;String&gt; 🔵</abbr></span>



<span class="-4673362671275703253" onmouseenter="enter('-4673362671275703253');" onmouseout="out('-4673362671275703253');" style=""> 296          Set&lt;String&gt; extractFieldList = Sets.newHashSet();                                                         </span>
<span class="8833203050470988767" onmouseenter="enter('8833203050470988767');" onmouseout="out('8833203050470988767');" style=""> 297          for(Tuple2&lt;String, String&gt; field : joinFieldSet){                                                         </span>
<span class="-9037397631967971194" onmouseenter="enter('-9037397631967971194');" onmouseout="out('-9037397631967971194');" style=""> 298              if(fromTableNameSet.contains(field.f0)){                                                              </span>
<span class="-4436761311933817361" onmouseenter="enter('-4436761311933817361');" onmouseout="out('-4436761311933817361');" style=""> 299                  extractFieldList.add(field.f0 + &quot;.&quot; + field.f1);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300              }                                                                                                     </span>






















<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301          }                                                                                                         </span>
<span  style=""> 302                                                                                                                    </span>
<span class="-1685101767459189568" onmouseenter="enter('-1685101767459189568');" onmouseout="out('-1685101767459189568');" style=""> 303          return extractFieldList;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304      }                                                                                                             </span>
<span  style=""> 305                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 306      /**                                                                                                           </span>
<span class="-672438967754228662" onmouseenter="enter('-672438967754228662');" onmouseout="out('-672438967754228662');" style=""> 307       * 从join的条件中获取字段信息                                                                                            </span>
<span class="-4160812560585701802" onmouseenter="enter('-4160812560585701802');" onmouseout="out('-4160812560585701802');" style=""> 308       * @param condition                                                                                           </span>
<span class="-1140437271418707941" onmouseenter="enter('-1140437271418707941');" onmouseout="out('-1140437271418707941');" style=""> 309       * @param joinFieldSet                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 310       */                                                                                                           </span>
<span class="1552352851009209412" onmouseenter="enter('1552352851009209412');" onmouseout="out('1552352851009209412');" style=""> 311      private void extractJoinField(SqlNode condition, Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet){                   </span>




<span class="5418896256960850645" onmouseenter="enter('5418896256960850645');" onmouseout="out('5418896256960850645');" style=""> 312          SqlKind joinKind = condition.getKind();                                                                   </span>
<span class="6904180996725590590" onmouseenter="enter('6904180996725590590');" onmouseout="out('6904180996725590590');" style=""> 313          if( joinKind == AND || joinKind == EQUALS ){                                                              </span>
<span class="5740954560868172997" onmouseenter="enter('5740954560868172997');" onmouseout="out('5740954560868172997');" style=""> 314              extractJoinField(((SqlBasicCall)condition).operands[0], joinFieldSet);                                </span>
<span class="-450517509397156355" onmouseenter="enter('-450517509397156355');" onmouseout="out('-450517509397156355');" style=""> 315              extractJoinField(((SqlBasicCall)condition).operands[1], joinFieldSet);                                </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 316          }else{                                                                                                    </span>
<span class="3421902236901684905" onmouseenter="enter('3421902236901684905');" onmouseout="out('3421902236901684905');" style=""><abbr title=" 317              Preconditions.checkState(((SqlIdentifier)condition).names.size() == 2, &quot;join condition must be format table.field&quot;);"> 317              Preconditions.checkState(((SqlIdentifier)condition).names.size() == 2, &quot;join condition must be format 🔵</abbr></span>
<span class="6389924414477169388" onmouseenter="enter('6389924414477169388');" onmouseout="out('6389924414477169388');" style=""><abbr title=" 318              Tuple2&lt;String, String&gt; tuple2 = Tuple2.of(((SqlIdentifier)condition).names.get(0), ((SqlIdentifier)condition).names.get(1));"> 318              Tuple2&lt;String, String&gt; tuple2 = Tuple2.of(((SqlIdentifier)condition).names.get(0), ((SqlIdentifier)con🔵</abbr></span>
<span class="-8031023747394340843" onmouseenter="enter('-8031023747394340843');" onmouseout="out('-8031023747394340843');" style=""> 319              joinFieldSet.add(tuple2);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321      }                                                                                                             </span>
<span  style=""> 322                                                                                                                    </span>
<span  style=""> 323                                                                                                                    </span>
<span class="-6450965667049352633" onmouseenter="enter('-6450965667049352633');" onmouseout="out('-6450965667049352633');" style=""> 324      private void extractSelectField(SqlNode selectNode,                                                           </span>
<span class="4215167182352113360" onmouseenter="enter('4215167182352113360');" onmouseout="out('4215167182352113360');" style=""> 325                                      Set&lt;String&gt; extractFieldSet,                                                  </span>
<span class="8604782440088857459" onmouseenter="enter('8604782440088857459');" onmouseout="out('8604782440088857459');" style=""> 326                                      Set&lt;String&gt; fromTableNameSet,                                                 </span>
<span class="1617584146151990847" onmouseenter="enter('1617584146151990847');" onmouseout="out('1617584146151990847');" style=""> 327                                      Map&lt;String, String&gt; tableRef){                                                </span>
<span class="8103739576060170768" onmouseenter="enter('8103739576060170768');" onmouseout="out('8103739576060170768');" style=""> 328          if (selectNode.getKind() == AS) {                                                                         </span>
<span class="1510889832473438632" onmouseenter="enter('1510889832473438632');" onmouseout="out('1510889832473438632');" style=""> 329              SqlNode leftNode = ((SqlBasicCall) selectNode).getOperands()[0];                                      </span>
<span class="-3569930423065034136" onmouseenter="enter('-3569930423065034136');" onmouseout="out('-3569930423065034136');" style=""> 330              extractSelectField(leftNode, extractFieldSet, fromTableNameSet, tableRef);                            </span>
<span  style=""> 331                                                                                                                    </span>
<span class="-8354265102451448120" onmouseenter="enter('-8354265102451448120');" onmouseout="out('-8354265102451448120');" style=""> 332          }else if(selectNode.getKind() == IDENTIFIER) {                                                            </span>
<span class="-3732912994311321816" onmouseenter="enter('-3732912994311321816');" onmouseout="out('-3732912994311321816');" style=""> 333              SqlIdentifier sqlIdentifier = (SqlIdentifier) selectNode;                                             </span>
<span  style=""> 334                                                                                                                    </span>
<span class="2651178788475624428" onmouseenter="enter('2651178788475624428');" onmouseout="out('2651178788475624428');" style=""> 335              if(sqlIdentifier.names.size() == 1){                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 336                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337              }                                                                                                     </span>
<span  style=""> 338                                                                                                                    </span>
<span class="3965609827388612088" onmouseenter="enter('3965609827388612088');" onmouseout="out('3965609827388612088');" style=""> 339              String tableName = sqlIdentifier.names.get(0);                                                        </span>
<span class="5468885380070811563" onmouseenter="enter('5468885380070811563');" onmouseout="out('5468885380070811563');" style=""> 340              //TODO                                                                                                </span>
<span class="3096268752058072981" onmouseenter="enter('3096268752058072981');" onmouseout="out('3096268752058072981');" style=""> 341              if(fromTableNameSet.contains(tableName)){                                                             </span>
<span class="-4452600673359758385" onmouseenter="enter('-4452600673359758385');" onmouseout="out('-4452600673359758385');" style=""> 342                  extractFieldSet.add(sqlIdentifier.toString());                                                    </span>
<span class="1142707085951947184" onmouseenter="enter('1142707085951947184');" onmouseout="out('1142707085951947184');" style=""> 343              } else if(fromTableNameSet.contains(tableRef.get(tableName))){                                        </span>
<span class="5574286290036421401" onmouseenter="enter('5574286290036421401');" onmouseout="out('5574286290036421401');" style=""> 344                  //TODO extractFieldSet.add(sqlIdentifier.setName(0, tableRef.get(tableName)).toString());         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 345              }                                                                                                     </span>
<span  style=""> 346                                                                                                                    </span>
<span class="7025405726449532045" onmouseenter="enter('7025405726449532045');" onmouseout="out('7025405726449532045');" style=""> 347          }else if(  AGGREGATE.contains(selectNode.getKind())                                                       </span>
<span class="-6933542481251357306" onmouseenter="enter('-6933542481251357306');" onmouseout="out('-6933542481251357306');" style=""> 348                  || AVG_AGG_FUNCTIONS.contains(selectNode.getKind())                                               </span>
<span class="-2120439329066417772" onmouseenter="enter('-2120439329066417772');" onmouseout="out('-2120439329066417772');" style=""> 349                  || COMPARISON.contains(selectNode.getKind())                                                      </span>
<span class="6729191807379931332" onmouseenter="enter('6729191807379931332');" onmouseout="out('6729191807379931332');" style=""> 350                  || selectNode.getKind() == OTHER_FUNCTION                                                         </span>
<span class="-790540336783787818" onmouseenter="enter('-790540336783787818');" onmouseout="out('-790540336783787818');" style=""> 351                  || selectNode.getKind() == DIVIDE                                                                 </span>
<span class="8042439450870069301" onmouseenter="enter('8042439450870069301');" onmouseout="out('8042439450870069301');" style=""> 352                  || selectNode.getKind() == CAST                                                                   </span>
<span class="8131430949670321542" onmouseenter="enter('8131430949670321542');" onmouseout="out('8131430949670321542');" style=""> 353                  || selectNode.getKind() == TRIM                                                                   </span>
<span class="7539044465271514325" onmouseenter="enter('7539044465271514325');" onmouseout="out('7539044465271514325');" style=""> 354                  || selectNode.getKind() == TIMES                                                                  </span>
<span class="5017875227939513377" onmouseenter="enter('5017875227939513377');" onmouseout="out('5017875227939513377');" style=""> 355                  || selectNode.getKind() == PLUS                                                                   </span>
<span class="-8896687143784188803" onmouseenter="enter('-8896687143784188803');" onmouseout="out('-8896687143784188803');" style=""> 356                  || selectNode.getKind() == NOT_IN                                                                 </span>
<span class="-1863732027976694038" onmouseenter="enter('-1863732027976694038');" onmouseout="out('-1863732027976694038');" style=""> 357                  || selectNode.getKind() == OR                                                                     </span>
<span class="6505261652610820896" onmouseenter="enter('6505261652610820896');" onmouseout="out('6505261652610820896');" style=""> 358                  || selectNode.getKind() == AND                                                                    </span>
<span class="8098904506676885196" onmouseenter="enter('8098904506676885196');" onmouseout="out('8098904506676885196');" style=""> 359                  || selectNode.getKind() == MINUS                                                                  </span>
<span class="-157153081163608557" onmouseenter="enter('-157153081163608557');" onmouseout="out('-157153081163608557');" style=""> 360                  || selectNode.getKind() == TUMBLE                                                                 </span>
<span class="-2839638964097736537" onmouseenter="enter('-2839638964097736537');" onmouseout="out('-2839638964097736537');" style=""> 361                  || selectNode.getKind() == TUMBLE_START                                                           </span>
<span class="6482577849437391011" onmouseenter="enter('6482577849437391011');" onmouseout="out('6482577849437391011');" style=""> 362                  || selectNode.getKind() == TUMBLE_END                                                             </span>
<span class="6880276476651207951" onmouseenter="enter('6880276476651207951');" onmouseout="out('6880276476651207951');" style=""> 363                  || selectNode.getKind() == SESSION                                                                </span>
<span class="-5893490809135961202" onmouseenter="enter('-5893490809135961202');" onmouseout="out('-5893490809135961202');" style=""> 364                  || selectNode.getKind() == SESSION_START                                                          </span>
<span class="-1646114820326763405" onmouseenter="enter('-1646114820326763405');" onmouseout="out('-1646114820326763405');" style=""> 365                  || selectNode.getKind() == SESSION_END                                                            </span>
<span class="268793040563115559" onmouseenter="enter('268793040563115559');" onmouseout="out('268793040563115559');" style=""> 366                  || selectNode.getKind() == HOP                                                                    </span>
<span class="5104117061177388693" onmouseenter="enter('5104117061177388693');" onmouseout="out('5104117061177388693');" style=""> 367                  || selectNode.getKind() == HOP_START                                                              </span>
<span class="8235260830665848207" onmouseenter="enter('8235260830665848207');" onmouseout="out('8235260830665848207');" style=""> 368                  || selectNode.getKind() == HOP_END                                                                </span>
<span class="-3943236427179035086" onmouseenter="enter('-3943236427179035086');" onmouseout="out('-3943236427179035086');" style=""> 369                  || selectNode.getKind() == BETWEEN                                                                </span>
<span class="-4981553052649867721" onmouseenter="enter('-4981553052649867721');" onmouseout="out('-4981553052649867721');" style=""> 370                  || selectNode.getKind() == IS_NULL                                                                </span>
<span class="2062318608323297657" onmouseenter="enter('2062318608323297657');" onmouseout="out('2062318608323297657');" style=""> 371                  || selectNode.getKind() == IS_NOT_NULL                                                            </span>
<span class="-5717204280699012051" onmouseenter="enter('-5717204280699012051');" onmouseout="out('-5717204280699012051');" style=""> 372                  || selectNode.getKind() == CONTAINS                                                               </span>
<span class="-4225388998654687854" onmouseenter="enter('-4225388998654687854');" onmouseout="out('-4225388998654687854');" style=""> 373                  || selectNode.getKind() == TIMESTAMP_ADD                                                          </span>
<span class="-1992782825152874013" onmouseenter="enter('-1992782825152874013');" onmouseout="out('-1992782825152874013');" style=""> 374                  || selectNode.getKind() == TIMESTAMP_DIFF                                                         </span>
<span class="-1380076266281630813" onmouseenter="enter('-1380076266281630813');" onmouseout="out('-1380076266281630813');" style=""> 375                  || selectNode.getKind() == LIKE                                                                   </span>
<span  style=""> 376                                                                                                                    </span>
<span class="1769062068492699725" onmouseenter="enter('1769062068492699725');" onmouseout="out('1769062068492699725');" style=""> 377          ){                                                                                                        </span>
<span class="7946305415555164516" onmouseenter="enter('7946305415555164516');" onmouseout="out('7946305415555164516');" style=""> 378              SqlBasicCall sqlBasicCall = (SqlBasicCall) selectNode;                                                </span>
<span class="-6221234471722277998" onmouseenter="enter('-6221234471722277998');" onmouseout="out('-6221234471722277998');" style=""> 379              for(int i=0; i&lt;sqlBasicCall.getOperands().length; i++){                                               </span>
<span class="-6831609595517394087" onmouseenter="enter('-6831609595517394087');" onmouseout="out('-6831609595517394087');" style=""> 380                  SqlNode sqlNode = sqlBasicCall.getOperands()[i];                                                  </span>
<span class="92437031510630357" onmouseenter="enter('92437031510630357');" onmouseout="out('92437031510630357');" style=""> 381                  if(sqlNode instanceof SqlLiteral){                                                                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 382                      continue;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 383                  }                                                                                                 </span>
<span  style=""> 384                                                                                                                    </span>
<span class="-7655129146813432779" onmouseenter="enter('-7655129146813432779');" onmouseout="out('-7655129146813432779');" style=""> 385                  if(sqlNode instanceof SqlDataTypeSpec){                                                           </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 386                      continue;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 387                  }                                                                                                 </span>
<span  style=""> 388                                                                                                                    </span>
<span class="30158307191940159" onmouseenter="enter('30158307191940159');" onmouseout="out('30158307191940159');" style=""> 389                  extractSelectField(sqlNode, extractFieldSet, fromTableNameSet, tableRef);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390              }                                                                                                     </span>
<span  style=""> 391                                                                                                                    </span>
<span class="2155507952934750451" onmouseenter="enter('2155507952934750451');" onmouseout="out('2155507952934750451');" style=""> 392          }else if(selectNode.getKind() == CASE){                                                                   </span>
<span class="-6113591358780745482" onmouseenter="enter('-6113591358780745482');" onmouseout="out('-6113591358780745482');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 393 -            System.out.println(&quot;selectNode&quot;);                                                                     </span>
<span class="-1390336112814264886" onmouseenter="enter('-1390336112814264886');" onmouseout="out('-1390336112814264886');" style=""> 394              SqlCase sqlCase = (SqlCase) selectNode;                                                               </span>
<span class="-3655271460728510010" onmouseenter="enter('-3655271460728510010');" onmouseout="out('-3655271460728510010');" style=""> 395              SqlNodeList whenOperands = sqlCase.getWhenOperands();                                                 </span>
<span class="8318973293639639494" onmouseenter="enter('8318973293639639494');" onmouseout="out('8318973293639639494');" style=""> 396              SqlNodeList thenOperands = sqlCase.getThenOperands();                                                 </span>
<span class="3014895614462197568" onmouseenter="enter('3014895614462197568');" onmouseout="out('3014895614462197568');" style=""> 397              SqlNode elseNode = sqlCase.getElseOperand();                                                          </span>
<span  style=""> 398                                                                                                                    </span>
<span class="6346785150356032184" onmouseenter="enter('6346785150356032184');" onmouseout="out('6346785150356032184');" style=""> 399              for(int i=0; i&lt;whenOperands.size(); i++){                                                             </span>
<span class="1734344807386881213" onmouseenter="enter('1734344807386881213');" onmouseout="out('1734344807386881213');" style=""> 400                  SqlNode oneOperand = whenOperands.get(i);                                                         </span>
<span class="1407654974389323920" onmouseenter="enter('1407654974389323920');" onmouseout="out('1407654974389323920');" style=""> 401                  extractSelectField(oneOperand, extractFieldSet, fromTableNameSet, tableRef);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402              }                                                                                                     </span>
<span  style=""> 403                                                                                                                    </span>
<span class="-8902171898794493922" onmouseenter="enter('-8902171898794493922');" onmouseout="out('-8902171898794493922');" style=""> 404              for(int i=0; i&lt;thenOperands.size(); i++){                                                             </span>
<span class="-3989978989358262134" onmouseenter="enter('-3989978989358262134');" onmouseout="out('-3989978989358262134');" style=""> 405                  SqlNode oneOperand = thenOperands.get(i);                                                         </span>
<span class="1407654974389323920" onmouseenter="enter('1407654974389323920');" onmouseout="out('1407654974389323920');" style=""> 406                  extractSelectField(oneOperand, extractFieldSet, fromTableNameSet, tableRef);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 407              }                                                                                                     </span>
<span  style=""> 408                                                                                                                    </span>
<span class="-1225911656205055173" onmouseenter="enter('-1225911656205055173');" onmouseout="out('-1225911656205055173');" style=""> 409              extractSelectField(elseNode, extractFieldSet, fromTableNameSet, tableRef);                            </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 410          }else {                                                                                                   </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 411              //do nothing                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 413      }                                                                                                             </span>
<span  style=""> 414                                                                                                                    </span>
<span  style=""> 415                                                                                                                    </span>
<span class="-1906922116491244459" onmouseenter="enter('-1906922116491244459');" onmouseout="out('-1906922116491244459');" style=""><abbr title=" 416      private Tuple2&lt;String, String&gt; parseRightNode(SqlNode sqlNode, Set&lt;String&gt; sideTableSet, Queue&lt;Object&gt; queueInfo,"> 416      private Tuple2&lt;String, String&gt; parseRightNode(SqlNode sqlNode, Set&lt;String&gt; sideTableSet, Queue&lt;Object&gt; queueIn🔵</abbr></span>
<span class="-5149999535499369188" onmouseenter="enter('-5149999535499369188');" onmouseout="out('-5149999535499369188');" style=""> 417                                                    SqlNode parentWhere, SqlNodeList selectList) {                  </span>

<span class="-7809629950828083535" onmouseenter="enter('-7809629950828083535');" onmouseout="out('-7809629950828083535');" style=""> 418          Tuple2&lt;String, String&gt; tabName = new Tuple2&lt;&gt;(&quot;&quot;, &quot;&quot;);                                                    </span>
<span class="7570038518439211250" onmouseenter="enter('7570038518439211250');" onmouseout="out('7570038518439211250');" style=""> 419          if(sqlNode.getKind() == IDENTIFIER){                                                                      </span>
<span class="-7735158387636601028" onmouseenter="enter('-7735158387636601028');" onmouseout="out('-7735158387636601028');" style=""> 420              tabName.f0 = sqlNode.toString();                                                                      </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 421          }else{                                                                                                    </span>
<span class="5760084663094791409" onmouseenter="enter('5760084663094791409');" onmouseout="out('5760084663094791409');" style=""><abbr title=" 422              AliasInfo aliasInfo = (AliasInfo)sideSQLParser.parseSql(sqlNode, sideTableSet, queueInfo, parentWhere, selectList);"> 422              AliasInfo aliasInfo = (AliasInfo)sideSQLParser.parseSql(sqlNode, sideTableSet, queueInfo, parentWhere,🔵</abbr></span>

<span class="-7052196639543907068" onmouseenter="enter('-7052196639543907068');" onmouseout="out('-7052196639543907068');" style=""> 423              tabName.f0 = aliasInfo.getName();                                                                     </span>
<span class="-2307032070137542057" onmouseenter="enter('-2307032070137542057');" onmouseout="out('-2307032070137542057');" style=""> 424              tabName.f1 = aliasInfo.getAlias();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 425          }                                                                                                         </span>
<span class="-6789109484485831180" onmouseenter="enter('-6789109484485831180');" onmouseout="out('-6789109484485831180');" style=""> 426          return tabName;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 427      }                                                                                                             </span>
<span  style=""> 428                                                                                                                    </span>
<span class="1768499303484569694" onmouseenter="enter('1768499303484569694');" onmouseout="out('1768499303484569694');" style=""> 429      private Tuple2&lt;String, String&gt; parseLeftNode(SqlNode sqlNode){                                                </span>
<span class="-7809629950828083535" onmouseenter="enter('-7809629950828083535');" onmouseout="out('-7809629950828083535');" style=""> 430          Tuple2&lt;String, String&gt; tabName = new Tuple2&lt;&gt;(&quot;&quot;, &quot;&quot;);                                                    </span>
<span class="7570038518439211250" onmouseenter="enter('7570038518439211250');" onmouseout="out('7570038518439211250');" style=""> 431          if(sqlNode.getKind() == IDENTIFIER){                                                                      </span>
<span class="-7735158387636601028" onmouseenter="enter('-7735158387636601028');" onmouseout="out('-7735158387636601028');" style=""> 432              tabName.f0 = sqlNode.toString();                                                                      </span>
<span class="-6648818000206782174" onmouseenter="enter('-6648818000206782174');" onmouseout="out('-6648818000206782174');" style=""> 433              tabName.f1 = sqlNode.toString();                                                                      </span>
<span class="7640894634328871584" onmouseenter="enter('7640894634328871584');" onmouseout="out('7640894634328871584');" style=""> 434          }else if (sqlNode.getKind() == AS){                                                                       </span>
<span class="-4085054753182131209" onmouseenter="enter('-4085054753182131209');" onmouseout="out('-4085054753182131209');" style=""> 435              SqlNode info = ((SqlBasicCall)sqlNode).getOperands()[0];                                              </span>
<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style=""> 436              SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                                            </span>
<span  style=""> 437                                                                                                                    </span>
<span class="6350181014025417708" onmouseenter="enter('6350181014025417708');" onmouseout="out('6350181014025417708');" style=""> 438              tabName.f0 = info.toString();                                                                         </span>
<span class="-6499418961284910074" onmouseenter="enter('-6499418961284910074');" onmouseout="out('-6499418961284910074');" style=""> 439              tabName.f1 = alias.toString();                                                                        </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 440          }else {                                                                                                   </span>
<span class="-4528765899368294479" onmouseenter="enter('-4528765899368294479');" onmouseout="out('-4528765899368294479');" style=""> 441              throw new RuntimeException(&quot;&quot;);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 442          }                                                                                                         </span>
<span  style=""> 443                                                                                                                    </span>
<span class="-6789109484485831180" onmouseenter="enter('-6789109484485831180');" onmouseout="out('-6789109484485831180');" style=""> 444          return tabName;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 445      }                                                                                                             </span>
<span  style=""> 446                                                                                                                    </span>
<span class="2221421009159751305" onmouseenter="enter('2221421009159751305');" onmouseout="out('2221421009159751305');" style=""> 447      public String buildCondition(List&lt;SqlBasicCall&gt; conditionList){                                               </span>
<span class="-4757924659479519527" onmouseenter="enter('-4757924659479519527');" onmouseout="out('-4757924659479519527');" style=""> 448          if(CollectionUtils.isEmpty(conditionList)){                                                               </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 449              return &quot;&quot;;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 450          }                                                                                                         </span>
<span  style=""> 451                                                                                                                    </span>
<span class="-8689756052096276488" onmouseenter="enter('-8689756052096276488');" onmouseout="out('-8689756052096276488');" style=""> 452          return &quot; where &quot; + StringUtils.join(conditionList, &quot; AND &quot;);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 453      }                                                                                                             </span>
<span  style=""> 454                                                                                                                    </span>
<span class="5697770358925248547" onmouseenter="enter('5697770358925248547');" onmouseout="out('5697770358925248547');" style=""> 455      public String buildSelectNode(Set&lt;String&gt; extractSelectField, Set&lt;String&gt; joinFieldSet){                      </span>








<span class="2785520985351844766" onmouseenter="enter('2785520985351844766');" onmouseout="out('2785520985351844766');" style=""> 456          if(CollectionUtils.isEmpty(extractSelectField)){                                                          </span>
<span class="5868864582051651172" onmouseenter="enter('5868864582051651172');" onmouseout="out('5868864582051651172');" style=""> 457              throw new RuntimeException(&quot;no field is used&quot;);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 458          }                                                                                                         </span>
<span  style=""> 459                                                                                                                    </span>
<span class="6553440588068575808" onmouseenter="enter('6553440588068575808');" onmouseout="out('6553440588068575808');" style=""> 460          Sets.SetView view = Sets.union(extractSelectField, joinFieldSet);                                         </span>
<span  style=""> 461                                                                                                                    </span>
<span class="-551741438203083334" onmouseenter="enter('-551741438203083334');" onmouseout="out('-551741438203083334');" style=""> 462          return StringUtils.join(view, &quot;,&quot;);                                                                       </span>





















<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 463      }                                                                                                             </span>
<span  style=""> 464                                                                                                                    </span>
<span class="4243587240101238542" onmouseenter="enter('4243587240101238542');" onmouseout="out('4243587240101238542');" style=""> 465      private boolean checkIsSideTable(String tableName, Set&lt;String&gt; sideTableList){                                </span>
<span class="7734723301291741274" onmouseenter="enter('7734723301291741274');" onmouseout="out('7734723301291741274');" style=""> 466          if(sideTableList.contains(tableName)){                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 467              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 468          }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 469          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470      }                                                                                                             </span>
<span  style=""> 471                                                                                                                    </span>
<span class="-8109971872323514495" onmouseenter="enter('-8109971872323514495');" onmouseout="out('-8109971872323514495');" style=""> 472      private SqlBasicCall buildAsSqlNode(String internalTableName, SqlNode newSource) {                            </span>
<span class="2981236818393294037" onmouseenter="enter('2981236818393294037');" onmouseout="out('2981236818393294037');" style=""> 473          SqlOperator operator = new SqlAsOperator();                                                               </span>
<span class="-1667801166019875282" onmouseenter="enter('-1667801166019875282');" onmouseout="out('-1667801166019875282');" style=""> 474          SqlParserPos sqlParserPos = new SqlParserPos(0, 0);                                                       </span>
<span class="8198536898736028280" onmouseenter="enter('8198536898736028280');" onmouseout="out('8198536898736028280');" style=""> 475          SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(internalTableName, null, sqlParserPos);              </span>
<span class="-7310412248425019303" onmouseenter="enter('-7310412248425019303');" onmouseout="out('-7310412248425019303');" style=""> 476          SqlNode[] sqlNodes = new SqlNode[2];                                                                      </span>
<span class="2025970151619105195" onmouseenter="enter('2025970151619105195');" onmouseout="out('2025970151619105195');" style=""> 477          sqlNodes[0] = newSource;                                                                                  </span>
<span class="-4093556188235461327" onmouseenter="enter('-4093556188235461327');" onmouseout="out('-4093556188235461327');" style=""> 478          sqlNodes[1] = sqlIdentifierAlias;                                                                         </span>
<span class="-1928364106966605511" onmouseenter="enter('-1928364106966605511');" onmouseout="out('-1928364106966605511');" style=""> 479          return new SqlBasicCall(operator, sqlNodes, sqlParserPos);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 480      }                                                                                                             </span>
<span  style=""> 481                                                                                                                    </span>
































<span  style=""> 482                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 483      /**                                                                                                           </span>
<span class="-74598125528384596" onmouseenter="enter('-74598125528384596');" onmouseout="out('-74598125528384596');" style=""> 484       * 检查关联的where 条件中的判断是否可以下移到新构建的子查询                                                                            </span>
<span class="-6365101737408851156" onmouseenter="enter('-6365101737408851156');" onmouseout="out('-6365101737408851156');" style=""> 485       * @param fromTableNameSet                                                                                    </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 486       * @param parentWhere                                                                                         </span>
<span class="-2506765310601959421" onmouseenter="enter('-2506765310601959421');" onmouseout="out('-2506765310601959421');" style=""> 487       * @param extractCondition                                                                                    </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 488       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 489       */                                                                                                           </span>
<span class="-3374362155096196822" onmouseenter="enter('-3374362155096196822');" onmouseout="out('-3374362155096196822');" style=""> 490      private boolean checkAndRemoveWhereCondition(Set&lt;String&gt; fromTableNameSet,                                    </span>
<span class="1711245815305911921" onmouseenter="enter('1711245815305911921');" onmouseout="out('1711245815305911921');" style=""> 491                                                   SqlBasicCall parentWhere,                                        </span>
<span class="-6744704019370069554" onmouseenter="enter('-6744704019370069554');" onmouseout="out('-6744704019370069554');" style=""> 492                                                   List&lt;SqlBasicCall&gt; extractCondition){                            </span>
<span class="-7344361739038630250" onmouseenter="enter('-7344361739038630250');" onmouseout="out('-7344361739038630250');" style=""> 493          if(parentWhere == null){                                                                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 494              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 495          }                                                                                                         </span>
<span  style=""> 496                                                                                                                    </span>
<span class="7198030462908925381" onmouseenter="enter('7198030462908925381');" onmouseout="out('7198030462908925381');" style=""> 497          SqlKind kind = parentWhere.getKind();                                                                     </span>
<span class="-1872623569752802183" onmouseenter="enter('-1872623569752802183');" onmouseout="out('-1872623569752802183');" style=""> 498          if(kind == AND){                                                                                          </span>
<span class="-8510136866484254033" onmouseenter="enter('-8510136866484254033');" onmouseout="out('-8510136866484254033');" style=""><abbr title=" 499              boolean removeLeft = checkAndRemoveWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[0], extractCondition);"> 499              boolean removeLeft = checkAndRemoveWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOper🔵</abbr></span>
<span class="-2929912762198310557" onmouseenter="enter('-2929912762198310557');" onmouseout="out('-2929912762198310557');" style=""><abbr title=" 500              boolean removeRight = checkAndRemoveWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOperands()[1], extractCondition);"> 500              boolean removeRight = checkAndRemoveWhereCondition(fromTableNameSet, (SqlBasicCall) parentWhere.getOpe🔵</abbr></span>
<span class="891835357289668161" onmouseenter="enter('891835357289668161');" onmouseout="out('891835357289668161');" style=""> 501              //DO remove                                                                                           </span>
<span class="1439443091018833301" onmouseenter="enter('1439443091018833301');" onmouseout="out('1439443091018833301');" style=""> 502              if(removeLeft){                                                                                       </span>
<span class="5619021625980792664" onmouseenter="enter('5619021625980792664');" onmouseout="out('5619021625980792664');" style=""> 503                  extractCondition.add(removeWhereConditionNode(parentWhere, 0));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 504              }                                                                                                     </span>
<span  style=""> 505                                                                                                                    </span>
<span class="6778546312639684033" onmouseenter="enter('6778546312639684033');" onmouseout="out('6778546312639684033');" style=""> 506              if(removeRight){                                                                                      </span>
<span class="-3233327769126268813" onmouseenter="enter('-3233327769126268813');" onmouseout="out('-3233327769126268813');" style=""> 507                  extractCondition.add(removeWhereConditionNode(parentWhere, 1));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 508              }                                                                                                     </span>
<span  style=""> 509                                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 510              return false;                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 511          } else {                                                                                                  </span>



<span class="2827886728692945898" onmouseenter="enter('2827886728692945898');" onmouseout="out('2827886728692945898');" style=""> 512              Set&lt;String&gt; conditionRefTableNameSet = Sets.newHashSet();                                             </span>
<span class="-8585593551708223309" onmouseenter="enter('-8585593551708223309');" onmouseout="out('-8585593551708223309');" style=""> 513              TableUtils.getConditionRefTable(parentWhere, conditionRefTableNameSet);                               </span>








<span  style=""> 514                                                                                                                    </span>
<span class="1299203886922461523" onmouseenter="enter('1299203886922461523');" onmouseout="out('1299203886922461523');" style=""> 515              if(fromTableNameSet.containsAll(conditionRefTableNameSet)){                                           </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 516                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 517              }                                                                                                     </span>
<span  style=""> 518                                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 519              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 520          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 521      }                                                                                                             </span>
<span  style=""> 522                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 523      /**                                                                                                           </span>
<span class="967733528902221289" onmouseenter="enter('967733528902221289');" onmouseout="out('967733528902221289');" style=""> 524       * 抽取where 条件中指定的条件                                                                                           </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style=""> 525       * @param parentWhere                                                                                         </span>
<span class="-460759719067432320" onmouseenter="enter('-460759719067432320');" onmouseout="out('-460759719067432320');" style=""> 526       * @param index                                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 527       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 528       */                                                                                                           </span>
<span class="-8004122385362241836" onmouseenter="enter('-8004122385362241836');" onmouseout="out('-8004122385362241836');" style=""> 529      public SqlBasicCall removeWhereConditionNode(SqlBasicCall parentWhere, int index){                            </span>
<span class="2911889278610374450" onmouseenter="enter('2911889278610374450');" onmouseout="out('2911889278610374450');" style=""> 530          SqlBasicCall oldCondition = (SqlBasicCall) parentWhere.getOperands()[index];                              </span>
<span class="3156064786234930120" onmouseenter="enter('3156064786234930120');" onmouseout="out('3156064786234930120');" style=""> 531          parentWhere.setOperand(index, buildEmptyCondition());                                                     </span>
<span class="-6343538087515378636" onmouseenter="enter('-6343538087515378636');" onmouseout="out('-6343538087515378636');" style=""> 532          return oldCondition;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 533      }                                                                                                             </span>
<span  style=""> 534                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 535      /**                                                                                                           </span>
<span class="-6739953174199833520" onmouseenter="enter('-6739953174199833520');" onmouseout="out('-6739953174199833520');" style=""> 536       * 构建 1=1的 where 条件                                                                                           </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 537       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 538       */                                                                                                           </span>
<span class="-4073514796854358980" onmouseenter="enter('-4073514796854358980');" onmouseout="out('-4073514796854358980');" style=""> 539      public SqlBasicCall buildEmptyCondition(){                                                                    </span>
<span class="7737073508893451149" onmouseenter="enter('7737073508893451149');" onmouseout="out('7737073508893451149');" style=""> 540          SqlBinaryOperator equalsOperators = SqlStdOperatorTable.EQUALS;                                           </span>
<span class="-6629769419150459383" onmouseenter="enter('-6629769419150459383');" onmouseout="out('-6629769419150459383');" style=""> 541          SqlNode[] operands = new SqlNode[2];                                                                      </span>
<span class="7829210030518325331" onmouseenter="enter('7829210030518325331');" onmouseout="out('7829210030518325331');" style=""> 542          operands[0] = SqlLiteral.createExactNumeric(&quot;1&quot;, SqlParserPos.ZERO);                                      </span>
<span class="8653141241037221613" onmouseenter="enter('8653141241037221613');" onmouseout="out('8653141241037221613');" style=""> 543          operands[1] = SqlLiteral.createExactNumeric(&quot;1&quot;, SqlParserPos.ZERO);                                      </span>
<span  style=""> 544                                                                                                                    </span>
<span class="-886608164186614965" onmouseenter="enter('-886608164186614965');" onmouseout="out('-886608164186614965');" style=""> 545          return new SqlBasicCall(equalsOperators, operands, SqlParserPos.ZERO);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 546      }                                                                                                             </span>
<span  style=""> 547                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 548      /**                                                                                                           </span>
<span class="6566659164166093473" onmouseenter="enter('6566659164166093473');" onmouseout="out('6566659164166093473');" style=""> 549       * 替换join 条件中的表名称                                                                                             </span>
<span class="384197096128287152" onmouseenter="enter('384197096128287152');" onmouseout="out('384197096128287152');" style=""> 550       * @param node                                                                                                </span>
<span class="1832696003310156507" onmouseenter="enter('1832696003310156507');" onmouseout="out('1832696003310156507');" style=""> 551       * @param tableMap 表名的关联关系                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 552       */                                                                                                           </span>
<span class="8926761967375059586" onmouseenter="enter('8926761967375059586');" onmouseout="out('8926761967375059586');" style=""> 553      private SqlIdentifier checkAndReplaceJoinCondition(SqlNode node, Map&lt;String, String&gt; tableMap){               </span>
<span  style=""> 554                                                                                                                    </span>
<span class="-4460996797142447051" onmouseenter="enter('-4460996797142447051');" onmouseout="out('-4460996797142447051');" style=""> 555          SqlKind joinKind = node.getKind();                                                                        </span>
<span class="6904180996725590590" onmouseenter="enter('6904180996725590590');" onmouseout="out('6904180996725590590');" style=""> 556          if( joinKind == AND || joinKind == EQUALS ){                                                              </span>
<span class="-5502960919920628784" onmouseenter="enter('-5502960919920628784');" onmouseout="out('-5502960919920628784');" style=""> 557              SqlIdentifier leftNode = checkAndReplaceJoinCondition(((SqlBasicCall)node).operands[0], tableMap);    </span>
<span class="-1134508213250580541" onmouseenter="enter('-1134508213250580541');" onmouseout="out('-1134508213250580541');" style=""> 558              SqlIdentifier rightNode = checkAndReplaceJoinCondition(((SqlBasicCall)node).operands[1], tableMap);   </span>
<span  style=""> 559                                                                                                                    </span>
<span class="1261032046064330806" onmouseenter="enter('1261032046064330806');" onmouseout="out('1261032046064330806');" style=""> 560              if(leftNode != null){                                                                                 </span>
<span class="7925883472313959466" onmouseenter="enter('7925883472313959466');" onmouseout="out('7925883472313959466');" style=""> 561                  ((SqlBasicCall)node).setOperand(0, leftNode);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 562              }                                                                                                     </span>
<span  style=""> 563                                                                                                                    </span>
<span class="-5287428749677694788" onmouseenter="enter('-5287428749677694788');" onmouseout="out('-5287428749677694788');" style=""> 564              if(rightNode != null){                                                                                </span>
<span class="-6758558001428237557" onmouseenter="enter('-6758558001428237557');" onmouseout="out('-6758558001428237557');" style=""> 565                  ((SqlBasicCall)node).setOperand(1, leftNode);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 566              }                                                                                                     </span>
<span  style=""> 567                                                                                                                    </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 568              return null;                                                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 569          } else {                                                                                                  </span>
<span class="2603254540286226339" onmouseenter="enter('2603254540286226339');" onmouseout="out('2603254540286226339');" style=""> 570              //replace table                                                                                       </span>
<span class="-7283729608735687376" onmouseenter="enter('-7283729608735687376');" onmouseout="out('-7283729608735687376');" style=""><abbr title=" 571              Preconditions.checkState(((SqlIdentifier)node).names.size() == 2, &quot;join condition must be format table.field&quot;);"> 571              Preconditions.checkState(((SqlIdentifier)node).names.size() == 2, &quot;join condition must be format table🔵</abbr></span>
<span class="5830077366186139259" onmouseenter="enter('5830077366186139259');" onmouseout="out('5830077366186139259');" style=""> 572              String tbName = ((SqlIdentifier) node).names.get(0);                                                  </span>
<span class="807909526670811479" onmouseenter="enter('807909526670811479');" onmouseout="out('807909526670811479');" style=""> 573              if(tableMap.containsKey(tbName)){                                                                     </span>
<span class="-5261902895497527633" onmouseenter="enter('-5261902895497527633');" onmouseout="out('-5261902895497527633');" style=""> 574                  tbName = tableMap.get(tbName);                                                                    </span>
<span class="6671350446806430567" onmouseenter="enter('6671350446806430567');" onmouseout="out('6671350446806430567');" style=""> 575                  return ((SqlIdentifier) node).setName(0, tbName);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 576              }                                                                                                     </span>
<span  style=""> 577                                                                                                                    </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 578              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 579          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 580      }                                                                                                             </span>
<span  style=""> 581                                                                                                                    </span>



















<span  style=""> 582                                                                                                                    </span>
<span  style=""> 583                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 584  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            