<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>536</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    536
                    <a href="535.html">prev</a>
                    <a href="537.html">next</a>
                    <a href="536_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    Evernote/android-job_990c47ba5da81fba1ec423479b571f44f504d473_library/src/main/java/com/evernote/android/job/JobProxy.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Evernote\android-job show &quot;990c47ba5da81fba1ec423479b571f44f504d473:library/src/main/java/com/evernote/android/job/JobProxy.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Evernote\android-job show &quot;990c47ba5da81fba1ec423479b571f44f504d473^1:library/src/main/java/com/evernote/android/job/JobProxy.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Evernote\android-job show &quot;990c47ba5da81fba1ec423479b571f44f504d473^2:library/src/main/java/com/evernote/android/job/JobProxy.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Evernote\android-job show &quot;796bfe5f3ba9fe53d163919757b3d93d45df0089:library/src/main/java/com/evernote/android/job/JobProxy.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [b], [j]], subset: [[bj], [b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-8822900351790619766" onmouseenter="enter('-8822900351790619766');" onmouseout="out('-8822900351790619766');" style="">   2  * Copyright 2007-present Evernote Corporation.                                                          </span>
<span class="-2278367542838177584" onmouseenter="enter('-2278367542838177584');" onmouseout="out('-2278367542838177584');" style="">   3  * All rights reserved.                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   4  *                                                                                                       </span>
<span class="181301442133285836" onmouseenter="enter('181301442133285836');" onmouseout="out('181301442133285836');" style="">   5  * Redistribution and use in source and binary forms, with or without modification,                      </span>
<span class="-5073197948967426970" onmouseenter="enter('-5073197948967426970');" onmouseout="out('-5073197948967426970');" style="">   6  * are permitted provided that the following conditions are met:                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="8127251449117563942" onmouseenter="enter('8127251449117563942');" onmouseout="out('8127251449117563942');" style="">   8  * 1. Redistributions of source code must retain the above copyright notice, this                        </span>
<span class="-1473911044945790828" onmouseenter="enter('-1473911044945790828');" onmouseout="out('-1473911044945790828');" style="">   9  *    list of conditions and the following disclaimer.                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  10  *                                                                                                       </span>
<span class="4835137028529553232" onmouseenter="enter('4835137028529553232');" onmouseout="out('4835137028529553232');" style="">  11  * 2. Redistributions in binary form must reproduce the above copyright notice,                          </span>
<span class="-1312443230807442131" onmouseenter="enter('-1312443230807442131');" onmouseout="out('-1312443230807442131');" style="">  12  *    this list of conditions and the following disclaimer in the documentation                          </span>
<span class="-2067912076149043179" onmouseenter="enter('-2067912076149043179');" onmouseout="out('-2067912076149043179');" style="">  13  *    and/or other materials provided with the distribution.                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  14  *                                                                                                       </span>
<span class="-7721941782677048447" onmouseenter="enter('-7721941782677048447');" onmouseout="out('-7721941782677048447');" style="">  15  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND                       </span>
<span class="-5124048439450882348" onmouseenter="enter('-5124048439450882348');" onmouseout="out('-5124048439450882348');" style="">  16  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED                         </span>
<span class="2277289959795125050" onmouseenter="enter('2277289959795125050');" onmouseout="out('2277289959795125050');" style="">  17  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.                    </span>
<span class="4422846307625339339" onmouseenter="enter('4422846307625339339');" onmouseout="out('4422846307625339339');" style="">  18  * IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,                       </span>
<span class="9023453646714579255" onmouseenter="enter('9023453646714579255');" onmouseout="out('9023453646714579255');" style="">  19  * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,                        </span>
<span class="2153827234735713132" onmouseenter="enter('2153827234735713132');" onmouseout="out('2153827234735713132');" style="">  20  * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,                         </span>
<span class="5782830561991082866" onmouseenter="enter('5782830561991082866');" onmouseout="out('5782830561991082866');" style="">  21  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF                       </span>
<span class="-2513683953102966204" onmouseenter="enter('-2513683953102966204');" onmouseout="out('-2513683953102966204');" style="">  22  * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE                       </span>
<span class="-6562574984275957691" onmouseenter="enter('-6562574984275957691');" onmouseout="out('-6562574984275957691');" style="">  23  * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF                             </span>
<span class="505998933154990042" onmouseenter="enter('505998933154990042');" onmouseout="out('505998933154990042');" style="">  24  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  25  */                                                                                                      </span>
<span class="4675552543740820910" onmouseenter="enter('4675552543740820910');" onmouseout="out('4675552543740820910');" style="">  26 package com.evernote.android.job;                                                                        </span>
<span  style="">  27                                                                                                          </span>
<span class="-1261404242645970098" onmouseenter="enter('-1261404242645970098');" onmouseout="out('-1261404242645970098');" style="">  28 import android.app.Service;                                                                              </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  29 import android.content.ComponentName;                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  30 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  31 import android.content.Intent;                                                                           </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  32 import android.os.Bundle;                                                                                </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="">  33 import android.os.Looper;                                                                                </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  34 import android.support.annotation.NonNull;                                                               </span>
<span class="4394652512097310678" onmouseenter="enter('4394652512097310678');" onmouseout="out('4394652512097310678');" style="">  35 import android.support.annotation.Nullable;                                                              </span>
<span  style="">  36                                                                                                          </span>
<span class="2270421051523495577" onmouseenter="enter('2270421051523495577');" onmouseout="out('2270421051523495577');" style="">  37 import com.evernote.android.job.util.JobUtil;                                                            </span>
<span  style="">  38                                                                                                          </span>
<span class="4887698622156748971" onmouseenter="enter('4887698622156748971');" onmouseout="out('4887698622156748971');" style="">  39 import net.vrallev.android.cat.CatLog;                                                                   </span>
<span  style="">  40                                                                                                          </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="">  41 import java.util.Locale;                                                                                 </span>
<span class="6613496282884511495" onmouseenter="enter('6613496282884511495');" onmouseout="out('6613496282884511495');" style="">  42 import java.util.concurrent.ExecutionException;                                                          </span>
<span class="-331778695229620376" onmouseenter="enter('-331778695229620376');" onmouseout="out('-331778695229620376');" style="">  43 import java.util.concurrent.Future;                                                                      </span>
<span class="1867212591271003466" onmouseenter="enter('1867212591271003466');" onmouseout="out('1867212591271003466');" style="">  44 import java.util.concurrent.ThreadFactory;                                                               </span>
<span class="7979168040994256185" onmouseenter="enter('7979168040994256185');" onmouseout="out('7979168040994256185');" style="">  45 import java.util.concurrent.atomic.AtomicInteger;                                                        </span>
<span  style="">  46                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  47 /**                                                                                                      </span>
<span class="-126646863796949621" onmouseenter="enter('-126646863796949621');" onmouseout="out('-126646863796949621');" style="">  48  * A proxy for each {@link JobApi}.                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  49  *                                                                                                       </span>
<span class="-2541210092808878866" onmouseenter="enter('-2541210092808878866');" onmouseout="out('-2541210092808878866');" style="">  50  * @author rwondratschek                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  51  */                                                                                                      </span>
<span class="1140466455373644171" onmouseenter="enter('1140466455373644171');" onmouseout="out('1140466455373644171');" style="">  52 public interface JobProxy {                                                                              </span>
<span  style="">  53                                                                                                          </span>
<span class="-8144897713900189970" onmouseenter="enter('-8144897713900189970');" onmouseout="out('-8144897713900189970');" style="">  54     void plantOneOff(JobRequest request);                                                                </span>
<span  style="">  55                                                                                                          </span>
<span class="-2416890449051145953" onmouseenter="enter('-2416890449051145953');" onmouseout="out('-2416890449051145953');" style="">  56     void plantPeriodic(JobRequest request);                                                              </span>
<span  style="">  57                                                                                                          </span>
<span class="6309911337945331379" onmouseenter="enter('6309911337945331379');" onmouseout="out('6309911337945331379');" style="">  58     void plantPeriodicFlexSupport(JobRequest request);                                                   </span>
<span  style="">  59                                                                                                          </span>
<span class="8340124833639515371" onmouseenter="enter('8340124833639515371');" onmouseout="out('8340124833639515371');" style="">  60     void cancel(int jobId);                                                                              </span>
<span  style="">  61                                                                                                          </span>
<span class="-6161809553933645851" onmouseenter="enter('-6161809553933645851');" onmouseout="out('-6161809553933645851');" style="">  62     boolean isPlatformJobScheduled(JobRequest request);                                                  </span>
<span  style="">  63                                                                                                          </span>
<span class="5106484226992372263" onmouseenter="enter('5106484226992372263');" onmouseout="out('5106484226992372263');" style="">  64     @SuppressWarnings(&quot;UnusedReturnValue&quot;)                                                               </span>
<span class="1769639894748899311" onmouseenter="enter('1769639894748899311');" onmouseout="out('1769639894748899311');" style="">  65     /*package*/ final class Common {                                                                     </span>
<span  style="">  66                                                                                                          </span>
<span class="-7267523611033686156" onmouseenter="enter('-7267523611033686156');" onmouseout="out('-7267523611033686156');" style="">  67         private static final Object COMMON_MONITOR = new Object();                                       </span>
<span  style="">  68                                                                                                          </span>
<span class="142194204239450957" onmouseenter="enter('142194204239450957');" onmouseout="out('142194204239450957');" style="">  69         public static final ThreadFactory COMMON_THREAD_FACTORY = new ThreadFactory() {                  </span>
<span  style="">  70                                                                                                          </span>
<span class="8379292492229673398" onmouseenter="enter('8379292492229673398');" onmouseout="out('8379292492229673398');" style="">  71             private final AtomicInteger mThreadNumber = new AtomicInteger();                             </span>
<span  style="">  72                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  73             @Override                                                                                    </span>
<span class="-5634161788732062937" onmouseenter="enter('-5634161788732062937');" onmouseout="out('-5634161788732062937');" style="">  74             public Thread newThread(@NonNull Runnable r) {                                               </span>
<span class="-2238610439465529740" onmouseenter="enter('-2238610439465529740');" onmouseout="out('-2238610439465529740');" style="">  75                 Thread thread = new Thread(r, &quot;AndroidJob-&quot; + mThreadNumber.incrementAndGet());          </span>
<span class="-2780159030059633262" onmouseenter="enter('-2780159030059633262');" onmouseout="out('-2780159030059633262');" style="">  76                 if (thread.isDaemon()) {                                                                 </span>
<span class="-6985289869807539393" onmouseenter="enter('-6985289869807539393');" onmouseout="out('-6985289869807539393');" style="">  77                     thread.setDaemon(false);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78                 }                                                                                        </span>
<span class="3121234640013807968" onmouseenter="enter('3121234640013807968');" onmouseout="out('3121234640013807968');" style="">  79                 if (thread.getPriority() != Thread.NORM_PRIORITY) {                                      </span>
<span class="3041005067018043930" onmouseenter="enter('3041005067018043930');" onmouseout="out('3041005067018043930');" style="">  80                     thread.setPriority(Thread.NORM_PRIORITY);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  81                 }                                                                                        </span>
<span class="3079099442831550764" onmouseenter="enter('3079099442831550764');" onmouseout="out('3079099442831550764');" style="">  82                 return thread;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  83             }                                                                                            </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style="">  84         };                                                                                               </span>
<span  style="">  85                                                                                                          </span>
<span class="8412616957402907467" onmouseenter="enter('8412616957402907467');" onmouseout="out('8412616957402907467');" style=""><abbr title="  86         // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/math/LongMath.java">  86         // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/math🔵</abbr></span>
<span class="-1572685421845796133" onmouseenter="enter('-1572685421845796133');" onmouseout="out('-1572685421845796133');" style="">  87         private static long checkedAdd(long a, long b) {                                                 </span>
<span class="-1527942472133998342" onmouseenter="enter('-1527942472133998342');" onmouseout="out('-1527942472133998342');" style="">  88             long result = a + b;                                                                         </span>
<span class="-8281399218677613001" onmouseenter="enter('-8281399218677613001');" onmouseout="out('-8281399218677613001');" style="">  89             return checkNoOverflow(result, (a ^ b) &lt; 0 | (a ^ result) &gt;= 0);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90         }                                                                                                </span>
<span  style="">  91                                                                                                          </span>
<span class="6423040751114649745" onmouseenter="enter('6423040751114649745');" onmouseout="out('6423040751114649745');" style="">  92         private static long checkNoOverflow(long result, boolean condition) {                            </span>
<span class="6603368327369456734" onmouseenter="enter('6603368327369456734');" onmouseout="out('6603368327369456734');" style="">  93             return condition ? result : Long.MAX_VALUE;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  94         }                                                                                                </span>
<span  style="">  95                                                                                                          </span>
<span class="1406832824568924523" onmouseenter="enter('1406832824568924523');" onmouseout="out('1406832824568924523');" style="">  96         public static long getStartMs(JobRequest request) {                                              </span>
<span class="-6205484021482461183" onmouseenter="enter('-6205484021482461183');" onmouseout="out('-6205484021482461183');" style="">  97             if (request.getFailureCount() &gt; 0) {                                                         </span>
<span class="9206292300770255130" onmouseenter="enter('9206292300770255130');" onmouseout="out('9206292300770255130');" style="">  98                 return request.getBackoffOffset();                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  99             } else {                                                                                     </span>
<span class="-8332790610925894090" onmouseenter="enter('-8332790610925894090');" onmouseout="out('-8332790610925894090');" style=""> 100                 return request.getStartMs();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102         }                                                                                                </span>
<span  style=""> 103                                                                                                          </span>
<span class="-3832824197988283345" onmouseenter="enter('-3832824197988283345');" onmouseout="out('-3832824197988283345');" style=""> 104         public static long getEndMs(JobRequest request) {                                                </span>
<span class="-6205484021482461183" onmouseenter="enter('-6205484021482461183');" onmouseout="out('-6205484021482461183');" style=""> 105             if (request.getFailureCount() &gt; 0) {                                                         </span>
<span class="9206292300770255130" onmouseenter="enter('9206292300770255130');" onmouseout="out('9206292300770255130');" style=""> 106                 return request.getBackoffOffset();                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 107             } else {                                                                                     </span>
<span class="3799819942554251441" onmouseenter="enter('3799819942554251441');" onmouseout="out('3799819942554251441');" style=""> 108                 return request.getEndMs();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 109             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110         }                                                                                                </span>
<span  style=""> 111                                                                                                          </span>
<span class="2658461420075954163" onmouseenter="enter('2658461420075954163');" onmouseout="out('2658461420075954163');" style=""> 112         public static long getAverageDelayMs(JobRequest request) {                                       </span>
<span class="5188333912507681776" onmouseenter="enter('5188333912507681776');" onmouseout="out('5188333912507681776');" style=""> 113             return checkedAdd(getStartMs(request), (getEndMs(request) - getStartMs(request)) / 2);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114         }                                                                                                </span>
<span  style=""> 115                                                                                                          </span>
<span class="-8453711403554538500" onmouseenter="enter('-8453711403554538500');" onmouseout="out('-8453711403554538500');" style=""> 116         public static long getStartMsSupportFlex(JobRequest request) {                                   </span>
<span class="4867134151855536256" onmouseenter="enter('4867134151855536256');" onmouseout="out('4867134151855536256');" style=""> 117             return Math.max(1, request.getIntervalMs() - request.getFlexMs());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118         }                                                                                                </span>
<span  style=""> 119                                                                                                          </span>
<span class="2402850512558550424" onmouseenter="enter('2402850512558550424');" onmouseout="out('2402850512558550424');" style=""> 120         public static long getEndMsSupportFlex(JobRequest request) {                                     </span>
<span class="1818143853198758132" onmouseenter="enter('1818143853198758132');" onmouseout="out('1818143853198758132');" style=""> 121             return request.getIntervalMs();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 122         }                                                                                                </span>
<span  style=""> 123                                                                                                          </span>
<span class="5236833657260895409" onmouseenter="enter('5236833657260895409');" onmouseout="out('5236833657260895409');" style=""> 124         public static long getAverageDelayMsSupportFlex(JobRequest request) {                            </span>
<span class="1202002964551881523" onmouseenter="enter('1202002964551881523');" onmouseout="out('1202002964551881523');" style=""><abbr title=" 125             return checkedAdd(getStartMsSupportFlex(request), (getEndMsSupportFlex(request) - getStartMsSupportFlex(request)) / 2);"> 125             return checkedAdd(getStartMsSupportFlex(request), (getEndMsSupportFlex(request) - getStartMsS🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126         }                                                                                                </span>
<span  style=""> 127                                                                                                          </span>
<span class="5683661540559112003" onmouseenter="enter('5683661540559112003');" onmouseout="out('5683661540559112003');" style=""> 128         public static int getRescheduleCount(JobRequest request) {                                       </span>
<span class="6823077784476657246" onmouseenter="enter('6823077784476657246');" onmouseout="out('6823077784476657246');" style=""> 129             return request.getFailureCount();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 130         }                                                                                                </span>
<span  style=""> 131                                                                                                          </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style=""> 132         private final Context mContext;                                                                  </span>
<span class="3051386596282037072" onmouseenter="enter('3051386596282037072');" onmouseout="out('3051386596282037072');" style=""> 133         private final int mJobId;                                                                        </span>
<span class="6179859670209082226" onmouseenter="enter('6179859670209082226');" onmouseout="out('6179859670209082226');" style=""> 134         private final CatLog mCat;                                                                       </span>
<span  style=""> 135                                                                                                          </span>
<span class="5239517905467210385" onmouseenter="enter('5239517905467210385');" onmouseout="out('5239517905467210385');" style=""> 136         private final JobManager mJobManager;                                                            </span>
<span  style=""> 137                                                                                                          </span>
<span class="-8396683440428310884" onmouseenter="enter('-8396683440428310884');" onmouseout="out('-8396683440428310884');" style=""> 138         public Common(@NonNull Service service, CatLog cat, int jobId) {                                 </span>
<span class="-373217571160035833" onmouseenter="enter('-373217571160035833');" onmouseout="out('-373217571160035833');" style=""> 139             this((Context) service, cat, jobId);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140         }                                                                                                </span>
<span  style=""> 141                                                                                                          </span>
<span class="-8666365961470977949" onmouseenter="enter('-8666365961470977949');" onmouseout="out('-8666365961470977949');" style=""> 142         /*package*/ Common(@NonNull Context context, CatLog cat, int jobId) {                            </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 143             mContext = context;                                                                          </span>
<span class="3380959276812020408" onmouseenter="enter('3380959276812020408');" onmouseout="out('3380959276812020408');" style=""> 144             mJobId = jobId;                                                                              </span>
<span class="-7514169524268117475" onmouseenter="enter('-7514169524268117475');" onmouseout="out('-7514169524268117475');" style=""> 145             mCat = cat;                                                                                  </span>
<span  style=""> 146                                                                                                          </span>
<span class="2088134523180067307" onmouseenter="enter('2088134523180067307');" onmouseout="out('2088134523180067307');" style=""> 147             mJobManager = JobManager.create(context);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148         }                                                                                                </span>
<span  style=""> 149                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 150 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-4157356782926206773" onmouseenter="enter('-4157356782926206773');" onmouseout="out('-4157356782926206773');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 151         public JobRequest getPendingRequest(@SuppressWarnings(&quot;SameParameterValue&quot;) boolean cleanUpOrphanedJob) {"> 151         public JobRequest getPendingRequest(@SuppressWarnings(&quot;SameParameterValue&quot;) boolean cleanUpOrphan🔵</abbr></span>
<span class="-1539078468410613703" onmouseenter="enter('-1539078468410613703');" onmouseout="out('-1539078468410613703');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 152             // order is important for logging purposes                                                   </span>
<span class="6754931577315038874" onmouseenter="enter('6754931577315038874');" onmouseout="out('6754931577315038874');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 153             JobRequest request = mJobManager.getJobRequest(mJobId, true);                                </span>
<span class="-4807858926389575759" onmouseenter="enter('-4807858926389575759');" onmouseout="out('-4807858926389575759');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 154             Job job = mJobManager.getJob(mJobId);                                                        </span>
<span class="80157358755741526" onmouseenter="enter('80157358755741526');" onmouseout="out('80157358755741526');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 155             boolean periodic = request != null &amp;&amp; request.isPeriodic();                                  </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 156 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="6754931577315038874" onmouseenter="enter('6754931577315038874');" onmouseout="out('6754931577315038874');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157             JobRequest request = mJobManager.getJobRequest(mJobId, true);                                </span>
<span class="-4807858926389575759" onmouseenter="enter('-4807858926389575759');" onmouseout="out('-4807858926389575759');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158             Job job = mJobManager.getJob(mJobId);                                                        </span>
<span class="80157358755741526" onmouseenter="enter('80157358755741526');" onmouseout="out('80157358755741526');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159             boolean periodic = request != null &amp;&amp; request.isPeriodic();                                  </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160                                                                                                          </span>
<span class="1317679291661326604" onmouseenter="enter('1317679291661326604');" onmouseout="out('1317679291661326604');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161             if (job != null &amp;&amp; !job.isFinished()) {                                                      </span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 162                 // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 162                 // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobschedule🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 163 =======                                                                                                  </span>
<span class="-3925023906723607869" onmouseenter="enter('-3925023906723607869');" onmouseout="out('-3925023906723607869');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 164         public JobRequest getPendingRequest(boolean cleanUpOrphanedJob, boolean markStarting) {          </span>
<span class="357065027804466477" onmouseenter="enter('357065027804466477');" onmouseout="out('357065027804466477');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 165             synchronized (COMMON_MONITOR) {                                                              </span>
<span class="-1539078468410613703" onmouseenter="enter('-1539078468410613703');" onmouseout="out('-1539078468410613703');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166                 // order is important for logging purposes                                               </span>
<span class="6754931577315038874" onmouseenter="enter('6754931577315038874');" onmouseout="out('6754931577315038874');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 167                 JobRequest request = mJobManager.getJobRequest(mJobId, true);                            </span>
<span class="-4807858926389575759" onmouseenter="enter('-4807858926389575759');" onmouseout="out('-4807858926389575759');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168                 Job job = mJobManager.getJob(mJobId);                                                    </span>
<span class="80157358755741526" onmouseenter="enter('80157358755741526');" onmouseout="out('80157358755741526');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 169                 boolean periodic = request != null &amp;&amp; request.isPeriodic();                              </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 170 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span  style=""> 171                                                                                                          </span>
<span class="1317679291661326604" onmouseenter="enter('1317679291661326604');" onmouseout="out('1317679291661326604');" style=""> 172                 if (job != null &amp;&amp; !job.isFinished()) {                                                  </span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style=""><abbr title=" 173                     // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 173                     // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobsche🔵</abbr></span>
<span class="-5462975656818636592" onmouseenter="enter('-5462975656818636592');" onmouseout="out('-5462975656818636592');" style=""> 174                     mCat.d(&quot;Job %d is already running, %s&quot;, mJobId, request);                            </span>
<span class="-8865814855968501379" onmouseenter="enter('-8865814855968501379');" onmouseout="out('-8865814855968501379');" style=""> 175                     // not necessary to clean up, the running instance will do that                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 176                     return null;                                                                         </span>
<span  style=""> 177                                                                                                          </span>
<span class="-4007651353712364444" onmouseenter="enter('-4007651353712364444');" onmouseout="out('-4007651353712364444');" style=""> 178                 } else if (job != null &amp;&amp; !periodic) {                                                   </span>
<span class="599327769680236656" onmouseenter="enter('599327769680236656');" onmouseout="out('599327769680236656');" style=""> 179                     mCat.d(&quot;Job %d already finished, %s&quot;, mJobId, request);                              </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style=""> 180                     cleanUpOrphanedJob(cleanUpOrphanedJob);                                              </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 181                     return null;                                                                         </span>
<span  style=""> 182                                                                                                          </span>
<span class="-4441559070839346687" onmouseenter="enter('-4441559070839346687');" onmouseout="out('-4441559070839346687');" style=""><abbr title=" 183                 } else if (job != null &amp;&amp; System.currentTimeMillis() - job.getFinishedTimeStamp() &lt; 2_000) {"> 183                 } else if (job != null &amp;&amp; System.currentTimeMillis() - job.getFinishedTimeStamp() &lt; 2_000🔵</abbr></span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style=""><abbr title=" 184                     // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 184                     // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobsche🔵</abbr></span>
<span class="-2963240540698415567" onmouseenter="enter('-2963240540698415567');" onmouseout="out('-2963240540698415567');" style=""> 185                     mCat.d(&quot;Job %d is periodic and just finished, %s&quot;, mJobId, request);                 </span>
<span class="5118828189189336116" onmouseenter="enter('5118828189189336116');" onmouseout="out('5118828189189336116');" style=""> 186                     // don&#x27;t clean up, periodic job                                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 187                     return null;                                                                         </span>
<span  style=""> 188                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 189 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-4719477180175309163" onmouseenter="enter('-4719477180175309163');" onmouseout="out('-4719477180175309163');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 190             } else if (request != null &amp;&amp; request.isStarted()) {                                         </span>
<span class="2694894942883236024" onmouseenter="enter('2694894942883236024');" onmouseout="out('2694894942883236024');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 191                 mCat.d(&quot;Request %d already started, %s&quot;, mJobId, request);                               </span>
<span class="3715771020426903748" onmouseenter="enter('3715771020426903748');" onmouseout="out('3715771020426903748');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 192                 // not necessary to clean up, the JobManager will do this for started jobs               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 193                 return null;                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 194 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="5877082491190597240" onmouseenter="enter('5877082491190597240');" onmouseout="out('5877082491190597240');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195                 // not necessary to clean up, the JobManager will do this for transient jobs             </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196                 return null;                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197                                                                                                          </span>
<span class="-4428555773566380837" onmouseenter="enter('-4428555773566380837');" onmouseout="out('-4428555773566380837');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198             } else if (request == null) {                                                                </span>
<span class="7609103357697598215" onmouseenter="enter('7609103357697598215');" onmouseout="out('7609103357697598215');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 199                 mCat.d(&quot;Request for ID %d was null&quot;, mJobId);                                            </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 200 =======                                                                                                  </span>
<span class="-6449094046803794181" onmouseenter="enter('-6449094046803794181');" onmouseout="out('-6449094046803794181');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201                 } else if (request != null &amp;&amp; request.isTransient()) {                                   </span>
<span class="4384727207576607146" onmouseenter="enter('4384727207576607146');" onmouseout="out('4384727207576607146');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202                     mCat.d(&quot;Request %d is transient, %s&quot;, mJobId, request);                              </span>
<span class="5877082491190597240" onmouseenter="enter('5877082491190597240');" onmouseout="out('5877082491190597240');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203                     // not necessary to clean up, the JobManager will do this for transient jobs         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204                     return null;                                                                         </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 205 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span  style=""> 206                                                                                                          </span>
<span class="-8745598640251884545" onmouseenter="enter('-8745598640251884545');" onmouseout="out('-8745598640251884545');" style=""> 207                 } else if (request != null &amp;&amp; mJobManager.getJobExecutor().isRequestStarting(request)) { </span>
<span class="3441384320730940166" onmouseenter="enter('3441384320730940166');" onmouseout="out('3441384320730940166');" style=""> 208                     mCat.d(&quot;Request %d is in the queue to start, %s&quot;, mJobId, request);                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 209                     return null;                                                                         </span>
<span  style=""> 210                                                                                                          </span>
<span class="-4428555773566380837" onmouseenter="enter('-4428555773566380837');" onmouseout="out('-4428555773566380837');" style=""> 211                 } else if (request == null) {                                                            </span>
<span class="7609103357697598215" onmouseenter="enter('7609103357697598215');" onmouseout="out('7609103357697598215');" style=""> 212                     mCat.d(&quot;Request for ID %d was null&quot;, mJobId);                                        </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style=""> 213                     cleanUpOrphanedJob(cleanUpOrphanedJob);                                              </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 214                     return null;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215                 }                                                                                        </span>
<span  style=""> 216                                                                                                          </span>
<span class="8480325012103084437" onmouseenter="enter('8480325012103084437');" onmouseout="out('8480325012103084437');" style=""> 217                 if (markStarting) {                                                                      </span>
<span class="8387569989042798053" onmouseenter="enter('8387569989042798053');" onmouseout="out('8387569989042798053');" style=""> 218                     mJobManager.getJobExecutor().markJobRequestStarting(request);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219                 }                                                                                        </span>
<span  style=""> 220                                                                                                          </span>
<span class="-1057636993633179522" onmouseenter="enter('-1057636993633179522');" onmouseout="out('-1057636993633179522');" style=""> 221                 return request;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223         }                                                                                                </span>
<span  style=""> 224                                                                                                          </span>
<span class="5154748246392482767" onmouseenter="enter('5154748246392482767');" onmouseout="out('5154748246392482767');" style=""> 225         @NonNull                                                                                         </span>
<span class="4426606055051844156" onmouseenter="enter('4426606055051844156');" onmouseout="out('4426606055051844156');" style=""><abbr title=" 226         public Job.Result executeJobRequest(@NonNull JobRequest request, @Nullable Bundle transientExtras) {"> 226         public Job.Result executeJobRequest(@NonNull JobRequest request, @Nullable Bundle transientExtras🔵</abbr></span>
<span class="8785519441075077783" onmouseenter="enter('8785519441075077783');" onmouseout="out('8785519441075077783');" style=""> 227             long waited = System.currentTimeMillis() - request.getScheduledAt();                         </span>
<span class="-521988911558271196" onmouseenter="enter('-521988911558271196');" onmouseout="out('-521988911558271196');" style=""> 228             String timeWindow;                                                                           </span>
<span class="-4749167882947985624" onmouseenter="enter('-4749167882947985624');" onmouseout="out('-4749167882947985624');" style=""> 229             if (request.isPeriodic()) {                                                                  </span>
<span class="22254303833830880" onmouseenter="enter('22254303833830880');" onmouseout="out('22254303833830880');" style=""><abbr title=" 230                 timeWindow = String.format(Locale.US, &quot;interval %s, flex %s&quot;, JobUtil.timeToString(request.getIntervalMs()),"> 230                 timeWindow = String.format(Locale.US, &quot;interval %s, flex %s&quot;, JobUtil.timeToString(reques🔵</abbr></span>
<span class="-7441385486773924310" onmouseenter="enter('-7441385486773924310');" onmouseout="out('-7441385486773924310');" style=""> 231                         JobUtil.timeToString(request.getFlexMs()));                                      </span>
<span class="4779514256224206313" onmouseenter="enter('4779514256224206313');" onmouseout="out('4779514256224206313');" style=""> 232             } else if (request.getJobApi().supportsExecutionWindow()) {                                  </span>
<span class="-6246254348184491385" onmouseenter="enter('-6246254348184491385');" onmouseout="out('-6246254348184491385');" style=""><abbr title=" 233                 timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMs(request)),"> 233                 timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMs🔵</abbr></span>
<span class="6965396589660564452" onmouseenter="enter('6965396589660564452');" onmouseout="out('6965396589660564452');" style=""> 234                         JobUtil.timeToString(getEndMs(request)));                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 235             } else {                                                                                     </span>
<span class="-1520611369215068334" onmouseenter="enter('-1520611369215068334');" onmouseout="out('-1520611369215068334');" style=""> 236                 timeWindow = &quot;delay &quot; + JobUtil.timeToString(getAverageDelayMs(request));                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237             }                                                                                            </span>
<span  style=""> 238                                                                                                          </span>
<span class="-8808967967811702611" onmouseenter="enter('-8808967967811702611');" onmouseout="out('-8808967967811702611');" style=""> 239             if (Looper.myLooper() == Looper.getMainLooper()) {                                           </span>
<span class="-1368751502622418275" onmouseenter="enter('-1368751502622418275');" onmouseout="out('-1368751502622418275');" style=""><abbr title=" 240                 mCat.w(&quot;Running JobRequest on a main thread, this could cause stutter or ANR in your app.&quot;);"> 240                 mCat.w(&quot;Running JobRequest on a main thread, this could cause stutter or ANR in your app.🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241             }                                                                                            </span>
<span  style=""> 242                                                                                                          </span>
<span class="-1843046913616870974" onmouseenter="enter('-1843046913616870974');" onmouseout="out('-1843046913616870974');" style=""> 243             mCat.d(&quot;Run job, %s, waited %s, %s&quot;, request, JobUtil.timeToString(waited), timeWindow);     </span>
<span class="-4828048199353050218" onmouseenter="enter('-4828048199353050218');" onmouseout="out('-4828048199353050218');" style=""> 244             JobExecutor jobExecutor = mJobManager.getJobExecutor();                                      </span>
<span class="-1235692988875235782" onmouseenter="enter('-1235692988875235782');" onmouseout="out('-1235692988875235782');" style=""> 245             Job job = null;                                                                              </span>
<span  style=""> 246                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 247             try {                                                                                        </span>
<span class="-4769195842780086458" onmouseenter="enter('-4769195842780086458');" onmouseout="out('-4769195842780086458');" style=""><abbr title=" 248                 // create job first before setting it started, avoids a race condition while rescheduling jobs"> 248                 // create job first before setting it started, avoids a race condition while rescheduling🔵</abbr></span>
<span class="1625132338136195706" onmouseenter="enter('1625132338136195706');" onmouseout="out('1625132338136195706');" style=""> 249                 job = mJobManager.getJobCreatorHolder().createJob(request.getTag());                     </span>
<span  style=""> 250                                                                                                          </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 251                 if (!request.isPeriodic()) {                                                             </span>
<span class="4919726022962249182" onmouseenter="enter('4919726022962249182');" onmouseout="out('4919726022962249182');" style=""> 252                     request.setStarted(true);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253                 }                                                                                        </span>
<span  style=""> 254                                                                                                          </span>
<span class="-7821317659145756468" onmouseenter="enter('-7821317659145756468');" onmouseout="out('-7821317659145756468');" style=""> 255                 if (transientExtras == null) {                                                           </span>
<span class="-387255381167201921" onmouseenter="enter('-387255381167201921');" onmouseout="out('-387255381167201921');" style=""> 256                     transientExtras = Bundle.EMPTY;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257                 }                                                                                        </span>
<span  style=""> 258                                                                                                          </span>
<span class="8687421104735025391" onmouseenter="enter('8687421104735025391');" onmouseout="out('8687421104735025391');" style=""> 259                 Future&lt;Job.Result&gt; future = jobExecutor.execute(mContext, request, job, transientExtras);</span>
<span class="-4410702629486134619" onmouseenter="enter('-4410702629486134619');" onmouseout="out('-4410702629486134619');" style=""> 260                 if (future == null) {                                                                    </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 261                     return Job.Result.FAILURE;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262                 }                                                                                        </span>
<span  style=""> 263                                                                                                          </span>
<span class="5244342940061655384" onmouseenter="enter('5244342940061655384');" onmouseout="out('5244342940061655384');" style=""> 264                 // wait until done                                                                       </span>
<span class="-4728317628971455727" onmouseenter="enter('-4728317628971455727');" onmouseout="out('-4728317628971455727');" style=""> 265                 Job.Result result = future.get();                                                        </span>
<span class="368857225067072174" onmouseenter="enter('368857225067072174');" onmouseout="out('368857225067072174');" style=""> 266                 mCat.d(&quot;Finished job, %s %s&quot;, request, result);                                          </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 267                 return result;                                                                           </span>
<span  style=""> 268                                                                                                          </span>
<span class="2273166757001165010" onmouseenter="enter('2273166757001165010');" onmouseout="out('2273166757001165010');" style=""> 269             } catch (InterruptedException | ExecutionException e) {                                      </span>
<span class="-1683580236663429788" onmouseenter="enter('-1683580236663429788');" onmouseout="out('-1683580236663429788');" style=""> 270                 mCat.e(e);                                                                               </span>
<span  style=""> 271                                                                                                          </span>
<span class="6519543964694909858" onmouseenter="enter('6519543964694909858');" onmouseout="out('6519543964694909858');" style=""> 272                 if (job != null) {                                                                       </span>
<span class="-9041905225007822866" onmouseenter="enter('-9041905225007822866');" onmouseout="out('-9041905225007822866');" style=""> 273                     job.cancel();                                                                        </span>
<span class="3580809215980372017" onmouseenter="enter('3580809215980372017');" onmouseout="out('3580809215980372017');" style=""> 274                     mCat.e(&quot;Canceled %s&quot;, request);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275                 }                                                                                        </span>
<span  style=""> 276                                                                                                          </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 277                 return Job.Result.FAILURE;                                                               </span>
<span  style=""> 278                                                                                                          </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 279             } finally {                                                                                  </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 280                 if (!request.isPeriodic()) {                                                             </span>
<span class="1449747436325478708" onmouseenter="enter('1449747436325478708');" onmouseout="out('1449747436325478708');" style=""> 281                     mJobManager.getJobStorage().remove(request);                                         </span>
<span  style=""> 282                                                                                                          </span>
<span class="-2333237089390189385" onmouseenter="enter('-2333237089390189385');" onmouseout="out('-2333237089390189385');" style=""> 283                 } else if (request.isFlexSupport()) {                                                    </span>
<span class="733386345181994468" onmouseenter="enter('733386345181994468');" onmouseout="out('733386345181994468');" style=""><abbr title=" 284                     mJobManager.getJobStorage().remove(request); // remove, we store the new job in JobManager.schedule()"> 284                     mJobManager.getJobStorage().remove(request); // remove, we store the new job in JobMa🔵</abbr></span>
<span class="2102053740633122535" onmouseenter="enter('2102053740633122535');" onmouseout="out('2102053740633122535');" style=""> 285                     request.reschedule(false, false);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288         }                                                                                                </span>
<span  style=""> 289                                                                                                          </span>
<span class="-3194552414098127961" onmouseenter="enter('-3194552414098127961');" onmouseout="out('-3194552414098127961');" style=""> 290         private void cleanUpOrphanedJob(boolean cleanUp) {                                               </span>
<span class="8101282554241671494" onmouseenter="enter('8101282554241671494');" onmouseout="out('8101282554241671494');" style=""> 291             if (cleanUp) {                                                                               </span>
<span class="6651175145696850096" onmouseenter="enter('6651175145696850096');" onmouseout="out('6651175145696850096');" style=""> 292                 cleanUpOrphanedJob(mContext, mJobId);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294         }                                                                                                </span>
<span  style=""> 295                                                                                                          </span>
<span class="-4527238056439721160" onmouseenter="enter('-4527238056439721160');" onmouseout="out('-4527238056439721160');" style=""> 296         /*package*/ static void cleanUpOrphanedJob(Context context, int jobId) {                         </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 297             /*                                                                                           </span>
<span class="4873467377157825728" onmouseenter="enter('4873467377157825728');" onmouseout="out('4873467377157825728');" style=""><abbr title=" 298              * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are still around."> 298              * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are st🔵</abbr></span>
<span class="7880315656890986822" onmouseenter="enter('7880315656890986822');" onmouseout="out('7880315656890986822');" style=""><abbr title=" 299              * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the old one. Here"> 299              * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the old🔵</abbr></span>
<span class="7642695698821586509" onmouseenter="enter('7642695698821586509');" onmouseout="out('7642695698821586509');" style=""> 300              * we make sure, that no job is left in the system.                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 301              */                                                                                          </span>
<span class="-1280302924927314158" onmouseenter="enter('-1280302924927314158');" onmouseout="out('-1280302924927314158');" style=""> 302             for (JobApi jobApi : JobApi.values()) {                                                      </span>
<span class="-5474372138432799739" onmouseenter="enter('-5474372138432799739');" onmouseout="out('-5474372138432799739');" style=""> 303                 if (jobApi.isSupported(context)) {                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 304                     try {                                                                                </span>
<span class="4287784381767543802" onmouseenter="enter('4287784381767543802');" onmouseout="out('4287784381767543802');" style=""> 305                         jobApi.getProxy(context).cancel(jobId);                                          </span>
<span class="8538742657781196138" onmouseenter="enter('8538742657781196138');" onmouseout="out('8538742657781196138');" style=""> 306                     } catch (Exception ignored) {                                                        </span>
<span class="-571140832119819901" onmouseenter="enter('-571140832119819901');" onmouseout="out('-571140832119819901');" style=""><abbr title=" 307                         // GCM API could crash if it&#x27;s disabled, ignore crashes at this point and continue"> 307                         // GCM API could crash if it&#x27;s disabled, ignore crashes at this point and continu🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 310             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311         }                                                                                                </span>
<span  style=""> 312                                                                                                          </span>
<span class="5053639476535817445" onmouseenter="enter('5053639476535817445');" onmouseout="out('5053639476535817445');" style=""> 313         public static ComponentName startWakefulService(Context context, Intent intent) {                </span>
<span class="-2841441978426476425" onmouseenter="enter('-2841441978426476425');" onmouseout="out('-2841441978426476425');" style=""> 314             return WakeLockUtil.startWakefulService(context, intent);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315         }                                                                                                </span>
<span  style=""> 316                                                                                                          </span>
<span class="-5135813554980344335" onmouseenter="enter('-5135813554980344335');" onmouseout="out('-5135813554980344335');" style=""> 317         public static boolean completeWakefulIntent(Intent intent) {                                     </span>
<span class="-1383746570627903167" onmouseenter="enter('-1383746570627903167');" onmouseout="out('-1383746570627903167');" style=""> 318             return WakeLockUtil.completeWakefulIntent(intent);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-8822900351790619766" onmouseenter="enter('-8822900351790619766');" onmouseout="out('-8822900351790619766');" style="">   2  * Copyright 2007-present Evernote Corporation.                                                          </span>
<span class="-2278367542838177584" onmouseenter="enter('-2278367542838177584');" onmouseout="out('-2278367542838177584');" style="">   3  * All rights reserved.                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   4  *                                                                                                       </span>
<span class="181301442133285836" onmouseenter="enter('181301442133285836');" onmouseout="out('181301442133285836');" style="">   5  * Redistribution and use in source and binary forms, with or without modification,                      </span>
<span class="-5073197948967426970" onmouseenter="enter('-5073197948967426970');" onmouseout="out('-5073197948967426970');" style="">   6  * are permitted provided that the following conditions are met:                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="8127251449117563942" onmouseenter="enter('8127251449117563942');" onmouseout="out('8127251449117563942');" style="">   8  * 1. Redistributions of source code must retain the above copyright notice, this                        </span>
<span class="-1473911044945790828" onmouseenter="enter('-1473911044945790828');" onmouseout="out('-1473911044945790828');" style="">   9  *    list of conditions and the following disclaimer.                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  10  *                                                                                                       </span>
<span class="4835137028529553232" onmouseenter="enter('4835137028529553232');" onmouseout="out('4835137028529553232');" style="">  11  * 2. Redistributions in binary form must reproduce the above copyright notice,                          </span>
<span class="-1312443230807442131" onmouseenter="enter('-1312443230807442131');" onmouseout="out('-1312443230807442131');" style="">  12  *    this list of conditions and the following disclaimer in the documentation                          </span>
<span class="-2067912076149043179" onmouseenter="enter('-2067912076149043179');" onmouseout="out('-2067912076149043179');" style="">  13  *    and/or other materials provided with the distribution.                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  14  *                                                                                                       </span>
<span class="-7721941782677048447" onmouseenter="enter('-7721941782677048447');" onmouseout="out('-7721941782677048447');" style="">  15  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND                       </span>
<span class="-5124048439450882348" onmouseenter="enter('-5124048439450882348');" onmouseout="out('-5124048439450882348');" style="">  16  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED                         </span>
<span class="2277289959795125050" onmouseenter="enter('2277289959795125050');" onmouseout="out('2277289959795125050');" style="">  17  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.                    </span>
<span class="4422846307625339339" onmouseenter="enter('4422846307625339339');" onmouseout="out('4422846307625339339');" style="">  18  * IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,                       </span>
<span class="9023453646714579255" onmouseenter="enter('9023453646714579255');" onmouseout="out('9023453646714579255');" style="">  19  * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,                        </span>
<span class="2153827234735713132" onmouseenter="enter('2153827234735713132');" onmouseout="out('2153827234735713132');" style="">  20  * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,                         </span>
<span class="5782830561991082866" onmouseenter="enter('5782830561991082866');" onmouseout="out('5782830561991082866');" style="">  21  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF                       </span>
<span class="-2513683953102966204" onmouseenter="enter('-2513683953102966204');" onmouseout="out('-2513683953102966204');" style="">  22  * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE                       </span>
<span class="-6562574984275957691" onmouseenter="enter('-6562574984275957691');" onmouseout="out('-6562574984275957691');" style="">  23  * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF                             </span>
<span class="505998933154990042" onmouseenter="enter('505998933154990042');" onmouseout="out('505998933154990042');" style="">  24  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  25  */                                                                                                      </span>
<span class="4675552543740820910" onmouseenter="enter('4675552543740820910');" onmouseout="out('4675552543740820910');" style="">  26 package com.evernote.android.job;                                                                        </span>
<span  style="">  27                                                                                                          </span>
<span class="-1261404242645970098" onmouseenter="enter('-1261404242645970098');" onmouseout="out('-1261404242645970098');" style="">  28 import android.app.Service;                                                                              </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  29 import android.content.ComponentName;                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  30 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  31 import android.content.Intent;                                                                           </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  32 import android.os.Bundle;                                                                                </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="">  33 import android.os.Looper;                                                                                </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  34 import android.support.annotation.NonNull;                                                               </span>
<span class="4394652512097310678" onmouseenter="enter('4394652512097310678');" onmouseout="out('4394652512097310678');" style="">  35 import android.support.annotation.Nullable;                                                              </span>
<span  style="">  36                                                                                                          </span>
<span class="2270421051523495577" onmouseenter="enter('2270421051523495577');" onmouseout="out('2270421051523495577');" style="">  37 import com.evernote.android.job.util.JobUtil;                                                            </span>
<span  style="">  38                                                                                                          </span>
<span class="4887698622156748971" onmouseenter="enter('4887698622156748971');" onmouseout="out('4887698622156748971');" style="">  39 import net.vrallev.android.cat.CatLog;                                                                   </span>
<span  style="">  40                                                                                                          </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="">  41 import java.util.Locale;                                                                                 </span>
<span class="6613496282884511495" onmouseenter="enter('6613496282884511495');" onmouseout="out('6613496282884511495');" style="">  42 import java.util.concurrent.ExecutionException;                                                          </span>
<span class="-331778695229620376" onmouseenter="enter('-331778695229620376');" onmouseout="out('-331778695229620376');" style="">  43 import java.util.concurrent.Future;                                                                      </span>
<span class="1867212591271003466" onmouseenter="enter('1867212591271003466');" onmouseout="out('1867212591271003466');" style="">  44 import java.util.concurrent.ThreadFactory;                                                               </span>
<span class="7979168040994256185" onmouseenter="enter('7979168040994256185');" onmouseout="out('7979168040994256185');" style="">  45 import java.util.concurrent.atomic.AtomicInteger;                                                        </span>
<span  style="">  46                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  47 /**                                                                                                      </span>
<span class="-126646863796949621" onmouseenter="enter('-126646863796949621');" onmouseout="out('-126646863796949621');" style="">  48  * A proxy for each {@link JobApi}.                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  49  *                                                                                                       </span>
<span class="-2541210092808878866" onmouseenter="enter('-2541210092808878866');" onmouseout="out('-2541210092808878866');" style="">  50  * @author rwondratschek                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  51  */                                                                                                      </span>
<span class="1140466455373644171" onmouseenter="enter('1140466455373644171');" onmouseout="out('1140466455373644171');" style="">  52 public interface JobProxy {                                                                              </span>
<span  style="">  53                                                                                                          </span>
<span class="-8144897713900189970" onmouseenter="enter('-8144897713900189970');" onmouseout="out('-8144897713900189970');" style="">  54     void plantOneOff(JobRequest request);                                                                </span>
<span  style="">  55                                                                                                          </span>
<span class="-2416890449051145953" onmouseenter="enter('-2416890449051145953');" onmouseout="out('-2416890449051145953');" style="">  56     void plantPeriodic(JobRequest request);                                                              </span>
<span  style="">  57                                                                                                          </span>
<span class="6309911337945331379" onmouseenter="enter('6309911337945331379');" onmouseout="out('6309911337945331379');" style="">  58     void plantPeriodicFlexSupport(JobRequest request);                                                   </span>
<span  style="">  59                                                                                                          </span>
<span class="8340124833639515371" onmouseenter="enter('8340124833639515371');" onmouseout="out('8340124833639515371');" style="">  60     void cancel(int jobId);                                                                              </span>
<span  style="">  61                                                                                                          </span>
<span class="-6161809553933645851" onmouseenter="enter('-6161809553933645851');" onmouseout="out('-6161809553933645851');" style="">  62     boolean isPlatformJobScheduled(JobRequest request);                                                  </span>
<span  style="">  63                                                                                                          </span>
<span class="5106484226992372263" onmouseenter="enter('5106484226992372263');" onmouseout="out('5106484226992372263');" style="">  64     @SuppressWarnings(&quot;UnusedReturnValue&quot;)                                                               </span>
<span class="1769639894748899311" onmouseenter="enter('1769639894748899311');" onmouseout="out('1769639894748899311');" style="">  65     /*package*/ final class Common {                                                                     </span>
<span  style="">  66                                                                                                          </span>
<span class="-7267523611033686156" onmouseenter="enter('-7267523611033686156');" onmouseout="out('-7267523611033686156');" style="">  67         private static final Object COMMON_MONITOR = new Object();                                       </span>
<span  style="">  68                                                                                                          </span>
<span class="142194204239450957" onmouseenter="enter('142194204239450957');" onmouseout="out('142194204239450957');" style="">  69         public static final ThreadFactory COMMON_THREAD_FACTORY = new ThreadFactory() {                  </span>
<span  style="">  70                                                                                                          </span>
<span class="8379292492229673398" onmouseenter="enter('8379292492229673398');" onmouseout="out('8379292492229673398');" style="">  71             private final AtomicInteger mThreadNumber = new AtomicInteger();                             </span>
<span  style="">  72                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  73             @Override                                                                                    </span>
<span class="-5634161788732062937" onmouseenter="enter('-5634161788732062937');" onmouseout="out('-5634161788732062937');" style="">  74             public Thread newThread(@NonNull Runnable r) {                                               </span>
<span class="-2238610439465529740" onmouseenter="enter('-2238610439465529740');" onmouseout="out('-2238610439465529740');" style="">  75                 Thread thread = new Thread(r, &quot;AndroidJob-&quot; + mThreadNumber.incrementAndGet());          </span>
<span class="-2780159030059633262" onmouseenter="enter('-2780159030059633262');" onmouseout="out('-2780159030059633262');" style="">  76                 if (thread.isDaemon()) {                                                                 </span>
<span class="-6985289869807539393" onmouseenter="enter('-6985289869807539393');" onmouseout="out('-6985289869807539393');" style="">  77                     thread.setDaemon(false);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78                 }                                                                                        </span>
<span class="3121234640013807968" onmouseenter="enter('3121234640013807968');" onmouseout="out('3121234640013807968');" style="">  79                 if (thread.getPriority() != Thread.NORM_PRIORITY) {                                      </span>
<span class="3041005067018043930" onmouseenter="enter('3041005067018043930');" onmouseout="out('3041005067018043930');" style="">  80                     thread.setPriority(Thread.NORM_PRIORITY);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  81                 }                                                                                        </span>
<span class="3079099442831550764" onmouseenter="enter('3079099442831550764');" onmouseout="out('3079099442831550764');" style="">  82                 return thread;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  83             }                                                                                            </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style="">  84         };                                                                                               </span>
<span  style="">  85                                                                                                          </span>
<span class="8412616957402907467" onmouseenter="enter('8412616957402907467');" onmouseout="out('8412616957402907467');" style=""><abbr title="  86         // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/math/LongMath.java">  86         // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/math🔵</abbr></span>
<span class="-1572685421845796133" onmouseenter="enter('-1572685421845796133');" onmouseout="out('-1572685421845796133');" style="">  87         private static long checkedAdd(long a, long b) {                                                 </span>
<span class="-1527942472133998342" onmouseenter="enter('-1527942472133998342');" onmouseout="out('-1527942472133998342');" style="">  88             long result = a + b;                                                                         </span>
<span class="-8281399218677613001" onmouseenter="enter('-8281399218677613001');" onmouseout="out('-8281399218677613001');" style="">  89             return checkNoOverflow(result, (a ^ b) &lt; 0 | (a ^ result) &gt;= 0);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90         }                                                                                                </span>
<span  style="">  91                                                                                                          </span>
<span class="6423040751114649745" onmouseenter="enter('6423040751114649745');" onmouseout="out('6423040751114649745');" style="">  92         private static long checkNoOverflow(long result, boolean condition) {                            </span>
<span class="6603368327369456734" onmouseenter="enter('6603368327369456734');" onmouseout="out('6603368327369456734');" style="">  93             return condition ? result : Long.MAX_VALUE;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  94         }                                                                                                </span>
<span  style="">  95                                                                                                          </span>
<span class="1406832824568924523" onmouseenter="enter('1406832824568924523');" onmouseout="out('1406832824568924523');" style="">  96         public static long getStartMs(JobRequest request) {                                              </span>
<span class="-6205484021482461183" onmouseenter="enter('-6205484021482461183');" onmouseout="out('-6205484021482461183');" style="">  97             if (request.getFailureCount() &gt; 0) {                                                         </span>
<span class="9206292300770255130" onmouseenter="enter('9206292300770255130');" onmouseout="out('9206292300770255130');" style="">  98                 return request.getBackoffOffset();                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  99             } else {                                                                                     </span>
<span class="-8332790610925894090" onmouseenter="enter('-8332790610925894090');" onmouseout="out('-8332790610925894090');" style=""> 100                 return request.getStartMs();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102         }                                                                                                </span>
<span  style=""> 103                                                                                                          </span>
<span class="-3832824197988283345" onmouseenter="enter('-3832824197988283345');" onmouseout="out('-3832824197988283345');" style=""> 104         public static long getEndMs(JobRequest request) {                                                </span>
<span class="-6205484021482461183" onmouseenter="enter('-6205484021482461183');" onmouseout="out('-6205484021482461183');" style=""> 105             if (request.getFailureCount() &gt; 0) {                                                         </span>
<span class="9206292300770255130" onmouseenter="enter('9206292300770255130');" onmouseout="out('9206292300770255130');" style=""> 106                 return request.getBackoffOffset();                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 107             } else {                                                                                     </span>
<span class="3799819942554251441" onmouseenter="enter('3799819942554251441');" onmouseout="out('3799819942554251441');" style=""> 108                 return request.getEndMs();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 109             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110         }                                                                                                </span>
<span  style=""> 111                                                                                                          </span>
<span class="2658461420075954163" onmouseenter="enter('2658461420075954163');" onmouseout="out('2658461420075954163');" style=""> 112         public static long getAverageDelayMs(JobRequest request) {                                       </span>
<span class="5188333912507681776" onmouseenter="enter('5188333912507681776');" onmouseout="out('5188333912507681776');" style=""> 113             return checkedAdd(getStartMs(request), (getEndMs(request) - getStartMs(request)) / 2);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114         }                                                                                                </span>
<span  style=""> 115                                                                                                          </span>
<span class="-8453711403554538500" onmouseenter="enter('-8453711403554538500');" onmouseout="out('-8453711403554538500');" style=""> 116         public static long getStartMsSupportFlex(JobRequest request) {                                   </span>
<span class="4867134151855536256" onmouseenter="enter('4867134151855536256');" onmouseout="out('4867134151855536256');" style=""> 117             return Math.max(1, request.getIntervalMs() - request.getFlexMs());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118         }                                                                                                </span>
<span  style=""> 119                                                                                                          </span>
<span class="2402850512558550424" onmouseenter="enter('2402850512558550424');" onmouseout="out('2402850512558550424');" style=""> 120         public static long getEndMsSupportFlex(JobRequest request) {                                     </span>
<span class="1818143853198758132" onmouseenter="enter('1818143853198758132');" onmouseout="out('1818143853198758132');" style=""> 121             return request.getIntervalMs();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 122         }                                                                                                </span>
<span  style=""> 123                                                                                                          </span>
<span class="5236833657260895409" onmouseenter="enter('5236833657260895409');" onmouseout="out('5236833657260895409');" style=""> 124         public static long getAverageDelayMsSupportFlex(JobRequest request) {                            </span>
<span class="1202002964551881523" onmouseenter="enter('1202002964551881523');" onmouseout="out('1202002964551881523');" style=""><abbr title=" 125             return checkedAdd(getStartMsSupportFlex(request), (getEndMsSupportFlex(request) - getStartMsSupportFlex(request)) / 2);"> 125             return checkedAdd(getStartMsSupportFlex(request), (getEndMsSupportFlex(request) - getStartMsS🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126         }                                                                                                </span>
<span  style=""> 127                                                                                                          </span>
<span class="5683661540559112003" onmouseenter="enter('5683661540559112003');" onmouseout="out('5683661540559112003');" style=""> 128         public static int getRescheduleCount(JobRequest request) {                                       </span>
<span class="6823077784476657246" onmouseenter="enter('6823077784476657246');" onmouseout="out('6823077784476657246');" style=""> 129             return request.getFailureCount();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 130         }                                                                                                </span>
<span  style=""> 131                                                                                                          </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style=""> 132         private final Context mContext;                                                                  </span>
<span class="3051386596282037072" onmouseenter="enter('3051386596282037072');" onmouseout="out('3051386596282037072');" style=""> 133         private final int mJobId;                                                                        </span>
<span class="6179859670209082226" onmouseenter="enter('6179859670209082226');" onmouseout="out('6179859670209082226');" style=""> 134         private final CatLog mCat;                                                                       </span>
<span  style=""> 135                                                                                                          </span>
<span class="5239517905467210385" onmouseenter="enter('5239517905467210385');" onmouseout="out('5239517905467210385');" style=""> 136         private final JobManager mJobManager;                                                            </span>
<span  style=""> 137                                                                                                          </span>
<span class="-8396683440428310884" onmouseenter="enter('-8396683440428310884');" onmouseout="out('-8396683440428310884');" style=""> 138         public Common(@NonNull Service service, CatLog cat, int jobId) {                                 </span>
<span class="-373217571160035833" onmouseenter="enter('-373217571160035833');" onmouseout="out('-373217571160035833');" style=""> 139             this((Context) service, cat, jobId);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140         }                                                                                                </span>
<span  style=""> 141                                                                                                          </span>
<span class="-8666365961470977949" onmouseenter="enter('-8666365961470977949');" onmouseout="out('-8666365961470977949');" style=""> 142         /*package*/ Common(@NonNull Context context, CatLog cat, int jobId) {                            </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 143             mContext = context;                                                                          </span>
<span class="3380959276812020408" onmouseenter="enter('3380959276812020408');" onmouseout="out('3380959276812020408');" style=""> 144             mJobId = jobId;                                                                              </span>
<span class="-7514169524268117475" onmouseenter="enter('-7514169524268117475');" onmouseout="out('-7514169524268117475');" style=""> 145             mCat = cat;                                                                                  </span>
<span  style=""> 146                                                                                                          </span>
<span class="2088134523180067307" onmouseenter="enter('2088134523180067307');" onmouseout="out('2088134523180067307');" style=""> 147             mJobManager = JobManager.create(context);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148         }                                                                                                </span>
<span  style=""> 149                                                                                                          </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 150 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-4157356782926206773" onmouseenter="enter('-4157356782926206773');" onmouseout="out('-4157356782926206773');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 151 public JobRequest getPendingRequest(@SuppressWarnings(&quot;SameParameterValue&quot;) boolean cleanUpOrphanedJob) {</span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 152 ||||||| BASE                                                                                             </span>
<span class="-5511335237538855208" onmouseenter="enter('-5511335237538855208');" onmouseout="out('-5511335237538855208');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153 public JobRequest getPendingRequest(boolean cleanUpOrphanedJob) {                                        </span>
<span class="-1539078468410613703" onmouseenter="enter('-1539078468410613703');" onmouseout="out('-1539078468410613703');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154             // order is important for logging purposes                                                   </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 155 =======                                                                                                  </span>
<span class="-3925023906723607869" onmouseenter="enter('-3925023906723607869');" onmouseout="out('-3925023906723607869');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156 public JobRequest getPendingRequest(boolean cleanUpOrphanedJob, boolean markStarting) {                  </span>
<span class="357065027804466477" onmouseenter="enter('357065027804466477');" onmouseout="out('357065027804466477');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157             synchronized (COMMON_MONITOR) {                                                              </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 158 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-1539078468410613703" onmouseenter="enter('-1539078468410613703');" onmouseout="out('-1539078468410613703');" style=""> 159             // order is important for logging purposes                                                   </span>
<span class="6754931577315038874" onmouseenter="enter('6754931577315038874');" onmouseout="out('6754931577315038874');" style=""> 160             JobRequest request = mJobManager.getJobRequest(mJobId, true);                                </span>
<span class="-4807858926389575759" onmouseenter="enter('-4807858926389575759');" onmouseout="out('-4807858926389575759');" style=""> 161             Job job = mJobManager.getJob(mJobId);                                                        </span>
<span class="80157358755741526" onmouseenter="enter('80157358755741526');" onmouseout="out('80157358755741526');" style=""> 162             boolean periodic = request != null &amp;&amp; request.isPeriodic();                                  </span>
<span  style=""> 163                                                                                                          </span>
<span class="1317679291661326604" onmouseenter="enter('1317679291661326604');" onmouseout="out('1317679291661326604');" style=""> 164             if (job != null &amp;&amp; !job.isFinished()) {                                                      </span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style=""><abbr title=" 165                 // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 165                 // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobschedule🔵</abbr></span>
<span class="-5462975656818636592" onmouseenter="enter('-5462975656818636592');" onmouseout="out('-5462975656818636592');" style=""> 166                 mCat.d(&quot;Job %d is already running, %s&quot;, mJobId, request);                                </span>
<span class="-8865814855968501379" onmouseenter="enter('-8865814855968501379');" onmouseout="out('-8865814855968501379');" style=""> 167                 // not necessary to clean up, the running instance will do that                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 168                 return null;                                                                             </span>
<span  style=""> 169                                                                                                          </span>
<span class="-4007651353712364444" onmouseenter="enter('-4007651353712364444');" onmouseout="out('-4007651353712364444');" style=""> 170             } else if (job != null &amp;&amp; !periodic) {                                                       </span>
<span class="599327769680236656" onmouseenter="enter('599327769680236656');" onmouseout="out('599327769680236656');" style=""> 171                 mCat.d(&quot;Job %d already finished, %s&quot;, mJobId, request);                                  </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style=""> 172                 cleanUpOrphanedJob(cleanUpOrphanedJob);                                                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 173                 return null;                                                                             </span>
<span  style=""> 174                                                                                                          </span>
<span class="-4441559070839346687" onmouseenter="enter('-4441559070839346687');" onmouseout="out('-4441559070839346687');" style=""> 175             } else if (job != null &amp;&amp; System.currentTimeMillis() - job.getFinishedTimeStamp() &lt; 2_000) { </span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style=""><abbr title=" 176                 // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 176                 // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobschedule🔵</abbr></span>
<span class="-2963240540698415567" onmouseenter="enter('-2963240540698415567');" onmouseout="out('-2963240540698415567');" style=""> 177                 mCat.d(&quot;Job %d is periodic and just finished, %s&quot;, mJobId, request);                     </span>
<span class="5118828189189336116" onmouseenter="enter('5118828189189336116');" onmouseout="out('5118828189189336116');" style=""> 178                 // don&#x27;t clean up, periodic job                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 179                 return null;                                                                             </span>
<span  style=""> 180                                                                                                          </span>
<span class="-4719477180175309163" onmouseenter="enter('-4719477180175309163');" onmouseout="out('-4719477180175309163');" style=""> 181             } else if (request != null &amp;&amp; request.isStarted()) {                                         </span>
<span class="2694894942883236024" onmouseenter="enter('2694894942883236024');" onmouseout="out('2694894942883236024');" style=""> 182                 mCat.d(&quot;Request %d already started, %s&quot;, mJobId, request);                               </span>
<span class="3715771020426903748" onmouseenter="enter('3715771020426903748');" onmouseout="out('3715771020426903748');" style=""> 183                 // not necessary to clean up, the JobManager will do this for started jobs               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 184                 return null;                                                                             </span>
<span  style=""> 185                                                                                                          </span>
<span class="-8745598640251884545" onmouseenter="enter('-8745598640251884545');" onmouseout="out('-8745598640251884545');" style=""> 186                 } else if (request != null &amp;&amp; mJobManager.getJobExecutor().isRequestStarting(request)) { </span>
<span class="3441384320730940166" onmouseenter="enter('3441384320730940166');" onmouseout="out('3441384320730940166');" style=""> 187                     mCat.d(&quot;Request %d is in the queue to start, %s&quot;, mJobId, request);                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 188                     return null;                                                                         </span>
<span  style=""> 189                                                                                                          </span>
<span class="-4428555773566380837" onmouseenter="enter('-4428555773566380837');" onmouseout="out('-4428555773566380837');" style=""> 190             } else if (request == null) {                                                                </span>
<span class="7609103357697598215" onmouseenter="enter('7609103357697598215');" onmouseout="out('7609103357697598215');" style=""> 191                 mCat.d(&quot;Request for ID %d was null&quot;, mJobId);                                            </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style=""> 192                 cleanUpOrphanedJob(cleanUpOrphanedJob);                                                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 193                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194             }                                                                                            </span>
<span  style=""> 195                                                                                                          </span>
<span class="8480325012103084437" onmouseenter="enter('8480325012103084437');" onmouseout="out('8480325012103084437');" style=""> 196                 if (markStarting) {                                                                      </span>
<span class="8387569989042798053" onmouseenter="enter('8387569989042798053');" onmouseout="out('8387569989042798053');" style=""> 197                     mJobManager.getJobExecutor().markJobRequestStarting(request);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198                 }                                                                                        </span>
<span  style=""> 199                                                                                                          </span>
<span class="-1057636993633179522" onmouseenter="enter('-1057636993633179522');" onmouseout="out('-1057636993633179522');" style=""> 200             return request;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202         }                                                                                                </span>
<span  style=""> 203                                                                                                          </span>
<span class="5154748246392482767" onmouseenter="enter('5154748246392482767');" onmouseout="out('5154748246392482767');" style=""> 204         @NonNull                                                                                         </span>
<span class="4426606055051844156" onmouseenter="enter('4426606055051844156');" onmouseout="out('4426606055051844156');" style=""><abbr title=" 205         public Job.Result executeJobRequest(@NonNull JobRequest request, @Nullable Bundle transientExtras) {"> 205         public Job.Result executeJobRequest(@NonNull JobRequest request, @Nullable Bundle transientExtras🔵</abbr></span>
<span class="8785519441075077783" onmouseenter="enter('8785519441075077783');" onmouseout="out('8785519441075077783');" style=""> 206             long waited = System.currentTimeMillis() - request.getScheduledAt();                         </span>
<span class="-521988911558271196" onmouseenter="enter('-521988911558271196');" onmouseout="out('-521988911558271196');" style=""> 207             String timeWindow;                                                                           </span>
<span class="-4749167882947985624" onmouseenter="enter('-4749167882947985624');" onmouseout="out('-4749167882947985624');" style=""> 208             if (request.isPeriodic()) {                                                                  </span>
<span class="22254303833830880" onmouseenter="enter('22254303833830880');" onmouseout="out('22254303833830880');" style=""><abbr title=" 209                 timeWindow = String.format(Locale.US, &quot;interval %s, flex %s&quot;, JobUtil.timeToString(request.getIntervalMs()),"> 209                 timeWindow = String.format(Locale.US, &quot;interval %s, flex %s&quot;, JobUtil.timeToString(reques🔵</abbr></span>
<span class="-7441385486773924310" onmouseenter="enter('-7441385486773924310');" onmouseout="out('-7441385486773924310');" style=""> 210                         JobUtil.timeToString(request.getFlexMs()));                                      </span>
<span class="4779514256224206313" onmouseenter="enter('4779514256224206313');" onmouseout="out('4779514256224206313');" style=""> 211             } else if (request.getJobApi().supportsExecutionWindow()) {                                  </span>
<span class="-6246254348184491385" onmouseenter="enter('-6246254348184491385');" onmouseout="out('-6246254348184491385');" style=""><abbr title=" 212                 timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMs(request)),"> 212                 timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMs🔵</abbr></span>
<span class="6965396589660564452" onmouseenter="enter('6965396589660564452');" onmouseout="out('6965396589660564452');" style=""> 213                         JobUtil.timeToString(getEndMs(request)));                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 214             } else {                                                                                     </span>
<span class="-1520611369215068334" onmouseenter="enter('-1520611369215068334');" onmouseout="out('-1520611369215068334');" style=""> 215                 timeWindow = &quot;delay &quot; + JobUtil.timeToString(getAverageDelayMs(request));                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216             }                                                                                            </span>
<span  style=""> 217                                                                                                          </span>
<span class="-8808967967811702611" onmouseenter="enter('-8808967967811702611');" onmouseout="out('-8808967967811702611');" style=""> 218             if (Looper.myLooper() == Looper.getMainLooper()) {                                           </span>
<span class="-1368751502622418275" onmouseenter="enter('-1368751502622418275');" onmouseout="out('-1368751502622418275');" style=""><abbr title=" 219                 mCat.w(&quot;Running JobRequest on a main thread, this could cause stutter or ANR in your app.&quot;);"> 219                 mCat.w(&quot;Running JobRequest on a main thread, this could cause stutter or ANR in your app.🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220             }                                                                                            </span>
<span  style=""> 221                                                                                                          </span>
<span class="-1843046913616870974" onmouseenter="enter('-1843046913616870974');" onmouseout="out('-1843046913616870974');" style=""> 222             mCat.d(&quot;Run job, %s, waited %s, %s&quot;, request, JobUtil.timeToString(waited), timeWindow);     </span>
<span class="-4828048199353050218" onmouseenter="enter('-4828048199353050218');" onmouseout="out('-4828048199353050218');" style=""> 223             JobExecutor jobExecutor = mJobManager.getJobExecutor();                                      </span>
<span class="-1235692988875235782" onmouseenter="enter('-1235692988875235782');" onmouseout="out('-1235692988875235782');" style=""> 224             Job job = null;                                                                              </span>
<span  style=""> 225                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 226             try {                                                                                        </span>
<span class="-4769195842780086458" onmouseenter="enter('-4769195842780086458');" onmouseout="out('-4769195842780086458');" style=""><abbr title=" 227                 // create job first before setting it started, avoids a race condition while rescheduling jobs"> 227                 // create job first before setting it started, avoids a race condition while rescheduling🔵</abbr></span>
<span class="1625132338136195706" onmouseenter="enter('1625132338136195706');" onmouseout="out('1625132338136195706');" style=""> 228                 job = mJobManager.getJobCreatorHolder().createJob(request.getTag());                     </span>
<span  style=""> 229                                                                                                          </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 230                 if (!request.isPeriodic()) {                                                             </span>
<span class="4919726022962249182" onmouseenter="enter('4919726022962249182');" onmouseout="out('4919726022962249182');" style=""> 231                     request.setStarted(true);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232                 }                                                                                        </span>
<span  style=""> 233                                                                                                          </span>
<span class="-7821317659145756468" onmouseenter="enter('-7821317659145756468');" onmouseout="out('-7821317659145756468');" style=""> 234                 if (transientExtras == null) {                                                           </span>
<span class="-387255381167201921" onmouseenter="enter('-387255381167201921');" onmouseout="out('-387255381167201921');" style=""> 235                     transientExtras = Bundle.EMPTY;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236                 }                                                                                        </span>
<span  style=""> 237                                                                                                          </span>
<span class="8687421104735025391" onmouseenter="enter('8687421104735025391');" onmouseout="out('8687421104735025391');" style=""> 238                 Future&lt;Job.Result&gt; future = jobExecutor.execute(mContext, request, job, transientExtras);</span>
<span class="-4410702629486134619" onmouseenter="enter('-4410702629486134619');" onmouseout="out('-4410702629486134619');" style=""> 239                 if (future == null) {                                                                    </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 240                     return Job.Result.FAILURE;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241                 }                                                                                        </span>
<span  style=""> 242                                                                                                          </span>
<span class="5244342940061655384" onmouseenter="enter('5244342940061655384');" onmouseout="out('5244342940061655384');" style=""> 243                 // wait until done                                                                       </span>
<span class="-4728317628971455727" onmouseenter="enter('-4728317628971455727');" onmouseout="out('-4728317628971455727');" style=""> 244                 Job.Result result = future.get();                                                        </span>
<span class="368857225067072174" onmouseenter="enter('368857225067072174');" onmouseout="out('368857225067072174');" style=""> 245                 mCat.d(&quot;Finished job, %s %s&quot;, request, result);                                          </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 246                 return result;                                                                           </span>
<span  style=""> 247                                                                                                          </span>
<span class="2273166757001165010" onmouseenter="enter('2273166757001165010');" onmouseout="out('2273166757001165010');" style=""> 248             } catch (InterruptedException | ExecutionException e) {                                      </span>
<span class="-1683580236663429788" onmouseenter="enter('-1683580236663429788');" onmouseout="out('-1683580236663429788');" style=""> 249                 mCat.e(e);                                                                               </span>
<span  style=""> 250                                                                                                          </span>
<span class="6519543964694909858" onmouseenter="enter('6519543964694909858');" onmouseout="out('6519543964694909858');" style=""> 251                 if (job != null) {                                                                       </span>
<span class="-9041905225007822866" onmouseenter="enter('-9041905225007822866');" onmouseout="out('-9041905225007822866');" style=""> 252                     job.cancel();                                                                        </span>
<span class="3580809215980372017" onmouseenter="enter('3580809215980372017');" onmouseout="out('3580809215980372017');" style=""> 253                     mCat.e(&quot;Canceled %s&quot;, request);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254                 }                                                                                        </span>
<span  style=""> 255                                                                                                          </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 256                 return Job.Result.FAILURE;                                                               </span>
<span  style=""> 257                                                                                                          </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 258             } finally {                                                                                  </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 259                 if (!request.isPeriodic()) {                                                             </span>
<span class="1449747436325478708" onmouseenter="enter('1449747436325478708');" onmouseout="out('1449747436325478708');" style=""> 260                     mJobManager.getJobStorage().remove(request);                                         </span>
<span  style=""> 261                                                                                                          </span>
<span class="-2333237089390189385" onmouseenter="enter('-2333237089390189385');" onmouseout="out('-2333237089390189385');" style=""> 262                 } else if (request.isFlexSupport()) {                                                    </span>
<span class="733386345181994468" onmouseenter="enter('733386345181994468');" onmouseout="out('733386345181994468');" style=""><abbr title=" 263                     mJobManager.getJobStorage().remove(request); // remove, we store the new job in JobManager.schedule()"> 263                     mJobManager.getJobStorage().remove(request); // remove, we store the new job in JobMa🔵</abbr></span>
<span class="2102053740633122535" onmouseenter="enter('2102053740633122535');" onmouseout="out('2102053740633122535');" style=""> 264                     request.reschedule(false, false);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267         }                                                                                                </span>
<span  style=""> 268                                                                                                          </span>
<span class="-3194552414098127961" onmouseenter="enter('-3194552414098127961');" onmouseout="out('-3194552414098127961');" style=""> 269         private void cleanUpOrphanedJob(boolean cleanUp) {                                               </span>
<span class="8101282554241671494" onmouseenter="enter('8101282554241671494');" onmouseout="out('8101282554241671494');" style=""> 270             if (cleanUp) {                                                                               </span>
<span class="6651175145696850096" onmouseenter="enter('6651175145696850096');" onmouseout="out('6651175145696850096');" style=""> 271                 cleanUpOrphanedJob(mContext, mJobId);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273         }                                                                                                </span>
<span  style=""> 274                                                                                                          </span>
<span class="-4527238056439721160" onmouseenter="enter('-4527238056439721160');" onmouseout="out('-4527238056439721160');" style=""> 275         /*package*/ static void cleanUpOrphanedJob(Context context, int jobId) {                         </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 276             /*                                                                                           </span>
<span class="4873467377157825728" onmouseenter="enter('4873467377157825728');" onmouseout="out('4873467377157825728');" style=""><abbr title=" 277              * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are still around."> 277              * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are st🔵</abbr></span>
<span class="7880315656890986822" onmouseenter="enter('7880315656890986822');" onmouseout="out('7880315656890986822');" style=""><abbr title=" 278              * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the old one. Here"> 278              * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the old🔵</abbr></span>
<span class="7642695698821586509" onmouseenter="enter('7642695698821586509');" onmouseout="out('7642695698821586509');" style=""> 279              * we make sure, that no job is left in the system.                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 280              */                                                                                          </span>
<span class="-1280302924927314158" onmouseenter="enter('-1280302924927314158');" onmouseout="out('-1280302924927314158');" style=""> 281             for (JobApi jobApi : JobApi.values()) {                                                      </span>
<span class="-5474372138432799739" onmouseenter="enter('-5474372138432799739');" onmouseout="out('-5474372138432799739');" style=""> 282                 if (jobApi.isSupported(context)) {                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 283                     try {                                                                                </span>
<span class="4287784381767543802" onmouseenter="enter('4287784381767543802');" onmouseout="out('4287784381767543802');" style=""> 284                         jobApi.getProxy(context).cancel(jobId);                                          </span>
<span class="8538742657781196138" onmouseenter="enter('8538742657781196138');" onmouseout="out('8538742657781196138');" style=""> 285                     } catch (Exception ignored) {                                                        </span>
<span class="-571140832119819901" onmouseenter="enter('-571140832119819901');" onmouseout="out('-571140832119819901');" style=""><abbr title=" 286                         // GCM API could crash if it&#x27;s disabled, ignore crashes at this point and continue"> 286                         // GCM API could crash if it&#x27;s disabled, ignore crashes at this point and continu🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290         }                                                                                                </span>
<span  style=""> 291                                                                                                          </span>
<span class="5053639476535817445" onmouseenter="enter('5053639476535817445');" onmouseout="out('5053639476535817445');" style=""> 292         public static ComponentName startWakefulService(Context context, Intent intent) {                </span>
<span class="-2841441978426476425" onmouseenter="enter('-2841441978426476425');" onmouseout="out('-2841441978426476425');" style=""> 293             return WakeLockUtil.startWakefulService(context, intent);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294         }                                                                                                </span>
<span  style=""> 295                                                                                                          </span>
<span class="-5135813554980344335" onmouseenter="enter('-5135813554980344335');" onmouseout="out('-5135813554980344335');" style=""> 296         public static boolean completeWakefulIntent(Intent intent) {                                     </span>
<span class="-1383746570627903167" onmouseenter="enter('-1383746570627903167');" onmouseout="out('-1383746570627903167');" style=""> 297             return WakeLockUtil.completeWakefulIntent(intent);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300 }                                                                                                        </span>



















</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-8822900351790619766" onmouseenter="enter('-8822900351790619766');" onmouseout="out('-8822900351790619766');" style="">   2  * Copyright 2007-present Evernote Corporation.                                                          </span>
<span class="-2278367542838177584" onmouseenter="enter('-2278367542838177584');" onmouseout="out('-2278367542838177584');" style="">   3  * All rights reserved.                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   4  *                                                                                                       </span>
<span class="181301442133285836" onmouseenter="enter('181301442133285836');" onmouseout="out('181301442133285836');" style="">   5  * Redistribution and use in source and binary forms, with or without modification,                      </span>
<span class="-5073197948967426970" onmouseenter="enter('-5073197948967426970');" onmouseout="out('-5073197948967426970');" style="">   6  * are permitted provided that the following conditions are met:                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="8127251449117563942" onmouseenter="enter('8127251449117563942');" onmouseout="out('8127251449117563942');" style="">   8  * 1. Redistributions of source code must retain the above copyright notice, this                        </span>
<span class="-1473911044945790828" onmouseenter="enter('-1473911044945790828');" onmouseout="out('-1473911044945790828');" style="">   9  *    list of conditions and the following disclaimer.                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  10  *                                                                                                       </span>
<span class="4835137028529553232" onmouseenter="enter('4835137028529553232');" onmouseout="out('4835137028529553232');" style="">  11  * 2. Redistributions in binary form must reproduce the above copyright notice,                          </span>
<span class="-1312443230807442131" onmouseenter="enter('-1312443230807442131');" onmouseout="out('-1312443230807442131');" style="">  12  *    this list of conditions and the following disclaimer in the documentation                          </span>
<span class="-2067912076149043179" onmouseenter="enter('-2067912076149043179');" onmouseout="out('-2067912076149043179');" style="">  13  *    and/or other materials provided with the distribution.                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  14  *                                                                                                       </span>
<span class="-7721941782677048447" onmouseenter="enter('-7721941782677048447');" onmouseout="out('-7721941782677048447');" style="">  15  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND                       </span>
<span class="-5124048439450882348" onmouseenter="enter('-5124048439450882348');" onmouseout="out('-5124048439450882348');" style="">  16  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED                         </span>
<span class="2277289959795125050" onmouseenter="enter('2277289959795125050');" onmouseout="out('2277289959795125050');" style="">  17  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.                    </span>
<span class="4422846307625339339" onmouseenter="enter('4422846307625339339');" onmouseout="out('4422846307625339339');" style="">  18  * IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,                       </span>
<span class="9023453646714579255" onmouseenter="enter('9023453646714579255');" onmouseout="out('9023453646714579255');" style="">  19  * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,                        </span>
<span class="2153827234735713132" onmouseenter="enter('2153827234735713132');" onmouseout="out('2153827234735713132');" style="">  20  * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,                         </span>
<span class="5782830561991082866" onmouseenter="enter('5782830561991082866');" onmouseout="out('5782830561991082866');" style="">  21  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF                       </span>
<span class="-2513683953102966204" onmouseenter="enter('-2513683953102966204');" onmouseout="out('-2513683953102966204');" style="">  22  * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE                       </span>
<span class="-6562574984275957691" onmouseenter="enter('-6562574984275957691');" onmouseout="out('-6562574984275957691');" style="">  23  * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF                             </span>
<span class="505998933154990042" onmouseenter="enter('505998933154990042');" onmouseout="out('505998933154990042');" style="">  24  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  25  */                                                                                                      </span>
<span class="4675552543740820910" onmouseenter="enter('4675552543740820910');" onmouseout="out('4675552543740820910');" style="">  26 package com.evernote.android.job;                                                                        </span>
<span  style="">  27                                                                                                          </span>
<span class="-1261404242645970098" onmouseenter="enter('-1261404242645970098');" onmouseout="out('-1261404242645970098');" style="">  28 import android.app.Service;                                                                              </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  29 import android.content.ComponentName;                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  30 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  31 import android.content.Intent;                                                                           </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  32 import android.os.Bundle;                                                                                </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="">  33 import android.os.Looper;                                                                                </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  34 import android.support.annotation.NonNull;                                                               </span>
<span class="4394652512097310678" onmouseenter="enter('4394652512097310678');" onmouseout="out('4394652512097310678');" style="">  35 import android.support.annotation.Nullable;                                                              </span>
<span class="2270421051523495577" onmouseenter="enter('2270421051523495577');" onmouseout="out('2270421051523495577');" style="">  36 import com.evernote.android.job.util.JobUtil;                                                            </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="">  37 import java.util.Locale;                                                                                 </span>
<span class="6613496282884511495" onmouseenter="enter('6613496282884511495');" onmouseout="out('6613496282884511495');" style="">  38 import java.util.concurrent.ExecutionException;                                                          </span>
<span class="-331778695229620376" onmouseenter="enter('-331778695229620376');" onmouseout="out('-331778695229620376');" style="">  39 import java.util.concurrent.Future;                                                                      </span>
<span class="1867212591271003466" onmouseenter="enter('1867212591271003466');" onmouseout="out('1867212591271003466');" style="">  40 import java.util.concurrent.ThreadFactory;                                                               </span>
<span class="7979168040994256185" onmouseenter="enter('7979168040994256185');" onmouseout="out('7979168040994256185');" style="">  41 import java.util.concurrent.atomic.AtomicInteger;                                                        </span>
<span class="4887698622156748971" onmouseenter="enter('4887698622156748971');" onmouseout="out('4887698622156748971');" style="">  42 import net.vrallev.android.cat.CatLog;                                                                   </span>
<span  style="">  43                                                                                                          </span>
<span  style="">  44                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  45 /**                                                                                                      </span>
<span class="-126646863796949621" onmouseenter="enter('-126646863796949621');" onmouseout="out('-126646863796949621');" style="">  46  * A proxy for each {@link JobApi}.                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  47  *                                                                                                       </span>
<span class="-2541210092808878866" onmouseenter="enter('-2541210092808878866');" onmouseout="out('-2541210092808878866');" style="">  48  * @author rwondratschek                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  49  */                                                                                                      </span>
<span class="1140466455373644171" onmouseenter="enter('1140466455373644171');" onmouseout="out('1140466455373644171');" style="">  50 public interface JobProxy {                                                                              </span>
<span class="-8144897713900189970" onmouseenter="enter('-8144897713900189970');" onmouseout="out('-8144897713900189970');" style="">  51     void plantOneOff(JobRequest request);                                                                </span>
<span  style="">  52                                                                                                          </span>
<span class="-2416890449051145953" onmouseenter="enter('-2416890449051145953');" onmouseout="out('-2416890449051145953');" style="">  53     void plantPeriodic(JobRequest request);                                                              </span>
<span  style="">  54                                                                                                          </span>
<span class="6309911337945331379" onmouseenter="enter('6309911337945331379');" onmouseout="out('6309911337945331379');" style="">  55     void plantPeriodicFlexSupport(JobRequest request);                                                   </span>
<span  style="">  56                                                                                                          </span>
<span class="8340124833639515371" onmouseenter="enter('8340124833639515371');" onmouseout="out('8340124833639515371');" style="">  57     void cancel(int jobId);                                                                              </span>
<span  style="">  58                                                                                                          </span>
<span class="-6161809553933645851" onmouseenter="enter('-6161809553933645851');" onmouseout="out('-6161809553933645851');" style="">  59     boolean isPlatformJobScheduled(JobRequest request);                                                  </span>
<span  style="">  60                                                                                                          </span>
<span class="-2942343485984948817" onmouseenter="enter('-2942343485984948817');" onmouseout="out('-2942343485984948817');" style="">  61     /*package*/                                                                                          </span>
<span class="5106484226992372263" onmouseenter="enter('5106484226992372263');" onmouseout="out('5106484226992372263');" style="">  62     @SuppressWarnings(&quot;UnusedReturnValue&quot;)                                                               </span>
<span class="1802690055591873141" onmouseenter="enter('1802690055591873141');" onmouseout="out('1802690055591873141');" style="">  63     final class Common {                                                                                 </span>
<span class="-7267523611033686156" onmouseenter="enter('-7267523611033686156');" onmouseout="out('-7267523611033686156');" style="">  64         private static final Object COMMON_MONITOR = new Object();                                       </span>
<span  style="">  65                                                                                                          </span>
<span class="142194204239450957" onmouseenter="enter('142194204239450957');" onmouseout="out('142194204239450957');" style="">  66         public static final ThreadFactory COMMON_THREAD_FACTORY = new ThreadFactory() {                  </span>
<span class="8379292492229673398" onmouseenter="enter('8379292492229673398');" onmouseout="out('8379292492229673398');" style="">  67             private final AtomicInteger mThreadNumber = new AtomicInteger();                             </span>
<span  style="">  68                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  69             @Override                                                                                    </span>
<span class="-4555742382280632002" onmouseenter="enter('-4555742382280632002');" onmouseout="out('-4555742382280632002');" style="">  70             public Thread newThread(@NonNull                                                             </span>
<span class="846237013790465000" onmouseenter="enter('846237013790465000');" onmouseout="out('846237013790465000');" style="">  71             Runnable r) {                                                                                </span>
<span class="-2238610439465529740" onmouseenter="enter('-2238610439465529740');" onmouseout="out('-2238610439465529740');" style="">  72                 Thread thread = new Thread(r, &quot;AndroidJob-&quot; + mThreadNumber.incrementAndGet());          </span>
<span class="-2780159030059633262" onmouseenter="enter('-2780159030059633262');" onmouseout="out('-2780159030059633262');" style="">  73                 if (thread.isDaemon()) {                                                                 </span>
<span class="-6985289869807539393" onmouseenter="enter('-6985289869807539393');" onmouseout="out('-6985289869807539393');" style="">  74                     thread.setDaemon(false);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  75                 }                                                                                        </span>
<span class="3121234640013807968" onmouseenter="enter('3121234640013807968');" onmouseout="out('3121234640013807968');" style="">  76                 if (thread.getPriority() != Thread.NORM_PRIORITY) {                                      </span>
<span class="3041005067018043930" onmouseenter="enter('3041005067018043930');" onmouseout="out('3041005067018043930');" style="">  77                     thread.setPriority(Thread.NORM_PRIORITY);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78                 }                                                                                        </span>
<span class="3079099442831550764" onmouseenter="enter('3079099442831550764');" onmouseout="out('3079099442831550764');" style="">  79                 return thread;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  80             }                                                                                            </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style="">  81         };                                                                                               </span>
<span  style="">  82                                                                                                          </span>
<span class="8412616957402907467" onmouseenter="enter('8412616957402907467');" onmouseout="out('8412616957402907467');" style=""><abbr title="  83         // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/math/LongMath.java">  83         // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/math🔵</abbr></span>
<span class="-1572685421845796133" onmouseenter="enter('-1572685421845796133');" onmouseout="out('-1572685421845796133');" style="">  84         private static long checkedAdd(long a, long b) {                                                 </span>
<span class="-1527942472133998342" onmouseenter="enter('-1527942472133998342');" onmouseout="out('-1527942472133998342');" style="">  85             long result = a + b;                                                                         </span>
<span class="-8281399218677613001" onmouseenter="enter('-8281399218677613001');" onmouseout="out('-8281399218677613001');" style="">  86             return checkNoOverflow(result, (a ^ b) &lt; 0 | (a ^ result) &gt;= 0);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  87         }                                                                                                </span>
<span  style="">  88                                                                                                          </span>
<span class="6423040751114649745" onmouseenter="enter('6423040751114649745');" onmouseout="out('6423040751114649745');" style="">  89         private static long checkNoOverflow(long result, boolean condition) {                            </span>
<span class="6603368327369456734" onmouseenter="enter('6603368327369456734');" onmouseout="out('6603368327369456734');" style="">  90             return condition ? result : Long.MAX_VALUE;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91         }                                                                                                </span>
<span  style="">  92                                                                                                          </span>
<span class="1406832824568924523" onmouseenter="enter('1406832824568924523');" onmouseout="out('1406832824568924523');" style="">  93         public static long getStartMs(JobRequest request) {                                              </span>
<span class="-6205484021482461183" onmouseenter="enter('-6205484021482461183');" onmouseout="out('-6205484021482461183');" style="">  94             if (request.getFailureCount() &gt; 0) {                                                         </span>
<span class="9206292300770255130" onmouseenter="enter('9206292300770255130');" onmouseout="out('9206292300770255130');" style="">  95                 return request.getBackoffOffset();                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  96             } else {                                                                                     </span>
<span class="-8332790610925894090" onmouseenter="enter('-8332790610925894090');" onmouseout="out('-8332790610925894090');" style="">  97                 return request.getStartMs();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99         }                                                                                                </span>
<span  style=""> 100                                                                                                          </span>
<span class="-3832824197988283345" onmouseenter="enter('-3832824197988283345');" onmouseout="out('-3832824197988283345');" style=""> 101         public static long getEndMs(JobRequest request) {                                                </span>
<span class="-6205484021482461183" onmouseenter="enter('-6205484021482461183');" onmouseout="out('-6205484021482461183');" style=""> 102             if (request.getFailureCount() &gt; 0) {                                                         </span>
<span class="9206292300770255130" onmouseenter="enter('9206292300770255130');" onmouseout="out('9206292300770255130');" style=""> 103                 return request.getBackoffOffset();                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 104             } else {                                                                                     </span>
<span class="3799819942554251441" onmouseenter="enter('3799819942554251441');" onmouseout="out('3799819942554251441');" style=""> 105                 return request.getEndMs();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107         }                                                                                                </span>
<span  style=""> 108                                                                                                          </span>
<span class="2658461420075954163" onmouseenter="enter('2658461420075954163');" onmouseout="out('2658461420075954163');" style=""> 109         public static long getAverageDelayMs(JobRequest request) {                                       </span>
<span class="5188333912507681776" onmouseenter="enter('5188333912507681776');" onmouseout="out('5188333912507681776');" style=""> 110             return checkedAdd(getStartMs(request), (getEndMs(request) - getStartMs(request)) / 2);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111         }                                                                                                </span>
<span  style=""> 112                                                                                                          </span>
<span class="-8453711403554538500" onmouseenter="enter('-8453711403554538500');" onmouseout="out('-8453711403554538500');" style=""> 113         public static long getStartMsSupportFlex(JobRequest request) {                                   </span>
<span class="4867134151855536256" onmouseenter="enter('4867134151855536256');" onmouseout="out('4867134151855536256');" style=""> 114             return Math.max(1, request.getIntervalMs() - request.getFlexMs());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115         }                                                                                                </span>
<span  style=""> 116                                                                                                          </span>
<span class="2402850512558550424" onmouseenter="enter('2402850512558550424');" onmouseout="out('2402850512558550424');" style=""> 117         public static long getEndMsSupportFlex(JobRequest request) {                                     </span>
<span class="1818143853198758132" onmouseenter="enter('1818143853198758132');" onmouseout="out('1818143853198758132');" style=""> 118             return request.getIntervalMs();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119         }                                                                                                </span>
<span  style=""> 120                                                                                                          </span>
<span class="5236833657260895409" onmouseenter="enter('5236833657260895409');" onmouseout="out('5236833657260895409');" style=""> 121         public static long getAverageDelayMsSupportFlex(JobRequest request) {                            </span>
<span class="1202002964551881523" onmouseenter="enter('1202002964551881523');" onmouseout="out('1202002964551881523');" style=""><abbr title=" 122             return checkedAdd(getStartMsSupportFlex(request), (getEndMsSupportFlex(request) - getStartMsSupportFlex(request)) / 2);"> 122             return checkedAdd(getStartMsSupportFlex(request), (getEndMsSupportFlex(request) - getStartMsS🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123         }                                                                                                </span>
<span  style=""> 124                                                                                                          </span>
<span class="5683661540559112003" onmouseenter="enter('5683661540559112003');" onmouseout="out('5683661540559112003');" style=""> 125         public static int getRescheduleCount(JobRequest request) {                                       </span>
<span class="6823077784476657246" onmouseenter="enter('6823077784476657246');" onmouseout="out('6823077784476657246');" style=""> 126             return request.getFailureCount();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127         }                                                                                                </span>
<span  style=""> 128                                                                                                          </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style=""> 129         private final Context mContext;                                                                  </span>
<span  style=""> 130                                                                                                          </span>
<span class="3051386596282037072" onmouseenter="enter('3051386596282037072');" onmouseout="out('3051386596282037072');" style=""> 131         private final int mJobId;                                                                        </span>
<span  style=""> 132                                                                                                          </span>
<span class="6179859670209082226" onmouseenter="enter('6179859670209082226');" onmouseout="out('6179859670209082226');" style=""> 133         private final CatLog mCat;                                                                       </span>
<span  style=""> 134                                                                                                          </span>
<span class="5239517905467210385" onmouseenter="enter('5239517905467210385');" onmouseout="out('5239517905467210385');" style=""> 135         private final JobManager mJobManager;                                                            </span>
<span  style=""> 136                                                                                                          </span>
<span class="8226250815326017684" onmouseenter="enter('8226250815326017684');" onmouseout="out('8226250815326017684');" style=""> 137         public Common(@NonNull                                                                           </span>
<span class="5873760423534416630" onmouseenter="enter('5873760423534416630');" onmouseout="out('5873760423534416630');" style=""> 138         Service service, CatLog cat, int jobId) {                                                        </span>
<span class="4456333106500041007" onmouseenter="enter('4456333106500041007');" onmouseout="out('4456333106500041007');" style=""> 139             this(((Context) (service)), cat, jobId);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140         }                                                                                                </span>
<span  style=""> 141                                                                                                          </span>
<span class="8245917193041428481" onmouseenter="enter('8245917193041428481');" onmouseout="out('8245917193041428481');" style=""> 142         /* package */                                                                                    </span>
<span class="-1449042905942585555" onmouseenter="enter('-1449042905942585555');" onmouseout="out('-1449042905942585555');" style=""> 143         Common(@NonNull                                                                                  </span>
<span class="7498457560842255638" onmouseenter="enter('7498457560842255638');" onmouseout="out('7498457560842255638');" style=""> 144         Context context, CatLog cat, int jobId) {                                                        </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 145             mContext = context;                                                                          </span>
<span class="3380959276812020408" onmouseenter="enter('3380959276812020408');" onmouseout="out('3380959276812020408');" style=""> 146             mJobId = jobId;                                                                              </span>
<span class="-7514169524268117475" onmouseenter="enter('-7514169524268117475');" onmouseout="out('-7514169524268117475');" style=""> 147             mCat = cat;                                                                                  </span>
<span class="2088134523180067307" onmouseenter="enter('2088134523180067307');" onmouseout="out('2088134523180067307');" style=""> 148             mJobManager = JobManager.create(context);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 149         }                                                                                                </span>
<span  style=""> 150                                                                                                          </span>
<span class="-2624265816122902557" onmouseenter="enter('-2624265816122902557');" onmouseout="out('-2624265816122902557');" style=""> 151         public JobRequest getPendingRequest(@SuppressWarnings(&quot;SameParameterValue&quot;)                      </span>
<span class="-7032528630724522666" onmouseenter="enter('-7032528630724522666');" onmouseout="out('-7032528630724522666');" style=""> 152         boolean cleanUpOrphanedJob, boolean markStarting) {                                              </span>
<span class="4698918318189663428" onmouseenter="enter('4698918318189663428');" onmouseout="out('4698918318189663428');" style=""> 153             synchronized(COMMON_MONITOR) {                                                               </span>
<span class="-1539078468410613703" onmouseenter="enter('-1539078468410613703');" onmouseout="out('-1539078468410613703');" style=""> 154                 // order is important for logging purposes                                               </span>
<span class="6754931577315038874" onmouseenter="enter('6754931577315038874');" onmouseout="out('6754931577315038874');" style=""> 155                 JobRequest request = mJobManager.getJobRequest(mJobId, true);                            </span>
<span class="-4807858926389575759" onmouseenter="enter('-4807858926389575759');" onmouseout="out('-4807858926389575759');" style=""> 156                 Job job = mJobManager.getJob(mJobId);                                                    </span>
<span class="5941467937120979310" onmouseenter="enter('5941467937120979310');" onmouseout="out('5941467937120979310');" style=""> 157                 boolean periodic = (request != null) &amp;&amp; request.isPeriodic();                            </span>
<span class="2156808502362659130" onmouseenter="enter('2156808502362659130');" onmouseout="out('2156808502362659130');" style=""> 158                 if ((job != null) &amp;&amp; (!job.isFinished())) {                                              </span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style=""><abbr title=" 159                     // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 159                     // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobsche🔵</abbr></span>
<span class="-5462975656818636592" onmouseenter="enter('-5462975656818636592');" onmouseout="out('-5462975656818636592');" style=""> 160                     mCat.d(&quot;Job %d is already running, %s&quot;, mJobId, request);                            </span>
<span class="-8865814855968501379" onmouseenter="enter('-8865814855968501379');" onmouseout="out('-8865814855968501379');" style=""> 161                     // not necessary to clean up, the running instance will do that                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 162                     return null;                                                                         </span>
<span class="7238865033192171952" onmouseenter="enter('7238865033192171952');" onmouseout="out('7238865033192171952');" style=""> 163                 } else if ((job != null) &amp;&amp; (!periodic)) {                                               </span>
<span class="599327769680236656" onmouseenter="enter('599327769680236656');" onmouseout="out('599327769680236656');" style=""> 164                     mCat.d(&quot;Job %d already finished, %s&quot;, mJobId, request);                              </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style=""> 165                     cleanUpOrphanedJob(cleanUpOrphanedJob);                                              </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 166                     return null;                                                                         </span>
<span class="7081690850833435069" onmouseenter="enter('7081690850833435069');" onmouseout="out('7081690850833435069');" style=""><abbr title=" 167                 } else if ((job != null) &amp;&amp; ((System.currentTimeMillis() - job.getFinishedTimeStamp()) &lt; 2000)) {"> 167                 } else if ((job != null) &amp;&amp; ((System.currentTimeMillis() - job.getFinishedTimeStamp()) &lt; 🔵</abbr></span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style=""><abbr title=" 168                     // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 168                     // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobsche🔵</abbr></span>
<span class="-2963240540698415567" onmouseenter="enter('-2963240540698415567');" onmouseout="out('-2963240540698415567');" style=""> 169                     mCat.d(&quot;Job %d is periodic and just finished, %s&quot;, mJobId, request);                 </span>
<span class="5118828189189336116" onmouseenter="enter('5118828189189336116');" onmouseout="out('5118828189189336116');" style=""> 170                     // don&#x27;t clean up, periodic job                                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 171                     return null;                                                                         </span>
<span class="-4117709597523372179" onmouseenter="enter('-4117709597523372179');" onmouseout="out('-4117709597523372179');" style=""> 172                 } else if ((request != null) &amp;&amp; request.isStarted()) {                                   </span>
<span class="2694894942883236024" onmouseenter="enter('2694894942883236024');" onmouseout="out('2694894942883236024');" style=""> 173                     mCat.d(&quot;Request %d already started, %s&quot;, mJobId, request);                           </span>
<span class="3715771020426903748" onmouseenter="enter('3715771020426903748');" onmouseout="out('3715771020426903748');" style=""> 174                     // not necessary to clean up, the JobManager will do this for started jobs           </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 175                     return null;                                                                         </span>
<span class="5935759300804907979" onmouseenter="enter('5935759300804907979');" onmouseout="out('5935759300804907979');" style=""><abbr title=" 176                 } else if ((request != null) &amp;&amp; mJobManager.getJobExecutor().isRequestStarting(request)) {"> 176                 } else if ((request != null) &amp;&amp; mJobManager.getJobExecutor().isRequestStarting(request)) 🔵</abbr></span>
<span class="3441384320730940166" onmouseenter="enter('3441384320730940166');" onmouseout="out('3441384320730940166');" style=""> 177                     mCat.d(&quot;Request %d is in the queue to start, %s&quot;, mJobId, request);                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 178                     return null;                                                                         </span>
<span class="-4428555773566380837" onmouseenter="enter('-4428555773566380837');" onmouseout="out('-4428555773566380837');" style=""> 179                 } else if (request == null) {                                                            </span>
<span class="7609103357697598215" onmouseenter="enter('7609103357697598215');" onmouseout="out('7609103357697598215');" style=""> 180                     mCat.d(&quot;Request for ID %d was null&quot;, mJobId);                                        </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style=""> 181                     cleanUpOrphanedJob(cleanUpOrphanedJob);                                              </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 182                     return null;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183                 }                                                                                        </span>
<span class="8480325012103084437" onmouseenter="enter('8480325012103084437');" onmouseout="out('8480325012103084437');" style=""> 184                 if (markStarting) {                                                                      </span>
<span class="8387569989042798053" onmouseenter="enter('8387569989042798053');" onmouseout="out('8387569989042798053');" style=""> 185                     mJobManager.getJobExecutor().markJobRequestStarting(request);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186                 }                                                                                        </span>
<span class="-1057636993633179522" onmouseenter="enter('-1057636993633179522');" onmouseout="out('-1057636993633179522');" style=""> 187                 return request;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189         }                                                                                                </span>
<span  style=""> 190                                                                                                          </span>
<span class="5154748246392482767" onmouseenter="enter('5154748246392482767');" onmouseout="out('5154748246392482767');" style=""> 191         @NonNull                                                                                         </span>
<span class="-2557260734306891674" onmouseenter="enter('-2557260734306891674');" onmouseout="out('-2557260734306891674');" style=""> 192         public Job.Result executeJobRequest(@NonNull                                                     </span>
<span class="-3130935040465667812" onmouseenter="enter('-3130935040465667812');" onmouseout="out('-3130935040465667812');" style=""> 193         JobRequest request, @Nullable                                                                    </span>
<span class="-6818704493118073415" onmouseenter="enter('-6818704493118073415');" onmouseout="out('-6818704493118073415');" style=""> 194         Bundle transientExtras) {                                                                        </span>
<span class="8785519441075077783" onmouseenter="enter('8785519441075077783');" onmouseout="out('8785519441075077783');" style=""> 195             long waited = System.currentTimeMillis() - request.getScheduledAt();                         </span>
<span class="-521988911558271196" onmouseenter="enter('-521988911558271196');" onmouseout="out('-521988911558271196');" style=""> 196             String timeWindow;                                                                           </span>
<span class="-4749167882947985624" onmouseenter="enter('-4749167882947985624');" onmouseout="out('-4749167882947985624');" style=""> 197             if (request.isPeriodic()) {                                                                  </span>
<span class="-4529385517217469077" onmouseenter="enter('-4529385517217469077');" onmouseout="out('-4529385517217469077');" style=""><abbr title=" 198                 timeWindow = String.format(Locale.US, &quot;interval %s, flex %s&quot;, JobUtil.timeToString(request.getIntervalMs()), JobUtil.timeToString(request.getFlexMs()));"> 198                 timeWindow = String.format(Locale.US, &quot;interval %s, flex %s&quot;, JobUtil.timeToString(reques🔵</abbr></span>
<span class="4779514256224206313" onmouseenter="enter('4779514256224206313');" onmouseout="out('4779514256224206313');" style=""> 199             } else if (request.getJobApi().supportsExecutionWindow()) {                                  </span>
<span class="-3666957316142863099" onmouseenter="enter('-3666957316142863099');" onmouseout="out('-3666957316142863099');" style=""><abbr title=" 200                 timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMs(request)), JobUtil.timeToString(getEndMs(request)));"> 200                 timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMs🔵</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 201             } else {                                                                                     </span>
<span class="-1520611369215068334" onmouseenter="enter('-1520611369215068334');" onmouseout="out('-1520611369215068334');" style=""> 202                 timeWindow = &quot;delay &quot; + JobUtil.timeToString(getAverageDelayMs(request));                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203             }                                                                                            </span>
<span class="-8808967967811702611" onmouseenter="enter('-8808967967811702611');" onmouseout="out('-8808967967811702611');" style=""> 204             if (Looper.myLooper() == Looper.getMainLooper()) {                                           </span>
<span class="-1368751502622418275" onmouseenter="enter('-1368751502622418275');" onmouseout="out('-1368751502622418275');" style=""><abbr title=" 205                 mCat.w(&quot;Running JobRequest on a main thread, this could cause stutter or ANR in your app.&quot;);"> 205                 mCat.w(&quot;Running JobRequest on a main thread, this could cause stutter or ANR in your app.🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206             }                                                                                            </span>
<span class="-1843046913616870974" onmouseenter="enter('-1843046913616870974');" onmouseout="out('-1843046913616870974');" style=""> 207             mCat.d(&quot;Run job, %s, waited %s, %s&quot;, request, JobUtil.timeToString(waited), timeWindow);     </span>
<span class="-4828048199353050218" onmouseenter="enter('-4828048199353050218');" onmouseout="out('-4828048199353050218');" style=""> 208             JobExecutor jobExecutor = mJobManager.getJobExecutor();                                      </span>
<span class="-1235692988875235782" onmouseenter="enter('-1235692988875235782');" onmouseout="out('-1235692988875235782');" style=""> 209             Job job = null;                                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 210             try {                                                                                        </span>
<span class="-4769195842780086458" onmouseenter="enter('-4769195842780086458');" onmouseout="out('-4769195842780086458');" style=""><abbr title=" 211                 // create job first before setting it started, avoids a race condition while rescheduling jobs"> 211                 // create job first before setting it started, avoids a race condition while rescheduling🔵</abbr></span>
<span class="1625132338136195706" onmouseenter="enter('1625132338136195706');" onmouseout="out('1625132338136195706');" style=""> 212                 job = mJobManager.getJobCreatorHolder().createJob(request.getTag());                     </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 213                 if (!request.isPeriodic()) {                                                             </span>
<span class="4919726022962249182" onmouseenter="enter('4919726022962249182');" onmouseout="out('4919726022962249182');" style=""> 214                     request.setStarted(true);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215                 }                                                                                        </span>
<span class="-7821317659145756468" onmouseenter="enter('-7821317659145756468');" onmouseout="out('-7821317659145756468');" style=""> 216                 if (transientExtras == null) {                                                           </span>
<span class="-387255381167201921" onmouseenter="enter('-387255381167201921');" onmouseout="out('-387255381167201921');" style=""> 217                     transientExtras = Bundle.EMPTY;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218                 }                                                                                        </span>
<span class="8687421104735025391" onmouseenter="enter('8687421104735025391');" onmouseout="out('8687421104735025391');" style=""> 219                 Future&lt;Job.Result&gt; future = jobExecutor.execute(mContext, request, job, transientExtras);</span>
<span class="-4410702629486134619" onmouseenter="enter('-4410702629486134619');" onmouseout="out('-4410702629486134619');" style=""> 220                 if (future == null) {                                                                    </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 221                     return Job.Result.FAILURE;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222                 }                                                                                        </span>
<span class="5244342940061655384" onmouseenter="enter('5244342940061655384');" onmouseout="out('5244342940061655384');" style=""> 223                 // wait until done                                                                       </span>
<span class="-4728317628971455727" onmouseenter="enter('-4728317628971455727');" onmouseout="out('-4728317628971455727');" style=""> 224                 Job.Result result = future.get();                                                        </span>
<span class="368857225067072174" onmouseenter="enter('368857225067072174');" onmouseout="out('368857225067072174');" style=""> 225                 mCat.d(&quot;Finished job, %s %s&quot;, request, result);                                          </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 226                 return result;                                                                           </span>
<span class="1408709784185360224" onmouseenter="enter('1408709784185360224');" onmouseout="out('1408709784185360224');" style=""> 227             } catch (java.lang.InterruptedException | ExecutionException e) {                            </span>
<span class="-1683580236663429788" onmouseenter="enter('-1683580236663429788');" onmouseout="out('-1683580236663429788');" style=""> 228                 mCat.e(e);                                                                               </span>
<span class="6519543964694909858" onmouseenter="enter('6519543964694909858');" onmouseout="out('6519543964694909858');" style=""> 229                 if (job != null) {                                                                       </span>
<span class="-9041905225007822866" onmouseenter="enter('-9041905225007822866');" onmouseout="out('-9041905225007822866');" style=""> 230                     job.cancel();                                                                        </span>
<span class="3580809215980372017" onmouseenter="enter('3580809215980372017');" onmouseout="out('3580809215980372017');" style=""> 231                     mCat.e(&quot;Canceled %s&quot;, request);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232                 }                                                                                        </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 233                 return Job.Result.FAILURE;                                                               </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 234             } finally {                                                                                  </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 235                 if (!request.isPeriodic()) {                                                             </span>
<span class="1449747436325478708" onmouseenter="enter('1449747436325478708');" onmouseout="out('1449747436325478708');" style=""> 236                     mJobManager.getJobStorage().remove(request);                                         </span>
<span class="-2333237089390189385" onmouseenter="enter('-2333237089390189385');" onmouseout="out('-2333237089390189385');" style=""> 237                 } else if (request.isFlexSupport()) {                                                    </span>
<span class="2778742918241741027" onmouseenter="enter('2778742918241741027');" onmouseout="out('2778742918241741027');" style=""><abbr title=" 238                     mJobManager.getJobStorage().remove(request);// remove, we store the new job in JobManager.schedule()"> 238                     mJobManager.getJobStorage().remove(request);// remove, we store the new job in JobMan🔵</abbr></span>
<span  style=""> 239                                                                                                          </span>
<span class="2102053740633122535" onmouseenter="enter('2102053740633122535');" onmouseout="out('2102053740633122535');" style=""> 240                     request.reschedule(false, false);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243         }                                                                                                </span>
<span  style=""> 244                                                                                                          </span>
<span class="-3194552414098127961" onmouseenter="enter('-3194552414098127961');" onmouseout="out('-3194552414098127961');" style=""> 245         private void cleanUpOrphanedJob(boolean cleanUp) {                                               </span>
<span class="8101282554241671494" onmouseenter="enter('8101282554241671494');" onmouseout="out('8101282554241671494');" style=""> 246             if (cleanUp) {                                                                               </span>
<span class="6651175145696850096" onmouseenter="enter('6651175145696850096');" onmouseout="out('6651175145696850096');" style=""> 247                 cleanUpOrphanedJob(mContext, mJobId);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249         }                                                                                                </span>
<span  style=""> 250                                                                                                          </span>
<span class="-2942343485984948817" onmouseenter="enter('-2942343485984948817');" onmouseout="out('-2942343485984948817');" style=""> 251         /*package*/                                                                                      </span>
<span class="-3980437807714189532" onmouseenter="enter('-3980437807714189532');" onmouseout="out('-3980437807714189532');" style=""> 252         static void cleanUpOrphanedJob(Context context, int jobId) {                                     </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 253             /*                                                                                           </span>
<span class="4873467377157825728" onmouseenter="enter('4873467377157825728');" onmouseout="out('4873467377157825728');" style=""><abbr title=" 254              * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are still around."> 254              * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are st🔵</abbr></span>
<span class="7880315656890986822" onmouseenter="enter('7880315656890986822');" onmouseout="out('7880315656890986822');" style=""><abbr title=" 255              * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the old one. Here"> 255              * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the old🔵</abbr></span>
<span class="7642695698821586509" onmouseenter="enter('7642695698821586509');" onmouseout="out('7642695698821586509');" style=""> 256              * we make sure, that no job is left in the system.                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 257              */                                                                                          </span>
<span class="-1280302924927314158" onmouseenter="enter('-1280302924927314158');" onmouseout="out('-1280302924927314158');" style=""> 258             for (JobApi jobApi : JobApi.values()) {                                                      </span>
<span class="-5474372138432799739" onmouseenter="enter('-5474372138432799739');" onmouseout="out('-5474372138432799739');" style=""> 259                 if (jobApi.isSupported(context)) {                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 260                     try {                                                                                </span>
<span class="4287784381767543802" onmouseenter="enter('4287784381767543802');" onmouseout="out('4287784381767543802');" style=""> 261                         jobApi.getProxy(context).cancel(jobId);                                          </span>
<span class="2168304593065879823" onmouseenter="enter('2168304593065879823');" onmouseout="out('2168304593065879823');" style=""> 262                     } catch (java.lang.Exception ignored) {                                              </span>
<span class="-571140832119819901" onmouseenter="enter('-571140832119819901');" onmouseout="out('-571140832119819901');" style=""><abbr title=" 263                         // GCM API could crash if it&#x27;s disabled, ignore crashes at this point and continue"> 263                         // GCM API could crash if it&#x27;s disabled, ignore crashes at this point and continu🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267         }                                                                                                </span>
<span  style=""> 268                                                                                                          </span>
<span class="5053639476535817445" onmouseenter="enter('5053639476535817445');" onmouseout="out('5053639476535817445');" style=""> 269         public static ComponentName startWakefulService(Context context, Intent intent) {                </span>
<span class="-2841441978426476425" onmouseenter="enter('-2841441978426476425');" onmouseout="out('-2841441978426476425');" style=""> 270             return WakeLockUtil.startWakefulService(context, intent);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 271         }                                                                                                </span>
<span  style=""> 272                                                                                                          </span>
<span class="-5135813554980344335" onmouseenter="enter('-5135813554980344335');" onmouseout="out('-5135813554980344335');" style=""> 273         public static boolean completeWakefulIntent(Intent intent) {                                     </span>
<span class="-1383746570627903167" onmouseenter="enter('-1383746570627903167');" onmouseout="out('-1383746570627903167');" style=""> 274             return WakeLockUtil.completeWakefulIntent(intent);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277 }                                                                                                        </span>










































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-8822900351790619766" onmouseenter="enter('-8822900351790619766');" onmouseout="out('-8822900351790619766');" style="">   2   * Copyright 2007-present Evernote Corporation.                                                                   </span>
<span class="-2278367542838177584" onmouseenter="enter('-2278367542838177584');" onmouseout="out('-2278367542838177584');" style="">   3   * All rights reserved.                                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   4   *                                                                                                                </span>
<span class="181301442133285836" onmouseenter="enter('181301442133285836');" onmouseout="out('181301442133285836');" style="">   5   * Redistribution and use in source and binary forms, with or without modification,                               </span>
<span class="-5073197948967426970" onmouseenter="enter('-5073197948967426970');" onmouseout="out('-5073197948967426970');" style="">   6   * are permitted provided that the following conditions are met:                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="8127251449117563942" onmouseenter="enter('8127251449117563942');" onmouseout="out('8127251449117563942');" style="">   8   * 1. Redistributions of source code must retain the above copyright notice, this                                 </span>
<span class="-1473911044945790828" onmouseenter="enter('-1473911044945790828');" onmouseout="out('-1473911044945790828');" style="">   9   *    list of conditions and the following disclaimer.                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  10   *                                                                                                                </span>
<span class="4835137028529553232" onmouseenter="enter('4835137028529553232');" onmouseout="out('4835137028529553232');" style="">  11   * 2. Redistributions in binary form must reproduce the above copyright notice,                                   </span>
<span class="-1312443230807442131" onmouseenter="enter('-1312443230807442131');" onmouseout="out('-1312443230807442131');" style="">  12   *    this list of conditions and the following disclaimer in the documentation                                   </span>
<span class="-2067912076149043179" onmouseenter="enter('-2067912076149043179');" onmouseout="out('-2067912076149043179');" style="">  13   *    and/or other materials provided with the distribution.                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  14   *                                                                                                                </span>
<span class="-7721941782677048447" onmouseenter="enter('-7721941782677048447');" onmouseout="out('-7721941782677048447');" style="">  15   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND                                </span>
<span class="-5124048439450882348" onmouseenter="enter('-5124048439450882348');" onmouseout="out('-5124048439450882348');" style="">  16   * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED                                  </span>
<span class="2277289959795125050" onmouseenter="enter('2277289959795125050');" onmouseout="out('2277289959795125050');" style="">  17   * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.                             </span>
<span class="4422846307625339339" onmouseenter="enter('4422846307625339339');" onmouseout="out('4422846307625339339');" style="">  18   * IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,                                </span>
<span class="9023453646714579255" onmouseenter="enter('9023453646714579255');" onmouseout="out('9023453646714579255');" style="">  19   * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,                                 </span>
<span class="2153827234735713132" onmouseenter="enter('2153827234735713132');" onmouseout="out('2153827234735713132');" style="">  20   * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,                                  </span>
<span class="5782830561991082866" onmouseenter="enter('5782830561991082866');" onmouseout="out('5782830561991082866');" style="">  21   * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF                                </span>
<span class="-2513683953102966204" onmouseenter="enter('-2513683953102966204');" onmouseout="out('-2513683953102966204');" style="">  22   * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE                                </span>
<span class="-6562574984275957691" onmouseenter="enter('-6562574984275957691');" onmouseout="out('-6562574984275957691');" style="">  23   * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF                                      </span>
<span class="505998933154990042" onmouseenter="enter('505998933154990042');" onmouseout="out('505998933154990042');" style="">  24   * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  25   */                                                                                                               </span>
<span class="4675552543740820910" onmouseenter="enter('4675552543740820910');" onmouseout="out('4675552543740820910');" style="">  26  package com.evernote.android.job;                                                                                 </span>
<span  style="">  27                                                                                                                    </span>
<span class="-1261404242645970098" onmouseenter="enter('-1261404242645970098');" onmouseout="out('-1261404242645970098');" style="">  28  import android.app.Service;                                                                                       </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  29  import android.content.ComponentName;                                                                             </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  30  import android.content.Context;                                                                                   </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  31  import android.content.Intent;                                                                                    </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  32 +import android.os.Bundle;                                                                                         </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="">  33  import android.os.Looper;                                                                                         </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  34  import android.support.annotation.NonNull;                                                                        </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  35 -                                                                                                                  </span>
<span class="-2629940017315809162" onmouseenter="enter('-2629940017315809162');" onmouseout="out('-2629940017315809162');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  36 -import com.evernote.android.job.util.JobApi;                                                                      </span>
<span class="4394652512097310678" onmouseenter="enter('4394652512097310678');" onmouseout="out('4394652512097310678');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  37 +import android.support.annotation.Nullable;                                                                       </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  38 +                                                                                                                  </span>
<span class="2270421051523495577" onmouseenter="enter('2270421051523495577');" onmouseout="out('2270421051523495577');" style="">  39  import com.evernote.android.job.util.JobUtil;                                                                     </span>
<span  style="">  40                                                                                                                    </span>
<span class="4887698622156748971" onmouseenter="enter('4887698622156748971');" onmouseout="out('4887698622156748971');" style="">  41  import net.vrallev.android.cat.CatLog;                                                                            </span>
<span  style="">  42                                                                                                                    </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="">  43  import java.util.Locale;                                                                                          </span>
<span class="6613496282884511495" onmouseenter="enter('6613496282884511495');" onmouseout="out('6613496282884511495');" style="">  44  import java.util.concurrent.ExecutionException;                                                                   </span>
<span class="-331778695229620376" onmouseenter="enter('-331778695229620376');" onmouseout="out('-331778695229620376');" style="">  45  import java.util.concurrent.Future;                                                                               </span>
<span class="1867212591271003466" onmouseenter="enter('1867212591271003466');" onmouseout="out('1867212591271003466');" style="">  46  import java.util.concurrent.ThreadFactory;                                                                        </span>
<span class="7979168040994256185" onmouseenter="enter('7979168040994256185');" onmouseout="out('7979168040994256185');" style="">  47  import java.util.concurrent.atomic.AtomicInteger;                                                                 </span>
<span  style="">  48                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  49  /**                                                                                                               </span>
<span class="-126646863796949621" onmouseenter="enter('-126646863796949621');" onmouseout="out('-126646863796949621');" style="">  50   * A proxy for each {@link JobApi}.                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  51   *                                                                                                                </span>
<span class="-2541210092808878866" onmouseenter="enter('-2541210092808878866');" onmouseout="out('-2541210092808878866');" style="">  52   * @author rwondratschek                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  53   */                                                                                                               </span>
<span class="1140466455373644171" onmouseenter="enter('1140466455373644171');" onmouseout="out('1140466455373644171');" style="">  54  public interface JobProxy {                                                                                       </span>
<span  style="">  55                                                                                                                    </span>
<span class="-8144897713900189970" onmouseenter="enter('-8144897713900189970');" onmouseout="out('-8144897713900189970');" style="">  56      void plantOneOff(JobRequest request);                                                                         </span>
<span  style="">  57                                                                                                                    </span>
<span class="-2416890449051145953" onmouseenter="enter('-2416890449051145953');" onmouseout="out('-2416890449051145953');" style="">  58      void plantPeriodic(JobRequest request);                                                                       </span>
<span  style="">  59                                                                                                                    </span>
<span class="6309911337945331379" onmouseenter="enter('6309911337945331379');" onmouseout="out('6309911337945331379');" style="">  60      void plantPeriodicFlexSupport(JobRequest request);                                                            </span>
<span  style="">  61                                                                                                                    </span>
<span class="8340124833639515371" onmouseenter="enter('8340124833639515371');" onmouseout="out('8340124833639515371');" style="">  62      void cancel(int jobId);                                                                                       </span>
<span  style="">  63                                                                                                                    </span>
<span class="-6161809553933645851" onmouseenter="enter('-6161809553933645851');" onmouseout="out('-6161809553933645851');" style="">  64      boolean isPlatformJobScheduled(JobRequest request);                                                           </span>
<span  style="">  65                                                                                                                    </span>
<span class="5106484226992372263" onmouseenter="enter('5106484226992372263');" onmouseout="out('5106484226992372263');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +    @SuppressWarnings(&quot;UnusedReturnValue&quot;)                                                                        </span>
<span class="1769639894748899311" onmouseenter="enter('1769639894748899311');" onmouseout="out('1769639894748899311');" style="">  67      /*package*/ final class Common {                                                                              </span>
<span  style="">  68                                                                                                                    </span>


<span class="142194204239450957" onmouseenter="enter('142194204239450957');" onmouseout="out('142194204239450957');" style="">  69          public static final ThreadFactory COMMON_THREAD_FACTORY = new ThreadFactory() {                           </span>
<span  style="">  70                                                                                                                    </span>
<span class="8379292492229673398" onmouseenter="enter('8379292492229673398');" onmouseout="out('8379292492229673398');" style="">  71              private final AtomicInteger mThreadNumber = new AtomicInteger();                                      </span>
<span  style="">  72                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  73              @Override                                                                                             </span>
<span class="5852676775001677995" onmouseenter="enter('5852676775001677995');" onmouseout="out('5852676775001677995');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  74 -            public Thread newThread(Runnable r) {                                                                 </span>
<span class="-5634161788732062937" onmouseenter="enter('-5634161788732062937');" onmouseout="out('-5634161788732062937');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  75 +            public Thread newThread(@NonNull Runnable r) {                                                        </span>
<span class="-2238610439465529740" onmouseenter="enter('-2238610439465529740');" onmouseout="out('-2238610439465529740');" style="">  76                  Thread thread = new Thread(r, &quot;AndroidJob-&quot; + mThreadNumber.incrementAndGet());                   </span>
<span class="-2780159030059633262" onmouseenter="enter('-2780159030059633262');" onmouseout="out('-2780159030059633262');" style="">  77                  if (thread.isDaemon()) {                                                                          </span>
<span class="-6985289869807539393" onmouseenter="enter('-6985289869807539393');" onmouseout="out('-6985289869807539393');" style="">  78                      thread.setDaemon(false);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  79                  }                                                                                                 </span>
<span class="3121234640013807968" onmouseenter="enter('3121234640013807968');" onmouseout="out('3121234640013807968');" style="">  80                  if (thread.getPriority() != Thread.NORM_PRIORITY) {                                               </span>
<span class="3041005067018043930" onmouseenter="enter('3041005067018043930');" onmouseout="out('3041005067018043930');" style="">  81                      thread.setPriority(Thread.NORM_PRIORITY);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  82                  }                                                                                                 </span>
<span class="3079099442831550764" onmouseenter="enter('3079099442831550764');" onmouseout="out('3079099442831550764');" style="">  83                  return thread;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84              }                                                                                                     </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style="">  85          };                                                                                                        </span>
<span  style="">  86                                                                                                                    </span>
<span class="8412616957402907467" onmouseenter="enter('8412616957402907467');" onmouseout="out('8412616957402907467');" style=""><abbr title="  87          // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/math/LongMath.java">  87          // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/math/LongMath🔵</abbr></span>
<span class="-1572685421845796133" onmouseenter="enter('-1572685421845796133');" onmouseout="out('-1572685421845796133');" style="">  88          private static long checkedAdd(long a, long b) {                                                          </span>
<span class="-1527942472133998342" onmouseenter="enter('-1527942472133998342');" onmouseout="out('-1527942472133998342');" style="">  89              long result = a + b;                                                                                  </span>
<span class="-8281399218677613001" onmouseenter="enter('-8281399218677613001');" onmouseout="out('-8281399218677613001');" style="">  90              return checkNoOverflow(result, (a ^ b) &lt; 0 | (a ^ result) &gt;= 0);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91          }                                                                                                         </span>
<span  style="">  92                                                                                                                    </span>
<span class="6423040751114649745" onmouseenter="enter('6423040751114649745');" onmouseout="out('6423040751114649745');" style="">  93          private static long checkNoOverflow(long result, boolean condition) {                                     </span>
<span class="6603368327369456734" onmouseenter="enter('6603368327369456734');" onmouseout="out('6603368327369456734');" style="">  94              return condition ? result : Long.MAX_VALUE;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  95          }                                                                                                         </span>
<span  style="">  96                                                                                                                    </span>
<span class="1406832824568924523" onmouseenter="enter('1406832824568924523');" onmouseout="out('1406832824568924523');" style="">  97          public static long getStartMs(JobRequest request) {                                                       </span>
<span class="-6205484021482461183" onmouseenter="enter('-6205484021482461183');" onmouseout="out('-6205484021482461183');" style="">  98              if (request.getFailureCount() &gt; 0) {                                                                  </span>
<span class="9206292300770255130" onmouseenter="enter('9206292300770255130');" onmouseout="out('9206292300770255130');" style="">  99                  return request.getBackoffOffset();                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 100              } else {                                                                                              </span>
<span class="-8332790610925894090" onmouseenter="enter('-8332790610925894090');" onmouseout="out('-8332790610925894090');" style=""> 101                  return request.getStartMs();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103          }                                                                                                         </span>
<span  style=""> 104                                                                                                                    </span>
<span class="-3832824197988283345" onmouseenter="enter('-3832824197988283345');" onmouseout="out('-3832824197988283345');" style=""> 105          public static long getEndMs(JobRequest request) {                                                         </span>
<span class="-6205484021482461183" onmouseenter="enter('-6205484021482461183');" onmouseout="out('-6205484021482461183');" style=""> 106              if (request.getFailureCount() &gt; 0) {                                                                  </span>
<span class="9206292300770255130" onmouseenter="enter('9206292300770255130');" onmouseout="out('9206292300770255130');" style=""> 107                  return request.getBackoffOffset();                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 108              } else {                                                                                              </span>
<span class="3799819942554251441" onmouseenter="enter('3799819942554251441');" onmouseout="out('3799819942554251441');" style=""> 109                  return request.getEndMs();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111          }                                                                                                         </span>
<span  style=""> 112                                                                                                                    </span>
<span class="2658461420075954163" onmouseenter="enter('2658461420075954163');" onmouseout="out('2658461420075954163');" style=""> 113          public static long getAverageDelayMs(JobRequest request) {                                                </span>
<span class="5188333912507681776" onmouseenter="enter('5188333912507681776');" onmouseout="out('5188333912507681776');" style=""> 114              return checkedAdd(getStartMs(request), (getEndMs(request) - getStartMs(request)) / 2);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115          }                                                                                                         </span>
<span  style=""> 116                                                                                                                    </span>
<span class="-8453711403554538500" onmouseenter="enter('-8453711403554538500');" onmouseout="out('-8453711403554538500');" style=""> 117          public static long getStartMsSupportFlex(JobRequest request) {                                            </span>
<span class="4867134151855536256" onmouseenter="enter('4867134151855536256');" onmouseout="out('4867134151855536256');" style=""> 118              return Math.max(1, request.getIntervalMs() - request.getFlexMs());                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119          }                                                                                                         </span>
<span  style=""> 120                                                                                                                    </span>
<span class="2402850512558550424" onmouseenter="enter('2402850512558550424');" onmouseout="out('2402850512558550424');" style=""> 121          public static long getEndMsSupportFlex(JobRequest request) {                                              </span>
<span class="1818143853198758132" onmouseenter="enter('1818143853198758132');" onmouseout="out('1818143853198758132');" style=""> 122              return request.getIntervalMs();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123          }                                                                                                         </span>
<span  style=""> 124                                                                                                                    </span>
<span class="5236833657260895409" onmouseenter="enter('5236833657260895409');" onmouseout="out('5236833657260895409');" style=""> 125          public static long getAverageDelayMsSupportFlex(JobRequest request) {                                     </span>
<span class="1202002964551881523" onmouseenter="enter('1202002964551881523');" onmouseout="out('1202002964551881523');" style=""><abbr title=" 126              return checkedAdd(getStartMsSupportFlex(request), (getEndMsSupportFlex(request) - getStartMsSupportFlex(request)) / 2);"> 126              return checkedAdd(getStartMsSupportFlex(request), (getEndMsSupportFlex(request) - getStartMsSupportFle🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127          }                                                                                                         </span>
<span  style=""> 128                                                                                                                    </span>
<span class="5683661540559112003" onmouseenter="enter('5683661540559112003');" onmouseout="out('5683661540559112003');" style=""> 129          public static int getRescheduleCount(JobRequest request) {                                                </span>
<span class="6823077784476657246" onmouseenter="enter('6823077784476657246');" onmouseout="out('6823077784476657246');" style=""> 130              return request.getFailureCount();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131          }                                                                                                         </span>
<span  style=""> 132                                                                                                                    </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style=""> 133          private final Context mContext;                                                                           </span>
<span class="3051386596282037072" onmouseenter="enter('3051386596282037072');" onmouseout="out('3051386596282037072');" style=""> 134          private final int mJobId;                                                                                 </span>
<span class="6179859670209082226" onmouseenter="enter('6179859670209082226');" onmouseout="out('6179859670209082226');" style=""> 135          private final CatLog mCat;                                                                                </span>
<span  style=""> 136                                                                                                                    </span>
<span class="5239517905467210385" onmouseenter="enter('5239517905467210385');" onmouseout="out('5239517905467210385');" style=""> 137          private final JobManager mJobManager;                                                                     </span>
<span  style=""> 138                                                                                                                    </span>
<span class="-8396683440428310884" onmouseenter="enter('-8396683440428310884');" onmouseout="out('-8396683440428310884');" style=""> 139          public Common(@NonNull Service service, CatLog cat, int jobId) {                                          </span>
<span class="-373217571160035833" onmouseenter="enter('-373217571160035833');" onmouseout="out('-373217571160035833');" style=""> 140              this((Context) service, cat, jobId);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141          }                                                                                                         </span>
<span  style=""> 142                                                                                                                    </span>
<span class="-8666365961470977949" onmouseenter="enter('-8666365961470977949');" onmouseout="out('-8666365961470977949');" style=""> 143          /*package*/ Common(@NonNull Context context, CatLog cat, int jobId) {                                     </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 144              mContext = context;                                                                                   </span>
<span class="3380959276812020408" onmouseenter="enter('3380959276812020408');" onmouseout="out('3380959276812020408');" style=""> 145              mJobId = jobId;                                                                                       </span>
<span class="-7514169524268117475" onmouseenter="enter('-7514169524268117475');" onmouseout="out('-7514169524268117475');" style=""> 146              mCat = cat;                                                                                           </span>
<span  style=""> 147                                                                                                                    </span>
<span class="2088134523180067307" onmouseenter="enter('2088134523180067307');" onmouseout="out('2088134523180067307');" style=""> 148              mJobManager = JobManager.create(context);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 149          }                                                                                                         </span>
<span  style=""> 150                                                                                                                    </span>
<span class="-5511335237538855208" onmouseenter="enter('-5511335237538855208');" onmouseout="out('-5511335237538855208');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 151 -        public JobRequest getPendingRequest(boolean cleanUpOrphanedJob) {                                         </span>
<span class="-4157356782926206773" onmouseenter="enter('-4157356782926206773');" onmouseout="out('-4157356782926206773');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +        public JobRequest getPendingRequest(@SuppressWarnings(&quot;SameParameterValue&quot;) boolean cleanUpOrphanedJob) { </span>
<span class="-1539078468410613703" onmouseenter="enter('-1539078468410613703');" onmouseout="out('-1539078468410613703');" style=""> 153              // order is important for logging purposes                                                            </span>
<span class="6754931577315038874" onmouseenter="enter('6754931577315038874');" onmouseout="out('6754931577315038874');" style=""> 154              JobRequest request = mJobManager.getJobRequest(mJobId, true);                                         </span>
<span class="-4807858926389575759" onmouseenter="enter('-4807858926389575759');" onmouseout="out('-4807858926389575759');" style=""> 155              Job job = mJobManager.getJob(mJobId);                                                                 </span>
<span class="80157358755741526" onmouseenter="enter('80157358755741526');" onmouseout="out('80157358755741526');" style=""> 156              boolean periodic = request != null &amp;&amp; request.isPeriodic();                                           </span>
<span  style=""> 157                                                                                                                    </span>
<span class="1317679291661326604" onmouseenter="enter('1317679291661326604');" onmouseout="out('1317679291661326604');" style=""> 158              if (job != null &amp;&amp; !job.isFinished()) {                                                               </span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style=""><abbr title=" 159                  // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 159                  // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting🔵</abbr></span>
<span class="-5462975656818636592" onmouseenter="enter('-5462975656818636592');" onmouseout="out('-5462975656818636592');" style=""> 160                  mCat.d(&quot;Job %d is already running, %s&quot;, mJobId, request);                                         </span>
<span class="-8865814855968501379" onmouseenter="enter('-8865814855968501379');" onmouseout="out('-8865814855968501379');" style=""> 161                  // not necessary to clean up, the running instance will do that                                   </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 162                  return null;                                                                                      </span>
<span  style=""> 163                                                                                                                    </span>
<span class="-4007651353712364444" onmouseenter="enter('-4007651353712364444');" onmouseout="out('-4007651353712364444');" style=""> 164              } else if (job != null &amp;&amp; !periodic) {                                                                </span>
<span class="599327769680236656" onmouseenter="enter('599327769680236656');" onmouseout="out('599327769680236656');" style=""> 165                  mCat.d(&quot;Job %d already finished, %s&quot;, mJobId, request);                                           </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style=""> 166                  cleanUpOrphanedJob(cleanUpOrphanedJob);                                                           </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 167                  return null;                                                                                      </span>
<span  style=""> 168                                                                                                                    </span>
<span class="-4441559070839346687" onmouseenter="enter('-4441559070839346687');" onmouseout="out('-4441559070839346687');" style=""> 169              } else if (job != null &amp;&amp; System.currentTimeMillis() - job.getFinishedTimeStamp() &lt; 2_000) {          </span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style=""><abbr title=" 170                  // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 170                  // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting🔵</abbr></span>
<span class="-2963240540698415567" onmouseenter="enter('-2963240540698415567');" onmouseout="out('-2963240540698415567');" style=""> 171                  mCat.d(&quot;Job %d is periodic and just finished, %s&quot;, mJobId, request);                              </span>
<span class="5118828189189336116" onmouseenter="enter('5118828189189336116');" onmouseout="out('5118828189189336116');" style=""> 172                  // don&#x27;t clean up, periodic job                                                                   </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 173                  return null;                                                                                      </span>
<span  style=""> 174                                                                                                                    </span>
<span class="-6449094046803794181" onmouseenter="enter('-6449094046803794181');" onmouseout="out('-6449094046803794181');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 175 -            } else if (request != null &amp;&amp; request.isTransient()) {                                                </span>
<span class="4384727207576607146" onmouseenter="enter('4384727207576607146');" onmouseout="out('4384727207576607146');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 176 -                mCat.d(&quot;Request %d is transient, %s&quot;, mJobId, request);                                           </span>
<span class="5877082491190597240" onmouseenter="enter('5877082491190597240');" onmouseout="out('5877082491190597240');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 177 -                // not necessary to clean up, the JobManager will do this for transient jobs                      </span>
<span class="-4719477180175309163" onmouseenter="enter('-4719477180175309163');" onmouseout="out('-4719477180175309163');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 178 +            } else if (request != null &amp;&amp; request.isStarted()) {                                                  </span>
<span class="2694894942883236024" onmouseenter="enter('2694894942883236024');" onmouseout="out('2694894942883236024');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 179 +                mCat.d(&quot;Request %d already started, %s&quot;, mJobId, request);                                        </span>
<span class="3715771020426903748" onmouseenter="enter('3715771020426903748');" onmouseout="out('3715771020426903748');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 180 +                // not necessary to clean up, the JobManager will do this for started jobs                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 181                  return null;                                                                                      </span>
<span  style=""> 182                                                                                                                    </span>
<span class="-4428555773566380837" onmouseenter="enter('-4428555773566380837');" onmouseout="out('-4428555773566380837');" style=""> 183              } else if (request == null) {                                                                         </span>
<span class="7609103357697598215" onmouseenter="enter('7609103357697598215');" onmouseout="out('7609103357697598215');" style=""> 184                  mCat.d(&quot;Request for ID %d was null&quot;, mJobId);                                                     </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style=""> 185                  cleanUpOrphanedJob(cleanUpOrphanedJob);                                                           </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 186                  return null;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187              }                                                                                                     </span>
<span  style=""> 188                                                                                                                    </span>
<span class="-1057636993633179522" onmouseenter="enter('-1057636993633179522');" onmouseout="out('-1057636993633179522');" style=""> 189              return request;                                                                                       </span>













































<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190          }                                                                                                         </span>
<span  style=""> 191                                                                                                                    </span>
<span class="5154748246392482767" onmouseenter="enter('5154748246392482767');" onmouseout="out('5154748246392482767');" style=""> 192          @NonNull                                                                                                  </span>
<span class="1474434811491937762" onmouseenter="enter('1474434811491937762');" onmouseout="out('1474434811491937762');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 193 -        public Job.Result executeJobRequest(@NonNull JobRequest request) {                                        </span>
<span class="4426606055051844156" onmouseenter="enter('4426606055051844156');" onmouseout="out('4426606055051844156');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 194 +        public Job.Result executeJobRequest(@NonNull JobRequest request, @Nullable Bundle transientExtras) {      </span>
<span class="8785519441075077783" onmouseenter="enter('8785519441075077783');" onmouseout="out('8785519441075077783');" style=""> 195              long waited = System.currentTimeMillis() - request.getScheduledAt();                                  </span>
<span class="-521988911558271196" onmouseenter="enter('-521988911558271196');" onmouseout="out('-521988911558271196');" style=""> 196              String timeWindow;                                                                                    </span>
<span class="-4749167882947985624" onmouseenter="enter('-4749167882947985624');" onmouseout="out('-4749167882947985624');" style=""> 197              if (request.isPeriodic()) {                                                                           </span>
<span class="22254303833830880" onmouseenter="enter('22254303833830880');" onmouseout="out('22254303833830880');" style=""><abbr title=" 198                  timeWindow = String.format(Locale.US, &quot;interval %s, flex %s&quot;, JobUtil.timeToString(request.getIntervalMs()),"> 198                  timeWindow = String.format(Locale.US, &quot;interval %s, flex %s&quot;, JobUtil.timeToString(request.getInte🔵</abbr></span>
<span class="-7441385486773924310" onmouseenter="enter('-7441385486773924310');" onmouseout="out('-7441385486773924310');" style=""> 199                          JobUtil.timeToString(request.getFlexMs()));                                               </span>
<span class="4779514256224206313" onmouseenter="enter('4779514256224206313');" onmouseout="out('4779514256224206313');" style=""> 200              } else if (request.getJobApi().supportsExecutionWindow()) {                                           </span>
<span class="-6246254348184491385" onmouseenter="enter('-6246254348184491385');" onmouseout="out('-6246254348184491385');" style=""><abbr title=" 201                  timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMs(request)),"> 201                  timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMs(request)🔵</abbr></span>
<span class="6965396589660564452" onmouseenter="enter('6965396589660564452');" onmouseout="out('6965396589660564452');" style=""> 202                          JobUtil.timeToString(getEndMs(request)));                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 203              } else {                                                                                              </span>
<span class="-1520611369215068334" onmouseenter="enter('-1520611369215068334');" onmouseout="out('-1520611369215068334');" style=""> 204                  timeWindow = &quot;delay &quot; + JobUtil.timeToString(getAverageDelayMs(request));                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 205              }                                                                                                     </span>
<span  style=""> 206                                                                                                                    </span>
<span class="-8808967967811702611" onmouseenter="enter('-8808967967811702611');" onmouseout="out('-8808967967811702611');" style=""> 207              if (Looper.myLooper() == Looper.getMainLooper()) {                                                    </span>
<span class="-1368751502622418275" onmouseenter="enter('-1368751502622418275');" onmouseout="out('-1368751502622418275');" style=""> 208                  mCat.w(&quot;Running JobRequest on a main thread, this could cause stutter or ANR in your app.&quot;);      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209              }                                                                                                     </span>
<span  style=""> 210                                                                                                                    </span>
<span class="-1843046913616870974" onmouseenter="enter('-1843046913616870974');" onmouseout="out('-1843046913616870974');" style=""> 211              mCat.d(&quot;Run job, %s, waited %s, %s&quot;, request, JobUtil.timeToString(waited), timeWindow);              </span>
<span class="-4828048199353050218" onmouseenter="enter('-4828048199353050218');" onmouseout="out('-4828048199353050218');" style=""> 212              JobExecutor jobExecutor = mJobManager.getJobExecutor();                                               </span>
<span class="-1235692988875235782" onmouseenter="enter('-1235692988875235782');" onmouseout="out('-1235692988875235782');" style=""> 213              Job job = null;                                                                                       </span>
<span  style=""> 214                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 215              try {                                                                                                 </span>
<span class="-9073677935190895883" onmouseenter="enter('-9073677935190895883');" onmouseout="out('-9073677935190895883');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 216 -                // create job first before setting it transient, avoids a race condition while rescheduling jobs  </span>
<span class="-4769195842780086458" onmouseenter="enter('-4769195842780086458');" onmouseout="out('-4769195842780086458');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 217 +                // create job first before setting it started, avoids a race condition while rescheduling jobs    </span>
<span class="1625132338136195706" onmouseenter="enter('1625132338136195706');" onmouseout="out('1625132338136195706');" style=""> 218                  job = mJobManager.getJobCreatorHolder().createJob(request.getTag());                              </span>
<span  style=""> 219                                                                                                                    </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 220                  if (!request.isPeriodic()) {                                                                      </span>
<span class="3122394794119912241" onmouseenter="enter('3122394794119912241');" onmouseout="out('3122394794119912241');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 221 -                    request.setTransient(true);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 222 -                }                                                                                                 </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 223 -                                                                                                                  </span>
<span class="-2797125910631995922" onmouseenter="enter('-2797125910631995922');" onmouseout="out('-2797125910631995922');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 224 -                Future&lt;Job.Result&gt; future = jobExecutor.execute(mContext, request, job);                          </span>
<span class="4919726022962249182" onmouseenter="enter('4919726022962249182');" onmouseout="out('4919726022962249182');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 225 +                    request.setStarted(true);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 226 +                }                                                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 227 +                                                                                                                  </span>
<span class="-7821317659145756468" onmouseenter="enter('-7821317659145756468');" onmouseout="out('-7821317659145756468');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 228 +                if (transientExtras == null) {                                                                    </span>
<span class="-387255381167201921" onmouseenter="enter('-387255381167201921');" onmouseout="out('-387255381167201921');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 229 +                    transientExtras = Bundle.EMPTY;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 230 +                }                                                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 231 +                                                                                                                  </span>
<span class="8687421104735025391" onmouseenter="enter('8687421104735025391');" onmouseout="out('8687421104735025391');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 232 +                Future&lt;Job.Result&gt; future = jobExecutor.execute(mContext, request, job, transientExtras);         </span>
<span class="-4410702629486134619" onmouseenter="enter('-4410702629486134619');" onmouseout="out('-4410702629486134619');" style=""> 233                  if (future == null) {                                                                             </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 234                      return Job.Result.FAILURE;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235                  }                                                                                                 </span>
<span  style=""> 236                                                                                                                    </span>
<span class="5244342940061655384" onmouseenter="enter('5244342940061655384');" onmouseout="out('5244342940061655384');" style=""> 237                  // wait until done                                                                                </span>
<span class="-4728317628971455727" onmouseenter="enter('-4728317628971455727');" onmouseout="out('-4728317628971455727');" style=""> 238                  Job.Result result = future.get();                                                                 </span>
<span class="368857225067072174" onmouseenter="enter('368857225067072174');" onmouseout="out('368857225067072174');" style=""> 239                  mCat.d(&quot;Finished job, %s %s&quot;, request, result);                                                   </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 240                  return result;                                                                                    </span>
<span  style=""> 241                                                                                                                    </span>
<span class="2273166757001165010" onmouseenter="enter('2273166757001165010');" onmouseout="out('2273166757001165010');" style=""> 242              } catch (InterruptedException | ExecutionException e) {                                               </span>
<span class="-1683580236663429788" onmouseenter="enter('-1683580236663429788');" onmouseout="out('-1683580236663429788');" style=""> 243                  mCat.e(e);                                                                                        </span>
<span  style=""> 244                                                                                                                    </span>
<span class="6519543964694909858" onmouseenter="enter('6519543964694909858');" onmouseout="out('6519543964694909858');" style=""> 245                  if (job != null) {                                                                                </span>
<span class="-9041905225007822866" onmouseenter="enter('-9041905225007822866');" onmouseout="out('-9041905225007822866');" style=""> 246                      job.cancel();                                                                                 </span>
<span class="3580809215980372017" onmouseenter="enter('3580809215980372017');" onmouseout="out('3580809215980372017');" style=""> 247                      mCat.e(&quot;Canceled %s&quot;, request);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248                  }                                                                                                 </span>
<span  style=""> 249                                                                                                                    </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 250                  return Job.Result.FAILURE;                                                                        </span>
<span  style=""> 251                                                                                                                    </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 252              } finally {                                                                                           </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 253                  if (!request.isPeriodic()) {                                                                      </span>
<span class="1449747436325478708" onmouseenter="enter('1449747436325478708');" onmouseout="out('1449747436325478708');" style=""> 254                      mJobManager.getJobStorage().remove(request);                                                  </span>
<span  style=""> 255                                                                                                                    </span>
<span class="-2333237089390189385" onmouseenter="enter('-2333237089390189385');" onmouseout="out('-2333237089390189385');" style=""> 256                  } else if (request.isFlexSupport()) {                                                             </span>
<span class="733386345181994468" onmouseenter="enter('733386345181994468');" onmouseout="out('733386345181994468');" style=""><abbr title=" 257                      mJobManager.getJobStorage().remove(request); // remove, we store the new job in JobManager.schedule()"> 257                      mJobManager.getJobStorage().remove(request); // remove, we store the new job in JobManager.sch🔵</abbr></span>
<span class="2102053740633122535" onmouseenter="enter('2102053740633122535');" onmouseout="out('2102053740633122535');" style=""> 258                      request.reschedule(false, false);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261          }                                                                                                         </span>
<span  style=""> 262                                                                                                                    </span>
<span class="-3194552414098127961" onmouseenter="enter('-3194552414098127961');" onmouseout="out('-3194552414098127961');" style=""> 263          private void cleanUpOrphanedJob(boolean cleanUp) {                                                        </span>
<span class="8101282554241671494" onmouseenter="enter('8101282554241671494');" onmouseout="out('8101282554241671494');" style=""> 264              if (cleanUp) {                                                                                        </span>
<span class="6651175145696850096" onmouseenter="enter('6651175145696850096');" onmouseout="out('6651175145696850096');" style=""> 265                  cleanUpOrphanedJob(mContext, mJobId);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267          }                                                                                                         </span>
<span  style=""> 268                                                                                                                    </span>
<span class="3574082725044615574" onmouseenter="enter('3574082725044615574');" onmouseout="out('3574082725044615574');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 269 -        public static void cleanUpOrphanedJob(Context context, int jobId) {                                       </span>
<span class="-4527238056439721160" onmouseenter="enter('-4527238056439721160');" onmouseout="out('-4527238056439721160');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 270 +        /*package*/ static void cleanUpOrphanedJob(Context context, int jobId) {                                  </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 271              /*                                                                                                    </span>
<span class="4873467377157825728" onmouseenter="enter('4873467377157825728');" onmouseout="out('4873467377157825728');" style=""><abbr title=" 272               * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are still around."> 272               * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are still aroun🔵</abbr></span>
<span class="7880315656890986822" onmouseenter="enter('7880315656890986822');" onmouseout="out('7880315656890986822');" style=""><abbr title=" 273               * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the old one. Here"> 273               * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the old one. Her🔵</abbr></span>
<span class="7642695698821586509" onmouseenter="enter('7642695698821586509');" onmouseout="out('7642695698821586509');" style=""> 274               * we make sure, that no job is left in the system.                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 275               */                                                                                                   </span>
<span class="-1280302924927314158" onmouseenter="enter('-1280302924927314158');" onmouseout="out('-1280302924927314158');" style=""> 276              for (JobApi jobApi : JobApi.values()) {                                                               </span>
<span class="-5474372138432799739" onmouseenter="enter('-5474372138432799739');" onmouseout="out('-5474372138432799739');" style=""> 277                  if (jobApi.isSupported(context)) {                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 278                      try {                                                                                         </span>
<span class="-5924449239106429276" onmouseenter="enter('-5924449239106429276');" onmouseout="out('-5924449239106429276');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 279 -                        jobApi.getCachedProxy(context).cancel(jobId);                                             </span>
<span class="4287784381767543802" onmouseenter="enter('4287784381767543802');" onmouseout="out('4287784381767543802');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 280 +                        jobApi.getProxy(context).cancel(jobId);                                                   </span>
<span class="8538742657781196138" onmouseenter="enter('8538742657781196138');" onmouseout="out('8538742657781196138');" style=""> 281                      } catch (Exception ignored) {                                                                 </span>
<span class="-571140832119819901" onmouseenter="enter('-571140832119819901');" onmouseout="out('-571140832119819901');" style=""> 282                          // GCM API could crash if it&#x27;s disabled, ignore crashes at this point and continue        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286          }                                                                                                         </span>
<span  style=""> 287                                                                                                                    </span>
<span class="5053639476535817445" onmouseenter="enter('5053639476535817445');" onmouseout="out('5053639476535817445');" style=""> 288          public static ComponentName startWakefulService(Context context, Intent intent) {                         </span>
<span class="-2841441978426476425" onmouseenter="enter('-2841441978426476425');" onmouseout="out('-2841441978426476425');" style=""> 289              return WakeLockUtil.startWakefulService(context, intent);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290          }                                                                                                         </span>
<span  style=""> 291                                                                                                                    </span>
<span class="-5135813554980344335" onmouseenter="enter('-5135813554980344335');" onmouseout="out('-5135813554980344335');" style=""> 292          public static boolean completeWakefulIntent(Intent intent) {                                              </span>
<span class="-1383746570627903167" onmouseenter="enter('-1383746570627903167');" onmouseout="out('-1383746570627903167');" style=""> 293              return WakeLockUtil.completeWakefulIntent(intent);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-8822900351790619766" onmouseenter="enter('-8822900351790619766');" onmouseout="out('-8822900351790619766');" style="">   2   * Copyright 2007-present Evernote Corporation.                                                                   </span>
<span class="-2278367542838177584" onmouseenter="enter('-2278367542838177584');" onmouseout="out('-2278367542838177584');" style="">   3   * All rights reserved.                                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   4   *                                                                                                                </span>
<span class="181301442133285836" onmouseenter="enter('181301442133285836');" onmouseout="out('181301442133285836');" style="">   5   * Redistribution and use in source and binary forms, with or without modification,                               </span>
<span class="-5073197948967426970" onmouseenter="enter('-5073197948967426970');" onmouseout="out('-5073197948967426970');" style="">   6   * are permitted provided that the following conditions are met:                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="8127251449117563942" onmouseenter="enter('8127251449117563942');" onmouseout="out('8127251449117563942');" style="">   8   * 1. Redistributions of source code must retain the above copyright notice, this                                 </span>
<span class="-1473911044945790828" onmouseenter="enter('-1473911044945790828');" onmouseout="out('-1473911044945790828');" style="">   9   *    list of conditions and the following disclaimer.                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  10   *                                                                                                                </span>
<span class="4835137028529553232" onmouseenter="enter('4835137028529553232');" onmouseout="out('4835137028529553232');" style="">  11   * 2. Redistributions in binary form must reproduce the above copyright notice,                                   </span>
<span class="-1312443230807442131" onmouseenter="enter('-1312443230807442131');" onmouseout="out('-1312443230807442131');" style="">  12   *    this list of conditions and the following disclaimer in the documentation                                   </span>
<span class="-2067912076149043179" onmouseenter="enter('-2067912076149043179');" onmouseout="out('-2067912076149043179');" style="">  13   *    and/or other materials provided with the distribution.                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  14   *                                                                                                                </span>
<span class="-7721941782677048447" onmouseenter="enter('-7721941782677048447');" onmouseout="out('-7721941782677048447');" style="">  15   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND                                </span>
<span class="-5124048439450882348" onmouseenter="enter('-5124048439450882348');" onmouseout="out('-5124048439450882348');" style="">  16   * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED                                  </span>
<span class="2277289959795125050" onmouseenter="enter('2277289959795125050');" onmouseout="out('2277289959795125050');" style="">  17   * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.                             </span>
<span class="4422846307625339339" onmouseenter="enter('4422846307625339339');" onmouseout="out('4422846307625339339');" style="">  18   * IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,                                </span>
<span class="9023453646714579255" onmouseenter="enter('9023453646714579255');" onmouseout="out('9023453646714579255');" style="">  19   * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,                                 </span>
<span class="2153827234735713132" onmouseenter="enter('2153827234735713132');" onmouseout="out('2153827234735713132');" style="">  20   * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,                                  </span>
<span class="5782830561991082866" onmouseenter="enter('5782830561991082866');" onmouseout="out('5782830561991082866');" style="">  21   * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF                                </span>
<span class="-2513683953102966204" onmouseenter="enter('-2513683953102966204');" onmouseout="out('-2513683953102966204');" style="">  22   * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE                                </span>
<span class="-6562574984275957691" onmouseenter="enter('-6562574984275957691');" onmouseout="out('-6562574984275957691');" style="">  23   * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF                                      </span>
<span class="505998933154990042" onmouseenter="enter('505998933154990042');" onmouseout="out('505998933154990042');" style="">  24   * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  25   */                                                                                                               </span>
<span class="4675552543740820910" onmouseenter="enter('4675552543740820910');" onmouseout="out('4675552543740820910');" style="">  26  package com.evernote.android.job;                                                                                 </span>
<span  style="">  27                                                                                                                    </span>
<span class="-1261404242645970098" onmouseenter="enter('-1261404242645970098');" onmouseout="out('-1261404242645970098');" style="">  28  import android.app.Service;                                                                                       </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  29  import android.content.ComponentName;                                                                             </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  30  import android.content.Context;                                                                                   </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  31  import android.content.Intent;                                                                                    </span>

<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="">  32  import android.os.Looper;                                                                                         </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  33  import android.support.annotation.NonNull;                                                                        </span>
<span  style="">  34                                                                                                                    </span>
<span class="-2629940017315809162" onmouseenter="enter('-2629940017315809162');" onmouseout="out('-2629940017315809162');" style="">  35  import com.evernote.android.job.util.JobApi;                                                                      </span>


<span class="2270421051523495577" onmouseenter="enter('2270421051523495577');" onmouseout="out('2270421051523495577');" style="">  36  import com.evernote.android.job.util.JobUtil;                                                                     </span>
<span  style="">  37                                                                                                                    </span>
<span class="4887698622156748971" onmouseenter="enter('4887698622156748971');" onmouseout="out('4887698622156748971');" style="">  38  import net.vrallev.android.cat.CatLog;                                                                            </span>
<span  style="">  39                                                                                                                    </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="">  40  import java.util.Locale;                                                                                          </span>
<span class="6613496282884511495" onmouseenter="enter('6613496282884511495');" onmouseout="out('6613496282884511495');" style="">  41  import java.util.concurrent.ExecutionException;                                                                   </span>
<span class="-331778695229620376" onmouseenter="enter('-331778695229620376');" onmouseout="out('-331778695229620376');" style="">  42  import java.util.concurrent.Future;                                                                               </span>
<span class="1867212591271003466" onmouseenter="enter('1867212591271003466');" onmouseout="out('1867212591271003466');" style="">  43  import java.util.concurrent.ThreadFactory;                                                                        </span>
<span class="7979168040994256185" onmouseenter="enter('7979168040994256185');" onmouseout="out('7979168040994256185');" style="">  44  import java.util.concurrent.atomic.AtomicInteger;                                                                 </span>
<span  style="">  45                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  46  /**                                                                                                               </span>
<span class="-126646863796949621" onmouseenter="enter('-126646863796949621');" onmouseout="out('-126646863796949621');" style="">  47   * A proxy for each {@link JobApi}.                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  48   *                                                                                                                </span>
<span class="-2541210092808878866" onmouseenter="enter('-2541210092808878866');" onmouseout="out('-2541210092808878866');" style="">  49   * @author rwondratschek                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  50   */                                                                                                               </span>
<span class="1140466455373644171" onmouseenter="enter('1140466455373644171');" onmouseout="out('1140466455373644171');" style="">  51  public interface JobProxy {                                                                                       </span>
<span  style="">  52                                                                                                                    </span>
<span class="-8144897713900189970" onmouseenter="enter('-8144897713900189970');" onmouseout="out('-8144897713900189970');" style="">  53      void plantOneOff(JobRequest request);                                                                         </span>
<span  style="">  54                                                                                                                    </span>
<span class="-2416890449051145953" onmouseenter="enter('-2416890449051145953');" onmouseout="out('-2416890449051145953');" style="">  55      void plantPeriodic(JobRequest request);                                                                       </span>
<span  style="">  56                                                                                                                    </span>
<span class="6309911337945331379" onmouseenter="enter('6309911337945331379');" onmouseout="out('6309911337945331379');" style="">  57      void plantPeriodicFlexSupport(JobRequest request);                                                            </span>
<span  style="">  58                                                                                                                    </span>
<span class="8340124833639515371" onmouseenter="enter('8340124833639515371');" onmouseout="out('8340124833639515371');" style="">  59      void cancel(int jobId);                                                                                       </span>
<span  style="">  60                                                                                                                    </span>
<span class="-6161809553933645851" onmouseenter="enter('-6161809553933645851');" onmouseout="out('-6161809553933645851');" style="">  61      boolean isPlatformJobScheduled(JobRequest request);                                                           </span>
<span  style="">  62                                                                                                                    </span>

<span class="1769639894748899311" onmouseenter="enter('1769639894748899311');" onmouseout="out('1769639894748899311');" style="">  63      /*package*/ final class Common {                                                                              </span>
<span  style="">  64                                                                                                                    </span>
<span class="-7267523611033686156" onmouseenter="enter('-7267523611033686156');" onmouseout="out('-7267523611033686156');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  65 +        private static final Object COMMON_MONITOR = new Object();                                                </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +                                                                                                                  </span>
<span class="142194204239450957" onmouseenter="enter('142194204239450957');" onmouseout="out('142194204239450957');" style="">  67          public static final ThreadFactory COMMON_THREAD_FACTORY = new ThreadFactory() {                           </span>
<span  style="">  68                                                                                                                    </span>
<span class="8379292492229673398" onmouseenter="enter('8379292492229673398');" onmouseout="out('8379292492229673398');" style="">  69              private final AtomicInteger mThreadNumber = new AtomicInteger();                                      </span>
<span  style="">  70                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  71              @Override                                                                                             </span>
<span class="5852676775001677995" onmouseenter="enter('5852676775001677995');" onmouseout="out('5852676775001677995');" style="">  72              public Thread newThread(Runnable r) {                                                                 </span>

<span class="-2238610439465529740" onmouseenter="enter('-2238610439465529740');" onmouseout="out('-2238610439465529740');" style="">  73                  Thread thread = new Thread(r, &quot;AndroidJob-&quot; + mThreadNumber.incrementAndGet());                   </span>
<span class="-2780159030059633262" onmouseenter="enter('-2780159030059633262');" onmouseout="out('-2780159030059633262');" style="">  74                  if (thread.isDaemon()) {                                                                          </span>
<span class="-6985289869807539393" onmouseenter="enter('-6985289869807539393');" onmouseout="out('-6985289869807539393');" style="">  75                      thread.setDaemon(false);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  76                  }                                                                                                 </span>
<span class="3121234640013807968" onmouseenter="enter('3121234640013807968');" onmouseout="out('3121234640013807968');" style="">  77                  if (thread.getPriority() != Thread.NORM_PRIORITY) {                                               </span>
<span class="3041005067018043930" onmouseenter="enter('3041005067018043930');" onmouseout="out('3041005067018043930');" style="">  78                      thread.setPriority(Thread.NORM_PRIORITY);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  79                  }                                                                                                 </span>
<span class="3079099442831550764" onmouseenter="enter('3079099442831550764');" onmouseout="out('3079099442831550764');" style="">  80                  return thread;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  81              }                                                                                                     </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style="">  82          };                                                                                                        </span>
<span  style="">  83                                                                                                                    </span>
<span class="8412616957402907467" onmouseenter="enter('8412616957402907467');" onmouseout="out('8412616957402907467');" style=""><abbr title="  84          // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/math/LongMath.java">  84          // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/math/LongMath🔵</abbr></span>
<span class="-1572685421845796133" onmouseenter="enter('-1572685421845796133');" onmouseout="out('-1572685421845796133');" style="">  85          private static long checkedAdd(long a, long b) {                                                          </span>
<span class="-1527942472133998342" onmouseenter="enter('-1527942472133998342');" onmouseout="out('-1527942472133998342');" style="">  86              long result = a + b;                                                                                  </span>
<span class="-8281399218677613001" onmouseenter="enter('-8281399218677613001');" onmouseout="out('-8281399218677613001');" style="">  87              return checkNoOverflow(result, (a ^ b) &lt; 0 | (a ^ result) &gt;= 0);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  88          }                                                                                                         </span>
<span  style="">  89                                                                                                                    </span>
<span class="6423040751114649745" onmouseenter="enter('6423040751114649745');" onmouseout="out('6423040751114649745');" style="">  90          private static long checkNoOverflow(long result, boolean condition) {                                     </span>
<span class="6603368327369456734" onmouseenter="enter('6603368327369456734');" onmouseout="out('6603368327369456734');" style="">  91              return condition ? result : Long.MAX_VALUE;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  92          }                                                                                                         </span>
<span  style="">  93                                                                                                                    </span>
<span class="1406832824568924523" onmouseenter="enter('1406832824568924523');" onmouseout="out('1406832824568924523');" style="">  94          public static long getStartMs(JobRequest request) {                                                       </span>
<span class="-6205484021482461183" onmouseenter="enter('-6205484021482461183');" onmouseout="out('-6205484021482461183');" style="">  95              if (request.getFailureCount() &gt; 0) {                                                                  </span>
<span class="9206292300770255130" onmouseenter="enter('9206292300770255130');" onmouseout="out('9206292300770255130');" style="">  96                  return request.getBackoffOffset();                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  97              } else {                                                                                              </span>
<span class="-8332790610925894090" onmouseenter="enter('-8332790610925894090');" onmouseout="out('-8332790610925894090');" style="">  98                  return request.getStartMs();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 100          }                                                                                                         </span>
<span  style=""> 101                                                                                                                    </span>
<span class="-3832824197988283345" onmouseenter="enter('-3832824197988283345');" onmouseout="out('-3832824197988283345');" style=""> 102          public static long getEndMs(JobRequest request) {                                                         </span>
<span class="-6205484021482461183" onmouseenter="enter('-6205484021482461183');" onmouseout="out('-6205484021482461183');" style=""> 103              if (request.getFailureCount() &gt; 0) {                                                                  </span>
<span class="9206292300770255130" onmouseenter="enter('9206292300770255130');" onmouseout="out('9206292300770255130');" style=""> 104                  return request.getBackoffOffset();                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 105              } else {                                                                                              </span>
<span class="3799819942554251441" onmouseenter="enter('3799819942554251441');" onmouseout="out('3799819942554251441');" style=""> 106                  return request.getEndMs();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108          }                                                                                                         </span>
<span  style=""> 109                                                                                                                    </span>
<span class="2658461420075954163" onmouseenter="enter('2658461420075954163');" onmouseout="out('2658461420075954163');" style=""> 110          public static long getAverageDelayMs(JobRequest request) {                                                </span>
<span class="5188333912507681776" onmouseenter="enter('5188333912507681776');" onmouseout="out('5188333912507681776');" style=""> 111              return checkedAdd(getStartMs(request), (getEndMs(request) - getStartMs(request)) / 2);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112          }                                                                                                         </span>
<span  style=""> 113                                                                                                                    </span>
<span class="-8453711403554538500" onmouseenter="enter('-8453711403554538500');" onmouseout="out('-8453711403554538500');" style=""> 114          public static long getStartMsSupportFlex(JobRequest request) {                                            </span>
<span class="4867134151855536256" onmouseenter="enter('4867134151855536256');" onmouseout="out('4867134151855536256');" style=""> 115              return Math.max(1, request.getIntervalMs() - request.getFlexMs());                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116          }                                                                                                         </span>
<span  style=""> 117                                                                                                                    </span>
<span class="2402850512558550424" onmouseenter="enter('2402850512558550424');" onmouseout="out('2402850512558550424');" style=""> 118          public static long getEndMsSupportFlex(JobRequest request) {                                              </span>
<span class="1818143853198758132" onmouseenter="enter('1818143853198758132');" onmouseout="out('1818143853198758132');" style=""> 119              return request.getIntervalMs();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 120          }                                                                                                         </span>
<span  style=""> 121                                                                                                                    </span>
<span class="5236833657260895409" onmouseenter="enter('5236833657260895409');" onmouseout="out('5236833657260895409');" style=""> 122          public static long getAverageDelayMsSupportFlex(JobRequest request) {                                     </span>
<span class="1202002964551881523" onmouseenter="enter('1202002964551881523');" onmouseout="out('1202002964551881523');" style=""><abbr title=" 123              return checkedAdd(getStartMsSupportFlex(request), (getEndMsSupportFlex(request) - getStartMsSupportFlex(request)) / 2);"> 123              return checkedAdd(getStartMsSupportFlex(request), (getEndMsSupportFlex(request) - getStartMsSupportFle🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124          }                                                                                                         </span>
<span  style=""> 125                                                                                                                    </span>
<span class="5683661540559112003" onmouseenter="enter('5683661540559112003');" onmouseout="out('5683661540559112003');" style=""> 126          public static int getRescheduleCount(JobRequest request) {                                                </span>
<span class="6823077784476657246" onmouseenter="enter('6823077784476657246');" onmouseout="out('6823077784476657246');" style=""> 127              return request.getFailureCount();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128          }                                                                                                         </span>
<span  style=""> 129                                                                                                                    </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style=""> 130          private final Context mContext;                                                                           </span>
<span class="3051386596282037072" onmouseenter="enter('3051386596282037072');" onmouseout="out('3051386596282037072');" style=""> 131          private final int mJobId;                                                                                 </span>
<span class="6179859670209082226" onmouseenter="enter('6179859670209082226');" onmouseout="out('6179859670209082226');" style=""> 132          private final CatLog mCat;                                                                                </span>
<span  style=""> 133                                                                                                                    </span>
<span class="5239517905467210385" onmouseenter="enter('5239517905467210385');" onmouseout="out('5239517905467210385');" style=""> 134          private final JobManager mJobManager;                                                                     </span>
<span  style=""> 135                                                                                                                    </span>
<span class="-8396683440428310884" onmouseenter="enter('-8396683440428310884');" onmouseout="out('-8396683440428310884');" style=""> 136          public Common(@NonNull Service service, CatLog cat, int jobId) {                                          </span>
<span class="-373217571160035833" onmouseenter="enter('-373217571160035833');" onmouseout="out('-373217571160035833');" style=""> 137              this((Context) service, cat, jobId);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138          }                                                                                                         </span>
<span  style=""> 139                                                                                                                    </span>
<span class="-8666365961470977949" onmouseenter="enter('-8666365961470977949');" onmouseout="out('-8666365961470977949');" style=""> 140          /*package*/ Common(@NonNull Context context, CatLog cat, int jobId) {                                     </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 141              mContext = context;                                                                                   </span>
<span class="3380959276812020408" onmouseenter="enter('3380959276812020408');" onmouseout="out('3380959276812020408');" style=""> 142              mJobId = jobId;                                                                                       </span>
<span class="-7514169524268117475" onmouseenter="enter('-7514169524268117475');" onmouseout="out('-7514169524268117475');" style=""> 143              mCat = cat;                                                                                           </span>
<span  style=""> 144                                                                                                                    </span>
<span class="2088134523180067307" onmouseenter="enter('2088134523180067307');" onmouseout="out('2088134523180067307');" style=""> 145              mJobManager = JobManager.create(context);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146          }                                                                                                         </span>
<span  style=""> 147                                                                                                                    </span>
<span class="-5511335237538855208" onmouseenter="enter('-5511335237538855208');" onmouseout="out('-5511335237538855208');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 148 -        public JobRequest getPendingRequest(boolean cleanUpOrphanedJob) {                                         </span>

<span class="-1539078468410613703" onmouseenter="enter('-1539078468410613703');" onmouseout="out('-1539078468410613703');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 149 -            // order is important for logging purposes                                                            </span>
<span class="6754931577315038874" onmouseenter="enter('6754931577315038874');" onmouseout="out('6754931577315038874');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 150 -            JobRequest request = mJobManager.getJobRequest(mJobId, true);                                         </span>
<span class="-4807858926389575759" onmouseenter="enter('-4807858926389575759');" onmouseout="out('-4807858926389575759');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 151 -            Job job = mJobManager.getJob(mJobId);                                                                 </span>
<span class="80157358755741526" onmouseenter="enter('80157358755741526');" onmouseout="out('80157358755741526');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 152 -            boolean periodic = request != null &amp;&amp; request.isPeriodic();                                           </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 153 -                                                                                                                  </span>
<span class="1317679291661326604" onmouseenter="enter('1317679291661326604');" onmouseout="out('1317679291661326604');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 154 -            if (job != null &amp;&amp; !job.isFinished()) {                                                               </span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 155 -                // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 155 -                // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting🔵</abbr></span>
<span class="-5462975656818636592" onmouseenter="enter('-5462975656818636592');" onmouseout="out('-5462975656818636592');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 156 -                mCat.d(&quot;Job %d is already running, %s&quot;, mJobId, request);                                         </span>
<span class="-8865814855968501379" onmouseenter="enter('-8865814855968501379');" onmouseout="out('-8865814855968501379');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 157 -                // not necessary to clean up, the running instance will do that                                   </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 158 -                return null;                                                                                      </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 159 -                                                                                                                  </span>
<span class="-4007651353712364444" onmouseenter="enter('-4007651353712364444');" onmouseout="out('-4007651353712364444');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 160 -            } else if (job != null &amp;&amp; !periodic) {                                                                </span>
<span class="599327769680236656" onmouseenter="enter('599327769680236656');" onmouseout="out('599327769680236656');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 161 -                mCat.d(&quot;Job %d already finished, %s&quot;, mJobId, request);                                           </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 162 -                cleanUpOrphanedJob(cleanUpOrphanedJob);                                                           </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 163 -                return null;                                                                                      </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 164 -                                                                                                                  </span>
<span class="-4441559070839346687" onmouseenter="enter('-4441559070839346687');" onmouseout="out('-4441559070839346687');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 165 -            } else if (job != null &amp;&amp; System.currentTimeMillis() - job.getFinishedTimeStamp() &lt; 2_000) {          </span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 166 -                // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 166 -                // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting🔵</abbr></span>
<span class="-2963240540698415567" onmouseenter="enter('-2963240540698415567');" onmouseout="out('-2963240540698415567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 167 -                mCat.d(&quot;Job %d is periodic and just finished, %s&quot;, mJobId, request);                              </span>
<span class="5118828189189336116" onmouseenter="enter('5118828189189336116');" onmouseout="out('5118828189189336116');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 168 -                // don&#x27;t clean up, periodic job                                                                   </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 169 -                return null;                                                                                      </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 170 -                                                                                                                  </span>
<span class="-6449094046803794181" onmouseenter="enter('-6449094046803794181');" onmouseout="out('-6449094046803794181');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 171 -            } else if (request != null &amp;&amp; request.isTransient()) {                                                </span>
<span class="4384727207576607146" onmouseenter="enter('4384727207576607146');" onmouseout="out('4384727207576607146');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 172 -                mCat.d(&quot;Request %d is transient, %s&quot;, mJobId, request);                                           </span>
<span class="5877082491190597240" onmouseenter="enter('5877082491190597240');" onmouseout="out('5877082491190597240');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 173 -                // not necessary to clean up, the JobManager will do this for transient jobs                      </span>



<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 174 -                return null;                                                                                      </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 175 -                                                                                                                  </span>
<span class="-4428555773566380837" onmouseenter="enter('-4428555773566380837');" onmouseout="out('-4428555773566380837');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 176 -            } else if (request == null) {                                                                         </span>
<span class="7609103357697598215" onmouseenter="enter('7609103357697598215');" onmouseout="out('7609103357697598215');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 177 -                mCat.d(&quot;Request for ID %d was null&quot;, mJobId);                                                     </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 178 -                cleanUpOrphanedJob(cleanUpOrphanedJob);                                                           </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 179 -                return null;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 180 -            }                                                                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 181 -                                                                                                                  </span>
<span class="-1057636993633179522" onmouseenter="enter('-1057636993633179522');" onmouseout="out('-1057636993633179522');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 182 -            return request;                                                                                       </span>
<span class="-3925023906723607869" onmouseenter="enter('-3925023906723607869');" onmouseout="out('-3925023906723607869');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 183 +        public JobRequest getPendingRequest(boolean cleanUpOrphanedJob, boolean markStarting) {                   </span>
<span class="357065027804466477" onmouseenter="enter('357065027804466477');" onmouseout="out('357065027804466477');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 184 +            synchronized (COMMON_MONITOR) {                                                                       </span>
<span class="-1539078468410613703" onmouseenter="enter('-1539078468410613703');" onmouseout="out('-1539078468410613703');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 185 +                // order is important for logging purposes                                                        </span>
<span class="6754931577315038874" onmouseenter="enter('6754931577315038874');" onmouseout="out('6754931577315038874');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 186 +                JobRequest request = mJobManager.getJobRequest(mJobId, true);                                     </span>
<span class="-4807858926389575759" onmouseenter="enter('-4807858926389575759');" onmouseout="out('-4807858926389575759');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 187 +                Job job = mJobManager.getJob(mJobId);                                                             </span>
<span class="80157358755741526" onmouseenter="enter('80157358755741526');" onmouseout="out('80157358755741526');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 188 +                boolean periodic = request != null &amp;&amp; request.isPeriodic();                                       </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 189 +                                                                                                                  </span>
<span class="1317679291661326604" onmouseenter="enter('1317679291661326604');" onmouseout="out('1317679291661326604');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 190 +                if (job != null &amp;&amp; !job.isFinished()) {                                                           </span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 191 +                    // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 191 +                    // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-pos🔵</abbr></span>
<span class="-5462975656818636592" onmouseenter="enter('-5462975656818636592');" onmouseout="out('-5462975656818636592');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 192 +                    mCat.d(&quot;Job %d is already running, %s&quot;, mJobId, request);                                     </span>
<span class="-8865814855968501379" onmouseenter="enter('-8865814855968501379');" onmouseout="out('-8865814855968501379');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 193 +                    // not necessary to clean up, the running instance will do that                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 194 +                    return null;                                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 195 +                                                                                                                  </span>
<span class="-4007651353712364444" onmouseenter="enter('-4007651353712364444');" onmouseout="out('-4007651353712364444');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 196 +                } else if (job != null &amp;&amp; !periodic) {                                                            </span>
<span class="599327769680236656" onmouseenter="enter('599327769680236656');" onmouseout="out('599327769680236656');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 197 +                    mCat.d(&quot;Job %d already finished, %s&quot;, mJobId, request);                                       </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 198 +                    cleanUpOrphanedJob(cleanUpOrphanedJob);                                                       </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 199 +                    return null;                                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 200 +                                                                                                                  </span>
<span class="-4441559070839346687" onmouseenter="enter('-4441559070839346687');" onmouseout="out('-4441559070839346687');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 201 +                } else if (job != null &amp;&amp; System.currentTimeMillis() - job.getFinishedTimeStamp() &lt; 2_000) {      </span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 202 +                    // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 202 +                    // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-pos🔵</abbr></span>
<span class="-2963240540698415567" onmouseenter="enter('-2963240540698415567');" onmouseout="out('-2963240540698415567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 203 +                    mCat.d(&quot;Job %d is periodic and just finished, %s&quot;, mJobId, request);                          </span>
<span class="5118828189189336116" onmouseenter="enter('5118828189189336116');" onmouseout="out('5118828189189336116');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 204 +                    // don&#x27;t clean up, periodic job                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 205 +                    return null;                                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 206 +                                                                                                                  </span>
<span class="-6449094046803794181" onmouseenter="enter('-6449094046803794181');" onmouseout="out('-6449094046803794181');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 207 +                } else if (request != null &amp;&amp; request.isTransient()) {                                            </span>
<span class="4384727207576607146" onmouseenter="enter('4384727207576607146');" onmouseout="out('4384727207576607146');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 208 +                    mCat.d(&quot;Request %d is transient, %s&quot;, mJobId, request);                                       </span>
<span class="5877082491190597240" onmouseenter="enter('5877082491190597240');" onmouseout="out('5877082491190597240');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 209 +                    // not necessary to clean up, the JobManager will do this for transient jobs                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 210 +                    return null;                                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 211 +                                                                                                                  </span>
<span class="-8745598640251884545" onmouseenter="enter('-8745598640251884545');" onmouseout="out('-8745598640251884545');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 212 +                } else if (request != null &amp;&amp; mJobManager.getJobExecutor().isRequestStarting(request)) {          </span>
<span class="3441384320730940166" onmouseenter="enter('3441384320730940166');" onmouseout="out('3441384320730940166');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 213 +                    mCat.d(&quot;Request %d is in the queue to start, %s&quot;, mJobId, request);                           </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 214 +                    return null;                                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 215 +                                                                                                                  </span>
<span class="-4428555773566380837" onmouseenter="enter('-4428555773566380837');" onmouseout="out('-4428555773566380837');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 216 +                } else if (request == null) {                                                                     </span>
<span class="7609103357697598215" onmouseenter="enter('7609103357697598215');" onmouseout="out('7609103357697598215');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 217 +                    mCat.d(&quot;Request for ID %d was null&quot;, mJobId);                                                 </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 218 +                    cleanUpOrphanedJob(cleanUpOrphanedJob);                                                       </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 219 +                    return null;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 220 +                }                                                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +                                                                                                                  </span>
<span class="8480325012103084437" onmouseenter="enter('8480325012103084437');" onmouseout="out('8480325012103084437');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 222 +                if (markStarting) {                                                                               </span>
<span class="8387569989042798053" onmouseenter="enter('8387569989042798053');" onmouseout="out('8387569989042798053');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +                    mJobManager.getJobExecutor().markJobRequestStarting(request);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 224 +                }                                                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 225 +                                                                                                                  </span>
<span class="-1057636993633179522" onmouseenter="enter('-1057636993633179522');" onmouseout="out('-1057636993633179522');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 226 +                return request;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 227 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228          }                                                                                                         </span>
<span  style=""> 229                                                                                                                    </span>
<span class="5154748246392482767" onmouseenter="enter('5154748246392482767');" onmouseout="out('5154748246392482767');" style=""> 230          @NonNull                                                                                                  </span>
<span class="1474434811491937762" onmouseenter="enter('1474434811491937762');" onmouseout="out('1474434811491937762');" style=""> 231          public Job.Result executeJobRequest(@NonNull JobRequest request) {                                        </span>

<span class="8785519441075077783" onmouseenter="enter('8785519441075077783');" onmouseout="out('8785519441075077783');" style=""> 232              long waited = System.currentTimeMillis() - request.getScheduledAt();                                  </span>
<span class="-521988911558271196" onmouseenter="enter('-521988911558271196');" onmouseout="out('-521988911558271196');" style=""> 233              String timeWindow;                                                                                    </span>
<span class="-4749167882947985624" onmouseenter="enter('-4749167882947985624');" onmouseout="out('-4749167882947985624');" style=""> 234              if (request.isPeriodic()) {                                                                           </span>
<span class="22254303833830880" onmouseenter="enter('22254303833830880');" onmouseout="out('22254303833830880');" style=""><abbr title=" 235                  timeWindow = String.format(Locale.US, &quot;interval %s, flex %s&quot;, JobUtil.timeToString(request.getIntervalMs()),"> 235                  timeWindow = String.format(Locale.US, &quot;interval %s, flex %s&quot;, JobUtil.timeToString(request.getInte🔵</abbr></span>
<span class="-7441385486773924310" onmouseenter="enter('-7441385486773924310');" onmouseout="out('-7441385486773924310');" style=""> 236                          JobUtil.timeToString(request.getFlexMs()));                                               </span>
<span class="4779514256224206313" onmouseenter="enter('4779514256224206313');" onmouseout="out('4779514256224206313');" style=""> 237              } else if (request.getJobApi().supportsExecutionWindow()) {                                           </span>
<span class="-6246254348184491385" onmouseenter="enter('-6246254348184491385');" onmouseout="out('-6246254348184491385');" style=""><abbr title=" 238                  timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMs(request)),"> 238                  timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMs(request)🔵</abbr></span>
<span class="6965396589660564452" onmouseenter="enter('6965396589660564452');" onmouseout="out('6965396589660564452');" style=""> 239                          JobUtil.timeToString(getEndMs(request)));                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 240              } else {                                                                                              </span>
<span class="-1520611369215068334" onmouseenter="enter('-1520611369215068334');" onmouseout="out('-1520611369215068334');" style=""> 241                  timeWindow = &quot;delay &quot; + JobUtil.timeToString(getAverageDelayMs(request));                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242              }                                                                                                     </span>
<span  style=""> 243                                                                                                                    </span>
<span class="-8808967967811702611" onmouseenter="enter('-8808967967811702611');" onmouseout="out('-8808967967811702611');" style=""> 244              if (Looper.myLooper() == Looper.getMainLooper()) {                                                    </span>
<span class="-1368751502622418275" onmouseenter="enter('-1368751502622418275');" onmouseout="out('-1368751502622418275');" style=""> 245                  mCat.w(&quot;Running JobRequest on a main thread, this could cause stutter or ANR in your app.&quot;);      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246              }                                                                                                     </span>
<span  style=""> 247                                                                                                                    </span>
<span class="-1843046913616870974" onmouseenter="enter('-1843046913616870974');" onmouseout="out('-1843046913616870974');" style=""> 248              mCat.d(&quot;Run job, %s, waited %s, %s&quot;, request, JobUtil.timeToString(waited), timeWindow);              </span>
<span class="-4828048199353050218" onmouseenter="enter('-4828048199353050218');" onmouseout="out('-4828048199353050218');" style=""> 249              JobExecutor jobExecutor = mJobManager.getJobExecutor();                                               </span>
<span class="-1235692988875235782" onmouseenter="enter('-1235692988875235782');" onmouseout="out('-1235692988875235782');" style=""> 250              Job job = null;                                                                                       </span>
<span  style=""> 251                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 252              try {                                                                                                 </span>
<span class="-9073677935190895883" onmouseenter="enter('-9073677935190895883');" onmouseout="out('-9073677935190895883');" style=""> 253                  // create job first before setting it transient, avoids a race condition while rescheduling jobs  </span>

<span class="1625132338136195706" onmouseenter="enter('1625132338136195706');" onmouseout="out('1625132338136195706');" style=""> 254                  job = mJobManager.getJobCreatorHolder().createJob(request.getTag());                              </span>
<span  style=""> 255                                                                                                                    </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 256                  if (!request.isPeriodic()) {                                                                      </span>
<span class="3122394794119912241" onmouseenter="enter('3122394794119912241');" onmouseout="out('3122394794119912241');" style=""> 257                      request.setTransient(true);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258                  }                                                                                                 </span>
<span  style=""> 259                                                                                                                    </span>
<span class="-2797125910631995922" onmouseenter="enter('-2797125910631995922');" onmouseout="out('-2797125910631995922');" style=""> 260                  Future&lt;Job.Result&gt; future = jobExecutor.execute(mContext, request, job);                          </span>








<span class="-4410702629486134619" onmouseenter="enter('-4410702629486134619');" onmouseout="out('-4410702629486134619');" style=""> 261                  if (future == null) {                                                                             </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 262                      return Job.Result.FAILURE;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263                  }                                                                                                 </span>
<span  style=""> 264                                                                                                                    </span>
<span class="5244342940061655384" onmouseenter="enter('5244342940061655384');" onmouseout="out('5244342940061655384');" style=""> 265                  // wait until done                                                                                </span>
<span class="-4728317628971455727" onmouseenter="enter('-4728317628971455727');" onmouseout="out('-4728317628971455727');" style=""> 266                  Job.Result result = future.get();                                                                 </span>
<span class="368857225067072174" onmouseenter="enter('368857225067072174');" onmouseout="out('368857225067072174');" style=""> 267                  mCat.d(&quot;Finished job, %s %s&quot;, request, result);                                                   </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 268                  return result;                                                                                    </span>
<span  style=""> 269                                                                                                                    </span>
<span class="2273166757001165010" onmouseenter="enter('2273166757001165010');" onmouseout="out('2273166757001165010');" style=""> 270              } catch (InterruptedException | ExecutionException e) {                                               </span>
<span class="-1683580236663429788" onmouseenter="enter('-1683580236663429788');" onmouseout="out('-1683580236663429788');" style=""> 271                  mCat.e(e);                                                                                        </span>
<span  style=""> 272                                                                                                                    </span>
<span class="6519543964694909858" onmouseenter="enter('6519543964694909858');" onmouseout="out('6519543964694909858');" style=""> 273                  if (job != null) {                                                                                </span>
<span class="-9041905225007822866" onmouseenter="enter('-9041905225007822866');" onmouseout="out('-9041905225007822866');" style=""> 274                      job.cancel();                                                                                 </span>
<span class="3580809215980372017" onmouseenter="enter('3580809215980372017');" onmouseout="out('3580809215980372017');" style=""> 275                      mCat.e(&quot;Canceled %s&quot;, request);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276                  }                                                                                                 </span>
<span  style=""> 277                                                                                                                    </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 278                  return Job.Result.FAILURE;                                                                        </span>
<span  style=""> 279                                                                                                                    </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 280              } finally {                                                                                           </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 281                  if (!request.isPeriodic()) {                                                                      </span>
<span class="1449747436325478708" onmouseenter="enter('1449747436325478708');" onmouseout="out('1449747436325478708');" style=""> 282                      mJobManager.getJobStorage().remove(request);                                                  </span>
<span  style=""> 283                                                                                                                    </span>
<span class="-2333237089390189385" onmouseenter="enter('-2333237089390189385');" onmouseout="out('-2333237089390189385');" style=""> 284                  } else if (request.isFlexSupport()) {                                                             </span>
<span class="733386345181994468" onmouseenter="enter('733386345181994468');" onmouseout="out('733386345181994468');" style=""><abbr title=" 285                      mJobManager.getJobStorage().remove(request); // remove, we store the new job in JobManager.schedule()"> 285                      mJobManager.getJobStorage().remove(request); // remove, we store the new job in JobManager.sch🔵</abbr></span>
<span class="2102053740633122535" onmouseenter="enter('2102053740633122535');" onmouseout="out('2102053740633122535');" style=""> 286                      request.reschedule(false, false);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289          }                                                                                                         </span>
<span  style=""> 290                                                                                                                    </span>
<span class="-3194552414098127961" onmouseenter="enter('-3194552414098127961');" onmouseout="out('-3194552414098127961');" style=""> 291          private void cleanUpOrphanedJob(boolean cleanUp) {                                                        </span>
<span class="8101282554241671494" onmouseenter="enter('8101282554241671494');" onmouseout="out('8101282554241671494');" style=""> 292              if (cleanUp) {                                                                                        </span>
<span class="6651175145696850096" onmouseenter="enter('6651175145696850096');" onmouseout="out('6651175145696850096');" style=""> 293                  cleanUpOrphanedJob(mContext, mJobId);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295          }                                                                                                         </span>
<span  style=""> 296                                                                                                                    </span>
<span class="3574082725044615574" onmouseenter="enter('3574082725044615574');" onmouseout="out('3574082725044615574');" style=""> 297          public static void cleanUpOrphanedJob(Context context, int jobId) {                                       </span>

<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 298              /*                                                                                                    </span>
<span class="4873467377157825728" onmouseenter="enter('4873467377157825728');" onmouseout="out('4873467377157825728');" style=""><abbr title=" 299               * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are still around."> 299               * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are still aroun🔵</abbr></span>
<span class="7880315656890986822" onmouseenter="enter('7880315656890986822');" onmouseout="out('7880315656890986822');" style=""><abbr title=" 300               * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the old one. Here"> 300               * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the old one. Her🔵</abbr></span>
<span class="7642695698821586509" onmouseenter="enter('7642695698821586509');" onmouseout="out('7642695698821586509');" style=""> 301               * we make sure, that no job is left in the system.                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 302               */                                                                                                   </span>
<span class="-1280302924927314158" onmouseenter="enter('-1280302924927314158');" onmouseout="out('-1280302924927314158');" style=""> 303              for (JobApi jobApi : JobApi.values()) {                                                               </span>
<span class="-5474372138432799739" onmouseenter="enter('-5474372138432799739');" onmouseout="out('-5474372138432799739');" style=""> 304                  if (jobApi.isSupported(context)) {                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 305                      try {                                                                                         </span>
<span class="-5924449239106429276" onmouseenter="enter('-5924449239106429276');" onmouseout="out('-5924449239106429276');" style=""> 306                          jobApi.getCachedProxy(context).cancel(jobId);                                             </span>

<span class="8538742657781196138" onmouseenter="enter('8538742657781196138');" onmouseout="out('8538742657781196138');" style=""> 307                      } catch (Exception ignored) {                                                                 </span>
<span class="-571140832119819901" onmouseenter="enter('-571140832119819901');" onmouseout="out('-571140832119819901');" style=""> 308                          // GCM API could crash if it&#x27;s disabled, ignore crashes at this point and continue        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 310                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312          }                                                                                                         </span>
<span  style=""> 313                                                                                                                    </span>
<span class="5053639476535817445" onmouseenter="enter('5053639476535817445');" onmouseout="out('5053639476535817445');" style=""> 314          public static ComponentName startWakefulService(Context context, Intent intent) {                         </span>
<span class="-2841441978426476425" onmouseenter="enter('-2841441978426476425');" onmouseout="out('-2841441978426476425');" style=""> 315              return WakeLockUtil.startWakefulService(context, intent);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316          }                                                                                                         </span>
<span  style=""> 317                                                                                                                    </span>
<span class="-5135813554980344335" onmouseenter="enter('-5135813554980344335');" onmouseout="out('-5135813554980344335');" style=""> 318          public static boolean completeWakefulIntent(Intent intent) {                                              </span>
<span class="-1383746570627903167" onmouseenter="enter('-1383746570627903167');" onmouseout="out('-1383746570627903167');" style=""> 319              return WakeLockUtil.completeWakefulIntent(intent);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            