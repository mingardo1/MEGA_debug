<!DOCTYPE html>
<html lang="en">
          <head>
            <meta charset="utf-8">
            <title>157 chunks</title>
                <style>
                    #top {
                        height: 48vh;
                        overflow-y: auto;
                    }
                    #bottom {
                        height: 48vh;
                        overflow-y: auto;
                    }
                </style>
          </head>
          <body>
            <pre>[[{&#x27;eq&#x27;: [{&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;/*-\n&#x27;
                           &#x27; * #%L\n&#x27;
                           &#x27; * BroadleafCommerce Common Libraries\n&#x27;
                           &#x27; * %%\n&#x27;
                           &#x27; * Copyright (C) 2009 - 2022 Broadleaf Commerce\n&#x27;
                           &#x27; * %%\n&#x27;
                           &#x27; * Licensed under the Broadleaf Fair Use License &#x27;
                           &#x27;Agreement, Version 1.0\n&#x27;
                           &#x27; * (the &quot;Fair Use License&quot; located  at &#x27;
                           &#x27;http://license.broadleafcommerce.org/fair_use_license-1.0.txt)\n&#x27;
                           &#x27; * unless the restrictions on use therein are &#x27;
                           &#x27;violated and require payment to Broadleaf in which &#x27;
                           &#x27;case\n&#x27;
                           &#x27; * the Broadleaf End User License Agreement &#x27;
                           &#x27;(EULA), Version 1.1\n&#x27;
                           &#x27; * (the &quot;Commercial License&quot; located at &#x27;
                           &#x27;http://license.broadleafcommerce.org/commercial_license-1.1.txt)\n&#x27;
                           &#x27; * shall apply.\n&#x27;
                           &#x27; * \n&#x27;
                           &#x27; * Alternatively, the Commercial License may be &#x27;
                           &#x27;replaced with a mutually agreed upon license (the &#x27;
                           &#x27;&quot;Custom License&quot;)\n&#x27;
                           &#x27; * between you and Broadleaf Commerce. You may not &#x27;
                           &#x27;use this file except in compliance with the &#x27;
                           &#x27;applicable license.\n&#x27;
                           &#x27; * #L%\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;package org.broadleafcommerce.common.config;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.commons.collections.CollectionUtils;\n&#x27;
                           &#x27;import org.apache.commons.lang3.StringUtils;\n&#x27;
                           &#x27;import org.apache.commons.logging.Log;\n&#x27;
                           &#x27;import org.apache.commons.logging.LogFactory;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.broadleafcommerce.common.logging.SupportLogManager;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.broadleafcommerce.common.logging.SupportLogger;\n&#x27;
                           &#x27;import org.springframework.beans.BeansException;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.InitializingBean;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.annotation.Autowired;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.config.ConfigurableListableBeanFactory;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.support.BeanDefinitionRegistry;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.context.ApplicationContext;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.core.io.ClassPathResource;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.core.io.FileSystemResource;\n&#x27;
                           &#x27;import org.springframework.core.io.Resource;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.util.PropertyPlaceholderHelper;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.util.StringValueResolver;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.io.IOException;\n&#x27;
                           &#x27;import java.util.ArrayList;\n&#x27;
                           &#x27;import java.util.Collections;\n&#x27;
                           &#x27;import java.util.LinkedHashSet;\n&#x27;
                           &#x27;import java.util.Map.Entry;\n&#x27;
                           &#x27;import java.util.Properties;\n&#x27;
                           &#x27;import java.util.Set;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import javax.annotation.PostConstruct;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * A property resource configurer that chooses the &#x27;
                           &#x27;property file at runtime\n&#x27;
                           &#x27; * based on the runtime environment.\n&#x27;
                           &#x27; * &lt;p&gt;\n&#x27;
                           &#x27; * Used for choosing properties files based on the &#x27;
                           &#x27;current runtime environment,\n&#x27;
                           &#x27; * allowing for movement of the same application &#x27;
                           &#x27;between multiple runtime\n&#x27;
                           &#x27; * environments without rebuilding.\n&#x27;
                           &#x27; * &lt;p&gt;\n&#x27;
                           &#x27; * The property replacement semantics of this &#x27;
                           &#x27;implementation are identical to\n&#x27;
                           &#x27; * PropertyPlaceholderConfigurer, from which this &#x27;
                           &#x27;class inherits. &lt;code&gt;\n&#x27;
                           &#x27; * &lt;pre&gt;\n&#x27;
                           &#x27; * &amp;lt;bean id=&amp;quot;propertyConfigurator&amp;quot; &#x27;
                           &#x27;class=&amp;quot;frilista.framework.RuntimeEnvironmentPropertiesConfigurer&amp;quot;&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;property &#x27;
                           &#x27;name=&amp;quot;propertyLocation&amp;quot; &#x27;
                           &#x27;value=&amp;quot;/WEB-INF/runtime-properties/&amp;quot; &#x27;
                           &#x27;/&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;property &#x27;
                           &#x27;name=&amp;quot;environments&amp;quot;&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;set&amp;gt;\n&#x27;
                           &#x27; *            &#x27;
                           &#x27;&amp;lt;value&amp;gt;production&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *            &amp;lt;value&amp;gt;staging&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *            &#x27;
                           &#x27;&amp;lt;value&amp;gt;integration&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *            &#x27;
                           &#x27;&amp;lt;value&amp;gt;development&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;/set&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;/property&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;property &#x27;
                           &#x27;name=&amp;quot;defaultEnvironment&amp;quot; &#x27;
                           &#x27;value=&amp;quot;development&amp;quot;/&amp;gt;\n&#x27;
                           &#x27; * &amp;lt;/bean&amp;gt;\n&#x27;
                           &#x27; * &lt;/code&gt; &lt;/pre&gt; The keys of the environment &#x27;
                           &#x27;specific properties files are\n&#x27;
                           &#x27; * compared to ensure that each property file &#x27;
                           &#x27;defines the complete set of keys,\n&#x27;
                           &#x27; * in order to avoid environment-specific &#x27;
                           &#x27;failures.\n&#x27;
                           &#x27; * &lt;p&gt;\n&#x27;
                           &#x27; * An optional RuntimeEnvironmentKeyResolver &#x27;
                           &#x27;implementation can be provided,\n&#x27;
                           &#x27; * allowing for customization of how the runtime &#x27;
                           &#x27;environment is determined. If\n&#x27;
                           &#x27; * no implementation is provided, a default of\n&#x27;
                           &#x27; * SystemPropertyRuntimeEnvironmentKeyResolver is &#x27;
                           &#x27;used (which uses the system\n&#x27;
                           &quot; * property &#x27;runtime.environment&#x27;)\n&quot;
                           &#x27; * @author &lt;a &#x27;
                           &#x27;href=&quot;mailto:chris.lee.9@gmail.com&quot;&gt;Chris Lee&lt;/a&gt;\n&#x27;
                           &#x27; * @deprecated Instead of using anything around &#x27;
                           &#x27;the -Druntime-environment values, you should be &#x27;
                           &#x27;using Spring profiles\n&#x27;
                           &#x27; * and properties activated with that via {@link &#x27;
                           &#x27;BroadleafEnvironmentConfiguringApplicationListener}.\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;@Deprecated\n&#x27;
                           &#x27;public class &#x27;
                           &#x27;RuntimeEnvironmentPropertiesConfigurer extends &#x27;
                           &#x27;PropertyPlaceholderConfigurer implements &#x27;
                           &#x27;InitializingBean {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static final Log LOG = &#x27;
                           &#x27;LogFactory.getLog(RuntimeEnvironmentPropertiesConfigurer.class);\n&#x27;
                           &#x27;    protected SupportLogger logger = &#x27;
                           &#x27;SupportLogManager.getLogger(&quot;UserOverride&quot;, &#x27;
                           &#x27;this.getClass());\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    protected static final String &#x27;
                           &#x27;SHARED_PROPERTY_OVERRIDE = &#x27;
                           &#x27;&quot;property-shared-override&quot;;\n&#x27;
                           &#x27;    protected static final String &#x27;
                           &#x27;PROPERTY_OVERRIDE = &quot;property-override&quot;;\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    protected static Set&lt;String&gt; &#x27;
                           &#x27;defaultEnvironments = new LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;    protected static Set&lt;Resource&gt; &#x27;
                           &#x27;blcPropertyLocations = new LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;    protected static Set&lt;Resource&gt; &#x27;
                           &#x27;defaultPropertyLocations = new LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    static {\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;production&quot;);\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;staging&quot;);\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;integrationqa&quot;);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;defaultEnvironments.add(&quot;integrationdev&quot;);\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;development&quot;);\n&#x27;
                           &#x27;        \n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/admin/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/cms/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/web/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/fw/&quot;));\n&#x27;
                           &#x27;        \n&#x27;
                           &#x27;        defaultPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;runtime-properties/&quot;));\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected String defaultEnvironment = &#x27;
                           &#x27;&quot;development&quot;;\n&#x27;
                           &#x27;    protected String determinedEnvironment = &#x27;
                           &#x27;null;\n&#x27;
                           &#x27;    protected RuntimeEnvironmentKeyResolver &#x27;
                           &#x27;keyResolver;\n&#x27;
                           &#x27;    protected Set&lt;String&gt; environments = &#x27;
                           &#x27;Collections.emptySet();\n&#x27;
                           &#x27;    protected Set&lt;Resource&gt; propertyLocations;\n&#x27;
                           &#x27;    protected Set&lt;Resource&gt; &#x27;
                           &#x27;overridableProperyLocations;\n&#x27;
                           &#x27;    protected StringValueResolver &#x27;
                           &#x27;stringValueResolver;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Autowired\n&#x27;
                           &#x27;    protected ApplicationContext &#x27;
                           &#x27;applicationContext;\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    @PostConstruct\n&#x27;
                           &#x27;    public void init() {\n&#x27;
                           &#x27;        String originatingFile = &#x27;
                           &#x27;((BeanDefinitionRegistry) &#x27;
                           &#x27;applicationContext.getAutowireCapableBeanFactory()).getBeanDefinition(&quot;blConfiguration&quot;).getResourceDescription();\n&#x27;
                           &#x27;        LOG.error(&quot;A blConfiguration bean was &#x27;
                           &#x27;detected in &quot; + originatingFile + &quot;. Any use of &#x27;
                           &#x27;blConfiguration and the &#x27;
                           &#x27;RuntimeEnvironmentProperitesConfigurer is &#x27;
                           &#x27;deprecated and has unknown side-effects. Remove &quot;\n&#x27;
                           &#x27;            + &quot;all instances blConfiguration from &#x27;
                           &#x27;all applicationContext.xml files. Use either a &#x27;
                           &#x27;FrameworkCommonPropertySource, &#x27;
                           &#x27;ProfileAwarePropertySource or a @PropertySource &#x27;
                           &#x27;annotation on an @Configuration class&quot;);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void afterPropertiesSet() throws &#x27;
                           &#x27;IOException {\n&#x27;
                           &#x27;        setIgnoreUnresolvablePlaceholders(true); &#x27;
                           &#x27;// This default will get overriden by user options &#x27;
                           &#x27;if present\n&#x27;
                           &#x27;        setNullValue(&quot;@null&quot;);\n&#x27;
                           &#x27;        \n&#x27;
                           &#x27;        // If no environment override has been &#x27;
                           &#x27;specified, used the default environments\n&#x27;
                           &#x27;        if (environments == null || &#x27;
                           &#x27;environments.size() == 0) {\n&#x27;
                           &#x27;            environments = defaultEnvironments;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        \n&#x27;
                           &#x27;        // Prepend the default property locations &#x27;
                           &#x27;to the specified property locations (if any)\n&#x27;
                           &#x27;        Set&lt;Resource&gt; combinedLocations = new &#x27;
                           &#x27;LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(!CollectionUtils.isEmpty(overridableProperyLocations)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            &#x27;
                           &#x27;combinedLocations.addAll(overridableProperyLocations);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(!CollectionUtils.isEmpty(propertyLocations)) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;combinedLocations.addAll(propertyLocations);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        propertyLocations = combinedLocations;\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(!environments.contains(defaultEnvironment)) {\n&#x27;
                           &#x27;            throw new AssertionError(&quot;Default &#x27;
                           &#x27;environment \&#x27;&quot; + defaultEnvironment + &quot;\&#x27; not &#x27;
                           &#x27;listed in environment list&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (keyResolver == null) {\n&#x27;
                           &#x27;            keyResolver = new &#x27;
                           &#x27;SystemPropertyRuntimeEnvironmentKeyResolver();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        String environment = &#x27;
                           &#x27;determineEnvironment();\n&#x27;
                           &#x27;        ArrayList&lt;Resource&gt; allLocations = new &#x27;
                           &#x27;ArrayList&lt;&gt;();\n&#x27;
                           &#x27;        \n&#x27;
                           &#x27;        /* Process configuration in the following &#x27;
                           &#x27;order (later files override earlier files\n&#x27;
                           &#x27;         * common-shared.properties\n&#x27;
                           &#x27;         * [environment]-shared.properties\n&#x27;
                           &#x27;         * common.properties\n&#x27;
                           &#x27;         * [environment].properties\n&#x27;
                           &#x27;         * -Dproperty-override-shared specified &#x27;
                           &#x27;value, if any\n&#x27;
                           &#x27;         * -Dproperty-override specified value, if &#x27;
                           &#x27;any  */\n&#x27;
                           &#x27;        Set&lt;Set&lt;Resource&gt;&gt; testLocations = new &#x27;
                           &#x27;LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;        testLocations.add(propertyLocations);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;testLocations.add(defaultPropertyLocations);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        for (Resource resource : &#x27;
                           &#x27;createBroadleafResource()) {\n&#x27;
                           &#x27;            if (resource.exists()) {\n&#x27;
                           &#x27;                allLocations.add(resource);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        for (Set&lt;Resource&gt; locations : &#x27;
                           &#x27;testLocations) {\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createSharedCommonResource(locations)) {\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createSharedPropertiesResource(environment, &#x27;
                           &#x27;locations)) {\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createCommonResource(locations)) {\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createPropertiesResource(environment, locations)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Resource sharedPropertyOverride = &#x27;
                           &#x27;createSharedOverrideResource();\n&#x27;
                           &#x27;        if (sharedPropertyOverride != null) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;allLocations.add(sharedPropertyOverride);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        \n&#x27;
                           &#x27;        Resource propertyOverride = &#x27;
                           &#x27;createOverrideResource();\n&#x27;
                           &#x27;        if (propertyOverride != null) {\n&#x27;
                           &#x27;            allLocations.add(propertyOverride);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        \n&#x27;
                           &#x27;        Properties props = new Properties();\n&#x27;
                           &#x27;        for (Resource resource : allLocations) {\n&#x27;
                           &#x27;            if (resource.exists()) {\n&#x27;
                           &#x27;                // We will log source-control &#x27;
                           &#x27;managed properties with trace and overrides with &#x27;
                           &#x27;info\n&#x27;
                           &#x27;                if &#x27;
                           &#x27;(((resource.equals(sharedPropertyOverride) || &#x27;
                           &#x27;resource.equals(propertyOverride)))\n&#x27;
                           &#x27;                        || LOG.isTraceEnabled()) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    props = new &#x27;
                           &#x27;Properties(props);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;props.load(resource.getInputStream());\n&#x27;
                           &#x27;                    for (Entry&lt;Object, Object&gt; &#x27;
                           &#x27;entry : props.entrySet()) {\n&#x27;
                           &#x27;                        if &#x27;
                           &#x27;(resource.equals(sharedPropertyOverride) || &#x27;
                           &#x27;resource.equals(propertyOverride)) {\n&#x27;
                           &#x27;                            logger.support(&quot;Read &quot; &#x27;
                           &#x27;+ entry.getKey() + &quot; from &quot; + &#x27;
                           &#x27;resource.getFilename());\n&#x27;
                           &#x27;                        } else {\n&#x27;
                           &#x27;                            LOG.trace(&quot;Read &quot; + &#x27;
                           &#x27;entry.getKey() + &quot; from &quot; + &#x27;
                           &#x27;resource.getFilename());\n&#x27;
                           &#x27;                        }\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            } else {\n&#x27;
                           &#x27;                LOG.debug(&quot;Unable to locate &#x27;
                           &#x27;resource: &quot; + resource.getFilename());\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        setLocations(allLocations.toArray(new &#x27;
                           &#x27;Resource[] {}));\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createSharedPropertiesResource(String environment, &#x27;
                           &#x27;Set&lt;Resource&gt; locations) throws IOException {\n&#x27;
                           &#x27;        String fileName = &#x27;
                           &#x27;environment.toString().toLowerCase() + &#x27;
                           &#x27;&quot;-shared.properties&quot;;\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(fileName);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    protected Resource[] createBroadleafResource() &#x27;
                           &#x27;throws IOException {\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[blcPropertyLocations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : &#x27;
                           &#x27;blcPropertyLocations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(&quot;common.properties&quot;);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createSharedCommonResource(Set&lt;Resource&gt; &#x27;
                           &#x27;locations) throws IOException {\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(&quot;common-shared.properties&quot;);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createPropertiesResource(String environment, &#x27;
                           &#x27;Set&lt;Resource&gt; locations) throws IOException {\n&#x27;
                           &#x27;        String fileName = &#x27;
                           &#x27;environment.toString().toLowerCase() + &#x27;
                           &#x27;&quot;.properties&quot;;\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(fileName);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createCommonResource(Set&lt;Resource&gt; locations) &#x27;
                           &#x27;throws IOException {\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(&quot;common.properties&quot;);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    protected Resource &#x27;
                           &#x27;createSharedOverrideResource() throws IOException &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        String path = &#x27;
                           &#x27;System.getProperty(SHARED_PROPERTY_OVERRIDE);\n&#x27;
                           &#x27;        return StringUtils.isBlank(path) ? null : &#x27;
                           &#x27;new FileSystemResource(path);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    protected Resource createOverrideResource() &#x27;
                           &#x27;throws IOException {\n&#x27;
                           &#x27;        String path = &#x27;
                           &#x27;System.getProperty(PROPERTY_OVERRIDE);\n&#x27;
                           &#x27;        return StringUtils.isBlank(path) ? null : &#x27;
                           &#x27;new FileSystemResource(path);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String determineEnvironment() {\n&#x27;
                           &#x27;        if (determinedEnvironment != null) {\n&#x27;
                           &#x27;            return determinedEnvironment;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        determinedEnvironment = &#x27;
                           &#x27;keyResolver.resolveRuntimeEnvironmentKey();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (determinedEnvironment == null) {\n&#x27;
                           &#x27;            LOG.warn(&quot;Unable to determine runtime &#x27;
                           &#x27;environment, using default environment \&#x27;&quot; + &#x27;
                           &#x27;defaultEnvironment + &quot;\&#x27;&quot;);\n&#x27;
                           &#x27;            determinedEnvironment = &#x27;
                           &#x27;defaultEnvironment;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;determinedEnvironment.toLowerCase();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void &#x27;
                           &#x27;processProperties(ConfigurableListableBeanFactory &#x27;
                           &#x27;beanFactoryToProcess, Properties props) throws &#x27;
                           &#x27;BeansException {\n&#x27;
                           &#x27;        &#x27;
                           &#x27;super.processProperties(beanFactoryToProcess, &#x27;
                           &#x27;props);\n&#x27;
                           &#x27;        stringValueResolver = new &#x27;
                           &#x27;PlaceholderResolvingStringValueResolver(props);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the default environment name, used &#x27;
                           &#x27;when the runtime environment\n&#x27;
                           &#x27;     * cannot be determined.\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setDefaultEnvironment(String &#x27;
                           &#x27;defaultEnvironment) {\n&#x27;
                           &#x27;        this.defaultEnvironment = &#x27;
                           &#x27;defaultEnvironment;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String getDefaultEnvironment() {\n&#x27;
                           &#x27;        return defaultEnvironment;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;setKeyResolver(RuntimeEnvironmentKeyResolver &#x27;
                           &#x27;keyResolver) {\n&#x27;
                           &#x27;        this.keyResolver = keyResolver;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the allowed list of runtime &#x27;
                           &#x27;environments\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setEnvironments(Set&lt;String&gt; &#x27;
                           &#x27;environments) {\n&#x27;
                           &#x27;        this.environments = environments;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the directory from which to read &#x27;
                           &#x27;environment-specific properties\n&#x27;
                           &quot;     * files; note that it must end with a &#x27;/&#x27;\n&quot;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setPropertyLocations(Set&lt;Resource&gt; &#x27;
                           &#x27;propertyLocations) {\n&#x27;
                           &#x27;        this.propertyLocations = &#x27;
                           &#x27;propertyLocations;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the directory from which to read &#x27;
                           &#x27;environment-specific properties\n&#x27;
                           &quot;     * files; note that it must end with a &#x27;/&#x27;. &quot;
                           &#x27;Note, these properties may be\n&#x27;
                           &#x27;     * overridden by those defined in &#x27;
                           &#x27;propertyLocations and any &quot;runtime-properties&quot; &#x27;
                           &#x27;directories\n&#x27;
                           &#x27;     *\n&#x27;
                           &#x27;     * @param overridableProperyLocations location &#x27;
                           &#x27;containing overridable environment properties\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;setOverridableProperyLocations(Set&lt;Resource&gt; &#x27;
                           &#x27;overridableProperyLocations) {\n&#x27;
                           &#x27;        this.overridableProperyLocations = &#x27;
                           &#x27;overridableProperyLocations;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class &#x27;
                           &#x27;PlaceholderResolvingStringValueResolver implements &#x27;
                           &#x27;StringValueResolver {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private final PropertyPlaceholderHelper &#x27;
                           &#x27;helper;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private final &#x27;
                           &#x27;PropertyPlaceholderHelper.PlaceholderResolver &#x27;
                           &#x27;resolver;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public &#x27;
                           &#x27;PlaceholderResolvingStringValueResolver(Properties &#x27;
                           &#x27;props) {\n&#x27;
                           &#x27;            this.helper = new &#x27;
                           &#x27;PropertyPlaceholderHelper(&quot;${&quot;, &quot;}&quot;, &quot;:&quot;, true);\n&#x27;
                           &#x27;            this.resolver = new &#x27;
                           &#x27;PropertyPlaceholderConfigurerResolver(props);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public String resolveStringValue(String &#x27;
                           &#x27;strVal) throws BeansException {\n&#x27;
                           &#x27;            String value = &#x27;
                           &#x27;this.helper.replacePlaceholders(strVal, &#x27;
                           &#x27;this.resolver);\n&#x27;
                           &#x27;            return (value.equals(&quot;&quot;) ? null : &#x27;
                           &#x27;value);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class &#x27;
                           &#x27;PropertyPlaceholderConfigurerResolver implements &#x27;
                           &#x27;PropertyPlaceholderHelper.PlaceholderResolver {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private final Properties props;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private &#x27;
                           &#x27;PropertyPlaceholderConfigurerResolver(Properties &#x27;
                           &#x27;props) {\n&#x27;
                           &#x27;            this.props = props;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public String resolvePlaceholder(String &#x27;
                           &#x27;placeholderName) {\n&#x27;
                           &#x27;            return &#x27;
                           &#x27;RuntimeEnvironmentPropertiesConfigurer.this.resolvePlaceholder(placeholderName, &#x27;
                           &#x27;props, 1);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public StringValueResolver &#x27;
                           &#x27;getStringValueResolver() {\n&#x27;
                           &#x27;        return stringValueResolver;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;/*-\n&#x27;
                           &#x27; * #%L\n&#x27;
                           &#x27; * BroadleafCommerce Common Libraries\n&#x27;
                           &#x27; * %%\n&#x27;
                           &#x27; * Copyright (C) 2009 - 2022 Broadleaf Commerce\n&#x27;
                           &#x27; * %%\n&#x27;
                           &#x27; * Licensed under the Broadleaf Fair Use License &#x27;
                           &#x27;Agreement, Version 1.0\n&#x27;
                           &#x27; * (the &quot;Fair Use License&quot; located  at &#x27;
                           &#x27;http://license.broadleafcommerce.org/fair_use_license-1.0.txt)\n&#x27;
                           &#x27; * unless the restrictions on use therein are &#x27;
                           &#x27;violated and require payment to Broadleaf in which &#x27;
                           &#x27;case\n&#x27;
                           &#x27; * the Broadleaf End User License Agreement &#x27;
                           &#x27;(EULA), Version 1.1\n&#x27;
                           &#x27; * (the &quot;Commercial License&quot; located at &#x27;
                           &#x27;http://license.broadleafcommerce.org/commercial_license-1.1.txt)\n&#x27;
                           &#x27; * shall apply.\n&#x27;
                           &#x27; *\n&#x27;
                           &#x27; * Alternatively, the Commercial License may be &#x27;
                           &#x27;replaced with a mutually agreed upon license (the &#x27;
                           &#x27;&quot;Custom License&quot;)\n&#x27;
                           &#x27; * between you and Broadleaf Commerce. You may not &#x27;
                           &#x27;use this file except in compliance with the &#x27;
                           &#x27;applicable license.\n&#x27;
                           &#x27; * #L%\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;package org.broadleafcommerce.common.config;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.commons.collections.CollectionUtils;\n&#x27;
                           &#x27;import org.apache.commons.lang3.StringUtils;\n&#x27;
                           &#x27;import org.apache.commons.logging.Log;\n&#x27;
                           &#x27;import org.apache.commons.logging.LogFactory;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.broadleafcommerce.common.logging.SupportLogManager;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.broadleafcommerce.common.logging.SupportLogger;\n&#x27;
                           &#x27;import org.springframework.beans.BeansException;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.InitializingBean;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.annotation.Autowired;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.config.ConfigurableListableBeanFactory;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.support.BeanDefinitionRegistry;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.context.ApplicationContext;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.core.io.ClassPathResource;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.core.io.FileSystemResource;\n&#x27;
                           &#x27;import org.springframework.core.io.Resource;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.util.PropertyPlaceholderHelper;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.util.StringValueResolver;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.io.IOException;\n&#x27;
                           &#x27;import java.util.ArrayList;\n&#x27;
                           &#x27;import java.util.Collections;\n&#x27;
                           &#x27;import java.util.LinkedHashSet;\n&#x27;
                           &#x27;import java.util.Map.Entry;\n&#x27;
                           &#x27;import java.util.Properties;\n&#x27;
                           &#x27;import java.util.Set;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import javax.annotation.PostConstruct;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * A property resource configurer that chooses the &#x27;
                           &#x27;property file at runtime\n&#x27;
                           &#x27; * based on the runtime environment.\n&#x27;
                           &#x27; * &lt;p&gt;\n&#x27;
                           &#x27; * Used for choosing properties files based on the &#x27;
                           &#x27;current runtime environment,\n&#x27;
                           &#x27; * allowing for movement of the same application &#x27;
                           &#x27;between multiple runtime\n&#x27;
                           &#x27; * environments without rebuilding.\n&#x27;
                           &#x27; * &lt;p&gt;\n&#x27;
                           &#x27; * The property replacement semantics of this &#x27;
                           &#x27;implementation are identical to\n&#x27;
                           &#x27; * PropertyPlaceholderConfigurer, from which this &#x27;
                           &#x27;class inherits. &lt;code&gt;\n&#x27;
                           &#x27; * &lt;pre&gt;\n&#x27;
                           &#x27; * &amp;lt;bean id=&amp;quot;propertyConfigurator&amp;quot; &#x27;
                           &#x27;class=&amp;quot;frilista.framework.RuntimeEnvironmentPropertiesConfigurer&amp;quot;&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;property &#x27;
                           &#x27;name=&amp;quot;propertyLocation&amp;quot; &#x27;
                           &#x27;value=&amp;quot;/WEB-INF/runtime-properties/&amp;quot; &#x27;
                           &#x27;/&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;property &#x27;
                           &#x27;name=&amp;quot;environments&amp;quot;&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;set&amp;gt;\n&#x27;
                           &#x27; *            &#x27;
                           &#x27;&amp;lt;value&amp;gt;production&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *            &amp;lt;value&amp;gt;staging&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *            &#x27;
                           &#x27;&amp;lt;value&amp;gt;integration&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *            &#x27;
                           &#x27;&amp;lt;value&amp;gt;development&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;/set&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;/property&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;property &#x27;
                           &#x27;name=&amp;quot;defaultEnvironment&amp;quot; &#x27;
                           &#x27;value=&amp;quot;development&amp;quot;/&amp;gt;\n&#x27;
                           &#x27; * &amp;lt;/bean&amp;gt;\n&#x27;
                           &#x27; * &lt;/code&gt; &lt;/pre&gt; The keys of the environment &#x27;
                           &#x27;specific properties files are\n&#x27;
                           &#x27; * compared to ensure that each property file &#x27;
                           &#x27;defines the complete set of keys,\n&#x27;
                           &#x27; * in order to avoid environment-specific &#x27;
                           &#x27;failures.\n&#x27;
                           &#x27; * &lt;p&gt;\n&#x27;
                           &#x27; * An optional RuntimeEnvironmentKeyResolver &#x27;
                           &#x27;implementation can be provided,\n&#x27;
                           &#x27; * allowing for customization of how the runtime &#x27;
                           &#x27;environment is determined. If\n&#x27;
                           &#x27; * no implementation is provided, a default of\n&#x27;
                           &#x27; * SystemPropertyRuntimeEnvironmentKeyResolver is &#x27;
                           &#x27;used (which uses the system\n&#x27;
                           &quot; * property &#x27;runtime.environment&#x27;)\n&quot;
                           &#x27; * @author &lt;a &#x27;
                           &#x27;href=&quot;mailto:chris.lee.9@gmail.com&quot;&gt;Chris Lee&lt;/a&gt;\n&#x27;
                           &#x27; * @deprecated Instead of using anything around &#x27;
                           &#x27;the -Druntime-environment values, you should be &#x27;
                           &#x27;using Spring profiles\n&#x27;
                           &#x27; * and properties activated with that via {@link &#x27;
                           &#x27;BroadleafEnvironmentConfiguringApplicationListener}.\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;@Deprecated\n&#x27;
                           &#x27;public class &#x27;
                           &#x27;RuntimeEnvironmentPropertiesConfigurer extends &#x27;
                           &#x27;PropertyPlaceholderConfigurer implements &#x27;
                           &#x27;InitializingBean {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static final Log LOG = &#x27;
                           &#x27;LogFactory.getLog(RuntimeEnvironmentPropertiesConfigurer.class);\n&#x27;
                           &#x27;    protected SupportLogger logger = &#x27;
                           &#x27;SupportLogManager.getLogger(&quot;UserOverride&quot;, &#x27;
                           &#x27;this.getClass());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected static final String &#x27;
                           &#x27;SHARED_PROPERTY_OVERRIDE = &#x27;
                           &#x27;&quot;property-shared-override&quot;;\n&#x27;
                           &#x27;    protected static final String &#x27;
                           &#x27;PROPERTY_OVERRIDE = &quot;property-override&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected static Set&lt;String&gt; &#x27;
                           &#x27;defaultEnvironments = new LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;    protected static Set&lt;Resource&gt; &#x27;
                           &#x27;blcPropertyLocations = new LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;    protected static Set&lt;Resource&gt; &#x27;
                           &#x27;defaultPropertyLocations = new LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    static {\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;production&quot;);\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;staging&quot;);\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;integrationqa&quot;);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;defaultEnvironments.add(&quot;integrationdev&quot;);\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;development&quot;);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/admin/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/cms/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/web/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/fw/&quot;));\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        defaultPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;runtime-properties/&quot;));\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected String defaultEnvironment = &#x27;
                           &#x27;&quot;development&quot;;\n&#x27;
                           &#x27;    protected String determinedEnvironment = &#x27;
                           &#x27;null;\n&#x27;
                           &#x27;    protected RuntimeEnvironmentKeyResolver &#x27;
                           &#x27;keyResolver;\n&#x27;
                           &#x27;    protected Set&lt;String&gt; environments = &#x27;
                           &#x27;Collections.emptySet();\n&#x27;
                           &#x27;    protected Set&lt;Resource&gt; propertyLocations;\n&#x27;
                           &#x27;    protected Set&lt;Resource&gt; &#x27;
                           &#x27;overridableProperyLocations;\n&#x27;
                           &#x27;    protected StringValueResolver &#x27;
                           &#x27;stringValueResolver;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Autowired\n&#x27;
                           &#x27;    protected ApplicationContext &#x27;
                           &#x27;applicationContext;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @PostConstruct\n&#x27;
                           &#x27;    public void init() {\n&#x27;
                           &#x27;        String originatingFile = &#x27;
                           &#x27;((BeanDefinitionRegistry) &#x27;
                           &#x27;applicationContext.getAutowireCapableBeanFactory()).getBeanDefinition(&quot;blConfiguration&quot;).getResourceDescription();\n&#x27;
                           &#x27;        LOG.error(&quot;A blConfiguration bean was &#x27;
                           &#x27;detected in &quot; + originatingFile + &quot;. Any use of &#x27;
                           &#x27;blConfiguration and the &#x27;
                           &#x27;RuntimeEnvironmentProperitesConfigurer is &#x27;
                           &#x27;deprecated and has unknown side-effects. Remove &quot;\n&#x27;
                           &#x27;            + &quot;all instances blConfiguration from &#x27;
                           &#x27;all applicationContext.xml files. Use either a &#x27;
                           &#x27;FrameworkCommonPropertySource, &#x27;
                           &#x27;ProfileAwarePropertySource or a @PropertySource &#x27;
                           &#x27;annotation on an @Configuration class&quot;);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void afterPropertiesSet() throws &#x27;
                           &#x27;IOException {\n&#x27;
                           &#x27;        setIgnoreUnresolvablePlaceholders(true); &#x27;
                           &#x27;// This default will get overriden by user options &#x27;
                           &#x27;if present\n&#x27;
                           &#x27;        setNullValue(&quot;@null&quot;);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        // If no environment override has been &#x27;
                           &#x27;specified, used the default environments\n&#x27;
                           &#x27;        if (environments == null || &#x27;
                           &#x27;environments.size() == 0) {\n&#x27;
                           &#x27;            environments = defaultEnvironments;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        // Prepend the default property locations &#x27;
                           &#x27;to the specified property locations (if any)\n&#x27;
                           &#x27;        Set&lt;Resource&gt; combinedLocations = new &#x27;
                           &#x27;LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(!CollectionUtils.isEmpty(overridableProperyLocations)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            &#x27;
                           &#x27;combinedLocations.addAll(overridableProperyLocations);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(!CollectionUtils.isEmpty(propertyLocations)) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;combinedLocations.addAll(propertyLocations);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        propertyLocations = combinedLocations;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(!environments.contains(defaultEnvironment)) {\n&#x27;
                           &#x27;            throw new AssertionError(&quot;Default &#x27;
                           &#x27;environment \&#x27;&quot; + defaultEnvironment + &quot;\&#x27; not &#x27;
                           &#x27;listed in environment list&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (keyResolver == null) {\n&#x27;
                           &#x27;            keyResolver = new &#x27;
                           &#x27;SystemPropertyRuntimeEnvironmentKeyResolver();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        String environment = &#x27;
                           &#x27;determineEnvironment();\n&#x27;
                           &#x27;        ArrayList&lt;Resource&gt; allLocations = new &#x27;
                           &#x27;ArrayList&lt;&gt;();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        /* Process configuration in the following &#x27;
                           &#x27;order (later files override earlier files\n&#x27;
                           &#x27;         * common-shared.properties\n&#x27;
                           &#x27;         * [environment]-shared.properties\n&#x27;
                           &#x27;         * common.properties\n&#x27;
                           &#x27;         * [environment].properties\n&#x27;
                           &#x27;         * -Dproperty-override-shared specified &#x27;
                           &#x27;value, if any\n&#x27;
                           &#x27;         * -Dproperty-override specified value, if &#x27;
                           &#x27;any  */\n&#x27;
                           &#x27;        Set&lt;Set&lt;Resource&gt;&gt; testLocations = new &#x27;
                           &#x27;LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;        testLocations.add(propertyLocations);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;testLocations.add(defaultPropertyLocations);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        for (Resource resource : &#x27;
                           &#x27;createBroadleafResource()) {\n&#x27;
                           &#x27;            if (resource.exists()) {\n&#x27;
                           &#x27;                allLocations.add(resource);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        for (Set&lt;Resource&gt; locations : &#x27;
                           &#x27;testLocations) {\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createSharedCommonResource(locations)) {\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createSharedPropertiesResource(environment, &#x27;
                           &#x27;locations)) {\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createCommonResource(locations)) {\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createPropertiesResource(environment, locations)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Resource sharedPropertyOverride = &#x27;
                           &#x27;createSharedOverrideResource();\n&#x27;
                           &#x27;        if (sharedPropertyOverride != null) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;allLocations.add(sharedPropertyOverride);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Resource propertyOverride = &#x27;
                           &#x27;createOverrideResource();\n&#x27;
                           &#x27;        if (propertyOverride != null) {\n&#x27;
                           &#x27;            allLocations.add(propertyOverride);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Properties props = new Properties();\n&#x27;
                           &#x27;        for (Resource resource : allLocations) {\n&#x27;
                           &#x27;            if (resource.exists()) {\n&#x27;
                           &#x27;                // We will log source-control &#x27;
                           &#x27;managed properties with trace and overrides with &#x27;
                           &#x27;info\n&#x27;
                           &#x27;                if &#x27;
                           &#x27;(((resource.equals(sharedPropertyOverride) || &#x27;
                           &#x27;resource.equals(propertyOverride)))\n&#x27;
                           &#x27;                        || LOG.isTraceEnabled()) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    props = new &#x27;
                           &#x27;Properties(props);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;props.load(resource.getInputStream());\n&#x27;
                           &#x27;                    for (Entry&lt;Object, Object&gt; &#x27;
                           &#x27;entry : props.entrySet()) {\n&#x27;
                           &#x27;                        if &#x27;
                           &#x27;(resource.equals(sharedPropertyOverride) || &#x27;
                           &#x27;resource.equals(propertyOverride)) {\n&#x27;
                           &#x27;                            logger.support(&quot;Read &quot; &#x27;
                           &#x27;+ entry.getKey() + &quot; from &quot; + &#x27;
                           &#x27;resource.getFilename());\n&#x27;
                           &#x27;                        } else {\n&#x27;
                           &#x27;                            LOG.trace(&quot;Read &quot; + &#x27;
                           &#x27;entry.getKey() + &quot; from &quot; + &#x27;
                           &#x27;resource.getFilename());\n&#x27;
                           &#x27;                        }\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            } else {\n&#x27;
                           &#x27;                LOG.debug(&quot;Unable to locate &#x27;
                           &#x27;resource: &quot; + resource.getFilename());\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        setLocations(allLocations.toArray(new &#x27;
                           &#x27;Resource[] {}));\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createSharedPropertiesResource(String environment, &#x27;
                           &#x27;Set&lt;Resource&gt; locations) throws IOException {\n&#x27;
                           &#x27;        String fileName = &#x27;
                           &#x27;environment.toString().toLowerCase() + &#x27;
                           &#x27;&quot;-shared.properties&quot;;\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(fileName);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] createBroadleafResource() &#x27;
                           &#x27;throws IOException {\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[blcPropertyLocations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : &#x27;
                           &#x27;blcPropertyLocations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(&quot;common.properties&quot;);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createSharedCommonResource(Set&lt;Resource&gt; &#x27;
                           &#x27;locations) throws IOException {\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(&quot;common-shared.properties&quot;);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createPropertiesResource(String environment, &#x27;
                           &#x27;Set&lt;Resource&gt; locations) throws IOException {\n&#x27;
                           &#x27;        String fileName = &#x27;
                           &#x27;environment.toString().toLowerCase() + &#x27;
                           &#x27;&quot;.properties&quot;;\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(fileName);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createCommonResource(Set&lt;Resource&gt; locations) &#x27;
                           &#x27;throws IOException {\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(&quot;common.properties&quot;);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource &#x27;
                           &#x27;createSharedOverrideResource() throws IOException &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        String path = &#x27;
                           &#x27;System.getProperty(SHARED_PROPERTY_OVERRIDE);\n&#x27;
                           &#x27;        return StringUtils.isBlank(path) ? null : &#x27;
                           &#x27;new FileSystemResource(path);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource createOverrideResource() &#x27;
                           &#x27;throws IOException {\n&#x27;
                           &#x27;        String path = &#x27;
                           &#x27;System.getProperty(PROPERTY_OVERRIDE);\n&#x27;
                           &#x27;        return StringUtils.isBlank(path) ? null : &#x27;
                           &#x27;new FileSystemResource(path);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String determineEnvironment() {\n&#x27;
                           &#x27;        if (determinedEnvironment != null) {\n&#x27;
                           &#x27;            return determinedEnvironment;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        determinedEnvironment = &#x27;
                           &#x27;keyResolver.resolveRuntimeEnvironmentKey();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (determinedEnvironment == null) {\n&#x27;
                           &#x27;            LOG.warn(&quot;Unable to determine runtime &#x27;
                           &#x27;environment, using default environment \&#x27;&quot; + &#x27;
                           &#x27;defaultEnvironment + &quot;\&#x27;&quot;);\n&#x27;
                           &#x27;            determinedEnvironment = &#x27;
                           &#x27;defaultEnvironment;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;determinedEnvironment.toLowerCase();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void &#x27;
                           &#x27;processProperties(ConfigurableListableBeanFactory &#x27;
                           &#x27;beanFactoryToProcess, Properties props) throws &#x27;
                           &#x27;BeansException {\n&#x27;
                           &#x27;        &#x27;
                           &#x27;super.processProperties(beanFactoryToProcess, &#x27;
                           &#x27;props);\n&#x27;
                           &#x27;        stringValueResolver = new &#x27;
                           &#x27;PlaceholderResolvingStringValueResolver(props);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the default environment name, used &#x27;
                           &#x27;when the runtime environment\n&#x27;
                           &#x27;     * cannot be determined.\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setDefaultEnvironment(String &#x27;
                           &#x27;defaultEnvironment) {\n&#x27;
                           &#x27;        this.defaultEnvironment = &#x27;
                           &#x27;defaultEnvironment;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String getDefaultEnvironment() {\n&#x27;
                           &#x27;        return defaultEnvironment;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;setKeyResolver(RuntimeEnvironmentKeyResolver &#x27;
                           &#x27;keyResolver) {\n&#x27;
                           &#x27;        this.keyResolver = keyResolver;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the allowed list of runtime &#x27;
                           &#x27;environments\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setEnvironments(Set&lt;String&gt; &#x27;
                           &#x27;environments) {\n&#x27;
                           &#x27;        this.environments = environments;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the directory from which to read &#x27;
                           &#x27;environment-specific properties\n&#x27;
                           &quot;     * files; note that it must end with a &#x27;/&#x27;\n&quot;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setPropertyLocations(Set&lt;Resource&gt; &#x27;
                           &#x27;propertyLocations) {\n&#x27;
                           &#x27;        this.propertyLocations = &#x27;
                           &#x27;propertyLocations;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the directory from which to read &#x27;
                           &#x27;environment-specific properties\n&#x27;
                           &quot;     * files; note that it must end with a &#x27;/&#x27;. &quot;
                           &#x27;Note, these properties may be\n&#x27;
                           &#x27;     * overridden by those defined in &#x27;
                           &#x27;propertyLocations and any &quot;runtime-properties&quot; &#x27;
                           &#x27;directories\n&#x27;
                           &#x27;     *\n&#x27;
                           &#x27;     * @param overridableProperyLocations location &#x27;
                           &#x27;containing overridable environment properties\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;setOverridableProperyLocations(Set&lt;Resource&gt; &#x27;
                           &#x27;overridableProperyLocations) {\n&#x27;
                           &#x27;        this.overridableProperyLocations = &#x27;
                           &#x27;overridableProperyLocations;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class &#x27;
                           &#x27;PlaceholderResolvingStringValueResolver implements &#x27;
                           &#x27;StringValueResolver {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private final PropertyPlaceholderHelper &#x27;
                           &#x27;helper;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private final &#x27;
                           &#x27;PropertyPlaceholderHelper.PlaceholderResolver &#x27;
                           &#x27;resolver;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public &#x27;
                           &#x27;PlaceholderResolvingStringValueResolver(Properties &#x27;
                           &#x27;props) {\n&#x27;
                           &#x27;            this.helper = new &#x27;
                           &#x27;PropertyPlaceholderHelper(&quot;${&quot;, &quot;}&quot;, &quot;:&quot;, true);\n&#x27;
                           &#x27;            this.resolver = new &#x27;
                           &#x27;PropertyPlaceholderConfigurerResolver(props);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public String resolveStringValue(String &#x27;
                           &#x27;strVal) throws BeansException {\n&#x27;
                           &#x27;            String value = &#x27;
                           &#x27;this.helper.replacePlaceholders(strVal, &#x27;
                           &#x27;this.resolver);\n&#x27;
                           &#x27;            return (value.equals(&quot;&quot;) ? null : &#x27;
                           &#x27;value);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class &#x27;
                           &#x27;PropertyPlaceholderConfigurerResolver implements &#x27;
                           &#x27;PropertyPlaceholderHelper.PlaceholderResolver {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private final Properties props;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private &#x27;
                           &#x27;PropertyPlaceholderConfigurerResolver(Properties &#x27;
                           &#x27;props) {\n&#x27;
                           &#x27;            this.props = props;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public String resolvePlaceholder(String &#x27;
                           &#x27;placeholderName) {\n&#x27;
                           &#x27;            return &#x27;
                           &#x27;RuntimeEnvironmentPropertiesConfigurer.this.resolvePlaceholder(placeholderName, &#x27;
                           &#x27;props, 1);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public StringValueResolver &#x27;
                           &#x27;getStringValueResolver() {\n&#x27;
                           &#x27;        return stringValueResolver;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;\n&#x27;
                           &#x27;/*-\n&#x27;
                           &#x27; * #%L\n&#x27;
                           &#x27; * BroadleafCommerce Common Libraries\n&#x27;
                           &#x27; * %%\n&#x27;
                           &#x27; * Copyright (C) 2009 - 2022 Broadleaf Commerce\n&#x27;
                           &#x27; * %%\n&#x27;
                           &#x27; * Licensed under the Broadleaf Fair Use License &#x27;
                           &#x27;Agreement, Version 1.0\n&#x27;
                           &#x27; * (the &quot;Fair Use License&quot; located  at &#x27;
                           &#x27;http://license.broadleafcommerce.org/fair_use_license-1.0.txt)\n&#x27;
                           &#x27; * unless the restrictions on use therein are &#x27;
                           &#x27;violated and require payment to Broadleaf in which &#x27;
                           &#x27;case\n&#x27;
                           &#x27; * the Broadleaf End User License Agreement &#x27;
                           &#x27;(EULA), Version 1.1\n&#x27;
                           &#x27; * (the &quot;Commercial License&quot; located at &#x27;
                           &#x27;http://license.broadleafcommerce.org/commercial_license-1.1.txt)\n&#x27;
                           &#x27; * shall apply.\n&#x27;
                           &#x27; *\n&#x27;
                           &#x27; * Alternatively, the Commercial License may be &#x27;
                           &#x27;replaced with a mutually agreed upon license (the &#x27;
                           &#x27;&quot;Custom License&quot;)\n&#x27;
                           &#x27; * between you and Broadleaf Commerce. You may not &#x27;
                           &#x27;use this file except in compliance with the &#x27;
                           &#x27;applicable license.\n&#x27;
                           &#x27; * #L%\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;package org.broadleafcommerce.common.config;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.commons.collections.CollectionUtils;\n&#x27;
                           &#x27;import org.apache.commons.lang3.StringUtils;\n&#x27;
                           &#x27;import org.apache.commons.logging.Log;\n&#x27;
                           &#x27;import org.apache.commons.logging.LogFactory;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.broadleafcommerce.common.logging.SupportLogManager;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.broadleafcommerce.common.logging.SupportLogger;\n&#x27;
                           &#x27;import org.springframework.beans.BeansException;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.InitializingBean;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.annotation.Autowired;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.config.ConfigurableListableBeanFactory;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.support.BeanDefinitionRegistry;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.context.ApplicationContext;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.core.io.ClassPathResource;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.core.io.FileSystemResource;\n&#x27;
                           &#x27;import org.springframework.core.io.Resource;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.util.PropertyPlaceholderHelper;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.util.StringValueResolver;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.io.IOException;\n&#x27;
                           &#x27;import java.util.ArrayList;\n&#x27;
                           &#x27;import java.util.Collections;\n&#x27;
                           &#x27;import java.util.LinkedHashSet;\n&#x27;
                           &#x27;import java.util.Map.Entry;\n&#x27;
                           &#x27;import java.util.Properties;\n&#x27;
                           &#x27;import java.util.Set;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import javax.annotation.PostConstruct;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * A property resource configurer that chooses the &#x27;
                           &#x27;property file at runtime\n&#x27;
                           &#x27; * based on the runtime environment.\n&#x27;
                           &#x27; * &lt;p&gt;\n&#x27;
                           &#x27; * Used for choosing properties files based on the &#x27;
                           &#x27;current runtime environment,\n&#x27;
                           &#x27; * allowing for movement of the same application &#x27;
                           &#x27;between multiple runtime\n&#x27;
                           &#x27; * environments without rebuilding.\n&#x27;
                           &#x27; * &lt;p&gt;\n&#x27;
                           &#x27; * The property replacement semantics of this &#x27;
                           &#x27;implementation are identical to\n&#x27;
                           &#x27; * PropertyPlaceholderConfigurer, from which this &#x27;
                           &#x27;class inherits. &lt;code&gt;\n&#x27;
                           &#x27; * &lt;pre&gt;\n&#x27;
                           &#x27; * &amp;lt;bean id=&amp;quot;propertyConfigurator&amp;quot; &#x27;
                           &#x27;class=&amp;quot;frilista.framework.RuntimeEnvironmentPropertiesConfigurer&amp;quot;&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;property &#x27;
                           &#x27;name=&amp;quot;propertyLocation&amp;quot; &#x27;
                           &#x27;value=&amp;quot;/WEB-INF/runtime-properties/&amp;quot; &#x27;
                           &#x27;/&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;property &#x27;
                           &#x27;name=&amp;quot;environments&amp;quot;&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;set&amp;gt;\n&#x27;
                           &#x27; *            &#x27;
                           &#x27;&amp;lt;value&amp;gt;production&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *            &amp;lt;value&amp;gt;staging&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *            &#x27;
                           &#x27;&amp;lt;value&amp;gt;integration&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *            &#x27;
                           &#x27;&amp;lt;value&amp;gt;development&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;/set&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;/property&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;property &#x27;
                           &#x27;name=&amp;quot;defaultEnvironment&amp;quot; &#x27;
                           &#x27;value=&amp;quot;development&amp;quot;/&amp;gt;\n&#x27;
                           &#x27; * &amp;lt;/bean&amp;gt;\n&#x27;
                           &#x27; * &lt;/code&gt; &lt;/pre&gt; The keys of the environment &#x27;
                           &#x27;specific properties files are\n&#x27;
                           &#x27; * compared to ensure that each property file &#x27;
                           &#x27;defines the complete set of keys,\n&#x27;
                           &#x27; * in order to avoid environment-specific &#x27;
                           &#x27;failures.\n&#x27;
                           &#x27; * &lt;p&gt;\n&#x27;
                           &#x27; * An optional RuntimeEnvironmentKeyResolver &#x27;
                           &#x27;implementation can be provided,\n&#x27;
                           &#x27; * allowing for customization of how the runtime &#x27;
                           &#x27;environment is determined. If\n&#x27;
                           &#x27; * no implementation is provided, a default of\n&#x27;
                           &#x27; * SystemPropertyRuntimeEnvironmentKeyResolver is &#x27;
                           &#x27;used (which uses the system\n&#x27;
                           &quot; * property &#x27;runtime.environment&#x27;)\n&quot;
                           &#x27; * @author &lt;a &#x27;
                           &#x27;href=&quot;mailto:chris.lee.9@gmail.com&quot;&gt;Chris Lee&lt;/a&gt;\n&#x27;
                           &#x27; * @deprecated Instead of using anything around &#x27;
                           &#x27;the -Druntime-environment values, you should be &#x27;
                           &#x27;using Spring profiles\n&#x27;
                           &#x27; * and properties activated with that via {@link &#x27;
                           &#x27;BroadleafEnvironmentConfiguringApplicationListener}.\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;@Deprecated\n&#x27;
                           &#x27;public class &#x27;
                           &#x27;RuntimeEnvironmentPropertiesConfigurer extends &#x27;
                           &#x27;PropertyPlaceholderConfigurer implements &#x27;
                           &#x27;InitializingBean {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static final Log LOG = &#x27;
                           &#x27;LogFactory.getLog(RuntimeEnvironmentPropertiesConfigurer.class);\n&#x27;
                           &#x27;    protected SupportLogger logger = &#x27;
                           &#x27;SupportLogManager.getLogger(&quot;UserOverride&quot;, &#x27;
                           &#x27;this.getClass());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected static final String &#x27;
                           &#x27;SHARED_PROPERTY_OVERRIDE = &#x27;
                           &#x27;&quot;property-shared-override&quot;;\n&#x27;
                           &#x27;    protected static final String &#x27;
                           &#x27;PROPERTY_OVERRIDE = &quot;property-override&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected static Set&lt;String&gt; &#x27;
                           &#x27;defaultEnvironments = new LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;    protected static Set&lt;Resource&gt; &#x27;
                           &#x27;blcPropertyLocations = new LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;    protected static Set&lt;Resource&gt; &#x27;
                           &#x27;defaultPropertyLocations = new LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    static {\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;production&quot;);\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;staging&quot;);\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;integrationqa&quot;);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;defaultEnvironments.add(&quot;integrationdev&quot;);\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;development&quot;);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/admin/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/cms/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/web/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/fw/&quot;));\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        defaultPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;runtime-properties/&quot;));\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected String defaultEnvironment = &#x27;
                           &#x27;&quot;development&quot;;\n&#x27;
                           &#x27;    protected String determinedEnvironment = &#x27;
                           &#x27;null;\n&#x27;
                           &#x27;    protected RuntimeEnvironmentKeyResolver &#x27;
                           &#x27;keyResolver;\n&#x27;
                           &#x27;    protected Set&lt;String&gt; environments = &#x27;
                           &#x27;Collections.emptySet();\n&#x27;
                           &#x27;    protected Set&lt;Resource&gt; propertyLocations;\n&#x27;
                           &#x27;    protected Set&lt;Resource&gt; &#x27;
                           &#x27;overridableProperyLocations;\n&#x27;
                           &#x27;    protected StringValueResolver &#x27;
                           &#x27;stringValueResolver;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Autowired\n&#x27;
                           &#x27;    protected ApplicationContext &#x27;
                           &#x27;applicationContext;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @PostConstruct\n&#x27;
                           &#x27;    public void init() {\n&#x27;
                           &#x27;        String originatingFile = &#x27;
                           &#x27;((BeanDefinitionRegistry) &#x27;
                           &#x27;applicationContext.getAutowireCapableBeanFactory()).getBeanDefinition(&quot;blConfiguration&quot;).getResourceDescription();\n&#x27;
                           &#x27;        LOG.error(&quot;A blConfiguration bean was &#x27;
                           &#x27;detected in &quot; + originatingFile + &quot;. Any use of &#x27;
                           &#x27;blConfiguration and the &#x27;
                           &#x27;RuntimeEnvironmentProperitesConfigurer is &#x27;
                           &#x27;deprecated and has unknown side-effects. Remove &quot;\n&#x27;
                           &#x27;            + &quot;all instances blConfiguration from &#x27;
                           &#x27;all applicationContext.xml files. Use either a &#x27;
                           &#x27;FrameworkCommonPropertySource, &#x27;
                           &#x27;ProfileAwarePropertySource or a @PropertySource &#x27;
                           &#x27;annotation on an @Configuration class&quot;);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void afterPropertiesSet() throws &#x27;
                           &#x27;IOException {\n&#x27;
                           &#x27;        setIgnoreUnresolvablePlaceholders(true); &#x27;
                           &#x27;// This default will get overriden by user options &#x27;
                           &#x27;if present\n&#x27;
                           &#x27;        setNullValue(&quot;@null&quot;);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        // If no environment override has been &#x27;
                           &#x27;specified, used the default environments\n&#x27;
                           &#x27;        if (environments == null || &#x27;
                           &#x27;environments.size() == 0) {\n&#x27;
                           &#x27;            environments = defaultEnvironments;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        // Prepend the default property locations &#x27;
                           &#x27;to the specified property locations (if any)\n&#x27;
                           &#x27;        Set&lt;Resource&gt; combinedLocations = new &#x27;
                           &#x27;LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(!CollectionUtils.isEmpty(overridableProperyLocations)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            &#x27;
                           &#x27;combinedLocations.addAll(overridableProperyLocations);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(!CollectionUtils.isEmpty(propertyLocations)) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;combinedLocations.addAll(propertyLocations);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        propertyLocations = combinedLocations;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(!environments.contains(defaultEnvironment)) {\n&#x27;
                           &#x27;            throw new AssertionError(&quot;Default &#x27;
                           &#x27;environment \&#x27;&quot; + defaultEnvironment + &quot;\&#x27; not &#x27;
                           &#x27;listed in environment list&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (keyResolver == null) {\n&#x27;
                           &#x27;            keyResolver = new &#x27;
                           &#x27;SystemPropertyRuntimeEnvironmentKeyResolver();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        String environment = &#x27;
                           &#x27;determineEnvironment();\n&#x27;
                           &#x27;        ArrayList&lt;Resource&gt; allLocations = new &#x27;
                           &#x27;ArrayList&lt;&gt;();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        /* Process configuration in the following &#x27;
                           &#x27;order (later files override earlier files\n&#x27;
                           &#x27;         * common-shared.properties\n&#x27;
                           &#x27;         * [environment]-shared.properties\n&#x27;
                           &#x27;         * common.properties\n&#x27;
                           &#x27;         * [environment].properties\n&#x27;
                           &#x27;         * -Dproperty-override-shared specified &#x27;
                           &#x27;value, if any\n&#x27;
                           &#x27;         * -Dproperty-override specified value, if &#x27;
                           &#x27;any  */\n&#x27;
                           &#x27;        Set&lt;Set&lt;Resource&gt;&gt; testLocations = new &#x27;
                           &#x27;LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;        testLocations.add(propertyLocations);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;testLocations.add(defaultPropertyLocations);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        for (Resource resource : &#x27;
                           &#x27;createBroadleafResource()) {\n&#x27;
                           &#x27;            if (resource.exists()) {\n&#x27;
                           &#x27;                allLocations.add(resource);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        for (Set&lt;Resource&gt; locations : &#x27;
                           &#x27;testLocations) {\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createSharedCommonResource(locations)) {\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createSharedPropertiesResource(environment, &#x27;
                           &#x27;locations)) {\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createCommonResource(locations)) {\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createPropertiesResource(environment, locations)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Resource sharedPropertyOverride = &#x27;
                           &#x27;createSharedOverrideResource();\n&#x27;
                           &#x27;        if (sharedPropertyOverride != null) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;allLocations.add(sharedPropertyOverride);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Resource propertyOverride = &#x27;
                           &#x27;createOverrideResource();\n&#x27;
                           &#x27;        if (propertyOverride != null) {\n&#x27;
                           &#x27;            allLocations.add(propertyOverride);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Properties props = new Properties();\n&#x27;
                           &#x27;        for (Resource resource : allLocations) {\n&#x27;
                           &#x27;            if (resource.exists()) {\n&#x27;
                           &#x27;                // We will log source-control &#x27;
                           &#x27;managed properties with trace and overrides with &#x27;
                           &#x27;info\n&#x27;
                           &#x27;                if &#x27;
                           &#x27;(((resource.equals(sharedPropertyOverride) || &#x27;
                           &#x27;resource.equals(propertyOverride)))\n&#x27;
                           &#x27;                        || LOG.isTraceEnabled()) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    props = new &#x27;
                           &#x27;Properties(props);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;props.load(resource.getInputStream());\n&#x27;
                           &#x27;                    for (Entry&lt;Object, Object&gt; &#x27;
                           &#x27;entry : props.entrySet()) {\n&#x27;
                           &#x27;                        if &#x27;
                           &#x27;(resource.equals(sharedPropertyOverride) || &#x27;
                           &#x27;resource.equals(propertyOverride)) {\n&#x27;
                           &#x27;                            logger.support(&quot;Read &quot; &#x27;
                           &#x27;+ entry.getKey() + &quot; from &quot; + &#x27;
                           &#x27;resource.getFilename());\n&#x27;
                           &#x27;                        } else {\n&#x27;
                           &#x27;                            LOG.trace(&quot;Read &quot; + &#x27;
                           &#x27;entry.getKey() + &quot; from &quot; + &#x27;
                           &#x27;resource.getFilename());\n&#x27;
                           &#x27;                        }\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            } else {\n&#x27;
                           &#x27;                LOG.debug(&quot;Unable to locate &#x27;
                           &#x27;resource: &quot; + resource.getFilename());\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        setLocations(allLocations.toArray(new &#x27;
                           &#x27;Resource[] {}));\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createSharedPropertiesResource(String environment, &#x27;
                           &#x27;Set&lt;Resource&gt; locations) throws IOException {\n&#x27;
                           &#x27;        String fileName = &#x27;
                           &#x27;environment.toString().toLowerCase() + &#x27;
                           &#x27;&quot;-shared.properties&quot;;\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(fileName);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] createBroadleafResource() &#x27;
                           &#x27;throws IOException {\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[blcPropertyLocations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : &#x27;
                           &#x27;blcPropertyLocations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(&quot;common.properties&quot;);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createSharedCommonResource(Set&lt;Resource&gt; &#x27;
                           &#x27;locations) throws IOException {\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(&quot;common-shared.properties&quot;);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createPropertiesResource(String environment, &#x27;
                           &#x27;Set&lt;Resource&gt; locations) throws IOException {\n&#x27;
                           &#x27;        String fileName = &#x27;
                           &#x27;environment.toString().toLowerCase() + &#x27;
                           &#x27;&quot;.properties&quot;;\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(fileName);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createCommonResource(Set&lt;Resource&gt; locations) &#x27;
                           &#x27;throws IOException {\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(&quot;common.properties&quot;);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource &#x27;
                           &#x27;createSharedOverrideResource() throws IOException &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        String path = &#x27;
                           &#x27;System.getProperty(SHARED_PROPERTY_OVERRIDE);\n&#x27;
                           &#x27;        return StringUtils.isBlank(path) ? null : &#x27;
                           &#x27;new FileSystemResource(path);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource createOverrideResource() &#x27;
                           &#x27;throws IOException {\n&#x27;
                           &#x27;        String path = &#x27;
                           &#x27;System.getProperty(PROPERTY_OVERRIDE);\n&#x27;
                           &#x27;        return StringUtils.isBlank(path) ? null : &#x27;
                           &#x27;new FileSystemResource(path);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String determineEnvironment() {\n&#x27;
                           &#x27;        if (determinedEnvironment != null) {\n&#x27;
                           &#x27;            return determinedEnvironment;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        determinedEnvironment = &#x27;
                           &#x27;keyResolver.resolveRuntimeEnvironmentKey();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (determinedEnvironment == null) {\n&#x27;
                           &#x27;            LOG.warn(&quot;Unable to determine runtime &#x27;
                           &#x27;environment, using default environment \&#x27;&quot; + &#x27;
                           &#x27;defaultEnvironment + &quot;\&#x27;&quot;);\n&#x27;
                           &#x27;            determinedEnvironment = &#x27;
                           &#x27;defaultEnvironment;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;determinedEnvironment.toLowerCase();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void &#x27;
                           &#x27;processProperties(ConfigurableListableBeanFactory &#x27;
                           &#x27;beanFactoryToProcess, Properties props) throws &#x27;
                           &#x27;BeansException {\n&#x27;
                           &#x27;        &#x27;
                           &#x27;super.processProperties(beanFactoryToProcess, &#x27;
                           &#x27;props);\n&#x27;
                           &#x27;        stringValueResolver = new &#x27;
                           &#x27;PlaceholderResolvingStringValueResolver(props);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the default environment name, used &#x27;
                           &#x27;when the runtime environment\n&#x27;
                           &#x27;     * cannot be determined.\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setDefaultEnvironment(String &#x27;
                           &#x27;defaultEnvironment) {\n&#x27;
                           &#x27;        this.defaultEnvironment = &#x27;
                           &#x27;defaultEnvironment;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String getDefaultEnvironment() {\n&#x27;
                           &#x27;        return defaultEnvironment;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;setKeyResolver(RuntimeEnvironmentKeyResolver &#x27;
                           &#x27;keyResolver) {\n&#x27;
                           &#x27;        this.keyResolver = keyResolver;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the allowed list of runtime &#x27;
                           &#x27;environments\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setEnvironments(Set&lt;String&gt; &#x27;
                           &#x27;environments) {\n&#x27;
                           &#x27;        this.environments = environments;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the directory from which to read &#x27;
                           &#x27;environment-specific properties\n&#x27;
                           &quot;     * files; note that it must end with a &#x27;/&#x27;\n&quot;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setPropertyLocations(Set&lt;Resource&gt; &#x27;
                           &#x27;propertyLocations) {\n&#x27;
                           &#x27;        this.propertyLocations = &#x27;
                           &#x27;propertyLocations;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the directory from which to read &#x27;
                           &#x27;environment-specific properties\n&#x27;
                           &quot;     * files; note that it must end with a &#x27;/&#x27;. &quot;
                           &#x27;Note, these properties may be\n&#x27;
                           &#x27;     * overridden by those defined in &#x27;
                           &#x27;propertyLocations and any &quot;runtime-properties&quot; &#x27;
                           &#x27;directories\n&#x27;
                           &#x27;     *\n&#x27;
                           &#x27;     * @param overridableProperyLocations location &#x27;
                           &#x27;containing overridable environment properties\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;setOverridableProperyLocations(Set&lt;Resource&gt; &#x27;
                           &#x27;overridableProperyLocations) {\n&#x27;
                           &#x27;        this.overridableProperyLocations = &#x27;
                           &#x27;overridableProperyLocations;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class &#x27;
                           &#x27;PlaceholderResolvingStringValueResolver implements &#x27;
                           &#x27;StringValueResolver {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private final PropertyPlaceholderHelper &#x27;
                           &#x27;helper;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private final &#x27;
                           &#x27;PropertyPlaceholderHelper.PlaceholderResolver &#x27;
                           &#x27;resolver;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public &#x27;
                           &#x27;PlaceholderResolvingStringValueResolver(Properties &#x27;
                           &#x27;props) {\n&#x27;
                           &#x27;            this.helper = new &#x27;
                           &#x27;PropertyPlaceholderHelper(&quot;${&quot;, &quot;}&quot;, &quot;:&quot;, true);\n&#x27;
                           &#x27;            this.resolver = new &#x27;
                           &#x27;PropertyPlaceholderConfigurerResolver(props);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public String resolveStringValue(String &#x27;
                           &#x27;strVal) throws BeansException {\n&#x27;
                           &#x27;            String value = &#x27;
                           &#x27;this.helper.replacePlaceholders(strVal, &#x27;
                           &#x27;this.resolver);\n&#x27;
                           &#x27;            return (value.equals(&quot;&quot;) ? null : &#x27;
                           &#x27;value);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class &#x27;
                           &#x27;PropertyPlaceholderConfigurerResolver implements &#x27;
                           &#x27;PropertyPlaceholderHelper.PlaceholderResolver {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private final Properties props;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private &#x27;
                           &#x27;PropertyPlaceholderConfigurerResolver(Properties &#x27;
                           &#x27;props) {\n&#x27;
                           &#x27;            this.props = props;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public String resolvePlaceholder(String &#x27;
                           &#x27;placeholderName) {\n&#x27;
                           &#x27;            return &#x27;
                           &#x27;RuntimeEnvironmentPropertiesConfigurer.this.resolvePlaceholder(placeholderName, &#x27;
                           &#x27;props, 1);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public StringValueResolver &#x27;
                           &#x27;getStringValueResolver() {\n&#x27;
                           &#x27;        return stringValueResolver;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;}\n&#x27;}],
   &#x27;mergers&#x27;: {&#x27;spork&#x27;, &#x27;baseline&#x27;, &#x27;jfstmerge&#x27;}}],
 [{&#x27;eq&#x27;: [{&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;/*-\n&#x27;
                           &#x27; * #%L\n&#x27;
                           &#x27; * BroadleafCommerce Common Libraries\n&#x27;
                           &#x27; * %%\n&#x27;
                           &#x27; * Copyright (C) 2009 - 2022 Broadleaf Commerce\n&#x27;
                           &#x27; * %%\n&#x27;
                           &#x27; * Licensed under the Broadleaf Fair Use License &#x27;
                           &#x27;Agreement, Version 1.0\n&#x27;
                           &#x27; * (the &quot;Fair Use License&quot; located  at &#x27;
                           &#x27;http://license.broadleafcommerce.org/fair_use_license-1.0.txt)\n&#x27;
                           &#x27; * unless the restrictions on use therein are &#x27;
                           &#x27;violated and require payment to Broadleaf in which &#x27;
                           &#x27;case\n&#x27;
                           &#x27; * the Broadleaf End User License Agreement &#x27;
                           &#x27;(EULA), Version 1.1\n&#x27;
                           &#x27; * (the &quot;Commercial License&quot; located at &#x27;
                           &#x27;http://license.broadleafcommerce.org/commercial_license-1.1.txt)\n&#x27;
                           &#x27; * shall apply.\n&#x27;
                           &#x27; * \n&#x27;
                           &#x27; * Alternatively, the Commercial License may be &#x27;
                           &#x27;replaced with a mutually agreed upon license (the &#x27;
                           &#x27;&quot;Custom License&quot;)\n&#x27;
                           &#x27; * between you and Broadleaf Commerce. You may not &#x27;
                           &#x27;use this file except in compliance with the &#x27;
                           &#x27;applicable license.\n&#x27;
                           &#x27; * #L%\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;package org.broadleafcommerce.common.config;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.commons.collections.CollectionUtils;\n&#x27;
                           &#x27;import org.apache.commons.lang3.StringUtils;\n&#x27;
                           &#x27;import org.apache.commons.logging.Log;\n&#x27;
                           &#x27;import org.apache.commons.logging.LogFactory;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.broadleafcommerce.common.logging.SupportLogManager;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.broadleafcommerce.common.logging.SupportLogger;\n&#x27;
                           &#x27;import org.springframework.beans.BeansException;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.InitializingBean;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.annotation.Autowired;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.config.ConfigurableListableBeanFactory;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.support.BeanDefinitionRegistry;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.context.ApplicationContext;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.core.io.ClassPathResource;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.core.io.FileSystemResource;\n&#x27;
                           &#x27;import org.springframework.core.io.Resource;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.util.PropertyPlaceholderHelper;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.util.StringValueResolver;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.io.IOException;\n&#x27;
                           &#x27;import java.util.ArrayList;\n&#x27;
                           &#x27;import java.util.Collections;\n&#x27;
                           &#x27;import java.util.LinkedHashSet;\n&#x27;
                           &#x27;import java.util.Map.Entry;\n&#x27;
                           &#x27;import java.util.Properties;\n&#x27;
                           &#x27;import java.util.Set;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import javax.annotation.PostConstruct;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * A property resource configurer that chooses the &#x27;
                           &#x27;property file at runtime\n&#x27;
                           &#x27; * based on the runtime environment.\n&#x27;
                           &#x27; * &lt;p&gt;\n&#x27;
                           &#x27; * Used for choosing properties files based on the &#x27;
                           &#x27;current runtime environment,\n&#x27;
                           &#x27; * allowing for movement of the same application &#x27;
                           &#x27;between multiple runtime\n&#x27;
                           &#x27; * environments without rebuilding.\n&#x27;
                           &#x27; * &lt;p&gt;\n&#x27;
                           &#x27; * The property replacement semantics of this &#x27;
                           &#x27;implementation are identical to\n&#x27;
                           &#x27; * PropertyPlaceholderConfigurer, from which this &#x27;
                           &#x27;class inherits. &lt;code&gt;\n&#x27;
                           &#x27; * &lt;pre&gt;\n&#x27;
                           &#x27; * &amp;lt;bean id=&amp;quot;propertyConfigurator&amp;quot; &#x27;
                           &#x27;class=&amp;quot;frilista.framework.RuntimeEnvironmentPropertiesConfigurer&amp;quot;&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;property &#x27;
                           &#x27;name=&amp;quot;propertyLocation&amp;quot; &#x27;
                           &#x27;value=&amp;quot;/WEB-INF/runtime-properties/&amp;quot; &#x27;
                           &#x27;/&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;property &#x27;
                           &#x27;name=&amp;quot;environments&amp;quot;&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;set&amp;gt;\n&#x27;
                           &#x27; *            &#x27;
                           &#x27;&amp;lt;value&amp;gt;production&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *            &amp;lt;value&amp;gt;staging&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *            &#x27;
                           &#x27;&amp;lt;value&amp;gt;integration&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *            &#x27;
                           &#x27;&amp;lt;value&amp;gt;development&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;/set&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;/property&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;property &#x27;
                           &#x27;name=&amp;quot;defaultEnvironment&amp;quot; &#x27;
                           &#x27;value=&amp;quot;development&amp;quot;/&amp;gt;\n&#x27;
                           &#x27; * &amp;lt;/bean&amp;gt;\n&#x27;
                           &#x27; * &lt;/code&gt; &lt;/pre&gt; The keys of the environment &#x27;
                           &#x27;specific properties files are\n&#x27;
                           &#x27; * compared to ensure that each property file &#x27;
                           &#x27;defines the complete set of keys,\n&#x27;
                           &#x27; * in order to avoid environment-specific &#x27;
                           &#x27;failures.\n&#x27;
                           &#x27; * &lt;p&gt;\n&#x27;
                           &#x27; * An optional RuntimeEnvironmentKeyResolver &#x27;
                           &#x27;implementation can be provided,\n&#x27;
                           &#x27; * allowing for customization of how the runtime &#x27;
                           &#x27;environment is determined. If\n&#x27;
                           &#x27; * no implementation is provided, a default of\n&#x27;
                           &#x27; * SystemPropertyRuntimeEnvironmentKeyResolver is &#x27;
                           &#x27;used (which uses the system\n&#x27;
                           &quot; * property &#x27;runtime.environment&#x27;)\n&quot;
                           &#x27; * @author &lt;a &#x27;
                           &#x27;href=&quot;mailto:chris.lee.9@gmail.com&quot;&gt;Chris Lee&lt;/a&gt;\n&#x27;
                           &#x27; * @deprecated Instead of using anything around &#x27;
                           &#x27;the -Druntime-environment values, you should be &#x27;
                           &#x27;using Spring profiles\n&#x27;
                           &#x27; * and properties activated with that via {@link &#x27;
                           &#x27;BroadleafEnvironmentConfiguringApplicationListener}.\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;@Deprecated\n&#x27;
                           &#x27;public class &#x27;
                           &#x27;RuntimeEnvironmentPropertiesConfigurer extends &#x27;
                           &#x27;PropertyPlaceholderConfigurer implements &#x27;
                           &#x27;InitializingBean {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static final Log LOG = &#x27;
                           &#x27;LogFactory.getLog(RuntimeEnvironmentPropertiesConfigurer.class);\n&#x27;
                           &#x27;    protected SupportLogger logger = &#x27;
                           &#x27;SupportLogManager.getLogger(&quot;UserOverride&quot;, &#x27;
                           &#x27;this.getClass());\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    protected static final String &#x27;
                           &#x27;SHARED_PROPERTY_OVERRIDE = &#x27;
                           &#x27;&quot;property-shared-override&quot;;\n&#x27;
                           &#x27;    protected static final String &#x27;
                           &#x27;PROPERTY_OVERRIDE = &quot;property-override&quot;;\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    protected static Set&lt;String&gt; &#x27;
                           &#x27;defaultEnvironments = new LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;    protected static Set&lt;Resource&gt; &#x27;
                           &#x27;blcPropertyLocations = new LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;    protected static Set&lt;Resource&gt; &#x27;
                           &#x27;defaultPropertyLocations = new LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    static {\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;production&quot;);\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;staging&quot;);\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;integrationqa&quot;);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;defaultEnvironments.add(&quot;integrationdev&quot;);\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;development&quot;);\n&#x27;
                           &#x27;        \n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/admin/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/cms/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/web/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/fw/&quot;));\n&#x27;
                           &#x27;        \n&#x27;
                           &#x27;        defaultPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;runtime-properties/&quot;));\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected String defaultEnvironment = &#x27;
                           &#x27;&quot;development&quot;;\n&#x27;
                           &#x27;    protected String determinedEnvironment = &#x27;
                           &#x27;null;\n&#x27;
                           &#x27;    protected RuntimeEnvironmentKeyResolver &#x27;
                           &#x27;keyResolver;\n&#x27;
                           &#x27;    protected Set&lt;String&gt; environments = &#x27;
                           &#x27;Collections.emptySet();\n&#x27;
                           &#x27;    protected Set&lt;Resource&gt; propertyLocations;\n&#x27;
                           &#x27;    protected Set&lt;Resource&gt; &#x27;
                           &#x27;overridableProperyLocations;\n&#x27;
                           &#x27;    protected StringValueResolver &#x27;
                           &#x27;stringValueResolver;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Autowired\n&#x27;
                           &#x27;    protected ApplicationContext &#x27;
                           &#x27;applicationContext;\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    @PostConstruct\n&#x27;
                           &#x27;    public void init() {\n&#x27;
                           &#x27;        String originatingFile = &#x27;
                           &#x27;((BeanDefinitionRegistry) &#x27;
                           &#x27;applicationContext.getAutowireCapableBeanFactory()).getBeanDefinition(&quot;blConfiguration&quot;).getResourceDescription();\n&#x27;
                           &#x27;        LOG.error(&quot;A blConfiguration bean was &#x27;
                           &#x27;detected in &quot; + originatingFile + &quot;. Any use of &#x27;
                           &#x27;blConfiguration and the &#x27;
                           &#x27;RuntimeEnvironmentProperitesConfigurer is &#x27;
                           &#x27;deprecated and has unknown side-effects. Remove &quot;\n&#x27;
                           &#x27;            + &quot;all instances blConfiguration from &#x27;
                           &#x27;all applicationContext.xml files. Use either a &#x27;
                           &#x27;FrameworkCommonPropertySource, &#x27;
                           &#x27;ProfileAwarePropertySource or a @PropertySource &#x27;
                           &#x27;annotation on an @Configuration class&quot;);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void afterPropertiesSet() throws &#x27;
                           &#x27;IOException {\n&#x27;
                           &#x27;        setIgnoreUnresolvablePlaceholders(true); &#x27;
                           &#x27;// This default will get overriden by user options &#x27;
                           &#x27;if present\n&#x27;
                           &#x27;        setNullValue(&quot;@null&quot;);\n&#x27;
                           &#x27;        \n&#x27;
                           &#x27;        // If no environment override has been &#x27;
                           &#x27;specified, used the default environments\n&#x27;
                           &#x27;        if (environments == null || &#x27;
                           &#x27;environments.size() == 0) {\n&#x27;
                           &#x27;            environments = defaultEnvironments;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        \n&#x27;
                           &#x27;        // Prepend the default property locations &#x27;
                           &#x27;to the specified property locations (if any)\n&#x27;
                           &#x27;        Set&lt;Resource&gt; combinedLocations = new &#x27;
                           &#x27;LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(!CollectionUtils.isEmpty(overridableProperyLocations)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            &#x27;
                           &#x27;combinedLocations.addAll(overridableProperyLocations);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(!CollectionUtils.isEmpty(propertyLocations)) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;combinedLocations.addAll(propertyLocations);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        propertyLocations = combinedLocations;\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(!environments.contains(defaultEnvironment)) {\n&#x27;
                           &#x27;            throw new AssertionError(&quot;Default &#x27;
                           &#x27;environment \&#x27;&quot; + defaultEnvironment + &quot;\&#x27; not &#x27;
                           &#x27;listed in environment list&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (keyResolver == null) {\n&#x27;
                           &#x27;            keyResolver = new &#x27;
                           &#x27;SystemPropertyRuntimeEnvironmentKeyResolver();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        String environment = &#x27;
                           &#x27;determineEnvironment();\n&#x27;
                           &#x27;        ArrayList&lt;Resource&gt; allLocations = new &#x27;
                           &#x27;ArrayList&lt;&gt;();\n&#x27;
                           &#x27;        \n&#x27;
                           &#x27;        /* Process configuration in the following &#x27;
                           &#x27;order (later files override earlier files\n&#x27;
                           &#x27;         * common-shared.properties\n&#x27;
                           &#x27;         * [environment]-shared.properties\n&#x27;
                           &#x27;         * common.properties\n&#x27;
                           &#x27;         * [environment].properties\n&#x27;
                           &#x27;         * -Dproperty-override-shared specified &#x27;
                           &#x27;value, if any\n&#x27;
                           &#x27;         * -Dproperty-override specified value, if &#x27;
                           &#x27;any  */\n&#x27;
                           &#x27;        Set&lt;Set&lt;Resource&gt;&gt; testLocations = new &#x27;
                           &#x27;LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;        testLocations.add(propertyLocations);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;testLocations.add(defaultPropertyLocations);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        for (Resource resource : &#x27;
                           &#x27;createBroadleafResource()) {\n&#x27;
                           &#x27;            if (resource.exists()) {\n&#x27;
                           &#x27;                allLocations.add(resource);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        for (Set&lt;Resource&gt; locations : &#x27;
                           &#x27;testLocations) {\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createSharedCommonResource(locations)) {\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createSharedPropertiesResource(environment, &#x27;
                           &#x27;locations)) {\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createCommonResource(locations)) {\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createPropertiesResource(environment, locations)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Resource sharedPropertyOverride = &#x27;
                           &#x27;createSharedOverrideResource();\n&#x27;
                           &#x27;        if (sharedPropertyOverride != null) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;allLocations.add(sharedPropertyOverride);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        \n&#x27;
                           &#x27;        Resource propertyOverride = &#x27;
                           &#x27;createOverrideResource();\n&#x27;
                           &#x27;        if (propertyOverride != null) {\n&#x27;
                           &#x27;            allLocations.add(propertyOverride);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        \n&#x27;
                           &#x27;        Properties props = new Properties();\n&#x27;
                           &#x27;        for (Resource resource : allLocations) {\n&#x27;
                           &#x27;            if (resource.exists()) {\n&#x27;
                           &#x27;                // We will log source-control &#x27;
                           &#x27;managed properties with trace and overrides with &#x27;
                           &#x27;info\n&#x27;
                           &#x27;                if &#x27;
                           &#x27;(((resource.equals(sharedPropertyOverride) || &#x27;
                           &#x27;resource.equals(propertyOverride)))\n&#x27;
                           &#x27;                        || LOG.isTraceEnabled()) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    props = new &#x27;
                           &#x27;Properties(props);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;props.load(resource.getInputStream());\n&#x27;
                           &#x27;                    for (Entry&lt;Object, Object&gt; &#x27;
                           &#x27;entry : props.entrySet()) {\n&#x27;
                           &#x27;                        if &#x27;
                           &#x27;(resource.equals(sharedPropertyOverride) || &#x27;
                           &#x27;resource.equals(propertyOverride)) {\n&#x27;
                           &#x27;                            logger.support(&quot;Read &quot; &#x27;
                           &#x27;+ entry.getKey() + &quot; from &quot; + &#x27;
                           &#x27;resource.getFilename());\n&#x27;
                           &#x27;                        } else {\n&#x27;
                           &#x27;                            LOG.trace(&quot;Read &quot; + &#x27;
                           &#x27;entry.getKey() + &quot; from &quot; + &#x27;
                           &#x27;resource.getFilename());\n&#x27;
                           &#x27;                        }\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            } else {\n&#x27;
                           &#x27;                LOG.debug(&quot;Unable to locate &#x27;
                           &#x27;resource: &quot; + resource.getFilename());\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        setLocations(allLocations.toArray(new &#x27;
                           &#x27;Resource[] {}));\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createSharedPropertiesResource(String environment, &#x27;
                           &#x27;Set&lt;Resource&gt; locations) throws IOException {\n&#x27;
                           &#x27;        String fileName = &#x27;
                           &#x27;environment.toString().toLowerCase() + &#x27;
                           &#x27;&quot;-shared.properties&quot;;\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(fileName);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    protected Resource[] createBroadleafResource() &#x27;
                           &#x27;throws IOException {\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[blcPropertyLocations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : &#x27;
                           &#x27;blcPropertyLocations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(&quot;common.properties&quot;);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createSharedCommonResource(Set&lt;Resource&gt; &#x27;
                           &#x27;locations) throws IOException {\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(&quot;common-shared.properties&quot;);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createPropertiesResource(String environment, &#x27;
                           &#x27;Set&lt;Resource&gt; locations) throws IOException {\n&#x27;
                           &#x27;        String fileName = &#x27;
                           &#x27;environment.toString().toLowerCase() + &#x27;
                           &#x27;&quot;.properties&quot;;\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(fileName);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createCommonResource(Set&lt;Resource&gt; locations) &#x27;
                           &#x27;throws IOException {\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(&quot;common.properties&quot;);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    protected Resource &#x27;
                           &#x27;createSharedOverrideResource() throws IOException &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        String path = &#x27;
                           &#x27;System.getProperty(SHARED_PROPERTY_OVERRIDE);\n&#x27;
                           &#x27;        return StringUtils.isBlank(path) ? null : &#x27;
                           &#x27;new FileSystemResource(path);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;    \n&#x27;
                           &#x27;    protected Resource createOverrideResource() &#x27;
                           &#x27;throws IOException {\n&#x27;
                           &#x27;        String path = &#x27;
                           &#x27;System.getProperty(PROPERTY_OVERRIDE);\n&#x27;
                           &#x27;        return StringUtils.isBlank(path) ? null : &#x27;
                           &#x27;new FileSystemResource(path);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String determineEnvironment() {\n&#x27;
                           &#x27;        if (determinedEnvironment != null) {\n&#x27;
                           &#x27;            return determinedEnvironment;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        determinedEnvironment = &#x27;
                           &#x27;keyResolver.resolveRuntimeEnvironmentKey();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (determinedEnvironment == null) {\n&#x27;
                           &#x27;            LOG.warn(&quot;Unable to determine runtime &#x27;
                           &#x27;environment, using default environment \&#x27;&quot; + &#x27;
                           &#x27;defaultEnvironment + &quot;\&#x27;&quot;);\n&#x27;
                           &#x27;            determinedEnvironment = &#x27;
                           &#x27;defaultEnvironment;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;determinedEnvironment.toLowerCase();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void &#x27;
                           &#x27;processProperties(ConfigurableListableBeanFactory &#x27;
                           &#x27;beanFactoryToProcess, Properties props) throws &#x27;
                           &#x27;BeansException {\n&#x27;
                           &#x27;        &#x27;
                           &#x27;super.processProperties(beanFactoryToProcess, &#x27;
                           &#x27;props);\n&#x27;
                           &#x27;        stringValueResolver = new &#x27;
                           &#x27;PlaceholderResolvingStringValueResolver(props);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the default environment name, used &#x27;
                           &#x27;when the runtime environment\n&#x27;
                           &#x27;     * cannot be determined.\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setDefaultEnvironment(String &#x27;
                           &#x27;defaultEnvironment) {\n&#x27;
                           &#x27;        this.defaultEnvironment = &#x27;
                           &#x27;defaultEnvironment;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String getDefaultEnvironment() {\n&#x27;
                           &#x27;        return defaultEnvironment;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;setKeyResolver(RuntimeEnvironmentKeyResolver &#x27;
                           &#x27;keyResolver) {\n&#x27;
                           &#x27;        this.keyResolver = keyResolver;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the allowed list of runtime &#x27;
                           &#x27;environments\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setEnvironments(Set&lt;String&gt; &#x27;
                           &#x27;environments) {\n&#x27;
                           &#x27;        this.environments = environments;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the directory from which to read &#x27;
                           &#x27;environment-specific properties\n&#x27;
                           &quot;     * files; note that it must end with a &#x27;/&#x27;\n&quot;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setPropertyLocations(Set&lt;Resource&gt; &#x27;
                           &#x27;propertyLocations) {\n&#x27;
                           &#x27;        this.propertyLocations = &#x27;
                           &#x27;propertyLocations;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the directory from which to read &#x27;
                           &#x27;environment-specific properties\n&#x27;
                           &quot;     * files; note that it must end with a &#x27;/&#x27;. &quot;
                           &#x27;Note, these properties may be\n&#x27;
                           &#x27;     * overridden by those defined in &#x27;
                           &#x27;propertyLocations and any &quot;runtime-properties&quot; &#x27;
                           &#x27;directories\n&#x27;
                           &#x27;     *\n&#x27;
                           &#x27;     * @param overridableProperyLocations location &#x27;
                           &#x27;containing overridable environment properties\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;setOverridableProperyLocations(Set&lt;Resource&gt; &#x27;
                           &#x27;overridableProperyLocations) {\n&#x27;
                           &#x27;        this.overridableProperyLocations = &#x27;
                           &#x27;overridableProperyLocations;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class &#x27;
                           &#x27;PlaceholderResolvingStringValueResolver implements &#x27;
                           &#x27;StringValueResolver {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private final PropertyPlaceholderHelper &#x27;
                           &#x27;helper;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private final &#x27;
                           &#x27;PropertyPlaceholderHelper.PlaceholderResolver &#x27;
                           &#x27;resolver;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public &#x27;
                           &#x27;PlaceholderResolvingStringValueResolver(Properties &#x27;
                           &#x27;props) {\n&#x27;
                           &#x27;            this.helper = new &#x27;
                           &#x27;PropertyPlaceholderHelper(&quot;${&quot;, &quot;}&quot;, &quot;:&quot;, true);\n&#x27;
                           &#x27;            this.resolver = new &#x27;
                           &#x27;PropertyPlaceholderConfigurerResolver(props);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public String resolveStringValue(String &#x27;
                           &#x27;strVal) throws BeansException {\n&#x27;
                           &#x27;            String value = &#x27;
                           &#x27;this.helper.replacePlaceholders(strVal, &#x27;
                           &#x27;this.resolver);\n&#x27;
                           &#x27;            return (value.equals(&quot;&quot;) ? null : &#x27;
                           &#x27;value);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class &#x27;
                           &#x27;PropertyPlaceholderConfigurerResolver implements &#x27;
                           &#x27;PropertyPlaceholderHelper.PlaceholderResolver {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private final Properties props;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private &#x27;
                           &#x27;PropertyPlaceholderConfigurerResolver(Properties &#x27;
                           &#x27;props) {\n&#x27;
                           &#x27;            this.props = props;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public String resolvePlaceholder(String &#x27;
                           &#x27;placeholderName) {\n&#x27;
                           &#x27;            return &#x27;
                           &#x27;RuntimeEnvironmentPropertiesConfigurer.this.resolvePlaceholder(placeholderName, &#x27;
                           &#x27;props, 1);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public StringValueResolver &#x27;
                           &#x27;getStringValueResolver() {\n&#x27;
                           &#x27;        return stringValueResolver;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;/*-\n&#x27;
                           &#x27; * #%L\n&#x27;
                           &#x27; * BroadleafCommerce Common Libraries\n&#x27;
                           &#x27; * %%\n&#x27;
                           &#x27; * Copyright (C) 2009 - 2022 Broadleaf Commerce\n&#x27;
                           &#x27; * %%\n&#x27;
                           &#x27; * Licensed under the Broadleaf Fair Use License &#x27;
                           &#x27;Agreement, Version 1.0\n&#x27;
                           &#x27; * (the &quot;Fair Use License&quot; located  at &#x27;
                           &#x27;http://license.broadleafcommerce.org/fair_use_license-1.0.txt)\n&#x27;
                           &#x27; * unless the restrictions on use therein are &#x27;
                           &#x27;violated and require payment to Broadleaf in which &#x27;
                           &#x27;case\n&#x27;
                           &#x27; * the Broadleaf End User License Agreement &#x27;
                           &#x27;(EULA), Version 1.1\n&#x27;
                           &#x27; * (the &quot;Commercial License&quot; located at &#x27;
                           &#x27;http://license.broadleafcommerce.org/commercial_license-1.1.txt)\n&#x27;
                           &#x27; * shall apply.\n&#x27;
                           &#x27; *\n&#x27;
                           &#x27; * Alternatively, the Commercial License may be &#x27;
                           &#x27;replaced with a mutually agreed upon license (the &#x27;
                           &#x27;&quot;Custom License&quot;)\n&#x27;
                           &#x27; * between you and Broadleaf Commerce. You may not &#x27;
                           &#x27;use this file except in compliance with the &#x27;
                           &#x27;applicable license.\n&#x27;
                           &#x27; * #L%\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;package org.broadleafcommerce.common.config;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.commons.collections.CollectionUtils;\n&#x27;
                           &#x27;import org.apache.commons.lang3.StringUtils;\n&#x27;
                           &#x27;import org.apache.commons.logging.Log;\n&#x27;
                           &#x27;import org.apache.commons.logging.LogFactory;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.broadleafcommerce.common.logging.SupportLogManager;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.broadleafcommerce.common.logging.SupportLogger;\n&#x27;
                           &#x27;import org.springframework.beans.BeansException;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.InitializingBean;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.annotation.Autowired;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.config.ConfigurableListableBeanFactory;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.support.BeanDefinitionRegistry;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.context.ApplicationContext;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.core.io.ClassPathResource;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.core.io.FileSystemResource;\n&#x27;
                           &#x27;import org.springframework.core.io.Resource;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.util.PropertyPlaceholderHelper;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.util.StringValueResolver;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.io.IOException;\n&#x27;
                           &#x27;import java.util.ArrayList;\n&#x27;
                           &#x27;import java.util.Collections;\n&#x27;
                           &#x27;import java.util.LinkedHashSet;\n&#x27;
                           &#x27;import java.util.Map.Entry;\n&#x27;
                           &#x27;import java.util.Properties;\n&#x27;
                           &#x27;import java.util.Set;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import javax.annotation.PostConstruct;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * A property resource configurer that chooses the &#x27;
                           &#x27;property file at runtime\n&#x27;
                           &#x27; * based on the runtime environment.\n&#x27;
                           &#x27; * &lt;p&gt;\n&#x27;
                           &#x27; * Used for choosing properties files based on the &#x27;
                           &#x27;current runtime environment,\n&#x27;
                           &#x27; * allowing for movement of the same application &#x27;
                           &#x27;between multiple runtime\n&#x27;
                           &#x27; * environments without rebuilding.\n&#x27;
                           &#x27; * &lt;p&gt;\n&#x27;
                           &#x27; * The property replacement semantics of this &#x27;
                           &#x27;implementation are identical to\n&#x27;
                           &#x27; * PropertyPlaceholderConfigurer, from which this &#x27;
                           &#x27;class inherits. &lt;code&gt;\n&#x27;
                           &#x27; * &lt;pre&gt;\n&#x27;
                           &#x27; * &amp;lt;bean id=&amp;quot;propertyConfigurator&amp;quot; &#x27;
                           &#x27;class=&amp;quot;frilista.framework.RuntimeEnvironmentPropertiesConfigurer&amp;quot;&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;property &#x27;
                           &#x27;name=&amp;quot;propertyLocation&amp;quot; &#x27;
                           &#x27;value=&amp;quot;/WEB-INF/runtime-properties/&amp;quot; &#x27;
                           &#x27;/&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;property &#x27;
                           &#x27;name=&amp;quot;environments&amp;quot;&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;set&amp;gt;\n&#x27;
                           &#x27; *            &#x27;
                           &#x27;&amp;lt;value&amp;gt;production&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *            &amp;lt;value&amp;gt;staging&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *            &#x27;
                           &#x27;&amp;lt;value&amp;gt;integration&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *            &#x27;
                           &#x27;&amp;lt;value&amp;gt;development&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;/set&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;/property&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;property &#x27;
                           &#x27;name=&amp;quot;defaultEnvironment&amp;quot; &#x27;
                           &#x27;value=&amp;quot;development&amp;quot;/&amp;gt;\n&#x27;
                           &#x27; * &amp;lt;/bean&amp;gt;\n&#x27;
                           &#x27; * &lt;/code&gt; &lt;/pre&gt; The keys of the environment &#x27;
                           &#x27;specific properties files are\n&#x27;
                           &#x27; * compared to ensure that each property file &#x27;
                           &#x27;defines the complete set of keys,\n&#x27;
                           &#x27; * in order to avoid environment-specific &#x27;
                           &#x27;failures.\n&#x27;
                           &#x27; * &lt;p&gt;\n&#x27;
                           &#x27; * An optional RuntimeEnvironmentKeyResolver &#x27;
                           &#x27;implementation can be provided,\n&#x27;
                           &#x27; * allowing for customization of how the runtime &#x27;
                           &#x27;environment is determined. If\n&#x27;
                           &#x27; * no implementation is provided, a default of\n&#x27;
                           &#x27; * SystemPropertyRuntimeEnvironmentKeyResolver is &#x27;
                           &#x27;used (which uses the system\n&#x27;
                           &quot; * property &#x27;runtime.environment&#x27;)\n&quot;
                           &#x27; * @author &lt;a &#x27;
                           &#x27;href=&quot;mailto:chris.lee.9@gmail.com&quot;&gt;Chris Lee&lt;/a&gt;\n&#x27;
                           &#x27; * @deprecated Instead of using anything around &#x27;
                           &#x27;the -Druntime-environment values, you should be &#x27;
                           &#x27;using Spring profiles\n&#x27;
                           &#x27; * and properties activated with that via {@link &#x27;
                           &#x27;BroadleafEnvironmentConfiguringApplicationListener}.\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;@Deprecated\n&#x27;
                           &#x27;public class &#x27;
                           &#x27;RuntimeEnvironmentPropertiesConfigurer extends &#x27;
                           &#x27;PropertyPlaceholderConfigurer implements &#x27;
                           &#x27;InitializingBean {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static final Log LOG = &#x27;
                           &#x27;LogFactory.getLog(RuntimeEnvironmentPropertiesConfigurer.class);\n&#x27;
                           &#x27;    protected SupportLogger logger = &#x27;
                           &#x27;SupportLogManager.getLogger(&quot;UserOverride&quot;, &#x27;
                           &#x27;this.getClass());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected static final String &#x27;
                           &#x27;SHARED_PROPERTY_OVERRIDE = &#x27;
                           &#x27;&quot;property-shared-override&quot;;\n&#x27;
                           &#x27;    protected static final String &#x27;
                           &#x27;PROPERTY_OVERRIDE = &quot;property-override&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected static Set&lt;String&gt; &#x27;
                           &#x27;defaultEnvironments = new LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;    protected static Set&lt;Resource&gt; &#x27;
                           &#x27;blcPropertyLocations = new LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;    protected static Set&lt;Resource&gt; &#x27;
                           &#x27;defaultPropertyLocations = new LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    static {\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;production&quot;);\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;staging&quot;);\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;integrationqa&quot;);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;defaultEnvironments.add(&quot;integrationdev&quot;);\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;development&quot;);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/admin/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/cms/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/web/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/fw/&quot;));\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        defaultPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;runtime-properties/&quot;));\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected String defaultEnvironment = &#x27;
                           &#x27;&quot;development&quot;;\n&#x27;
                           &#x27;    protected String determinedEnvironment = &#x27;
                           &#x27;null;\n&#x27;
                           &#x27;    protected RuntimeEnvironmentKeyResolver &#x27;
                           &#x27;keyResolver;\n&#x27;
                           &#x27;    protected Set&lt;String&gt; environments = &#x27;
                           &#x27;Collections.emptySet();\n&#x27;
                           &#x27;    protected Set&lt;Resource&gt; propertyLocations;\n&#x27;
                           &#x27;    protected Set&lt;Resource&gt; &#x27;
                           &#x27;overridableProperyLocations;\n&#x27;
                           &#x27;    protected StringValueResolver &#x27;
                           &#x27;stringValueResolver;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Autowired\n&#x27;
                           &#x27;    protected ApplicationContext &#x27;
                           &#x27;applicationContext;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @PostConstruct\n&#x27;
                           &#x27;    public void init() {\n&#x27;
                           &#x27;        String originatingFile = &#x27;
                           &#x27;((BeanDefinitionRegistry) &#x27;
                           &#x27;applicationContext.getAutowireCapableBeanFactory()).getBeanDefinition(&quot;blConfiguration&quot;).getResourceDescription();\n&#x27;
                           &#x27;        LOG.error(&quot;A blConfiguration bean was &#x27;
                           &#x27;detected in &quot; + originatingFile + &quot;. Any use of &#x27;
                           &#x27;blConfiguration and the &#x27;
                           &#x27;RuntimeEnvironmentProperitesConfigurer is &#x27;
                           &#x27;deprecated and has unknown side-effects. Remove &quot;\n&#x27;
                           &#x27;            + &quot;all instances blConfiguration from &#x27;
                           &#x27;all applicationContext.xml files. Use either a &#x27;
                           &#x27;FrameworkCommonPropertySource, &#x27;
                           &#x27;ProfileAwarePropertySource or a @PropertySource &#x27;
                           &#x27;annotation on an @Configuration class&quot;);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void afterPropertiesSet() throws &#x27;
                           &#x27;IOException {\n&#x27;
                           &#x27;        setIgnoreUnresolvablePlaceholders(true); &#x27;
                           &#x27;// This default will get overriden by user options &#x27;
                           &#x27;if present\n&#x27;
                           &#x27;        setNullValue(&quot;@null&quot;);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        // If no environment override has been &#x27;
                           &#x27;specified, used the default environments\n&#x27;
                           &#x27;        if (environments == null || &#x27;
                           &#x27;environments.size() == 0) {\n&#x27;
                           &#x27;            environments = defaultEnvironments;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        // Prepend the default property locations &#x27;
                           &#x27;to the specified property locations (if any)\n&#x27;
                           &#x27;        Set&lt;Resource&gt; combinedLocations = new &#x27;
                           &#x27;LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(!CollectionUtils.isEmpty(overridableProperyLocations)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            &#x27;
                           &#x27;combinedLocations.addAll(overridableProperyLocations);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(!CollectionUtils.isEmpty(propertyLocations)) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;combinedLocations.addAll(propertyLocations);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        propertyLocations = combinedLocations;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(!environments.contains(defaultEnvironment)) {\n&#x27;
                           &#x27;            throw new AssertionError(&quot;Default &#x27;
                           &#x27;environment \&#x27;&quot; + defaultEnvironment + &quot;\&#x27; not &#x27;
                           &#x27;listed in environment list&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (keyResolver == null) {\n&#x27;
                           &#x27;            keyResolver = new &#x27;
                           &#x27;SystemPropertyRuntimeEnvironmentKeyResolver();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        String environment = &#x27;
                           &#x27;determineEnvironment();\n&#x27;
                           &#x27;        ArrayList&lt;Resource&gt; allLocations = new &#x27;
                           &#x27;ArrayList&lt;&gt;();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        /* Process configuration in the following &#x27;
                           &#x27;order (later files override earlier files\n&#x27;
                           &#x27;         * common-shared.properties\n&#x27;
                           &#x27;         * [environment]-shared.properties\n&#x27;
                           &#x27;         * common.properties\n&#x27;
                           &#x27;         * [environment].properties\n&#x27;
                           &#x27;         * -Dproperty-override-shared specified &#x27;
                           &#x27;value, if any\n&#x27;
                           &#x27;         * -Dproperty-override specified value, if &#x27;
                           &#x27;any  */\n&#x27;
                           &#x27;        Set&lt;Set&lt;Resource&gt;&gt; testLocations = new &#x27;
                           &#x27;LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;        testLocations.add(propertyLocations);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;testLocations.add(defaultPropertyLocations);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        for (Resource resource : &#x27;
                           &#x27;createBroadleafResource()) {\n&#x27;
                           &#x27;            if (resource.exists()) {\n&#x27;
                           &#x27;                allLocations.add(resource);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        for (Set&lt;Resource&gt; locations : &#x27;
                           &#x27;testLocations) {\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createSharedCommonResource(locations)) {\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createSharedPropertiesResource(environment, &#x27;
                           &#x27;locations)) {\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createCommonResource(locations)) {\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createPropertiesResource(environment, locations)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Resource sharedPropertyOverride = &#x27;
                           &#x27;createSharedOverrideResource();\n&#x27;
                           &#x27;        if (sharedPropertyOverride != null) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;allLocations.add(sharedPropertyOverride);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Resource propertyOverride = &#x27;
                           &#x27;createOverrideResource();\n&#x27;
                           &#x27;        if (propertyOverride != null) {\n&#x27;
                           &#x27;            allLocations.add(propertyOverride);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Properties props = new Properties();\n&#x27;
                           &#x27;        for (Resource resource : allLocations) {\n&#x27;
                           &#x27;            if (resource.exists()) {\n&#x27;
                           &#x27;                // We will log source-control &#x27;
                           &#x27;managed properties with trace and overrides with &#x27;
                           &#x27;info\n&#x27;
                           &#x27;                if &#x27;
                           &#x27;(((resource.equals(sharedPropertyOverride) || &#x27;
                           &#x27;resource.equals(propertyOverride)))\n&#x27;
                           &#x27;                        || LOG.isTraceEnabled()) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    props = new &#x27;
                           &#x27;Properties(props);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;props.load(resource.getInputStream());\n&#x27;
                           &#x27;                    for (Entry&lt;Object, Object&gt; &#x27;
                           &#x27;entry : props.entrySet()) {\n&#x27;
                           &#x27;                        if &#x27;
                           &#x27;(resource.equals(sharedPropertyOverride) || &#x27;
                           &#x27;resource.equals(propertyOverride)) {\n&#x27;
                           &#x27;                            logger.support(&quot;Read &quot; &#x27;
                           &#x27;+ entry.getKey() + &quot; from &quot; + &#x27;
                           &#x27;resource.getFilename());\n&#x27;
                           &#x27;                        } else {\n&#x27;
                           &#x27;                            LOG.trace(&quot;Read &quot; + &#x27;
                           &#x27;entry.getKey() + &quot; from &quot; + &#x27;
                           &#x27;resource.getFilename());\n&#x27;
                           &#x27;                        }\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            } else {\n&#x27;
                           &#x27;                LOG.debug(&quot;Unable to locate &#x27;
                           &#x27;resource: &quot; + resource.getFilename());\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        setLocations(allLocations.toArray(new &#x27;
                           &#x27;Resource[] {}));\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createSharedPropertiesResource(String environment, &#x27;
                           &#x27;Set&lt;Resource&gt; locations) throws IOException {\n&#x27;
                           &#x27;        String fileName = &#x27;
                           &#x27;environment.toString().toLowerCase() + &#x27;
                           &#x27;&quot;-shared.properties&quot;;\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(fileName);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] createBroadleafResource() &#x27;
                           &#x27;throws IOException {\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[blcPropertyLocations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : &#x27;
                           &#x27;blcPropertyLocations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(&quot;common.properties&quot;);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createSharedCommonResource(Set&lt;Resource&gt; &#x27;
                           &#x27;locations) throws IOException {\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(&quot;common-shared.properties&quot;);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createPropertiesResource(String environment, &#x27;
                           &#x27;Set&lt;Resource&gt; locations) throws IOException {\n&#x27;
                           &#x27;        String fileName = &#x27;
                           &#x27;environment.toString().toLowerCase() + &#x27;
                           &#x27;&quot;.properties&quot;;\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(fileName);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createCommonResource(Set&lt;Resource&gt; locations) &#x27;
                           &#x27;throws IOException {\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(&quot;common.properties&quot;);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource &#x27;
                           &#x27;createSharedOverrideResource() throws IOException &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        String path = &#x27;
                           &#x27;System.getProperty(SHARED_PROPERTY_OVERRIDE);\n&#x27;
                           &#x27;        return StringUtils.isBlank(path) ? null : &#x27;
                           &#x27;new FileSystemResource(path);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource createOverrideResource() &#x27;
                           &#x27;throws IOException {\n&#x27;
                           &#x27;        String path = &#x27;
                           &#x27;System.getProperty(PROPERTY_OVERRIDE);\n&#x27;
                           &#x27;        return StringUtils.isBlank(path) ? null : &#x27;
                           &#x27;new FileSystemResource(path);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String determineEnvironment() {\n&#x27;
                           &#x27;        if (determinedEnvironment != null) {\n&#x27;
                           &#x27;            return determinedEnvironment;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        determinedEnvironment = &#x27;
                           &#x27;keyResolver.resolveRuntimeEnvironmentKey();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (determinedEnvironment == null) {\n&#x27;
                           &#x27;            LOG.warn(&quot;Unable to determine runtime &#x27;
                           &#x27;environment, using default environment \&#x27;&quot; + &#x27;
                           &#x27;defaultEnvironment + &quot;\&#x27;&quot;);\n&#x27;
                           &#x27;            determinedEnvironment = &#x27;
                           &#x27;defaultEnvironment;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;determinedEnvironment.toLowerCase();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void &#x27;
                           &#x27;processProperties(ConfigurableListableBeanFactory &#x27;
                           &#x27;beanFactoryToProcess, Properties props) throws &#x27;
                           &#x27;BeansException {\n&#x27;
                           &#x27;        &#x27;
                           &#x27;super.processProperties(beanFactoryToProcess, &#x27;
                           &#x27;props);\n&#x27;
                           &#x27;        stringValueResolver = new &#x27;
                           &#x27;PlaceholderResolvingStringValueResolver(props);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the default environment name, used &#x27;
                           &#x27;when the runtime environment\n&#x27;
                           &#x27;     * cannot be determined.\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setDefaultEnvironment(String &#x27;
                           &#x27;defaultEnvironment) {\n&#x27;
                           &#x27;        this.defaultEnvironment = &#x27;
                           &#x27;defaultEnvironment;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String getDefaultEnvironment() {\n&#x27;
                           &#x27;        return defaultEnvironment;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;setKeyResolver(RuntimeEnvironmentKeyResolver &#x27;
                           &#x27;keyResolver) {\n&#x27;
                           &#x27;        this.keyResolver = keyResolver;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the allowed list of runtime &#x27;
                           &#x27;environments\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setEnvironments(Set&lt;String&gt; &#x27;
                           &#x27;environments) {\n&#x27;
                           &#x27;        this.environments = environments;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the directory from which to read &#x27;
                           &#x27;environment-specific properties\n&#x27;
                           &quot;     * files; note that it must end with a &#x27;/&#x27;\n&quot;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setPropertyLocations(Set&lt;Resource&gt; &#x27;
                           &#x27;propertyLocations) {\n&#x27;
                           &#x27;        this.propertyLocations = &#x27;
                           &#x27;propertyLocations;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the directory from which to read &#x27;
                           &#x27;environment-specific properties\n&#x27;
                           &quot;     * files; note that it must end with a &#x27;/&#x27;. &quot;
                           &#x27;Note, these properties may be\n&#x27;
                           &#x27;     * overridden by those defined in &#x27;
                           &#x27;propertyLocations and any &quot;runtime-properties&quot; &#x27;
                           &#x27;directories\n&#x27;
                           &#x27;     *\n&#x27;
                           &#x27;     * @param overridableProperyLocations location &#x27;
                           &#x27;containing overridable environment properties\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;setOverridableProperyLocations(Set&lt;Resource&gt; &#x27;
                           &#x27;overridableProperyLocations) {\n&#x27;
                           &#x27;        this.overridableProperyLocations = &#x27;
                           &#x27;overridableProperyLocations;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class &#x27;
                           &#x27;PlaceholderResolvingStringValueResolver implements &#x27;
                           &#x27;StringValueResolver {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private final PropertyPlaceholderHelper &#x27;
                           &#x27;helper;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private final &#x27;
                           &#x27;PropertyPlaceholderHelper.PlaceholderResolver &#x27;
                           &#x27;resolver;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public &#x27;
                           &#x27;PlaceholderResolvingStringValueResolver(Properties &#x27;
                           &#x27;props) {\n&#x27;
                           &#x27;            this.helper = new &#x27;
                           &#x27;PropertyPlaceholderHelper(&quot;${&quot;, &quot;}&quot;, &quot;:&quot;, true);\n&#x27;
                           &#x27;            this.resolver = new &#x27;
                           &#x27;PropertyPlaceholderConfigurerResolver(props);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public String resolveStringValue(String &#x27;
                           &#x27;strVal) throws BeansException {\n&#x27;
                           &#x27;            String value = &#x27;
                           &#x27;this.helper.replacePlaceholders(strVal, &#x27;
                           &#x27;this.resolver);\n&#x27;
                           &#x27;            return (value.equals(&quot;&quot;) ? null : &#x27;
                           &#x27;value);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class &#x27;
                           &#x27;PropertyPlaceholderConfigurerResolver implements &#x27;
                           &#x27;PropertyPlaceholderHelper.PlaceholderResolver {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private final Properties props;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private &#x27;
                           &#x27;PropertyPlaceholderConfigurerResolver(Properties &#x27;
                           &#x27;props) {\n&#x27;
                           &#x27;            this.props = props;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public String resolvePlaceholder(String &#x27;
                           &#x27;placeholderName) {\n&#x27;
                           &#x27;            return &#x27;
                           &#x27;RuntimeEnvironmentPropertiesConfigurer.this.resolvePlaceholder(placeholderName, &#x27;
                           &#x27;props, 1);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public StringValueResolver &#x27;
                           &#x27;getStringValueResolver() {\n&#x27;
                           &#x27;        return stringValueResolver;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;\n&#x27;
                           &#x27;/*-\n&#x27;
                           &#x27; * #%L\n&#x27;
                           &#x27; * BroadleafCommerce Common Libraries\n&#x27;
                           &#x27; * %%\n&#x27;
                           &#x27; * Copyright (C) 2009 - 2022 Broadleaf Commerce\n&#x27;
                           &#x27; * %%\n&#x27;
                           &#x27; * Licensed under the Broadleaf Fair Use License &#x27;
                           &#x27;Agreement, Version 1.0\n&#x27;
                           &#x27; * (the &quot;Fair Use License&quot; located  at &#x27;
                           &#x27;http://license.broadleafcommerce.org/fair_use_license-1.0.txt)\n&#x27;
                           &#x27; * unless the restrictions on use therein are &#x27;
                           &#x27;violated and require payment to Broadleaf in which &#x27;
                           &#x27;case\n&#x27;
                           &#x27; * the Broadleaf End User License Agreement &#x27;
                           &#x27;(EULA), Version 1.1\n&#x27;
                           &#x27; * (the &quot;Commercial License&quot; located at &#x27;
                           &#x27;http://license.broadleafcommerce.org/commercial_license-1.1.txt)\n&#x27;
                           &#x27; * shall apply.\n&#x27;
                           &#x27; *\n&#x27;
                           &#x27; * Alternatively, the Commercial License may be &#x27;
                           &#x27;replaced with a mutually agreed upon license (the &#x27;
                           &#x27;&quot;Custom License&quot;)\n&#x27;
                           &#x27; * between you and Broadleaf Commerce. You may not &#x27;
                           &#x27;use this file except in compliance with the &#x27;
                           &#x27;applicable license.\n&#x27;
                           &#x27; * #L%\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;package org.broadleafcommerce.common.config;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.apache.commons.collections.CollectionUtils;\n&#x27;
                           &#x27;import org.apache.commons.lang3.StringUtils;\n&#x27;
                           &#x27;import org.apache.commons.logging.Log;\n&#x27;
                           &#x27;import org.apache.commons.logging.LogFactory;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.broadleafcommerce.common.logging.SupportLogManager;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.broadleafcommerce.common.logging.SupportLogger;\n&#x27;
                           &#x27;import org.springframework.beans.BeansException;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.InitializingBean;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.annotation.Autowired;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.config.ConfigurableListableBeanFactory;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.beans.factory.support.BeanDefinitionRegistry;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.context.ApplicationContext;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.core.io.ClassPathResource;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.core.io.FileSystemResource;\n&#x27;
                           &#x27;import org.springframework.core.io.Resource;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.util.PropertyPlaceholderHelper;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;org.springframework.util.StringValueResolver;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.io.IOException;\n&#x27;
                           &#x27;import java.util.ArrayList;\n&#x27;
                           &#x27;import java.util.Collections;\n&#x27;
                           &#x27;import java.util.LinkedHashSet;\n&#x27;
                           &#x27;import java.util.Map.Entry;\n&#x27;
                           &#x27;import java.util.Properties;\n&#x27;
                           &#x27;import java.util.Set;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import javax.annotation.PostConstruct;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * A property resource configurer that chooses the &#x27;
                           &#x27;property file at runtime\n&#x27;
                           &#x27; * based on the runtime environment.\n&#x27;
                           &#x27; * &lt;p&gt;\n&#x27;
                           &#x27; * Used for choosing properties files based on the &#x27;
                           &#x27;current runtime environment,\n&#x27;
                           &#x27; * allowing for movement of the same application &#x27;
                           &#x27;between multiple runtime\n&#x27;
                           &#x27; * environments without rebuilding.\n&#x27;
                           &#x27; * &lt;p&gt;\n&#x27;
                           &#x27; * The property replacement semantics of this &#x27;
                           &#x27;implementation are identical to\n&#x27;
                           &#x27; * PropertyPlaceholderConfigurer, from which this &#x27;
                           &#x27;class inherits. &lt;code&gt;\n&#x27;
                           &#x27; * &lt;pre&gt;\n&#x27;
                           &#x27; * &amp;lt;bean id=&amp;quot;propertyConfigurator&amp;quot; &#x27;
                           &#x27;class=&amp;quot;frilista.framework.RuntimeEnvironmentPropertiesConfigurer&amp;quot;&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;property &#x27;
                           &#x27;name=&amp;quot;propertyLocation&amp;quot; &#x27;
                           &#x27;value=&amp;quot;/WEB-INF/runtime-properties/&amp;quot; &#x27;
                           &#x27;/&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;property &#x27;
                           &#x27;name=&amp;quot;environments&amp;quot;&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;set&amp;gt;\n&#x27;
                           &#x27; *            &#x27;
                           &#x27;&amp;lt;value&amp;gt;production&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *            &amp;lt;value&amp;gt;staging&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *            &#x27;
                           &#x27;&amp;lt;value&amp;gt;integration&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *            &#x27;
                           &#x27;&amp;lt;value&amp;gt;development&amp;lt;/value&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;/set&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;/property&amp;gt;\n&#x27;
                           &#x27; *        &amp;lt;property &#x27;
                           &#x27;name=&amp;quot;defaultEnvironment&amp;quot; &#x27;
                           &#x27;value=&amp;quot;development&amp;quot;/&amp;gt;\n&#x27;
                           &#x27; * &amp;lt;/bean&amp;gt;\n&#x27;
                           &#x27; * &lt;/code&gt; &lt;/pre&gt; The keys of the environment &#x27;
                           &#x27;specific properties files are\n&#x27;
                           &#x27; * compared to ensure that each property file &#x27;
                           &#x27;defines the complete set of keys,\n&#x27;
                           &#x27; * in order to avoid environment-specific &#x27;
                           &#x27;failures.\n&#x27;
                           &#x27; * &lt;p&gt;\n&#x27;
                           &#x27; * An optional RuntimeEnvironmentKeyResolver &#x27;
                           &#x27;implementation can be provided,\n&#x27;
                           &#x27; * allowing for customization of how the runtime &#x27;
                           &#x27;environment is determined. If\n&#x27;
                           &#x27; * no implementation is provided, a default of\n&#x27;
                           &#x27; * SystemPropertyRuntimeEnvironmentKeyResolver is &#x27;
                           &#x27;used (which uses the system\n&#x27;
                           &quot; * property &#x27;runtime.environment&#x27;)\n&quot;
                           &#x27; * @author &lt;a &#x27;
                           &#x27;href=&quot;mailto:chris.lee.9@gmail.com&quot;&gt;Chris Lee&lt;/a&gt;\n&#x27;
                           &#x27; * @deprecated Instead of using anything around &#x27;
                           &#x27;the -Druntime-environment values, you should be &#x27;
                           &#x27;using Spring profiles\n&#x27;
                           &#x27; * and properties activated with that via {@link &#x27;
                           &#x27;BroadleafEnvironmentConfiguringApplicationListener}.\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;@Deprecated\n&#x27;
                           &#x27;public class &#x27;
                           &#x27;RuntimeEnvironmentPropertiesConfigurer extends &#x27;
                           &#x27;PropertyPlaceholderConfigurer implements &#x27;
                           &#x27;InitializingBean {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private static final Log LOG = &#x27;
                           &#x27;LogFactory.getLog(RuntimeEnvironmentPropertiesConfigurer.class);\n&#x27;
                           &#x27;    protected SupportLogger logger = &#x27;
                           &#x27;SupportLogManager.getLogger(&quot;UserOverride&quot;, &#x27;
                           &#x27;this.getClass());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected static final String &#x27;
                           &#x27;SHARED_PROPERTY_OVERRIDE = &#x27;
                           &#x27;&quot;property-shared-override&quot;;\n&#x27;
                           &#x27;    protected static final String &#x27;
                           &#x27;PROPERTY_OVERRIDE = &quot;property-override&quot;;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected static Set&lt;String&gt; &#x27;
                           &#x27;defaultEnvironments = new LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;    protected static Set&lt;Resource&gt; &#x27;
                           &#x27;blcPropertyLocations = new LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;    protected static Set&lt;Resource&gt; &#x27;
                           &#x27;defaultPropertyLocations = new LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    static {\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;production&quot;);\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;staging&quot;);\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;integrationqa&quot;);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;defaultEnvironments.add(&quot;integrationdev&quot;);\n&#x27;
                           &#x27;        defaultEnvironments.add(&quot;development&quot;);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/admin/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/cms/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/web/&quot;));\n&#x27;
                           &#x27;        blcPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;config/bc/fw/&quot;));\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        defaultPropertyLocations.add(new &#x27;
                           &#x27;ClassPathResource(&quot;runtime-properties/&quot;));\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected String defaultEnvironment = &#x27;
                           &#x27;&quot;development&quot;;\n&#x27;
                           &#x27;    protected String determinedEnvironment = &#x27;
                           &#x27;null;\n&#x27;
                           &#x27;    protected RuntimeEnvironmentKeyResolver &#x27;
                           &#x27;keyResolver;\n&#x27;
                           &#x27;    protected Set&lt;String&gt; environments = &#x27;
                           &#x27;Collections.emptySet();\n&#x27;
                           &#x27;    protected Set&lt;Resource&gt; propertyLocations;\n&#x27;
                           &#x27;    protected Set&lt;Resource&gt; &#x27;
                           &#x27;overridableProperyLocations;\n&#x27;
                           &#x27;    protected StringValueResolver &#x27;
                           &#x27;stringValueResolver;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Autowired\n&#x27;
                           &#x27;    protected ApplicationContext &#x27;
                           &#x27;applicationContext;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @PostConstruct\n&#x27;
                           &#x27;    public void init() {\n&#x27;
                           &#x27;        String originatingFile = &#x27;
                           &#x27;((BeanDefinitionRegistry) &#x27;
                           &#x27;applicationContext.getAutowireCapableBeanFactory()).getBeanDefinition(&quot;blConfiguration&quot;).getResourceDescription();\n&#x27;
                           &#x27;        LOG.error(&quot;A blConfiguration bean was &#x27;
                           &#x27;detected in &quot; + originatingFile + &quot;. Any use of &#x27;
                           &#x27;blConfiguration and the &#x27;
                           &#x27;RuntimeEnvironmentProperitesConfigurer is &#x27;
                           &#x27;deprecated and has unknown side-effects. Remove &quot;\n&#x27;
                           &#x27;            + &quot;all instances blConfiguration from &#x27;
                           &#x27;all applicationContext.xml files. Use either a &#x27;
                           &#x27;FrameworkCommonPropertySource, &#x27;
                           &#x27;ProfileAwarePropertySource or a @PropertySource &#x27;
                           &#x27;annotation on an @Configuration class&quot;);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void afterPropertiesSet() throws &#x27;
                           &#x27;IOException {\n&#x27;
                           &#x27;        setIgnoreUnresolvablePlaceholders(true); &#x27;
                           &#x27;// This default will get overriden by user options &#x27;
                           &#x27;if present\n&#x27;
                           &#x27;        setNullValue(&quot;@null&quot;);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        // If no environment override has been &#x27;
                           &#x27;specified, used the default environments\n&#x27;
                           &#x27;        if (environments == null || &#x27;
                           &#x27;environments.size() == 0) {\n&#x27;
                           &#x27;            environments = defaultEnvironments;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        // Prepend the default property locations &#x27;
                           &#x27;to the specified property locations (if any)\n&#x27;
                           &#x27;        Set&lt;Resource&gt; combinedLocations = new &#x27;
                           &#x27;LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(!CollectionUtils.isEmpty(overridableProperyLocations)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            &#x27;
                           &#x27;combinedLocations.addAll(overridableProperyLocations);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(!CollectionUtils.isEmpty(propertyLocations)) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;combinedLocations.addAll(propertyLocations);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        propertyLocations = combinedLocations;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if &#x27;
                           &#x27;(!environments.contains(defaultEnvironment)) {\n&#x27;
                           &#x27;            throw new AssertionError(&quot;Default &#x27;
                           &#x27;environment \&#x27;&quot; + defaultEnvironment + &quot;\&#x27; not &#x27;
                           &#x27;listed in environment list&quot;);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (keyResolver == null) {\n&#x27;
                           &#x27;            keyResolver = new &#x27;
                           &#x27;SystemPropertyRuntimeEnvironmentKeyResolver();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        String environment = &#x27;
                           &#x27;determineEnvironment();\n&#x27;
                           &#x27;        ArrayList&lt;Resource&gt; allLocations = new &#x27;
                           &#x27;ArrayList&lt;&gt;();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        /* Process configuration in the following &#x27;
                           &#x27;order (later files override earlier files\n&#x27;
                           &#x27;         * common-shared.properties\n&#x27;
                           &#x27;         * [environment]-shared.properties\n&#x27;
                           &#x27;         * common.properties\n&#x27;
                           &#x27;         * [environment].properties\n&#x27;
                           &#x27;         * -Dproperty-override-shared specified &#x27;
                           &#x27;value, if any\n&#x27;
                           &#x27;         * -Dproperty-override specified value, if &#x27;
                           &#x27;any  */\n&#x27;
                           &#x27;        Set&lt;Set&lt;Resource&gt;&gt; testLocations = new &#x27;
                           &#x27;LinkedHashSet&lt;&gt;();\n&#x27;
                           &#x27;        testLocations.add(propertyLocations);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;testLocations.add(defaultPropertyLocations);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        for (Resource resource : &#x27;
                           &#x27;createBroadleafResource()) {\n&#x27;
                           &#x27;            if (resource.exists()) {\n&#x27;
                           &#x27;                allLocations.add(resource);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        for (Set&lt;Resource&gt; locations : &#x27;
                           &#x27;testLocations) {\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createSharedCommonResource(locations)) {\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createSharedPropertiesResource(environment, &#x27;
                           &#x27;locations)) {\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createCommonResource(locations)) {\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            for (Resource resource : &#x27;
                           &#x27;createPropertiesResource(environment, locations)) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                if (resource.exists()) {\n&#x27;
                           &#x27;                    allLocations.add(resource);\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Resource sharedPropertyOverride = &#x27;
                           &#x27;createSharedOverrideResource();\n&#x27;
                           &#x27;        if (sharedPropertyOverride != null) {\n&#x27;
                           &#x27;            &#x27;
                           &#x27;allLocations.add(sharedPropertyOverride);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Resource propertyOverride = &#x27;
                           &#x27;createOverrideResource();\n&#x27;
                           &#x27;        if (propertyOverride != null) {\n&#x27;
                           &#x27;            allLocations.add(propertyOverride);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Properties props = new Properties();\n&#x27;
                           &#x27;        for (Resource resource : allLocations) {\n&#x27;
                           &#x27;            if (resource.exists()) {\n&#x27;
                           &#x27;                // We will log source-control &#x27;
                           &#x27;managed properties with trace and overrides with &#x27;
                           &#x27;info\n&#x27;
                           &#x27;                if &#x27;
                           &#x27;(((resource.equals(sharedPropertyOverride) || &#x27;
                           &#x27;resource.equals(propertyOverride)))\n&#x27;
                           &#x27;                        || LOG.isTraceEnabled()) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    props = new &#x27;
                           &#x27;Properties(props);\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;props.load(resource.getInputStream());\n&#x27;
                           &#x27;                    for (Entry&lt;Object, Object&gt; &#x27;
                           &#x27;entry : props.entrySet()) {\n&#x27;
                           &#x27;                        if &#x27;
                           &#x27;(resource.equals(sharedPropertyOverride) || &#x27;
                           &#x27;resource.equals(propertyOverride)) {\n&#x27;
                           &#x27;                            logger.support(&quot;Read &quot; &#x27;
                           &#x27;+ entry.getKey() + &quot; from &quot; + &#x27;
                           &#x27;resource.getFilename());\n&#x27;
                           &#x27;                        } else {\n&#x27;
                           &#x27;                            LOG.trace(&quot;Read &quot; + &#x27;
                           &#x27;entry.getKey() + &quot; from &quot; + &#x27;
                           &#x27;resource.getFilename());\n&#x27;
                           &#x27;                        }\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            } else {\n&#x27;
                           &#x27;                LOG.debug(&quot;Unable to locate &#x27;
                           &#x27;resource: &quot; + resource.getFilename());\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        setLocations(allLocations.toArray(new &#x27;
                           &#x27;Resource[] {}));\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createSharedPropertiesResource(String environment, &#x27;
                           &#x27;Set&lt;Resource&gt; locations) throws IOException {\n&#x27;
                           &#x27;        String fileName = &#x27;
                           &#x27;environment.toString().toLowerCase() + &#x27;
                           &#x27;&quot;-shared.properties&quot;;\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(fileName);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] createBroadleafResource() &#x27;
                           &#x27;throws IOException {\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[blcPropertyLocations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : &#x27;
                           &#x27;blcPropertyLocations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(&quot;common.properties&quot;);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createSharedCommonResource(Set&lt;Resource&gt; &#x27;
                           &#x27;locations) throws IOException {\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(&quot;common-shared.properties&quot;);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createPropertiesResource(String environment, &#x27;
                           &#x27;Set&lt;Resource&gt; locations) throws IOException {\n&#x27;
                           &#x27;        String fileName = &#x27;
                           &#x27;environment.toString().toLowerCase() + &#x27;
                           &#x27;&quot;.properties&quot;;\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(fileName);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource[] &#x27;
                           &#x27;createCommonResource(Set&lt;Resource&gt; locations) &#x27;
                           &#x27;throws IOException {\n&#x27;
                           &#x27;        Resource[] resources = new &#x27;
                           &#x27;Resource[locations.size()];\n&#x27;
                           &#x27;        int index = 0;\n&#x27;
                           &#x27;        for (Resource resource : locations) {\n&#x27;
                           &#x27;            resources[index] = &#x27;
                           &#x27;resource.createRelative(&quot;common.properties&quot;);\n&#x27;
                           &#x27;            index++;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        return resources;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource &#x27;
                           &#x27;createSharedOverrideResource() throws IOException &#x27;
                           &#x27;{\n&#x27;
                           &#x27;        String path = &#x27;
                           &#x27;System.getProperty(SHARED_PROPERTY_OVERRIDE);\n&#x27;
                           &#x27;        return StringUtils.isBlank(path) ? null : &#x27;
                           &#x27;new FileSystemResource(path);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected Resource createOverrideResource() &#x27;
                           &#x27;throws IOException {\n&#x27;
                           &#x27;        String path = &#x27;
                           &#x27;System.getProperty(PROPERTY_OVERRIDE);\n&#x27;
                           &#x27;        return StringUtils.isBlank(path) ? null : &#x27;
                           &#x27;new FileSystemResource(path);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String determineEnvironment() {\n&#x27;
                           &#x27;        if (determinedEnvironment != null) {\n&#x27;
                           &#x27;            return determinedEnvironment;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;        determinedEnvironment = &#x27;
                           &#x27;keyResolver.resolveRuntimeEnvironmentKey();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (determinedEnvironment == null) {\n&#x27;
                           &#x27;            LOG.warn(&quot;Unable to determine runtime &#x27;
                           &#x27;environment, using default environment \&#x27;&quot; + &#x27;
                           &#x27;defaultEnvironment + &quot;\&#x27;&quot;);\n&#x27;
                           &#x27;            determinedEnvironment = &#x27;
                           &#x27;defaultEnvironment;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        return &#x27;
                           &#x27;determinedEnvironment.toLowerCase();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void &#x27;
                           &#x27;processProperties(ConfigurableListableBeanFactory &#x27;
                           &#x27;beanFactoryToProcess, Properties props) throws &#x27;
                           &#x27;BeansException {\n&#x27;
                           &#x27;        &#x27;
                           &#x27;super.processProperties(beanFactoryToProcess, &#x27;
                           &#x27;props);\n&#x27;
                           &#x27;        stringValueResolver = new &#x27;
                           &#x27;PlaceholderResolvingStringValueResolver(props);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the default environment name, used &#x27;
                           &#x27;when the runtime environment\n&#x27;
                           &#x27;     * cannot be determined.\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setDefaultEnvironment(String &#x27;
                           &#x27;defaultEnvironment) {\n&#x27;
                           &#x27;        this.defaultEnvironment = &#x27;
                           &#x27;defaultEnvironment;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public String getDefaultEnvironment() {\n&#x27;
                           &#x27;        return defaultEnvironment;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;setKeyResolver(RuntimeEnvironmentKeyResolver &#x27;
                           &#x27;keyResolver) {\n&#x27;
                           &#x27;        this.keyResolver = keyResolver;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the allowed list of runtime &#x27;
                           &#x27;environments\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setEnvironments(Set&lt;String&gt; &#x27;
                           &#x27;environments) {\n&#x27;
                           &#x27;        this.environments = environments;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the directory from which to read &#x27;
                           &#x27;environment-specific properties\n&#x27;
                           &quot;     * files; note that it must end with a &#x27;/&#x27;\n&quot;
                           &#x27;     */\n&#x27;
                           &#x27;    public void setPropertyLocations(Set&lt;Resource&gt; &#x27;
                           &#x27;propertyLocations) {\n&#x27;
                           &#x27;        this.propertyLocations = &#x27;
                           &#x27;propertyLocations;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    /**\n&#x27;
                           &#x27;     * Sets the directory from which to read &#x27;
                           &#x27;environment-specific properties\n&#x27;
                           &quot;     * files; note that it must end with a &#x27;/&#x27;. &quot;
                           &#x27;Note, these properties may be\n&#x27;
                           &#x27;     * overridden by those defined in &#x27;
                           &#x27;propertyLocations and any &quot;runtime-properties&quot; &#x27;
                           &#x27;directories\n&#x27;
                           &#x27;     *\n&#x27;
                           &#x27;     * @param overridableProperyLocations location &#x27;
                           &#x27;containing overridable environment properties\n&#x27;
                           &#x27;     */\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;setOverridableProperyLocations(Set&lt;Resource&gt; &#x27;
                           &#x27;overridableProperyLocations) {\n&#x27;
                           &#x27;        this.overridableProperyLocations = &#x27;
                           &#x27;overridableProperyLocations;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class &#x27;
                           &#x27;PlaceholderResolvingStringValueResolver implements &#x27;
                           &#x27;StringValueResolver {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private final PropertyPlaceholderHelper &#x27;
                           &#x27;helper;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private final &#x27;
                           &#x27;PropertyPlaceholderHelper.PlaceholderResolver &#x27;
                           &#x27;resolver;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public &#x27;
                           &#x27;PlaceholderResolvingStringValueResolver(Properties &#x27;
                           &#x27;props) {\n&#x27;
                           &#x27;            this.helper = new &#x27;
                           &#x27;PropertyPlaceholderHelper(&quot;${&quot;, &quot;}&quot;, &quot;:&quot;, true);\n&#x27;
                           &#x27;            this.resolver = new &#x27;
                           &#x27;PropertyPlaceholderConfigurerResolver(props);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public String resolveStringValue(String &#x27;
                           &#x27;strVal) throws BeansException {\n&#x27;
                           &#x27;            String value = &#x27;
                           &#x27;this.helper.replacePlaceholders(strVal, &#x27;
                           &#x27;this.resolver);\n&#x27;
                           &#x27;            return (value.equals(&quot;&quot;) ? null : &#x27;
                           &#x27;value);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class &#x27;
                           &#x27;PropertyPlaceholderConfigurerResolver implements &#x27;
                           &#x27;PropertyPlaceholderHelper.PlaceholderResolver {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private final Properties props;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private &#x27;
                           &#x27;PropertyPlaceholderConfigurerResolver(Properties &#x27;
                           &#x27;props) {\n&#x27;
                           &#x27;            this.props = props;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public String resolvePlaceholder(String &#x27;
                           &#x27;placeholderName) {\n&#x27;
                           &#x27;            return &#x27;
                           &#x27;RuntimeEnvironmentPropertiesConfigurer.this.resolvePlaceholder(placeholderName, &#x27;
                           &#x27;props, 1);\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    public StringValueResolver &#x27;
                           &#x27;getStringValueResolver() {\n&#x27;
                           &#x27;        return stringValueResolver;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;}\n&#x27;}],
   &#x27;mergers&#x27;: {&#x27;spork&#x27;, &#x27;baseline&#x27;, &#x27;jfstmerge&#x27;}}]]</pre>
          </body>
        </html>
        