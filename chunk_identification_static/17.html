<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>17</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    17
                    <a href="16.html">prev</a>
                    <a href="18.html">next</a>
                    <a href="17_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    AriaLyy/Aria_b301590869f31d3a44039c34fcd8bec944b5b7f8_Aria/src/main/java/com/arialyy/aria/core/download/DownloadGroupListener.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;b301590869f31d3a44039c34fcd8bec944b5b7f8:Aria/src/main/java/com/arialyy/aria/core/download/DownloadGroupListener.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;b301590869f31d3a44039c34fcd8bec944b5b7f8^1:Aria/src/main/java/com/arialyy/aria/core/download/DownloadGroupListener.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;b301590869f31d3a44039c34fcd8bec944b5b7f8^2:Aria/src/main/java/com/arialyy/aria/core/download/DownloadGroupListener.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;426c148370677ae2daf8fd879d4a76bdfd2b7f3d:Aria/src/main/java/com/arialyy/aria/core/download/DownloadGroupListener.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package com.arialyy.aria.core.download;
  17 
  18 import android.os.Handler;
  19 import com.arialyy.aria.core.download.downloader.IDownloadGroupListener;
  20 import com.arialyy.aria.core.inf.GroupSendParams;
  21 import com.arialyy.aria.core.scheduler.ISchedulers;
  22 import com.arialyy.aria.util.ALog;
  23 
  24 /**
  25  * Created by Aria.Lao on 2017/7/20.
  26  * 任务组下载事件
  27  */
  28 class DownloadGroupListener
  29     extends BaseDListener&lt;DownloadGroupEntity, DownloadGroupTaskEntity, DownloadGroupTask&gt;
  30     implements IDownloadGroupListener {
  31   private final String TAG = &quot;DownloadGroupListener&quot;;
  32   private GroupSendParams&lt;DownloadGroupTask, DownloadEntity&gt; mSeedEntity;
  33 
  34   DownloadGroupListener(DownloadGroupTask task, Handler outHandler) {
  35     super(task, outHandler);
  36     mSeedEntity = new GroupSendParams&lt;&gt;();
  37     mSeedEntity.groupTask = task;
  38   }
  39 
  40   @Override public void onSubPre(DownloadEntity subEntity) {
  41     sendInState2Target(ISchedulers.SUB_PRE, subEntity);
  42   }
  43 
  44   @Override public void supportBreakpoint(boolean support, DownloadEntity subEntity) {
  45 
  46   }
  47 
  48   @Override public void onSubStart(DownloadEntity subEntity) {
  49     sendInState2Target(ISchedulers.SUB_START, subEntity);
  50   }
  51 
  52   @Override public void onSubStop(DownloadEntity subEntity) {
  53     saveCurrentLocation();
  54     sendInState2Target(ISchedulers.SUB_STOP, subEntity);
  55   }
  56 
  57   @Override public void onSubComplete(DownloadEntity subEntity) {
  58     saveCurrentLocation();
  59     sendInState2Target(ISchedulers.SUB_COMPLETE, subEntity);
  60   }
  61 
  62   @Override public void onSubFail(DownloadEntity subEntity) {
  63     saveCurrentLocation();
  64     sendInState2Target(ISchedulers.SUB_FAIL, subEntity);
  65   }
  66 
  67   @Override public void onSubCancel(DownloadEntity subEntity) {
  68     saveCurrentLocation();
  69     sendInState2Target(ISchedulers.SUB_CANCEL, subEntity);
  70   }
  71 
  72   @Override public void onSubRunning(DownloadEntity subEntity) {
  73     sendInState2Target(ISchedulers.SUB_RUNNING, subEntity);
  74   }
  75 
  76   /**
  77    * 将任务状态发送给下载器
  78    *
  79    * @param state {@link ISchedulers#START}
  80    */
  81   private void sendInState2Target(int state, DownloadEntity subEntity) {
  82     if (outHandler.get() != null) {
  83       mSeedEntity.entity = subEntity;
  84       outHandler.get().obtainMessage(state, ISchedulers.IS_SUB_TASK, 0, mSeedEntity).sendToTarget();
  85     }
  86   }
  87 
  88   private void saveCurrentLocation() {
  89     if (mEntity.getSubEntities() == null || mEntity.getSubEntities().isEmpty()) {
  90       ALog.w(TAG, &quot;保存进度失败，子任务为null&quot;);
  91       return;
  92     }
  93     long location = 0;
  94     for (DownloadEntity e : mEntity.getSubEntities()) {
  95       location += e.getCurrentProgress();
  96     }
  97 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  98     if (location &gt; mEntity.getFileSize()) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99       location = mEntity.getFileSize();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100     }</span>
 101 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102     mEntity.setCurrentProgress(location);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103     mEntity.update();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105 }</span>
 106 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 107 </span>
 108 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 109     mEntity.setCurrentProgress(location);
 110     mEntity.update();
 111   }
 112 }</pre></td>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package com.arialyy.aria.core.download;
  17 
  18 import android.os.Handler;
  19 import com.arialyy.aria.core.download.downloader.IDownloadGroupListener;
  20 import com.arialyy.aria.core.inf.GroupSendParams;
  21 import com.arialyy.aria.core.scheduler.ISchedulers;
  22 import com.arialyy.aria.util.ALog;
  23 
  24 /**
  25  * Created by Aria.Lao on 2017/7/20.
  26  * 任务组下载事件
  27  */
  28 class DownloadGroupListener
  29     extends BaseDListener&lt;DownloadGroupEntity, DownloadGroupTaskEntity, DownloadGroupTask&gt;
  30     implements IDownloadGroupListener {
  31   private final String TAG = &quot;DownloadGroupListener&quot;;
  32   private GroupSendParams&lt;DownloadGroupTask, DownloadEntity&gt; mSeedEntity;
  33 
  34   DownloadGroupListener(DownloadGroupTask task, Handler outHandler) {
  35     super(task, outHandler);
  36     mSeedEntity = new GroupSendParams&lt;&gt;();
  37     mSeedEntity.groupTask = task;
  38   }
  39 
  40   @Override public void onSubPre(DownloadEntity subEntity) {
  41     sendInState2Target(ISchedulers.SUB_PRE, subEntity);
  42   }
  43 
  44   @Override public void supportBreakpoint(boolean support, DownloadEntity subEntity) {
  45 
  46   }
  47 
  48   @Override public void onSubStart(DownloadEntity subEntity) {
  49     sendInState2Target(ISchedulers.SUB_START, subEntity);
  50   }
  51 
  52   @Override public void onSubStop(DownloadEntity subEntity) {
  53     saveCurrentLocation();
  54     sendInState2Target(ISchedulers.SUB_STOP, subEntity);
  55   }
  56 
  57   @Override public void onSubComplete(DownloadEntity subEntity) {
  58     saveCurrentLocation();
  59     sendInState2Target(ISchedulers.SUB_COMPLETE, subEntity);
  60   }
  61 
  62   @Override public void onSubFail(DownloadEntity subEntity) {
  63     saveCurrentLocation();
  64     sendInState2Target(ISchedulers.SUB_FAIL, subEntity);
  65   }
  66 
  67   @Override public void onSubCancel(DownloadEntity subEntity) {
  68     saveCurrentLocation();
  69     sendInState2Target(ISchedulers.SUB_CANCEL, subEntity);
  70   }
  71 
  72   @Override public void onSubRunning(DownloadEntity subEntity) {
  73     sendInState2Target(ISchedulers.SUB_RUNNING, subEntity);
  74   }
  75 
  76   /**
  77    * 将任务状态发送给下载器
  78    *
  79    * @param state {@link ISchedulers#START}
  80    */
  81   private void sendInState2Target(int state, DownloadEntity subEntity) {
  82     if (outHandler.get() != null) {
  83       mSeedEntity.entity = subEntity;
  84       outHandler.get().obtainMessage(state, ISchedulers.IS_SUB_TASK, 0, mSeedEntity).sendToTarget();
  85     }
  86   }
  87 
  88   private void saveCurrentLocation() {
  89     if (mEntity.getSubEntities() == null || mEntity.getSubEntities().isEmpty()) {
  90       ALog.w(TAG, &quot;保存进度失败，子任务为null&quot;);
  91       return;
  92     }
  93     long location = 0;
  94     for (DownloadEntity e : mEntity.getSubEntities()) {
  95       location += e.getCurrentProgress();
  96     }
  97     if (location &gt; mEntity.getFileSize()) {
  98       location = mEntity.getFileSize();
  99     }
 100     mEntity.setCurrentProgress(location);
 101     mEntity.update();
 102   }
 103 }
 
 
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package com.arialyy.aria.core.download;
  17 
  18 import android.os.Handler;
  19 import com.arialyy.aria.core.download.downloader.IDownloadGroupListener;
  20 import com.arialyy.aria.core.inf.GroupSendParams;
  21 import com.arialyy.aria.core.scheduler.ISchedulers;
  22 import com.arialyy.aria.util.ALog;
  23 
  24 
  25 /**
  26  * Created by Aria.Lao on 2017/7/20.
  27  * 任务组下载事件
  28  */
<abbr title="  29 class DownloadGroupListener extends BaseDListener&lt;DownloadGroupEntity, DownloadGroupTaskEntity, DownloadGroupTask&gt; implements IDownloadGroupListener {">  29 class DownloadGroupListener extends BaseDListener&lt;DownloadGroupEntity, DownloadGroupTaskEntity, DownloadG🔵</abbr>
  30   private final String TAG = &quot;DownloadGroupListener&quot;;
  31 
  32   private GroupSendParams&lt;DownloadGroupTask, DownloadEntity&gt; mSeedEntity;
  33 
  34   DownloadGroupListener(DownloadGroupTask task, Handler outHandler) {
  35     super(task, outHandler);
  36     mSeedEntity = new GroupSendParams&lt;&gt;();
  37     mSeedEntity.groupTask = task;
  38   }
  39 
  40   @Override public void onSubPre(DownloadEntity subEntity) {
  41     sendInState2Target(ISchedulers.SUB_PRE, subEntity);
  42   }
  43 
  44   @Override public void supportBreakpoint(boolean support, DownloadEntity subEntity) {
  45 
  46   }
  47 
  48   @Override public void onSubStart(DownloadEntity subEntity) {
  49     sendInState2Target(ISchedulers.SUB_START, subEntity);
  50   }
  51 
  52   @Override public void onSubStop(DownloadEntity subEntity) {
  53     saveCurrentLocation();
  54     sendInState2Target(ISchedulers.SUB_STOP, subEntity);
  55   }
  56 
  57   @Override public void onSubComplete(DownloadEntity subEntity) {
  58     saveCurrentLocation();
  59     sendInState2Target(ISchedulers.SUB_COMPLETE, subEntity);
  60   }
  61 
  62   @Override public void onSubFail(DownloadEntity subEntity) {
  63     saveCurrentLocation();
  64     sendInState2Target(ISchedulers.SUB_FAIL, subEntity);
  65   }
  66 
  67   @Override public void onSubCancel(DownloadEntity subEntity) {
  68     saveCurrentLocation();
  69     sendInState2Target(ISchedulers.SUB_CANCEL, subEntity);
  70   }
  71 
  72   @Override public void onSubRunning(DownloadEntity subEntity) {
  73     sendInState2Target(ISchedulers.SUB_RUNNING, subEntity);
  74   }
  75 
  76   /**
  77    * 将任务状态发送给下载器
  78    *
  79    * @param state {@link ISchedulers#START}
  80    */
  81   private void sendInState2Target(int state, DownloadEntity subEntity) {
  82     if (outHandler.get() != null) {
  83       mSeedEntity.entity = subEntity;
  84       outHandler.get().obtainMessage(state, ISchedulers.IS_SUB_TASK, 0, mSeedEntity).sendToTarget();
  85     }
  86   }
  87 
  88   private void saveCurrentLocation() {
  89     if ((mEntity.getSubEntities() == null) || mEntity.getSubEntities().isEmpty()) {
  90       ALog.w(TAG, &quot;保存进度失败，子任务为null&quot;);
  91       return;
  92     }
  93     long location = 0;
  94     for (DownloadEntity e : mEntity.getSubEntities()) {
  95       location += e.getCurrentProgress();
  96     }
  97     if (location &gt; mEntity.getFileSize()) {
  98       location = mEntity.getFileSize();
  99     }
 100     mEntity.setCurrentProgress(location);
 101     mEntity.update();
 102   }
 103 }
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  /*
   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3   *
   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5   * you may not use this file except in compliance with the License.
   6   * You may obtain a copy of the License at
   7   *
   8   *      http://www.apache.org/licenses/LICENSE-2.0
   9   *
  10   * Unless required by applicable law or agreed to in writing, software
  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13   * See the License for the specific language governing permissions and
  14   * limitations under the License.
  15   */
  16  package com.arialyy.aria.core.download;
  17  
  18  import android.os.Handler;
  19  import com.arialyy.aria.core.download.downloader.IDownloadGroupListener;
  20  import com.arialyy.aria.core.inf.GroupSendParams;
  21  import com.arialyy.aria.core.scheduler.ISchedulers;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  22 +import com.arialyy.aria.util.ALog;</span>
  23  
  24  /**
  25   * Created by Aria.Lao on 2017/7/20.
  26   * 任务组下载事件
  27   */
  28  class DownloadGroupListener
  29      extends BaseDListener&lt;DownloadGroupEntity, DownloadGroupTaskEntity, DownloadGroupTask&gt;
  30      implements IDownloadGroupListener {
  31    private final String TAG = &quot;DownloadGroupListener&quot;;
  32    private GroupSendParams&lt;DownloadGroupTask, DownloadEntity&gt; mSeedEntity;
  33  
  34    DownloadGroupListener(DownloadGroupTask task, Handler outHandler) {
  35      super(task, outHandler);
  36      mSeedEntity = new GroupSendParams&lt;&gt;();
  37      mSeedEntity.groupTask = task;
  38    }
  39  
  40    @Override public void onSubPre(DownloadEntity subEntity) {
  41      sendInState2Target(ISchedulers.SUB_PRE, subEntity);
  42    }
  43  
  44    @Override public void supportBreakpoint(boolean support, DownloadEntity subEntity) {
  45  
  46    }
  47  
  48    @Override public void onSubStart(DownloadEntity subEntity) {
  49      sendInState2Target(ISchedulers.SUB_START, subEntity);
  50    }
  51  
  52    @Override public void onSubStop(DownloadEntity subEntity) {
  53      saveCurrentLocation();
  54      sendInState2Target(ISchedulers.SUB_STOP, subEntity);
  55    }
  56  
  57    @Override public void onSubComplete(DownloadEntity subEntity) {
  58      saveCurrentLocation();
  59      sendInState2Target(ISchedulers.SUB_COMPLETE, subEntity);
  60    }
  61  
  62    @Override public void onSubFail(DownloadEntity subEntity) {
  63      saveCurrentLocation();
  64      sendInState2Target(ISchedulers.SUB_FAIL, subEntity);
  65    }
  66  
  67    @Override public void onSubCancel(DownloadEntity subEntity) {
  68      saveCurrentLocation();
  69      sendInState2Target(ISchedulers.SUB_CANCEL, subEntity);
  70    }
  71  
  72    @Override public void onSubRunning(DownloadEntity subEntity) {
  73      sendInState2Target(ISchedulers.SUB_RUNNING, subEntity);
  74    }
  75  
  76    /**
  77     * 将任务状态发送给下载器
  78     *
  79     * @param state {@link ISchedulers#START}
  80     */
  81    private void sendInState2Target(int state, DownloadEntity subEntity) {
  82      if (outHandler.get() != null) {
  83        mSeedEntity.entity = subEntity;
  84        outHandler.get().obtainMessage(state, ISchedulers.IS_SUB_TASK, 0, mSeedEntity).sendToTarget();
  85      }
  86    }
  87  
  88    private void saveCurrentLocation() {
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  89 +    if (mEntity.getSubEntities() == null || mEntity.getSubEntities().isEmpty()) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  90 +      ALog.w(TAG, &quot;保存进度失败，子任务为null&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  91 +      return;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  92 +    }</span>
  93      long location = 0;
  94      for (DownloadEntity e : mEntity.getSubEntities()) {
  95        location += e.getCurrentProgress();
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  96 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +    if (location &gt; mEntity.getFileSize()) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +      location = mEntity.getFileSize();</span>
  99      }

 100      mEntity.setCurrentProgress(location);
 101      mEntity.update();
 102    }
 103  }</pre></td>
                            <td><pre>   1  /*
   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3   *
   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5   * you may not use this file except in compliance with the License.
   6   * You may obtain a copy of the License at
   7   *
   8   *      http://www.apache.org/licenses/LICENSE-2.0
   9   *
  10   * Unless required by applicable law or agreed to in writing, software
  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13   * See the License for the specific language governing permissions and
  14   * limitations under the License.
  15   */
  16  package com.arialyy.aria.core.download;
  17  
  18  import android.os.Handler;
  19  import com.arialyy.aria.core.download.downloader.IDownloadGroupListener;
  20  import com.arialyy.aria.core.inf.GroupSendParams;
  21  import com.arialyy.aria.core.scheduler.ISchedulers;

  22  
  23  /**
  24   * Created by Aria.Lao on 2017/7/20.
  25   * 任务组下载事件
  26   */
  27  class DownloadGroupListener
  28      extends BaseDListener&lt;DownloadGroupEntity, DownloadGroupTaskEntity, DownloadGroupTask&gt;
  29      implements IDownloadGroupListener {
  30    private final String TAG = &quot;DownloadGroupListener&quot;;
  31    private GroupSendParams&lt;DownloadGroupTask, DownloadEntity&gt; mSeedEntity;
  32  
  33    DownloadGroupListener(DownloadGroupTask task, Handler outHandler) {
  34      super(task, outHandler);
  35      mSeedEntity = new GroupSendParams&lt;&gt;();
  36      mSeedEntity.groupTask = task;
  37    }
  38  
  39    @Override public void onSubPre(DownloadEntity subEntity) {
  40      sendInState2Target(ISchedulers.SUB_PRE, subEntity);
  41    }
  42  
  43    @Override public void supportBreakpoint(boolean support, DownloadEntity subEntity) {
  44  
  45    }
  46  
  47    @Override public void onSubStart(DownloadEntity subEntity) {
  48      sendInState2Target(ISchedulers.SUB_START, subEntity);
  49    }
  50  
  51    @Override public void onSubStop(DownloadEntity subEntity) {
  52      saveCurrentLocation();
  53      sendInState2Target(ISchedulers.SUB_STOP, subEntity);
  54    }
  55  
  56    @Override public void onSubComplete(DownloadEntity subEntity) {
  57      saveCurrentLocation();
  58      sendInState2Target(ISchedulers.SUB_COMPLETE, subEntity);
  59    }
  60  
  61    @Override public void onSubFail(DownloadEntity subEntity) {
  62      saveCurrentLocation();
  63      sendInState2Target(ISchedulers.SUB_FAIL, subEntity);
  64    }
  65  
  66    @Override public void onSubCancel(DownloadEntity subEntity) {
  67      saveCurrentLocation();
  68      sendInState2Target(ISchedulers.SUB_CANCEL, subEntity);
  69    }
  70  
  71    @Override public void onSubRunning(DownloadEntity subEntity) {
  72      sendInState2Target(ISchedulers.SUB_RUNNING, subEntity);
  73    }
  74  
  75    /**
  76     * 将任务状态发送给下载器
  77     *
  78     * @param state {@link ISchedulers#START}
  79     */
  80    private void sendInState2Target(int state, DownloadEntity subEntity) {
  81      if (outHandler.get() != null) {
  82        mSeedEntity.entity = subEntity;
  83        outHandler.get().obtainMessage(state, ISchedulers.IS_SUB_TASK, 0, mSeedEntity).sendToTarget();
  84      }
  85    }
  86  
  87    private void saveCurrentLocation() {




  88      long location = 0;
  89      for (DownloadEntity e : mEntity.getSubEntities()) {
  90        location += e.getCurrentProgress();



  91      }
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  92 +</span>
  93      mEntity.setCurrentProgress(location);
  94      mEntity.update();
  95    }
  96  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            