<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>425</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    425
                    <a href="424.html">prev</a>
                    <a href="426.html">next</a>
                    <a href="425_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    Evernote/android-job_d797e79ecc6bc6ca09d5864cf1a7dcace6702b52_library/src/main/java/com/evernote/android/job/JobProxy.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Evernote\android-job show &quot;d797e79ecc6bc6ca09d5864cf1a7dcace6702b52:library/src/main/java/com/evernote/android/job/JobProxy.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Evernote\android-job show &quot;d797e79ecc6bc6ca09d5864cf1a7dcace6702b52^1:library/src/main/java/com/evernote/android/job/JobProxy.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Evernote\android-job show &quot;d797e79ecc6bc6ca09d5864cf1a7dcace6702b52^2:library/src/main/java/com/evernote/android/job/JobProxy.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Evernote\android-job show &quot;7cde8e1e51cf104910bb292f9d01c663ee120814:library/src/main/java/com/evernote/android/job/JobProxy.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [j]], subset: [[b], [j]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-8822900351790619766" onmouseenter="enter('-8822900351790619766');" onmouseout="out('-8822900351790619766');" style="">   2  * Copyright 2007-present Evernote Corporation.                                                          </span>
<span class="-2278367542838177584" onmouseenter="enter('-2278367542838177584');" onmouseout="out('-2278367542838177584');" style="">   3  * All rights reserved.                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   4  *                                                                                                       </span>
<span class="181301442133285836" onmouseenter="enter('181301442133285836');" onmouseout="out('181301442133285836');" style="">   5  * Redistribution and use in source and binary forms, with or without modification,                      </span>
<span class="-5073197948967426970" onmouseenter="enter('-5073197948967426970');" onmouseout="out('-5073197948967426970');" style="">   6  * are permitted provided that the following conditions are met:                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="8127251449117563942" onmouseenter="enter('8127251449117563942');" onmouseout="out('8127251449117563942');" style="">   8  * 1. Redistributions of source code must retain the above copyright notice, this                        </span>
<span class="-1473911044945790828" onmouseenter="enter('-1473911044945790828');" onmouseout="out('-1473911044945790828');" style="">   9  *    list of conditions and the following disclaimer.                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  10  *                                                                                                       </span>
<span class="4835137028529553232" onmouseenter="enter('4835137028529553232');" onmouseout="out('4835137028529553232');" style="">  11  * 2. Redistributions in binary form must reproduce the above copyright notice,                          </span>
<span class="-1312443230807442131" onmouseenter="enter('-1312443230807442131');" onmouseout="out('-1312443230807442131');" style="">  12  *    this list of conditions and the following disclaimer in the documentation                          </span>
<span class="-2067912076149043179" onmouseenter="enter('-2067912076149043179');" onmouseout="out('-2067912076149043179');" style="">  13  *    and/or other materials provided with the distribution.                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  14  *                                                                                                       </span>
<span class="-7721941782677048447" onmouseenter="enter('-7721941782677048447');" onmouseout="out('-7721941782677048447');" style="">  15  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND                       </span>
<span class="-5124048439450882348" onmouseenter="enter('-5124048439450882348');" onmouseout="out('-5124048439450882348');" style="">  16  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED                         </span>
<span class="2277289959795125050" onmouseenter="enter('2277289959795125050');" onmouseout="out('2277289959795125050');" style="">  17  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.                    </span>
<span class="4422846307625339339" onmouseenter="enter('4422846307625339339');" onmouseout="out('4422846307625339339');" style="">  18  * IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,                       </span>
<span class="9023453646714579255" onmouseenter="enter('9023453646714579255');" onmouseout="out('9023453646714579255');" style="">  19  * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,                        </span>
<span class="2153827234735713132" onmouseenter="enter('2153827234735713132');" onmouseout="out('2153827234735713132');" style="">  20  * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,                         </span>
<span class="5782830561991082866" onmouseenter="enter('5782830561991082866');" onmouseout="out('5782830561991082866');" style="">  21  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF                       </span>
<span class="-2513683953102966204" onmouseenter="enter('-2513683953102966204');" onmouseout="out('-2513683953102966204');" style="">  22  * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE                       </span>
<span class="-6562574984275957691" onmouseenter="enter('-6562574984275957691');" onmouseout="out('-6562574984275957691');" style="">  23  * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF                             </span>
<span class="505998933154990042" onmouseenter="enter('505998933154990042');" onmouseout="out('505998933154990042');" style="">  24  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  25  */                                                                                                      </span>
<span class="4675552543740820910" onmouseenter="enter('4675552543740820910');" onmouseout="out('4675552543740820910');" style="">  26 package com.evernote.android.job;                                                                        </span>
<span  style="">  27                                                                                                          </span>
<span class="-1261404242645970098" onmouseenter="enter('-1261404242645970098');" onmouseout="out('-1261404242645970098');" style="">  28 import android.app.Service;                                                                              </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  29 import android.content.Context;                                                                          </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="">  30 import android.os.Looper;                                                                                </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  31 import android.support.annotation.NonNull;                                                               </span>
<span  style="">  32                                                                                                          </span>
<span class="-2629940017315809162" onmouseenter="enter('-2629940017315809162');" onmouseout="out('-2629940017315809162');" style="">  33 import com.evernote.android.job.util.JobApi;                                                             </span>
<span class="-5245147800812157155" onmouseenter="enter('-5245147800812157155');" onmouseout="out('-5245147800812157155');" style="">  34 import com.evernote.android.job.util.JobCat;                                                             </span>
<span class="2270421051523495577" onmouseenter="enter('2270421051523495577');" onmouseout="out('2270421051523495577');" style="">  35 import com.evernote.android.job.util.JobUtil;                                                            </span>
<span  style="">  36                                                                                                          </span>
<span class="4887698622156748971" onmouseenter="enter('4887698622156748971');" onmouseout="out('4887698622156748971');" style="">  37 import net.vrallev.android.cat.CatLog;                                                                   </span>
<span  style="">  38                                                                                                          </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="">  39 import java.util.Locale;                                                                                 </span>
<span class="6613496282884511495" onmouseenter="enter('6613496282884511495');" onmouseout="out('6613496282884511495');" style="">  40 import java.util.concurrent.ExecutionException;                                                          </span>
<span class="-331778695229620376" onmouseenter="enter('-331778695229620376');" onmouseout="out('-331778695229620376');" style="">  41 import java.util.concurrent.Future;                                                                      </span>
<span  style="">  42                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  43 /**                                                                                                      </span>
<span class="-126646863796949621" onmouseenter="enter('-126646863796949621');" onmouseout="out('-126646863796949621');" style="">  44  * A proxy for each {@link JobApi}.                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  45  *                                                                                                       </span>
<span class="-2541210092808878866" onmouseenter="enter('-2541210092808878866');" onmouseout="out('-2541210092808878866');" style="">  46  * @author rwondratschek                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  47  */                                                                                                      </span>
<span class="1140466455373644171" onmouseenter="enter('1140466455373644171');" onmouseout="out('1140466455373644171');" style="">  48 public interface JobProxy {                                                                              </span>
<span  style="">  49                                                                                                          </span>
<span class="-8144897713900189970" onmouseenter="enter('-8144897713900189970');" onmouseout="out('-8144897713900189970');" style="">  50     void plantOneOff(JobRequest request);                                                                </span>
<span  style="">  51                                                                                                          </span>
<span class="-2416890449051145953" onmouseenter="enter('-2416890449051145953');" onmouseout="out('-2416890449051145953');" style="">  52     void plantPeriodic(JobRequest request);                                                              </span>
<span  style="">  53                                                                                                          </span>
<span class="6309911337945331379" onmouseenter="enter('6309911337945331379');" onmouseout="out('6309911337945331379');" style="">  54     void plantPeriodicFlexSupport(JobRequest request);                                                   </span>
<span  style="">  55                                                                                                          </span>
<span class="8340124833639515371" onmouseenter="enter('8340124833639515371');" onmouseout="out('8340124833639515371');" style="">  56     void cancel(int jobId);                                                                              </span>
<span  style="">  57                                                                                                          </span>
<span class="-6161809553933645851" onmouseenter="enter('-6161809553933645851');" onmouseout="out('-6161809553933645851');" style="">  58     boolean isPlatformJobScheduled(JobRequest request);                                                  </span>
<span  style="">  59                                                                                                          </span>
<span class="1769639894748899311" onmouseenter="enter('1769639894748899311');" onmouseout="out('1769639894748899311');" style="">  60     /*package*/ final class Common {                                                                     </span>
<span  style="">  61                                                                                                          </span>
<span class="8412616957402907467" onmouseenter="enter('8412616957402907467');" onmouseout="out('8412616957402907467');" style=""><abbr title="  62         // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/math/LongMath.java">  62         // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/mathðŸ”µ</abbr></span>
<span class="-1572685421845796133" onmouseenter="enter('-1572685421845796133');" onmouseout="out('-1572685421845796133');" style="">  63         private static long checkedAdd(long a, long b) {                                                 </span>
<span class="-1527942472133998342" onmouseenter="enter('-1527942472133998342');" onmouseout="out('-1527942472133998342');" style="">  64             long result = a + b;                                                                         </span>
<span class="-8281399218677613001" onmouseenter="enter('-8281399218677613001');" onmouseout="out('-8281399218677613001');" style="">  65             return checkNoOverflow(result, (a ^ b) &lt; 0 | (a ^ result) &gt;= 0);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  66         }                                                                                                </span>
<span  style="">  67                                                                                                          </span>
<span class="6423040751114649745" onmouseenter="enter('6423040751114649745');" onmouseout="out('6423040751114649745');" style="">  68         private static long checkNoOverflow(long result, boolean condition) {                            </span>
<span class="6603368327369456734" onmouseenter="enter('6603368327369456734');" onmouseout="out('6603368327369456734');" style="">  69             return condition ? result : Long.MAX_VALUE;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70         }                                                                                                </span>
<span  style="">  71                                                                                                          </span>
<span class="1406832824568924523" onmouseenter="enter('1406832824568924523');" onmouseout="out('1406832824568924523');" style="">  72         public static long getStartMs(JobRequest request) {                                              </span>
<span class="226786102758733848" onmouseenter="enter('226786102758733848');" onmouseout="out('226786102758733848');" style="">  73             return checkedAdd(request.getStartMs(), request.getBackoffOffset());                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  74         }                                                                                                </span>
<span  style="">  75                                                                                                          </span>
<span class="-3832824197988283345" onmouseenter="enter('-3832824197988283345');" onmouseout="out('-3832824197988283345');" style="">  76         public static long getEndMs(JobRequest request) {                                                </span>
<span class="-7905467348819582542" onmouseenter="enter('-7905467348819582542');" onmouseout="out('-7905467348819582542');" style="">  77             return checkedAdd(request.getEndMs(), request.getBackoffOffset());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78         }                                                                                                </span>
<span  style="">  79                                                                                                          </span>
<span class="2658461420075954163" onmouseenter="enter('2658461420075954163');" onmouseout="out('2658461420075954163');" style="">  80         public static long getAverageDelayMs(JobRequest request) {                                       </span>
<span class="5188333912507681776" onmouseenter="enter('5188333912507681776');" onmouseout="out('5188333912507681776');" style="">  81             return checkedAdd(getStartMs(request), (getEndMs(request) - getStartMs(request)) / 2);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  82         }                                                                                                </span>
<span  style="">  83                                                                                                          </span>
<span class="-8453711403554538500" onmouseenter="enter('-8453711403554538500');" onmouseout="out('-8453711403554538500');" style="">  84         public static long getStartMsSupportFlex(JobRequest request) {                                   </span>
<span class="4867134151855536256" onmouseenter="enter('4867134151855536256');" onmouseout="out('4867134151855536256');" style="">  85             return Math.max(1, request.getIntervalMs() - request.getFlexMs());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  86         }                                                                                                </span>
<span  style="">  87                                                                                                          </span>
<span class="2402850512558550424" onmouseenter="enter('2402850512558550424');" onmouseout="out('2402850512558550424');" style="">  88         public static long getEndMsSupportFlex(JobRequest request) {                                     </span>
<span class="1818143853198758132" onmouseenter="enter('1818143853198758132');" onmouseout="out('1818143853198758132');" style="">  89             return request.getIntervalMs();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90         }                                                                                                </span>
<span  style="">  91                                                                                                          </span>
<span class="5236833657260895409" onmouseenter="enter('5236833657260895409');" onmouseout="out('5236833657260895409');" style="">  92         public static long getAverageDelayMsSupportFlex(JobRequest request) {                            </span>
<span class="1202002964551881523" onmouseenter="enter('1202002964551881523');" onmouseout="out('1202002964551881523');" style=""><abbr title="  93             return checkedAdd(getStartMsSupportFlex(request), (getEndMsSupportFlex(request) - getStartMsSupportFlex(request)) / 2);">  93             return checkedAdd(getStartMsSupportFlex(request), (getEndMsSupportFlex(request) - getStartMsSðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  94         }                                                                                                </span>
<span  style="">  95                                                                                                          </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style="">  96         private final Context mContext;                                                                  </span>
<span class="3051386596282037072" onmouseenter="enter('3051386596282037072');" onmouseout="out('3051386596282037072');" style="">  97         private final int mJobId;                                                                        </span>
<span class="6179859670209082226" onmouseenter="enter('6179859670209082226');" onmouseout="out('6179859670209082226');" style="">  98         private final CatLog mCat;                                                                       </span>
<span  style="">  99                                                                                                          </span>
<span class="5239517905467210385" onmouseenter="enter('5239517905467210385');" onmouseout="out('5239517905467210385');" style=""> 100         private final JobManager mJobManager;                                                            </span>
<span  style=""> 101                                                                                                          </span>
<span class="-4983816859190478642" onmouseenter="enter('-4983816859190478642');" onmouseout="out('-4983816859190478642');" style=""> 102         public Common(@NonNull Service service, int jobId) {                                             </span>
<span class="7913494938757178552" onmouseenter="enter('7913494938757178552');" onmouseout="out('7913494938757178552');" style=""> 103             this(service, service.getClass().getSimpleName(), jobId);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104         }                                                                                                </span>
<span  style=""> 105                                                                                                          </span>
<span class="9132788366718402424" onmouseenter="enter('9132788366718402424');" onmouseout="out('9132788366718402424');" style=""> 106         /*package*/ Common(@NonNull Context context, String loggingTag, int jobId) {                     </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 107             mContext = context;                                                                          </span>
<span class="3380959276812020408" onmouseenter="enter('3380959276812020408');" onmouseout="out('3380959276812020408');" style=""> 108             mJobId = jobId;                                                                              </span>
<span class="-630819311965639477" onmouseenter="enter('-630819311965639477');" onmouseout="out('-630819311965639477');" style=""> 109             mCat = new JobCat(loggingTag);                                                               </span>
<span  style=""> 110                                                                                                          </span>
<span class="2088134523180067307" onmouseenter="enter('2088134523180067307');" onmouseout="out('2088134523180067307');" style=""> 111             mJobManager = JobManager.create(context);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112         }                                                                                                </span>
<span  style=""> 113                                                                                                          </span>
<span class="-5511335237538855208" onmouseenter="enter('-5511335237538855208');" onmouseout="out('-5511335237538855208');" style=""> 114         public JobRequest getPendingRequest(boolean cleanUpOrphanedJob) {                                </span>
<span class="-1539078468410613703" onmouseenter="enter('-1539078468410613703');" onmouseout="out('-1539078468410613703');" style=""> 115             // order is important for logging purposes                                                   </span>
<span class="6754931577315038874" onmouseenter="enter('6754931577315038874');" onmouseout="out('6754931577315038874');" style=""> 116             JobRequest request = mJobManager.getJobRequest(mJobId, true);                                </span>
<span class="-4807858926389575759" onmouseenter="enter('-4807858926389575759');" onmouseout="out('-4807858926389575759');" style=""> 117             Job job = mJobManager.getJob(mJobId);                                                        </span>
<span class="80157358755741526" onmouseenter="enter('80157358755741526');" onmouseout="out('80157358755741526');" style=""> 118             boolean periodic = request != null &amp;&amp; request.isPeriodic();                                  </span>
<span  style=""> 119                                                                                                          </span>
<span class="1317679291661326604" onmouseenter="enter('1317679291661326604');" onmouseout="out('1317679291661326604');" style=""> 120             if (job != null &amp;&amp; !job.isFinished()) {                                                      </span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style=""><abbr title=" 121                 // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 121                 // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduleðŸ”µ</abbr></span>
<span class="-5462975656818636592" onmouseenter="enter('-5462975656818636592');" onmouseout="out('-5462975656818636592');" style=""> 122                 mCat.d(&quot;Job %d is already running, %s&quot;, mJobId, request);                                </span>
<span class="-8865814855968501379" onmouseenter="enter('-8865814855968501379');" onmouseout="out('-8865814855968501379');" style=""> 123                 // not necessary to clean up, the running instance will do that                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 124                 return null;                                                                             </span>
<span  style=""> 125                                                                                                          </span>
<span class="-4007651353712364444" onmouseenter="enter('-4007651353712364444');" onmouseout="out('-4007651353712364444');" style=""> 126             } else if (job != null &amp;&amp; !periodic) {                                                       </span>
<span class="599327769680236656" onmouseenter="enter('599327769680236656');" onmouseout="out('599327769680236656');" style=""> 127                 mCat.d(&quot;Job %d already finished, %s&quot;, mJobId, request);                                  </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style=""> 128                 cleanUpOrphanedJob(cleanUpOrphanedJob);                                                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 129                 return null;                                                                             </span>
<span  style=""> 130                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 131 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-6422008231677608128" onmouseenter="enter('-6422008231677608128');" onmouseout="out('-6422008231677608128');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 132             } else if (job != null &amp;&amp; System.currentTimeMillis() - job.getFinishedTimeStamp() &lt; JobRequest.getMinInterval() / 2) {"> 132             } else if (job != null &amp;&amp; System.currentTimeMillis() - job.getFinishedTimeStamp() &lt; JobRequesðŸ”µ</abbr></span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 133 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134                                                                                                          </span>
<span class="-4428555773566380837" onmouseenter="enter('-4428555773566380837');" onmouseout="out('-4428555773566380837');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135             } else if (request == null) {                                                                </span>
<span class="7609103357697598215" onmouseenter="enter('7609103357697598215');" onmouseout="out('7609103357697598215');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136                 mCat.d(&quot;Request for ID %d was null&quot;, mJobId);                                            </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139                                                                                                          </span>
<span class="-1057636993633179522" onmouseenter="enter('-1057636993633179522');" onmouseout="out('-1057636993633179522');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140             return request;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141         }                                                                                                </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 142 =======                                                                                                  </span>
<span class="-4441559070839346687" onmouseenter="enter('-4441559070839346687');" onmouseout="out('-4441559070839346687');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143             } else if (job != null &amp;&amp; System.currentTimeMillis() - job.getFinishedTimeStamp() &lt; 2_000) { </span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 144                 // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 144                 // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduleðŸ”µ</abbr></span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 145 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-2963240540698415567" onmouseenter="enter('-2963240540698415567');" onmouseout="out('-2963240540698415567');" style=""> 146                 mCat.d(&quot;Job %d is periodic and just finished, %s&quot;, mJobId, request);                     </span>
<span class="5118828189189336116" onmouseenter="enter('5118828189189336116');" onmouseout="out('5118828189189336116');" style=""> 147                 // don&#x27;t clean up, periodic job                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 148                 return null;                                                                             </span>
<span  style=""> 149                                                                                                          </span>
<span class="-6449094046803794181" onmouseenter="enter('-6449094046803794181');" onmouseout="out('-6449094046803794181');" style=""> 150             } else if (request != null &amp;&amp; request.isTransient()) {                                       </span>
<span class="4384727207576607146" onmouseenter="enter('4384727207576607146');" onmouseout="out('4384727207576607146');" style=""> 151                 mCat.d(&quot;Request %d is transient, %s&quot;, mJobId, request);                                  </span>
<span class="5877082491190597240" onmouseenter="enter('5877082491190597240');" onmouseout="out('5877082491190597240');" style=""> 152                 // not necessary to clean up, the JobManager will do this for transient jobs             </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 153                 return null;                                                                             </span>
<span  style=""> 154                                                                                                          </span>
<span class="-4428555773566380837" onmouseenter="enter('-4428555773566380837');" onmouseout="out('-4428555773566380837');" style=""> 155             } else if (request == null) {                                                                </span>
<span class="7609103357697598215" onmouseenter="enter('7609103357697598215');" onmouseout="out('7609103357697598215');" style=""> 156                 mCat.d(&quot;Request for ID %d was null&quot;, mJobId);                                            </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style=""> 157                 cleanUpOrphanedJob(cleanUpOrphanedJob);                                                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 158                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159             }                                                                                            </span>
<span  style=""> 160                                                                                                          </span>
<span class="-1057636993633179522" onmouseenter="enter('-1057636993633179522');" onmouseout="out('-1057636993633179522');" style=""> 161             return request;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162         }                                                                                                </span>
<span  style=""> 163                                                                                                          </span>
<span class="5154748246392482767" onmouseenter="enter('5154748246392482767');" onmouseout="out('5154748246392482767');" style=""> 164         @NonNull                                                                                         </span>
<span class="1474434811491937762" onmouseenter="enter('1474434811491937762');" onmouseout="out('1474434811491937762');" style=""> 165         public Job.Result executeJobRequest(@NonNull JobRequest request) {                               </span>
<span class="8785519441075077783" onmouseenter="enter('8785519441075077783');" onmouseout="out('8785519441075077783');" style=""> 166             long waited = System.currentTimeMillis() - request.getScheduledAt();                         </span>
<span class="-521988911558271196" onmouseenter="enter('-521988911558271196');" onmouseout="out('-521988911558271196');" style=""> 167             String timeWindow;                                                                           </span>
<span class="-4749167882947985624" onmouseenter="enter('-4749167882947985624');" onmouseout="out('-4749167882947985624');" style=""> 168             if (request.isPeriodic()) {                                                                  </span>
<span class="22254303833830880" onmouseenter="enter('22254303833830880');" onmouseout="out('22254303833830880');" style=""><abbr title=" 169                 timeWindow = String.format(Locale.US, &quot;interval %s, flex %s&quot;, JobUtil.timeToString(request.getIntervalMs()),"> 169                 timeWindow = String.format(Locale.US, &quot;interval %s, flex %s&quot;, JobUtil.timeToString(requesðŸ”µ</abbr></span>
<span class="-7441385486773924310" onmouseenter="enter('-7441385486773924310');" onmouseout="out('-7441385486773924310');" style=""> 170                         JobUtil.timeToString(request.getFlexMs()));                                      </span>
<span class="4779514256224206313" onmouseenter="enter('4779514256224206313');" onmouseout="out('4779514256224206313');" style=""> 171             } else if (request.getJobApi().supportsExecutionWindow()) {                                  </span>
<span class="-6246254348184491385" onmouseenter="enter('-6246254348184491385');" onmouseout="out('-6246254348184491385');" style=""><abbr title=" 172                 timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMs(request)),"> 172                 timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMsðŸ”µ</abbr></span>
<span class="6965396589660564452" onmouseenter="enter('6965396589660564452');" onmouseout="out('6965396589660564452');" style=""> 173                         JobUtil.timeToString(getEndMs(request)));                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 174             } else {                                                                                     </span>
<span class="-1520611369215068334" onmouseenter="enter('-1520611369215068334');" onmouseout="out('-1520611369215068334');" style=""> 175                 timeWindow = &quot;delay &quot; + JobUtil.timeToString(getAverageDelayMs(request));                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176             }                                                                                            </span>
<span  style=""> 177                                                                                                          </span>
<span class="-8808967967811702611" onmouseenter="enter('-8808967967811702611');" onmouseout="out('-8808967967811702611');" style=""> 178             if (Looper.myLooper() == Looper.getMainLooper()) {                                           </span>
<span class="-1368751502622418275" onmouseenter="enter('-1368751502622418275');" onmouseout="out('-1368751502622418275');" style=""><abbr title=" 179                 mCat.w(&quot;Running JobRequest on a main thread, this could cause stutter or ANR in your app.&quot;);"> 179                 mCat.w(&quot;Running JobRequest on a main thread, this could cause stutter or ANR in your app.ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180             }                                                                                            </span>
<span  style=""> 181                                                                                                          </span>
<span class="-1843046913616870974" onmouseenter="enter('-1843046913616870974');" onmouseout="out('-1843046913616870974');" style=""> 182             mCat.d(&quot;Run job, %s, waited %s, %s&quot;, request, JobUtil.timeToString(waited), timeWindow);     </span>
<span class="-4828048199353050218" onmouseenter="enter('-4828048199353050218');" onmouseout="out('-4828048199353050218');" style=""> 183             JobExecutor jobExecutor = mJobManager.getJobExecutor();                                      </span>
<span class="-1235692988875235782" onmouseenter="enter('-1235692988875235782');" onmouseout="out('-1235692988875235782');" style=""> 184             Job job = null;                                                                              </span>
<span  style=""> 185                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 186             try {                                                                                        </span>
<span class="-9073677935190895883" onmouseenter="enter('-9073677935190895883');" onmouseout="out('-9073677935190895883');" style=""><abbr title=" 187                 // create job first before setting it transient, avoids a race condition while rescheduling jobs"> 187                 // create job first before setting it transient, avoids a race condition while rescheduliðŸ”µ</abbr></span>
<span class="1625132338136195706" onmouseenter="enter('1625132338136195706');" onmouseout="out('1625132338136195706');" style=""> 188                 job = mJobManager.getJobCreatorHolder().createJob(request.getTag());                     </span>
<span  style=""> 189                                                                                                          </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 190                 if (!request.isPeriodic()) {                                                             </span>
<span class="3122394794119912241" onmouseenter="enter('3122394794119912241');" onmouseout="out('3122394794119912241');" style=""> 191                     request.setTransient(true);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192                 }                                                                                        </span>
<span  style=""> 193                                                                                                          </span>
<span class="-2797125910631995922" onmouseenter="enter('-2797125910631995922');" onmouseout="out('-2797125910631995922');" style=""> 194                 Future&lt;Job.Result&gt; future = jobExecutor.execute(mContext, request, job);                 </span>
<span class="-4410702629486134619" onmouseenter="enter('-4410702629486134619');" onmouseout="out('-4410702629486134619');" style=""> 195                 if (future == null) {                                                                    </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 196                     return Job.Result.FAILURE;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197                 }                                                                                        </span>
<span  style=""> 198                                                                                                          </span>
<span class="5244342940061655384" onmouseenter="enter('5244342940061655384');" onmouseout="out('5244342940061655384');" style=""> 199                 // wait until done                                                                       </span>
<span class="-4728317628971455727" onmouseenter="enter('-4728317628971455727');" onmouseout="out('-4728317628971455727');" style=""> 200                 Job.Result result = future.get();                                                        </span>
<span class="368857225067072174" onmouseenter="enter('368857225067072174');" onmouseout="out('368857225067072174');" style=""> 201                 mCat.d(&quot;Finished job, %s %s&quot;, request, result);                                          </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 202                 return result;                                                                           </span>
<span  style=""> 203                                                                                                          </span>
<span class="2273166757001165010" onmouseenter="enter('2273166757001165010');" onmouseout="out('2273166757001165010');" style=""> 204             } catch (InterruptedException | ExecutionException e) {                                      </span>
<span class="-1683580236663429788" onmouseenter="enter('-1683580236663429788');" onmouseout="out('-1683580236663429788');" style=""> 205                 mCat.e(e);                                                                               </span>
<span  style=""> 206                                                                                                          </span>
<span class="6519543964694909858" onmouseenter="enter('6519543964694909858');" onmouseout="out('6519543964694909858');" style=""> 207                 if (job != null) {                                                                       </span>
<span class="-9041905225007822866" onmouseenter="enter('-9041905225007822866');" onmouseout="out('-9041905225007822866');" style=""> 208                     job.cancel();                                                                        </span>
<span class="3580809215980372017" onmouseenter="enter('3580809215980372017');" onmouseout="out('3580809215980372017');" style=""> 209                     mCat.e(&quot;Canceled %s&quot;, request);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210                 }                                                                                        </span>
<span  style=""> 211                                                                                                          </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 212                 return Job.Result.FAILURE;                                                               </span>
<span  style=""> 213                                                                                                          </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 214             } finally {                                                                                  </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 215                 if (!request.isPeriodic()) {                                                             </span>
<span class="1449747436325478708" onmouseenter="enter('1449747436325478708');" onmouseout="out('1449747436325478708');" style=""> 216                     mJobManager.getJobStorage().remove(request);                                         </span>
<span  style=""> 217                                                                                                          </span>
<span class="-2333237089390189385" onmouseenter="enter('-2333237089390189385');" onmouseout="out('-2333237089390189385');" style=""> 218                 } else if (request.isFlexSupport()) {                                                    </span>
<span class="733386345181994468" onmouseenter="enter('733386345181994468');" onmouseout="out('733386345181994468');" style=""><abbr title=" 219                     mJobManager.getJobStorage().remove(request); // remove, we store the new job in JobManager.schedule()"> 219                     mJobManager.getJobStorage().remove(request); // remove, we store the new job in JobMaðŸ”µ</abbr></span>
<span class="2102053740633122535" onmouseenter="enter('2102053740633122535');" onmouseout="out('2102053740633122535');" style=""> 220                     request.reschedule(false, false);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223         }                                                                                                </span>
<span  style=""> 224                                                                                                          </span>
<span class="-3194552414098127961" onmouseenter="enter('-3194552414098127961');" onmouseout="out('-3194552414098127961');" style=""> 225         private void cleanUpOrphanedJob(boolean cleanUp) {                                               </span>
<span class="8101282554241671494" onmouseenter="enter('8101282554241671494');" onmouseout="out('8101282554241671494');" style=""> 226             if (cleanUp) {                                                                               </span>
<span class="6651175145696850096" onmouseenter="enter('6651175145696850096');" onmouseout="out('6651175145696850096');" style=""> 227                 cleanUpOrphanedJob(mContext, mJobId);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229         }                                                                                                </span>
<span  style=""> 230                                                                                                          </span>
<span class="3574082725044615574" onmouseenter="enter('3574082725044615574');" onmouseout="out('3574082725044615574');" style=""> 231         public static void cleanUpOrphanedJob(Context context, int jobId) {                              </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 232             /*                                                                                           </span>
<span class="4873467377157825728" onmouseenter="enter('4873467377157825728');" onmouseout="out('4873467377157825728');" style=""><abbr title=" 233              * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are still around."> 233              * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are stðŸ”µ</abbr></span>
<span class="7880315656890986822" onmouseenter="enter('7880315656890986822');" onmouseout="out('7880315656890986822');" style=""><abbr title=" 234              * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the old one. Here"> 234              * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the oldðŸ”µ</abbr></span>
<span class="7642695698821586509" onmouseenter="enter('7642695698821586509');" onmouseout="out('7642695698821586509');" style=""> 235              * we make sure, that no job is left in the system.                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 236              */                                                                                          </span>
<span class="-1280302924927314158" onmouseenter="enter('-1280302924927314158');" onmouseout="out('-1280302924927314158');" style=""> 237             for (JobApi jobApi : JobApi.values()) {                                                      </span>
<span class="-5474372138432799739" onmouseenter="enter('-5474372138432799739');" onmouseout="out('-5474372138432799739');" style=""> 238                 if (jobApi.isSupported(context)) {                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 239                     try {                                                                                </span>
<span class="-5924449239106429276" onmouseenter="enter('-5924449239106429276');" onmouseout="out('-5924449239106429276');" style=""> 240                         jobApi.getCachedProxy(context).cancel(jobId);                                    </span>
<span class="8538742657781196138" onmouseenter="enter('8538742657781196138');" onmouseout="out('8538742657781196138');" style=""> 241                     } catch (Exception ignored) {                                                        </span>
<span class="-571140832119819901" onmouseenter="enter('-571140832119819901');" onmouseout="out('-571140832119819901');" style=""><abbr title=" 242                         // GCM API could crash if it&#x27;s disabled, ignore crashes at this point and continue"> 242                         // GCM API could crash if it&#x27;s disabled, ignore crashes at this point and continuðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248 }                                                                                                        </span>
















































</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-8822900351790619766" onmouseenter="enter('-8822900351790619766');" onmouseout="out('-8822900351790619766');" style="">   2  * Copyright 2007-present Evernote Corporation.                                                          </span>
<span class="-2278367542838177584" onmouseenter="enter('-2278367542838177584');" onmouseout="out('-2278367542838177584');" style="">   3  * All rights reserved.                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   4  *                                                                                                       </span>
<span class="181301442133285836" onmouseenter="enter('181301442133285836');" onmouseout="out('181301442133285836');" style="">   5  * Redistribution and use in source and binary forms, with or without modification,                      </span>
<span class="-5073197948967426970" onmouseenter="enter('-5073197948967426970');" onmouseout="out('-5073197948967426970');" style="">   6  * are permitted provided that the following conditions are met:                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="8127251449117563942" onmouseenter="enter('8127251449117563942');" onmouseout="out('8127251449117563942');" style="">   8  * 1. Redistributions of source code must retain the above copyright notice, this                        </span>
<span class="-1473911044945790828" onmouseenter="enter('-1473911044945790828');" onmouseout="out('-1473911044945790828');" style="">   9  *    list of conditions and the following disclaimer.                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  10  *                                                                                                       </span>
<span class="4835137028529553232" onmouseenter="enter('4835137028529553232');" onmouseout="out('4835137028529553232');" style="">  11  * 2. Redistributions in binary form must reproduce the above copyright notice,                          </span>
<span class="-1312443230807442131" onmouseenter="enter('-1312443230807442131');" onmouseout="out('-1312443230807442131');" style="">  12  *    this list of conditions and the following disclaimer in the documentation                          </span>
<span class="-2067912076149043179" onmouseenter="enter('-2067912076149043179');" onmouseout="out('-2067912076149043179');" style="">  13  *    and/or other materials provided with the distribution.                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  14  *                                                                                                       </span>
<span class="-7721941782677048447" onmouseenter="enter('-7721941782677048447');" onmouseout="out('-7721941782677048447');" style="">  15  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND                       </span>
<span class="-5124048439450882348" onmouseenter="enter('-5124048439450882348');" onmouseout="out('-5124048439450882348');" style="">  16  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED                         </span>
<span class="2277289959795125050" onmouseenter="enter('2277289959795125050');" onmouseout="out('2277289959795125050');" style="">  17  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.                    </span>
<span class="4422846307625339339" onmouseenter="enter('4422846307625339339');" onmouseout="out('4422846307625339339');" style="">  18  * IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,                       </span>
<span class="9023453646714579255" onmouseenter="enter('9023453646714579255');" onmouseout="out('9023453646714579255');" style="">  19  * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,                        </span>
<span class="2153827234735713132" onmouseenter="enter('2153827234735713132');" onmouseout="out('2153827234735713132');" style="">  20  * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,                         </span>
<span class="5782830561991082866" onmouseenter="enter('5782830561991082866');" onmouseout="out('5782830561991082866');" style="">  21  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF                       </span>
<span class="-2513683953102966204" onmouseenter="enter('-2513683953102966204');" onmouseout="out('-2513683953102966204');" style="">  22  * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE                       </span>
<span class="-6562574984275957691" onmouseenter="enter('-6562574984275957691');" onmouseout="out('-6562574984275957691');" style="">  23  * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF                             </span>
<span class="505998933154990042" onmouseenter="enter('505998933154990042');" onmouseout="out('505998933154990042');" style="">  24  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  25  */                                                                                                      </span>
<span class="4675552543740820910" onmouseenter="enter('4675552543740820910');" onmouseout="out('4675552543740820910');" style="">  26 package com.evernote.android.job;                                                                        </span>
<span  style="">  27                                                                                                          </span>
<span class="-1261404242645970098" onmouseenter="enter('-1261404242645970098');" onmouseout="out('-1261404242645970098');" style="">  28 import android.app.Service;                                                                              </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  29 import android.content.Context;                                                                          </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="">  30 import android.os.Looper;                                                                                </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  31 import android.support.annotation.NonNull;                                                               </span>
<span  style="">  32                                                                                                          </span>
<span class="-2629940017315809162" onmouseenter="enter('-2629940017315809162');" onmouseout="out('-2629940017315809162');" style="">  33 import com.evernote.android.job.util.JobApi;                                                             </span>
<span class="-5245147800812157155" onmouseenter="enter('-5245147800812157155');" onmouseout="out('-5245147800812157155');" style="">  34 import com.evernote.android.job.util.JobCat;                                                             </span>
<span class="2270421051523495577" onmouseenter="enter('2270421051523495577');" onmouseout="out('2270421051523495577');" style="">  35 import com.evernote.android.job.util.JobUtil;                                                            </span>
<span  style="">  36                                                                                                          </span>
<span class="4887698622156748971" onmouseenter="enter('4887698622156748971');" onmouseout="out('4887698622156748971');" style="">  37 import net.vrallev.android.cat.CatLog;                                                                   </span>
<span  style="">  38                                                                                                          </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="">  39 import java.util.Locale;                                                                                 </span>
<span class="6613496282884511495" onmouseenter="enter('6613496282884511495');" onmouseout="out('6613496282884511495');" style="">  40 import java.util.concurrent.ExecutionException;                                                          </span>
<span class="-331778695229620376" onmouseenter="enter('-331778695229620376');" onmouseout="out('-331778695229620376');" style="">  41 import java.util.concurrent.Future;                                                                      </span>
<span  style="">  42                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  43 /**                                                                                                      </span>
<span class="-126646863796949621" onmouseenter="enter('-126646863796949621');" onmouseout="out('-126646863796949621');" style="">  44  * A proxy for each {@link JobApi}.                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  45  *                                                                                                       </span>
<span class="-2541210092808878866" onmouseenter="enter('-2541210092808878866');" onmouseout="out('-2541210092808878866');" style="">  46  * @author rwondratschek                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  47  */                                                                                                      </span>
<span class="1140466455373644171" onmouseenter="enter('1140466455373644171');" onmouseout="out('1140466455373644171');" style="">  48 public interface JobProxy {                                                                              </span>
<span  style="">  49                                                                                                          </span>
<span class="-8144897713900189970" onmouseenter="enter('-8144897713900189970');" onmouseout="out('-8144897713900189970');" style="">  50     void plantOneOff(JobRequest request);                                                                </span>
<span  style="">  51                                                                                                          </span>
<span class="-2416890449051145953" onmouseenter="enter('-2416890449051145953');" onmouseout="out('-2416890449051145953');" style="">  52     void plantPeriodic(JobRequest request);                                                              </span>
<span  style="">  53                                                                                                          </span>
<span class="6309911337945331379" onmouseenter="enter('6309911337945331379');" onmouseout="out('6309911337945331379');" style="">  54     void plantPeriodicFlexSupport(JobRequest request);                                                   </span>
<span  style="">  55                                                                                                          </span>
<span class="8340124833639515371" onmouseenter="enter('8340124833639515371');" onmouseout="out('8340124833639515371');" style="">  56     void cancel(int jobId);                                                                              </span>
<span  style="">  57                                                                                                          </span>
<span class="-6161809553933645851" onmouseenter="enter('-6161809553933645851');" onmouseout="out('-6161809553933645851');" style="">  58     boolean isPlatformJobScheduled(JobRequest request);                                                  </span>
<span  style="">  59                                                                                                          </span>
<span class="1769639894748899311" onmouseenter="enter('1769639894748899311');" onmouseout="out('1769639894748899311');" style="">  60     /*package*/ final class Common {                                                                     </span>
<span  style="">  61                                                                                                          </span>
<span class="8412616957402907467" onmouseenter="enter('8412616957402907467');" onmouseout="out('8412616957402907467');" style=""><abbr title="  62         // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/math/LongMath.java">  62         // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/mathðŸ”µ</abbr></span>
<span class="-1572685421845796133" onmouseenter="enter('-1572685421845796133');" onmouseout="out('-1572685421845796133');" style="">  63         private static long checkedAdd(long a, long b) {                                                 </span>
<span class="-1527942472133998342" onmouseenter="enter('-1527942472133998342');" onmouseout="out('-1527942472133998342');" style="">  64             long result = a + b;                                                                         </span>
<span class="-8281399218677613001" onmouseenter="enter('-8281399218677613001');" onmouseout="out('-8281399218677613001');" style="">  65             return checkNoOverflow(result, (a ^ b) &lt; 0 | (a ^ result) &gt;= 0);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  66         }                                                                                                </span>
<span  style="">  67                                                                                                          </span>
<span class="6423040751114649745" onmouseenter="enter('6423040751114649745');" onmouseout="out('6423040751114649745');" style="">  68         private static long checkNoOverflow(long result, boolean condition) {                            </span>
<span class="6603368327369456734" onmouseenter="enter('6603368327369456734');" onmouseout="out('6603368327369456734');" style="">  69             return condition ? result : Long.MAX_VALUE;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70         }                                                                                                </span>
<span  style="">  71                                                                                                          </span>
<span class="1406832824568924523" onmouseenter="enter('1406832824568924523');" onmouseout="out('1406832824568924523');" style="">  72         public static long getStartMs(JobRequest request) {                                              </span>
<span class="226786102758733848" onmouseenter="enter('226786102758733848');" onmouseout="out('226786102758733848');" style="">  73             return checkedAdd(request.getStartMs(), request.getBackoffOffset());                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  74         }                                                                                                </span>
<span  style="">  75                                                                                                          </span>
<span class="-3832824197988283345" onmouseenter="enter('-3832824197988283345');" onmouseout="out('-3832824197988283345');" style="">  76         public static long getEndMs(JobRequest request) {                                                </span>
<span class="-7905467348819582542" onmouseenter="enter('-7905467348819582542');" onmouseout="out('-7905467348819582542');" style="">  77             return checkedAdd(request.getEndMs(), request.getBackoffOffset());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78         }                                                                                                </span>
<span  style="">  79                                                                                                          </span>
<span class="2658461420075954163" onmouseenter="enter('2658461420075954163');" onmouseout="out('2658461420075954163');" style="">  80         public static long getAverageDelayMs(JobRequest request) {                                       </span>
<span class="5188333912507681776" onmouseenter="enter('5188333912507681776');" onmouseout="out('5188333912507681776');" style="">  81             return checkedAdd(getStartMs(request), (getEndMs(request) - getStartMs(request)) / 2);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  82         }                                                                                                </span>
<span  style="">  83                                                                                                          </span>
<span class="-8453711403554538500" onmouseenter="enter('-8453711403554538500');" onmouseout="out('-8453711403554538500');" style="">  84         public static long getStartMsSupportFlex(JobRequest request) {                                   </span>
<span class="4867134151855536256" onmouseenter="enter('4867134151855536256');" onmouseout="out('4867134151855536256');" style="">  85             return Math.max(1, request.getIntervalMs() - request.getFlexMs());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  86         }                                                                                                </span>
<span  style="">  87                                                                                                          </span>
<span class="2402850512558550424" onmouseenter="enter('2402850512558550424');" onmouseout="out('2402850512558550424');" style="">  88         public static long getEndMsSupportFlex(JobRequest request) {                                     </span>
<span class="1818143853198758132" onmouseenter="enter('1818143853198758132');" onmouseout="out('1818143853198758132');" style="">  89             return request.getIntervalMs();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90         }                                                                                                </span>
<span  style="">  91                                                                                                          </span>
<span class="5236833657260895409" onmouseenter="enter('5236833657260895409');" onmouseout="out('5236833657260895409');" style="">  92         public static long getAverageDelayMsSupportFlex(JobRequest request) {                            </span>
<span class="1202002964551881523" onmouseenter="enter('1202002964551881523');" onmouseout="out('1202002964551881523');" style=""><abbr title="  93             return checkedAdd(getStartMsSupportFlex(request), (getEndMsSupportFlex(request) - getStartMsSupportFlex(request)) / 2);">  93             return checkedAdd(getStartMsSupportFlex(request), (getEndMsSupportFlex(request) - getStartMsSðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  94         }                                                                                                </span>
<span  style="">  95                                                                                                          </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style="">  96         private final Context mContext;                                                                  </span>
<span class="3051386596282037072" onmouseenter="enter('3051386596282037072');" onmouseout="out('3051386596282037072');" style="">  97         private final int mJobId;                                                                        </span>
<span class="6179859670209082226" onmouseenter="enter('6179859670209082226');" onmouseout="out('6179859670209082226');" style="">  98         private final CatLog mCat;                                                                       </span>
<span  style="">  99                                                                                                          </span>
<span class="5239517905467210385" onmouseenter="enter('5239517905467210385');" onmouseout="out('5239517905467210385');" style=""> 100         private final JobManager mJobManager;                                                            </span>
<span  style=""> 101                                                                                                          </span>
<span class="-4983816859190478642" onmouseenter="enter('-4983816859190478642');" onmouseout="out('-4983816859190478642');" style=""> 102         public Common(@NonNull Service service, int jobId) {                                             </span>
<span class="7913494938757178552" onmouseenter="enter('7913494938757178552');" onmouseout="out('7913494938757178552');" style=""> 103             this(service, service.getClass().getSimpleName(), jobId);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104         }                                                                                                </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 105 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="697901881928484759" onmouseenter="enter('697901881928484759');" onmouseout="out('697901881928484759');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106 public JobRequest getPendingRequest() {                                                                  </span>
<span class="-1539078468410613703" onmouseenter="enter('-1539078468410613703');" onmouseout="out('-1539078468410613703');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107             // order is important for logging purposes                                                   </span>
<span class="6754931577315038874" onmouseenter="enter('6754931577315038874');" onmouseout="out('6754931577315038874');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108             JobRequest request = mJobManager.getJobRequest(mJobId, true);                                </span>
<span class="-4807858926389575759" onmouseenter="enter('-4807858926389575759');" onmouseout="out('-4807858926389575759');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 109             Job job = mJobManager.getJob(mJobId);                                                        </span>
<span class="80157358755741526" onmouseenter="enter('80157358755741526');" onmouseout="out('80157358755741526');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 110             boolean periodic = request != null &amp;&amp; request.isPeriodic();                                  </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 111                                                                                                          </span>
<span class="1317679291661326604" onmouseenter="enter('1317679291661326604');" onmouseout="out('1317679291661326604');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112             if (job != null &amp;&amp; !job.isFinished()) {                                                      </span>
<span class="-5462975656818636592" onmouseenter="enter('-5462975656818636592');" onmouseout="out('-5462975656818636592');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113                 mCat.d(&quot;Job %d is already running, %s&quot;, mJobId, request);                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 114                 return null;                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115                                                                                                          </span>
<span class="-4007651353712364444" onmouseenter="enter('-4007651353712364444');" onmouseout="out('-4007651353712364444');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116             } else if (job != null &amp;&amp; !periodic) {                                                       </span>
<span class="599327769680236656" onmouseenter="enter('599327769680236656');" onmouseout="out('599327769680236656');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 117                 mCat.d(&quot;Job %d already finished, %s&quot;, mJobId, request);                                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 118                 return null;                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 119                                                                                                          </span>
<span class="-6422008231677608128" onmouseenter="enter('-6422008231677608128');" onmouseout="out('-6422008231677608128');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 120             } else if (job != null &amp;&amp; System.currentTimeMillis() - job.getFinishedTimeStamp() &lt; JobRequest.getMinInterval() / 2) {"> 120             } else if (job != null &amp;&amp; System.currentTimeMillis() - job.getFinishedTimeStamp() &lt; JobRequesðŸ”µ</abbr></span>
<span class="-2963240540698415567" onmouseenter="enter('-2963240540698415567');" onmouseout="out('-2963240540698415567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121                 mCat.d(&quot;Job %d is periodic and just finished, %s&quot;, mJobId, request);                     </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122                 return null;                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123                                                                                                          </span>
<span class="-6449094046803794181" onmouseenter="enter('-6449094046803794181');" onmouseout="out('-6449094046803794181');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124             } else if (request != null &amp;&amp; request.isTransient()) {                                       </span>
<span class="4384727207576607146" onmouseenter="enter('4384727207576607146');" onmouseout="out('4384727207576607146');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125                 mCat.d(&quot;Request %d is transient, %s&quot;, mJobId, request);                                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126                 return null;                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127                                                                                                          </span>
<span class="-4428555773566380837" onmouseenter="enter('-4428555773566380837');" onmouseout="out('-4428555773566380837');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128             } else if (request == null) {                                                                </span>
<span class="7609103357697598215" onmouseenter="enter('7609103357697598215');" onmouseout="out('7609103357697598215');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129                 mCat.d(&quot;Request for ID %d was null&quot;, mJobId);                                            </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131             }                                                                                            </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132                                                                                                          </span>
<span class="-1057636993633179522" onmouseenter="enter('-1057636993633179522');" onmouseout="out('-1057636993633179522');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 133             return request;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 134         }                                                                                                </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 135 ||||||| BASE                                                                                             </span>
<span class="697901881928484759" onmouseenter="enter('697901881928484759');" onmouseout="out('697901881928484759');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136 public JobRequest getPendingRequest() {                                                                  </span>
<span class="-1539078468410613703" onmouseenter="enter('-1539078468410613703');" onmouseout="out('-1539078468410613703');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137             // order is important for logging purposes                                                   </span>
<span class="6754931577315038874" onmouseenter="enter('6754931577315038874');" onmouseout="out('6754931577315038874');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138             JobRequest request = mJobManager.getJobRequest(mJobId, true);                                </span>
<span class="-4807858926389575759" onmouseenter="enter('-4807858926389575759');" onmouseout="out('-4807858926389575759');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139             Job job = mJobManager.getJob(mJobId);                                                        </span>
<span class="80157358755741526" onmouseenter="enter('80157358755741526');" onmouseout="out('80157358755741526');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140             boolean periodic = request != null &amp;&amp; request.isPeriodic();                                  </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141                                                                                                          </span>
<span class="1317679291661326604" onmouseenter="enter('1317679291661326604');" onmouseout="out('1317679291661326604');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142             if (job != null &amp;&amp; !job.isFinished()) {                                                      </span>
<span class="-5462975656818636592" onmouseenter="enter('-5462975656818636592');" onmouseout="out('-5462975656818636592');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143                 mCat.d(&quot;Job %d is already running, %s&quot;, mJobId, request);                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144                 return null;                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145                                                                                                          </span>
<span class="-4007651353712364444" onmouseenter="enter('-4007651353712364444');" onmouseout="out('-4007651353712364444');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146             } else if (job != null &amp;&amp; !periodic) {                                                       </span>
<span class="599327769680236656" onmouseenter="enter('599327769680236656');" onmouseout="out('599327769680236656');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147                 mCat.d(&quot;Job %d already finished, %s&quot;, mJobId, request);                                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148                 return null;                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149                                                                                                          </span>
<span class="-4441559070839346687" onmouseenter="enter('-4441559070839346687');" onmouseout="out('-4441559070839346687');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150             } else if (job != null &amp;&amp; System.currentTimeMillis() - job.getFinishedTimeStamp() &lt; 2_000) { </span>
<span class="-2963240540698415567" onmouseenter="enter('-2963240540698415567');" onmouseout="out('-2963240540698415567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151                 mCat.d(&quot;Job %d is periodic and just finished, %s&quot;, mJobId, request);                     </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152                 return null;                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153                                                                                                          </span>
<span class="-6449094046803794181" onmouseenter="enter('-6449094046803794181');" onmouseout="out('-6449094046803794181');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154             } else if (request != null &amp;&amp; request.isTransient()) {                                       </span>
<span class="4384727207576607146" onmouseenter="enter('4384727207576607146');" onmouseout="out('4384727207576607146');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155                 mCat.d(&quot;Request %d is transient, %s&quot;, mJobId, request);                                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156                 return null;                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157                                                                                                          </span>
<span class="-4428555773566380837" onmouseenter="enter('-4428555773566380837');" onmouseout="out('-4428555773566380837');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158             } else if (request == null) {                                                                </span>
<span class="7609103357697598215" onmouseenter="enter('7609103357697598215');" onmouseout="out('7609103357697598215');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159                 mCat.d(&quot;Request for ID %d was null&quot;, mJobId);                                            </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162                                                                                                          </span>
<span class="-1057636993633179522" onmouseenter="enter('-1057636993633179522');" onmouseout="out('-1057636993633179522');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163             return request;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164         }                                                                                                </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 165 =======                                                                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 166 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style=""> 167                                                                                                          </span>
<span  style=""> 168                                                                                                          </span>
<span class="9132788366718402424" onmouseenter="enter('9132788366718402424');" onmouseout="out('9132788366718402424');" style=""> 169         /*package*/ Common(@NonNull Context context, String loggingTag, int jobId) {                     </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 170             mContext = context;                                                                          </span>
<span class="3380959276812020408" onmouseenter="enter('3380959276812020408');" onmouseout="out('3380959276812020408');" style=""> 171             mJobId = jobId;                                                                              </span>
<span class="-630819311965639477" onmouseenter="enter('-630819311965639477');" onmouseout="out('-630819311965639477');" style=""> 172             mCat = new JobCat(loggingTag);                                                               </span>
<span  style=""> 173                                                                                                          </span>
<span class="2088134523180067307" onmouseenter="enter('2088134523180067307');" onmouseout="out('2088134523180067307');" style=""> 174             mJobManager = JobManager.create(context);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175         }                                                                                                </span>
<span  style=""> 176                                                                                                          </span>
<span class="-5511335237538855208" onmouseenter="enter('-5511335237538855208');" onmouseout="out('-5511335237538855208');" style=""> 177         public JobRequest getPendingRequest(boolean cleanUpOrphanedJob) {                                </span>
<span class="-1539078468410613703" onmouseenter="enter('-1539078468410613703');" onmouseout="out('-1539078468410613703');" style=""> 178             // order is important for logging purposes                                                   </span>
<span class="6754931577315038874" onmouseenter="enter('6754931577315038874');" onmouseout="out('6754931577315038874');" style=""> 179             JobRequest request = mJobManager.getJobRequest(mJobId, true);                                </span>
<span class="-4807858926389575759" onmouseenter="enter('-4807858926389575759');" onmouseout="out('-4807858926389575759');" style=""> 180             Job job = mJobManager.getJob(mJobId);                                                        </span>
<span class="80157358755741526" onmouseenter="enter('80157358755741526');" onmouseout="out('80157358755741526');" style=""> 181             boolean periodic = request != null &amp;&amp; request.isPeriodic();                                  </span>
<span  style=""> 182                                                                                                          </span>
<span class="1317679291661326604" onmouseenter="enter('1317679291661326604');" onmouseout="out('1317679291661326604');" style=""> 183             if (job != null &amp;&amp; !job.isFinished()) {                                                      </span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style=""><abbr title=" 184                 // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 184                 // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduleðŸ”µ</abbr></span>
<span class="-5462975656818636592" onmouseenter="enter('-5462975656818636592');" onmouseout="out('-5462975656818636592');" style=""> 185                 mCat.d(&quot;Job %d is already running, %s&quot;, mJobId, request);                                </span>
<span class="-8865814855968501379" onmouseenter="enter('-8865814855968501379');" onmouseout="out('-8865814855968501379');" style=""> 186                 // not necessary to clean up, the running instance will do that                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 187                 return null;                                                                             </span>
<span  style=""> 188                                                                                                          </span>
<span class="-4007651353712364444" onmouseenter="enter('-4007651353712364444');" onmouseout="out('-4007651353712364444');" style=""> 189             } else if (job != null &amp;&amp; !periodic) {                                                       </span>
<span class="599327769680236656" onmouseenter="enter('599327769680236656');" onmouseout="out('599327769680236656');" style=""> 190                 mCat.d(&quot;Job %d already finished, %s&quot;, mJobId, request);                                  </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style=""> 191                 cleanUpOrphanedJob(cleanUpOrphanedJob);                                                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 192                 return null;                                                                             </span>
<span  style=""> 193                                                                                                          </span>
<span class="-4441559070839346687" onmouseenter="enter('-4441559070839346687');" onmouseout="out('-4441559070839346687');" style=""> 194             } else if (job != null &amp;&amp; System.currentTimeMillis() - job.getFinishedTimeStamp() &lt; 2_000) { </span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style=""><abbr title=" 195                 // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 195                 // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduleðŸ”µ</abbr></span>
<span class="-2963240540698415567" onmouseenter="enter('-2963240540698415567');" onmouseout="out('-2963240540698415567');" style=""> 196                 mCat.d(&quot;Job %d is periodic and just finished, %s&quot;, mJobId, request);                     </span>
<span class="5118828189189336116" onmouseenter="enter('5118828189189336116');" onmouseout="out('5118828189189336116');" style=""> 197                 // don&#x27;t clean up, periodic job                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 198                 return null;                                                                             </span>
<span  style=""> 199                                                                                                          </span>
<span class="-6449094046803794181" onmouseenter="enter('-6449094046803794181');" onmouseout="out('-6449094046803794181');" style=""> 200             } else if (request != null &amp;&amp; request.isTransient()) {                                       </span>
<span class="4384727207576607146" onmouseenter="enter('4384727207576607146');" onmouseout="out('4384727207576607146');" style=""> 201                 mCat.d(&quot;Request %d is transient, %s&quot;, mJobId, request);                                  </span>
<span class="5877082491190597240" onmouseenter="enter('5877082491190597240');" onmouseout="out('5877082491190597240');" style=""> 202                 // not necessary to clean up, the JobManager will do this for transient jobs             </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 203                 return null;                                                                             </span>
<span  style=""> 204                                                                                                          </span>
<span class="-4428555773566380837" onmouseenter="enter('-4428555773566380837');" onmouseout="out('-4428555773566380837');" style=""> 205             } else if (request == null) {                                                                </span>
<span class="7609103357697598215" onmouseenter="enter('7609103357697598215');" onmouseout="out('7609103357697598215');" style=""> 206                 mCat.d(&quot;Request for ID %d was null&quot;, mJobId);                                            </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style=""> 207                 cleanUpOrphanedJob(cleanUpOrphanedJob);                                                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 208                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209             }                                                                                            </span>
<span  style=""> 210                                                                                                          </span>
<span class="-1057636993633179522" onmouseenter="enter('-1057636993633179522');" onmouseout="out('-1057636993633179522');" style=""> 211             return request;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212         }                                                                                                </span>
<span  style=""> 213                                                                                                          </span>
<span class="5154748246392482767" onmouseenter="enter('5154748246392482767');" onmouseout="out('5154748246392482767');" style=""> 214         @NonNull                                                                                         </span>
<span class="1474434811491937762" onmouseenter="enter('1474434811491937762');" onmouseout="out('1474434811491937762');" style=""> 215         public Job.Result executeJobRequest(@NonNull JobRequest request) {                               </span>
<span class="8785519441075077783" onmouseenter="enter('8785519441075077783');" onmouseout="out('8785519441075077783');" style=""> 216             long waited = System.currentTimeMillis() - request.getScheduledAt();                         </span>
<span class="-521988911558271196" onmouseenter="enter('-521988911558271196');" onmouseout="out('-521988911558271196');" style=""> 217             String timeWindow;                                                                           </span>
<span class="-4749167882947985624" onmouseenter="enter('-4749167882947985624');" onmouseout="out('-4749167882947985624');" style=""> 218             if (request.isPeriodic()) {                                                                  </span>
<span class="22254303833830880" onmouseenter="enter('22254303833830880');" onmouseout="out('22254303833830880');" style=""><abbr title=" 219                 timeWindow = String.format(Locale.US, &quot;interval %s, flex %s&quot;, JobUtil.timeToString(request.getIntervalMs()),"> 219                 timeWindow = String.format(Locale.US, &quot;interval %s, flex %s&quot;, JobUtil.timeToString(requesðŸ”µ</abbr></span>
<span class="-7441385486773924310" onmouseenter="enter('-7441385486773924310');" onmouseout="out('-7441385486773924310');" style=""> 220                         JobUtil.timeToString(request.getFlexMs()));                                      </span>
<span class="4779514256224206313" onmouseenter="enter('4779514256224206313');" onmouseout="out('4779514256224206313');" style=""> 221             } else if (request.getJobApi().supportsExecutionWindow()) {                                  </span>
<span class="-6246254348184491385" onmouseenter="enter('-6246254348184491385');" onmouseout="out('-6246254348184491385');" style=""><abbr title=" 222                 timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMs(request)),"> 222                 timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMsðŸ”µ</abbr></span>
<span class="6965396589660564452" onmouseenter="enter('6965396589660564452');" onmouseout="out('6965396589660564452');" style=""> 223                         JobUtil.timeToString(getEndMs(request)));                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 224             } else {                                                                                     </span>
<span class="-1520611369215068334" onmouseenter="enter('-1520611369215068334');" onmouseout="out('-1520611369215068334');" style=""> 225                 timeWindow = &quot;delay &quot; + JobUtil.timeToString(getAverageDelayMs(request));                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226             }                                                                                            </span>
<span  style=""> 227                                                                                                          </span>
<span class="-8808967967811702611" onmouseenter="enter('-8808967967811702611');" onmouseout="out('-8808967967811702611');" style=""> 228             if (Looper.myLooper() == Looper.getMainLooper()) {                                           </span>
<span class="-1368751502622418275" onmouseenter="enter('-1368751502622418275');" onmouseout="out('-1368751502622418275');" style=""><abbr title=" 229                 mCat.w(&quot;Running JobRequest on a main thread, this could cause stutter or ANR in your app.&quot;);"> 229                 mCat.w(&quot;Running JobRequest on a main thread, this could cause stutter or ANR in your app.ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230             }                                                                                            </span>
<span  style=""> 231                                                                                                          </span>
<span class="-1843046913616870974" onmouseenter="enter('-1843046913616870974');" onmouseout="out('-1843046913616870974');" style=""> 232             mCat.d(&quot;Run job, %s, waited %s, %s&quot;, request, JobUtil.timeToString(waited), timeWindow);     </span>
<span class="-4828048199353050218" onmouseenter="enter('-4828048199353050218');" onmouseout="out('-4828048199353050218');" style=""> 233             JobExecutor jobExecutor = mJobManager.getJobExecutor();                                      </span>
<span class="-1235692988875235782" onmouseenter="enter('-1235692988875235782');" onmouseout="out('-1235692988875235782');" style=""> 234             Job job = null;                                                                              </span>
<span  style=""> 235                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 236             try {                                                                                        </span>
<span class="-9073677935190895883" onmouseenter="enter('-9073677935190895883');" onmouseout="out('-9073677935190895883');" style=""><abbr title=" 237                 // create job first before setting it transient, avoids a race condition while rescheduling jobs"> 237                 // create job first before setting it transient, avoids a race condition while rescheduliðŸ”µ</abbr></span>
<span class="1625132338136195706" onmouseenter="enter('1625132338136195706');" onmouseout="out('1625132338136195706');" style=""> 238                 job = mJobManager.getJobCreatorHolder().createJob(request.getTag());                     </span>
<span  style=""> 239                                                                                                          </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 240                 if (!request.isPeriodic()) {                                                             </span>
<span class="3122394794119912241" onmouseenter="enter('3122394794119912241');" onmouseout="out('3122394794119912241');" style=""> 241                     request.setTransient(true);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242                 }                                                                                        </span>
<span  style=""> 243                                                                                                          </span>
<span class="-2797125910631995922" onmouseenter="enter('-2797125910631995922');" onmouseout="out('-2797125910631995922');" style=""> 244                 Future&lt;Job.Result&gt; future = jobExecutor.execute(mContext, request, job);                 </span>
<span class="-4410702629486134619" onmouseenter="enter('-4410702629486134619');" onmouseout="out('-4410702629486134619');" style=""> 245                 if (future == null) {                                                                    </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 246                     return Job.Result.FAILURE;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247                 }                                                                                        </span>
<span  style=""> 248                                                                                                          </span>
<span class="5244342940061655384" onmouseenter="enter('5244342940061655384');" onmouseout="out('5244342940061655384');" style=""> 249                 // wait until done                                                                       </span>
<span class="-4728317628971455727" onmouseenter="enter('-4728317628971455727');" onmouseout="out('-4728317628971455727');" style=""> 250                 Job.Result result = future.get();                                                        </span>
<span class="368857225067072174" onmouseenter="enter('368857225067072174');" onmouseout="out('368857225067072174');" style=""> 251                 mCat.d(&quot;Finished job, %s %s&quot;, request, result);                                          </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 252                 return result;                                                                           </span>
<span  style=""> 253                                                                                                          </span>
<span class="2273166757001165010" onmouseenter="enter('2273166757001165010');" onmouseout="out('2273166757001165010');" style=""> 254             } catch (InterruptedException | ExecutionException e) {                                      </span>
<span class="-1683580236663429788" onmouseenter="enter('-1683580236663429788');" onmouseout="out('-1683580236663429788');" style=""> 255                 mCat.e(e);                                                                               </span>
<span  style=""> 256                                                                                                          </span>
<span class="6519543964694909858" onmouseenter="enter('6519543964694909858');" onmouseout="out('6519543964694909858');" style=""> 257                 if (job != null) {                                                                       </span>
<span class="-9041905225007822866" onmouseenter="enter('-9041905225007822866');" onmouseout="out('-9041905225007822866');" style=""> 258                     job.cancel();                                                                        </span>
<span class="3580809215980372017" onmouseenter="enter('3580809215980372017');" onmouseout="out('3580809215980372017');" style=""> 259                     mCat.e(&quot;Canceled %s&quot;, request);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260                 }                                                                                        </span>
<span  style=""> 261                                                                                                          </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 262                 return Job.Result.FAILURE;                                                               </span>
<span  style=""> 263                                                                                                          </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 264             } finally {                                                                                  </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 265                 if (!request.isPeriodic()) {                                                             </span>
<span class="1449747436325478708" onmouseenter="enter('1449747436325478708');" onmouseout="out('1449747436325478708');" style=""> 266                     mJobManager.getJobStorage().remove(request);                                         </span>
<span  style=""> 267                                                                                                          </span>
<span class="-2333237089390189385" onmouseenter="enter('-2333237089390189385');" onmouseout="out('-2333237089390189385');" style=""> 268                 } else if (request.isFlexSupport()) {                                                    </span>
<span class="733386345181994468" onmouseenter="enter('733386345181994468');" onmouseout="out('733386345181994468');" style=""><abbr title=" 269                     mJobManager.getJobStorage().remove(request); // remove, we store the new job in JobManager.schedule()"> 269                     mJobManager.getJobStorage().remove(request); // remove, we store the new job in JobMaðŸ”µ</abbr></span>
<span class="2102053740633122535" onmouseenter="enter('2102053740633122535');" onmouseout="out('2102053740633122535');" style=""> 270                     request.reschedule(false, false);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 271                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273         }                                                                                                </span>
<span  style=""> 274                                                                                                          </span>
<span class="-3194552414098127961" onmouseenter="enter('-3194552414098127961');" onmouseout="out('-3194552414098127961');" style=""> 275         private void cleanUpOrphanedJob(boolean cleanUp) {                                               </span>
<span class="8101282554241671494" onmouseenter="enter('8101282554241671494');" onmouseout="out('8101282554241671494');" style=""> 276             if (cleanUp) {                                                                               </span>
<span class="6651175145696850096" onmouseenter="enter('6651175145696850096');" onmouseout="out('6651175145696850096');" style=""> 277             cleanUpOrphanedJob(mContext, mJobId);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279         }                                                                                                </span>
<span  style=""> 280                                                                                                          </span>
<span class="3574082725044615574" onmouseenter="enter('3574082725044615574');" onmouseout="out('3574082725044615574');" style=""> 281         public static void cleanUpOrphanedJob(Context context, int jobId) {                              </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 282             /*                                                                                           </span>
<span class="4873467377157825728" onmouseenter="enter('4873467377157825728');" onmouseout="out('4873467377157825728');" style=""><abbr title=" 283              * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are still around."> 283              * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are stðŸ”µ</abbr></span>
<span class="7880315656890986822" onmouseenter="enter('7880315656890986822');" onmouseout="out('7880315656890986822');" style=""><abbr title=" 284              * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the old one. Here"> 284              * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the oldðŸ”µ</abbr></span>
<span class="7642695698821586509" onmouseenter="enter('7642695698821586509');" onmouseout="out('7642695698821586509');" style=""> 285              * we make sure, that no job is left in the system.                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 286              */                                                                                          </span>
<span class="-1280302924927314158" onmouseenter="enter('-1280302924927314158');" onmouseout="out('-1280302924927314158');" style=""> 287             for (JobApi jobApi : JobApi.values()) {                                                      </span>
<span class="-5474372138432799739" onmouseenter="enter('-5474372138432799739');" onmouseout="out('-5474372138432799739');" style=""> 288                 if (jobApi.isSupported(context)) {                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 289                     try {                                                                                </span>
<span class="-5924449239106429276" onmouseenter="enter('-5924449239106429276');" onmouseout="out('-5924449239106429276');" style=""> 290                     jobApi.getCachedProxy(context).cancel(jobId);                                        </span>
<span class="8538742657781196138" onmouseenter="enter('8538742657781196138');" onmouseout="out('8538742657781196138');" style=""> 291                     } catch (Exception ignored) {                                                        </span>
<span class="-571140832119819901" onmouseenter="enter('-571140832119819901');" onmouseout="out('-571140832119819901');" style=""><abbr title=" 292                         // GCM API could crash if it&#x27;s disabled, ignore crashes at this point and continue"> 292                         // GCM API could crash if it&#x27;s disabled, ignore crashes at this point and continuðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-8822900351790619766" onmouseenter="enter('-8822900351790619766');" onmouseout="out('-8822900351790619766');" style="">   2  * Copyright 2007-present Evernote Corporation.                                                          </span>
<span class="-2278367542838177584" onmouseenter="enter('-2278367542838177584');" onmouseout="out('-2278367542838177584');" style="">   3  * All rights reserved.                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   4  *                                                                                                       </span>
<span class="181301442133285836" onmouseenter="enter('181301442133285836');" onmouseout="out('181301442133285836');" style="">   5  * Redistribution and use in source and binary forms, with or without modification,                      </span>
<span class="-5073197948967426970" onmouseenter="enter('-5073197948967426970');" onmouseout="out('-5073197948967426970');" style="">   6  * are permitted provided that the following conditions are met:                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="8127251449117563942" onmouseenter="enter('8127251449117563942');" onmouseout="out('8127251449117563942');" style="">   8  * 1. Redistributions of source code must retain the above copyright notice, this                        </span>
<span class="-1473911044945790828" onmouseenter="enter('-1473911044945790828');" onmouseout="out('-1473911044945790828');" style="">   9  *    list of conditions and the following disclaimer.                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  10  *                                                                                                       </span>
<span class="4835137028529553232" onmouseenter="enter('4835137028529553232');" onmouseout="out('4835137028529553232');" style="">  11  * 2. Redistributions in binary form must reproduce the above copyright notice,                          </span>
<span class="-1312443230807442131" onmouseenter="enter('-1312443230807442131');" onmouseout="out('-1312443230807442131');" style="">  12  *    this list of conditions and the following disclaimer in the documentation                          </span>
<span class="-2067912076149043179" onmouseenter="enter('-2067912076149043179');" onmouseout="out('-2067912076149043179');" style="">  13  *    and/or other materials provided with the distribution.                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  14  *                                                                                                       </span>
<span class="-7721941782677048447" onmouseenter="enter('-7721941782677048447');" onmouseout="out('-7721941782677048447');" style="">  15  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND                       </span>
<span class="-5124048439450882348" onmouseenter="enter('-5124048439450882348');" onmouseout="out('-5124048439450882348');" style="">  16  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED                         </span>
<span class="2277289959795125050" onmouseenter="enter('2277289959795125050');" onmouseout="out('2277289959795125050');" style="">  17  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.                    </span>
<span class="4422846307625339339" onmouseenter="enter('4422846307625339339');" onmouseout="out('4422846307625339339');" style="">  18  * IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,                       </span>
<span class="9023453646714579255" onmouseenter="enter('9023453646714579255');" onmouseout="out('9023453646714579255');" style="">  19  * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,                        </span>
<span class="2153827234735713132" onmouseenter="enter('2153827234735713132');" onmouseout="out('2153827234735713132');" style="">  20  * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,                         </span>
<span class="5782830561991082866" onmouseenter="enter('5782830561991082866');" onmouseout="out('5782830561991082866');" style="">  21  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF                       </span>
<span class="-2513683953102966204" onmouseenter="enter('-2513683953102966204');" onmouseout="out('-2513683953102966204');" style="">  22  * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE                       </span>
<span class="-6562574984275957691" onmouseenter="enter('-6562574984275957691');" onmouseout="out('-6562574984275957691');" style="">  23  * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF                             </span>
<span class="505998933154990042" onmouseenter="enter('505998933154990042');" onmouseout="out('505998933154990042');" style="">  24  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  25  */                                                                                                      </span>
<span class="4675552543740820910" onmouseenter="enter('4675552543740820910');" onmouseout="out('4675552543740820910');" style="">  26 package com.evernote.android.job;                                                                        </span>
<span  style="">  27                                                                                                          </span>
<span class="-1261404242645970098" onmouseenter="enter('-1261404242645970098');" onmouseout="out('-1261404242645970098');" style="">  28 import android.app.Service;                                                                              </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  29 import android.content.Context;                                                                          </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="">  30 import android.os.Looper;                                                                                </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  31 import android.support.annotation.NonNull;                                                               </span>
<span class="-2629940017315809162" onmouseenter="enter('-2629940017315809162');" onmouseout="out('-2629940017315809162');" style="">  32 import com.evernote.android.job.util.JobApi;                                                             </span>
<span class="-5245147800812157155" onmouseenter="enter('-5245147800812157155');" onmouseout="out('-5245147800812157155');" style="">  33 import com.evernote.android.job.util.JobCat;                                                             </span>
<span class="2270421051523495577" onmouseenter="enter('2270421051523495577');" onmouseout="out('2270421051523495577');" style="">  34 import com.evernote.android.job.util.JobUtil;                                                            </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="">  35 import java.util.Locale;                                                                                 </span>
<span class="6613496282884511495" onmouseenter="enter('6613496282884511495');" onmouseout="out('6613496282884511495');" style="">  36 import java.util.concurrent.ExecutionException;                                                          </span>
<span class="-331778695229620376" onmouseenter="enter('-331778695229620376');" onmouseout="out('-331778695229620376');" style="">  37 import java.util.concurrent.Future;                                                                      </span>
<span class="4887698622156748971" onmouseenter="enter('4887698622156748971');" onmouseout="out('4887698622156748971');" style="">  38 import net.vrallev.android.cat.CatLog;                                                                   </span>
<span  style="">  39                                                                                                          </span>
<span  style="">  40                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  41 /**                                                                                                      </span>
<span class="-126646863796949621" onmouseenter="enter('-126646863796949621');" onmouseout="out('-126646863796949621');" style="">  42  * A proxy for each {@link JobApi}.                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  43  *                                                                                                       </span>
<span class="-2541210092808878866" onmouseenter="enter('-2541210092808878866');" onmouseout="out('-2541210092808878866');" style="">  44  * @author rwondratschek                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  45  */                                                                                                      </span>
<span class="1140466455373644171" onmouseenter="enter('1140466455373644171');" onmouseout="out('1140466455373644171');" style="">  46 public interface JobProxy {                                                                              </span>
<span class="-8144897713900189970" onmouseenter="enter('-8144897713900189970');" onmouseout="out('-8144897713900189970');" style="">  47     void plantOneOff(JobRequest request);                                                                </span>
<span  style="">  48                                                                                                          </span>
<span class="-2416890449051145953" onmouseenter="enter('-2416890449051145953');" onmouseout="out('-2416890449051145953');" style="">  49     void plantPeriodic(JobRequest request);                                                              </span>
<span  style="">  50                                                                                                          </span>
<span class="6309911337945331379" onmouseenter="enter('6309911337945331379');" onmouseout="out('6309911337945331379');" style="">  51     void plantPeriodicFlexSupport(JobRequest request);                                                   </span>
<span  style="">  52                                                                                                          </span>
<span class="8340124833639515371" onmouseenter="enter('8340124833639515371');" onmouseout="out('8340124833639515371');" style="">  53     void cancel(int jobId);                                                                              </span>
<span  style="">  54                                                                                                          </span>
<span class="-6161809553933645851" onmouseenter="enter('-6161809553933645851');" onmouseout="out('-6161809553933645851');" style="">  55     boolean isPlatformJobScheduled(JobRequest request);                                                  </span>
<span  style="">  56                                                                                                          </span>
<span class="-2942343485984948817" onmouseenter="enter('-2942343485984948817');" onmouseout="out('-2942343485984948817');" style="">  57     /*package*/                                                                                          </span>
<span class="1802690055591873141" onmouseenter="enter('1802690055591873141');" onmouseout="out('1802690055591873141');" style="">  58     final class Common {                                                                                 </span>
<span class="8412616957402907467" onmouseenter="enter('8412616957402907467');" onmouseout="out('8412616957402907467');" style=""><abbr title="  59         // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/math/LongMath.java">  59         // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/mathðŸ”µ</abbr></span>
<span class="-1572685421845796133" onmouseenter="enter('-1572685421845796133');" onmouseout="out('-1572685421845796133');" style="">  60         private static long checkedAdd(long a, long b) {                                                 </span>
<span class="-1527942472133998342" onmouseenter="enter('-1527942472133998342');" onmouseout="out('-1527942472133998342');" style="">  61             long result = a + b;                                                                         </span>
<span class="-8281399218677613001" onmouseenter="enter('-8281399218677613001');" onmouseout="out('-8281399218677613001');" style="">  62             return checkNoOverflow(result, (a ^ b) &lt; 0 | (a ^ result) &gt;= 0);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  63         }                                                                                                </span>
<span  style="">  64                                                                                                          </span>
<span class="6423040751114649745" onmouseenter="enter('6423040751114649745');" onmouseout="out('6423040751114649745');" style="">  65         private static long checkNoOverflow(long result, boolean condition) {                            </span>
<span class="6603368327369456734" onmouseenter="enter('6603368327369456734');" onmouseout="out('6603368327369456734');" style="">  66             return condition ? result : Long.MAX_VALUE;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  67         }                                                                                                </span>
<span  style="">  68                                                                                                          </span>
<span class="1406832824568924523" onmouseenter="enter('1406832824568924523');" onmouseout="out('1406832824568924523');" style="">  69         public static long getStartMs(JobRequest request) {                                              </span>
<span class="226786102758733848" onmouseenter="enter('226786102758733848');" onmouseout="out('226786102758733848');" style="">  70             return checkedAdd(request.getStartMs(), request.getBackoffOffset());                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  71         }                                                                                                </span>
<span  style="">  72                                                                                                          </span>
<span class="-3832824197988283345" onmouseenter="enter('-3832824197988283345');" onmouseout="out('-3832824197988283345');" style="">  73         public static long getEndMs(JobRequest request) {                                                </span>
<span class="-7905467348819582542" onmouseenter="enter('-7905467348819582542');" onmouseout="out('-7905467348819582542');" style="">  74             return checkedAdd(request.getEndMs(), request.getBackoffOffset());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  75         }                                                                                                </span>
<span  style="">  76                                                                                                          </span>
<span class="2658461420075954163" onmouseenter="enter('2658461420075954163');" onmouseout="out('2658461420075954163');" style="">  77         public static long getAverageDelayMs(JobRequest request) {                                       </span>
<span class="5188333912507681776" onmouseenter="enter('5188333912507681776');" onmouseout="out('5188333912507681776');" style="">  78             return checkedAdd(getStartMs(request), (getEndMs(request) - getStartMs(request)) / 2);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  79         }                                                                                                </span>
<span  style="">  80                                                                                                          </span>
<span class="-8453711403554538500" onmouseenter="enter('-8453711403554538500');" onmouseout="out('-8453711403554538500');" style="">  81         public static long getStartMsSupportFlex(JobRequest request) {                                   </span>
<span class="4867134151855536256" onmouseenter="enter('4867134151855536256');" onmouseout="out('4867134151855536256');" style="">  82             return Math.max(1, request.getIntervalMs() - request.getFlexMs());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  83         }                                                                                                </span>
<span  style="">  84                                                                                                          </span>
<span class="2402850512558550424" onmouseenter="enter('2402850512558550424');" onmouseout="out('2402850512558550424');" style="">  85         public static long getEndMsSupportFlex(JobRequest request) {                                     </span>
<span class="1818143853198758132" onmouseenter="enter('1818143853198758132');" onmouseout="out('1818143853198758132');" style="">  86             return request.getIntervalMs();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  87         }                                                                                                </span>
<span  style="">  88                                                                                                          </span>
<span class="5236833657260895409" onmouseenter="enter('5236833657260895409');" onmouseout="out('5236833657260895409');" style="">  89         public static long getAverageDelayMsSupportFlex(JobRequest request) {                            </span>
<span class="1202002964551881523" onmouseenter="enter('1202002964551881523');" onmouseout="out('1202002964551881523');" style=""><abbr title="  90             return checkedAdd(getStartMsSupportFlex(request), (getEndMsSupportFlex(request) - getStartMsSupportFlex(request)) / 2);">  90             return checkedAdd(getStartMsSupportFlex(request), (getEndMsSupportFlex(request) - getStartMsSðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91         }                                                                                                </span>
<span  style="">  92                                                                                                          </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style="">  93         private final Context mContext;                                                                  </span>
<span  style="">  94                                                                                                          </span>
<span class="3051386596282037072" onmouseenter="enter('3051386596282037072');" onmouseout="out('3051386596282037072');" style="">  95         private final int mJobId;                                                                        </span>
<span  style="">  96                                                                                                          </span>
<span class="6179859670209082226" onmouseenter="enter('6179859670209082226');" onmouseout="out('6179859670209082226');" style="">  97         private final CatLog mCat;                                                                       </span>
<span  style="">  98                                                                                                          </span>
<span class="5239517905467210385" onmouseenter="enter('5239517905467210385');" onmouseout="out('5239517905467210385');" style="">  99         private final JobManager mJobManager;                                                            </span>
<span  style=""> 100                                                                                                          </span>
<span class="8226250815326017684" onmouseenter="enter('8226250815326017684');" onmouseout="out('8226250815326017684');" style=""> 101         public Common(@NonNull                                                                           </span>
<span class="-6745870674712476697" onmouseenter="enter('-6745870674712476697');" onmouseout="out('-6745870674712476697');" style=""> 102         Service service, int jobId) {                                                                    </span>
<span class="7913494938757178552" onmouseenter="enter('7913494938757178552');" onmouseout="out('7913494938757178552');" style=""> 103             this(service, service.getClass().getSimpleName(), jobId);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104         }                                                                                                </span>
<span  style=""> 105                                                                                                          </span>
<span class="-2942343485984948817" onmouseenter="enter('-2942343485984948817');" onmouseout="out('-2942343485984948817');" style=""> 106         /*package*/                                                                                      </span>
<span class="-1449042905942585555" onmouseenter="enter('-1449042905942585555');" onmouseout="out('-1449042905942585555');" style=""> 107         Common(@NonNull                                                                                  </span>
<span class="-2549690916314214747" onmouseenter="enter('-2549690916314214747');" onmouseout="out('-2549690916314214747');" style=""> 108         Context context, String loggingTag, int jobId) {                                                 </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 109             mContext = context;                                                                          </span>
<span class="3380959276812020408" onmouseenter="enter('3380959276812020408');" onmouseout="out('3380959276812020408');" style=""> 110             mJobId = jobId;                                                                              </span>
<span class="-630819311965639477" onmouseenter="enter('-630819311965639477');" onmouseout="out('-630819311965639477');" style=""> 111             mCat = new JobCat(loggingTag);                                                               </span>
<span class="2088134523180067307" onmouseenter="enter('2088134523180067307');" onmouseout="out('2088134523180067307');" style=""> 112             mJobManager = JobManager.create(context);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113         }                                                                                                </span>
<span  style=""> 114                                                                                                          </span>
<span class="-5511335237538855208" onmouseenter="enter('-5511335237538855208');" onmouseout="out('-5511335237538855208');" style=""> 115         public JobRequest getPendingRequest(boolean cleanUpOrphanedJob) {                                </span>
<span class="-1539078468410613703" onmouseenter="enter('-1539078468410613703');" onmouseout="out('-1539078468410613703');" style=""> 116             // order is important for logging purposes                                                   </span>
<span class="6754931577315038874" onmouseenter="enter('6754931577315038874');" onmouseout="out('6754931577315038874');" style=""> 117             JobRequest request = mJobManager.getJobRequest(mJobId, true);                                </span>
<span class="-4807858926389575759" onmouseenter="enter('-4807858926389575759');" onmouseout="out('-4807858926389575759');" style=""> 118             Job job = mJobManager.getJob(mJobId);                                                        </span>
<span class="5941467937120979310" onmouseenter="enter('5941467937120979310');" onmouseout="out('5941467937120979310');" style=""> 119             boolean periodic = (request != null) &amp;&amp; request.isPeriodic();                                </span>
<span class="2156808502362659130" onmouseenter="enter('2156808502362659130');" onmouseout="out('2156808502362659130');" style=""> 120             if ((job != null) &amp;&amp; (!job.isFinished())) {                                                  </span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style=""><abbr title=" 121                 // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 121                 // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduleðŸ”µ</abbr></span>
<span class="-5462975656818636592" onmouseenter="enter('-5462975656818636592');" onmouseout="out('-5462975656818636592');" style=""> 122                 mCat.d(&quot;Job %d is already running, %s&quot;, mJobId, request);                                </span>
<span class="-8865814855968501379" onmouseenter="enter('-8865814855968501379');" onmouseout="out('-8865814855968501379');" style=""> 123                 // not necessary to clean up, the running instance will do that                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 124                 return null;                                                                             </span>
<span class="7238865033192171952" onmouseenter="enter('7238865033192171952');" onmouseout="out('7238865033192171952');" style=""> 125             } else if ((job != null) &amp;&amp; (!periodic)) {                                                   </span>
<span class="599327769680236656" onmouseenter="enter('599327769680236656');" onmouseout="out('599327769680236656');" style=""> 126                 mCat.d(&quot;Job %d already finished, %s&quot;, mJobId, request);                                  </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style=""> 127                 cleanUpOrphanedJob(cleanUpOrphanedJob);                                                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 128                 return null;                                                                             </span>
<span class="-1536904387314809707" onmouseenter="enter('-1536904387314809707');" onmouseout="out('-1536904387314809707');" style=""><abbr title=" 129             } else if ((job != null) &amp;&amp; ((System.currentTimeMillis() - job.getFinishedTimeStamp()) &lt; (JobRequest.getMinInterval() / 2))) {"> 129             } else if ((job != null) &amp;&amp; ((System.currentTimeMillis() - job.getFinishedTimeStamp()) &lt; (JobðŸ”µ</abbr></span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style=""><abbr title=" 130                 // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 130                 // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduleðŸ”µ</abbr></span>
<span class="-2963240540698415567" onmouseenter="enter('-2963240540698415567');" onmouseout="out('-2963240540698415567');" style=""> 131                 mCat.d(&quot;Job %d is periodic and just finished, %s&quot;, mJobId, request);                     </span>
<span class="5118828189189336116" onmouseenter="enter('5118828189189336116');" onmouseout="out('5118828189189336116');" style=""> 132                 // don&#x27;t clean up, periodic job                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 133                 return null;                                                                             </span>
<span class="6970891164962603316" onmouseenter="enter('6970891164962603316');" onmouseout="out('6970891164962603316');" style=""> 134             } else if ((request != null) &amp;&amp; request.isTransient()) {                                     </span>
<span class="4384727207576607146" onmouseenter="enter('4384727207576607146');" onmouseout="out('4384727207576607146');" style=""> 135                 mCat.d(&quot;Request %d is transient, %s&quot;, mJobId, request);                                  </span>
<span class="5877082491190597240" onmouseenter="enter('5877082491190597240');" onmouseout="out('5877082491190597240');" style=""> 136                 // not necessary to clean up, the JobManager will do this for transient jobs             </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 137                 return null;                                                                             </span>
<span class="-4428555773566380837" onmouseenter="enter('-4428555773566380837');" onmouseout="out('-4428555773566380837');" style=""> 138             } else if (request == null) {                                                                </span>
<span class="7609103357697598215" onmouseenter="enter('7609103357697598215');" onmouseout="out('7609103357697598215');" style=""> 139                 mCat.d(&quot;Request for ID %d was null&quot;, mJobId);                                            </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style=""> 140                 cleanUpOrphanedJob(cleanUpOrphanedJob);                                                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 141                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142             }                                                                                            </span>
<span class="-1057636993633179522" onmouseenter="enter('-1057636993633179522');" onmouseout="out('-1057636993633179522');" style=""> 143             return request;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144         }                                                                                                </span>
<span  style=""> 145                                                                                                          </span>
<span class="5154748246392482767" onmouseenter="enter('5154748246392482767');" onmouseout="out('5154748246392482767');" style=""> 146         @NonNull                                                                                         </span>
<span class="-2557260734306891674" onmouseenter="enter('-2557260734306891674');" onmouseout="out('-2557260734306891674');" style=""> 147         public Job.Result executeJobRequest(@NonNull                                                     </span>
<span class="3209093281142716612" onmouseenter="enter('3209093281142716612');" onmouseout="out('3209093281142716612');" style=""> 148         JobRequest request) {                                                                            </span>
<span class="8785519441075077783" onmouseenter="enter('8785519441075077783');" onmouseout="out('8785519441075077783');" style=""> 149             long waited = System.currentTimeMillis() - request.getScheduledAt();                         </span>
<span class="-521988911558271196" onmouseenter="enter('-521988911558271196');" onmouseout="out('-521988911558271196');" style=""> 150             String timeWindow;                                                                           </span>
<span class="-4749167882947985624" onmouseenter="enter('-4749167882947985624');" onmouseout="out('-4749167882947985624');" style=""> 151             if (request.isPeriodic()) {                                                                  </span>
<span class="-4529385517217469077" onmouseenter="enter('-4529385517217469077');" onmouseout="out('-4529385517217469077');" style=""><abbr title=" 152                 timeWindow = String.format(Locale.US, &quot;interval %s, flex %s&quot;, JobUtil.timeToString(request.getIntervalMs()), JobUtil.timeToString(request.getFlexMs()));"> 152                 timeWindow = String.format(Locale.US, &quot;interval %s, flex %s&quot;, JobUtil.timeToString(requesðŸ”µ</abbr></span>
<span class="4779514256224206313" onmouseenter="enter('4779514256224206313');" onmouseout="out('4779514256224206313');" style=""> 153             } else if (request.getJobApi().supportsExecutionWindow()) {                                  </span>
<span class="-3666957316142863099" onmouseenter="enter('-3666957316142863099');" onmouseout="out('-3666957316142863099');" style=""><abbr title=" 154                 timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMs(request)), JobUtil.timeToString(getEndMs(request)));"> 154                 timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMsðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 155             } else {                                                                                     </span>
<span class="-1520611369215068334" onmouseenter="enter('-1520611369215068334');" onmouseout="out('-1520611369215068334');" style=""> 156                 timeWindow = &quot;delay &quot; + JobUtil.timeToString(getAverageDelayMs(request));                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157             }                                                                                            </span>
<span class="-8808967967811702611" onmouseenter="enter('-8808967967811702611');" onmouseout="out('-8808967967811702611');" style=""> 158             if (Looper.myLooper() == Looper.getMainLooper()) {                                           </span>
<span class="-1368751502622418275" onmouseenter="enter('-1368751502622418275');" onmouseout="out('-1368751502622418275');" style=""><abbr title=" 159                 mCat.w(&quot;Running JobRequest on a main thread, this could cause stutter or ANR in your app.&quot;);"> 159                 mCat.w(&quot;Running JobRequest on a main thread, this could cause stutter or ANR in your app.ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160             }                                                                                            </span>
<span class="-1843046913616870974" onmouseenter="enter('-1843046913616870974');" onmouseout="out('-1843046913616870974');" style=""> 161             mCat.d(&quot;Run job, %s, waited %s, %s&quot;, request, JobUtil.timeToString(waited), timeWindow);     </span>
<span class="-4828048199353050218" onmouseenter="enter('-4828048199353050218');" onmouseout="out('-4828048199353050218');" style=""> 162             JobExecutor jobExecutor = mJobManager.getJobExecutor();                                      </span>
<span class="-1235692988875235782" onmouseenter="enter('-1235692988875235782');" onmouseout="out('-1235692988875235782');" style=""> 163             Job job = null;                                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 164             try {                                                                                        </span>
<span class="-9073677935190895883" onmouseenter="enter('-9073677935190895883');" onmouseout="out('-9073677935190895883');" style=""><abbr title=" 165                 // create job first before setting it transient, avoids a race condition while rescheduling jobs"> 165                 // create job first before setting it transient, avoids a race condition while rescheduliðŸ”µ</abbr></span>
<span class="1625132338136195706" onmouseenter="enter('1625132338136195706');" onmouseout="out('1625132338136195706');" style=""> 166                 job = mJobManager.getJobCreatorHolder().createJob(request.getTag());                     </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 167                 if (!request.isPeriodic()) {                                                             </span>
<span class="3122394794119912241" onmouseenter="enter('3122394794119912241');" onmouseout="out('3122394794119912241');" style=""> 168                     request.setTransient(true);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169                 }                                                                                        </span>
<span class="-2797125910631995922" onmouseenter="enter('-2797125910631995922');" onmouseout="out('-2797125910631995922');" style=""> 170                 Future&lt;Job.Result&gt; future = jobExecutor.execute(mContext, request, job);                 </span>
<span class="-4410702629486134619" onmouseenter="enter('-4410702629486134619');" onmouseout="out('-4410702629486134619');" style=""> 171                 if (future == null) {                                                                    </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 172                     return Job.Result.FAILURE;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173                 }                                                                                        </span>
<span class="5244342940061655384" onmouseenter="enter('5244342940061655384');" onmouseout="out('5244342940061655384');" style=""> 174                 // wait until done                                                                       </span>
<span class="-4728317628971455727" onmouseenter="enter('-4728317628971455727');" onmouseout="out('-4728317628971455727');" style=""> 175                 Job.Result result = future.get();                                                        </span>
<span class="368857225067072174" onmouseenter="enter('368857225067072174');" onmouseout="out('368857225067072174');" style=""> 176                 mCat.d(&quot;Finished job, %s %s&quot;, request, result);                                          </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 177                 return result;                                                                           </span>
<span class="1408709784185360224" onmouseenter="enter('1408709784185360224');" onmouseout="out('1408709784185360224');" style=""> 178             } catch (java.lang.InterruptedException | ExecutionException e) {                            </span>
<span class="-1683580236663429788" onmouseenter="enter('-1683580236663429788');" onmouseout="out('-1683580236663429788');" style=""> 179                 mCat.e(e);                                                                               </span>
<span class="6519543964694909858" onmouseenter="enter('6519543964694909858');" onmouseout="out('6519543964694909858');" style=""> 180                 if (job != null) {                                                                       </span>
<span class="-9041905225007822866" onmouseenter="enter('-9041905225007822866');" onmouseout="out('-9041905225007822866');" style=""> 181                     job.cancel();                                                                        </span>
<span class="3580809215980372017" onmouseenter="enter('3580809215980372017');" onmouseout="out('3580809215980372017');" style=""> 182                     mCat.e(&quot;Canceled %s&quot;, request);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183                 }                                                                                        </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 184                 return Job.Result.FAILURE;                                                               </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 185             } finally {                                                                                  </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 186                 if (!request.isPeriodic()) {                                                             </span>
<span class="1449747436325478708" onmouseenter="enter('1449747436325478708');" onmouseout="out('1449747436325478708');" style=""> 187                     mJobManager.getJobStorage().remove(request);                                         </span>
<span class="-2333237089390189385" onmouseenter="enter('-2333237089390189385');" onmouseout="out('-2333237089390189385');" style=""> 188                 } else if (request.isFlexSupport()) {                                                    </span>
<span class="2778742918241741027" onmouseenter="enter('2778742918241741027');" onmouseout="out('2778742918241741027');" style=""><abbr title=" 189                     mJobManager.getJobStorage().remove(request);// remove, we store the new job in JobManager.schedule()"> 189                     mJobManager.getJobStorage().remove(request);// remove, we store the new job in JobManðŸ”µ</abbr></span>
<span  style=""> 190                                                                                                          </span>
<span class="2102053740633122535" onmouseenter="enter('2102053740633122535');" onmouseout="out('2102053740633122535');" style=""> 191                     request.reschedule(false, false);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194         }                                                                                                </span>
<span  style=""> 195                                                                                                          </span>
<span class="-3194552414098127961" onmouseenter="enter('-3194552414098127961');" onmouseout="out('-3194552414098127961');" style=""> 196         private void cleanUpOrphanedJob(boolean cleanUp) {                                               </span>
<span class="8101282554241671494" onmouseenter="enter('8101282554241671494');" onmouseout="out('8101282554241671494');" style=""> 197             if (cleanUp) {                                                                               </span>
<span class="6651175145696850096" onmouseenter="enter('6651175145696850096');" onmouseout="out('6651175145696850096');" style=""> 198                 cleanUpOrphanedJob(mContext, mJobId);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200         }                                                                                                </span>
<span  style=""> 201                                                                                                          </span>
<span class="3574082725044615574" onmouseenter="enter('3574082725044615574');" onmouseout="out('3574082725044615574');" style=""> 202         public static void cleanUpOrphanedJob(Context context, int jobId) {                              </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 203             /*                                                                                           </span>
<span class="4873467377157825728" onmouseenter="enter('4873467377157825728');" onmouseout="out('4873467377157825728');" style=""><abbr title=" 204              * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are still around."> 204              * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are stðŸ”µ</abbr></span>
<span class="7880315656890986822" onmouseenter="enter('7880315656890986822');" onmouseout="out('7880315656890986822');" style=""><abbr title=" 205              * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the old one. Here"> 205              * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the oldðŸ”µ</abbr></span>
<span class="7642695698821586509" onmouseenter="enter('7642695698821586509');" onmouseout="out('7642695698821586509');" style=""> 206              * we make sure, that no job is left in the system.                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 207              */                                                                                          </span>
<span class="-1280302924927314158" onmouseenter="enter('-1280302924927314158');" onmouseout="out('-1280302924927314158');" style=""> 208             for (JobApi jobApi : JobApi.values()) {                                                      </span>
<span class="-5474372138432799739" onmouseenter="enter('-5474372138432799739');" onmouseout="out('-5474372138432799739');" style=""> 209                 if (jobApi.isSupported(context)) {                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 210                     try {                                                                                </span>
<span class="-5924449239106429276" onmouseenter="enter('-5924449239106429276');" onmouseout="out('-5924449239106429276');" style=""> 211                         jobApi.getCachedProxy(context).cancel(jobId);                                    </span>
<span class="2168304593065879823" onmouseenter="enter('2168304593065879823');" onmouseout="out('2168304593065879823');" style=""> 212                     } catch (java.lang.Exception ignored) {                                              </span>
<span class="-571140832119819901" onmouseenter="enter('-571140832119819901');" onmouseout="out('-571140832119819901');" style=""><abbr title=" 213                         // GCM API could crash if it&#x27;s disabled, ignore crashes at this point and continue"> 213                         // GCM API could crash if it&#x27;s disabled, ignore crashes at this point and continuðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219 }                                                                                                        </span>













































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-8822900351790619766" onmouseenter="enter('-8822900351790619766');" onmouseout="out('-8822900351790619766');" style="">   2   * Copyright 2007-present Evernote Corporation.                                                                   </span>
<span class="-2278367542838177584" onmouseenter="enter('-2278367542838177584');" onmouseout="out('-2278367542838177584');" style="">   3   * All rights reserved.                                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   4   *                                                                                                                </span>
<span class="181301442133285836" onmouseenter="enter('181301442133285836');" onmouseout="out('181301442133285836');" style="">   5   * Redistribution and use in source and binary forms, with or without modification,                               </span>
<span class="-5073197948967426970" onmouseenter="enter('-5073197948967426970');" onmouseout="out('-5073197948967426970');" style="">   6   * are permitted provided that the following conditions are met:                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="8127251449117563942" onmouseenter="enter('8127251449117563942');" onmouseout="out('8127251449117563942');" style="">   8   * 1. Redistributions of source code must retain the above copyright notice, this                                 </span>
<span class="-1473911044945790828" onmouseenter="enter('-1473911044945790828');" onmouseout="out('-1473911044945790828');" style="">   9   *    list of conditions and the following disclaimer.                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  10   *                                                                                                                </span>
<span class="4835137028529553232" onmouseenter="enter('4835137028529553232');" onmouseout="out('4835137028529553232');" style="">  11   * 2. Redistributions in binary form must reproduce the above copyright notice,                                   </span>
<span class="-1312443230807442131" onmouseenter="enter('-1312443230807442131');" onmouseout="out('-1312443230807442131');" style="">  12   *    this list of conditions and the following disclaimer in the documentation                                   </span>
<span class="-2067912076149043179" onmouseenter="enter('-2067912076149043179');" onmouseout="out('-2067912076149043179');" style="">  13   *    and/or other materials provided with the distribution.                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  14   *                                                                                                                </span>
<span class="-7721941782677048447" onmouseenter="enter('-7721941782677048447');" onmouseout="out('-7721941782677048447');" style="">  15   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND                                </span>
<span class="-5124048439450882348" onmouseenter="enter('-5124048439450882348');" onmouseout="out('-5124048439450882348');" style="">  16   * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED                                  </span>
<span class="2277289959795125050" onmouseenter="enter('2277289959795125050');" onmouseout="out('2277289959795125050');" style="">  17   * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.                             </span>
<span class="4422846307625339339" onmouseenter="enter('4422846307625339339');" onmouseout="out('4422846307625339339');" style="">  18   * IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,                                </span>
<span class="9023453646714579255" onmouseenter="enter('9023453646714579255');" onmouseout="out('9023453646714579255');" style="">  19   * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,                                 </span>
<span class="2153827234735713132" onmouseenter="enter('2153827234735713132');" onmouseout="out('2153827234735713132');" style="">  20   * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,                                  </span>
<span class="5782830561991082866" onmouseenter="enter('5782830561991082866');" onmouseout="out('5782830561991082866');" style="">  21   * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF                                </span>
<span class="-2513683953102966204" onmouseenter="enter('-2513683953102966204');" onmouseout="out('-2513683953102966204');" style="">  22   * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE                                </span>
<span class="-6562574984275957691" onmouseenter="enter('-6562574984275957691');" onmouseout="out('-6562574984275957691');" style="">  23   * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF                                      </span>
<span class="505998933154990042" onmouseenter="enter('505998933154990042');" onmouseout="out('505998933154990042');" style="">  24   * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  25   */                                                                                                               </span>
<span class="4675552543740820910" onmouseenter="enter('4675552543740820910');" onmouseout="out('4675552543740820910');" style="">  26  package com.evernote.android.job;                                                                                 </span>
<span  style="">  27                                                                                                                    </span>
<span class="-1261404242645970098" onmouseenter="enter('-1261404242645970098');" onmouseout="out('-1261404242645970098');" style="">  28  import android.app.Service;                                                                                       </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  29  import android.content.Context;                                                                                   </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="">  30  import android.os.Looper;                                                                                         </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  31  import android.support.annotation.NonNull;                                                                        </span>
<span  style="">  32                                                                                                                    </span>
<span class="-2629940017315809162" onmouseenter="enter('-2629940017315809162');" onmouseout="out('-2629940017315809162');" style="">  33  import com.evernote.android.job.util.JobApi;                                                                      </span>
<span class="-5245147800812157155" onmouseenter="enter('-5245147800812157155');" onmouseout="out('-5245147800812157155');" style="">  34  import com.evernote.android.job.util.JobCat;                                                                      </span>
<span class="2270421051523495577" onmouseenter="enter('2270421051523495577');" onmouseout="out('2270421051523495577');" style="">  35  import com.evernote.android.job.util.JobUtil;                                                                     </span>
<span  style="">  36                                                                                                                    </span>
<span class="4887698622156748971" onmouseenter="enter('4887698622156748971');" onmouseout="out('4887698622156748971');" style="">  37  import net.vrallev.android.cat.CatLog;                                                                            </span>
<span  style="">  38                                                                                                                    </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="">  39  import java.util.Locale;                                                                                          </span>
<span class="6613496282884511495" onmouseenter="enter('6613496282884511495');" onmouseout="out('6613496282884511495');" style="">  40  import java.util.concurrent.ExecutionException;                                                                   </span>
<span class="-331778695229620376" onmouseenter="enter('-331778695229620376');" onmouseout="out('-331778695229620376');" style="">  41  import java.util.concurrent.Future;                                                                               </span>
<span  style="">  42                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  43  /**                                                                                                               </span>
<span class="-126646863796949621" onmouseenter="enter('-126646863796949621');" onmouseout="out('-126646863796949621');" style="">  44   * A proxy for each {@link JobApi}.                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  45   *                                                                                                                </span>
<span class="-2541210092808878866" onmouseenter="enter('-2541210092808878866');" onmouseout="out('-2541210092808878866');" style="">  46   * @author rwondratschek                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  47   */                                                                                                               </span>
<span class="1140466455373644171" onmouseenter="enter('1140466455373644171');" onmouseout="out('1140466455373644171');" style="">  48  public interface JobProxy {                                                                                       </span>
<span  style="">  49                                                                                                                    </span>
<span class="-8144897713900189970" onmouseenter="enter('-8144897713900189970');" onmouseout="out('-8144897713900189970');" style="">  50      void plantOneOff(JobRequest request);                                                                         </span>
<span  style="">  51                                                                                                                    </span>
<span class="-2416890449051145953" onmouseenter="enter('-2416890449051145953');" onmouseout="out('-2416890449051145953');" style="">  52      void plantPeriodic(JobRequest request);                                                                       </span>
<span  style="">  53                                                                                                                    </span>
<span class="6309911337945331379" onmouseenter="enter('6309911337945331379');" onmouseout="out('6309911337945331379');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  54 +    void plantPeriodicFlexSupport(JobRequest request);                                                            </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  55 +                                                                                                                  </span>
<span class="8340124833639515371" onmouseenter="enter('8340124833639515371');" onmouseout="out('8340124833639515371');" style="">  56      void cancel(int jobId);                                                                                       </span>
<span  style="">  57                                                                                                                    </span>
<span class="-6161809553933645851" onmouseenter="enter('-6161809553933645851');" onmouseout="out('-6161809553933645851');" style="">  58      boolean isPlatformJobScheduled(JobRequest request);                                                           </span>
<span  style="">  59                                                                                                                    </span>
<span class="1769639894748899311" onmouseenter="enter('1769639894748899311');" onmouseout="out('1769639894748899311');" style="">  60      /*package*/ final class Common {                                                                              </span>
<span  style="">  61                                                                                                                    </span>
<span class="8412616957402907467" onmouseenter="enter('8412616957402907467');" onmouseout="out('8412616957402907467');" style=""><abbr title="  62          // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/math/LongMath.java">  62          // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/math/LongMathðŸ”µ</abbr></span>
<span class="-1572685421845796133" onmouseenter="enter('-1572685421845796133');" onmouseout="out('-1572685421845796133');" style="">  63          private static long checkedAdd(long a, long b) {                                                          </span>
<span class="-1527942472133998342" onmouseenter="enter('-1527942472133998342');" onmouseout="out('-1527942472133998342');" style="">  64              long result = a + b;                                                                                  </span>
<span class="-8281399218677613001" onmouseenter="enter('-8281399218677613001');" onmouseout="out('-8281399218677613001');" style="">  65              return checkNoOverflow(result, (a ^ b) &lt; 0 | (a ^ result) &gt;= 0);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  66          }                                                                                                         </span>
<span  style="">  67                                                                                                                    </span>
<span class="6423040751114649745" onmouseenter="enter('6423040751114649745');" onmouseout="out('6423040751114649745');" style="">  68          private static long checkNoOverflow(long result, boolean condition) {                                     </span>
<span class="6603368327369456734" onmouseenter="enter('6603368327369456734');" onmouseout="out('6603368327369456734');" style="">  69              return condition ? result : Long.MAX_VALUE;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70          }                                                                                                         </span>
<span  style="">  71                                                                                                                    </span>
<span class="1406832824568924523" onmouseenter="enter('1406832824568924523');" onmouseout="out('1406832824568924523');" style="">  72          public static long getStartMs(JobRequest request) {                                                       </span>
<span class="226786102758733848" onmouseenter="enter('226786102758733848');" onmouseout="out('226786102758733848');" style="">  73              return checkedAdd(request.getStartMs(), request.getBackoffOffset());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  74          }                                                                                                         </span>
<span  style="">  75                                                                                                                    </span>
<span class="-3832824197988283345" onmouseenter="enter('-3832824197988283345');" onmouseout="out('-3832824197988283345');" style="">  76          public static long getEndMs(JobRequest request) {                                                         </span>
<span class="-7905467348819582542" onmouseenter="enter('-7905467348819582542');" onmouseout="out('-7905467348819582542');" style="">  77              return checkedAdd(request.getEndMs(), request.getBackoffOffset());                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78          }                                                                                                         </span>
<span  style="">  79                                                                                                                    </span>
<span class="2658461420075954163" onmouseenter="enter('2658461420075954163');" onmouseout="out('2658461420075954163');" style="">  80          public static long getAverageDelayMs(JobRequest request) {                                                </span>
<span class="5188333912507681776" onmouseenter="enter('5188333912507681776');" onmouseout="out('5188333912507681776');" style="">  81              return checkedAdd(getStartMs(request), (getEndMs(request) - getStartMs(request)) / 2);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  82 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  83 +                                                                                                                  </span>
<span class="-8453711403554538500" onmouseenter="enter('-8453711403554538500');" onmouseout="out('-8453711403554538500');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  84 +        public static long getStartMsSupportFlex(JobRequest request) {                                            </span>
<span class="4867134151855536256" onmouseenter="enter('4867134151855536256');" onmouseout="out('4867134151855536256');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  85 +            return Math.max(1, request.getIntervalMs() - request.getFlexMs());                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  86 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  87 +                                                                                                                  </span>
<span class="2402850512558550424" onmouseenter="enter('2402850512558550424');" onmouseout="out('2402850512558550424');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  88 +        public static long getEndMsSupportFlex(JobRequest request) {                                              </span>
<span class="1818143853198758132" onmouseenter="enter('1818143853198758132');" onmouseout="out('1818143853198758132');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  89 +            return request.getIntervalMs();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  90 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  91 +                                                                                                                  </span>
<span class="5236833657260895409" onmouseenter="enter('5236833657260895409');" onmouseout="out('5236833657260895409');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  92 +        public static long getAverageDelayMsSupportFlex(JobRequest request) {                                     </span>
<span class="1202002964551881523" onmouseenter="enter('1202002964551881523');" onmouseout="out('1202002964551881523');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title="  93 +            return checkedAdd(getStartMsSupportFlex(request), (getEndMsSupportFlex(request) - getStartMsSupportFlex(request)) / 2);">  93 +            return checkedAdd(getStartMsSupportFlex(request), (getEndMsSupportFlex(request) - getStartMsSupportFleðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  94          }                                                                                                         </span>
<span  style="">  95                                                                                                                    </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style="">  96          private final Context mContext;                                                                           </span>
<span class="3051386596282037072" onmouseenter="enter('3051386596282037072');" onmouseout="out('3051386596282037072');" style="">  97          private final int mJobId;                                                                                 </span>
<span class="6179859670209082226" onmouseenter="enter('6179859670209082226');" onmouseout="out('6179859670209082226');" style="">  98          private final CatLog mCat;                                                                                </span>
<span  style="">  99                                                                                                                    </span>
<span class="5239517905467210385" onmouseenter="enter('5239517905467210385');" onmouseout="out('5239517905467210385');" style=""> 100          private final JobManager mJobManager;                                                                     </span>
<span  style=""> 101                                                                                                                    </span>
<span class="9207186923120198843" onmouseenter="enter('9207186923120198843');" onmouseout="out('9207186923120198843');" style=""> 102          public Common(Service service, int jobId) {                                                               </span>
<span class="-3030977859657206756" onmouseenter="enter('-3030977859657206756');" onmouseout="out('-3030977859657206756');" style=""> 103              mContext = service;                                                                                   </span>






<span class="3380959276812020408" onmouseenter="enter('3380959276812020408');" onmouseout="out('3380959276812020408');" style=""> 104              mJobId = jobId;                                                                                       </span>
<span class="67268752679343694" onmouseenter="enter('67268752679343694');" onmouseout="out('67268752679343694');" style=""> 105              mCat = new JobCat(service.getClass());                                                                </span>
<span  style=""> 106                                                                                                                    </span>
<span class="819678989109847509" onmouseenter="enter('819678989109847509');" onmouseout="out('819678989109847509');" style=""> 107              mJobManager = JobManager.create(service);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108          }                                                                                                         </span>
<span  style=""> 109                                                                                                                    </span>
<span class="697901881928484759" onmouseenter="enter('697901881928484759');" onmouseout="out('697901881928484759');" style=""> 110          public JobRequest getPendingRequest() {                                                                   </span>






<span class="-1539078468410613703" onmouseenter="enter('-1539078468410613703');" onmouseout="out('-1539078468410613703');" style=""> 111              // order is important for logging purposes                                                            </span>
<span class="6754931577315038874" onmouseenter="enter('6754931577315038874');" onmouseout="out('6754931577315038874');" style=""> 112              JobRequest request = mJobManager.getJobRequest(mJobId, true);                                         </span>
<span class="-4807858926389575759" onmouseenter="enter('-4807858926389575759');" onmouseout="out('-4807858926389575759');" style=""> 113              Job job = mJobManager.getJob(mJobId);                                                                 </span>
<span class="80157358755741526" onmouseenter="enter('80157358755741526');" onmouseout="out('80157358755741526');" style=""> 114              boolean periodic = request != null &amp;&amp; request.isPeriodic();                                           </span>
<span  style=""> 115                                                                                                                    </span>
<span class="1317679291661326604" onmouseenter="enter('1317679291661326604');" onmouseout="out('1317679291661326604');" style=""> 116              if (job != null &amp;&amp; !job.isFinished()) {                                                               </span>

<span class="-5462975656818636592" onmouseenter="enter('-5462975656818636592');" onmouseout="out('-5462975656818636592');" style=""> 117                  mCat.d(&quot;Job %d is already running, %s&quot;, mJobId, request);                                         </span>

<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 118                  return null;                                                                                      </span>
<span  style=""> 119                                                                                                                    </span>
<span class="-4007651353712364444" onmouseenter="enter('-4007651353712364444');" onmouseout="out('-4007651353712364444');" style=""> 120              } else if (job != null &amp;&amp; !periodic) {                                                                </span>
<span class="599327769680236656" onmouseenter="enter('599327769680236656');" onmouseout="out('599327769680236656');" style=""> 121                  mCat.d(&quot;Job %d already finished, %s&quot;, mJobId, request);                                           </span>

<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 122                  return null;                                                                                      </span>
<span  style=""> 123                                                                                                                    </span>
<span class="-4441559070839346687" onmouseenter="enter('-4441559070839346687');" onmouseout="out('-4441559070839346687');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 124 -            } else if (job != null &amp;&amp; System.currentTimeMillis() - job.getFinishedTimeStamp() &lt; 2_000) {          </span>
<span class="-6422008231677608128" onmouseenter="enter('-6422008231677608128');" onmouseout="out('-6422008231677608128');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 125 +            } else if (job != null &amp;&amp; System.currentTimeMillis() - job.getFinishedTimeStamp() &lt; JobRequest.getMinInterval() / 2) {"> 125 +            } else if (job != null &amp;&amp; System.currentTimeMillis() - job.getFinishedTimeStamp() &lt; JobRequest.getMinIðŸ”µ</abbr></span>
<span class="-2963240540698415567" onmouseenter="enter('-2963240540698415567');" onmouseout="out('-2963240540698415567');" style=""> 126                  mCat.d(&quot;Job %d is periodic and just finished, %s&quot;, mJobId, request);                              </span>

<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 127                  return null;                                                                                      </span>
<span  style=""> 128                                                                                                                    </span>
<span class="-6449094046803794181" onmouseenter="enter('-6449094046803794181');" onmouseout="out('-6449094046803794181');" style=""> 129              } else if (request != null &amp;&amp; request.isTransient()) {                                                </span>
<span class="4384727207576607146" onmouseenter="enter('4384727207576607146');" onmouseout="out('4384727207576607146');" style=""> 130                  mCat.d(&quot;Request %d is transient, %s&quot;, mJobId, request);                                           </span>

<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 131                  return null;                                                                                      </span>
<span  style=""> 132                                                                                                                    </span>
<span class="-4428555773566380837" onmouseenter="enter('-4428555773566380837');" onmouseout="out('-4428555773566380837');" style=""> 133              } else if (request == null) {                                                                         </span>
<span class="7609103357697598215" onmouseenter="enter('7609103357697598215');" onmouseout="out('7609103357697598215');" style=""> 134                  mCat.d(&quot;Request for ID %d was null&quot;, mJobId);                                                     </span>

<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 135                  return null;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136              }                                                                                                     </span>
<span  style=""> 137                                                                                                                    </span>
<span class="-1057636993633179522" onmouseenter="enter('-1057636993633179522');" onmouseout="out('-1057636993633179522');" style=""> 138              return request;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139          }                                                                                                         </span>
<span  style=""> 140                                                                                                                    </span>
<span class="5154748246392482767" onmouseenter="enter('5154748246392482767');" onmouseout="out('5154748246392482767');" style=""> 141          @NonNull                                                                                                  </span>
<span class="1474434811491937762" onmouseenter="enter('1474434811491937762');" onmouseout="out('1474434811491937762');" style=""> 142          public Job.Result executeJobRequest(@NonNull JobRequest request) {                                        </span>
<span class="8785519441075077783" onmouseenter="enter('8785519441075077783');" onmouseout="out('8785519441075077783');" style=""> 143              long waited = System.currentTimeMillis() - request.getScheduledAt();                                  </span>
<span class="-521988911558271196" onmouseenter="enter('-521988911558271196');" onmouseout="out('-521988911558271196');" style=""> 144              String timeWindow;                                                                                    </span>
<span class="-4749167882947985624" onmouseenter="enter('-4749167882947985624');" onmouseout="out('-4749167882947985624');" style=""> 145              if (request.isPeriodic()) {                                                                           </span>
<span class="-1473637266447080664" onmouseenter="enter('-1473637266447080664');" onmouseout="out('-1473637266447080664');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 146 -                timeWindow = &quot;interval &quot; + JobUtil.timeToString(request.getIntervalMs());                         </span>
<span class="7076130925826682266" onmouseenter="enter('7076130925826682266');" onmouseout="out('7076130925826682266');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 147 -            } else if (JobApi.V_14.equals(request.getJobApi())) {                                                 </span>
<span class="-1520611369215068334" onmouseenter="enter('-1520611369215068334');" onmouseout="out('-1520611369215068334');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 148 -                timeWindow = &quot;delay &quot; + JobUtil.timeToString(getAverageDelayMs(request));                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 149 -            } else {                                                                                              </span>
<span class="22254303833830880" onmouseenter="enter('22254303833830880');" onmouseout="out('22254303833830880');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 150 +                timeWindow = String.format(Locale.US, &quot;interval %s, flex %s&quot;, JobUtil.timeToString(request.getIntervalMs()),"> 150 +                timeWindow = String.format(Locale.US, &quot;interval %s, flex %s&quot;, JobUtil.timeToString(request.getInteðŸ”µ</abbr></span>
<span class="-7441385486773924310" onmouseenter="enter('-7441385486773924310');" onmouseout="out('-7441385486773924310');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +                        JobUtil.timeToString(request.getFlexMs()));                                               </span>
<span class="4779514256224206313" onmouseenter="enter('4779514256224206313');" onmouseout="out('4779514256224206313');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +            } else if (request.getJobApi().supportsExecutionWindow()) {                                           </span>
<span class="-6246254348184491385" onmouseenter="enter('-6246254348184491385');" onmouseout="out('-6246254348184491385');" style=""><abbr title=" 153                  timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMs(request)),"> 153                  timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMs(request)ðŸ”µ</abbr></span>
<span class="6965396589660564452" onmouseenter="enter('6965396589660564452');" onmouseout="out('6965396589660564452');" style=""> 154                          JobUtil.timeToString(getEndMs(request)));                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +            } else {                                                                                              </span>
<span class="-1520611369215068334" onmouseenter="enter('-1520611369215068334');" onmouseout="out('-1520611369215068334');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 156 +                timeWindow = &quot;delay &quot; + JobUtil.timeToString(getAverageDelayMs(request));                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157              }                                                                                                     </span>
<span  style=""> 158                                                                                                                    </span>
<span class="-8808967967811702611" onmouseenter="enter('-8808967967811702611');" onmouseout="out('-8808967967811702611');" style=""> 159              if (Looper.myLooper() == Looper.getMainLooper()) {                                                    </span>
<span class="-1368751502622418275" onmouseenter="enter('-1368751502622418275');" onmouseout="out('-1368751502622418275');" style=""> 160                  mCat.w(&quot;Running JobRequest on a main thread, this could cause stutter or ANR in your app.&quot;);      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161              }                                                                                                     </span>
<span  style=""> 162                                                                                                                    </span>
<span class="-1843046913616870974" onmouseenter="enter('-1843046913616870974');" onmouseout="out('-1843046913616870974');" style=""> 163              mCat.d(&quot;Run job, %s, waited %s, %s&quot;, request, JobUtil.timeToString(waited), timeWindow);              </span>
<span class="-4828048199353050218" onmouseenter="enter('-4828048199353050218');" onmouseout="out('-4828048199353050218');" style=""> 164              JobExecutor jobExecutor = mJobManager.getJobExecutor();                                               </span>
<span class="-1235692988875235782" onmouseenter="enter('-1235692988875235782');" onmouseout="out('-1235692988875235782');" style=""> 165              Job job = null;                                                                                       </span>
<span  style=""> 166                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 167              try {                                                                                                 </span>
<span class="-9073677935190895883" onmouseenter="enter('-9073677935190895883');" onmouseout="out('-9073677935190895883');" style=""> 168                  // create job first before setting it transient, avoids a race condition while rescheduling jobs  </span>
<span class="1625132338136195706" onmouseenter="enter('1625132338136195706');" onmouseout="out('1625132338136195706');" style=""> 169                  job = mJobManager.getJobCreatorHolder().createJob(request.getTag());                              </span>
<span  style=""> 170                                                                                                                    </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 171                  if (!request.isPeriodic()) {                                                                      </span>
<span class="3122394794119912241" onmouseenter="enter('3122394794119912241');" onmouseout="out('3122394794119912241');" style=""> 172                      request.setTransient(true);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173                  }                                                                                                 </span>
<span  style=""> 174                                                                                                                    </span>
<span class="-2797125910631995922" onmouseenter="enter('-2797125910631995922');" onmouseout="out('-2797125910631995922');" style=""> 175                  Future&lt;Job.Result&gt; future = jobExecutor.execute(mContext, request, job);                          </span>
<span class="-4410702629486134619" onmouseenter="enter('-4410702629486134619');" onmouseout="out('-4410702629486134619');" style=""> 176                  if (future == null) {                                                                             </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 177                      return Job.Result.FAILURE;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178                  }                                                                                                 </span>
<span  style=""> 179                                                                                                                    </span>
<span class="5244342940061655384" onmouseenter="enter('5244342940061655384');" onmouseout="out('5244342940061655384');" style=""> 180                  // wait until done                                                                                </span>
<span class="-4728317628971455727" onmouseenter="enter('-4728317628971455727');" onmouseout="out('-4728317628971455727');" style=""> 181                  Job.Result result = future.get();                                                                 </span>
<span class="368857225067072174" onmouseenter="enter('368857225067072174');" onmouseout="out('368857225067072174');" style=""> 182                  mCat.d(&quot;Finished job, %s %s&quot;, request, result);                                                   </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 183                  return result;                                                                                    </span>
<span  style=""> 184                                                                                                                    </span>
<span class="2273166757001165010" onmouseenter="enter('2273166757001165010');" onmouseout="out('2273166757001165010');" style=""> 185              } catch (InterruptedException | ExecutionException e) {                                               </span>
<span class="-1683580236663429788" onmouseenter="enter('-1683580236663429788');" onmouseout="out('-1683580236663429788');" style=""> 186                  mCat.e(e);                                                                                        </span>
<span  style=""> 187                                                                                                                    </span>
<span class="6519543964694909858" onmouseenter="enter('6519543964694909858');" onmouseout="out('6519543964694909858');" style=""> 188                  if (job != null) {                                                                                </span>
<span class="-9041905225007822866" onmouseenter="enter('-9041905225007822866');" onmouseout="out('-9041905225007822866');" style=""> 189                      job.cancel();                                                                                 </span>
<span class="3580809215980372017" onmouseenter="enter('3580809215980372017');" onmouseout="out('3580809215980372017');" style=""> 190                      mCat.e(&quot;Canceled %s&quot;, request);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191                  }                                                                                                 </span>
<span  style=""> 192                                                                                                                    </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 193                  return Job.Result.FAILURE;                                                                        </span>
<span  style=""> 194                                                                                                                    </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 195              } finally {                                                                                           </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 196                  if (!request.isPeriodic()) {                                                                      </span>
<span class="1449747436325478708" onmouseenter="enter('1449747436325478708');" onmouseout="out('1449747436325478708');" style=""> 197                      mJobManager.getJobStorage().remove(request);                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 198 +                                                                                                                  </span>
<span class="-2333237089390189385" onmouseenter="enter('-2333237089390189385');" onmouseout="out('-2333237089390189385');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 199 +                } else if (request.isFlexSupport()) {                                                             </span>
<span class="733386345181994468" onmouseenter="enter('733386345181994468');" onmouseout="out('733386345181994468');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 200 +                    mJobManager.getJobStorage().remove(request); // remove, we store the new job in JobManager.schedule()"> 200 +                    mJobManager.getJobStorage().remove(request); // remove, we store the new job in JobManager.schðŸ”µ</abbr></span>
<span class="2102053740633122535" onmouseenter="enter('2102053740633122535');" onmouseout="out('2102053740633122535');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 201 +                    request.reschedule(false, false);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204          }                                                                                                         </span>
<span  style=""> 205                                                                                                                    </span>
<span class="-5091037902047692513" onmouseenter="enter('-5091037902047692513');" onmouseout="out('-5091037902047692513');" style=""> 206          public void cleanUpOrphanedJob() {                                                                        </span>
<span class="6651175145696850096" onmouseenter="enter('6651175145696850096');" onmouseout="out('6651175145696850096');" style=""> 207              cleanUpOrphanedJob(mContext, mJobId);                                                                 </span>




<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208          }                                                                                                         </span>
<span  style=""> 209                                                                                                                    </span>
<span class="3574082725044615574" onmouseenter="enter('3574082725044615574');" onmouseout="out('3574082725044615574');" style=""> 210          public static void cleanUpOrphanedJob(Context context, int jobId) {                                       </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 211              /*                                                                                                    </span>
<span class="4873467377157825728" onmouseenter="enter('4873467377157825728');" onmouseout="out('4873467377157825728');" style=""><abbr title=" 212               * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are still around."> 212               * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are still arounðŸ”µ</abbr></span>
<span class="7880315656890986822" onmouseenter="enter('7880315656890986822');" onmouseout="out('7880315656890986822');" style=""><abbr title=" 213               * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the old one. Here"> 213               * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the old one. HerðŸ”µ</abbr></span>
<span class="7642695698821586509" onmouseenter="enter('7642695698821586509');" onmouseout="out('7642695698821586509');" style=""> 214               * we make sure, that no job is left in the system.                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 215               */                                                                                                   </span>
<span class="-1280302924927314158" onmouseenter="enter('-1280302924927314158');" onmouseout="out('-1280302924927314158');" style=""> 216              for (JobApi jobApi : JobApi.values()) {                                                               </span>
<span class="-5474372138432799739" onmouseenter="enter('-5474372138432799739');" onmouseout="out('-5474372138432799739');" style=""> 217                  if (jobApi.isSupported(context)) {                                                                </span>
<span class="-5924449239106429276" onmouseenter="enter('-5924449239106429276');" onmouseout="out('-5924449239106429276');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 218 -                    jobApi.getCachedProxy(context).cancel(jobId);                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 219 +                    try {                                                                                         </span>
<span class="-5924449239106429276" onmouseenter="enter('-5924449239106429276');" onmouseout="out('-5924449239106429276');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 220 +                        jobApi.getCachedProxy(context).cancel(jobId);                                             </span>
<span class="8538742657781196138" onmouseenter="enter('8538742657781196138');" onmouseout="out('8538742657781196138');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +                    } catch (Exception ignored) {                                                                 </span>
<span class="-571140832119819901" onmouseenter="enter('-571140832119819901');" onmouseout="out('-571140832119819901');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 222 +                        // GCM API could crash if it&#x27;s disabled, ignore crashes at this point and continue        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +                    }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-8822900351790619766" onmouseenter="enter('-8822900351790619766');" onmouseout="out('-8822900351790619766');" style="">   2   * Copyright 2007-present Evernote Corporation.                                                                   </span>
<span class="-2278367542838177584" onmouseenter="enter('-2278367542838177584');" onmouseout="out('-2278367542838177584');" style="">   3   * All rights reserved.                                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   4   *                                                                                                                </span>
<span class="181301442133285836" onmouseenter="enter('181301442133285836');" onmouseout="out('181301442133285836');" style="">   5   * Redistribution and use in source and binary forms, with or without modification,                               </span>
<span class="-5073197948967426970" onmouseenter="enter('-5073197948967426970');" onmouseout="out('-5073197948967426970');" style="">   6   * are permitted provided that the following conditions are met:                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="8127251449117563942" onmouseenter="enter('8127251449117563942');" onmouseout="out('8127251449117563942');" style="">   8   * 1. Redistributions of source code must retain the above copyright notice, this                                 </span>
<span class="-1473911044945790828" onmouseenter="enter('-1473911044945790828');" onmouseout="out('-1473911044945790828');" style="">   9   *    list of conditions and the following disclaimer.                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  10   *                                                                                                                </span>
<span class="4835137028529553232" onmouseenter="enter('4835137028529553232');" onmouseout="out('4835137028529553232');" style="">  11   * 2. Redistributions in binary form must reproduce the above copyright notice,                                   </span>
<span class="-1312443230807442131" onmouseenter="enter('-1312443230807442131');" onmouseout="out('-1312443230807442131');" style="">  12   *    this list of conditions and the following disclaimer in the documentation                                   </span>
<span class="-2067912076149043179" onmouseenter="enter('-2067912076149043179');" onmouseout="out('-2067912076149043179');" style="">  13   *    and/or other materials provided with the distribution.                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  14   *                                                                                                                </span>
<span class="-7721941782677048447" onmouseenter="enter('-7721941782677048447');" onmouseout="out('-7721941782677048447');" style="">  15   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND                                </span>
<span class="-5124048439450882348" onmouseenter="enter('-5124048439450882348');" onmouseout="out('-5124048439450882348');" style="">  16   * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED                                  </span>
<span class="2277289959795125050" onmouseenter="enter('2277289959795125050');" onmouseout="out('2277289959795125050');" style="">  17   * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.                             </span>
<span class="4422846307625339339" onmouseenter="enter('4422846307625339339');" onmouseout="out('4422846307625339339');" style="">  18   * IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,                                </span>
<span class="9023453646714579255" onmouseenter="enter('9023453646714579255');" onmouseout="out('9023453646714579255');" style="">  19   * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,                                 </span>
<span class="2153827234735713132" onmouseenter="enter('2153827234735713132');" onmouseout="out('2153827234735713132');" style="">  20   * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,                                  </span>
<span class="5782830561991082866" onmouseenter="enter('5782830561991082866');" onmouseout="out('5782830561991082866');" style="">  21   * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF                                </span>
<span class="-2513683953102966204" onmouseenter="enter('-2513683953102966204');" onmouseout="out('-2513683953102966204');" style="">  22   * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE                                </span>
<span class="-6562574984275957691" onmouseenter="enter('-6562574984275957691');" onmouseout="out('-6562574984275957691');" style="">  23   * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF                                      </span>
<span class="505998933154990042" onmouseenter="enter('505998933154990042');" onmouseout="out('505998933154990042');" style="">  24   * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  25   */                                                                                                               </span>
<span class="4675552543740820910" onmouseenter="enter('4675552543740820910');" onmouseout="out('4675552543740820910');" style="">  26  package com.evernote.android.job;                                                                                 </span>
<span  style="">  27                                                                                                                    </span>
<span class="-1261404242645970098" onmouseenter="enter('-1261404242645970098');" onmouseout="out('-1261404242645970098');" style="">  28  import android.app.Service;                                                                                       </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  29  import android.content.Context;                                                                                   </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="">  30  import android.os.Looper;                                                                                         </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  31  import android.support.annotation.NonNull;                                                                        </span>
<span  style="">  32                                                                                                                    </span>
<span class="-2629940017315809162" onmouseenter="enter('-2629940017315809162');" onmouseout="out('-2629940017315809162');" style="">  33  import com.evernote.android.job.util.JobApi;                                                                      </span>
<span class="-5245147800812157155" onmouseenter="enter('-5245147800812157155');" onmouseout="out('-5245147800812157155');" style="">  34  import com.evernote.android.job.util.JobCat;                                                                      </span>
<span class="2270421051523495577" onmouseenter="enter('2270421051523495577');" onmouseout="out('2270421051523495577');" style="">  35  import com.evernote.android.job.util.JobUtil;                                                                     </span>
<span  style="">  36                                                                                                                    </span>
<span class="4887698622156748971" onmouseenter="enter('4887698622156748971');" onmouseout="out('4887698622156748971');" style="">  37  import net.vrallev.android.cat.CatLog;                                                                            </span>
<span  style="">  38                                                                                                                    </span>
<span class="-4563680703184802189" onmouseenter="enter('-4563680703184802189');" onmouseout="out('-4563680703184802189');" style="">  39  import java.util.Locale;                                                                                          </span>
<span class="6613496282884511495" onmouseenter="enter('6613496282884511495');" onmouseout="out('6613496282884511495');" style="">  40  import java.util.concurrent.ExecutionException;                                                                   </span>
<span class="-331778695229620376" onmouseenter="enter('-331778695229620376');" onmouseout="out('-331778695229620376');" style="">  41  import java.util.concurrent.Future;                                                                               </span>
<span  style="">  42                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  43  /**                                                                                                               </span>
<span class="-126646863796949621" onmouseenter="enter('-126646863796949621');" onmouseout="out('-126646863796949621');" style="">  44   * A proxy for each {@link JobApi}.                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  45   *                                                                                                                </span>
<span class="-2541210092808878866" onmouseenter="enter('-2541210092808878866');" onmouseout="out('-2541210092808878866');" style="">  46   * @author rwondratschek                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  47   */                                                                                                               </span>
<span class="1140466455373644171" onmouseenter="enter('1140466455373644171');" onmouseout="out('1140466455373644171');" style="">  48  public interface JobProxy {                                                                                       </span>
<span  style="">  49                                                                                                                    </span>
<span class="-8144897713900189970" onmouseenter="enter('-8144897713900189970');" onmouseout="out('-8144897713900189970');" style="">  50      void plantOneOff(JobRequest request);                                                                         </span>
<span  style="">  51                                                                                                                    </span>
<span class="-2416890449051145953" onmouseenter="enter('-2416890449051145953');" onmouseout="out('-2416890449051145953');" style="">  52      void plantPeriodic(JobRequest request);                                                                       </span>
<span  style="">  53                                                                                                                    </span>


<span class="8340124833639515371" onmouseenter="enter('8340124833639515371');" onmouseout="out('8340124833639515371');" style="">  54      void cancel(int jobId);                                                                                       </span>
<span  style="">  55                                                                                                                    </span>
<span class="-6161809553933645851" onmouseenter="enter('-6161809553933645851');" onmouseout="out('-6161809553933645851');" style="">  56      boolean isPlatformJobScheduled(JobRequest request);                                                           </span>
<span  style="">  57                                                                                                                    </span>
<span class="1769639894748899311" onmouseenter="enter('1769639894748899311');" onmouseout="out('1769639894748899311');" style="">  58      /*package*/ final class Common {                                                                              </span>
<span  style="">  59                                                                                                                    </span>
<span class="8412616957402907467" onmouseenter="enter('8412616957402907467');" onmouseout="out('8412616957402907467');" style=""><abbr title="  60          // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/math/LongMath.java">  60          // see Google Guava: https://github.com/google/guava/blob/master/guava/src/com/google/common/math/LongMathðŸ”µ</abbr></span>
<span class="-1572685421845796133" onmouseenter="enter('-1572685421845796133');" onmouseout="out('-1572685421845796133');" style="">  61          private static long checkedAdd(long a, long b) {                                                          </span>
<span class="-1527942472133998342" onmouseenter="enter('-1527942472133998342');" onmouseout="out('-1527942472133998342');" style="">  62              long result = a + b;                                                                                  </span>
<span class="-8281399218677613001" onmouseenter="enter('-8281399218677613001');" onmouseout="out('-8281399218677613001');" style="">  63              return checkNoOverflow(result, (a ^ b) &lt; 0 | (a ^ result) &gt;= 0);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  64          }                                                                                                         </span>
<span  style="">  65                                                                                                                    </span>
<span class="6423040751114649745" onmouseenter="enter('6423040751114649745');" onmouseout="out('6423040751114649745');" style="">  66          private static long checkNoOverflow(long result, boolean condition) {                                     </span>
<span class="6603368327369456734" onmouseenter="enter('6603368327369456734');" onmouseout="out('6603368327369456734');" style="">  67              return condition ? result : Long.MAX_VALUE;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  68          }                                                                                                         </span>
<span  style="">  69                                                                                                                    </span>
<span class="1406832824568924523" onmouseenter="enter('1406832824568924523');" onmouseout="out('1406832824568924523');" style="">  70          public static long getStartMs(JobRequest request) {                                                       </span>
<span class="226786102758733848" onmouseenter="enter('226786102758733848');" onmouseout="out('226786102758733848');" style="">  71              return checkedAdd(request.getStartMs(), request.getBackoffOffset());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  72          }                                                                                                         </span>
<span  style="">  73                                                                                                                    </span>
<span class="-3832824197988283345" onmouseenter="enter('-3832824197988283345');" onmouseout="out('-3832824197988283345');" style="">  74          public static long getEndMs(JobRequest request) {                                                         </span>
<span class="-7905467348819582542" onmouseenter="enter('-7905467348819582542');" onmouseout="out('-7905467348819582542');" style="">  75              return checkedAdd(request.getEndMs(), request.getBackoffOffset());                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  76          }                                                                                                         </span>
<span  style="">  77                                                                                                                    </span>
<span class="2658461420075954163" onmouseenter="enter('2658461420075954163');" onmouseout="out('2658461420075954163');" style="">  78          public static long getAverageDelayMs(JobRequest request) {                                                </span>
<span class="5188333912507681776" onmouseenter="enter('5188333912507681776');" onmouseout="out('5188333912507681776');" style="">  79              return checkedAdd(getStartMs(request), (getEndMs(request) - getStartMs(request)) / 2);                </span>












<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  80          }                                                                                                         </span>
<span  style="">  81                                                                                                                    </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style="">  82          private final Context mContext;                                                                           </span>
<span class="3051386596282037072" onmouseenter="enter('3051386596282037072');" onmouseout="out('3051386596282037072');" style="">  83          private final int mJobId;                                                                                 </span>
<span class="6179859670209082226" onmouseenter="enter('6179859670209082226');" onmouseout="out('6179859670209082226');" style="">  84          private final CatLog mCat;                                                                                </span>
<span  style="">  85                                                                                                                    </span>
<span class="5239517905467210385" onmouseenter="enter('5239517905467210385');" onmouseout="out('5239517905467210385');" style="">  86          private final JobManager mJobManager;                                                                     </span>
<span  style="">  87                                                                                                                    </span>
<span class="9207186923120198843" onmouseenter="enter('9207186923120198843');" onmouseout="out('9207186923120198843');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  88 -        public Common(Service service, int jobId) {                                                               </span>
<span class="-3030977859657206756" onmouseenter="enter('-3030977859657206756');" onmouseout="out('-3030977859657206756');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  89 -            mContext = service;                                                                                   </span>
<span class="-4983816859190478642" onmouseenter="enter('-4983816859190478642');" onmouseout="out('-4983816859190478642');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  90 +        public Common(@NonNull Service service, int jobId) {                                                      </span>
<span class="7913494938757178552" onmouseenter="enter('7913494938757178552');" onmouseout="out('7913494938757178552');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  91 +            this(service, service.getClass().getSimpleName(), jobId);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  92 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  93 +                                                                                                                  </span>
<span class="9132788366718402424" onmouseenter="enter('9132788366718402424');" onmouseout="out('9132788366718402424');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  94 +        /*package*/ Common(@NonNull Context context, String loggingTag, int jobId) {                              </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  95 +            mContext = context;                                                                                   </span>
<span class="3380959276812020408" onmouseenter="enter('3380959276812020408');" onmouseout="out('3380959276812020408');" style="">  96              mJobId = jobId;                                                                                       </span>
<span class="67268752679343694" onmouseenter="enter('67268752679343694');" onmouseout="out('67268752679343694');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  97 -            mCat = new JobCat(service.getClass());                                                                </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  98 -                                                                                                                  </span>
<span class="819678989109847509" onmouseenter="enter('819678989109847509');" onmouseout="out('819678989109847509');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -            mJobManager = JobManager.create(service);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 100 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 101 -                                                                                                                  </span>
<span class="697901881928484759" onmouseenter="enter('697901881928484759');" onmouseout="out('697901881928484759');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 102 -        public JobRequest getPendingRequest() {                                                                   </span>
<span class="-630819311965639477" onmouseenter="enter('-630819311965639477');" onmouseout="out('-630819311965639477');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 103 +            mCat = new JobCat(loggingTag);                                                                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +                                                                                                                  </span>
<span class="2088134523180067307" onmouseenter="enter('2088134523180067307');" onmouseout="out('2088134523180067307');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +            mJobManager = JobManager.create(context);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 107 +                                                                                                                  </span>
<span class="-5511335237538855208" onmouseenter="enter('-5511335237538855208');" onmouseout="out('-5511335237538855208');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 108 +        public JobRequest getPendingRequest(boolean cleanUpOrphanedJob) {                                         </span>
<span class="-1539078468410613703" onmouseenter="enter('-1539078468410613703');" onmouseout="out('-1539078468410613703');" style=""> 109              // order is important for logging purposes                                                            </span>
<span class="6754931577315038874" onmouseenter="enter('6754931577315038874');" onmouseout="out('6754931577315038874');" style=""> 110              JobRequest request = mJobManager.getJobRequest(mJobId, true);                                         </span>
<span class="-4807858926389575759" onmouseenter="enter('-4807858926389575759');" onmouseout="out('-4807858926389575759');" style=""> 111              Job job = mJobManager.getJob(mJobId);                                                                 </span>
<span class="80157358755741526" onmouseenter="enter('80157358755741526');" onmouseout="out('80157358755741526');" style=""> 112              boolean periodic = request != null &amp;&amp; request.isPeriodic();                                           </span>
<span  style=""> 113                                                                                                                    </span>
<span class="1317679291661326604" onmouseenter="enter('1317679291661326604');" onmouseout="out('1317679291661326604');" style=""> 114              if (job != null &amp;&amp; !job.isFinished()) {                                                               </span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 115 +                // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 115 +                // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-postingðŸ”µ</abbr></span>
<span class="-5462975656818636592" onmouseenter="enter('-5462975656818636592');" onmouseout="out('-5462975656818636592');" style=""> 116                  mCat.d(&quot;Job %d is already running, %s&quot;, mJobId, request);                                         </span>
<span class="-8865814855968501379" onmouseenter="enter('-8865814855968501379');" onmouseout="out('-8865814855968501379');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 117 +                // not necessary to clean up, the running instance will do that                                   </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 118                  return null;                                                                                      </span>
<span  style=""> 119                                                                                                                    </span>
<span class="-4007651353712364444" onmouseenter="enter('-4007651353712364444');" onmouseout="out('-4007651353712364444');" style=""> 120              } else if (job != null &amp;&amp; !periodic) {                                                                </span>
<span class="599327769680236656" onmouseenter="enter('599327769680236656');" onmouseout="out('599327769680236656');" style=""> 121                  mCat.d(&quot;Job %d already finished, %s&quot;, mJobId, request);                                           </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +                cleanUpOrphanedJob(cleanUpOrphanedJob);                                                           </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 123                  return null;                                                                                      </span>
<span  style=""> 124                                                                                                                    </span>
<span class="-4441559070839346687" onmouseenter="enter('-4441559070839346687');" onmouseout="out('-4441559070839346687');" style=""> 125              } else if (job != null &amp;&amp; System.currentTimeMillis() - job.getFinishedTimeStamp() &lt; 2_000) {          </span>
<span class="161982712671711012" onmouseenter="enter('161982712671711012');" onmouseout="out('161982712671711012');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 126 +                // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-posting-jobs-twice-not-expected"> 126 +                // that&#x27;s probably a platform bug http://stackoverflow.com/questions/33235754/jobscheduler-postingðŸ”µ</abbr></span>
<span class="-2963240540698415567" onmouseenter="enter('-2963240540698415567');" onmouseout="out('-2963240540698415567');" style=""> 127                  mCat.d(&quot;Job %d is periodic and just finished, %s&quot;, mJobId, request);                              </span>
<span class="5118828189189336116" onmouseenter="enter('5118828189189336116');" onmouseout="out('5118828189189336116');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +                // don&#x27;t clean up, periodic job                                                                   </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 129                  return null;                                                                                      </span>
<span  style=""> 130                                                                                                                    </span>
<span class="-6449094046803794181" onmouseenter="enter('-6449094046803794181');" onmouseout="out('-6449094046803794181');" style=""> 131              } else if (request != null &amp;&amp; request.isTransient()) {                                                </span>
<span class="4384727207576607146" onmouseenter="enter('4384727207576607146');" onmouseout="out('4384727207576607146');" style=""> 132                  mCat.d(&quot;Request %d is transient, %s&quot;, mJobId, request);                                           </span>
<span class="5877082491190597240" onmouseenter="enter('5877082491190597240');" onmouseout="out('5877082491190597240');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 133 +                // not necessary to clean up, the JobManager will do this for transient jobs                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 134                  return null;                                                                                      </span>
<span  style=""> 135                                                                                                                    </span>
<span class="-4428555773566380837" onmouseenter="enter('-4428555773566380837');" onmouseout="out('-4428555773566380837');" style=""> 136              } else if (request == null) {                                                                         </span>
<span class="7609103357697598215" onmouseenter="enter('7609103357697598215');" onmouseout="out('7609103357697598215');" style=""> 137                  mCat.d(&quot;Request for ID %d was null&quot;, mJobId);                                                     </span>
<span class="551228072734458705" onmouseenter="enter('551228072734458705');" onmouseout="out('551228072734458705');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 138 +                cleanUpOrphanedJob(cleanUpOrphanedJob);                                                           </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 139                  return null;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140              }                                                                                                     </span>
<span  style=""> 141                                                                                                                    </span>
<span class="-1057636993633179522" onmouseenter="enter('-1057636993633179522');" onmouseout="out('-1057636993633179522');" style=""> 142              return request;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143          }                                                                                                         </span>
<span  style=""> 144                                                                                                                    </span>
<span class="5154748246392482767" onmouseenter="enter('5154748246392482767');" onmouseout="out('5154748246392482767');" style=""> 145          @NonNull                                                                                                  </span>
<span class="1474434811491937762" onmouseenter="enter('1474434811491937762');" onmouseout="out('1474434811491937762');" style=""> 146          public Job.Result executeJobRequest(@NonNull JobRequest request) {                                        </span>
<span class="8785519441075077783" onmouseenter="enter('8785519441075077783');" onmouseout="out('8785519441075077783');" style=""> 147              long waited = System.currentTimeMillis() - request.getScheduledAt();                                  </span>
<span class="-521988911558271196" onmouseenter="enter('-521988911558271196');" onmouseout="out('-521988911558271196');" style=""> 148              String timeWindow;                                                                                    </span>
<span class="-4749167882947985624" onmouseenter="enter('-4749167882947985624');" onmouseout="out('-4749167882947985624');" style=""> 149              if (request.isPeriodic()) {                                                                           </span>
<span class="-1473637266447080664" onmouseenter="enter('-1473637266447080664');" onmouseout="out('-1473637266447080664');" style=""> 150                  timeWindow = &quot;interval &quot; + JobUtil.timeToString(request.getIntervalMs());                         </span>
<span class="7076130925826682266" onmouseenter="enter('7076130925826682266');" onmouseout="out('7076130925826682266');" style=""> 151              } else if (JobApi.V_14.equals(request.getJobApi())) {                                                 </span>
<span class="-1520611369215068334" onmouseenter="enter('-1520611369215068334');" onmouseout="out('-1520611369215068334');" style=""> 152                  timeWindow = &quot;delay &quot; + JobUtil.timeToString(getAverageDelayMs(request));                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 153              } else {                                                                                              </span>



<span class="-6246254348184491385" onmouseenter="enter('-6246254348184491385');" onmouseout="out('-6246254348184491385');" style=""><abbr title=" 154                  timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMs(request)),"> 154                  timeWindow = String.format(Locale.US, &quot;start %s, end %s&quot;, JobUtil.timeToString(getStartMs(request)ðŸ”µ</abbr></span>
<span class="6965396589660564452" onmouseenter="enter('6965396589660564452');" onmouseout="out('6965396589660564452');" style=""> 155                          JobUtil.timeToString(getEndMs(request)));                                                 </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156              }                                                                                                     </span>
<span  style=""> 157                                                                                                                    </span>
<span class="-8808967967811702611" onmouseenter="enter('-8808967967811702611');" onmouseout="out('-8808967967811702611');" style=""> 158              if (Looper.myLooper() == Looper.getMainLooper()) {                                                    </span>
<span class="-1368751502622418275" onmouseenter="enter('-1368751502622418275');" onmouseout="out('-1368751502622418275');" style=""> 159                  mCat.w(&quot;Running JobRequest on a main thread, this could cause stutter or ANR in your app.&quot;);      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160              }                                                                                                     </span>
<span  style=""> 161                                                                                                                    </span>
<span class="-1843046913616870974" onmouseenter="enter('-1843046913616870974');" onmouseout="out('-1843046913616870974');" style=""> 162              mCat.d(&quot;Run job, %s, waited %s, %s&quot;, request, JobUtil.timeToString(waited), timeWindow);              </span>
<span class="-4828048199353050218" onmouseenter="enter('-4828048199353050218');" onmouseout="out('-4828048199353050218');" style=""> 163              JobExecutor jobExecutor = mJobManager.getJobExecutor();                                               </span>
<span class="-1235692988875235782" onmouseenter="enter('-1235692988875235782');" onmouseout="out('-1235692988875235782');" style=""> 164              Job job = null;                                                                                       </span>
<span  style=""> 165                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 166              try {                                                                                                 </span>
<span class="-9073677935190895883" onmouseenter="enter('-9073677935190895883');" onmouseout="out('-9073677935190895883');" style=""> 167                  // create job first before setting it transient, avoids a race condition while rescheduling jobs  </span>
<span class="1625132338136195706" onmouseenter="enter('1625132338136195706');" onmouseout="out('1625132338136195706');" style=""> 168                  job = mJobManager.getJobCreatorHolder().createJob(request.getTag());                              </span>
<span  style=""> 169                                                                                                                    </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 170                  if (!request.isPeriodic()) {                                                                      </span>
<span class="3122394794119912241" onmouseenter="enter('3122394794119912241');" onmouseout="out('3122394794119912241');" style=""> 171                      request.setTransient(true);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172                  }                                                                                                 </span>
<span  style=""> 173                                                                                                                    </span>
<span class="-2797125910631995922" onmouseenter="enter('-2797125910631995922');" onmouseout="out('-2797125910631995922');" style=""> 174                  Future&lt;Job.Result&gt; future = jobExecutor.execute(mContext, request, job);                          </span>
<span class="-4410702629486134619" onmouseenter="enter('-4410702629486134619');" onmouseout="out('-4410702629486134619');" style=""> 175                  if (future == null) {                                                                             </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 176                      return Job.Result.FAILURE;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177                  }                                                                                                 </span>
<span  style=""> 178                                                                                                                    </span>
<span class="5244342940061655384" onmouseenter="enter('5244342940061655384');" onmouseout="out('5244342940061655384');" style=""> 179                  // wait until done                                                                                </span>
<span class="-4728317628971455727" onmouseenter="enter('-4728317628971455727');" onmouseout="out('-4728317628971455727');" style=""> 180                  Job.Result result = future.get();                                                                 </span>
<span class="368857225067072174" onmouseenter="enter('368857225067072174');" onmouseout="out('368857225067072174');" style=""> 181                  mCat.d(&quot;Finished job, %s %s&quot;, request, result);                                                   </span>
<span class="-6419540350677864751" onmouseenter="enter('-6419540350677864751');" onmouseout="out('-6419540350677864751');" style=""> 182                  return result;                                                                                    </span>
<span  style=""> 183                                                                                                                    </span>
<span class="2273166757001165010" onmouseenter="enter('2273166757001165010');" onmouseout="out('2273166757001165010');" style=""> 184              } catch (InterruptedException | ExecutionException e) {                                               </span>
<span class="-1683580236663429788" onmouseenter="enter('-1683580236663429788');" onmouseout="out('-1683580236663429788');" style=""> 185                  mCat.e(e);                                                                                        </span>
<span  style=""> 186                                                                                                                    </span>
<span class="6519543964694909858" onmouseenter="enter('6519543964694909858');" onmouseout="out('6519543964694909858');" style=""> 187                  if (job != null) {                                                                                </span>
<span class="-9041905225007822866" onmouseenter="enter('-9041905225007822866');" onmouseout="out('-9041905225007822866');" style=""> 188                      job.cancel();                                                                                 </span>
<span class="3580809215980372017" onmouseenter="enter('3580809215980372017');" onmouseout="out('3580809215980372017');" style=""> 189                      mCat.e(&quot;Canceled %s&quot;, request);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190                  }                                                                                                 </span>
<span  style=""> 191                                                                                                                    </span>
<span class="1517479204923502265" onmouseenter="enter('1517479204923502265');" onmouseout="out('1517479204923502265');" style=""> 192                  return Job.Result.FAILURE;                                                                        </span>
<span  style=""> 193                                                                                                                    </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 194              } finally {                                                                                           </span>
<span class="-3487888380990104274" onmouseenter="enter('-3487888380990104274');" onmouseout="out('-3487888380990104274');" style=""> 195                  if (!request.isPeriodic()) {                                                                      </span>
<span class="1449747436325478708" onmouseenter="enter('1449747436325478708');" onmouseout="out('1449747436325478708');" style=""> 196                      mJobManager.getJobStorage().remove(request);                                                  </span>




<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199          }                                                                                                         </span>
<span  style=""> 200                                                                                                                    </span>
<span class="-5091037902047692513" onmouseenter="enter('-5091037902047692513');" onmouseout="out('-5091037902047692513');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 201 -        public void cleanUpOrphanedJob() {                                                                        </span>
<span class="6651175145696850096" onmouseenter="enter('6651175145696850096');" onmouseout="out('6651175145696850096');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 202 -            cleanUpOrphanedJob(mContext, mJobId);                                                                 </span>
<span class="-3194552414098127961" onmouseenter="enter('-3194552414098127961');" onmouseout="out('-3194552414098127961');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 203 +        private void cleanUpOrphanedJob(boolean cleanUp) {                                                        </span>
<span class="8101282554241671494" onmouseenter="enter('8101282554241671494');" onmouseout="out('8101282554241671494');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 204 +            if (cleanUp) {                                                                                        </span>
<span class="6651175145696850096" onmouseenter="enter('6651175145696850096');" onmouseout="out('6651175145696850096');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 205 +                cleanUpOrphanedJob(mContext, mJobId);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 206 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207          }                                                                                                         </span>
<span  style=""> 208                                                                                                                    </span>
<span class="3574082725044615574" onmouseenter="enter('3574082725044615574');" onmouseout="out('3574082725044615574');" style=""> 209          public static void cleanUpOrphanedJob(Context context, int jobId) {                                       </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 210              /*                                                                                                    </span>
<span class="4873467377157825728" onmouseenter="enter('4873467377157825728');" onmouseout="out('4873467377157825728');" style=""><abbr title=" 211               * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are still around."> 211               * That&#x27;s necessary if the database was deleted and jobs (especially the JobScheduler) are still arounðŸ”µ</abbr></span>
<span class="7880315656890986822" onmouseenter="enter('7880315656890986822');" onmouseout="out('7880315656890986822');" style=""><abbr title=" 212               * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the old one. Here"> 212               * Then if a new job is being scheduled, it&#x27;s possible that the new job has the ID of the old one. HerðŸ”µ</abbr></span>
<span class="7642695698821586509" onmouseenter="enter('7642695698821586509');" onmouseout="out('7642695698821586509');" style=""> 213               * we make sure, that no job is left in the system.                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 214               */                                                                                                   </span>
<span class="-1280302924927314158" onmouseenter="enter('-1280302924927314158');" onmouseout="out('-1280302924927314158');" style=""> 215              for (JobApi jobApi : JobApi.values()) {                                                               </span>
<span class="-5474372138432799739" onmouseenter="enter('-5474372138432799739');" onmouseout="out('-5474372138432799739');" style=""> 216                  if (jobApi.isSupported(context)) {                                                                </span>
<span class="-5924449239106429276" onmouseenter="enter('-5924449239106429276');" onmouseout="out('-5924449239106429276');" style=""> 217                      jobApi.getCachedProxy(context).cancel(jobId);                                                 </span>





<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            